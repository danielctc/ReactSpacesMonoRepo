function u_e(n,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var sE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function g0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mM={exports:{}},Yb={},gM={exports:{}},fr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r$;function d_e(){if(r$)return fr;r$=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),A=Symbol.iterator;function N(be){return be===null||typeof be!="object"?null:(be=A&&be[A]||be["@@iterator"],typeof be=="function"?be:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,z={};function H(be,Te,Ae){this.props=be,this.context=Te,this.refs=z,this.updater=Ae||F}H.prototype.isReactComponent={},H.prototype.setState=function(be,Te){if(typeof be!="object"&&typeof be!="function"&&be!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,be,Te,"setState")},H.prototype.forceUpdate=function(be){this.updater.enqueueForceUpdate(this,be,"forceUpdate")};function te(){}te.prototype=H.prototype;function K(be,Te,Ae){this.props=be,this.context=Te,this.refs=z,this.updater=Ae||F}var ne=K.prototype=new te;ne.constructor=K,j(ne,H.prototype),ne.isPureReactComponent=!0;var de=Array.isArray,oe=Object.prototype.hasOwnProperty,ge={current:null},ee={key:!0,ref:!0,__self:!0,__source:!0};function Z(be,Te,Ae){var Ue,ze={},et=null,nt=null;if(Te!=null)for(Ue in Te.ref!==void 0&&(nt=Te.ref),Te.key!==void 0&&(et=""+Te.key),Te)oe.call(Te,Ue)&&!ee.hasOwnProperty(Ue)&&(ze[Ue]=Te[Ue]);var dt=arguments.length-2;if(dt===1)ze.children=Ae;else if(1<dt){for(var Xe=Array(dt),Ct=0;Ct<dt;Ct++)Xe[Ct]=arguments[Ct+2];ze.children=Xe}if(be&&be.defaultProps)for(Ue in dt=be.defaultProps,dt)ze[Ue]===void 0&&(ze[Ue]=dt[Ue]);return{$$typeof:n,type:be,key:et,ref:nt,props:ze,_owner:ge.current}}function J(be,Te){return{$$typeof:n,type:be.type,key:Te,ref:be.ref,props:be.props,_owner:be._owner}}function se(be){return typeof be=="object"&&be!==null&&be.$$typeof===n}function he(be){var Te={"=":"=0",":":"=2"};return"$"+be.replace(/[=:]/g,function(Ae){return Te[Ae]})}var pe=/\/+/g;function le(be,Te){return typeof be=="object"&&be!==null&&be.key!=null?he(""+be.key):Te.toString(36)}function Me(be,Te,Ae,Ue,ze){var et=typeof be;(et==="undefined"||et==="boolean")&&(be=null);var nt=!1;if(be===null)nt=!0;else switch(et){case"string":case"number":nt=!0;break;case"object":switch(be.$$typeof){case n:case t:nt=!0}}if(nt)return nt=be,ze=ze(nt),be=Ue===""?"."+le(nt,0):Ue,de(ze)?(Ae="",be!=null&&(Ae=be.replace(pe,"$&/")+"/"),Me(ze,Te,Ae,"",function(Ct){return Ct})):ze!=null&&(se(ze)&&(ze=J(ze,Ae+(!ze.key||nt&&nt.key===ze.key?"":(""+ze.key).replace(pe,"$&/")+"/")+be)),Te.push(ze)),1;if(nt=0,Ue=Ue===""?".":Ue+":",de(be))for(var dt=0;dt<be.length;dt++){et=be[dt];var Xe=Ue+le(et,dt);nt+=Me(et,Te,Ae,Xe,ze)}else if(Xe=N(be),typeof Xe=="function")for(be=Xe.call(be),dt=0;!(et=be.next()).done;)et=et.value,Xe=Ue+le(et,dt++),nt+=Me(et,Te,Ae,Xe,ze);else if(et==="object")throw Te=String(be),Error("Objects are not valid as a React child (found: "+(Te==="[object Object]"?"object with keys {"+Object.keys(be).join(", ")+"}":Te)+"). If you meant to render a collection of children, use an array instead.");return nt}function He(be,Te,Ae){if(be==null)return be;var Ue=[],ze=0;return Me(be,Ue,"","",function(et){return Te.call(Ae,et,ze++)}),Ue}function rt(be){if(be._status===-1){var Te=be._result;Te=Te(),Te.then(function(Ae){(be._status===0||be._status===-1)&&(be._status=1,be._result=Ae)},function(Ae){(be._status===0||be._status===-1)&&(be._status=2,be._result=Ae)}),be._status===-1&&(be._status=0,be._result=Te)}if(be._status===1)return be._result.default;throw be._result}var we={current:null},Ce={transition:null},ve={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:Ce,ReactCurrentOwner:ge};function Ne(){throw Error("act(...) is not supported in production builds of React.")}return fr.Children={map:He,forEach:function(be,Te,Ae){He(be,function(){Te.apply(this,arguments)},Ae)},count:function(be){var Te=0;return He(be,function(){Te++}),Te},toArray:function(be){return He(be,function(Te){return Te})||[]},only:function(be){if(!se(be))throw Error("React.Children.only expected to receive a single React element child.");return be}},fr.Component=H,fr.Fragment=s,fr.Profiler=l,fr.PureComponent=K,fr.StrictMode=a,fr.Suspense=v,fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ve,fr.act=Ne,fr.cloneElement=function(be,Te,Ae){if(be==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+be+".");var Ue=j({},be.props),ze=be.key,et=be.ref,nt=be._owner;if(Te!=null){if(Te.ref!==void 0&&(et=Te.ref,nt=ge.current),Te.key!==void 0&&(ze=""+Te.key),be.type&&be.type.defaultProps)var dt=be.type.defaultProps;for(Xe in Te)oe.call(Te,Xe)&&!ee.hasOwnProperty(Xe)&&(Ue[Xe]=Te[Xe]===void 0&&dt!==void 0?dt[Xe]:Te[Xe])}var Xe=arguments.length-2;if(Xe===1)Ue.children=Ae;else if(1<Xe){dt=Array(Xe);for(var Ct=0;Ct<Xe;Ct++)dt[Ct]=arguments[Ct+2];Ue.children=dt}return{$$typeof:n,type:be.type,key:ze,ref:et,props:Ue,_owner:nt}},fr.createContext=function(be){return be={$$typeof:f,_currentValue:be,_currentValue2:be,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},be.Provider={$$typeof:d,_context:be},be.Consumer=be},fr.createElement=Z,fr.createFactory=function(be){var Te=Z.bind(null,be);return Te.type=be,Te},fr.createRef=function(){return{current:null}},fr.forwardRef=function(be){return{$$typeof:E,render:be}},fr.isValidElement=se,fr.lazy=function(be){return{$$typeof:w,_payload:{_status:-1,_result:be},_init:rt}},fr.memo=function(be,Te){return{$$typeof:T,type:be,compare:Te===void 0?null:Te}},fr.startTransition=function(be){var Te=Ce.transition;Ce.transition={};try{be()}finally{Ce.transition=Te}},fr.unstable_act=Ne,fr.useCallback=function(be,Te){return we.current.useCallback(be,Te)},fr.useContext=function(be){return we.current.useContext(be)},fr.useDebugValue=function(){},fr.useDeferredValue=function(be){return we.current.useDeferredValue(be)},fr.useEffect=function(be,Te){return we.current.useEffect(be,Te)},fr.useId=function(){return we.current.useId()},fr.useImperativeHandle=function(be,Te,Ae){return we.current.useImperativeHandle(be,Te,Ae)},fr.useInsertionEffect=function(be,Te){return we.current.useInsertionEffect(be,Te)},fr.useLayoutEffect=function(be,Te){return we.current.useLayoutEffect(be,Te)},fr.useMemo=function(be,Te){return we.current.useMemo(be,Te)},fr.useReducer=function(be,Te,Ae){return we.current.useReducer(be,Te,Ae)},fr.useRef=function(be){return we.current.useRef(be)},fr.useState=function(be){return we.current.useState(be)},fr.useSyncExternalStore=function(be,Te,Ae){return we.current.useSyncExternalStore(be,Te,Ae)},fr.useTransition=function(){return we.current.useTransition()},fr.version="18.3.1",fr}var i$;function Cu(){return i$||(i$=1,gM.exports=d_e()),gM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s$;function h_e(){if(s$)return Yb;s$=1;var n=Cu(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(E,v,T){var w,A={},N=null,F=null;T!==void 0&&(N=""+T),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(F=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(A[w]=v[w]);if(E&&E.defaultProps)for(w in v=E.defaultProps,v)A[w]===void 0&&(A[w]=v[w]);return{$$typeof:t,type:E,key:N,ref:F,props:A,_owner:l.current}}return Yb.Fragment=s,Yb.jsx=f,Yb.jsxs=f,Yb}var o$;function p_e(){return o$||(o$=1,mM.exports=h_e()),mM.exports}var I=p_e(),L=Cu();const ni=g0(L),a$=u_e({__proto__:null,default:ni},[L]);var GP={},_M={exports:{}},jc={},EM={exports:{}},yM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c$;function f_e(){return c$||(c$=1,function(n){function t(Ce,ve){var Ne=Ce.length;Ce.push(ve);e:for(;0<Ne;){var be=Ne-1>>>1,Te=Ce[be];if(0<l(Te,ve))Ce[be]=ve,Ce[Ne]=Te,Ne=be;else break e}}function s(Ce){return Ce.length===0?null:Ce[0]}function a(Ce){if(Ce.length===0)return null;var ve=Ce[0],Ne=Ce.pop();if(Ne!==ve){Ce[0]=Ne;e:for(var be=0,Te=Ce.length,Ae=Te>>>1;be<Ae;){var Ue=2*(be+1)-1,ze=Ce[Ue],et=Ue+1,nt=Ce[et];if(0>l(ze,Ne))et<Te&&0>l(nt,ze)?(Ce[be]=nt,Ce[et]=Ne,be=et):(Ce[be]=ze,Ce[Ue]=Ne,be=Ue);else if(et<Te&&0>l(nt,Ne))Ce[be]=nt,Ce[et]=Ne,be=et;else break e}}return ve}function l(Ce,ve){var Ne=Ce.sortIndex-ve.sortIndex;return Ne!==0?Ne:Ce.id-ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var f=Date,E=f.now();n.unstable_now=function(){return f.now()-E}}var v=[],T=[],w=1,A=null,N=3,F=!1,j=!1,z=!1,H=typeof setTimeout=="function"?setTimeout:null,te=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(Ce){for(var ve=s(T);ve!==null;){if(ve.callback===null)a(T);else if(ve.startTime<=Ce)a(T),ve.sortIndex=ve.expirationTime,t(v,ve);else break;ve=s(T)}}function de(Ce){if(z=!1,ne(Ce),!j)if(s(v)!==null)j=!0,rt(oe);else{var ve=s(T);ve!==null&&we(de,ve.startTime-Ce)}}function oe(Ce,ve){j=!1,z&&(z=!1,te(Z),Z=-1),F=!0;var Ne=N;try{for(ne(ve),A=s(v);A!==null&&(!(A.expirationTime>ve)||Ce&&!he());){var be=A.callback;if(typeof be=="function"){A.callback=null,N=A.priorityLevel;var Te=be(A.expirationTime<=ve);ve=n.unstable_now(),typeof Te=="function"?A.callback=Te:A===s(v)&&a(v),ne(ve)}else a(v);A=s(v)}if(A!==null)var Ae=!0;else{var Ue=s(T);Ue!==null&&we(de,Ue.startTime-ve),Ae=!1}return Ae}finally{A=null,N=Ne,F=!1}}var ge=!1,ee=null,Z=-1,J=5,se=-1;function he(){return!(n.unstable_now()-se<J)}function pe(){if(ee!==null){var Ce=n.unstable_now();se=Ce;var ve=!0;try{ve=ee(!0,Ce)}finally{ve?le():(ge=!1,ee=null)}}else ge=!1}var le;if(typeof K=="function")le=function(){K(pe)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,He=Me.port2;Me.port1.onmessage=pe,le=function(){He.postMessage(null)}}else le=function(){H(pe,0)};function rt(Ce){ee=Ce,ge||(ge=!0,le())}function we(Ce,ve){Z=H(function(){Ce(n.unstable_now())},ve)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ce){Ce.callback=null},n.unstable_continueExecution=function(){j||F||(j=!0,rt(oe))},n.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<Ce?Math.floor(1e3/Ce):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return s(v)},n.unstable_next=function(Ce){switch(N){case 1:case 2:case 3:var ve=3;break;default:ve=N}var Ne=N;N=ve;try{return Ce()}finally{N=Ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ce,ve){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Ne=N;N=Ce;try{return ve()}finally{N=Ne}},n.unstable_scheduleCallback=function(Ce,ve,Ne){var be=n.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?be+Ne:be):Ne=be,Ce){case 1:var Te=-1;break;case 2:Te=250;break;case 5:Te=1073741823;break;case 4:Te=1e4;break;default:Te=5e3}return Te=Ne+Te,Ce={id:w++,callback:ve,priorityLevel:Ce,startTime:Ne,expirationTime:Te,sortIndex:-1},Ne>be?(Ce.sortIndex=Ne,t(T,Ce),s(v)===null&&Ce===s(T)&&(z?(te(Z),Z=-1):z=!0,we(de,Ne-be))):(Ce.sortIndex=Te,t(v,Ce),j||F||(j=!0,rt(oe))),Ce},n.unstable_shouldYield=he,n.unstable_wrapCallback=function(Ce){var ve=N;return function(){var Ne=N;N=ve;try{return Ce.apply(this,arguments)}finally{N=Ne}}}}(yM)),yM}var l$;function m_e(){return l$||(l$=1,EM.exports=f_e()),EM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u$;function g_e(){if(u$)return jc;u$=1;var n=Cu(),t=m_e();function s(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,b=1;b<arguments.length;b++)g+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},A={};function N(p){return v.call(A,p)?!0:v.call(w,p)?!1:T.test(p)?A[p]=!0:(w[p]=!0,!1)}function F(p,g,b,O){if(b!==null&&b.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:b!==null?!b.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function j(p,g,b,O){if(g===null||typeof g>"u"||F(p,g,b,O))return!0;if(O)return!1;if(b!==null)switch(b.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function z(p,g,b,O,M,G,ae){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=M,this.mustUseProperty=b,this.propertyName=p,this.type=g,this.sanitizeURL=G,this.removeEmptyString=ae}var H={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){H[p]=new z(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];H[g]=new z(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){H[p]=new z(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){H[p]=new z(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){H[p]=new z(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){H[p]=new z(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){H[p]=new z(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){H[p]=new z(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){H[p]=new z(p,5,!1,p.toLowerCase(),null,!1,!1)});var te=/[\-:]([a-z])/g;function K(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(te,K);H[g]=new z(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(te,K);H[g]=new z(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(te,K);H[g]=new z(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){H[p]=new z(p,1,!1,p.toLowerCase(),null,!1,!1)}),H.xlinkHref=new z("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){H[p]=new z(p,1,!1,p.toLowerCase(),null,!0,!0)});function ne(p,g,b,O){var M=H.hasOwnProperty(g)?H[g]:null;(M!==null?M.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(j(g,b,M,O)&&(b=null),O||M===null?N(g)&&(b===null?p.removeAttribute(g):p.setAttribute(g,""+b)):M.mustUseProperty?p[M.propertyName]=b===null?M.type===3?!1:"":b:(g=M.attributeName,O=M.attributeNamespace,b===null?p.removeAttribute(g):(M=M.type,b=M===3||M===4&&b===!0?"":""+b,O?p.setAttributeNS(O,g,b):p.setAttribute(g,b))))}var de=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oe=Symbol.for("react.element"),ge=Symbol.for("react.portal"),ee=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),he=Symbol.for("react.context"),pe=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),He=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),Ce=Symbol.iterator;function ve(p){return p===null||typeof p!="object"?null:(p=Ce&&p[Ce]||p["@@iterator"],typeof p=="function"?p:null)}var Ne=Object.assign,be;function Te(p){if(be===void 0)try{throw Error()}catch(b){var g=b.stack.trim().match(/\n( *(at )?)/);be=g&&g[1]||""}return`
`+be+p}var Ae=!1;function Ue(p,g){if(!p||Ae)return"";Ae=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(it){var O=it}Reflect.construct(p,[],g)}else{try{g.call()}catch(it){O=it}p.call(g.prototype)}else{try{throw Error()}catch(it){O=it}p()}}catch(it){if(it&&O&&typeof it.stack=="string"){for(var M=it.stack.split(`
`),G=O.stack.split(`
`),ae=M.length-1,Ie=G.length-1;1<=ae&&0<=Ie&&M[ae]!==G[Ie];)Ie--;for(;1<=ae&&0<=Ie;ae--,Ie--)if(M[ae]!==G[Ie]){if(ae!==1||Ie!==1)do if(ae--,Ie--,0>Ie||M[ae]!==G[Ie]){var xe=`
`+M[ae].replace(" at new "," at ");return p.displayName&&xe.includes("<anonymous>")&&(xe=xe.replace("<anonymous>",p.displayName)),xe}while(1<=ae&&0<=Ie);break}}}finally{Ae=!1,Error.prepareStackTrace=b}return(p=p?p.displayName||p.name:"")?Te(p):""}function ze(p){switch(p.tag){case 5:return Te(p.type);case 16:return Te("Lazy");case 13:return Te("Suspense");case 19:return Te("SuspenseList");case 0:case 2:case 15:return p=Ue(p.type,!1),p;case 11:return p=Ue(p.type.render,!1),p;case 1:return p=Ue(p.type,!0),p;default:return""}}function et(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case ee:return"Fragment";case ge:return"Portal";case J:return"Profiler";case Z:return"StrictMode";case le:return"Suspense";case Me:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case he:return(p.displayName||"Context")+".Consumer";case se:return(p._context.displayName||"Context")+".Provider";case pe:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case He:return g=p.displayName||null,g!==null?g:et(p.type)||"Memo";case rt:g=p._payload,p=p._init;try{return et(p(g))}catch{}}return null}function nt(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return et(g);case 8:return g===Z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function dt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Xe(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Ct(p){var g=Xe(p)?"checked":"value",b=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),O=""+p[g];if(!p.hasOwnProperty(g)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var M=b.get,G=b.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return M.call(this)},set:function(ae){O=""+ae,G.call(this,ae)}}),Object.defineProperty(p,g,{enumerable:b.enumerable}),{getValue:function(){return O},setValue:function(ae){O=""+ae},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function hn(p){p._valueTracker||(p._valueTracker=Ct(p))}function Ut(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var b=g.getValue(),O="";return p&&(O=Xe(p)?p.checked?"true":"false":p.value),p=O,p!==b?(g.setValue(p),!0):!1}function ln(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function xn(p,g){var b=g.checked;return Ne({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??p._wrapperState.initialChecked})}function Yt(p,g){var b=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;b=dt(g.value!=null?g.value:b),p._wrapperState={initialChecked:O,initialValue:b,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Yn(p,g){g=g.checked,g!=null&&ne(p,"checked",g,!1)}function Kt(p,g){Yn(p,g);var b=dt(g.value),O=g.type;if(b!=null)O==="number"?(b===0&&p.value===""||p.value!=b)&&(p.value=""+b):p.value!==""+b&&(p.value=""+b);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Fe(p,g.type,b):g.hasOwnProperty("defaultValue")&&Fe(p,g.type,dt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Re(p,g,b){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,b||g===p.value||(p.value=g),p.defaultValue=g}b=p.name,b!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,b!==""&&(p.name=b)}function Fe(p,g,b){(g!=="number"||ln(p.ownerDocument)!==p)&&(b==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+b&&(p.defaultValue=""+b))}var Ke=Array.isArray;function _t(p,g,b,O){if(p=p.options,g){g={};for(var M=0;M<b.length;M++)g["$"+b[M]]=!0;for(b=0;b<p.length;b++)M=g.hasOwnProperty("$"+p[b].value),p[b].selected!==M&&(p[b].selected=M),M&&O&&(p[b].defaultSelected=!0)}else{for(b=""+dt(b),g=null,M=0;M<p.length;M++){if(p[M].value===b){p[M].selected=!0,O&&(p[M].defaultSelected=!0);return}g!==null||p[M].disabled||(g=p[M])}g!==null&&(g.selected=!0)}}function vt(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(s(91));return Ne({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Ge(p,g){var b=g.value;if(b==null){if(b=g.children,g=g.defaultValue,b!=null){if(g!=null)throw Error(s(92));if(Ke(b)){if(1<b.length)throw Error(s(93));b=b[0]}g=b}g==null&&(g=""),b=g}p._wrapperState={initialValue:dt(b)}}function Ot(p,g){var b=dt(g.value),O=dt(g.defaultValue);b!=null&&(b=""+b,b!==p.value&&(p.value=b),g.defaultValue==null&&p.defaultValue!==b&&(p.defaultValue=b)),O!=null&&(p.defaultValue=""+O)}function Xt(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function pn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function an(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?pn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var ir,na=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,b,O,M){MSApp.execUnsafeLocalFunction(function(){return p(g,b,O,M)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(ir=ir||document.createElement("div"),ir.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=ir.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Vt(p,g){if(g){var b=p.firstChild;if(b&&b===p.lastChild&&b.nodeType===3){b.nodeValue=g;return}}p.textContent=g}var sn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ii=["Webkit","ms","Moz","O"];Object.keys(sn).forEach(function(p){Ii.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),sn[g]=sn[p]})});function di(p,g,b){return g==null||typeof g=="boolean"||g===""?"":b||typeof g!="number"||g===0||sn.hasOwnProperty(p)&&sn[p]?(""+g).trim():g+"px"}function yi(p,g){p=p.style;for(var b in g)if(g.hasOwnProperty(b)){var O=b.indexOf("--")===0,M=di(b,g[b],O);b==="float"&&(b="cssFloat"),O?p.setProperty(b,M):p[b]=M}}var dr=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ua(p,g){if(g){if(dr[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(s(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(s(61))}if(g.style!=null&&typeof g.style!="object")throw Error(s(62))}}function Zc(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var co=null;function lo(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var xl=null,Us=null,ac=null;function ra(p){if(p=Xf(p)){if(typeof xl!="function")throw Error(s(280));var g=p.stateNode;g&&(g=Jf(g),xl(p.stateNode,p.type,g))}}function cc(p){Us?ac?ac.push(p):ac=[p]:Us=p}function el(){if(Us){var p=Us,g=ac;if(ac=Us=null,ra(p),g)for(p=0;p<g.length;p++)ra(g[p])}}function Nu(p,g){return p(g)}function lc(){}var tl=!1;function Co(p,g,b){if(tl)return p(g,b);tl=!0;try{return Nu(p,g,b)}finally{tl=!1,(Us!==null||ac!==null)&&(lc(),el())}}function Ni(p,g){var b=p.stateNode;if(b===null)return null;var O=Jf(b);if(O===null)return null;b=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(b&&typeof b!="function")throw Error(s(231,g,typeof b));return b}var ls=!1;if(E)try{var Va={};Object.defineProperty(Va,"passive",{get:function(){ls=!0}}),window.addEventListener("test",Va,Va),window.removeEventListener("test",Va,Va)}catch{ls=!1}function Du(p,g,b,O,M,G,ae,Ie,xe){var it=Array.prototype.slice.call(arguments,3);try{g.apply(b,it)}catch(It){this.onError(It)}}var uc=!1,ia=null,sa=!1,Dd=null,Og={onError:function(p){uc=!0,ia=p}};function Lu(p,g,b,O,M,G,ae,Ie,xe){uc=!1,ia=null,Du.apply(Og,arguments)}function ip(p,g,b,O,M,G,ae,Ie,xe){if(Lu.apply(this,arguments),uc){if(uc){var it=ia;uc=!1,ia=null}else throw Error(s(198));sa||(sa=!0,Dd=it)}}function Vs(p){var g=p,b=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(b=g.return),p=g.return;while(p)}return g.tag===3?b:null}function xu(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function oa(p){if(Vs(p)!==p)throw Error(s(188))}function Ld(p){var g=p.alternate;if(!g){if(g=Vs(p),g===null)throw Error(s(188));return g!==p?null:p}for(var b=p,O=g;;){var M=b.return;if(M===null)break;var G=M.alternate;if(G===null){if(O=M.return,O!==null){b=O;continue}break}if(M.child===G.child){for(G=M.child;G;){if(G===b)return oa(M),p;if(G===O)return oa(M),g;G=G.sibling}throw Error(s(188))}if(b.return!==O.return)b=M,O=G;else{for(var ae=!1,Ie=M.child;Ie;){if(Ie===b){ae=!0,b=M,O=G;break}if(Ie===O){ae=!0,O=M,b=G;break}Ie=Ie.sibling}if(!ae){for(Ie=G.child;Ie;){if(Ie===b){ae=!0,b=G,O=M;break}if(Ie===O){ae=!0,O=G,b=M;break}Ie=Ie.sibling}if(!ae)throw Error(s(189))}}if(b.alternate!==O)throw Error(s(190))}if(b.tag!==3)throw Error(s(188));return b.stateNode.current===b?p:g}function xd(p){return p=Ld(p),p!==null?Fa(p):null}function Fa(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=Fa(p);if(g!==null)return g;p=p.sibling}return null}var Md=t.unstable_scheduleCallback,Mu=t.unstable_cancelCallback,Io=t.unstable_shouldYield,Ud=t.unstable_requestPaint,Fr=t.unstable_now,hi=t.unstable_getCurrentPriorityLevel,dc=t.unstable_ImmediatePriority,nl=t.unstable_UserBlockingPriority,aa=t.unstable_NormalPriority,sp=t.unstable_LowPriority,Vd=t.unstable_IdlePriority,Ml=null,uo=null;function xf(p){if(uo&&typeof uo.onCommitFiberRoot=="function")try{uo.onCommitFiberRoot(Ml,p,void 0,(p.current.flags&128)===128)}catch{}}var Ks=Math.clz32?Math.clz32:Fd,op=Math.log,rl=Math.LN2;function Fd(p){return p>>>=0,p===0?32:31-(op(p)/rl|0)|0}var jd=64,hr=4194304;function Ul(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Vl(p,g){var b=p.pendingLanes;if(b===0)return 0;var O=0,M=p.suspendedLanes,G=p.pingedLanes,ae=b&268435455;if(ae!==0){var Ie=ae&~M;Ie!==0?O=Ul(Ie):(G&=ae,G!==0&&(O=Ul(G)))}else ae=b&~M,ae!==0?O=Ul(ae):G!==0&&(O=Ul(G));if(O===0)return 0;if(g!==0&&g!==O&&(g&M)===0&&(M=O&-O,G=g&-g,M>=G||M===16&&(G&4194240)!==0))return g;if((O&4)!==0&&(O|=b&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=O;0<g;)b=31-Ks(g),M=1<<b,O|=p[b],g&=~M;return O}function Uu(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ja(p,g){for(var b=p.suspendedLanes,O=p.pingedLanes,M=p.expirationTimes,G=p.pendingLanes;0<G;){var ae=31-Ks(G),Ie=1<<ae,xe=M[ae];xe===-1?((Ie&b)===0||(Ie&O)!==0)&&(M[ae]=Uu(Ie,g)):xe<=g&&(p.expiredLanes|=Ie),G&=~Ie}}function Ao(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Vu(){var p=jd;return jd<<=1,(jd&4194240)===0&&(jd=64),p}function il(p){for(var g=[],b=0;31>b;b++)g.push(p);return g}function Fl(p,g,b){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-Ks(g),p[g]=b}function zr(p,g){var b=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<b;){var M=31-Ks(b),G=1<<M;g[M]=0,O[M]=-1,p[M]=-1,b&=~G}}function Ba(p,g){var b=p.entangledLanes|=g;for(p=p.entanglements;b;){var O=31-Ks(b),M=1<<O;M&g|p[O]&g&&(p[O]|=g),b&=~M}}var nr=0;function hc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Mf,jl,Bd,ap,Uf,cp=!1,Po=[],ns=null,Oo=null,ko=null,Bl=new Map,No=new Map,Do=[],Vf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pc(p,g){switch(p){case"focusin":case"focusout":ns=null;break;case"dragenter":case"dragleave":Oo=null;break;case"mouseover":case"mouseout":ko=null;break;case"pointerover":case"pointerout":Bl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":No.delete(g.pointerId)}}function us(p,g,b,O,M,G){return p===null||p.nativeEvent!==G?(p={blockedOn:g,domEventName:b,eventSystemFlags:O,nativeEvent:G,targetContainers:[M]},g!==null&&(g=Xf(g),g!==null&&jl(g)),p):(p.eventSystemFlags|=O,g=p.targetContainers,M!==null&&g.indexOf(M)===-1&&g.push(M),p)}function Fu(p,g,b,O,M){switch(g){case"focusin":return ns=us(ns,p,g,b,O,M),!0;case"dragenter":return Oo=us(Oo,p,g,b,O,M),!0;case"mouseover":return ko=us(ko,p,g,b,O,M),!0;case"pointerover":var G=M.pointerId;return Bl.set(G,us(Bl.get(G)||null,p,g,b,O,M)),!0;case"gotpointercapture":return G=M.pointerId,No.set(G,us(No.get(G)||null,p,g,b,O,M)),!0}return!1}function lp(p){var g=_p(p.target);if(g!==null){var b=Vs(g);if(b!==null){if(g=b.tag,g===13){if(g=xu(b),g!==null){p.blockedOn=g,Uf(p.priority,function(){Bd(b)});return}}else if(g===3&&b.stateNode.current.memoizedState.isDehydrated){p.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}p.blockedOn=null}function sl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var b=_r(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(b===null){b=p.nativeEvent;var O=new b.constructor(b.type,b);co=O,b.target.dispatchEvent(O),co=null}else return g=Xf(b),g!==null&&jl(g),p.blockedOn=b,!1;g.shift()}return!0}function Wl(p,g,b){sl(p)&&b.delete(g)}function Ff(){cp=!1,ns!==null&&sl(ns)&&(ns=null),Oo!==null&&sl(Oo)&&(Oo=null),ko!==null&&sl(ko)&&(ko=null),Bl.forEach(Wl),No.forEach(Wl)}function ca(p,g){p.blockedOn===g&&(p.blockedOn=null,cp||(cp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Ff)))}function la(p){function g(M){return ca(M,p)}if(0<Po.length){ca(Po[0],p);for(var b=1;b<Po.length;b++){var O=Po[b];O.blockedOn===p&&(O.blockedOn=null)}}for(ns!==null&&ca(ns,p),Oo!==null&&ca(Oo,p),ko!==null&&ca(ko,p),Bl.forEach(g),No.forEach(g),b=0;b<Do.length;b++)O=Do[b],O.blockedOn===p&&(O.blockedOn=null);for(;0<Do.length&&(b=Do[0],b.blockedOn===null);)lp(b),b.blockedOn===null&&Do.shift()}var ol=de.ReactCurrentBatchConfig,Se=!0;function De(p,g,b,O){var M=nr,G=ol.transition;ol.transition=null;try{nr=1,$t(p,g,b,O)}finally{nr=M,ol.transition=G}}function tt(p,g,b,O){var M=nr,G=ol.transition;ol.transition=null;try{nr=4,$t(p,g,b,O)}finally{nr=M,ol.transition=G}}function $t(p,g,b,O){if(Se){var M=_r(p,g,b,O);if(M===null)KE(p,g,O,Hn,b),pc(p,O);else if(Fu(M,p,g,b,O))O.stopPropagation();else if(pc(p,O),g&4&&-1<Vf.indexOf(p)){for(;M!==null;){var G=Xf(M);if(G!==null&&Mf(G),G=_r(p,g,b,O),G===null&&KE(p,g,O,Hn,b),G===M)break;M=G}M!==null&&O.stopPropagation()}else KE(p,g,O,null,b)}}var Hn=null;function _r(p,g,b,O){if(Hn=null,p=lo(O),p=_p(p),p!==null)if(g=Vs(p),g===null)p=null;else if(b=g.tag,b===13){if(p=xu(g),p!==null)return p;p=null}else if(b===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return Hn=p,null}function jr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hi()){case dc:return 1;case nl:return 4;case aa:case sp:return 16;case Vd:return 536870912;default:return 16}default:return 16}}var cn=null,Nr=null,pi=null;function Is(){if(pi)return pi;var p,g=Nr,b=g.length,O,M="value"in cn?cn.value:cn.textContent,G=M.length;for(p=0;p<b&&g[p]===M[p];p++);var ae=b-p;for(O=1;O<=ae&&g[b-O]===M[G-O];O++);return pi=M.slice(p,1<O?1-O:void 0)}function Lo(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function xo(){return!0}function ju(){return!1}function Ki(p){function g(b,O,M,G,ae){this._reactName=b,this._targetInst=M,this.type=O,this.nativeEvent=G,this.target=ae,this.currentTarget=null;for(var Ie in p)p.hasOwnProperty(Ie)&&(b=p[Ie],this[Ie]=b?b(G):G[Ie]);return this.isDefaultPrevented=(G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1)?xo:ju,this.isPropagationStopped=ju,this}return Ne(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=xo)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=xo)},persist:function(){},isPersistent:xo}),g}var al={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wd=Ki(al),fc=Ne({},al,{view:0,detail:0}),kg=Ki(fc),jf,Bu,Mo,zl=Ne({},fc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Mo&&(Mo&&p.type==="mousemove"?(jf=p.screenX-Mo.screenX,Bu=p.screenY-Mo.screenY):Bu=jf=0,Mo=p),jf)},movementY:function(p){return"movementY"in p?p.movementY:Bu}}),Bf=Ki(zl),Ng=Ne({},zl,{dataTransfer:0}),FE=Ki(Ng),Wf=Ne({},fc,{relatedTarget:0}),zf=Ki(Wf),Wu=Ne({},al,{animationName:0,elapsedTime:0,pseudoElement:0}),zu=Ki(Wu),Gu=Ne({},al,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Dg=Ki(Gu),jE=Ne({},al,{data:0}),Mn=Ki(jE),Gf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Uo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function WE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=BE[p])?!!g[p]:!1}function mc(){return WE}var C=Ne({},fc,{key:function(p){if(p.key){var g=Gf[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=Lo(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Uo[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mc,charCode:function(p){return p.type==="keypress"?Lo(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Lo(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),B=Ki(C),Q=Ne({},zl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fe=Ki(Q),qe=Ne({},fc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mc}),at=Ki(qe),xt=Ne({},al,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gr=Ki(xt),ii=Ne({},zl,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Er=Ki(ii),Fs=[9,13,27,32],ds=E&&"CompositionEvent"in window,Wa=null;E&&"documentMode"in document&&(Wa=document.documentMode);var Vo=E&&"TextEvent"in window&&!Wa,up=E&&(!ds||Wa&&8<Wa&&11>=Wa),Hf=" ",za=!1;function sC(p,g){switch(p){case"keyup":return Fs.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function oC(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var $f=!1;function G1(p,g){switch(p){case"compositionend":return oC(g);case"keypress":return g.which!==32?null:(za=!0,Hf);case"textInput":return p=g.data,p===Hf&&za?null:p;default:return null}}function aC(p,g){if($f)return p==="compositionend"||!ds&&sC(p,g)?(p=Is(),pi=Nr=cn=null,$f=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return up&&g.locale!=="ko"?null:g.data;default:return null}}var H1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cC(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!H1[p.type]:g==="textarea"}function D0(p,g,b,O){cc(O),g=qE(g,"onChange"),0<g.length&&(b=new Wd("onChange","change",null,b,O),p.push({event:b,listeners:g}))}var dp=null,Lg=null;function $1(p){j0(p,0)}function hp(p){var g=Ep(p);if(Ut(g))return p}function K1(p,g){if(p==="change")return g}var lC=!1;if(E){var L0;if(E){var gc="oninput"in document;if(!gc){var uC=document.createElement("div");uC.setAttribute("oninput","return;"),gc=typeof uC.oninput=="function"}L0=gc}else L0=!1;lC=L0&&(!document.documentMode||9<document.documentMode)}function dC(){dp&&(dp.detachEvent("onpropertychange",ua),Lg=dp=null)}function ua(p){if(p.propertyName==="value"&&hp(Lg)){var g=[];D0(g,Lg,p,lo(p)),Co($1,g)}}function q1(p,g,b){p==="focusin"?(dC(),dp=g,Lg=b,dp.attachEvent("onpropertychange",ua)):p==="focusout"&&dC()}function Y1(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return hp(Lg)}function X1(p,g){if(p==="click")return hp(g)}function J1(p,g){if(p==="input"||p==="change")return hp(g)}function hC(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var cl=typeof Object.is=="function"?Object.is:hC;function xg(p,g){if(cl(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var b=Object.keys(p),O=Object.keys(g);if(b.length!==O.length)return!1;for(O=0;O<b.length;O++){var M=b[O];if(!v.call(g,M)||!cl(p[M],g[M]))return!1}return!0}function pC(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function x0(p,g){var b=pC(p);p=0;for(var O;b;){if(b.nodeType===3){if(O=p+b.textContent.length,p<=g&&O>=g)return{node:b,offset:g-p};p=O}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=pC(b)}}function fC(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?fC(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function mC(){for(var p=window,g=ln();g instanceof p.HTMLIFrameElement;){try{var b=typeof g.contentWindow.location.href=="string"}catch{b=!1}if(b)p=g.contentWindow;else break;g=ln(p.document)}return g}function Mg(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function M0(p){var g=mC(),b=p.focusedElem,O=p.selectionRange;if(g!==b&&b&&b.ownerDocument&&fC(b.ownerDocument.documentElement,b)){if(O!==null&&Mg(b)){if(g=O.start,p=O.end,p===void 0&&(p=g),"selectionStart"in b)b.selectionStart=g,b.selectionEnd=Math.min(p,b.value.length);else if(p=(g=b.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var M=b.textContent.length,G=Math.min(O.start,M);O=O.end===void 0?G:Math.min(O.end,M),!p.extend&&G>O&&(M=O,O=G,G=M),M=x0(b,G);var ae=x0(b,O);M&&ae&&(p.rangeCount!==1||p.anchorNode!==M.node||p.anchorOffset!==M.offset||p.focusNode!==ae.node||p.focusOffset!==ae.offset)&&(g=g.createRange(),g.setStart(M.node,M.offset),p.removeAllRanges(),G>O?(p.addRange(g),p.extend(ae.node,ae.offset)):(g.setEnd(ae.node,ae.offset),p.addRange(g)))}}for(g=[],p=b;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<g.length;b++)p=g[b],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var Q1=E&&"documentMode"in document&&11>=document.documentMode,ot=null,U0=null,Ug=null,V0=!1;function gC(p,g,b){var O=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;V0||ot==null||ot!==ln(O)||(O=ot,"selectionStart"in O&&Mg(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),Ug&&xg(Ug,O)||(Ug=O,O=qE(U0,"onSelect"),0<O.length&&(g=new Wd("onSelect","select",null,g,b),p.push({event:g,listeners:O}),g.target=ot)))}function zE(p,g){var b={};return b[p.toLowerCase()]=g.toLowerCase(),b["Webkit"+p]="webkit"+g,b["Moz"+p]="moz"+g,b}var Kf={animationend:zE("Animation","AnimationEnd"),animationiteration:zE("Animation","AnimationIteration"),animationstart:zE("Animation","AnimationStart"),transitionend:zE("Transition","TransitionEnd")},F0={},_C={};E&&(_C=document.createElement("div").style,"AnimationEvent"in window||(delete Kf.animationend.animation,delete Kf.animationiteration.animation,delete Kf.animationstart.animation),"TransitionEvent"in window||delete Kf.transitionend.transition);function pp(p){if(F0[p])return F0[p];if(!Kf[p])return p;var g=Kf[p],b;for(b in g)if(g.hasOwnProperty(b)&&b in _C)return F0[p]=g[b];return p}var fp=pp("animationend"),EC=pp("animationiteration"),yC=pp("animationstart"),vC=pp("transitionend"),SC=new Map,GE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zd(p,g){SC.set(p,g),d(g,[p])}for(var HE=0;HE<GE.length;HE++){var Ga=GE[HE],Z1=Ga.toLowerCase(),Vg=Ga[0].toUpperCase()+Ga.slice(1);zd(Z1,"on"+Vg)}zd(fp,"onAnimationEnd"),zd(EC,"onAnimationIteration"),zd(yC,"onAnimationStart"),zd("dblclick","onDoubleClick"),zd("focusin","onFocus"),zd("focusout","onBlur"),zd(vC,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fg));function TC(p,g,b){var O=p.type||"unknown-event";p.currentTarget=b,ip(O,g,void 0,p),p.currentTarget=null}function j0(p,g){g=(g&4)!==0;for(var b=0;b<p.length;b++){var O=p[b],M=O.event;O=O.listeners;e:{var G=void 0;if(g)for(var ae=O.length-1;0<=ae;ae--){var Ie=O[ae],xe=Ie.instance,it=Ie.currentTarget;if(Ie=Ie.listener,xe!==G&&M.isPropagationStopped())break e;TC(M,Ie,it),G=xe}else for(ae=0;ae<O.length;ae++){if(Ie=O[ae],xe=Ie.instance,it=Ie.currentTarget,Ie=Ie.listener,xe!==G&&M.isPropagationStopped())break e;TC(M,Ie,it),G=xe}}}if(sa)throw p=Dd,sa=!1,Dd=null,p}function vi(p,g){var b=g[zg];b===void 0&&(b=g[zg]=new Set);var O=p+"__bubble";b.has(O)||(bC(g,p,2,!1),b.add(O))}function B0(p,g,b){var O=0;g&&(O|=4),bC(b,p,O,g)}var $E="_reactListening"+Math.random().toString(36).slice(2);function mp(p){if(!p[$E]){p[$E]=!0,a.forEach(function(b){b!=="selectionchange"&&(eN.has(b)||B0(b,!1,p),B0(b,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[$E]||(g[$E]=!0,B0("selectionchange",!1,g))}}function bC(p,g,b,O){switch(jr(g)){case 1:var M=De;break;case 4:M=tt;break;default:M=$t}b=M.bind(null,g,b,p),M=void 0,!ls||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(M=!0),O?M!==void 0?p.addEventListener(g,b,{capture:!0,passive:M}):p.addEventListener(g,b,!0):M!==void 0?p.addEventListener(g,b,{passive:M}):p.addEventListener(g,b,!1)}function KE(p,g,b,O,M){var G=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ae=O.tag;if(ae===3||ae===4){var Ie=O.stateNode.containerInfo;if(Ie===M||Ie.nodeType===8&&Ie.parentNode===M)break;if(ae===4)for(ae=O.return;ae!==null;){var xe=ae.tag;if((xe===3||xe===4)&&(xe=ae.stateNode.containerInfo,xe===M||xe.nodeType===8&&xe.parentNode===M))return;ae=ae.return}for(;Ie!==null;){if(ae=_p(Ie),ae===null)return;if(xe=ae.tag,xe===5||xe===6){O=G=ae;continue e}Ie=Ie.parentNode}}O=O.return}Co(function(){var it=G,It=lo(b),At=[];e:{var Rt=SC.get(p);if(Rt!==void 0){var Gt=Wd,Zt=p;switch(p){case"keypress":if(Lo(b)===0)break e;case"keydown":case"keyup":Gt=B;break;case"focusin":Zt="focus",Gt=zf;break;case"focusout":Zt="blur",Gt=zf;break;case"beforeblur":case"afterblur":Gt=zf;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Gt=Bf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Gt=FE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Gt=at;break;case fp:case EC:case yC:Gt=zu;break;case vC:Gt=Gr;break;case"scroll":Gt=kg;break;case"wheel":Gt=Er;break;case"copy":case"cut":case"paste":Gt=Dg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Gt=fe}var en=(g&4)!==0,Yi=!en&&p==="scroll",Je=en?Rt!==null?Rt+"Capture":null:Rt;en=[];for(var Ve=it,Ze;Ve!==null;){Ze=Ve;var Nt=Ze.stateNode;if(Ze.tag===5&&Nt!==null&&(Ze=Nt,Je!==null&&(Nt=Ni(Ve,Je),Nt!=null&&en.push(qf(Ve,Nt,Ze)))),Yi)break;Ve=Ve.return}0<en.length&&(Rt=new Gt(Rt,Zt,null,b,It),At.push({event:Rt,listeners:en}))}}if((g&7)===0){e:{if(Rt=p==="mouseover"||p==="pointerover",Gt=p==="mouseout"||p==="pointerout",Rt&&b!==co&&(Zt=b.relatedTarget||b.fromElement)&&(_p(Zt)||Zt[_c]))break e;if((Gt||Rt)&&(Rt=It.window===It?It:(Rt=It.ownerDocument)?Rt.defaultView||Rt.parentWindow:window,Gt?(Zt=b.relatedTarget||b.toElement,Gt=it,Zt=Zt?_p(Zt):null,Zt!==null&&(Yi=Vs(Zt),Zt!==Yi||Zt.tag!==5&&Zt.tag!==6)&&(Zt=null)):(Gt=null,Zt=it),Gt!==Zt)){if(en=Bf,Nt="onMouseLeave",Je="onMouseEnter",Ve="mouse",(p==="pointerout"||p==="pointerover")&&(en=fe,Nt="onPointerLeave",Je="onPointerEnter",Ve="pointer"),Yi=Gt==null?Rt:Ep(Gt),Ze=Zt==null?Rt:Ep(Zt),Rt=new en(Nt,Ve+"leave",Gt,b,It),Rt.target=Yi,Rt.relatedTarget=Ze,Nt=null,_p(It)===it&&(en=new en(Je,Ve+"enter",Zt,b,It),en.target=Ze,en.relatedTarget=Yi,Nt=en),Yi=Nt,Gt&&Zt)t:{for(en=Gt,Je=Zt,Ve=0,Ze=en;Ze;Ze=gp(Ze))Ve++;for(Ze=0,Nt=Je;Nt;Nt=gp(Nt))Ze++;for(;0<Ve-Ze;)en=gp(en),Ve--;for(;0<Ze-Ve;)Je=gp(Je),Ze--;for(;Ve--;){if(en===Je||Je!==null&&en===Je.alternate)break t;en=gp(en),Je=gp(Je)}en=null}else en=null;Gt!==null&&jg(At,Rt,Gt,en,!1),Zt!==null&&Yi!==null&&jg(At,Yi,Zt,en,!0)}}e:{if(Rt=it?Ep(it):window,Gt=Rt.nodeName&&Rt.nodeName.toLowerCase(),Gt==="select"||Gt==="input"&&Rt.type==="file")var tn=K1;else if(cC(Rt))if(lC)tn=J1;else{tn=Y1;var fn=q1}else(Gt=Rt.nodeName)&&Gt.toLowerCase()==="input"&&(Rt.type==="checkbox"||Rt.type==="radio")&&(tn=X1);if(tn&&(tn=tn(p,it))){D0(At,tn,b,It);break e}fn&&fn(p,Rt,it),p==="focusout"&&(fn=Rt._wrapperState)&&fn.controlled&&Rt.type==="number"&&Fe(Rt,"number",Rt.value)}switch(fn=it?Ep(it):window,p){case"focusin":(cC(fn)||fn.contentEditable==="true")&&(ot=fn,U0=it,Ug=null);break;case"focusout":Ug=U0=ot=null;break;case"mousedown":V0=!0;break;case"contextmenu":case"mouseup":case"dragend":V0=!1,gC(At,b,It);break;case"selectionchange":if(Q1)break;case"keydown":case"keyup":gC(At,b,It)}var En;if(ds)e:{switch(p){case"compositionstart":var On="onCompositionStart";break e;case"compositionend":On="onCompositionEnd";break e;case"compositionupdate":On="onCompositionUpdate";break e}On=void 0}else $f?sC(p,b)&&(On="onCompositionEnd"):p==="keydown"&&b.keyCode===229&&(On="onCompositionStart");On&&(up&&b.locale!=="ko"&&($f||On!=="onCompositionStart"?On==="onCompositionEnd"&&$f&&(En=Is()):(cn=It,Nr="value"in cn?cn.value:cn.textContent,$f=!0)),fn=qE(it,On),0<fn.length&&(On=new Mn(On,p,null,b,It),At.push({event:On,listeners:fn}),En?On.data=En:(En=oC(b),En!==null&&(On.data=En)))),(En=Vo?G1(p,b):aC(p,b))&&(it=qE(it,"onBeforeInput"),0<it.length&&(It=new Mn("onBeforeInput","beforeinput",null,b,It),At.push({event:It,listeners:it}),It.data=En))}j0(At,g)})}function qf(p,g,b){return{instance:p,listener:g,currentTarget:b}}function qE(p,g){for(var b=g+"Capture",O=[];p!==null;){var M=p,G=M.stateNode;M.tag===5&&G!==null&&(M=G,G=Ni(p,b),G!=null&&O.unshift(qf(p,G,M)),G=Ni(p,g),G!=null&&O.push(qf(p,G,M))),p=p.return}return O}function gp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function jg(p,g,b,O,M){for(var G=g._reactName,ae=[];b!==null&&b!==O;){var Ie=b,xe=Ie.alternate,it=Ie.stateNode;if(xe!==null&&xe===O)break;Ie.tag===5&&it!==null&&(Ie=it,M?(xe=Ni(b,G),xe!=null&&ae.unshift(qf(b,xe,Ie))):M||(xe=Ni(b,G),xe!=null&&ae.push(qf(b,xe,Ie)))),b=b.return}ae.length!==0&&p.push({event:g,listeners:ae})}var tN=/\r\n?/g,nN=/\u0000|\uFFFD/g;function wC(p){return(typeof p=="string"?p:""+p).replace(tN,`
`).replace(nN,"")}function YE(p,g,b){if(g=wC(g),wC(p)!==g&&b)throw Error(s(425))}function XE(){}var JE=null,Bg=null;function W0(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Wg=typeof setTimeout=="function"?setTimeout:void 0,rN=typeof clearTimeout=="function"?clearTimeout:void 0,RC=typeof Promise=="function"?Promise:void 0,iN=typeof queueMicrotask=="function"?queueMicrotask:typeof RC<"u"?function(p){return RC.resolve(null).then(p).catch(sN)}:Wg;function sN(p){setTimeout(function(){throw p})}function z0(p,g){var b=g,O=0;do{var M=b.nextSibling;if(p.removeChild(b),M&&M.nodeType===8)if(b=M.data,b==="/$"){if(O===0){p.removeChild(M),la(g);return}O--}else b!=="$"&&b!=="$?"&&b!=="$!"||O++;b=M}while(b);la(g)}function Gd(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function CC(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var b=p.data;if(b==="$"||b==="$!"||b==="$?"){if(g===0)return p;g--}else b==="/$"&&g++}p=p.previousSibling}return null}var Yf=Math.random().toString(36).slice(2),Gl="__reactFiber$"+Yf,Hd="__reactProps$"+Yf,_c="__reactContainer$"+Yf,zg="__reactEvents$"+Yf,oN="__reactListeners$"+Yf,aN="__reactHandles$"+Yf;function _p(p){var g=p[Gl];if(g)return g;for(var b=p.parentNode;b;){if(g=b[_c]||b[Gl]){if(b=g.alternate,g.child!==null||b!==null&&b.child!==null)for(p=CC(p);p!==null;){if(b=p[Gl])return b;p=CC(p)}return g}p=b,b=p.parentNode}return null}function Xf(p){return p=p[Gl]||p[_c],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Ep(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function Jf(p){return p[Hd]||null}var G0=[],Qf=-1;function Ec(p){return{current:p}}function Si(p){0>Qf||(p.current=G0[Qf],G0[Qf]=null,Qf--)}function fi(p,g){Qf++,G0[Qf]=p.current,p.current=g}var $d={},ho=Ec($d),da=Ec(!1),yp=$d;function vp(p,g){var b=p.type.contextTypes;if(!b)return $d;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var M={},G;for(G in b)M[G]=g[G];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=M),M}function ha(p){return p=p.childContextTypes,p!=null}function QE(){Si(da),Si(ho)}function IC(p,g,b){if(ho.current!==$d)throw Error(s(168));fi(ho,g),fi(da,b)}function ZE(p,g,b){var O=p.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return b;O=O.getChildContext();for(var M in O)if(!(M in g))throw Error(s(108,nt(p)||"Unknown",M));return Ne({},b,O)}function ey(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||$d,yp=ho.current,fi(ho,p),fi(da,da.current),!0}function AC(p,g,b){var O=p.stateNode;if(!O)throw Error(s(169));b?(p=ZE(p,g,yp),O.__reactInternalMemoizedMergedChildContext=p,Si(da),Si(ho),fi(ho,p)):Si(da),fi(da,b)}var yc=null,ty=!1,H0=!1;function PC(p){yc===null?yc=[p]:yc.push(p)}function cN(p){ty=!0,PC(p)}function Kd(){if(!H0&&yc!==null){H0=!0;var p=0,g=nr;try{var b=yc;for(nr=1;p<b.length;p++){var O=b[p];do O=O(!0);while(O!==null)}yc=null,ty=!1}catch(M){throw yc!==null&&(yc=yc.slice(p+1)),Md(dc,Kd),M}finally{nr=g,H0=!1}}return null}var Zf=[],Hu=0,Gg=null,ny=0,vc=[],Ha=0,Sp=null,$u=1,Ku="";function qu(p,g){Zf[Hu++]=ny,Zf[Hu++]=Gg,Gg=p,ny=g}function ry(p,g,b){vc[Ha++]=$u,vc[Ha++]=Ku,vc[Ha++]=Sp,Sp=p;var O=$u;p=Ku;var M=32-Ks(O)-1;O&=~(1<<M),b+=1;var G=32-Ks(g)+M;if(30<G){var ae=M-M%5;G=(O&(1<<ae)-1).toString(32),O>>=ae,M-=ae,$u=1<<32-Ks(g)+M|b<<M|O,Ku=G+p}else $u=1<<G|b<<M|O,Ku=p}function iy(p){p.return!==null&&(qu(p,1),ry(p,1,0))}function Hg(p){for(;p===Gg;)Gg=Zf[--Hu],Zf[Hu]=null,ny=Zf[--Hu],Zf[Hu]=null;for(;p===Sp;)Sp=vc[--Ha],vc[Ha]=null,Ku=vc[--Ha],vc[Ha]=null,$u=vc[--Ha],vc[Ha]=null}var pa=null,fa=null,si=!1,Fo=null;function OC(p,g){var b=qa(5,null,null,0);b.elementType="DELETED",b.stateNode=g,b.return=p,g=p.deletions,g===null?(p.deletions=[b],p.flags|=16):g.push(b)}function kC(p,g){switch(p.tag){case 5:var b=p.type;return g=g.nodeType!==1||b.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,pa=p,fa=Gd(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,pa=p,fa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(b=Sp!==null?{id:$u,overflow:Ku}:null,p.memoizedState={dehydrated:g,treeContext:b,retryLane:1073741824},b=qa(18,null,null,0),b.stateNode=g,b.return=p,p.child=b,pa=p,fa=null,!0):!1;default:return!1}}function sy(p){return(p.mode&1)!==0&&(p.flags&128)===0}function $0(p){if(si){var g=fa;if(g){var b=g;if(!kC(p,g)){if(sy(p))throw Error(s(418));g=Gd(b.nextSibling);var O=pa;g&&kC(p,g)?OC(O,b):(p.flags=p.flags&-4097|2,si=!1,pa=p)}}else{if(sy(p))throw Error(s(418));p.flags=p.flags&-4097|2,si=!1,pa=p}}}function NC(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;pa=p}function $g(p){if(p!==pa)return!1;if(!si)return NC(p),si=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!W0(p.type,p.memoizedProps)),g&&(g=fa)){if(sy(p))throw DC(),Error(s(418));for(;g;)OC(p,g),g=Gd(g.nextSibling)}if(NC(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var b=p.data;if(b==="/$"){if(g===0){fa=Gd(p.nextSibling);break e}g--}else b!=="$"&&b!=="$!"&&b!=="$?"||g++}p=p.nextSibling}fa=null}}else fa=pa?Gd(p.stateNode.nextSibling):null;return!0}function DC(){for(var p=fa;p;)p=Gd(p.nextSibling)}function em(){fa=pa=null,si=!1}function K0(p){Fo===null?Fo=[p]:Fo.push(p)}var lN=de.ReactCurrentBatchConfig;function Kg(p,g,b){if(p=b.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(s(309));var O=b.stateNode}if(!O)throw Error(s(147,p));var M=O,G=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===G?g.ref:(g=function(ae){var Ie=M.refs;ae===null?delete Ie[G]:Ie[G]=ae},g._stringRef=G,g)}if(typeof p!="string")throw Error(s(284));if(!b._owner)throw Error(s(290,p))}return p}function oy(p,g){throw p=Object.prototype.toString.call(g),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function q0(p){var g=p._init;return g(p._payload)}function qd(p){function g(Je,Ve){if(p){var Ze=Je.deletions;Ze===null?(Je.deletions=[Ve],Je.flags|=16):Ze.push(Ve)}}function b(Je,Ve){if(!p)return null;for(;Ve!==null;)g(Je,Ve),Ve=Ve.sibling;return null}function O(Je,Ve){for(Je=new Map;Ve!==null;)Ve.key!==null?Je.set(Ve.key,Ve):Je.set(Ve.index,Ve),Ve=Ve.sibling;return Je}function M(Je,Ve){return Je=nd(Je,Ve),Je.index=0,Je.sibling=null,Je}function G(Je,Ve,Ze){return Je.index=Ze,p?(Ze=Je.alternate,Ze!==null?(Ze=Ze.index,Ze<Ve?(Je.flags|=2,Ve):Ze):(Je.flags|=2,Ve)):(Je.flags|=1048576,Ve)}function ae(Je){return p&&Je.alternate===null&&(Je.flags|=2),Je}function Ie(Je,Ve,Ze,Nt){return Ve===null||Ve.tag!==6?(Ve=kT(Ze,Je.mode,Nt),Ve.return=Je,Ve):(Ve=M(Ve,Ze),Ve.return=Je,Ve)}function xe(Je,Ve,Ze,Nt){var tn=Ze.type;return tn===ee?It(Je,Ve,Ze.props.children,Nt,Ze.key):Ve!==null&&(Ve.elementType===tn||typeof tn=="object"&&tn!==null&&tn.$$typeof===rt&&q0(tn)===Ve.type)?(Nt=M(Ve,Ze.props),Nt.ref=Kg(Je,Ve,Ze),Nt.return=Je,Nt):(Nt=$y(Ze.type,Ze.key,Ze.props,null,Je.mode,Nt),Nt.ref=Kg(Je,Ve,Ze),Nt.return=Je,Nt)}function it(Je,Ve,Ze,Nt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==Ze.containerInfo||Ve.stateNode.implementation!==Ze.implementation?(Ve=NT(Ze,Je.mode,Nt),Ve.return=Je,Ve):(Ve=M(Ve,Ze.children||[]),Ve.return=Je,Ve)}function It(Je,Ve,Ze,Nt,tn){return Ve===null||Ve.tag!==7?(Ve=Dp(Ze,Je.mode,Nt,tn),Ve.return=Je,Ve):(Ve=M(Ve,Ze),Ve.return=Je,Ve)}function At(Je,Ve,Ze){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=kT(""+Ve,Je.mode,Ze),Ve.return=Je,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case oe:return Ze=$y(Ve.type,Ve.key,Ve.props,null,Je.mode,Ze),Ze.ref=Kg(Je,null,Ve),Ze.return=Je,Ze;case ge:return Ve=NT(Ve,Je.mode,Ze),Ve.return=Je,Ve;case rt:var Nt=Ve._init;return At(Je,Nt(Ve._payload),Ze)}if(Ke(Ve)||ve(Ve))return Ve=Dp(Ve,Je.mode,Ze,null),Ve.return=Je,Ve;oy(Je,Ve)}return null}function Rt(Je,Ve,Ze,Nt){var tn=Ve!==null?Ve.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return tn!==null?null:Ie(Je,Ve,""+Ze,Nt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case oe:return Ze.key===tn?xe(Je,Ve,Ze,Nt):null;case ge:return Ze.key===tn?it(Je,Ve,Ze,Nt):null;case rt:return tn=Ze._init,Rt(Je,Ve,tn(Ze._payload),Nt)}if(Ke(Ze)||ve(Ze))return tn!==null?null:It(Je,Ve,Ze,Nt,null);oy(Je,Ze)}return null}function Gt(Je,Ve,Ze,Nt,tn){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Je=Je.get(Ze)||null,Ie(Ve,Je,""+Nt,tn);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case oe:return Je=Je.get(Nt.key===null?Ze:Nt.key)||null,xe(Ve,Je,Nt,tn);case ge:return Je=Je.get(Nt.key===null?Ze:Nt.key)||null,it(Ve,Je,Nt,tn);case rt:var fn=Nt._init;return Gt(Je,Ve,Ze,fn(Nt._payload),tn)}if(Ke(Nt)||ve(Nt))return Je=Je.get(Ze)||null,It(Ve,Je,Nt,tn,null);oy(Ve,Nt)}return null}function Zt(Je,Ve,Ze,Nt){for(var tn=null,fn=null,En=Ve,On=Ve=0,gs=null;En!==null&&On<Ze.length;On++){En.index>On?(gs=En,En=null):gs=En.sibling;var yr=Rt(Je,En,Ze[On],Nt);if(yr===null){En===null&&(En=gs);break}p&&En&&yr.alternate===null&&g(Je,En),Ve=G(yr,Ve,On),fn===null?tn=yr:fn.sibling=yr,fn=yr,En=gs}if(On===Ze.length)return b(Je,En),si&&qu(Je,On),tn;if(En===null){for(;On<Ze.length;On++)En=At(Je,Ze[On],Nt),En!==null&&(Ve=G(En,Ve,On),fn===null?tn=En:fn.sibling=En,fn=En);return si&&qu(Je,On),tn}for(En=O(Je,En);On<Ze.length;On++)gs=Gt(En,Je,On,Ze[On],Nt),gs!==null&&(p&&gs.alternate!==null&&En.delete(gs.key===null?On:gs.key),Ve=G(gs,Ve,On),fn===null?tn=gs:fn.sibling=gs,fn=gs);return p&&En.forEach(function(sh){return g(Je,sh)}),si&&qu(Je,On),tn}function en(Je,Ve,Ze,Nt){var tn=ve(Ze);if(typeof tn!="function")throw Error(s(150));if(Ze=tn.call(Ze),Ze==null)throw Error(s(151));for(var fn=tn=null,En=Ve,On=Ve=0,gs=null,yr=Ze.next();En!==null&&!yr.done;On++,yr=Ze.next()){En.index>On?(gs=En,En=null):gs=En.sibling;var sh=Rt(Je,En,yr.value,Nt);if(sh===null){En===null&&(En=gs);break}p&&En&&sh.alternate===null&&g(Je,En),Ve=G(sh,Ve,On),fn===null?tn=sh:fn.sibling=sh,fn=sh,En=gs}if(yr.done)return b(Je,En),si&&qu(Je,On),tn;if(En===null){for(;!yr.done;On++,yr=Ze.next())yr=At(Je,yr.value,Nt),yr!==null&&(Ve=G(yr,Ve,On),fn===null?tn=yr:fn.sibling=yr,fn=yr);return si&&qu(Je,On),tn}for(En=O(Je,En);!yr.done;On++,yr=Ze.next())yr=Gt(En,Je,On,yr.value,Nt),yr!==null&&(p&&yr.alternate!==null&&En.delete(yr.key===null?On:yr.key),Ve=G(yr,Ve,On),fn===null?tn=yr:fn.sibling=yr,fn=yr);return p&&En.forEach(function(RN){return g(Je,RN)}),si&&qu(Je,On),tn}function Yi(Je,Ve,Ze,Nt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===ee&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case oe:e:{for(var tn=Ze.key,fn=Ve;fn!==null;){if(fn.key===tn){if(tn=Ze.type,tn===ee){if(fn.tag===7){b(Je,fn.sibling),Ve=M(fn,Ze.props.children),Ve.return=Je,Je=Ve;break e}}else if(fn.elementType===tn||typeof tn=="object"&&tn!==null&&tn.$$typeof===rt&&q0(tn)===fn.type){b(Je,fn.sibling),Ve=M(fn,Ze.props),Ve.ref=Kg(Je,fn,Ze),Ve.return=Je,Je=Ve;break e}b(Je,fn);break}else g(Je,fn);fn=fn.sibling}Ze.type===ee?(Ve=Dp(Ze.props.children,Je.mode,Nt,Ze.key),Ve.return=Je,Je=Ve):(Nt=$y(Ze.type,Ze.key,Ze.props,null,Je.mode,Nt),Nt.ref=Kg(Je,Ve,Ze),Nt.return=Je,Je=Nt)}return ae(Je);case ge:e:{for(fn=Ze.key;Ve!==null;){if(Ve.key===fn)if(Ve.tag===4&&Ve.stateNode.containerInfo===Ze.containerInfo&&Ve.stateNode.implementation===Ze.implementation){b(Je,Ve.sibling),Ve=M(Ve,Ze.children||[]),Ve.return=Je,Je=Ve;break e}else{b(Je,Ve);break}else g(Je,Ve);Ve=Ve.sibling}Ve=NT(Ze,Je.mode,Nt),Ve.return=Je,Je=Ve}return ae(Je);case rt:return fn=Ze._init,Yi(Je,Ve,fn(Ze._payload),Nt)}if(Ke(Ze))return Zt(Je,Ve,Ze,Nt);if(ve(Ze))return en(Je,Ve,Ze,Nt);oy(Je,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,Ve!==null&&Ve.tag===6?(b(Je,Ve.sibling),Ve=M(Ve,Ze),Ve.return=Je,Je=Ve):(b(Je,Ve),Ve=kT(Ze,Je.mode,Nt),Ve.return=Je,Je=Ve),ae(Je)):b(Je,Ve)}return Yi}var tm=qd(!0),LC=qd(!1),ay=Ec(null),qg=null,nm=null,cy=null;function Y0(){cy=nm=qg=null}function X0(p){var g=ay.current;Si(ay),p._currentValue=g}function J0(p,g,b){for(;p!==null;){var O=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),p===b)break;p=p.return}}function Yu(p,g){qg=p,cy=nm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(ga=!0),p.firstContext=null)}function Sc(p){var g=p._currentValue;if(cy!==p)if(p={context:p,memoizedValue:g,next:null},nm===null){if(qg===null)throw Error(s(308));nm=p,qg.dependencies={lanes:0,firstContext:p}}else nm=nm.next=p;return g}var Tp=null;function Q0(p){Tp===null?Tp=[p]:Tp.push(p)}function xC(p,g,b,O){var M=g.interleaved;return M===null?(b.next=b,Q0(g)):(b.next=M.next,M.next=b),g.interleaved=b,Xu(p,O)}function Xu(p,g){p.lanes|=g;var b=p.alternate;for(b!==null&&(b.lanes|=g),b=p,p=p.return;p!==null;)p.childLanes|=g,b=p.alternate,b!==null&&(b.childLanes|=g),b=p,p=p.return;return b.tag===3?b.stateNode:null}var Yd=!1;function Yg(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function MC(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Hl(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function Xd(p,g,b){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(br&2)!==0){var M=O.pending;return M===null?g.next=g:(g.next=M.next,M.next=g),O.pending=g,Xu(p,b)}return M=O.interleaved,M===null?(g.next=g,Q0(O)):(g.next=M.next,M.next=g),O.interleaved=g,Xu(p,b)}function Xg(p,g,b){if(g=g.updateQueue,g!==null&&(g=g.shared,(b&4194240)!==0)){var O=g.lanes;O&=p.pendingLanes,b|=O,g.lanes=b,Ba(p,b)}}function UC(p,g){var b=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,b===O)){var M=null,G=null;if(b=b.firstBaseUpdate,b!==null){do{var ae={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};G===null?M=G=ae:G=G.next=ae,b=b.next}while(b!==null);G===null?M=G=g:G=G.next=g}else M=G=g;b={baseState:O.baseState,firstBaseUpdate:M,lastBaseUpdate:G,shared:O.shared,effects:O.effects},p.updateQueue=b;return}p=b.lastBaseUpdate,p===null?b.firstBaseUpdate=g:p.next=g,b.lastBaseUpdate=g}function ly(p,g,b,O){var M=p.updateQueue;Yd=!1;var G=M.firstBaseUpdate,ae=M.lastBaseUpdate,Ie=M.shared.pending;if(Ie!==null){M.shared.pending=null;var xe=Ie,it=xe.next;xe.next=null,ae===null?G=it:ae.next=it,ae=xe;var It=p.alternate;It!==null&&(It=It.updateQueue,Ie=It.lastBaseUpdate,Ie!==ae&&(Ie===null?It.firstBaseUpdate=it:Ie.next=it,It.lastBaseUpdate=xe))}if(G!==null){var At=M.baseState;ae=0,It=it=xe=null,Ie=G;do{var Rt=Ie.lane,Gt=Ie.eventTime;if((O&Rt)===Rt){It!==null&&(It=It.next={eventTime:Gt,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var Zt=p,en=Ie;switch(Rt=g,Gt=b,en.tag){case 1:if(Zt=en.payload,typeof Zt=="function"){At=Zt.call(Gt,At,Rt);break e}At=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=en.payload,Rt=typeof Zt=="function"?Zt.call(Gt,At,Rt):Zt,Rt==null)break e;At=Ne({},At,Rt);break e;case 2:Yd=!0}}Ie.callback!==null&&Ie.lane!==0&&(p.flags|=64,Rt=M.effects,Rt===null?M.effects=[Ie]:Rt.push(Ie))}else Gt={eventTime:Gt,lane:Rt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},It===null?(it=It=Gt,xe=At):It=It.next=Gt,ae|=Rt;if(Ie=Ie.next,Ie===null){if(Ie=M.shared.pending,Ie===null)break;Rt=Ie,Ie=Rt.next,Rt.next=null,M.lastBaseUpdate=Rt,M.shared.pending=null}}while(!0);if(It===null&&(xe=At),M.baseState=xe,M.firstBaseUpdate=it,M.lastBaseUpdate=It,g=M.shared.interleaved,g!==null){M=g;do ae|=M.lane,M=M.next;while(M!==g)}else G===null&&(M.shared.lanes=0);Ap|=ae,p.lanes=ae,p.memoizedState=At}}function VC(p,g,b){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var O=p[g],M=O.callback;if(M!==null){if(O.callback=null,O=b,typeof M!="function")throw Error(s(191,M));M.call(O)}}}var Jg={},$l=Ec(Jg),Qg=Ec(Jg),rm=Ec(Jg);function bp(p){if(p===Jg)throw Error(s(174));return p}function Z0(p,g){switch(fi(rm,g),fi(Qg,p),fi($l,Jg),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:an(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=an(g,p)}Si($l),fi($l,g)}function wp(){Si($l),Si(Qg),Si(rm)}function FC(p){bp(rm.current);var g=bp($l.current),b=an(g,p.type);g!==b&&(fi(Qg,p),fi($l,b))}function im(p){Qg.current===p&&(Si($l),Si(Qg))}var Ai=Ec(0);function Jd(p){for(var g=p;g!==null;){if(g.tag===13){var b=g.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var eT=[];function tT(){for(var p=0;p<eT.length;p++)eT[p]._workInProgressVersionPrimary=null;eT.length=0}var uy=de.ReactCurrentDispatcher,nT=de.ReactCurrentBatchConfig,Kl=0,Di=null,hs=null,ps=null,sm=!1,Zg=!1,e_=0,uN=0;function po(){throw Error(s(321))}function rT(p,g){if(g===null)return!1;for(var b=0;b<g.length&&b<p.length;b++)if(!cl(p[b],g[b]))return!1;return!0}function om(p,g,b,O,M,G){if(Kl=G,Di=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,uy.current=p===null||p.memoizedState===null?pN:XC,p=b(O,M),Zg){G=0;do{if(Zg=!1,e_=0,25<=G)throw Error(s(301));G+=1,ps=hs=null,g.updateQueue=null,uy.current=fN,p=b(O,M)}while(Zg)}if(uy.current=fy,g=hs!==null&&hs.next!==null,Kl=0,ps=hs=Di=null,sm=!1,g)throw Error(s(300));return p}function iT(){var p=e_!==0;return e_=0,p}function jo(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ps===null?Di.memoizedState=ps=p:ps=ps.next=p,ps}function ma(){if(hs===null){var p=Di.alternate;p=p!==null?p.memoizedState:null}else p=hs.next;var g=ps===null?Di.memoizedState:ps.next;if(g!==null)ps=g,hs=p;else{if(p===null)throw Error(s(310));hs=p,p={memoizedState:hs.memoizedState,baseState:hs.baseState,baseQueue:hs.baseQueue,queue:hs.queue,next:null},ps===null?Di.memoizedState=ps=p:ps=ps.next=p}return ps}function Qd(p,g){return typeof g=="function"?g(p):g}function Rp(p){var g=ma(),b=g.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=p;var O=hs,M=O.baseQueue,G=b.pending;if(G!==null){if(M!==null){var ae=M.next;M.next=G.next,G.next=ae}O.baseQueue=M=G,b.pending=null}if(M!==null){G=M.next,O=O.baseState;var Ie=ae=null,xe=null,it=G;do{var It=it.lane;if((Kl&It)===It)xe!==null&&(xe=xe.next={lane:0,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null}),O=it.hasEagerState?it.eagerState:p(O,it.action);else{var At={lane:It,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null};xe===null?(Ie=xe=At,ae=O):xe=xe.next=At,Di.lanes|=It,Ap|=It}it=it.next}while(it!==null&&it!==G);xe===null?ae=O:xe.next=Ie,cl(O,g.memoizedState)||(ga=!0),g.memoizedState=O,g.baseState=ae,g.baseQueue=xe,b.lastRenderedState=O}if(p=b.interleaved,p!==null){M=p;do G=M.lane,Di.lanes|=G,Ap|=G,M=M.next;while(M!==p)}else M===null&&(b.lanes=0);return[g.memoizedState,b.dispatch]}function am(p){var g=ma(),b=g.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=p;var O=b.dispatch,M=b.pending,G=g.memoizedState;if(M!==null){b.pending=null;var ae=M=M.next;do G=p(G,ae.action),ae=ae.next;while(ae!==M);cl(G,g.memoizedState)||(ga=!0),g.memoizedState=G,g.baseQueue===null&&(g.baseState=G),b.lastRenderedState=G}return[G,O]}function jC(){}function sT(p,g){var b=Di,O=ma(),M=g(),G=!cl(O.memoizedState,M);if(G&&(O.memoizedState=M,ga=!0),O=O.queue,Tc(WC.bind(null,b,O,p),[p]),O.getSnapshot!==g||G||ps!==null&&ps.memoizedState.tag&1){if(b.flags|=2048,t_(9,oT.bind(null,b,O,M,g),void 0,null),js===null)throw Error(s(349));(Kl&30)!==0||BC(b,g,M)}return M}function BC(p,g,b){p.flags|=16384,p={getSnapshot:g,value:b},g=Di.updateQueue,g===null?(g={lastEffect:null,stores:null},Di.updateQueue=g,g.stores=[p]):(b=g.stores,b===null?g.stores=[p]:b.push(p))}function oT(p,g,b,O){g.value=b,g.getSnapshot=O,zC(g)&&dy(p)}function WC(p,g,b){return b(function(){zC(g)&&dy(p)})}function zC(p){var g=p.getSnapshot;p=p.value;try{var b=g();return!cl(p,b)}catch{return!0}}function dy(p){var g=Xu(p,1);g!==null&&Cc(g,p,1,-1)}function hy(p){var g=jo();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qd,lastRenderedState:p},g.queue=p,p=p.dispatch=hN.bind(null,Di,p),[g.memoizedState,p]}function t_(p,g,b,O){return p={tag:p,create:g,destroy:b,deps:O,next:null},g=Di.updateQueue,g===null?(g={lastEffect:null,stores:null},Di.updateQueue=g,g.lastEffect=p.next=p):(b=g.lastEffect,b===null?g.lastEffect=p.next=p:(O=b.next,b.next=p,p.next=O,g.lastEffect=p)),p}function GC(){return ma().memoizedState}function n_(p,g,b,O){var M=jo();Di.flags|=p,M.memoizedState=t_(1|g,b,void 0,O===void 0?null:O)}function cm(p,g,b,O){var M=ma();O=O===void 0?null:O;var G=void 0;if(hs!==null){var ae=hs.memoizedState;if(G=ae.destroy,O!==null&&rT(O,ae.deps)){M.memoizedState=t_(g,b,G,O);return}}Di.flags|=p,M.memoizedState=t_(1|g,b,G,O)}function HC(p,g){return n_(8390656,8,p,g)}function Tc(p,g){return cm(2048,8,p,g)}function Cp(p,g){return cm(4,2,p,g)}function Zd(p,g){return cm(4,4,p,g)}function aT(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function cT(p,g,b){return b=b!=null?b.concat([p]):null,cm(4,4,aT.bind(null,g,p),b)}function Ju(){}function py(p,g){var b=ma();g=g===void 0?null:g;var O=b.memoizedState;return O!==null&&g!==null&&rT(g,O[1])?O[0]:(b.memoizedState=[p,g],p)}function $C(p,g){var b=ma();g=g===void 0?null:g;var O=b.memoizedState;return O!==null&&g!==null&&rT(g,O[1])?O[0]:(p=p(),b.memoizedState=[p,g],p)}function lT(p,g,b){return(Kl&21)===0?(p.baseState&&(p.baseState=!1,ga=!0),p.memoizedState=b):(cl(b,g)||(b=Vu(),Di.lanes|=b,Ap|=b,p.baseState=!0),g)}function dN(p,g){var b=nr;nr=b!==0&&4>b?b:4,p(!0);var O=nT.transition;nT.transition={};try{p(!1),g()}finally{nr=b,nT.transition=O}}function uT(){return ma().memoizedState}function KC(p,g,b){var O=Rc(p);if(b={lane:O,action:b,hasEagerState:!1,eagerState:null,next:null},Qu(p))qC(g,b);else if(b=xC(p,g,b,O),b!==null){var M=Xs();Cc(b,p,O,M),YC(b,g,O)}}function hN(p,g,b){var O=Rc(p),M={lane:O,action:b,hasEagerState:!1,eagerState:null,next:null};if(Qu(p))qC(g,M);else{var G=p.alternate;if(p.lanes===0&&(G===null||G.lanes===0)&&(G=g.lastRenderedReducer,G!==null))try{var ae=g.lastRenderedState,Ie=G(ae,b);if(M.hasEagerState=!0,M.eagerState=Ie,cl(Ie,ae)){var xe=g.interleaved;xe===null?(M.next=M,Q0(g)):(M.next=xe.next,xe.next=M),g.interleaved=M;return}}catch{}finally{}b=xC(p,g,M,O),b!==null&&(M=Xs(),Cc(b,p,O,M),YC(b,g,O))}}function Qu(p){var g=p.alternate;return p===Di||g!==null&&g===Di}function qC(p,g){Zg=sm=!0;var b=p.pending;b===null?g.next=g:(g.next=b.next,b.next=g),p.pending=g}function YC(p,g,b){if((b&4194240)!==0){var O=g.lanes;O&=p.pendingLanes,b|=O,g.lanes=b,Ba(p,b)}}var fy={readContext:Sc,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},pN={readContext:Sc,useCallback:function(p,g){return jo().memoizedState=[p,g===void 0?null:g],p},useContext:Sc,useEffect:HC,useImperativeHandle:function(p,g,b){return b=b!=null?b.concat([p]):null,n_(4194308,4,aT.bind(null,g,p),b)},useLayoutEffect:function(p,g){return n_(4194308,4,p,g)},useInsertionEffect:function(p,g){return n_(4,2,p,g)},useMemo:function(p,g){var b=jo();return g=g===void 0?null:g,p=p(),b.memoizedState=[p,g],p},useReducer:function(p,g,b){var O=jo();return g=b!==void 0?b(g):g,O.memoizedState=O.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},O.queue=p,p=p.dispatch=KC.bind(null,Di,p),[O.memoizedState,p]},useRef:function(p){var g=jo();return p={current:p},g.memoizedState=p},useState:hy,useDebugValue:Ju,useDeferredValue:function(p){return jo().memoizedState=p},useTransition:function(){var p=hy(!1),g=p[0];return p=dN.bind(null,p[1]),jo().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,b){var O=Di,M=jo();if(si){if(b===void 0)throw Error(s(407));b=b()}else{if(b=g(),js===null)throw Error(s(349));(Kl&30)!==0||BC(O,g,b)}M.memoizedState=b;var G={value:b,getSnapshot:g};return M.queue=G,HC(WC.bind(null,O,G,p),[p]),O.flags|=2048,t_(9,oT.bind(null,O,G,b,g),void 0,null),b},useId:function(){var p=jo(),g=js.identifierPrefix;if(si){var b=Ku,O=$u;b=(O&~(1<<32-Ks(O)-1)).toString(32)+b,g=":"+g+"R"+b,b=e_++,0<b&&(g+="H"+b.toString(32)),g+=":"}else b=uN++,g=":"+g+"r"+b.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},XC={readContext:Sc,useCallback:py,useContext:Sc,useEffect:Tc,useImperativeHandle:cT,useInsertionEffect:Cp,useLayoutEffect:Zd,useMemo:$C,useReducer:Rp,useRef:GC,useState:function(){return Rp(Qd)},useDebugValue:Ju,useDeferredValue:function(p){var g=ma();return lT(g,hs.memoizedState,p)},useTransition:function(){var p=Rp(Qd)[0],g=ma().memoizedState;return[p,g]},useMutableSource:jC,useSyncExternalStore:sT,useId:uT,unstable_isNewReconciler:!1},fN={readContext:Sc,useCallback:py,useContext:Sc,useEffect:Tc,useImperativeHandle:cT,useInsertionEffect:Cp,useLayoutEffect:Zd,useMemo:$C,useReducer:am,useRef:GC,useState:function(){return am(Qd)},useDebugValue:Ju,useDeferredValue:function(p){var g=ma();return hs===null?g.memoizedState=p:lT(g,hs.memoizedState,p)},useTransition:function(){var p=am(Qd)[0],g=ma().memoizedState;return[p,g]},useMutableSource:jC,useSyncExternalStore:sT,useId:uT,unstable_isNewReconciler:!1};function $a(p,g){if(p&&p.defaultProps){g=Ne({},g),p=p.defaultProps;for(var b in p)g[b]===void 0&&(g[b]=p[b]);return g}return g}function my(p,g,b,O){g=p.memoizedState,b=b(O,g),b=b==null?g:Ne({},g,b),p.memoizedState=b,p.lanes===0&&(p.updateQueue.baseState=b)}var gy={isMounted:function(p){return(p=p._reactInternals)?Vs(p)===p:!1},enqueueSetState:function(p,g,b){p=p._reactInternals;var O=Xs(),M=Rc(p),G=Hl(O,M);G.payload=g,b!=null&&(G.callback=b),g=Xd(p,G,M),g!==null&&(Cc(g,p,M,O),Xg(g,p,M))},enqueueReplaceState:function(p,g,b){p=p._reactInternals;var O=Xs(),M=Rc(p),G=Hl(O,M);G.tag=1,G.payload=g,b!=null&&(G.callback=b),g=Xd(p,G,M),g!==null&&(Cc(g,p,M,O),Xg(g,p,M))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var b=Xs(),O=Rc(p),M=Hl(b,O);M.tag=2,g!=null&&(M.callback=g),g=Xd(p,M,O),g!==null&&(Cc(g,p,O,b),Xg(g,p,O))}};function dT(p,g,b,O,M,G,ae){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,G,ae):g.prototype&&g.prototype.isPureReactComponent?!xg(b,O)||!xg(M,G):!0}function JC(p,g,b){var O=!1,M=$d,G=g.contextType;return typeof G=="object"&&G!==null?G=Sc(G):(M=ha(g)?yp:ho.current,O=g.contextTypes,G=(O=O!=null)?vp(p,M):$d),g=new g(b,G),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=gy,p.stateNode=g,g._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=M,p.__reactInternalMemoizedMaskedChildContext=G),g}function QC(p,g,b,O){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(b,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(b,O),g.state!==p&&gy.enqueueReplaceState(g,g.state,null)}function hT(p,g,b,O){var M=p.stateNode;M.props=b,M.state=p.memoizedState,M.refs={},Yg(p);var G=g.contextType;typeof G=="object"&&G!==null?M.context=Sc(G):(G=ha(g)?yp:ho.current,M.context=vp(p,G)),M.state=p.memoizedState,G=g.getDerivedStateFromProps,typeof G=="function"&&(my(p,g,G,b),M.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(g=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),g!==M.state&&gy.enqueueReplaceState(M,M.state,null),ly(p,b,M,O),M.state=p.memoizedState),typeof M.componentDidMount=="function"&&(p.flags|=4194308)}function lm(p,g){try{var b="",O=g;do b+=ze(O),O=O.return;while(O);var M=b}catch(G){M=`
Error generating stack: `+G.message+`
`+G.stack}return{value:p,source:g,stack:M,digest:null}}function pT(p,g,b){return{value:p,source:null,stack:b??null,digest:g??null}}function fT(p,g){try{console.error(g.value)}catch(b){setTimeout(function(){throw b})}}var mN=typeof WeakMap=="function"?WeakMap:Map;function mT(p,g,b){b=Hl(-1,b),b.tag=3,b.payload={element:null};var O=g.value;return b.callback=function(){Ly||(Ly=!0,CT=O),fT(p,g)},b}function Zu(p,g,b){b=Hl(-1,b),b.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var M=g.value;b.payload=function(){return O(M)},b.callback=function(){fT(p,g)}}var G=p.stateNode;return G!==null&&typeof G.componentDidCatch=="function"&&(b.callback=function(){fT(p,g),typeof O!="function"&&(eh===null?eh=new Set([this]):eh.add(this));var ae=g.stack;this.componentDidCatch(g.value,{componentStack:ae!==null?ae:""})}),b}function ZC(p,g,b){var O=p.pingCache;if(O===null){O=p.pingCache=new mN;var M=new Set;O.set(g,M)}else M=O.get(g),M===void 0&&(M=new Set,O.set(g,M));M.has(b)||(M.add(b),p=bI.bind(null,p,g,b),g.then(p,p))}function eI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function tI(p,g,b,O,M){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(g=Hl(-1,1),g.tag=2,Xd(b,g,1))),b.lanes|=1),p):(p.flags|=65536,p.lanes=M,p)}var gN=de.ReactCurrentOwner,ga=!1;function Bo(p,g,b,O){g.child=p===null?LC(g,null,b,O):tm(g,p.child,b,O)}function _y(p,g,b,O,M){b=b.render;var G=g.ref;return Yu(g,M),O=om(p,g,b,O,G,M),b=iT(),p!==null&&!ga?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~M,ql(p,g,M)):(si&&b&&iy(g),g.flags|=1,Bo(p,g,O,M),g.child)}function nI(p,g,b,O,M){if(p===null){var G=b.type;return typeof G=="function"&&!nh(G)&&G.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(g.tag=15,g.type=G,rI(p,g,G,O,M)):(p=$y(b.type,null,O,g,g.mode,M),p.ref=g.ref,p.return=g,g.child=p)}if(G=p.child,(p.lanes&M)===0){var ae=G.memoizedProps;if(b=b.compare,b=b!==null?b:xg,b(ae,O)&&p.ref===g.ref)return ql(p,g,M)}return g.flags|=1,p=nd(G,O),p.ref=g.ref,p.return=g,g.child=p}function rI(p,g,b,O,M){if(p!==null){var G=p.memoizedProps;if(xg(G,O)&&p.ref===g.ref)if(ga=!1,g.pendingProps=O=G,(p.lanes&M)!==0)(p.flags&131072)!==0&&(ga=!0);else return g.lanes=p.lanes,ql(p,g,M)}return gT(p,g,b,O,M)}function iI(p,g,b){var O=g.pendingProps,M=O.children,G=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},fi(ll,Ka),Ka|=b;else{if((b&1073741824)===0)return p=G!==null?G.baseLanes|b:b,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,fi(ll,Ka),Ka|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=G!==null?G.baseLanes:b,fi(ll,Ka),Ka|=O}else G!==null?(O=G.baseLanes|b,g.memoizedState=null):O=b,fi(ll,Ka),Ka|=O;return Bo(p,g,M,b),g.child}function sI(p,g){var b=g.ref;(p===null&&b!==null||p!==null&&p.ref!==b)&&(g.flags|=512,g.flags|=2097152)}function gT(p,g,b,O,M){var G=ha(b)?yp:ho.current;return G=vp(g,G),Yu(g,M),b=om(p,g,b,O,G,M),O=iT(),p!==null&&!ga?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~M,ql(p,g,M)):(si&&O&&iy(g),g.flags|=1,Bo(p,g,b,M),g.child)}function oI(p,g,b,O,M){if(ha(b)){var G=!0;ey(g)}else G=!1;if(Yu(g,M),g.stateNode===null)by(p,g),JC(g,b,O),hT(g,b,O,M),O=!0;else if(p===null){var ae=g.stateNode,Ie=g.memoizedProps;ae.props=Ie;var xe=ae.context,it=b.contextType;typeof it=="object"&&it!==null?it=Sc(it):(it=ha(b)?yp:ho.current,it=vp(g,it));var It=b.getDerivedStateFromProps,At=typeof It=="function"||typeof ae.getSnapshotBeforeUpdate=="function";At||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==O||xe!==it)&&QC(g,ae,O,it),Yd=!1;var Rt=g.memoizedState;ae.state=Rt,ly(g,O,ae,M),xe=g.memoizedState,Ie!==O||Rt!==xe||da.current||Yd?(typeof It=="function"&&(my(g,b,It,O),xe=g.memoizedState),(Ie=Yd||dT(g,b,Ie,O,Rt,xe,it))?(At||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=xe),ae.props=O,ae.state=xe,ae.context=it,O=Ie):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ae=g.stateNode,MC(p,g),Ie=g.memoizedProps,it=g.type===g.elementType?Ie:$a(g.type,Ie),ae.props=it,At=g.pendingProps,Rt=ae.context,xe=b.contextType,typeof xe=="object"&&xe!==null?xe=Sc(xe):(xe=ha(b)?yp:ho.current,xe=vp(g,xe));var Gt=b.getDerivedStateFromProps;(It=typeof Gt=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==At||Rt!==xe)&&QC(g,ae,O,xe),Yd=!1,Rt=g.memoizedState,ae.state=Rt,ly(g,O,ae,M);var Zt=g.memoizedState;Ie!==At||Rt!==Zt||da.current||Yd?(typeof Gt=="function"&&(my(g,b,Gt,O),Zt=g.memoizedState),(it=Yd||dT(g,b,it,O,Rt,Zt,xe)||!1)?(It||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(O,Zt,xe),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(O,Zt,xe)),typeof ae.componentDidUpdate=="function"&&(g.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Ie===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=Zt),ae.props=O,ae.state=Zt,ae.context=xe,O=it):(typeof ae.componentDidUpdate!="function"||Ie===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=1024),O=!1)}return Ey(p,g,b,O,G,M)}function Ey(p,g,b,O,M,G){sI(p,g);var ae=(g.flags&128)!==0;if(!O&&!ae)return M&&AC(g,b,!1),ql(p,g,G);O=g.stateNode,gN.current=g;var Ie=ae&&typeof b.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,p!==null&&ae?(g.child=tm(g,p.child,null,G),g.child=tm(g,null,Ie,G)):Bo(p,g,Ie,G),g.memoizedState=O.state,M&&AC(g,b,!0),g.child}function _T(p){var g=p.stateNode;g.pendingContext?IC(p,g.pendingContext,g.pendingContext!==g.context):g.context&&IC(p,g.context,!1),Z0(p,g.containerInfo)}function aI(p,g,b,O,M){return em(),K0(M),g.flags|=256,Bo(p,g,b,O),g.child}var ET={dehydrated:null,treeContext:null,retryLane:0};function um(p){return{baseLanes:p,cachePool:null,transitions:null}}function yy(p,g,b){var O=g.pendingProps,M=Ai.current,G=!1,ae=(g.flags&128)!==0,Ie;if((Ie=ae)||(Ie=p!==null&&p.memoizedState===null?!1:(M&2)!==0),Ie?(G=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(M|=1),fi(Ai,M&1),p===null)return $0(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ae=O.children,p=O.fallback,G?(O=g.mode,G=g.child,ae={mode:"hidden",children:ae},(O&1)===0&&G!==null?(G.childLanes=0,G.pendingProps=ae):G=rh(ae,O,0,null),p=Dp(p,O,b,null),G.return=g,p.return=g,G.sibling=p,g.child=G,g.child.memoizedState=um(b),g.memoizedState=ET,p):vy(g,ae));if(M=p.memoizedState,M!==null&&(Ie=M.dehydrated,Ie!==null))return cI(p,g,ae,O,Ie,M,b);if(G){G=O.fallback,ae=g.mode,M=p.child,Ie=M.sibling;var xe={mode:"hidden",children:O.children};return(ae&1)===0&&g.child!==M?(O=g.child,O.childLanes=0,O.pendingProps=xe,g.deletions=null):(O=nd(M,xe),O.subtreeFlags=M.subtreeFlags&14680064),Ie!==null?G=nd(Ie,G):(G=Dp(G,ae,b,null),G.flags|=2),G.return=g,O.return=g,O.sibling=G,g.child=O,O=G,G=g.child,ae=p.child.memoizedState,ae=ae===null?um(b):{baseLanes:ae.baseLanes|b,cachePool:null,transitions:ae.transitions},G.memoizedState=ae,G.childLanes=p.childLanes&~b,g.memoizedState=ET,O}return G=p.child,p=G.sibling,O=nd(G,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=b),O.return=g,O.sibling=null,p!==null&&(b=g.deletions,b===null?(g.deletions=[p],g.flags|=16):b.push(p)),g.child=O,g.memoizedState=null,O}function vy(p,g){return g=rh({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function Ip(p,g,b,O){return O!==null&&K0(O),tm(g,p.child,null,b),p=vy(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function cI(p,g,b,O,M,G,ae){if(b)return g.flags&256?(g.flags&=-257,O=pT(Error(s(422))),Ip(p,g,ae,O)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(G=O.fallback,M=g.mode,O=rh({mode:"visible",children:O.children},M,0,null),G=Dp(G,M,ae,null),G.flags|=2,O.return=g,G.return=g,O.sibling=G,g.child=O,(g.mode&1)!==0&&tm(g,p.child,null,ae),g.child.memoizedState=um(ae),g.memoizedState=ET,G);if((g.mode&1)===0)return Ip(p,g,ae,null);if(M.data==="$!"){if(O=M.nextSibling&&M.nextSibling.dataset,O)var Ie=O.dgst;return O=Ie,G=Error(s(419)),O=pT(G,O,void 0),Ip(p,g,ae,O)}if(Ie=(ae&p.childLanes)!==0,ga||Ie){if(O=js,O!==null){switch(ae&-ae){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(O.suspendedLanes|ae))!==0?0:M,M!==0&&M!==G.retryLane&&(G.retryLane=M,Xu(p,M),Cc(O,p,M,-1))}return PT(),O=pT(Error(s(421))),Ip(p,g,ae,O)}return M.data==="$?"?(g.flags|=128,g.child=p.child,g=zy.bind(null,p),M._reactRetry=g,null):(p=G.treeContext,fa=Gd(M.nextSibling),pa=g,si=!0,Fo=null,p!==null&&(vc[Ha++]=$u,vc[Ha++]=Ku,vc[Ha++]=Sp,$u=p.id,Ku=p.overflow,Sp=g),g=vy(g,O.children),g.flags|=4096,g)}function lI(p,g,b){p.lanes|=g;var O=p.alternate;O!==null&&(O.lanes|=g),J0(p.return,g,b)}function Sy(p,g,b,O,M){var G=p.memoizedState;G===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:b,tailMode:M}:(G.isBackwards=g,G.rendering=null,G.renderingStartTime=0,G.last=O,G.tail=b,G.tailMode=M)}function Ty(p,g,b){var O=g.pendingProps,M=O.revealOrder,G=O.tail;if(Bo(p,g,O.children,b),O=Ai.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&lI(p,b,g);else if(p.tag===19)lI(p,b,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(fi(Ai,O),(g.mode&1)===0)g.memoizedState=null;else switch(M){case"forwards":for(b=g.child,M=null;b!==null;)p=b.alternate,p!==null&&Jd(p)===null&&(M=b),b=b.sibling;b=M,b===null?(M=g.child,g.child=null):(M=b.sibling,b.sibling=null),Sy(g,!1,M,b,G);break;case"backwards":for(b=null,M=g.child,g.child=null;M!==null;){if(p=M.alternate,p!==null&&Jd(p)===null){g.child=M;break}p=M.sibling,M.sibling=b,b=M,M=p}Sy(g,!0,b,null,G);break;case"together":Sy(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function by(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function ql(p,g,b){if(p!==null&&(g.dependencies=p.dependencies),Ap|=g.lanes,(b&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(s(153));if(g.child!==null){for(p=g.child,b=nd(p,p.pendingProps),g.child=b,b.return=g;p.sibling!==null;)p=p.sibling,b=b.sibling=nd(p,p.pendingProps),b.return=g;b.sibling=null}return g.child}function uI(p,g,b){switch(g.tag){case 3:_T(g),em();break;case 5:FC(g);break;case 1:ha(g.type)&&ey(g);break;case 4:Z0(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,M=g.memoizedProps.value;fi(ay,O._currentValue),O._currentValue=M;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(fi(Ai,Ai.current&1),g.flags|=128,null):(b&g.child.childLanes)!==0?yy(p,g,b):(fi(Ai,Ai.current&1),p=ql(p,g,b),p!==null?p.sibling:null);fi(Ai,Ai.current&1);break;case 19:if(O=(b&g.childLanes)!==0,(p.flags&128)!==0){if(O)return Ty(p,g,b);g.flags|=128}if(M=g.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),fi(Ai,Ai.current),O)break;return null;case 22:case 23:return g.lanes=0,iI(p,g,b)}return ql(p,g,b)}var dI,wy,yT,hI;dI=function(p,g){for(var b=g.child;b!==null;){if(b.tag===5||b.tag===6)p.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===g)break;for(;b.sibling===null;){if(b.return===null||b.return===g)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},wy=function(){},yT=function(p,g,b,O){var M=p.memoizedProps;if(M!==O){p=g.stateNode,bp($l.current);var G=null;switch(b){case"input":M=xn(p,M),O=xn(p,O),G=[];break;case"select":M=Ne({},M,{value:void 0}),O=Ne({},O,{value:void 0}),G=[];break;case"textarea":M=vt(p,M),O=vt(p,O),G=[];break;default:typeof M.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=XE)}Ua(b,O);var ae;b=null;for(it in M)if(!O.hasOwnProperty(it)&&M.hasOwnProperty(it)&&M[it]!=null)if(it==="style"){var Ie=M[it];for(ae in Ie)Ie.hasOwnProperty(ae)&&(b||(b={}),b[ae]="")}else it!=="dangerouslySetInnerHTML"&&it!=="children"&&it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(l.hasOwnProperty(it)?G||(G=[]):(G=G||[]).push(it,null));for(it in O){var xe=O[it];if(Ie=M!=null?M[it]:void 0,O.hasOwnProperty(it)&&xe!==Ie&&(xe!=null||Ie!=null))if(it==="style")if(Ie){for(ae in Ie)!Ie.hasOwnProperty(ae)||xe&&xe.hasOwnProperty(ae)||(b||(b={}),b[ae]="");for(ae in xe)xe.hasOwnProperty(ae)&&Ie[ae]!==xe[ae]&&(b||(b={}),b[ae]=xe[ae])}else b||(G||(G=[]),G.push(it,b)),b=xe;else it==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,Ie=Ie?Ie.__html:void 0,xe!=null&&Ie!==xe&&(G=G||[]).push(it,xe)):it==="children"?typeof xe!="string"&&typeof xe!="number"||(G=G||[]).push(it,""+xe):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&(l.hasOwnProperty(it)?(xe!=null&&it==="onScroll"&&vi("scroll",p),G||Ie===xe||(G=[])):(G=G||[]).push(it,xe))}b&&(G=G||[]).push("style",b);var it=G;(g.updateQueue=it)&&(g.flags|=4)}},hI=function(p,g,b,O){b!==O&&(g.flags|=4)};function r_(p,g){if(!si)switch(p.tailMode){case"hidden":g=p.tail;for(var b=null;g!==null;)g.alternate!==null&&(b=g),g=g.sibling;b===null?p.tail=null:b.sibling=null;break;case"collapsed":b=p.tail;for(var O=null;b!==null;)b.alternate!==null&&(O=b),b=b.sibling;O===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function fo(p){var g=p.alternate!==null&&p.alternate.child===p.child,b=0,O=0;if(g)for(var M=p.child;M!==null;)b|=M.lanes|M.childLanes,O|=M.subtreeFlags&14680064,O|=M.flags&14680064,M.return=p,M=M.sibling;else for(M=p.child;M!==null;)b|=M.lanes|M.childLanes,O|=M.subtreeFlags,O|=M.flags,M.return=p,M=M.sibling;return p.subtreeFlags|=O,p.childLanes=b,g}function Ry(p,g,b){var O=g.pendingProps;switch(Hg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fo(g),null;case 1:return ha(g.type)&&QE(),fo(g),null;case 3:return O=g.stateNode,wp(),Si(da),Si(ho),tT(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&($g(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Fo!==null&&(Fy(Fo),Fo=null))),wy(p,g),fo(g),null;case 5:im(g);var M=bp(rm.current);if(b=g.type,p!==null&&g.stateNode!=null)yT(p,g,b,O,M),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(s(166));return fo(g),null}if(p=bp($l.current),$g(g)){O=g.stateNode,b=g.type;var G=g.memoizedProps;switch(O[Gl]=g,O[Hd]=G,p=(g.mode&1)!==0,b){case"dialog":vi("cancel",O),vi("close",O);break;case"iframe":case"object":case"embed":vi("load",O);break;case"video":case"audio":for(M=0;M<Fg.length;M++)vi(Fg[M],O);break;case"source":vi("error",O);break;case"img":case"image":case"link":vi("error",O),vi("load",O);break;case"details":vi("toggle",O);break;case"input":Yt(O,G),vi("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!G.multiple},vi("invalid",O);break;case"textarea":Ge(O,G),vi("invalid",O)}Ua(b,G),M=null;for(var ae in G)if(G.hasOwnProperty(ae)){var Ie=G[ae];ae==="children"?typeof Ie=="string"?O.textContent!==Ie&&(G.suppressHydrationWarning!==!0&&YE(O.textContent,Ie,p),M=["children",Ie]):typeof Ie=="number"&&O.textContent!==""+Ie&&(G.suppressHydrationWarning!==!0&&YE(O.textContent,Ie,p),M=["children",""+Ie]):l.hasOwnProperty(ae)&&Ie!=null&&ae==="onScroll"&&vi("scroll",O)}switch(b){case"input":hn(O),Re(O,G,!0);break;case"textarea":hn(O),Xt(O);break;case"select":case"option":break;default:typeof G.onClick=="function"&&(O.onclick=XE)}O=M,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ae=M.nodeType===9?M:M.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=pn(b)),p==="http://www.w3.org/1999/xhtml"?b==="script"?(p=ae.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=ae.createElement(b,{is:O.is}):(p=ae.createElement(b),b==="select"&&(ae=p,O.multiple?ae.multiple=!0:O.size&&(ae.size=O.size))):p=ae.createElementNS(p,b),p[Gl]=g,p[Hd]=O,dI(p,g,!1,!1),g.stateNode=p;e:{switch(ae=Zc(b,O),b){case"dialog":vi("cancel",p),vi("close",p),M=O;break;case"iframe":case"object":case"embed":vi("load",p),M=O;break;case"video":case"audio":for(M=0;M<Fg.length;M++)vi(Fg[M],p);M=O;break;case"source":vi("error",p),M=O;break;case"img":case"image":case"link":vi("error",p),vi("load",p),M=O;break;case"details":vi("toggle",p),M=O;break;case"input":Yt(p,O),M=xn(p,O),vi("invalid",p);break;case"option":M=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},M=Ne({},O,{value:void 0}),vi("invalid",p);break;case"textarea":Ge(p,O),M=vt(p,O),vi("invalid",p);break;default:M=O}Ua(b,M),Ie=M;for(G in Ie)if(Ie.hasOwnProperty(G)){var xe=Ie[G];G==="style"?yi(p,xe):G==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,xe!=null&&na(p,xe)):G==="children"?typeof xe=="string"?(b!=="textarea"||xe!=="")&&Vt(p,xe):typeof xe=="number"&&Vt(p,""+xe):G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&G!=="autoFocus"&&(l.hasOwnProperty(G)?xe!=null&&G==="onScroll"&&vi("scroll",p):xe!=null&&ne(p,G,xe,ae))}switch(b){case"input":hn(p),Re(p,O,!1);break;case"textarea":hn(p),Xt(p);break;case"option":O.value!=null&&p.setAttribute("value",""+dt(O.value));break;case"select":p.multiple=!!O.multiple,G=O.value,G!=null?_t(p,!!O.multiple,G,!1):O.defaultValue!=null&&_t(p,!!O.multiple,O.defaultValue,!0);break;default:typeof M.onClick=="function"&&(p.onclick=XE)}switch(b){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return fo(g),null;case 6:if(p&&g.stateNode!=null)hI(p,g,p.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(s(166));if(b=bp(rm.current),bp($l.current),$g(g)){if(O=g.stateNode,b=g.memoizedProps,O[Gl]=g,(G=O.nodeValue!==b)&&(p=pa,p!==null))switch(p.tag){case 3:YE(O.nodeValue,b,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&YE(O.nodeValue,b,(p.mode&1)!==0)}G&&(g.flags|=4)}else O=(b.nodeType===9?b:b.ownerDocument).createTextNode(O),O[Gl]=g,g.stateNode=O}return fo(g),null;case 13:if(Si(Ai),O=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(si&&fa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)DC(),em(),g.flags|=98560,G=!1;else if(G=$g(g),O!==null&&O.dehydrated!==null){if(p===null){if(!G)throw Error(s(318));if(G=g.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(s(317));G[Gl]=g}else em(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;fo(g),G=!1}else Fo!==null&&(Fy(Fo),Fo=null),G=!0;if(!G)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=b,g):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(Ai.current&1)!==0?ms===0&&(ms=3):PT())),g.updateQueue!==null&&(g.flags|=4),fo(g),null);case 4:return wp(),wy(p,g),p===null&&mp(g.stateNode.containerInfo),fo(g),null;case 10:return X0(g.type._context),fo(g),null;case 17:return ha(g.type)&&QE(),fo(g),null;case 19:if(Si(Ai),G=g.memoizedState,G===null)return fo(g),null;if(O=(g.flags&128)!==0,ae=G.rendering,ae===null)if(O)r_(G,!1);else{if(ms!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(ae=Jd(p),ae!==null){for(g.flags|=128,r_(G,!1),O=ae.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=b,b=g.child;b!==null;)G=b,p=O,G.flags&=14680066,ae=G.alternate,ae===null?(G.childLanes=0,G.lanes=p,G.child=null,G.subtreeFlags=0,G.memoizedProps=null,G.memoizedState=null,G.updateQueue=null,G.dependencies=null,G.stateNode=null):(G.childLanes=ae.childLanes,G.lanes=ae.lanes,G.child=ae.child,G.subtreeFlags=0,G.deletions=null,G.memoizedProps=ae.memoizedProps,G.memoizedState=ae.memoizedState,G.updateQueue=ae.updateQueue,G.type=ae.type,p=ae.dependencies,G.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),b=b.sibling;return fi(Ai,Ai.current&1|2),g.child}p=p.sibling}G.tail!==null&&Fr()>pm&&(g.flags|=128,O=!0,r_(G,!1),g.lanes=4194304)}else{if(!O)if(p=Jd(ae),p!==null){if(g.flags|=128,O=!0,b=p.updateQueue,b!==null&&(g.updateQueue=b,g.flags|=4),r_(G,!0),G.tail===null&&G.tailMode==="hidden"&&!ae.alternate&&!si)return fo(g),null}else 2*Fr()-G.renderingStartTime>pm&&b!==1073741824&&(g.flags|=128,O=!0,r_(G,!1),g.lanes=4194304);G.isBackwards?(ae.sibling=g.child,g.child=ae):(b=G.last,b!==null?b.sibling=ae:g.child=ae,G.last=ae)}return G.tail!==null?(g=G.tail,G.rendering=g,G.tail=g.sibling,G.renderingStartTime=Fr(),g.sibling=null,b=Ai.current,fi(Ai,O?b&1|2:b&1),g):(fo(g),null);case 22:case 23:return d_(),O=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(Ka&1073741824)!==0&&(fo(g),g.subtreeFlags&6&&(g.flags|=8192)):fo(g),null;case 24:return null;case 25:return null}throw Error(s(156,g.tag))}function _N(p,g){switch(Hg(g),g.tag){case 1:return ha(g.type)&&QE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return wp(),Si(da),Si(ho),tT(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return im(g),null;case 13:if(Si(Ai),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(s(340));em()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Si(Ai),null;case 4:return wp(),null;case 10:return X0(g.type._context),null;case 22:case 23:return d_(),null;case 24:return null;default:return null}}var Cy=!1,mo=!1,pI=typeof WeakSet=="function"?WeakSet:Set,Jt=null;function dm(p,g){var b=p.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(O){Li(p,g,O)}else b.current=null}function i_(p,g,b){try{b()}catch(O){Li(p,g,O)}}var fI=!1;function vT(p,g){if(JE=Se,p=mC(),Mg(p)){if("selectionStart"in p)var b={start:p.selectionStart,end:p.selectionEnd};else e:{b=(b=p.ownerDocument)&&b.defaultView||window;var O=b.getSelection&&b.getSelection();if(O&&O.rangeCount!==0){b=O.anchorNode;var M=O.anchorOffset,G=O.focusNode;O=O.focusOffset;try{b.nodeType,G.nodeType}catch{b=null;break e}var ae=0,Ie=-1,xe=-1,it=0,It=0,At=p,Rt=null;t:for(;;){for(var Gt;At!==b||M!==0&&At.nodeType!==3||(Ie=ae+M),At!==G||O!==0&&At.nodeType!==3||(xe=ae+O),At.nodeType===3&&(ae+=At.nodeValue.length),(Gt=At.firstChild)!==null;)Rt=At,At=Gt;for(;;){if(At===p)break t;if(Rt===b&&++it===M&&(Ie=ae),Rt===G&&++It===O&&(xe=ae),(Gt=At.nextSibling)!==null)break;At=Rt,Rt=At.parentNode}At=Gt}b=Ie===-1||xe===-1?null:{start:Ie,end:xe}}else b=null}b=b||{start:0,end:0}}else b=null;for(Bg={focusedElem:p,selectionRange:b},Se=!1,Jt=g;Jt!==null;)if(g=Jt,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,Jt=p;else for(;Jt!==null;){g=Jt;try{var Zt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Zt!==null){var en=Zt.memoizedProps,Yi=Zt.memoizedState,Je=g.stateNode,Ve=Je.getSnapshotBeforeUpdate(g.elementType===g.type?en:$a(g.type,en),Yi);Je.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var Ze=g.stateNode.containerInfo;Ze.nodeType===1?Ze.textContent="":Ze.nodeType===9&&Ze.documentElement&&Ze.removeChild(Ze.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Nt){Li(g,g.return,Nt)}if(p=g.sibling,p!==null){p.return=g.return,Jt=p;break}Jt=g.return}return Zt=fI,fI=!1,Zt}function s_(p,g,b){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var M=O=O.next;do{if((M.tag&p)===p){var G=M.destroy;M.destroy=void 0,G!==void 0&&i_(g,b,G)}M=M.next}while(M!==O)}}function o_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var b=g=g.next;do{if((b.tag&p)===p){var O=b.create;b.destroy=O()}b=b.next}while(b!==g)}}function ST(p){var g=p.ref;if(g!==null){var b=p.stateNode;switch(p.tag){case 5:p=b;break;default:p=b}typeof g=="function"?g(p):g.current=p}}function mI(p){var g=p.alternate;g!==null&&(p.alternate=null,mI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[Gl],delete g[Hd],delete g[zg],delete g[oN],delete g[aN])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function TT(p){return p.tag===5||p.tag===3||p.tag===4}function gI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||TT(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function bT(p,g,b){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?b.nodeType===8?b.parentNode.insertBefore(p,g):b.insertBefore(p,g):(b.nodeType===8?(g=b.parentNode,g.insertBefore(p,b)):(g=b,g.appendChild(p)),b=b._reactRootContainer,b!=null||g.onclick!==null||(g.onclick=XE));else if(O!==4&&(p=p.child,p!==null))for(bT(p,g,b),p=p.sibling;p!==null;)bT(p,g,b),p=p.sibling}function Iy(p,g,b){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?b.insertBefore(p,g):b.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(Iy(p,g,b),p=p.sibling;p!==null;)Iy(p,g,b),p=p.sibling}var qs=null,bc=!1;function Yl(p,g,b){for(b=b.child;b!==null;)_I(p,g,b),b=b.sibling}function _I(p,g,b){if(uo&&typeof uo.onCommitFiberUnmount=="function")try{uo.onCommitFiberUnmount(Ml,b)}catch{}switch(b.tag){case 5:mo||dm(b,g);case 6:var O=qs,M=bc;qs=null,Yl(p,g,b),qs=O,bc=M,qs!==null&&(bc?(p=qs,b=b.stateNode,p.nodeType===8?p.parentNode.removeChild(b):p.removeChild(b)):qs.removeChild(b.stateNode));break;case 18:qs!==null&&(bc?(p=qs,b=b.stateNode,p.nodeType===8?z0(p.parentNode,b):p.nodeType===1&&z0(p,b),la(p)):z0(qs,b.stateNode));break;case 4:O=qs,M=bc,qs=b.stateNode.containerInfo,bc=!0,Yl(p,g,b),qs=O,bc=M;break;case 0:case 11:case 14:case 15:if(!mo&&(O=b.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){M=O=O.next;do{var G=M,ae=G.destroy;G=G.tag,ae!==void 0&&((G&2)!==0||(G&4)!==0)&&i_(b,g,ae),M=M.next}while(M!==O)}Yl(p,g,b);break;case 1:if(!mo&&(dm(b,g),O=b.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=b.memoizedProps,O.state=b.memoizedState,O.componentWillUnmount()}catch(Ie){Li(b,g,Ie)}Yl(p,g,b);break;case 21:Yl(p,g,b);break;case 22:b.mode&1?(mo=(O=mo)||b.memoizedState!==null,Yl(p,g,b),mo=O):Yl(p,g,b);break;default:Yl(p,g,b)}}function EI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var b=p.stateNode;b===null&&(b=p.stateNode=new pI),g.forEach(function(O){var M=wI.bind(null,p,O);b.has(O)||(b.add(O),O.then(M,M))})}}function Wo(p,g){var b=g.deletions;if(b!==null)for(var O=0;O<b.length;O++){var M=b[O];try{var G=p,ae=g,Ie=ae;e:for(;Ie!==null;){switch(Ie.tag){case 5:qs=Ie.stateNode,bc=!1;break e;case 3:qs=Ie.stateNode.containerInfo,bc=!0;break e;case 4:qs=Ie.stateNode.containerInfo,bc=!0;break e}Ie=Ie.return}if(qs===null)throw Error(s(160));_I(G,ae,M),qs=null,bc=!1;var xe=M.alternate;xe!==null&&(xe.return=null),M.return=null}catch(it){Li(M,g,it)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)wT(g,p),g=g.sibling}function wT(p,g){var b=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Wo(g,p),_a(p),O&4){try{s_(3,p,p.return),o_(3,p)}catch(en){Li(p,p.return,en)}try{s_(5,p,p.return)}catch(en){Li(p,p.return,en)}}break;case 1:Wo(g,p),_a(p),O&512&&b!==null&&dm(b,b.return);break;case 5:if(Wo(g,p),_a(p),O&512&&b!==null&&dm(b,b.return),p.flags&32){var M=p.stateNode;try{Vt(M,"")}catch(en){Li(p,p.return,en)}}if(O&4&&(M=p.stateNode,M!=null)){var G=p.memoizedProps,ae=b!==null?b.memoizedProps:G,Ie=p.type,xe=p.updateQueue;if(p.updateQueue=null,xe!==null)try{Ie==="input"&&G.type==="radio"&&G.name!=null&&Yn(M,G),Zc(Ie,ae);var it=Zc(Ie,G);for(ae=0;ae<xe.length;ae+=2){var It=xe[ae],At=xe[ae+1];It==="style"?yi(M,At):It==="dangerouslySetInnerHTML"?na(M,At):It==="children"?Vt(M,At):ne(M,It,At,it)}switch(Ie){case"input":Kt(M,G);break;case"textarea":Ot(M,G);break;case"select":var Rt=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!G.multiple;var Gt=G.value;Gt!=null?_t(M,!!G.multiple,Gt,!1):Rt!==!!G.multiple&&(G.defaultValue!=null?_t(M,!!G.multiple,G.defaultValue,!0):_t(M,!!G.multiple,G.multiple?[]:"",!1))}M[Hd]=G}catch(en){Li(p,p.return,en)}}break;case 6:if(Wo(g,p),_a(p),O&4){if(p.stateNode===null)throw Error(s(162));M=p.stateNode,G=p.memoizedProps;try{M.nodeValue=G}catch(en){Li(p,p.return,en)}}break;case 3:if(Wo(g,p),_a(p),O&4&&b!==null&&b.memoizedState.isDehydrated)try{la(g.containerInfo)}catch(en){Li(p,p.return,en)}break;case 4:Wo(g,p),_a(p);break;case 13:Wo(g,p),_a(p),M=p.child,M.flags&8192&&(G=M.memoizedState!==null,M.stateNode.isHidden=G,!G||M.alternate!==null&&M.alternate.memoizedState!==null||(Dy=Fr())),O&4&&EI(p);break;case 22:if(It=b!==null&&b.memoizedState!==null,p.mode&1?(mo=(it=mo)||It,Wo(g,p),mo=it):Wo(g,p),_a(p),O&8192){if(it=p.memoizedState!==null,(p.stateNode.isHidden=it)&&!It&&(p.mode&1)!==0)for(Jt=p,It=p.child;It!==null;){for(At=Jt=It;Jt!==null;){switch(Rt=Jt,Gt=Rt.child,Rt.tag){case 0:case 11:case 14:case 15:s_(4,Rt,Rt.return);break;case 1:dm(Rt,Rt.return);var Zt=Rt.stateNode;if(typeof Zt.componentWillUnmount=="function"){O=Rt,b=Rt.return;try{g=O,Zt.props=g.memoizedProps,Zt.state=g.memoizedState,Zt.componentWillUnmount()}catch(en){Li(O,b,en)}}break;case 5:dm(Rt,Rt.return);break;case 22:if(Rt.memoizedState!==null){a_(At);continue}}Gt!==null?(Gt.return=Rt,Jt=Gt):a_(At)}It=It.sibling}e:for(It=null,At=p;;){if(At.tag===5){if(It===null){It=At;try{M=At.stateNode,it?(G=M.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none"):(Ie=At.stateNode,xe=At.memoizedProps.style,ae=xe!=null&&xe.hasOwnProperty("display")?xe.display:null,Ie.style.display=di("display",ae))}catch(en){Li(p,p.return,en)}}}else if(At.tag===6){if(It===null)try{At.stateNode.nodeValue=it?"":At.memoizedProps}catch(en){Li(p,p.return,en)}}else if((At.tag!==22&&At.tag!==23||At.memoizedState===null||At===p)&&At.child!==null){At.child.return=At,At=At.child;continue}if(At===p)break e;for(;At.sibling===null;){if(At.return===null||At.return===p)break e;It===At&&(It=null),At=At.return}It===At&&(It=null),At.sibling.return=At.return,At=At.sibling}}break;case 19:Wo(g,p),_a(p),O&4&&EI(p);break;case 21:break;default:Wo(g,p),_a(p)}}function _a(p){var g=p.flags;if(g&2){try{e:{for(var b=p.return;b!==null;){if(TT(b)){var O=b;break e}b=b.return}throw Error(s(160))}switch(O.tag){case 5:var M=O.stateNode;O.flags&32&&(Vt(M,""),O.flags&=-33);var G=gI(p);Iy(p,G,M);break;case 3:case 4:var ae=O.stateNode.containerInfo,Ie=gI(p);bT(p,Ie,ae);break;default:throw Error(s(161))}}catch(xe){Li(p,p.return,xe)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function hm(p,g,b){Jt=p,RT(p)}function RT(p,g,b){for(var O=(p.mode&1)!==0;Jt!==null;){var M=Jt,G=M.child;if(M.tag===22&&O){var ae=M.memoizedState!==null||Cy;if(!ae){var Ie=M.alternate,xe=Ie!==null&&Ie.memoizedState!==null||mo;Ie=Cy;var it=mo;if(Cy=ae,(mo=xe)&&!it)for(Jt=M;Jt!==null;)ae=Jt,xe=ae.child,ae.tag===22&&ae.memoizedState!==null?yI(M):xe!==null?(xe.return=ae,Jt=xe):yI(M);for(;G!==null;)Jt=G,RT(G),G=G.sibling;Jt=M,Cy=Ie,mo=it}Ay(p)}else(M.subtreeFlags&8772)!==0&&G!==null?(G.return=M,Jt=G):Ay(p)}}function Ay(p){for(;Jt!==null;){var g=Jt;if((g.flags&8772)!==0){var b=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:mo||o_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!mo)if(b===null)O.componentDidMount();else{var M=g.elementType===g.type?b.memoizedProps:$a(g.type,b.memoizedProps);O.componentDidUpdate(M,b.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var G=g.updateQueue;G!==null&&VC(g,G,O);break;case 3:var ae=g.updateQueue;if(ae!==null){if(b=null,g.child!==null)switch(g.child.tag){case 5:b=g.child.stateNode;break;case 1:b=g.child.stateNode}VC(g,ae,b)}break;case 5:var Ie=g.stateNode;if(b===null&&g.flags&4){b=Ie;var xe=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":xe.autoFocus&&b.focus();break;case"img":xe.src&&(b.src=xe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var it=g.alternate;if(it!==null){var It=it.memoizedState;if(It!==null){var At=It.dehydrated;At!==null&&la(At)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}mo||g.flags&512&&ST(g)}catch(Rt){Li(g,g.return,Rt)}}if(g===p){Jt=null;break}if(b=g.sibling,b!==null){b.return=g.return,Jt=b;break}Jt=g.return}}function a_(p){for(;Jt!==null;){var g=Jt;if(g===p){Jt=null;break}var b=g.sibling;if(b!==null){b.return=g.return,Jt=b;break}Jt=g.return}}function yI(p){for(;Jt!==null;){var g=Jt;try{switch(g.tag){case 0:case 11:case 15:var b=g.return;try{o_(4,g)}catch(xe){Li(g,b,xe)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var M=g.return;try{O.componentDidMount()}catch(xe){Li(g,M,xe)}}var G=g.return;try{ST(g)}catch(xe){Li(g,G,xe)}break;case 5:var ae=g.return;try{ST(g)}catch(xe){Li(g,ae,xe)}}}catch(xe){Li(g,g.return,xe)}if(g===p){Jt=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,Jt=Ie;break}Jt=g.return}}var EN=Math.ceil,Py=de.ReactCurrentDispatcher,Oy=de.ReactCurrentOwner,wc=de.ReactCurrentBatchConfig,br=0,js=null,qi=null,fs=0,Ka=0,ll=Ec(0),ms=0,Ys=null,Ap=0,ky=0,Ny=0,c_=null,zo=null,Dy=0,pm=1/0,Xl=null,Ly=!1,CT=null,eh=null,fm=!1,Jl=null,xy=0,Pp=0,IT=null,l_=-1,My=0;function Xs(){return(br&6)!==0?Fr():l_!==-1?l_:l_=Fr()}function Rc(p){return(p.mode&1)===0?1:(br&2)!==0&&fs!==0?fs&-fs:lN.transition!==null?(My===0&&(My=Vu()),My):(p=nr,p!==0||(p=window.event,p=p===void 0?16:jr(p.type)),p)}function Cc(p,g,b,O){if(50<Pp)throw Pp=0,IT=null,Error(s(185));Fl(p,b,O),((br&2)===0||p!==js)&&(p===js&&((br&2)===0&&(ky|=b),ms===4&&ed(p,fs)),go(p,O),b===1&&br===0&&(g.mode&1)===0&&(pm=Fr()+500,ty&&Kd()))}function go(p,g){var b=p.callbackNode;ja(p,g);var O=Vl(p,p===js?fs:0);if(O===0)b!==null&&Mu(b),p.callbackNode=null,p.callbackPriority=0;else if(g=O&-O,p.callbackPriority!==g){if(b!=null&&Mu(b),g===1)p.tag===0?cN(Op.bind(null,p)):PC(Op.bind(null,p)),iN(function(){(br&6)===0&&Kd()}),b=null;else{switch(hc(O)){case 1:b=dc;break;case 4:b=nl;break;case 16:b=aa;break;case 536870912:b=Vd;break;default:b=aa}b=h_(b,Uy.bind(null,p))}p.callbackPriority=g,p.callbackNode=b}}function Uy(p,g){if(l_=-1,My=0,(br&6)!==0)throw Error(s(327));var b=p.callbackNode;if(mm()&&p.callbackNode!==b)return null;var O=Vl(p,p===js?fs:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||g)g=Ql(p,O);else{g=O;var M=br;br|=2;var G=vI();(js!==p||fs!==g)&&(Xl=null,pm=Fr()+500,th(p,g));do try{yN();break}catch(Ie){AT(p,Ie)}while(!0);Y0(),Py.current=G,br=M,qi!==null?g=0:(js=null,fs=0,g=ms)}if(g!==0){if(g===2&&(M=Ao(p),M!==0&&(O=M,g=Vy(p,M))),g===1)throw b=Ys,th(p,0),ed(p,O),go(p,Fr()),b;if(g===6)ed(p,O);else{if(M=p.current.alternate,(O&30)===0&&!jy(M)&&(g=Ql(p,O),g===2&&(G=Ao(p),G!==0&&(O=G,g=Vy(p,G))),g===1))throw b=Ys,th(p,0),ed(p,O),go(p,Fr()),b;switch(p.finishedWork=M,p.finishedLanes=O,g){case 0:case 1:throw Error(s(345));case 2:kp(p,zo,Xl);break;case 3:if(ed(p,O),(O&130023424)===O&&(g=Dy+500-Fr(),10<g)){if(Vl(p,0)!==0)break;if(M=p.suspendedLanes,(M&O)!==O){Xs(),p.pingedLanes|=p.suspendedLanes&M;break}p.timeoutHandle=Wg(kp.bind(null,p,zo,Xl),g);break}kp(p,zo,Xl);break;case 4:if(ed(p,O),(O&4194240)===O)break;for(g=p.eventTimes,M=-1;0<O;){var ae=31-Ks(O);G=1<<ae,ae=g[ae],ae>M&&(M=ae),O&=~G}if(O=M,O=Fr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*EN(O/1960))-O,10<O){p.timeoutHandle=Wg(kp.bind(null,p,zo,Xl),O);break}kp(p,zo,Xl);break;case 5:kp(p,zo,Xl);break;default:throw Error(s(329))}}}return go(p,Fr()),p.callbackNode===b?Uy.bind(null,p):null}function Vy(p,g){var b=c_;return p.current.memoizedState.isDehydrated&&(th(p,g).flags|=256),p=Ql(p,g),p!==2&&(g=zo,zo=b,g!==null&&Fy(g)),p}function Fy(p){zo===null?zo=p:zo.push.apply(zo,p)}function jy(p){for(var g=p;;){if(g.flags&16384){var b=g.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var O=0;O<b.length;O++){var M=b[O],G=M.getSnapshot;M=M.value;try{if(!cl(G(),M))return!1}catch{return!1}}}if(b=g.child,g.subtreeFlags&16384&&b!==null)b.return=g,g=b;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function ed(p,g){for(g&=~Ny,g&=~ky,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var b=31-Ks(g),O=1<<b;p[b]=-1,g&=~O}}function Op(p){if((br&6)!==0)throw Error(s(327));mm();var g=Vl(p,0);if((g&1)===0)return go(p,Fr()),null;var b=Ql(p,g);if(p.tag!==0&&b===2){var O=Ao(p);O!==0&&(g=O,b=Vy(p,O))}if(b===1)throw b=Ys,th(p,0),ed(p,g),go(p,Fr()),b;if(b===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,kp(p,zo,Xl),go(p,Fr()),null}function u_(p,g){var b=br;br|=1;try{return p(g)}finally{br=b,br===0&&(pm=Fr()+500,ty&&Kd())}}function td(p){Jl!==null&&Jl.tag===0&&(br&6)===0&&mm();var g=br;br|=1;var b=wc.transition,O=nr;try{if(wc.transition=null,nr=1,p)return p()}finally{nr=O,wc.transition=b,br=g,(br&6)===0&&Kd()}}function d_(){Ka=ll.current,Si(ll)}function th(p,g){p.finishedWork=null,p.finishedLanes=0;var b=p.timeoutHandle;if(b!==-1&&(p.timeoutHandle=-1,rN(b)),qi!==null)for(b=qi.return;b!==null;){var O=b;switch(Hg(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&QE();break;case 3:wp(),Si(da),Si(ho),tT();break;case 5:im(O);break;case 4:wp();break;case 13:Si(Ai);break;case 19:Si(Ai);break;case 10:X0(O.type._context);break;case 22:case 23:d_()}b=b.return}if(js=p,qi=p=nd(p.current,null),fs=Ka=g,ms=0,Ys=null,Ny=ky=Ap=0,zo=c_=null,Tp!==null){for(g=0;g<Tp.length;g++)if(b=Tp[g],O=b.interleaved,O!==null){b.interleaved=null;var M=O.next,G=b.pending;if(G!==null){var ae=G.next;G.next=M,O.next=ae}b.pending=O}Tp=null}return p}function AT(p,g){do{var b=qi;try{if(Y0(),uy.current=fy,sm){for(var O=Di.memoizedState;O!==null;){var M=O.queue;M!==null&&(M.pending=null),O=O.next}sm=!1}if(Kl=0,ps=hs=Di=null,Zg=!1,e_=0,Oy.current=null,b===null||b.return===null){ms=1,Ys=g,qi=null;break}e:{var G=p,ae=b.return,Ie=b,xe=g;if(g=fs,Ie.flags|=32768,xe!==null&&typeof xe=="object"&&typeof xe.then=="function"){var it=xe,It=Ie,At=It.tag;if((It.mode&1)===0&&(At===0||At===11||At===15)){var Rt=It.alternate;Rt?(It.updateQueue=Rt.updateQueue,It.memoizedState=Rt.memoizedState,It.lanes=Rt.lanes):(It.updateQueue=null,It.memoizedState=null)}var Gt=eI(ae);if(Gt!==null){Gt.flags&=-257,tI(Gt,ae,Ie,G,g),Gt.mode&1&&ZC(G,it,g),g=Gt,xe=it;var Zt=g.updateQueue;if(Zt===null){var en=new Set;en.add(xe),g.updateQueue=en}else Zt.add(xe);break e}else{if((g&1)===0){ZC(G,it,g),PT();break e}xe=Error(s(426))}}else if(si&&Ie.mode&1){var Yi=eI(ae);if(Yi!==null){(Yi.flags&65536)===0&&(Yi.flags|=256),tI(Yi,ae,Ie,G,g),K0(lm(xe,Ie));break e}}G=xe=lm(xe,Ie),ms!==4&&(ms=2),c_===null?c_=[G]:c_.push(G),G=ae;do{switch(G.tag){case 3:G.flags|=65536,g&=-g,G.lanes|=g;var Je=mT(G,xe,g);UC(G,Je);break e;case 1:Ie=xe;var Ve=G.type,Ze=G.stateNode;if((G.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(eh===null||!eh.has(Ze)))){G.flags|=65536,g&=-g,G.lanes|=g;var Nt=Zu(G,Ie,g);UC(G,Nt);break e}}G=G.return}while(G!==null)}TI(b)}catch(tn){g=tn,qi===b&&b!==null&&(qi=b=b.return);continue}break}while(!0)}function vI(){var p=Py.current;return Py.current=fy,p===null?fy:p}function PT(){(ms===0||ms===3||ms===2)&&(ms=4),js===null||(Ap&268435455)===0&&(ky&268435455)===0||ed(js,fs)}function Ql(p,g){var b=br;br|=2;var O=vI();(js!==p||fs!==g)&&(Xl=null,th(p,g));do try{SI();break}catch(M){AT(p,M)}while(!0);if(Y0(),br=b,Py.current=O,qi!==null)throw Error(s(261));return js=null,fs=0,ms}function SI(){for(;qi!==null;)By(qi)}function yN(){for(;qi!==null&&!Io();)By(qi)}function By(p){var g=Gy(p.alternate,p,Ka);p.memoizedProps=p.pendingProps,g===null?TI(p):qi=g,Oy.current=null}function TI(p){var g=p;do{var b=g.alternate;if(p=g.return,(g.flags&32768)===0){if(b=Ry(b,g,Ka),b!==null){qi=b;return}}else{if(b=_N(b,g),b!==null){b.flags&=32767,qi=b;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{ms=6,qi=null;return}}if(g=g.sibling,g!==null){qi=g;return}qi=g=p}while(g!==null);ms===0&&(ms=5)}function kp(p,g,b){var O=nr,M=wc.transition;try{wc.transition=null,nr=1,vN(p,g,b,O)}finally{wc.transition=M,nr=O}return null}function vN(p,g,b,O){do mm();while(Jl!==null);if((br&6)!==0)throw Error(s(327));b=p.finishedWork;var M=p.finishedLanes;if(b===null)return null;if(p.finishedWork=null,p.finishedLanes=0,b===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var G=b.lanes|b.childLanes;if(zr(p,G),p===js&&(qi=js=null,fs=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||fm||(fm=!0,h_(aa,function(){return mm(),null})),G=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||G){G=wc.transition,wc.transition=null;var ae=nr;nr=1;var Ie=br;br|=4,Oy.current=null,vT(p,b),wT(b,p),M0(Bg),Se=!!JE,Bg=JE=null,p.current=b,hm(b),Ud(),br=Ie,nr=ae,wc.transition=G}else p.current=b;if(fm&&(fm=!1,Jl=p,xy=M),G=p.pendingLanes,G===0&&(eh=null),xf(b.stateNode),go(p,Fr()),g!==null)for(O=p.onRecoverableError,b=0;b<g.length;b++)M=g[b],O(M.value,{componentStack:M.stack,digest:M.digest});if(Ly)throw Ly=!1,p=CT,CT=null,p;return(xy&1)!==0&&p.tag!==0&&mm(),G=p.pendingLanes,(G&1)!==0?p===IT?Pp++:(Pp=0,IT=p):Pp=0,Kd(),null}function mm(){if(Jl!==null){var p=hc(xy),g=wc.transition,b=nr;try{if(wc.transition=null,nr=16>p?16:p,Jl===null)var O=!1;else{if(p=Jl,Jl=null,xy=0,(br&6)!==0)throw Error(s(331));var M=br;for(br|=4,Jt=p.current;Jt!==null;){var G=Jt,ae=G.child;if((Jt.flags&16)!==0){var Ie=G.deletions;if(Ie!==null){for(var xe=0;xe<Ie.length;xe++){var it=Ie[xe];for(Jt=it;Jt!==null;){var It=Jt;switch(It.tag){case 0:case 11:case 15:s_(8,It,G)}var At=It.child;if(At!==null)At.return=It,Jt=At;else for(;Jt!==null;){It=Jt;var Rt=It.sibling,Gt=It.return;if(mI(It),It===it){Jt=null;break}if(Rt!==null){Rt.return=Gt,Jt=Rt;break}Jt=Gt}}}var Zt=G.alternate;if(Zt!==null){var en=Zt.child;if(en!==null){Zt.child=null;do{var Yi=en.sibling;en.sibling=null,en=Yi}while(en!==null)}}Jt=G}}if((G.subtreeFlags&2064)!==0&&ae!==null)ae.return=G,Jt=ae;else e:for(;Jt!==null;){if(G=Jt,(G.flags&2048)!==0)switch(G.tag){case 0:case 11:case 15:s_(9,G,G.return)}var Je=G.sibling;if(Je!==null){Je.return=G.return,Jt=Je;break e}Jt=G.return}}var Ve=p.current;for(Jt=Ve;Jt!==null;){ae=Jt;var Ze=ae.child;if((ae.subtreeFlags&2064)!==0&&Ze!==null)Ze.return=ae,Jt=Ze;else e:for(ae=Ve;Jt!==null;){if(Ie=Jt,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:o_(9,Ie)}}catch(tn){Li(Ie,Ie.return,tn)}if(Ie===ae){Jt=null;break e}var Nt=Ie.sibling;if(Nt!==null){Nt.return=Ie.return,Jt=Nt;break e}Jt=Ie.return}}if(br=M,Kd(),uo&&typeof uo.onPostCommitFiberRoot=="function")try{uo.onPostCommitFiberRoot(Ml,p)}catch{}O=!0}return O}finally{nr=b,wc.transition=g}}return!1}function Wy(p,g,b){g=lm(b,g),g=mT(p,g,1),p=Xd(p,g,1),g=Xs(),p!==null&&(Fl(p,1,g),go(p,g))}function Li(p,g,b){if(p.tag===3)Wy(p,p,b);else for(;g!==null;){if(g.tag===3){Wy(g,p,b);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(eh===null||!eh.has(O))){p=lm(b,p),p=Zu(g,p,1),g=Xd(g,p,1),p=Xs(),g!==null&&(Fl(g,1,p),go(g,p));break}}g=g.return}}function bI(p,g,b){var O=p.pingCache;O!==null&&O.delete(g),g=Xs(),p.pingedLanes|=p.suspendedLanes&b,js===p&&(fs&b)===b&&(ms===4||ms===3&&(fs&130023424)===fs&&500>Fr()-Dy?th(p,0):Ny|=b),go(p,g)}function OT(p,g){g===0&&((p.mode&1)===0?g=1:(g=hr,hr<<=1,(hr&130023424)===0&&(hr=4194304)));var b=Xs();p=Xu(p,g),p!==null&&(Fl(p,g,b),go(p,b))}function zy(p){var g=p.memoizedState,b=0;g!==null&&(b=g.retryLane),OT(p,b)}function wI(p,g){var b=0;switch(p.tag){case 13:var O=p.stateNode,M=p.memoizedState;M!==null&&(b=M.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(s(314))}O!==null&&O.delete(g),OT(p,b)}var Gy;Gy=function(p,g,b){if(p!==null)if(p.memoizedProps!==g.pendingProps||da.current)ga=!0;else{if((p.lanes&b)===0&&(g.flags&128)===0)return ga=!1,uI(p,g,b);ga=(p.flags&131072)!==0}else ga=!1,si&&(g.flags&1048576)!==0&&ry(g,ny,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;by(p,g),p=g.pendingProps;var M=vp(g,ho.current);Yu(g,b),M=om(null,g,O,p,M,b);var G=iT();return g.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,ha(O)?(G=!0,ey(g)):G=!1,g.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,Yg(g),M.updater=gy,g.stateNode=M,M._reactInternals=g,hT(g,O,p,b),g=Ey(null,g,O,!0,G,b)):(g.tag=0,si&&G&&iy(g),Bo(null,g,M,b),g=g.child),g;case 16:O=g.elementType;e:{switch(by(p,g),p=g.pendingProps,M=O._init,O=M(O._payload),g.type=O,M=g.tag=Np(O),p=$a(O,p),M){case 0:g=gT(null,g,O,p,b);break e;case 1:g=oI(null,g,O,p,b);break e;case 11:g=_y(null,g,O,p,b);break e;case 14:g=nI(null,g,O,$a(O.type,p),b);break e}throw Error(s(306,O,""))}return g;case 0:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:$a(O,M),gT(p,g,O,M,b);case 1:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:$a(O,M),oI(p,g,O,M,b);case 3:e:{if(_T(g),p===null)throw Error(s(387));O=g.pendingProps,G=g.memoizedState,M=G.element,MC(p,g),ly(g,O,null,b);var ae=g.memoizedState;if(O=ae.element,G.isDehydrated)if(G={element:O,isDehydrated:!1,cache:ae.cache,pendingSuspenseBoundaries:ae.pendingSuspenseBoundaries,transitions:ae.transitions},g.updateQueue.baseState=G,g.memoizedState=G,g.flags&256){M=lm(Error(s(423)),g),g=aI(p,g,O,b,M);break e}else if(O!==M){M=lm(Error(s(424)),g),g=aI(p,g,O,b,M);break e}else for(fa=Gd(g.stateNode.containerInfo.firstChild),pa=g,si=!0,Fo=null,b=LC(g,null,O,b),g.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(em(),O===M){g=ql(p,g,b);break e}Bo(p,g,O,b)}g=g.child}return g;case 5:return FC(g),p===null&&$0(g),O=g.type,M=g.pendingProps,G=p!==null?p.memoizedProps:null,ae=M.children,W0(O,M)?ae=null:G!==null&&W0(O,G)&&(g.flags|=32),sI(p,g),Bo(p,g,ae,b),g.child;case 6:return p===null&&$0(g),null;case 13:return yy(p,g,b);case 4:return Z0(g,g.stateNode.containerInfo),O=g.pendingProps,p===null?g.child=tm(g,null,O,b):Bo(p,g,O,b),g.child;case 11:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:$a(O,M),_y(p,g,O,M,b);case 7:return Bo(p,g,g.pendingProps,b),g.child;case 8:return Bo(p,g,g.pendingProps.children,b),g.child;case 12:return Bo(p,g,g.pendingProps.children,b),g.child;case 10:e:{if(O=g.type._context,M=g.pendingProps,G=g.memoizedProps,ae=M.value,fi(ay,O._currentValue),O._currentValue=ae,G!==null)if(cl(G.value,ae)){if(G.children===M.children&&!da.current){g=ql(p,g,b);break e}}else for(G=g.child,G!==null&&(G.return=g);G!==null;){var Ie=G.dependencies;if(Ie!==null){ae=G.child;for(var xe=Ie.firstContext;xe!==null;){if(xe.context===O){if(G.tag===1){xe=Hl(-1,b&-b),xe.tag=2;var it=G.updateQueue;if(it!==null){it=it.shared;var It=it.pending;It===null?xe.next=xe:(xe.next=It.next,It.next=xe),it.pending=xe}}G.lanes|=b,xe=G.alternate,xe!==null&&(xe.lanes|=b),J0(G.return,b,g),Ie.lanes|=b;break}xe=xe.next}}else if(G.tag===10)ae=G.type===g.type?null:G.child;else if(G.tag===18){if(ae=G.return,ae===null)throw Error(s(341));ae.lanes|=b,Ie=ae.alternate,Ie!==null&&(Ie.lanes|=b),J0(ae,b,g),ae=G.sibling}else ae=G.child;if(ae!==null)ae.return=G;else for(ae=G;ae!==null;){if(ae===g){ae=null;break}if(G=ae.sibling,G!==null){G.return=ae.return,ae=G;break}ae=ae.return}G=ae}Bo(p,g,M.children,b),g=g.child}return g;case 9:return M=g.type,O=g.pendingProps.children,Yu(g,b),M=Sc(M),O=O(M),g.flags|=1,Bo(p,g,O,b),g.child;case 14:return O=g.type,M=$a(O,g.pendingProps),M=$a(O.type,M),nI(p,g,O,M,b);case 15:return rI(p,g,g.type,g.pendingProps,b);case 17:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:$a(O,M),by(p,g),g.tag=1,ha(O)?(p=!0,ey(g)):p=!1,Yu(g,b),JC(g,O,M),hT(g,O,M,b),Ey(null,g,O,!0,p,b);case 19:return Ty(p,g,b);case 22:return iI(p,g,b)}throw Error(s(156,g.tag))};function h_(p,g){return Md(p,g)}function Hy(p,g,b,O){this.tag=p,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qa(p,g,b,O){return new Hy(p,g,b,O)}function nh(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Np(p){if(typeof p=="function")return nh(p)?1:0;if(p!=null){if(p=p.$$typeof,p===pe)return 11;if(p===He)return 14}return 2}function nd(p,g){var b=p.alternate;return b===null?(b=qa(p.tag,g,p.key,p.mode),b.elementType=p.elementType,b.type=p.type,b.stateNode=p.stateNode,b.alternate=p,p.alternate=b):(b.pendingProps=g,b.type=p.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=p.flags&14680064,b.childLanes=p.childLanes,b.lanes=p.lanes,b.child=p.child,b.memoizedProps=p.memoizedProps,b.memoizedState=p.memoizedState,b.updateQueue=p.updateQueue,g=p.dependencies,b.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},b.sibling=p.sibling,b.index=p.index,b.ref=p.ref,b}function $y(p,g,b,O,M,G){var ae=2;if(O=p,typeof p=="function")nh(p)&&(ae=1);else if(typeof p=="string")ae=5;else e:switch(p){case ee:return Dp(b.children,M,G,g);case Z:ae=8,M|=8;break;case J:return p=qa(12,b,g,M|2),p.elementType=J,p.lanes=G,p;case le:return p=qa(13,b,g,M),p.elementType=le,p.lanes=G,p;case Me:return p=qa(19,b,g,M),p.elementType=Me,p.lanes=G,p;case we:return rh(b,M,G,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case se:ae=10;break e;case he:ae=9;break e;case pe:ae=11;break e;case He:ae=14;break e;case rt:ae=16,O=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return g=qa(ae,b,g,M),g.elementType=p,g.type=O,g.lanes=G,g}function Dp(p,g,b,O){return p=qa(7,p,O,g),p.lanes=b,p}function rh(p,g,b,O){return p=qa(22,p,O,g),p.elementType=we,p.lanes=b,p.stateNode={isHidden:!1},p}function kT(p,g,b){return p=qa(6,p,null,g),p.lanes=b,p}function NT(p,g,b){return g=qa(4,p.children!==null?p.children:[],p.key,g),g.lanes=b,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function SN(p,g,b,O,M){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=il(0),this.expirationTimes=il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=il(0),this.identifierPrefix=O,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function DT(p,g,b,O,M,G,ae,Ie,xe){return p=new SN(p,g,b,Ie,xe),g===1?(g=1,G===!0&&(g|=8)):g=0,G=qa(3,null,null,g),p.current=G,G.stateNode=p,G.memoizedState={element:O,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yg(G),p}function TN(p,g,b){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ge,key:O==null?null:""+O,children:p,containerInfo:g,implementation:b}}function RI(p){if(!p)return $d;p=p._reactInternals;e:{if(Vs(p)!==p||p.tag!==1)throw Error(s(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(ha(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(s(171))}if(p.tag===1){var b=p.type;if(ha(b))return ZE(p,b,g)}return g}function Ky(p,g,b,O,M,G,ae,Ie,xe){return p=DT(b,O,!0,p,M,G,ae,Ie,xe),p.context=RI(null),b=p.current,O=Xs(),M=Rc(b),G=Hl(O,M),G.callback=g??null,Xd(b,G,M),p.current.lanes=M,Fl(p,M,O),go(p,O),p}function p_(p,g,b,O){var M=g.current,G=Xs(),ae=Rc(M);return b=RI(b),g.context===null?g.context=b:g.pendingContext=b,g=Hl(G,ae),g.payload={element:p},O=O===void 0?null:O,O!==null&&(g.callback=O),p=Xd(M,g,ae),p!==null&&(Cc(p,M,ae,G),Xg(p,M,ae)),ae}function qy(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function LT(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var b=p.retryLane;p.retryLane=b!==0&&b<g?b:g}}function xT(p,g){LT(p,g),(p=p.alternate)&&LT(p,g)}function f_(){return null}var ul=typeof reportError=="function"?reportError:function(p){console.error(p)};function Yy(p){this._internalRoot=p}Xy.prototype.render=Yy.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(s(409));p_(p,g,null,null)},Xy.prototype.unmount=Yy.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;td(function(){p_(null,p,null,null)}),g[_c]=null}};function Xy(p){this._internalRoot=p}Xy.prototype.unstable_scheduleHydration=function(p){if(p){var g=ap();p={blockedOn:null,target:p,priority:g};for(var b=0;b<Do.length&&g!==0&&g<Do[b].priority;b++);Do.splice(b,0,p),b===0&&lp(p)}};function MT(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function gm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function UT(){}function bN(p,g,b,O,M){if(M){if(typeof O=="function"){var G=O;O=function(){var it=qy(ae);G.call(it)}}var ae=Ky(g,O,p,0,null,!1,!1,"",UT);return p._reactRootContainer=ae,p[_c]=ae.current,mp(p.nodeType===8?p.parentNode:p),td(),ae}for(;M=p.lastChild;)p.removeChild(M);if(typeof O=="function"){var Ie=O;O=function(){var it=qy(xe);Ie.call(it)}}var xe=DT(p,0,!1,null,null,!1,!1,"",UT);return p._reactRootContainer=xe,p[_c]=xe.current,mp(p.nodeType===8?p.parentNode:p),td(function(){p_(g,xe,b,O)}),xe}function Lp(p,g,b,O,M){var G=b._reactRootContainer;if(G){var ae=G;if(typeof M=="function"){var Ie=M;M=function(){var xe=qy(ae);Ie.call(xe)}}p_(g,ae,p,M)}else ae=bN(b,g,p,M,O);return qy(ae)}Mf=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var b=Ul(g.pendingLanes);b!==0&&(Ba(g,b|1),go(g,Fr()),(br&6)===0&&(pm=Fr()+500,Kd()))}break;case 13:td(function(){var O=Xu(p,1);if(O!==null){var M=Xs();Cc(O,p,1,M)}}),xT(p,1)}},jl=function(p){if(p.tag===13){var g=Xu(p,134217728);if(g!==null){var b=Xs();Cc(g,p,134217728,b)}xT(p,134217728)}},Bd=function(p){if(p.tag===13){var g=Rc(p),b=Xu(p,g);if(b!==null){var O=Xs();Cc(b,p,g,O)}xT(p,g)}},ap=function(){return nr},Uf=function(p,g){var b=nr;try{return nr=p,g()}finally{nr=b}},xl=function(p,g,b){switch(g){case"input":if(Kt(p,b),g=b.name,b.type==="radio"&&g!=null){for(b=p;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<b.length;g++){var O=b[g];if(O!==p&&O.form===p.form){var M=Jf(O);if(!M)throw Error(s(90));Ut(O),Kt(O,M)}}}break;case"textarea":Ot(p,b);break;case"select":g=b.value,g!=null&&_t(p,!!b.multiple,g,!1)}},Nu=u_,lc=td;var ih={usingClientEntryPoint:!1,Events:[Xf,Ep,Jf,cc,el,u_]},rd={findFiberByHostInstance:_p,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wN={bundleType:rd.bundleType,version:rd.version,rendererPackageName:rd.rendererPackageName,rendererConfig:rd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:de.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=xd(p),p===null?null:p.stateNode},findFiberByHostInstance:rd.findFiberByHostInstance||f_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Jy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jy.isDisabled&&Jy.supportsFiber)try{Ml=Jy.inject(wN),uo=Jy}catch{}}return jc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ih,jc.createPortal=function(p,g){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!MT(g))throw Error(s(200));return TN(p,g,null,b)},jc.createRoot=function(p,g){if(!MT(p))throw Error(s(299));var b=!1,O="",M=ul;return g!=null&&(g.unstable_strictMode===!0&&(b=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(M=g.onRecoverableError)),g=DT(p,1,!1,null,null,b,!1,O,M),p[_c]=g.current,mp(p.nodeType===8?p.parentNode:p),new Yy(g)},jc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=xd(g),p=p===null?null:p.stateNode,p},jc.flushSync=function(p){return td(p)},jc.hydrate=function(p,g,b){if(!gm(g))throw Error(s(200));return Lp(null,p,g,!0,b)},jc.hydrateRoot=function(p,g,b){if(!MT(p))throw Error(s(405));var O=b!=null&&b.hydratedSources||null,M=!1,G="",ae=ul;if(b!=null&&(b.unstable_strictMode===!0&&(M=!0),b.identifierPrefix!==void 0&&(G=b.identifierPrefix),b.onRecoverableError!==void 0&&(ae=b.onRecoverableError)),g=Ky(g,null,p,1,b??null,M,!1,G,ae),p[_c]=g.current,mp(p),O)for(p=0;p<O.length;p++)b=O[p],M=b._getVersion,M=M(b._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[b,M]:g.mutableSourceEagerHydrationData.push(b,M);return new Xy(g)},jc.render=function(p,g,b){if(!gm(g))throw Error(s(200));return Lp(null,p,g,!1,b)},jc.unmountComponentAtNode=function(p){if(!gm(p))throw Error(s(40));return p._reactRootContainer?(td(function(){Lp(null,null,p,!1,function(){p._reactRootContainer=null,p[_c]=null})}),!0):!1},jc.unstable_batchedUpdates=u_,jc.unstable_renderSubtreeIntoContainer=function(p,g,b,O){if(!gm(b))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return Lp(p,g,b,!1,O)},jc.version="18.3.1-next-f1338f8080-20240426",jc}var d$;function DJ(){if(d$)return _M.exports;d$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),_M.exports=g_e(),_M.exports}var h$;function __e(){if(h$)return GP;h$=1;var n=DJ();return GP.createRoot=n.createRoot,GP.hydrateRoot=n.hydrateRoot,GP}var E_e=__e();const y_e=g0(E_e);function v_e(n,t,s,a){return n.addEventListener(t,s,a),()=>{n.removeEventListener(t,s,a)}}function Wk(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function S_e(){return!!(globalThis!=null&&globalThis.document)}function LJ(n){return n.parentElement&&LJ(n.parentElement)?!0:n.hidden}function T_e(n){const t=n.getAttribute("contenteditable");return t!=="false"&&t!=null}function b_e(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function w_e(n){var t;return((t=xJ(n))==null?void 0:t.defaultView)??window}function xJ(n){return Wk(n)?n.ownerDocument:document}function R_e(n){return n.view??window}function C_e(n){return xJ(n).activeElement}function I_e(n){const t=R_e(n);return typeof t.PointerEvent<"u"&&n instanceof t.PointerEvent?n.pointerType==="mouse":n instanceof t.MouseEvent}function MJ(n){return!!n.touches}function A_e(n){return MJ(n)&&n.touches.length>1}function P_e(n,t="page"){const s=n.touches[0]||n.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function O_e(n,t="page"){return{x:n[`${t}X`],y:n[`${t}Y`]}}function UJ(n,t="page"){return MJ(n)?P_e(n,t):O_e(n,t)}function k_e(n){return t=>{const s=I_e(t);(!s||s&&t.button===0)&&n(t)}}function N_e(n,t=!1){function s(l){n(l,{point:UJ(l)})}return t?k_e(s):s}function vO(n,t,s,a){return v_e(n,t,N_e(s,t==="pointerdown"),a)}function D_e(n,...t){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const s={...n};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const Kn=n=>n?"":void 0,AS=n=>n?!0:void 0;function L_e(n){return Array.isArray(n)}function wu(n){const t=typeof n;return n!=null&&(t==="object"||t==="function")&&!L_e(n)}function x_e(n){const t=n==null?0:n.length;return t?n[t-1]:void 0}function M_e(n){const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function j2(n){if(n==null)return n;const{unitless:t}=M_e(n);return t||typeof n=="number"?`${n}px`:n}const VJ=(n,t)=>parseInt(n[1],10)>parseInt(t[1],10)?1:-1,TV=n=>Object.fromEntries(Object.entries(n).sort(VJ));function p$(n){const t=TV(n);return Object.assign(Object.values(t),t)}function U_e(n){const t=Object.keys(TV(n));return new Set(t)}function f$(n){if(!n)return n;n=j2(n)??n;const t=-.02;return typeof n=="number"?`${n+t}`:n.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function mw(n,t){const s=["@media screen"];return n&&s.push("and",`(min-width: ${j2(n)})`),t&&s.push("and",`(max-width: ${j2(t)})`),s.join(" ")}function V_e(n){if(!n)return null;n.base=n.base??"0px";const t=p$(n),s=Object.entries(n).sort(VJ).map(([d,f],E,v)=>{let[,T]=v[E+1]??[];return T=parseFloat(T)>0?f$(T):void 0,{_minW:f$(f),breakpoint:d,minW:f,maxW:T,maxWQuery:mw(null,T),minWQuery:mw(f),minMaxQuery:mw(f,T)}}),a=U_e(n),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(E=>a.has(E))},asObject:TV(n),asArray:p$(n),details:s,get(d){return s.find(f=>f.breakpoint===d)},media:[null,...t.map(d=>mw(d)).slice(1)],toArrayValue(d){if(!wu(d))throw new Error("toArrayValue: value must be an object");const f=l.map(E=>d[E]??null);for(;x_e(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,E,v)=>{const T=l[v];return T!=null&&E!=null&&(f[T]=E),f},{})}}}function FJ(...n){return function(...s){n.forEach(a=>a==null?void 0:a(...s))}}function Qn(...n){return function(s){n.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function bV(n){return L.Children.toArray(n).filter(t=>L.isValidElement(t))}function zk(n){const t=Object.assign({},n);for(let s in t)t[s]===void 0&&delete t[s];return t}function F_e(n,t){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Oi(n={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=n,E=L.createContext(f);E.displayName=t;function v(){var w;const T=L.useContext(E);if(!T&&s){const A=new Error(d??F_e(a,l));throw A.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,A,v),A}return T}return[E.Provider,v,E]}const dn=(...n)=>n.filter(Boolean).join(" "),jJ=n=>n.hasAttribute("tabindex"),j_e=n=>jJ(n)&&n.tabIndex===-1;function tk(n){if(!Wk(n)||LJ(n)||b_e(n))return!1;const{localName:t}=n;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return t in a?a[t]():T_e(n)?!0:jJ(n)}function B_e(n){return n?Wk(n)&&tk(n)&&!j_e(n):!1}const W_e=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],z_e=W_e.join(),G_e=n=>n.offsetWidth>0&&n.offsetHeight>0;function BJ(n){const t=Array.from(n.querySelectorAll(z_e));return t.unshift(n),t.filter(s=>tk(s)&&G_e(s))}function H_e(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const $_e=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=n(a,l,d,f);return E.set(l,v),v}},WJ=$_e(H_e),K_e=n=>n.default||n;function wV(n){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=n;return!!(!s||a||l==="keepMounted"&&t)}function q_e(n){const t=parseFloat(n);return typeof t!="number"||Number.isNaN(t)?0:t}function Y_e(n,t){let s=q_e(n);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function X_e(n){if(!Number.isFinite(n))return 0;let t=1,s=0;for(;Math.round(n*t)/t!==n;)t*=10,s+=1;return s}function m$(n,t,s){return(n-t)*100/(s-t)}function J_e(n,t,s){return(s-t)*n+t}function g$(n,t,s){const a=Math.round((n-t)/s)*s+t,l=X_e(s);return Y_e(a,l)}function vM(n,t,s){return n==null?n:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,t),s))}function _0(n,t=[]){const s=Object.assign({},n);for(const a of t)a in s&&delete s[a];return s}function zJ(n,t){const s={};for(const a of t)a in n&&(s[a]=n[a]);return s}function RV(n,t){return Array.isArray(n)?n.map(s=>s===null?null:t(s)):wu(n)?Object.keys(n).reduce((s,a)=>(s[a]=t(n[a]),s),{}):n!=null?t(n):null}const Q_e=n=>typeof n=="function";function Kc(n,...t){return Q_e(n)?n(...t):n}function Z_e(n){const t=n.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(s+l+a)}function eEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function GJ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:Wk(n)&&Z_e(n)?n:GJ(eEe(n))}function tEe(n,t){const s={},a={};for(const[l,d]of Object.entries(n))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function nEe(n,...t){const s=Object.getOwnPropertyDescriptors(n),a=Object.keys(s),l=f=>{const E={};for(let v=0;v<f.length;v++){const T=f[v];s[T]&&(Object.defineProperty(E,T,s[T]),delete s[T])}return E},d=f=>l(Array.isArray(f)?f:a.filter(f));return t.map(d).concat(l(a))}function _$(n,t,s={}){const{stop:a,getKey:l}=s;function d(f,E=[]){if(wu(f)||Array.isArray(f)){const v={};for(const[T,w]of Object.entries(f)){const A=(l==null?void 0:l(T))??T,N=[...E,A];if(a!=null&&a(f,N))return t(f,E);v[A]=d(w,N)}return v}return t(f,E)}return d(n)}var gw={exports:{}};gw.exports;var E$;function rEe(){return E$||(E$=1,function(n,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,E="[object Arguments]",v="[object Array]",T="[object AsyncFunction]",w="[object Boolean]",A="[object Date]",N="[object Error]",F="[object Function]",j="[object GeneratorFunction]",z="[object Map]",H="[object Number]",te="[object Null]",K="[object Object]",ne="[object Proxy]",de="[object RegExp]",oe="[object Set]",ge="[object String]",ee="[object Undefined]",Z="[object WeakMap]",J="[object ArrayBuffer]",se="[object DataView]",he="[object Float32Array]",pe="[object Float64Array]",le="[object Int8Array]",Me="[object Int16Array]",He="[object Int32Array]",rt="[object Uint8Array]",we="[object Uint8ClampedArray]",Ce="[object Uint16Array]",ve="[object Uint32Array]",Ne=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,Te=/^(?:0|[1-9]\d*)$/,Ae={};Ae[he]=Ae[pe]=Ae[le]=Ae[Me]=Ae[He]=Ae[rt]=Ae[we]=Ae[Ce]=Ae[ve]=!0,Ae[E]=Ae[v]=Ae[J]=Ae[w]=Ae[se]=Ae[A]=Ae[N]=Ae[F]=Ae[z]=Ae[H]=Ae[K]=Ae[de]=Ae[oe]=Ae[ge]=Ae[Z]=!1;var Ue=typeof sE=="object"&&sE&&sE.Object===Object&&sE,ze=typeof self=="object"&&self&&self.Object===Object&&self,et=Ue||ze||Function("return this")(),nt=t&&!t.nodeType&&t,dt=nt&&!0&&n&&!n.nodeType&&n,Xe=dt&&dt.exports===nt,Ct=Xe&&Ue.process,hn=function(){try{var Se=dt&&dt.require&&dt.require("util").types;return Se||Ct&&Ct.binding&&Ct.binding("util")}catch{}}(),Ut=hn&&hn.isTypedArray;function ln(Se,De,tt){switch(tt.length){case 0:return Se.call(De);case 1:return Se.call(De,tt[0]);case 2:return Se.call(De,tt[0],tt[1]);case 3:return Se.call(De,tt[0],tt[1],tt[2])}return Se.apply(De,tt)}function xn(Se,De){for(var tt=-1,$t=Array(Se);++tt<Se;)$t[tt]=De(tt);return $t}function Yt(Se){return function(De){return Se(De)}}function Yn(Se,De){return Se==null?void 0:Se[De]}function Kt(Se,De){return function(tt){return Se(De(tt))}}var Re=Array.prototype,Fe=Function.prototype,Ke=Object.prototype,_t=et["__core-js_shared__"],vt=Fe.toString,Ge=Ke.hasOwnProperty,Ot=function(){var Se=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return Se?"Symbol(src)_1."+Se:""}(),Xt=Ke.toString,pn=vt.call(Object),an=RegExp("^"+vt.call(Ge).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ir=Xe?et.Buffer:void 0,na=et.Symbol,Vt=et.Uint8Array;ir&&ir.allocUnsafe;var sn=Kt(Object.getPrototypeOf,Object),Ii=Object.create,di=Ke.propertyIsEnumerable,yi=Re.splice,dr=na?na.toStringTag:void 0,Ua=function(){try{var Se=ja(Object,"defineProperty");return Se({},"",{}),Se}catch{}}(),Zc=ir?ir.isBuffer:void 0,co=Math.max,lo=Date.now,xl=ja(et,"Map"),Us=ja(Object,"create"),ac=function(){function Se(){}return function(De){if(!pc(De))return{};if(Ii)return Ii(De);Se.prototype=De;var tt=new Se;return Se.prototype=void 0,tt}}();function ra(Se){var De=-1,tt=Se==null?0:Se.length;for(this.clear();++De<tt;){var $t=Se[De];this.set($t[0],$t[1])}}function cc(){this.__data__=Us?Us(null):{},this.size=0}function el(Se){var De=this.has(Se)&&delete this.__data__[Se];return this.size-=De?1:0,De}function Nu(Se){var De=this.__data__;if(Us){var tt=De[Se];return tt===a?void 0:tt}return Ge.call(De,Se)?De[Se]:void 0}function lc(Se){var De=this.__data__;return Us?De[Se]!==void 0:Ge.call(De,Se)}function tl(Se,De){var tt=this.__data__;return this.size+=this.has(Se)?0:1,tt[Se]=Us&&De===void 0?a:De,this}ra.prototype.clear=cc,ra.prototype.delete=el,ra.prototype.get=Nu,ra.prototype.has=lc,ra.prototype.set=tl;function Co(Se){var De=-1,tt=Se==null?0:Se.length;for(this.clear();++De<tt;){var $t=Se[De];this.set($t[0],$t[1])}}function Ni(){this.__data__=[],this.size=0}function ls(Se){var De=this.__data__,tt=Ud(De,Se);if(tt<0)return!1;var $t=De.length-1;return tt==$t?De.pop():yi.call(De,tt,1),--this.size,!0}function Va(Se){var De=this.__data__,tt=Ud(De,Se);return tt<0?void 0:De[tt][1]}function Du(Se){return Ud(this.__data__,Se)>-1}function uc(Se,De){var tt=this.__data__,$t=Ud(tt,Se);return $t<0?(++this.size,tt.push([Se,De])):tt[$t][1]=De,this}Co.prototype.clear=Ni,Co.prototype.delete=ls,Co.prototype.get=Va,Co.prototype.has=Du,Co.prototype.set=uc;function ia(Se){var De=-1,tt=Se==null?0:Se.length;for(this.clear();++De<tt;){var $t=Se[De];this.set($t[0],$t[1])}}function sa(){this.size=0,this.__data__={hash:new ra,map:new(xl||Co),string:new ra}}function Dd(Se){var De=Uu(this,Se).delete(Se);return this.size-=De?1:0,De}function Og(Se){return Uu(this,Se).get(Se)}function Lu(Se){return Uu(this,Se).has(Se)}function ip(Se,De){var tt=Uu(this,Se),$t=tt.size;return tt.set(Se,De),this.size+=tt.size==$t?0:1,this}ia.prototype.clear=sa,ia.prototype.delete=Dd,ia.prototype.get=Og,ia.prototype.has=Lu,ia.prototype.set=ip;function Vs(Se){var De=this.__data__=new Co(Se);this.size=De.size}function xu(){this.__data__=new Co,this.size=0}function oa(Se){var De=this.__data__,tt=De.delete(Se);return this.size=De.size,tt}function Ld(Se){return this.__data__.get(Se)}function xd(Se){return this.__data__.has(Se)}function Fa(Se,De){var tt=this.__data__;if(tt instanceof Co){var $t=tt.__data__;if(!xl||$t.length<s-1)return $t.push([Se,De]),this.size=++tt.size,this;tt=this.__data__=new ia($t)}return tt.set(Se,De),this.size=tt.size,this}Vs.prototype.clear=xu,Vs.prototype.delete=oa,Vs.prototype.get=Ld,Vs.prototype.has=xd,Vs.prototype.set=Fa;function Md(Se,De){var tt=Oo(Se),$t=!tt&&ns(Se),Hn=!tt&&!$t&&No(Se),_r=!tt&&!$t&&!Hn&&lp(Se),jr=tt||$t||Hn||_r,cn=jr?xn(Se.length,String):[],Nr=cn.length;for(var pi in Se)jr&&(pi=="length"||Hn&&(pi=="offset"||pi=="parent")||_r&&(pi=="buffer"||pi=="byteLength"||pi=="byteOffset")||il(pi,Nr))||cn.push(pi);return cn}function Mu(Se,De,tt){(tt!==void 0&&!Po(Se[De],tt)||tt===void 0&&!(De in Se))&&Fr(Se,De,tt)}function Io(Se,De,tt){var $t=Se[De];(!(Ge.call(Se,De)&&Po($t,tt))||tt===void 0&&!(De in Se))&&Fr(Se,De,tt)}function Ud(Se,De){for(var tt=Se.length;tt--;)if(Po(Se[tt][0],De))return tt;return-1}function Fr(Se,De,tt){De=="__proto__"&&Ua?Ua(Se,De,{configurable:!0,enumerable:!0,value:tt,writable:!0}):Se[De]=tt}var hi=Vl();function dc(Se){return Se==null?Se===void 0?ee:te:dr&&dr in Object(Se)?Ao(Se):Mf(Se)}function nl(Se){return us(Se)&&dc(Se)==E}function aa(Se){if(!pc(Se)||Ba(Se))return!1;var De=Do(Se)?an:be;return De.test(cp(Se))}function sp(Se){return us(Se)&&Vf(Se.length)&&!!Ae[dc(Se)]}function Vd(Se){if(!pc(Se))return hc(Se);var De=nr(Se),tt=[];for(var $t in Se)$t=="constructor"&&(De||!Ge.call(Se,$t))||tt.push($t);return tt}function Ml(Se,De,tt,$t,Hn){Se!==De&&hi(De,function(_r,jr){if(Hn||(Hn=new Vs),pc(_r))uo(Se,De,jr,tt,Ml,$t,Hn);else{var cn=$t?$t(Bd(Se,jr),_r,jr+"",Se,De,Hn):void 0;cn===void 0&&(cn=_r),Mu(Se,jr,cn)}},Wl)}function uo(Se,De,tt,$t,Hn,_r,jr){var cn=Bd(Se,tt),Nr=Bd(De,tt),pi=jr.get(Nr);if(pi){Mu(Se,tt,pi);return}var Is=_r?_r(cn,Nr,tt+"",Se,De,jr):void 0,Lo=Is===void 0;if(Lo){var xo=Oo(Nr),ju=!xo&&No(Nr),Ki=!xo&&!ju&&lp(Nr);Is=Nr,xo||ju||Ki?Oo(cn)?Is=cn:Bl(cn)?Is=jd(cn):ju?(Lo=!1,Is=op(Nr)):Ki?(Lo=!1,Is=Fd(Nr)):Is=[]:Fu(Nr)||ns(Nr)?(Is=cn,ns(cn)?Is=sl(cn):(!pc(cn)||Do(cn))&&(Is=Vu(Nr))):Lo=!1}Lo&&(jr.set(Nr,Is),Hn(Is,Nr,$t,_r,jr),jr.delete(Nr)),Mu(Se,tt,Is)}function xf(Se,De){return ap(jl(Se,De,la),Se+"")}var Ks=Ua?function(Se,De){return Ua(Se,"toString",{configurable:!0,enumerable:!1,value:ca(De),writable:!0})}:la;function op(Se,De){return Se.slice()}function rl(Se){var De=new Se.constructor(Se.byteLength);return new Vt(De).set(new Vt(Se)),De}function Fd(Se,De){var tt=rl(Se.buffer);return new Se.constructor(tt,Se.byteOffset,Se.length)}function jd(Se,De){var tt=-1,$t=Se.length;for(De||(De=Array($t));++tt<$t;)De[tt]=Se[tt];return De}function hr(Se,De,tt,$t){var Hn=!tt;tt||(tt={});for(var _r=-1,jr=De.length;++_r<jr;){var cn=De[_r],Nr=void 0;Nr===void 0&&(Nr=Se[cn]),Hn?Fr(tt,cn,Nr):Io(tt,cn,Nr)}return tt}function Ul(Se){return xf(function(De,tt){var $t=-1,Hn=tt.length,_r=Hn>1?tt[Hn-1]:void 0,jr=Hn>2?tt[2]:void 0;for(_r=Se.length>3&&typeof _r=="function"?(Hn--,_r):void 0,jr&&Fl(tt[0],tt[1],jr)&&(_r=Hn<3?void 0:_r,Hn=1),De=Object(De);++$t<Hn;){var cn=tt[$t];cn&&Se(De,cn,$t,_r)}return De})}function Vl(Se){return function(De,tt,$t){for(var Hn=-1,_r=Object(De),jr=$t(De),cn=jr.length;cn--;){var Nr=jr[++Hn];if(tt(_r[Nr],Nr,_r)===!1)break}return De}}function Uu(Se,De){var tt=Se.__data__;return zr(De)?tt[typeof De=="string"?"string":"hash"]:tt.map}function ja(Se,De){var tt=Yn(Se,De);return aa(tt)?tt:void 0}function Ao(Se){var De=Ge.call(Se,dr),tt=Se[dr];try{Se[dr]=void 0;var $t=!0}catch{}var Hn=Xt.call(Se);return $t&&(De?Se[dr]=tt:delete Se[dr]),Hn}function Vu(Se){return typeof Se.constructor=="function"&&!nr(Se)?ac(sn(Se)):{}}function il(Se,De){var tt=typeof Se;return De=De??f,!!De&&(tt=="number"||tt!="symbol"&&Te.test(Se))&&Se>-1&&Se%1==0&&Se<De}function Fl(Se,De,tt){if(!pc(tt))return!1;var $t=typeof De;return($t=="number"?ko(tt)&&il(De,tt.length):$t=="string"&&De in tt)?Po(tt[De],Se):!1}function zr(Se){var De=typeof Se;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Se!=="__proto__":Se===null}function Ba(Se){return!!Ot&&Ot in Se}function nr(Se){var De=Se&&Se.constructor,tt=typeof De=="function"&&De.prototype||Ke;return Se===tt}function hc(Se){var De=[];if(Se!=null)for(var tt in Object(Se))De.push(tt);return De}function Mf(Se){return Xt.call(Se)}function jl(Se,De,tt){return De=co(De===void 0?Se.length-1:De,0),function(){for(var $t=arguments,Hn=-1,_r=co($t.length-De,0),jr=Array(_r);++Hn<_r;)jr[Hn]=$t[De+Hn];Hn=-1;for(var cn=Array(De+1);++Hn<De;)cn[Hn]=$t[Hn];return cn[De]=tt(jr),ln(Se,this,cn)}}function Bd(Se,De){if(!(De==="constructor"&&typeof Se[De]=="function")&&De!="__proto__")return Se[De]}var ap=Uf(Ks);function Uf(Se){var De=0,tt=0;return function(){var $t=lo(),Hn=d-($t-tt);if(tt=$t,Hn>0){if(++De>=l)return arguments[0]}else De=0;return Se.apply(void 0,arguments)}}function cp(Se){if(Se!=null){try{return vt.call(Se)}catch{}try{return Se+""}catch{}}return""}function Po(Se,De){return Se===De||Se!==Se&&De!==De}var ns=nl(function(){return arguments}())?nl:function(Se){return us(Se)&&Ge.call(Se,"callee")&&!di.call(Se,"callee")},Oo=Array.isArray;function ko(Se){return Se!=null&&Vf(Se.length)&&!Do(Se)}function Bl(Se){return us(Se)&&ko(Se)}var No=Zc||ol;function Do(Se){if(!pc(Se))return!1;var De=dc(Se);return De==F||De==j||De==T||De==ne}function Vf(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=f}function pc(Se){var De=typeof Se;return Se!=null&&(De=="object"||De=="function")}function us(Se){return Se!=null&&typeof Se=="object"}function Fu(Se){if(!us(Se)||dc(Se)!=K)return!1;var De=sn(Se);if(De===null)return!0;var tt=Ge.call(De,"constructor")&&De.constructor;return typeof tt=="function"&&tt instanceof tt&&vt.call(tt)==pn}var lp=Ut?Yt(Ut):sp;function sl(Se){return hr(Se,Wl(Se))}function Wl(Se){return ko(Se)?Md(Se):Vd(Se)}var Ff=Ul(function(Se,De,tt,$t){Ml(Se,De,tt,$t)});function ca(Se){return function(){return Se}}function la(Se){return Se}function ol(){return!1}n.exports=Ff}(gw,gw.exports)),gw.exports}var iEe=rEe();const Uh=g0(iEe);function qc(n,t=[]){const s=L.useRef(n);return L.useEffect(()=>{s.current=n}),L.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function PS(n,t,s,a){const l=qc(s);return L.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,n,a,l,s]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(t,l,a)}}function HJ(n){const{isOpen:t,ref:s}=n,[a,l]=L.useState(t),[d,f]=L.useState(!1);return L.useEffect(()=>{d||(l(t),f(!0))},[t,d,a]),PS(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var w;const v=w_e(s.current),T=new v.CustomEvent("animationend",{bubbles:!0});(w=s.current)==null||w.dispatchEvent(T)}}}function $J(n){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(N,F)=>N!==F}=n,d=qc(a),f=qc(l),[E,v]=L.useState(s),T=t!==void 0,w=T?t:E,A=qc(N=>{const j=typeof N=="function"?N(w):N;f(w,j)&&(T||v(j),d(j))},[T,d,w,f]);return[w,A]}function Sf(n={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=n,d=qc(s),f=qc(t),[E,v]=L.useState(n.defaultIsOpen||!1),T=a!==void 0?a:E,w=a!==void 0,A=L.useId(),N=l??`disclosure-${A}`,F=L.useCallback(()=>{w||v(!1),f==null||f()},[w,f]),j=L.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),z=L.useCallback(()=>{T?F():j()},[T,j,F]);function H(K={}){return{...K,"aria-expanded":T,"aria-controls":N,onClick(ne){var de;(de=K.onClick)==null||de.call(K,ne),z()}}}function te(K={}){return{...K,hidden:!T,id:N}}return{isOpen:T,onOpen:j,onClose:F,onToggle:z,isControlled:w,getButtonProps:H,getDisclosureProps:te}}const mf=globalThis!=null&&globalThis.document?L.useLayoutEffect:L.useEffect,hg=(n,t)=>{const s=L.useRef(!1),a=L.useRef(!1);L.useEffect(()=>{if(s.current&&a.current)return n();a.current=!0},t),L.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function sEe(n){const t=n.current;if(!t)return!1;const s=C_e(t);return!s||t.contains(s)?!1:!!B_e(s)}function KJ(n,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;hg(()=>{if(!d||sEe(n))return;const f=(l==null?void 0:l.current)||n.current;let E;if(f)return E=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,n,l])}const oEe={preventScroll:!0,shouldFocus:!1};function aEe(n,t=oEe){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,f=cEe(n)?n.current:n,E=l&&d,v=L.useRef(E),T=L.useRef(d);mf(()=>{!T.current&&d&&(v.current=E),T.current=d},[d,E]);const w=L.useCallback(()=>{if(!(!d||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var A;(A=s.current)==null||A.focus({preventScroll:a})});else{const A=BJ(f);A.length>0&&requestAnimationFrame(()=>{A[0].focus({preventScroll:a})})}},[d,a,f,s]);hg(()=>{w()},[w]),PS(f,"transitionend",w)}function cEe(n){return"current"in n}function lEe(n){return"current"in n}const qJ=()=>typeof window<"u";function uEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const dEe=n=>qJ()&&n.test(navigator.vendor),hEe=n=>qJ()&&n.test(uEe()),pEe=()=>hEe(/mac|iphone|ipad|ipod/i),fEe=()=>pEe()&&dEe(/apple/i);function mEe(n){const{ref:t,elements:s,enabled:a}=n,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};PS(l,"pointerdown",d=>{var T,w;if(!fEe()||!a)return;const f=((w=(T=d.composedPath)==null?void 0:T.call(d))==null?void 0:w[0])??d.target,v=(s??[t]).some(A=>{const N=lEe(A)?A.current:A;return(N==null?void 0:N.contains(f))||N===f});l().activeElement!==f&&v&&(d.preventDefault(),f.focus())})}function gEe(n,t){const s=L.useId();return L.useMemo(()=>n||[t,s].filter(Boolean).join("-"),[n,t,s])}function _Ee(n,...t){const s=gEe(n);return L.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function YJ(n){const t=L.useRef(null);return t.current=n,t}function EEe(n,t){if(n!=null){if(typeof n=="function"){n(t);return}try{n.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${n}'`)}}}function es(...n){return t=>{n.forEach(s=>{EEe(s,t)})}}function yEe(...n){return L.useMemo(()=>es(...n),n)}function XJ(n){const{ref:t,handler:s,enabled:a=!0}=n,l=qc(s),f=L.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;L.useEffect(()=>{if(!a)return;const E=A=>{SM(A,t)&&(f.isPointerDown=!0)},v=A=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&s&&SM(A,t)&&(f.isPointerDown=!1,l(A))},T=A=>{f.ignoreEmulatedMouseEvents=!0,s&&f.isPointerDown&&SM(A,t)&&(f.isPointerDown=!1,l(A))},w=JJ(t.current);return w.addEventListener("mousedown",E,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",E,!0),w.addEventListener("touchend",T,!0),()=>{w.removeEventListener("mousedown",E,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",E,!0),w.removeEventListener("touchend",T,!0)}},[s,t,l,f,a])}function SM(n,t){var a,l;const s=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return s&&!JJ(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function JJ(n){return(n==null?void 0:n.ownerDocument)??document}function vEe(n,t){const s=qc(n);L.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const QJ=1/60*1e3,SEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),ZJ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(SEe()),QJ);function TEe(n){let t=[],s=[],a=0,l=!1,d=!1;const f=new WeakSet,E={schedule:(v,T=!1,w=!1)=>{const A=w&&l,N=A?t:s;return T&&f.add(v),N.indexOf(v)===-1&&(N.push(v),A&&l&&(a=t.length)),v},cancel:v=>{const T=s.indexOf(v);T!==-1&&s.splice(T,1),f.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let T=0;T<a;T++){const w=t[T];w(v),f.has(w)&&(E.schedule(w),n())}l=!1,d&&(d=!1,E.process(v))}};return E}const bEe=40;let B2=!0,nR=!1,W2=!1;const OS={delta:0,timestamp:0},OR=["read","update","preRender","render","postRender"],Gk=OR.reduce((n,t)=>(n[t]=TEe(()=>nR=!0),n),{}),wEe=OR.reduce((n,t)=>{const s=Gk[t];return n[t]=(a,l=!1,d=!1)=>(nR||IEe(),s.schedule(a,l,d)),n},{}),REe=OR.reduce((n,t)=>(n[t]=Gk[t].cancel,n),{});OR.reduce((n,t)=>(n[t]=()=>Gk[t].process(OS),n),{});const CEe=n=>Gk[n].process(OS),eQ=n=>{nR=!1,OS.delta=B2?QJ:Math.max(Math.min(n-OS.timestamp,bEe),1),OS.timestamp=n,W2=!0,OR.forEach(CEe),W2=!1,nR&&(B2=!1,ZJ(eQ))},IEe=()=>{nR=!0,B2=!0,W2||ZJ(eQ)},y$=()=>OS;var AEe=Object.defineProperty,PEe=(n,t,s)=>t in n?AEe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,vd=(n,t,s)=>(PEe(n,typeof t!="symbol"?t+"":t,s),s);class OEe{constructor(t,s,a){if(vd(this,"history",[]),vd(this,"startEvent",null),vd(this,"lastEvent",null),vd(this,"lastEventInfo",null),vd(this,"handlers",{}),vd(this,"removeListeners",()=>{}),vd(this,"threshold",3),vd(this,"win"),vd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=TM(this.lastEventInfo,this.history),v=this.startEvent!==null,T=LEe(E.offset,{x:0,y:0})>=this.threshold;if(!v&&!T)return;const{timestamp:w}=y$();this.history.push({...E.point,timestamp:w});const{onStart:A,onMove:N}=this.handlers;v||(A==null||A(this.lastEvent,E),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,E)}),vd(this,"onPointerMove",(E,v)=>{this.lastEvent=E,this.lastEventInfo=v,wEe.update(this.updatePoint,!0)}),vd(this,"onPointerUp",(E,v)=>{const T=TM(v,this.history),{onEnd:w,onSessionEnd:A}=this.handlers;A==null||A(E,T),this.end(),!(!w||!this.startEvent)&&(w==null||w(E,T))}),this.win=t.view??window,A_e(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:UJ(t)},{timestamp:d}=y$();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=s;f==null||f(t,TM(l,this.history)),this.removeListeners=DEe(vO(this.win,"pointermove",this.onPointerMove),vO(this.win,"pointerup",this.onPointerUp),vO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),REe.update(this.updatePoint)}}function v$(n,t){return{x:n.x-t.x,y:n.y-t.y}}function TM(n,t){return{point:n.point,delta:v$(n.point,t[t.length-1]),offset:v$(n.point,t[0]),velocity:NEe(t,.1)}}const kEe=n=>n*1e3;function NEe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=n[n.length-1];for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>kEe(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function DEe(...n){return t=>n.reduce((s,a)=>a(s),t)}function bM(n,t){return Math.abs(n-t)}function S$(n){return"x"in n&&"y"in n}function LEe(n,t){if(typeof n=="number"&&typeof t=="number")return bM(n,t);if(S$(n)&&S$(t)){const s=bM(n.x,t.x),a=bM(n.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function xEe(n,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:E}=t,v=!!(s||a||l||d||f),T=L.useRef(null),w=YJ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:s,onEnd(A,N){T.current=null,l==null||l(A,N)}});L.useEffect(()=>{var A;(A=T.current)==null||A.updateHandlers(w.current)}),L.useEffect(()=>{const A=n.current;if(!A||!v)return;function N(F){T.current=new OEe(F,w.current,E)}return vO(A,"pointerdown",N)},[n,v,w,E]),L.useEffect(()=>()=>{var A;(A=T.current)==null||A.end(),T.current=null},[])}const no={open:(n,t)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${t}`,closed:(n,t)=>`${n}[data-closed], ${n}[data-state=closed] ${t}`,hover:(n,t)=>`${n}:hover ${t}, ${n}[data-hover] ${t}`,focus:(n,t)=>`${n}:focus ${t}, ${n}[data-focus] ${t}`,focusVisible:(n,t)=>`${n}:focus-visible ${t}`,focusWithin:(n,t)=>`${n}:focus-within ${t}`,active:(n,t)=>`${n}:active ${t}, ${n}[data-active] ${t}`,disabled:(n,t)=>`${n}:disabled ${t}, ${n}[data-disabled] ${t}`,invalid:(n,t)=>`${n}:invalid ${t}, ${n}[data-invalid] ${t}`,checked:(n,t)=>`${n}:checked ${t}, ${n}[data-checked] ${t}`,placeholderShown:(n,t)=>`${n}:placeholder-shown ${t}`},Ih=n=>tQ(t=>n(t,"&"),"[role=group]","[data-group]",".group"),ef=n=>tQ(t=>n(t,"~ &"),"[data-peer]",".peer"),tQ=(n,...t)=>t.map(n).join(", "),kS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Ih(no.open),_groupClosed:Ih(no.closed),_groupHover:Ih(no.hover),_peerHover:ef(no.hover),_groupFocus:Ih(no.focus),_peerFocus:ef(no.focus),_groupFocusVisible:Ih(no.focusVisible),_peerFocusVisible:ef(no.focusVisible),_groupActive:Ih(no.active),_peerActive:ef(no.active),_groupDisabled:Ih(no.disabled),_peerDisabled:ef(no.disabled),_groupInvalid:Ih(no.invalid),_peerInvalid:ef(no.invalid),_groupChecked:Ih(no.checked),_peerChecked:ef(no.checked),_groupFocusWithin:Ih(no.focusWithin),_peerFocusWithin:ef(no.focusWithin),_peerPlaceholderShown:ef(no.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},nQ=Object.keys(kS),MEe=n=>/!(important)?$/.test(n),T$=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,UEe=(n,t)=>s=>{const a=String(t),l=MEe(a),d=T$(a),f=n?`${n}.${d}`:d;let E=wu(s.__cssMap)&&f in s.__cssMap?s.__cssMap[f].varRef:t;return E=T$(E),l?`${E} !important`:E};function CV(n){const{scale:t,transform:s,compose:a}=n;return(d,f)=>{const E=UEe(t,d)(f);let v=(s==null?void 0:s(E,f))??E;return a&&(v=a(v,f)),v}}const HP=(...n)=>t=>n.reduce((s,a)=>a(s),t);function _u(n,t){return s=>{const a={property:s,scale:n};return a.transform=CV({scale:n,transform:t}),a}}const VEe=({rtl:n,ltr:t})=>s=>s.direction==="rtl"?n:t;function FEe(n){const{property:t,scale:s,transform:a}=n;return{scale:s,property:VEe(t),transform:s?CV({scale:s,compose:a}):a}}const rQ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function jEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...rQ].join(" ")}function BEe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...rQ].join(" ")}const WEe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},zEe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function GEe(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const HEe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},z2={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},$Ee=new Set(Object.values(z2)),G2=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),KEe=n=>n.trim();function qEe(n,t){if(n==null||G2.has(n))return n;if(!(H2(n)||G2.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return n;const E=d.includes("-gradient")?d:`${d}-gradient`,[v,...T]=f.split(",").map(KEe).filter(Boolean);if((T==null?void 0:T.length)===0)return n;const w=v in z2?z2[v]:v;T.unshift(w);const A=T.map(N=>{if($Ee.has(N))return N;const F=N.indexOf(" "),[j,z]=F!==-1?[N.substr(0,F),N.substr(F+1)]:[N],H=H2(z)?z:z&&z.split(" "),te=`colors.${j}`,K=te in t.__cssMap?t.__cssMap[te].varRef:j;return H?[K,...Array.isArray(H)?H:[H]].join(" "):K});return`${E}(${A.join(", ")})`}const H2=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),YEe=(n,t)=>qEe(n,t??{});function XEe(n){return/^var\(--.+\)$/.test(n)}const JEe=n=>{const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},Ah=n=>t=>`${n}(${t})`,Ir={filter(n){return n!=="auto"?n:WEe},backdropFilter(n){return n!=="auto"?n:zEe},ring(n){return GEe(Ir.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?jEe():n==="auto-gpu"?BEe():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:t}=JEe(n);return t||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[n]:n},degree(n){if(XEe(n)||n==null)return n;const t=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||t?`${n}deg`:n},gradient:YEe,blur:Ah("blur"),opacity:Ah("opacity"),brightness:Ah("brightness"),contrast:Ah("contrast"),dropShadow:Ah("drop-shadow"),grayscale:Ah("grayscale"),hueRotate:n=>Ah("hue-rotate")(Ir.degree(n)),invert:Ah("invert"),saturate:Ah("saturate"),sepia:Ah("sepia"),bgImage(n){return n==null||H2(n)||G2.has(n)?n:`url(${n})`},outline(n){const t=String(n)==="0"||String(n)==="none";return n!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:t,divide:s}=HEe[n]??{},a={flexDirection:n};return t&&(a[t]=1),s&&(a[s]=1),a}},Be={borderWidths:_u("borderWidths"),borderStyles:_u("borderStyles"),colors:_u("colors"),borders:_u("borders"),gradients:_u("gradients",Ir.gradient),radii:_u("radii",Ir.px),space:_u("space",HP(Ir.vh,Ir.px)),spaceT:_u("space",HP(Ir.vh,Ir.px)),degreeT(n){return{property:n,transform:Ir.degree}},prop(n,t,s){return{property:n,scale:t,...t&&{transform:CV({scale:t,transform:s})}}},propT(n,t){return{property:n,transform:t}},sizes:_u("sizes",HP(Ir.vh,Ir.px)),sizesT:_u("sizes",HP(Ir.vh,Ir.fraction)),shadows:_u("shadows"),logical:FEe,blur:_u("blur",Ir.blur)},SO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Ir.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Ir.bgClip}};Object.assign(SO,{bgImage:SO.backgroundImage,bgImg:SO.backgroundImage});const $r={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign($r,{rounded:$r.borderRadius,roundedTop:$r.borderTopRadius,roundedTopLeft:$r.borderTopLeftRadius,roundedTopRight:$r.borderTopRightRadius,roundedTopStart:$r.borderStartStartRadius,roundedTopEnd:$r.borderStartEndRadius,roundedBottom:$r.borderBottomRadius,roundedBottomLeft:$r.borderBottomLeftRadius,roundedBottomRight:$r.borderBottomRightRadius,roundedBottomStart:$r.borderEndStartRadius,roundedBottomEnd:$r.borderEndEndRadius,roundedLeft:$r.borderLeftRadius,roundedRight:$r.borderRightRadius,roundedStart:$r.borderInlineStartRadius,roundedEnd:$r.borderInlineEndRadius,borderStart:$r.borderInlineStart,borderEnd:$r.borderInlineEnd,borderTopStartRadius:$r.borderStartStartRadius,borderTopEndRadius:$r.borderStartEndRadius,borderBottomStartRadius:$r.borderEndStartRadius,borderBottomEndRadius:$r.borderEndEndRadius,borderStartRadius:$r.borderInlineStartRadius,borderEndRadius:$r.borderInlineEndRadius,borderStartWidth:$r.borderInlineStartWidth,borderEndWidth:$r.borderInlineEndWidth,borderStartColor:$r.borderInlineStartColor,borderEndColor:$r.borderInlineEndColor,borderStartStyle:$r.borderInlineStartStyle,borderEndStyle:$r.borderInlineEndStyle});const QEe={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},nk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Ir.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(nk,{flexDir:nk.flexDirection});const vu={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Ir.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(vu,{w:vu.width,h:vu.height,minW:vu.minWidth,maxW:vu.maxWidth,minH:vu.minHeight,maxH:vu.maxHeight,overscroll:vu.overscrollBehavior,overscrollX:vu.overscrollBehaviorX,overscrollY:vu.overscrollBehaviorY});const ZEe={filter:{transform:Ir.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Ir.brightness),contrast:Be.propT("--chakra-contrast",Ir.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Ir.hueRotate),invert:Be.propT("--chakra-invert",Ir.invert),saturate:Be.propT("--chakra-saturate",Ir.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Ir.dropShadow),backdropFilter:{transform:Ir.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Ir.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Ir.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Ir.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Ir.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Ir.saturate)},eye={ring:{transform:Ir.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},tye={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Ir.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},iQ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function nye(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const rye=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=n(a,l,d,f);return E.set(l,v),v}},iye=rye(nye),sye={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},oye={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},wM=(n,t,s)=>{const a={},l=iye(n,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},aye={srOnly:{transform(n){return n===!0?sye:n==="focusable"?oye:{}}},layerStyle:{processResult:!0,transform:(n,t,s)=>wM(t,`layerStyles.${n}`,s)},textStyle:{processResult:!0,transform:(n,t,s)=>wM(t,`textStyles.${n}`,s)},apply:{processResult:!0,transform:(n,t,s)=>wM(t,n,s)}},Dw={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Dw,{insetStart:Dw.insetInlineStart,insetEnd:Dw.insetInlineEnd});const $2={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign($2,{shadow:$2.boxShadow});const ji={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(ji,{m:ji.margin,mt:ji.marginTop,mr:ji.marginRight,me:ji.marginInlineEnd,marginEnd:ji.marginInlineEnd,mb:ji.marginBottom,ml:ji.marginLeft,ms:ji.marginInlineStart,marginStart:ji.marginInlineStart,mx:ji.marginX,my:ji.marginY,p:ji.padding,pt:ji.paddingTop,py:ji.paddingY,px:ji.paddingX,pb:ji.paddingBottom,pl:ji.paddingLeft,ps:ji.paddingInlineStart,paddingStart:ji.paddingInlineStart,pr:ji.paddingRight,pe:ji.paddingInlineEnd,paddingEnd:ji.paddingInlineEnd});const cye={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},lye={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Ir.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},uye={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},dye={clipPath:!0,transform:Be.propT("transform",Ir.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},hye={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},pye={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},IV=Uh({},SO,$r,QEe,nk,vu,ZEe,eye,tye,iQ,aye,Dw,$2,ji,cye,lye,uye,dye,hye,pye),fye=Object.assign({},ji,vu,nk,iQ,Dw),mye=Object.keys(fye),gye=[...Object.keys(IV),...nQ],_ye={...IV,...kS},Eye=n=>n in _ye,yye=n=>t=>{if(!t.__breakpoints)return n;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const f in n){let E=Kc(n[f],t);if(E==null)continue;if(E=wu(E)&&s(E)?a(E):E,!Array.isArray(E)){d[f]=E;continue}const v=E.slice(0,l.length).length;for(let T=0;T<v;T+=1){const w=l==null?void 0:l[T];if(!w){d[f]=E[T];continue}d[w]=d[w]||{},E[T]!=null&&(d[w][f]=E[T])}}return d};function vye(n){const t=[];let s="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function Sye(n){return/^var\(--.+\)$/.test(n)}const Tye=(n,t)=>n.startsWith("--")&&typeof t=="string"&&!Sye(t),bye=(n,t)=>{if(t==null)return t;const s=f=>{var E,v;return(v=(E=n.__cssMap)==null?void 0:E[f])==null?void 0:v.varRef},a=f=>s(f)??f,[l,d]=vye(t);return t=s(l)??a(d)??a(t),t};function wye(n){const{configs:t={},pseudos:s={},theme:a}=n,l=(d,f=!1)=>{var w;const E=Kc(d,a),v=yye(E)(a);let T={};for(let A in v){const N=v[A];let F=Kc(N,a);A in s&&(A=s[A]),Tye(A,F)&&(F=bye(a,F));let j=t[A];if(j===!0&&(j={property:A}),wu(F)){T[A]=T[A]??{},T[A]=Uh({},T[A],l(F,!0));continue}let z=((w=j==null?void 0:j.transform)==null?void 0:w.call(j,F,a,E))??F;z=j!=null&&j.processResult?l(z,!0):z;const H=Kc(j==null?void 0:j.property,a);if(!f&&(j!=null&&j.static)){const te=Kc(j.static,a);T=Uh({},T,te)}if(H&&Array.isArray(H)){for(const te of H)T[te]=z;continue}if(H){H==="&"&&wu(z)?T=Uh({},T,z):T[H]=z;continue}if(wu(z)){T=Uh({},T,z);continue}T[A]=z}return T};return l}const sQ=n=>t=>wye({theme:t,pseudos:kS,configs:IV})(n);function n8e(n){return n}function r8e(n){return n}function ki(n){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:n,...t}}}}function Rye(n,t,s){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function Cye(n,t){if(Array.isArray(n))return n;if(wu(n))return t(n);if(n!=null)return[n]}function Iye(n,t){for(let s=t+1;s<n.length;s++)if(n[s]!=null)return s;return-1}function Aye(n){const t=n.__breakpoints;return function(a,l,d,f){var N,F;if(!t)return;const E={},v=Cye(d,t.toArrayValue);if(!v)return E;const T=v.length,w=T===1,A=!!a.parts;for(let j=0;j<T;j++){const z=t.details[j],H=t.details[Iye(v,j)],te=mw(z.minW,H==null?void 0:H._minW),K=Kc((N=a[l])==null?void 0:N[v[j]],f);if(K){if(A){(F=a.parts)==null||F.forEach(ne=>{Uh(E,{[ne]:w?K[ne]:{[te]:K[ne]}})});continue}if(!A){w?Uh(E,K):E[te]=K;continue}E[te]=K}}return E}}function Pye(n){return t=>{const{variant:s,size:a,theme:l}=t,d=Aye(l);return Uh({},Kc(n.baseStyle??{},t),d(n,"sizes",a,t),d(n,"variants",s,t))}}function $i(n){return _0(n,["styleConfig","size","variant","colorScheme"])}function oQ(n){return wu(n)&&n.reference?n.reference:String(n)}const Hk=(n,...t)=>t.map(oQ).join(` ${n} `).replace(/calc/g,""),b$=(...n)=>`calc(${Hk("+",...n)})`,w$=(...n)=>`calc(${Hk("-",...n)})`,K2=(...n)=>`calc(${Hk("*",...n)})`,R$=(...n)=>`calc(${Hk("/",...n)})`,C$=n=>{const t=oQ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:K2(t,-1)},of=Object.assign(n=>({add:(...t)=>of(b$(n,...t)),subtract:(...t)=>of(w$(n,...t)),multiply:(...t)=>of(K2(n,...t)),divide:(...t)=>of(R$(n,...t)),negate:()=>of(C$(n)),toString:()=>n.toString()}),{add:b$,subtract:w$,multiply:K2,divide:R$,negate:C$});function Oye(n,t="-"){return n.replace(/\s+/g,t)}function kye(n){const t=Oye(n.toString());return Dye(Nye(t))}function Nye(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function Dye(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Lye(n,t=""){return[t,n].filter(Boolean).join("-")}function xye(n,t){return`var(${n}${t?`, ${t}`:""})`}function Mye(n,t=""){return kye(`--${Lye(n,t)}`)}function Pn(n,t,s){const a=Mye(n,s);return{variable:a,reference:xye(a,t)}}function Uye(n,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=Pn(`${n}-${l}`,d);continue}s[a]=Pn(`${n}-${a}`)}return s}const Vye=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Fye(n){return zJ(n,Vye)}function jye(n){return n.semanticTokens}function Bye(n){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=n;return l}function Wye(n){const t=Fye(n),s=jye(n),a=d=>nQ.includes(d)||d==="default",l={};return _$(t,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),_$(s,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function I$(n,t){return Pn(String(n).replace(/\./g,"-"),void 0,t)}function zye(n){var f;const t=Wye(n),s=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(E,v){const w=[String(E).split(".")[0],v].join(".");if(!t[w])return v;const{reference:N}=I$(w,s);return N}for(const[E,v]of Object.entries(t)){const{isSemantic:T,value:w}=v,{variable:A,reference:N}=I$(E,s);if(!T){if(E.startsWith("space")){const j=E.split("."),[z,...H]=j,te=`${z}.-${H.join(".")}`,K=of.negate(w),ne=of.negate(N);l[te]={value:K,var:A,varRef:ne}}a[A]=w,l[E]={value:w,var:A,varRef:N};continue}const F=wu(w)?w:{default:w};a=Uh(a,Object.entries(F).reduce((j,[z,H])=>{if(!H)return j;const te=d(E,`${H}`);if(z==="default")return j[A]=te,j;const K=(kS==null?void 0:kS[z])??z;return j[K]={[A]:te},j},{})),l[E]={value:N,var:A,varRef:N}}return{cssVars:a,cssMap:l}}function Gye(n){const t=Bye(n),{cssMap:s,cssVars:a}=zye(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:V_e(t.breakpoints)}),t}function Xr(n,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const A of w)t[A]=v(A);return Xr(n,t)}function d(...w){for(const A of w)A in t||(t[A]=v(A));return Xr(n,t)}function f(){return Object.fromEntries(Object.entries(t).map(([A,N])=>[A,N.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([A,N])=>[A,N.className]))}function v(w){const F=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:F,selector:`.${F}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:f,classnames:E,get keys(){return Object.keys(t)},__type:{}}}const Hye=Xr("accordion").parts("root","container","button","panel","icon"),$ye=Xr("alert").parts("title","description","container","icon","spinner"),Kye=Xr("avatar").parts("label","badge","container","excessLabel","group"),qye=Xr("breadcrumb").parts("link","item","container","separator");Xr("button").parts();const Yye=Xr("checkbox").parts("control","icon","container","label");Xr("progress").parts("track","filledTrack","label");const Xye=Xr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Jye=Xr("editable").parts("preview","input","textarea"),Qye=Xr("form").parts("container","requiredIndicator","helperText"),Zye=Xr("formError").parts("text","icon"),eve=Xr("input").parts("addon","field","element","group"),tve=Xr("list").parts("container","item","icon"),nve=Xr("menu").parts("button","list","item","groupTitle","icon","command","divider"),rve=Xr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),ive=Xr("numberinput").parts("root","field","stepperGroup","stepper");Xr("pininput").parts("field");const sve=Xr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),ove=Xr("progress").parts("label","filledTrack","track"),ave=Xr("radio").parts("container","control","label"),cve=Xr("select").parts("field","icon"),lve=Xr("slider").parts("container","track","thumb","filledTrack","mark"),uve=Xr("stat").parts("container","label","helpText","number","icon"),dve=Xr("switch").parts("container","track","thumb","label"),hve=Xr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),pve=Xr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),fve=Xr("tag").parts("container","label","closeButton"),mve=Xr("card").parts("container","header","body","footer");Xr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:gve,defineMultiStyleConfig:_ve}=ki(Hye.keys),Eve={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},yve={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},vve={pt:"2",px:"4",pb:"5"},Sve={fontSize:"1.25em"},Tve=gve({container:Eve,button:yve,panel:vve,icon:Sve}),bve=_ve({baseStyle:Tve});function oE(n,t,s){return Math.min(Math.max(n,s),t)}class wve extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var _w=wve;function AV(n){if(typeof n!="string")throw new _w(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=Nve.test(n)?Ive(n):n;const s=Ave.exec(t);if(s){const f=Array.from(s).slice(1);return[...f.slice(0,3).map(E=>parseInt(rR(E,2),16)),parseInt(rR(f[3]||"f",2),16)/255]}const a=Pve.exec(t);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(E=>parseInt(E,16)),parseInt(f[3]||"ff",16)/255]}const l=Ove.exec(t);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(E=>parseInt(E,10)),parseFloat(f[3]||"1")]}const d=kve.exec(t);if(d){const[f,E,v,T]=Array.from(d).slice(1).map(parseFloat);if(oE(0,100,E)!==E)throw new _w(n);if(oE(0,100,v)!==v)throw new _w(n);return[...Dve(f,E,v),Number.isNaN(T)?1:T]}throw new _w(n)}function Rve(n){let t=5381,s=n.length;for(;s;)t=t*33^n.charCodeAt(--s);return(t>>>0)%2341}const A$=n=>parseInt(n.replace(/_/g,""),36),Cve="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const s=A$(t.substring(0,3)),a=A$(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[s]=`${l}${a}`,n},{});function Ive(n){const t=n.toLowerCase().trim(),s=Cve[Rve(t)];if(!s)throw new _w(n);return`#${s}`}const rR=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),Ave=new RegExp(`^#${rR("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Pve=new RegExp(`^#${rR("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Ove=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${rR(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),kve=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Nve=/^[a-z]+$/i,P$=n=>Math.round(n*255),Dve=(n,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(P$);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),f=d*(1-Math.abs(l%2-1));let E=0,v=0,T=0;l>=0&&l<1?(E=d,v=f):l>=1&&l<2?(E=f,v=d):l>=2&&l<3?(v=d,T=f):l>=3&&l<4?(v=f,T=d):l>=4&&l<5?(E=f,T=d):l>=5&&l<6&&(E=d,T=f);const w=a-d/2,A=E+w,N=v+w,F=T+w;return[A,N,F].map(P$)};function Lve(n,t,s,a){return`rgba(${oE(0,255,n).toFixed()}, ${oE(0,255,t).toFixed()}, ${oE(0,255,s).toFixed()}, ${parseFloat(oE(0,1,a).toFixed(3))})`}function xve(n,t){const[s,a,l,d]=AV(n);return Lve(s,a,l,d-t)}function Mve(n){const[t,s,a,l]=AV(n);let d=f=>{const E=oE(0,255,f).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const Uve=n=>Object.keys(n).length===0;function Vve(n,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)n=n?n[t[a]]:l;return n===l?s:n}const nc=(n,t,s)=>{const a=Vve(n,`colors.${t}`,t);try{return Mve(a),a}catch{return s??"#000000"}},Fve=n=>{const[t,s,a]=AV(n);return(t*299+s*587+a*114)/1e3},jve=n=>t=>{const s=nc(t,n);return Fve(s)<128?"dark":"light"},Bve=n=>t=>jve(n)(t)==="dark",$S=(n,t)=>s=>{const a=nc(s,n);return xve(a,1-t)};function O$(n="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const Wve=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function zve(n){const t=Wve();return!n||Uve(n)?t:n.string&&n.colors?Hve(n.string,n.colors):n.string&&!n.colors?Gve(n.string):n.colors&&!n.string?$ve(n.colors):t}function Gve(n){let t=0;if(n.length===0)return t.toString();for(let a=0;a<n.length;a+=1)t=n.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function Hve(n,t){let s=0;if(n.length===0)return t[0];for(let a=0;a<n.length;a+=1)s=n.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function $ve(n){return n[Math.floor(Math.random()*n.length)]}function An(n,t){return s=>s.colorMode==="dark"?t:n}function PV(n){const{orientation:t,vertical:s,horizontal:a}=n;return t?t==="vertical"?s:a:{}}function aQ(n){return wu(n)&&n.reference?n.reference:String(n)}const $k=(n,...t)=>t.map(aQ).join(` ${n} `).replace(/calc/g,""),k$=(...n)=>`calc(${$k("+",...n)})`,N$=(...n)=>`calc(${$k("-",...n)})`,q2=(...n)=>`calc(${$k("*",...n)})`,D$=(...n)=>`calc(${$k("/",...n)})`,L$=n=>{const t=aQ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:q2(t,-1)},af=Object.assign(n=>({add:(...t)=>af(k$(n,...t)),subtract:(...t)=>af(N$(n,...t)),multiply:(...t)=>af(q2(n,...t)),divide:(...t)=>af(D$(n,...t)),negate:()=>af(L$(n)),toString:()=>n.toString()}),{add:k$,subtract:N$,multiply:q2,divide:D$,negate:L$});function Kve(n){return!Number.isInteger(parseFloat(n.toString()))}function qve(n,t="-"){return n.replace(/\s+/g,t)}function cQ(n){const t=qve(n.toString());return t.includes("\\.")?n:Kve(n)?t.replace(".","\\."):n}function Yve(n,t=""){return[t,cQ(n)].filter(Boolean).join("-")}function Xve(n,t){return`var(${cQ(n)}${t?`, ${t}`:""})`}function Jve(n,t=""){return`--${Yve(n,t)}`}function ao(n,t){const s=Jve(n,t==null?void 0:t.prefix);return{variable:s,reference:Xve(s,Qve(t==null?void 0:t.fallback))}}function Qve(n){return n==null?void 0:n.reference}const{definePartsStyle:kR,defineMultiStyleConfig:Zve}=ki($ye.keys),Il=Pn("alert-fg"),Tf=Pn("alert-bg"),eSe=kR({container:{bg:Tf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Il.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Il.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function OV(n){const{theme:t,colorScheme:s}=n,a=$S(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const tSe=kR(n=>{const{colorScheme:t}=n,s=OV(n);return{container:{[Il.variable]:`colors.${t}.600`,[Tf.variable]:s.light,_dark:{[Il.variable]:`colors.${t}.200`,[Tf.variable]:s.dark}}}}),nSe=kR(n=>{const{colorScheme:t}=n,s=OV(n);return{container:{[Il.variable]:`colors.${t}.600`,[Tf.variable]:s.light,_dark:{[Il.variable]:`colors.${t}.200`,[Tf.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Il.reference}}}),rSe=kR(n=>{const{colorScheme:t}=n,s=OV(n);return{container:{[Il.variable]:`colors.${t}.600`,[Tf.variable]:s.light,_dark:{[Il.variable]:`colors.${t}.200`,[Tf.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Il.reference}}}),iSe=kR(n=>{const{colorScheme:t}=n;return{container:{[Il.variable]:"colors.white",[Tf.variable]:`colors.${t}.600`,_dark:{[Il.variable]:"colors.gray.900",[Tf.variable]:`colors.${t}.200`},color:Il.reference}}}),sSe={subtle:tSe,"left-accent":nSe,"top-accent":rSe,solid:iSe},oSe=Zve({baseStyle:eSe,variants:sSe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),lQ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},aSe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},cSe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},uQ={...lQ,...aSe,container:cSe},lSe=n=>typeof n=="function";function rc(n,...t){return lSe(n)?n(...t):n}const{definePartsStyle:dQ,defineMultiStyleConfig:uSe}=ki(Kye.keys),NS=Pn("avatar-border-color"),Lw=Pn("avatar-bg"),iR=Pn("avatar-font-size"),KS=Pn("avatar-size"),dSe={borderRadius:"full",border:"0.2em solid",borderColor:NS.reference,[NS.variable]:"white",_dark:{[NS.variable]:"colors.gray.800"}},hSe={bg:Lw.reference,fontSize:iR.reference,width:KS.reference,height:KS.reference,lineHeight:"1",[Lw.variable]:"colors.gray.200",_dark:{[Lw.variable]:"colors.whiteAlpha.400"}},pSe=n=>{const{name:t,theme:s}=n,a=t?zve({string:t}):"colors.gray.400",l=Bve(a)(s);let d="white";return l||(d="gray.800"),{bg:Lw.reference,fontSize:iR.reference,color:d,borderColor:NS.reference,verticalAlign:"top",width:KS.reference,height:KS.reference,"&:not([data-loaded])":{[Lw.variable]:a},[NS.variable]:"colors.white",_dark:{[NS.variable]:"colors.gray.800"}}},fSe={fontSize:iR.reference,lineHeight:"1"},mSe=dQ(n=>({badge:rc(dSe,n),excessLabel:rc(hSe,n),container:rc(pSe,n),label:fSe}));function Wm(n){const t=n!=="100%"?uQ[n]:void 0;return dQ({container:{[KS.variable]:t??n,[iR.variable]:`calc(${t??n} / 2.5)`},excessLabel:{[KS.variable]:t??n,[iR.variable]:`calc(${t??n} / 2.5)`}})}const gSe={"2xs":Wm(4),xs:Wm(6),sm:Wm(8),md:Wm(12),lg:Wm(16),xl:Wm(24),"2xl":Wm(32),full:Wm("100%")},_Se=uSe({baseStyle:mSe,sizes:gSe,defaultProps:{size:"md"}}),xs=Uye("badge",["bg","color","shadow"]),ESe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:xs.bg.reference,color:xs.color.reference,boxShadow:xs.shadow.reference},ySe=n=>{const{colorScheme:t,theme:s}=n,a=$S(`${t}.500`,.6)(s);return{[xs.bg.variable]:`colors.${t}.500`,[xs.color.variable]:"colors.white",_dark:{[xs.bg.variable]:a,[xs.color.variable]:"colors.whiteAlpha.800"}}},vSe=n=>{const{colorScheme:t,theme:s}=n,a=$S(`${t}.200`,.16)(s);return{[xs.bg.variable]:`colors.${t}.100`,[xs.color.variable]:`colors.${t}.800`,_dark:{[xs.bg.variable]:a,[xs.color.variable]:`colors.${t}.200`}}},SSe=n=>{const{colorScheme:t,theme:s}=n,a=$S(`${t}.200`,.8)(s);return{[xs.color.variable]:`colors.${t}.500`,_dark:{[xs.color.variable]:a},[xs.shadow.variable]:`inset 0 0 0px 1px ${xs.color.reference}`}},TSe={solid:ySe,subtle:vSe,outline:SSe},xw={baseStyle:ESe,variants:TSe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:bSe,definePartsStyle:wSe}=ki(qye.keys),RM=Pn("breadcrumb-link-decor"),RSe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:RM.reference,[RM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[RM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},CSe=wSe({link:RSe}),ISe=bSe({baseStyle:CSe}),ASe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},hQ=n=>{const{colorScheme:t,theme:s}=n;if(t==="gray")return{color:An("gray.800","whiteAlpha.900")(n),_hover:{bg:An("gray.100","whiteAlpha.200")(n)},_active:{bg:An("gray.200","whiteAlpha.300")(n)}};const a=$S(`${t}.200`,.12)(s),l=$S(`${t}.200`,.24)(s);return{color:An(`${t}.600`,`${t}.200`)(n),bg:"transparent",_hover:{bg:An(`${t}.50`,a)(n)},_active:{bg:An(`${t}.100`,l)(n)}}},PSe=n=>{const{colorScheme:t}=n,s=An("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...rc(hQ,n)}},OSe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},kSe=n=>{const{colorScheme:t}=n;if(t==="gray"){const E=An("gray.100","whiteAlpha.200")(n);return{bg:E,color:An("gray.800","whiteAlpha.900")(n),_hover:{bg:An("gray.200","whiteAlpha.300")(n),_disabled:{bg:E}},_active:{bg:An("gray.300","whiteAlpha.400")(n)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=OSe[t]??{},f=An(s,`${t}.200`)(n);return{bg:f,color:An(a,"gray.800")(n),_hover:{bg:An(l,`${t}.300`)(n),_disabled:{bg:f}},_active:{bg:An(d,`${t}.400`)(n)}}},NSe=n=>{const{colorScheme:t}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:An(`${t}.500`,`${t}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:An(`${t}.700`,`${t}.500`)(n)}}},DSe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},LSe={ghost:hQ,outline:PSe,solid:kSe,link:NSe,unstyled:DSe},xSe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},MSe={baseStyle:ASe,variants:LSe,sizes:xSe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:uE,defineMultiStyleConfig:USe}=ki(mve.keys),rk=Pn("card-bg"),gf=Pn("card-padding"),pQ=Pn("card-shadow"),TO=Pn("card-radius"),fQ=Pn("card-border-width","0"),mQ=Pn("card-border-color"),VSe=uE({container:{[rk.variable]:"colors.chakra-body-bg",backgroundColor:rk.reference,boxShadow:pQ.reference,borderRadius:TO.reference,color:"chakra-body-text",borderWidth:fQ.reference,borderColor:mQ.reference},body:{padding:gf.reference,flex:"1 1 0%"},header:{padding:gf.reference},footer:{padding:gf.reference}}),FSe={sm:uE({container:{[TO.variable]:"radii.base",[gf.variable]:"space.3"}}),md:uE({container:{[TO.variable]:"radii.md",[gf.variable]:"space.5"}}),lg:uE({container:{[TO.variable]:"radii.xl",[gf.variable]:"space.7"}})},jSe={elevated:uE({container:{[pQ.variable]:"shadows.base",_dark:{[rk.variable]:"colors.gray.700"}}}),outline:uE({container:{[fQ.variable]:"1px",[mQ.variable]:"colors.chakra-border-color"}}),filled:uE({container:{[rk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[gf.variable]:0},header:{[gf.variable]:0},footer:{[gf.variable]:0}}},BSe=USe({baseStyle:VSe,variants:jSe,sizes:FSe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:bO,defineMultiStyleConfig:WSe}=ki(Yye.keys),Mw=Pn("checkbox-size"),zSe=n=>{const{colorScheme:t}=n;return{w:Mw.reference,h:Mw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:An(`${t}.500`,`${t}.200`)(n),borderColor:An(`${t}.500`,`${t}.200`)(n),color:An("white","gray.900")(n),_hover:{bg:An(`${t}.600`,`${t}.300`)(n),borderColor:An(`${t}.600`,`${t}.300`)(n)},_disabled:{borderColor:An("gray.200","transparent")(n),bg:An("gray.200","whiteAlpha.300")(n),color:An("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:An(`${t}.500`,`${t}.200`)(n),borderColor:An(`${t}.500`,`${t}.200`)(n),color:An("white","gray.900")(n)},_disabled:{bg:An("gray.100","whiteAlpha.100")(n),borderColor:An("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:An("red.500","red.300")(n)}}},GSe={_disabled:{cursor:"not-allowed"}},HSe={userSelect:"none",_disabled:{opacity:.4}},$Se={transitionProperty:"transform",transitionDuration:"normal"},KSe=bO(n=>({icon:$Se,container:GSe,control:rc(zSe,n),label:HSe})),qSe={sm:bO({control:{[Mw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:bO({control:{[Mw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:bO({control:{[Mw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},Km=WSe({baseStyle:KSe,sizes:qSe,defaultProps:{size:"md",colorScheme:"blue"}}),Uw=ao("close-button-size"),Xb=ao("close-button-bg"),YSe={w:[Uw.reference],h:[Uw.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[Xb.variable]:"colors.blackAlpha.100",_dark:{[Xb.variable]:"colors.whiteAlpha.100"}},_active:{[Xb.variable]:"colors.blackAlpha.200",_dark:{[Xb.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:Xb.reference},XSe={lg:{[Uw.variable]:"sizes.10",fontSize:"md"},md:{[Uw.variable]:"sizes.8",fontSize:"xs"},sm:{[Uw.variable]:"sizes.6",fontSize:"2xs"}},JSe={baseStyle:YSe,sizes:XSe,defaultProps:{size:"md"}},{variants:QSe,defaultProps:ZSe}=xw,e0e={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:xs.bg.reference,color:xs.color.reference,boxShadow:xs.shadow.reference},t0e={baseStyle:e0e,variants:QSe,defaultProps:ZSe},n0e={w:"100%",mx:"auto",maxW:"prose",px:"4"},r0e={baseStyle:n0e},i0e={opacity:.6,borderColor:"inherit"},s0e={borderStyle:"solid"},o0e={borderStyle:"dashed"},a0e={solid:s0e,dashed:o0e},c0e={baseStyle:i0e,variants:a0e,defaultProps:{variant:"solid"}},{definePartsStyle:Y2,defineMultiStyleConfig:l0e}=ki(Xye.keys),CM=Pn("drawer-bg"),IM=Pn("drawer-box-shadow");function tS(n){return Y2(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const u0e={bg:"blackAlpha.600",zIndex:"modal"},d0e={display:"flex",zIndex:"modal",justifyContent:"center"},h0e=n=>{const{isFullHeight:t}=n;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[CM.variable]:"colors.white",[IM.variable]:"shadows.lg",_dark:{[CM.variable]:"colors.gray.700",[IM.variable]:"shadows.dark-lg"},bg:CM.reference,boxShadow:IM.reference}},p0e={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},f0e={position:"absolute",top:"2",insetEnd:"3"},m0e={px:"6",py:"2",flex:"1",overflow:"auto"},g0e={px:"6",py:"4"},_0e=Y2(n=>({overlay:u0e,dialogContainer:d0e,dialog:rc(h0e,n),header:p0e,closeButton:f0e,body:m0e,footer:g0e})),E0e={xs:tS("xs"),sm:tS("md"),md:tS("lg"),lg:tS("2xl"),xl:tS("4xl"),full:tS("full")},y0e=l0e({baseStyle:_0e,sizes:E0e,defaultProps:{size:"xs"}}),{definePartsStyle:v0e,defineMultiStyleConfig:S0e}=ki(Jye.keys),T0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},b0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},w0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},R0e=v0e({preview:T0e,input:b0e,textarea:w0e}),C0e=S0e({baseStyle:R0e}),{definePartsStyle:I0e,defineMultiStyleConfig:A0e}=ki(Qye.keys),DS=Pn("form-control-color"),P0e={marginStart:"1",[DS.variable]:"colors.red.500",_dark:{[DS.variable]:"colors.red.300"},color:DS.reference},O0e={mt:"2",[DS.variable]:"colors.gray.600",_dark:{[DS.variable]:"colors.whiteAlpha.600"},color:DS.reference,lineHeight:"normal",fontSize:"sm"},k0e=I0e({container:{width:"100%",position:"relative"},requiredIndicator:P0e,helperText:O0e}),N0e=A0e({baseStyle:k0e}),{definePartsStyle:D0e,defineMultiStyleConfig:L0e}=ki(Zye.keys),LS=Pn("form-error-color"),x0e={[LS.variable]:"colors.red.500",_dark:{[LS.variable]:"colors.red.300"},color:LS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},M0e={marginEnd:"0.5em",[LS.variable]:"colors.red.500",_dark:{[LS.variable]:"colors.red.300"},color:LS.reference},U0e=D0e({text:x0e,icon:M0e}),V0e=L0e({baseStyle:U0e}),F0e={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},j0e={baseStyle:F0e},B0e={fontFamily:"heading",fontWeight:"bold"},W0e={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},z0e={baseStyle:B0e,sizes:W0e,defaultProps:{size:"xl"}},{definePartsStyle:lf,defineMultiStyleConfig:G0e}=ki(eve.keys),mS=Pn("input-height"),gS=Pn("input-font-size"),_S=Pn("input-padding"),ES=Pn("input-border-radius"),H0e=lf({addon:{height:mS.reference,fontSize:gS.reference,px:_S.reference,borderRadius:ES.reference},field:{width:"100%",height:mS.reference,fontSize:gS.reference,px:_S.reference,borderRadius:ES.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),zm={lg:{[gS.variable]:"fontSizes.lg",[_S.variable]:"space.4",[ES.variable]:"radii.md",[mS.variable]:"sizes.12"},md:{[gS.variable]:"fontSizes.md",[_S.variable]:"space.4",[ES.variable]:"radii.md",[mS.variable]:"sizes.10"},sm:{[gS.variable]:"fontSizes.sm",[_S.variable]:"space.3",[ES.variable]:"radii.sm",[mS.variable]:"sizes.8"},xs:{[gS.variable]:"fontSizes.xs",[_S.variable]:"space.2",[ES.variable]:"radii.sm",[mS.variable]:"sizes.6"}},$0e={lg:lf({field:zm.lg,group:zm.lg}),md:lf({field:zm.md,group:zm.md}),sm:lf({field:zm.sm,group:zm.sm}),xs:lf({field:zm.xs,group:zm.xs})};function kV(n){const{focusBorderColor:t,errorBorderColor:s}=n;return{focusBorderColor:t||An("blue.500","blue.300")(n),errorBorderColor:s||An("red.500","red.300")(n)}}const K0e=lf(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=kV(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:An("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:nc(t,a),boxShadow:`0 0 0 1px ${nc(t,a)}`},_focusVisible:{zIndex:1,borderColor:nc(t,s),boxShadow:`0 0 0 1px ${nc(t,s)}`}},addon:{border:"1px solid",borderColor:An("inherit","whiteAlpha.50")(n),bg:An("gray.100","whiteAlpha.300")(n)}}}),q0e=lf(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=kV(n);return{field:{border:"2px solid",borderColor:"transparent",bg:An("gray.100","whiteAlpha.50")(n),_hover:{bg:An("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:nc(t,a)},_focusVisible:{bg:"transparent",borderColor:nc(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:An("gray.100","whiteAlpha.50")(n)}}}),Y0e=lf(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=kV(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:nc(t,a),boxShadow:`0px 1px 0px 0px ${nc(t,a)}`},_focusVisible:{borderColor:nc(t,s),boxShadow:`0px 1px 0px 0px ${nc(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),X0e=lf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),J0e={outline:K0e,filled:q0e,flushed:Y0e,unstyled:X0e},Yr=G0e({baseStyle:H0e,sizes:$0e,variants:J0e,defaultProps:{size:"md",variant:"outline"}}),AM=Pn("kbd-bg"),Q0e={[AM.variable]:"colors.gray.100",_dark:{[AM.variable]:"colors.whiteAlpha.100"},bg:AM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},Z0e={baseStyle:Q0e},eTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},tTe={baseStyle:eTe},{defineMultiStyleConfig:nTe,definePartsStyle:rTe}=ki(tve.keys),iTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},sTe=rTe({icon:iTe}),oTe=nTe({baseStyle:sTe}),{defineMultiStyleConfig:aTe,definePartsStyle:cTe}=ki(nve.keys),Ph=Pn("menu-bg"),PM=Pn("menu-shadow"),lTe={[Ph.variable]:"#fff",[PM.variable]:"shadows.sm",_dark:{[Ph.variable]:"colors.gray.700",[PM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Ph.reference,boxShadow:PM.reference},uTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Ph.variable]:"colors.gray.100",_dark:{[Ph.variable]:"colors.whiteAlpha.100"}},_active:{[Ph.variable]:"colors.gray.200",_dark:{[Ph.variable]:"colors.whiteAlpha.200"}},_expanded:{[Ph.variable]:"colors.gray.100",_dark:{[Ph.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Ph.reference},dTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},hTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},pTe={opacity:.6},fTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},mTe={transitionProperty:"common",transitionDuration:"normal"},gTe=cTe({button:mTe,list:lTe,item:uTe,groupTitle:dTe,icon:hTe,command:pTe,divider:fTe}),_Te=aTe({baseStyle:gTe}),{defineMultiStyleConfig:ETe,definePartsStyle:X2}=ki(rve.keys),OM=Pn("modal-bg"),kM=Pn("modal-shadow"),yTe={bg:"blackAlpha.600",zIndex:"modal"},vTe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},STe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[OM.variable]:"colors.white",[kM.variable]:"shadows.lg",_dark:{[OM.variable]:"colors.gray.700",[kM.variable]:"shadows.dark-lg"},bg:OM.reference,boxShadow:kM.reference}},TTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},bTe={position:"absolute",top:"2",insetEnd:"3"},wTe=n=>{const{scrollBehavior:t}=n;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},RTe={px:"6",py:"4"},CTe=X2(n=>({overlay:yTe,dialogContainer:rc(vTe,n),dialog:rc(STe,n),header:TTe,closeButton:bTe,body:rc(wTe,n),footer:RTe}));function Sd(n){return X2(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const ITe={xs:Sd("xs"),sm:Sd("sm"),md:Sd("md"),lg:Sd("lg"),xl:Sd("xl"),"2xl":Sd("2xl"),"3xl":Sd("3xl"),"4xl":Sd("4xl"),"5xl":Sd("5xl"),"6xl":Sd("6xl"),full:Sd("full")},ATe=ETe({baseStyle:CTe,sizes:ITe,defaultProps:{size:"md"}}),gQ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:PTe,definePartsStyle:_Q}=ki(ive.keys),NV=ao("number-input-stepper-width"),EQ=ao("number-input-input-padding"),OTe=af(NV).add("0.5rem").toString(),NM=ao("number-input-bg"),DM=ao("number-input-color"),LM=ao("number-input-border-color"),kTe={[NV.variable]:"sizes.6",[EQ.variable]:OTe},NTe=n=>{var t;return((t=rc(Yr.baseStyle,n))==null?void 0:t.field)??{}},DTe={width:NV.reference},LTe={borderStart:"1px solid",borderStartColor:LM.reference,color:DM.reference,bg:NM.reference,[DM.variable]:"colors.chakra-body-text",[LM.variable]:"colors.chakra-border-color",_dark:{[DM.variable]:"colors.whiteAlpha.800",[LM.variable]:"colors.whiteAlpha.300"},_active:{[NM.variable]:"colors.gray.200",_dark:{[NM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},xTe=_Q(n=>({root:kTe,field:rc(NTe,n)??{},stepperGroup:DTe,stepper:LTe}));function $P(n){var d,f;const t=(d=Yr.sizes)==null?void 0:d[n],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=t.field)==null?void 0:f.fontSize)??"md",l=gQ.fontSizes[a];return _Q({field:{...t.field,paddingInlineEnd:EQ.reference,verticalAlign:"top"},stepper:{fontSize:af(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[n]},_last:{borderBottomEndRadius:s[n],mt:"-1px",borderTopWidth:1}}})}const MTe={xs:$P("xs"),sm:$P("sm"),md:$P("md"),lg:$P("lg")},UTe=PTe({baseStyle:xTe,sizes:MTe,variants:Yr.variants,defaultProps:Yr.defaultProps});var gJ;const VTe={...(gJ=Yr.baseStyle)==null?void 0:gJ.field,textAlign:"center"},FTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var _J;const jTe={outline:n=>{var t,s;return((s=rc((t=Yr.variants)==null?void 0:t.outline,n))==null?void 0:s.field)??{}},flushed:n=>{var t,s;return((s=rc((t=Yr.variants)==null?void 0:t.flushed,n))==null?void 0:s.field)??{}},filled:n=>{var t,s;return((s=rc((t=Yr.variants)==null?void 0:t.filled,n))==null?void 0:s.field)??{}},unstyled:((_J=Yr.variants)==null?void 0:_J.unstyled.field)??{}},BTe={baseStyle:VTe,sizes:FTe,variants:jTe,defaultProps:Yr.defaultProps},{defineMultiStyleConfig:WTe,definePartsStyle:zTe}=ki(sve.keys),KP=ao("popper-bg"),GTe=ao("popper-arrow-bg"),x$=ao("popper-arrow-shadow-color"),HTe={zIndex:"popover"},$Te={[KP.variable]:"colors.white",bg:KP.reference,[GTe.variable]:KP.reference,[x$.variable]:"colors.gray.200",_dark:{[KP.variable]:"colors.gray.700",[x$.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},KTe={px:3,py:2,borderBottomWidth:"1px"},qTe={px:3,py:2},YTe={px:3,py:2,borderTopWidth:"1px"},XTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},JTe=zTe({popper:HTe,content:$Te,header:KTe,body:qTe,footer:YTe,closeButton:XTe}),QTe=WTe({baseStyle:JTe}),{defineMultiStyleConfig:ZTe,definePartsStyle:Ew}=ki(ove.keys),ebe=n=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=n,d=An(O$(),O$("1rem","rgba(0,0,0,0.1)"))(n),f=An(`${t}.500`,`${t}.200`)(n),E=`linear-gradient(
    to right,
    transparent 0%,
    ${nc(s,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:f}}},tbe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},nbe=n=>({bg:An("gray.100","whiteAlpha.300")(n)}),rbe=n=>({transitionProperty:"common",transitionDuration:"slow",...ebe(n)}),ibe=Ew(n=>({label:tbe,filledTrack:rbe(n),track:nbe(n)})),sbe={xs:Ew({track:{h:"1"}}),sm:Ew({track:{h:"2"}}),md:Ew({track:{h:"3"}}),lg:Ew({track:{h:"4"}})},obe=ZTe({sizes:sbe,baseStyle:ibe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:abe,definePartsStyle:wO}=ki(ave.keys),cbe=n=>{var s;const t=(s=rc(Km.baseStyle,n))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},lbe=wO(n=>{var t,s;return{label:(t=Km.baseStyle)==null?void 0:t.call(Km,n).label,container:(s=Km.baseStyle)==null?void 0:s.call(Km,n).container,control:cbe(n)}}),ube={md:wO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:wO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:wO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},dbe=abe({baseStyle:lbe,sizes:ube,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:hbe,definePartsStyle:pbe}=ki(cve.keys),qP=Pn("select-bg");var EJ;const fbe={...(EJ=Yr.baseStyle)==null?void 0:EJ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:qP.reference,[qP.variable]:"colors.white",_dark:{[qP.variable]:"colors.gray.700"},"> option, > optgroup":{bg:qP.reference}},mbe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},gbe=pbe({field:fbe,icon:mbe}),YP={paddingInlineEnd:"8"};var yJ,vJ,SJ,TJ,bJ,wJ,RJ,CJ;const _be={lg:{...(yJ=Yr.sizes)==null?void 0:yJ.lg,field:{...(vJ=Yr.sizes)==null?void 0:vJ.lg.field,...YP}},md:{...(SJ=Yr.sizes)==null?void 0:SJ.md,field:{...(TJ=Yr.sizes)==null?void 0:TJ.md.field,...YP}},sm:{...(bJ=Yr.sizes)==null?void 0:bJ.sm,field:{...(wJ=Yr.sizes)==null?void 0:wJ.sm.field,...YP}},xs:{...(RJ=Yr.sizes)==null?void 0:RJ.xs,field:{...(CJ=Yr.sizes)==null?void 0:CJ.xs.field,...YP},icon:{insetEnd:"1"}}},Ebe=hbe({baseStyle:gbe,sizes:_be,variants:Yr.variants,defaultProps:Yr.defaultProps}),xM=Pn("skeleton-start-color"),MM=Pn("skeleton-end-color"),ybe={[xM.variable]:"colors.gray.100",[MM.variable]:"colors.gray.400",_dark:{[xM.variable]:"colors.gray.800",[MM.variable]:"colors.gray.600"},background:xM.reference,borderColor:MM.reference,opacity:.7,borderRadius:"sm"},vbe={baseStyle:ybe},UM=Pn("skip-link-bg"),Sbe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[UM.variable]:"colors.white",_dark:{[UM.variable]:"colors.gray.700"},bg:UM.reference}},Tbe={baseStyle:Sbe},{defineMultiStyleConfig:bbe,definePartsStyle:Kk}=ki(lve.keys),vE=Pn("slider-thumb-size"),sR=Pn("slider-track-size"),qm=Pn("slider-bg"),wbe=n=>{const{orientation:t}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...PV({orientation:t,vertical:{h:"100%",px:of(vE.reference).divide(2).toString()},horizontal:{w:"100%",py:of(vE.reference).divide(2).toString()}})}},Rbe=n=>({...PV({orientation:n.orientation,horizontal:{h:sR.reference},vertical:{w:sR.reference}}),overflow:"hidden",borderRadius:"sm",[qm.variable]:"colors.gray.200",_dark:{[qm.variable]:"colors.whiteAlpha.200"},_disabled:{[qm.variable]:"colors.gray.300",_dark:{[qm.variable]:"colors.whiteAlpha.300"}},bg:qm.reference}),Cbe=n=>{const{orientation:t}=n;return{...PV({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:vE.reference,h:vE.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},Ibe=n=>{const{colorScheme:t}=n;return{width:"inherit",height:"inherit",[qm.variable]:`colors.${t}.500`,_dark:{[qm.variable]:`colors.${t}.200`},bg:qm.reference}},Abe=Kk(n=>({container:wbe(n),track:Rbe(n),thumb:Cbe(n),filledTrack:Ibe(n)})),Pbe=Kk({container:{[vE.variable]:"sizes.4",[sR.variable]:"sizes.1"}}),Obe=Kk({container:{[vE.variable]:"sizes.3.5",[sR.variable]:"sizes.1"}}),kbe=Kk({container:{[vE.variable]:"sizes.2.5",[sR.variable]:"sizes.0.5"}}),Nbe={lg:Pbe,md:Obe,sm:kbe},Dbe=bbe({baseStyle:Abe,sizes:Nbe,defaultProps:{size:"md",colorScheme:"blue"}}),iE=ao("spinner-size"),Lbe={width:[iE.reference],height:[iE.reference]},xbe={xs:{[iE.variable]:"sizes.3"},sm:{[iE.variable]:"sizes.4"},md:{[iE.variable]:"sizes.6"},lg:{[iE.variable]:"sizes.8"},xl:{[iE.variable]:"sizes.12"}},Mbe={baseStyle:Lbe,sizes:xbe,defaultProps:{size:"md"}},{defineMultiStyleConfig:Ube,definePartsStyle:yQ}=ki(uve.keys),Vbe={fontWeight:"medium"},Fbe={opacity:.8,marginBottom:"2"},jbe={verticalAlign:"baseline",fontWeight:"semibold"},Bbe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},Wbe=yQ({container:{},label:Vbe,helpText:Fbe,number:jbe,icon:Bbe}),zbe={md:yQ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},Gbe=Ube({baseStyle:Wbe,sizes:zbe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:Hbe,definePartsStyle:yw}=ki(["stepper","step","title","description","indicator","separator","icon","number"]),cf=Pn("stepper-indicator-size"),yS=Pn("stepper-icon-size"),vS=Pn("stepper-title-font-size"),vw=Pn("stepper-description-font-size"),Jb=Pn("stepper-accent-color"),$be=yw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[Jb.variable]:`colors.${n}.500`,_dark:{[Jb.variable]:`colors.${n}.200`}},title:{fontSize:vS.reference,fontWeight:"medium"},description:{fontSize:vw.reference,color:"chakra-subtle-text"},number:{fontSize:vS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:yS.reference,height:yS.reference},indicator:{flexShrink:0,borderRadius:"full",width:cf.reference,height:cf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:Jb.reference},"&[data-status=complete]":{bg:Jb.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:Jb.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${cf.reference} - 8px)`,top:`calc(${cf.reference} + 4px)`,insetStart:`calc(${cf.reference} / 2 - 1px)`}}})),Kbe=Hbe({baseStyle:$be,sizes:{xs:yw({stepper:{[cf.variable]:"sizes.4",[yS.variable]:"sizes.3",[vS.variable]:"fontSizes.xs",[vw.variable]:"fontSizes.xs"}}),sm:yw({stepper:{[cf.variable]:"sizes.6",[yS.variable]:"sizes.4",[vS.variable]:"fontSizes.sm",[vw.variable]:"fontSizes.xs"}}),md:yw({stepper:{[cf.variable]:"sizes.8",[yS.variable]:"sizes.5",[vS.variable]:"fontSizes.md",[vw.variable]:"fontSizes.sm"}}),lg:yw({stepper:{[cf.variable]:"sizes.10",[yS.variable]:"sizes.6",[vS.variable]:"fontSizes.lg",[vw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:qbe,definePartsStyle:RO}=ki(dve.keys),Vw=ao("switch-track-width"),dE=ao("switch-track-height"),VM=ao("switch-track-diff"),Ybe=af.subtract(Vw,dE),J2=ao("switch-thumb-x"),Qb=ao("switch-bg"),Xbe=n=>{const{colorScheme:t}=n;return{borderRadius:"full",p:"0.5",width:[Vw.reference],height:[dE.reference],transitionProperty:"common",transitionDuration:"fast",[Qb.variable]:"colors.gray.300",_dark:{[Qb.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Qb.variable]:`colors.${t}.500`,_dark:{[Qb.variable]:`colors.${t}.200`}},bg:Qb.reference}},Jbe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[dE.reference],height:[dE.reference],_checked:{transform:`translateX(${J2.reference})`}},Qbe=RO(n=>({container:{[VM.variable]:Ybe,[J2.variable]:VM.reference,_rtl:{[J2.variable]:af(VM).negate().toString()}},track:Xbe(n),thumb:Jbe})),Zbe={sm:RO({container:{[Vw.variable]:"1.375rem",[dE.variable]:"sizes.3"}}),md:RO({container:{[Vw.variable]:"1.875rem",[dE.variable]:"sizes.4"}}),lg:RO({container:{[Vw.variable]:"2.875rem",[dE.variable]:"sizes.6"}})},ewe=qbe({baseStyle:Qbe,sizes:Zbe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:twe,definePartsStyle:xS}=ki(hve.keys),nwe=xS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),ik={"&[data-is-numeric=true]":{textAlign:"end"}},rwe=xS(n=>{const{colorScheme:t}=n;return{th:{color:An("gray.600","gray.400")(n),borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n),...ik},td:{borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n),...ik},caption:{color:An("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),iwe=xS(n=>{const{colorScheme:t}=n;return{th:{color:An("gray.600","gray.400")(n),borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n),...ik},td:{borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n),...ik},caption:{color:An("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n)},td:{background:An(`${t}.100`,`${t}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),swe={simple:rwe,striped:iwe,unstyled:{}},owe={sm:xS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:xS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:xS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},awe=twe({baseStyle:nwe,variants:swe,sizes:owe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Gc=Pn("tabs-color"),wd=Pn("tabs-bg"),XP=Pn("tabs-border-color"),{defineMultiStyleConfig:cwe,definePartsStyle:Bh}=ki(pve.keys),lwe=n=>{const{orientation:t}=n;return{display:t==="vertical"?"flex":"block"}},uwe=n=>{const{isFitted:t}=n;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},dwe=n=>{const{align:t="start",orientation:s}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},hwe={p:4},pwe=Bh(n=>({root:lwe(n),tab:uwe(n),tablist:dwe(n),tabpanel:hwe})),fwe={sm:Bh({tab:{py:1,px:4,fontSize:"sm"}}),md:Bh({tab:{fontSize:"md",py:2,px:4}}),lg:Bh({tab:{fontSize:"lg",py:3,px:4}})},mwe=Bh(n=>{const{colorScheme:t,orientation:s}=n,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Gc.variable]:`colors.${t}.600`,_dark:{[Gc.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[wd.variable]:"colors.gray.200",_dark:{[wd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Gc.reference,bg:wd.reference}}}),gwe=Bh(n=>{const{colorScheme:t}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[XP.variable]:"transparent",_selected:{[Gc.variable]:`colors.${t}.600`,[XP.variable]:"colors.white",_dark:{[Gc.variable]:`colors.${t}.300`,[XP.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:XP.reference},color:Gc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),_we=Bh(n=>{const{colorScheme:t}=n;return{tab:{border:"1px solid",borderColor:"inherit",[wd.variable]:"colors.gray.50",_dark:{[wd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[wd.variable]:"colors.white",[Gc.variable]:`colors.${t}.600`,_dark:{[wd.variable]:"colors.gray.800",[Gc.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Gc.reference,bg:wd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Ewe=Bh(n=>{const{colorScheme:t,theme:s}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:nc(s,`${t}.700`),bg:nc(s,`${t}.100`)}}}}),ywe=Bh(n=>{const{colorScheme:t}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[Gc.variable]:"colors.gray.600",_dark:{[Gc.variable]:"inherit"},_selected:{[Gc.variable]:"colors.white",[wd.variable]:`colors.${t}.600`,_dark:{[Gc.variable]:"colors.gray.800",[wd.variable]:`colors.${t}.300`}},color:Gc.reference,bg:wd.reference}}}),vwe=Bh({}),Swe={line:mwe,enclosed:gwe,"enclosed-colored":_we,"soft-rounded":Ewe,"solid-rounded":ywe,unstyled:vwe},Twe=cwe({baseStyle:pwe,sizes:fwe,variants:Swe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:bwe,definePartsStyle:hE}=ki(fve.keys),M$=Pn("tag-bg"),U$=Pn("tag-color"),FM=Pn("tag-shadow"),CO=Pn("tag-min-height"),IO=Pn("tag-min-width"),AO=Pn("tag-font-size"),PO=Pn("tag-padding-inline"),wwe={fontWeight:"medium",lineHeight:1.2,outline:0,[U$.variable]:xs.color.reference,[M$.variable]:xs.bg.reference,[FM.variable]:xs.shadow.reference,color:U$.reference,bg:M$.reference,boxShadow:FM.reference,borderRadius:"md",minH:CO.reference,minW:IO.reference,fontSize:AO.reference,px:PO.reference,_focusVisible:{[FM.variable]:"shadows.outline"}},Rwe={lineHeight:1.2,overflow:"visible"},Cwe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},Iwe=hE({container:wwe,label:Rwe,closeButton:Cwe}),Awe={sm:hE({container:{[CO.variable]:"sizes.5",[IO.variable]:"sizes.5",[AO.variable]:"fontSizes.xs",[PO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:hE({container:{[CO.variable]:"sizes.6",[IO.variable]:"sizes.6",[AO.variable]:"fontSizes.sm",[PO.variable]:"space.2"}}),lg:hE({container:{[CO.variable]:"sizes.8",[IO.variable]:"sizes.8",[AO.variable]:"fontSizes.md",[PO.variable]:"space.3"}})},Pwe={subtle:hE(n=>{var t;return{container:(t=xw.variants)==null?void 0:t.subtle(n)}}),solid:hE(n=>{var t;return{container:(t=xw.variants)==null?void 0:t.solid(n)}}),outline:hE(n=>{var t;return{container:(t=xw.variants)==null?void 0:t.outline(n)}})},Owe=bwe({variants:Pwe,baseStyle:Iwe,sizes:Awe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var IJ;const kwe={...(IJ=Yr.baseStyle)==null?void 0:IJ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var AJ;const Nwe={outline:n=>{var t;return((t=Yr.variants)==null?void 0:t.outline(n).field)??{}},flushed:n=>{var t;return((t=Yr.variants)==null?void 0:t.flushed(n).field)??{}},filled:n=>{var t;return((t=Yr.variants)==null?void 0:t.filled(n).field)??{}},unstyled:((AJ=Yr.variants)==null?void 0:AJ.unstyled.field)??{}};var PJ,OJ,kJ,NJ;const Dwe={xs:((PJ=Yr.sizes)==null?void 0:PJ.xs.field)??{},sm:((OJ=Yr.sizes)==null?void 0:OJ.sm.field)??{},md:((kJ=Yr.sizes)==null?void 0:kJ.md.field)??{},lg:((NJ=Yr.sizes)==null?void 0:NJ.lg.field)??{}},Lwe={baseStyle:kwe,sizes:Dwe,variants:Nwe,defaultProps:{size:"md",variant:"outline"}},JP=ao("tooltip-bg"),jM=ao("tooltip-fg"),xwe=ao("popper-arrow-bg"),Mwe={bg:JP.reference,color:jM.reference,[JP.variable]:"colors.gray.700",[jM.variable]:"colors.whiteAlpha.900",_dark:{[JP.variable]:"colors.gray.300",[jM.variable]:"colors.gray.900"},[xwe.variable]:JP.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},Uwe={baseStyle:Mwe},Vwe={Accordion:bve,Alert:oSe,Avatar:_Se,Badge:xw,Breadcrumb:ISe,Button:MSe,Checkbox:Km,CloseButton:JSe,Code:t0e,Container:r0e,Divider:c0e,Drawer:y0e,Editable:C0e,Form:N0e,FormError:V0e,FormLabel:j0e,Heading:z0e,Input:Yr,Kbd:Z0e,Link:tTe,List:oTe,Menu:_Te,Modal:ATe,NumberInput:UTe,PinInput:BTe,Popover:QTe,Progress:obe,Radio:dbe,Select:Ebe,Skeleton:vbe,SkipLink:Tbe,Slider:Dbe,Spinner:Mbe,Stat:Gbe,Switch:ewe,Table:awe,Tabs:Twe,Tag:Owe,Textarea:Lwe,Tooltip:Uwe,Card:BSe,Stepper:Kbe},Fwe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},jwe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},Bwe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},Wwe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},zwe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},Gwe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},Hwe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},$we={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},Kwe={property:Gwe,easing:Hwe,duration:$we},qwe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},Ywe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},Xwe={breakpoints:jwe,zIndices:qwe,radii:Wwe,blur:Ywe,colors:Bwe,...gQ,sizes:uQ,shadows:zwe,space:lQ,borders:Fwe,transition:Kwe},Jwe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},Qwe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},Zwe="ltr",eRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},tRe={semanticTokens:Jwe,direction:Zwe,...Xwe,components:Vwe,styles:Qwe,config:eRe};function nRe(n){if(n.sheet)return n.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===n)return document.styleSheets[t]}function rRe(n){var t=document.createElement("style");return t.setAttribute("data-emotion",n.key),n.nonce!==void 0&&t.setAttribute("nonce",n.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var iRe=function(){function n(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=n.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(rRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=nRe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),Ca="-ms-",sk="-moz-",Kr="-webkit-",vQ="comm",DV="rule",LV="decl",sRe="@import",SQ="@keyframes",oRe="@layer",aRe=Math.abs,qk=String.fromCharCode,cRe=Object.assign;function lRe(n,t){return Zo(n,0)^45?(((t<<2^Zo(n,0))<<2^Zo(n,1))<<2^Zo(n,2))<<2^Zo(n,3):0}function TQ(n){return n.trim()}function uRe(n,t){return(n=t.exec(n))?n[0]:n}function qr(n,t,s){return n.replace(t,s)}function Q2(n,t){return n.indexOf(t)}function Zo(n,t){return n.charCodeAt(t)|0}function oR(n,t,s){return n.slice(t,s)}function Nh(n){return n.length}function xV(n){return n.length}function QP(n,t){return t.push(n),n}function dRe(n,t){return n.map(t).join("")}var Yk=1,qS=1,bQ=0,Jc=0,Gs=0,E0="";function Xk(n,t,s,a,l,d,f){return{value:n,root:t,parent:s,type:a,props:l,children:d,line:Yk,column:qS,length:f,return:""}}function Zb(n,t){return cRe(Xk("",null,null,"",null,null,0),n,{length:-n.length},t)}function hRe(){return Gs}function pRe(){return Gs=Jc>0?Zo(E0,--Jc):0,qS--,Gs===10&&(qS=1,Yk--),Gs}function Al(){return Gs=Jc<bQ?Zo(E0,Jc++):0,qS++,Gs===10&&(qS=1,Yk++),Gs}function Wh(){return Zo(E0,Jc)}function OO(){return Jc}function NR(n,t){return oR(E0,n,t)}function aR(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function wQ(n){return Yk=qS=1,bQ=Nh(E0=n),Jc=0,[]}function RQ(n){return E0="",n}function kO(n){return TQ(NR(Jc-1,Z2(n===91?n+2:n===40?n+1:n)))}function fRe(n){for(;(Gs=Wh())&&Gs<33;)Al();return aR(n)>2||aR(Gs)>3?"":" "}function mRe(n,t){for(;--t&&Al()&&!(Gs<48||Gs>102||Gs>57&&Gs<65||Gs>70&&Gs<97););return NR(n,OO()+(t<6&&Wh()==32&&Al()==32))}function Z2(n){for(;Al();)switch(Gs){case n:return Jc;case 34:case 39:n!==34&&n!==39&&Z2(Gs);break;case 40:n===41&&Z2(n);break;case 92:Al();break}return Jc}function gRe(n,t){for(;Al()&&n+Gs!==57;)if(n+Gs===84&&Wh()===47)break;return"/*"+NR(t,Jc-1)+"*"+qk(n===47?n:Al())}function _Re(n){for(;!aR(Wh());)Al();return NR(n,Jc)}function ERe(n){return RQ(NO("",null,null,null,[""],n=wQ(n),0,[0],n))}function NO(n,t,s,a,l,d,f,E,v){for(var T=0,w=0,A=f,N=0,F=0,j=0,z=1,H=1,te=1,K=0,ne="",de=l,oe=d,ge=a,ee=ne;H;)switch(j=K,K=Al()){case 40:if(j!=108&&Zo(ee,A-1)==58){Q2(ee+=qr(kO(K),"&","&\f"),"&\f")!=-1&&(te=-1);break}case 34:case 39:case 91:ee+=kO(K);break;case 9:case 10:case 13:case 32:ee+=fRe(j);break;case 92:ee+=mRe(OO()-1,7);continue;case 47:switch(Wh()){case 42:case 47:QP(yRe(gRe(Al(),OO()),t,s),v);break;default:ee+="/"}break;case 123*z:E[T++]=Nh(ee)*te;case 125*z:case 59:case 0:switch(K){case 0:case 125:H=0;case 59+w:te==-1&&(ee=qr(ee,/\f/g,"")),F>0&&Nh(ee)-A&&QP(F>32?F$(ee+";",a,s,A-1):F$(qr(ee," ","")+";",a,s,A-2),v);break;case 59:ee+=";";default:if(QP(ge=V$(ee,t,s,T,w,l,E,ne,de=[],oe=[],A),d),K===123)if(w===0)NO(ee,t,ge,ge,de,d,A,E,oe);else switch(N===99&&Zo(ee,3)===110?100:N){case 100:case 108:case 109:case 115:NO(n,ge,ge,a&&QP(V$(n,ge,ge,0,0,l,E,ne,l,de=[],A),oe),l,oe,A,E,a?de:oe);break;default:NO(ee,ge,ge,ge,[""],oe,0,E,oe)}}T=w=F=0,z=te=1,ne=ee="",A=f;break;case 58:A=1+Nh(ee),F=j;default:if(z<1){if(K==123)--z;else if(K==125&&z++==0&&pRe()==125)continue}switch(ee+=qk(K),K*z){case 38:te=w>0?1:(ee+="\f",-1);break;case 44:E[T++]=(Nh(ee)-1)*te,te=1;break;case 64:Wh()===45&&(ee+=kO(Al())),N=Wh(),w=A=Nh(ne=ee+=_Re(OO())),K++;break;case 45:j===45&&Nh(ee)==2&&(z=0)}}return d}function V$(n,t,s,a,l,d,f,E,v,T,w){for(var A=l-1,N=l===0?d:[""],F=xV(N),j=0,z=0,H=0;j<a;++j)for(var te=0,K=oR(n,A+1,A=aRe(z=f[j])),ne=n;te<F;++te)(ne=TQ(z>0?N[te]+" "+K:qr(K,/&\f/g,N[te])))&&(v[H++]=ne);return Xk(n,t,s,l===0?DV:E,v,T,w)}function yRe(n,t,s){return Xk(n,t,s,vQ,qk(hRe()),oR(n,2,-2),0)}function F$(n,t,s,a){return Xk(n,t,s,LV,oR(n,0,a),oR(n,a+1,-1),a)}function MS(n,t){for(var s="",a=xV(n),l=0;l<a;l++)s+=t(n[l],l,n,t)||"";return s}function vRe(n,t,s,a){switch(n.type){case oRe:if(n.children.length)break;case sRe:case LV:return n.return=n.return||n.value;case vQ:return"";case SQ:return n.return=n.value+"{"+MS(n.children,a)+"}";case DV:n.value=n.props.join(",")}return Nh(s=MS(n.children,a))?n.return=n.value+"{"+s+"}":""}function SRe(n){var t=xV(n);return function(s,a,l,d){for(var f="",E=0;E<t;E++)f+=n[E](s,a,l,d)||"";return f}}function TRe(n){return function(t){t.root||(t=t.return)&&n(t)}}var j$=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function CQ(n){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=n(s)),t[s]}}var bRe=function(t,s,a){for(var l=0,d=0;l=d,d=Wh(),l===38&&d===12&&(s[a]=1),!aR(d);)Al();return NR(t,Jc)},wRe=function(t,s){var a=-1,l=44;do switch(aR(l)){case 0:l===38&&Wh()===12&&(s[a]=1),t[a]+=bRe(Jc-1,s,a);break;case 2:t[a]+=kO(l);break;case 4:if(l===44){t[++a]=Wh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=qk(l)}while(l=Al());return t},RRe=function(t,s){return RQ(wRe(wQ(t),s))},B$=new WeakMap,CRe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!B$.get(a))&&!l){B$.set(t,!0);for(var d=[],f=RRe(s,d),E=a.props,v=0,T=0;v<f.length;v++)for(var w=0;w<E.length;w++,T++)t.props[T]=d[v]?f[v].replace(/&\f/g,E[w]):E[w]+" "+f[v]}}},IRe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function IQ(n,t){switch(lRe(n,t)){case 5103:return Kr+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Kr+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Kr+n+sk+n+Ca+n+n;case 6828:case 4268:return Kr+n+Ca+n+n;case 6165:return Kr+n+Ca+"flex-"+n+n;case 5187:return Kr+n+qr(n,/(\w+).+(:[^]+)/,Kr+"box-$1$2"+Ca+"flex-$1$2")+n;case 5443:return Kr+n+Ca+"flex-item-"+qr(n,/flex-|-self/,"")+n;case 4675:return Kr+n+Ca+"flex-line-pack"+qr(n,/align-content|flex-|-self/,"")+n;case 5548:return Kr+n+Ca+qr(n,"shrink","negative")+n;case 5292:return Kr+n+Ca+qr(n,"basis","preferred-size")+n;case 6060:return Kr+"box-"+qr(n,"-grow","")+Kr+n+Ca+qr(n,"grow","positive")+n;case 4554:return Kr+qr(n,/([^-])(transform)/g,"$1"+Kr+"$2")+n;case 6187:return qr(qr(qr(n,/(zoom-|grab)/,Kr+"$1"),/(image-set)/,Kr+"$1"),n,"")+n;case 5495:case 3959:return qr(n,/(image-set\([^]*)/,Kr+"$1$`$1");case 4968:return qr(qr(n,/(.+:)(flex-)?(.*)/,Kr+"box-pack:$3"+Ca+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Kr+n+n;case 4095:case 3583:case 4068:case 2532:return qr(n,/(.+)-inline(.+)/,Kr+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Nh(n)-1-t>6)switch(Zo(n,t+1)){case 109:if(Zo(n,t+4)!==45)break;case 102:return qr(n,/(.+:)(.+)-([^]+)/,"$1"+Kr+"$2-$3$1"+sk+(Zo(n,t+3)==108?"$3":"$2-$3"))+n;case 115:return~Q2(n,"stretch")?IQ(qr(n,"stretch","fill-available"),t)+n:n}break;case 4949:if(Zo(n,t+1)!==115)break;case 6444:switch(Zo(n,Nh(n)-3-(~Q2(n,"!important")&&10))){case 107:return qr(n,":",":"+Kr)+n;case 101:return qr(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Kr+(Zo(n,14)===45?"inline-":"")+"box$3$1"+Kr+"$2$3$1"+Ca+"$2box$3")+n}break;case 5936:switch(Zo(n,t+11)){case 114:return Kr+n+Ca+qr(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Kr+n+Ca+qr(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Kr+n+Ca+qr(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return Kr+n+Ca+n+n}return n}var ARe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case LV:t.return=IQ(t.value,t.length);break;case SQ:return MS([Zb(t,{value:qr(t.value,"@","@"+Kr)})],l);case DV:if(t.length)return dRe(t.props,function(d){switch(uRe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return MS([Zb(t,{props:[qr(d,/:(read-\w+)/,":"+sk+"$1")]})],l);case"::placeholder":return MS([Zb(t,{props:[qr(d,/:(plac\w+)/,":"+Kr+"input-$1")]}),Zb(t,{props:[qr(d,/:(plac\w+)/,":"+sk+"$1")]}),Zb(t,{props:[qr(d,/:(plac\w+)/,Ca+"input-$1")]})],l)}return""})}},PRe=[ARe],ORe=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(z){var H=z.getAttribute("data-emotion");H.indexOf(" ")!==-1&&(document.head.appendChild(z),z.setAttribute("data-s",""))})}var l=t.stylisPlugins||PRe,d={},f,E=[];f=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(z){for(var H=z.getAttribute("data-emotion").split(" "),te=1;te<H.length;te++)d[H[te]]=!0;E.push(z)});var v,T=[CRe,IRe];{var w,A=[vRe,TRe(function(z){w.insert(z)})],N=SRe(T.concat(l,A)),F=function(H){return MS(ERe(H),N)};v=function(H,te,K,ne){w=K,F(H?H+"{"+te.styles+"}":te.styles),ne&&(j.inserted[te.name]=!0)}}var j={key:s,sheet:new iRe({key:s,container:f,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return j.sheet.hydrate(E),j};function SE(){return SE=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},SE.apply(null,arguments)}var BM={exports:{}},ti={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W$;function kRe(){if(W$)return ti;W$=1;var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,s=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,E=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,T=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,A=n?Symbol.for("react.suspense"):60113,N=n?Symbol.for("react.suspense_list"):60120,F=n?Symbol.for("react.memo"):60115,j=n?Symbol.for("react.lazy"):60116,z=n?Symbol.for("react.block"):60121,H=n?Symbol.for("react.fundamental"):60117,te=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function ne(oe){if(typeof oe=="object"&&oe!==null){var ge=oe.$$typeof;switch(ge){case t:switch(oe=oe.type,oe){case v:case T:case a:case d:case l:case A:return oe;default:switch(oe=oe&&oe.$$typeof,oe){case E:case w:case j:case F:case f:return oe;default:return ge}}case s:return ge}}}function de(oe){return ne(oe)===T}return ti.AsyncMode=v,ti.ConcurrentMode=T,ti.ContextConsumer=E,ti.ContextProvider=f,ti.Element=t,ti.ForwardRef=w,ti.Fragment=a,ti.Lazy=j,ti.Memo=F,ti.Portal=s,ti.Profiler=d,ti.StrictMode=l,ti.Suspense=A,ti.isAsyncMode=function(oe){return de(oe)||ne(oe)===v},ti.isConcurrentMode=de,ti.isContextConsumer=function(oe){return ne(oe)===E},ti.isContextProvider=function(oe){return ne(oe)===f},ti.isElement=function(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===t},ti.isForwardRef=function(oe){return ne(oe)===w},ti.isFragment=function(oe){return ne(oe)===a},ti.isLazy=function(oe){return ne(oe)===j},ti.isMemo=function(oe){return ne(oe)===F},ti.isPortal=function(oe){return ne(oe)===s},ti.isProfiler=function(oe){return ne(oe)===d},ti.isStrictMode=function(oe){return ne(oe)===l},ti.isSuspense=function(oe){return ne(oe)===A},ti.isValidElementType=function(oe){return typeof oe=="string"||typeof oe=="function"||oe===a||oe===T||oe===d||oe===l||oe===A||oe===N||typeof oe=="object"&&oe!==null&&(oe.$$typeof===j||oe.$$typeof===F||oe.$$typeof===f||oe.$$typeof===E||oe.$$typeof===w||oe.$$typeof===H||oe.$$typeof===te||oe.$$typeof===K||oe.$$typeof===z)},ti.typeOf=ne,ti}var z$;function NRe(){return z$||(z$=1,BM.exports=kRe()),BM.exports}var WM,G$;function DRe(){if(G$)return WM;G$=1;var n=NRe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function f(j){return n.isMemo(j)?l:d[j.$$typeof]||t}var E=Object.defineProperty,v=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,A=Object.getPrototypeOf,N=Object.prototype;function F(j,z,H){if(typeof z!="string"){if(N){var te=A(z);te&&te!==N&&F(j,te,H)}var K=v(z);T&&(K=K.concat(T(z)));for(var ne=f(j),de=f(z),oe=0;oe<K.length;++oe){var ge=K[oe];if(!s[ge]&&!(H&&H[ge])&&!(de&&de[ge])&&!(ne&&ne[ge])){var ee=w(z,ge);try{E(j,ge,ee)}catch{}}}}return j}return WM=F,WM}DRe();var LRe=!0;function AQ(n,t,s){var a="";return s.split(" ").forEach(function(l){n[l]!==void 0?t.push(n[l]+";"):l&&(a+=l+" ")}),a}var MV=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||LRe===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},UV=function(t,s,a){MV(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function xRe(n){for(var t=0,s,a=0,l=n.length;l>=4;++a,l-=4)s=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(n.charCodeAt(a+2)&255)<<16;case 2:t^=(n.charCodeAt(a+1)&255)<<8;case 1:t^=n.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var MRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},URe=/[A-Z]|^ms/g,VRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,PQ=function(t){return t.charCodeAt(1)===45},H$=function(t){return t!=null&&typeof t!="boolean"},zM=CQ(function(n){return PQ(n)?n:n.replace(URe,"-$&").toLowerCase()}),$$=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(VRe,function(a,l,d){return Dh={name:l,styles:d,next:Dh},l})}return MRe[t]!==1&&!PQ(t)&&typeof s=="number"&&s!==0?s+"px":s};function cR(n,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return Dh={name:l.name,styles:l.styles,next:Dh},l.name;var d=s;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)Dh={name:f.name,styles:f.styles,next:Dh},f=f.next;var E=d.styles+";";return E}return FRe(n,t,s)}case"function":{if(n!==void 0){var v=Dh,T=s(n);return Dh=v,cR(n,t,T)}break}}var w=s;if(t==null)return w;var A=t[w];return A!==void 0?A:w}function FRe(n,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=cR(n,t,s[l])+";";else for(var d in s){var f=s[d];if(typeof f!="object"){var E=f;t!=null&&t[E]!==void 0?a+=d+"{"+t[E]+"}":H$(E)&&(a+=zM(d)+":"+$$(d,E)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(t==null||t[f[0]]===void 0))for(var v=0;v<f.length;v++)H$(f[v])&&(a+=zM(d)+":"+$$(d,f[v])+";");else{var T=cR(n,t,f);switch(d){case"animation":case"animationName":{a+=zM(d)+":"+T+";";break}default:a+=d+"{"+T+"}"}}}return a}var K$=/label:\s*([^\s;{]+)\s*(;|$)/g,Dh;function Jk(n,t,s){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Dh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=cR(s,t,d);else{var f=d;l+=f[0]}for(var E=1;E<n.length;E++)if(l+=cR(s,t,n[E]),a){var v=d;l+=v[E]}K$.lastIndex=0;for(var T="",w;(w=K$.exec(l))!==null;)T+="-"+w[1];var A=xRe(l)+T;return{name:A,styles:l,next:Dh}}var jRe=function(t){return t()},OQ=a$.useInsertionEffect?a$.useInsertionEffect:!1,kQ=OQ||jRe,q$=OQ||L.useLayoutEffect,VV=L.createContext(typeof HTMLElement<"u"?ORe({key:"css"}):null);VV.Provider;var BRe=function(){return L.useContext(VV)},FV=function(t){return L.forwardRef(function(s,a){var l=L.useContext(VV);return t(s,l,a)})},YS=L.createContext({}),WRe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return SE({},t,s)},zRe=j$(function(n){return j$(function(t){return WRe(n,t)})}),GRe=function(t){var s=L.useContext(YS);return t.theme!==s&&(s=zRe(s)(t.theme)),L.createElement(YS.Provider,{value:s},t.children)},jV={}.hasOwnProperty,eU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",HRe=function(t,s){var a={};for(var l in s)jV.call(s,l)&&(a[l]=s[l]);return a[eU]=t,a},$Re=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return MV(s,a,l),kQ(function(){return UV(s,a,l)}),null},KRe=FV(function(n,t,s){var a=n.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=n[eU],d=[a],f="";typeof n.className=="string"?f=AQ(t.registered,d,n.className):n.className!=null&&(f=n.className+" ");var E=Jk(d,void 0,L.useContext(YS));f+=t.key+"-"+E.name;var v={};for(var T in n)jV.call(n,T)&&T!=="css"&&T!==eU&&(v[T]=n[T]);return v.className=f,s&&(v.ref=s),L.createElement(L.Fragment,null,L.createElement($Re,{cache:t,serialized:E,isStringTag:typeof l=="string"}),L.createElement(l,v))}),qRe=KRe,Y$=function(t,s){var a=arguments;if(s==null||!jV.call(s,"css"))return L.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=qRe,d[1]=HRe(t,s);for(var f=2;f<l;f++)d[f]=a[f];return L.createElement.apply(null,d)};(function(n){var t;t||(t=n.JSX||(n.JSX={}))})(Y$||(Y$={}));var Qk=FV(function(n,t){var s=n.styles,a=Jk([s],void 0,L.useContext(YS)),l=L.useRef();return q$(function(){var d=t.key+"-global",f=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(f.before=t.sheet.tags[0]),v!==null&&(E=!0,v.setAttribute("data-emotion",d),f.hydrate([v])),l.current=[f,E],function(){f.flush()}},[t]),q$(function(){var d=l.current,f=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&UV(t,a.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}t.insert("",a,f,!1)},[t,a.name]),null});function YRe(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return Jk(t)}function DR(){var n=YRe.apply(void 0,arguments),t="animation-"+n.name;return{name:t,styles:"@keyframes "+t+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const BV=L.createContext({});BV.displayName="ColorModeContext";function Zk(){const n=L.useContext(BV);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function XRe(n,t){const{colorMode:s}=Zk();return s==="dark"?t:n}const ZP={light:"chakra-ui-light",dark:"chakra-ui-dark"};function JRe(n={}){const{preventTransition:t=!0,nonce:s}=n,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?ZP.dark:ZP.light),document.body.classList.remove(l?ZP.light:ZP.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=E=>{l(E.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const QRe="chakra-ui-color-mode";function ZRe(n){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(n)||t}catch{}return s||t},set(t){try{localStorage.setItem(n,t)}catch{}}}}const eCe=ZRe(QRe),X$=()=>{},tCe=S_e()?L.useLayoutEffect:L.useEffect;function J$(n,t){return n.type==="cookie"&&n.ssr?n.get(t):t}const NQ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:E=eCe}=t,v=BRe(),T=d==="dark"?"dark":"light",[w,A]=L.useState(()=>J$(E,T)),[N,F]=L.useState(()=>J$(E)),{getSystemTheme:j,setClassName:z,setDataset:H,addListener:te}=L.useMemo(()=>JRe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),K=d==="system"&&!w?N:w,ne=L.useCallback(ge=>{const ee=ge==="system"?j():ge;A(ee),z(ee==="dark"),H(ee),E.set(ee)},[E,j,z,H]);tCe(()=>{d==="system"&&F(j())},[]),L.useEffect(()=>{const ge=E.get();if(ge){ne(ge);return}if(d==="system"){ne("system");return}ne(T)},[E,T,d,ne]);const de=L.useCallback(()=>{ne(K==="dark"?"light":"dark")},[K,ne]);L.useEffect(()=>{if(l)return te(ne)},[l,te,ne]);const oe=L.useMemo(()=>({colorMode:s??K,toggleColorMode:s?X$:de,setColorMode:s?X$:ne,forced:s!==void 0}),[K,de,ne,s]);return I.jsx(BV.Provider,{value:oe,children:a})};NQ.displayName="ColorModeProvider";const DQ=String.raw,LQ=DQ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,nCe=()=>I.jsx(Qk,{styles:LQ}),rCe=({scope:n=""})=>I.jsx(Qk,{styles:DQ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${LQ}
    `});function iCe(n){const{cssVarsRoot:t,theme:s,children:a}=n,l=L.useMemo(()=>Gye(s),[s]);return I.jsxs(GRe,{theme:l,children:[I.jsx(sCe,{root:t}),a]})}function sCe({root:n=":host, :root"}){const t=[n,"[data-theme]"].join(",");return I.jsx(Qk,{styles:s=>({[t]:s.__cssVars})})}Oi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function oCe(){const{colorMode:n}=Zk();return I.jsx(Qk,{styles:t=>{const s=WJ(t,"styles.global"),a=Kc(s,{theme:t,colorMode:n});return a?sQ(a)(t):void 0}})}const[aCe,cCe]=Oi({strict:!1,name:"PortalManagerContext"});function WV(n){const{children:t,zIndex:s}=n;return I.jsx(aCe,{value:{zIndex:s},children:t})}WV.displayName="PortalManager";const zV=L.createContext({getDocument(){return document},getWindow(){return window}});zV.displayName="EnvironmentContext";function lCe({defer:n}={}){const[,t]=L.useReducer(s=>s+1,0);return mf(()=>{n&&t()},[n]),L.useContext(zV)}function xQ(n){const{children:t,environment:s,disabled:a}=n,l=L.useRef(null),d=L.useMemo(()=>s||{getDocument:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument)??document},getWindow:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument.defaultView)??window}},[s]),f=!a||!s;return I.jsxs(zV.Provider,{value:d,children:[t,f&&I.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}xQ.displayName="EnvironmentProvider";const uCe=n=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:E,cssVarsRoot:v,disableEnvironment:T,disableGlobalStyle:w}=n,A=I.jsx(xQ,{environment:E,disabled:T,children:t});return I.jsx(iCe,{theme:f,cssVarsRoot:v,children:I.jsxs(NQ,{colorModeManager:s,options:f.config,children:[d?I.jsx(rCe,{scope:l}):I.jsx(nCe,{}),!w&&I.jsx(oCe,{}),a?I.jsx(WV,{zIndex:a,children:A}):A]})})},GV=L.createContext({});function HV(n){const t=L.useRef(null);return t.current===null&&(t.current=n()),t.current}const LR=L.createContext(null),$V=L.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class dCe extends L.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function hCe({children:n,isPresent:t}){const s=L.useId(),a=L.useRef(null),l=L.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=L.useContext($V);return L.useInsertionEffect(()=>{const{width:f,height:E,top:v,left:T}=l.current;if(t||!a.current||!f||!E)return;a.current.dataset.motionPopId=s;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${E}px !important;
            top: ${v}px !important;
            left: ${T}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[t]),I.jsx(dCe,{isPresent:t,childRef:a,sizeRef:l,children:L.cloneElement(n,{ref:a})})}const pCe=({children:n,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const E=HV(fCe),v=L.useId(),T=L.useCallback(A=>{E.set(A,!0);for(const N of E.values())if(!N)return;a&&a()},[E,a]),w=L.useMemo(()=>({id:v,initial:t,isPresent:s,custom:l,onExitComplete:T,register:A=>(E.set(A,!1),()=>E.delete(A))}),d?[Math.random(),T]:[s,T]);return L.useMemo(()=>{E.forEach((A,N)=>E.set(N,!1))},[s]),L.useEffect(()=>{!s&&!E.size&&a&&a()},[s]),f==="popLayout"&&(n=I.jsx(hCe,{isPresent:s,children:n})),I.jsx(LR.Provider,{value:w,children:n})};function fCe(){return new Map}function KV(n=!0){const t=L.useContext(LR);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=L.useId();L.useEffect(()=>{n&&l(d)},[n]);const f=L.useCallback(()=>n&&a&&a(d),[d,a,n]);return!s&&a?[!1,f]:[!0]}function mCe(){return gCe(L.useContext(LR))}function gCe(n){return n===null?!0:n.isPresent}const eO=n=>n.key||"";function Q$(n){const t=[];return L.Children.forEach(n,s=>{L.isValidElement(s)&&t.push(s)}),t}const qV=typeof window<"u",MQ=qV?L.useLayoutEffect:L.useEffect,y0=({children:n,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[E,v]=KV(f),T=L.useMemo(()=>Q$(n),[n]),w=f&&!E?[]:T.map(eO),A=L.useRef(!0),N=L.useRef(T),F=HV(()=>new Map),[j,z]=L.useState(T),[H,te]=L.useState(T);MQ(()=>{A.current=!1,N.current=T;for(let de=0;de<H.length;de++){const oe=eO(H[de]);w.includes(oe)?F.delete(oe):F.get(oe)!==!0&&F.set(oe,!1)}},[H,w.length,w.join("-")]);const K=[];if(T!==j){let de=[...T];for(let oe=0;oe<H.length;oe++){const ge=H[oe],ee=eO(ge);w.includes(ee)||(de.splice(oe,0,ge),K.push(ge))}d==="wait"&&K.length&&(de=K),te(Q$(de)),z(T);return}const{forceRender:ne}=L.useContext(GV);return I.jsx(I.Fragment,{children:H.map(de=>{const oe=eO(de),ge=f&&!E?!1:T===H||w.includes(oe),ee=()=>{if(F.has(oe))F.set(oe,!0);else return;let Z=!0;F.forEach(J=>{J||(Z=!1)}),Z&&(ne==null||ne(),te(N.current),f&&(v==null||v()),a&&a())};return I.jsx(pCe,{isPresent:ge,initial:!A.current||s?void 0:!1,custom:ge?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:ge?void 0:ee,children:de},oe)})})},Pl=n=>n;let UQ=Pl;function YV(n){let t;return()=>(t===void 0&&(t=n()),t)}const XS=(n,t,s)=>{const a=t-n;return a===0?1:(s-n)/a},_f=n=>n*1e3,Ef=n=>n/1e3,_Ce={useManualTiming:!1};function ECe(n){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function E(T){d.has(T)&&(v.schedule(T),n()),T(f)}const v={schedule:(T,w=!1,A=!1)=>{const F=A&&a?t:s;return w&&d.add(T),F.has(T)||F.add(T),T},cancel:T=>{s.delete(T),d.delete(T)},process:T=>{if(f=T,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(E),t.clear(),a=!1,l&&(l=!1,v.process(T))}};return v}const tO=["read","resolveKeyframes","update","preRender","render","postRender"],yCe=40;function VQ(n,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,f=tO.reduce((te,K)=>(te[K]=ECe(d),te),{}),{read:E,resolveKeyframes:v,update:T,preRender:w,render:A,postRender:N}=f,F=()=>{const te=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(te-l.timestamp,yCe),1),l.timestamp=te,l.isProcessing=!0,E.process(l),v.process(l),T.process(l),w.process(l),A.process(l),N.process(l),l.isProcessing=!1,s&&t&&(a=!1,n(F))},j=()=>{s=!0,a=!0,l.isProcessing||n(F)};return{schedule:tO.reduce((te,K)=>{const ne=f[K];return te[K]=(de,oe=!1,ge=!1)=>(s||j(),ne.schedule(de,oe,ge)),te},{}),cancel:te=>{for(let K=0;K<tO.length;K++)f[tO[K]].cancel(te)},state:l,steps:f}}const{schedule:Gi,cancel:pg,state:Jo,steps:GM}=VQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Pl,!0),FQ=L.createContext({strict:!1}),Z$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},JS={};for(const n in Z$)JS[n]={isEnabled:t=>Z$[n].some(s=>!!t[s])};function vCe(n){for(const t in n)JS[t]={...JS[t],...n[t]}}const SCe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ok(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||SCe.has(n)}let jQ=n=>!ok(n);function TCe(n){n&&(jQ=t=>t.startsWith("on")?!ok(t):n(t))}try{TCe(require("@emotion/is-prop-valid").default)}catch{}function bCe(n,t,s){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(jQ(l)||s===!0&&ok(l)||!t&&!ok(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function wCe(n){if(typeof Proxy>"u")return n;const t=new Map,s=(...a)=>n(...a);return new Proxy(s,{get:(a,l)=>l==="create"?n:(t.has(l)||t.set(l,n(l)),t.get(l))})}const e1=L.createContext({});function lR(n){return typeof n=="string"||Array.isArray(n)}function t1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const XV=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],JV=["initial",...XV];function n1(n){return t1(n.animate)||JV.some(t=>lR(n[t]))}function BQ(n){return!!(n1(n)||n.variants)}function RCe(n,t){if(n1(n)){const{initial:s,animate:a}=n;return{initial:s===!1||lR(s)?s:void 0,animate:lR(a)?a:void 0}}return n.inherit!==!1?t:{}}function CCe(n){const{initial:t,animate:s}=RCe(n,L.useContext(e1));return L.useMemo(()=>({initial:t,animate:s}),[eK(t),eK(s)])}function eK(n){return Array.isArray(n)?n.join(" "):n}const ICe=Symbol.for("motionComponentSymbol");function SS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function ACe(n,t,s){return L.useCallback(a=>{a&&n.onMount&&n.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):SS(s)&&(s.current=a))},[t])}const QV=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),PCe="framerAppearId",WQ="data-"+QV(PCe),{schedule:ZV}=VQ(queueMicrotask,!1),zQ=L.createContext({});function OCe(n,t,s,a,l){var d,f;const{visualElement:E}=L.useContext(e1),v=L.useContext(FQ),T=L.useContext(LR),w=L.useContext($V).reducedMotion,A=L.useRef(null);a=a||v.renderer,!A.current&&a&&(A.current=a(n,{visualState:t,parent:E,props:s,presenceContext:T,blockInitialAnimation:T?T.initial===!1:!1,reducedMotionConfig:w}));const N=A.current,F=L.useContext(zQ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&kCe(A.current,s,l,F);const j=L.useRef(!1);L.useInsertionEffect(()=>{N&&j.current&&N.update(s,T)});const z=s[WQ],H=L.useRef(!!z&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,z))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,z)));return MQ(()=>{N&&(j.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),ZV.render(N.render),H.current&&N.animationState&&N.animationState.animateChanges())}),L.useEffect(()=>{N&&(!H.current&&N.animationState&&N.animationState.animateChanges(),H.current&&(queueMicrotask(()=>{var te;(te=window.MotionHandoffMarkAsComplete)===null||te===void 0||te.call(window,z)}),H.current=!1))}),N}function kCe(n,t,s,a){const{layoutId:l,layout:d,drag:f,dragConstraints:E,layoutScroll:v,layoutRoot:T}=t;n.projection=new s(n.latestValues,t["data-framer-portal-id"]?void 0:GQ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||E&&SS(E),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:T})}function GQ(n){if(n)return n.options.allowProjection!==!1?n.projection:GQ(n.parent)}function NCe({preloadedFeatures:n,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,f;n&&vCe(n);function E(T,w){let A;const N={...L.useContext($V),...T,layoutId:DCe(T)},{isStatic:F}=N,j=CCe(T),z=a(T,F);if(!F&&qV){LCe();const H=xCe(N);A=H.MeasureLayout,j.visualElement=OCe(l,z,N,t,H.ProjectionNode)}return I.jsxs(e1.Provider,{value:j,children:[A&&j.visualElement?I.jsx(A,{visualElement:j.visualElement,...N}):null,s(l,T,ACe(z,j.visualElement,w),z,F,j.visualElement)]})}E.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const v=L.forwardRef(E);return v[ICe]=l,v}function DCe({layoutId:n}){const t=L.useContext(GV).id;return t&&n!==void 0?t+"-"+n:n}function LCe(n,t){L.useContext(FQ).strict}function xCe(n){const{drag:t,layout:s}=JS;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(n)||s!=null&&s.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const MCe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function eF(n){return typeof n!="string"||n.includes("-")?!1:!!(MCe.indexOf(n)>-1||/[A-Z]/u.test(n))}function tK(n){const t=[{},{}];return n==null||n.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function tF(n,t,s,a){if(typeof t=="function"){const[l,d]=tK(a);t=t(s!==void 0?s:n.custom,l,d)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[l,d]=tK(a);t=t(s!==void 0?s:n.custom,l,d)}return t}const tU=n=>Array.isArray(n),UCe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),VCe=n=>tU(n)?n[n.length-1]||0:n,ka=n=>!!(n&&n.getVelocity);function DO(n){const t=ka(n)?n.get():n;return UCe(t)?t.toValue():t}function FCe({scrapeMotionValuesFromProps:n,createRenderState:t,onUpdate:s},a,l,d){const f={latestValues:jCe(a,l,d,n),renderState:t()};return s&&(f.onMount=E=>s({props:a,current:E,...f}),f.onUpdate=E=>s(E)),f}const HQ=n=>(t,s)=>{const a=L.useContext(e1),l=L.useContext(LR),d=()=>FCe(n,t,a,l);return s?d():HV(d)};function jCe(n,t,s,a){const l={},d=a(n,{});for(const N in d)l[N]=DO(d[N]);let{initial:f,animate:E}=n;const v=n1(n),T=BQ(n);t&&T&&!v&&n.inherit!==!1&&(f===void 0&&(f=t.initial),E===void 0&&(E=t.animate));let w=s?s.initial===!1:!1;w=w||f===!1;const A=w?E:f;if(A&&typeof A!="boolean"&&!t1(A)){const N=Array.isArray(A)?A:[A];for(let F=0;F<N.length;F++){const j=tF(n,N[F]);if(j){const{transitionEnd:z,transition:H,...te}=j;for(const K in te){let ne=te[K];if(Array.isArray(ne)){const de=w?ne.length-1:0;ne=ne[de]}ne!==null&&(l[K]=ne)}for(const K in z)l[K]=z[K]}}}return l}const v0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],NE=new Set(v0),$Q=n=>t=>typeof t=="string"&&t.startsWith(n),KQ=$Q("--"),BCe=$Q("var(--"),nF=n=>BCe(n)?WCe.test(n.split("/*")[0].trim()):!1,WCe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,qQ=(n,t)=>t&&typeof n=="number"?t.transform(n):n,bf=(n,t,s)=>s>t?t:s<n?n:s,S0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},uR={...S0,transform:n=>bf(0,1,n)},nO={...S0,default:1},xR=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),Hm=xR("deg"),zh=xR("%"),Nn=xR("px"),zCe=xR("vh"),GCe=xR("vw"),nK={...zh,parse:n=>zh.parse(n)/100,transform:n=>zh.transform(n*100)},HCe={borderWidth:Nn,borderTopWidth:Nn,borderRightWidth:Nn,borderBottomWidth:Nn,borderLeftWidth:Nn,borderRadius:Nn,radius:Nn,borderTopLeftRadius:Nn,borderTopRightRadius:Nn,borderBottomRightRadius:Nn,borderBottomLeftRadius:Nn,width:Nn,maxWidth:Nn,height:Nn,maxHeight:Nn,top:Nn,right:Nn,bottom:Nn,left:Nn,padding:Nn,paddingTop:Nn,paddingRight:Nn,paddingBottom:Nn,paddingLeft:Nn,margin:Nn,marginTop:Nn,marginRight:Nn,marginBottom:Nn,marginLeft:Nn,backgroundPositionX:Nn,backgroundPositionY:Nn},$Ce={rotate:Hm,rotateX:Hm,rotateY:Hm,rotateZ:Hm,scale:nO,scaleX:nO,scaleY:nO,scaleZ:nO,skew:Hm,skewX:Hm,skewY:Hm,distance:Nn,translateX:Nn,translateY:Nn,translateZ:Nn,x:Nn,y:Nn,z:Nn,perspective:Nn,transformPerspective:Nn,opacity:uR,originX:nK,originY:nK,originZ:Nn},rK={...S0,transform:Math.round},rF={...HCe,...$Ce,zIndex:rK,size:Nn,fillOpacity:uR,strokeOpacity:uR,numOctaves:rK},KCe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},qCe=v0.length;function YCe(n,t,s){let a="",l=!0;for(let d=0;d<qCe;d++){const f=v0[d],E=n[f];if(E===void 0)continue;let v=!0;if(typeof E=="number"?v=E===(f.startsWith("scale")?1:0):v=parseFloat(E)===0,!v||s){const T=qQ(E,rF[f]);if(!v){l=!1;const w=KCe[f]||f;a+=`${w}(${T}) `}s&&(t[f]=T)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function iF(n,t,s){const{style:a,vars:l,transformOrigin:d}=n;let f=!1,E=!1;for(const v in t){const T=t[v];if(NE.has(v)){f=!0;continue}else if(KQ(v)){l[v]=T;continue}else{const w=qQ(T,rF[v]);v.startsWith("origin")?(E=!0,d[v]=w):a[v]=w}}if(t.transform||(f||s?a.transform=YCe(t,n.transform,s):a.transform&&(a.transform="none")),E){const{originX:v="50%",originY:T="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${T} ${w}`}}const XCe={offset:"stroke-dashoffset",array:"stroke-dasharray"},JCe={offset:"strokeDashoffset",array:"strokeDasharray"};function QCe(n,t,s=1,a=0,l=!0){n.pathLength=1;const d=l?XCe:JCe;n[d.offset]=Nn.transform(-a);const f=Nn.transform(t),E=Nn.transform(s);n[d.array]=`${f} ${E}`}function iK(n,t,s){return typeof n=="string"?n:Nn.transform(t+s*n)}function ZCe(n,t,s){const a=iK(t,n.x,n.width),l=iK(s,n.y,n.height);return`${a} ${l}`}function sF(n,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:E=1,pathOffset:v=0,...T},w,A){if(iF(n,T,A),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:F,dimensions:j}=n;N.transform&&(j&&(F.transform=N.transform),delete N.transform),j&&(l!==void 0||d!==void 0||F.transform)&&(F.transformOrigin=ZCe(j,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(N.x=t),s!==void 0&&(N.y=s),a!==void 0&&(N.scale=a),f!==void 0&&QCe(N,f,E,v,!1)}const oF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),YQ=()=>({...oF(),attrs:{}}),aF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function XQ(n,{style:t,vars:s},a,l){Object.assign(n.style,t,l&&l.getProjectionStyles(a));for(const d in s)n.style.setProperty(d,s[d])}const JQ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function QQ(n,t,s,a){XQ(n,t,void 0,a);for(const l in t.attrs)n.setAttribute(JQ.has(l)?l:QV(l),t.attrs[l])}const ak={};function eIe(n){Object.assign(ak,n)}function ZQ(n,{layout:t,layoutId:s}){return NE.has(n)||n.startsWith("origin")||(t||s!==void 0)&&(!!ak[n]||n==="opacity")}function cF(n,t,s){var a;const{style:l}=n,d={};for(const f in l)(ka(l[f])||t.style&&ka(t.style[f])||ZQ(f,n)||((a=s==null?void 0:s.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function eZ(n,t,s){const a=cF(n,t,s);for(const l in n)if(ka(n[l])||ka(t[l])){const d=v0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function tIe(n,t){try{t.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const sK=["x","y","width","height","cx","cy","r"],nIe={useVisualState:HQ({scrapeMotionValuesFromProps:eZ,createRenderState:YQ,onUpdate:({props:n,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!n.drag;if(!d){for(const E in l)if(NE.has(E)){d=!0;break}}if(!d)return;let f=!t;if(t)for(let E=0;E<sK.length;E++){const v=sK[E];n[v]!==t[v]&&(f=!0)}f&&Gi.read(()=>{tIe(s,a),Gi.render(()=>{sF(a,l,aF(s.tagName),n.transformTemplate),QQ(s,a)})})}})},rIe={useVisualState:HQ({scrapeMotionValuesFromProps:cF,createRenderState:oF})};function tZ(n,t,s){for(const a in t)!ka(t[a])&&!ZQ(a,s)&&(n[a]=t[a])}function iIe({transformTemplate:n},t){return L.useMemo(()=>{const s=oF();return iF(s,t,n),Object.assign({},s.vars,s.style)},[t])}function sIe(n,t){const s=n.style||{},a={};return tZ(a,s,n),Object.assign(a,iIe(n,t)),a}function oIe(n,t){const s={},a=sIe(n,t);return n.drag&&n.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(s.tabIndex=0),s.style=a,s}function aIe(n,t,s,a){const l=L.useMemo(()=>{const d=YQ();return sF(d,t,aF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(n.style){const d={};tZ(d,n.style,n),l.style={...d,...l.style}}return l}function cIe(n=!1){return(s,a,l,{latestValues:d},f)=>{const v=(eF(s)?aIe:oIe)(a,d,f,s),T=bCe(a,typeof s=="string",n),w=s!==L.Fragment?{...T,...v,ref:l}:{},{children:A}=a,N=L.useMemo(()=>ka(A)?A.get():A,[A]);return L.createElement(s,{...w,children:N})}}function lIe(n,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...eF(a)?nIe:rIe,preloadedFeatures:n,useRender:cIe(l),createVisualElement:t,Component:a};return NCe(f)}}function nZ(n,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==n.length)return!1;for(let a=0;a<s;a++)if(t[a]!==n[a])return!1;return!0}function r1(n,t,s){const a=n.getProps();return tF(a,t,s!==void 0?s:a.custom,n)}const uIe=YV(()=>window.ScrollTimeline!==void 0);class dIe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(uIe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class hIe extends dIe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function lF(n,t){return n?n[t]||n.default||n:void 0}const nU=2e4;function rZ(n){let t=0;const s=50;let a=n.next(t);for(;!a.done&&t<nU;)t+=s,a=n.next(t);return t>=nU?1/0:t}function uF(n){return typeof n=="function"}function oK(n,t){n.timeline=t,n.onfinish=null}const dF=n=>Array.isArray(n)&&typeof n[0]=="number",pIe={linearEasing:void 0};function fIe(n,t){const s=YV(n);return()=>{var a;return(a=pIe[t])!==null&&a!==void 0?a:s()}}const ck=fIe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),iZ=(n,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=n(XS(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function sZ(n){return!!(typeof n=="function"&&ck()||!n||typeof n=="string"&&(n in rU||ck())||dF(n)||Array.isArray(n)&&n.every(sZ))}const Sw=([n,t,s,a])=>`cubic-bezier(${n}, ${t}, ${s}, ${a})`,rU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Sw([0,.65,.55,1]),circOut:Sw([.55,0,1,.45]),backIn:Sw([.31,.01,.66,-.59]),backOut:Sw([.33,1.53,.69,.99])};function oZ(n,t){if(n)return typeof n=="function"&&ck()?iZ(n,t):dF(n)?Sw(n):Array.isArray(n)?n.map(s=>oZ(s,t)||rU.easeOut):rU[n]}const bd={x:!1,y:!1};function aZ(){return bd.x||bd.y}function mIe(n,t,s){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function cZ(n,t){const s=mIe(n),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function aK(n){return t=>{t.pointerType==="touch"||aZ()||n(t)}}function gIe(n,t,s={}){const[a,l,d]=cZ(n,s),f=aK(E=>{const{target:v}=E,T=t(E);if(typeof T!="function"||!v)return;const w=aK(A=>{T(A),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(E=>{E.addEventListener("pointerenter",f,l)}),d}const lZ=(n,t)=>t?n===t?!0:lZ(n,t.parentElement):!1,hF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,_Ie=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function EIe(n){return _Ie.has(n.tagName)||n.tabIndex!==-1}const Tw=new WeakSet;function cK(n){return t=>{t.key==="Enter"&&n(t)}}function HM(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const yIe=(n,t)=>{const s=n.currentTarget;if(!s)return;const a=cK(()=>{if(Tw.has(s))return;HM(s,"down");const l=cK(()=>{HM(s,"up")}),d=()=>HM(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function lK(n){return hF(n)&&!aZ()}function vIe(n,t,s={}){const[a,l,d]=cZ(n,s),f=E=>{const v=E.currentTarget;if(!lK(E)||Tw.has(v))return;Tw.add(v);const T=t(E),w=(F,j)=>{window.removeEventListener("pointerup",A),window.removeEventListener("pointercancel",N),!(!lK(F)||!Tw.has(v))&&(Tw.delete(v),typeof T=="function"&&T(F,{success:j}))},A=F=>{w(F,s.useGlobalTarget||lZ(v,F.target))},N=F=>{w(F,!1)};window.addEventListener("pointerup",A,l),window.addEventListener("pointercancel",N,l)};return a.forEach(E=>{!EIe(E)&&E.getAttribute("tabindex")===null&&(E.tabIndex=0),(s.useGlobalTarget?window:E).addEventListener("pointerdown",f,l),E.addEventListener("focus",T=>yIe(T,l),l)}),d}function SIe(n){return n==="x"||n==="y"?bd[n]?null:(bd[n]=!0,()=>{bd[n]=!1}):bd.x||bd.y?null:(bd.x=bd.y=!0,()=>{bd.x=bd.y=!1})}const uZ=new Set(["width","height","top","left","right","bottom",...v0]);let LO;function TIe(){LO=void 0}const Gh={now:()=>(LO===void 0&&Gh.set(Jo.isProcessing||_Ce.useManualTiming?Jo.timestamp:performance.now()),LO),set:n=>{LO=n,queueMicrotask(TIe)}};function pF(n,t){n.indexOf(t)===-1&&n.push(t)}function fF(n,t){const s=n.indexOf(t);s>-1&&n.splice(s,1)}class mF{constructor(){this.subscriptions=[]}add(t){return pF(this.subscriptions,t),()=>fF(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function dZ(n,t){return t?n*(1e3/t):0}const uK=30,bIe=n=>!isNaN(parseFloat(n));class wIe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Gh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Gh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=bIe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new mF);const a=this.events[t].add(s);return t==="change"?()=>{a(),Gi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Gh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>uK)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,uK);return dZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function dR(n,t){return new wIe(n,t)}function RIe(n,t,s){n.hasValue(t)?n.getValue(t).set(s):n.addValue(t,dR(s))}function CIe(n,t){const s=r1(n,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const f in d){const E=VCe(d[f]);RIe(n,f,E)}}function IIe(n){return!!(ka(n)&&n.add)}function iU(n,t){const s=n.getValue("willChange");if(IIe(s))return s.add(t)}function hZ(n){return n.props[WQ]}const pZ=(n,t,s)=>(((1-3*s+3*t)*n+(3*s-6*t))*n+3*t)*n,AIe=1e-7,PIe=12;function OIe(n,t,s,a,l){let d,f,E=0;do f=t+(s-t)/2,d=pZ(f,a,l)-n,d>0?s=f:t=f;while(Math.abs(d)>AIe&&++E<PIe);return f}function MR(n,t,s,a){if(n===t&&s===a)return Pl;const l=d=>OIe(d,0,1,n,s);return d=>d===0||d===1?d:pZ(l(d),t,a)}const fZ=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,mZ=n=>t=>1-n(1-t),gZ=MR(.33,1.53,.69,.99),gF=mZ(gZ),_Z=fZ(gF),EZ=n=>(n*=2)<1?.5*gF(n):.5*(2-Math.pow(2,-10*(n-1))),_F=n=>1-Math.sin(Math.acos(n)),yZ=mZ(_F),vZ=fZ(_F),SZ=n=>/^0[^.\s]+$/u.test(n);function kIe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||SZ(n):!0}const Fw=n=>Math.round(n*1e5)/1e5,EF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function NIe(n){return n==null}const DIe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,yF=(n,t)=>s=>!!(typeof s=="string"&&DIe.test(s)&&s.startsWith(n)||t&&!NIe(s)&&Object.prototype.hasOwnProperty.call(s,t)),TZ=(n,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,f,E]=a.match(EF);return{[n]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(f),alpha:E!==void 0?parseFloat(E):1}},LIe=n=>bf(0,255,n),$M={...S0,transform:n=>Math.round(LIe(n))},aE={test:yF("rgb","red"),parse:TZ("red","green","blue"),transform:({red:n,green:t,blue:s,alpha:a=1})=>"rgba("+$M.transform(n)+", "+$M.transform(t)+", "+$M.transform(s)+", "+Fw(uR.transform(a))+")"};function xIe(n){let t="",s="",a="",l="";return n.length>5?(t=n.substring(1,3),s=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(t=n.substring(1,2),s=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const sU={test:yF("#"),parse:xIe,transform:aE.transform},TS={test:yF("hsl","hue"),parse:TZ("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(n)+", "+zh.transform(Fw(t))+", "+zh.transform(Fw(s))+", "+Fw(uR.transform(a))+")"},Ia={test:n=>aE.test(n)||sU.test(n)||TS.test(n),parse:n=>aE.test(n)?aE.parse(n):TS.test(n)?TS.parse(n):sU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?aE.transform(n):TS.transform(n)},MIe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function UIe(n){var t,s;return isNaN(n)&&typeof n=="string"&&(((t=n.match(EF))===null||t===void 0?void 0:t.length)||0)+(((s=n.match(MIe))===null||s===void 0?void 0:s.length)||0)>0}const bZ="number",wZ="color",VIe="var",FIe="var(",dK="${}",jIe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function hR(n){const t=n.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(jIe,v=>(Ia.test(v)?(a.color.push(d),l.push(wZ),s.push(Ia.parse(v))):v.startsWith(FIe)?(a.var.push(d),l.push(VIe),s.push(v)):(a.number.push(d),l.push(bZ),s.push(parseFloat(v))),++d,dK)).split(dK);return{values:s,split:E,indexes:a,types:l}}function RZ(n){return hR(n).values}function CZ(n){const{split:t,types:s}=hR(n),a=t.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=t[f],l[f]!==void 0){const E=s[f];E===bZ?d+=Fw(l[f]):E===wZ?d+=Ia.transform(l[f]):d+=l[f]}return d}}const BIe=n=>typeof n=="number"?0:n;function WIe(n){const t=RZ(n);return CZ(n)(t.map(BIe))}const fg={test:UIe,parse:RZ,createTransformer:CZ,getAnimatableNone:WIe},zIe=new Set(["brightness","contrast","saturate","opacity"]);function GIe(n){const[t,s]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[a]=s.match(EF)||[];if(!a)return n;const l=s.replace(a,"");let d=zIe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const HIe=/\b([a-z-]*)\(.*?\)/gu,oU={...fg,getAnimatableNone:n=>{const t=n.match(HIe);return t?t.map(GIe).join(" "):n}},$Ie={...rF,color:Ia,backgroundColor:Ia,outlineColor:Ia,fill:Ia,stroke:Ia,borderColor:Ia,borderTopColor:Ia,borderRightColor:Ia,borderBottomColor:Ia,borderLeftColor:Ia,filter:oU,WebkitFilter:oU},vF=n=>$Ie[n];function IZ(n,t){let s=vF(n);return s!==oU&&(s=fg),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const KIe=new Set(["auto","none","0"]);function qIe(n,t,s){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!KIe.has(d)&&hR(d).values.length&&(l=n[a]),a++}if(l&&s)for(const d of t)n[d]=IZ(s,l)}const hK=n=>n===S0||n===Nn,pK=(n,t)=>parseFloat(n.split(", ")[t]),fK=(n,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return pK(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?pK(d[1],n):0}},YIe=new Set(["x","y","z"]),XIe=v0.filter(n=>!YIe.has(n));function JIe(n){const t=[];return XIe.forEach(s=>{const a=n.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const QS={width:({x:n},{paddingLeft:t="0",paddingRight:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),height:({y:n},{paddingTop:t="0",paddingBottom:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:fK(4,13),y:fK(5,14)};QS.translateX=QS.x;QS.translateY=QS.y;const pE=new Set;let aU=!1,cU=!1;function AZ(){if(cU){const n=Array.from(pE).filter(a=>a.needsMeasurement),t=new Set(n.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=JIe(a);l.length&&(s.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,f])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}cU=!1,aU=!1,pE.forEach(n=>n.complete()),pE.clear()}function PZ(){pE.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(cU=!0)})}function QIe(){PZ(),AZ()}class SF{constructor(t,s,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(pE.add(this),aU||(aU=!0,Gi.read(PZ),Gi.resolveKeyframes(AZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const f=l==null?void 0:l.get(),E=t[t.length-1];if(f!==void 0)t[0]=f;else if(a&&s){const v=a.readValue(s,E);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=E),l&&f===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),pE.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,pE.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const OZ=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),ZIe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function eAe(n){const t=ZIe.exec(n);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function kZ(n,t,s=1){const[a,l]=eAe(n);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const f=d.trim();return OZ(f)?parseFloat(f):f}return nF(l)?kZ(l,t,s+1):l}const NZ=n=>t=>t.test(n),tAe={test:n=>n==="auto",parse:n=>n},DZ=[S0,Nn,zh,Hm,GCe,zCe,tAe],mK=n=>DZ.find(NZ(n));class LZ extends SF{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let T=t[v];if(typeof T=="string"&&(T=T.trim(),nF(T))){const w=kZ(T,s.current);w!==void 0&&(t[v]=w),v===t.length-1&&(this.finalKeyframe=T)}}if(this.resolveNoneKeyframes(),!uZ.has(a)||t.length!==2)return;const[l,d]=t,f=mK(l),E=mK(d);if(f!==E)if(hK(f)&&hK(E))for(let v=0;v<t.length;v++){const T=t[v];typeof T=="string"&&(t[v]=parseFloat(T))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)kIe(t[l])&&a.push(l);a.length&&qIe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=QS[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,E=l[f];l[f]=QS[a](s.measureViewportBox(),window.getComputedStyle(s.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,T])=>{s.getValue(v).set(T)}),this.resolveNoneKeyframes()}}const gK=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(fg.test(n)||n==="0")&&!n.startsWith("url("));function nAe(n){const t=n[0];if(n.length===1)return!0;for(let s=0;s<n.length;s++)if(n[s]!==t)return!0}function rAe(n,t,s,a){const l=n[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=n[n.length-1],f=gK(l,t),E=gK(d,t);return!f||!E?!1:nAe(n)||(s==="spring"||uF(s))&&a}const iAe=n=>n!==null;function i1(n,{repeat:t,repeatType:s="loop"},a){const l=n.filter(iAe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const sAe=40;class xZ{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Gh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:f,...E},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>sAe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&QIe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Gh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:E,onUpdate:v,isGenerator:T}=this.options;if(!T&&!rAe(t,a,l,d))if(f)this.options.duration=0;else{v&&v(i1(t,this.options,s)),E&&E(),this.resolveFinishedPromise();return}const w=this.initPlayback(t,s);w!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...w},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const as=(n,t,s)=>n+(t-n)*s;function KM(n,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?n+(t-n)*6*s:s<1/2?t:s<2/3?n+(t-n)*(2/3-s)*6:n}function oAe({hue:n,saturation:t,lightness:s,alpha:a}){n/=360,t/=100,s/=100;let l=0,d=0,f=0;if(!t)l=d=f=s;else{const E=s<.5?s*(1+t):s+t-s*t,v=2*s-E;l=KM(v,E,n+1/3),d=KM(v,E,n),f=KM(v,E,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function lk(n,t){return s=>s>0?t:n}const qM=(n,t,s)=>{const a=n*n,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},aAe=[sU,aE,TS],cAe=n=>aAe.find(t=>t.test(n));function _K(n){const t=cAe(n);if(!t)return!1;let s=t.parse(n);return t===TS&&(s=oAe(s)),s}const EK=(n,t)=>{const s=_K(n),a=_K(t);if(!s||!a)return lk(n,t);const l={...s};return d=>(l.red=qM(s.red,a.red,d),l.green=qM(s.green,a.green,d),l.blue=qM(s.blue,a.blue,d),l.alpha=as(s.alpha,a.alpha,d),aE.transform(l))},lAe=(n,t)=>s=>t(n(s)),UR=(...n)=>n.reduce(lAe),lU=new Set(["none","hidden"]);function uAe(n,t){return lU.has(n)?s=>s<=0?n:t:s=>s>=1?t:n}function dAe(n,t){return s=>as(n,t,s)}function TF(n){return typeof n=="number"?dAe:typeof n=="string"?nF(n)?lk:Ia.test(n)?EK:fAe:Array.isArray(n)?MZ:typeof n=="object"?Ia.test(n)?EK:hAe:lk}function MZ(n,t){const s=[...n],a=s.length,l=n.map((d,f)=>TF(d)(d,t[f]));return d=>{for(let f=0;f<a;f++)s[f]=l[f](d);return s}}function hAe(n,t){const s={...n,...t},a={};for(const l in s)n[l]!==void 0&&t[l]!==void 0&&(a[l]=TF(n[l])(n[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function pAe(n,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],E=n.indexes[f][l[f]],v=(s=n.values[E])!==null&&s!==void 0?s:0;a[d]=v,l[f]++}return a}const fAe=(n,t)=>{const s=fg.createTransformer(t),a=hR(n),l=hR(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?lU.has(n)&&!l.values.length||lU.has(t)&&!a.values.length?uAe(n,t):UR(MZ(pAe(a,l),l.values),s):lk(n,t)};function UZ(n,t,s){return typeof n=="number"&&typeof t=="number"&&typeof s=="number"?as(n,t,s):TF(n)(n,t)}const mAe=5;function VZ(n,t,s){const a=Math.max(t-mAe,0);return dZ(s-n(a),t-a)}const ws={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},yK=.001;function gAe({duration:n=ws.duration,bounce:t=ws.bounce,velocity:s=ws.velocity,mass:a=ws.mass}){let l,d,f=1-t;f=bf(ws.minDamping,ws.maxDamping,f),n=bf(ws.minDuration,ws.maxDuration,Ef(n)),f<1?(l=T=>{const w=T*f,A=w*n,N=w-s,F=uU(T,f),j=Math.exp(-A);return yK-N/F*j},d=T=>{const A=T*f*n,N=A*s+s,F=Math.pow(f,2)*Math.pow(T,2)*n,j=Math.exp(-A),z=uU(Math.pow(T,2),f);return(-l(T)+yK>0?-1:1)*((N-F)*j)/z}):(l=T=>{const w=Math.exp(-T*n),A=(T-s)*n+1;return-.001+w*A},d=T=>{const w=Math.exp(-T*n),A=(s-T)*(n*n);return w*A});const E=5/n,v=EAe(l,d,E);if(n=_f(n),isNaN(v))return{stiffness:ws.stiffness,damping:ws.damping,duration:n};{const T=Math.pow(v,2)*a;return{stiffness:T,damping:f*2*Math.sqrt(a*T),duration:n}}}const _Ae=12;function EAe(n,t,s){let a=s;for(let l=1;l<_Ae;l++)a=a-n(a)/t(a);return a}function uU(n,t){return n*Math.sqrt(1-t*t)}const yAe=["duration","bounce"],vAe=["stiffness","damping","mass"];function vK(n,t){return t.some(s=>n[s]!==void 0)}function SAe(n){let t={velocity:ws.velocity,stiffness:ws.stiffness,damping:ws.damping,mass:ws.mass,isResolvedFromDuration:!1,...n};if(!vK(n,vAe)&&vK(n,yAe))if(n.visualDuration){const s=n.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*bf(.05,1,1-(n.bounce||0))*Math.sqrt(l);t={...t,mass:ws.mass,stiffness:l,damping:d}}else{const s=gAe(n);t={...t,...s,mass:ws.mass},t.isResolvedFromDuration=!0}return t}function FZ(n=ws.visualDuration,t=ws.bounce){const s=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],f=s.keyframes[s.keyframes.length-1],E={done:!1,value:d},{stiffness:v,damping:T,mass:w,duration:A,velocity:N,isResolvedFromDuration:F}=SAe({...s,velocity:-Ef(s.velocity||0)}),j=N||0,z=T/(2*Math.sqrt(v*w)),H=f-d,te=Ef(Math.sqrt(v/w)),K=Math.abs(H)<5;a||(a=K?ws.restSpeed.granular:ws.restSpeed.default),l||(l=K?ws.restDelta.granular:ws.restDelta.default);let ne;if(z<1){const oe=uU(te,z);ne=ge=>{const ee=Math.exp(-z*te*ge);return f-ee*((j+z*te*H)/oe*Math.sin(oe*ge)+H*Math.cos(oe*ge))}}else if(z===1)ne=oe=>f-Math.exp(-te*oe)*(H+(j+te*H)*oe);else{const oe=te*Math.sqrt(z*z-1);ne=ge=>{const ee=Math.exp(-z*te*ge),Z=Math.min(oe*ge,300);return f-ee*((j+z*te*H)*Math.sinh(Z)+oe*H*Math.cosh(Z))/oe}}const de={calculatedDuration:F&&A||null,next:oe=>{const ge=ne(oe);if(F)E.done=oe>=A;else{let ee=0;z<1&&(ee=oe===0?_f(j):VZ(ne,oe,ge));const Z=Math.abs(ee)<=a,J=Math.abs(f-ge)<=l;E.done=Z&&J}return E.value=E.done?f:ge,E},toString:()=>{const oe=Math.min(rZ(de),nU),ge=iZ(ee=>de.next(oe*ee).value,oe,30);return oe+"ms "+ge}};return de}function SK({keyframes:n,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:E,max:v,restDelta:T=.5,restSpeed:w}){const A=n[0],N={done:!1,value:A},F=Z=>E!==void 0&&Z<E||v!==void 0&&Z>v,j=Z=>E===void 0?v:v===void 0||Math.abs(E-Z)<Math.abs(v-Z)?E:v;let z=s*t;const H=A+z,te=f===void 0?H:f(H);te!==H&&(z=te-A);const K=Z=>-z*Math.exp(-Z/a),ne=Z=>te+K(Z),de=Z=>{const J=K(Z),se=ne(Z);N.done=Math.abs(J)<=T,N.value=N.done?te:se};let oe,ge;const ee=Z=>{F(N.value)&&(oe=Z,ge=FZ({keyframes:[N.value,j(N.value)],velocity:VZ(ne,Z,N.value),damping:l,stiffness:d,restDelta:T,restSpeed:w}))};return ee(0),{calculatedDuration:null,next:Z=>{let J=!1;return!ge&&oe===void 0&&(J=!0,de(Z),ee(Z)),oe!==void 0&&Z>=oe?ge.next(Z-oe):(!J&&de(Z),N)}}}const TAe=MR(.42,0,1,1),bAe=MR(0,0,.58,1),jZ=MR(.42,0,.58,1),wAe=n=>Array.isArray(n)&&typeof n[0]!="number",RAe={linear:Pl,easeIn:TAe,easeInOut:jZ,easeOut:bAe,circIn:_F,circInOut:vZ,circOut:yZ,backIn:gF,backInOut:_Z,backOut:gZ,anticipate:EZ},TK=n=>{if(dF(n)){UQ(n.length===4);const[t,s,a,l]=n;return MR(t,s,a,l)}else if(typeof n=="string")return RAe[n];return n};function CAe(n,t,s){const a=[],l=s||UZ,d=n.length-1;for(let f=0;f<d;f++){let E=l(n[f],n[f+1]);if(t){const v=Array.isArray(t)?t[f]||Pl:t;E=UR(v,E)}a.push(E)}return a}function IAe(n,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=n.length;if(UQ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const f=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),t=[...t].reverse());const E=CAe(t,a,l),v=E.length,T=w=>{if(f&&w<n[0])return t[0];let A=0;if(v>1)for(;A<n.length-2&&!(w<n[A+1]);A++);const N=XS(n[A],n[A+1],w);return E[A](N)};return s?w=>T(bf(n[0],n[d-1],w)):T}function AAe(n,t){const s=n[n.length-1];for(let a=1;a<=t;a++){const l=XS(0,t,a);n.push(as(s,1,l))}}function PAe(n){const t=[0];return AAe(t,n.length-1),t}function OAe(n,t){return n.map(s=>s*t)}function kAe(n,t){return n.map(()=>t||jZ).splice(0,n.length-1)}function uk({duration:n=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=wAe(a)?a.map(TK):TK(a),d={done:!1,value:t[0]},f=OAe(s&&s.length===t.length?s:PAe(t),n),E=IAe(f,t,{ease:Array.isArray(l)?l:kAe(t,l)});return{calculatedDuration:n,next:v=>(d.value=E(v),d.done=v>=n,d)}}const NAe=n=>{const t=({timestamp:s})=>n(s);return{start:()=>Gi.update(t,!0),stop:()=>pg(t),now:()=>Jo.isProcessing?Jo.timestamp:Gh.now()}},DAe={decay:SK,inertia:SK,tween:uk,keyframes:uk,spring:FZ},LAe=n=>n/100;class bF extends xZ{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||SF,E=(v,T)=>this.onKeyframesResolved(v,T);this.resolver=new f(d,E,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,E=uF(s)?s:DAe[s]||uk;let v,T;E!==uk&&typeof t[0]!="number"&&(v=UR(LAe,UZ(t[0],t[1])),t=[0,100]);const w=E({...this.options,keyframes:t});d==="mirror"&&(T=E({...this.options,keyframes:[...t].reverse(),velocity:-f})),w.calculatedDuration===null&&(w.calculatedDuration=rZ(w));const{calculatedDuration:A}=w,N=A+l,F=N*(a+1)-l;return{generator:w,mirroredGenerator:T,mapPercentToKeyframes:v,calculatedDuration:A,resolvedDuration:N,totalDuration:F}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:Z}=this.options;return{done:!0,value:Z[Z.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:E,keyframes:v,calculatedDuration:T,totalDuration:w,resolvedDuration:A}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:F,repeatType:j,repeatDelay:z,onUpdate:H}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-w/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const te=this.currentTime-N*(this.speed>=0?1:-1),K=this.speed>=0?te<0:te>w;this.currentTime=Math.max(te,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let ne=this.currentTime,de=d;if(F){const Z=Math.min(this.currentTime,w)/A;let J=Math.floor(Z),se=Z%1;!se&&Z>=1&&(se=1),se===1&&J--,J=Math.min(J,F+1),!!(J%2)&&(j==="reverse"?(se=1-se,z&&(se-=z/A)):j==="mirror"&&(de=f)),ne=bf(0,1,se)*A}const oe=K?{done:!1,value:v[0]}:de.next(ne);E&&(oe.value=E(oe.value));let{done:ge}=oe;!K&&T!==null&&(ge=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const ee=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ge);return ee&&l!==void 0&&(oe.value=i1(v,this.options,l)),H&&H(oe.value),ee&&this.finish(),oe}get duration(){const{resolved:t}=this;return t?Ef(t.calculatedDuration):0}get time(){return Ef(this.currentTime)}set time(t){t=_f(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=Ef(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=NAe,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const xAe=new Set(["opacity","clipPath","filter","transform"]);function MAe(n,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:E="easeInOut",times:v}={}){const T={[t]:s};v&&(T.offset=v);const w=oZ(E,l);return Array.isArray(w)&&(T.easing=w),n.animate(T,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const UAe=YV(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),dk=10,VAe=2e4;function FAe(n){return uF(n.type)||n.type==="spring"||!sZ(n.ease)}function jAe(n,t){const s=new bF({...t,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<VAe;)a=s.sample(d),l.push(a.value),d+=dk;return{times:void 0,keyframes:l,duration:d-dk,ease:"linear"}}const BZ={anticipate:EZ,backInOut:_Z,circInOut:vZ};function BAe(n){return n in BZ}class bK extends xZ{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new LZ(d,(f,E)=>this.onKeyframesResolved(f,E),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:f,motionValue:E,name:v,startTime:T}=this.options;if(!E.owner||!E.owner.current)return!1;if(typeof d=="string"&&ck()&&BAe(d)&&(d=BZ[d]),FAe(this.options)){const{onComplete:A,onUpdate:N,motionValue:F,element:j,...z}=this.options,H=jAe(t,z);t=H.keyframes,t.length===1&&(t[1]=t[0]),a=H.duration,l=H.times,d=H.ease,f="keyframes"}const w=MAe(E.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return w.startTime=T??this.calcStartTime(),this.pendingTimeline?(oK(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:A}=this.options;E.set(i1(t,this.options,s)),A&&A(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:f,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return Ef(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return Ef(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=_f(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Pl;const{animation:a}=s;oK(a,t)}return Pl}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:f,times:E}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:T,onUpdate:w,onComplete:A,element:N,...F}=this.options,j=new bF({...F,keyframes:a,duration:l,type:d,ease:f,times:E,isGenerator:!0}),z=_f(this.time);T.setWithVelocity(j.sample(z-dk).value,j.sample(z).value,dk)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:f,type:E}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:T}=s.owner.getProps();return UAe()&&a&&xAe.has(a)&&!v&&!T&&!l&&d!=="mirror"&&f!==0&&E!=="inertia"}}const WAe={type:"spring",stiffness:500,damping:25,restSpeed:10},zAe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),GAe={type:"keyframes",duration:.8},HAe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},$Ae=(n,{keyframes:t})=>t.length>2?GAe:NE.has(n)?n.startsWith("scale")?zAe(t[1]):WAe:HAe;function KAe({when:n,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:E,from:v,elapsed:T,...w}){return!!Object.keys(w).length}const wF=(n,t,s,a={},l,d)=>f=>{const E=lF(a,n)||{},v=E.delay||a.delay||0;let{elapsed:T=0}=a;T=T-_f(v);let w={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-T,onUpdate:N=>{t.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{f(),E.onComplete&&E.onComplete()},name:n,motionValue:t,element:d?void 0:l};KAe(E)||(w={...w,...$Ae(n,w)}),w.duration&&(w.duration=_f(w.duration)),w.repeatDelay&&(w.repeatDelay=_f(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let A=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(A=!0)),A&&!d&&t.get()!==void 0){const N=i1(w.keyframes,E);if(N!==void 0)return Gi.update(()=>{w.onUpdate(N),w.onComplete()}),new hIe([])}return!d&&bK.supports(w)?new bK(w):new bF(w)};function qAe({protectedKeys:n,needsAnimating:t},s){const a=n.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function WZ(n,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:f=n.getDefaultTransition(),transitionEnd:E,...v}=t;a&&(f=a);const T=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const A in v){const N=n.getValue(A,(d=n.latestValues[A])!==null&&d!==void 0?d:null),F=v[A];if(F===void 0||w&&qAe(w,A))continue;const j={delay:s,...lF(f||{},A)};let z=!1;if(window.MotionHandoffAnimation){const te=hZ(n);if(te){const K=window.MotionHandoffAnimation(te,A,Gi);K!==null&&(j.startTime=K,z=!0)}}iU(n,A),N.start(wF(A,N,F,n.shouldReduceMotion&&uZ.has(A)?{type:!1}:j,n,z));const H=N.animation;H&&T.push(H)}return E&&Promise.all(T).then(()=>{Gi.update(()=>{E&&CIe(n,E)})}),T}function dU(n,t,s={}){var a;const l=r1(n,t,s.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const f=l?()=>Promise.all(WZ(n,l,s)):()=>Promise.resolve(),E=n.variantChildren&&n.variantChildren.size?(T=0)=>{const{delayChildren:w=0,staggerChildren:A,staggerDirection:N}=d;return YAe(n,t,w+T,A,N,s)}:()=>Promise.resolve(),{when:v}=d;if(v){const[T,w]=v==="beforeChildren"?[f,E]:[E,f];return T().then(()=>w())}else return Promise.all([f(),E(s.delay)])}function YAe(n,t,s=0,a=0,l=1,d){const f=[],E=(n.variantChildren.size-1)*a,v=l===1?(T=0)=>T*a:(T=0)=>E-T*a;return Array.from(n.variantChildren).sort(XAe).forEach((T,w)=>{T.notify("AnimationStart",t),f.push(dU(T,t,{...d,delay:s+v(w)}).then(()=>T.notify("AnimationComplete",t)))}),Promise.all(f)}function XAe(n,t){return n.sortNodePosition(t)}function JAe(n,t,s={}){n.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>dU(n,d,s));a=Promise.all(l)}else if(typeof t=="string")a=dU(n,t,s);else{const l=typeof t=="function"?r1(n,t,s.custom):t;a=Promise.all(WZ(n,l,s))}return a.then(()=>{n.notify("AnimationComplete",t)})}const QAe=JV.length;function zZ(n){if(!n)return;if(!n.isControllingVariants){const s=n.parent?zZ(n.parent)||{}:{};return n.props.initial!==void 0&&(s.initial=n.props.initial),s}const t={};for(let s=0;s<QAe;s++){const a=JV[s],l=n.props[a];(lR(l)||l===!1)&&(t[a]=l)}return t}const ZAe=[...XV].reverse(),ePe=XV.length;function tPe(n){return t=>Promise.all(t.map(({animation:s,options:a})=>JAe(n,s,a)))}function nPe(n){let t=tPe(n),s=wK(),a=!0;const l=v=>(T,w)=>{var A;const N=r1(n,w,v==="exit"?(A=n.presenceContext)===null||A===void 0?void 0:A.custom:void 0);if(N){const{transition:F,transitionEnd:j,...z}=N;T={...T,...z,...j}}return T};function d(v){t=v(n)}function f(v){const{props:T}=n,w=zZ(n.parent)||{},A=[],N=new Set;let F={},j=1/0;for(let H=0;H<ePe;H++){const te=ZAe[H],K=s[te],ne=T[te]!==void 0?T[te]:w[te],de=lR(ne),oe=te===v?K.isActive:null;oe===!1&&(j=H);let ge=ne===w[te]&&ne!==T[te]&&de;if(ge&&a&&n.manuallyAnimateOnMount&&(ge=!1),K.protectedKeys={...F},!K.isActive&&oe===null||!ne&&!K.prevProp||t1(ne)||typeof ne=="boolean")continue;const ee=rPe(K.prevProp,ne);let Z=ee||te===v&&K.isActive&&!ge&&de||H>j&&de,J=!1;const se=Array.isArray(ne)?ne:[ne];let he=se.reduce(l(te),{});oe===!1&&(he={});const{prevResolvedValues:pe={}}=K,le={...pe,...he},Me=we=>{Z=!0,N.has(we)&&(J=!0,N.delete(we)),K.needsAnimating[we]=!0;const Ce=n.getValue(we);Ce&&(Ce.liveStyle=!1)};for(const we in le){const Ce=he[we],ve=pe[we];if(F.hasOwnProperty(we))continue;let Ne=!1;tU(Ce)&&tU(ve)?Ne=!nZ(Ce,ve):Ne=Ce!==ve,Ne?Ce!=null?Me(we):N.add(we):Ce!==void 0&&N.has(we)?Me(we):K.protectedKeys[we]=!0}K.prevProp=ne,K.prevResolvedValues=he,K.isActive&&(F={...F,...he}),a&&n.blockInitialAnimation&&(Z=!1),Z&&(!(ge&&ee)||J)&&A.push(...se.map(we=>({animation:we,options:{type:te}})))}if(N.size){const H={};N.forEach(te=>{const K=n.getBaseTarget(te),ne=n.getValue(te);ne&&(ne.liveStyle=!0),H[te]=K??null}),A.push({animation:H})}let z=!!A.length;return a&&(T.initial===!1||T.initial===T.animate)&&!n.manuallyAnimateOnMount&&(z=!1),a=!1,z?t(A):Promise.resolve()}function E(v,T){var w;if(s[v].isActive===T)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(N=>{var F;return(F=N.animationState)===null||F===void 0?void 0:F.setActive(v,T)}),s[v].isActive=T;const A=f(v);for(const N in s)s[N].protectedKeys={};return A}return{animateChanges:f,setActive:E,setAnimateFunction:d,getState:()=>s,reset:()=>{s=wK(),a=!0}}}function rPe(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!nZ(t,n):!1}function Q_(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function wK(){return{animate:Q_(!0),whileInView:Q_(),whileHover:Q_(),whileTap:Q_(),whileDrag:Q_(),whileFocus:Q_(),exit:Q_()}}class bg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class iPe extends bg{constructor(t){super(t),t.animationState||(t.animationState=nPe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();t1(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let sPe=0;class oPe extends bg{constructor(){super(...arguments),this.id=sPe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const aPe={animation:{Feature:iPe},exit:{Feature:oPe}};function pR(n,t,s,a={passive:!0}){return n.addEventListener(t,s,a),()=>n.removeEventListener(t,s)}function VR(n){return{point:{x:n.pageX,y:n.pageY}}}const cPe=n=>t=>hF(t)&&n(t,VR(t));function jw(n,t,s,a){return pR(n,t,cPe(s),a)}const RK=(n,t)=>Math.abs(n-t);function lPe(n,t){const s=RK(n.x,t.x),a=RK(n.y,t.y);return Math.sqrt(s**2+a**2)}class GZ{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=XM(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,F=lPe(A.offset,{x:0,y:0})>=3;if(!N&&!F)return;const{point:j}=A,{timestamp:z}=Jo;this.history.push({...j,timestamp:z});const{onStart:H,onMove:te}=this.handlers;N||(H&&H(this.lastMoveEvent,A),this.startEvent=this.lastMoveEvent),te&&te(this.lastMoveEvent,A)},this.handlePointerMove=(A,N)=>{this.lastMoveEvent=A,this.lastMoveEventInfo=YM(N,this.transformPagePoint),Gi.update(this.updatePoint,!0)},this.handlePointerUp=(A,N)=>{this.end();const{onEnd:F,onSessionEnd:j,resumeAnimation:z}=this.handlers;if(this.dragSnapToOrigin&&z&&z(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const H=XM(A.type==="pointercancel"?this.lastMoveEventInfo:YM(N,this.transformPagePoint),this.history);this.startEvent&&F&&F(A,H),j&&j(A,H)},!hF(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const f=VR(t),E=YM(f,this.transformPagePoint),{point:v}=E,{timestamp:T}=Jo;this.history=[{...v,timestamp:T}];const{onSessionStart:w}=s;w&&w(t,XM(E,this.history)),this.removeListeners=UR(jw(this.contextWindow,"pointermove",this.handlePointerMove),jw(this.contextWindow,"pointerup",this.handlePointerUp),jw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),pg(this.updatePoint)}}function YM(n,t){return t?{point:t(n.point)}:n}function CK(n,t){return{x:n.x-t.x,y:n.y-t.y}}function XM({point:n},t){return{point:n,delta:CK(n,HZ(t)),offset:CK(n,uPe(t)),velocity:dPe(t,.1)}}function uPe(n){return n[0]}function HZ(n){return n[n.length-1]}function dPe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=HZ(n);for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>_f(t)));)s--;if(!a)return{x:0,y:0};const d=Ef(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const $Z=1e-4,hPe=1-$Z,pPe=1+$Z,KZ=.01,fPe=0-KZ,mPe=0+KZ;function Ol(n){return n.max-n.min}function gPe(n,t,s){return Math.abs(n-t)<=s}function IK(n,t,s,a=.5){n.origin=a,n.originPoint=as(t.min,t.max,n.origin),n.scale=Ol(s)/Ol(t),n.translate=as(s.min,s.max,n.origin)-n.originPoint,(n.scale>=hPe&&n.scale<=pPe||isNaN(n.scale))&&(n.scale=1),(n.translate>=fPe&&n.translate<=mPe||isNaN(n.translate))&&(n.translate=0)}function Bw(n,t,s,a){IK(n.x,t.x,s.x,a?a.originX:void 0),IK(n.y,t.y,s.y,a?a.originY:void 0)}function AK(n,t,s){n.min=s.min+t.min,n.max=n.min+Ol(t)}function _Pe(n,t,s){AK(n.x,t.x,s.x),AK(n.y,t.y,s.y)}function PK(n,t,s){n.min=t.min-s.min,n.max=n.min+Ol(t)}function Ww(n,t,s){PK(n.x,t.x,s.x),PK(n.y,t.y,s.y)}function EPe(n,{min:t,max:s},a){return t!==void 0&&n<t?n=a?as(t,n,a.min):Math.max(n,t):s!==void 0&&n>s&&(n=a?as(s,n,a.max):Math.min(n,s)),n}function OK(n,t,s){return{min:t!==void 0?n.min+t:void 0,max:s!==void 0?n.max+s-(n.max-n.min):void 0}}function yPe(n,{top:t,left:s,bottom:a,right:l}){return{x:OK(n.x,s,l),y:OK(n.y,t,a)}}function kK(n,t){let s=t.min-n.min,a=t.max-n.max;return t.max-t.min<n.max-n.min&&([s,a]=[a,s]),{min:s,max:a}}function vPe(n,t){return{x:kK(n.x,t.x),y:kK(n.y,t.y)}}function SPe(n,t){let s=.5;const a=Ol(n),l=Ol(t);return l>a?s=XS(t.min,t.max-a,n.min):a>l&&(s=XS(n.min,n.max-l,t.min)),bf(0,1,s)}function TPe(n,t){const s={};return t.min!==void 0&&(s.min=t.min-n.min),t.max!==void 0&&(s.max=t.max-n.min),s}const hU=.35;function bPe(n=hU){return n===!1?n=0:n===!0&&(n=hU),{x:NK(n,"left","right"),y:NK(n,"top","bottom")}}function NK(n,t,s){return{min:DK(n,t),max:DK(n,s)}}function DK(n,t){return typeof n=="number"?n:n[t]||0}const LK=()=>({translate:0,scale:1,origin:0,originPoint:0}),bS=()=>({x:LK(),y:LK()}),xK=()=>({min:0,max:0}),Ds=()=>({x:xK(),y:xK()});function Su(n){return[n("x"),n("y")]}function qZ({top:n,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:n,max:a}}}function wPe({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function RPe(n,t){if(!t)return n;const s=t({x:n.left,y:n.top}),a=t({x:n.right,y:n.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function JM(n){return n===void 0||n===1}function pU({scale:n,scaleX:t,scaleY:s}){return!JM(n)||!JM(t)||!JM(s)}function eE(n){return pU(n)||YZ(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function YZ(n){return MK(n.x)||MK(n.y)}function MK(n){return n&&n!=="0%"}function hk(n,t,s){const a=n-s,l=t*a;return s+l}function UK(n,t,s,a,l){return l!==void 0&&(n=hk(n,l,a)),hk(n,s,a)+t}function fU(n,t=0,s=1,a,l){n.min=UK(n.min,t,s,a,l),n.max=UK(n.max,t,s,a,l)}function XZ(n,{x:t,y:s}){fU(n.x,t.translate,t.scale,t.originPoint),fU(n.y,s.translate,s.scale,s.originPoint)}const VK=.999999999999,FK=1.0000000000001;function CPe(n,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,f;for(let E=0;E<l;E++){d=s[E],f=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&RS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,XZ(n,f)),a&&eE(d.latestValues)&&RS(n,d.latestValues))}t.x<FK&&t.x>VK&&(t.x=1),t.y<FK&&t.y>VK&&(t.y=1)}function wS(n,t){n.min=n.min+t,n.max=n.max+t}function jK(n,t,s,a,l=.5){const d=as(n.min,n.max,l);fU(n,t,s,d,a)}function RS(n,t){jK(n.x,t.x,t.scaleX,t.scale,t.originX),jK(n.y,t.y,t.scaleY,t.scale,t.originY)}function JZ(n,t){return qZ(RPe(n.getBoundingClientRect(),t))}function IPe(n,t,s){const a=JZ(n,s),{scroll:l}=t;return l&&(wS(a.x,l.offset.x),wS(a.y,l.offset.y)),a}const QZ=({current:n})=>n?n.ownerDocument.defaultView:null,APe=new WeakMap;class PPe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ds(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:A}=this.getProps();A?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(VR(w).point)},d=(w,A)=>{const{drag:N,dragPropagation:F,onDragStart:j}=this.getProps();if(N&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=SIe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Su(H=>{let te=this.getAxisMotionValue(H).get()||0;if(zh.test(te)){const{projection:K}=this.visualElement;if(K&&K.layout){const ne=K.layout.layoutBox[H];ne&&(te=Ol(ne)*(parseFloat(te)/100))}}this.originPoint[H]=te}),j&&Gi.postRender(()=>j(w,A)),iU(this.visualElement,"transform");const{animationState:z}=this.visualElement;z&&z.setActive("whileDrag",!0)},f=(w,A)=>{const{dragPropagation:N,dragDirectionLock:F,onDirectionLock:j,onDrag:z}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:H}=A;if(F&&this.currentDirection===null){this.currentDirection=OPe(H),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",A.point,H),this.updateAxis("y",A.point,H),this.visualElement.render(),z&&z(w,A)},E=(w,A)=>this.stop(w,A),v=()=>Su(w=>{var A;return this.getAnimationState(w)==="paused"&&((A=this.getAxisMotionValue(w).animation)===null||A===void 0?void 0:A.play())}),{dragSnapToOrigin:T}=this.getProps();this.panSession=new GZ(t,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:E,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,contextWindow:QZ(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Gi.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!rO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let f=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(f=EPe(f,this.constraints[t],this.elastic[t])),d.set(f)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&SS(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=yPe(l.layoutBox,s):this.constraints=!1,this.elastic=bPe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Su(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=TPe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!SS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=IPe(a,l.root,this.visualElement.getTransformPagePoint());let f=vPe(l.layout.layoutBox,d);if(s){const E=s(wPe(f));this.hasMutatedConstraints=!!E,E&&(f=qZ(E))}return f}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:E}=this.getProps(),v=this.constraints||{},T=Su(w=>{if(!rO(w,s,this.currentDirection))return;let A=v&&v[w]||{};f&&(A={min:0,max:0});const N=l?200:1e6,F=l?40:1e7,j={type:"inertia",velocity:a?t[w]:0,bounceStiffness:N,bounceDamping:F,timeConstant:750,restDelta:1,restSpeed:10,...d,...A};return this.startAxisValueAnimation(w,j)});return Promise.all(T).then(E)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return iU(this.visualElement,t),a.start(wF(t,a,0,s,this.visualElement,!1))}stopAnimation(){Su(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Su(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){Su(s=>{const{drag:a}=this.getProps();if(!rO(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:f,max:E}=l.layout.layoutBox[s];d.set(t[s]-as(f,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!SS(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Su(f=>{const E=this.getAxisMotionValue(f);if(E&&this.constraints!==!1){const v=E.get();l[f]=SPe({min:v,max:v},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Su(f=>{if(!rO(f,t,null))return;const E=this.getAxisMotionValue(f),{min:v,max:T}=this.constraints[f];E.set(as(v,T,l[f]))})}addListeners(){if(!this.visualElement.current)return;APe.set(this.visualElement,this);const t=this.visualElement.current,s=jw(t,"pointerdown",v=>{const{drag:T,dragListener:w=!0}=this.getProps();T&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();SS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Gi.read(a);const f=pR(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:T})=>{this.isDragging&&T&&(Su(w=>{const A=this.getAxisMotionValue(w);A&&(this.originPoint[w]+=v[w].translate,A.set(A.get()+v[w].translate))}),this.visualElement.render())});return()=>{f(),s(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=hU,dragMomentum:E=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:E}}}function rO(n,t,s){return(t===!0||t===n)&&(s===null||s===n)}function OPe(n,t=10){let s=null;return Math.abs(n.y)>t?s="y":Math.abs(n.x)>t&&(s="x"),s}class kPe extends bg{constructor(t){super(t),this.removeGroupControls=Pl,this.removeListeners=Pl,this.controls=new PPe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Pl}unmount(){this.removeGroupControls(),this.removeListeners()}}const BK=n=>(t,s)=>{n&&Gi.postRender(()=>n(t,s))};class NPe extends bg{constructor(){super(...arguments),this.removePointerDownListener=Pl}onPointerDown(t){this.session=new GZ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:QZ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:BK(t),onStart:BK(s),onMove:a,onEnd:(d,f)=>{delete this.session,l&&Gi.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=jw(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const xO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function WK(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const ew={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(Nn.test(n))n=parseFloat(n);else return n;const s=WK(n,t.target.x),a=WK(n,t.target.y);return`${s}% ${a}%`}},DPe={correct:(n,{treeScale:t,projectionDelta:s})=>{const a=n,l=fg.parse(n);if(l.length>5)return a;const d=fg.createTransformer(n),f=typeof l[0]!="number"?1:0,E=s.x.scale*t.x,v=s.y.scale*t.y;l[0+f]/=E,l[1+f]/=v;const T=as(E,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=T),typeof l[3+f]=="number"&&(l[3+f]/=T),d(l)}};class LPe extends L.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;eIe(xPe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),xO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||t.layoutDependency!==s||s===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?f.promote():f.relegate()||Gi.postRender(()=>{const E=f.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),ZV.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function ZZ(n){const[t,s]=KV(),a=L.useContext(GV);return I.jsx(LPe,{...n,layoutGroup:a,switchLayoutGroup:L.useContext(zQ),isPresent:t,safeToRemove:s})}const xPe={borderRadius:{...ew,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ew,borderTopRightRadius:ew,borderBottomLeftRadius:ew,borderBottomRightRadius:ew,boxShadow:DPe};function MPe(n,t,s){const a=ka(n)?n:dR(n);return a.start(wF("",a,t,s)),a.animation}function UPe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const VPe=(n,t)=>n.depth-t.depth;class FPe{constructor(){this.children=[],this.isDirty=!1}add(t){pF(this.children,t),this.isDirty=!0}remove(t){fF(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(VPe),this.isDirty=!1,this.children.forEach(t)}}function jPe(n,t){const s=Gh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(pg(a),n(d-t))};return Gi.read(a,!0),()=>pg(a)}const eee=["TopLeft","TopRight","BottomLeft","BottomRight"],BPe=eee.length,zK=n=>typeof n=="string"?parseFloat(n):n,GK=n=>typeof n=="number"||Nn.test(n);function WPe(n,t,s,a,l,d){l?(n.opacity=as(0,s.opacity!==void 0?s.opacity:1,zPe(a)),n.opacityExit=as(t.opacity!==void 0?t.opacity:1,0,GPe(a))):d&&(n.opacity=as(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let f=0;f<BPe;f++){const E=`border${eee[f]}Radius`;let v=HK(t,E),T=HK(s,E);if(v===void 0&&T===void 0)continue;v||(v=0),T||(T=0),v===0||T===0||GK(v)===GK(T)?(n[E]=Math.max(as(zK(v),zK(T),a),0),(zh.test(T)||zh.test(v))&&(n[E]+="%")):n[E]=T}(t.rotate||s.rotate)&&(n.rotate=as(t.rotate||0,s.rotate||0,a))}function HK(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const zPe=tee(0,.5,yZ),GPe=tee(.5,.95,Pl);function tee(n,t,s){return a=>a<n?0:a>t?1:s(XS(n,t,a))}function $K(n,t){n.min=t.min,n.max=t.max}function Eu(n,t){$K(n.x,t.x),$K(n.y,t.y)}function KK(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function qK(n,t,s,a,l){return n-=t,n=hk(n,1/s,a),l!==void 0&&(n=hk(n,1/l,a)),n}function HPe(n,t=0,s=1,a=.5,l,d=n,f=n){if(zh.test(t)&&(t=parseFloat(t),t=as(f.min,f.max,t/100)-f.min),typeof t!="number")return;let E=as(d.min,d.max,a);n===d&&(E-=t),n.min=qK(n.min,t,s,E,l),n.max=qK(n.max,t,s,E,l)}function YK(n,t,[s,a,l],d,f){HPe(n,t[s],t[a],t[l],t.scale,d,f)}const $Pe=["x","scaleX","originX"],KPe=["y","scaleY","originY"];function XK(n,t,s,a){YK(n.x,t,$Pe,s?s.x:void 0,a?a.x:void 0),YK(n.y,t,KPe,s?s.y:void 0,a?a.y:void 0)}function JK(n){return n.translate===0&&n.scale===1}function nee(n){return JK(n.x)&&JK(n.y)}function QK(n,t){return n.min===t.min&&n.max===t.max}function qPe(n,t){return QK(n.x,t.x)&&QK(n.y,t.y)}function ZK(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function ree(n,t){return ZK(n.x,t.x)&&ZK(n.y,t.y)}function eq(n){return Ol(n.x)/Ol(n.y)}function tq(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class YPe{constructor(){this.members=[]}add(t){pF(this.members,t),t.scheduleRender()}remove(t){if(fF(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function XPe(n,t,s){let a="";const l=n.x.translate/t.x,d=n.y.translate/t.y,f=(s==null?void 0:s.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:T,rotate:w,rotateX:A,rotateY:N,skewX:F,skewY:j}=s;T&&(a=`perspective(${T}px) ${a}`),w&&(a+=`rotate(${w}deg) `),A&&(a+=`rotateX(${A}deg) `),N&&(a+=`rotateY(${N}deg) `),F&&(a+=`skewX(${F}deg) `),j&&(a+=`skewY(${j}deg) `)}const E=n.x.scale*t.x,v=n.y.scale*t.y;return(E!==1||v!==1)&&(a+=`scale(${E}, ${v})`),a||"none"}const tE={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},bw=typeof window<"u"&&window.MotionDebug!==void 0,QM=["","X","Y","Z"],JPe={visibility:"hidden"},nq=1e3;let QPe=0;function ZM(n,t,s,a){const{latestValues:l}=t;l[n]&&(s[n]=l[n],t.setStaticValue(n,0),a&&(a[n]=0))}function iee(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const s=hZ(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(s,"transform",Gi,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&iee(a)}function see({attachResizeListener:n,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},E=t==null?void 0:t()){this.id=QPe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,bw&&(tE.totalNodes=tE.resolvedTargetDeltas=tE.recalculatedProjection=0),this.nodes.forEach(tOe),this.nodes.forEach(oOe),this.nodes.forEach(aOe),this.nodes.forEach(nOe),bw&&window.MotionDebug.record(tE)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new FPe)}addEventListener(f,E){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new mF),this.eventHandlers.get(f).add(E)}notifyListeners(f,...E){const v=this.eventHandlers.get(f);v&&v.notify(...E)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=UPe(f),this.instance=f;const{layoutId:v,layout:T,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(T||v)&&(this.isLayoutDirty=!0),n){let A;const N=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,A&&A(),A=jPe(N,250),xO.hasAnimatedSinceResize&&(xO.hasAnimatedSinceResize=!1,this.nodes.forEach(iq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||T)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:N,hasRelativeTargetChanged:F,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const z=this.options.transition||w.getDefaultTransition()||hOe,{onLayoutAnimationStart:H,onLayoutAnimationComplete:te}=w.getProps(),K=!this.targetLayout||!ree(this.targetLayout,j)||F,ne=!N&&F;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ne||N&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(A,ne);const de={...lF(z,"layout"),onPlay:H,onComplete:te};(w.shouldReduceMotion||this.options.layoutRoot)&&(de.delay=0,de.type=!1),this.startAnimation(de)}else N||iq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,pg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(cOe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&iee(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const A=this.path[w];A.shouldResetTransform=!0,A.updateScroll("snapshot"),A.options.layoutRoot&&A.willUpdate(!1)}const{layoutId:E,layout:v}=this.options;if(E===void 0&&!v)return;const T=this.getTransformTemplate();this.prevTransformTemplateValue=T?T(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(rq);return}this.isUpdating||this.nodes.forEach(iOe),this.isUpdating=!1,this.nodes.forEach(sOe),this.nodes.forEach(ZPe),this.nodes.forEach(eOe),this.clearAllSnapshots();const E=Gh.now();Jo.delta=bf(0,1e3/60,E-Jo.timestamp),Jo.timestamp=E,Jo.isProcessing=!0,GM.update.process(Jo),GM.preRender.process(Jo),GM.render.process(Jo),Jo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,ZV.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(rOe),this.sharedNodes.forEach(lOe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Gi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Gi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ds(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(E=!1),E){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!nee(this.projectionDelta),v=this.getTransformTemplate(),T=v?v(this.latestValues,""):void 0,w=T!==this.prevTransformTemplateValue;f&&(E||eE(this.latestValues)||w)&&(l(this.instance,T),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const E=this.measurePageBox();let v=this.removeElementScroll(E);return f&&(v=this.removeTransform(v)),pOe(v),{animationId:this.root.animationId,measuredBox:E,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:E}=this.options;if(!E)return Ds();const v=E.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(fOe))){const{scroll:w}=this.root;w&&(wS(v.x,w.offset.x),wS(v.y,w.offset.y))}return v}removeElementScroll(f){var E;const v=Ds();if(Eu(v,f),!((E=this.scroll)===null||E===void 0)&&E.wasRoot)return v;for(let T=0;T<this.path.length;T++){const w=this.path[T],{scroll:A,options:N}=w;w!==this.root&&A&&N.layoutScroll&&(A.wasRoot&&Eu(v,f),wS(v.x,A.offset.x),wS(v.y,A.offset.y))}return v}applyTransform(f,E=!1){const v=Ds();Eu(v,f);for(let T=0;T<this.path.length;T++){const w=this.path[T];!E&&w.options.layoutScroll&&w.scroll&&w!==w.root&&RS(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),eE(w.latestValues)&&RS(v,w.latestValues)}return eE(this.latestValues)&&RS(v,this.latestValues),v}removeTransform(f){const E=Ds();Eu(E,f);for(let v=0;v<this.path.length;v++){const T=this.path[v];if(!T.instance||!eE(T.latestValues))continue;pU(T.latestValues)&&T.updateSnapshot();const w=Ds(),A=T.measurePageBox();Eu(w,A),XK(E,T.latestValues,T.snapshot?T.snapshot.layoutBox:void 0,w)}return eE(this.latestValues)&&XK(E,this.latestValues),E}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Jo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var E;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const T=!!this.resumingFrom||this!==v;if(!(f||T&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:N}=this.options;if(!(!this.layout||!(A||N))){if(this.resolvedRelativeTargetAt=Jo.timestamp,!this.targetDelta&&!this.relativeTarget){const F=this.getClosestProjectingParent();F&&F.layout&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ds(),this.relativeTargetOrigin=Ds(),Ww(this.relativeTargetOrigin,this.layout.layoutBox,F.layout.layoutBox),Eu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ds(),this.targetWithTransforms=Ds()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),_Pe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Eu(this.target,this.layout.layoutBox),XZ(this.target,this.targetDelta)):Eu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const F=this.getClosestProjectingParent();F&&!!F.resumingFrom==!!this.resumingFrom&&!F.options.layoutScroll&&F.target&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ds(),this.relativeTargetOrigin=Ds(),Ww(this.relativeTargetOrigin,this.target,F.target),Eu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}bw&&tE.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||pU(this.parent.latestValues)||YZ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const E=this.getLead(),v=!!this.resumingFrom||this!==E;let T=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(T=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(T=!1),this.resolvedRelativeTargetAt===Jo.timestamp&&(T=!1),T)return;const{layout:w,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||A))return;Eu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,F=this.treeScale.y;CPe(this.layoutCorrected,this.treeScale,this.path,v),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=Ds());const{target:j}=E;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(KK(this.prevProjectionDelta.x,this.projectionDelta.x),KK(this.prevProjectionDelta.y,this.projectionDelta.y)),Bw(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==F||!tq(this.projectionDelta.x,this.prevProjectionDelta.x)||!tq(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j)),bw&&tE.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var E;if((E=this.options.visualElement)===null||E===void 0||E.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=bS(),this.projectionDelta=bS(),this.projectionDeltaWithTransform=bS()}setAnimationOrigin(f,E=!1){const v=this.snapshot,T=v?v.latestValues:{},w={...this.latestValues},A=bS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=Ds(),F=v?v.source:void 0,j=this.layout?this.layout.source:void 0,z=F!==j,H=this.getStack(),te=!H||H.members.length<=1,K=!!(z&&!te&&this.options.crossfade===!0&&!this.path.some(dOe));this.animationProgress=0;let ne;this.mixTargetDelta=de=>{const oe=de/1e3;sq(A.x,f.x,oe),sq(A.y,f.y,oe),this.setTargetDelta(A),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ww(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),uOe(this.relativeTarget,this.relativeTargetOrigin,N,oe),ne&&qPe(this.relativeTarget,ne)&&(this.isProjectionDirty=!1),ne||(ne=Ds()),Eu(ne,this.relativeTarget)),z&&(this.animationValues=w,WPe(w,T,this.latestValues,oe,K,te)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=oe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(pg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Gi.update(()=>{xO.hasAnimatedSinceResize=!0,this.currentAnimation=MPe(0,nq,{...f,onUpdate:E=>{this.mixTargetDelta(E),f.onUpdate&&f.onUpdate(E)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(nq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:E,target:v,layout:T,latestValues:w}=f;if(!(!E||!v||!T)){if(this!==f&&this.layout&&T&&oee(this.options.animationType,this.layout.layoutBox,T.layoutBox)){v=this.target||Ds();const A=Ol(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+A;const N=Ol(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+N}Eu(E,v),RS(E,w),Bw(this.projectionDeltaWithTransform,this.layoutCorrected,E,w)}}registerSharedNode(f,E){this.sharedNodes.has(f)||this.sharedNodes.set(f,new YPe),this.sharedNodes.get(f).add(E);const T=E.options.initialPromotionConfig;E.promote({transition:T?T.transition:void 0,preserveFollowOpacity:T&&T.shouldPreserveFollowOpacity?T.shouldPreserveFollowOpacity(E):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:E}=this.options;return E?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:E}=this.options;return E?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:E,preserveFollowOpacity:v}={}){const T=this.getStack();T&&T.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let E=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(E=!0),!E)return;const T={};v.z&&ZM("z",f,T,this.animationValues);for(let w=0;w<QM.length;w++)ZM(`rotate${QM[w]}`,f,T,this.animationValues),ZM(`skew${QM[w]}`,f,T,this.animationValues);f.render();for(const w in T)f.setStaticValue(w,T[w]),this.animationValues&&(this.animationValues[w]=T[w]);f.scheduleRender()}getProjectionStyles(f){var E,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return JPe;const T={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,T.opacity="",T.pointerEvents=DO(f==null?void 0:f.pointerEvents)||"",T.transform=w?w(this.latestValues,""):"none",T;const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){const z={};return this.options.layoutId&&(z.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,z.pointerEvents=DO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!eE(this.latestValues)&&(z.transform=w?w({},""):"none",this.hasProjected=!1),z}const N=A.animationValues||A.latestValues;this.applyTransformsToTarget(),T.transform=XPe(this.projectionDeltaWithTransform,this.treeScale,N),w&&(T.transform=w(N,T.transform));const{x:F,y:j}=this.projectionDelta;T.transformOrigin=`${F.origin*100}% ${j.origin*100}% 0`,A.animationValues?T.opacity=A===this?(v=(E=N.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:T.opacity=A===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const z in ak){if(N[z]===void 0)continue;const{correct:H,applyTo:te}=ak[z],K=T.transform==="none"?N[z]:H(N[z],A);if(te){const ne=te.length;for(let de=0;de<ne;de++)T[te[de]]=K}else T[z]=K}return this.options.layoutId&&(T.pointerEvents=A===this?DO(f==null?void 0:f.pointerEvents)||"":"none"),T}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var E;return(E=f.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(rq),this.root.sharedNodes.clear()}}}function ZPe(n){n.updateLayout()}function eOe(n){var t;const s=((t=n.resumeFrom)===null||t===void 0?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&s&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,f=s.source!==n.layout.source;d==="size"?Su(A=>{const N=f?s.measuredBox[A]:s.layoutBox[A],F=Ol(N);N.min=a[A].min,N.max=N.min+F}):oee(d,s.layoutBox,a)&&Su(A=>{const N=f?s.measuredBox[A]:s.layoutBox[A],F=Ol(a[A]);N.max=N.min+F,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[A].max=n.relativeTarget[A].min+F)});const E=bS();Bw(E,a,s.layoutBox);const v=bS();f?Bw(v,n.applyTransform(l,!0),s.measuredBox):Bw(v,a,s.layoutBox);const T=!nee(E);let w=!1;if(!n.resumeFrom){const A=n.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:N,layout:F}=A;if(N&&F){const j=Ds();Ww(j,s.layoutBox,N.layoutBox);const z=Ds();Ww(z,a,F.layoutBox),ree(j,z)||(w=!0),A.options.layoutRoot&&(n.relativeTarget=z,n.relativeTargetOrigin=j,n.relativeParent=A)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:v,layoutDelta:E,hasLayoutChanged:T,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function tOe(n){bw&&tE.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function nOe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function rOe(n){n.clearSnapshot()}function rq(n){n.clearMeasurements()}function iOe(n){n.isLayoutDirty=!1}function sOe(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function iq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function oOe(n){n.resolveTargetDelta()}function aOe(n){n.calcProjection()}function cOe(n){n.resetSkewAndRotation()}function lOe(n){n.removeLeadSnapshot()}function sq(n,t,s){n.translate=as(t.translate,0,s),n.scale=as(t.scale,1,s),n.origin=t.origin,n.originPoint=t.originPoint}function oq(n,t,s,a){n.min=as(t.min,s.min,a),n.max=as(t.max,s.max,a)}function uOe(n,t,s,a){oq(n.x,t.x,s.x,a),oq(n.y,t.y,s.y,a)}function dOe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const hOe={duration:.45,ease:[.4,0,.1,1]},aq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),cq=aq("applewebkit/")&&!aq("chrome/")?Math.round:Pl;function lq(n){n.min=cq(n.min),n.max=cq(n.max)}function pOe(n){lq(n.x),lq(n.y)}function oee(n,t,s){return n==="position"||n==="preserve-aspect"&&!gPe(eq(t),eq(s),.2)}function fOe(n){var t;return n!==n.root&&((t=n.scroll)===null||t===void 0?void 0:t.wasRoot)}const mOe=see({attachResizeListener:(n,t)=>pR(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),e2={current:void 0},aee=see({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!e2.current){const n=new mOe({});n.mount(window),n.setOptions({layoutScroll:!0}),e2.current=n}return e2.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),gOe={pan:{Feature:NPe},drag:{Feature:kPe,ProjectionNode:aee,MeasureLayout:ZZ}};function uq(n,t,s){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&Gi.postRender(()=>d(t,VR(t)))}class _Oe extends bg{mount(){const{current:t}=this.node;t&&(this.unmount=gIe(t,s=>(uq(this.node,s,"Start"),a=>uq(this.node,a,"End"))))}unmount(){}}class EOe extends bg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=UR(pR(this.node.current,"focus",()=>this.onFocus()),pR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function dq(n,t,s){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&Gi.postRender(()=>d(t,VR(t)))}class yOe extends bg{mount(){const{current:t}=this.node;t&&(this.unmount=vIe(t,s=>(dq(this.node,s,"Start"),(a,{success:l})=>dq(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const mU=new WeakMap,t2=new WeakMap,vOe=n=>{const t=mU.get(n.target);t&&t(n)},SOe=n=>{n.forEach(vOe)};function TOe({root:n,...t}){const s=n||document;t2.has(s)||t2.set(s,{});const a=t2.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(SOe,{root:n,...t})),a[l]}function bOe(n,t,s){const a=TOe(t);return mU.set(n,s),a.observe(n),()=>{mU.delete(n),a.unobserve(n)}}const wOe={some:0,all:1};class ROe extends bg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,f={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:wOe[l]},E=v=>{const{isIntersecting:T}=v;if(this.isInView===T||(this.isInView=T,d&&!T&&this.hasEnteredView))return;T&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",T);const{onViewportEnter:w,onViewportLeave:A}=this.node.getProps(),N=T?w:A;N&&N(v)};return bOe(this.node.current,f,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(COe(t,s))&&this.startObserver()}unmount(){}}function COe({viewport:n={}},{viewport:t={}}={}){return s=>n[s]!==t[s]}const IOe={inView:{Feature:ROe},tap:{Feature:yOe},focus:{Feature:EOe},hover:{Feature:_Oe}},AOe={layout:{ProjectionNode:aee,MeasureLayout:ZZ}},gU={current:null},cee={current:!1};function POe(){if(cee.current=!0,!!qV)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>gU.current=n.matches;n.addListener(t),t()}else gU.current=!1}const OOe=[...DZ,Ia,fg],kOe=n=>OOe.find(NZ(n)),hq=new WeakMap;function NOe(n,t,s){for(const a in t){const l=t[a],d=s[a];if(ka(l))n.addValue(a,l);else if(ka(d))n.addValue(a,dR(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,dR(f!==void 0?f:l,{owner:n}))}}for(const a in s)t[a]===void 0&&n.removeValue(a);return t}const pq=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class DOe{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=SF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const F=Gh.now();this.renderScheduledAt<F&&(this.renderScheduledAt=F,Gi.render(this.render,!1,!0))};const{latestValues:v,renderState:T,onUpdate:w}=f;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=s.initial?{...v}:{},this.renderState=T,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=n1(s),this.isVariantNode=BQ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:A,...N}=this.scrapeMotionValuesFromProps(s,{},this);for(const F in N){const j=N[F];v[F]!==void 0&&ka(j)&&j.set(v[F],!1)}}mount(t){this.current=t,hq.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),cee.current||POe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:gU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){hq.delete(this.current),this.projection&&this.projection.unmount(),pg(this.notifyUpdate),pg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=NE.has(t),l=s.on("change",E=>{this.latestValues[t]=E,this.props.onUpdate&&Gi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),f&&f(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in JS){const s=JS[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ds()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<pq.length;a++){const l=pq[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=t[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=NOe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=dR(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(OZ(l)||SZ(l))?l=parseFloat(l):!kOe(l)&&fg.test(s)&&(l=IZ(t,s)),this.setBaseTarget(t,ka(l)?l.get():l)),ka(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=tF(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);f&&(l=f[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!ka(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new mF),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class lee extends DOe{constructor(){super(...arguments),this.KeyframeResolver=LZ}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ka(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function LOe(n){return window.getComputedStyle(n)}class xOe extends lee{constructor(){super(...arguments),this.type="html",this.renderInstance=XQ}readValueFromInstance(t,s){if(NE.has(s)){const a=vF(s);return a&&a.default||0}else{const a=LOe(t),l=(KQ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return JZ(t,s)}build(t,s,a){iF(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return cF(t,s,a)}}class MOe extends lee{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ds}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(NE.has(s)){const a=vF(s);return a&&a.default||0}return s=JQ.has(s)?s:QV(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return eZ(t,s,a)}build(t,s,a){sF(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){QQ(t,s,a,l)}mount(t){this.isSVGTag=aF(t.tagName),super.mount(t)}}const UOe=(n,t)=>eF(n)?new MOe(t):new xOe(t,{allowProjection:n!==L.Fragment}),VOe=lIe({...aPe,...IOe,...gOe,...AOe},UOe),kf=wCe(VOe),FOe=(n,t)=>n.find(s=>s.id===t);function fq(n,t){const s=uee(n,t),a=s?n[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function uee(n,t){for(const[s,a]of Object.entries(n))if(FOe(a,t))return s}function jOe(n){const t=n.includes("right"),s=n.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function BOe(n){const s=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:f}}var WOe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,zOe=CQ(function(n){return WOe.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),GOe=zOe,HOe=function(t){return t!=="theme"},mq=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?GOe:HOe},gq=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(f){return t.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},$Oe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return MV(s,a,l),kQ(function(){return UV(s,a,l)}),null},KOe=function n(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,f;s!==void 0&&(d=s.label,f=s.target);var E=gq(t,s,a),v=E||mq(l),T=!v("as");return function(){var w=arguments,A=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&A.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)A.push.apply(A,w);else{var N=w[0];A.push(N[0]);for(var F=w.length,j=1;j<F;j++)A.push(w[j],N[j])}var z=FV(function(H,te,K){var ne=T&&H.as||l,de="",oe=[],ge=H;if(H.theme==null){ge={};for(var ee in H)ge[ee]=H[ee];ge.theme=L.useContext(YS)}typeof H.className=="string"?de=AQ(te.registered,oe,H.className):H.className!=null&&(de=H.className+" ");var Z=Jk(A.concat(oe),te.registered,ge);de+=te.key+"-"+Z.name,f!==void 0&&(de+=" "+f);var J=T&&E===void 0?mq(ne):v,se={};for(var he in H)T&&he==="as"||J(he)&&(se[he]=H[he]);return se.className=de,K&&(se.ref=K),L.createElement(L.Fragment,null,L.createElement($Oe,{cache:te,serialized:Z,isStringTag:typeof ne=="string"}),L.createElement(ne,se))});return z.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",z.defaultProps=t.defaultProps,z.__emotion_real=z,z.__emotion_base=l,z.__emotion_styles=A,z.__emotion_forwardProp=E,Object.defineProperty(z,"toString",{value:function(){return"."+f}}),z.withComponent=function(H,te){var K=n(H,SE({},s,te,{shouldForwardProp:gq(z,te,!0)}));return K.apply(void 0,A)},z}},qOe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],_U=KOe.bind(null);qOe.forEach(function(n){_U[n]=_U(n)});const YOe=new Set([...gye,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),XOe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function JOe(n){return(XOe.has(n)||!YOe.has(n))&&n[0]!=="_"}const QOe=K_e(_U),ZOe=({baseStyle:n})=>t=>{const{theme:s,css:a,__css:l,sx:d,...f}=t,[E]=nEe(f,Eye),v=Kc(n,t),T=D_e({},l,v,zk(E),d),w=sQ(T)(t.theme);return a?[w,a]:w};function n2(n,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=JOe);const l=ZOe({baseStyle:s}),d=QOe(n,a)(l);return L.forwardRef(function(v,T){const{children:w,...A}=v,{colorMode:N,forced:F}=Zk(),j=F?N:void 0;return L.createElement(d,{ref:T,"data-theme":j,...A},w)})}function eke(){const n=new Map;return new Proxy(n2,{apply(t,s,a){return n2(...a)},get(t,s){return n.has(s)||n.set(s,n2(s)),n.get(s)}})}const Dt=eke(),tke={initial:n=>{const{position:t}=n,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},dee=L.memo(n=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:E=5e3,containerStyle:v,motionVariants:T=tke,toastSpacing:w="0.5rem"}=n,[A,N]=L.useState(E),F=mCe();hg(()=>{F||a==null||a()},[F]),hg(()=>{N(E)},[E]);const j=()=>N(null),z=()=>N(E),H=()=>{F&&l()};L.useEffect(()=>{F&&d&&l()},[F,d,l]),vEe(H,A);const te=L.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),K=L.useMemo(()=>jOe(f),[f]);return I.jsx(kf.div,{layout:!0,className:"chakra-toast",variants:T,initial:"initial",animate:"animate",exit:"exit",onHoverStart:j,onHoverEnd:z,custom:{position:f},style:K,children:I.jsx(Dt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:te,children:Kc(s,{id:t,onClose:H})})})});dee.displayName="ToastComponent";function Wt(n){return L.forwardRef(n)}var r2,_q;function nke(){if(_q)return r2;_q=1;var n=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var E,v,T;if(Array.isArray(d)){if(E=d.length,E!=f.length)return!1;for(v=E;v--!==0;)if(!l(d[v],f[v]))return!1;return!0}var w;if(t&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(s&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(E=d.length,E!=f.length)return!1;for(v=E;v--!==0;)if(d[v]!==f[v])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(T=Object.keys(d),E=T.length,E!==Object.keys(f).length)return!1;for(v=E;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,T[v]))return!1;if(n&&d instanceof Element)return!1;for(v=E;v--!==0;)if(!((T[v]==="_owner"||T[v]==="__v"||T[v]==="__o")&&d.$$typeof)&&!l(d[T[v]],f[T[v]]))return!1;return!0}return d!==d&&f!==f}return r2=function(f,E){try{return l(f,E)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},r2}var rke=nke();const ike=g0(rke);function T0(){const n=L.useContext(YS);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function hee(){const n=Zk(),t=T0();return{...n,theme:t}}function ske(n,t,s){if(t==null)return t;const a=l=>{var d,f;return(f=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(t)??a(s)??s}function oke(n,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const f=l.filter(Boolean),E=a.map((v,T)=>{const w=`${n}.${v}`;return ske(d,w,f[T]??v)});return Array.isArray(t)?E:E[0]}}function pee(n,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=hee(),f=n?WJ(l,`components.${n}`):void 0,E=s||f,v=Uh({theme:l,colorMode:d},(E==null?void 0:E.defaultProps)??{},zk(_0(a,["children"])),(w,A)=>w?void 0:A),T=L.useRef({});if(E){const A=Pye(E)(v);ike(T.current,A)||(T.current=A)}return T.current}function Ou(n,t={}){return pee(n,t)}function oc(n,t={}){return pee(n,t)}const Eq={path:I.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[I.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),I.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),I.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Dn=Wt((n,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:E,__css:v,...T}=n,w=dn("chakra-icon",E),A=Ou("Icon",n),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...A},F={ref:t,focusable:d,className:w,__css:N},j=a??Eq.viewBox;if(s&&typeof s!="string")return I.jsx(Dt.svg,{as:s,...F,...T});const z=f??Eq.path;return I.jsx(Dt.svg,{verticalAlign:"middle",viewBox:j,...F,...T,children:z})});Dn.displayName="Icon";function ake(n){return I.jsx(Dn,{viewBox:"0 0 24 24",...n,children:I.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function cke(n){return I.jsx(Dn,{viewBox:"0 0 24 24",...n,children:I.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function yq(n){return I.jsx(Dn,{viewBox:"0 0 24 24",...n,children:I.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const lke=DR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),tp=Wt((n,t)=>{const s=Ou("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:E,...v}=$i(n),T=dn("chakra-spinner",E),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${lke} ${d} linear infinite`,...s};return I.jsx(Dt.div,{ref:t,__css:w,className:T,...v,children:a&&I.jsx(Dt.span,{srOnly:!0,children:a})})});tp.displayName="Spinner";const[uke,RF]=Oi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[dke,CF]=Oi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),fee={info:{icon:cke,colorScheme:"blue"},warning:{icon:yq,colorScheme:"orange"},success:{icon:ake,colorScheme:"green"},error:{icon:yq,colorScheme:"red"},loading:{icon:tp,colorScheme:"blue"}};function hke(n){return fee[n].colorScheme}function pke(n){return fee[n].icon}const ng=Wt(function(t,s){const{status:a="info",addRole:l=!0,...d}=$i(t),f=t.colorScheme??hke(a),E=oc("Alert",{...t,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...E.container};return I.jsx(uke,{value:{status:a},children:I.jsx(dke,{value:E,children:I.jsx(Dt.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:dn("chakra-alert",t.className),__css:v})})})});ng.displayName="Alert";function rg(n){const{status:t}=RF(),s=pke(t),a=CF(),l=t==="loading"?a.spinner:a.icon;return I.jsx(Dt.span,{display:"inherit","data-status":t,...n,className:dn("chakra-alert__icon",n.className),__css:l,children:n.children||I.jsx(s,{h:"100%",w:"100%"})})}rg.displayName="AlertIcon";const zw=Wt(function(t,s){const a=CF(),{status:l}=RF();return I.jsx(Dt.div,{ref:s,"data-status":l,...t,className:dn("chakra-alert__title",t.className),__css:a.title})});zw.displayName="AlertTitle";const Gw=Wt(function(t,s){const{status:a}=RF(),l=CF(),d={display:"inline",...l.description};return I.jsx(Dt.div,{ref:s,"data-status":a,...t,className:dn("chakra-alert__desc",t.className),__css:d})});Gw.displayName="AlertDescription";function fke(n){return I.jsx(Dn,{focusable:"false","aria-hidden":!0,...n,children:I.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const IF=Wt(function(t,s){const a=Ou("CloseButton",t),{children:l,isDisabled:d,__css:f,...E}=$i(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return I.jsx(Dt.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...v,...a,...f},...E,children:l||I.jsx(fke,{width:"1em",height:"1em"})})});IF.displayName="CloseButton";const mke=n=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:f,description:E,colorScheme:v,icon:T}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return I.jsxs(ng,{addRole:!1,status:t,variant:s,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[I.jsx(rg,{children:T}),I.jsxs(Dt.div,{flex:"1",maxWidth:"100%",children:[l&&I.jsx(zw,{id:w==null?void 0:w.title,children:l}),E&&I.jsx(Gw,{id:w==null?void 0:w.description,display:"block",children:E})]}),d&&I.jsx(IF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function mee(n={}){const{render:t,toastComponent:s=mke}=n;return l=>typeof t=="function"?t({...l,...n}):I.jsx(s,{...l,...n})}const gke={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Lh=_ke(gke);function _ke(n){let t=n;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>n),s.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const f=Eke(l,d),{position:E,id:v}=f;return a(T=>{const A=E.includes("top")?[f,...T[E]??[]]:[...T[E]??[],f];return{...T,[E]:A}}),v},update:(l,d)=>{l&&a(f=>{const E={...f},{position:v,index:T}=fq(E,l);return v&&T!==-1&&(E[v][T]={...E[v][T],...d,message:mee(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,T)=>(v[T]=d[T].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const f=uee(d,l);return f?{...d,[f]:d[f].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!fq(Lh.getState(),l).position}}let vq=0;function Eke(n,t={}){vq+=1;const s=t.id??vq,a=t.position??"bottom";return{id:s,message:n,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>Lh.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var gee=DJ();const[_ee,yke]=Oi({strict:!1,name:"PortalContext"}),AF="chakra-portal",vke=".chakra-portal",Ske=n=>I.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),Tke=n=>{const{appendToParentPortal:t,children:s}=n,[a,l]=L.useState(null),d=L.useRef(null),[,f]=L.useState({});L.useEffect(()=>f({}),[]);const E=yke(),v=cCe();mf(()=>{if(!a)return;const w=a.ownerDocument,A=t?E??w.body:w.body;if(!A)return;d.current=w.createElement("div"),d.current.className=AF,A.appendChild(d.current),f({});const N=d.current;return()=>{A.contains(N)&&A.removeChild(N)}},[a]);const T=v!=null&&v.zIndex?I.jsx(Ske,{zIndex:v==null?void 0:v.zIndex,children:s}):s;return d.current?gee.createPortal(I.jsx(_ee,{value:d.current,children:T}),d.current):I.jsx("span",{ref:w=>{w&&l(w)}})},bke=n=>{const{children:t,containerRef:s,appendToParentPortal:a}=n,l=s.current,d=l??(typeof window<"u"?document.body:void 0),f=L.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=AF),v},[l]),[,E]=L.useState({});return mf(()=>E({}),[]),mf(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?gee.createPortal(I.jsx(_ee,{value:a?f:null,children:t}),f):null};function ku(n){const t={appendToParentPortal:!0,...n},{containerRef:s,...a}=t;return s?I.jsx(bke,{containerRef:s,...a}):I.jsx(Tke,{...a})}ku.className=AF;ku.selector=vke;ku.displayName="Portal";const[wke,Rke]=Oi({name:"ToastOptionsContext",strict:!1}),Cke=n=>{const t=L.useSyncExternalStore(Lh.subscribe,Lh.getState,Lh.getState),{motionVariants:s,component:a=dee,portalProps:l,animatePresenceProps:d}=n,E=Object.keys(t).map(v=>{const T=t[v];return I.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:BOe(v),children:I.jsx(y0,{...d,initial:!1,children:T.map(w=>I.jsx(a,{motionVariants:s,...w},w.id))})},v)});return I.jsx(ku,{...l,children:E})},Ike=n=>function({children:s,theme:a=n,toastOptions:l,...d}){return I.jsxs(uCe,{theme:a,...d,children:[I.jsx(wke,{value:l==null?void 0:l.defaultOptions,children:s}),I.jsx(Cke,{...l})]})},Ake=Ike(tRe);function Sq(n){return n.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const Pke=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function Tq(n,t,s){let a=n+1;return s&&a>=t&&(a=0),a}function bq(n,t,s){let a=n-1;return s&&a<0&&(a=t),a}const i2=typeof window<"u"?L.useLayoutEffect:L.useEffect,wq=n=>n;var Oke=Object.defineProperty,kke=(n,t,s)=>t in n?Oke(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,bs=(n,t,s)=>(kke(n,typeof t!="symbol"?t+"":t,s),s);class Nke{constructor(){bs(this,"descendants",new Map),bs(this,"register",t=>{if(t!=null)return Pke(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),bs(this,"unregister",t=>{this.descendants.delete(t);const s=Sq(Array.from(this.descendants.keys()));this.assignIndex(s)}),bs(this,"destroy",()=>{this.descendants.clear()}),bs(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),bs(this,"count",()=>this.descendants.size),bs(this,"enabledCount",()=>this.enabledValues().length),bs(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),bs(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),bs(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),bs(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),bs(this,"first",()=>this.item(0)),bs(this,"firstEnabled",()=>this.enabledItem(0)),bs(this,"last",()=>this.item(this.descendants.size-1)),bs(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),bs(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),bs(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),bs(this,"next",(t,s=!0)=>{const a=Tq(t,this.count(),s);return this.item(a)}),bs(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=Tq(l,this.enabledCount(),s);return this.enabledItem(d)}),bs(this,"prev",(t,s=!0)=>{const a=bq(t,this.count()-1,s);return this.item(a)}),bs(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=bq(l,this.enabledCount()-1,s);return this.enabledItem(d)}),bs(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=Sq(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function Eee(){const[n,t]=Oi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,t,()=>{const l=L.useRef(new Nke);return i2(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[f,E]=L.useState(-1),v=L.useRef(null);i2(()=>()=>{v.current&&d.unregister(v.current)},[]),i2(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);f!=w&&!Number.isNaN(w)&&E(w)});const T=wq(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(v.current),register:es(T,v)}}]}const Rq={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},fE={enter:{duration:.2,ease:Rq.easeOut},exit:{duration:.1,ease:Rq.easeIn}},mE={enter:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[Dke,Lke]=Oi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function xke(n){const t=n.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function yee(n){const{name:t,getInitials:s,...a}=n,l=Lke();return I.jsx(Dt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}yee.displayName="AvatarName";const vee=n=>I.jsxs(Dt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[I.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),I.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function See(n){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:E,ignoreFallback:v}=n,[T,w]=L.useState("pending");L.useEffect(()=>{w(s?"loading":"pending")},[s]);const A=L.useRef(null),N=L.useCallback(()=>{if(!s)return;F();const j=new Image;j.src=s,f&&(j.crossOrigin=f),a&&(j.srcset=a),E&&(j.sizes=E),t&&(j.loading=t),j.onload=z=>{F(),w("loaded"),l==null||l(z)},j.onerror=z=>{F(),w("failed"),d==null||d(z)},A.current=j},[s,f,a,E,l,d,t]),F=()=>{A.current&&(A.current.onload=null,A.current.onerror=null,A.current=null)};return mf(()=>{if(!v)return T==="loading"&&N(),()=>{F()}},[T,N,v]),v?"loaded":T}const Mke=(n,t)=>n!=="loaded"&&t==="beforeLoadOrError"||n==="failed"&&t==="onError";function Tee(n){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:E,loading:v,iconLabel:T,icon:w=I.jsx(vee,{}),ignoreFallback:A,referrerPolicy:N,crossOrigin:F}=n,z=See({src:t,onError:a,crossOrigin:F,ignoreFallback:A})==="loaded";return!t||!z?f?I.jsx(yee,{className:"chakra-avatar__initials",getInitials:d,name:f}):L.cloneElement(w,{role:"img","aria-label":T}):I.jsx(Dt.img,{src:t,srcSet:s,alt:f??T,onLoad:l,referrerPolicy:N,crossOrigin:F??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}Tee.displayName="AvatarImage";const Uke={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},wf=Wt((n,t)=>{const s=oc("Avatar",n),[a,l]=L.useState(!1),{src:d,srcSet:f,name:E,showBorder:v,borderRadius:T="full",onError:w,onLoad:A,getInitials:N=xke,icon:F=I.jsx(vee,{}),iconLabel:j=" avatar",loading:z,children:H,borderColor:te,ignoreFallback:K,crossOrigin:ne,referrerPolicy:de,...oe}=$i(n),ge={borderRadius:T,borderWidth:v?"2px":void 0,...Uke,...s.container};return te&&(ge.borderColor=te),I.jsx(Dt.span,{ref:t,...oe,className:dn("chakra-avatar",n.className),"data-loaded":Kn(a),__css:ge,children:I.jsxs(Dke,{value:s,children:[I.jsx(Tee,{src:d,srcSet:f,loading:z,onLoad:Qn(A,()=>{l(!0)}),onError:w,getInitials:N,name:E,borderRadius:T,icon:F,iconLabel:j,ignoreFallback:K,crossOrigin:ne,referrerPolicy:de}),H]})})});wf.displayName="Avatar";const uf=Wt(function(t,s){const a=Ou("Badge",t),{className:l,...d}=$i(t);return I.jsx(Dt.span,{ref:s,className:dn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});uf.displayName="Badge";const Pt=Dt("div");Pt.displayName="Box";const[s8e,Vke]=Oi({strict:!1,name:"ButtonGroupContext"});function ww(n){const{children:t,className:s,...a}=n,l=L.isValidElement(t)?L.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=dn("chakra-button__icon",s);return I.jsx(Dt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}ww.displayName="ButtonIcon";function EU(n){const{label:t,placement:s,spacing:a="0.5rem",children:l=I.jsx(tp,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,...E}=n,v=dn("chakra-button__spinner",d),T=s==="start"?"marginEnd":"marginStart",w=L.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[T]:t?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,t,T,a]);return I.jsx(Dt.div,{className:v,...E,__css:w,children:l})}EU.displayName="ButtonSpinner";function Fke(n){const[t,s]=L.useState(!n);return{ref:L.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const Ri=Wt((n,t)=>{const s=Vke(),a=Ou("Button",{...s,...n}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:f,children:E,leftIcon:v,rightIcon:T,loadingText:w,iconSpacing:A="0.5rem",type:N,spinner:F,spinnerPlacement:j="start",className:z,as:H,shouldWrapChildren:te,...K}=$i(n),ne=L.useMemo(()=>{const ee={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:ee}}},[a,s]),{ref:de,type:oe}=Fke(H),ge={rightIcon:T,leftIcon:v,iconSpacing:A,children:E,shouldWrapChildren:te};return I.jsxs(Dt.button,{disabled:l||d,ref:yEe(t,de),as:H,type:N??oe,"data-active":Kn(f),"data-loading":Kn(d),__css:ne,className:dn("chakra-button",z),...K,children:[d&&j==="start"&&I.jsx(EU,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:A,children:F}),d?w||I.jsx(Dt.span,{opacity:0,children:I.jsx(Cq,{...ge})}):I.jsx(Cq,{...ge}),d&&j==="end"&&I.jsx(EU,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:A,children:F})]})});Ri.displayName="Button";function Cq(n){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?I.jsxs("span",{style:{display:"contents"},children:[t&&I.jsx(ww,{marginEnd:l,children:t}),a,s&&I.jsx(ww,{marginStart:l,children:s})]}):I.jsxs(I.Fragment,{children:[t&&I.jsx(ww,{marginEnd:l,children:t}),a,s&&I.jsx(ww,{marginStart:l,children:s})]})}const Pa=Wt((n,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...f}=n,E=s||a,v=L.isValidElement(E)?L.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return I.jsx(Ri,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...f,children:v})});Pa.displayName="IconButton";const bee=Dt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});bee.displayName="Center";const jke={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Wt(function(t,s){const{axis:a="both",...l}=t;return I.jsx(Dt.div,{ref:s,__css:jke[a],...l,position:"absolute"})});var Bke=()=>typeof document<"u",Iq=!1,FR=null,TE=!1,yU=!1,vU=new Set;function PF(n,t){vU.forEach(s=>s(n,t))}var Wke=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function zke(n){return!(n.metaKey||!Wke&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function Aq(n){TE=!0,zke(n)&&(FR="keyboard",PF("keyboard",n))}function nS(n){if(FR="pointer",n.type==="mousedown"||n.type==="pointerdown"){TE=!0;const t=n.composedPath?n.composedPath()[0]:n.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;PF("pointer",n)}}function Gke(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function Hke(n){Gke(n)&&(TE=!0,FR="virtual")}function $ke(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!TE&&!yU&&(FR="virtual",PF("virtual",n)),TE=!1,yU=!1)}function Kke(){TE=!1,yU=!0}function Pq(){return FR!=="pointer"}function qke(){if(!Bke()||Iq)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){TE=!0,n.apply(this,s)},document.addEventListener("keydown",Aq,!0),document.addEventListener("keyup",Aq,!0),document.addEventListener("click",Hke,!0),window.addEventListener("focus",$ke,!0),window.addEventListener("blur",Kke,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",nS,!0),document.addEventListener("pointermove",nS,!0),document.addEventListener("pointerup",nS,!0)):(document.addEventListener("mousedown",nS,!0),document.addEventListener("mousemove",nS,!0),document.addEventListener("mouseup",nS,!0)),Iq=!0}function Yke(n){qke(),n(Pq());const t=()=>n(Pq());return vU.add(t),()=>{vU.delete(t)}}const[Xke,wee]=Oi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[Jke,b0]=Oi({strict:!1,name:"FormControlContext"});function Qke(n){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=n,E=L.useId(),v=t||`field-${E}`,T=`${v}-label`,w=`${v}-feedback`,A=`${v}-helptext`,[N,F]=L.useState(!1),[j,z]=L.useState(!1),[H,te]=L.useState(!1),K=L.useCallback((ee={},Z=null)=>({id:A,...ee,ref:es(Z,J=>{J&&z(!0)})}),[A]),ne=L.useCallback((ee={},Z=null)=>({...ee,ref:Z,"data-focus":Kn(H),"data-disabled":Kn(l),"data-invalid":Kn(a),"data-readonly":Kn(d),id:ee.id!==void 0?ee.id:T,htmlFor:ee.htmlFor!==void 0?ee.htmlFor:v}),[v,l,H,a,d,T]),de=L.useCallback((ee={},Z=null)=>({id:w,...ee,ref:es(Z,J=>{J&&F(!0)}),"aria-live":"polite"}),[w]),oe=L.useCallback((ee={},Z=null)=>({...ee,...f,ref:Z,role:"group","data-focus":Kn(H),"data-disabled":Kn(l),"data-invalid":Kn(a),"data-readonly":Kn(d)}),[f,l,H,a,d]),ge=L.useCallback((ee={},Z=null)=>({...ee,ref:Z,role:"presentation","aria-hidden":!0,children:ee.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!H,onFocus:()=>te(!0),onBlur:()=>te(!1),hasFeedbackText:N,setHasFeedbackText:F,hasHelpText:j,setHasHelpText:z,id:v,labelId:T,feedbackId:w,helpTextId:A,htmlProps:f,getHelpTextProps:K,getErrorMessageProps:de,getRootProps:oe,getLabelProps:ne,getRequiredIndicatorProps:ge}}const Zi=Wt(function(t,s){const a=oc("Form",t),l=$i(t),{getRootProps:d,htmlProps:f,...E}=Qke(l),v=dn("chakra-form-control",t.className);return I.jsx(Jke,{value:E,children:I.jsx(Xke,{value:a,children:I.jsx(Dt.div,{...d({},s),className:v,__css:a.container})})})});Zi.displayName="FormControl";const SU=Wt(function(t,s){const a=b0(),l=wee(),d=dn("chakra-form__helper-text",t.className);return I.jsx(Dt.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});SU.displayName="FormHelperText";function OF(n){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=Ree(n);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":AS(s),"aria-required":AS(l),"aria-readonly":AS(a)}}function Ree(n){const t=b0(),{id:s,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:E,isReadOnly:v,isDisabled:T,onFocus:w,onBlur:A,...N}=n,F=n["aria-describedby"]?[n["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&F.push(t.feedbackId),t!=null&&t.hasHelpText&&F.push(t.helpTextId),{...N,"aria-describedby":F.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??T??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??f??(t==null?void 0:t.isRequired),isInvalid:E??(t==null?void 0:t.isInvalid),onFocus:Qn(t==null?void 0:t.onFocus,w),onBlur:Qn(t==null?void 0:t.onBlur,A)}}const Zke={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function e1e(n={}){const t=Ree(n),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:E,onFocus:v,"aria-describedby":T}=t,{defaultChecked:w,isChecked:A,isFocusable:N,onChange:F,isIndeterminate:j,name:z,value:H,tabIndex:te=void 0,"aria-label":K,"aria-labelledby":ne,"aria-invalid":de,...oe}=n,ge=_0(oe,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),ee=qc(F),Z=qc(E),J=qc(v),[se,he]=L.useState(!1),[pe,le]=L.useState(!1),[Me,He]=L.useState(!1),[rt,we]=L.useState(!1);L.useEffect(()=>Yke(he),[]);const Ce=L.useRef(null),[ve,Ne]=L.useState(!0),[be,Te]=L.useState(!!w),Ae=A!==void 0,Ue=Ae?A:be,ze=L.useCallback(Yt=>{if(a||s){Yt.preventDefault();return}Ae||Te(Ue?Yt.currentTarget.checked:j?!0:Yt.currentTarget.checked),ee==null||ee(Yt)},[a,s,Ue,Ae,j,ee]);mf(()=>{Ce.current&&(Ce.current.indeterminate=!!j)},[j]),hg(()=>{s&&le(!1)},[s,le]),mf(()=>{const Yt=Ce.current;if(!(Yt!=null&&Yt.form))return;const Yn=()=>{Te(!!w)};return Yt.form.addEventListener("reset",Yn),()=>{var Kt;return(Kt=Yt.form)==null?void 0:Kt.removeEventListener("reset",Yn)}},[]);const et=s&&!N,nt=L.useCallback(Yt=>{Yt.key===" "&&we(!0)},[we]),dt=L.useCallback(Yt=>{Yt.key===" "&&we(!1)},[we]);mf(()=>{if(!Ce.current)return;Ce.current.checked!==Ue&&Te(Ce.current.checked)},[Ce.current]);const Xe=L.useCallback((Yt={},Yn=null)=>{const Kt=Re=>{pe&&Re.preventDefault(),we(!0)};return{...Yt,ref:Yn,"data-active":Kn(rt),"data-hover":Kn(Me),"data-checked":Kn(Ue),"data-focus":Kn(pe),"data-focus-visible":Kn(pe&&se),"data-indeterminate":Kn(j),"data-disabled":Kn(s),"data-invalid":Kn(d),"data-readonly":Kn(a),"aria-hidden":!0,onMouseDown:Qn(Yt.onMouseDown,Kt),onMouseUp:Qn(Yt.onMouseUp,()=>we(!1)),onMouseEnter:Qn(Yt.onMouseEnter,()=>He(!0)),onMouseLeave:Qn(Yt.onMouseLeave,()=>He(!1))}},[rt,Ue,s,pe,se,Me,j,d,a]),Ct=L.useCallback((Yt={},Yn=null)=>({...Yt,ref:Yn,"data-active":Kn(rt),"data-hover":Kn(Me),"data-checked":Kn(Ue),"data-focus":Kn(pe),"data-focus-visible":Kn(pe&&se),"data-indeterminate":Kn(j),"data-disabled":Kn(s),"data-invalid":Kn(d),"data-readonly":Kn(a)}),[rt,Ue,s,pe,se,Me,j,d,a]),hn=L.useCallback((Yt={},Yn=null)=>({...ge,htmlFor:ve?f:void 0,...Yt,ref:es(Yn,Kt=>{Kt&&Ne(Kt.tagName==="LABEL")}),onClick:Qn(Yt.onClick,()=>{var Kt;ve||((Kt=Ce.current)==null||Kt.click(),requestAnimationFrame(()=>{var Re;(Re=Ce.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":Kn(s),"data-checked":Kn(Ue),"data-invalid":Kn(d)}),[ge,s,Ue,d,ve,f]),Ut=L.useCallback((Yt={},Yn=null)=>({...Yt,ref:es(Ce,Yn),type:"checkbox",name:z,value:H,id:f,tabIndex:te,onChange:Qn(Yt.onChange,ze),onBlur:Qn(Yt.onBlur,Z,()=>le(!1)),onFocus:Qn(Yt.onFocus,J,()=>le(!0)),onKeyDown:Qn(Yt.onKeyDown,nt),onKeyUp:Qn(Yt.onKeyUp,dt),required:l,checked:Ue,disabled:et,readOnly:a,"aria-label":K,"aria-labelledby":ne,"aria-invalid":de?!!de:d,"aria-describedby":T,"aria-disabled":s,"aria-checked":j?"mixed":Ue,style:Zke}),[z,H,f,te,ze,Z,J,nt,dt,l,Ue,et,a,K,ne,de,d,T,s,j]),ln=L.useCallback((Yt={},Yn=null)=>({...Yt,ref:Yn,onMouseDown:Qn(Yt.onMouseDown,t1e),"data-disabled":Kn(s),"data-checked":Kn(Ue),"data-invalid":Kn(d)}),[Ue,s,d]);return{state:{isInvalid:d,isFocused:pe,isChecked:Ue,isActive:rt,isHovered:Me,isIndeterminate:j,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:hn,getCheckboxProps:Xe,getIndicatorProps:Ct,getInputProps:Ut,getLabelProps:ln,htmlProps:ge}}function t1e(n){n.preventDefault(),n.stopPropagation()}const gE=Wt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:E,borderStyle:v,borderColor:T,...w}=Ou("Divider",t),{className:A,orientation:N="horizontal",__css:F,...j}=$i(t),z={vertical:{borderLeftWidth:a||f||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return I.jsx(Dt.hr,{ref:s,"aria-orientation":N,...j,__css:{...w,border:"0",borderColor:T,borderStyle:v,...z[N],...F},className:dn("chakra-divider",A)})});gE.displayName="Divider";const io=Wt(function(t,s){const{direction:a,align:l,justify:d,wrap:f,basis:E,grow:v,shrink:T,...w}=t,A={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:E,flexGrow:v,flexShrink:T};return I.jsx(Dt.div,{ref:s,__css:A,...w})});io.displayName="Flex";function n1e(n,t){if(n==null)return{};var s={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(t.indexOf(a)!==-1)continue;s[a]=n[a]}return s}var s2={exports:{}},o2,Oq;function r1e(){if(Oq)return o2;Oq=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return o2=n,o2}var a2,kq;function i1e(){if(kq)return a2;kq=1;var n=r1e();function t(){}function s(){}return s.resetWarningCache=t,a2=function(){function a(f,E,v,T,w,A){if(A!==n){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},a2}var Nq;function s1e(){return Nq||(Nq=1,s2.exports=i1e()()),s2.exports}var o1e=s1e();const kr=g0(o1e);var TU="data-focus-lock",Cee="data-focus-lock-disabled",a1e="data-no-focus-lock",c1e="data-autofocus-inside",l1e="data-no-autofocus";function c2(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function u1e(n,t){var s=L.useState(function(){return{value:n,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var d1e=typeof window<"u"?L.useLayoutEffect:L.useEffect,Dq=new WeakMap;function Iee(n,t){var s=u1e(null,function(a){return n.forEach(function(l){return c2(l,a)})});return d1e(function(){var a=Dq.get(s);if(a){var l=new Set(a),d=new Set(n),f=s.current;l.forEach(function(E){d.has(E)||c2(E,null)}),d.forEach(function(E){l.has(E)||c2(E,f)})}Dq.set(s,n)},[n]),s}var l2={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},xh=function(){return xh=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},xh.apply(this,arguments)};function jR(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s}function h1e(n,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return n.concat(d||Array.prototype.slice.call(t))}function Aee(n){return n}function Pee(n,t){t===void 0&&(t=Aee);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:n},useMedium:function(d){var f=t(d,a);return s.push(f),function(){s=s.filter(function(E){return E!==f})}},assignSyncMedium:function(d){for(a=!0;s.length;){var f=s;s=[],f.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var f=[];if(s.length){var E=s;s=[],E.forEach(d),f=s}var v=function(){var w=f;f=[],w.forEach(d)},T=function(){return Promise.resolve().then(v)};T(),s={push:function(w){f.push(w),T()},filter:function(w){return f=f.filter(w),s}}}};return l}function kF(n,t){return t===void 0&&(t=Aee),Pee(n,t)}function Oee(n){n===void 0&&(n={});var t=Pee(null);return t.options=xh({async:!0,ssr:!1},n),t}var kee=function(n){var t=n.sideCar,s=jR(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return L.createElement(a,xh({},s))};kee.isSideCarExport=!0;function p1e(n,t){return n.useMedium(t),kee}var Nee=kF({},function(n){var t=n.target,s=n.currentTarget;return{target:t,currentTarget:s}}),Dee=kF(),f1e=kF(),m1e=Oee({async:!0,ssr:typeof document<"u"}),g1e=L.createContext(void 0),_1e=[],NF=L.forwardRef(function(t,s){var a,l=L.useState(),d=l[0],f=l[1],E=L.useRef(),v=L.useRef(!1),T=L.useRef(null),w=L.useState({}),A=w[1],N=t.children,F=t.disabled,j=F===void 0?!1:F,z=t.noFocusGuards,H=z===void 0?!1:z,te=t.persistentFocus,K=te===void 0?!1:te,ne=t.crossFrame,de=ne===void 0?!0:ne,oe=t.autoFocus,ge=oe===void 0?!0:oe;t.allowTextSelection;var ee=t.group,Z=t.className,J=t.whiteList,se=t.hasPositiveIndices,he=t.shards,pe=he===void 0?_1e:he,le=t.as,Me=le===void 0?"div":le,He=t.lockProps,rt=He===void 0?{}:He,we=t.sideCar,Ce=t.returnFocus,ve=Ce===void 0?!1:Ce,Ne=t.focusOptions,be=t.onActivation,Te=t.onDeactivation,Ae=L.useState({}),Ue=Ae[0],ze=L.useCallback(function(Yn){var Kt=Yn.captureFocusRestore;if(!T.current){var Re,Fe=(Re=document)==null?void 0:Re.activeElement;T.current=Fe,Fe!==document.body&&(T.current=Kt(Fe))}E.current&&be&&be(E.current),v.current=!0,A()},[be]),et=L.useCallback(function(){v.current=!1,Te&&Te(E.current),A()},[Te]),nt=L.useCallback(function(Yn){var Kt=T.current;if(Kt){var Re=(typeof Kt=="function"?Kt():Kt)||document.body,Fe=typeof ve=="function"?ve(Re):ve;if(Fe){var Ke=typeof Fe=="object"?Fe:void 0;T.current=null,Yn?Promise.resolve().then(function(){return Re.focus(Ke)}):Re.focus(Ke)}}},[ve]),dt=L.useCallback(function(Yn){v.current&&Nee.useMedium(Yn)},[]),Xe=Dee.useMedium,Ct=L.useCallback(function(Yn){E.current!==Yn&&(E.current=Yn,f(Yn))},[]),hn=SE((a={},a[Cee]=j&&"disabled",a[TU]=ee,a),rt),Ut=H!==!0,ln=Ut&&H!=="tail",xn=Iee([s,Ct]),Yt=L.useMemo(function(){return{observed:E,shards:pe,enabled:!j,active:v.current}},[j,v.current,pe,d]);return ni.createElement(L.Fragment,null,Ut&&[ni.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:j?-1:0,style:l2}),se?ni.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:j?-1:1,style:l2}):null],!j&&ni.createElement(we,{id:Ue,sideCar:m1e,observed:d,disabled:j,persistentFocus:K,crossFrame:de,autoFocus:ge,whiteList:J,shards:pe,onActivation:ze,onDeactivation:et,returnFocus:nt,focusOptions:Ne,noFocusGuards:H}),ni.createElement(Me,SE({ref:xn},hn,{className:Z,onBlur:Xe,onFocus:dt}),ni.createElement(g1e.Provider,{value:Yt},N)),ln&&ni.createElement("div",{"data-focus-guard":!0,tabIndex:j?-1:0,style:l2}))});NF.propTypes={};function bU(n,t){return bU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},bU(n,t)}function E1e(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,bU(n,t)}function fR(n){"@babel/helpers - typeof";return fR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fR(n)}function y1e(n,t){if(fR(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,t);if(fR(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function v1e(n){var t=y1e(n,"string");return fR(t)=="symbol"?t:t+""}function S1e(n,t,s){return(t=v1e(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function T1e(n,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function E(){f=n(d.map(function(T){return T.props})),t(f)}var v=function(T){E1e(w,T);function w(){return T.apply(this,arguments)||this}w.peek=function(){return f};var A=w.prototype;return A.componentDidMount=function(){d.push(this),E()},A.componentDidUpdate=function(){E()},A.componentWillUnmount=function(){var F=d.indexOf(this);d.splice(F,1),E()},A.render=function(){return ni.createElement(l,this.props)},w}(L.PureComponent);return S1e(v,"displayName","SideEffect("+s(l)+")"),v}}var np=function(n){for(var t=Array(n.length),s=0;s<n.length;++s)t[s]=n[s];return t},bE=function(n){return Array.isArray(n)?n:[n]},Lee=function(n){return Array.isArray(n)?n[0]:n},b1e=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(n,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},xee=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Mee=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},w1e=function(n){return n.hasAttribute("inert")},R1e=function(n,t){return!n||Mee(n)||!b1e(n)&&!w1e(n)&&t(xee(n))},Uee=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=R1e(t,Uee.bind(void 0,n));return n.set(t,a),a},C1e=function(n,t){return n&&!Mee(n)?P1e(n)?t(xee(n)):!1:!0},Vee=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=C1e(t,Vee.bind(void 0,n));return n.set(t,a),a},Fee=function(n){return n.dataset},I1e=function(n){return n.tagName==="BUTTON"},jee=function(n){return n.tagName==="INPUT"},Bee=function(n){return jee(n)&&n.type==="radio"},A1e=function(n){return!((jee(n)||I1e(n))&&(n.type==="hidden"||n.disabled))},P1e=function(n){var t=n.getAttribute(l1e);return![!0,"true",""].includes(t)},DF=function(n){var t;return!!(n&&(!((t=Fee(n))===null||t===void 0)&&t.focusGuard))},wU=function(n){return!DF(n)},O1e=function(n){return!!n},k1e=function(n,t){var s=Math.max(0,n.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=n.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},N1e=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},LF=function(n,t,s){return np(n).map(function(a,l){var d=N1e(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(k1e)},D1e=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],xF=D1e.join(","),L1e="".concat(xF,", [data-focus-guard]"),Wee=function(n,t){return np((n.shadowRoot||n).children).reduce(function(s,a){return s.concat(a.matches(t?L1e:xF)?[a]:[],Wee(a))},[])},x1e=function(n,t){var s;return n instanceof HTMLIFrameElement&&(!((s=n.contentDocument)===null||s===void 0)&&s.body)?ZS([n.contentDocument.body],t):[n]},ZS=function(n,t){return n.reduce(function(s,a){var l,d=Wee(a,t),f=(l=[]).concat.apply(l,d.map(function(E){return x1e(E,t)}));return s.concat(f,a.parentNode?np(a.parentNode.querySelectorAll(xF)).filter(function(E){return E===a}):[])},[])},M1e=function(n){var t=n.querySelectorAll("[".concat(c1e,"]"));return np(t).map(function(s){return ZS([s])}).reduce(function(s,a){return s.concat(a)},[])},MF=function(n,t){return np(n).filter(function(s){return Uee(t,s)}).filter(function(s){return A1e(s)})},Lq=function(n,t){return t===void 0&&(t=new Map),np(n).filter(function(s){return Vee(t,s)})},UF=function(n,t,s){return LF(MF(ZS(n,s),t),!0,s)},mR=function(n,t){return LF(MF(ZS(n),t),!1)},U1e=function(n,t){return MF(M1e(n),t)},_E=function(n,t){return n.shadowRoot?_E(n.shadowRoot,t):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,t)?!0:np(n.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?_E(l,t):!1}return _E(s,t)})},V1e=function(n){for(var t=new Set,s=n.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return n.filter(function(f,E){return!t.has(E)})},zee=function(n){return n.parentNode?zee(n.parentNode):n},VF=function(n){var t=bE(n);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(TU);return s.push.apply(s,l?V1e(np(zee(a).querySelectorAll("[".concat(TU,'="').concat(l,'"]:not([').concat(Cee,'="disabled"])')))):[a]),s},[])},F1e=function(n){try{return n()}catch{return}},gR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var t=n.activeElement;return t.shadowRoot?gR(t.shadowRoot):t instanceof HTMLIFrameElement&&F1e(function(){return t.contentWindow.document})?gR(t.contentWindow.document):t}},j1e=function(n,t){return n===t},B1e=function(n,t){return!!np(n.querySelectorAll("iframe")).some(function(s){return j1e(s,t)})},Gee=function(n,t){return t===void 0&&(t=gR(Lee(n).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:VF(n).some(function(s){return _E(s,t)||B1e(s,t)})},W1e=function(n){n===void 0&&(n=document);var t=gR(n);return t?np(n.querySelectorAll("[".concat(a1e,"]"))).some(function(s){return _E(s,t)}):!1},z1e=function(n,t){return t.filter(Bee).filter(function(s){return s.name===n.name}).filter(function(s){return s.checked})[0]||n},FF=function(n,t){return Bee(n)&&n.name?z1e(n,t):n},G1e=function(n){var t=new Set;return n.forEach(function(s){return t.add(FF(s,n))}),n.filter(function(s){return t.has(s)})},xq=function(n){return n[0]&&n.length>1?FF(n[0],n):n[0]},Mq=function(n,t){return n.indexOf(FF(t,n))},RU="NEW_FOCUS",H1e=function(n,t,s,a,l){var d=n.length,f=n[0],E=n[d-1],v=DF(a);if(!(a&&n.indexOf(a)>=0)){var T=a!==void 0?s.indexOf(a):-1,w=l?s.indexOf(l):T,A=l?n.indexOf(l):-1;if(T===-1)return A!==-1?A:RU;if(A===-1)return RU;var N=T-w,F=s.indexOf(f),j=s.indexOf(E),z=G1e(s),H=a!==void 0?z.indexOf(a):-1,te=l?z.indexOf(l):H,K=z.filter(function(Z){return Z.tabIndex>=0}),ne=a!==void 0?K.indexOf(a):-1,de=l?K.indexOf(l):ne,oe=ne>=0&&de>=0?de-ne:te-H;if(!N&&A>=0||t.length===0)return A;var ge=Mq(n,t[0]),ee=Mq(n,t[t.length-1]);if(T<=F&&v&&Math.abs(N)>1)return ee;if(T>=j&&v&&Math.abs(N)>1)return ge;if(N&&Math.abs(oe)>1)return A;if(T<=F)return ee;if(T>j)return ge;if(N)return Math.abs(N)>1?A:(d+A+N)%d}},$1e=function(n){return function(t){var s,a=(s=Fee(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||n.indexOf(t)>=0}},Uq=function(n,t,s){var a=n.map(function(d){var f=d.node;return f}),l=Lq(a.filter($1e(s)));return l&&l.length?xq(l):xq(Lq(t))},CU=function(n,t){return t===void 0&&(t=[]),t.push(n),n.parentNode&&CU(n.parentNode.host||n.parentNode,t),t},u2=function(n,t){for(var s=CU(n),a=CU(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},Hee=function(n,t,s){var a=bE(n),l=bE(t),d=a[0],f=!1;return l.filter(Boolean).forEach(function(E){f=u2(f||E,E)||f,s.filter(Boolean).forEach(function(v){var T=u2(d,v);T&&(!f||_E(T,f)?f=T:f=u2(T,f))})}),f},Vq=function(n,t){return n.reduce(function(s,a){return s.concat(U1e(a,t))},[])},K1e=function(n,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),n.map(function(a){return s.get(a)}).filter(O1e)},q1e=function(n,t){var s=gR(bE(n).length>0?document:Lee(n).ownerDocument),a=VF(n).filter(wU),l=Hee(s||n,n,a),d=new Map,f=mR(a,d),E=f.filter(function(j){var z=j.node;return wU(z)});if(E[0]){var v=mR([l],d).map(function(j){var z=j.node;return z}),T=K1e(v,E),w=T.map(function(j){var z=j.node;return z}),A=T.filter(function(j){var z=j.tabIndex;return z>=0}).map(function(j){var z=j.node;return z}),N=H1e(w,A,v,s,t);if(N===RU){var F=Uq(f,A,Vq(a,d))||Uq(f,w,Vq(a,d));if(F)return{node:F};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:T[N]}},Y1e=function(n){var t=VF(n).filter(wU),s=Hee(n,n,t),a=LF(ZS([s],!0),!0,!0),l=ZS(t,!1);return a.map(function(d){var f=d.node,E=d.index;return{node:f,index:E,lockItem:l.indexOf(f)>=0,guard:DF(f)}})},jF=function(n,t){n&&("focus"in n&&n.focus(t),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},d2=0,h2=!1,$ee=function(n,t,s){s===void 0&&(s={});var a=q1e(n,t);if(!h2&&a){if(d2>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),h2=!0,setTimeout(function(){h2=!1},1);return}d2++,jF(a.node,s.focusOptions),d2--}};function tw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var t=n?new WeakRef(n):null;return function(){return(t==null?void 0:t.deref())||null}}var X1e=function(n){if(!n)return null;for(var t=[],s=n;s&&s!==document.body;)t.push({current:tw(s),parent:tw(s.parentElement),left:tw(s.previousElementSibling),right:tw(s.nextElementSibling)}),s=s.parentElement;return{element:tw(n),stack:t,ownerDocument:n.ownerDocument}},J1e=function(n){var t,s,a,l,d;if(n)for(var f=n.stack,E=n.ownerDocument,v=new Map,T=0,w=f;T<w.length;T++){var A=w[T],N=(t=A.parent)===null||t===void 0?void 0:t.call(A);if(N&&E.contains(N)){for(var F=(s=A.left)===null||s===void 0?void 0:s.call(A),j=A.current(),z=N.contains(j)?j:void 0,H=(a=A.right)===null||a===void 0?void 0:a.call(A),te=UF([N],v),K=(d=(l=z??(F==null?void 0:F.nextElementSibling))!==null&&l!==void 0?l:H)!==null&&d!==void 0?d:F;K;){for(var ne=0,de=te;ne<de.length;ne++){var oe=de[ne];if(K!=null&&K.contains(oe.node))return oe.node}K=K.nextElementSibling}if(te.length)return te[0].node}}},Kee=function(n){var t=X1e(n);return function(){return J1e(t)}},Q1e=function(n,t,s){if(!n||!t)return console.error("no element or scope given"),{};var a=bE(t);if(a.every(function(f){return!_E(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=s?UF(a,new Map):mR(a,new Map),d=l.findIndex(function(f){var E=f.node;return E===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},Z1e=function(n,t){var s=t?UF(bE(n),new Map):mR(bE(n),new Map);return{first:s[0],last:s[s.length-1]}},eNe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},qee=function(n,t,s){t===void 0&&(t={});var a=eNe(t),l=Q1e(n,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&jF(d.node,a.focusOptions)}},tNe=function(n,t){t===void 0&&(t={}),qee(n,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},nNe=function(n,t){t===void 0&&(t={}),qee(n,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},Yee=function(n,t,s){var a,l=Z1e(n,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&jF(d.node,t.focusOptions)},rNe=function(n,t){t===void 0&&(t={}),Yee(n,t,"first")},iNe=function(n,t){t===void 0&&(t={}),Yee(n,t,"last")};function BF(n){setTimeout(n,1)}var sNe=function(t){return t&&"current"in t?t.current:t},Xee=function(){return document&&document.activeElement===document.body},oNe=function(){return Xee()||W1e()},US=null,Bc=null,Fq=function(){return null},VS=null,_R=!1,WF=!1,aNe=function(){return!0},cNe=function(t){return(US.whiteList||aNe)(t)},lNe=function(t,s){VS={observerNode:t,portaledElement:s}},uNe=function(t){return VS&&VS.portaledElement===t};function jq(n,t,s,a){var l=null,d=n;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==n)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var dNe=function(t){return t?!!_R:_R==="meanwhile"},hNe=function n(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&n(t,s.parentNode,a))},pNe=function(t,s){return s.some(function(a){return hNe(t,a,a)})},Jee=function(t){return mR(t,new Map)},fNe=function(t){return!Jee([t.parentNode]).some(function(s){return s.node===t})},pk=function(){var t=!1;if(US){var s=US,a=s.observed,l=s.persistentFocus,d=s.autoFocus,f=s.shards,E=s.crossFrame,v=s.focusOptions,T=s.noFocusGuards,w=a||VS&&VS.portaledElement;if(Xee()&&Bc&&Bc!==document.body&&(!document.body.contains(Bc)||fNe(Bc))){var A=Fq();A&&A.focus()}var N=document&&document.activeElement;if(w){var F=[w].concat(f.map(sNe).filter(Boolean)),j=function(){if(!dNe(E)||!T||!Bc||WF)return!1;var ne=Jee(F),de=ne.findIndex(function(oe){var ge=oe.node;return ge===Bc});return de===0||de===ne.length-1};if((!N||cNe(N))&&(l||j()||!oNe()||!Bc&&d)&&(w&&!(Gee(F)||N&&pNe(N,F)||uNe(N))&&(document&&!Bc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(t=$ee(F,Bc,{focusOptions:v}),VS={})),Bc=document&&document.activeElement,Bc!==document.body&&(Fq=Kee(Bc)),_R=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var z=document&&document.activeElement,H=Y1e(F),te=H.map(function(K){var ne=K.node;return ne}).indexOf(z);te>-1&&(H.filter(function(K){var ne=K.guard,de=K.node;return ne&&de.dataset.focusAutoGuard}).forEach(function(K){var ne=K.node;return ne.removeAttribute("tabIndex")}),jq(te,H.length,1,H),jq(te,-1,-1,H))}}}return t},Qee=function(t){pk()&&t&&(t.stopPropagation(),t.preventDefault())},zF=function(){return BF(pk)},mNe=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||lNe(a,s)},gNe=function(){return null},Zee=function(){WF=!0},ete=function(){WF=!1,_R="just",BF(function(){_R="meanwhile"})},_Ne=function(){document.addEventListener("focusin",Qee),document.addEventListener("focusout",zF),window.addEventListener("focus",Zee),window.addEventListener("blur",ete)},ENe=function(){document.removeEventListener("focusin",Qee),document.removeEventListener("focusout",zF),window.removeEventListener("focus",Zee),window.removeEventListener("blur",ete)};function yNe(n){return n.filter(function(t){var s=t.disabled;return!s})}var tte={moveFocusInside:$ee,focusInside:Gee,focusNextElement:tNe,focusPrevElement:nNe,focusFirstElement:rNe,focusLastElement:iNe,captureFocusRestore:Kee};function vNe(n){var t=n.slice(-1)[0];t&&!US&&_Ne();var s=US,a=s&&t&&t.id===s.id;US=t,s&&!a&&(s.onDeactivation(),n.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(Bc=null,(!a||s.observed!==t.observed)&&t.onActivation(tte),pk(),BF(pk)):(ENe(),Bc=null)}Nee.assignSyncMedium(mNe);Dee.assignMedium(zF);f1e.assignMedium(function(n){return n(tte)});const SNe=T1e(yNe,vNe)(gNe);var IU=L.forwardRef(function(t,s){return ni.createElement(NF,SE({sideCar:SNe,ref:s},t))}),nte=NF.propTypes||{};nte.sideCar;n1e(nte,["sideCar"]);IU.propTypes={};const TNe=IU.default??IU,rte=n=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:E,persistentFocus:v,lockFocusAcrossFrames:T}=n,w=L.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&BJ(a.current).length===0&&requestAnimationFrame(()=>{var j;(j=a.current)==null||j.focus()})},[t,a]),A=L.useCallback(()=>{var F;(F=s==null?void 0:s.current)==null||F.focus()},[s]),N=l&&!s;return I.jsx(TNe,{crossFrame:T,persistentFocus:v,autoFocus:E,disabled:f,onActivation:w,onDeactivation:A,returnFocus:N,children:d})};rte.displayName="FocusLock";const[bNe,wNe]=Oi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),sf=Wt((n,t)=>{const s=oc("FormError",n),a=$i(n),l=b0();return l!=null&&l.isInvalid?I.jsx(bNe,{value:s,children:I.jsx(Dt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:dn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});sf.displayName="FormErrorMessage";const RNe=Wt((n,t)=>{const s=wNe(),a=b0();if(!(a!=null&&a.isInvalid))return null;const l=dn("chakra-form__error-icon",n.className);return I.jsx(Dn,{ref:t,"aria-hidden":!0,...n,__css:s.icon,className:l,children:I.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});RNe.displayName="FormErrorIcon";const bl=Wt(function(t,s){const a=Ou("FormLabel",t),l=$i(t),{className:d,children:f,requiredIndicator:E=I.jsx(ite,{}),optionalIndicator:v=null,...T}=l,w=b0(),A=(w==null?void 0:w.getLabelProps(T,s))??{ref:s,...T};return I.jsxs(Dt.label,{...A,className:dn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,w!=null&&w.isRequired?E:v]})});bl.displayName="FormLabel";const ite=Wt(function(t,s){const a=b0(),l=wee();if(!(a!=null&&a.isRequired))return null;const d=dn("chakra-form__required-indicator",t.className);return I.jsx(Dt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});ite.displayName="RequiredIndicator";const ste=Wt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:E,row:v,autoFlow:T,autoRows:w,templateRows:A,autoColumns:N,templateColumns:F,...j}=t,z={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:N,gridColumn:E,gridRow:v,gridAutoFlow:T,gridAutoRows:w,gridTemplateRows:A,gridTemplateColumns:F};return I.jsx(Dt.div,{ref:s,__css:z,...j})});ste.displayName="Grid";const ote=Wt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:E,...v}=t,T=T0(),w=E?INe(E,T):ANe(a);return I.jsx(ste,{ref:s,gap:f,columnGap:l,rowGap:d,templateColumns:w,...v})});ote.displayName="SimpleGrid";function CNe(n){return typeof n=="number"?`${n}px`:n}function INe(n,t){return RV(n,s=>{const a=oke("sizes",s,CNe(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function ANe(n){return RV(n,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function wg(n){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=n,d=L.Children.toArray(n.path),f=Wt((E,v)=>I.jsx(Dn,{ref:v,viewBox:t,...l,...E,children:d.length?d:I.jsx("path",{fill:"currentColor",d:s})}));return f.displayName=a,f}const AU=Wt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=t;return I.jsx("img",{width:a,height:l,ref:s,alt:d,...f})});AU.displayName="NativeImage";const Vh=Wt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:E,fit:v,loading:T,ignoreFallback:w,crossOrigin:A,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:F,...j}=t,z=a!==void 0||l!==void 0,H=T!=null||w||!z,te=See({...t,crossOrigin:A,ignoreFallback:H}),K=Mke(te,N),ne={ref:s,objectFit:v,objectPosition:E,...H?j:_0(j,["onError","onLoad"])};return K?l||I.jsx(Dt.img,{as:AU,className:"chakra-image__placeholder",src:a,...ne}):I.jsx(Dt.img,{as:AU,src:d,srcSet:f,crossOrigin:A,loading:T,referrerPolicy:F,className:"chakra-image",...ne})});Vh.displayName="Image";const Ro=Wt(function(t,s){const{htmlSize:a,...l}=t,d=oc("Input",l),f=$i(l),E=OF(f),v=dn("chakra-input",t.className);return I.jsx(Dt.input,{size:a,...E,__css:d.field,ref:s,className:v})});Ro.displayName="Input";Ro.id="Input";const[PNe,ONe]=Oi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),MO=Wt(function(t,s){const a=oc("Input",t),{children:l,className:d,...f}=$i(t),E=dn("chakra-input__group",d),v={},T=bV(l),w=a.field;T.forEach(N=>{a&&(w&&N.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&N.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const A=T.map(N=>{var j,z;const F=zk({size:((j=N.props)==null?void 0:j.size)||t.size,variant:((z=N.props)==null?void 0:z.variant)||t.variant});return N.type.id!=="Input"?L.cloneElement(N,F):L.cloneElement(N,Object.assign(F,v,N.props))});return I.jsx(Dt.div,{className:E,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:I.jsx(PNe,{value:a,children:A})})});MO.displayName="InputGroup";const kNe=Dt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),s1=Wt(function(t,s){const{placement:a="left",...l}=t,d=ONe(),f=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return I.jsx(kNe,{ref:s,__css:v,...l})});s1.id="InputElement";s1.displayName="InputElement";const Hw=Wt(function(t,s){const{className:a,...l}=t,d=dn("chakra-input__left-element",a);return I.jsx(s1,{ref:s,placement:"left",className:d,...l})});Hw.id="InputLeftElement";Hw.displayName="InputLeftElement";const ate=Wt(function(t,s){const{className:a,...l}=t,d=dn("chakra-input__right-element",a);return I.jsx(s1,{ref:s,placement:"right",className:d,...l})});ate.id="InputRightElement";ate.displayName="InputRightElement";const bu=Wt(function(t,s){const a=Ou("Link",t),{className:l,isExternal:d,...f}=$i(t);return I.jsx(Dt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:dn("chakra-link",l),...f,__css:a})});bu.displayName="Link";function NNe(n,t={}){const{ssr:s=!0,fallback:a}=t,{getWindow:l}=lCe(),d=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(T=>T!=null);const[E,v]=L.useState(()=>d.map((T,w)=>({media:T,matches:s?!!f[w]:l().matchMedia(T).matches})));return L.useEffect(()=>{const T=l();v(d.map(N=>({media:N,matches:T.matchMedia(N).matches})));const w=d.map(N=>T.matchMedia(N)),A=N=>{v(F=>F.slice().map(j=>j.media===N.media?{...j,matches:N.matches}:j))};return w.forEach(N=>{typeof N.addListener=="function"?N.addListener(A):N.addEventListener("change",A)}),()=>{w.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(A):N.removeEventListener("change",A)})}},[l]),E.map(T=>T.matches)}function DNe(n,t,s,a){if(t==null)return a;if(!a)return n.find(f=>s(f).toLowerCase().startsWith(t.toLowerCase()));const l=n.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function LNe(n){const{key:t}=n;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function xNe(n={}){const{timeout:t=300,preventDefault:s=()=>!0}=n,[a,l]=L.useState([]),d=L.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},t)};L.useEffect(()=>f,[]);function v(T){return w=>{if(w.key==="Backspace"){const A=[...a];A.pop(),l(A);return}if(LNe(w)){const A=a.concat(w.key);s(w)&&(w.preventDefault(),w.stopPropagation()),l(A),T(A.join("")),E()}}}return v}var Yc="top",Iu="bottom",Au="right",Xc="left",GF="auto",BR=[Yc,Iu,Au,Xc],e0="start",ER="end",MNe="clippingParents",cte="viewport",nw="popper",UNe="reference",Bq=BR.reduce(function(n,t){return n.concat([t+"-"+e0,t+"-"+ER])},[]),lte=[].concat(BR,[GF]).reduce(function(n,t){return n.concat([t,t+"-"+e0,t+"-"+ER])},[]),VNe="beforeRead",FNe="read",jNe="afterRead",BNe="beforeMain",WNe="main",zNe="afterMain",GNe="beforeWrite",HNe="write",$Ne="afterWrite",KNe=[VNe,FNe,jNe,BNe,WNe,zNe,GNe,HNe,$Ne];function Jh(n){return n?(n.nodeName||"").toLowerCase():null}function kl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function wE(n){var t=kl(n).Element;return n instanceof t||n instanceof Element}function Ru(n){var t=kl(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function HF(n){if(typeof ShadowRoot>"u")return!1;var t=kl(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function qNe(n){var t=n.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!Ru(d)||!Jh(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var E=l[f];E===!1?d.removeAttribute(f):d.setAttribute(f,E===!0?"":E)}))})}function YNe(n){var t=n.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},f=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),E=f.reduce(function(v,T){return v[T]="",v},{});!Ru(l)||!Jh(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const XNe={name:"applyStyles",enabled:!0,phase:"write",fn:qNe,effect:YNe,requires:["computeStyles"]};function Hh(n){return n.split("-")[0]}var EE=Math.max,fk=Math.min,t0=Math.round;function PU(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function ute(){return!/^((?!chrome|android).)*safari/i.test(PU())}function n0(n,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=n.getBoundingClientRect(),l=1,d=1;t&&Ru(n)&&(l=n.offsetWidth>0&&t0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&t0(a.height)/n.offsetHeight||1);var f=wE(n)?kl(n):window,E=f.visualViewport,v=!ute()&&s,T=(a.left+(v&&E?E.offsetLeft:0))/l,w=(a.top+(v&&E?E.offsetTop:0))/d,A=a.width/l,N=a.height/d;return{width:A,height:N,top:w,right:T+A,bottom:w+N,left:T,x:T,y:w}}function $F(n){var t=n0(n),s=n.offsetWidth,a=n.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:n.offsetLeft,y:n.offsetTop,width:s,height:a}}function dte(n,t){var s=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(s&&HF(s)){var a=t;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Rf(n){return kl(n).getComputedStyle(n)}function JNe(n){return["table","td","th"].indexOf(Jh(n))>=0}function Rg(n){return((wE(n)?n.ownerDocument:n.document)||window.document).documentElement}function o1(n){return Jh(n)==="html"?n:n.assignedSlot||n.parentNode||(HF(n)?n.host:null)||Rg(n)}function Wq(n){return!Ru(n)||Rf(n).position==="fixed"?null:n.offsetParent}function QNe(n){var t=/firefox/i.test(PU()),s=/Trident/i.test(PU());if(s&&Ru(n)){var a=Rf(n);if(a.position==="fixed")return null}var l=o1(n);for(HF(l)&&(l=l.host);Ru(l)&&["html","body"].indexOf(Jh(l))<0;){var d=Rf(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function WR(n){for(var t=kl(n),s=Wq(n);s&&JNe(s)&&Rf(s).position==="static";)s=Wq(s);return s&&(Jh(s)==="html"||Jh(s)==="body"&&Rf(s).position==="static")?t:s||QNe(n)||t}function KF(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function $w(n,t,s){return EE(n,fk(t,s))}function ZNe(n,t,s){var a=$w(n,t,s);return a>s?s:a}function hte(){return{top:0,right:0,bottom:0,left:0}}function pte(n){return Object.assign({},hte(),n)}function fte(n,t){return t.reduce(function(s,a){return s[a]=n,s},{})}var eDe=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,pte(typeof t!="number"?t:fte(t,BR))};function tDe(n){var t,s=n.state,a=n.name,l=n.options,d=s.elements.arrow,f=s.modifiersData.popperOffsets,E=Hh(s.placement),v=KF(E),T=[Xc,Au].indexOf(E)>=0,w=T?"height":"width";if(!(!d||!f)){var A=eDe(l.padding,s),N=$F(d),F=v==="y"?Yc:Xc,j=v==="y"?Iu:Au,z=s.rects.reference[w]+s.rects.reference[v]-f[v]-s.rects.popper[w],H=f[v]-s.rects.reference[v],te=WR(d),K=te?v==="y"?te.clientHeight||0:te.clientWidth||0:0,ne=z/2-H/2,de=A[F],oe=K-N[w]-A[j],ge=K/2-N[w]/2+ne,ee=$w(de,ge,oe),Z=v;s.modifiersData[a]=(t={},t[Z]=ee,t.centerOffset=ee-ge,t)}}function nDe(n){var t=n.state,s=n.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||dte(t.elements.popper,l)&&(t.elements.arrow=l))}const rDe={name:"arrow",enabled:!0,phase:"main",fn:tDe,effect:nDe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function r0(n){return n.split("-")[1]}var iDe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function sDe(n,t){var s=n.x,a=n.y,l=t.devicePixelRatio||1;return{x:t0(s*l)/l||0,y:t0(a*l)/l||0}}function zq(n){var t,s=n.popper,a=n.popperRect,l=n.placement,d=n.variation,f=n.offsets,E=n.position,v=n.gpuAcceleration,T=n.adaptive,w=n.roundOffsets,A=n.isFixed,N=f.x,F=N===void 0?0:N,j=f.y,z=j===void 0?0:j,H=typeof w=="function"?w({x:F,y:z}):{x:F,y:z};F=H.x,z=H.y;var te=f.hasOwnProperty("x"),K=f.hasOwnProperty("y"),ne=Xc,de=Yc,oe=window;if(T){var ge=WR(s),ee="clientHeight",Z="clientWidth";if(ge===kl(s)&&(ge=Rg(s),Rf(ge).position!=="static"&&E==="absolute"&&(ee="scrollHeight",Z="scrollWidth")),ge=ge,l===Yc||(l===Xc||l===Au)&&d===ER){de=Iu;var J=A&&ge===oe&&oe.visualViewport?oe.visualViewport.height:ge[ee];z-=J-a.height,z*=v?1:-1}if(l===Xc||(l===Yc||l===Iu)&&d===ER){ne=Au;var se=A&&ge===oe&&oe.visualViewport?oe.visualViewport.width:ge[Z];F-=se-a.width,F*=v?1:-1}}var he=Object.assign({position:E},T&&iDe),pe=w===!0?sDe({x:F,y:z},kl(s)):{x:F,y:z};if(F=pe.x,z=pe.y,v){var le;return Object.assign({},he,(le={},le[de]=K?"0":"",le[ne]=te?"0":"",le.transform=(oe.devicePixelRatio||1)<=1?"translate("+F+"px, "+z+"px)":"translate3d("+F+"px, "+z+"px, 0)",le))}return Object.assign({},he,(t={},t[de]=K?z+"px":"",t[ne]=te?F+"px":"",t.transform="",t))}function oDe(n){var t=n.state,s=n.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,f=d===void 0?!0:d,E=s.roundOffsets,v=E===void 0?!0:E,T={placement:Hh(t.placement),variation:r0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,zq(Object.assign({},T,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,zq(Object.assign({},T,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const aDe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:oDe,data:{}};var iO={passive:!0};function cDe(n){var t=n.state,s=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,E=f===void 0?!0:f,v=kl(t.elements.popper),T=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&T.forEach(function(w){w.addEventListener("scroll",s.update,iO)}),E&&v.addEventListener("resize",s.update,iO),function(){d&&T.forEach(function(w){w.removeEventListener("scroll",s.update,iO)}),E&&v.removeEventListener("resize",s.update,iO)}}const lDe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:cDe,data:{}};var uDe={left:"right",right:"left",bottom:"top",top:"bottom"};function UO(n){return n.replace(/left|right|bottom|top/g,function(t){return uDe[t]})}var dDe={start:"end",end:"start"};function Gq(n){return n.replace(/start|end/g,function(t){return dDe[t]})}function qF(n){var t=kl(n),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function YF(n){return n0(Rg(n)).left+qF(n).scrollLeft}function hDe(n,t){var s=kl(n),a=Rg(n),l=s.visualViewport,d=a.clientWidth,f=a.clientHeight,E=0,v=0;if(l){d=l.width,f=l.height;var T=ute();(T||!T&&t==="fixed")&&(E=l.offsetLeft,v=l.offsetTop)}return{width:d,height:f,x:E+YF(n),y:v}}function pDe(n){var t,s=Rg(n),a=qF(n),l=(t=n.ownerDocument)==null?void 0:t.body,d=EE(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=EE(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+YF(n),v=-a.scrollTop;return Rf(l||s).direction==="rtl"&&(E+=EE(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:E,y:v}}function XF(n){var t=Rf(n),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function mte(n){return["html","body","#document"].indexOf(Jh(n))>=0?n.ownerDocument.body:Ru(n)&&XF(n)?n:mte(o1(n))}function Kw(n,t){var s;t===void 0&&(t=[]);var a=mte(n),l=a===((s=n.ownerDocument)==null?void 0:s.body),d=kl(a),f=l?[d].concat(d.visualViewport||[],XF(a)?a:[]):a,E=t.concat(f);return l?E:E.concat(Kw(o1(f)))}function OU(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function fDe(n,t){var s=n0(n,!1,t==="fixed");return s.top=s.top+n.clientTop,s.left=s.left+n.clientLeft,s.bottom=s.top+n.clientHeight,s.right=s.left+n.clientWidth,s.width=n.clientWidth,s.height=n.clientHeight,s.x=s.left,s.y=s.top,s}function Hq(n,t,s){return t===cte?OU(hDe(n,s)):wE(t)?fDe(t,s):OU(pDe(Rg(n)))}function mDe(n){var t=Kw(o1(n)),s=["absolute","fixed"].indexOf(Rf(n).position)>=0,a=s&&Ru(n)?WR(n):n;return wE(a)?t.filter(function(l){return wE(l)&&dte(l,a)&&Jh(l)!=="body"}):[]}function gDe(n,t,s,a){var l=t==="clippingParents"?mDe(n):[].concat(t),d=[].concat(l,[s]),f=d[0],E=d.reduce(function(v,T){var w=Hq(n,T,a);return v.top=EE(w.top,v.top),v.right=fk(w.right,v.right),v.bottom=fk(w.bottom,v.bottom),v.left=EE(w.left,v.left),v},Hq(n,f,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function gte(n){var t=n.reference,s=n.element,a=n.placement,l=a?Hh(a):null,d=a?r0(a):null,f=t.x+t.width/2-s.width/2,E=t.y+t.height/2-s.height/2,v;switch(l){case Yc:v={x:f,y:t.y-s.height};break;case Iu:v={x:f,y:t.y+t.height};break;case Au:v={x:t.x+t.width,y:E};break;case Xc:v={x:t.x-s.width,y:E};break;default:v={x:t.x,y:t.y}}var T=l?KF(l):null;if(T!=null){var w=T==="y"?"height":"width";switch(d){case e0:v[T]=v[T]-(t[w]/2-s[w]/2);break;case ER:v[T]=v[T]+(t[w]/2-s[w]/2);break}}return v}function yR(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?n.placement:a,d=s.strategy,f=d===void 0?n.strategy:d,E=s.boundary,v=E===void 0?MNe:E,T=s.rootBoundary,w=T===void 0?cte:T,A=s.elementContext,N=A===void 0?nw:A,F=s.altBoundary,j=F===void 0?!1:F,z=s.padding,H=z===void 0?0:z,te=pte(typeof H!="number"?H:fte(H,BR)),K=N===nw?UNe:nw,ne=n.rects.popper,de=n.elements[j?K:N],oe=gDe(wE(de)?de:de.contextElement||Rg(n.elements.popper),v,w,f),ge=n0(n.elements.reference),ee=gte({reference:ge,element:ne,placement:l}),Z=OU(Object.assign({},ne,ee)),J=N===nw?Z:ge,se={top:oe.top-J.top+te.top,bottom:J.bottom-oe.bottom+te.bottom,left:oe.left-J.left+te.left,right:J.right-oe.right+te.right},he=n.modifiersData.offset;if(N===nw&&he){var pe=he[l];Object.keys(se).forEach(function(le){var Me=[Au,Iu].indexOf(le)>=0?1:-1,He=[Yc,Iu].indexOf(le)>=0?"y":"x";se[le]+=pe[He]*Me})}return se}function _De(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,f=s.padding,E=s.flipVariations,v=s.allowedAutoPlacements,T=v===void 0?lte:v,w=r0(a),A=w?E?Bq:Bq.filter(function(j){return r0(j)===w}):BR,N=A.filter(function(j){return T.indexOf(j)>=0});N.length===0&&(N=A);var F=N.reduce(function(j,z){return j[z]=yR(n,{placement:z,boundary:l,rootBoundary:d,padding:f})[Hh(z)],j},{});return Object.keys(F).sort(function(j,z){return F[j]-F[z]})}function EDe(n){if(Hh(n)===GF)return[];var t=UO(n);return[Gq(n),t,Gq(t)]}function yDe(n){var t=n.state,s=n.options,a=n.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,E=f===void 0?!0:f,v=s.fallbackPlacements,T=s.padding,w=s.boundary,A=s.rootBoundary,N=s.altBoundary,F=s.flipVariations,j=F===void 0?!0:F,z=s.allowedAutoPlacements,H=t.options.placement,te=Hh(H),K=te===H,ne=v||(K||!j?[UO(H)]:EDe(H)),de=[H].concat(ne).reduce(function(Ue,ze){return Ue.concat(Hh(ze)===GF?_De(t,{placement:ze,boundary:w,rootBoundary:A,padding:T,flipVariations:j,allowedAutoPlacements:z}):ze)},[]),oe=t.rects.reference,ge=t.rects.popper,ee=new Map,Z=!0,J=de[0],se=0;se<de.length;se++){var he=de[se],pe=Hh(he),le=r0(he)===e0,Me=[Yc,Iu].indexOf(pe)>=0,He=Me?"width":"height",rt=yR(t,{placement:he,boundary:w,rootBoundary:A,altBoundary:N,padding:T}),we=Me?le?Au:Xc:le?Iu:Yc;oe[He]>ge[He]&&(we=UO(we));var Ce=UO(we),ve=[];if(d&&ve.push(rt[pe]<=0),E&&ve.push(rt[we]<=0,rt[Ce]<=0),ve.every(function(Ue){return Ue})){J=he,Z=!1;break}ee.set(he,ve)}if(Z)for(var Ne=j?3:1,be=function(ze){var et=de.find(function(nt){var dt=ee.get(nt);if(dt)return dt.slice(0,ze).every(function(Xe){return Xe})});if(et)return J=et,"break"},Te=Ne;Te>0;Te--){var Ae=be(Te);if(Ae==="break")break}t.placement!==J&&(t.modifiersData[a]._skip=!0,t.placement=J,t.reset=!0)}}const vDe={name:"flip",enabled:!0,phase:"main",fn:yDe,requiresIfExists:["offset"],data:{_skip:!1}};function $q(n,t,s){return s===void 0&&(s={x:0,y:0}),{top:n.top-t.height-s.y,right:n.right-t.width+s.x,bottom:n.bottom-t.height+s.y,left:n.left-t.width-s.x}}function Kq(n){return[Yc,Au,Iu,Xc].some(function(t){return n[t]>=0})}function SDe(n){var t=n.state,s=n.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,f=yR(t,{elementContext:"reference"}),E=yR(t,{altBoundary:!0}),v=$q(f,a),T=$q(E,l,d),w=Kq(v),A=Kq(T);t.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:T,isReferenceHidden:w,hasPopperEscaped:A},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":A})}const TDe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:SDe};function bDe(n,t,s){var a=Hh(n),l=[Xc,Yc].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:n})):s,f=d[0],E=d[1];return f=f||0,E=(E||0)*l,[Xc,Au].indexOf(a)>=0?{x:E,y:f}:{x:f,y:E}}function wDe(n){var t=n.state,s=n.options,a=n.name,l=s.offset,d=l===void 0?[0,0]:l,f=lte.reduce(function(w,A){return w[A]=bDe(A,t.rects,d),w},{}),E=f[t.placement],v=E.x,T=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=T),t.modifiersData[a]=f}const RDe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:wDe};function CDe(n){var t=n.state,s=n.name;t.modifiersData[s]=gte({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const IDe={name:"popperOffsets",enabled:!0,phase:"read",fn:CDe,data:{}};function ADe(n){return n==="x"?"y":"x"}function PDe(n){var t=n.state,s=n.options,a=n.name,l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,E=f===void 0?!1:f,v=s.boundary,T=s.rootBoundary,w=s.altBoundary,A=s.padding,N=s.tether,F=N===void 0?!0:N,j=s.tetherOffset,z=j===void 0?0:j,H=yR(t,{boundary:v,rootBoundary:T,padding:A,altBoundary:w}),te=Hh(t.placement),K=r0(t.placement),ne=!K,de=KF(te),oe=ADe(de),ge=t.modifiersData.popperOffsets,ee=t.rects.reference,Z=t.rects.popper,J=typeof z=="function"?z(Object.assign({},t.rects,{placement:t.placement})):z,se=typeof J=="number"?{mainAxis:J,altAxis:J}:Object.assign({mainAxis:0,altAxis:0},J),he=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,pe={x:0,y:0};if(ge){if(d){var le,Me=de==="y"?Yc:Xc,He=de==="y"?Iu:Au,rt=de==="y"?"height":"width",we=ge[de],Ce=we+H[Me],ve=we-H[He],Ne=F?-Z[rt]/2:0,be=K===e0?ee[rt]:Z[rt],Te=K===e0?-Z[rt]:-ee[rt],Ae=t.elements.arrow,Ue=F&&Ae?$F(Ae):{width:0,height:0},ze=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:hte(),et=ze[Me],nt=ze[He],dt=$w(0,ee[rt],Ue[rt]),Xe=ne?ee[rt]/2-Ne-dt-et-se.mainAxis:be-dt-et-se.mainAxis,Ct=ne?-ee[rt]/2+Ne+dt+nt+se.mainAxis:Te+dt+nt+se.mainAxis,hn=t.elements.arrow&&WR(t.elements.arrow),Ut=hn?de==="y"?hn.clientTop||0:hn.clientLeft||0:0,ln=(le=he==null?void 0:he[de])!=null?le:0,xn=we+Xe-ln-Ut,Yt=we+Ct-ln,Yn=$w(F?fk(Ce,xn):Ce,we,F?EE(ve,Yt):ve);ge[de]=Yn,pe[de]=Yn-we}if(E){var Kt,Re=de==="x"?Yc:Xc,Fe=de==="x"?Iu:Au,Ke=ge[oe],_t=oe==="y"?"height":"width",vt=Ke+H[Re],Ge=Ke-H[Fe],Ot=[Yc,Xc].indexOf(te)!==-1,Xt=(Kt=he==null?void 0:he[oe])!=null?Kt:0,pn=Ot?vt:Ke-ee[_t]-Z[_t]-Xt+se.altAxis,an=Ot?Ke+ee[_t]+Z[_t]-Xt-se.altAxis:Ge,ir=F&&Ot?ZNe(pn,Ke,an):$w(F?pn:vt,Ke,F?an:Ge);ge[oe]=ir,pe[oe]=ir-Ke}t.modifiersData[a]=pe}}const ODe={name:"preventOverflow",enabled:!0,phase:"main",fn:PDe,requiresIfExists:["offset"]};function kDe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function NDe(n){return n===kl(n)||!Ru(n)?qF(n):kDe(n)}function DDe(n){var t=n.getBoundingClientRect(),s=t0(t.width)/n.offsetWidth||1,a=t0(t.height)/n.offsetHeight||1;return s!==1||a!==1}function LDe(n,t,s){s===void 0&&(s=!1);var a=Ru(t),l=Ru(t)&&DDe(t),d=Rg(t),f=n0(n,l,s),E={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((Jh(t)!=="body"||XF(d))&&(E=NDe(t)),Ru(t)?(v=n0(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=YF(d))),{x:f.left+E.scrollLeft-v.x,y:f.top+E.scrollTop-v.y,width:f.width,height:f.height}}function xDe(n){var t=new Map,s=new Set,a=[];n.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(E){if(!s.has(E)){var v=t.get(E);v&&l(v)}}),a.push(d)}return n.forEach(function(d){s.has(d.name)||l(d)}),a}function MDe(n){var t=xDe(n);return KNe.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function UDe(n){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(n())})})),t}}function VDe(n){var t=n.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var qq={placement:"bottom",modifiers:[],strategy:"absolute"};function Yq(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function FDe(n){n===void 0&&(n={});var t=n,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?qq:l;return function(E,v,T){T===void 0&&(T=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},qq,d),modifiersData:{},elements:{reference:E,popper:v},attributes:{},styles:{}},A=[],N=!1,F={state:w,setOptions:function(te){var K=typeof te=="function"?te(w.options):te;z(),w.options=Object.assign({},d,w.options,K),w.scrollParents={reference:wE(E)?Kw(E):E.contextElement?Kw(E.contextElement):[],popper:Kw(v)};var ne=MDe(VDe([].concat(a,w.options.modifiers)));return w.orderedModifiers=ne.filter(function(de){return de.enabled}),j(),F.update()},forceUpdate:function(){if(!N){var te=w.elements,K=te.reference,ne=te.popper;if(Yq(K,ne)){w.rects={reference:LDe(K,WR(ne),w.options.strategy==="fixed"),popper:$F(ne)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(se){return w.modifiersData[se.name]=Object.assign({},se.data)});for(var de=0;de<w.orderedModifiers.length;de++){if(w.reset===!0){w.reset=!1,de=-1;continue}var oe=w.orderedModifiers[de],ge=oe.fn,ee=oe.options,Z=ee===void 0?{}:ee,J=oe.name;typeof ge=="function"&&(w=ge({state:w,options:Z,name:J,instance:F})||w)}}}},update:UDe(function(){return new Promise(function(H){F.forceUpdate(),H(w)})}),destroy:function(){z(),N=!0}};if(!Yq(E,v))return F;F.setOptions(T).then(function(H){!N&&T.onFirstUpdate&&T.onFirstUpdate(H)});function j(){w.orderedModifiers.forEach(function(H){var te=H.name,K=H.options,ne=K===void 0?{}:K,de=H.effect;if(typeof de=="function"){var oe=de({state:w,name:te,instance:F,options:ne}),ge=function(){};A.push(oe||ge)}})}function z(){A.forEach(function(H){return H()}),A=[]}return F}}var jDe=[lDe,IDe,aDe,XNe,RDe,vDe,ODe,rDe,TDe],BDe=FDe({defaultModifiers:jDe});const rS=(n,t)=>({var:n,varRef:t?`var(${n}, ${t})`:`var(${n})`}),Hs={arrowShadowColor:rS("--popper-arrow-shadow-color"),arrowSize:rS("--popper-arrow-size","8px"),arrowSizeHalf:rS("--popper-arrow-size-half"),arrowBg:rS("--popper-arrow-bg"),transformOrigin:rS("--popper-transform-origin"),arrowOffset:rS("--popper-arrow-offset")};function WDe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const zDe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},GDe=n=>zDe[n],Xq={scroll:!0,resize:!0};function HDe(n){let t;return typeof n=="object"?t={enabled:!0,options:{...Xq,...n}}:t={enabled:n,options:Xq},t}const $De={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const t=n.elements.reference;n.elements.popper.style.width=`${t.offsetWidth}px`}},KDe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{Jq(n)},effect:({state:n})=>()=>{Jq(n)}},Jq=n=>{n.elements.popper.style.setProperty(Hs.transformOrigin.var,GDe(n.placement))},qDe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{YDe(n)}},YDe=n=>{var s;if(!n.placement)return;const t=XDe(n.placement);if((s=n.elements)!=null&&s.arrow&&t){Object.assign(n.elements.arrow.style,{[t.property]:t.value,width:Hs.arrowSize.varRef,height:Hs.arrowSize.varRef,zIndex:-1});const a={[Hs.arrowSizeHalf.var]:`calc(${Hs.arrowSize.varRef} / 2 - 1px)`,[Hs.arrowOffset.var]:`calc(${Hs.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},XDe=n=>{if(n.startsWith("top"))return{property:"bottom",value:Hs.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Hs.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Hs.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Hs.arrowOffset.varRef}},JDe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{Qq(n)},effect:({state:n})=>()=>{Qq(n)}},Qq=n=>{if(!n.elements.arrow)return;const t=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=WDe(n.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:Hs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},QDe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},ZDe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function eLe(n,t="ltr"){var a;const s=((a=QDe[n])==null?void 0:a[t])||n;return t==="ltr"?s:ZDe[n]??s}function JF(n={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:E,gutter:v=8,flip:T=!0,boundary:w="clippingParents",preventOverflow:A=!0,matchWidth:N,direction:F="ltr"}=n,j=L.useRef(null),z=L.useRef(null),H=L.useRef(null),te=eLe(a,F),K=L.useRef(()=>{}),ne=L.useCallback(()=>{var se;!t||!j.current||!z.current||((se=K.current)==null||se.call(K),H.current=BDe(j.current,z.current,{placement:te,modifiers:[JDe,qDe,KDe,{...$De,enabled:!!N},{name:"eventListeners",...HDe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,v]}},{name:"flip",enabled:!!T,options:{padding:8}},{name:"preventOverflow",enabled:!!A,options:{boundary:w}},...s??[]],strategy:l}),H.current.forceUpdate(),K.current=H.current.destroy)},[te,t,s,N,f,d,E,v,T,A,w,l]);L.useEffect(()=>()=>{var se;!j.current&&!z.current&&((se=H.current)==null||se.destroy(),H.current=null)},[]);const de=L.useCallback(se=>{j.current=se,ne()},[ne]),oe=L.useCallback((se={},he=null)=>({...se,ref:es(de,he)}),[de]),ge=L.useCallback(se=>{z.current=se,ne()},[ne]),ee=L.useCallback((se={},he=null)=>({...se,ref:es(ge,he),style:{...se.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ge,N]),Z=L.useCallback((se={},he=null)=>{const{size:pe,shadowColor:le,bg:Me,style:He,...rt}=se;return{...rt,ref:he,"data-popper-arrow":"",style:tLe(se)}},[]),J=L.useCallback((se={},he=null)=>({...se,ref:he,"data-popper-arrow-inner":""}),[]);return{update(){var se;(se=H.current)==null||se.update()},forceUpdate(){var se;(se=H.current)==null||se.forceUpdate()},transformOrigin:Hs.transformOrigin.varRef,referenceRef:de,popperRef:ge,getPopperProps:ee,getArrowProps:Z,getArrowInnerProps:J,getReferenceProps:oe}}function tLe(n){const{size:t,shadowColor:s,bg:a,style:l}=n,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function nLe(){const n=L.useRef(new Map),t=n.current,s=L.useCallback((l,d,f,E)=>{n.current.set(f,{type:d,el:l,options:E}),l.addEventListener(d,f,E)},[]),a=L.useCallback((l,d,f,E)=>{l.removeEventListener(d,f,E),n.current.delete(f)},[]);return L.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function p2(n){var l,d;const t=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function _te(n={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:E,onClick:v,onKeyDown:T,onKeyUp:w,tabIndex:A,onMouseOver:N,onMouseLeave:F,...j}=n,[z,H]=L.useState(!0),[te,K]=L.useState(!1),ne=nLe(),de=we=>{we&&we.tagName!=="BUTTON"&&H(!1)},oe=z?A:A||0,ge=s&&!a,ee=L.useCallback(we=>{if(s){we.stopPropagation(),we.preventDefault();return}we.currentTarget.focus(),v==null||v(we)},[s,v]),Z=L.useCallback(we=>{te&&p2(we)&&(we.preventDefault(),we.stopPropagation(),K(!1),ne.remove(document,"keyup",Z,!1))},[te,ne]),J=L.useCallback(we=>{if(T==null||T(we),s||we.defaultPrevented||we.metaKey||!p2(we.nativeEvent)||z)return;const Ce=l&&we.key==="Enter";d&&we.key===" "&&(we.preventDefault(),K(!0)),Ce&&(we.preventDefault(),we.currentTarget.click()),ne.add(document,"keyup",Z,!1)},[s,z,T,l,d,ne,Z]),se=L.useCallback(we=>{if(w==null||w(we),s||we.defaultPrevented||we.metaKey||!p2(we.nativeEvent)||z)return;d&&we.key===" "&&(we.preventDefault(),K(!1),we.currentTarget.click())},[d,z,s,w]),he=L.useCallback(we=>{we.button===0&&(K(!1),ne.remove(document,"mouseup",he,!1))},[ne]),pe=L.useCallback(we=>{if(we.button!==0)return;if(s){we.stopPropagation(),we.preventDefault();return}z||K(!0),we.currentTarget.focus({preventScroll:!0}),ne.add(document,"mouseup",he,!1),f==null||f(we)},[s,z,f,ne,he]),le=L.useCallback(we=>{we.button===0&&(z||K(!1),E==null||E(we))},[E,z]),Me=L.useCallback(we=>{if(s){we.preventDefault();return}N==null||N(we)},[s,N]),He=L.useCallback(we=>{te&&(we.preventDefault(),K(!1)),F==null||F(we)},[te,F]),rt=es(t,de);return z?{...j,ref:rt,type:"button","aria-disabled":ge?void 0:s,disabled:ge,onClick:ee,onMouseDown:f,onMouseUp:E,onKeyUp:w,onKeyDown:T,onMouseOver:N,onMouseLeave:F}:{...j,ref:rt,role:"button","data-active":Kn(te),"aria-disabled":s?"true":void 0,tabIndex:ge?void 0:oe,onClick:ee,onMouseDown:pe,onMouseUp:le,onKeyUp:se,onKeyDown:J,onMouseOver:Me,onMouseLeave:He}}const[rLe,iLe,sLe,oLe]=Eee(),[aLe,zR]=Oi({strict:!1,name:"MenuContext"});function Ete(n){return(n==null?void 0:n.ownerDocument)??document}function cLe(n){return Ete(n).activeElement===n}function lLe(n={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:E,defaultIsOpen:v,onClose:T,onOpen:w,placement:A="bottom-start",lazyBehavior:N="unmount",direction:F,computePositionOnMount:j=!1,...z}=n,H=L.useRef(null),te=L.useRef(null),K=L.useRef(!0),ne=sLe(),de=L.useCallback(()=>{requestAnimationFrame(()=>{var Ae;(Ae=H.current)==null||Ae.focus({preventScroll:!1})})},[]),oe=L.useCallback(()=>{const Ae=setTimeout(()=>{var Ue,ze;if(l)(Ue=l.current)==null||Ue.focus();else if(!ne.count())(ze=H.current)==null||ze.focus({preventScroll:!1});else{const et=ne.firstEnabled();et&&Me(et.index)}});ve.current.add(Ae)},[ne,l]),ge=L.useCallback(()=>{const Ae=setTimeout(()=>{var Ue;if(!ne.count())(Ue=H.current)==null||Ue.focus({preventScroll:!1});else{const ze=ne.lastEnabled();ze&&Me(ze.index)}});ve.current.add(Ae)},[ne]),ee=L.useCallback(()=>{w==null||w(),d?oe():de()},[d,oe,de,w]),{isOpen:Z,onOpen:J,onClose:se,onToggle:he}=Sf({isOpen:E,defaultIsOpen:v,onClose:T,onOpen:ee});XJ({enabled:Z&&a,ref:H,handler:Ae=>{var ze,et,nt;const Ue=((et=(ze=Ae.composedPath)==null?void 0:ze.call(Ae))==null?void 0:et[0])??Ae.target;(nt=te.current)!=null&&nt.contains(Ue)||se()}});const pe=JF({...z,enabled:Z||j,placement:A,direction:F}),[le,Me]=L.useState(-1);KJ(H,{focusRef:te,visible:Z,shouldFocus:!0});const He=HJ({isOpen:Z,ref:H}),[rt,we]=_Ee(t,"menu-button","menu-list"),Ce=L.useCallback(()=>{J(),de()},[J,de]),ve=L.useRef(new Set([]));L.useEffect(()=>{const Ae=ve.current;return()=>{Ae.forEach(Ue=>clearTimeout(Ue)),Ae.clear()}},[]),hg(()=>{var Ae;Z||(Me(-1),(Ae=H.current)==null||Ae.scrollTo(0,0))},[Z]),hg(()=>{Z&&le===-1&&de()},[le,Z]),L.useEffect(()=>{var Ue;if(!Z)return;const Ae=ne.item(le);(Ue=Ae==null?void 0:Ae.node)==null||Ue.focus({preventScroll:!K.current})},[ne,le,Z]);const Ne=L.useCallback(()=>{J(),oe()},[oe,J]),be=L.useCallback(()=>{K.current=!0,J(),ge()},[J,ge]),Te=L.useCallback(()=>{var nt,dt;const Ae=Ete(H.current),Ue=(nt=H.current)==null?void 0:nt.contains(Ae.activeElement);if(!(Z&&!Ue))return;const et=(dt=ne.item(le))==null?void 0:dt.node;et==null||et.focus({preventScroll:!K.current})},[Z,le,ne]);return{openAndFocusMenu:Ce,openAndFocusFirstItem:Ne,openAndFocusLastItem:be,onTransitionEnd:Te,unstable__animationState:He,descendants:ne,popper:pe,buttonId:rt,menuId:we,forceUpdate:pe.forceUpdate,orientation:"vertical",isOpen:Z,onToggle:he,onOpen:J,onClose:se,menuRef:H,buttonRef:te,focusedIndex:le,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:f,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:K}}function uLe(n={},t=null){const s=zR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:E}=s,v=L.useCallback(T=>{const w=T.key,N={Enter:d,ArrowDown:d,ArrowUp:f}[w];N&&(E.current=!0,T.preventDefault(),T.stopPropagation(),N(T))},[d,f,E]);return{...n,ref:es(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":Kn(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:Qn(n.onClick,a),onKeyDown:Qn(n.onKeyDown,v)}}function kU(n){var t;return fLe(n)&&!!((t=n==null?void 0:n.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function dLe(n={},t=null){const s=zR();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:E,menuId:v,isLazy:T,lazyBehavior:w,scrollIntoViewRef:A,unstable__animationState:N}=s,F=iLe(),j=xNe({preventDefault:K=>K.key!==" "&&kU(K.target)}),z=L.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const ne=K.key,oe={Tab:ee=>ee.preventDefault(),Escape:ee=>{ee.stopPropagation(),E()},ArrowDown:()=>{A.current=!0;const ee=F.nextEnabled(a)??F.firstEnabled();ee&&l(ee.index)},ArrowUp:()=>{A.current=!0;const ee=F.prevEnabled(a)??F.firstEnabled();ee&&l(ee.index)}}[ne];if(oe){K.preventDefault(),oe(K);return}const ge=j(ee=>{const Z=DNe(F.values(),ee,J=>{var se;return((se=J==null?void 0:J.node)==null?void 0:se.textContent)??""},F.item(a));if(Z){const J=F.indexOf(Z.node);l(J)}});kU(K.target)&&ge(K)},[F,a,j,E,l,A]),H=L.useRef(!1);f&&(H.current=!0);const te=wV({wasSelected:H.current,enabled:T,mode:w,isSelected:N.present});return{...n,ref:es(d,t),children:te?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Qn(n.onKeyDown,z)}}function hLe(n={}){const{popper:t,isOpen:s}=zR();return t.getPopperProps({...n,style:{visibility:s?"visible":"hidden",...n.style}})}function pLe(n={},t=null){const{onMouseEnter:s,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:E,isFocusable:v,closeOnSelect:T,type:w,...A}=n,N=zR(),{setFocusedIndex:F,focusedIndex:j,closeOnSelect:z,onClose:H,menuId:te,scrollIntoViewRef:K}=N,ne=L.useRef(null),de=`${te}-menuitem-${L.useId()}`,{index:oe,register:ge}=oLe({disabled:E&&!v}),ee=L.useCallback(Me=>{s==null||s(Me),!E&&(K.current=!1,F(oe))},[F,oe,E,s,K]),Z=L.useCallback(Me=>{a==null||a(Me),ne.current&&!cLe(ne.current)&&ee(Me)},[ee,a]),J=L.useCallback(Me=>{l==null||l(Me),!E&&F(-1)},[F,E,l]),se=L.useCallback(Me=>{d==null||d(Me),kU(Me.currentTarget)&&(T??z)&&H()},[H,d,z,T]),he=L.useCallback(Me=>{f==null||f(Me),F(oe)},[F,f,oe]),pe=oe===j,le=_te({onClick:se,onFocus:he,onMouseEnter:ee,onMouseMove:Z,onMouseLeave:J,ref:es(ge,ne,t),isDisabled:E,isFocusable:v});return{...A,...le,type:w??le.type,id:de,role:"menuitem",tabIndex:pe?0:-1}}function fLe(n){if(!mLe(n))return!1;const t=n.ownerDocument.defaultView??window;return n instanceof t.HTMLElement}function mLe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[gLe,w0]=Oi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),a1=n=>{const{children:t}=n,s=oc("Menu",n),a=$i(n),{direction:l}=T0(),{descendants:d,...f}=lLe({...a,direction:l}),E=L.useMemo(()=>f,[f]),{isOpen:v,onClose:T,forceUpdate:w}=E;return I.jsx(rLe,{value:d,children:I.jsx(aLe,{value:E,children:I.jsx(gLe,{value:s,children:Kc(t,{isOpen:v,onClose:T,forceUpdate:w})})})})};a1.displayName="Menu";const _Le=Wt((n,t)=>{const s=w0();return I.jsx(Dt.button,{ref:t,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),c1=Wt((n,t)=>{const{children:s,as:a,...l}=n,d=uLe(l,t),f=a||_Le;return I.jsx(f,{...d,className:dn("chakra-menu__menu-button",n.className),children:I.jsx(Dt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});c1.displayName="MenuButton";const yte=Wt((n,t)=>{const s=w0();return I.jsx(Dt.span,{ref:t,...n,__css:s.command,className:"chakra-menu__command"})});yte.displayName="MenuCommand";const vte=n=>{const{className:t,...s}=n,a=w0();return I.jsx(Dt.hr,{"aria-orientation":"horizontal",className:dn("chakra-menu__divider",t),...s,__css:a.divider})};vte.displayName="MenuDivider";const Ste=n=>{const{className:t,children:s,...a}=n,l=w0(),d=L.Children.only(s),f=L.isValidElement(d)?L.cloneElement(d,{focusable:"false","aria-hidden":!0,className:dn("chakra-menu__icon",d.props.className)}):null,E=dn("chakra-menu__icon-wrapper",t);return I.jsx(Dt.span,{className:E,...a,__css:l.icon,children:f})};Ste.displayName="MenuIcon";const ELe=Wt((n,t)=>{const{type:s,...a}=n,l=w0(),d=a.as||s?s??void 0:"button",f=L.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return I.jsx(Dt.button,{ref:t,type:d,...a,__css:f})}),FS=Wt((n,t)=>{const{icon:s,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,...E}=n,v=pLe(E,t),w=s||l?I.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return I.jsxs(ELe,{...v,className:dn("chakra-menu__menuitem",v.className),children:[s&&I.jsx(Ste,{fontSize:"0.8em",marginEnd:a,children:s}),w,l&&I.jsx(yte,{marginStart:d,children:l})]})});FS.displayName="MenuItem";const yLe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},vLe=Dt(kf.div),l1=Wt(function(t,s){var N;const{rootProps:a,motionProps:l,...d}=t,{isOpen:f,onTransitionEnd:E,unstable__animationState:v}=zR(),T=dLe(d,s),w=hLe(a),A=w0();return I.jsx(Dt.div,{...w,__css:{zIndex:t.zIndex??((N=A.list)==null?void 0:N.zIndex)},children:I.jsx(vLe,{variants:yLe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...A.list},...l,...T,className:dn("chakra-menu__menu-list",T.className),onUpdate:E,onAnimationComplete:FJ(v.onComplete,T.onAnimationComplete)})})});l1.displayName="MenuList";var SLe=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},iS=new WeakMap,sO=new WeakMap,oO={},f2=0,Tte=function(n){return n&&(n.host||Tte(n.parentNode))},TLe=function(n,t){return t.map(function(s){if(n.contains(s))return s;var a=Tte(s);return a&&n.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",n,". Doing nothing"),null)}).filter(function(s){return!!s})},bLe=function(n,t,s,a){var l=TLe(t,Array.isArray(n)?n:[n]);oO[s]||(oO[s]=new WeakMap);var d=oO[s],f=[],E=new Set,v=new Set(l),T=function(A){!A||E.has(A)||(E.add(A),T(A.parentNode))};l.forEach(T);var w=function(A){!A||v.has(A)||Array.prototype.forEach.call(A.children,function(N){if(E.has(N))w(N);else try{var F=N.getAttribute(a),j=F!==null&&F!=="false",z=(iS.get(N)||0)+1,H=(d.get(N)||0)+1;iS.set(N,z),d.set(N,H),f.push(N),z===1&&j&&sO.set(N,!0),H===1&&N.setAttribute(s,"true"),j||N.setAttribute(a,"true")}catch(te){console.error("aria-hidden: cannot operate on ",N,te)}})};return w(t),E.clear(),f2++,function(){f.forEach(function(A){var N=iS.get(A)-1,F=d.get(A)-1;iS.set(A,N),d.set(A,F),N||(sO.has(A)||A.removeAttribute(a),sO.delete(A)),F||A.removeAttribute(s)}),f2--,f2||(iS=new WeakMap,iS=new WeakMap,sO=new WeakMap,oO={})}},wLe=function(n,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=SLe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),bLe(a,l,s,"aria-hidden")):function(){return null}},RLe=Object.defineProperty,CLe=(n,t,s)=>t in n?RLe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,ILe=(n,t,s)=>(CLe(n,t+"",s),s);class ALe{constructor(){ILe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const NU=new ALe;function bte(n,t){const[s,a]=L.useState(0);return L.useEffect(()=>{const l=n.current;if(l){if(t){const d=NU.add(l);a(d)}return()=>{NU.remove(l),a(0)}}},[t,n]),s}function PLe(n){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:E,onEsc:v}=n,T=L.useRef(null),w=L.useRef(null),[A,N,F]=kLe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");OLe(T,t&&f);const j=bte(T,t),z=L.useRef(null),H=L.useCallback(J=>{z.current=J.target},[]),te=L.useCallback(J=>{J.key==="Escape"&&(J.stopPropagation(),d&&(s==null||s()),v==null||v())},[d,s,v]),[K,ne]=L.useState(!1),[de,oe]=L.useState(!1),ge=L.useCallback((J={},se=null)=>({role:"dialog",...J,ref:es(se,T),id:A,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?N:void 0,"aria-describedby":de?F:void 0,onClick:Qn(J.onClick,he=>he.stopPropagation())}),[F,de,A,N,K]),ee=L.useCallback(J=>{J.stopPropagation(),z.current===J.target&&NU.isTopModal(T.current)&&(l&&(s==null||s()),E==null||E())},[s,l,E]),Z=L.useCallback((J={},se=null)=>({...J,ref:es(se,w),onClick:Qn(J.onClick,ee),onKeyDown:Qn(J.onKeyDown,te),onMouseDown:Qn(J.onMouseDown,H)}),[te,H,ee]);return{isOpen:t,onClose:s,headerId:N,bodyId:F,setBodyMounted:oe,setHeaderMounted:ne,dialogRef:T,overlayRef:w,getDialogProps:ge,getDialogContainerProps:Z,index:j}}function OLe(n,t){const s=n.current;L.useEffect(()=>{if(!(!n.current||!t))return wLe(n.current)},[t,n,s])}function kLe(n,...t){const s=L.useId(),a=n||s;return L.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[NLe,R0]=Oi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[DLe,RE]=Oi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Na=n=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:T,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:F,animatePresenceProps:j,onCloseComplete:z}=t,H=oc("Modal",t),K={...PLe(t),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:T,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:F};return I.jsx(DLe,{value:K,children:I.jsx(NLe,{value:H,children:I.jsx(y0,{...j,onExitComplete:z,children:K.isOpen&&I.jsx(ku,{...s,children:a})})})})};Na.displayName="Modal";var VO="right-scroll-bar-position",FO="width-before-scroll-bar",LLe="with-scroll-bars-hidden",xLe="--removed-body-scroll-bar-size",wte=Oee(),m2=function(){},u1=L.forwardRef(function(n,t){var s=L.useRef(null),a=L.useState({onScrollCapture:m2,onWheelCapture:m2,onTouchMoveCapture:m2}),l=a[0],d=a[1],f=n.forwardProps,E=n.children,v=n.className,T=n.removeScrollBar,w=n.enabled,A=n.shards,N=n.sideCar,F=n.noIsolation,j=n.inert,z=n.allowPinchZoom,H=n.as,te=H===void 0?"div":H,K=n.gapMode,ne=jR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),de=N,oe=Iee([s,t]),ge=xh(xh({},ne),l);return L.createElement(L.Fragment,null,w&&L.createElement(de,{sideCar:wte,removeScrollBar:T,shards:A,noIsolation:F,inert:j,setCallbacks:d,allowPinchZoom:!!z,lockRef:s,gapMode:K}),f?L.cloneElement(L.Children.only(E),xh(xh({},ge),{ref:oe})):L.createElement(te,xh({},ge,{className:v,ref:oe}),E))});u1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};u1.classNames={fullWidth:FO,zeroRight:VO};var MLe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function ULe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=MLe();return t&&n.setAttribute("nonce",t),n}function VLe(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function FLe(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var jLe=function(){var n=0,t=null;return{add:function(s){n==0&&(t=ULe())&&(VLe(t,s),FLe(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},BLe=function(){var n=jLe();return function(t,s){L.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&s])}},Rte=function(){var n=BLe(),t=function(s){var a=s.styles,l=s.dynamic;return n(a,l),null};return t},WLe={left:0,top:0,right:0,gap:0},g2=function(n){return parseInt(n||"",10)||0},zLe=function(n){var t=window.getComputedStyle(document.body),s=t[n==="padding"?"paddingLeft":"marginLeft"],a=t[n==="padding"?"paddingTop":"marginTop"],l=t[n==="padding"?"paddingRight":"marginRight"];return[g2(s),g2(a),g2(l)]},GLe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return WLe;var t=zLe(n),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},HLe=Rte(),jS="data-scroll-locked",$Le=function(n,t,s,a){var l=n.left,d=n.top,f=n.right,E=n.gap;return s===void 0&&(s="margin"),`
  .`.concat(LLe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(jS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(VO,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(FO,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(VO," .").concat(VO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(FO," .").concat(FO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(jS,`] {
    `).concat(xLe,": ").concat(E,`px;
  }
`)},Zq=function(){var n=parseInt(document.body.getAttribute(jS)||"0",10);return isFinite(n)?n:0},KLe=function(){L.useEffect(function(){return document.body.setAttribute(jS,(Zq()+1).toString()),function(){var n=Zq()-1;n<=0?document.body.removeAttribute(jS):document.body.setAttribute(jS,n.toString())}},[])},qLe=function(n){var t=n.noRelative,s=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;KLe();var d=L.useMemo(function(){return GLe(l)},[l]);return L.createElement(HLe,{styles:$Le(d,!t,l,s?"":"!important")})},DU=!1;if(typeof window<"u")try{var aO=Object.defineProperty({},"passive",{get:function(){return DU=!0,!0}});window.addEventListener("test",aO,aO),window.removeEventListener("test",aO,aO)}catch{DU=!1}var sS=DU?{passive:!1}:!1,YLe=function(n){return n.tagName==="TEXTAREA"},Cte=function(n,t){if(!(n instanceof Element))return!1;var s=window.getComputedStyle(n);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!YLe(n)&&s[t]==="visible")},XLe=function(n){return Cte(n,"overflowY")},JLe=function(n){return Cte(n,"overflowX")},eY=function(n,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Ite(n,a);if(l){var d=Ate(n,a),f=d[1],E=d[2];if(f>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},QLe=function(n){var t=n.scrollTop,s=n.scrollHeight,a=n.clientHeight;return[t,s,a]},ZLe=function(n){var t=n.scrollLeft,s=n.scrollWidth,a=n.clientWidth;return[t,s,a]},Ite=function(n,t){return n==="v"?XLe(t):JLe(t)},Ate=function(n,t){return n==="v"?QLe(t):ZLe(t)},exe=function(n,t){return n==="h"&&t==="rtl"?-1:1},txe=function(n,t,s,a,l){var d=exe(n,window.getComputedStyle(t).direction),f=d*a,E=s.target,v=t.contains(E),T=!1,w=f>0,A=0,N=0;do{var F=Ate(n,E),j=F[0],z=F[1],H=F[2],te=z-H-d*j;(j||te)&&Ite(n,E)&&(A+=te,N+=j),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!v&&E!==document.body||v&&(t.contains(E)||t===E));return(w&&Math.abs(A)<1||!w&&Math.abs(N)<1)&&(T=!0),T},cO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},tY=function(n){return[n.deltaX,n.deltaY]},nY=function(n){return n&&"current"in n?n.current:n},nxe=function(n,t){return n[0]===t[0]&&n[1]===t[1]},rxe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},ixe=0,oS=[];function sxe(n){var t=L.useRef([]),s=L.useRef([0,0]),a=L.useRef(),l=L.useState(ixe++)[0],d=L.useState(Rte)[0],f=L.useRef(n);L.useEffect(function(){f.current=n},[n]),L.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var z=h1e([n.lockRef.current],(n.shards||[]).map(nY),!0).filter(Boolean);return z.forEach(function(H){return H.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),z.forEach(function(H){return H.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var E=L.useCallback(function(z,H){if("touches"in z&&z.touches.length===2||z.type==="wheel"&&z.ctrlKey)return!f.current.allowPinchZoom;var te=cO(z),K=s.current,ne="deltaX"in z?z.deltaX:K[0]-te[0],de="deltaY"in z?z.deltaY:K[1]-te[1],oe,ge=z.target,ee=Math.abs(ne)>Math.abs(de)?"h":"v";if("touches"in z&&ee==="h"&&ge.type==="range")return!1;var Z=eY(ee,ge);if(!Z)return!0;if(Z?oe=ee:(oe=ee==="v"?"h":"v",Z=eY(ee,ge)),!Z)return!1;if(!a.current&&"changedTouches"in z&&(ne||de)&&(a.current=oe),!oe)return!0;var J=a.current||oe;return txe(J,H,z,J==="h"?ne:de)},[]),v=L.useCallback(function(z){var H=z;if(!(!oS.length||oS[oS.length-1]!==d)){var te="deltaY"in H?tY(H):cO(H),K=t.current.filter(function(oe){return oe.name===H.type&&(oe.target===H.target||H.target===oe.shadowParent)&&nxe(oe.delta,te)})[0];if(K&&K.should){H.cancelable&&H.preventDefault();return}if(!K){var ne=(f.current.shards||[]).map(nY).filter(Boolean).filter(function(oe){return oe.contains(H.target)}),de=ne.length>0?E(H,ne[0]):!f.current.noIsolation;de&&H.cancelable&&H.preventDefault()}}},[]),T=L.useCallback(function(z,H,te,K){var ne={name:z,delta:H,target:te,should:K,shadowParent:oxe(te)};t.current.push(ne),setTimeout(function(){t.current=t.current.filter(function(de){return de!==ne})},1)},[]),w=L.useCallback(function(z){s.current=cO(z),a.current=void 0},[]),A=L.useCallback(function(z){T(z.type,tY(z),z.target,E(z,n.lockRef.current))},[]),N=L.useCallback(function(z){T(z.type,cO(z),z.target,E(z,n.lockRef.current))},[]);L.useEffect(function(){return oS.push(d),n.setCallbacks({onScrollCapture:A,onWheelCapture:A,onTouchMoveCapture:N}),document.addEventListener("wheel",v,sS),document.addEventListener("touchmove",v,sS),document.addEventListener("touchstart",w,sS),function(){oS=oS.filter(function(z){return z!==d}),document.removeEventListener("wheel",v,sS),document.removeEventListener("touchmove",v,sS),document.removeEventListener("touchstart",w,sS)}},[]);var F=n.removeScrollBar,j=n.inert;return L.createElement(L.Fragment,null,j?L.createElement(d,{styles:rxe(l)}):null,F?L.createElement(qLe,{gapMode:n.gapMode}):null)}function oxe(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const axe=p1e(wte,sxe);var Pte=L.forwardRef(function(n,t){return L.createElement(u1,xh({},n,{ref:t,sideCar:axe}))});Pte.classNames=u1.classNames;function cxe(n){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:E,returnFocusOnClose:v,preserveScrollBarGap:T,lockFocusAcrossFrames:w,isOpen:A}=RE(),[N,F]=KV();L.useEffect(()=>{!N&&F&&setTimeout(F)},[N,F]);const j=bte(a,A);return I.jsx(rte,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:E,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:I.jsx(Pte,{removeScrollBar:!T,allowPinchZoom:f,enabled:j===1&&d,forwardProps:!0,children:n.children})})}const lxe={initial:({offsetX:n,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:t,transition:(s==null?void 0:s.exit)??mE.exit(fE.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??mE.enter(fE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:n,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const f={x:t,y:n};return{opacity:0,transition:(s==null?void 0:s.exit)??mE.exit(fE.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},Rw={initial:"initial",animate:"enter",exit:"exit",variants:lxe},uxe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:E=0,offsetY:v=8,transition:T,transitionEnd:w,delay:A,animatePresenceProps:N,...F}=t,j=a?l&&a:!0,z=l||a?"enter":"exit",H={offsetX:E,offsetY:v,reverse:d,transition:T,transitionEnd:w,delay:A};return I.jsx(y0,{...N,custom:H,children:j&&I.jsx(kf.div,{ref:s,className:dn("chakra-offset-slide",f),custom:H,...Rw,animate:z,...F})})});uxe.displayName="SlideFade";const dxe={exit:({reverse:n,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??mE.exit(fE.exit,l)}),enter:({transitionEnd:n,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??mE.enter(fE.enter,s),transitionEnd:n==null?void 0:n.enter})},Ote={initial:"exit",animate:"enter",exit:"exit",variants:dxe},hxe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:E,transition:v,transitionEnd:T,delay:w,animatePresenceProps:A,...N}=t,F=a?l&&a:!0,j=l||a?"enter":"exit",z={initialScale:f,reverse:d,transition:v,transitionEnd:T,delay:w};return I.jsx(y0,{...A,custom:z,children:F&&I.jsx(kf.div,{ref:s,className:dn("chakra-offset-slide",E),...Ote,animate:j,custom:z,...N})})});hxe.displayName="ScaleFade";const pxe={slideInBottom:{...Rw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Rw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Rw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Rw,custom:{offsetX:-16,reverse:!0}},scale:{...Ote,custom:{initialScale:.95,reverse:!0}},none:{}},fxe=Dt(kf.section),mxe=n=>pxe[n||"none"],kte=L.forwardRef((n,t)=>{const{preset:s,motionProps:a=mxe(s),...l}=n;return I.jsx(fxe,{ref:t,...a,...l})});kte.displayName="ModalTransition";const Da=Wt((n,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...f}=n,{getDialogProps:E,getDialogContainerProps:v}=RE(),T=E(f,t),w=v(l),A=dn("chakra-modal__content",s),N=R0(),F={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},j={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:z}=RE();return I.jsx(cxe,{children:I.jsx(Dt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:j,children:I.jsx(kte,{preset:z,motionProps:d,className:A,...T,__css:F,children:a})})})});Da.displayName="ModalContent";const La=Wt((n,t)=>{const{className:s,...a}=n,{bodyId:l,setBodyMounted:d}=RE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=dn("chakra-modal__body",s),E=R0();return I.jsx(Dt.div,{ref:t,className:f,id:l,...a,__css:E.body})});La.displayName="ModalBody";const sc=Wt((n,t)=>{const{onClick:s,className:a,...l}=n,{onClose:d}=RE(),f=dn("chakra-modal__close-btn",a),E=R0();return I.jsx(IF,{ref:t,__css:E.closeButton,className:f,onClick:Qn(s,v=>{v.stopPropagation(),d()}),...l})});sc.displayName="ModalCloseButton";const mg=Wt((n,t)=>{const{className:s,...a}=n,l=dn("chakra-modal__footer",s),d=R0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return I.jsx(Dt.footer,{ref:t,...a,__css:f,className:l})});mg.displayName="ModalFooter";const Nl=Wt((n,t)=>{const{className:s,...a}=n,{headerId:l,setHeaderMounted:d}=RE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=dn("chakra-modal__header",s),E=R0(),v={flex:0,...E.header};return I.jsx(Dt.header,{ref:t,className:f,id:l,...a,__css:v})});Nl.displayName="ModalHeader";const gxe={enter:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??mE.enter(fE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??mE.exit(fE.exit,s),transitionEnd:t==null?void 0:t.exit})},Nte={initial:"exit",animate:"enter",exit:"exit",variants:gxe},_xe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:E,delay:v,animatePresenceProps:T,...w}=t,A=l||a?"enter":"exit",N=a?l&&a:!0,F={transition:f,transitionEnd:E,delay:v};return I.jsx(y0,{...T,custom:F,children:N&&I.jsx(kf.div,{ref:s,className:dn("chakra-fade",d),custom:F,...Nte,animate:A,...w})})});_xe.displayName="Fade";const Exe=Dt(kf.div),xa=Wt((n,t)=>{const{className:s,transition:a,motionProps:l,...d}=n,f=dn("chakra-modal__overlay",s),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...R0().overlay},{motionPreset:T}=RE(),A=l||(T==="none"?{}:Nte);return I.jsx(Exe,{...A,__css:v,ref:t,className:f,...d})});xa.displayName="ModalOverlay";function yxe(n){const{leastDestructiveRef:t,...s}=n;return I.jsx(Na,{...s,initialFocusRef:t})}const vxe=Wt((n,t)=>I.jsx(Da,{ref:t,role:"alertdialog",...n})),[Sxe,d1]=Oi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[Txe,Dte]=Oi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),aS={click:"click",hover:"hover"};function bxe(n={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:E,arrowShadowColor:v,trigger:T=aS.click,openDelay:w=200,closeDelay:A=200,isLazy:N,lazyBehavior:F="unmount",computePositionOnMount:j,...z}=n,{isOpen:H,onClose:te,onOpen:K,onToggle:ne}=Sf(n),[de,oe]=L.useState(d);L.useEffect(()=>oe(d),[d]);const ge=L.useRef(null),ee=L.useRef(null),Z=L.useRef(null),J=L.useRef(!1),se=L.useRef(!1);H&&(se.current=!0);const[he,pe]=L.useState(!1),[le,Me]=L.useState(!1),He=L.useId(),rt=l??He,[we,Ce,ve,Ne]=["popover-trigger","popover-content","popover-header","popover-body"].map(Kt=>`${Kt}-${rt}`),{referenceRef:be,getArrowProps:Te,getPopperProps:Ae,getArrowInnerProps:Ue,forceUpdate:ze}=JF({...z,enabled:H||!!j}),et=HJ({isOpen:H,ref:Z});mEe({enabled:H,ref:ee}),KJ(Z,{focusRef:ee,visible:H,shouldFocus:de&&T===aS.click}),aEe(Z,{focusRef:a,visible:H,shouldFocus:f&&T===aS.click}),XJ({enabled:H&&t,ref:Z,handler(Kt){var Fe;const Re=((Fe=Kt.composedPath)==null?void 0:Fe.call(Kt)[0])??[Kt.target];lO(ee.current,Re)||(Re&&oe(!tk(Re)),te())}});const nt=wV({wasSelected:se.current,enabled:N,mode:F,isSelected:et.present}),dt=L.useCallback((Kt={},Re=null)=>{const Fe={...Kt,style:{...Kt.style,transformOrigin:Hs.transformOrigin.varRef,[Hs.arrowSize.var]:E?`${E}px`:void 0,[Hs.arrowShadowColor.var]:v},ref:es(Z,Re),children:nt?Kt.children:null,id:Ce,tabIndex:-1,role:"dialog",onKeyDown:Qn(Kt.onKeyDown,Ke=>{Ke.nativeEvent.isComposing||s&&Ke.key==="Escape"&&(Ke.preventDefault(),Ke.stopPropagation(),te())}),onBlur:Qn(Kt.onBlur,Ke=>{const _t=rY(Ke),vt=lO(Z.current,_t),Ge=lO(ee.current,_t),Ot=!vt&&!Ge;_t&&oe(!tk(_t)),H&&t&&Ot&&te()}),"aria-labelledby":he?ve:void 0,"aria-describedby":le?Ne:void 0};return T===aS.hover&&(Fe.role="tooltip",Fe.onMouseEnter=Qn(Kt.onMouseEnter,()=>{J.current=!0}),Fe.onMouseLeave=Qn(Kt.onMouseLeave,Ke=>{Ke.nativeEvent.relatedTarget!==null&&(J.current=!1,setTimeout(()=>te(),A))})),Fe},[nt,Ce,he,ve,le,Ne,T,s,te,H,t,A,v,E]),Xe=L.useCallback((Kt={},Re=null)=>Ae({...Kt,style:{visibility:H?"visible":"hidden",...Kt.style}},Re),[H,Ae]),Ct=L.useCallback((Kt,Re=null)=>({...Kt,ref:es(Re,ge,be)}),[ge,be]),hn=L.useRef(void 0),Ut=L.useRef(void 0),ln=L.useCallback(Kt=>{ge.current==null&&be(Kt)},[be]),xn=L.useCallback((Kt={},Re=null)=>{const Fe={...Kt,ref:es(ee,Re,ln),id:we,"aria-haspopup":"dialog","aria-expanded":H,"aria-controls":Ce};return T===aS.click&&(Fe.onClick=Qn(Kt.onClick,ne)),T===aS.hover&&(Fe.onFocus=Qn(Kt.onFocus,()=>{hn.current===void 0&&K()}),Fe.onBlur=Qn(Kt.onBlur,Ke=>{const _t=rY(Ke),vt=!lO(Z.current,_t);H&&t&&vt&&te()}),Fe.onKeyDown=Qn(Kt.onKeyDown,Ke=>{Ke.key==="Escape"&&te()}),Fe.onMouseEnter=Qn(Kt.onMouseEnter,()=>{J.current=!0,hn.current=window.setTimeout(()=>K(),w)}),Fe.onMouseLeave=Qn(Kt.onMouseLeave,()=>{J.current=!1,hn.current&&(clearTimeout(hn.current),hn.current=void 0),Ut.current=window.setTimeout(()=>{J.current===!1&&te()},A)})),Fe},[we,H,Ce,T,ln,ne,K,t,te,w,A]);L.useEffect(()=>()=>{hn.current&&clearTimeout(hn.current),Ut.current&&clearTimeout(Ut.current)},[]);const Yt=L.useCallback((Kt={},Re=null)=>({...Kt,id:ve,ref:es(Re,Fe=>{pe(!!Fe)})}),[ve]),Yn=L.useCallback((Kt={},Re=null)=>({...Kt,id:Ne,ref:es(Re,Fe=>{Me(!!Fe)})}),[Ne]);return{forceUpdate:ze,isOpen:H,onAnimationComplete:et.onComplete,onClose:te,getAnchorProps:Ct,getArrowProps:Te,getArrowInnerProps:Ue,getPopoverPositionerProps:Xe,getPopoverProps:dt,getTriggerProps:xn,getHeaderProps:Yt,getBodyProps:Yn}}function lO(n,t){return n===t||(n==null?void 0:n.contains(t))}function rY(n){const t=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??t}function Lte(n){const t=oc("Popover",n),{children:s,...a}=$i(n),l=T0(),d=bxe({...a,direction:l.direction});return I.jsx(Sxe,{value:d,children:I.jsx(Txe,{value:t,children:Kc(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Lte.displayName="Popover";function xte(n){var s;const t=L.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(s=n==null?void 0:n.props)==null?void 0:s.ref}const Mte=Wt(function(t,s){const{getBodyProps:a}=d1(),l=Dte();return I.jsx(Dt.div,{...a(t,s),className:dn("chakra-popover__body",t.className),__css:l.body})});Mte.displayName="PopoverBody";function wxe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const Rxe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},Cxe=Dt(kf.section),Ute=Wt(function(t,s){const{variants:a=Rxe,...l}=t,{isOpen:d}=d1();return I.jsx(Cxe,{ref:s,variants:wxe(a),initial:!1,animate:d?"enter":"exit",...l})});Ute.displayName="PopoverTransition";const Vte=Wt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:f,getPopoverPositionerProps:E,onAnimationComplete:v}=d1(),T=Dte(),w={position:"relative",display:"flex",flexDirection:"column",...T.content};return I.jsx(Dt.div,{...E(a),__css:T.popper,className:"chakra-popover__popper",children:I.jsx(Ute,{...l,...f(d,s),onAnimationComplete:FJ(v,d.onAnimationComplete),className:dn("chakra-popover__content",t.className),__css:w})})});Vte.displayName="PopoverContent";function Fte(n){const t=L.Children.only(n.children),{getTriggerProps:s}=d1();return I.jsx(I.Fragment,{children:L.cloneElement(t,s(t.props,xte(t)))})}Fte.displayName="PopoverTrigger";function Ixe(n,t,s){return(n-t)*100/(s-t)}DR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});DR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const Axe=DR({"0%":{left:"-40%"},"100%":{left:"100%"}}),Pxe=DR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function Oxe(n){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:E="progressbar"}=n,v=Ixe(t,s,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":f?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:E},percent:v,value:t}}const[kxe,Nxe]=Oi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),Dxe=Wt((n,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:f,...E}=n,v=Oxe({value:l,min:s,max:a,isIndeterminate:d,role:f}),w={height:"100%",...Nxe().filledTrack};return I.jsx(Dt.div,{ref:t,style:{width:`${v.percent}%`,...E.style},...v.bind,...E,__css:w})}),i0=Wt((n,t)=>{var ee;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:E,borderRadius:v,isIndeterminate:T,"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,title:F,role:j,...z}=$i(n),H=oc("Progress",n),te=v??((ee=H.track)==null?void 0:ee.borderRadius),K={animation:`${Pxe} 1s linear infinite`},oe={...!T&&d&&f&&K,...T&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${Axe} 1s ease infinite normal none running`}},ge={overflow:"hidden",position:"relative",...H.track};return I.jsx(Dt.div,{ref:t,borderRadius:te,__css:ge,...z,children:I.jsxs(kxe,{value:H,children:[I.jsx(Dxe,{"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,min:a,max:l,value:s,isIndeterminate:T,css:oe,borderRadius:te,title:F,role:j}),E]})})});i0.displayName="Progress";const jte=Wt(function(t,s){const{children:a,placeholder:l,className:d,...f}=t;return I.jsxs(Dt.select,{...f,ref:s,className:dn("chakra-select",d),children:[l&&I.jsx("option",{value:"",children:l}),a]})});jte.displayName="SelectField";const Bte=Wt((n,t)=>{var ne;const s=oc("Select",n),{rootProps:a,placeholder:l,icon:d,color:f,height:E,h:v,minH:T,minHeight:w,iconColor:A,iconSize:N,...F}=$i(n),[j,z]=tEe(F,mye),H=OF(z),te={width:"100%",height:"fit-content",position:"relative",color:f},K={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(ne=s.field)==null?void 0:ne._focus}};return I.jsxs(Dt.div,{className:"chakra-select__wrapper",__css:te,...j,...a,children:[I.jsx(jte,{ref:t,height:v??E,minH:T??w,placeholder:l,...H,__css:K,children:n.children}),I.jsx(Wte,{"data-disabled":Kn(H.disabled),...(A||f)&&{color:A||f},__css:s.icon,...N&&{fontSize:N},children:d})]})});Bte.displayName="Select";const Lxe=n=>I.jsx("svg",{viewBox:"0 0 24 24",...n,children:I.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),xxe=Dt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Wte=n=>{const{children:t=I.jsx(Lxe,{}),...s}=n,a=L.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return I.jsx(xxe,{...s,className:"chakra-select__icon-wrapper",children:L.isValidElement(t)?a:null})};Wte.displayName="SelectIcon";function _2(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function Mxe(n){const{orientation:t,thumbPercents:s,isReversed:a}=n,l=F=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",..._2({orientation:t,vertical:{bottom:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",..._2({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=s.length===1,v=[0,a?100-s[0]:s[0]],T=E?v:s;let w=T[0];!E&&a&&(w=100-w);const A=Math.abs(T[T.length-1]-T[0]),N={...f,..._2({orientation:t,vertical:a?{height:`${A}%`,top:`${w}%`}:{height:`${A}%`,bottom:`${w}%`},horizontal:a?{width:`${A}%`,right:`${w}%`}:{width:`${A}%`,left:`${w}%`}})};return{trackStyle:f,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function Uxe(n){const{isReversed:t,direction:s,orientation:a}=n;return s==="ltr"||a==="vertical"?t:!t}function Vxe(n){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:E="ltr",orientation:v="horizontal",id:T,isDisabled:w,isReadOnly:A,onChangeStart:N,onChangeEnd:F,step:j=1,getAriaValueText:z,"aria-valuetext":H,"aria-label":te,"aria-labelledby":K,name:ne,focusThumbOnChange:de=!0,...oe}=n,ge=qc(N),ee=qc(F),Z=qc(z),J=Uxe({isReversed:f,direction:E,orientation:v}),[se,he]=$J({value:l,defaultValue:d??jxe(t,s),onChange:a}),[pe,le]=L.useState(!1),[Me,He]=L.useState(!1),rt=!(w||A),we=(s-t)/10,Ce=j||(s-t)/100,ve=vM(se,t,s),Ne=s-ve+t,Te=m$(J?Ne:ve,t,s),Ae=v==="vertical",Ue=YJ({min:t,max:s,step:j,isDisabled:w,value:ve,isInteractive:rt,isReversed:J,isVertical:Ae,eventSource:null,focusThumbOnChange:de,orientation:v}),ze=L.useRef(null),et=L.useRef(null),nt=L.useRef(null),dt=L.useId(),Xe=T??dt,[Ct,hn]=[`slider-thumb-${Xe}`,`slider-track-${Xe}`],Ut=L.useCallback(Vt=>{var lo;if(!ze.current)return;const sn=Ue.current;sn.eventSource="pointer";const Ii=ze.current.getBoundingClientRect(),{clientX:di,clientY:yi}=((lo=Vt.touches)==null?void 0:lo[0])??Vt,dr=Ae?Ii.bottom-yi:di-Ii.left,Ua=Ae?Ii.height:Ii.width;let Zc=dr/Ua;J&&(Zc=1-Zc);let co=J_e(Zc,sn.min,sn.max);return sn.step&&(co=parseFloat(g$(co,sn.min,sn.step))),co=vM(co,sn.min,sn.max),co},[Ae,J,Ue]),ln=L.useCallback(Vt=>{const sn=Ue.current;sn.isInteractive&&(Vt=parseFloat(g$(Vt,sn.min,Ce)),Vt=vM(Vt,sn.min,sn.max),he(Vt))},[Ce,he,Ue]),xn=L.useMemo(()=>({stepUp(Vt=Ce){const sn=J?ve-Vt:ve+Vt;ln(sn)},stepDown(Vt=Ce){const sn=J?ve+Vt:ve-Vt;ln(sn)},reset(){ln(d||0)},stepTo(Vt){ln(Vt)}}),[ln,J,ve,Ce,d]),Yt=L.useCallback(Vt=>{const sn=Ue.current,di={ArrowRight:()=>xn.stepUp(),ArrowUp:()=>xn.stepUp(),ArrowLeft:()=>xn.stepDown(),ArrowDown:()=>xn.stepDown(),PageUp:()=>xn.stepUp(we),PageDown:()=>xn.stepDown(we),Home:()=>ln(sn.min),End:()=>ln(sn.max)}[Vt.key];di&&(Vt.preventDefault(),Vt.stopPropagation(),di(Vt),sn.eventSource="keyboard")},[xn,ln,we,Ue]),Yn=(Z==null?void 0:Z(ve))??H,{getThumbStyle:Kt,rootStyle:Re,trackStyle:Fe,innerTrackStyle:Ke}=L.useMemo(()=>{const Vt=Ue.current;return Mxe({isReversed:J,orientation:Vt.orientation,thumbPercents:[Te]})},[J,Te,Ue]),_t=L.useCallback(()=>{Ue.current.focusThumbOnChange&&setTimeout(()=>{var sn;return(sn=et.current)==null?void 0:sn.focus()})},[Ue]);hg(()=>{const Vt=Ue.current;_t(),Vt.eventSource==="keyboard"&&(ee==null||ee(Vt.value))},[ve,ee]);function vt(Vt){const sn=Ut(Vt);sn!=null&&sn!==Ue.current.value&&he(sn)}xEe(nt,{onPanSessionStart(Vt){const sn=Ue.current;sn.isInteractive&&(le(!0),_t(),vt(Vt),ge==null||ge(sn.value))},onPanSessionEnd(){const Vt=Ue.current;Vt.isInteractive&&(le(!1),ee==null||ee(Vt.value))},onPan(Vt){Ue.current.isInteractive&&vt(Vt)}});const Ge=L.useCallback((Vt={},sn=null)=>({...Vt,...oe,ref:es(sn,nt),tabIndex:-1,"aria-disabled":AS(w),"data-focused":Kn(Me),style:{...Vt.style,...Re}}),[oe,w,Me,Re]),Ot=L.useCallback((Vt={},sn=null)=>({...Vt,ref:es(sn,ze),id:hn,"data-disabled":Kn(w),style:{...Vt.style,...Fe}}),[w,hn,Fe]),Xt=L.useCallback((Vt={},sn=null)=>({...Vt,ref:sn,style:{...Vt.style,...Ke}}),[Ke]),pn=L.useCallback((Vt={},sn=null)=>({...Vt,ref:es(sn,et),role:"slider",tabIndex:rt?0:void 0,id:Ct,"data-active":Kn(pe),"aria-valuetext":Yn,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":ve,"aria-orientation":v,"aria-disabled":AS(w),"aria-readonly":AS(A),"aria-label":te,"aria-labelledby":te?void 0:K,style:{...Vt.style,...Kt(0)},onKeyDown:Qn(Vt.onKeyDown,Yt),onFocus:Qn(Vt.onFocus,()=>He(!0)),onBlur:Qn(Vt.onBlur,()=>He(!1))}),[rt,Ct,pe,Yn,t,s,ve,v,w,A,te,K,Kt,Yt]),an=L.useCallback((Vt,sn=null)=>{const Ii=!(Vt.value<t||Vt.value>s),di=ve>=Vt.value,yi=m$(Vt.value,t,s),dr={position:"absolute",pointerEvents:"none",...Fxe({orientation:v,vertical:{bottom:J?`${100-yi}%`:`${yi}%`},horizontal:{left:J?`${100-yi}%`:`${yi}%`}})};return{...Vt,ref:sn,role:"presentation","aria-hidden":!0,"data-disabled":Kn(w),"data-invalid":Kn(!Ii),"data-highlighted":Kn(di),style:{...Vt.style,...dr}}},[w,J,s,t,v,ve]),ir=L.useCallback((Vt={},sn=null)=>({...Vt,ref:sn,type:"hidden",value:ve,name:ne}),[ne,ve]);return{state:{value:ve,isFocused:Me,isDragging:pe},actions:xn,getRootProps:Ge,getTrackProps:Ot,getInnerTrackProps:Xt,getThumbProps:pn,getMarkerProps:an,getInputProps:ir}}function Fxe(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function jxe(n,t){return t<n?n:n+(t-n)/2}const[Bxe,h1]=Oi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[Wxe,p1]=Oi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),LU=Wt((n,t)=>{const s={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=oc("Slider",s),l=$i(s),{direction:d}=T0();l.direction=d;const{getInputProps:f,getRootProps:E,...v}=Vxe(l),T=E(),w=f({},t);return I.jsx(Bxe,{value:v,children:I.jsx(Wxe,{value:a,children:I.jsxs(Dt.div,{...T,className:dn("chakra-slider",s.className),__css:a.container,children:[s.children,I.jsx("input",{...w})]})})})});LU.displayName="Slider";const xU=Wt((n,t)=>{const{getThumbProps:s}=h1(),a=p1(),l=s(n,t);return I.jsx(Dt.div,{...l,className:dn("chakra-slider__thumb",n.className),__css:a.thumb})});xU.displayName="SliderThumb";const MU=Wt((n,t)=>{const{getTrackProps:s}=h1(),a=p1(),l=s(n,t);return I.jsx(Dt.div,{...l,className:dn("chakra-slider__track",n.className),__css:a.track})});MU.displayName="SliderTrack";const UU=Wt((n,t)=>{const{getInnerTrackProps:s}=h1(),a=p1(),l=s(n,t);return I.jsx(Dt.div,{...l,className:dn("chakra-slider__filled-track",n.className),__css:a.filledTrack})});UU.displayName="SliderFilledTrack";const zxe=Wt((n,t)=>{const{getMarkerProps:s}=h1(),a=p1(),l=s(n,t);return I.jsx(Dt.div,{...l,className:dn("chakra-slider__marker",n.className),__css:a.mark})});zxe.displayName="SliderMark";const mk=Dt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});mk.displayName="Spacer";const zte=n=>I.jsx(Dt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});zte.displayName="StackItem";function Gxe(n){const{spacing:t,direction:s}=n,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":RV(s,l=>a[l])}}const QF=Wt((n,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:E,children:v,divider:T,className:w,shouldWrapChildren:A,...N}=n,F=s?"row":a??"column",j=L.useMemo(()=>Gxe({spacing:f,direction:F}),[f,F]),z=!!T,H=!A&&!z,te=L.useMemo(()=>{const ne=bV(v);return H?ne:ne.map((de,oe)=>{const ge=typeof de.key<"u"?de.key:oe,ee=oe+1===ne.length,J=A?I.jsx(zte,{children:de},ge):de;if(!z)return J;const se=L.cloneElement(T,{__css:j}),he=ee?null:se;return I.jsxs(L.Fragment,{children:[J,he]},ge)})},[T,j,z,H,A,v]),K=dn("chakra-stack",w);return I.jsx(Dt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:F,flexWrap:E,gap:z?void 0:f,className:K,...N,children:te})});QF.displayName="Stack";const wi=Wt((n,t)=>I.jsx(QF,{align:"center",...n,direction:"row",ref:t}));wi.displayName="HStack";const zi=Wt((n,t)=>I.jsx(QF,{align:"center",...n,direction:"column",ref:t}));zi.displayName="VStack";const ig=Wt(function(t,s){const a=oc("Switch",t),{spacing:l="0.5rem",children:d,...f}=$i(t),{getIndicatorProps:E,getInputProps:v,getCheckboxProps:T,getRootProps:w,getLabelProps:A}=e1e(f),N=L.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),F=L.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),j=L.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return I.jsxs(Dt.label,{...w(),className:dn("chakra-switch",t.className),__css:N,children:[I.jsx("input",{className:"chakra-switch__input",...v({},s)}),I.jsx(Dt.span,{...T(),className:"chakra-switch__track",__css:F,children:I.jsx(Dt.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&I.jsx(Dt.span,{className:"chakra-switch__label",...A(),__css:j,children:d})]})});ig.displayName="Switch";const[Hxe,$xe,Kxe,qxe]=Eee();function Yxe(n){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:E="horizontal",direction:v="ltr",...T}=n,[w,A]=L.useState(t??0),[N,F]=$J({defaultValue:t??0,value:a,onChange:s});L.useEffect(()=>{a!=null&&A(a)},[a]);const j=Kxe(),z=L.useId();return{id:`tabs-${n.id??z}`,selectedIndex:N,focusedIndex:w,setSelectedIndex:F,setFocusedIndex:A,isManual:l,isLazy:d,lazyBehavior:f,orientation:E,descendants:j,direction:v,htmlProps:T}}const[Xxe,f1]=Oi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function Jxe(n){const{focusedIndex:t,orientation:s,direction:a}=f1(),l=$xe(),d=L.useCallback(f=>{const E=()=>{var ne;const K=l.nextEnabled(t);K&&((ne=K.node)==null||ne.focus())},v=()=>{var ne;const K=l.prevEnabled(t);K&&((ne=K.node)==null||ne.focus())},T=()=>{var ne;const K=l.firstEnabled();K&&((ne=K.node)==null||ne.focus())},w=()=>{var ne;const K=l.lastEnabled();K&&((ne=K.node)==null||ne.focus())},A=s==="horizontal",N=s==="vertical",F=f.key,j=a==="ltr"?"ArrowLeft":"ArrowRight",z=a==="ltr"?"ArrowRight":"ArrowLeft",te={[j]:()=>A&&v(),[z]:()=>A&&E(),ArrowDown:()=>N&&E(),ArrowUp:()=>N&&v(),Home:T,End:w}[F];te&&(f.preventDefault(),te(f))},[l,t,s,a]);return{...n,role:"tablist","aria-orientation":s,onKeyDown:Qn(n.onKeyDown,d)}}function Qxe(n){const{isDisabled:t=!1,isFocusable:s=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:E,selectedIndex:v}=f1(),{index:T,register:w}=qxe({disabled:t&&!s}),A=T===v,N=()=>{l(T)},F=()=>{E(T),!d&&!(t&&s)&&l(T)};return{..._te({...a,ref:es(w,n.ref),isDisabled:t,isFocusable:s,onClick:Qn(n.onClick,N)}),id:Gte(f,T),role:"tab",tabIndex:A?0:-1,type:"button","aria-selected":A,"aria-controls":Hte(f,T),onFocus:t?void 0:Qn(n.onFocus,F)}}const[Zxe,eMe]=Oi({});function tMe(n){const t=f1(),{id:s,selectedIndex:a}=t,d=bV(n.children).map((f,E)=>L.createElement(Zxe,{key:f.key??E,value:{isSelected:E===a,id:Hte(s,E),tabId:Gte(s,E),selectedIndex:a}},f));return{...n,children:d}}function nMe(n){const{children:t,...s}=n,{isLazy:a,lazyBehavior:l}=f1(),{isSelected:d,id:f,tabId:E}=eMe(),v=L.useRef(!1);d&&(v.current=!0);const T=wV({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:T?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:f}}function Gte(n,t){return`${n}--tab-${t}`}function Hte(n,t){return`${n}--tabpanel-${t}`}const[rMe,m1]=Oi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),GR=Wt(function(t,s){const a=oc("Tabs",t),{children:l,className:d,...f}=$i(t),{htmlProps:E,descendants:v,...T}=Yxe(f),w=L.useMemo(()=>T,[T]),{isFitted:A,...N}=E,F={position:"relative",...a.root};return I.jsx(Hxe,{value:v,children:I.jsx(Xxe,{value:w,children:I.jsx(rMe,{value:a,children:I.jsx(Dt.div,{className:dn("chakra-tabs",d),ref:s,...N,__css:F,children:l})})})})});GR.displayName="Tabs";const Hc=Wt(function(t,s){const a=m1(),l=Qxe({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return I.jsx(Dt.button,{...l,className:dn("chakra-tabs__tab",t.className),__css:d})});Hc.displayName="Tab";const HR=Wt(function(t,s){const a=Jxe({...t,ref:s}),l=m1(),d={display:"flex",...l.tablist};return I.jsx(Dt.div,{...a,className:dn("chakra-tabs__tablist",t.className),__css:d})});HR.displayName="TabList";const Tu=Wt(function(t,s){const a=nMe({...t,ref:s}),l=m1();return I.jsx(Dt.div,{outline:"0",...a,className:dn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});Tu.displayName="TabPanel";const g1=Wt(function(t,s){const a=tMe(t),l=m1();return I.jsx(Dt.div,{...a,width:"100%",ref:s,className:dn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});g1.displayName="TabPanels";const[iMe,$te]=Oi({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Kte=Wt((n,t)=>{const s=oc("Tag",n),a=$i(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...s.container};return I.jsx(iMe,{value:s,children:I.jsx(Dt.span,{ref:t,...a,__css:l})})});Kte.displayName="Tag";const qte=Wt((n,t)=>{const s=$te();return I.jsx(Dt.span,{ref:t,noOfLines:1,...n,__css:s.label})});qte.displayName="TagLabel";const sMe=Wt((n,t)=>I.jsx(Dn,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...n}));sMe.displayName="TagLeftIcon";const oMe=Wt((n,t)=>I.jsx(Dn,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...n}));oMe.displayName="TagRightIcon";const Yte=n=>I.jsx(Dn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:I.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Yte.displayName="TagCloseIcon";const Xte=Wt((n,t)=>{const{isDisabled:s,children:a,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...$te().closeButton};return I.jsx(Dt.button,{ref:t,"aria-label":"close",...l,type:"button",disabled:s,__css:f,children:a||I.jsx(Yte,{})})});Xte.displayName="TagCloseButton";const aMe=["h","minH","height","minHeight"],Jte=Wt((n,t)=>{const s=Ou("Textarea",n),{className:a,rows:l,...d}=$i(n),f=OF(d),E=l?_0(s,aMe):s;return I.jsx(Dt.textarea,{ref:t,rows:l,...f,className:dn("chakra-textarea",a),__css:E})});Jte.displayName="Textarea";function cMe(n,t){const s=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function lMe(n,t){const s=l=>({...t,...l,position:cMe((l==null?void 0:l.position)??(t==null?void 0:t.position),n)}),a=l=>{const d=s(l),f=mee(d);return Lh.notify(f,d)};return a.update=(l,d)=>{Lh.update(l,s(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(f,{status:"success",duration:5e3,...Kc(d.success,E)})).catch(E=>a.update(f,{status:"error",duration:5e3,...Kc(d.error,E)}))},a.closeAll=Lh.closeAll,a.close=Lh.close,a.isActive=Lh.isActive,a}function kd(n){const{theme:t}=hee(),s=Rke();return L.useMemo(()=>lMe(t.direction,{...s,...n}),[n,t.direction,s])}const uMe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},VU=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},jO=n=>{var t,s;return((s=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function dMe(n={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:E=!0,onOpen:v,onClose:T,placement:w,id:A,isOpen:N,defaultIsOpen:F,arrowSize:j=10,arrowShadowColor:z,arrowPadding:H,modifiers:te,isDisabled:K,gutter:ne,offset:de,direction:oe,...ge}=n,{isOpen:ee,onOpen:Z,onClose:J}=Sf({isOpen:N,defaultIsOpen:F,onOpen:v,onClose:T}),{referenceRef:se,getPopperProps:he,getArrowInnerProps:pe,getArrowProps:le}=JF({enabled:ee,placement:w,arrowPadding:H,modifiers:te,gutter:ne,offset:de,direction:oe}),Me=L.useId(),rt=`tooltip-${A??Me}`,we=L.useRef(null),Ce=L.useRef(void 0),ve=L.useCallback(()=>{Ce.current&&(clearTimeout(Ce.current),Ce.current=void 0)},[]),Ne=L.useRef(void 0),be=L.useCallback(()=>{Ne.current&&(clearTimeout(Ne.current),Ne.current=void 0)},[]),Te=L.useCallback(()=>{be(),J()},[J,be]),Ae=hMe(we,Te),Ue=L.useCallback(()=>{if(!K&&!Ce.current){ee&&Ae();const Ut=jO(we);Ce.current=Ut.setTimeout(Z,t)}},[Ae,K,ee,Z,t]),ze=L.useCallback(()=>{ve();const Ut=jO(we);Ne.current=Ut.setTimeout(Te,s)},[s,Te,ve]),et=L.useCallback(()=>{ee&&a&&ze()},[a,ze,ee]),nt=L.useCallback(()=>{ee&&f&&ze()},[f,ze,ee]),dt=L.useCallback(Ut=>{ee&&Ut.key==="Escape"&&ze()},[ee,ze]);PS(()=>VU(we),"keydown",E?dt:void 0),PS(()=>{if(!d)return null;const Ut=we.current;if(!Ut)return null;const ln=GJ(Ut);return ln.localName==="body"?jO(we):ln},"scroll",()=>{ee&&d&&Te()},{passive:!0,capture:!0}),L.useEffect(()=>{K&&(ve(),ee&&J())},[K,ee,J,ve]),L.useEffect(()=>()=>{ve(),be()},[ve,be]),PS(()=>we.current,"pointerleave",ze);const Xe=L.useCallback((Ut={},ln=null)=>({...Ut,ref:es(we,ln,se),onPointerEnter:Qn(Ut.onPointerEnter,Yt=>{Yt.pointerType!=="touch"&&Ue()}),onClick:Qn(Ut.onClick,et),onPointerDown:Qn(Ut.onPointerDown,nt),onFocus:Qn(Ut.onFocus,Ue),onBlur:Qn(Ut.onBlur,ze),"aria-describedby":ee?rt:void 0}),[Ue,ze,nt,ee,rt,et,se]),Ct=L.useCallback((Ut={},ln=null)=>he({...Ut,style:{...Ut.style,[Hs.arrowSize.var]:j?`${j}px`:void 0,[Hs.arrowShadowColor.var]:z}},ln),[he,j,z]),hn=L.useCallback((Ut={},ln=null)=>{const xn={...Ut.style,position:"relative",transformOrigin:Hs.transformOrigin.varRef};return{ref:ln,...ge,...Ut,id:rt,role:"tooltip",style:xn}},[ge,rt]);return{isOpen:ee,show:Ue,hide:ze,getTriggerProps:Xe,getTooltipProps:hn,getTooltipPositionerProps:Ct,getArrowProps:le,getArrowInnerProps:pe}}const E2="chakra-ui:close-tooltip";function hMe(n,t){return L.useEffect(()=>{const s=VU(n);return s.addEventListener(E2,t),()=>s.removeEventListener(E2,t)},[t,n]),()=>{const s=VU(n),a=jO(n);s.dispatchEvent(new a.CustomEvent(E2))}}const pMe=Dt(kf.div),sg=Wt((n,t)=>{const s=Ou("Tooltip",n),a=$i(n),l=T0(),{children:d,label:f,shouldWrapChildren:E,"aria-label":v,hasArrow:T,bg:w,portalProps:A,background:N,backgroundColor:F,bgColor:j,motionProps:z,animatePresenceProps:H,...te}=a,K=N??F??w??j;if(K){s.bg=K;const se=Rye(l,"colors",K);s[Hs.arrowBg.var]=se}const ne=dMe({...te,direction:l.direction}),de=!L.isValidElement(d)||E;let oe;if(de)oe=I.jsx(Dt.span,{display:"inline-block",tabIndex:0,...ne.getTriggerProps(),children:d});else{const se=L.Children.only(d);oe=L.cloneElement(se,ne.getTriggerProps(se.props,xte(se)))}const ge=!!v,ee=ne.getTooltipProps({},t),Z=ge?_0(ee,["role","id"]):ee,J=zJ(ee,["role","id"]);return f?I.jsxs(I.Fragment,{children:[oe,I.jsx(y0,{...H,children:ne.isOpen&&I.jsx(ku,{...A,children:I.jsx(Dt.div,{...ne.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:I.jsxs(pMe,{variants:uMe,initial:"exit",animate:"enter",exit:"exit",...z,...Z,__css:s,children:[f,ge&&I.jsx(Dt.span,{srOnly:!0,...J,children:v}),T&&I.jsx(Dt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:I.jsx(Dt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):I.jsx(I.Fragment,{children:d})});sg.displayName="Tooltip";const gk=Wt(function(t,s){const a=Ou("Heading",t),{className:l,...d}=$i(t);return I.jsx(Dt.h2,{ref:s,className:dn("chakra-heading",t.className),...d,__css:a})});gk.displayName="Heading";const Et=Wt(function(t,s){const a=Ou("Text",t),{className:l,align:d,decoration:f,casing:E,...v}=$i(t),T=zk({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return I.jsx(Dt.p,{ref:s,className:dn("chakra-text",t.className),...T,...v,__css:a})});Et.displayName="Text";const Qte=Wt(function(t,s){const{spacing:a="0.5rem",spacingX:l,spacingY:d,children:f,justify:E,direction:v,align:T,className:w,shouldWrapChildren:A,...N}=t,F=L.useMemo(()=>A?L.Children.map(f,(j,z)=>I.jsx(ZF,{children:j},z)):f,[f,A]);return I.jsx(Dt.div,{ref:s,className:dn("chakra-wrap",w),...N,children:I.jsx(Dt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:E,alignItems:T,flexDirection:v,listStyleType:"none",gap:a,columnGap:l,rowGap:d,padding:"0"},children:F})})});Qte.displayName="Wrap";const ZF=Wt(function(t,s){const{className:a,...l}=t;return I.jsx(Dt.li,{ref:s,__css:{display:"flex",alignItems:"flex-start"},className:dn("chakra-wrap__listitem",a),...l})});ZF.displayName="WrapItem";const fMe="modulepreload",mMe=function(n,t){return new URL(n,t).href},iY={},y2=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const f=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),v=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(s.map(T=>{if(T=mMe(T,a),T in iY)return;iY[T]=!0;const w=T.endsWith(".css"),A=w?'[rel="stylesheet"]':"";if(!!a)for(let j=f.length-1;j>=0;j--){const z=f[j];if(z.href===T&&(!w||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${A}`))return;const F=document.createElement("link");if(F.rel=w?"stylesheet":fMe,w||(F.as="script"),F.crossOrigin="",F.href=T,v&&F.setAttribute("nonce",v),document.head.appendChild(F),w)return new Promise((j,z)=>{F.addEventListener("load",j),F.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${T}`)))})}))}function d(f){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=f,window.dispatchEvent(E),!E.defaultPrevented)throw f}return l.then(f=>{for(const E of f||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},uO=()=>{const n=new Date,t=n.getHours().toString().padStart(2,"0"),s=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},Ee={log:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${uO()}] `,...t)}},error:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${uO()}] `,...t)}},warn:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${uO()}]`,...t)}},trace:n=>{console.trace(`[TRACE] [${uO()}] ${n}`)}};async function gMe(n){let t;try{switch(n){case"default":t=await y2(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await y2(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(s){return Ee.error("Failed to load theme:",s),t=await y2(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const _Me=()=>{};var sY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zte=function(n){const t=[];let s=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},EMe=function(n){const t=[];let s=0,a=0;for(;s<n.length;){const l=n[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[s++],f=n[s++],E=n[s++],v=((l&7)<<18|(d&63)<<12|(f&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[s++],f=n[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return t.join("")},ene={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],f=l+1<n.length,E=f?n[l+1]:0,v=l+2<n.length,T=v?n[l+2]:0,w=d>>2,A=(d&3)<<4|E>>4;let N=(E&15)<<2|T>>6,F=T&63;v||(F=64,f||(N=64)),a.push(s[w],s[A],s[N],s[F])}return a.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Zte(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):EMe(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=s[n.charAt(l++)],E=l<n.length?s[n.charAt(l)]:0;++l;const T=l<n.length?s[n.charAt(l)]:64;++l;const A=l<n.length?s[n.charAt(l)]:64;if(++l,d==null||E==null||T==null||A==null)throw new yMe;const N=d<<2|E>>4;if(a.push(N),T!==64){const F=E<<4&240|T>>2;if(a.push(F),A!==64){const j=T<<6&192|A;a.push(j)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class yMe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vMe=function(n){const t=Zte(n);return ene.encodeByteArray(t,!0)},_k=function(n){return vMe(n).replace(/\./g,"")},tne=function(n){try{return ene.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SMe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TMe=()=>SMe().__FIREBASE_DEFAULTS__,bMe=()=>{if(typeof process>"u"||typeof sY>"u")return;const n=sY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},wMe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&tne(n[1]);return t&&JSON.parse(t)},_1=()=>{try{return _Me()||TMe()||bMe()||wMe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},nne=n=>{var t,s;return(s=(t=_1())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[n]},rne=n=>{const t=nne(n);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},ine=()=>{var n;return(n=_1())===null||n===void 0?void 0:n.config},sne=n=>{var t;return(t=_1())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RMe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function one(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[_k(JSON.stringify(s)),_k(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ma(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function CMe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ma())}function IMe(){var n;const t=(n=_1())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function AMe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function PMe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function OMe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function kMe(){const n=Ma();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function NMe(){return!IMe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function DMe(){try{return typeof indexedDB=="object"}catch{return!1}}function LMe(){return new Promise((n,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xMe="FirebaseError";class rp extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=xMe,Object.setPrototypeOf(this,rp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$R.prototype.create)}}class $R{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],f=d?MMe(d,a):"Error",E=`${this.serviceName}: ${f} (${l}).`;return new rp(l,E,a)}}function MMe(n,t){return n.replace(UMe,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const UMe=/\{\$([^}]+)}/g;function VMe(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function Cf(n,t){if(n===t)return!0;const s=Object.keys(n),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=n[l],f=t[l];if(oY(d)&&oY(f)){if(!Cf(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function oY(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KR(n){const t=[];for(const[s,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function Cw(n){const t={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function Iw(n){const t=n.indexOf("?");if(!t)return"";const s=n.indexOf("#",t);return n.substring(t,s>0?s:void 0)}function FMe(n,t){const s=new jMe(n,t);return s.subscribe.bind(s)}class jMe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");BMe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=v2),l.error===void 0&&(l.error=v2),l.complete===void 0&&(l.complete=v2);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function BMe(n,t){if(typeof n!="object"||n===null)return!1;for(const s of t)if(s in n&&typeof n[s]=="function")return!0;return!1}function v2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ts(n){return n&&n._delegate?n._delegate:n}class gg{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nE="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WMe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new RMe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(GMe(t))try{this.getOrInitializeService({instanceIdentifier:nE})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=nE){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=nE){return this.instances.has(t)}getOptions(t=nE){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,f]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&f.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&t(f,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:zMe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=nE){return this.component?this.component.multipleInstances?t:nE:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function zMe(n){return n===nE?void 0:n}function GMe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HMe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new WMe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Sr||(Sr={}));const $Me={debug:Sr.DEBUG,verbose:Sr.VERBOSE,info:Sr.INFO,warn:Sr.WARN,error:Sr.ERROR,silent:Sr.SILENT},KMe=Sr.INFO,qMe={[Sr.DEBUG]:"log",[Sr.VERBOSE]:"log",[Sr.INFO]:"info",[Sr.WARN]:"warn",[Sr.ERROR]:"error"},YMe=(n,t,...s)=>{if(t<n.logLevel)return;const a=new Date().toISOString(),l=qMe[t];if(l)console[l](`[${a}]  ${n.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ej{constructor(t){this.name=t,this._logLevel=KMe,this._logHandler=YMe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Sr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?$Me[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Sr.DEBUG,...t),this._logHandler(this,Sr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Sr.VERBOSE,...t),this._logHandler(this,Sr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Sr.INFO,...t),this._logHandler(this,Sr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Sr.WARN,...t),this._logHandler(this,Sr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Sr.ERROR,...t),this._logHandler(this,Sr.ERROR,...t)}}const XMe=(n,t)=>t.some(s=>n instanceof s);let aY,cY;function JMe(){return aY||(aY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function QMe(){return cY||(cY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ane=new WeakMap,FU=new WeakMap,cne=new WeakMap,S2=new WeakMap,tj=new WeakMap;function ZMe(n){const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",f)},d=()=>{s(og(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",f)});return t.then(s=>{s instanceof IDBCursor&&ane.set(s,n)}).catch(()=>{}),tj.set(t,n),t}function e2e(n){if(FU.has(n))return;const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",f),n.removeEventListener("abort",f)},d=()=>{s(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",f),n.addEventListener("abort",f)});FU.set(n,t)}let jU={get(n,t,s){if(n instanceof IDBTransaction){if(t==="done")return FU.get(n);if(t==="objectStoreNames")return n.objectStoreNames||cne.get(n);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return og(n[t])},set(n,t,s){return n[t]=s,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function t2e(n){jU=n(jU)}function n2e(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=n.call(T2(this),t,...s);return cne.set(a,t.sort?t.sort():[t]),og(a)}:QMe().includes(n)?function(...t){return n.apply(T2(this),t),og(ane.get(this))}:function(...t){return og(n.apply(T2(this),t))}}function r2e(n){return typeof n=="function"?n2e(n):(n instanceof IDBTransaction&&e2e(n),XMe(n,JMe())?new Proxy(n,jU):n)}function og(n){if(n instanceof IDBRequest)return ZMe(n);if(S2.has(n))return S2.get(n);const t=r2e(n);return t!==n&&(S2.set(n,t),tj.set(t,n)),t}const T2=n=>tj.get(n);function i2e(n,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(n,t),E=og(f);return a&&f.addEventListener("upgradeneeded",v=>{a(og(f.result),v.oldVersion,v.newVersion,og(f.transaction),v)}),s&&f.addEventListener("blocked",v=>s(v.oldVersion,v.newVersion,v)),E.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",T=>l(T.oldVersion,T.newVersion,T))}).catch(()=>{}),E}const s2e=["get","getKey","getAll","getAllKeys","count"],o2e=["put","add","delete","clear"],b2=new Map;function lY(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(b2.get(t))return b2.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=o2e.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||s2e.includes(s)))return;const d=async function(f,...E){const v=this.transaction(f,l?"readwrite":"readonly");let T=v.store;return a&&(T=T.index(E.shift())),(await Promise.all([T[s](...E),l&&v.done]))[0]};return b2.set(t,d),d}t2e(n=>({...n,get:(t,s,a)=>lY(t,s)||n.get(t,s,a),has:(t,s)=>!!lY(t,s)||n.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a2e{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(c2e(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function c2e(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const BU="@firebase/app",uY="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const If=new ej("@firebase/app"),l2e="@firebase/app-compat",u2e="@firebase/analytics-compat",d2e="@firebase/analytics",h2e="@firebase/app-check-compat",p2e="@firebase/app-check",f2e="@firebase/auth",m2e="@firebase/auth-compat",g2e="@firebase/database",_2e="@firebase/data-connect",E2e="@firebase/database-compat",y2e="@firebase/functions",v2e="@firebase/functions-compat",S2e="@firebase/installations",T2e="@firebase/installations-compat",b2e="@firebase/messaging",w2e="@firebase/messaging-compat",R2e="@firebase/performance",C2e="@firebase/performance-compat",I2e="@firebase/remote-config",A2e="@firebase/remote-config-compat",P2e="@firebase/storage",O2e="@firebase/storage-compat",k2e="@firebase/firestore",N2e="@firebase/vertexai",D2e="@firebase/firestore-compat",L2e="firebase",x2e="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WU="[DEFAULT]",M2e={[BU]:"fire-core",[l2e]:"fire-core-compat",[d2e]:"fire-analytics",[u2e]:"fire-analytics-compat",[p2e]:"fire-app-check",[h2e]:"fire-app-check-compat",[f2e]:"fire-auth",[m2e]:"fire-auth-compat",[g2e]:"fire-rtdb",[_2e]:"fire-data-connect",[E2e]:"fire-rtdb-compat",[y2e]:"fire-fn",[v2e]:"fire-fn-compat",[S2e]:"fire-iid",[T2e]:"fire-iid-compat",[b2e]:"fire-fcm",[w2e]:"fire-fcm-compat",[R2e]:"fire-perf",[C2e]:"fire-perf-compat",[I2e]:"fire-rc",[A2e]:"fire-rc-compat",[P2e]:"fire-gcs",[O2e]:"fire-gcs-compat",[k2e]:"fire-fst",[D2e]:"fire-fst-compat",[N2e]:"fire-vertex","fire-js":"fire-js",[L2e]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek=new Map,U2e=new Map,zU=new Map;function dY(n,t){try{n.container.addComponent(t)}catch(s){If.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,s)}}function CE(n){const t=n.name;if(zU.has(t))return If.debug(`There were multiple attempts to register component ${t}.`),!1;zU.set(t,n);for(const s of Ek.values())dY(s,n);for(const s of U2e.values())dY(s,n);return!0}function E1(n,t){const s=n.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),n.container.getProvider(t)}function wl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ag=new $R("app","Firebase",V2e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2e{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new gg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ag.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DE=x2e;function lne(n,t={}){let s=n;typeof t!="object"&&(t={name:t});const a=Object.assign({name:WU,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw ag.create("bad-app-name",{appName:String(l)});if(s||(s=ine()),!s)throw ag.create("no-options");const d=Ek.get(l);if(d){if(Cf(s,d.options)&&Cf(a,d.config))return d;throw ag.create("duplicate-app",{appName:l})}const f=new HMe(l);for(const v of zU.values())f.addComponent(v);const E=new F2e(s,a,f);return Ek.set(l,E),E}function nj(n=WU){const t=Ek.get(n);if(!t&&n===WU&&ine())return lne();if(!t)throw ag.create("no-app",{appName:n});return t}function $h(n,t,s){var a;let l=(a=M2e[n])!==null&&a!==void 0?a:n;s&&(l+=`-${s}`);const d=l.match(/\s|\//),f=t.match(/\s|\//);if(d||f){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&E.push("and"),f&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),If.warn(E.join(" "));return}CE(new gg(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j2e="firebase-heartbeat-database",B2e=1,vR="firebase-heartbeat-store";let w2=null;function une(){return w2||(w2=i2e(j2e,B2e,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(vR)}catch(s){console.warn(s)}}}}).catch(n=>{throw ag.create("idb-open",{originalErrorMessage:n.message})})),w2}async function W2e(n){try{const s=(await une()).transaction(vR),a=await s.objectStore(vR).get(dne(n));return await s.done,a}catch(t){if(t instanceof rp)If.warn(t.message);else{const s=ag.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});If.warn(s.message)}}}async function hY(n,t){try{const a=(await une()).transaction(vR,"readwrite");await a.objectStore(vR).put(t,dne(n)),await a.done}catch(s){if(s instanceof rp)If.warn(s.message);else{const a=ag.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});If.warn(a.message)}}}function dne(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2e=1024,G2e=30;class H2e{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new K2e(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=pY();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>G2e){const f=q2e(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){If.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=pY(),{heartbeatsToSend:a,unsentEntries:l}=$2e(this._heartbeatsCache.heartbeats),d=_k(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return If.warn(s),""}}}function pY(){return new Date().toISOString().substring(0,10)}function $2e(n,t=z2e){const s=[];let a=n.slice();for(const l of n){const d=s.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),fY(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),fY(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class K2e{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return DMe()?LMe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await W2e(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return hY(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return hY(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function fY(n){return _k(JSON.stringify({version:2,heartbeats:n})).length}function q2e(n){if(n.length===0)return-1;let t=0,s=n[0].date;for(let a=1;a<n.length;a++)n[a].date<s&&(s=n[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2e(n){CE(new gg("platform-logger",t=>new a2e(t),"PRIVATE")),CE(new gg("heartbeat",t=>new H2e(t),"PRIVATE")),$h(BU,uY,n),$h(BU,uY,"esm2017"),$h("fire-js","")}Y2e("");function hne(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const X2e=hne,pne=new $R("auth","Firebase",hne());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk=new ej("@firebase/auth");function J2e(n,...t){yk.logLevel<=Sr.WARN&&yk.warn(`Auth (${DE}): ${n}`,...t)}function BO(n,...t){yk.logLevel<=Sr.ERROR&&yk.error(`Auth (${DE}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pd(n,...t){throw rj(n,...t)}function Kh(n,...t){return rj(n,...t)}function fne(n,t,s){const a=Object.assign(Object.assign({},X2e()),{[t]:s});return new $R("auth","Firebase",a).create(t,{appName:n.name})}function yf(n){return fne(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function rj(n,...t){if(typeof n!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(s,...a)}return pne.create(n,...t)}function Ln(n,t,...s){if(!n)throw rj(t,...s)}function df(n){const t="INTERNAL ASSERTION FAILED: "+n;throw BO(t),new Error(t)}function Af(n,t){n||df(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GU(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Q2e(){return mY()==="http:"||mY()==="https:"}function mY(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z2e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Q2e()||PMe()||"connection"in navigator)?navigator.onLine:!0}function eUe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(t,s){this.shortDelay=t,this.longDelay=s,Af(s>t,"Short delay should be less than long delay!"),this.isMobile=CMe()||OMe()}get(){return Z2e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ij(n,t){Af(n.emulator,"Emulator should always be set here");const{url:s}=n.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mne{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;df("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;df("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;df("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tUe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nUe=new qR(3e4,6e4);function Nf(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function Df(n,t,s,a,l={}){return gne(n,l,async()=>{let d={},f={};a&&(t==="GET"?f=a:d={body:JSON.stringify(a)});const E=KR(Object.assign({key:n.config.apiKey},f)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const T=Object.assign({method:t,headers:v},d);return AMe()||(T.referrerPolicy="no-referrer"),mne.fetch()(_ne(n,n.config.apiHost,s,E),T)})}async function gne(n,t,s){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},tUe),t);try{const l=new iUe(n),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw dO(n,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const E=d.ok?f.errorMessage:f.error.message,[v,T]=E.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw dO(n,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw dO(n,"email-already-in-use",f);if(v==="USER_DISABLED")throw dO(n,"user-disabled",f);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(T)throw fne(n,w,T);Pd(n,w)}}catch(l){if(l instanceof rp)throw l;Pd(n,"network-request-failed",{message:String(l)})}}async function YR(n,t,s,a,l={}){const d=await Df(n,t,s,a,l);return"mfaPendingCredential"in d&&Pd(n,"multi-factor-auth-required",{_serverResponse:d}),d}function _ne(n,t,s,a){const l=`${t}${s}?${a}`;return n.config.emulator?ij(n.config,l):`${n.config.apiScheme}://${l}`}function rUe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class iUe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(Kh(this.auth,"network-request-failed")),nUe.get())})}}function dO(n,t,s){const a={appName:n.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=Kh(n,t,a);return l.customData._tokenResponse=s,l}function gY(n){return n!==void 0&&n.enterprise!==void 0}class sUe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return rUe(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function oUe(n,t){return Df(n,"GET","/v2/recaptchaConfig",Nf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aUe(n,t){return Df(n,"POST","/v1/accounts:delete",t)}async function Ene(n,t){return Df(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function cUe(n,t=!1){const s=ts(n),a=await s.getIdToken(t),l=sj(a);Ln(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:qw(R2(l.auth_time)),issuedAtTime:qw(R2(l.iat)),expirationTime:qw(R2(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function R2(n){return Number(n)*1e3}function sj(n){const[t,s,a]=n.split(".");if(t===void 0||s===void 0||a===void 0)return BO("JWT malformed, contained fewer than 3 sections"),null;try{const l=tne(s);return l?JSON.parse(l):(BO("Failed to decode base64 JWT payload"),null)}catch(l){return BO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function _Y(n){const t=sj(n);return Ln(t,"internal-error"),Ln(typeof t.exp<"u","internal-error"),Ln(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SR(n,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof rp&&lUe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function lUe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uUe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HU{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=qw(this.lastLoginAt),this.creationTime=qw(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vk(n){var t;const s=n.auth,a=await n.getIdToken(),l=await SR(n,Ene(s,{idToken:a}));Ln(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const f=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?yne(d.providerUserInfo):[],E=hUe(n.providerData,f),v=n.isAnonymous,T=!(n.email&&d.passwordHash)&&!(E!=null&&E.length),w=v?T:!1,A={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new HU(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,A)}async function dUe(n){const t=ts(n);await vk(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function hUe(n,t){return[...n.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function yne(n){return n.map(t=>{var{providerId:s}=t,a=jR(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pUe(n,t){const s=await gne(n,{},async()=>{const a=KR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,f=_ne(n,l,"/v1/token",`key=${d}`),E=await n._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",mne.fetch()(f,{method:"POST",headers:E,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function fUe(n,t){return Df(n,"POST","/v2/accounts:revokeToken",Nf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ln(t.idToken,"internal-error"),Ln(typeof t.idToken<"u","internal-error"),Ln(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):_Y(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Ln(t.length!==0,"internal-error");const s=_Y(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Ln(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await pUe(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,f=new BS;return a&&(Ln(typeof a=="string","internal-error",{appName:t}),f.refreshToken=a),l&&(Ln(typeof l=="string","internal-error",{appName:t}),f.accessToken=l),d&&(Ln(typeof d=="number","internal-error",{appName:t}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new BS,this.toJSON())}_performRefresh(){return df("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gm(n,t){Ln(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class hf{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=jR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new uUe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new HU(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await SR(this,this.stsTokenManager.getToken(this.auth,t));return Ln(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return cUe(this,t)}reload(){return dUe(this)}_assign(t){this!==t&&(Ln(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new hf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Ln(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await vk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(wl(this.auth.app))return Promise.reject(yf(this.auth));const t=await this.getIdToken();return await SR(this,aUe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,f,E,v,T,w;const A=(a=s.displayName)!==null&&a!==void 0?a:void 0,N=(l=s.email)!==null&&l!==void 0?l:void 0,F=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,j=(f=s.photoURL)!==null&&f!==void 0?f:void 0,z=(E=s.tenantId)!==null&&E!==void 0?E:void 0,H=(v=s._redirectEventId)!==null&&v!==void 0?v:void 0,te=(T=s.createdAt)!==null&&T!==void 0?T:void 0,K=(w=s.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:ne,emailVerified:de,isAnonymous:oe,providerData:ge,stsTokenManager:ee}=s;Ln(ne&&ee,t,"internal-error");const Z=BS.fromJSON(this.name,ee);Ln(typeof ne=="string",t,"internal-error"),Gm(A,t.name),Gm(N,t.name),Ln(typeof de=="boolean",t,"internal-error"),Ln(typeof oe=="boolean",t,"internal-error"),Gm(F,t.name),Gm(j,t.name),Gm(z,t.name),Gm(H,t.name),Gm(te,t.name),Gm(K,t.name);const J=new hf({uid:ne,auth:t,email:N,emailVerified:de,displayName:A,isAnonymous:oe,photoURL:j,phoneNumber:F,tenantId:z,stsTokenManager:Z,createdAt:te,lastLoginAt:K});return ge&&Array.isArray(ge)&&(J.providerData=ge.map(se=>Object.assign({},se))),H&&(J._redirectEventId=H),J}static async _fromIdTokenResponse(t,s,a=!1){const l=new BS;l.updateFromServerResponse(s);const d=new hf({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await vk(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Ln(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?yne(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new BS;E.updateFromIdToken(a);const v=new hf({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:f}),T={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new HU(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,T),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EY=new Map;function pf(n){Af(n instanceof Function,"Expected a class definition");let t=EY.get(n);return t?(Af(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,EY.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vne{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}vne.type="NONE";const yY=vne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WO(n,t,s){return`firebase:${n}:${t}:${s}`}class WS{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=WO(this.userKey,l.apiKey,d),this.fullPersistenceKey=WO("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?hf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new WS(pf(yY),t,a);const l=(await Promise.all(s.map(async T=>{if(await T._isAvailable())return T}))).filter(T=>T);let d=l[0]||pf(yY);const f=WO(a,t.config.apiKey,t.name);let E=null;for(const T of s)try{const w=await T._get(f);if(w){const A=hf._fromJSON(t,w);T!==d&&(E=A),d=T;break}}catch{}const v=l.filter(T=>T._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new WS(d,t,a):(d=v[0],E&&await d._set(f,E.toJSON()),await Promise.all(s.map(async T=>{if(T!==d)try{await T._remove(f)}catch{}})),new WS(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vY(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(wne(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Sne(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Cne(t))return"Blackberry";if(Ine(t))return"Webos";if(Tne(t))return"Safari";if((t.includes("chrome/")||bne(t))&&!t.includes("edge/"))return"Chrome";if(Rne(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Sne(n=Ma()){return/firefox\//i.test(n)}function Tne(n=Ma()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function bne(n=Ma()){return/crios\//i.test(n)}function wne(n=Ma()){return/iemobile/i.test(n)}function Rne(n=Ma()){return/android/i.test(n)}function Cne(n=Ma()){return/blackberry/i.test(n)}function Ine(n=Ma()){return/webos/i.test(n)}function oj(n=Ma()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function mUe(n=Ma()){var t;return oj(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function gUe(){return kMe()&&document.documentMode===10}function Ane(n=Ma()){return oj(n)||Rne(n)||Ine(n)||Cne(n)||/windows phone/i.test(n)||wne(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pne(n,t=[]){let s;switch(n){case"Browser":s=vY(Ma());break;case"Worker":s=`${vY(Ma())}-${n}`;break;default:s=n}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${DE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Ue{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((f,E)=>{try{const v=t(d);f(v)}catch(v){E(v)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EUe(n,t={}){return Df(n,"GET","/v2/passwordPolicy",Nf(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yUe=6;class vUe{constructor(t){var s,a,l,d;const f=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=f.minPasswordLength)!==null&&s!==void 0?s:yUe,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,f,E;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(s=v.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(E=v.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),v}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SUe{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new SY(this),this.idTokenSubscription=new SY(this),this.beforeStateQueue=new _Ue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pne,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=pf(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await WS.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await Ene(this,{idToken:t}),a=await hf._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(wl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,E=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!f||f===E)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Ln(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await vk(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=eUe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(wl(this.app))return Promise.reject(yf(this));const s=t?ts(t):null;return s&&Ln(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Ln(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return wl(this.app)?Promise.reject(yf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return wl(this.app)?Promise.reject(yf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(pf(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await EUe(this),s=new vUe(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new $R("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await fUe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&pf(t)||this._popupRedirectResolver;Ln(s,this,"argument-error"),this.redirectPersistenceManager=await WS.create(this,[pf(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let f=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ln(E,this,"internal-error"),E.then(()=>{f||d(this.currentUser)}),typeof s=="function"){const v=t.addObserver(s,a,l);return()=>{f=!0,v()}}else{const v=t.addObserver(s);return()=>{f=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ln(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Pne(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(wl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&J2e(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Cg(n){return ts(n)}class SY{constructor(t){this.auth=t,this.observer=null,this.addObserver=FMe(s=>this.observer=s)}get next(){return Ln(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let y1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function TUe(n){y1=n}function One(n){return y1.loadJS(n)}function bUe(){return y1.recaptchaEnterpriseScript}function wUe(){return y1.gapiScript}function RUe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class CUe{constructor(){this.enterprise=new IUe}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class IUe{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const AUe="recaptcha-enterprise",kne="NO_RECAPTCHA";class PUe{constructor(t){this.type=AUe,this.auth=Cg(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,E)=>{oUe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const T=new sUe(v);return d.tenantId==null?d._agentRecaptchaConfig=T:d._tenantRecaptchaConfigs[d.tenantId]=T,f(T.siteKey)}}).catch(v=>{E(v)})})}function l(d,f,E){const v=window.grecaptcha;gY(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(T=>{f(T)}).catch(()=>{f(kne)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new CUe().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(E=>{if(!s&&gY(window.grecaptcha))l(E,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=bUe();v.length!==0&&(v+=E),One(v).then(()=>{l(E,d,f)}).catch(T=>{f(T)})}}).catch(E=>{f(E)})})}}async function TY(n,t,s,a=!1,l=!1){const d=new PUe(n);let f;if(l)f=kne;else try{f=await d.verify(s)}catch{f=await d.verify(s,!0)}const E=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const v=E.phoneEnrollmentInfo.phoneNumber,T=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:T,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const v=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:f}):Object.assign(E,{captchaResponse:f}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function Sk(n,t,s,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await TY(n,t,s,s==="getOobCode");return a(n,f)}else return a(n,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await TY(n,t,s,s==="getOobCode");return a(n,E)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OUe(n,t){const s=E1(n,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(Cf(d,t??{}))return l;Pd(l,"already-initialized")}return s.initialize({options:t})}function kUe(n,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(pf);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function NUe(n,t,s){const a=Cg(n);Ln(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=Nne(t),{host:f,port:E}=DUe(t),v=E===null?"":`:${E}`,T={url:`${d}//${f}${v}/`},w=Object.freeze({host:f,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Ln(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Ln(Cf(T,a.config.emulator)&&Cf(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=T,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,LUe()}function Nne(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function DUe(n){const t=Nne(n),s=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:bY(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:bY(f)}}}function bY(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function LUe(){function n(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return df("not implemented")}_getIdTokenResponse(t){return df("not implemented")}_linkToIdToken(t,s){return df("not implemented")}_getReauthenticationResolver(t){return df("not implemented")}}async function xUe(n,t){return Df(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MUe(n,t){return YR(n,"POST","/v1/accounts:signInWithPassword",Nf(n,t))}async function Dne(n,t){return Df(n,"POST","/v1/accounts:sendOobCode",Nf(n,t))}async function UUe(n,t){return Dne(n,t)}async function VUe(n,t){return Dne(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FUe(n,t){return YR(n,"POST","/v1/accounts:signInWithEmailLink",Nf(n,t))}async function jUe(n,t){return YR(n,"POST","/v1/accounts:signInWithEmailLink",Nf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR extends aj{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new TR(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new TR(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Sk(t,s,"signInWithPassword",MUe);case"emailLink":return FUe(t,{email:this._email,oobCode:this._password});default:Pd(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Sk(t,a,"signUpPassword",xUe);case"emailLink":return jUe(t,{idToken:s,email:this._email,oobCode:this._password});default:Pd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zS(n,t){return YR(n,"POST","/v1/accounts:signInWithIdp",Nf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BUe="http://localhost";class IE extends aj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new IE(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):Pd("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=jR(s,["providerId","signInMethod"]);if(!a||!l)return null;const f=new IE(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(t){const s=this.buildRequest();return zS(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,zS(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,zS(t,s)}buildRequest(){const t={requestUri:BUe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=KR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WUe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function zUe(n){const t=Cw(Iw(n)).link,s=t?Cw(Iw(t)).deep_link_id:null,a=Cw(Iw(n)).deep_link_id;return(a?Cw(Iw(a)).link:null)||a||s||t||n}class cj{constructor(t){var s,a,l,d,f,E;const v=Cw(Iw(t)),T=(s=v.apiKey)!==null&&s!==void 0?s:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,A=WUe((l=v.mode)!==null&&l!==void 0?l:null);Ln(T&&w&&A,"argument-error"),this.apiKey=T,this.operation=A,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=v.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(E=v.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const s=zUe(t);try{return new cj(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{constructor(){this.providerId=C0.PROVIDER_ID}static credential(t,s){return TR._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=cj.parseLink(s);return Ln(a,"argument-error"),TR._fromEmailAndCode(t,a.code,a.tenantId)}}C0.PROVIDER_ID="password";C0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";C0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lne{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XR extends Lne{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym extends XR{constructor(){super("facebook.com")}static credential(t){return IE._fromParams({providerId:Ym.PROVIDER_ID,signInMethod:Ym.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ym.credentialFromTaggedObject(t)}static credentialFromError(t){return Ym.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Ym.credential(t.oauthAccessToken)}catch{return null}}}Ym.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ym.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm extends XR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return IE._fromParams({providerId:Xm.PROVIDER_ID,signInMethod:Xm.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return Xm.credentialFromTaggedObject(t)}static credentialFromError(t){return Xm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return Xm.credential(s,a)}catch{return null}}}Xm.GOOGLE_SIGN_IN_METHOD="google.com";Xm.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm extends XR{constructor(){super("github.com")}static credential(t){return IE._fromParams({providerId:Jm.PROVIDER_ID,signInMethod:Jm.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Jm.credentialFromTaggedObject(t)}static credentialFromError(t){return Jm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Jm.credential(t.oauthAccessToken)}catch{return null}}}Jm.GITHUB_SIGN_IN_METHOD="github.com";Jm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm extends XR{constructor(){super("twitter.com")}static credential(t,s){return IE._fromParams({providerId:Qm.PROVIDER_ID,signInMethod:Qm.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return Qm.credentialFromTaggedObject(t)}static credentialFromError(t){return Qm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return Qm.credential(s,a)}catch{return null}}}Qm.TWITTER_SIGN_IN_METHOD="twitter.com";Qm.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GUe(n,t){return YR(n,"POST","/v1/accounts:signUp",Nf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await hf._fromIdTokenResponse(t,a,l),f=wY(a);return new AE({user:d,providerId:f,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=wY(a);return new AE({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function wY(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk extends rp{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,Tk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new Tk(t,s,a,l)}}function xne(n,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(n):s._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?Tk._fromErrorAndOperation(n,d,t,a):d})}async function HUe(n,t,s=!1){const a=await SR(n,t._linkToIdToken(n.auth,await n.getIdToken()),s);return AE._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $Ue(n,t,s=!1){const{auth:a}=n;if(wl(a.app))return Promise.reject(yf(a));const l="reauthenticate";try{const d=await SR(n,xne(a,l,t,n),s);Ln(d.idToken,a,"internal-error");const f=sj(d.idToken);Ln(f,a,"internal-error");const{sub:E}=f;return Ln(n.uid===E,a,"user-mismatch"),AE._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Pd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mne(n,t,s=!1){if(wl(n.app))return Promise.reject(yf(n));const a="signIn",l=await xne(n,a,t),d=await AE._fromIdTokenResponse(n,a,l);return s||await n._updateCurrentUser(d.user),d}async function KUe(n,t){return Mne(Cg(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Une(n){const t=Cg(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function qUe(n,t,s){const a=Cg(n);await Sk(a,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",VUe)}async function YUe(n,t,s){if(wl(n.app))return Promise.reject(yf(n));const a=Cg(n),f=await Sk(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",GUe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Une(n),v}),E=await AE._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(E.user),E}function XUe(n,t,s){return wl(n.app)?Promise.reject(yf(n)):KUe(ts(n),C0.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Une(n),a})}async function $U(n,t){const s=ts(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await UUe(s.auth,l);d!==n.email&&await n.reload()}function JUe(n,t,s,a){return ts(n).onIdTokenChanged(t,s,a)}function QUe(n,t,s){return ts(n).beforeAuthStateChanged(t,s)}function ZUe(n,t,s,a){return ts(n).onAuthStateChanged(t,s,a)}function eVe(n){return ts(n).signOut()}const bk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vne{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(bk,"1"),this.storage.removeItem(bk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tVe=1e3,nVe=10;class Fne extends Vne{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ane(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((f,E,v)=>{this.notifyListeners(f,v)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!s&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);gUe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,nVe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},tVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}Fne.type="LOCAL";const rVe=Fne;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jne extends Vne{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}jne.type="SESSION";const Bne=jne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iVe(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new v1(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(f).map(async T=>T(s.origin,d)),v=await iVe(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}v1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lj(n="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return n+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sVe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((E,v)=>{const T=lj("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(A){const N=A;if(N.data.eventId===T)switch(N.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:t,eventId:T,data:s},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qh(){return window}function oVe(n){qh().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wne(){return typeof qh().WorkerGlobalScope<"u"&&typeof qh().importScripts=="function"}async function aVe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function cVe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function lVe(){return Wne()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zne="firebaseLocalStorageDb",uVe=1,wk="firebaseLocalStorage",Gne="fbase_key";class JR{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function S1(n,t){return n.transaction([wk],t?"readwrite":"readonly").objectStore(wk)}function dVe(){const n=indexedDB.deleteDatabase(zne);return new JR(n).toPromise()}function KU(){const n=indexedDB.open(zne,uVe);return new Promise((t,s)=>{n.addEventListener("error",()=>{s(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(wk,{keyPath:Gne})}catch(l){s(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(wk)?t(a):(a.close(),await dVe(),t(await KU()))})})}async function RY(n,t,s){const a=S1(n,!0).put({[Gne]:t,value:s});return new JR(a).toPromise()}async function hVe(n,t){const s=S1(n,!1).get(t),a=await new JR(s).toPromise();return a===void 0?null:a.value}function CY(n,t){const s=S1(n,!0).delete(t);return new JR(s).toPromise()}const pVe=800,fVe=3;class Hne{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await KU(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>fVe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Wne()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=v1._getInstance(lVe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await aVe(),!this.activeServiceWorker)return;this.sender=new sVe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||cVe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await KU();return await RY(t,bk,"1"),await CY(t,bk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>RY(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>hVe(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>CY(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=S1(l,!1).getAll();return new JR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),pVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Hne.type="LOCAL";const mVe=Hne;new qR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gVe(n,t){return t?pf(t):(Ln(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj extends aj{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return zS(t,this._buildIdpRequest())}_linkToIdToken(t,s){return zS(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return zS(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function _Ve(n){return Mne(n.auth,new uj(n),n.bypassAuthState)}function EVe(n){const{auth:t,user:s}=n;return Ln(s,t,"internal-error"),$Ue(s,new uj(n),n.bypassAuthState)}async function yVe(n){const{auth:t,user:s}=n;return Ln(s,t,"internal-error"),HUe(s,new uj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ne{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:f,type:E}=t;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(v))}catch(T){this.reject(T)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return _Ve;case"linkViaPopup":case"linkViaRedirect":return yVe;case"reauthViaPopup":case"reauthViaRedirect":return EVe;default:Pd(this.auth,"internal-error")}}resolve(t){Af(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Af(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vVe=new qR(2e3,1e4);class CS extends $ne{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,CS.currentPopupAction&&CS.currentPopupAction.cancel(),CS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Ln(t,this.auth,"internal-error"),t}async onExecution(){Af(this.filter.length===1,"Popup operations only handle one event");const t=lj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(Kh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Kh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,CS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Kh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,vVe.get())};t()}}CS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SVe="pendingRedirect",zO=new Map;class TVe extends $ne{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=zO.get(this.auth._key());if(!t){try{const a=await bVe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}zO.set(this.auth._key(),t)}return this.bypassAuthState||zO.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function bVe(n,t){const s=CVe(t),a=RVe(n);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function wVe(n,t){zO.set(n._key(),t)}function RVe(n){return pf(n._redirectPersistence)}function CVe(n){return WO(SVe,n.config.apiKey,n.name)}async function IVe(n,t,s=!1){if(wl(n.app))return Promise.reject(yf(n));const a=Cg(n),l=gVe(a,t),f=await new TVe(a,l,s).execute();return f&&!s&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,t)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AVe=10*60*1e3;class PVe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!OVe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!Kne(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(Kh(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=AVe&&this.cachedEventUids.clear(),this.cachedEventUids.has(IY(t))}saveEventToCache(t){this.cachedEventUids.add(IY(t)),this.lastProcessedEventTime=Date.now()}}function IY(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function Kne({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function OVe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Kne(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kVe(n,t={}){return Df(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NVe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,DVe=/^https?/;async function LVe(n){if(n.config.emulator)return;const{authorizedDomains:t}=await kVe(n);for(const s of t)try{if(xVe(s))return}catch{}Pd(n,"unauthorized-domain")}function xVe(n){const t=GU(),{protocol:s,hostname:a}=new URL(t);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?s==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&f.hostname===a}if(!DVe.test(s))return!1;if(NVe.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MVe=new qR(3e4,6e4);function AY(){const n=qh().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let s=0;s<n.CP.length;s++)n.CP[s]=null}}function UVe(n){return new Promise((t,s)=>{var a,l,d;function f(){AY(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{AY(),s(Kh(n,"network-request-failed"))},timeout:MVe.get()})}if(!((l=(a=qh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=qh().gapi)===null||d===void 0)&&d.load)f();else{const E=RUe("iframefcb");return qh()[E]=()=>{gapi.load?f():s(Kh(n,"network-request-failed"))},One(`${wUe()}?onload=${E}`).catch(v=>s(v))}}).catch(t=>{throw GO=null,t})}let GO=null;function VVe(n){return GO=GO||UVe(n),GO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FVe=new qR(5e3,15e3),jVe="__/auth/iframe",BVe="emulator/auth/iframe",WVe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},zVe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function GVe(n){const t=n.config;Ln(t.authDomain,n,"auth-domain-config-required");const s=t.emulator?ij(t,BVe):`https://${n.config.authDomain}/${jVe}`,a={apiKey:t.apiKey,appName:n.name,v:DE},l=zVe.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${KR(a).slice(1)}`}async function HVe(n){const t=await VVe(n),s=qh().gapi;return Ln(s,n,"internal-error"),t.open({where:document.body,url:GVe(n),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:WVe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=Kh(n,"network-request-failed"),E=qh().setTimeout(()=>{d(f)},FVe.get());function v(){qh().clearTimeout(E),l(a)}a.ping(v).then(v,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Ve={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},KVe=500,qVe=600,YVe="_blank",XVe="http://localhost";class PY{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function JVe(n,t,s,a=KVe,l=qVe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const v=Object.assign(Object.assign({},$Ve),{width:a.toString(),height:l.toString(),top:d,left:f}),T=Ma().toLowerCase();s&&(E=bne(T)?YVe:s),Sne(T)&&(t=t||XVe,v.scrollbars="yes");const w=Object.entries(v).reduce((N,[F,j])=>`${N}${F}=${j},`,"");if(mUe(T)&&E!=="_self")return QVe(t||"",E),new PY(null);const A=window.open(t||"",E,w);Ln(A,n,"popup-blocked");try{A.focus()}catch{}return new PY(A)}function QVe(n,t){const s=document.createElement("a");s.href=n,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZVe="__/auth/handler",eFe="emulator/auth/handler",tFe=encodeURIComponent("fac");async function OY(n,t,s,a,l,d){Ln(n.config.authDomain,n,"auth-domain-config-required"),Ln(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:s,redirectUrl:a,v:DE,eventId:l};if(t instanceof Lne){t.setDefaultLanguage(n.languageCode),f.providerId=t.providerId||"",VMe(t.getCustomParameters())||(f.customParameters=JSON.stringify(t.getCustomParameters()));for(const[w,A]of Object.entries({}))f[w]=A}if(t instanceof XR){const w=t.getScopes().filter(A=>A!=="");w.length>0&&(f.scopes=w.join(","))}n.tenantId&&(f.tid=n.tenantId);const E=f;for(const w of Object.keys(E))E[w]===void 0&&delete E[w];const v=await n._getAppCheckToken(),T=v?`#${tFe}=${encodeURIComponent(v)}`:"";return`${nFe(n)}?${KR(E).slice(1)}${T}`}function nFe({config:n}){return n.emulator?ij(n,eFe):`https://${n.authDomain}/${ZVe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2="webStorageSupport";class rFe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Bne,this._completeRedirectFn=IVe,this._overrideRedirectResult=wVe}async _openPopup(t,s,a,l){var d;Af((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await OY(t,s,a,GU(),l);return JVe(t,f,lj())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await OY(t,s,a,GU(),l);return oVe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(Af(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await HVe(t),a=new PVe(t);return s.register("authEvent",l=>(Ln(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(C2,{type:C2},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[C2];f!==void 0&&s(!!f),Pd(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=LVe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return Ane()||Tne()||oj()}}const iFe=rFe;var kY="@firebase/auth",NY="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sFe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Ln(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oFe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function aFe(n){CE(new gg("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:f,authDomain:E}=a.options;Ln(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:f,authDomain:E,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Pne(n)},T=new SUe(a,l,d,v);return kUe(T,s),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),CE(new gg("auth-internal",t=>{const s=Cg(t.getProvider("auth").getImmediate());return(a=>new sFe(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),$h(kY,NY,oFe(n)),$h(kY,NY,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cFe=5*60,lFe=sne("authIdTokenMaxAge")||cFe;let DY=null;const uFe=n=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>lFe)return;const l=s==null?void 0:s.token;DY!==l&&(DY=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function qne(n=nj()){const t=E1(n,"auth");if(t.isInitialized())return t.getImmediate();const s=OUe(n,{popupRedirectResolver:iFe,persistence:[mVe,rVe,Bne]}),a=sne("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=uFe(d.toString());QUe(s,f,()=>f(s.currentUser)),JUe(s,E=>f(E))}}const l=nne("auth");return l&&NUe(s,`http://${l}`),s}function dFe(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}TUe({loadJS(n){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=t,a.onerror=l=>{const d=Kh("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",dFe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});aFe("Browser");var LY=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var cg,Yne;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(ee,Z){function J(){}J.prototype=Z.prototype,ee.D=Z.prototype,ee.prototype=new J,ee.prototype.constructor=ee,ee.C=function(se,he,pe){for(var le=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)le[Me-2]=arguments[Me];return Z.prototype[he].apply(se,le)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(ee,Z,J){J||(J=0);var se=Array(16);if(typeof Z=="string")for(var he=0;16>he;++he)se[he]=Z.charCodeAt(J++)|Z.charCodeAt(J++)<<8|Z.charCodeAt(J++)<<16|Z.charCodeAt(J++)<<24;else for(he=0;16>he;++he)se[he]=Z[J++]|Z[J++]<<8|Z[J++]<<16|Z[J++]<<24;Z=ee.g[0],J=ee.g[1],he=ee.g[2];var pe=ee.g[3],le=Z+(pe^J&(he^pe))+se[0]+3614090360&4294967295;Z=J+(le<<7&4294967295|le>>>25),le=pe+(he^Z&(J^he))+se[1]+3905402710&4294967295,pe=Z+(le<<12&4294967295|le>>>20),le=he+(J^pe&(Z^J))+se[2]+606105819&4294967295,he=pe+(le<<17&4294967295|le>>>15),le=J+(Z^he&(pe^Z))+se[3]+3250441966&4294967295,J=he+(le<<22&4294967295|le>>>10),le=Z+(pe^J&(he^pe))+se[4]+4118548399&4294967295,Z=J+(le<<7&4294967295|le>>>25),le=pe+(he^Z&(J^he))+se[5]+1200080426&4294967295,pe=Z+(le<<12&4294967295|le>>>20),le=he+(J^pe&(Z^J))+se[6]+2821735955&4294967295,he=pe+(le<<17&4294967295|le>>>15),le=J+(Z^he&(pe^Z))+se[7]+4249261313&4294967295,J=he+(le<<22&4294967295|le>>>10),le=Z+(pe^J&(he^pe))+se[8]+1770035416&4294967295,Z=J+(le<<7&4294967295|le>>>25),le=pe+(he^Z&(J^he))+se[9]+2336552879&4294967295,pe=Z+(le<<12&4294967295|le>>>20),le=he+(J^pe&(Z^J))+se[10]+4294925233&4294967295,he=pe+(le<<17&4294967295|le>>>15),le=J+(Z^he&(pe^Z))+se[11]+2304563134&4294967295,J=he+(le<<22&4294967295|le>>>10),le=Z+(pe^J&(he^pe))+se[12]+1804603682&4294967295,Z=J+(le<<7&4294967295|le>>>25),le=pe+(he^Z&(J^he))+se[13]+4254626195&4294967295,pe=Z+(le<<12&4294967295|le>>>20),le=he+(J^pe&(Z^J))+se[14]+2792965006&4294967295,he=pe+(le<<17&4294967295|le>>>15),le=J+(Z^he&(pe^Z))+se[15]+1236535329&4294967295,J=he+(le<<22&4294967295|le>>>10),le=Z+(he^pe&(J^he))+se[1]+4129170786&4294967295,Z=J+(le<<5&4294967295|le>>>27),le=pe+(J^he&(Z^J))+se[6]+3225465664&4294967295,pe=Z+(le<<9&4294967295|le>>>23),le=he+(Z^J&(pe^Z))+se[11]+643717713&4294967295,he=pe+(le<<14&4294967295|le>>>18),le=J+(pe^Z&(he^pe))+se[0]+3921069994&4294967295,J=he+(le<<20&4294967295|le>>>12),le=Z+(he^pe&(J^he))+se[5]+3593408605&4294967295,Z=J+(le<<5&4294967295|le>>>27),le=pe+(J^he&(Z^J))+se[10]+38016083&4294967295,pe=Z+(le<<9&4294967295|le>>>23),le=he+(Z^J&(pe^Z))+se[15]+3634488961&4294967295,he=pe+(le<<14&4294967295|le>>>18),le=J+(pe^Z&(he^pe))+se[4]+3889429448&4294967295,J=he+(le<<20&4294967295|le>>>12),le=Z+(he^pe&(J^he))+se[9]+568446438&4294967295,Z=J+(le<<5&4294967295|le>>>27),le=pe+(J^he&(Z^J))+se[14]+3275163606&4294967295,pe=Z+(le<<9&4294967295|le>>>23),le=he+(Z^J&(pe^Z))+se[3]+4107603335&4294967295,he=pe+(le<<14&4294967295|le>>>18),le=J+(pe^Z&(he^pe))+se[8]+1163531501&4294967295,J=he+(le<<20&4294967295|le>>>12),le=Z+(he^pe&(J^he))+se[13]+2850285829&4294967295,Z=J+(le<<5&4294967295|le>>>27),le=pe+(J^he&(Z^J))+se[2]+4243563512&4294967295,pe=Z+(le<<9&4294967295|le>>>23),le=he+(Z^J&(pe^Z))+se[7]+1735328473&4294967295,he=pe+(le<<14&4294967295|le>>>18),le=J+(pe^Z&(he^pe))+se[12]+2368359562&4294967295,J=he+(le<<20&4294967295|le>>>12),le=Z+(J^he^pe)+se[5]+4294588738&4294967295,Z=J+(le<<4&4294967295|le>>>28),le=pe+(Z^J^he)+se[8]+2272392833&4294967295,pe=Z+(le<<11&4294967295|le>>>21),le=he+(pe^Z^J)+se[11]+1839030562&4294967295,he=pe+(le<<16&4294967295|le>>>16),le=J+(he^pe^Z)+se[14]+4259657740&4294967295,J=he+(le<<23&4294967295|le>>>9),le=Z+(J^he^pe)+se[1]+2763975236&4294967295,Z=J+(le<<4&4294967295|le>>>28),le=pe+(Z^J^he)+se[4]+1272893353&4294967295,pe=Z+(le<<11&4294967295|le>>>21),le=he+(pe^Z^J)+se[7]+4139469664&4294967295,he=pe+(le<<16&4294967295|le>>>16),le=J+(he^pe^Z)+se[10]+3200236656&4294967295,J=he+(le<<23&4294967295|le>>>9),le=Z+(J^he^pe)+se[13]+681279174&4294967295,Z=J+(le<<4&4294967295|le>>>28),le=pe+(Z^J^he)+se[0]+3936430074&4294967295,pe=Z+(le<<11&4294967295|le>>>21),le=he+(pe^Z^J)+se[3]+3572445317&4294967295,he=pe+(le<<16&4294967295|le>>>16),le=J+(he^pe^Z)+se[6]+76029189&4294967295,J=he+(le<<23&4294967295|le>>>9),le=Z+(J^he^pe)+se[9]+3654602809&4294967295,Z=J+(le<<4&4294967295|le>>>28),le=pe+(Z^J^he)+se[12]+3873151461&4294967295,pe=Z+(le<<11&4294967295|le>>>21),le=he+(pe^Z^J)+se[15]+530742520&4294967295,he=pe+(le<<16&4294967295|le>>>16),le=J+(he^pe^Z)+se[2]+3299628645&4294967295,J=he+(le<<23&4294967295|le>>>9),le=Z+(he^(J|~pe))+se[0]+4096336452&4294967295,Z=J+(le<<6&4294967295|le>>>26),le=pe+(J^(Z|~he))+se[7]+1126891415&4294967295,pe=Z+(le<<10&4294967295|le>>>22),le=he+(Z^(pe|~J))+se[14]+2878612391&4294967295,he=pe+(le<<15&4294967295|le>>>17),le=J+(pe^(he|~Z))+se[5]+4237533241&4294967295,J=he+(le<<21&4294967295|le>>>11),le=Z+(he^(J|~pe))+se[12]+1700485571&4294967295,Z=J+(le<<6&4294967295|le>>>26),le=pe+(J^(Z|~he))+se[3]+2399980690&4294967295,pe=Z+(le<<10&4294967295|le>>>22),le=he+(Z^(pe|~J))+se[10]+4293915773&4294967295,he=pe+(le<<15&4294967295|le>>>17),le=J+(pe^(he|~Z))+se[1]+2240044497&4294967295,J=he+(le<<21&4294967295|le>>>11),le=Z+(he^(J|~pe))+se[8]+1873313359&4294967295,Z=J+(le<<6&4294967295|le>>>26),le=pe+(J^(Z|~he))+se[15]+4264355552&4294967295,pe=Z+(le<<10&4294967295|le>>>22),le=he+(Z^(pe|~J))+se[6]+2734768916&4294967295,he=pe+(le<<15&4294967295|le>>>17),le=J+(pe^(he|~Z))+se[13]+1309151649&4294967295,J=he+(le<<21&4294967295|le>>>11),le=Z+(he^(J|~pe))+se[4]+4149444226&4294967295,Z=J+(le<<6&4294967295|le>>>26),le=pe+(J^(Z|~he))+se[11]+3174756917&4294967295,pe=Z+(le<<10&4294967295|le>>>22),le=he+(Z^(pe|~J))+se[2]+718787259&4294967295,he=pe+(le<<15&4294967295|le>>>17),le=J+(pe^(he|~Z))+se[9]+3951481745&4294967295,ee.g[0]=ee.g[0]+Z&4294967295,ee.g[1]=ee.g[1]+(he+(le<<21&4294967295|le>>>11))&4294967295,ee.g[2]=ee.g[2]+he&4294967295,ee.g[3]=ee.g[3]+pe&4294967295}a.prototype.u=function(ee,Z){Z===void 0&&(Z=ee.length);for(var J=Z-this.blockSize,se=this.B,he=this.h,pe=0;pe<Z;){if(he==0)for(;pe<=J;)l(this,ee,pe),pe+=this.blockSize;if(typeof ee=="string"){for(;pe<Z;)if(se[he++]=ee.charCodeAt(pe++),he==this.blockSize){l(this,se),he=0;break}}else for(;pe<Z;)if(se[he++]=ee[pe++],he==this.blockSize){l(this,se),he=0;break}}this.h=he,this.o+=Z},a.prototype.v=function(){var ee=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ee[0]=128;for(var Z=1;Z<ee.length-8;++Z)ee[Z]=0;var J=8*this.o;for(Z=ee.length-8;Z<ee.length;++Z)ee[Z]=J&255,J/=256;for(this.u(ee),ee=Array(16),Z=J=0;4>Z;++Z)for(var se=0;32>se;se+=8)ee[J++]=this.g[Z]>>>se&255;return ee};function d(ee,Z){var J=E;return Object.prototype.hasOwnProperty.call(J,ee)?J[ee]:J[ee]=Z(ee)}function f(ee,Z){this.h=Z;for(var J=[],se=!0,he=ee.length-1;0<=he;he--){var pe=ee[he]|0;se&&pe==Z||(J[he]=pe,se=!1)}this.g=J}var E={};function v(ee){return-128<=ee&&128>ee?d(ee,function(Z){return new f([Z|0],0>Z?-1:0)}):new f([ee|0],0>ee?-1:0)}function T(ee){if(isNaN(ee)||!isFinite(ee))return A;if(0>ee)return H(T(-ee));for(var Z=[],J=1,se=0;ee>=J;se++)Z[se]=ee/J|0,J*=4294967296;return new f(Z,0)}function w(ee,Z){if(ee.length==0)throw Error("number format error: empty string");if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(ee.charAt(0)=="-")return H(w(ee.substring(1),Z));if(0<=ee.indexOf("-"))throw Error('number format error: interior "-" character');for(var J=T(Math.pow(Z,8)),se=A,he=0;he<ee.length;he+=8){var pe=Math.min(8,ee.length-he),le=parseInt(ee.substring(he,he+pe),Z);8>pe?(pe=T(Math.pow(Z,pe)),se=se.j(pe).add(T(le))):(se=se.j(J),se=se.add(T(le)))}return se}var A=v(0),N=v(1),F=v(16777216);n=f.prototype,n.m=function(){if(z(this))return-H(this).m();for(var ee=0,Z=1,J=0;J<this.g.length;J++){var se=this.i(J);ee+=(0<=se?se:4294967296+se)*Z,Z*=4294967296}return ee},n.toString=function(ee){if(ee=ee||10,2>ee||36<ee)throw Error("radix out of range: "+ee);if(j(this))return"0";if(z(this))return"-"+H(this).toString(ee);for(var Z=T(Math.pow(ee,6)),J=this,se="";;){var he=de(J,Z).g;J=te(J,he.j(Z));var pe=((0<J.g.length?J.g[0]:J.h)>>>0).toString(ee);if(J=he,j(J))return pe+se;for(;6>pe.length;)pe="0"+pe;se=pe+se}},n.i=function(ee){return 0>ee?0:ee<this.g.length?this.g[ee]:this.h};function j(ee){if(ee.h!=0)return!1;for(var Z=0;Z<ee.g.length;Z++)if(ee.g[Z]!=0)return!1;return!0}function z(ee){return ee.h==-1}n.l=function(ee){return ee=te(this,ee),z(ee)?-1:j(ee)?0:1};function H(ee){for(var Z=ee.g.length,J=[],se=0;se<Z;se++)J[se]=~ee.g[se];return new f(J,~ee.h).add(N)}n.abs=function(){return z(this)?H(this):this},n.add=function(ee){for(var Z=Math.max(this.g.length,ee.g.length),J=[],se=0,he=0;he<=Z;he++){var pe=se+(this.i(he)&65535)+(ee.i(he)&65535),le=(pe>>>16)+(this.i(he)>>>16)+(ee.i(he)>>>16);se=le>>>16,pe&=65535,le&=65535,J[he]=le<<16|pe}return new f(J,J[J.length-1]&-2147483648?-1:0)};function te(ee,Z){return ee.add(H(Z))}n.j=function(ee){if(j(this)||j(ee))return A;if(z(this))return z(ee)?H(this).j(H(ee)):H(H(this).j(ee));if(z(ee))return H(this.j(H(ee)));if(0>this.l(F)&&0>ee.l(F))return T(this.m()*ee.m());for(var Z=this.g.length+ee.g.length,J=[],se=0;se<2*Z;se++)J[se]=0;for(se=0;se<this.g.length;se++)for(var he=0;he<ee.g.length;he++){var pe=this.i(se)>>>16,le=this.i(se)&65535,Me=ee.i(he)>>>16,He=ee.i(he)&65535;J[2*se+2*he]+=le*He,K(J,2*se+2*he),J[2*se+2*he+1]+=pe*He,K(J,2*se+2*he+1),J[2*se+2*he+1]+=le*Me,K(J,2*se+2*he+1),J[2*se+2*he+2]+=pe*Me,K(J,2*se+2*he+2)}for(se=0;se<Z;se++)J[se]=J[2*se+1]<<16|J[2*se];for(se=Z;se<2*Z;se++)J[se]=0;return new f(J,0)};function K(ee,Z){for(;(ee[Z]&65535)!=ee[Z];)ee[Z+1]+=ee[Z]>>>16,ee[Z]&=65535,Z++}function ne(ee,Z){this.g=ee,this.h=Z}function de(ee,Z){if(j(Z))throw Error("division by zero");if(j(ee))return new ne(A,A);if(z(ee))return Z=de(H(ee),Z),new ne(H(Z.g),H(Z.h));if(z(Z))return Z=de(ee,H(Z)),new ne(H(Z.g),Z.h);if(30<ee.g.length){if(z(ee)||z(Z))throw Error("slowDivide_ only works with positive integers.");for(var J=N,se=Z;0>=se.l(ee);)J=oe(J),se=oe(se);var he=ge(J,1),pe=ge(se,1);for(se=ge(se,2),J=ge(J,2);!j(se);){var le=pe.add(se);0>=le.l(ee)&&(he=he.add(J),pe=le),se=ge(se,1),J=ge(J,1)}return Z=te(ee,he.j(Z)),new ne(he,Z)}for(he=A;0<=ee.l(Z);){for(J=Math.max(1,Math.floor(ee.m()/Z.m())),se=Math.ceil(Math.log(J)/Math.LN2),se=48>=se?1:Math.pow(2,se-48),pe=T(J),le=pe.j(Z);z(le)||0<le.l(ee);)J-=se,pe=T(J),le=pe.j(Z);j(pe)&&(pe=N),he=he.add(pe),ee=te(ee,le)}return new ne(he,ee)}n.A=function(ee){return de(this,ee).h},n.and=function(ee){for(var Z=Math.max(this.g.length,ee.g.length),J=[],se=0;se<Z;se++)J[se]=this.i(se)&ee.i(se);return new f(J,this.h&ee.h)},n.or=function(ee){for(var Z=Math.max(this.g.length,ee.g.length),J=[],se=0;se<Z;se++)J[se]=this.i(se)|ee.i(se);return new f(J,this.h|ee.h)},n.xor=function(ee){for(var Z=Math.max(this.g.length,ee.g.length),J=[],se=0;se<Z;se++)J[se]=this.i(se)^ee.i(se);return new f(J,this.h^ee.h)};function oe(ee){for(var Z=ee.g.length+1,J=[],se=0;se<Z;se++)J[se]=ee.i(se)<<1|ee.i(se-1)>>>31;return new f(J,ee.h)}function ge(ee,Z){var J=Z>>5;Z%=32;for(var se=ee.g.length-J,he=[],pe=0;pe<se;pe++)he[pe]=0<Z?ee.i(pe+J)>>>Z|ee.i(pe+J+1)<<32-Z:ee.i(pe+J);return new f(he,ee.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Yne=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=T,f.fromString=w,cg=f}).apply(typeof LY<"u"?LY:typeof self<"u"?self:typeof window<"u"?window:{});var hO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Xne,Aw,Jne,HO,qU,Qne,Zne,ere;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(C,B,Q){return C==Array.prototype||C==Object.prototype||(C[B]=Q.value),C};function s(C){C=[typeof globalThis=="object"&&globalThis,C,typeof window=="object"&&window,typeof self=="object"&&self,typeof hO=="object"&&hO];for(var B=0;B<C.length;++B){var Q=C[B];if(Q&&Q.Math==Math)return Q}throw Error("Cannot find global object")}var a=s(this);function l(C,B){if(B)e:{var Q=a;C=C.split(".");for(var fe=0;fe<C.length-1;fe++){var qe=C[fe];if(!(qe in Q))break e;Q=Q[qe]}C=C[C.length-1],fe=Q[C],B=B(fe),B!=fe&&B!=null&&t(Q,C,{configurable:!0,writable:!0,value:B})}}function d(C,B){C instanceof String&&(C+="");var Q=0,fe=!1,qe={next:function(){if(!fe&&Q<C.length){var at=Q++;return{value:B(at,C[at]),done:!1}}return fe=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(C){return C||function(){return d(this,function(B,Q){return Q})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},E=this||self;function v(C){var B=typeof C;return B=B!="object"?B:C?Array.isArray(C)?"array":B:"null",B=="array"||B=="object"&&typeof C.length=="number"}function T(C){var B=typeof C;return B=="object"&&C!=null||B=="function"}function w(C,B,Q){return C.call.apply(C.bind,arguments)}function A(C,B,Q){if(!C)throw Error();if(2<arguments.length){var fe=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,fe),C.apply(B,qe)}}return function(){return C.apply(B,arguments)}}function N(C,B,Q){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:A,N.apply(null,arguments)}function F(C,B){var Q=Array.prototype.slice.call(arguments,1);return function(){var fe=Q.slice();return fe.push.apply(fe,arguments),C.apply(this,fe)}}function j(C,B){function Q(){}Q.prototype=B.prototype,C.aa=B.prototype,C.prototype=new Q,C.prototype.constructor=C,C.Qb=function(fe,qe,at){for(var xt=Array(arguments.length-2),Gr=2;Gr<arguments.length;Gr++)xt[Gr-2]=arguments[Gr];return B.prototype[qe].apply(fe,xt)}}function z(C){const B=C.length;if(0<B){const Q=Array(B);for(let fe=0;fe<B;fe++)Q[fe]=C[fe];return Q}return[]}function H(C,B){for(let Q=1;Q<arguments.length;Q++){const fe=arguments[Q];if(v(fe)){const qe=C.length||0,at=fe.length||0;C.length=qe+at;for(let xt=0;xt<at;xt++)C[qe+xt]=fe[xt]}else C.push(fe)}}class te{constructor(B,Q){this.i=B,this.j=Q,this.h=0,this.g=null}get(){let B;return 0<this.h?(this.h--,B=this.g,this.g=B.next,B.next=null):B=this.i(),B}}function K(C){return/^[\s\xa0]*$/.test(C)}function ne(){var C=E.navigator;return C&&(C=C.userAgent)?C:""}function de(C){return de[" "](C),C}de[" "]=function(){};var oe=ne().indexOf("Gecko")!=-1&&!(ne().toLowerCase().indexOf("webkit")!=-1&&ne().indexOf("Edge")==-1)&&!(ne().indexOf("Trident")!=-1||ne().indexOf("MSIE")!=-1)&&ne().indexOf("Edge")==-1;function ge(C,B,Q){for(const fe in C)B.call(Q,C[fe],fe,C)}function ee(C,B){for(const Q in C)B.call(void 0,C[Q],Q,C)}function Z(C){const B={};for(const Q in C)B[Q]=C[Q];return B}const J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(C,B){let Q,fe;for(let qe=1;qe<arguments.length;qe++){fe=arguments[qe];for(Q in fe)C[Q]=fe[Q];for(let at=0;at<J.length;at++)Q=J[at],Object.prototype.hasOwnProperty.call(fe,Q)&&(C[Q]=fe[Q])}}function he(C){var B=1;C=C.split(":");const Q=[];for(;0<B&&C.length;)Q.push(C.shift()),B--;return C.length&&Q.push(C.join(":")),Q}function pe(C){E.setTimeout(()=>{throw C},0)}function le(){var C=ve;let B=null;return C.g&&(B=C.g,C.g=C.g.next,C.g||(C.h=null),B.next=null),B}class Me{constructor(){this.h=this.g=null}add(B,Q){const fe=He.get();fe.set(B,Q),this.h?this.h.next=fe:this.g=fe,this.h=fe}}var He=new te(()=>new rt,C=>C.reset());class rt{constructor(){this.next=this.g=this.h=null}set(B,Q){this.h=B,this.g=Q,this.next=null}reset(){this.next=this.g=this.h=null}}let we,Ce=!1,ve=new Me,Ne=()=>{const C=E.Promise.resolve(void 0);we=()=>{C.then(be)}};var be=()=>{for(var C;C=le();){try{C.h.call(C.g)}catch(Q){pe(Q)}var B=He;B.j(C),100>B.h&&(B.h++,C.next=B.g,B.g=C)}Ce=!1};function Te(){this.s=this.s,this.C=this.C}Te.prototype.s=!1,Te.prototype.ma=function(){this.s||(this.s=!0,this.N())},Te.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(C,B){this.type=C,this.g=this.target=B,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var C=!1,B=Object.defineProperty({},"passive",{get:function(){C=!0}});try{const Q=()=>{};E.addEventListener("test",Q,B),E.removeEventListener("test",Q,B)}catch{}return C}();function ze(C,B){if(Ae.call(this,C?C.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,C){var Q=this.type=C.type,fe=C.changedTouches&&C.changedTouches.length?C.changedTouches[0]:null;if(this.target=C.target||C.srcElement,this.g=B,B=C.relatedTarget){if(oe){e:{try{de(B.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(B=null)}}else Q=="mouseover"?B=C.fromElement:Q=="mouseout"&&(B=C.toElement);this.relatedTarget=B,fe?(this.clientX=fe.clientX!==void 0?fe.clientX:fe.pageX,this.clientY=fe.clientY!==void 0?fe.clientY:fe.pageY,this.screenX=fe.screenX||0,this.screenY=fe.screenY||0):(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0),this.button=C.button,this.key=C.key||"",this.ctrlKey=C.ctrlKey,this.altKey=C.altKey,this.shiftKey=C.shiftKey,this.metaKey=C.metaKey,this.pointerId=C.pointerId||0,this.pointerType=typeof C.pointerType=="string"?C.pointerType:et[C.pointerType]||"",this.state=C.state,this.i=C,C.defaultPrevented&&ze.aa.h.call(this)}}j(ze,Ae);var et={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var C=this.i;C.preventDefault?C.preventDefault():C.returnValue=!1};var nt="closure_listenable_"+(1e6*Math.random()|0),dt=0;function Xe(C,B,Q,fe,qe){this.listener=C,this.proxy=null,this.src=B,this.type=Q,this.capture=!!fe,this.ha=qe,this.key=++dt,this.da=this.fa=!1}function Ct(C){C.da=!0,C.listener=null,C.proxy=null,C.src=null,C.ha=null}function hn(C){this.src=C,this.g={},this.h=0}hn.prototype.add=function(C,B,Q,fe,qe){var at=C.toString();C=this.g[at],C||(C=this.g[at]=[],this.h++);var xt=ln(C,B,fe,qe);return-1<xt?(B=C[xt],Q||(B.fa=!1)):(B=new Xe(B,this.src,at,!!fe,qe),B.fa=Q,C.push(B)),B};function Ut(C,B){var Q=B.type;if(Q in C.g){var fe=C.g[Q],qe=Array.prototype.indexOf.call(fe,B,void 0),at;(at=0<=qe)&&Array.prototype.splice.call(fe,qe,1),at&&(Ct(B),C.g[Q].length==0&&(delete C.g[Q],C.h--))}}function ln(C,B,Q,fe){for(var qe=0;qe<C.length;++qe){var at=C[qe];if(!at.da&&at.listener==B&&at.capture==!!Q&&at.ha==fe)return qe}return-1}var xn="closure_lm_"+(1e6*Math.random()|0),Yt={};function Yn(C,B,Q,fe,qe){if(Array.isArray(B)){for(var at=0;at<B.length;at++)Yn(C,B[at],Q,fe,qe);return null}return Q=Xt(Q),C&&C[nt]?C.K(B,Q,T(fe)?!!fe.capture:!1,qe):Kt(C,B,Q,!1,fe,qe)}function Kt(C,B,Q,fe,qe,at){if(!B)throw Error("Invalid event type");var xt=T(qe)?!!qe.capture:!!qe,Gr=Ge(C);if(Gr||(C[xn]=Gr=new hn(C)),Q=Gr.add(B,Q,fe,xt,at),Q.proxy)return Q;if(fe=Re(),Q.proxy=fe,fe.src=C,fe.listener=Q,C.addEventListener)Ue||(qe=xt),qe===void 0&&(qe=!1),C.addEventListener(B.toString(),fe,qe);else if(C.attachEvent)C.attachEvent(_t(B.toString()),fe);else if(C.addListener&&C.removeListener)C.addListener(fe);else throw Error("addEventListener and attachEvent are unavailable.");return Q}function Re(){function C(Q){return B.call(C.src,C.listener,Q)}const B=vt;return C}function Fe(C,B,Q,fe,qe){if(Array.isArray(B))for(var at=0;at<B.length;at++)Fe(C,B[at],Q,fe,qe);else fe=T(fe)?!!fe.capture:!!fe,Q=Xt(Q),C&&C[nt]?(C=C.i,B=String(B).toString(),B in C.g&&(at=C.g[B],Q=ln(at,Q,fe,qe),-1<Q&&(Ct(at[Q]),Array.prototype.splice.call(at,Q,1),at.length==0&&(delete C.g[B],C.h--)))):C&&(C=Ge(C))&&(B=C.g[B.toString()],C=-1,B&&(C=ln(B,Q,fe,qe)),(Q=-1<C?B[C]:null)&&Ke(Q))}function Ke(C){if(typeof C!="number"&&C&&!C.da){var B=C.src;if(B&&B[nt])Ut(B.i,C);else{var Q=C.type,fe=C.proxy;B.removeEventListener?B.removeEventListener(Q,fe,C.capture):B.detachEvent?B.detachEvent(_t(Q),fe):B.addListener&&B.removeListener&&B.removeListener(fe),(Q=Ge(B))?(Ut(Q,C),Q.h==0&&(Q.src=null,B[xn]=null)):Ct(C)}}}function _t(C){return C in Yt?Yt[C]:Yt[C]="on"+C}function vt(C,B){if(C.da)C=!0;else{B=new ze(B,this);var Q=C.listener,fe=C.ha||C.src;C.fa&&Ke(C),C=Q.call(fe,B)}return C}function Ge(C){return C=C[xn],C instanceof hn?C:null}var Ot="__closure_events_fn_"+(1e9*Math.random()>>>0);function Xt(C){return typeof C=="function"?C:(C[Ot]||(C[Ot]=function(B){return C.handleEvent(B)}),C[Ot])}function pn(){Te.call(this),this.i=new hn(this),this.M=this,this.F=null}j(pn,Te),pn.prototype[nt]=!0,pn.prototype.removeEventListener=function(C,B,Q,fe){Fe(this,C,B,Q,fe)};function an(C,B){var Q,fe=C.F;if(fe)for(Q=[];fe;fe=fe.F)Q.push(fe);if(C=C.M,fe=B.type||B,typeof B=="string")B=new Ae(B,C);else if(B instanceof Ae)B.target=B.target||C;else{var qe=B;B=new Ae(fe,C),se(B,qe)}if(qe=!0,Q)for(var at=Q.length-1;0<=at;at--){var xt=B.g=Q[at];qe=ir(xt,fe,!0,B)&&qe}if(xt=B.g=C,qe=ir(xt,fe,!0,B)&&qe,qe=ir(xt,fe,!1,B)&&qe,Q)for(at=0;at<Q.length;at++)xt=B.g=Q[at],qe=ir(xt,fe,!1,B)&&qe}pn.prototype.N=function(){if(pn.aa.N.call(this),this.i){var C=this.i,B;for(B in C.g){for(var Q=C.g[B],fe=0;fe<Q.length;fe++)Ct(Q[fe]);delete C.g[B],C.h--}}this.F=null},pn.prototype.K=function(C,B,Q,fe){return this.i.add(String(C),B,!1,Q,fe)},pn.prototype.L=function(C,B,Q,fe){return this.i.add(String(C),B,!0,Q,fe)};function ir(C,B,Q,fe){if(B=C.i.g[String(B)],!B)return!0;B=B.concat();for(var qe=!0,at=0;at<B.length;++at){var xt=B[at];if(xt&&!xt.da&&xt.capture==Q){var Gr=xt.listener,ii=xt.ha||xt.src;xt.fa&&Ut(C.i,xt),qe=Gr.call(ii,fe)!==!1&&qe}}return qe&&!fe.defaultPrevented}function na(C,B,Q){if(typeof C=="function")Q&&(C=N(C,Q));else if(C&&typeof C.handleEvent=="function")C=N(C.handleEvent,C);else throw Error("Invalid listener argument");return 2147483647<Number(B)?-1:E.setTimeout(C,B||0)}function Vt(C){C.g=na(()=>{C.g=null,C.i&&(C.i=!1,Vt(C))},C.l);const B=C.h;C.h=null,C.m.apply(null,B)}class sn extends Te{constructor(B,Q){super(),this.m=B,this.l=Q,this.h=null,this.i=!1,this.g=null}j(B){this.h=arguments,this.g?this.i=!0:Vt(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ii(C){Te.call(this),this.h=C,this.g={}}j(Ii,Te);var di=[];function yi(C){ge(C.g,function(B,Q){this.g.hasOwnProperty(Q)&&Ke(B)},C),C.g={}}Ii.prototype.N=function(){Ii.aa.N.call(this),yi(this)},Ii.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var dr=E.JSON.stringify,Ua=E.JSON.parse,Zc=class{stringify(C){return E.JSON.stringify(C,void 0)}parse(C){return E.JSON.parse(C,void 0)}};function co(){}co.prototype.h=null;function lo(C){return C.h||(C.h=C.i())}function xl(){}var Us={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ac(){Ae.call(this,"d")}j(ac,Ae);function ra(){Ae.call(this,"c")}j(ra,Ae);var cc={},el=null;function Nu(){return el=el||new pn}cc.La="serverreachability";function lc(C){Ae.call(this,cc.La,C)}j(lc,Ae);function tl(C){const B=Nu();an(B,new lc(B))}cc.STAT_EVENT="statevent";function Co(C,B){Ae.call(this,cc.STAT_EVENT,C),this.stat=B}j(Co,Ae);function Ni(C){const B=Nu();an(B,new Co(B,C))}cc.Ma="timingevent";function ls(C,B){Ae.call(this,cc.Ma,C),this.size=B}j(ls,Ae);function Va(C,B){if(typeof C!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){C()},B)}function Du(){this.g=!0}Du.prototype.xa=function(){this.g=!1};function uc(C,B,Q,fe,qe,at){C.info(function(){if(C.g)if(at)for(var xt="",Gr=at.split("&"),ii=0;ii<Gr.length;ii++){var Er=Gr[ii].split("=");if(1<Er.length){var Fs=Er[0];Er=Er[1];var ds=Fs.split("_");xt=2<=ds.length&&ds[1]=="type"?xt+(Fs+"="+Er+"&"):xt+(Fs+"=redacted&")}}else xt=null;else xt=at;return"XMLHTTP REQ ("+fe+") [attempt "+qe+"]: "+B+`
`+Q+`
`+xt})}function ia(C,B,Q,fe,qe,at,xt){C.info(function(){return"XMLHTTP RESP ("+fe+") [ attempt "+qe+"]: "+B+`
`+Q+`
`+at+" "+xt})}function sa(C,B,Q,fe){C.info(function(){return"XMLHTTP TEXT ("+B+"): "+Og(C,Q)+(fe?" "+fe:"")})}function Dd(C,B){C.info(function(){return"TIMEOUT: "+B})}Du.prototype.info=function(){};function Og(C,B){if(!C.g)return B;if(!B)return null;try{var Q=JSON.parse(B);if(Q){for(C=0;C<Q.length;C++)if(Array.isArray(Q[C])){var fe=Q[C];if(!(2>fe.length)){var qe=fe[1];if(Array.isArray(qe)&&!(1>qe.length)){var at=qe[0];if(at!="noop"&&at!="stop"&&at!="close")for(var xt=1;xt<qe.length;xt++)qe[xt]=""}}}}return dr(Q)}catch{return B}}var Lu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ip={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Vs;function xu(){}j(xu,co),xu.prototype.g=function(){return new XMLHttpRequest},xu.prototype.i=function(){return{}},Vs=new xu;function oa(C,B,Q,fe){this.j=C,this.i=B,this.l=Q,this.R=fe||1,this.U=new Ii(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ld}function Ld(){this.i=null,this.g="",this.h=!1}var xd={},Fa={};function Md(C,B,Q){C.L=1,C.v=Ba(Ao(B)),C.m=Q,C.P=!0,Mu(C,null)}function Mu(C,B){C.F=Date.now(),Fr(C),C.A=Ao(C.v);var Q=C.A,fe=C.R;Array.isArray(fe)||(fe=[String(fe)]),Bl(Q.i,"t",fe),C.C=0,Q=C.j.J,C.h=new Ld,C.g=jE(C.j,Q?B:null,!C.m),0<C.O&&(C.M=new sn(N(C.Y,C,C.g),C.O)),B=C.U,Q=C.g,fe=C.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(di[0]=qe.toString()),qe=di);for(var at=0;at<qe.length;at++){var xt=Yn(Q,qe[at],fe||B.handleEvent,!1,B.h||B);if(!xt)break;B.g[xt.key]=xt}B=C.H?Z(C.H):{},C.m?(C.u||(C.u="POST"),B["Content-Type"]="application/x-www-form-urlencoded",C.g.ea(C.A,C.u,C.m,B)):(C.u="GET",C.g.ea(C.A,C.u,null,B)),tl(),uc(C.i,C.u,C.A,C.l,C.R,C.m)}oa.prototype.ca=function(C){C=C.target;const B=this.M;B&&pi(C)==3?B.j():this.Y(C)},oa.prototype.Y=function(C){try{if(C==this.g)e:{const ds=pi(this.g);var B=this.g.Ba();const Wa=this.g.Z();if(!(3>ds)&&(ds!=3||this.g&&(this.h.h||this.g.oa()||Is(this.g)))){this.J||ds!=4||B==7||(B==8||0>=Wa?tl(3):tl(2)),dc(this);var Q=this.g.Z();this.X=Q;t:if(Io(this)){var fe=Is(this.g);C="";var qe=fe.length,at=pi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){aa(this),nl(this);var xt="";break t}this.h.i=new E.TextDecoder}for(B=0;B<qe;B++)this.h.h=!0,C+=this.h.i.decode(fe[B],{stream:!(at&&B==qe-1)});fe.length=0,this.h.g+=C,this.C=0,xt=this.h.g}else xt=this.g.oa();if(this.o=Q==200,ia(this.i,this.u,this.A,this.l,this.R,ds,Q),this.o){if(this.T&&!this.K){t:{if(this.g){var Gr,ii=this.g;if((Gr=ii.g?ii.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(Gr)){var Er=Gr;break t}}Er=null}if(Q=Er)sa(this.i,this.l,Q,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,sp(this,Q);else{this.o=!1,this.s=3,Ni(12),aa(this),nl(this);break e}}if(this.P){Q=!0;let Vo;for(;!this.J&&this.C<xt.length;)if(Vo=Ud(this,xt),Vo==Fa){ds==4&&(this.s=4,Ni(14),Q=!1),sa(this.i,this.l,null,"[Incomplete Response]");break}else if(Vo==xd){this.s=4,Ni(15),sa(this.i,this.l,xt,"[Invalid Chunk]"),Q=!1;break}else sa(this.i,this.l,Vo,null),sp(this,Vo);if(Io(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ds!=4||xt.length!=0||this.h.h||(this.s=1,Ni(16),Q=!1),this.o=this.o&&Q,!Q)sa(this.i,this.l,xt,"[Invalid Chunked Response]"),aa(this),nl(this);else if(0<xt.length&&!this.W){this.W=!0;var Fs=this.j;Fs.g==this&&Fs.ba&&!Fs.M&&(Fs.j.info("Great, no buffering proxy detected. Bytes received: "+xt.length),Ng(Fs),Fs.M=!0,Ni(11))}}else sa(this.i,this.l,xt,null),sp(this,xt);ds==4&&aa(this),this.o&&!this.J&&(ds==4?zf(this.j,this):(this.o=!1,Fr(this)))}else Lo(this.g),Q==400&&0<xt.indexOf("Unknown SID")?(this.s=3,Ni(12)):(this.s=0,Ni(13)),aa(this),nl(this)}}}catch{}finally{}};function Io(C){return C.g?C.u=="GET"&&C.L!=2&&C.j.Ca:!1}function Ud(C,B){var Q=C.C,fe=B.indexOf(`
`,Q);return fe==-1?Fa:(Q=Number(B.substring(Q,fe)),isNaN(Q)?xd:(fe+=1,fe+Q>B.length?Fa:(B=B.slice(fe,fe+Q),C.C=fe+Q,B)))}oa.prototype.cancel=function(){this.J=!0,aa(this)};function Fr(C){C.S=Date.now()+C.I,hi(C,C.I)}function hi(C,B){if(C.B!=null)throw Error("WatchDog timer not null");C.B=Va(N(C.ba,C),B)}function dc(C){C.B&&(E.clearTimeout(C.B),C.B=null)}oa.prototype.ba=function(){this.B=null;const C=Date.now();0<=C-this.S?(Dd(this.i,this.A),this.L!=2&&(tl(),Ni(17)),aa(this),this.s=2,nl(this)):hi(this,this.S-C)};function nl(C){C.j.G==0||C.J||zf(C.j,C)}function aa(C){dc(C);var B=C.M;B&&typeof B.ma=="function"&&B.ma(),C.M=null,yi(C.U),C.g&&(B=C.g,C.g=null,B.abort(),B.ma())}function sp(C,B){try{var Q=C.j;if(Q.G!=0&&(Q.g==C||Ks(Q.h,C))){if(!C.K&&Ks(Q.h,C)&&Q.G==3){try{var fe=Q.Da.g.parse(B)}catch{fe=null}if(Array.isArray(fe)&&fe.length==3){var qe=fe;if(qe[0]==0){e:if(!Q.u){if(Q.g)if(Q.g.F+3e3<C.F)Wf(Q),al(Q);else break e;Bf(Q),Ni(18)}}else Q.za=qe[1],0<Q.za-Q.T&&37500>qe[2]&&Q.F&&Q.v==0&&!Q.C&&(Q.C=Va(N(Q.Za,Q),6e3));if(1>=xf(Q.h)&&Q.ca){try{Q.ca()}catch{}Q.ca=void 0}}else zu(Q,11)}else if((C.K||Q.g==C)&&Wf(Q),!K(B))for(qe=Q.Da.g.parse(B),B=0;B<qe.length;B++){let Er=qe[B];if(Q.T=Er[0],Er=Er[1],Q.G==2)if(Er[0]=="c"){Q.K=Er[1],Q.ia=Er[2];const Fs=Er[3];Fs!=null&&(Q.la=Fs,Q.j.info("VER="+Q.la));const ds=Er[4];ds!=null&&(Q.Aa=ds,Q.j.info("SVER="+Q.Aa));const Wa=Er[5];Wa!=null&&typeof Wa=="number"&&0<Wa&&(fe=1.5*Wa,Q.L=fe,Q.j.info("backChannelRequestTimeoutMs_="+fe)),fe=Q;const Vo=C.g;if(Vo){const up=Vo.g?Vo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(up){var at=fe.h;at.g||up.indexOf("spdy")==-1&&up.indexOf("quic")==-1&&up.indexOf("h2")==-1||(at.j=at.l,at.g=new Set,at.h&&(op(at,at.h),at.h=null))}if(fe.D){const Hf=Vo.g?Vo.g.getResponseHeader("X-HTTP-Session-Id"):null;Hf&&(fe.ya=Hf,zr(fe.I,fe.D,Hf))}}Q.G=3,Q.l&&Q.l.ua(),Q.ba&&(Q.R=Date.now()-C.F,Q.j.info("Handshake RTT: "+Q.R+"ms")),fe=Q;var xt=C;if(fe.qa=Dg(fe,fe.J?fe.ia:null,fe.W),xt.K){rl(fe.h,xt);var Gr=xt,ii=fe.L;ii&&(Gr.I=ii),Gr.B&&(dc(Gr),Fr(Gr)),fe.g=xt}else zl(fe);0<Q.i.length&&fc(Q)}else Er[0]!="stop"&&Er[0]!="close"||zu(Q,7);else Q.G==3&&(Er[0]=="stop"||Er[0]=="close"?Er[0]=="stop"?zu(Q,7):Ki(Q):Er[0]!="noop"&&Q.l&&Q.l.ta(Er),Q.v=0)}}tl(4)}catch{}}var Vd=class{constructor(C,B){this.g=C,this.map=B}};function Ml(C){this.l=C||10,E.PerformanceNavigationTiming?(C=E.performance.getEntriesByType("navigation"),C=0<C.length&&(C[0].nextHopProtocol=="hq"||C[0].nextHopProtocol=="h2")):C=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=C?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function uo(C){return C.h?!0:C.g?C.g.size>=C.j:!1}function xf(C){return C.h?1:C.g?C.g.size:0}function Ks(C,B){return C.h?C.h==B:C.g?C.g.has(B):!1}function op(C,B){C.g?C.g.add(B):C.h=B}function rl(C,B){C.h&&C.h==B?C.h=null:C.g&&C.g.has(B)&&C.g.delete(B)}Ml.prototype.cancel=function(){if(this.i=Fd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const C of this.g.values())C.cancel();this.g.clear()}};function Fd(C){if(C.h!=null)return C.i.concat(C.h.D);if(C.g!=null&&C.g.size!==0){let B=C.i;for(const Q of C.g.values())B=B.concat(Q.D);return B}return z(C.i)}function jd(C){if(C.V&&typeof C.V=="function")return C.V();if(typeof Map<"u"&&C instanceof Map||typeof Set<"u"&&C instanceof Set)return Array.from(C.values());if(typeof C=="string")return C.split("");if(v(C)){for(var B=[],Q=C.length,fe=0;fe<Q;fe++)B.push(C[fe]);return B}B=[],Q=0;for(fe in C)B[Q++]=C[fe];return B}function hr(C){if(C.na&&typeof C.na=="function")return C.na();if(!C.V||typeof C.V!="function"){if(typeof Map<"u"&&C instanceof Map)return Array.from(C.keys());if(!(typeof Set<"u"&&C instanceof Set)){if(v(C)||typeof C=="string"){var B=[];C=C.length;for(var Q=0;Q<C;Q++)B.push(Q);return B}B=[],Q=0;for(const fe in C)B[Q++]=fe;return B}}}function Ul(C,B){if(C.forEach&&typeof C.forEach=="function")C.forEach(B,void 0);else if(v(C)||typeof C=="string")Array.prototype.forEach.call(C,B,void 0);else for(var Q=hr(C),fe=jd(C),qe=fe.length,at=0;at<qe;at++)B.call(void 0,fe[at],Q&&Q[at],C)}var Vl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Uu(C,B){if(C){C=C.split("&");for(var Q=0;Q<C.length;Q++){var fe=C[Q].indexOf("="),qe=null;if(0<=fe){var at=C[Q].substring(0,fe);qe=C[Q].substring(fe+1)}else at=C[Q];B(at,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function ja(C){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,C instanceof ja){this.h=C.h,Vu(this,C.j),this.o=C.o,this.g=C.g,il(this,C.s),this.l=C.l;var B=C.i,Q=new Po;Q.i=B.i,B.g&&(Q.g=new Map(B.g),Q.h=B.h),Fl(this,Q),this.m=C.m}else C&&(B=String(C).match(Vl))?(this.h=!1,Vu(this,B[1]||"",!0),this.o=nr(B[2]||""),this.g=nr(B[3]||"",!0),il(this,B[4]),this.l=nr(B[5]||"",!0),Fl(this,B[6]||"",!0),this.m=nr(B[7]||"")):(this.h=!1,this.i=new Po(null,this.h))}ja.prototype.toString=function(){var C=[],B=this.j;B&&C.push(hc(B,jl,!0),":");var Q=this.g;return(Q||B=="file")&&(C.push("//"),(B=this.o)&&C.push(hc(B,jl,!0),"@"),C.push(encodeURIComponent(String(Q)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),Q=this.s,Q!=null&&C.push(":",String(Q))),(Q=this.l)&&(this.g&&Q.charAt(0)!="/"&&C.push("/"),C.push(hc(Q,Q.charAt(0)=="/"?ap:Bd,!0))),(Q=this.i.toString())&&C.push("?",Q),(Q=this.m)&&C.push("#",hc(Q,cp)),C.join("")};function Ao(C){return new ja(C)}function Vu(C,B,Q){C.j=Q?nr(B,!0):B,C.j&&(C.j=C.j.replace(/:$/,""))}function il(C,B){if(B){if(B=Number(B),isNaN(B)||0>B)throw Error("Bad port number "+B);C.s=B}else C.s=null}function Fl(C,B,Q){B instanceof Po?(C.i=B,Do(C.i,C.h)):(Q||(B=hc(B,Uf)),C.i=new Po(B,C.h))}function zr(C,B,Q){C.i.set(B,Q)}function Ba(C){return zr(C,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),C}function nr(C,B){return C?B?decodeURI(C.replace(/%25/g,"%2525")):decodeURIComponent(C):""}function hc(C,B,Q){return typeof C=="string"?(C=encodeURI(C).replace(B,Mf),Q&&(C=C.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C):null}function Mf(C){return C=C.charCodeAt(0),"%"+(C>>4&15).toString(16)+(C&15).toString(16)}var jl=/[#\/\?@]/g,Bd=/[#\?:]/g,ap=/[#\?]/g,Uf=/[#\?@]/g,cp=/#/g;function Po(C,B){this.h=this.g=null,this.i=C||null,this.j=!!B}function ns(C){C.g||(C.g=new Map,C.h=0,C.i&&Uu(C.i,function(B,Q){C.add(decodeURIComponent(B.replace(/\+/g," ")),Q)}))}n=Po.prototype,n.add=function(C,B){ns(this),this.i=null,C=No(this,C);var Q=this.g.get(C);return Q||this.g.set(C,Q=[]),Q.push(B),this.h+=1,this};function Oo(C,B){ns(C),B=No(C,B),C.g.has(B)&&(C.i=null,C.h-=C.g.get(B).length,C.g.delete(B))}function ko(C,B){return ns(C),B=No(C,B),C.g.has(B)}n.forEach=function(C,B){ns(this),this.g.forEach(function(Q,fe){Q.forEach(function(qe){C.call(B,qe,fe,this)},this)},this)},n.na=function(){ns(this);const C=Array.from(this.g.values()),B=Array.from(this.g.keys()),Q=[];for(let fe=0;fe<B.length;fe++){const qe=C[fe];for(let at=0;at<qe.length;at++)Q.push(B[fe])}return Q},n.V=function(C){ns(this);let B=[];if(typeof C=="string")ko(this,C)&&(B=B.concat(this.g.get(No(this,C))));else{C=Array.from(this.g.values());for(let Q=0;Q<C.length;Q++)B=B.concat(C[Q])}return B},n.set=function(C,B){return ns(this),this.i=null,C=No(this,C),ko(this,C)&&(this.h-=this.g.get(C).length),this.g.set(C,[B]),this.h+=1,this},n.get=function(C,B){return C?(C=this.V(C),0<C.length?String(C[0]):B):B};function Bl(C,B,Q){Oo(C,B),0<Q.length&&(C.i=null,C.g.set(No(C,B),z(Q)),C.h+=Q.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const C=[],B=Array.from(this.g.keys());for(var Q=0;Q<B.length;Q++){var fe=B[Q];const at=encodeURIComponent(String(fe)),xt=this.V(fe);for(fe=0;fe<xt.length;fe++){var qe=at;xt[fe]!==""&&(qe+="="+encodeURIComponent(String(xt[fe]))),C.push(qe)}}return this.i=C.join("&")};function No(C,B){return B=String(B),C.j&&(B=B.toLowerCase()),B}function Do(C,B){B&&!C.j&&(ns(C),C.i=null,C.g.forEach(function(Q,fe){var qe=fe.toLowerCase();fe!=qe&&(Oo(this,fe),Bl(this,qe,Q))},C)),C.j=B}function Vf(C,B){const Q=new Du;if(E.Image){const fe=new Image;fe.onload=F(us,Q,"TestLoadImage: loaded",!0,B,fe),fe.onerror=F(us,Q,"TestLoadImage: error",!1,B,fe),fe.onabort=F(us,Q,"TestLoadImage: abort",!1,B,fe),fe.ontimeout=F(us,Q,"TestLoadImage: timeout",!1,B,fe),E.setTimeout(function(){fe.ontimeout&&fe.ontimeout()},1e4),fe.src=C}else B(!1)}function pc(C,B){const Q=new Du,fe=new AbortController,qe=setTimeout(()=>{fe.abort(),us(Q,"TestPingServer: timeout",!1,B)},1e4);fetch(C,{signal:fe.signal}).then(at=>{clearTimeout(qe),at.ok?us(Q,"TestPingServer: ok",!0,B):us(Q,"TestPingServer: server error",!1,B)}).catch(()=>{clearTimeout(qe),us(Q,"TestPingServer: error",!1,B)})}function us(C,B,Q,fe,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),fe(Q)}catch{}}function Fu(){this.g=new Zc}function lp(C,B,Q){const fe=Q||"";try{Ul(C,function(qe,at){let xt=qe;T(qe)&&(xt=dr(qe)),B.push(fe+at+"="+encodeURIComponent(xt))})}catch(qe){throw B.push(fe+"type="+encodeURIComponent("_badmap")),qe}}function sl(C){this.l=C.Ub||null,this.j=C.eb||!1}j(sl,co),sl.prototype.g=function(){return new Wl(this.l,this.j)},sl.prototype.i=function(C){return function(){return C}}({});function Wl(C,B){pn.call(this),this.D=C,this.o=B,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j(Wl,pn),n=Wl.prototype,n.open=function(C,B){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=C,this.A=B,this.readyState=1,la(this)},n.send=function(C){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const B={headers:this.u,method:this.B,credentials:this.m,cache:void 0};C&&(B.body=C),(this.D||E).fetch(new Request(this.A,B)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ca(this)),this.readyState=0},n.Sa=function(C){if(this.g&&(this.l=C,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=C.headers,this.readyState=2,la(this)),this.g&&(this.readyState=3,la(this),this.g)))if(this.responseType==="arraybuffer")C.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in C){if(this.j=C.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ff(this)}else C.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ff(C){C.j.read().then(C.Pa.bind(C)).catch(C.ga.bind(C))}n.Pa=function(C){if(this.g){if(this.o&&C.value)this.response.push(C.value);else if(!this.o){var B=C.value?C.value:new Uint8Array(0);(B=this.v.decode(B,{stream:!C.done}))&&(this.response=this.responseText+=B)}C.done?ca(this):la(this),this.readyState==3&&Ff(this)}},n.Ra=function(C){this.g&&(this.response=this.responseText=C,ca(this))},n.Qa=function(C){this.g&&(this.response=C,ca(this))},n.ga=function(){this.g&&ca(this)};function ca(C){C.readyState=4,C.l=null,C.j=null,C.v=null,la(C)}n.setRequestHeader=function(C,B){this.u.append(C,B)},n.getResponseHeader=function(C){return this.h&&this.h.get(C.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const C=[],B=this.h.entries();for(var Q=B.next();!Q.done;)Q=Q.value,C.push(Q[0]+": "+Q[1]),Q=B.next();return C.join(`\r
`)};function la(C){C.onreadystatechange&&C.onreadystatechange.call(C)}Object.defineProperty(Wl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(C){this.m=C?"include":"same-origin"}});function ol(C){let B="";return ge(C,function(Q,fe){B+=fe,B+=":",B+=Q,B+=`\r
`}),B}function Se(C,B,Q){e:{for(fe in Q){var fe=!1;break e}fe=!0}fe||(Q=ol(Q),typeof C=="string"?Q!=null&&encodeURIComponent(String(Q)):zr(C,B,Q))}function De(C){pn.call(this),this.headers=new Map,this.o=C||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(De,pn);var tt=/^https?$/i,$t=["POST","PUT"];n=De.prototype,n.Ha=function(C){this.J=C},n.ea=function(C,B,Q,fe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+C);B=B?B.toUpperCase():"GET",this.D=C,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Vs.g(),this.v=this.o?lo(this.o):lo(Vs),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(B,String(C),!0),this.B=!1}catch(at){Hn(this,at);return}if(C=Q||"",Q=new Map(this.headers),fe)if(Object.getPrototypeOf(fe)===Object.prototype)for(var qe in fe)Q.set(qe,fe[qe]);else if(typeof fe.keys=="function"&&typeof fe.get=="function")for(const at of fe.keys())Q.set(at,fe.get(at));else throw Error("Unknown input type for opt_headers: "+String(fe));fe=Array.from(Q.keys()).find(at=>at.toLowerCase()=="content-type"),qe=E.FormData&&C instanceof E.FormData,!(0<=Array.prototype.indexOf.call($t,B,void 0))||fe||qe||Q.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[at,xt]of Q)this.g.setRequestHeader(at,xt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Nr(this),this.u=!0,this.g.send(C),this.u=!1}catch(at){Hn(this,at)}};function Hn(C,B){C.h=!1,C.g&&(C.j=!0,C.g.abort(),C.j=!1),C.l=B,C.m=5,_r(C),cn(C)}function _r(C){C.A||(C.A=!0,an(C,"complete"),an(C,"error"))}n.abort=function(C){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=C||7,an(this,"complete"),an(this,"abort"),cn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),cn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?jr(this):this.bb())},n.bb=function(){jr(this)};function jr(C){if(C.h&&typeof f<"u"&&(!C.v[1]||pi(C)!=4||C.Z()!=2)){if(C.u&&pi(C)==4)na(C.Ea,0,C);else if(an(C,"readystatechange"),pi(C)==4){C.h=!1;try{const xt=C.Z();e:switch(xt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var B=!0;break e;default:B=!1}var Q;if(!(Q=B)){var fe;if(fe=xt===0){var qe=String(C.D).match(Vl)[1]||null;!qe&&E.self&&E.self.location&&(qe=E.self.location.protocol.slice(0,-1)),fe=!tt.test(qe?qe.toLowerCase():"")}Q=fe}if(Q)an(C,"complete"),an(C,"success");else{C.m=6;try{var at=2<pi(C)?C.g.statusText:""}catch{at=""}C.l=at+" ["+C.Z()+"]",_r(C)}}finally{cn(C)}}}}function cn(C,B){if(C.g){Nr(C);const Q=C.g,fe=C.v[0]?()=>{}:null;C.g=null,C.v=null,B||an(C,"ready");try{Q.onreadystatechange=fe}catch{}}}function Nr(C){C.I&&(E.clearTimeout(C.I),C.I=null)}n.isActive=function(){return!!this.g};function pi(C){return C.g?C.g.readyState:0}n.Z=function(){try{return 2<pi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(C){if(this.g){var B=this.g.responseText;return C&&B.indexOf(C)==0&&(B=B.substring(C.length)),Ua(B)}};function Is(C){try{if(!C.g)return null;if("response"in C.g)return C.g.response;switch(C.H){case"":case"text":return C.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in C.g)return C.g.mozResponseArrayBuffer}return null}catch{return null}}function Lo(C){const B={};C=(C.g&&2<=pi(C)&&C.g.getAllResponseHeaders()||"").split(`\r
`);for(let fe=0;fe<C.length;fe++){if(K(C[fe]))continue;var Q=he(C[fe]);const qe=Q[0];if(Q=Q[1],typeof Q!="string")continue;Q=Q.trim();const at=B[qe]||[];B[qe]=at,at.push(Q)}ee(B,function(fe){return fe.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function xo(C,B,Q){return Q&&Q.internalChannelParams&&Q.internalChannelParams[C]||B}function ju(C){this.Aa=0,this.i=[],this.j=new Du,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=xo("failFast",!1,C),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=xo("baseRetryDelayMs",5e3,C),this.cb=xo("retryDelaySeedMs",1e4,C),this.Wa=xo("forwardChannelMaxRetries",2,C),this.wa=xo("forwardChannelRequestTimeoutMs",2e4,C),this.pa=C&&C.xmlHttpFactory||void 0,this.Xa=C&&C.Tb||void 0,this.Ca=C&&C.useFetchStreams||!1,this.L=void 0,this.J=C&&C.supportsCrossDomainXhr||!1,this.K="",this.h=new Ml(C&&C.concurrentRequestLimit),this.Da=new Fu,this.P=C&&C.fastHandshake||!1,this.O=C&&C.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=C&&C.Rb||!1,C&&C.xa&&this.j.xa(),C&&C.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&C&&C.detectBufferingProxy||!1,this.ja=void 0,C&&C.longPollingTimeout&&0<C.longPollingTimeout&&(this.ja=C.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ju.prototype,n.la=8,n.G=1,n.connect=function(C,B,Q,fe){Ni(0),this.W=C,this.H=B||{},Q&&fe!==void 0&&(this.H.OSID=Q,this.H.OAID=fe),this.F=this.X,this.I=Dg(this,null,this.W),fc(this)};function Ki(C){if(Wd(C),C.G==3){var B=C.U++,Q=Ao(C.I);if(zr(Q,"SID",C.K),zr(Q,"RID",B),zr(Q,"TYPE","terminate"),Bu(C,Q),B=new oa(C,C.j,B),B.L=2,B.v=Ba(Ao(Q)),Q=!1,E.navigator&&E.navigator.sendBeacon)try{Q=E.navigator.sendBeacon(B.v.toString(),"")}catch{}!Q&&E.Image&&(new Image().src=B.v,Q=!0),Q||(B.g=jE(B.j,null),B.g.ea(B.v)),B.F=Date.now(),Fr(B)}Gu(C)}function al(C){C.g&&(Ng(C),C.g.cancel(),C.g=null)}function Wd(C){al(C),C.u&&(E.clearTimeout(C.u),C.u=null),Wf(C),C.h.cancel(),C.s&&(typeof C.s=="number"&&E.clearTimeout(C.s),C.s=null)}function fc(C){if(!uo(C.h)&&!C.s){C.s=!0;var B=C.Ga;we||Ne(),Ce||(we(),Ce=!0),ve.add(B,C),C.B=0}}function kg(C,B){return xf(C.h)>=C.h.j-(C.s?1:0)?!1:C.s?(C.i=B.D.concat(C.i),!0):C.G==1||C.G==2||C.B>=(C.Va?0:C.Wa)?!1:(C.s=Va(N(C.Ga,C,B),Wu(C,C.B)),C.B++,!0)}n.Ga=function(C){if(this.s)if(this.s=null,this.G==1){if(!C){this.U=Math.floor(1e5*Math.random()),C=this.U++;const qe=new oa(this,this.j,C);let at=this.o;if(this.S&&(at?(at=Z(at),se(at,this.S)):at=this.S),this.m!==null||this.O||(qe.H=at,at=null),this.P)e:{for(var B=0,Q=0;Q<this.i.length;Q++){t:{var fe=this.i[Q];if("__data__"in fe.map&&(fe=fe.map.__data__,typeof fe=="string")){fe=fe.length;break t}fe=void 0}if(fe===void 0)break;if(B+=fe,4096<B){B=Q;break e}if(B===4096||Q===this.i.length-1){B=Q+1;break e}}B=1e3}else B=1e3;B=Mo(this,qe,B),Q=Ao(this.I),zr(Q,"RID",C),zr(Q,"CVER",22),this.D&&zr(Q,"X-HTTP-Session-Id",this.D),Bu(this,Q),at&&(this.O?B="headers="+encodeURIComponent(String(ol(at)))+"&"+B:this.m&&Se(Q,this.m,at)),op(this.h,qe),this.Ua&&zr(Q,"TYPE","init"),this.P?(zr(Q,"$req",B),zr(Q,"SID","null"),qe.T=!0,Md(qe,Q,null)):Md(qe,Q,B),this.G=2}}else this.G==3&&(C?jf(this,C):this.i.length==0||uo(this.h)||jf(this))};function jf(C,B){var Q;B?Q=B.l:Q=C.U++;const fe=Ao(C.I);zr(fe,"SID",C.K),zr(fe,"RID",Q),zr(fe,"AID",C.T),Bu(C,fe),C.m&&C.o&&Se(fe,C.m,C.o),Q=new oa(C,C.j,Q,C.B+1),C.m===null&&(Q.H=C.o),B&&(C.i=B.D.concat(C.i)),B=Mo(C,Q,1e3),Q.I=Math.round(.5*C.wa)+Math.round(.5*C.wa*Math.random()),op(C.h,Q),Md(Q,fe,B)}function Bu(C,B){C.H&&ge(C.H,function(Q,fe){zr(B,fe,Q)}),C.l&&Ul({},function(Q,fe){zr(B,fe,Q)})}function Mo(C,B,Q){Q=Math.min(C.i.length,Q);var fe=C.l?N(C.l.Na,C.l,C):null;e:{var qe=C.i;let at=-1;for(;;){const xt=["count="+Q];at==-1?0<Q?(at=qe[0].g,xt.push("ofs="+at)):at=0:xt.push("ofs="+at);let Gr=!0;for(let ii=0;ii<Q;ii++){let Er=qe[ii].g;const Fs=qe[ii].map;if(Er-=at,0>Er)at=Math.max(0,qe[ii].g-100),Gr=!1;else try{lp(Fs,xt,"req"+Er+"_")}catch{fe&&fe(Fs)}}if(Gr){fe=xt.join("&");break e}}}return C=C.i.splice(0,Q),B.D=C,fe}function zl(C){if(!C.g&&!C.u){C.Y=1;var B=C.Fa;we||Ne(),Ce||(we(),Ce=!0),ve.add(B,C),C.v=0}}function Bf(C){return C.g||C.u||3<=C.v?!1:(C.Y++,C.u=Va(N(C.Fa,C),Wu(C,C.v)),C.v++,!0)}n.Fa=function(){if(this.u=null,FE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var C=2*this.R;this.j.info("BP detection timer enabled: "+C),this.A=Va(N(this.ab,this),C)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ni(10),al(this),FE(this))};function Ng(C){C.A!=null&&(E.clearTimeout(C.A),C.A=null)}function FE(C){C.g=new oa(C,C.j,"rpc",C.Y),C.m===null&&(C.g.H=C.o),C.g.O=0;var B=Ao(C.qa);zr(B,"RID","rpc"),zr(B,"SID",C.K),zr(B,"AID",C.T),zr(B,"CI",C.F?"0":"1"),!C.F&&C.ja&&zr(B,"TO",C.ja),zr(B,"TYPE","xmlhttp"),Bu(C,B),C.m&&C.o&&Se(B,C.m,C.o),C.L&&(C.g.I=C.L);var Q=C.g;C=C.ia,Q.L=1,Q.v=Ba(Ao(B)),Q.m=null,Q.P=!0,Mu(Q,C)}n.Za=function(){this.C!=null&&(this.C=null,al(this),Bf(this),Ni(19))};function Wf(C){C.C!=null&&(E.clearTimeout(C.C),C.C=null)}function zf(C,B){var Q=null;if(C.g==B){Wf(C),Ng(C),C.g=null;var fe=2}else if(Ks(C.h,B))Q=B.D,rl(C.h,B),fe=1;else return;if(C.G!=0){if(B.o)if(fe==1){Q=B.m?B.m.length:0,B=Date.now()-B.F;var qe=C.B;fe=Nu(),an(fe,new ls(fe,Q)),fc(C)}else zl(C);else if(qe=B.s,qe==3||qe==0&&0<B.X||!(fe==1&&kg(C,B)||fe==2&&Bf(C)))switch(Q&&0<Q.length&&(B=C.h,B.i=B.i.concat(Q)),qe){case 1:zu(C,5);break;case 4:zu(C,10);break;case 3:zu(C,6);break;default:zu(C,2)}}}function Wu(C,B){let Q=C.Ta+Math.floor(Math.random()*C.cb);return C.isActive()||(Q*=2),Q*B}function zu(C,B){if(C.j.info("Error code "+B),B==2){var Q=N(C.fb,C),fe=C.Xa;const qe=!fe;fe=new ja(fe||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||Vu(fe,"https"),Ba(fe),qe?Vf(fe.toString(),Q):pc(fe.toString(),Q)}else Ni(2);C.G=0,C.l&&C.l.sa(B),Gu(C),Wd(C)}n.fb=function(C){C?(this.j.info("Successfully pinged google.com"),Ni(2)):(this.j.info("Failed to ping google.com"),Ni(1))};function Gu(C){if(C.G=0,C.ka=[],C.l){const B=Fd(C.h);(B.length!=0||C.i.length!=0)&&(H(C.ka,B),H(C.ka,C.i),C.h.i.length=0,z(C.i),C.i.length=0),C.l.ra()}}function Dg(C,B,Q){var fe=Q instanceof ja?Ao(Q):new ja(Q);if(fe.g!="")B&&(fe.g=B+"."+fe.g),il(fe,fe.s);else{var qe=E.location;fe=qe.protocol,B=B?B+"."+qe.hostname:qe.hostname,qe=+qe.port;var at=new ja(null);fe&&Vu(at,fe),B&&(at.g=B),qe&&il(at,qe),Q&&(at.l=Q),fe=at}return Q=C.D,B=C.ya,Q&&B&&zr(fe,Q,B),zr(fe,"VER",C.la),Bu(C,fe),fe}function jE(C,B,Q){if(B&&!C.J)throw Error("Can't create secondary domain capable XhrIo object.");return B=C.Ca&&!C.pa?new De(new sl({eb:Q})):new De(C.pa),B.Ha(C.J),B}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Mn(){}n=Mn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Gf(){}Gf.prototype.g=function(C,B){return new Uo(C,B)};function Uo(C,B){pn.call(this),this.g=new ju(B),this.l=C,this.h=B&&B.messageUrlParams||null,C=B&&B.messageHeaders||null,B&&B.clientProtocolHeaderRequired&&(C?C["X-Client-Protocol"]="webchannel":C={"X-Client-Protocol":"webchannel"}),this.g.o=C,C=B&&B.initMessageHeaders||null,B&&B.messageContentType&&(C?C["X-WebChannel-Content-Type"]=B.messageContentType:C={"X-WebChannel-Content-Type":B.messageContentType}),B&&B.va&&(C?C["X-WebChannel-Client-Profile"]=B.va:C={"X-WebChannel-Client-Profile":B.va}),this.g.S=C,(C=B&&B.Sb)&&!K(C)&&(this.g.m=C),this.v=B&&B.supportsCrossDomainXhr||!1,this.u=B&&B.sendRawJson||!1,(B=B&&B.httpSessionIdParam)&&!K(B)&&(this.g.D=B,C=this.h,C!==null&&B in C&&(C=this.h,B in C&&delete C[B])),this.j=new mc(this)}j(Uo,pn),Uo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Uo.prototype.close=function(){Ki(this.g)},Uo.prototype.o=function(C){var B=this.g;if(typeof C=="string"){var Q={};Q.__data__=C,C=Q}else this.u&&(Q={},Q.__data__=dr(C),C=Q);B.i.push(new Vd(B.Ya++,C)),B.G==3&&fc(B)},Uo.prototype.N=function(){this.g.l=null,delete this.j,Ki(this.g),delete this.g,Uo.aa.N.call(this)};function BE(C){ac.call(this),C.__headers__&&(this.headers=C.__headers__,this.statusCode=C.__status__,delete C.__headers__,delete C.__status__);var B=C.__sm__;if(B){e:{for(const Q in B){C=Q;break e}C=void 0}(this.i=C)&&(C=this.i,B=B!==null&&C in B?B[C]:void 0),this.data=B}else this.data=C}j(BE,ac);function WE(){ra.call(this),this.status=1}j(WE,ra);function mc(C){this.g=C}j(mc,Mn),mc.prototype.ua=function(){an(this.g,"a")},mc.prototype.ta=function(C){an(this.g,new BE(C))},mc.prototype.sa=function(C){an(this.g,new WE)},mc.prototype.ra=function(){an(this.g,"b")},Gf.prototype.createWebChannel=Gf.prototype.g,Uo.prototype.send=Uo.prototype.o,Uo.prototype.open=Uo.prototype.m,Uo.prototype.close=Uo.prototype.close,ere=function(){return new Gf},Zne=function(){return Nu()},Qne=cc,qU={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Lu.NO_ERROR=0,Lu.TIMEOUT=8,Lu.HTTP_ERROR=6,HO=Lu,ip.COMPLETE="complete",Jne=ip,xl.EventType=Us,Us.OPEN="a",Us.CLOSE="b",Us.ERROR="c",Us.MESSAGE="d",pn.prototype.listen=pn.prototype.K,Aw=xl,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Xne=De}).apply(typeof hO<"u"?hO:typeof self<"u"?self:typeof window<"u"?window:{});const xY="@firebase/firestore",MY="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Aa.UNAUTHENTICATED=new Aa(null),Aa.GOOGLE_CREDENTIALS=new Aa("google-credentials-uid"),Aa.FIRST_PARTY=new Aa("first-party-uid"),Aa.MOCK_USER=new Aa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let I0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE=new ej("@firebase/firestore");function lS(){return PE.logLevel}function Qt(n,...t){if(PE.logLevel<=Sr.DEBUG){const s=t.map(dj);PE.debug(`Firestore (${I0}): ${n}`,...s)}}function Pf(n,...t){if(PE.logLevel<=Sr.ERROR){const s=t.map(dj);PE.error(`Firestore (${I0}): ${n}`,...s)}}function s0(n,...t){if(PE.logLevel<=Sr.WARN){const s=t.map(dj);PE.warn(`Firestore (${I0}): ${n}`,...s)}}function dj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(n="Unexpected state"){const t=`FIRESTORE (${I0}) INTERNAL ASSERTION FAILED: `+n;throw Pf(t),new Error(t)}function ri(n,t){n||jn()}function qn(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rn extends rp{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tre{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class hFe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(Aa.UNAUTHENTICATED))}shutdown(){}}class pFe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class fFe{constructor(t){this.t=t,this.currentUser=Aa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){ri(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,s(v)):Promise.resolve();let d=new vf;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new vf,t.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},E=v=>{Qt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(v=>E(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?E(v):(Qt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new vf)}},0),f()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(Qt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(ri(typeof a.accessToken=="string"),new tre(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ri(t===null||typeof t=="string"),new Aa(t)}}class mFe{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=Aa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class gFe{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new mFe(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(Aa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class UY{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class _Fe{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,wl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){ri(this.o===void 0);const a=d=>{d.error!=null&&Qt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,Qt("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{Qt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Qt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new UY(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(ri(typeof s.token=="string"),this.R=s.token,new UY(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EFe(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<n;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nre(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rre{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=EFe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function ur(n,t){return n<t?-1:n>t?1:0}function YU(n,t){let s=0;for(;s<n.length&&s<t.length;){const a=n.codePointAt(s),l=t.codePointAt(s);if(a!==l){if(a<128&&l<128)return ur(a,l);{const d=nre(),f=yFe(d.encode(VY(n,s)),d.encode(VY(t,s)));return f!==0?f:ur(a,l)}}s+=a>65535?2:1}return ur(n.length,t.length)}function VY(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function yFe(n,t){for(let s=0;s<n.length&&s<t.length;++s)if(n[s]!==t[s])return ur(n[s],t[s]);return ur(n.length,t.length)}function o0(n,t,s){return n.length===t.length&&n.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FY=-62135596800,jY=1e6;class so{static now(){return so.fromMillis(Date.now())}static fromDate(t){return so.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*jY);return new so(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new rn(bt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new rn(bt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<FY)throw new rn(bt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new rn(bt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/jY}_compareTo(t){return this.seconds===t.seconds?ur(this.nanoseconds,t.nanoseconds):ur(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-FY;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{static fromTimestamp(t){return new Gn(t)}static min(){return new Gn(new so(0,0))}static max(){return new Gn(new so(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BY="__name__";class Oh{constructor(t,s,a){s===void 0?s=0:s>t.length&&jn(),a===void 0?a=t.length-s:a>t.length-s&&jn(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return Oh.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof Oh?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=Oh.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return ur(t.length,s.length)}static compareSegments(t,s){const a=Oh.isNumericId(t),l=Oh.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?Oh.extractNumericId(t).compare(Oh.extractNumericId(s)):YU(t,s)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return cg.fromString(t.substring(4,t.length-2))}}class Wi extends Oh{construct(t,s,a){return new Wi(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new rn(bt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new Wi(s)}static emptyPath(){return new Wi([])}}const vFe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ea extends Oh{construct(t,s,a){return new ea(t,s,a)}static isValidIdentifier(t){return vFe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ea.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===BY}static keyField(){return new ea([BY])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new rn(bt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let f=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new rn(bt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new rn(bt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else E==="`"?(f=!f,l++):E!=="."||f?(a+=E,l++):(d(),l++)}if(d(),f)throw new rn(bt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ea(s)}static emptyPath(){return new ea([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(t){this.path=t}static fromPath(t){return new Sn(Wi.fromString(t))}static fromName(t){return new Sn(Wi.fromString(t).popFirst(5))}static empty(){return new Sn(Wi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Wi.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return Wi.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Sn(new Wi(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bR=-1;function SFe(n,t){const s=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Gn.fromTimestamp(a===1e9?new so(s+1,0):new so(s,a));return new _g(l,Sn.empty(),t)}function TFe(n){return new _g(n.readTime,n.key,bR)}class _g{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new _g(Gn.min(),Sn.empty(),bR)}static max(){return new _g(Gn.max(),Sn.empty(),bR)}}function bFe(n,t){let s=n.readTime.compareTo(t.readTime);return s!==0?s:(s=Sn.comparator(n.documentKey,t.documentKey),s!==0?s:ur(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wFe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class RFe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A0(n){if(n.code!==bt.FAILED_PRECONDITION||n.message!==wFe)throw n;Qt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&jn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new Tt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof Tt?s:Tt.resolve(s)}catch(s){return Tt.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):Tt.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):Tt.reject(s)}static resolve(t){return new Tt((s,a)=>{s(t)})}static reject(t){return new Tt((s,a)=>{a(t)})}static waitFor(t){return new Tt((s,a)=>{let l=0,d=0,f=!1;t.forEach(E=>{++l,E.next(()=>{++d,f&&d===l&&s()},v=>a(v))}),f=!0,d===l&&s()})}static or(t){let s=Tt.resolve(!1);for(const a of t)s=s.next(l=>l?Tt.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new Tt((a,l)=>{const d=t.length,f=new Array(d);let E=0;for(let v=0;v<d;v++){const T=v;s(t[T]).next(w=>{f[T]=w,++E,E===d&&a(f)},w=>l(w))}})}static doWhile(t,s){return new Tt((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function CFe(n){const t=n.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function P0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}T1.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hj=-1;function b1(n){return n==null}function Rk(n){return n===0&&1/n==-1/0}function IFe(n){return typeof n=="number"&&Number.isInteger(n)&&!Rk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ire="";function AFe(n){let t="";for(let s=0;s<n.length;s++)t.length>0&&(t=WY(t)),t=PFe(n.get(s),t);return WY(t)}function PFe(n,t){let s=t;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":s+="";break;case ire:s+="";break;default:s+=d}}return s}function WY(n){return n+ire+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zY(n){let t=0;for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t++;return t}function Ig(n,t){for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t(s,n[s])}function sre(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cs{constructor(t,s){this.comparator=t,this.root=s||Qo.EMPTY}insert(t,s){return new cs(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,Qo.BLACK,null,null))}remove(t){return new cs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Qo.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new pO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new pO(this.root,t,this.comparator,!1)}getReverseIterator(){return new pO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new pO(this.root,t,this.comparator,!0)}}class pO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Qo{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??Qo.RED,this.left=l??Qo.EMPTY,this.right=d??Qo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new Qo(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Qo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return Qo.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Qo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Qo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw jn();const t=this.left.check();if(t!==this.right.check())throw jn();return t+(this.isRed()?0:1)}}Qo.EMPTY=null,Qo.RED=!0,Qo.BLACK=!1;Qo.EMPTY=new class{constructor(){this.size=0}get key(){throw jn()}get value(){throw jn()}get color(){throw jn()}get left(){throw jn()}get right(){throw jn()}copy(t,s,a,l,d){return this}insert(t,s,a){return new Qo(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(t){this.comparator=t,this.data=new cs(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new GY(this.data.getIterator())}getIteratorFrom(t){return new GY(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof oo)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new oo(this.comparator);return s.data=t,s}}class GY{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(t){this.fields=t,t.sort(ea.comparator)}static empty(){return new Rl([])}unionWith(t){let s=new oo(ea.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new Rl(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return o0(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ore extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new ore("Invalid base64 string: "+d):d}}(t);return new ta(s)}static fromUint8Array(t){const s=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(t);return new ta(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ur(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ta.EMPTY_BYTE_STRING=new ta("");const OFe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Eg(n){if(ri(!!n),typeof n=="string"){let t=0;const s=OFe.exec(n);if(ri(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:Ls(n.seconds),nanos:Ls(n.nanos)}}function Ls(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function yg(n){return typeof n=="string"?ta.fromBase64String(n):ta.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const are="server_timestamp",cre="__type__",lre="__previous_value__",ure="__local_write_time__";function pj(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[cre])===null||s===void 0?void 0:s.stringValue)===are}function w1(n){const t=n.mapValue.fields[lre];return pj(t)?w1(t):t}function wR(n){const t=Eg(n.mapValue.fields[ure].timestampValue);return new so(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kFe{constructor(t,s,a,l,d,f,E,v,T){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=E,this.longPollingOptions=v,this.useFetchStreams=T}}const Ck="(default)";class RR{constructor(t,s){this.projectId=t,this.database=s||Ck}static empty(){return new RR("","")}get isDefaultDatabase(){return this.database===Ck}isEqual(t){return t instanceof RR&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dre="__type__",NFe="__max__",fO={mapValue:{}},hre="__vector__",Ik="value";function vg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?pj(n)?4:LFe(n)?9007199254740991:DFe(n)?10:11:jn()}function Qh(n,t){if(n===t)return!0;const s=vg(n);if(s!==vg(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return wR(n).isEqual(wR(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=Eg(l.timestampValue),E=Eg(d.timestampValue);return f.seconds===E.seconds&&f.nanos===E.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(l,d){return yg(l.bytesValue).isEqual(yg(d.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(l,d){return Ls(l.geoPointValue.latitude)===Ls(d.geoPointValue.latitude)&&Ls(l.geoPointValue.longitude)===Ls(d.geoPointValue.longitude)}(n,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Ls(l.integerValue)===Ls(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=Ls(l.doubleValue),E=Ls(d.doubleValue);return f===E?Rk(f)===Rk(E):isNaN(f)&&isNaN(E)}return!1}(n,t);case 9:return o0(n.arrayValue.values||[],t.arrayValue.values||[],Qh);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},E=d.mapValue.fields||{};if(zY(f)!==zY(E))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(E[v]===void 0||!Qh(f[v],E[v])))return!1;return!0}(n,t);default:return jn()}}function CR(n,t){return(n.values||[]).find(s=>Qh(s,t))!==void 0}function a0(n,t){if(n===t)return 0;const s=vg(n),a=vg(t);if(s!==a)return ur(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return ur(n.booleanValue,t.booleanValue);case 2:return function(d,f){const E=Ls(d.integerValue||d.doubleValue),v=Ls(f.integerValue||f.doubleValue);return E<v?-1:E>v?1:E===v?0:isNaN(E)?isNaN(v)?0:-1:1}(n,t);case 3:return HY(n.timestampValue,t.timestampValue);case 4:return HY(wR(n),wR(t));case 5:return YU(n.stringValue,t.stringValue);case 6:return function(d,f){const E=yg(d),v=yg(f);return E.compareTo(v)}(n.bytesValue,t.bytesValue);case 7:return function(d,f){const E=d.split("/"),v=f.split("/");for(let T=0;T<E.length&&T<v.length;T++){const w=ur(E[T],v[T]);if(w!==0)return w}return ur(E.length,v.length)}(n.referenceValue,t.referenceValue);case 8:return function(d,f){const E=ur(Ls(d.latitude),Ls(f.latitude));return E!==0?E:ur(Ls(d.longitude),Ls(f.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return $Y(n.arrayValue,t.arrayValue);case 10:return function(d,f){var E,v,T,w;const A=d.fields||{},N=f.fields||{},F=(E=A[Ik])===null||E===void 0?void 0:E.arrayValue,j=(v=N[Ik])===null||v===void 0?void 0:v.arrayValue,z=ur(((T=F==null?void 0:F.values)===null||T===void 0?void 0:T.length)||0,((w=j==null?void 0:j.values)===null||w===void 0?void 0:w.length)||0);return z!==0?z:$Y(F,j)}(n.mapValue,t.mapValue);case 11:return function(d,f){if(d===fO.mapValue&&f===fO.mapValue)return 0;if(d===fO.mapValue)return 1;if(f===fO.mapValue)return-1;const E=d.fields||{},v=Object.keys(E),T=f.fields||{},w=Object.keys(T);v.sort(),w.sort();for(let A=0;A<v.length&&A<w.length;++A){const N=YU(v[A],w[A]);if(N!==0)return N;const F=a0(E[v[A]],T[w[A]]);if(F!==0)return F}return ur(v.length,w.length)}(n.mapValue,t.mapValue);default:throw jn()}}function HY(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return ur(n,t);const s=Eg(n),a=Eg(t),l=ur(s.seconds,a.seconds);return l!==0?l:ur(s.nanos,a.nanos)}function $Y(n,t){const s=n.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=a0(s[l],a[l]);if(d)return d}return ur(s.length,a.length)}function c0(n){return XU(n)}function XU(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(s){const a=Eg(s);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(s){return yg(s).toBase64()}(n.bytesValue):"referenceValue"in n?function(s){return Sn.fromName(s).toString()}(n.referenceValue):"geoPointValue"in n?function(s){return`geo(${s.latitude},${s.longitude})`}(n.geoPointValue):"arrayValue"in n?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=XU(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${XU(s.fields[f])}`;return l+"}"}(n.mapValue):jn()}function $O(n){switch(vg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=w1(n);return t?16+$O(t):16;case 5:return 2*n.stringValue.length;case 6:return yg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+$O(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Ig(a.fields,(d,f)=>{l+=d.length+$O(f)}),l}(n.mapValue);default:throw jn()}}function KY(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function JU(n){return!!n&&"integerValue"in n}function fj(n){return!!n&&"arrayValue"in n}function qY(n){return!!n&&"nullValue"in n}function YY(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function KO(n){return!!n&&"mapValue"in n}function DFe(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[dre])===null||s===void 0?void 0:s.stringValue)===hre}function Yw(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Ig(n.mapValue.fields,(s,a)=>t.mapValue.fields[s]=Yw(a)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(n.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=Yw(n.arrayValue.values[s]);return t}return Object.assign({},n)}function LFe(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===NFe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(t){this.value=t}static empty(){return new $c({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!KO(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=Yw(s)}setAll(t){let s=ea.emptyPath(),a={},l=[];t.forEach((f,E)=>{if(!s.isImmediateParentOf(E)){const v=this.getFieldsMap(s);this.applyChanges(v,a,l),a={},l=[],s=E.popLast()}f?a[E.lastSegment()]=Yw(f):l.push(E.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());KO(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return Qh(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];KO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){Ig(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new $c(Yw(this.value))}}function pre(n){const t=[];return Ig(n.fields,(s,a)=>{const l=new ea([s]);if(KO(a)){const d=pre(a.mapValue).fields;if(d.length===0)t.push(l);else for(const f of d)t.push(l.child(f))}else t.push(l)}),new Rl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(t,s,a,l,d,f,E){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=E}static newInvalidDocument(t){return new Oa(t,0,Gn.min(),Gn.min(),Gn.min(),$c.empty(),0)}static newFoundDocument(t,s,a,l){return new Oa(t,1,s,Gn.min(),a,l,0)}static newNoDocument(t,s){return new Oa(t,2,s,Gn.min(),Gn.min(),$c.empty(),0)}static newUnknownDocument(t,s){return new Oa(t,3,s,Gn.min(),Gn.min(),$c.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual(Gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=$c.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=$c.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Oa&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Oa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(t,s){this.position=t,this.inclusive=s}}function XY(n,t,s){let a=0;for(let l=0;l<n.position.length;l++){const d=t[l],f=n.position[l];if(d.field.isKeyField()?a=Sn.comparator(Sn.fromName(f.referenceValue),s.key):a=a0(f,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function JY(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let s=0;s<n.position.length;s++)if(!Qh(n.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(t,s="asc"){this.field=t,this.dir=s}}function xFe(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fre{}class $s extends fre{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new UFe(t,s,a):s==="array-contains"?new jFe(t,a):s==="in"?new BFe(t,a):s==="not-in"?new WFe(t,a):s==="array-contains-any"?new zFe(t,a):new $s(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new VFe(t,a):new FFe(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(a0(s,this.value)):s!==null&&vg(this.value)===vg(s)&&this.matchesComparison(a0(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return jn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Od extends fre{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new Od(t,s)}matches(t){return mre(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function mre(n){return n.op==="and"}function gre(n){return MFe(n)&&mre(n)}function MFe(n){for(const t of n.filters)if(t instanceof Od)return!1;return!0}function QU(n){if(n instanceof $s)return n.field.canonicalString()+n.op.toString()+c0(n.value);if(gre(n))return n.filters.map(t=>QU(t)).join(",");{const t=n.filters.map(s=>QU(s)).join(",");return`${n.op}(${t})`}}function _re(n,t){return n instanceof $s?function(a,l){return l instanceof $s&&a.op===l.op&&a.field.isEqual(l.field)&&Qh(a.value,l.value)}(n,t):n instanceof Od?function(a,l){return l instanceof Od&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,E)=>d&&_re(f,l.filters[E]),!0):!1}(n,t):void jn()}function Ere(n){return n instanceof $s?function(s){return`${s.field.canonicalString()} ${s.op} ${c0(s.value)}`}(n):n instanceof Od?function(s){return s.op.toString()+" {"+s.getFilters().map(Ere).join(" ,")+"}"}(n):"Filter"}class UFe extends $s{constructor(t,s,a){super(t,s,a),this.key=Sn.fromName(a.referenceValue)}matches(t){const s=Sn.comparator(t.key,this.key);return this.matchesComparison(s)}}class VFe extends $s{constructor(t,s){super(t,"in",s),this.keys=yre("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class FFe extends $s{constructor(t,s){super(t,"not-in",s),this.keys=yre("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function yre(n,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>Sn.fromName(a.referenceValue))}class jFe extends $s{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return fj(s)&&CR(s.arrayValue,this.value)}}class BFe extends $s{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&CR(this.value.arrayValue,s)}}class WFe extends $s{constructor(t,s){super(t,"not-in",s)}matches(t){if(CR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!CR(this.value.arrayValue,s)}}class zFe extends $s{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!fj(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>CR(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GFe{constructor(t,s=null,a=[],l=[],d=null,f=null,E=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=E,this.le=null}}function QY(n,t=null,s=[],a=[],l=null,d=null,f=null){return new GFe(n,t,s,a,l,d,f)}function mj(n){const t=qn(n);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>QU(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),b1(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>c0(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>c0(a)).join(",")),t.le=s}return t.le}function gj(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!xFe(n.orderBy[s],t.orderBy[s]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if(!_re(n.filters[s],t.filters[s]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!JY(n.startAt,t.startAt)&&JY(n.endAt,t.endAt)}function ZU(n){return Sn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{constructor(t,s=null,a=[],l=[],d=null,f="F",E=null,v=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=E,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function HFe(n,t,s,a,l,d,f,E){return new QR(n,t,s,a,l,d,f,E)}function _j(n){return new QR(n)}function ZY(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function vre(n){return n.collectionGroup!==null}function Xw(n){const t=qn(n);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(f){let E=new oo(ea.comparator);return f.filters.forEach(v=>{v.getFlattenedFilters().forEach(T=>{T.isInequality()&&(E=E.add(T.field))})}),E})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new Pk(d,a))}),s.has(ea.keyField().canonicalString())||t.he.push(new Pk(ea.keyField(),a))}return t.he}function Yh(n){const t=qn(n);return t.Pe||(t.Pe=$Fe(t,Xw(n))),t.Pe}function $Fe(n,t){if(n.limitType==="F")return QY(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new Pk(l.field,d)});const s=n.endAt?new Ak(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new Ak(n.startAt.position,n.startAt.inclusive):null;return QY(n.path,n.collectionGroup,t,n.filters,n.limit,s,a)}}function eV(n,t){const s=n.filters.concat([t]);return new QR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),s,n.limit,n.limitType,n.startAt,n.endAt)}function tV(n,t,s){return new QR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,s,n.startAt,n.endAt)}function R1(n,t){return gj(Yh(n),Yh(t))&&n.limitType===t.limitType}function Sre(n){return`${mj(Yh(n))}|lt:${n.limitType}`}function uS(n){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>Ere(l)).join(", ")}]`),b1(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>c0(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>c0(l)).join(",")),`Target(${a})`}(Yh(n))}; limitType=${n.limitType})`}function C1(n,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):Sn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,t)&&function(a,l){for(const d of Xw(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,t)&&function(a,l){return!(a.startAt&&!function(f,E,v){const T=XY(f,E,v);return f.inclusive?T<=0:T<0}(a.startAt,Xw(a),l)||a.endAt&&!function(f,E,v){const T=XY(f,E,v);return f.inclusive?T>=0:T>0}(a.endAt,Xw(a),l))}(n,t)}function KFe(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Tre(n){return(t,s)=>{let a=!1;for(const l of Xw(n)){const d=qFe(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function qFe(n,t,s){const a=n.field.isKeyField()?Sn.comparator(t.key,s.key):function(d,f,E){const v=f.data.field(d),T=E.data.field(d);return v!==null&&T!==null?a0(v,T):jn()}(n.field,t,s);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return jn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Ig(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return sre(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YFe=new cs(Sn.comparator);function Of(){return YFe}const bre=new cs(Sn.comparator);function Pw(...n){let t=bre;for(const s of n)t=t.insert(s.key,s);return t}function wre(n){let t=bre;return n.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function cE(){return Jw()}function Rre(){return Jw()}function Jw(){return new LE(n=>n.toString(),(n,t)=>n.isEqual(t))}const XFe=new cs(Sn.comparator),JFe=new oo(Sn.comparator);function Tr(...n){let t=JFe;for(const s of n)t=t.add(s);return t}const QFe=new oo(ur);function ZFe(){return QFe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ej(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Rk(t)?"-0":t}}function Cre(n){return{integerValue:""+n}}function eje(n,t){return IFe(t)?Cre(t):Ej(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(){this._=void 0}}function tje(n,t,s){return n instanceof Ok?function(l,d){const f={fields:{[cre]:{stringValue:are},[ure]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&pj(d)&&(d=w1(d)),d&&(f.fields[lre]=d),{mapValue:f}}(s,t):n instanceof l0?Are(n,t):n instanceof u0?Pre(n,t):function(l,d){const f=Ire(l,d),E=eX(f)+eX(l.Ie);return JU(f)&&JU(l.Ie)?Cre(E):Ej(l.serializer,E)}(n,t)}function nje(n,t,s){return n instanceof l0?Are(n,t):n instanceof u0?Pre(n,t):s}function Ire(n,t){return n instanceof kk?function(a){return JU(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class Ok extends I1{}class l0 extends I1{constructor(t){super(),this.elements=t}}function Are(n,t){const s=Ore(t);for(const a of n.elements)s.some(l=>Qh(l,a))||s.push(a);return{arrayValue:{values:s}}}class u0 extends I1{constructor(t){super(),this.elements=t}}function Pre(n,t){let s=Ore(t);for(const a of n.elements)s=s.filter(l=>!Qh(l,a));return{arrayValue:{values:s}}}class kk extends I1{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function eX(n){return Ls(n.integerValue||n.doubleValue)}function Ore(n){return fj(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kre{constructor(t,s){this.field=t,this.transform=s}}function rje(n,t){return n.field.isEqual(t.field)&&function(a,l){return a instanceof l0&&l instanceof l0||a instanceof u0&&l instanceof u0?o0(a.elements,l.elements,Qh):a instanceof kk&&l instanceof kk?Qh(a.Ie,l.Ie):a instanceof Ok&&l instanceof Ok}(n.transform,t.transform)}class ije{constructor(t,s){this.version=t,this.transformResults=s}}class Ad{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new Ad}static exists(t){return new Ad(void 0,t)}static updateTime(t){return new Ad(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function qO(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class A1{}function Nre(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Lre(n.key,Ad.none()):new ZR(n.key,n.data,Ad.none());{const s=n.data,a=$c.empty();let l=new oo(ea.comparator);for(let d of t.fields)if(!l.has(d)){let f=s.field(d);f===null&&d.length>1&&(d=d.popLast(),f=s.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new Ag(n.key,a,new Rl(l.toArray()),Ad.none())}}function sje(n,t,s){n instanceof ZR?function(l,d,f){const E=l.value.clone(),v=nX(l.fieldTransforms,d,f.transformResults);E.setAll(v),d.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(n,t,s):n instanceof Ag?function(l,d,f){if(!qO(l.precondition,d))return void d.convertToUnknownDocument(f.version);const E=nX(l.fieldTransforms,d,f.transformResults),v=d.data;v.setAll(Dre(l)),v.setAll(E),d.convertToFoundDocument(f.version,v).setHasCommittedMutations()}(n,t,s):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,t,s)}function Qw(n,t,s,a){return n instanceof ZR?function(d,f,E,v){if(!qO(d.precondition,f))return E;const T=d.value.clone(),w=rX(d.fieldTransforms,v,f);return T.setAll(w),f.convertToFoundDocument(f.version,T).setHasLocalMutations(),null}(n,t,s,a):n instanceof Ag?function(d,f,E,v){if(!qO(d.precondition,f))return E;const T=rX(d.fieldTransforms,v,f),w=f.data;return w.setAll(Dre(d)),w.setAll(T),f.convertToFoundDocument(f.version,w).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(A=>A.field))}(n,t,s,a):function(d,f,E){return qO(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):E}(n,t,s)}function oje(n,t){let s=null;for(const a of n.fieldTransforms){const l=t.data.field(a.field),d=Ire(a.transform,l||null);d!=null&&(s===null&&(s=$c.empty()),s.set(a.field,d))}return s||null}function tX(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&o0(a,l,(d,f)=>rje(d,f))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class ZR extends A1{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Ag extends A1{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function Dre(n){const t=new Map;return n.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=n.data.field(s);t.set(s,a)}}),t}function nX(n,t,s){const a=new Map;ri(n.length===s.length);for(let l=0;l<s.length;l++){const d=n[l],f=d.transform,E=t.data.field(d.field);a.set(d.field,nje(f,E,s[l]))}return a}function rX(n,t,s){const a=new Map;for(const l of n){const d=l.transform,f=s.data.field(l.field);a.set(l.field,tje(d,f,t))}return a}class Lre extends A1{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class aje extends A1{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cje{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&sje(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=Qw(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=Qw(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=Rre();return this.mutations.forEach(l=>{const d=t.get(l.key),f=d.overlayedDocument;let E=this.applyToLocalView(f,d.mutatedFields);E=s.has(l.key)?null:E;const v=Nre(f,E);v!==null&&a.set(l.key,v),f.isValidDocument()||f.convertToNoDocument(Gn.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),Tr())}isEqual(t){return this.batchId===t.batchId&&o0(this.mutations,t.mutations,(s,a)=>tX(s,a))&&o0(this.baseMutations,t.baseMutations,(s,a)=>tX(s,a))}}class yj{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){ri(t.mutations.length===a.length);let l=function(){return XFe}();const d=t.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new yj(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lje{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uje{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ws,Or;function dje(n){switch(n){case bt.OK:return jn();case bt.CANCELLED:case bt.UNKNOWN:case bt.DEADLINE_EXCEEDED:case bt.RESOURCE_EXHAUSTED:case bt.INTERNAL:case bt.UNAVAILABLE:case bt.UNAUTHENTICATED:return!1;case bt.INVALID_ARGUMENT:case bt.NOT_FOUND:case bt.ALREADY_EXISTS:case bt.PERMISSION_DENIED:case bt.FAILED_PRECONDITION:case bt.ABORTED:case bt.OUT_OF_RANGE:case bt.UNIMPLEMENTED:case bt.DATA_LOSS:return!0;default:return jn()}}function xre(n){if(n===void 0)return Pf("GRPC error has no .code"),bt.UNKNOWN;switch(n){case Ws.OK:return bt.OK;case Ws.CANCELLED:return bt.CANCELLED;case Ws.UNKNOWN:return bt.UNKNOWN;case Ws.DEADLINE_EXCEEDED:return bt.DEADLINE_EXCEEDED;case Ws.RESOURCE_EXHAUSTED:return bt.RESOURCE_EXHAUSTED;case Ws.INTERNAL:return bt.INTERNAL;case Ws.UNAVAILABLE:return bt.UNAVAILABLE;case Ws.UNAUTHENTICATED:return bt.UNAUTHENTICATED;case Ws.INVALID_ARGUMENT:return bt.INVALID_ARGUMENT;case Ws.NOT_FOUND:return bt.NOT_FOUND;case Ws.ALREADY_EXISTS:return bt.ALREADY_EXISTS;case Ws.PERMISSION_DENIED:return bt.PERMISSION_DENIED;case Ws.FAILED_PRECONDITION:return bt.FAILED_PRECONDITION;case Ws.ABORTED:return bt.ABORTED;case Ws.OUT_OF_RANGE:return bt.OUT_OF_RANGE;case Ws.UNIMPLEMENTED:return bt.UNIMPLEMENTED;case Ws.DATA_LOSS:return bt.DATA_LOSS;default:return jn()}}(Or=Ws||(Ws={}))[Or.OK=0]="OK",Or[Or.CANCELLED=1]="CANCELLED",Or[Or.UNKNOWN=2]="UNKNOWN",Or[Or.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Or[Or.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Or[Or.NOT_FOUND=5]="NOT_FOUND",Or[Or.ALREADY_EXISTS=6]="ALREADY_EXISTS",Or[Or.PERMISSION_DENIED=7]="PERMISSION_DENIED",Or[Or.UNAUTHENTICATED=16]="UNAUTHENTICATED",Or[Or.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Or[Or.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Or[Or.ABORTED=10]="ABORTED",Or[Or.OUT_OF_RANGE=11]="OUT_OF_RANGE",Or[Or.UNIMPLEMENTED=12]="UNIMPLEMENTED",Or[Or.INTERNAL=13]="INTERNAL",Or[Or.UNAVAILABLE=14]="UNAVAILABLE",Or[Or.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hje=new cg([4294967295,4294967295],0);function iX(n){const t=nre().encode(n),s=new Yne;return s.update(t),new Uint8Array(s.digest())}function sX(n){const t=new DataView(n.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new cg([s,a],0),new cg([l,d],0)]}class vj{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new Ow(`Invalid padding: ${s}`);if(a<0)throw new Ow(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new Ow(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new Ow(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=cg.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(cg.fromNumber(a)));return l.compare(hje)===1&&(l=new cg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=iX(t),[a,l]=sX(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),f=new vj(d,l,s);return a.forEach(E=>f.insert(E)),f}insert(t){if(this.Ee===0)return;const s=iX(t),[a,l]=sX(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class Ow extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,eC.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new P1(Gn.min(),l,new cs(ur),Of(),Tr())}}class eC{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new eC(a,s,Tr(),Tr(),Tr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YO{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class Mre{constructor(t,s){this.targetId=t,this.ge=s}}class Ure{constructor(t,s,a=ta.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class oX{constructor(){this.pe=0,this.ye=aX(),this.we=ta.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=Tr(),s=Tr(),a=Tr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:jn()}}),new eC(this.we,this.Se,t,s,a)}Me(){this.be=!1,this.ye=aX()}xe(t,s){this.be=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,ri(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class pje{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Of(),this.$e=mO(),this.Ue=mO(),this.Ke=new cs(ur)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:jn()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(ZU(d))if(a===0){const f=new Sn(d.path);this.ze(s,f,Oa.newNoDocument(f,Gn.min()))}else ri(a===1);else{const f=this.et(s);if(f!==a){const E=this.tt(t),v=E?this.nt(E,t,f):1;if(v!==0){this.Ye(s);const T=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(s,T)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let f,E;try{f=yg(a).toUint8Array()}catch(v){if(v instanceof ore)return s0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{E=new vj(f,l,d)}catch(v){return s0(v instanceof Ow?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return E.Ee===0?null:E}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const f=this.ke.it(),E=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,f)=>{const E=this.Xe(f);if(E){if(d.current&&ZU(E.target)){const v=new Sn(E.target.path);this._t(v).has(f)||this.ut(f,v)||this.ze(f,v,Oa.newNoDocument(v,t))}d.ve&&(s.set(f,d.Fe()),d.Me())}});let a=Tr();this.Ue.forEach((d,f)=>{let E=!0;f.forEachWhile(v=>{const T=this.Xe(v);return!T||T.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(t));const l=new P1(t,s,this.Ke,this.Qe,a);return this.Qe=Of(),this.$e=mO(),this.Ue=mO(),this.Ke=new cs(ur),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ue=this.Ue.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ue=this.Ue.insert(s,this.ct(s).delete(t)),this.Ue=this.Ue.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new oX,this.qe.set(t,s)),s}ct(t){let s=this.Ue.get(t);return s||(s=new oo(ur),this.Ue=this.Ue.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new oo(ur),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||Qt("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new oX),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function mO(){return new cs(Sn.comparator)}function aX(){return new cs(Sn.comparator)}const fje={asc:"ASCENDING",desc:"DESCENDING"},mje={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gje={and:"AND",or:"OR"};class _je{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function nV(n,t){return n.useProto3Json||b1(t)?t:{value:t}}function Nk(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Vre(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Eje(n,t){return Nk(n,t.toTimestamp())}function Xh(n){return ri(!!n),Gn.fromTimestamp(function(s){const a=Eg(s);return new so(a.seconds,a.nanos)}(n))}function Sj(n,t){return rV(n,t).canonicalString()}function rV(n,t){const s=function(l){return new Wi(["projects",l.projectId,"databases",l.database])}(n).child("documents");return t===void 0?s:s.child(t)}function Fre(n){const t=Wi.fromString(n);return ri(Gre(t)),t}function iV(n,t){return Sj(n.databaseId,t.path)}function I2(n,t){const s=Fre(t);if(s.get(1)!==n.databaseId.projectId)throw new rn(bt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+n.databaseId.projectId);if(s.get(3)!==n.databaseId.database)throw new rn(bt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+n.databaseId.database);return new Sn(Bre(s))}function jre(n,t){return Sj(n.databaseId,t)}function yje(n){const t=Fre(n);return t.length===4?Wi.emptyPath():Bre(t)}function sV(n){return new Wi(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Bre(n){return ri(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function cX(n,t,s){return{name:iV(n,t),fields:s.value.mapValue.fields}}function vje(n,t){let s;if("targetChange"in t){t.targetChange;const a=function(T){return T==="NO_CHANGE"?0:T==="ADD"?1:T==="REMOVE"?2:T==="CURRENT"?3:T==="RESET"?4:jn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(T,w){return T.useProto3Json?(ri(w===void 0||typeof w=="string"),ta.fromBase64String(w||"")):(ri(w===void 0||w instanceof Buffer||w instanceof Uint8Array),ta.fromUint8Array(w||new Uint8Array))}(n,t.targetChange.resumeToken),f=t.targetChange.cause,E=f&&function(T){const w=T.code===void 0?bt.UNKNOWN:xre(T.code);return new rn(w,T.message||"")}(f);s=new Ure(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=I2(n,a.document.name),d=Xh(a.document.updateTime),f=a.document.createTime?Xh(a.document.createTime):Gn.min(),E=new $c({mapValue:{fields:a.document.fields}}),v=Oa.newFoundDocument(l,d,f,E),T=a.targetIds||[],w=a.removedTargetIds||[];s=new YO(T,w,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=I2(n,a.document),d=a.readTime?Xh(a.readTime):Gn.min(),f=Oa.newNoDocument(l,d),E=a.removedTargetIds||[];s=new YO([],E,f.key,f)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=I2(n,a.document),d=a.removedTargetIds||[];s=new YO([],d,l,null)}else{if(!("filter"in t))return jn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new uje(l,d),E=a.targetId;s=new Mre(E,f)}}return s}function Sje(n,t){let s;if(t instanceof ZR)s={update:cX(n,t.key,t.value)};else if(t instanceof Lre)s={delete:iV(n,t.key)};else if(t instanceof Ag)s={update:cX(n,t.key,t.data),updateMask:Oje(t.fieldMask)};else{if(!(t instanceof aje))return jn();s={verify:iV(n,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,f){const E=f.transform;if(E instanceof Ok)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof l0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof u0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof kk)return{fieldPath:f.field.canonicalString(),increment:E.Ie};throw jn()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:Eje(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:jn()}(n,t.precondition)),s}function Tje(n,t){return n&&n.length>0?(ri(t!==void 0),n.map(s=>function(l,d){let f=l.updateTime?Xh(l.updateTime):Xh(d);return f.isEqual(Gn.min())&&(f=Xh(d)),new ije(f,l.transformResults||[])}(s,t))):[]}function bje(n,t){return{documents:[jre(n,t.path)]}}function wje(n,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=jre(n,l);const d=function(T){if(T.length!==0)return zre(Od.create(T,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const f=function(T){if(T.length!==0)return T.map(w=>function(N){return{field:dS(N.field),direction:Ije(N.dir)}}(w))}(t.orderBy);f&&(s.structuredQuery.orderBy=f);const E=nV(n,t.limit);return E!==null&&(s.structuredQuery.limit=E),t.startAt&&(s.structuredQuery.startAt=function(T){return{before:T.inclusive,values:T.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(T){return{before:!T.inclusive,values:T.position}}(t.endAt)),{ht:s,parent:l}}function Rje(n){let t=yje(n.parent);const s=n.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){ri(a===1);const w=s.from[0];w.allDescendants?l=w.collectionId:t=t.child(w.collectionId)}let d=[];s.where&&(d=function(A){const N=Wre(A);return N instanceof Od&&gre(N)?N.getFilters():[N]}(s.where));let f=[];s.orderBy&&(f=function(A){return A.map(N=>function(j){return new Pk(hS(j.field),function(H){switch(H){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(N))}(s.orderBy));let E=null;s.limit&&(E=function(A){let N;return N=typeof A=="object"?A.value:A,b1(N)?null:N}(s.limit));let v=null;s.startAt&&(v=function(A){const N=!!A.before,F=A.values||[];return new Ak(F,N)}(s.startAt));let T=null;return s.endAt&&(T=function(A){const N=!A.before,F=A.values||[];return new Ak(F,N)}(s.endAt)),HFe(t,l,f,d,E,"F",v,T)}function Cje(n,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return jn()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function Wre(n){return n.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=hS(s.unaryFilter.field);return $s.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=hS(s.unaryFilter.field);return $s.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=hS(s.unaryFilter.field);return $s.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=hS(s.unaryFilter.field);return $s.create(f,"!=",{nullValue:"NULL_VALUE"});default:return jn()}}(n):n.fieldFilter!==void 0?function(s){return $s.create(hS(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return jn()}}(s.fieldFilter.op),s.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(s){return Od.create(s.compositeFilter.filters.map(a=>Wre(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return jn()}}(s.compositeFilter.op))}(n):jn()}function Ije(n){return fje[n]}function Aje(n){return mje[n]}function Pje(n){return gje[n]}function dS(n){return{fieldPath:n.canonicalString()}}function hS(n){return ea.fromServerFormat(n.fieldPath)}function zre(n){return n instanceof $s?function(s){if(s.op==="=="){if(YY(s.value))return{unaryFilter:{field:dS(s.field),op:"IS_NAN"}};if(qY(s.value))return{unaryFilter:{field:dS(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(YY(s.value))return{unaryFilter:{field:dS(s.field),op:"IS_NOT_NAN"}};if(qY(s.value))return{unaryFilter:{field:dS(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dS(s.field),op:Aje(s.op),value:s.value}}}(n):n instanceof Od?function(s){const a=s.getFilters().map(l=>zre(l));return a.length===1?a[0]:{compositeFilter:{op:Pje(s.op),filters:a}}}(n):jn()}function Oje(n){const t=[];return n.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function Gre(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(t,s,a,l,d=Gn.min(),f=Gn.min(),E=ta.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=E,this.expectedCount=v}withSequenceNumber(t){return new tg(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new tg(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new tg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new tg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kje{constructor(t){this.Tt=t}}function Nje(n){const t=Rje({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?tV(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dje{constructor(){this.Tn=new Lje}addToCollectionParentIndex(t,s){return this.Tn.add(s),Tt.resolve()}getCollectionParents(t,s){return Tt.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return Tt.resolve()}deleteFieldIndex(t,s){return Tt.resolve()}deleteAllFieldIndexes(t){return Tt.resolve()}createTargetIndexes(t,s){return Tt.resolve()}getDocumentsMatchingTarget(t,s){return Tt.resolve(null)}getIndexType(t,s){return Tt.resolve(0)}getFieldIndexes(t,s){return Tt.resolve([])}getNextCollectionGroupToUpdate(t){return Tt.resolve(null)}getMinOffset(t,s){return Tt.resolve(_g.min())}getMinOffsetFromCollectionGroup(t,s){return Tt.resolve(_g.min())}updateCollectionGroup(t,s,a){return Tt.resolve()}updateIndexEntries(t,s){return Tt.resolve()}}class Lje{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new oo(Wi.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new oo(Wi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lX={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Hre=41943040;class zc{static withCacheSize(t){return new zc(t,zc.DEFAULT_COLLECTION_PERCENTILE,zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zc.DEFAULT_COLLECTION_PERCENTILE=10,zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zc.DEFAULT=new zc(Hre,zc.DEFAULT_COLLECTION_PERCENTILE,zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zc.DISABLED=new zc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new d0(0)}static Kn(){return new d0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uX="LruGarbageCollector",xje=1048576;function dX([n,t],[s,a]){const l=ur(n,s);return l===0?ur(t,a):l}class Mje{constructor(t){this.Hn=t,this.buffer=new oo(dX),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();dX(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class Uje{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){Qt(uX,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){P0(s)?Qt(uX,"Ignoring IndexedDB error during garbage collection: ",s):await A0(s)}await this.er(3e5)})}}class Vje{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return Tt.resolve(T1.ae);const a=new Mje(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(Qt("LruGarbageCollector","Garbage collection skipped; disabled"),Tt.resolve(lX)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(Qt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lX):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,f,E,v,T;const w=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(Qt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),l=this.params.maximumSequenceNumbersToCollect):l=A,f=Date.now(),this.nthSequenceNumber(t,l))).next(A=>(a=A,E=Date.now(),this.removeTargets(t,a,s))).next(A=>(d=A,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(A=>(T=Date.now(),lS()<=Sr.DEBUG&&Qt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-w}ms
	Determined least recently used ${l} in `+(E-f)+`ms
	Removed ${d} targets in `+(v-E)+`ms
	Removed ${A} documents in `+(T-v)+`ms
Total Duration: ${T-w}ms`),Tt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:A})))}}function Fje(n,t){return new Vje(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jje{constructor(){this.changes=new LE(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,Oa.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?Tt.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bje{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wje{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&Qw(a.mutation,l,Rl.empty(),so.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,Tr()).next(()=>a))}getLocalViewOfDocuments(t,s,a=Tr()){const l=cE();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let f=Pw();return d.forEach((E,v)=>{f=f.insert(E,v.overlayedDocument)}),f}))}getOverlayedDocuments(t,s){const a=cE();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,Tr()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((f,E)=>{s.set(f,E)})})}computeViews(t,s,a,l){let d=Of();const f=Jw(),E=function(){return Jw()}();return s.forEach((v,T)=>{const w=a.get(T.key);l.has(T.key)&&(w===void 0||w.mutation instanceof Ag)?d=d.insert(T.key,T):w!==void 0?(f.set(T.key,w.mutation.getFieldMask()),Qw(w.mutation,T,w.mutation.getFieldMask(),so.now())):f.set(T.key,Rl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((T,w)=>f.set(T,w)),s.forEach((T,w)=>{var A;return E.set(T,new Bje(w,(A=f.get(T))!==null&&A!==void 0?A:null))}),E))}recalculateAndSaveOverlays(t,s){const a=Jw();let l=new cs((f,E)=>f-E),d=Tr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(f=>{for(const E of f)E.keys().forEach(v=>{const T=s.get(v);if(T===null)return;let w=a.get(v)||Rl.empty();w=E.applyToLocalView(T,w),a.set(v,w);const A=(l.get(E.batchId)||Tr()).add(v);l=l.insert(E.batchId,A)})}).next(()=>{const f=[],E=l.getReverseIterator();for(;E.hasNext();){const v=E.getNext(),T=v.key,w=v.value,A=Rre();w.forEach(N=>{if(!d.has(N)){const F=Nre(s.get(N),a.get(N));F!==null&&A.set(N,F),d=d.add(N)}}),f.push(this.documentOverlayCache.saveOverlays(t,T,A))}return Tt.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(f){return Sn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):vre(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):Tt.resolve(cE());let E=bR,v=d;return f.next(T=>Tt.forEach(T,(w,A)=>(E<A.largestBatchId&&(E=A.largestBatchId),d.get(w)?Tt.resolve():this.remoteDocumentCache.getEntry(t,w).next(N=>{v=v.insert(w,N)}))).next(()=>this.populateOverlays(t,T,d)).next(()=>this.computeViews(t,v,T,Tr())).next(w=>({batchId:E,changes:wre(w)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new Sn(s)).next(a=>{let l=Pw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let f=Pw();return this.indexManager.getCollectionParents(t,d).next(E=>Tt.forEach(E,v=>{const T=function(A,N){return new QR(N,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(s,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,T,a,l).next(w=>{w.forEach((A,N)=>{f=f.insert(A,N)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(f=>{d.forEach((v,T)=>{const w=T.getKey();f.get(w)===null&&(f=f.insert(w,Oa.newInvalidDocument(w)))});let E=Pw();return f.forEach((v,T)=>{const w=d.get(v);w!==void 0&&Qw(w.mutation,T,Rl.empty(),so.now()),C1(s,T)&&(E=E.insert(v,T))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zje{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return Tt.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:Xh(l.createTime)}}(s)),Tt.resolve()}getNamedQuery(t,s){return Tt.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:Nje(l.bundledQuery),readTime:Xh(l.readTime)}}(s)),Tt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gje{constructor(){this.overlays=new cs(Sn.comparator),this.Rr=new Map}getOverlay(t,s){return Tt.resolve(this.overlays.get(s))}getOverlays(t,s){const a=cE();return Tt.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),Tt.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),Tt.resolve()}getOverlaysForCollection(t,s,a){const l=cE(),d=s.length+1,f=new Sn(s.child("")),E=this.overlays.getIteratorFrom(f);for(;E.hasNext();){const v=E.getNext().value,T=v.getKey();if(!s.isPrefixOf(T.path))break;T.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return Tt.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new cs((T,w)=>T-w);const f=this.overlays.getIterator();for(;f.hasNext();){const T=f.getNext().value;if(T.getKey().getCollectionGroup()===s&&T.largestBatchId>a){let w=d.get(T.largestBatchId);w===null&&(w=cE(),d=d.insert(T.largestBatchId,w)),w.set(T.getKey(),T)}}const E=cE(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((T,w)=>E.set(T,w)),!(E.size()>=l)););return Tt.resolve(E)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new lje(s,a));let d=this.Rr.get(s);d===void 0&&(d=Tr(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hje{constructor(){this.sessionToken=ta.EMPTY_BYTE_STRING}getSessionToken(t){return Tt.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,Tt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tj{constructor(){this.Vr=new oo(wo.mr),this.gr=new oo(wo.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new wo(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new wo(t,s))}Sr(t,s){t.forEach(a=>this.removeReference(a,s))}br(t){const s=new Sn(new Wi([])),a=new wo(s,t),l=new wo(s,t+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new Sn(new Wi([])),a=new wo(s,t),l=new wo(s,t+1);let d=Tr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(t){const s=new wo(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class wo{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return Sn.comparator(t.key,s.key)||ur(t.Cr,s.Cr)}static pr(t,s){return ur(t.Cr,s.Cr)||Sn.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $je{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new oo(wo.mr)}checkEmpty(t){return Tt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new cje(d,s,a,l);this.mutationQueue.push(f);for(const E of l)this.Mr=this.Mr.add(new wo(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return Tt.resolve(f)}lookupMutationBatch(t,s){return Tt.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return Tt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Tt.resolve(this.mutationQueue.length===0?hj:this.Fr-1)}getAllMutationBatches(t){return Tt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new wo(s,0),l=new wo(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const E=this.Or(f.Cr);d.push(E)}),Tt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new oo(ur);return s.forEach(l=>{const d=new wo(l,0),f=new wo(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],E=>{a=a.add(E.Cr)})}),Tt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;Sn.isDocumentKey(d)||(d=d.child(""));const f=new wo(new Sn(d),0);let E=new oo(ur);return this.Mr.forEachWhile(v=>{const T=v.key.path;return!!a.isPrefixOf(T)&&(T.length===l&&(E=E.add(v.Cr)),!0)},f),Tt.resolve(this.Br(E))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){ri(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Tt.forEach(s.mutations,l=>{const d=new wo(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new wo(s,0),l=this.Mr.firstAfterOrEqual(a);return Tt.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Tt.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kje{constructor(t){this.kr=t,this.docs=function(){return new cs(Sn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return Tt.resolve(a?a.document.mutableCopy():Oa.newInvalidDocument(s))}getEntries(t,s){let a=Of();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Oa.newInvalidDocument(l))}),Tt.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=Of();const f=s.path,E=new Sn(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(E);for(;v.hasNext();){const{key:T,value:{document:w}}=v.getNext();if(!f.isPrefixOf(T.path))break;T.path.length>f.length+1||bFe(TFe(w),a)<=0||(l.has(w.key)||C1(s,w))&&(d=d.insert(w.key,w.mutableCopy()))}return Tt.resolve(d)}getAllFromCollectionGroup(t,s,a,l){jn()}qr(t,s){return Tt.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new qje(this)}getSize(t){return Tt.resolve(this.size)}}class qje extends jje{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),Tt.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yje{constructor(t){this.persistence=t,this.Qr=new LE(s=>mj(s),gj),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new Tj,this.targetCount=0,this.Kr=d0.Un()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),Tt.resolve()}getLastRemoteSnapshotVersion(t){return Tt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Tt.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),Tt.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),Tt.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Kr=new d0(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,Tt.resolve()}updateTargetData(t,s){return this.zn(s),Tt.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Ur.br(s.targetId),this.targetCount-=1,Tt.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((f,E)=>{E.sequenceNumber<=s&&a.get(E.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),Tt.waitFor(d).next(()=>l)}getTargetCount(t){return Tt.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return Tt.resolve(a)}addMatchingKeys(t,s,a){return this.Ur.yr(s,a),Tt.resolve()}removeMatchingKeys(t,s,a){this.Ur.Sr(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(f=>{d.push(l.markPotentiallyOrphaned(t,f))}),Tt.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Ur.br(s),Tt.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Ur.vr(s);return Tt.resolve(a)}containsKey(t,s){return Tt.resolve(this.Ur.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $re{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new T1(0),this.zr=!1,this.zr=!0,this.jr=new Hje,this.referenceDelegate=t(this),this.Hr=new Yje(this),this.indexManager=new Dje,this.remoteDocumentCache=function(l){return new Kje(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new kje(s),this.Yr=new zje(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new Gje,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new $je(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){Qt("MemoryPersistence","Starting transaction:",t);const l=new Xje(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return Tt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class Xje extends RFe{constructor(t){super(),this.currentSequenceNumber=t}}class bj{constructor(t){this.persistence=t,this.ti=new Tj,this.ni=null}static ri(t){return new bj(t)}get ii(){if(this.ni)return this.ni;throw jn()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),Tt.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),Tt.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),Tt.resolve()}removeTarget(t,s){this.ti.br(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Tt.forEach(this.ii,a=>{const l=Sn.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,Gn.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return Tt.or([()=>Tt.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class Dk{constructor(t,s){this.persistence=t,this.oi=new LE(a=>AFe(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=Fje(this,s)}static ri(t,s){return new Dk(t,s)}Zr(){}Xr(t){return Tt.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return Tt.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?Tt.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,f=>this.ar(t,f,s).next(E=>{E||(a++,d.removeEntry(f,Gn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),Tt.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),Tt.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),Tt.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),Tt.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=$O(t.data.value)),s}ar(t,s,a){return Tt.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return Tt.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wj{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=Tr(),l=Tr();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new wj(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jje{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qje{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return NMe()?8:CFe(Ma())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new Jje;return this._s(t,s,f).next(E=>{if(d.result=E,this.Xi)return this.us(t,s,f,E.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(lS()<=Sr.DEBUG&&Qt("QueryEngine","SDK will not create cache indexes for query:",uS(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Tt.resolve()):(lS()<=Sr.DEBUG&&Qt("QueryEngine","Query:",uS(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(lS()<=Sr.DEBUG&&Qt("QueryEngine","The SDK decides to create cache indexes for query:",uS(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Yh(s))):Tt.resolve())}rs(t,s){if(ZY(s))return Tt.resolve(null);let a=Yh(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=tV(s,null,"F"),a=Yh(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const f=Tr(...d);return this.ns.getDocuments(t,f).next(E=>this.indexManager.getMinOffset(t,a).next(v=>{const T=this.cs(s,E);return this.ls(s,T,f,v.readTime)?this.rs(t,tV(s,null,"F")):this.hs(t,T,s,v)}))})))}ss(t,s,a,l){return ZY(s)||l.isEqual(Gn.min())?Tt.resolve(null):this.ns.getDocuments(t,a).next(d=>{const f=this.cs(s,d);return this.ls(s,f,a,l)?Tt.resolve(null):(lS()<=Sr.DEBUG&&Qt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),uS(s)),this.hs(t,f,s,SFe(l,bR)).next(E=>E))})}cs(t,s){let a=new oo(Tre(t));return s.forEach((l,d)=>{C1(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return lS()<=Sr.DEBUG&&Qt("QueryEngine","Using full collection scan to execute query:",uS(s)),this.ns.getDocumentsMatchingQuery(t,s,_g.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rj="LocalStore",Zje=3e8;class e4e{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new cs(ur),this.Is=new LE(d=>mj(d),gj),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Wje(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function t4e(n,t,s,a){return new e4e(n,t,s,a)}async function Kre(n,t){const s=qn(n);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],E=[];let v=Tr();for(const T of l){f.push(T.batchId);for(const w of T.mutations)v=v.add(w.key)}for(const T of d){E.push(T.batchId);for(const w of T.mutations)v=v.add(w.key)}return s.localDocuments.getDocuments(a,v).next(T=>({Rs:T,removedBatchIds:f,addedBatchIds:E}))})})}function n4e(n,t){const s=qn(n);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(E,v,T,w){const A=T.batch,N=A.keys();let F=Tt.resolve();return N.forEach(j=>{F=F.next(()=>w.getEntry(v,j)).next(z=>{const H=T.docVersions.get(j);ri(H!==null),z.version.compareTo(H)<0&&(A.applyToRemoteDocument(z,T),z.isValidDocument()&&(z.setReadTime(T.commitVersion),w.addEntry(z)))})}),F.next(()=>E.mutationQueue.removeMutationBatch(v,A))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let v=Tr();for(let T=0;T<E.mutationResults.length;++T)E.mutationResults[T].transformResults.length>0&&(v=v.add(E.batch.mutations[T].key));return v}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function qre(n){const t=qn(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function r4e(n,t){const s=qn(n),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const E=[];t.targetChanges.forEach((w,A)=>{const N=l.get(A);if(!N)return;E.push(s.Hr.removeMatchingKeys(d,w.removedDocuments,A).next(()=>s.Hr.addMatchingKeys(d,w.addedDocuments,A)));let F=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(A)!==null?F=F.withResumeToken(ta.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):w.resumeToken.approximateByteSize()>0&&(F=F.withResumeToken(w.resumeToken,a)),l=l.insert(A,F),function(z,H,te){return z.resumeToken.approximateByteSize()===0||H.snapshotVersion.toMicroseconds()-z.snapshotVersion.toMicroseconds()>=Zje?!0:te.addedDocuments.size+te.modifiedDocuments.size+te.removedDocuments.size>0}(N,F,w)&&E.push(s.Hr.updateTargetData(d,F))});let v=Of(),T=Tr();if(t.documentUpdates.forEach(w=>{t.resolvedLimboDocuments.has(w)&&E.push(s.persistence.referenceDelegate.updateLimboDocument(d,w))}),E.push(i4e(d,f,t.documentUpdates).next(w=>{v=w.Vs,T=w.fs})),!a.isEqual(Gn.min())){const w=s.Hr.getLastRemoteSnapshotVersion(d).next(A=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(w)}return Tt.waitFor(E).next(()=>f.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,v,T)).next(()=>v)}).then(d=>(s.Ts=l,d))}function i4e(n,t,s){let a=Tr(),l=Tr();return s.forEach(d=>a=a.add(d)),t.getEntries(n,a).next(d=>{let f=Of();return s.forEach((E,v)=>{const T=d.get(E);v.isFoundDocument()!==T.isFoundDocument()&&(l=l.add(E)),v.isNoDocument()&&v.version.isEqual(Gn.min())?(t.removeEntry(E,v.readTime),f=f.insert(E,v)):!T.isValidDocument()||v.version.compareTo(T.version)>0||v.version.compareTo(T.version)===0&&T.hasPendingWrites?(t.addEntry(v),f=f.insert(E,v)):Qt(Rj,"Ignoring outdated watch update for ",E,". Current version:",T.version," Watch version:",v.version)}),{Vs:f,fs:l}})}function s4e(n,t){const s=qn(n);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=hj),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function o4e(n,t){const s=qn(n);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,Tt.resolve(l)):s.Hr.allocateTargetId(a).next(f=>(l=new tg(t,f,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function oV(n,t,s){const a=qn(n),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!P0(f))throw f;Qt(Rj,`Failed to update sequence numbers for target ${t}: ${f}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function hX(n,t,s){const a=qn(n);let l=Gn.min(),d=Tr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(v,T,w){const A=qn(v),N=A.Is.get(w);return N!==void 0?Tt.resolve(A.Ts.get(N)):A.Hr.getTargetData(T,w)}(a,f,Yh(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,E.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,t,s?l:Gn.min(),s?d:Tr())).next(E=>(a4e(a,KFe(t),E),{documents:E,gs:d})))}function a4e(n,t,s){let a=n.Es.get(t)||Gn.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(t,a)}class pX{constructor(){this.activeTargetIds=ZFe()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class c4e{constructor(){this.ho=new pX,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new pX,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4e{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fX="ConnectivityMonitor";class mX{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Qt(fX,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){Qt(fX,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gO=null;function aV(){return gO===null?gO=function(){return 268435456+Math.round(2147483648*Math.random())}():gO++,"0x"+gO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2="RestConnection",u4e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class d4e{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===Ck?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(t,s,a,l,d){const f=aV(),E=this.bo(t,s.toUriEncodedString());Qt(A2,`Sending RPC '${t}' ${f}:`,E,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,E,v,a).then(T=>(Qt(A2,`Received RPC '${t}' ${f}: `,T),T),T=>{throw s0(A2,`RPC '${t}' ${f} failed with error: `,T,"url: ",E,"request:",a),T})}Co(t,s,a,l,d,f){return this.So(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+I0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}bo(t,s){const a=u4e[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4e{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra="WebChannelConnection";class p4e extends d4e{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=aV();return new Promise((f,E)=>{const v=new Xne;v.setWithCredentials(!0),v.listenOnce(Jne.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case HO.NO_ERROR:const w=v.getResponseJson();Qt(Ra,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(w)),f(w);break;case HO.TIMEOUT:Qt(Ra,`RPC '${t}' ${d} timed out`),E(new rn(bt.DEADLINE_EXCEEDED,"Request time out"));break;case HO.HTTP_ERROR:const A=v.getStatus();if(Qt(Ra,`RPC '${t}' ${d} failed with status:`,A,"response text:",v.getResponseText()),A>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const F=N==null?void 0:N.error;if(F&&F.status&&F.message){const j=function(H){const te=H.toLowerCase().replace(/_/g,"-");return Object.values(bt).indexOf(te)>=0?te:bt.UNKNOWN}(F.status);E(new rn(j,F.message))}else E(new rn(bt.UNKNOWN,"Server responded with status "+v.getStatus()))}else E(new rn(bt.UNAVAILABLE,"Connection failed."));break;default:jn()}}finally{Qt(Ra,`RPC '${t}' ${d} completed.`)}});const T=JSON.stringify(l);Qt(Ra,`RPC '${t}' ${d} sending request:`,l),v.send(s,"POST",T,a,15)})}Wo(t,s,a){const l=aV(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],f=ere(),E=Zne(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},T=this.longPollingOptions.timeoutSeconds;T!==void 0&&(v.longPollingTimeout=Math.round(1e3*T)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,s,a),v.encodeInitMessageHeaders=!0;const w=d.join("");Qt(Ra,`Creating RPC '${t}' stream ${l}: ${w}`,v);const A=f.createWebChannel(w,v);let N=!1,F=!1;const j=new h4e({Fo:H=>{F?Qt(Ra,`Not sending because RPC '${t}' stream ${l} is closed:`,H):(N||(Qt(Ra,`Opening RPC '${t}' stream ${l} transport.`),A.open(),N=!0),Qt(Ra,`RPC '${t}' stream ${l} sending:`,H),A.send(H))},Mo:()=>A.close()}),z=(H,te,K)=>{H.listen(te,ne=>{try{K(ne)}catch(de){setTimeout(()=>{throw de},0)}})};return z(A,Aw.EventType.OPEN,()=>{F||(Qt(Ra,`RPC '${t}' stream ${l} transport opened.`),j.Qo())}),z(A,Aw.EventType.CLOSE,()=>{F||(F=!0,Qt(Ra,`RPC '${t}' stream ${l} transport closed`),j.Uo())}),z(A,Aw.EventType.ERROR,H=>{F||(F=!0,s0(Ra,`RPC '${t}' stream ${l} transport errored:`,H),j.Uo(new rn(bt.UNAVAILABLE,"The operation could not be completed")))}),z(A,Aw.EventType.MESSAGE,H=>{var te;if(!F){const K=H.data[0];ri(!!K);const ne=K,de=(ne==null?void 0:ne.error)||((te=ne[0])===null||te===void 0?void 0:te.error);if(de){Qt(Ra,`RPC '${t}' stream ${l} received error:`,de);const oe=de.status;let ge=function(J){const se=Ws[J];if(se!==void 0)return xre(se)}(oe),ee=de.message;ge===void 0&&(ge=bt.INTERNAL,ee="Unknown error status: "+oe+" with message "+de.message),F=!0,j.Uo(new rn(ge,ee)),A.close()}else Qt(Ra,`RPC '${t}' stream ${l} received:`,K),j.Ko(K)}}),z(E,Qne.STAT_EVENT,H=>{H.stat===qU.PROXY?Qt(Ra,`RPC '${t}' stream ${l} detected buffering proxy`):H.stat===qU.NOPROXY&&Qt(Ra,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{j.$o()},0),j}}function P2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O1(n){return new _je(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yre{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&Qt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gX="PersistentStream";class Xre{constructor(t,s,a,l,d,f,E,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=E,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Yre(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===bt.RESOURCE_EXHAUSTED?(Pf(s.toString()),Pf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===bt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new rn(bt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return Qt(gX,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(Qt(gX,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class f4e extends Xre{constructor(t,s,a,l,d,f){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=vje(this.serializer,t),a=function(d){if(!("targetChange"in d))return Gn.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?Gn.min():f.readTime?Xh(f.readTime):Gn.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=sV(this.serializer),s.addTarget=function(d,f){let E;const v=f.target;if(E=ZU(v)?{documents:bje(d,v)}:{query:wje(d,v).ht},E.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){E.resumeToken=Vre(d,f.resumeToken);const T=nV(d,f.expectedCount);T!==null&&(E.expectedCount=T)}else if(f.snapshotVersion.compareTo(Gn.min())>0){E.readTime=Nk(d,f.snapshotVersion.toTimestamp());const T=nV(d,f.expectedCount);T!==null&&(E.expectedCount=T)}return E}(this.serializer,t);const a=Cje(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=sV(this.serializer),s.removeTarget=t,this.I_(s)}}class m4e extends Xre{constructor(t,s,a,l,d,f){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return ri(!!t.streamToken),this.lastStreamToken=t.streamToken,ri(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){ri(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=Tje(t.writeResults,t.commitTime),a=Xh(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=sV(this.serializer),this.I_(t)}b_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>Sje(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4e{}class _4e extends g4e{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new rn(bt.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.So(t,rV(s,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===bt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new rn(bt.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,E])=>this.connection.Co(t,rV(s,a),l,f,E,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===bt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new rn(bt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class E4e{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Pf(s),this.N_=!1):Qt("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE="RemoteStore";class y4e{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{xE(this)&&(Qt(OE,"Restarting streams for network reachability change."),await async function(v){const T=qn(v);T.W_.add(4),await tC(T),T.j_.set("Unknown"),T.W_.delete(4),await k1(T)}(this))})}),this.j_=new E4e(a,l)}}async function k1(n){if(xE(n))for(const t of n.G_)await t(!0)}async function tC(n){for(const t of n.G_)await t(!1)}function Jre(n,t){const s=qn(n);s.K_.has(t.targetId)||(s.K_.set(t.targetId,t),Pj(s)?Aj(s):O0(s).c_()&&Ij(s,t))}function Cj(n,t){const s=qn(n),a=O0(s);s.K_.delete(t),a.c_()&&Qre(s,t),s.K_.size===0&&(a.c_()?a.P_():xE(s)&&s.j_.set("Unknown"))}function Ij(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Gn.min())>0){const s=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}O0(n).y_(t)}function Qre(n,t){n.H_.Ne(t),O0(n).w_(t)}function Aj(n){n.H_=new pje({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.K_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),O0(n).start(),n.j_.B_()}function Pj(n){return xE(n)&&!O0(n).u_()&&n.K_.size>0}function xE(n){return qn(n).W_.size===0}function Zre(n){n.H_=void 0}async function v4e(n){n.j_.set("Online")}async function S4e(n){n.K_.forEach((t,s)=>{Ij(n,t)})}async function T4e(n,t){Zre(n),Pj(n)?(n.j_.q_(t),Aj(n)):n.j_.set("Unknown")}async function b4e(n,t,s){if(n.j_.set("Online"),t instanceof Ure&&t.state===2&&t.cause)try{await async function(l,d){const f=d.cause;for(const E of d.targetIds)l.K_.has(E)&&(await l.remoteSyncer.rejectListen(E,f),l.K_.delete(E),l.H_.removeTarget(E))}(n,t)}catch(a){Qt(OE,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await Lk(n,a)}else if(t instanceof YO?n.H_.We(t):t instanceof Mre?n.H_.Ze(t):n.H_.je(t),!s.isEqual(Gn.min()))try{const a=await qre(n.localStore);s.compareTo(a)>=0&&await function(d,f){const E=d.H_.ot(f);return E.targetChanges.forEach((v,T)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.K_.get(T);w&&d.K_.set(T,w.withResumeToken(v.resumeToken,f))}}),E.targetMismatches.forEach((v,T)=>{const w=d.K_.get(v);if(!w)return;d.K_.set(v,w.withResumeToken(ta.EMPTY_BYTE_STRING,w.snapshotVersion)),Qre(d,v);const A=new tg(w.target,v,T,w.sequenceNumber);Ij(d,A)}),d.remoteSyncer.applyRemoteEvent(E)}(n,s)}catch(a){Qt(OE,"Failed to raise snapshot:",a),await Lk(n,a)}}async function Lk(n,t,s){if(!P0(t))throw t;n.W_.add(1),await tC(n),n.j_.set("Offline"),s||(s=()=>qre(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Qt(OE,"Retrying IndexedDB access"),await s(),n.W_.delete(1),await k1(n)})}function eie(n,t){return t().catch(s=>Lk(n,s,t))}async function N1(n){const t=qn(n),s=Sg(t);let a=t.U_.length>0?t.U_[t.U_.length-1].batchId:hj;for(;w4e(t);)try{const l=await s4e(t.localStore,a);if(l===null){t.U_.length===0&&s.P_();break}a=l.batchId,R4e(t,l)}catch(l){await Lk(t,l)}tie(t)&&nie(t)}function w4e(n){return xE(n)&&n.U_.length<10}function R4e(n,t){n.U_.push(t);const s=Sg(n);s.c_()&&s.S_&&s.b_(t.mutations)}function tie(n){return xE(n)&&!Sg(n).u_()&&n.U_.length>0}function nie(n){Sg(n).start()}async function C4e(n){Sg(n).C_()}async function I4e(n){const t=Sg(n);for(const s of n.U_)t.b_(s.mutations)}async function A4e(n,t,s){const a=n.U_.shift(),l=yj.from(a,t,s);await eie(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await N1(n)}async function P4e(n,t){t&&Sg(n).S_&&await async function(a,l){if(function(f){return dje(f)&&f!==bt.ABORTED}(l.code)){const d=a.U_.shift();Sg(a).h_(),await eie(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await N1(a)}}(n,t),tie(n)&&nie(n)}async function _X(n,t){const s=qn(n);s.asyncQueue.verifyOperationInProgress(),Qt(OE,"RemoteStore received new credentials");const a=xE(s);s.W_.add(3),await tC(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await k1(s)}async function O4e(n,t){const s=qn(n);t?(s.W_.delete(2),await k1(s)):t||(s.W_.add(2),await tC(s),s.j_.set("Unknown"))}function O0(n){return n.J_||(n.J_=function(s,a,l){const d=qn(s);return d.M_(),new f4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:v4e.bind(null,n),No:S4e.bind(null,n),Lo:T4e.bind(null,n),p_:b4e.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),Pj(n)?Aj(n):n.j_.set("Unknown")):(await n.J_.stop(),Zre(n))})),n.J_}function Sg(n){return n.Y_||(n.Y_=function(s,a,l){const d=qn(s);return d.M_(),new m4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:C4e.bind(null,n),Lo:P4e.bind(null,n),D_:I4e.bind(null,n),v_:A4e.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await N1(n)):(await n.Y_.stop(),n.U_.length>0&&(Qt(OE,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oj{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new vf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const f=Date.now()+a,E=new Oj(t,s,f,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new rn(bt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function kj(n,t){if(Pf("AsyncQueue",`${t}: ${n}`),P0(n))return new rn(bt.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GS{static emptySet(t){return new GS(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||Sn.comparator(s.key,a.key):(s,a)=>Sn.comparator(s.key,a.key),this.keyedMap=Pw(),this.sortedSet=new cs(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof GS)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new GS;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EX{constructor(){this.Z_=new cs(Sn.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):jn():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class h0{constructor(t,s,a,l,d,f,E,v,T){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=E,this.excludesMetadataChanges=v,this.hasCachedResults=T}static fromInitialDocuments(t,s,a,l,d){const f=[];return s.forEach(E=>{f.push({type:0,doc:E})}),new h0(t,s,GS.emptySet(s),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&R1(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k4e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class N4e{constructor(){this.queries=yX(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=qn(s),d=l.queries;l.queries=yX(),d.forEach((f,E)=>{for(const v of E.ta)v.onError(a)})})(this,new rn(bt.ABORTED,"Firestore shutting down"))}}function yX(){return new LE(n=>Sre(n),R1)}async function rie(n,t){const s=qn(n);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new k4e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(f){const E=kj(f,`Initialization of query '${uS(t.query)}' failed`);return void t.onError(E)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&Nj(s)}async function iie(n,t){const s=qn(n),a=t.query;let l=3;const d=s.queries.get(a);if(d){const f=d.ta.indexOf(t);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function D4e(n,t){const s=qn(n);let a=!1;for(const l of t){const d=l.query,f=s.queries.get(d);if(f){for(const E of f.ta)E.oa(l)&&(a=!0);f.ea=l}}a&&Nj(s)}function L4e(n,t,s){const a=qn(n),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function Nj(n){n.ia.forEach(t=>{t.next()})}var cV,vX;(vX=cV||(cV={}))._a="default",vX.Cache="cache";class sie{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new h0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=h0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==cV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oie{constructor(t){this.key=t}}class aie{constructor(t){this.key=t}}class x4e{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Tr(),this.mutatedKeys=Tr(),this.ya=Tre(t),this.wa=new GS(this.ya)}get Sa(){return this.fa}ba(t,s){const a=s?s.Da:new EX,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,f=l,E=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,T=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((w,A)=>{const N=l.get(w),F=C1(this.query,A)?A:null,j=!!N&&this.mutatedKeys.has(N.key),z=!!F&&(F.hasLocalMutations||this.mutatedKeys.has(F.key)&&F.hasCommittedMutations);let H=!1;N&&F?N.data.isEqual(F.data)?j!==z&&(a.track({type:3,doc:F}),H=!0):this.va(N,F)||(a.track({type:2,doc:F}),H=!0,(v&&this.ya(F,v)>0||T&&this.ya(F,T)<0)&&(E=!0)):!N&&F?(a.track({type:0,doc:F}),H=!0):N&&!F&&(a.track({type:1,doc:N}),H=!0,(v||T)&&(E=!0)),H&&(F?(f=f.add(F),d=z?d.add(w):d.delete(w)):(f=f.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const w=this.query.limitType==="F"?f.last():f.first();f=f.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:f,Da:a,ls:E,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const f=t.Da.X_();f.sort((w,A)=>function(F,j){const z=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return jn()}};return z(F)-z(j)}(w.type,A.type)||this.ya(w.doc,A.doc)),this.Ca(a),l=l!=null&&l;const E=s&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,T=v!==this.ga;return this.ga=v,f.length!==0||T?{snapshot:new h0(this.query,t.wa,d,f,t.mutatedKeys,v===0,T,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:E}:{Ma:E}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new EX,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Tr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new aie(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new oie(a))}),s}Oa(t){this.fa=t.gs,this.pa=Tr();const s=this.ba(t.documents);return this.applyChanges(s,!0)}Na(){return h0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const Dj="SyncEngine";class M4e{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class U4e{constructor(t){this.key=t,this.Ba=!1}}class V4e{constructor(t,s,a,l,d,f){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new LE(E=>Sre(E),R1),this.qa=new Map,this.Qa=new Set,this.$a=new cs(Sn.comparator),this.Ua=new Map,this.Ka=new Tj,this.Wa={},this.Ga=new Map,this.za=d0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function F4e(n,t,s=!0){const a=pie(n);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await cie(a,t,s,!0),l}async function j4e(n,t){const s=pie(n);await cie(s,t,!0,!1)}async function cie(n,t,s,a){const l=await o4e(n.localStore,Yh(t)),d=l.targetId,f=n.sharedClientState.addLocalQueryTarget(d,s);let E;return a&&(E=await B4e(n,t,d,f==="current",l.resumeToken)),n.isPrimaryClient&&s&&Jre(n.remoteStore,l),E}async function B4e(n,t,s,a,l){n.Ha=(A,N,F)=>async function(z,H,te,K){let ne=H.view.ba(te);ne.ls&&(ne=await hX(z.localStore,H.query,!1).then(({documents:ee})=>H.view.ba(ee,ne)));const de=K&&K.targetChanges.get(H.targetId),oe=K&&K.targetMismatches.get(H.targetId)!=null,ge=H.view.applyChanges(ne,z.isPrimaryClient,de,oe);return TX(z,H.targetId,ge.Ma),ge.snapshot}(n,A,N,F);const d=await hX(n.localStore,t,!0),f=new x4e(t,d.gs),E=f.ba(d.documents),v=eC.createSynthesizedTargetChangeForCurrentChange(s,a&&n.onlineState!=="Offline",l),T=f.applyChanges(E,n.isPrimaryClient,v);TX(n,s,T.Ma);const w=new M4e(t,s,f);return n.ka.set(t,w),n.qa.has(s)?n.qa.get(s).push(t):n.qa.set(s,[t]),T.snapshot}async function W4e(n,t,s){const a=qn(n),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!R1(f,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await oV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&Cj(a.remoteStore,l.targetId),lV(a,l.targetId)}).catch(A0)):(lV(a,l.targetId),await oV(a.localStore,l.targetId,!0))}async function z4e(n,t){const s=qn(n),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),Cj(s.remoteStore,a.targetId))}async function G4e(n,t,s){const a=J4e(n);try{const l=await function(f,E){const v=qn(f),T=so.now(),w=E.reduce((F,j)=>F.add(j.key),Tr());let A,N;return v.persistence.runTransaction("Locally write mutations","readwrite",F=>{let j=Of(),z=Tr();return v.ds.getEntries(F,w).next(H=>{j=H,j.forEach((te,K)=>{K.isValidDocument()||(z=z.add(te))})}).next(()=>v.localDocuments.getOverlayedDocuments(F,j)).next(H=>{A=H;const te=[];for(const K of E){const ne=oje(K,A.get(K.key).overlayedDocument);ne!=null&&te.push(new Ag(K.key,ne,pre(ne.value.mapValue),Ad.exists(!0)))}return v.mutationQueue.addMutationBatch(F,T,te,E)}).next(H=>{N=H;const te=H.applyToLocalDocumentSet(A,z);return v.documentOverlayCache.saveOverlays(F,H.batchId,te)})}).then(()=>({batchId:N.batchId,changes:wre(A)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(f,E,v){let T=f.Wa[f.currentUser.toKey()];T||(T=new cs(ur)),T=T.insert(E,v),f.Wa[f.currentUser.toKey()]=T}(a,l.batchId,s),await nC(a,l.changes),await N1(a.remoteStore)}catch(l){const d=kj(l,"Failed to persist write");s.reject(d)}}async function lie(n,t){const s=qn(n);try{const a=await r4e(s.localStore,t);t.targetChanges.forEach((l,d)=>{const f=s.Ua.get(d);f&&(ri(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?ri(f.Ba):l.removedDocuments.size>0&&(ri(f.Ba),f.Ba=!1))}),await nC(s,a,t)}catch(a){await A0(a)}}function SX(n,t,s){const a=qn(n);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,f)=>{const E=f.view.sa(t);E.snapshot&&l.push(E.snapshot)}),function(f,E){const v=qn(f);v.onlineState=E;let T=!1;v.queries.forEach((w,A)=>{for(const N of A.ta)N.sa(E)&&(T=!0)}),T&&Nj(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function H4e(n,t,s){const a=qn(n);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ua.get(t),d=l&&l.key;if(d){let f=new cs(Sn.comparator);f=f.insert(d,Oa.newNoDocument(d,Gn.min()));const E=Tr().add(d),v=new P1(Gn.min(),new Map,new cs(ur),f,E);await lie(a,v),a.$a=a.$a.remove(d),a.Ua.delete(t),Lj(a)}else await oV(a.localStore,t,!1).then(()=>lV(a,t,s)).catch(A0)}async function $4e(n,t){const s=qn(n),a=t.batch.batchId;try{const l=await n4e(s.localStore,t);die(s,a,null),uie(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await nC(s,l)}catch(l){await A0(l)}}async function K4e(n,t,s){const a=qn(n);try{const l=await function(f,E){const v=qn(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",T=>{let w;return v.mutationQueue.lookupMutationBatch(T,E).next(A=>(ri(A!==null),w=A.keys(),v.mutationQueue.removeMutationBatch(T,A))).next(()=>v.mutationQueue.performConsistencyCheck(T)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(T,w,E)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(T,w)).next(()=>v.localDocuments.getDocuments(T,w))})}(a.localStore,t);die(a,t,s),uie(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await nC(a,l)}catch(l){await A0(l)}}function uie(n,t){(n.Ga.get(t)||[]).forEach(s=>{s.resolve()}),n.Ga.delete(t)}function die(n,t,s){const a=qn(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function lV(n,t,s=null){n.sharedClientState.removeLocalQueryTarget(t);for(const a of n.qa.get(t))n.ka.delete(a),s&&n.La.Ja(a,s);n.qa.delete(t),n.isPrimaryClient&&n.Ka.br(t).forEach(a=>{n.Ka.containsKey(a)||hie(n,a)})}function hie(n,t){n.Qa.delete(t.path.canonicalString());const s=n.$a.get(t);s!==null&&(Cj(n.remoteStore,s),n.$a=n.$a.remove(t),n.Ua.delete(s),Lj(n))}function TX(n,t,s){for(const a of s)a instanceof oie?(n.Ka.addReference(a.key,t),q4e(n,a)):a instanceof aie?(Qt(Dj,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,t),n.Ka.containsKey(a.key)||hie(n,a.key)):jn()}function q4e(n,t){const s=t.key,a=s.path.canonicalString();n.$a.get(s)||n.Qa.has(a)||(Qt(Dj,"New document in limbo: "+s),n.Qa.add(a),Lj(n))}function Lj(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const s=new Sn(Wi.fromString(t)),a=n.za.next();n.Ua.set(a,new U4e(s)),n.$a=n.$a.insert(s,a),Jre(n.remoteStore,new tg(Yh(_j(s.path)),a,"TargetPurposeLimboResolution",T1.ae))}}async function nC(n,t,s){const a=qn(n),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((E,v)=>{f.push(a.Ha(v,t,s).then(T=>{var w;if((T||s)&&a.isPrimaryClient){const A=T?!T.fromCache:(w=s==null?void 0:s.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,A?"current":"not-current")}if(T){l.push(T);const A=wj.Yi(v.targetId,T);d.push(A)}}))}),await Promise.all(f),a.La.p_(l),await async function(v,T){const w=qn(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>Tt.forEach(T,N=>Tt.forEach(N.Hi,F=>w.persistence.referenceDelegate.addReference(A,N.targetId,F)).next(()=>Tt.forEach(N.Ji,F=>w.persistence.referenceDelegate.removeReference(A,N.targetId,F)))))}catch(A){if(!P0(A))throw A;Qt(Rj,"Failed to update sequence numbers: "+A)}for(const A of T){const N=A.targetId;if(!A.fromCache){const F=w.Ts.get(N),j=F.snapshotVersion,z=F.withLastLimboFreeSnapshotVersion(j);w.Ts=w.Ts.insert(N,z)}}}(a.localStore,d))}async function Y4e(n,t){const s=qn(n);if(!s.currentUser.isEqual(t)){Qt(Dj,"User change. New user:",t.toKey());const a=await Kre(s.localStore,t);s.currentUser=t,function(d,f){d.Ga.forEach(E=>{E.forEach(v=>{v.reject(new rn(bt.CANCELLED,f))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await nC(s,a.Rs)}}function X4e(n,t){const s=qn(n),a=s.Ua.get(t);if(a&&a.Ba)return Tr().add(a.key);{let l=Tr();const d=s.qa.get(t);if(!d)return l;for(const f of d){const E=s.ka.get(f);l=l.unionWith(E.view.Sa)}return l}}function pie(n){const t=qn(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=lie.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=X4e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=H4e.bind(null,t),t.La.p_=D4e.bind(null,t.eventManager),t.La.Ja=L4e.bind(null,t.eventManager),t}function J4e(n){const t=qn(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=$4e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=K4e.bind(null,t),t}class xk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=O1(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return t4e(this.persistence,new Qje,t.initialUser,this.serializer)}Xa(t){return new $re(bj.ri,this.serializer)}Za(t){return new c4e}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}xk.provider={build:()=>new xk};class Q4e extends xk{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){ri(this.persistence.referenceDelegate instanceof Dk);const a=this.persistence.referenceDelegate.garbageCollector;return new Uje(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?zc.withCacheSize(this.cacheSizeBytes):zc.DEFAULT;return new $re(a=>Dk.ri(a,s),this.serializer)}}class uV{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>SX(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=Y4e.bind(null,this.syncEngine),await O4e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new N4e}()}createDatastore(t){const s=O1(t.databaseInfo.databaseId),a=function(d){return new p4e(d)}(t.databaseInfo);return function(d,f,E,v){return new _4e(d,f,E,v)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,f,E){return new y4e(a,l,d,f,E)}(this.localStore,this.datastore,t.asyncQueue,s=>SX(this.syncEngine,s,0),function(){return mX.D()?new mX:new l4e}())}createSyncEngine(t,s){return function(l,d,f,E,v,T,w){const A=new V4e(l,d,f,E,v,T);return w&&(A.ja=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=qn(l);Qt(OE,"RemoteStore shutting down."),d.W_.add(5),await tC(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}uV.provider={build:()=>new uV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fie{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Pf("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tg="FirestoreClient";class Z4e{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=Aa.UNAUTHENTICATED,this.clientId=rre.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{Qt(Tg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(Qt(Tg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new vf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=kj(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function O2(n,t){n.asyncQueue.verifyOperationInProgress(),Qt(Tg,"Initializing OfflineComponentProvider");const s=n.configuration;await t.initialize(s);let a=s.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Kre(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function bX(n,t){n.asyncQueue.verifyOperationInProgress();const s=await e3e(n);Qt(Tg,"Initializing OnlineComponentProvider"),await t.initialize(s,n.configuration),n.setCredentialChangeListener(a=>_X(t.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>_X(t.remoteStore,l)),n._onlineComponents=t}async function e3e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Qt(Tg,"Using user provided OfflineComponentProvider");try{await O2(n,n._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===bt.FAILED_PRECONDITION||l.code===bt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;s0("Error using user provided cache. Falling back to memory cache: "+s),await O2(n,new xk)}}else Qt(Tg,"Using default OfflineComponentProvider"),await O2(n,new Q4e(void 0));return n._offlineComponents}async function mie(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Qt(Tg,"Using user provided OnlineComponentProvider"),await bX(n,n._uninitializedComponentsProvider._online)):(Qt(Tg,"Using default OnlineComponentProvider"),await bX(n,new uV))),n._onlineComponents}function t3e(n){return mie(n).then(t=>t.syncEngine)}async function gie(n){const t=await mie(n),s=t.eventManager;return s.onListen=F4e.bind(null,t.syncEngine),s.onUnlisten=W4e.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=j4e.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=z4e.bind(null,t.syncEngine),s}function n3e(n,t,s={}){const a=new vf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,E,v,T){const w=new fie({next:N=>{w.su(),f.enqueueAndForget(()=>iie(d,A));const F=N.docs.has(E);!F&&N.fromCache?T.reject(new rn(bt.UNAVAILABLE,"Failed to get document because the client is offline.")):F&&N.fromCache&&v&&v.source==="server"?T.reject(new rn(bt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):T.resolve(N)},error:N=>T.reject(N)}),A=new sie(_j(E.path),w,{includeMetadataChanges:!0,Ta:!0});return rie(d,A)}(await gie(n),n.asyncQueue,t,s,a)),a.promise}function r3e(n,t,s={}){const a=new vf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,E,v,T){const w=new fie({next:N=>{w.su(),f.enqueueAndForget(()=>iie(d,A)),N.fromCache&&v.source==="server"?T.reject(new rn(bt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):T.resolve(N)},error:N=>T.reject(N)}),A=new sie(E,w,{includeMetadataChanges:!0,Ta:!0});return rie(d,A)}(await gie(n),n.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _ie(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wX=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eie(n,t,s){if(!s)throw new rn(bt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function i3e(n,t,s,a){if(t===!0&&a===!0)throw new rn(bt.INVALID_ARGUMENT,`${n} and ${s} cannot be used together.`)}function RX(n){if(!Sn.isDocumentKey(n))throw new rn(bt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function CX(n){if(Sn.isDocumentKey(n))throw new rn(bt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function D1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":jn()}function Zh(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new rn(bt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=D1(n);throw new rn(bt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yie="firestore.googleapis.com",IX=!0;class AX{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new rn(bt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=yie,this.ssl=IX}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:IX;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Hre;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<xje)throw new rn(bt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}i3e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_ie((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new rn(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new rn(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new rn(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class L1{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new AX({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rn(bt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new rn(bt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new AX(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new hFe;switch(a.type){case"firstParty":return new gFe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new rn(bt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=wX.get(s);a&&(Qt("ComponentProvider","Removing Datastore"),wX.delete(s),a.terminate())}(this),Promise.resolve()}}function s3e(n,t,s,a={}){var l;const d=(n=Zh(n,L1))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),E=`${t}:${s}`;d.host!==yie&&d.host!==E&&s0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:E,ssl:!1,emulatorOptions:a});if(!Cf(v,f)&&(n._setSettings(v),a.mockUserToken)){let T,w;if(typeof a.mockUserToken=="string")T=a.mockUserToken,w=Aa.MOCK_USER;else{T=one(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const A=a.mockUserToken.sub||a.mockUserToken.user_id;if(!A)throw new rn(bt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Aa(A)}n._authCredentials=new pFe(new tre(T,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new k0(this.firestore,t,this._query)}}class ic{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lg(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ic(this.firestore,t,this._key)}}class lg extends k0{constructor(t,s,a){super(t,s,_j(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ic(this.firestore,null,new Sn(t))}withConverter(t){return new lg(this.firestore,t,this._path)}}function p0(n,t,...s){if(n=ts(n),Eie("collection","path",t),n instanceof L1){const a=Wi.fromString(t,...s);return CX(a),new lg(n,null,a)}{if(!(n instanceof ic||n instanceof lg))throw new rn(bt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Wi.fromString(t,...s));return CX(a),new lg(n.firestore,null,a)}}function Hi(n,t,...s){if(n=ts(n),arguments.length===1&&(t=rre.newId()),Eie("doc","path",t),n instanceof L1){const a=Wi.fromString(t,...s);return RX(a),new ic(n,null,new Sn(a))}{if(!(n instanceof ic||n instanceof lg))throw new rn(bt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Wi.fromString(t,...s));return RX(a),new ic(n.firestore,n instanceof lg?n.converter:null,new Sn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PX="AsyncQueue";class OX{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Yre(this,"async_queue_retry"),this.Su=()=>{const a=P2();a&&Qt(PX,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=t;const s=P2();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=P2();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new vf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!P0(t))throw t;Qt(PX,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.bu.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let E=f.message||"";return f.stack&&(E=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),E}(a);throw Pf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=Oj.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&jn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.bu,await t;while(t!==this.bu)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}class N0 extends L1{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new OX,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new OX(t),this._firestoreClient=void 0,await t}}}function dV(n,t){const s=typeof n=="object"?n:nj(),a=typeof n=="string"?n:Ck,l=E1(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=rne("firestore");d&&s3e(l,...d)}return l}function xj(n){if(n._terminated)throw new rn(bt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||o3e(n),n._firestoreClient}function o3e(n){var t,s,a;const l=n._freezeSettings(),d=function(E,v,T,w){return new kFe(E,v,T,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,_ie(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new Z4e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(E){const v=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new f0(ta.fromBase64String(t))}catch(s){throw new rn(bt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new f0(ta.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new rn(bt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ea(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rC{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mj{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new rn(bt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new rn(bt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ur(this._lat,t._lat)||ur(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a3e=/^__.*__$/;class c3e{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new Ag(t,this.data,this.fieldMask,s,this.fieldTransforms):new ZR(t,this.data,s,this.fieldTransforms)}}class vie{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new Ag(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function Sie(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw jn()}}class M1{constructor(t,s,a,l,d,f){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new M1(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Uu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return Mk(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Sie(this.Lu)&&a3e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class l3e{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||O1(t)}ju(t,s,a,l=!1){return new M1({Lu:t,methodName:s,zu:a,path:ea.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function U1(n){const t=n._freezeSettings(),s=O1(n._databaseId);return new l3e(n._databaseId,!!t.ignoreUndefinedProperties,s)}function Tie(n,t,s,a,l,d={}){const f=n.ju(d.merge||d.mergeFields?2:0,t,s,l);jj("Data must be an object, but it was:",f,a);const E=wie(a,f);let v,T;if(d.merge)v=new Rl(f.fieldMask),T=f.fieldTransforms;else if(d.mergeFields){const w=[];for(const A of d.mergeFields){const N=hV(t,A,s);if(!f.contains(N))throw new rn(bt.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Cie(w,N)||w.push(N)}v=new Rl(w),T=f.fieldTransforms.filter(A=>v.covers(A.field))}else v=null,T=f.fieldTransforms;return new c3e(new $c(E),v,T)}class V1 extends rC{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof V1}}function bie(n,t,s){return new M1({Lu:3,zu:t.settings.zu,methodName:n._methodName,Qu:s},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Vj extends rC{constructor(t,s){super(t),this.Hu=s}_toFieldTransform(t){const s=bie(this,t,!0),a=this.Hu.map(d=>ME(d,s)),l=new l0(a);return new kre(t.path,l)}isEqual(t){return t instanceof Vj&&Cf(this.Hu,t.Hu)}}class Fj extends rC{constructor(t,s){super(t),this.Hu=s}_toFieldTransform(t){const s=bie(this,t,!0),a=this.Hu.map(d=>ME(d,s)),l=new u0(a);return new kre(t.path,l)}isEqual(t){return t instanceof Fj&&Cf(this.Hu,t.Hu)}}function u3e(n,t,s,a){const l=n.ju(1,t,s);jj("Data must be an object, but it was:",l,a);const d=[],f=$c.empty();Ig(a,(v,T)=>{const w=Bj(t,v,s);T=ts(T);const A=l.Uu(w);if(T instanceof V1)d.push(w);else{const N=ME(T,A);N!=null&&(d.push(w),f.set(w,N))}});const E=new Rl(d);return new vie(f,E,l.fieldTransforms)}function d3e(n,t,s,a,l,d){const f=n.ju(1,t,s),E=[hV(t,a,s)],v=[l];if(d.length%2!=0)throw new rn(bt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)E.push(hV(t,d[N])),v.push(d[N+1]);const T=[],w=$c.empty();for(let N=E.length-1;N>=0;--N)if(!Cie(T,E[N])){const F=E[N];let j=v[N];j=ts(j);const z=f.Uu(F);if(j instanceof V1)T.push(F);else{const H=ME(j,z);H!=null&&(T.push(F),w.set(F,H))}}const A=new Rl(T);return new vie(w,A,f.fieldTransforms)}function h3e(n,t,s,a=!1){return ME(s,n.ju(a?4:3,t))}function ME(n,t){if(Rie(n=ts(n)))return jj("Unsupported field value:",t,n),wie(n,t);if(n instanceof rC)return function(a,l){if(!Sie(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const E of a){let v=ME(E,l.Ku(f));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),f++}return{arrayValue:{values:d}}}(n,t)}return function(a,l){if((a=ts(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return eje(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=so.fromDate(a);return{timestampValue:Nk(l.serializer,d)}}if(a instanceof so){const d=new so(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Nk(l.serializer,d)}}if(a instanceof Mj)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof f0)return{bytesValue:Vre(l.serializer,a._byteString)};if(a instanceof ic){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:Sj(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof Uj)return function(f,E){return{mapValue:{fields:{[dre]:{stringValue:hre},[Ik]:{arrayValue:{values:f.toArray().map(T=>{if(typeof T!="number")throw E.Wu("VectorValues must only contain numeric values.");return Ej(E.serializer,T)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${D1(a)}`)}(n,t)}function wie(n,t){const s={};return sre(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ig(n,(a,l)=>{const d=ME(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function Rie(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof so||n instanceof Mj||n instanceof f0||n instanceof ic||n instanceof rC||n instanceof Uj)}function jj(n,t,s){if(!Rie(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=D1(s);throw a==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+a)}}function hV(n,t,s){if((t=ts(t))instanceof x1)return t._internalPath;if(typeof t=="string")return Bj(n,t);throw Mk("Field path arguments must be of type string or ",n,!1,void 0,s)}const p3e=new RegExp("[~\\*/\\[\\]]");function Bj(n,t,s){if(t.search(p3e)>=0)throw Mk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,s);try{return new x1(...t.split("."))._internalPath}catch{throw Mk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,s)}}function Mk(n,t,s,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let E=`Function ${t}() called with invalid data`;s&&(E+=" (via `toFirestore()`)"),E+=". ";let v="";return(d||f)&&(v+=" (found",d&&(v+=` in field ${a}`),f&&(v+=` in document ${l}`),v+=")"),new rn(bt.INVALID_ARGUMENT,E+n+v)}function Cie(n,t){return n.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iie{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new ic(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new f3e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(Wj("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class f3e extends Iie{data(){return super.data()}}function Wj(n,t){return typeof t=="string"?Bj(n,t):t instanceof x1?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m3e(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new rn(bt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class zj{}class g3e extends zj{}function kX(n,t,...s){let a=[];t instanceof zj&&a.push(t),a=a.concat(s),function(d){const f=d.filter(v=>v instanceof Gj).length,E=d.filter(v=>v instanceof F1).length;if(f>1||f>0&&E>0)throw new rn(bt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class F1 extends g3e{constructor(t,s,a){super(),this._field=t,this._op=s,this._value=a,this.type="where"}static _create(t,s,a){return new F1(t,s,a)}_apply(t){const s=this._parse(t);return Aie(t._query,s),new k0(t.firestore,t.converter,eV(t._query,s))}_parse(t){const s=U1(t.firestore);return function(d,f,E,v,T,w,A){let N;if(T.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new rn(bt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){LX(A,w);const j=[];for(const z of A)j.push(DX(v,d,z));N={arrayValue:{values:j}}}else N=DX(v,d,A)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||LX(A,w),N=h3e(E,f,A,w==="in"||w==="not-in");return $s.create(T,w,N)}(t._query,"where",s,t.firestore._databaseId,this._field,this._op,this._value)}}function NX(n,t,s){const a=t,l=Wj("where",n);return F1._create(l,a,s)}class Gj extends zj{constructor(t,s){super(),this.type=t,this._queryConstraints=s}static _create(t,s){return new Gj(t,s)}_parse(t){const s=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return s.length===1?s[0]:Od.create(s,this._getOperator())}_apply(t){const s=this._parse(t);return s.getFilters().length===0?t:(function(l,d){let f=l;const E=d.getFlattenedFilters();for(const v of E)Aie(f,v),f=eV(f,v)}(t._query,s),new k0(t.firestore,t.converter,eV(t._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function DX(n,t,s){if(typeof(s=ts(s))=="string"){if(s==="")throw new rn(bt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!vre(t)&&s.indexOf("/")!==-1)throw new rn(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const a=t.path.child(Wi.fromString(s));if(!Sn.isDocumentKey(a))throw new rn(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return KY(n,new Sn(a))}if(s instanceof ic)return KY(n,s._key);throw new rn(bt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${D1(s)}.`)}function LX(n,t){if(!Array.isArray(n)||n.length===0)throw new rn(bt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Aie(n,t){const s=function(l,d){for(const f of l)for(const E of f.getFlattenedFilters())if(d.indexOf(E.op)>=0)return E.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(s!==null)throw s===t.op?new rn(bt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new rn(bt.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class _3e{convertValue(t,s="none"){switch(vg(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ls(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(yg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw jn()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return Ig(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[Ik].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>Ls(f.doubleValue));return new Uj(d)}convertGeoPoint(t){return new Mj(Ls(t.latitude),Ls(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=w1(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(wR(t));default:return null}}convertTimestamp(t){const s=Eg(t);return new so(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=Wi.fromString(t);ri(Gre(a));const l=new RR(a.get(1),a.get(3)),d=new Sn(a.popFirst(5));return l.isEqual(s)||Pf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pie(n,t,s){let a;return a=n?s&&(s.merge||s.mergeFields)?n.toFirestore(t,s):n.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Oie extends Iie{constructor(t,s,a,l,d,f){super(t,s,a,l,f),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new XO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(Wj("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class XO extends Oie{data(t={}){return super.data(t)}}class E3e{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new kw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new XO(this._firestore,this._userDataWriter,a.key,a,new kw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new rn(bt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(E=>{const v=new XO(l._firestore,l._userDataWriter,E.doc.key,E.doc,new kw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const v=new XO(l._firestore,l._userDataWriter,E.doc.key,E.doc,new kw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let T=-1,w=-1;return E.type!==0&&(T=f.indexOf(E.doc.key),f=f.delete(E.doc.key)),E.type!==1&&(f=f.add(E.doc),w=f.indexOf(E.doc.key)),{type:y3e(E.type),doc:v,oldIndex:T,newIndex:w}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function y3e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return jn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pu(n){n=Zh(n,ic);const t=Zh(n.firestore,N0);return n3e(xj(t),n._key).then(s=>S3e(t,n,s))}class kie extends _3e{constructor(t){super(),this.firestore=t}convertBytes(t){return new f0(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new ic(this.firestore,null,s)}}function IR(n){n=Zh(n,k0);const t=Zh(n.firestore,N0),s=xj(t),a=new kie(t);return m3e(n._query),r3e(s,n._query).then(l=>new E3e(t,a,n,l))}function Uk(n,t,s){n=Zh(n,ic);const a=Zh(n.firestore,N0),l=Pie(n.converter,t,s);return Hj(a,[Tie(U1(a),"setDoc",n._key,l,n.converter!==null,s).toMutation(n._key,Ad.none())])}function Dl(n,t,s,...a){n=Zh(n,ic);const l=Zh(n.firestore,N0),d=U1(l);let f;return f=typeof(t=ts(t))=="string"||t instanceof x1?d3e(d,"updateDoc",n._key,t,s,a):u3e(d,"updateDoc",n._key,t),Hj(l,[f.toMutation(n._key,Ad.exists(!0))])}function v3e(n,t){const s=Zh(n.firestore,N0),a=Hi(n),l=Pie(n.converter,t);return Hj(s,[Tie(U1(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Ad.exists(!1))]).then(()=>a)}function Hj(n,t){return function(a,l){const d=new vf;return a.asyncQueue.enqueueAndForget(async()=>G4e(await t3e(a),l,d)),d.promise}(xj(n),t)}function S3e(n,t,s){const a=s.docs.get(t._key),l=new kie(n);return new Oie(n,l,t._key,a,new kw(s.hasPendingWrites,s.fromCache),t.converter)}function T3e(...n){return new Vj("arrayUnion",n)}function b3e(...n){return new Fj("arrayRemove",n)}(function(t,s=!0){(function(l){I0=l})(DE),CE(new gg("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),E=new N0(new fFe(a.getProvider("auth-internal")),new _Fe(f,a.getProvider("app-check-internal")),function(T,w){if(!Object.prototype.hasOwnProperty.apply(T.options,["projectId"]))throw new rn(bt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new RR(T.options.projectId,w)}(f,l),f);return d=Object.assign({useFetchStreams:s},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),$h(xY,MY,t),$h(xY,MY,"esm2017")})();var w3e="firebase",R3e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$h(w3e,R3e,"app");const C3e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"9442a472625f44e7b2c5065b9f9b3988",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!0);console.log("import.meta.env:",C3e);const $m={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:$m.apiKey?`${$m.apiKey.substring(0,5)}...`:"missing",authDomain:$m.authDomain,projectId:$m.projectId,storageBucket:$m.storageBucket,messagingSenderId:$m.messagingSenderId?"present":"missing",appId:$m.appId?"present":"missing"});const Nie=lne($m),Die=qne(Nie),Ci=dV(Nie),ep=async n=>{try{Ee.log("userFirestore: Get user Profile data for user ID: "+n);const t=Hi(Ci,"users",n),s=await Pu(t);return s.exists()?(Ee.log("userFirestore: Found Profile for : "+s.data().Nickname),s.data()):(Ee.error("userFirestore: user profile document not found"),null)}catch(t){throw Ee.error("userFirestore: Error fetching user profile data:",t),t}},I3e=async(n,t,s)=>{try{Ee.log("userFirestore: Registering new user with email:",n);const l=(await YUe(Die,n,t)).user;await $U(l),Ee.log("userFirestore: Verification email sent to:",n);const d={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!1,...s};Ee.log("userFirestore: Creating user document with data:",d);const f=Hi(Ci,"users",l.uid);return await Uk(f,d),Ee.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw Ee.error("userFirestore: Error creating user:",a),a}},Lie=async(n,t)=>{try{Ee.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const s=Hi(Ci,"users",n);await Dl(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),Ee.log("userFirestore: rpmURL updated successfully.")}catch(s){throw Ee.error("userFirestore: Error updating rpmURL:",s),s}},A3e=(n,t)=>{if(t==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${t} - Returning true`),!0;if(t==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(n);return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and admin group ${t} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${t} - Returning false`),!1},xie=async(n,t)=>A3e(n,t),P3e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Cd={sendUserToUnity:"sendUserToUnity"};class O3e{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),Ee.log(`EventBus: Published event '${t}'`)):Ee.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const Id=new O3e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mie="firebasestorage.googleapis.com",Uie="storageBucket",k3e=2*60*1e3,N3e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs extends rp{constructor(t,s,a=0){super(k2(t),`Firebase Storage: ${s} (${k2(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Cs.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return k2(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Rs;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Rs||(Rs={}));function k2(n){return"storage/"+n}function $j(){const n="An unknown error occurred, please check the error payload for server response.";return new Cs(Rs.UNKNOWN,n)}function D3e(n){return new Cs(Rs.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function L3e(n){return new Cs(Rs.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function x3e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Cs(Rs.UNAUTHENTICATED,n)}function M3e(){return new Cs(Rs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function U3e(n){return new Cs(Rs.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function V3e(){return new Cs(Rs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function F3e(){return new Cs(Rs.CANCELED,"User canceled the upload/download.")}function j3e(n){return new Cs(Rs.INVALID_URL,"Invalid URL '"+n+"'.")}function B3e(n){return new Cs(Rs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function W3e(){return new Cs(Rs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Uie+"' property when initializing the app?")}function z3e(){return new Cs(Rs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function G3e(){return new Cs(Rs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function H3e(n){return new Cs(Rs.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function pV(n){return new Cs(Rs.INVALID_ARGUMENT,n)}function Vie(){return new Cs(Rs.APP_DELETED,"The Firebase app was deleted.")}function $3e(n){return new Cs(Rs.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Zw(n,t){return new Cs(Rs.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function rw(n){throw new Cs(Rs.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=Cl.makeFromUrl(t,s)}catch{return new Cl(t,"")}if(a.path==="")return a;throw B3e(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(de){de.path.charAt(de.path.length-1)==="/"&&(de.path_=de.path_.slice(0,-1))}const f="(/(.*))?$",E=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function T(de){de.path_=decodeURIComponent(de.path)}const w="v[A-Za-z0-9_]+",A=s.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",F=new RegExp(`^https?://${A}/${w}/b/${l}/o${N}`,"i"),j={bucket:1,path:3},z=s===Mie?"(?:storage.googleapis.com|storage.cloud.google.com)":s,H="([^?#]*)",te=new RegExp(`^https?://${z}/${l}/${H}`,"i"),ne=[{regex:E,indices:v,postModify:d},{regex:F,indices:j,postModify:T},{regex:te,indices:{bucket:1,path:2},postModify:T}];for(let de=0;de<ne.length;de++){const oe=ne[de],ge=oe.regex.exec(t);if(ge){const ee=ge[oe.indices.bucket];let Z=ge[oe.indices.path];Z||(Z=""),a=new Cl(ee,Z),oe.postModify(a);break}}if(a==null)throw j3e(t);return a}}class K3e{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q3e(n,t,s){let a=1,l=null,d=null,f=!1,E=0;function v(){return E===2}let T=!1;function w(...H){T||(T=!0,t.apply(null,H))}function A(H){l=setTimeout(()=>{l=null,n(F,v())},H)}function N(){d&&clearTimeout(d)}function F(H,...te){if(T){N();return}if(H){N(),w.call(null,H,...te);return}if(v()||f){N(),w.call(null,H,...te);return}a<64&&(a*=2);let ne;E===1?(E=2,ne=0):ne=(a+Math.random())*1e3,A(ne)}let j=!1;function z(H){j||(j=!0,N(),!T&&(l!==null?(H||(E=2),clearTimeout(l),A(0)):H||(E=1)))}return A(0),d=setTimeout(()=>{f=!0,z(!0)},s),z}function Y3e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X3e(n){return n!==void 0}function J3e(n){return typeof n=="object"&&!Array.isArray(n)}function Kj(n){return typeof n=="string"||n instanceof String}function xX(n){return qj()&&n instanceof Blob}function qj(){return typeof Blob<"u"}function MX(n,t,s,a){if(a<t)throw pV(`Invalid value for '${n}'. Expected ${t} or greater.`);if(a>s)throw pV(`Invalid value for '${n}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j1(n,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${n}`}function Fie(n){const t=encodeURIComponent;let s="?";for(const a in n)if(n.hasOwnProperty(a)){const l=t(a)+"="+t(n[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var yE;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(yE||(yE={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q3e(n,t){const s=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=t.indexOf(n)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3e{constructor(t,s,a,l,d,f,E,v,T,w,A,N=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=E,this.errorCallback_=v,this.timeout_=T,this.progressCallback_=w,this.connectionFactory_=A,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((F,j)=>{this.resolve_=F,this.reject_=j,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new _O(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=E=>{const v=E.loaded,T=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,T)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const E=d.getErrorCode()===yE.NO_ERROR,v=d.getStatus();if(!E||Q3e(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===yE.ABORT;a(!1,new _O(!1,null,w));return}const T=this.successCodes_.indexOf(v)!==-1;a(!0,new _O(T,d))})},s=(a,l)=>{const d=this.resolve_,f=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(E,E.getResponse());X3e(v)?d(v):d()}catch(v){f(v)}else if(E!==null){const v=$j();v.serverResponse=E.getErrorText(),this.errorCallback_?f(this.errorCallback_(E,v)):f(v)}else if(l.canceled){const v=this.appDelete_?Vie():F3e();f(v)}else{const v=V3e();f(v)}};this.canceled_?s(!1,new _O(!1,null,!0)):this.backoffId_=q3e(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&Y3e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class _O{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function e5e(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function t5e(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function n5e(n,t){t&&(n["X-Firebase-GMPID"]=t)}function r5e(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function i5e(n,t,s,a,l,d,f=!0){const E=Fie(n.urlParams),v=n.url+E,T=Object.assign({},n.headers);return n5e(T,t),e5e(T,s),t5e(T,d),r5e(T,a),new Z3e(v,n.method,T,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s5e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function o5e(...n){const t=s5e();if(t!==void 0){const s=new t;for(let a=0;a<n.length;a++)s.append(n[a]);return s.getBlob()}else{if(qj())return new Blob(n);throw new Cs(Rs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function a5e(n,t,s){return n.webkitSlice?n.webkitSlice(t,s):n.mozSlice?n.mozSlice(t,s):n.slice?n.slice(t,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c5e(n){if(typeof atob>"u")throw H3e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class N2{constructor(t,s){this.data=t,this.contentType=s||null}}function l5e(n,t){switch(n){case Fh.RAW:return new N2(jie(t));case Fh.BASE64:case Fh.BASE64URL:return new N2(Bie(n,t));case Fh.DATA_URL:return new N2(d5e(t),h5e(t))}throw $j()}function jie(n){const t=[];for(let s=0;s<n.length;s++){let a=n.charCodeAt(s);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(s<n.length-1&&(n.charCodeAt(s+1)&64512)===56320))t.push(239,191,189);else{const d=a,f=n.charCodeAt(++s);a=65536|(d&1023)<<10|f&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function u5e(n){let t;try{t=decodeURIComponent(n)}catch{throw Zw(Fh.DATA_URL,"Malformed data URL.")}return jie(t)}function Bie(n,t){switch(n){case Fh.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw Zw(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Fh.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw Zw(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=c5e(t)}catch(l){throw l.message.includes("polyfill")?l:Zw(n,"Invalid character found")}const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}class Wie{constructor(t){this.base64=!1,this.contentType=null;const s=t.match(/^data:([^,]+)?,/);if(s===null)throw Zw(Fh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=s[1]||null;a!=null&&(this.base64=p5e(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function d5e(n){const t=new Wie(n);return t.base64?Bie(Fh.BASE64,t.rest):u5e(t.rest)}function h5e(n){return new Wie(n).contentType}function p5e(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(t,s){let a=0,l="";xX(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(s?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(s?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,s){if(xX(this.data_)){const a=this.data_,l=a5e(a,t,s);return l===null?null:new Zm(l)}else{const a=new Uint8Array(this.data_.buffer,t,s-t);return new Zm(a,!0)}}static getBlob(...t){if(qj()){const s=t.map(a=>a instanceof Zm?a.data_:a);return new Zm(o5e.apply(null,s))}else{const s=t.map(f=>Kj(f)?l5e(Fh.RAW,f).data:f.data_);let a=0;s.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return s.forEach(f=>{for(let E=0;E<f.length;E++)l[d++]=f[E]}),new Zm(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zie(n){let t;try{t=JSON.parse(n)}catch{return null}return J3e(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f5e(n){if(n.length===0)return null;const t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function m5e(n,t){const s=t.split("/").filter(a=>a.length>0).join("/");return n.length===0?s:n+"/"+s}function Gie(n){const t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g5e(n,t){return t}class ec{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||g5e}}let EO=null;function _5e(n){return!Kj(n)||n.length<2?n:Gie(n)}function Hie(){if(EO)return EO;const n=[];n.push(new ec("bucket")),n.push(new ec("generation")),n.push(new ec("metageneration")),n.push(new ec("name","fullPath",!0));function t(d,f){return _5e(f)}const s=new ec("name");s.xform=t,n.push(s);function a(d,f){return f!==void 0?Number(f):f}const l=new ec("size");return l.xform=a,n.push(l),n.push(new ec("timeCreated")),n.push(new ec("updated")),n.push(new ec("md5Hash",null,!0)),n.push(new ec("cacheControl",null,!0)),n.push(new ec("contentDisposition",null,!0)),n.push(new ec("contentEncoding",null,!0)),n.push(new ec("contentLanguage",null,!0)),n.push(new ec("contentType",null,!0)),n.push(new ec("metadata","customMetadata",!0)),EO=n,EO}function E5e(n,t){function s(){const a=n.bucket,l=n.fullPath,d=new Cl(a,l);return t._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:s})}function y5e(n,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const f=s[d];a[f.local]=f.xform(a,t[f.server])}return E5e(a,n),a}function $ie(n,t,s){const a=zie(t);return a===null?null:y5e(n,a,s)}function v5e(n,t,s,a){const l=zie(t);if(l===null||!Kj(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(T=>{const w=n.bucket,A=n.fullPath,N="/b/"+f(w)+"/o/"+f(A),F=j1(N,s,a),j=Fie({alt:"media",token:T});return F+j})[0]}function S5e(n,t){const s={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(s[d.server]=n[d.local])}return JSON.stringify(s)}class Yj{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kie(n){if(!n)throw $j()}function T5e(n,t){function s(a,l){const d=$ie(n,l,t);return Kie(d!==null),d}return s}function b5e(n,t){function s(a,l){const d=$ie(n,l,t);return Kie(d!==null),v5e(d,l,n.host,n._protocol)}return s}function qie(n){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=M3e():l=x3e():s.getStatus()===402?l=L3e(n.bucket):s.getStatus()===403?l=U3e(n.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function Yie(n){const t=qie(n);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=D3e(n.path)),d.serverResponse=l.serverResponse,d}return s}function w5e(n,t,s){const a=t.fullServerUrl(),l=j1(a,n.host,n._protocol),d="GET",f=n.maxOperationRetryTime,E=new Yj(l,d,b5e(n,s),f);return E.errorHandler=Yie(t),E}function R5e(n,t){const s=t.fullServerUrl(),a=j1(s,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function f(v,T){}const E=new Yj(a,l,f,d);return E.successCodes=[200,204],E.errorHandler=Yie(t),E}function C5e(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function I5e(n,t,s){const a=Object.assign({},s);return a.fullPath=n.path,a.size=t.size(),a.contentType||(a.contentType=C5e(null,t)),a}function A5e(n,t,s,a,l){const d=t.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function E(){let ne="";for(let de=0;de<2;de++)ne=ne+Math.random().toString().slice(2);return ne}const v=E();f["Content-Type"]="multipart/related; boundary="+v;const T=I5e(t,a,l),w=S5e(T,s),A="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+T.contentType+`\r
\r
`,N=`\r
--`+v+"--",F=Zm.getBlob(A,a,N);if(F===null)throw z3e();const j={name:T.fullPath},z=j1(d,n.host,n._protocol),H="POST",te=n.maxUploadRetryTime,K=new Yj(z,H,T5e(n,s),te);return K.urlParams=j,K.headers=f,K.body=F.uploadData(),K.errorHandler=qie(t),K}class P5e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=yE.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=yE.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=yE.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw rw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw rw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw rw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw rw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw rw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class O5e extends P5e{initXhr(){this.xhr_.responseType="text"}}function Xj(){return new O5e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(t,s){this._service=t,s instanceof Cl?this._location=s:this._location=Cl.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new kE(t,s)}get root(){const t=new Cl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Gie(this._location.path)}get storage(){return this._service}get parent(){const t=f5e(this._location.path);if(t===null)return null;const s=new Cl(this._location.bucket,t);return new kE(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw $3e(t)}}function k5e(n,t,s){n._throwIfRoot("uploadBytes");const a=A5e(n.storage,n._location,Hie(),new Zm(t,!0),s);return n.storage.makeRequestWithTokens(a,Xj).then(l=>({metadata:l,ref:n}))}function N5e(n){n._throwIfRoot("getDownloadURL");const t=w5e(n.storage,n._location,Hie());return n.storage.makeRequestWithTokens(t,Xj).then(s=>{if(s===null)throw G3e();return s})}function D5e(n){n._throwIfRoot("deleteObject");const t=R5e(n.storage,n._location);return n.storage.makeRequestWithTokens(t,Xj)}function L5e(n,t){const s=m5e(n._location.path,t),a=new Cl(n._location.bucket,s);return new kE(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x5e(n){return/^[A-Za-z]+:\/\//.test(n)}function M5e(n,t){return new kE(n,t)}function Xie(n,t){if(n instanceof Jj){const s=n;if(s._bucket==null)throw W3e();const a=new kE(s,s._bucket);return t!=null?Xie(a,t):a}else return t!==void 0?L5e(n,t):n}function U5e(n,t){if(t&&x5e(t)){if(n instanceof Jj)return M5e(n,t);throw pV("To use ref(service, url), the first argument must be a Storage instance.")}else return Xie(n,t)}function UX(n,t){const s=t==null?void 0:t[Uie];return s==null?null:Cl.makeFromBucketSpec(s,n)}function V5e(n,t,s,a={}){n.host=`${t}:${s}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:one(l,n.app.options.projectId))}class Jj{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=Mie,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=k3e,this._maxUploadRetryTime=N3e,this._requests=new Set,l!=null?this._bucket=Cl.makeFromBucketSpec(l,this._host):this._bucket=UX(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Cl.makeFromBucketSpec(this._url,t):this._bucket=UX(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){MX("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){MX("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(wl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new kE(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new K3e(Vie());{const f=i5e(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const VX="@firebase/storage",FX="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jie="storage";function Qj(n,t,s){return n=ts(n),k5e(n,t,s)}function B1(n){return n=ts(n),N5e(n)}function Zj(n){return n=ts(n),D5e(n)}function UE(n,t){return n=ts(n),U5e(n,t)}function VE(n=nj(),t){n=ts(n);const a=E1(n,Jie).getImmediate({identifier:t}),l=rne("storage");return l&&F5e(a,...l),a}function F5e(n,t,s,a={}){V5e(n,t,s,a)}function j5e(n,{instanceIdentifier:t}){const s=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new Jj(s,a,l,t,DE)}function B5e(){CE(new gg(Jie,j5e,"PUBLIC").setMultipleInstances(!0)),$h(VX,FX,""),$h(VX,FX,"esm2017")}B5e();const JO=async n=>{const t=VE(),s=UE(t,n);try{return await B1(s)}catch(a){throw Ee.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let AR={};const ug=async n=>{try{const t=Hi(Ci,"spaces",n),s=await Pu(t);if(s.exists()){let a=s.data();const l=a.name,d=a.description;if(a.webglBuildId){const f=Hi(Ci,"webglBuilds",a.webglBuildId),E=await Pu(f);if(E.exists()){const v=E.data();a={...a,...v,name:l||v.name,description:d||v.description}}else Ee.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await W5e(a),a=z5e(a),console.log("Space data:",a),Ee.log(`spacesFirestore: Caching space data for: ${n}`),AR[n]=a,a}else return Ee.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(t){throw Ee.error("spacesFirestore: Error fetching item data:",t),t}},W5e=async n=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await JO(l))});return await Promise.all(s),n},z5e=n=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let D2={};const Qie=async n=>{Ee.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(D2[n])return Ee.log("spacesFirestore: Returning cached videos for space:",n),D2[n];const t=p0(Ci,`spaces/${n}/videos`),s=await IR(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),D2[n]=a,a}catch(t){throw Ee.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},G5e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=VE(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,f=UE(s,`spaces/${n}/logo/${d}`);Ee.log(`Uploading logo for space ${n}`);const E=await Qj(f,t),v=await B1(E.ref),T=Hi(Ci,"spaces",n);return await Dl(T,{logoUrl:v,logoGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),Ee.log(`Successfully uploaded logo for space ${n}`),v}catch(s){throw Ee.error("Error uploading space logo:",s),s}},H5e=async n=>{try{const t=Hi(Ci,"spaces",n),s=await Pu(t);if(!s.exists())return Ee.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.logoGsUrl){const l=VE(),d=UE(l,a.logoGsUrl);try{await Zj(d),Ee.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){Ee.warn(`Could not delete logo file from storage: ${f.message}`)}}return await Dl(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),Ee.log(`Successfully removed logo for space ${n}`),!0}catch(t){throw Ee.error("Error deleting space logo:",t),t}},$5e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=VE(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,f=UE(s,`spaces/${n}/background/${d}`);Ee.log(`Uploading background for space ${n}`);const E=await Qj(f,t),v=await B1(E.ref),T=Hi(Ci,"spaces",n);return await Dl(T,{backgroundUrl:v,backgroundGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${E.ref.bucket}/${E.ref.fullPath}`,updatedAt:new Date().toISOString()}),Ee.log(`Successfully uploaded background for space ${n}`),v}catch(s){throw Ee.error("Error uploading space background:",s),s}},K5e=async n=>{try{const t=Hi(Ci,"spaces",n),s=await Pu(t);if(!s.exists())return Ee.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.backgroundGsUrl){const l=VE(),d=UE(l,a.backgroundGsUrl);try{await Zj(d),Ee.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){Ee.warn(`Could not delete background file from storage: ${f.message}`)}}return await Dl(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),Ee.log(`Successfully removed background references for space ${n}`),!0}catch(t){throw Ee.error("Error deleting space background:",t),t}},q5e=async(n,t)=>{try{Ee.log(`spacesFirestore: Updating settings for space: ${n}`,t);const s=Hi(Ci,"spaces",n),a=await Pu(s);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Dl(s,d),AR[n]&&delete AR[n],Ee.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(s){throw Ee.error(`spacesFirestore: Error updating settings for space: ${n}`,s),s}},Y5e=async(n,t)=>{try{Ee.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${n}`);const s=Hi(Ci,"spaces",n);if(!(await Pu(s)).exists())throw new Error(`Space with ID ${n} not found`);await Dl(s,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),AR[n]&&delete AR[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:t}})),Ee.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(s){throw Ee.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,s),s}},Ll=L.createContext(null),X5e=({children:n})=>{const[t,s]=L.useState(null),a=L.useRef(null),[l,d]=L.useState(!0),f=qne(),E=K=>K?K.Nickname?K.Nickname:`${K.firstName} ${K.lastName}`:"Anon";L.useEffect(()=>{const K=ZUe(f,async ne=>{if(Ee.log("UserProvider: Firebase onAuthStateChanged() fired"),ne)try{const de=await ep(ne.uid),oe=E(de),ge={uid:ne.uid,email:ne.email,emailVerified:ne.emailVerified,...de,displayName:oe};console.log(ge),s(ge),a.current=ge,A(ge)}catch(de){Ee.error("UserProvider: Error fetching user profile data:",de)}else s(null),a.current=null;d(!1)});return()=>{K&&K()}},[]);const v=async(K,ne,de)=>{try{const{firstName:oe,lastName:ge}=de,ee=`${oe}${ge.charAt(0).toUpperCase()}`,Z={...de,Nickname:ee,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},J=await I3e(K,ne,Z),se=E(Z),he={uid:J.uid,email:J.email,...Z,displayName:se};return s(he),a.current=he,Ee.log("UserProvider: User registered successfully with groups:",Z.groups),he}catch(oe){throw Ee.error("UserProvider: Error creating user:",oe),oe}},T=async(K,ne)=>{try{const de=await XUe(f,K,ne);if(!de.user.emailVerified)throw await $U(de.user),Ee.log("UserProvider: Verification email sent again to:",K),new Error("Please verify your email before signing in. A new verification email has been sent.");const oe=await ep(de.user.uid),ge=E(oe),ee={uid:de.user.uid,email:de.user.email,emailVerified:de.user.emailVerified,...oe,displayName:ge};s(ee),A(ee)}catch(de){throw Ee.error("UserProvider: Error signing in:",de),de}},w=async()=>{try{await eVe(f),s(null),Ee.log("UserProvider: User signed out.")}catch(K){throw Ee.error("UserProvider: Error signing out:",K),K}},A=()=>{const K=a.current;if(K){const ne=N(K);Ee.log("UserProvider: sendUserToUnity() using the eventBus",ne),Id.publish(Cd.sendUserToUnity,ne)}else Ee.log("UserProvider: No current user to send to Unity.")},N=K=>{const ne={};return[...P3e,"uid"].forEach(oe=>{K.hasOwnProperty(oe)&&(ne[oe]=K[oe])}),ne},F=async K=>!t||!t.uid?!1:await xie(t.uid,K),j=async K=>{if(!t||!t.uid)return!1;try{const ne=await ug(K);if(ne.usersAllowed.includes(t.uid)||ne.userAdmin.includes(t.uid)||ne.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const oe=`space_${K}_owners`,ge=`space_${K}_hosts`;if(t.groups.includes(oe)||t.groups.includes(ge))return Ee.log(`UserProvider: User ${t.uid} has access to space ${K} as owner/host`),!0}return ne.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(ne){return Ee.error("UserProvider: Error verifying user access to space:",ne),!1}},z=async K=>{if(!t||!t.uid)return!1;try{return(await ug(K)).userAdmin.includes(t.uid)}catch(ne){return Ee.error("UserProvider: Error verifying user admin status for space:",ne),!1}},H=async K=>{if(!t||!t.uid)return!1;try{return(await ug(K)).usersModerators.includes(t.uid)}catch(ne){return Ee.error("UserProvider: Error verifying user moderator status for space:",ne),!1}},te=async()=>{try{const K=f.currentUser;return K&&!K.emailVerified?(await $U(K),Ee.log("UserProvider: Verification email resent to:",K.email),!0):!1}catch(K){throw Ee.error("UserProvider: Error resending verification email:",K),K}};return I.jsx(Ll.Provider,{value:{user:t,loading:l,register:v,signIn:T,signOut:w,sendUserToUnity:A,isUserInGroup:F,userHasAccessToSpace:j,userIsAdminOfSpace:z,userIsModeratorOfSpace:H,resendVerificationEmail:te},children:n})},Zie=L.createContext(),Nd=()=>L.useContext(Zie),J5e=({children:n})=>{const[t,s]=L.useState(!1),a=L.useRef(null),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{const T=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(T)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=L.useCallback(v=>{a.current=v},[]),E=L.useCallback(()=>{const v=a.current;if(!v)return;const T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),s(!0);return}catch(A){console.error("iOS fullscreen error:",A)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),s(!0);return}}catch(A){console.error("iOS fallback fullscreen error:",A)}}if(/Android/i.test(navigator.userAgent))try{T?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),s(!0));return}catch(A){console.error("Android fullscreen error:",A)}}try{T?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{s(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),s(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),s(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),s(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return L.useEffect(()=>{const v=()=>{const T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!T)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),I.jsx(Zie.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:I.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})};var L2={},iw={},sw={},jX;function Q5e(){if(jX)return sw;jX=1,Object.defineProperty(sw,"__esModule",{value:!0}),sw.useUnityCanvasId=void 0;var n=Cu(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[s,++t].join("-")},[]);return d};return sw.useUnityCanvasId=a,sw}var tf={},ow={},BX;function ese(){if(BX)return ow;BX=1,Object.defineProperty(ow,"__esModule",{value:!0}),ow.UnityLoaderStatus=void 0;var n;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(n||(ow.UnityLoaderStatus=n={})),ow}var aw={},WX;function e4(){return WX||(WX=1,Object.defineProperty(aw,"__esModule",{value:!0}),aw.isBrowserEnvironment=void 0,aw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),aw}var zX;function Z5e(){if(zX)return tf;zX=1;var n=tf&&tf.__awaiter||function(f,E,v,T){function w(A){return A instanceof v?A:new v(function(N){N(A)})}return new(v||(v=Promise))(function(A,N){function F(H){try{z(T.next(H))}catch(te){N(te)}}function j(H){try{z(T.throw(H))}catch(te){N(te)}}function z(H){H.done?A(H.value):w(H.value).then(F,j)}z((T=T.apply(f,E||[])).next())})},t=tf&&tf.__generator||function(f,E){var v={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},T,w,A,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=F(0),N.throw=F(1),N.return=F(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function F(z){return function(H){return j([z,H])}}function j(z){if(T)throw new TypeError("Generator is already executing.");for(;N&&(N=0,z[0]&&(v=0)),v;)try{if(T=1,w&&(A=z[0]&2?w.return:z[0]?w.throw||((A=w.return)&&A.call(w),0):w.next)&&!(A=A.call(w,z[1])).done)return A;switch(w=0,A&&(z=[z[0]&2,A.value]),z[0]){case 0:case 1:A=z;break;case 4:return v.label++,{value:z[1],done:!1};case 5:v.label++,w=z[1],z=[0];continue;case 7:z=v.ops.pop(),v.trys.pop();continue;default:if(A=v.trys,!(A=A.length>0&&A[A.length-1])&&(z[0]===6||z[0]===2)){v=0;continue}if(z[0]===3&&(!A||z[1]>A[0]&&z[1]<A[3])){v.label=z[1];break}if(z[0]===6&&v.label<A[1]){v.label=A[1],A=z;break}if(A&&v.label<A[2]){v.label=A[2],v.ops.push(z);break}A[2]&&v.ops.pop(),v.trys.pop();continue}z=E.call(f,v)}catch(H){z=[6,H],w=0}finally{T=A=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}};Object.defineProperty(tf,"__esModule",{value:!0}),tf.useUnityInstance=void 0;var s=Cu(),a=ese(),l=e4(),d=function(f,E,v,T){(0,s.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,A;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||E===null)return T.setUnityInstance(null),T.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(E,v,T.setLoadingProgression)];case 2:return w=N.sent(),T.setUnityInstance(w),T.setInitialisationError(null),[3,4];case 3:return A=N.sent(),T.setUnityInstance(null),T.setInitialisationError(A),[3,4];case 4:return[2]}})})})()},[f,E,v,T])};return tf.useUnityInstance=d,tf}var cw={},GX;function eBe(){if(GX)return cw;GX=1,Object.defineProperty(cw,"__esModule",{value:!0}),cw.useUnityArguments=void 0;var n=Cu(),t=function(s){return(0,n.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return cw.useUnityArguments=t,cw}var lw={},HX;function tBe(){if(HX)return lw;HX=1,Object.defineProperty(lw,"__esModule",{value:!0}),lw.useUnityLoader=void 0;var n=Cu(),t=e4(),s=ese(),a=function(l){var d=(0,n.useState)(s.UnityLoaderStatus.Loading),f=d[0],E=d[1];return(0,n.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(s.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):E(v.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var T=function(w){return E(w.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return v.addEventListener("load",T),v.addEventListener("error",T),function(){v!==null&&(v.removeEventListener("load",T),v.removeEventListener("error",T),window.document.body.removeChild(v))}}},[l.loaderUrl]),f};return lw.useUnityLoader=a,lw}var $X;function nBe(){if($X)return iw;$X=1,Object.defineProperty(iw,"__esModule",{value:!0}),iw.Unity=void 0;var n=Cu(),t=Cu(),s=Q5e(),a=Z5e(),l=eBe(),d=tBe(),f=(0,t.forwardRef)(function(E,v){var T=(0,t.useRef)(null),w=(0,s.useUnityCanvasId)(E),A=(0,l.useUnityArguments)(E),N=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,T.current,A,E.unityProvider),(0,n.useImperativeHandle)(v,function(){return T.current}),(0,n.createElement)("canvas",{ref:T,id:w,style:E.style,className:E.className,tabIndex:E.tabIndex})});return iw.Unity=f,iw}var nf={},uw={},KX;function tse(){if(KX)return uw;KX=1,Object.defineProperty(uw,"__esModule",{value:!0}),uw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return uw.errorMessages=n,uw}var Z_={},qX;function rBe(){if(qX)return Z_;qX=1;var n=Z_&&Z_.__spreadArray||function(E,v,T){if(T||arguments.length===2)for(var w=0,A=v.length,N;w<A;w++)(N||!(w in v))&&(N||(N=Array.prototype.slice.call(v,0,w)),N[w]=v[w]);return E.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(Z_,"__esModule",{value:!0}),Z_.useEventSystem=void 0;var t=Cu(),s=tse(),a=e4(),l=[],d=function(E){for(var v=[],T=1;T<arguments.length;T++)v[T-1]=arguments[T];var w=void 0;return l.forEach(function(A){w=A.apply(void 0,n([E],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var f=function(){var E=(0,t.useRef)([]),v=(0,t.useCallback)(function(A,N){E.current=n(n([],E.current,!0),[{eventName:A,callback:N}],!1)},[E]),T=(0,t.useCallback)(function(A,N){E.current=E.current.filter(function(F){return F.eventName!==A&&F.callback!==N})},[E]),w=(0,t.useCallback)(function(A){for(var N=[],F=1;F<arguments.length;F++)N[F-1]=arguments[F];var j=E.current.find(function(z){return z.eventName===A});if(typeof j>"u"){console.warn(s.errorMessages.noEventListener,{eventName:A});return}return j.callback.apply(j,N)},[E]);return(0,t.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:T}};return Z_.useEventSystem=f,Z_}var dw={},YX;function iBe(){if(YX)return dw;YX=1,Object.defineProperty(dw,"__esModule",{value:!0}),dw.useNullableState=void 0;var n=Cu(),t=function(s){return(0,n.useState)(s||null)};return dw.useNullableState=t,dw}var XX;function sBe(){if(XX)return nf;XX=1;var n=nf&&nf.__awaiter||function(E,v,T,w){function A(N){return N instanceof T?N:new T(function(F){F(N)})}return new(T||(T=Promise))(function(N,F){function j(te){try{H(w.next(te))}catch(K){F(K)}}function z(te){try{H(w.throw(te))}catch(K){F(K)}}function H(te){te.done?N(te.value):A(te.value).then(j,z)}H((w=w.apply(E,v||[])).next())})},t=nf&&nf.__generator||function(E,v){var T={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},w,A,N,F=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return F.next=j(0),F.throw=j(1),F.return=j(2),typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function j(H){return function(te){return z([H,te])}}function z(H){if(w)throw new TypeError("Generator is already executing.");for(;F&&(F=0,H[0]&&(T=0)),T;)try{if(w=1,A&&(N=H[0]&2?A.return:H[0]?A.throw||((N=A.return)&&N.call(A),0):A.next)&&!(N=N.call(A,H[1])).done)return N;switch(A=0,N&&(H=[H[0]&2,N.value]),H[0]){case 0:case 1:N=H;break;case 4:return T.label++,{value:H[1],done:!1};case 5:T.label++,A=H[1],H=[0];continue;case 7:H=T.ops.pop(),T.trys.pop();continue;default:if(N=T.trys,!(N=N.length>0&&N[N.length-1])&&(H[0]===6||H[0]===2)){T=0;continue}if(H[0]===3&&(!N||H[1]>N[0]&&H[1]<N[3])){T.label=H[1];break}if(H[0]===6&&T.label<N[1]){T.label=N[1],N=H;break}if(N&&T.label<N[2]){T.label=N[2],T.ops.push(H);break}N[2]&&T.ops.pop(),T.trys.pop();continue}H=v.call(E,T)}catch(te){H=[6,te],A=0}finally{w=N=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}};Object.defineProperty(nf,"__esModule",{value:!0}),nf.useUnityContext=void 0;var s=Cu(),a=tse(),l=rBe(),d=iBe(),f=function(E){var v=(0,d.useNullableState)(),T=v[0],w=v[1],A=(0,s.useState)(0),N=A[0],F=A[1],j=(0,s.useState)(!1),z=j[0],H=j[1],te=(0,d.useNullableState)(),K=te[0],ne=te[1],de=(0,l.useEventSystem)(),oe=(0,s.useRef)({setLoadingProgression:F,setInitialisationError:ne,setUnityInstance:w,setIsLoaded:H,unityConfig:E}),ge=(0,s.useCallback)(function(pe){if(T===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}T.SetFullscreen(pe===!0?1:0)},[T]),ee=(0,s.useCallback)(function(){if(T===null||typeof T.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return T.Module.canvas.requestPointerLock()},[T]),Z=(0,s.useCallback)(function(pe,le,Me){if(T===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}T.SendMessage(pe,le,Me)},[T]),J=(0,s.useCallback)(function(pe,le){if(T===null||typeof T.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return T.Module.canvas.toDataURL(pe,le)},[T]),se=(0,s.useCallback)(function(){return T===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):T.Quit()},[T]),he=(0,s.useCallback)(function(){return n(void 0,void 0,void 0,function(){var pe;return t(this,function(le){switch(le.label){case 0:return T===null||typeof T.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(pe=T.Module.canvas,document.body.appendChild(pe),pe.style.display="none",[4,se()]);case 1:return le.sent(),pe.remove(),[2]}})})},[T]);return(0,s.useEffect)(function(){H(N===1)},[N]),{unityProvider:oe.current,loadingProgression:N,initialisationError:K,isLoaded:z,UNSAFE__unityInstance:T,requestFullscreen:ge,requestPointerLock:ee,sendMessage:Z,takeScreenshot:J,unload:se,UNSAFE__detachAndUnloadImmediate:he,addEventListener:de.addEventListener,removeEventListener:de.removeEventListener}};return nf.useUnityContext=f,nf}var JX;function oBe(){return JX||(JX=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var t=nBe();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=sBe();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(L2)),L2}var nse=oBe();const Td="[UnityProvider]",fV=L.createContext(),aBe=({spaceID:n,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:E,showDisruptiveLogo:v})=>{Ee.log(`${Td} Initializing with spaceID:`,n),Ee.log(`${Td} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:T,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:F,removeEventListener:j,error:z}=nse.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),H={unityProvider:T,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:F,removeEventListener:j,error:z,spaceID:n},te=L.useRef(null),K=L.useRef(Date.now());L.useEffect(()=>{const ge=()=>{document.hidden?(Ee.log(`${Td} Page hidden, starting keep-alive`),ne()):(Ee.log(`${Td} Page visible, stopping keep-alive`),de())};return document.addEventListener("visibilitychange",ge),()=>{document.removeEventListener("visibilitychange",ge),de()}},[]),L.useEffect(()=>{const ge=()=>{K.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ge),window.addEventListener("keydown",ge),window.addEventListener("touchstart",ge),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("keydown",ge),window.removeEventListener("touchstart",ge)}},[N]);const ne=()=>{te.current||(te.current=setInterval(()=>{A&&document.hidden&&(N("WebGLInputManager","KeepAlive"),Ee.debug(`${Td} Sent keep-alive message`))},1e4))},de=()=>{te.current&&(clearInterval(te.current),te.current=null)};L.useEffect(()=>(Ee.log(`${Td} Component mounted`),()=>{Ee.log(`${Td} Component unmounting`),de()}),[]),L.useEffect(()=>{Ee.log(`${Td} Loading progress:`,w)},[w]),L.useEffect(()=>{A&&(Ee.log(`${Td} Unity instance loaded for:`,n),document.hidden&&ne())},[A,n]),L.useEffect(()=>{z&&Ee.error(`${Td} Unity error:`,z)},[z]),Ee.log(`${Td} Rendering provider with instance:`,H),L.useEffect(()=>{Ee.log("UnityProvider: Unity build URLs:",{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d})},[s,a,l,d]);const oe=[];if(s||oe.push("loaderUrl"),a||oe.push("dataUrl"),l||oe.push("frameworkUrl"),d||oe.push("codeUrl"),oe.length>0)return Ee.error(`UnityProvider: Missing required Unity build URLs: ${oe.join(", ")}`),I.jsx(fV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${oe.join(", ")}`),spaceID:n},children:t});try{return L.useEffect(()=>{Ee.log("UnityProvider: Unity context created:",T),T?Ee.log("UnityProvider: Unity provider is available"):Ee.error("UnityProvider: Unity provider is not available"),A?Ee.log("UnityProvider: Unity is loaded"):Ee.log("UnityProvider: Unity is not loaded yet")},[T,A]),I.jsx(fV.Provider,{value:H,children:t})}catch(ge){return Ee.error("UnityProvider: Error creating Unity context:",ge),I.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[I.jsx("h3",{children:"Unity Error"}),I.jsxs("p",{children:["Error creating Unity context: ",ge.message]}),I.jsx("p",{children:"Please check the console for more details."})]})}},Qc=()=>L.useContext(fV),Pg=()=>{const{sendMessage:n,isLoaded:t}=Qc(),s=L.useRef([]),a=L.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:f}=s.current.shift();Ee.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(E){Ee.error("useSendUnityEvent: Error sending event to Unity:",E),s.current.unshift({eventName:d,data:f});break}}},[n,t]);return L.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),L.useCallback((d,f)=>{Ee.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:f}),a()},[a])},Lf=()=>{const{addEventListener:n,removeEventListener:t}=Qc();return L.useCallback((s,a)=>{const l=d=>{Ee.log(s+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(E){Ee.warn("Failed to parse JSON data from Unity message:",E)}a(f)};return n(s,l),()=>{t(s,l)}},[n,t])},cBe=()=>{const[n,t]=L.useState(!1),s=Lf();return L.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{Ee.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),n},lBe=n=>{const[t,s]=L.useState(null),a=Lf(),{spaceID:l}=Qc();return L.useEffect(()=>{let f=!0;const v=a("PlayVideo",async T=>{try{const{gameObjectName:w}=T;if(!w){Ee.error("Game object name is missing in Unity event data.");return}const A=await Qie(l);Ee.log("SPACES VIDEOS",A);const N=A.find(F=>F.id===w);N&&f?(s(N.url),Ee.log("Video URL set to:",N.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{f=!1,v()}},[a,l,n]),[t,()=>{s(null)}]},uBe=()=>{const n=Lf(),{sendUserToUnity:t}=L.useContext(Ll);return L.useEffect(()=>{const a=n("RequestUserForUnity",()=>{Ee.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[n,t]),!0},dBe=()=>{const{spaceID:n}=Qc(),t=Pg(),[s,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Ee.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{Ee.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!s){Ee.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}Ee.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await Qie(n),f=async T=>{const w=`https://vimeo.com/api/oembed.json?url=${T}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch thumbnail: ${A.statusText}`);const N=await A.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let z=null;for(let H of j){const te=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(te,{method:"HEAD"})).ok){z=te;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${te}`,K)}}return z||N.thumbnail_url},E=d.map(async T=>{const w=await f(T.url);return{gameObjectName:T.id,thumbnailUrl:w}}),v=await Promise.all(E);Ee.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:T,thumbnailUrl:w})=>{t("SetThumbnail",{gameObjectName:T,thumbnailUrl:w})})}catch(d){Ee.error("Error fetching thumbnails:",d)}})()},[t,n,s])},hBe=()=>{const[n,t]=L.useState(null),s=Lf();return console.log(" Nameplate click hook initialized"),L.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof f=="string"?JSON.parse(f):f;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[n,()=>{console.log(" Resetting nameplate data"),t(null)}]},rse=()=>{const[n,t]=L.useState([]),s=Lf();return L.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(Ee.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=F=>{if(a){Ee.log("UpdatePlayerList unity message received.");try{let j=[];if(typeof F=="object"&&F!==null?j=F.players||[]:j=JSON.parse(F).players||[],Array.isArray(j)){const z=Array.from(new Map(j.map(H=>[H.playerId,H])).values());t(z),l&&(clearTimeout(l),l=null)}}catch(j){Ee.error("Error handling player list data:",j),l||(l=setTimeout(d,1e3))}}},E=()=>{Ee.log("Player disconnected, requesting fresh player list"),d()},v=()=>{Ee.log("Player left, requesting fresh player list"),d()};d();const T=s("UpdatePlayerList",f),w=s("PlayerDisconnected",E),A=s("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof T=="function"&&T(),typeof w=="function"&&w(),typeof A=="function"&&A(),clearInterval(N)}},[s]),n},QX=async(n,t,s,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!n||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let E=null;if(s){if(!s.type.startsWith("image/"))throw new Error("File must be an image");const v=VE(),T=Date.now(),w=s.name.split(".").pop(),A=`${t}_${T}.${w}`,N=UE(v,`spaces/${n}/mediaScreens/${A}`);Ee.log(`Uploading image for media screen ${t} in space ${n}`);const F=await Qj(N,s);E=await B1(F.ref);const j=Hi(Ci,`spaces/${n}/mediaScreens`,t);await Uk(j,{imageUrl:E,gsUrl:`gs://${F.ref.bucket}/${F.ref.fullPath}`,fileName:A,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){E=f;const v=Hi(Ci,`spaces/${n}/mediaScreens`,t);await Uk(v,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return Ee.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),E}catch(l){throw Ee.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},t4=async n=>{Ee.log(`Getting media screen images for space: ${n}`);try{const t=p0(Ci,`spaces/${n}/mediaScreens`),s=await IR(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw Ee.error("Error fetching media screen images from Firestore:",t),t}},ff=async(n,t)=>{try{const s=Hi(Ci,`spaces/${n}/mediaScreens`,t),a=await Pu(s);return a.exists()?{id:a.id,...a.data()}:(Ee.warn(`No media screen found with ID: ${t}`),null)}catch(s){throw Ee.error("Error fetching media screen image:",s),s}},pBe=async(n,t)=>{try{const s=await ff(n,t);if(!s)return Ee.warn(`No media screen found with ID: ${t} to delete`),!1;if(s.gsUrl){const l=VE(),d=UE(l,s.gsUrl);try{await Zj(d),Ee.log(`Deleted file from storage: ${s.gsUrl}`)}catch(f){Ee.warn(`Could not delete file from storage: ${f.message}`)}}const a=Hi(Ci,`spaces/${n}/mediaScreens`,t);return s.mediaType==="video"?(await Dl(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Ee.log(`Successfully removed video for media screen ${t}`)):(await Dl(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Ee.log(`Successfully removed image for media screen ${t}`)),!0}catch(s){throw Ee.error("Error deleting media screen image:",s),s}},fBe=async(n,t,s)=>{try{if(!n||!t||typeof s!="boolean")throw new Error("Missing or invalid required parameters");const a=await ff(n,t);if(!a||!a.imageUrl&&!a.videoUrl)return Ee.warn(`No media screen content found with ID: ${t} to update`),!1;const l=Hi(Ci,`spaces/${n}/mediaScreens`,t);return await Dl(l,{displayAsVideo:s,updatedAt:new Date().toISOString()}),Ee.log(`Successfully updated display mode for media screen ${t} to ${s?"video":"image"}`),!0}catch(a){throw Ee.error("Error updating media screen display mode:",a),a}},mBe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},ise=()=>{const{spaceID:n}=Qc(),t=Pg(),[s,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Ee.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{Ee.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!s){Ee.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}Ee.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await t4(n);Ee.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:E,imageUrl:v,displayAsVideo:T,videoUrl:w}=f;let A=null;(!T||!w)&&(A=v?mBe(v):null),t("SetMediaScreenImage",{mediaScreenId:E,imageUrl:A,videoUrl:w||null,displayAsVideo:T||!1,timestamp:Date.now()}),Ee.log(`Sent media screen data for ${E} to Unity (displayAsVideo: ${T})`),T&&w&&(t("SetMediaScreenDisplayMode",{mediaScreenId:E,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),Ee.log(`Set display mode to video for screen ${E}`))})}catch(d){Ee.error("Error fetching media screen images:",d)}})()},[t,n,s])},gBe=n=>({opacity:1});var iC=n=>n.type==="checkbox",lE=n=>n instanceof Date,tc=n=>n==null;const sse=n=>typeof n=="object";var Ms=n=>!tc(n)&&!Array.isArray(n)&&sse(n)&&!lE(n),_Be=n=>Ms(n)&&n.target?iC(n.target)?n.target.checked:n.target.value:n,EBe=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,yBe=(n,t)=>n.has(EBe(t)),vBe=n=>{const t=n.constructor&&n.constructor.prototype;return Ms(t)&&t.hasOwnProperty("isPrototypeOf")},n4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function yu(n){let t;const s=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)t=new Date(n);else if(n instanceof Set)t=new Set(n);else if(!(n4&&(n instanceof Blob||a))&&(s||Ms(n)))if(t=s?[]:{},!s&&!vBe(n))t=n;else for(const l in n)n.hasOwnProperty(l)&&(t[l]=yu(n[l]));else return n;return t}var W1=n=>Array.isArray(n)?n.filter(Boolean):[],zs=n=>n===void 0,on=(n,t,s)=>{if(!t||!Ms(n))return s;const a=W1(t.split(/[,[\].]+?/)).reduce((l,d)=>tc(l)?l:l[d],n);return zs(a)||a===n?zs(n[t])?s:n[t]:a},kh=n=>typeof n=="boolean",r4=n=>/^\w*$/.test(n),ose=n=>W1(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Bi=(n,t,s)=>{let a=-1;const l=r4(t)?[t]:ose(t),d=l.length,f=d-1;for(;++a<d;){const E=l[a];let v=s;if(a!==f){const T=n[E];v=Ms(T)||Array.isArray(T)?T:isNaN(+l[a+1])?{}:[]}if(E==="__proto__"||E==="constructor"||E==="prototype")return;n[E]=v,n=n[E]}return n};const ZX={BLUR:"blur",FOCUS_OUT:"focusout"},Rd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},rf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ni.createContext(null);var SBe=(n,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const f=d;return t._proxyFormState[f]!==Rd.all&&(t._proxyFormState[f]=!a||Rd.all),n[f]}});return l},Wc=n=>Ms(n)&&!Object.keys(n).length,TBe=(n,t,s,a)=>{s(n);const{name:l,...d}=n;return Wc(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(f=>t[f]===Rd.all)},QO=n=>Array.isArray(n)?n:[n];function bBe(n){const t=ni.useRef(n);t.current=n,ni.useEffect(()=>{const s=!n.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[n.disabled])}var jh=n=>typeof n=="string",wBe=(n,t,s,a,l)=>jh(n)?(a&&t.watch.add(n),on(s,n,l)):Array.isArray(n)?n.map(d=>(a&&t.watch.add(d),on(s,d))):(a&&(t.watchAll=!0),s),RBe=(n,t,s,a,l)=>t?{...s[n],types:{...s[n]&&s[n].types?s[n].types:{},[a]:l||!0}}:{},eJ=n=>({isOnSubmit:!n||n===Rd.onSubmit,isOnBlur:n===Rd.onBlur,isOnChange:n===Rd.onChange,isOnAll:n===Rd.all,isOnTouch:n===Rd.onTouched}),tJ=(n,t,s)=>!s&&(t.watchAll||t.watch.has(n)||[...t.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const eR=(n,t,s,a)=>{for(const l of s||Object.keys(n)){const d=on(n,l);if(d){const{_f:f,...E}=d;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!a)return!0;if(f.ref&&t(f.ref,f.name)&&!a)return!0;if(eR(E,t))break}else if(Ms(E)&&eR(E,t))break}}};var CBe=(n,t,s)=>{const a=QO(on(n,s));return Bi(a,"root",t[s]),Bi(n,s,a),n},i4=n=>n.type==="file",Mh=n=>typeof n=="function",Vk=n=>{if(!n4)return!1;const t=n?n.ownerDocument:0;return n instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},ZO=n=>jh(n),s4=n=>n.type==="radio",Fk=n=>n instanceof RegExp;const nJ={value:!1,isValid:!1},rJ={value:!0,isValid:!0};var ase=n=>{if(Array.isArray(n)){if(n.length>1){const t=n.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!zs(n[0].attributes.value)?zs(n[0].value)||n[0].value===""?rJ:{value:n[0].value,isValid:!0}:rJ:nJ}return nJ};const iJ={isValid:!1,value:null};var cse=n=>Array.isArray(n)?n.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,iJ):iJ;function sJ(n,t,s="validate"){if(ZO(n)||Array.isArray(n)&&n.every(ZO)||kh(n)&&!n)return{type:s,message:ZO(n)?n:"",ref:t}}var cS=n=>Ms(n)&&!Fk(n)?n:{value:n,message:""},oJ=async(n,t,s,a,l,d)=>{const{ref:f,refs:E,required:v,maxLength:T,minLength:w,min:A,max:N,pattern:F,validate:j,name:z,valueAsNumber:H,mount:te}=n._f,K=on(s,z);if(!te||t.has(z))return{};const ne=E?E[0]:f,de=pe=>{l&&ne.reportValidity&&(ne.setCustomValidity(kh(pe)?"":pe||""),ne.reportValidity())},oe={},ge=s4(f),ee=iC(f),Z=ge||ee,J=(H||i4(f))&&zs(f.value)&&zs(K)||Vk(f)&&f.value===""||K===""||Array.isArray(K)&&!K.length,se=RBe.bind(null,z,a,oe),he=(pe,le,Me,He=rf.maxLength,rt=rf.minLength)=>{const we=pe?le:Me;oe[z]={type:pe?He:rt,message:we,ref:f,...se(pe?He:rt,we)}};if(d?!Array.isArray(K)||!K.length:v&&(!Z&&(J||tc(K))||kh(K)&&!K||ee&&!ase(E).isValid||ge&&!cse(E).isValid)){const{value:pe,message:le}=ZO(v)?{value:!!v,message:v}:cS(v);if(pe&&(oe[z]={type:rf.required,message:le,ref:ne,...se(rf.required,le)},!a))return de(le),oe}if(!J&&(!tc(A)||!tc(N))){let pe,le;const Me=cS(N),He=cS(A);if(!tc(K)&&!isNaN(K)){const rt=f.valueAsNumber||K&&+K;tc(Me.value)||(pe=rt>Me.value),tc(He.value)||(le=rt<He.value)}else{const rt=f.valueAsDate||new Date(K),we=Ne=>new Date(new Date().toDateString()+" "+Ne),Ce=f.type=="time",ve=f.type=="week";jh(Me.value)&&K&&(pe=Ce?we(K)>we(Me.value):ve?K>Me.value:rt>new Date(Me.value)),jh(He.value)&&K&&(le=Ce?we(K)<we(He.value):ve?K<He.value:rt<new Date(He.value))}if((pe||le)&&(he(!!pe,Me.message,He.message,rf.max,rf.min),!a))return de(oe[z].message),oe}if((T||w)&&!J&&(jh(K)||d&&Array.isArray(K))){const pe=cS(T),le=cS(w),Me=!tc(pe.value)&&K.length>+pe.value,He=!tc(le.value)&&K.length<+le.value;if((Me||He)&&(he(Me,pe.message,le.message),!a))return de(oe[z].message),oe}if(F&&!J&&jh(K)){const{value:pe,message:le}=cS(F);if(Fk(pe)&&!K.match(pe)&&(oe[z]={type:rf.pattern,message:le,ref:f,...se(rf.pattern,le)},!a))return de(le),oe}if(j){if(Mh(j)){const pe=await j(K,s),le=sJ(pe,ne);if(le&&(oe[z]={...le,...se(rf.validate,le.message)},!a))return de(le.message),oe}else if(Ms(j)){let pe={};for(const le in j){if(!Wc(pe)&&!a)break;const Me=sJ(await j[le](K,s),ne,le);Me&&(pe={...Me,...se(le,Me.message)},de(Me.message),a&&(oe[z]=pe))}if(!Wc(pe)&&(oe[z]={ref:ne,...pe},!a))return oe}}return de(!0),oe};function IBe(n,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)n=zs(n)?a++:n[t[a++]];return n}function ABe(n){for(const t in n)if(n.hasOwnProperty(t)&&!zs(n[t]))return!1;return!0}function ro(n,t){const s=Array.isArray(t)?t:r4(t)?[t]:ose(t),a=s.length===1?n:IBe(n,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(Ms(a)&&Wc(a)||Array.isArray(a)&&ABe(a))&&ro(n,s.slice(0,-1)),n}var x2=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},mV=n=>tc(n)||!sse(n);function eg(n,t){if(mV(n)||mV(t))return n===t;if(lE(n)&&lE(t))return n.getTime()===t.getTime();const s=Object.keys(n),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=t[l];if(lE(d)&&lE(f)||Ms(d)&&Ms(f)||Array.isArray(d)&&Array.isArray(f)?!eg(d,f):d!==f)return!1}}return!0}var lse=n=>n.type==="select-multiple",PBe=n=>s4(n)||iC(n),M2=n=>Vk(n)&&n.isConnected,use=n=>{for(const t in n)if(Mh(n[t]))return!0;return!1};function jk(n,t={}){const s=Array.isArray(n);if(Ms(n)||s)for(const a in n)Array.isArray(n[a])||Ms(n[a])&&!use(n[a])?(t[a]=Array.isArray(n[a])?[]:{},jk(n[a],t[a])):tc(n[a])||(t[a]=!0);return t}function dse(n,t,s){const a=Array.isArray(n);if(Ms(n)||a)for(const l in n)Array.isArray(n[l])||Ms(n[l])&&!use(n[l])?zs(t)||mV(s[l])?s[l]=Array.isArray(n[l])?jk(n[l],[]):{...jk(n[l])}:dse(n[l],tc(t)?{}:t[l],s[l]):s[l]=!eg(n[l],t[l]);return s}var hw=(n,t)=>dse(n,t,jk(t)),hse=(n,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>zs(n)?n:t?n===""?NaN:n&&+n:s&&jh(n)?new Date(n):a?a(n):n;function U2(n){const t=n.ref;return i4(t)?t.files:s4(t)?cse(n.refs).value:lse(t)?[...t.selectedOptions].map(({value:s})=>s):iC(t)?ase(n.refs).value:hse(zs(t.value)?n.ref.value:t.value,n)}var OBe=(n,t,s,a)=>{const l={};for(const d of n){const f=on(t,d);f&&Bi(l,d,f._f)}return{criteriaMode:s,names:[...n],fields:l,shouldUseNativeValidation:a}},pw=n=>zs(n)?n:Fk(n)?n.source:Ms(n)?Fk(n.value)?n.value.source:n.value:n;const aJ="AsyncFunction";var kBe=n=>!!n&&!!n.validate&&!!(Mh(n.validate)&&n.validate.constructor.name===aJ||Ms(n.validate)&&Object.values(n.validate).find(t=>t.constructor.name===aJ)),NBe=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function cJ(n,t,s){const a=on(n,s);if(a||r4(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),f=on(t,d),E=on(n,d);if(f&&!Array.isArray(f)&&s!==d)return{name:s};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:s}}var DBe=(n,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||n):(s?a.isOnBlur:l.isOnBlur)?!n:(s?a.isOnChange:l.isOnChange)?n:!0,LBe=(n,t)=>!W1(on(n,t)).length&&ro(n,t);const xBe={mode:Rd.onSubmit,reValidateMode:Rd.onChange,shouldFocusError:!0};function MBe(n={}){let t={...xBe,...n},s={submitCount:0,isDirty:!1,isLoading:Mh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=Ms(t.defaultValues)||Ms(t.values)?yu(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:yu(l),f={action:!1,mount:!1,watch:!1},E={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,T=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},A={values:x2(),array:x2(),state:x2()},N=eJ(t.mode),F=eJ(t.reValidateMode),j=t.criteriaMode===Rd.all,z=Re=>Fe=>{clearTimeout(T),T=setTimeout(Re,Fe)},H=async Re=>{if(!t.disabled&&(w.isValid||Re)){const Fe=t.resolver?Wc((await Z()).errors):await se(a,!0);Fe!==s.isValid&&A.state.next({isValid:Fe})}},te=(Re,Fe)=>{!t.disabled&&(w.isValidating||w.validatingFields)&&((Re||Array.from(E.mount)).forEach(Ke=>{Ke&&(Fe?Bi(s.validatingFields,Ke,Fe):ro(s.validatingFields,Ke))}),A.state.next({validatingFields:s.validatingFields,isValidating:!Wc(s.validatingFields)}))},K=(Re,Fe=[],Ke,_t,vt=!0,Ge=!0)=>{if(_t&&Ke&&!t.disabled){if(f.action=!0,Ge&&Array.isArray(on(a,Re))){const Ot=Ke(on(a,Re),_t.argA,_t.argB);vt&&Bi(a,Re,Ot)}if(Ge&&Array.isArray(on(s.errors,Re))){const Ot=Ke(on(s.errors,Re),_t.argA,_t.argB);vt&&Bi(s.errors,Re,Ot),LBe(s.errors,Re)}if(w.touchedFields&&Ge&&Array.isArray(on(s.touchedFields,Re))){const Ot=Ke(on(s.touchedFields,Re),_t.argA,_t.argB);vt&&Bi(s.touchedFields,Re,Ot)}w.dirtyFields&&(s.dirtyFields=hw(l,d)),A.state.next({name:Re,isDirty:pe(Re,Fe),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else Bi(d,Re,Fe)},ne=(Re,Fe)=>{Bi(s.errors,Re,Fe),A.state.next({errors:s.errors})},de=Re=>{s.errors=Re,A.state.next({errors:s.errors,isValid:!1})},oe=(Re,Fe,Ke,_t)=>{const vt=on(a,Re);if(vt){const Ge=on(d,Re,zs(Ke)?on(l,Re):Ke);zs(Ge)||_t&&_t.defaultChecked||Fe?Bi(d,Re,Fe?Ge:U2(vt._f)):He(Re,Ge),f.mount&&H()}},ge=(Re,Fe,Ke,_t,vt)=>{let Ge=!1,Ot=!1;const Xt={name:Re};if(!t.disabled){const pn=!!(on(a,Re)&&on(a,Re)._f&&on(a,Re)._f.disabled);if(!Ke||_t){w.isDirty&&(Ot=s.isDirty,s.isDirty=Xt.isDirty=pe(),Ge=Ot!==Xt.isDirty);const an=pn||eg(on(l,Re),Fe);Ot=!!(!pn&&on(s.dirtyFields,Re)),an||pn?ro(s.dirtyFields,Re):Bi(s.dirtyFields,Re,!0),Xt.dirtyFields=s.dirtyFields,Ge=Ge||w.dirtyFields&&Ot!==!an}if(Ke){const an=on(s.touchedFields,Re);an||(Bi(s.touchedFields,Re,Ke),Xt.touchedFields=s.touchedFields,Ge=Ge||w.touchedFields&&an!==Ke)}Ge&&vt&&A.state.next(Xt)}return Ge?Xt:{}},ee=(Re,Fe,Ke,_t)=>{const vt=on(s.errors,Re),Ge=w.isValid&&kh(Fe)&&s.isValid!==Fe;if(t.delayError&&Ke?(v=z(()=>ne(Re,Ke)),v(t.delayError)):(clearTimeout(T),v=null,Ke?Bi(s.errors,Re,Ke):ro(s.errors,Re)),(Ke?!eg(vt,Ke):vt)||!Wc(_t)||Ge){const Ot={..._t,...Ge&&kh(Fe)?{isValid:Fe}:{},errors:s.errors,name:Re};s={...s,...Ot},A.state.next(Ot)}},Z=async Re=>{te(Re,!0);const Fe=await t.resolver(d,t.context,OBe(Re||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return te(Re),Fe},J=async Re=>{const{errors:Fe}=await Z(Re);if(Re)for(const Ke of Re){const _t=on(Fe,Ke);_t?Bi(s.errors,Ke,_t):ro(s.errors,Ke)}else s.errors=Fe;return Fe},se=async(Re,Fe,Ke={valid:!0})=>{for(const _t in Re){const vt=Re[_t];if(vt){const{_f:Ge,...Ot}=vt;if(Ge){const Xt=E.array.has(Ge.name),pn=vt._f&&kBe(vt._f);pn&&w.validatingFields&&te([_t],!0);const an=await oJ(vt,E.disabled,d,j,t.shouldUseNativeValidation&&!Fe,Xt);if(pn&&w.validatingFields&&te([_t]),an[Ge.name]&&(Ke.valid=!1,Fe))break;!Fe&&(on(an,Ge.name)?Xt?CBe(s.errors,an,Ge.name):Bi(s.errors,Ge.name,an[Ge.name]):ro(s.errors,Ge.name))}!Wc(Ot)&&await se(Ot,Fe,Ke)}}return Ke.valid},he=()=>{for(const Re of E.unMount){const Fe=on(a,Re);Fe&&(Fe._f.refs?Fe._f.refs.every(Ke=>!M2(Ke)):!M2(Fe._f.ref))&&et(Re)}E.unMount=new Set},pe=(Re,Fe)=>!t.disabled&&(Re&&Fe&&Bi(d,Re,Fe),!eg(be(),l)),le=(Re,Fe,Ke)=>wBe(Re,E,{...f.mount?d:zs(Fe)?l:jh(Re)?{[Re]:Fe}:Fe},Ke,Fe),Me=Re=>W1(on(f.mount?d:l,Re,t.shouldUnregister?on(l,Re,[]):[])),He=(Re,Fe,Ke={})=>{const _t=on(a,Re);let vt=Fe;if(_t){const Ge=_t._f;Ge&&(!Ge.disabled&&Bi(d,Re,hse(Fe,Ge)),vt=Vk(Ge.ref)&&tc(Fe)?"":Fe,lse(Ge.ref)?[...Ge.ref.options].forEach(Ot=>Ot.selected=vt.includes(Ot.value)):Ge.refs?iC(Ge.ref)?Ge.refs.length>1?Ge.refs.forEach(Ot=>(!Ot.defaultChecked||!Ot.disabled)&&(Ot.checked=Array.isArray(vt)?!!vt.find(Xt=>Xt===Ot.value):vt===Ot.value)):Ge.refs[0]&&(Ge.refs[0].checked=!!vt):Ge.refs.forEach(Ot=>Ot.checked=Ot.value===vt):i4(Ge.ref)?Ge.ref.value="":(Ge.ref.value=vt,Ge.ref.type||A.values.next({name:Re,values:{...d}})))}(Ke.shouldDirty||Ke.shouldTouch)&&ge(Re,vt,Ke.shouldTouch,Ke.shouldDirty,!0),Ke.shouldValidate&&Ne(Re)},rt=(Re,Fe,Ke)=>{for(const _t in Fe){const vt=Fe[_t],Ge=`${Re}.${_t}`,Ot=on(a,Ge);(E.array.has(Re)||Ms(vt)||Ot&&!Ot._f)&&!lE(vt)?rt(Ge,vt,Ke):He(Ge,vt,Ke)}},we=(Re,Fe,Ke={})=>{const _t=on(a,Re),vt=E.array.has(Re),Ge=yu(Fe);Bi(d,Re,Ge),vt?(A.array.next({name:Re,values:{...d}}),(w.isDirty||w.dirtyFields)&&Ke.shouldDirty&&A.state.next({name:Re,dirtyFields:hw(l,d),isDirty:pe(Re,Ge)})):_t&&!_t._f&&!tc(Ge)?rt(Re,Ge,Ke):He(Re,Ge,Ke),tJ(Re,E)&&A.state.next({...s}),A.values.next({name:f.mount?Re:void 0,values:{...d}})},Ce=async Re=>{f.mount=!0;const Fe=Re.target;let Ke=Fe.name,_t=!0;const vt=on(a,Ke),Ge=()=>Fe.type?U2(vt._f):_Be(Re),Ot=Xt=>{_t=Number.isNaN(Xt)||lE(Xt)&&isNaN(Xt.getTime())||eg(Xt,on(d,Ke,Xt))};if(vt){let Xt,pn;const an=Ge(),ir=Re.type===ZX.BLUR||Re.type===ZX.FOCUS_OUT,na=!NBe(vt._f)&&!t.resolver&&!on(s.errors,Ke)&&!vt._f.deps||DBe(ir,on(s.touchedFields,Ke),s.isSubmitted,F,N),Vt=tJ(Ke,E,ir);Bi(d,Ke,an),ir?(vt._f.onBlur&&vt._f.onBlur(Re),v&&v(0)):vt._f.onChange&&vt._f.onChange(Re);const sn=ge(Ke,an,ir,!1),Ii=!Wc(sn)||Vt;if(!ir&&A.values.next({name:Ke,type:Re.type,values:{...d}}),na)return w.isValid&&(t.mode==="onBlur"&&ir?H():ir||H()),Ii&&A.state.next({name:Ke,...Vt?{}:sn});if(!ir&&Vt&&A.state.next({...s}),t.resolver){const{errors:di}=await Z([Ke]);if(Ot(an),_t){const yi=cJ(s.errors,a,Ke),dr=cJ(di,a,yi.name||Ke);Xt=dr.error,Ke=dr.name,pn=Wc(di)}}else te([Ke],!0),Xt=(await oJ(vt,E.disabled,d,j,t.shouldUseNativeValidation))[Ke],te([Ke]),Ot(an),_t&&(Xt?pn=!1:w.isValid&&(pn=await se(a,!0)));_t&&(vt._f.deps&&Ne(vt._f.deps),ee(Ke,pn,Xt,sn))}},ve=(Re,Fe)=>{if(on(s.errors,Fe)&&Re.focus)return Re.focus(),1},Ne=async(Re,Fe={})=>{let Ke,_t;const vt=QO(Re);if(t.resolver){const Ge=await J(zs(Re)?Re:vt);Ke=Wc(Ge),_t=Re?!vt.some(Ot=>on(Ge,Ot)):Ke}else Re?(_t=(await Promise.all(vt.map(async Ge=>{const Ot=on(a,Ge);return await se(Ot&&Ot._f?{[Ge]:Ot}:Ot)}))).every(Boolean),!(!_t&&!s.isValid)&&H()):_t=Ke=await se(a);return A.state.next({...!jh(Re)||w.isValid&&Ke!==s.isValid?{}:{name:Re},...t.resolver||!Re?{isValid:Ke}:{},errors:s.errors}),Fe.shouldFocus&&!_t&&eR(a,ve,Re?vt:E.mount),_t},be=Re=>{const Fe={...f.mount?d:l};return zs(Re)?Fe:jh(Re)?on(Fe,Re):Re.map(Ke=>on(Fe,Ke))},Te=(Re,Fe)=>({invalid:!!on((Fe||s).errors,Re),isDirty:!!on((Fe||s).dirtyFields,Re),error:on((Fe||s).errors,Re),isValidating:!!on(s.validatingFields,Re),isTouched:!!on((Fe||s).touchedFields,Re)}),Ae=Re=>{Re&&QO(Re).forEach(Fe=>ro(s.errors,Fe)),A.state.next({errors:Re?s.errors:{}})},Ue=(Re,Fe,Ke)=>{const _t=(on(a,Re,{_f:{}})._f||{}).ref,vt=on(s.errors,Re)||{},{ref:Ge,message:Ot,type:Xt,...pn}=vt;Bi(s.errors,Re,{...pn,...Fe,ref:_t}),A.state.next({name:Re,errors:s.errors,isValid:!1}),Ke&&Ke.shouldFocus&&_t&&_t.focus&&_t.focus()},ze=(Re,Fe)=>Mh(Re)?A.values.subscribe({next:Ke=>Re(le(void 0,Fe),Ke)}):le(Re,Fe,!0),et=(Re,Fe={})=>{for(const Ke of Re?QO(Re):E.mount)E.mount.delete(Ke),E.array.delete(Ke),Fe.keepValue||(ro(a,Ke),ro(d,Ke)),!Fe.keepError&&ro(s.errors,Ke),!Fe.keepDirty&&ro(s.dirtyFields,Ke),!Fe.keepTouched&&ro(s.touchedFields,Ke),!Fe.keepIsValidating&&ro(s.validatingFields,Ke),!t.shouldUnregister&&!Fe.keepDefaultValue&&ro(l,Ke);A.values.next({values:{...d}}),A.state.next({...s,...Fe.keepDirty?{isDirty:pe()}:{}}),!Fe.keepIsValid&&H()},nt=({disabled:Re,name:Fe,field:Ke,fields:_t})=>{(kh(Re)&&f.mount||Re||E.disabled.has(Fe))&&(Re?E.disabled.add(Fe):E.disabled.delete(Fe),ge(Fe,U2(Ke?Ke._f:on(_t,Fe)._f),!1,!1,!0))},dt=(Re,Fe={})=>{let Ke=on(a,Re);const _t=kh(Fe.disabled)||kh(t.disabled);return Bi(a,Re,{...Ke||{},_f:{...Ke&&Ke._f?Ke._f:{ref:{name:Re}},name:Re,mount:!0,...Fe}}),E.mount.add(Re),Ke?nt({field:Ke,disabled:kh(Fe.disabled)?Fe.disabled:t.disabled,name:Re}):oe(Re,!0,Fe.value),{..._t?{disabled:Fe.disabled||t.disabled}:{},...t.progressive?{required:!!Fe.required,min:pw(Fe.min),max:pw(Fe.max),minLength:pw(Fe.minLength),maxLength:pw(Fe.maxLength),pattern:pw(Fe.pattern)}:{},name:Re,onChange:Ce,onBlur:Ce,ref:vt=>{if(vt){dt(Re,Fe),Ke=on(a,Re);const Ge=zs(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,Ot=PBe(Ge),Xt=Ke._f.refs||[];if(Ot?Xt.find(pn=>pn===Ge):Ge===Ke._f.ref)return;Bi(a,Re,{_f:{...Ke._f,...Ot?{refs:[...Xt.filter(M2),Ge,...Array.isArray(on(l,Re))?[{}]:[]],ref:{type:Ge.type,name:Re}}:{ref:Ge}}}),oe(Re,!1,void 0,Ge)}else Ke=on(a,Re,{}),Ke._f&&(Ke._f.mount=!1),(t.shouldUnregister||Fe.shouldUnregister)&&!(yBe(E.array,Re)&&f.action)&&E.unMount.add(Re)}}},Xe=()=>t.shouldFocusError&&eR(a,ve,E.mount),Ct=Re=>{kh(Re)&&(A.state.next({disabled:Re}),eR(a,(Fe,Ke)=>{const _t=on(a,Ke);_t&&(Fe.disabled=_t._f.disabled||Re,Array.isArray(_t._f.refs)&&_t._f.refs.forEach(vt=>{vt.disabled=_t._f.disabled||Re}))},0,!1))},hn=(Re,Fe)=>async Ke=>{let _t;Ke&&(Ke.preventDefault&&Ke.preventDefault(),Ke.persist&&Ke.persist());let vt=yu(d);if(E.disabled.size)for(const Ge of E.disabled)Bi(vt,Ge,void 0);if(A.state.next({isSubmitting:!0}),t.resolver){const{errors:Ge,values:Ot}=await Z();s.errors=Ge,vt=Ot}else await se(a);if(ro(s.errors,"root"),Wc(s.errors)){A.state.next({errors:{}});try{await Re(vt,Ke)}catch(Ge){_t=Ge}}else Fe&&await Fe({...s.errors},Ke),Xe(),setTimeout(Xe);if(A.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Wc(s.errors)&&!_t,submitCount:s.submitCount+1,errors:s.errors}),_t)throw _t},Ut=(Re,Fe={})=>{on(a,Re)&&(zs(Fe.defaultValue)?we(Re,yu(on(l,Re))):(we(Re,Fe.defaultValue),Bi(l,Re,yu(Fe.defaultValue))),Fe.keepTouched||ro(s.touchedFields,Re),Fe.keepDirty||(ro(s.dirtyFields,Re),s.isDirty=Fe.defaultValue?pe(Re,yu(on(l,Re))):pe()),Fe.keepError||(ro(s.errors,Re),w.isValid&&H()),A.state.next({...s}))},ln=(Re,Fe={})=>{const Ke=Re?yu(Re):l,_t=yu(Ke),vt=Wc(Re),Ge=vt?l:_t;if(Fe.keepDefaultValues||(l=Ke),!Fe.keepValues){if(Fe.keepDirtyValues){const Ot=new Set([...E.mount,...Object.keys(hw(l,d))]);for(const Xt of Array.from(Ot))on(s.dirtyFields,Xt)?Bi(Ge,Xt,on(d,Xt)):we(Xt,on(Ge,Xt))}else{if(n4&&zs(Re))for(const Ot of E.mount){const Xt=on(a,Ot);if(Xt&&Xt._f){const pn=Array.isArray(Xt._f.refs)?Xt._f.refs[0]:Xt._f.ref;if(Vk(pn)){const an=pn.closest("form");if(an){an.reset();break}}}}a={}}d=t.shouldUnregister?Fe.keepDefaultValues?yu(l):{}:yu(Ge),A.array.next({values:{...Ge}}),A.values.next({values:{...Ge}})}E={mount:Fe.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!w.isValid||!!Fe.keepIsValid||!!Fe.keepDirtyValues,f.watch=!!t.shouldUnregister,A.state.next({submitCount:Fe.keepSubmitCount?s.submitCount:0,isDirty:vt?!1:Fe.keepDirty?s.isDirty:!!(Fe.keepDefaultValues&&!eg(Re,l)),isSubmitted:Fe.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:vt?{}:Fe.keepDirtyValues?Fe.keepDefaultValues&&d?hw(l,d):s.dirtyFields:Fe.keepDefaultValues&&Re?hw(l,Re):Fe.keepDirty?s.dirtyFields:{},touchedFields:Fe.keepTouched?s.touchedFields:{},errors:Fe.keepErrors?s.errors:{},isSubmitSuccessful:Fe.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},xn=(Re,Fe)=>ln(Mh(Re)?Re(d):Re,Fe);return{control:{register:dt,unregister:et,getFieldState:Te,handleSubmit:hn,setError:Ue,_executeSchema:Z,_getWatch:le,_getDirty:pe,_updateValid:H,_removeUnmounted:he,_updateFieldArray:K,_updateDisabledField:nt,_getFieldArray:Me,_reset:ln,_resetDefaultValues:()=>Mh(t.defaultValues)&&t.defaultValues().then(Re=>{xn(Re,t.resetOptions),A.state.next({isLoading:!1})}),_updateFormState:Re=>{s={...s,...Re}},_disableForm:Ct,_subjects:A,_proxyFormState:w,_setErrors:de,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(Re){f=Re},get _defaultValues(){return l},get _names(){return E},set _names(Re){E=Re},get _formState(){return s},set _formState(Re){s=Re},get _options(){return t},set _options(Re){t={...t,...Re}}},trigger:Ne,register:dt,handleSubmit:hn,watch:ze,setValue:we,getValues:be,reset:xn,resetField:Ut,clearErrors:Ae,unregister:et,setError:Ue,setFocus:(Re,Fe={})=>{const Ke=on(a,Re),_t=Ke&&Ke._f;if(_t){const vt=_t.refs?_t.refs[0]:_t.ref;vt.focus&&(vt.focus(),Fe.shouldSelect&&Mh(vt.select)&&vt.select())}},getFieldState:Te}}function pse(n={}){const t=ni.useRef(void 0),s=ni.useRef(void 0),[a,l]=ni.useState({isDirty:!1,isValidating:!1,isLoading:Mh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Mh(n.defaultValues)?void 0:n.defaultValues});t.current||(t.current={...MBe(n),formState:a});const d=t.current.control;return d._options=n,bBe({subject:d._subjects.state,next:f=>{TBe(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),ni.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),ni.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),ni.useEffect(()=>{n.values&&!eg(n.values,s.current)?(d._reset(n.values,d._options.resetOptions),s.current=n.values,l(f=>({...f}))):d._resetDefaultValues()},[n.values,d]),ni.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),ni.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),ni.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),t.current.formState=SBe(a,d),t.current}const z1=(n,t="generic-modal")=>{L.useEffect(()=>{if(!window.unityInstance)return;const s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Ee.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){Ee.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),Ee.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):Ee.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){Ee.error(`Failed to enable Unity input for ${t}:`,l)}};return n?s():a(),()=>{n&&a()}},[n,t])};function o4({mode:n,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:E}}=pse(),{register:v}=L.useContext(Ll),T=kd(),{fullscreenRef:w}=Nd(),[A,N]=L.useState(!1),[F,j]=L.useState(!1),z=a!==void 0?a:A,H=l||(()=>N(!1));z1(z);const te=async de=>{const{email:oe,password:ge,confirmPassword:ee,...Z}=de;if(ge!==ee){T({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}j(!0);try{const J=await v(oe,ge,Z);Ee.log("User: Registration process complete."),H(),T({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(J){Ee.error("User: Registration Error:",J),T({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{j(!1)}},K=()=>{l?l():N(!A)},ne=n==="link"?I.jsx(bu,{variant:"header",onClick:K,children:t}):I.jsx(Ri,{onClick:K,...s,children:t});return I.jsxs(I.Fragment,{children:[!a&&ne,I.jsxs(Na,{isOpen:z,onClose:H,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[I.jsx(xa,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),I.jsxs(Da,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:de=>{de.stopPropagation()},children:[I.jsxs(Nl,{p:8,textAlign:"center",children:[I.jsx(gk,{size:"lg",mb:2,children:"Create Account"}),I.jsx(Et,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),I.jsx(sc,{color:"gray.400"}),I.jsx(La,{px:8,children:I.jsx("form",{onSubmit:f(te),children:I.jsxs(zi,{spacing:4,children:[I.jsxs(Zi,{isInvalid:E.companyName,isRequired:!0,children:[I.jsx(Ro,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),I.jsx(sf,{children:E.companyName&&E.companyName.message})]}),I.jsxs(io,{gap:4,w:"100%",children:[I.jsxs(Zi,{isInvalid:E.firstName,isRequired:!0,children:[I.jsx(Ro,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),I.jsx(sf,{children:E.firstName&&E.firstName.message})]}),I.jsxs(Zi,{isInvalid:E.lastName,isRequired:!0,children:[I.jsx(Ro,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),I.jsx(sf,{children:E.lastName&&E.lastName.message})]})]}),I.jsxs(Zi,{isInvalid:E.email,isRequired:!0,children:[I.jsx(Ro,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),I.jsx(sf,{children:E.email&&E.email.message})]}),I.jsxs(io,{gap:4,w:"100%",children:[I.jsxs(Zi,{isInvalid:E.password,isRequired:!0,children:[I.jsx(Ro,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),I.jsx(sf,{children:E.password&&E.password.message})]}),I.jsxs(Zi,{isInvalid:E.confirmPassword,isRequired:!0,children:[I.jsx(Ro,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),I.jsx(sf,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),I.jsx(Zi,{children:I.jsx(Ro,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),I.jsx(Zi,{children:I.jsx(Ro,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),I.jsxs(mg,{px:8,pb:8,flexDirection:"column",gap:4,children:[I.jsx(Ri,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(te),isLoading:F,loadingText:"Creating Account",children:"Create Account"}),I.jsxs(Et,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",I.jsx(bu,{color:"blue.400",onClick:()=>{H(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}o4.propTypes={mode:kr.oneOf(["button","link"]),label:kr.string,buttonProps:kr.object,isOpen:kr.bool,onClose:kr.func};const UBe=wg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),VBe=wg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),FBe=wg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),jBe=wg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),lJ=wg({displayName:"EmailIcon",path:I.jsxs("g",{fill:"currentColor",children:[I.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),I.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),BBe=wg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),WBe=wg({displayName:"QuestionOutlineIcon",path:I.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[I.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),I.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),I.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),zBe=wg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});function a4({mode:n="button",label:t="Sign In",buttonProps:s={},initialIsOpen:a=!1}){const{signIn:l}=L.useContext(Ll),{fullscreenRef:d}=Nd(),f=kd(),{register:E,handleSubmit:v,formState:{errors:T,isSubmitting:w}}=pse({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[A,N]=L.useState(a),[F,j]=L.useState(!1),[z,H]=L.useState(!1),[te,K]=L.useState(""),[ne,de]=L.useState(!1);z1(A||z),L.useEffect(()=>{const he=()=>{N(!0)};return window.addEventListener("openSignInModal",he),()=>{window.removeEventListener("openSignInModal",he)}},[]);const oe=async he=>{try{await l(he.email,he.password),Ee.log("User: Sign-in process complete."),N(!1),window.location.reload()}catch(pe){Ee.error("User: SignIn Error:",pe);const le=pe.message||"An error occurred while logging in. Please check your credentials.",Me=le.includes("verify your email");f({title:Me?"Email Verification Required":"Error",description:le,status:Me?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}},ge=async()=>{if(!te){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{de(!0),await qUe(Die,te),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),H(!1)}catch(he){Ee.error("User: Reset Password Error:",he),f({title:"Error",description:he.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{de(!1)}},ee=()=>N(he=>!he),Z=()=>{N(!1),j(!0)},J=()=>{H(!0)},se=n==="link"?I.jsx(bu,{variant:"header",onClick:ee,children:t}):I.jsx(Ri,{onClick:ee,...s,children:t});return I.jsxs(I.Fragment,{children:[se,I.jsxs(Na,{isOpen:A,onClose:ee,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[I.jsx(xa,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),I.jsx("form",{onSubmit:v(oe),children:I.jsxs(Da,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:he=>{he.stopPropagation()},children:[I.jsxs(Nl,{p:8,textAlign:"center",children:[I.jsx(gk,{size:"lg",mb:2,children:"Welcome Back"}),I.jsx(Et,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),I.jsx(sc,{color:"gray.400"}),I.jsx(La,{px:8,pb:8,children:I.jsxs(zi,{spacing:4,children:[I.jsxs(Zi,{isInvalid:T.email,children:[I.jsxs(MO,{children:[I.jsx(Hw,{pointerEvents:"none",children:I.jsx(lJ,{color:"gray.500"})}),I.jsx(Ro,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("email",{required:"Email is required."})})]}),I.jsx(sf,{children:T.email&&T.email.message})]}),I.jsxs(Zi,{isInvalid:T.password,children:[I.jsxs(MO,{children:[I.jsx(Hw,{pointerEvents:"none",children:I.jsx(FBe,{color:"gray.500"})}),I.jsx(Ro,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("password",{required:"Password is required."})})]}),I.jsx(sf,{children:T.password&&T.password.message})]}),I.jsx(Pt,{alignSelf:"flex-end",children:I.jsx(bu,{color:"blue.400",fontSize:"sm",onClick:J,children:"Forgot Password?"})})]})}),I.jsxs(mg,{px:8,pb:8,flexDirection:"column",gap:4,children:[I.jsx(Ri,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",children:"Sign In"}),I.jsxs(Et,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",I.jsx(bu,{color:"blue.400",onClick:Z,children:"Sign Up"})]})]})]})})]}),I.jsxs(Na,{isOpen:z,onClose:()=>H(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[I.jsx(xa,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),I.jsxs(Da,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:he=>{he.stopPropagation()},children:[I.jsxs(Nl,{p:8,textAlign:"center",children:[I.jsx(gk,{size:"lg",mb:2,children:"Reset Password"}),I.jsx(Et,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),I.jsx(sc,{color:"gray.400"}),I.jsx(La,{px:8,pb:4,children:I.jsx(Zi,{children:I.jsxs(MO,{children:[I.jsx(Hw,{pointerEvents:"none",children:I.jsx(lJ,{color:"gray.500"})}),I.jsx(Ro,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:te,onChange:he=>K(he.target.value)})]})})}),I.jsxs(mg,{px:8,pb:8,flexDirection:"column",gap:4,children:[I.jsx(Ri,{colorScheme:"blue",size:"lg",width:"100%",onClick:ge,isLoading:ne,loadingText:"Sending",children:"Send Reset Link"}),I.jsxs(Et,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",I.jsx(bu,{color:"blue.400",onClick:()=>H(!1),children:"Back to Sign In"})]})]})]})]}),I.jsx(o4,{mode:"link",isOpen:F,onClose:()=>j(!1)})]})}a4.propTypes={mode:kr.oneOf(["button","link"]),label:kr.string,buttonProps:kr.object,initialIsOpen:kr.bool};function GBe(){const{loadingProgression:n,isLoaded:t,error:s}=Qc(),{user:a}=L.useContext(Ll),[l,d]=L.useState(!1),[f,E]=L.useState(!1),[v,T]=L.useState(!1),[w,A]=L.useState(!1),N=L.useRef(!1),F=L.useRef(!1),j=L.useRef(null),z=L.useRef(null),H=L.useRef(null),te=Lf(),K=L.useRef(null),ne=L.useRef(null),de=L.useRef(null),oe=L.useRef(null);L.useEffect(()=>{d(!a&&n===0)},[a,n]),L.useEffect(()=>{const Z=document.createElement("style");return Z.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Z),K.current=Z,()=>{K.current&&document.head.removeChild(K.current)}},[]),L.useEffect(()=>{const Z=()=>{const J=document.getElementById("unity-canvas"),se=document.getElementById("unity-container");J&&(j.current=J,console.log("LoaderProgress: Found Unity canvas"),J.style.zIndex="1"),se&&(z.current=se,console.log("LoaderProgress: Found Unity container"),se.style.zIndex="1"),J&&se&&de.current&&(clearInterval(de.current),de.current=null)};return Z(),de.current=setInterval(Z,100),()=>{de.current&&(clearInterval(de.current),de.current=null)}},[]),L.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),F.current=!0,A(!0));const J=te("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0}),se=setTimeout(()=>{F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{J(),clearTimeout(se)}},[te]),L.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0));const Z=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Z);const J=te("PlayerInstantiated",Z),se=setTimeout(()=>{N.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Z),J(),clearTimeout(se)}},[te]),L.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:v}),w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),j.current&&(j.current.style.opacity="1",j.current.style.removeProperty("opacity")),z.current&&(z.current.style.opacity="1",z.current.style.removeProperty("opacity")),H.current&&(H.current.style.opacity="0",H.current.style.pointerEvents="none",setTimeout(()=>{H.current&&(H.current.style.display="none")},1500))},2e3)),()=>{ne.current&&clearTimeout(ne.current)}),[w,v]),L.useEffect(()=>(oe.current=setInterval(()=>{var Z,J;console.log("LoaderProgress: Debug interval",{isLoaded:t,isFirstSceneLoaded:F.current,isPlayerInstantiated:N.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(Z=j.current)==null?void 0:Z.style.zIndex,loaderZIndex:(J=H.current)==null?void 0:J.style.zIndex})},5e3),()=>{oe.current&&clearInterval(oe.current)}),[t]),L.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:t,isFirstSceneLoaded:w,isPlayerInstantiated:v,loadingProgression:n})},[t,w,v,n]);const ge=()=>t?t&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",ee=()=>t?t&&!w&&!v?85:w&&!v?95:100:n*80;return I.jsx(I.Fragment,{children:l?I.jsx(Pt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:I.jsxs(zi,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[I.jsx(Et,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),I.jsx(Et,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),I.jsx(Ri,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):I.jsx(Pt,{ref:H,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:I.jsxs(io,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[I.jsx(Et,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),I.jsx(Et,{fontSize:"sm",children:ge()}),I.jsx(i0,{value:ee(),size:"lg",width:"100%",marginY:2})]})})})}function fse({mode:n="button",label:t="Sign Out"}){const s=kd(),{signOut:a}=L.useContext(Ll),{fullscreenRef:l}=Nd(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?I.jsx(bu,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return I.jsx(I.Fragment,{children:f})}fse.propTypes={mode:kr.oneOf(["button","link"]),label:kr.string};function HBe(){const{user:n}=L.useContext(Ll);return I.jsx("div",{children:n!==null?I.jsx("div",{children:I.jsx(fse,{})}):I.jsxs("div",{children:[I.jsx(o4,{}),I.jsx(a4,{})]})})}function $Be(){const{fullscreenRef:n}=Nd(),[t,s]=L.useState(!1),a=()=>{s(!t)};return I.jsxs(I.Fragment,{children:[I.jsx(sg,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:I.jsx(Pa,{"aria-label":"Controller Help",icon:I.jsx(WBe,{}),onClick:a,variant:"iconButton"})}),I.jsxs(Na,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:n},children:[I.jsx(xa,{}),I.jsxs(Da,{children:[I.jsx(Nl,{children:"Notes"}),I.jsx(sc,{}),I.jsx(La,{children:I.jsx(Et,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),I.jsx(mg,{children:I.jsx(Ri,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var mse={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},uJ=ni.createContext&&ni.createContext(mse),dg=function(){return dg=Object.assign||function(n){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])}return n},dg.apply(this,arguments)},KBe=function(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s};function gse(n){return n&&n.map(function(t,s){return ni.createElement(t.tag,dg({key:s},t.attr),gse(t.child))})}function Vr(n){return function(t){return ni.createElement(qBe,dg({attr:dg({},n.attr)},t),gse(n.child))}}function qBe(n){var t=function(s){var a=n.attr,l=n.size,d=n.title,f=KBe(n,["attr","size","title"]),E=l||s.size||"1em",v;return s.className&&(v=s.className),n.className&&(v=(v?v+" ":"")+n.className),ni.createElement("svg",dg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,f,{className:v,style:dg(dg({color:n.color||s.color},s.style),n.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&ni.createElement("title",null,d),n.children)};return uJ!==void 0?ni.createElement(uJ.Consumer,null,function(s){return t(s)}):t(mse)}function _se(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function YBe(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function gV(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function XBe(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function JBe(n){return Vr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function QBe(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Ese(n){return Vr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function ZBe(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function e6e(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function _V(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function EV(n){return Vr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function t6e(n){return Vr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function n6e(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function r6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function yV(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function i6e(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function s6e(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function o6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function a6e(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function yse({open:n,onClose:t}){const s=L.useRef(null),a=Pg(),{user:l}=L.useContext(Ll),d=v=>{s.current&&!s.current.contains(v.target)&&t()},f=async v=>{const T=E(v);if((T==null?void 0:T.source)==="readyplayerme"&&(T.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),T.eventName==="v1.avatar.exported")){const w=T.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await Lie(l.uid,w),t()}catch(A){console.error("Error updating RPM URL:",A)}else console.error("No authenticated user found to update rpmURL.")}},E=v=>{try{return JSON.parse(v.data)}catch{return null}};return L.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[n]),n&&I.jsx(ku,{children:I.jsx(Pt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:I.jsx(Pt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:I.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function c6e({isOpen:n,onClose:t}){const[s,a]=L.useState(!1),[l,d]=L.useState(null),{user:f}=L.useContext(Ll),E=Pg(),v=j=>{j.stopPropagation(),a(!0)},T=()=>{a(!1),t()},w=async j=>{if(d(j),f&&f.uid)try{await Lie(f.uid,j.url),E("AvatarUrlFromReact",{url:j.url}),t()}catch(z){console.error("Error updating RPM URL:",z)}else console.error("No authenticated user found to update rpmURL.")},A=XRe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",F=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return I.jsxs(I.Fragment,{children:[I.jsx(ku,{children:I.jsxs(Na,{isOpen:n,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[I.jsx(xa,{bg:"rgba(0, 0, 0, 0.7)"}),I.jsxs(Da,{bg:"gray.800",color:"white",maxW:"900px",children:[I.jsx(Nl,{fontSize:"lg",children:"Customise Your Avatar"}),I.jsx(sc,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),I.jsx(La,{pb:4,children:I.jsxs(zi,{spacing:4,align:"stretch",children:[I.jsx(Et,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),I.jsxs(ote,{columns:5,spacing:2,children:[I.jsx(Pt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:A,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:I.jsxs(zi,{spacing:1,children:[I.jsx(Dn,{as:n6e,boxSize:4}),I.jsx(Et,{fontSize:"xs",children:"Create Custom Avatar"})]})}),F.map(j=>I.jsxs(Pt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===j.id?"blue.400":A,borderRadius:"lg",overflow:"hidden",onClick:()=>w(j),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[I.jsx(Vh,{src:j.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:j.name,width:"100%",height:"100%",objectFit:"cover"}),I.jsx(Pt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:I.jsx(Et,{fontSize:"xs",children:j.name})})]},j.id))]})]})})]})]})}),s&&I.jsx(yse,{open:s,onClose:T})]})}function l6e(){const{fullscreenRef:n}=Nd(),[t,s]=L.useState(!1),[a,l]=L.useState(!1),[d,f]=L.useState(!1),[E,v]=L.useState(!1),{user:T}=L.useContext(Ll),[w,A]=L.useState(null),[N,F]=L.useState(!0),j=(K,ne)=>!K||!ne?"?":`${K.charAt(0)}${ne.charAt(0)}`.toUpperCase(),z=async()=>{if(T!=null&&T.uid){F(!0);try{const K=await ep(T.uid);A({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{F(!1)}}};L.useEffect(()=>{z()},[T==null?void 0:T.uid]),L.useEffect(()=>{const K=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const H=()=>l(!a),te=()=>{l(!1),z()};return t?I.jsxs(I.Fragment,{children:[I.jsx(sg,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:n},children:I.jsxs(Pt,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:"pointer",onClick:H,children:[I.jsx(wf,{src:N||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?j(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&I.jsx(Pt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:I.jsx(Et,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),I.jsx(c6e,{isOpen:a,onClose:te})]}):null}function u6e(n){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function d6e(n){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function h6e(){const{isFullscreen:n,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=Nd(),l=kd();L.useEffect(()=>{const f=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return I.jsx(sg,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:I.jsx(Pa,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?I.jsx(u6e,{}):I.jsx(d6e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const dJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function p6e(){const{isOpen:n,onOpen:t,onClose:s}=Sf(),{fullscreenRef:a}=Nd(),[l,d]=lBe(!1);L.useEffect(()=>{Ee.log("VideoPlayer: Current video URL:",l),l&&(Ee.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const f=()=>{Ee.log("VideoPlayer: Closing modal"),d(),s()};return I.jsx(ku,{containerRef:a,children:I.jsxs(Na,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[I.jsx(xa,{bg:"rgba(0, 0, 0, 0.8)"}),I.jsxs(Da,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[I.jsx(sc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),I.jsx(La,{p:0,width:"100%",children:l&&I.jsx(Pt,{style:dJ.iframeContainer,children:I.jsx("iframe",{src:l,style:dJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function f6e({isOpen:n,onClose:t,playerName:s,playerId:a,uid:l}){const[d,f]=L.useState(null),[E,v]=L.useState(!0),[T,w]=L.useState(null);return L.useEffect(()=>{n&&(async()=>{if(v(!0),w(null),!l){Ee.warn("NameplateModal: No UID provided for player:",s),w("No user ID available for this player"),v(!1);return}try{Ee.log("NameplateModal: Fetching profile for UID:",l);const N=await ep(l);N?f({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(N){Ee.error("Error fetching profile data:",N),w("Error loading profile data")}finally{v(!1)}})()},[l,n,s]),I.jsxs(Na,{isOpen:n,onClose:t,isCentered:!0,size:"md",children:[I.jsx(xa,{backdropFilter:"blur(10px)"}),I.jsxs(Da,{bg:"gray.900",color:"white",borderRadius:"xl",children:[I.jsx(Nl,{children:"Player Info"}),I.jsx(sc,{}),I.jsx(La,{pb:6,children:E?I.jsx(bee,{py:8,children:I.jsx(tp,{size:"xl",color:"blue.400"})}):T?I.jsxs(ng,{status:"warning",variant:"solid",borderRadius:"md",children:[I.jsx(rg,{}),T]}):I.jsxs(zi,{spacing:4,align:"center",children:[I.jsx(wf,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),I.jsxs(zi,{spacing:1,children:[I.jsx(Et,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&I.jsxs(Et,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),I.jsxs(Et,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&I.jsxs(I.Fragment,{children:[I.jsx(gE,{borderColor:"whiteAlpha.300"}),I.jsxs(wi,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&I.jsx(bu,{href:d.linkedinUrl,isExternal:!0,children:I.jsx(Pa,{icon:I.jsx(_se,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&I.jsx(bu,{href:d.websiteUrl,isExternal:!0,children:I.jsx(Pa,{icon:I.jsx(Ese,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const m6e=({isVisible:n,onToggleVisibility:t,spaceID:s})=>{const[a]=NNe("(max-width: 768px)"),[l,d]=L.useState(!1);L.useEffect(()=>{(()=>{const Ce=navigator.userAgent||navigator.vendor||window.opera,Ne=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Ce);d(Ne),Ne&&Ee.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,E=rse(),[v,T]=L.useState(!1),[w,A]=L.useState([]),[N,F]=L.useState(!1),[j,z]=L.useState({}),[H,te]=L.useState({}),[K,ne]=L.useState(null),[de,oe]=L.useState(!1),ge=kd(),ee=window.currentUser||{},J=(()=>{if(s)return s;if(window.spaceID)return window.spaceID;const Ce=(window.location.pathname||"").split("/"),ve=Ce[Ce.length-1];if(ve&&ve.length>5)return ve;const Ne=document.body.getAttribute("data-space-id");if(Ne)return Ne;const be=localStorage.getItem("currentSpaceId");return be||"fallback-space-id"})();L.useEffect(()=>{(async()=>{try{const ve=await ug(J);ve&&ve.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),oe(!0)):oe(!1)}catch(ve){console.error("UnityPlayerList: Error checking if voice is disabled:",ve)}})();const Ce=ve=>{ve.detail&&typeof ve.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ve.detail.voiceDisabled),oe(ve.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ce),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ce)}},[J]),L.useEffect(()=>{const we={};E.forEach(Ce=>{if(Ce.uid){if(Ce.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)we[Ce.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,Ne=ve.find(be=>String(be.uid)===String(Ce.uid));if(Ne)we[Ce.uid]=Ne.uid;else{const be=ve.find(Te=>typeof Te.uid=="string"&&Te.uid.includes(Ce.uid));if(be)we[Ce.uid]=be.uid;else{const Te=ve.find(Ae=>typeof Ce.uid=="string"&&Ce.uid.includes(String(Ae.uid)));if(Te)we[Ce.uid]=Te.uid;else{const Ae=ve.filter(Ue=>!(typeof Ue.uid=="string"&&Ue.uid.startsWith("screen-")));Ae.length===1&&!Ce.isLocalPlayer&&(we[Ce.uid]=Ae[0].uid)}}}}}}),te(we)},[E]);const se=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const we=window.agoraClient.isVoiceEnabled;we!==N&&F(we)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const we=window.agoraClient.client.remoteUsers,Ce={};we.forEach(ve=>{typeof ve.uid=="string"&&ve.uid.startsWith("screen-")||(Ce[ve.uid]=!!ve.audioTrack&&!ve.audioTrack.muted)}),JSON.stringify(Ce)!==JSON.stringify(j)&&z(Ce)}};L.useEffect(()=>{const we=setInterval(se,500),Ce=ve=>{ve.detail&&typeof ve.detail.enabled=="boolean"&&F(ve.detail.enabled)};return window.addEventListener("VoiceToggled",Ce),se(),()=>{clearInterval(we),window.removeEventListener("VoiceToggled",Ce)}},[]),L.useEffect(()=>{const we=()=>{Ee.log("UnityPlayerList: Player instantiated, showing list"),T(!0)};return window.addEventListener("PlayerInstantiated",we),window.isPlayerInstantiated&&(Ee.log("UnityPlayerList: Player was already instantiated"),T(!0)),()=>{window.removeEventListener("PlayerInstantiated",we)}},[]),L.useEffect(()=>{(async()=>{const Ce=await Promise.all(E.map(async ve=>{if(ve.uid)try{const Ne=await ep(ve.uid);let be=null;if(Ne.groups){const Te=`space_${J}_owners`,Ae=`space_${J}_hosts`;Ne.groups.includes(Te)?be="owner":Ne.groups.includes(Ae)&&(be="host")}return le({uid:ve.uid})&&ne(be),{...ve,firstName:Ne.firstName,lastName:Ne.lastName,linkedInProfile:Ne.linkedInProfile,websiteUrl:Ne.websiteUrl,rpmURL:Ne.rpmURL?Ne.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:be}}catch(Ne){return Ee.error(`Error fetching data for player ${ve.playerName}:`,Ne),ve}return ve}));A(Ce)})()},[E,J]);const he=[...w].sort((we,Ce)=>we.isLocalPlayer?-1:Ce.isLocalPlayer?1:0),pe=()=>{Ee.log("UnityPlayerList: Toggling visibility"),t&&t()},le=we=>!!(we.isLocalPlayer||ee&&ee.uid&&we.uid===ee.uid),Me=we=>{try{if(le(we))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:N;if(we.uid){if(j[we.uid])return!0;const Ce=H[we.uid];if(Ce&&j[Ce])return!0;const ve=parseInt(we.uid);if(!isNaN(ve)&&j[ve])return!0}return!1}catch(Ce){return console.error("Error in hasActiveMic:",Ce),!1}},He=({player:we})=>{const Ce=we.role;return Ce==="owner"?I.jsxs(wi,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[I.jsx(Dn,{as:gV,color:"green.400",boxSize:5}),I.jsx(uf,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Ce==="host"?I.jsxs(wi,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[I.jsx(Dn,{as:yV,color:"purple.400",boxSize:5}),I.jsx(uf,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},rt=(we,Ce)=>{switch(console.log(`Action "${we}" performed on player: ${Ce.playerName}`),we){case"mute":ge({title:"Player Muted",description:`${Ce.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":ge({title:"Player Kicked",description:`${Ce.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":ge({title:"Player Promoted",description:`${Ce.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return I.jsxs(Pt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!f?"visible":"hidden",role:"group",children:[I.jsx(Pt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:I.jsx(Pa,{icon:I.jsx(BBe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:pe,_hover:{opacity:.8}})}),I.jsxs(Et,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",E.length]}),I.jsx(Pt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:I.jsx(zi,{align:"stretch",spacing:1,width:"100%",children:he.map((we,Ce)=>{const ve=le(we),Ne=!de&&Me(we);return I.jsx(Pt,{children:I.jsxs(Lte,{placement:"left",trigger:"hover",children:[I.jsx(Fte,{children:I.jsxs(wi,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[I.jsx(wf,{size:"xs",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),I.jsx(Et,{fontSize:"xs",children:we.playerName}),we.role==="owner"&&I.jsx(Dn,{as:gV,color:"green.400",boxSize:2.5}),we.role==="host"&&I.jsx(Dn,{as:yV,color:"purple.400",boxSize:2.5}),I.jsx(mk,{}),K==="owner"&&I.jsxs(a1,{closeOnSelect:!0,placement:"bottom-end",children:[I.jsx(c1,{as:Pa,"aria-label":"Options",icon:I.jsx(JBe,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:be=>be.stopPropagation()}),I.jsxs(l1,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[I.jsx(FS,{icon:I.jsx(a6e,{}),onClick:()=>rt("mute",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:de,children:"Mute Player"}),I.jsx(FS,{icon:I.jsx(i6e,{}),onClick:()=>rt("promote",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),I.jsx(vte,{borderColor:"whiteAlpha.300"}),I.jsx(FS,{icon:I.jsx(YBe,{}),onClick:()=>rt("kick",we),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!de&&(Ne?I.jsx(Pt,{color:"green.400",children:I.jsx(EV,{})}):I.jsx(Pt,{color:"red.400",children:I.jsx(_V,{})})),ve&&I.jsx(Et,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),I.jsx(Vte,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:I.jsx(Mte,{children:I.jsxs(zi,{align:"center",spacing:3,children:[I.jsx(wf,{size:"xl",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),I.jsx(Et,{fontSize:"xl",fontWeight:"bold",children:we.playerName}),I.jsx(He,{player:we}),we.firstName&&I.jsxs(Et,{fontSize:"sm",color:"gray.300",children:[we.firstName," ",we.lastName]}),I.jsxs(wi,{spacing:4,pt:2,children:[we.linkedInProfile&&I.jsx(bu,{href:we.linkedInProfile,isExternal:!0,children:I.jsx(Pa,{icon:I.jsx(_se,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),we.websiteUrl&&I.jsx(bu,{href:we.websiteUrl,isExternal:!0,children:I.jsx(Pa,{icon:I.jsx(Ese,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!de&&I.jsx(Pa,{icon:Ne?I.jsx(EV,{}):I.jsx(_V,{}),variant:"ghost",colorScheme:Ne?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),de&&I.jsx(Pa,{icon:I.jsx(o6e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Ce)})})})]})};var ek={exports:{}},g6e=ek.exports,hJ;function _6e(){return hJ||(hJ=1,function(n,t){(function(s,a){n.exports=a()})(g6e,function(){function s(e,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof sE<"u"?sE:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=f,v=Function.prototype,T=v.call,w=E&&v.bind.bind(T,T),A=E?w:function(e){return function(){return T.apply(e,arguments)}},N=A({}.isPrototypeOf),F=function(e){return e&&e.Math==Math&&e},j=F(typeof globalThis=="object"&&globalThis)||F(typeof window=="object"&&window)||F(typeof self=="object"&&self)||F(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),z=f,H=Function.prototype,te=H.apply,K=H.call,ne=typeof Reflect=="object"&&Reflect.apply||(z?K.bind(te):function(){return K.apply(te,arguments)}),de=A,oe=de({}.toString),ge=de("".slice),ee=function(e){return ge(oe(e),8,-1)},Z=ee,J=A,se=function(e){if(Z(e)==="Function")return J(e)},he=typeof document=="object"&&document.all,pe={all:he,IS_HTMLDDA:he===void 0&&he!==void 0},le=pe.all,Me=pe.IS_HTMLDDA?function(e){return typeof e=="function"||e===le}:function(e){return typeof e=="function"},He={},rt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),we=f,Ce=Function.prototype.call,ve=we?Ce.bind(Ce):function(){return Ce.apply(Ce,arguments)},Ne={},be={}.propertyIsEnumerable,Te=Object.getOwnPropertyDescriptor,Ae=Te&&!be.call({1:2},1);Ne.f=Ae?function(e){var r=Te(this,e);return!!r&&r.enumerable}:be;var Ue,ze,et=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},nt=d,dt=ee,Xe=Object,Ct=A("".split),hn=nt(function(){return!Xe("z").propertyIsEnumerable(0)})?function(e){return dt(e)=="String"?Ct(e,""):Xe(e)}:Xe,Ut=function(e){return e==null},ln=Ut,xn=TypeError,Yt=function(e){if(ln(e))throw xn("Can't call method on "+e);return e},Yn=hn,Kt=Yt,Re=function(e){return Yn(Kt(e))},Fe=Me,Ke=pe.all,_t=pe.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Fe(e)||e===Ke}:function(e){return typeof e=="object"?e!==null:Fe(e)},vt={},Ge=vt,Ot=j,Xt=Me,pn=function(e){return Xt(e)?e:void 0},an=function(e,r){return arguments.length<2?pn(Ge[e])||pn(Ot[e]):Ge[e]&&Ge[e][r]||Ot[e]&&Ot[e][r]},ir=typeof navigator<"u"&&String(navigator.userAgent)||"",na=j,Vt=ir,sn=na.process,Ii=na.Deno,di=sn&&sn.versions||Ii&&Ii.version,yi=di&&di.v8;yi&&(ze=(Ue=yi.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!ze&&Vt&&(!(Ue=Vt.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Vt.match(/Chrome\/(\d+)/))&&(ze=+Ue[1]);var dr=ze,Ua=dr,Zc=d,co=j.String,lo=!!Object.getOwnPropertySymbols&&!Zc(function(){var e=Symbol();return!co(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ua&&Ua<41}),xl=lo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Us=an,ac=Me,ra=N,cc=Object,el=xl?function(e){return typeof e=="symbol"}:function(e){var r=Us("Symbol");return ac(r)&&ra(r.prototype,cc(e))},Nu=String,lc=function(e){try{return Nu(e)}catch{return"Object"}},tl=Me,Co=lc,Ni=TypeError,ls=function(e){if(tl(e))return e;throw Ni(Co(e)+" is not a function")},Va=ls,Du=Ut,uc=function(e,r){var i=e[r];return Du(i)?void 0:Va(i)},ia=ve,sa=Me,Dd=_t,Og=TypeError,Lu={exports:{}},ip=j,Vs=Object.defineProperty,xu=function(e,r){try{Vs(ip,e,{value:r,configurable:!0,writable:!0})}catch{ip[e]=r}return r},oa="__core-js_shared__",Ld=j[oa]||xu(oa,{}),xd=Ld;(Lu.exports=function(e,r){return xd[e]||(xd[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Fa=Lu.exports,Md=Yt,Mu=Object,Io=function(e){return Mu(Md(e))},Ud=Io,Fr=A({}.hasOwnProperty),hi=Object.hasOwn||function(e,r){return Fr(Ud(e),r)},dc=A,nl=0,aa=Math.random(),sp=dc(1 .toString),Vd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+sp(++nl+aa,36)},Ml=Fa,uo=hi,xf=Vd,Ks=lo,op=xl,rl=j.Symbol,Fd=Ml("wks"),jd=op?rl.for||rl:rl&&rl.withoutSetter||xf,hr=function(e){return uo(Fd,e)||(Fd[e]=Ks&&uo(rl,e)?rl[e]:jd("Symbol."+e)),Fd[e]},Ul=ve,Vl=_t,Uu=el,ja=uc,Ao=function(e,r){var i,o;if(sa(i=e.toString)&&!Dd(o=ia(i,e))||sa(i=e.valueOf)&&!Dd(o=ia(i,e)))return o;throw Og("Can't convert object to primitive value")},Vu=TypeError,il=hr("toPrimitive"),Fl=function(e,r){if(!Vl(e)||Uu(e))return e;var i,o=ja(e,il);if(o){if(i=Ul(o,e,r),!Vl(i)||Uu(i))return i;throw Vu("Can't convert object to primitive value")}return Ao(e)},zr=el,Ba=function(e){var r=Fl(e,"string");return zr(r)?r:r+""},nr=_t,hc=j.document,Mf=nr(hc)&&nr(hc.createElement),jl=function(e){return Mf?hc.createElement(e):{}},Bd=jl,ap=!rt&&!d(function(){return Object.defineProperty(Bd("div"),"a",{get:function(){return 7}}).a!=7}),Uf=rt,cp=ve,Po=Ne,ns=et,Oo=Re,ko=Ba,Bl=hi,No=ap,Do=Object.getOwnPropertyDescriptor;He.f=Uf?Do:function(e,r){if(e=Oo(e),r=ko(r),No)try{return Do(e,r)}catch{}if(Bl(e,r))return ns(!cp(Po.f,e,r),e[r])};var Vf=d,pc=Me,us=/#|\.prototype\./,Fu=function(e,r){var i=sl[lp(e)];return i==Ff||i!=Wl&&(pc(r)?Vf(r):!!r)},lp=Fu.normalize=function(e){return String(e).replace(us,".").toLowerCase()},sl=Fu.data={},Wl=Fu.NATIVE="N",Ff=Fu.POLYFILL="P",ca=Fu,la=ls,ol=f,Se=se(se.bind),De=function(e,r){return la(e),r===void 0?e:ol?Se(e,r):function(){return e.apply(r,arguments)}},tt={},$t=rt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Hn=_t,_r=String,jr=TypeError,cn=function(e){if(Hn(e))return e;throw jr(_r(e)+" is not an object")},Nr=rt,pi=ap,Is=$t,Lo=cn,xo=Ba,ju=TypeError,Ki=Object.defineProperty,al=Object.getOwnPropertyDescriptor,Wd="enumerable",fc="configurable",kg="writable";tt.f=Nr?Is?function(e,r,i){if(Lo(e),r=xo(r),Lo(i),typeof e=="function"&&r==="prototype"&&"value"in i&&kg in i&&!i[kg]){var o=al(e,r);o&&o[kg]&&(e[r]=i.value,i={configurable:fc in i?i[fc]:o[fc],enumerable:Wd in i?i[Wd]:o[Wd],writable:!1})}return Ki(e,r,i)}:Ki:function(e,r,i){if(Lo(e),r=xo(r),Lo(i),pi)try{return Ki(e,r,i)}catch{}if("get"in i||"set"in i)throw ju("Accessors not supported");return"value"in i&&(e[r]=i.value),e};var jf=tt,Bu=et,Mo=rt?function(e,r,i){return jf.f(e,r,Bu(1,i))}:function(e,r,i){return e[r]=i,e},zl=j,Bf=ne,Ng=se,FE=Me,Wf=He.f,zf=ca,Wu=vt,zu=De,Gu=Mo,Dg=hi,jE=function(e){var r=function(i,o,c){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return Bf(e,this,arguments)};return r.prototype=e.prototype,r},Mn=function(e,r){var i,o,c,u,h,m,_,y,S,R=e.target,P=e.global,k=e.stat,W=e.proto,U=P?zl:k?zl[R]:(zl[R]||{}).prototype,V=P?Wu:Wu[R]||Gu(Wu,R,{})[R],q=V.prototype;for(u in r)o=!(i=zf(P?u:R+(k?".":"#")+u,e.forced))&&U&&Dg(U,u),m=V[u],o&&(_=e.dontCallGetSet?(S=Wf(U,u))&&S.value:U[u]),h=o&&_?_:r[u],o&&typeof m==typeof h||(y=e.bind&&o?zu(h,zl):e.wrap&&o?jE(h):W&&FE(h)?Ng(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Gu(y,"sham",!0),Gu(V,u,y),W&&(Dg(Wu,c=R+"Prototype")||Gu(Wu,c,{}),Gu(Wu[c],u,h),e.real&&q&&(i||!q[u])&&Gu(q,u,h)))},Gf=Math.ceil,Uo=Math.floor,BE=Math.trunc||function(e){var r=+e;return(r>0?Uo:Gf)(r)},WE=BE,mc=function(e){var r=+e;return r!=r||r===0?0:WE(r)},C=mc,B=Math.max,Q=Math.min,fe=function(e,r){var i=C(e);return i<0?B(i+r,0):Q(i,r)},qe=mc,at=Math.min,xt=function(e){return e>0?at(qe(e),9007199254740991):0},Gr=xt,ii=function(e){return Gr(e.length)},Er=Re,Fs=fe,ds=ii,Wa=function(e){return function(r,i,o){var c,u=Er(r),h=ds(u),m=Fs(o,h);if(e&&i!=i){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===i)return e||m||0;return!e&&-1}},Vo={includes:Wa(!0),indexOf:Wa(!1)},up=Vo.includes;Mn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return up(this,e,arguments.length>1?arguments[1]:void 0)}});var Hf=vt,za=function(e){return Hf[e+"Prototype"]},sC=za("Array").includes,oC=_t,$f=ee,G1=hr("match"),aC=function(e){var r;return oC(e)&&((r=e[G1])!==void 0?!!r:$f(e)=="RegExp")},H1=aC,cC=TypeError,D0={};D0[hr("toStringTag")]="z";var dp=String(D0)==="[object z]",Lg=dp,$1=Me,hp=ee,K1=hr("toStringTag"),lC=Object,L0=hp(function(){return arguments}())=="Arguments",gc=Lg?hp:function(e){var r,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(r=lC(e),K1))=="string"?i:L0?hp(r):(o=hp(r))=="Object"&&$1(r.callee)?"Arguments":o},uC=gc,dC=String,ua=function(e){if(uC(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return dC(e)},q1=hr("match"),Y1=Mn,X1=function(e){if(H1(e))throw cC("The method doesn't accept regular expressions");return e},J1=Yt,hC=ua,cl=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[q1]=!1,"/./"[e](r)}catch{}}return!1},xg=A("".indexOf);Y1({target:"String",proto:!0,forced:!cl("includes")},{includes:function(e){return!!~xg(hC(J1(this)),hC(X1(e)),arguments.length>1?arguments[1]:void 0)}});var pC=za("String").includes,x0=N,fC=sC,mC=pC,Mg=Array.prototype,M0=String.prototype,Q1=function(e){var r=e.includes;return e===Mg||x0(Mg,e)&&r===Mg.includes?fC:typeof e=="string"||e===M0||x0(M0,e)&&r===M0.includes?mC:r},ot=l(Q1),U0=ls,Ug=Io,V0=hn,gC=ii,zE=TypeError,Kf=function(e){return function(r,i,o,c){U0(i);var u=Ug(r),h=V0(u),m=gC(u),_=e?m-1:0,y=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=y;break}if(_+=y,e?_<0:m<=_)throw zE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=y)_ in h&&(c=i(c,h[_],_,u));return c}},F0={left:Kf(!1)},_C=d,pp=function(e,r){var i=[][e];return!!i&&_C(function(){i.call(null,r||function(){return 1},1)})},fp=typeof process<"u"&&ee(process)=="process",EC=F0.left;Mn({target:"Array",proto:!0,forced:!fp&&dr>79&&dr<83||!pp("reduce")},{reduce:function(e){var r=arguments.length;return EC(this,e,r,r>1?arguments[1]:void 0)}});var yC=za("Array").reduce,vC=N,SC=yC,GE=Array.prototype,zd=function(e){var r=e.reduce;return e===GE||vC(GE,e)&&r===GE.reduce?SC:r},HE=zd,Ga=l(HE),Z1=ee,Vg=Array.isArray||function(e){return Z1(e)=="Array"},Fg=Mn,eN=Vg,TC=A([].reverse),j0=[1,2];Fg({target:"Array",proto:!0,forced:String(j0)===String(j0.reverse())},{reverse:function(){return eN(this)&&(this.length=this.length),TC(this)}});var vi=za("Array").reverse,B0=N,$E=vi,mp=Array.prototype,bC=function(e){var r=e.reverse;return e===mp||B0(mp,e)&&r===mp.reverse?$E:r},KE=bC,qf=l(KE),qE=Vd,gp=Fa("keys"),jg=function(e){return gp[e]||(gp[e]=qE(e))},tN=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),nN=hi,wC=Me,YE=Io,XE=tN,JE=jg("IE_PROTO"),Bg=Object,W0=Bg.prototype,Wg=XE?Bg.getPrototypeOf:function(e){var r=YE(e);if(nN(r,JE))return r[JE];var i=r.constructor;return wC(i)&&r instanceof i?i.prototype:r instanceof Bg?W0:null},rN=A,RC=ls,iN=Me,sN=String,z0=TypeError,Gd=function(e,r,i){try{return rN(RC(Object.getOwnPropertyDescriptor(e,r)[i]))}catch{}},CC=cn,Yf=function(e){if(typeof e=="object"||iN(e))return e;throw z0("Can't set "+sN(e)+" as a prototype")},Gl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,i={};try{(e=Gd(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(o,c){return CC(o),Yf(c),r?e(o,c):o.__proto__=c,o}}():void 0),Hd={},_c={},zg=hi,oN=Re,aN=Vo.indexOf,_p=_c,Xf=A([].push),Ep=function(e,r){var i,o=oN(e),c=0,u=[];for(i in o)!zg(_p,i)&&zg(o,i)&&Xf(u,i);for(;r.length>c;)zg(o,i=r[c++])&&(~aN(u,i)||Xf(u,i));return u},Jf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],G0=Ep,Qf=Jf.concat("length","prototype");Hd.f=Object.getOwnPropertyNames||function(e){return G0(e,Qf)};var Ec={};Ec.f=Object.getOwnPropertySymbols;var Si=an,fi=Hd,$d=Ec,ho=cn,da=A([].concat),yp=Si("Reflect","ownKeys")||function(e){var r=fi.f(ho(e)),i=$d.f;return i?da(r,i(e)):r},vp=hi,ha=yp,QE=He,IC=tt,ZE={},ey=Ep,AC=Jf,yc=Object.keys||function(e){return ey(e,AC)},ty=rt,H0=$t,PC=tt,cN=cn,Kd=Re,Zf=yc;ZE.f=ty&&!H0?Object.defineProperties:function(e,r){cN(e);for(var i,o=Kd(r),c=Zf(r),u=c.length,h=0;u>h;)PC.f(e,i=c[h++],o[i]);return e};var Hu,Gg=an("document","documentElement"),ny=cn,vc=ZE,Ha=Jf,Sp=_c,$u=Gg,Ku=jl,qu="prototype",ry="script",iy=jg("IE_PROTO"),Hg=function(){},pa=function(e){return"<"+ry+">"+e+"</"+ry+">"},fa=function(e){e.write(pa("")),e.close();var r=e.parentWindow.Object;return e=null,r},si=function(){try{Hu=new ActiveXObject("htmlfile")}catch{}var e,r,i;si=typeof document<"u"?document.domain&&Hu?fa(Hu):(r=Ku("iframe"),i="java"+ry+":",r.style.display="none",$u.appendChild(r),r.src=String(i),(e=r.contentWindow.document).open(),e.write(pa("document.F=Object")),e.close(),e.F):fa(Hu);for(var o=Ha.length;o--;)delete si[qu][Ha[o]];return si()};Sp[iy]=!0;var Fo=Object.create||function(e,r){var i;return e!==null?(Hg[qu]=ny(e),i=new Hg,Hg[qu]=null,i[iy]=e):i=si(),r===void 0?i:vc.f(i,r)},OC=_t,kC=Mo,sy=Error,$0=A("".replace),NC=String(sy("zxcasd").stack),$g=/\n\s*at [^:]*:[^\n]*/,DC=$g.test(NC),em=et,K0=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",em(1,7)),e.stack!==7)}),lN=Mo,Kg=function(e,r){if(DC&&typeof e=="string"&&!sy.prepareStackTrace)for(;r--;)e=$0(e,$g,"");return e},oy=K0,q0=Error.captureStackTrace,qd={},tm=qd,LC=hr("iterator"),ay=Array.prototype,qg=function(e){return e!==void 0&&(tm.Array===e||ay[LC]===e)},nm=gc,cy=uc,Y0=Ut,X0=qd,J0=hr("iterator"),Yu=function(e){if(!Y0(e))return cy(e,J0)||cy(e,"@@iterator")||X0[nm(e)]},Sc=ve,Tp=ls,Q0=cn,xC=lc,Xu=Yu,Yd=TypeError,Yg=function(e,r){var i=arguments.length<2?Xu(e):r;if(Tp(i))return Q0(Sc(i,e));throw Yd(xC(e)+" is not iterable")},MC=ve,Hl=cn,Xd=uc,Xg=function(e,r,i){var o,c;Hl(e);try{if(!(o=Xd(e,"return"))){if(r==="throw")throw i;return i}o=MC(o,e)}catch(u){c=!0,o=u}if(r==="throw")throw i;if(c)throw o;return Hl(o),i},UC=De,ly=ve,VC=cn,Jg=lc,$l=qg,Qg=ii,rm=N,bp=Yg,Z0=Yu,wp=Xg,FC=TypeError,im=function(e,r){this.stopped=e,this.result=r},Ai=im.prototype,Jd=function(e,r,i){var o,c,u,h,m,_,y,S=i&&i.that,R=!(!i||!i.AS_ENTRIES),P=!(!i||!i.IS_RECORD),k=!(!i||!i.IS_ITERATOR),W=!(!i||!i.INTERRUPTED),U=UC(r,S),V=function(Y){return o&&wp(o,"normal",Y),new im(!0,Y)},q=function(Y){return R?(VC(Y),W?U(Y[0],Y[1],V):U(Y[0],Y[1])):W?U(Y,V):U(Y)};if(P)o=e.iterator;else if(k)o=e;else{if(!(c=Z0(e)))throw FC(Jg(e)+" is not iterable");if($l(c)){for(u=0,h=Qg(e);h>u;u++)if((m=q(e[u]))&&rm(Ai,m))return m;return new im(!1)}o=bp(e,c)}for(_=P?e.next:o.next;!(y=ly(_,o)).done;){try{m=q(y.value)}catch(Y){wp(o,"throw",Y)}if(typeof m=="object"&&m&&rm(Ai,m))return m}return new im(!1)},eT=ua,tT=Mn,uy=N,nT=Wg,Kl=Gl,Di=function(e,r,i){for(var o=ha(r),c=IC.f,u=QE.f,h=0;h<o.length;h++){var m=o[h];vp(e,m)||i&&vp(i,m)||c(e,m,u(r,m))}},hs=Fo,ps=Mo,sm=et,Zg=function(e,r){OC(r)&&"cause"in r&&kC(e,"cause",r.cause)},e_=function(e,r,i,o){oy&&(q0?q0(e,r):lN(e,"stack",Kg(i,o)))},uN=Jd,po=function(e,r){return e===void 0?arguments.length<2?"":r:eT(e)},rT=hr("toStringTag"),om=Error,iT=[].push,jo=function(e,r){var i,o=uy(ma,this);Kl?i=Kl(om(),o?nT(this):ma):(i=o?this:hs(ma),ps(i,rT,"Error")),r!==void 0&&ps(i,"message",po(r)),e_(i,jo,i.stack,1),arguments.length>2&&Zg(i,arguments[2]);var c=[];return uN(e,iT,{that:c}),ps(i,"errors",c),i};Kl?Kl(jo,om):Di(jo,om,{name:!0});var ma=jo.prototype=hs(om.prototype,{constructor:sm(1,jo),message:sm(1,""),name:sm(1,"AggregateError")});tT({global:!0},{AggregateError:jo});var Qd,Rp,am,jC=Me,sT=j.WeakMap,BC=jC(sT)&&/native code/.test(String(sT)),oT=j,WC=_t,zC=Mo,dy=hi,hy=Ld,t_=jg,GC=_c,n_="Object already initialized",cm=oT.TypeError,HC=oT.WeakMap;if(BC||hy.state){var Tc=hy.state||(hy.state=new HC);Tc.get=Tc.get,Tc.has=Tc.has,Tc.set=Tc.set,Qd=function(e,r){if(Tc.has(e))throw cm(n_);return r.facade=e,Tc.set(e,r),r},Rp=function(e){return Tc.get(e)||{}},am=function(e){return Tc.has(e)}}else{var Cp=t_("state");GC[Cp]=!0,Qd=function(e,r){if(dy(e,Cp))throw cm(n_);return r.facade=e,zC(e,Cp,r),r},Rp=function(e){return dy(e,Cp)?e[Cp]:{}},am=function(e){return dy(e,Cp)}}var Zd,aT,cT,Ju={set:Qd,get:Rp,has:am,enforce:function(e){return am(e)?Rp(e):Qd(e,{})},getterFor:function(e){return function(r){var i;if(!WC(r)||(i=Rp(r)).type!==e)throw cm("Incompatible receiver, "+e+" required");return i}}},py=rt,$C=hi,lT=Function.prototype,dN=py&&Object.getOwnPropertyDescriptor,uT=$C(lT,"name"),KC={PROPER:uT&&(function(){}).name==="something",CONFIGURABLE:uT&&(!py||py&&dN(lT,"name").configurable)},hN=Mo,Qu=function(e,r,i,o){return o&&o.enumerable?e[r]=i:hN(e,r,i),e},qC=d,YC=Me,fy=_t,pN=Fo,XC=Wg,fN=Qu,$a=hr("iterator"),my=!1;[].keys&&("next"in(cT=[].keys())?(aT=XC(XC(cT)))!==Object.prototype&&(Zd=aT):my=!0);var gy=!fy(Zd)||qC(function(){var e={};return Zd[$a].call(e)!==e});YC((Zd=gy?{}:pN(Zd))[$a])||fN(Zd,$a,function(){return this});var dT={IteratorPrototype:Zd,BUGGY_SAFARI_ITERATORS:my},JC=gc,QC=dp?{}.toString:function(){return"[object "+JC(this)+"]"},hT=dp,lm=tt.f,pT=Mo,fT=hi,mN=QC,mT=hr("toStringTag"),Zu=function(e,r,i,o){if(e){var c=i?e:e.prototype;fT(c,mT)||lm(c,mT,{configurable:!0,value:r}),o&&!hT&&pT(c,"toString",mN)}},ZC=dT.IteratorPrototype,eI=Fo,tI=et,gN=Zu,ga=qd,Bo=function(){return this},_y=function(e,r,i,o){var c=r+" Iterator";return e.prototype=eI(ZC,{next:tI(+!o,i)}),gN(e,c,!1,!0),ga[c]=Bo,e},nI=Mn,rI=ve,iI=KC,sI=_y,gT=Wg,oI=Zu,Ey=Qu,_T=qd,aI=dT,ET=iI.PROPER,um=aI.BUGGY_SAFARI_ITERATORS,yy=hr("iterator"),vy="keys",Ip="values",cI="entries",lI=function(){return this},Sy=function(e,r,i,o,c,u,h){sI(i,r,o);var m,_,y,S=function(q){if(q===c&&U)return U;if(!um&&q in k)return k[q];switch(q){case vy:case Ip:case cI:return function(){return new i(this,q)}}return function(){return new i(this)}},R=r+" Iterator",P=!1,k=e.prototype,W=k[yy]||k["@@iterator"]||c&&k[c],U=!um&&W||S(c),V=r=="Array"&&k.entries||W;if(V&&(m=gT(V.call(new e)))!==Object.prototype&&m.next&&(oI(m,R,!0,!0),_T[R]=lI),ET&&c==Ip&&W&&W.name!==Ip&&(P=!0,U=function(){return rI(W,this)}),c)if(_={values:S(Ip),keys:u?U:S(vy),entries:S(cI)},h)for(y in _)(um||P||!(y in k))&&Ey(k,y,_[y]);else nI({target:r,proto:!0,forced:um||P},_);return h&&k[yy]!==U&&Ey(k,yy,U,{}),_T[r]=U,_},Ty=function(e,r){return{value:e,done:r}},by=Re,ql=qd,uI=Ju;tt.f;var dI=Sy,wy=Ty,yT="Array Iterator",hI=uI.set,r_=uI.getterFor(yT);dI(Array,"Array",function(e,r){hI(this,{type:yT,target:by(e),index:0,kind:r})},function(){var e=r_(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,wy(void 0,!0)):wy(i=="keys"?o:i=="values"?r[o]:[o,r[o]],!1)},"values"),ql.Arguments=ql.Array;var fo=tt,Ry=function(e,r,i){return fo.f(e,r,i)},_N=an,Cy=Ry,mo=rt,pI=hr("species"),Jt=N,dm=TypeError,i_=function(e,r){if(Jt(r,e))return e;throw dm("Incorrect invocation")},fI=Me,vT=Ld,s_=A(Function.toString);fI(vT.inspectSource)||(vT.inspectSource=function(e){return s_(e)});var o_=vT.inspectSource,ST=A,mI=d,TT=Me,gI=gc,bT=o_,Iy=function(){},qs=[],bc=an("Reflect","construct"),Yl=/^\s*(?:class|function)\b/,_I=ST(Yl.exec),EI=!Yl.exec(Iy),Wo=function(e){if(!TT(e))return!1;try{return bc(Iy,qs,e),!0}catch{return!1}},wT=function(e){if(!TT(e))return!1;switch(gI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return EI||!!_I(Yl,bT(e))}catch{return!0}};wT.sham=!0;var _a,hm,RT,Ay,a_=!bc||mI(function(){var e;return Wo(Wo.call)||!Wo(Object)||!Wo(function(){e=!0})||e})?wT:Wo,yI=a_,EN=lc,Py=TypeError,Oy=cn,wc=function(e){if(yI(e))return e;throw Py(EN(e)+" is not a constructor")},br=Ut,js=hr("species"),qi=function(e,r){var i,o=Oy(e).constructor;return o===void 0||br(i=Oy(o)[js])?r:wc(i)},fs=A([].slice),Ka=TypeError,ll=function(e,r){if(e<r)throw Ka("Not enough arguments");return e},ms=/(?:ipad|iphone|ipod).*applewebkit/i.test(ir),Ys=j,Ap=ne,ky=De,Ny=Me,c_=hi,zo=d,Dy=Gg,pm=fs,Xl=jl,Ly=ll,CT=ms,eh=fp,fm=Ys.setImmediate,Jl=Ys.clearImmediate,xy=Ys.process,Pp=Ys.Dispatch,IT=Ys.Function,l_=Ys.MessageChannel,My=Ys.String,Xs=0,Rc={},Cc="onreadystatechange";zo(function(){_a=Ys.location});var go=function(e){if(c_(Rc,e)){var r=Rc[e];delete Rc[e],r()}},Uy=function(e){return function(){go(e)}},Vy=function(e){go(e.data)},Fy=function(e){Ys.postMessage(My(e),_a.protocol+"//"+_a.host)};fm&&Jl||(fm=function(e){Ly(arguments.length,1);var r=Ny(e)?e:IT(e),i=pm(arguments,1);return Rc[++Xs]=function(){Ap(r,void 0,i)},hm(Xs),Xs},Jl=function(e){delete Rc[e]},eh?hm=function(e){xy.nextTick(Uy(e))}:Pp&&Pp.now?hm=function(e){Pp.now(Uy(e))}:l_&&!CT?(Ay=(RT=new l_).port2,RT.port1.onmessage=Vy,hm=ky(Ay.postMessage,Ay)):Ys.addEventListener&&Ny(Ys.postMessage)&&!Ys.importScripts&&_a&&_a.protocol!=="file:"&&!zo(Fy)?(hm=Fy,Ys.addEventListener("message",Vy,!1)):hm=Cc in Xl("script")?function(e){Dy.appendChild(Xl("script"))[Cc]=function(){Dy.removeChild(this),go(e)}}:function(e){setTimeout(Uy(e),0)});var jy={set:fm,clear:Jl},ed=function(){this.head=null,this.tail=null};ed.prototype={add:function(e){var r={item:e,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Op,u_,td,d_,th,AT=ed,vI=/ipad|iphone|ipod/i.test(ir)&&typeof Pebble<"u",PT=/web0s(?!.*chrome)/i.test(ir),Ql=j,SI=De,yN=He.f,By=jy.set,TI=AT,kp=ms,vN=vI,mm=PT,Wy=fp,Li=Ql.MutationObserver||Ql.WebKitMutationObserver,bI=Ql.document,OT=Ql.process,zy=Ql.Promise,wI=yN(Ql,"queueMicrotask"),Gy=wI&&wI.value;if(!Gy){var h_=new TI,Hy=function(){var e,r;for(Wy&&(e=OT.domain)&&e.exit();r=h_.get();)try{r()}catch(i){throw h_.head&&Op(),i}e&&e.enter()};kp||Wy||mm||!Li||!bI?!vN&&zy&&zy.resolve?((d_=zy.resolve(void 0)).constructor=zy,th=SI(d_.then,d_),Op=function(){th(Hy)}):Wy?Op=function(){OT.nextTick(Hy)}:(By=SI(By,Ql),Op=function(){By(Hy)}):(u_=!0,td=bI.createTextNode(""),new Li(Hy).observe(td,{characterData:!0}),Op=function(){td.data=u_=!u_}),Gy=function(e){h_.head||Op(),h_.add(e)}}var qa=Gy,nh=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},Np=j.Promise,nd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",$y=!nd&&!fp&&typeof window=="object"&&typeof document=="object",Dp=j,rh=Np,kT=Me,NT=ca,SN=o_,DT=hr,TN=$y,RI=nd,Ky=dr,p_=rh&&rh.prototype,qy=DT("species"),LT=kT(Dp.PromiseRejectionEvent),xT=NT("Promise",function(){var e=SN(rh),r=e!==String(rh);if(!r&&Ky===66||!p_.catch||!p_.finally)return!0;if(!Ky||Ky<51||!/native code/.test(e)){var i=new rh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[qy]=o,!(i.then(function(){})instanceof o))return!0}return!r&&(TN||RI)&&!LT}),f_={CONSTRUCTOR:xT,REJECTION_EVENT:LT},ul={},Yy=ls,Xy=TypeError,MT=function(e){var r,i;this.promise=new e(function(o,c){if(r!==void 0||i!==void 0)throw Xy("Bad Promise constructor");r=o,i=c}),this.resolve=Yy(r),this.reject=Yy(i)};ul.f=function(e){return new MT(e)};var gm,UT,bN=Mn,Lp=fp,ih=j,rd=ve,wN=Qu,Jy=Zu,p=function(e){var r=_N(e);mo&&r&&!r[pI]&&Cy(r,pI,{configurable:!0,get:function(){return this}})},g=ls,b=Me,O=_t,M=i_,G=qi,ae=jy.set,Ie=qa,xe=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},it=nh,It=AT,At=Ju,Rt=Np,Gt=f_,Zt=ul,en="Promise",Yi=Gt.CONSTRUCTOR,Je=Gt.REJECTION_EVENT,Ve=At.getterFor(en),Ze=At.set,Nt=Rt&&Rt.prototype,tn=Rt,fn=Nt,En=ih.TypeError,On=ih.document,gs=ih.process,yr=Zt.f,sh=yr,RN=!!(On&&On.createEvent&&ih.dispatchEvent),u4="unhandledrejection",d4=function(e){var r;return!(!O(e)||!b(r=e.then))&&r},h4=function(e,r){var i,o,c,u=r.value,h=r.state==1,m=h?e.ok:e.fail,_=e.resolve,y=e.reject,S=e.domain;try{m?(h||(r.rejection===2&&Dse(r),r.rejection=1),m===!0?i=u:(S&&S.enter(),i=m(u),S&&(S.exit(),c=!0)),i===e.promise?y(En("Promise-chain cycle")):(o=d4(i))?rd(o,i,_,y):_(i)):y(u)}catch(R){S&&!c&&S.exit(),y(R)}},p4=function(e,r){e.notified||(e.notified=!0,Ie(function(){for(var i,o=e.reactions;i=o.get();)h4(i,e);e.notified=!1,r&&!e.rejection&&Nse(e)}))},f4=function(e,r,i){var o,c;RN?((o=On.createEvent("Event")).promise=r,o.reason=i,o.initEvent(e,!1,!0),ih.dispatchEvent(o)):o={promise:r,reason:i},!Je&&(c=ih["on"+e])?c(o):e===u4&&xe("Unhandled promise rejection",i)},Nse=function(e){rd(ae,ih,function(){var r,i=e.facade,o=e.value;if(m4(e)&&(r=it(function(){Lp?gs.emit("unhandledRejection",o,i):f4(u4,i,o)}),e.rejection=Lp||m4(e)?2:1,r.error))throw r.value})},m4=function(e){return e.rejection!==1&&!e.parent},Dse=function(e){rd(ae,ih,function(){var r=e.facade;Lp?gs.emit("rejectionHandled",r):f4("rejectionhandled",r,e.value)})},Qy=function(e,r,i){return function(o){e(r,o,i)}},Zy=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,p4(e,!0))},CN=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw En("Promise can't be resolved itself");var o=d4(r);o?Ie(function(){var c={done:!1};try{rd(o,r,Qy(CN,c,e),Qy(Zy,c,e))}catch(u){Zy(c,u,e)}}):(e.value=r,e.state=1,p4(e,!1))}catch(c){Zy({done:!1},c,e)}}};Yi&&(fn=(tn=function(e){M(this,fn),g(e),rd(gm,this);var r=Ve(this);try{e(Qy(CN,r),Qy(Zy,r))}catch(i){Zy(r,i)}}).prototype,(gm=function(e){Ze(this,{type:en,done:!1,notified:!1,parent:!1,reactions:new It,rejection:!1,state:0,value:void 0})}).prototype=wN(fn,"then",function(e,r){var i=Ve(this),o=yr(G(this,tn));return i.parent=!0,o.ok=!b(e)||e,o.fail=b(r)&&r,o.domain=Lp?gs.domain:void 0,i.state==0?i.reactions.add(o):Ie(function(){h4(o,i)}),o.promise}),UT=function(){var e=new gm,r=Ve(e);this.promise=e,this.resolve=Qy(CN,r),this.reject=Qy(Zy,r)},Zt.f=yr=function(e){return e===tn||e===void 0?new UT(e):sh(e)}),bN({global:!0,wrap:!0,forced:Yi},{Promise:tn}),Jy(tn,en,!1,!0),p(en);var g4=hr("iterator"),_4=!1;try{var Lse=0,E4={next:function(){return{done:!!Lse++}},return:function(){_4=!0}};E4[g4]=function(){return this},Array.from(E4,function(){throw 2})}catch{}var xse=Np,Mse=function(e,r){if(!_4)return!1;var i=!1;try{var o={};o[g4]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},CI=f_.CONSTRUCTOR||!Mse(function(e){xse.all(e).then(void 0,function(){})}),Use=ve,Vse=ls,Fse=ul,jse=nh,Bse=Jd;Mn({target:"Promise",stat:!0,forced:CI},{all:function(e){var r=this,i=Fse.f(r),o=i.resolve,c=i.reject,u=jse(function(){var h=Vse(r.resolve),m=[],_=0,y=1;Bse(e,function(S){var R=_++,P=!1;y++,Use(h,r,S).then(function(k){P||(P=!0,m[R]=k,--y||o(m))},c)}),--y||o(m)});return u.error&&c(u.value),i.promise}});var Wse=Mn,zse=f_.CONSTRUCTOR;Np&&Np.prototype,Wse({target:"Promise",proto:!0,forced:zse,real:!0},{catch:function(e){return this.then(void 0,e)}});var Gse=ve,Hse=ls,$se=ul,Kse=nh,qse=Jd;Mn({target:"Promise",stat:!0,forced:CI},{race:function(e){var r=this,i=$se.f(r),o=i.reject,c=Kse(function(){var u=Hse(r.resolve);qse(e,function(h){Gse(u,r,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var Yse=ve,Xse=ul;Mn({target:"Promise",stat:!0,forced:f_.CONSTRUCTOR},{reject:function(e){var r=Xse.f(this);return Yse(r.reject,void 0,e),r.promise}});var Jse=cn,Qse=_t,Zse=ul,y4=function(e,r){if(Jse(e),Qse(r)&&r.constructor===e)return r;var i=Zse.f(e);return(0,i.resolve)(r),i.promise},eoe=Mn,toe=Np,noe=f_.CONSTRUCTOR,roe=y4,ioe=an("Promise"),soe=!noe;eoe({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return roe(soe&&this===ioe?toe:this,e)}});var ooe=ve,aoe=ls,coe=ul,loe=nh,uoe=Jd;Mn({target:"Promise",stat:!0,forced:CI},{allSettled:function(e){var r=this,i=coe.f(r),o=i.resolve,c=i.reject,u=loe(function(){var h=aoe(r.resolve),m=[],_=0,y=1;uoe(e,function(S){var R=_++,P=!1;y++,ooe(h,r,S).then(function(k){P||(P=!0,m[R]={status:"fulfilled",value:k},--y||o(m))},function(k){P||(P=!0,m[R]={status:"rejected",reason:k},--y||o(m))})}),--y||o(m)});return u.error&&c(u.value),i.promise}});var doe=ve,hoe=ls,poe=an,foe=ul,moe=nh,goe=Jd,v4="No one promise resolved";Mn({target:"Promise",stat:!0,forced:CI},{any:function(e){var r=this,i=poe("AggregateError"),o=foe.f(r),c=o.resolve,u=o.reject,h=moe(function(){var m=hoe(r.resolve),_=[],y=0,S=1,R=!1;goe(e,function(P){var k=y++,W=!1;S++,doe(m,r,P).then(function(U){W||R||(R=!0,c(U))},function(U){W||R||(W=!0,_[k]=U,--S||u(new i(_,v4)))})}),--S||u(new i(_,v4))});return h.error&&u(h.value),o.promise}});var _oe=Mn,IN=Np,Eoe=d,yoe=an,voe=Me,Soe=qi,S4=y4,Toe=IN&&IN.prototype;_oe({target:"Promise",proto:!0,real:!0,forced:!!IN&&Eoe(function(){Toe.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=Soe(this,yoe("Promise")),i=voe(e);return this.then(i?function(o){return S4(r,e()).then(function(){return o})}:e,i?function(o){return S4(r,e()).then(function(){throw o})}:e)}});var AN=A,boe=mc,woe=ua,Roe=Yt,Coe=AN("".charAt),T4=AN("".charCodeAt),Ioe=AN("".slice),b4=function(e){return function(r,i){var o,c,u=woe(Roe(r)),h=boe(i),m=u.length;return h<0||h>=m?e?"":void 0:(o=T4(u,h))<55296||o>56319||h+1===m||(c=T4(u,h+1))<56320||c>57343?e?Coe(u,h):o:e?Ioe(u,h,h+2):c-56320+(o-55296<<10)+65536}},PN={codeAt:b4(!1),charAt:b4(!0)},Aoe=PN.charAt,Poe=ua,w4=Ju,Ooe=Sy,R4=Ty,C4="String Iterator",koe=w4.set,Noe=w4.getterFor(C4);Ooe(String,"String",function(e){koe(this,{type:C4,string:Poe(e),index:0})},function(){var e,r=Noe(this),i=r.string,o=r.index;return o>=i.length?R4(void 0,!0):(e=Aoe(i,o),r.index+=e.length,R4(e,!1))});var Doe=vt.Promise,Loe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xoe=j,Moe=gc,Uoe=Mo,I4=qd,A4=hr("toStringTag");for(var ON in Loe){var P4=xoe[ON],kN=P4&&P4.prototype;kN&&Moe(kN)!==A4&&Uoe(kN,A4,ON),I4[ON]=I4.Array}var O4=Doe,lt=l(O4),Voe=za("Array").values,Foe=gc,joe=hi,Boe=N,Woe=Voe,NN=Array.prototype,zoe={DOMTokenList:!0,NodeList:!0},Goe=function(e){var r=e.values;return e===NN||Boe(NN,e)&&r===NN.values||joe(zoe,Foe(e))?Woe:r},Ic=l(Goe),Hoe=d,$oe=hr("iterator"),DN=!Hoe(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[$oe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Koe=Qu,qoe=Ba,Yoe=tt,Xoe=et,II=function(e,r,i){var o=qoe(r);o in e?Yoe.f(e,o,Xoe(0,i)):e[o]=i},k4=fe,Joe=ii,Qoe=II,Zoe=Array,eae=Math.max,LN=function(e,r,i){for(var o=Joe(e),c=k4(r,o),u=k4(i===void 0?o:i,o),h=Zoe(eae(u-c,0)),m=0;c<u;c++,m++)Qoe(h,m,e[c]);return h.length=m,h},N4=LN,tae=Math.floor,xN=function(e,r){var i=e.length,o=tae(i/2);return i<8?nae(e,r):rae(e,xN(N4(e,0,o),r),xN(N4(e,o),r),r)},nae=function(e,r){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&r(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},rae=function(e,r,i,o){for(var c=r.length,u=i.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(r[h],i[m])<=0?r[h++]:i[m++]:h<c?r[h++]:i[m++];return e},D4=xN,MN=Mn,ev=j,AI=ve,oh=A,tv=rt,L4=DN,x4=Qu,iae=Ry,sae=function(e,r,i){for(var o in r)i&&i.unsafe&&e[o]?e[o]=r[o]:Koe(e,o,r[o],i);return e},oae=Zu,aae=_y,UN=Ju,M4=i_,VN=Me,cae=hi,lae=De,uae=gc,dae=cn,U4=_t,Ya=ua,hae=Fo,V4=et,FN=Yg,pae=Yu,nv=ll,fae=D4,mae=hr("iterator"),VT="URLSearchParams",F4=VT+"Iterator",j4=UN.set,Zl=UN.getterFor(VT),gae=UN.getterFor(F4),_ae=Object.getOwnPropertyDescriptor,jN=function(e){if(!tv)return ev[e];var r=_ae(ev,e);return r&&r.value},B4=jN("fetch"),PI=jN("Request"),FT=jN("Headers"),BN=PI&&PI.prototype,W4=FT&&FT.prototype,Eae=ev.RegExp,yae=ev.TypeError,z4=ev.decodeURIComponent,vae=ev.encodeURIComponent,Sae=oh("".charAt),G4=oh([].join),m_=oh([].push),WN=oh("".replace),Tae=oh([].shift),H4=oh([].splice),$4=oh("".split),bae=oh("".slice),wae=/\+/g,K4=Array(4),Rae=function(e){return K4[e-1]||(K4[e-1]=Eae("((?:%[\\da-f]{2}){"+e+"})","gi"))},Cae=function(e){try{return z4(e)}catch{return e}},q4=function(e){var r=WN(e,wae," "),i=4;try{return z4(r)}catch{for(;i;)r=WN(r,Rae(i--),Cae);return r}},Iae=/[!'()~]|%20/g,Aae={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Pae=function(e){return Aae[e]},Y4=function(e){return WN(vae(e),Iae,Pae)},zN=aae(function(e,r){j4(this,{type:F4,iterator:FN(Zl(e).entries),kind:r})},"Iterator",function(){var e=gae(this),r=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),i},!0),X4=function(e){this.entries=[],this.url=null,e!==void 0&&(U4(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Sae(e,0)==="?"?bae(e,1):e:Ya(e)))};X4.prototype={type:VT,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,i,o,c,u,h,m,_=pae(e);if(_)for(i=(r=FN(e,_)).next;!(o=AI(i,r)).done;){if(u=(c=FN(dae(o.value))).next,(h=AI(u,c)).done||(m=AI(u,c)).done||!AI(u,c).done)throw yae("Expected sequence with length 2");m_(this.entries,{key:Ya(h.value),value:Ya(m.value)})}else for(var y in e)cae(e,y)&&m_(this.entries,{key:y,value:Ya(e[y])})},parseQuery:function(e){if(e)for(var r,i,o=$4(e,"&"),c=0;c<o.length;)(r=o[c++]).length&&(i=$4(r,"="),m_(this.entries,{key:q4(Tae(i)),value:q4(G4(i,"="))}))},serialize:function(){for(var e,r=this.entries,i=[],o=0;o<r.length;)e=r[o++],m_(i,Y4(e.key)+"="+Y4(e.value));return G4(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var OI=function(){M4(this,rv);var e=j4(this,new X4(arguments.length>0?arguments[0]:void 0));tv||(this.size=e.entries.length)},rv=OI.prototype;if(sae(rv,{append:function(e,r){var i=Zl(this);nv(arguments.length,2),m_(i.entries,{key:Ya(e),value:Ya(r)}),tv||this.length++,i.updateURL()},delete:function(e){for(var r=Zl(this),i=nv(arguments.length,1),o=r.entries,c=Ya(e),u=i<2?void 0:arguments[1],h=u===void 0?u:Ya(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(H4(o,m,1),h!==void 0)break}tv||(this.size=o.length),r.updateURL()},get:function(e){var r=Zl(this).entries;nv(arguments.length,1);for(var i=Ya(e),o=0;o<r.length;o++)if(r[o].key===i)return r[o].value;return null},getAll:function(e){var r=Zl(this).entries;nv(arguments.length,1);for(var i=Ya(e),o=[],c=0;c<r.length;c++)r[c].key===i&&m_(o,r[c].value);return o},has:function(e){for(var r=Zl(this).entries,i=nv(arguments.length,1),o=Ya(e),c=i<2?void 0:arguments[1],u=c===void 0?c:Ya(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,r){var i=Zl(this);nv(arguments.length,1);for(var o,c=i.entries,u=!1,h=Ya(e),m=Ya(r),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?H4(c,_--,1):(u=!0,o.value=m));u||m_(c,{key:h,value:m}),tv||(this.size=c.length),i.updateURL()},sort:function(){var e=Zl(this);fae(e.entries,function(r,i){return r.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,i=Zl(this).entries,o=lae(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((r=i[c++]).value,r.key,this)},keys:function(){return new zN(this,"keys")},values:function(){return new zN(this,"values")},entries:function(){return new zN(this,"entries")}},{enumerable:!0}),x4(rv,mae,rv.entries,{}),x4(rv,"toString",function(){return Zl(this).serialize()},{enumerable:!0}),tv&&iae(rv,"size",{get:function(){return Zl(this).entries.length},configurable:!0,enumerable:!0}),oae(OI,VT),MN({global:!0,forced:!L4},{URLSearchParams:OI}),!L4&&VN(FT)){var Oae=oh(W4.has),kae=oh(W4.set),J4=function(e){if(U4(e)){var r,i=e.body;if(uae(i)===VT)return r=e.headers?new FT(e.headers):new FT,Oae(r,"content-type")||kae(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),hae(e,{body:V4(0,Ya(i)),headers:V4(0,r)})}return e};if(VN(B4)&&MN({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return B4(e,arguments.length>1?J4(arguments[1]):{})}}),VN(PI)){var GN=function(e){return M4(this,BN),new PI(e,arguments.length>1?J4(arguments[1]):{})};BN.constructor=GN,GN.prototype=BN,MN({global:!0,dontCallGetSet:!0,forced:!0},{Request:GN})}}var eu,Nae={URLSearchParams:OI,getState:Zl},Dae=vt.URLSearchParams,Q4=rt,Lae=A,xae=ve,Mae=d,HN=yc,Uae=Ec,Vae=Ne,Fae=Io,jae=hn,iv=Object.assign,Z4=Object.defineProperty,Bae=Lae([].concat),Wae=!iv||Mae(function(){if(Q4&&iv({b:1},iv(Z4({},"a",{enumerable:!0,get:function(){Z4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){r[c]=c}),iv({},e)[i]!=7||HN(iv({},r)).join("")!=o})?function(e,r){for(var i=Fae(e),o=arguments.length,c=1,u=Uae.f,h=Vae.f;o>c;)for(var m,_=jae(arguments[c++]),y=u?Bae(HN(_),u(_)):HN(_),S=y.length,R=0;S>R;)m=y[R++],Q4&&!xae(h,_,m)||(i[m]=_[m]);return i}:iv,zae=cn,Gae=Xg,Hae=De,$ae=ve,Kae=Io,qae=function(e,r,i,o){try{return o?r(zae(i)[0],i[1]):r(i)}catch(c){Gae(e,"throw",c)}},Yae=qg,Xae=a_,Jae=ii,e3=II,Qae=Yg,Zae=Yu,t3=Array,g_=A,$N=2147483647,ece=/[^\0-\u007E]/,n3=/[.\u3002\uFF0E\uFF61]/g,r3="Overflow: input needs wider integers to process",i3=RangeError,tce=g_(n3.exec),sv=Math.floor,KN=String.fromCharCode,s3=g_("".charCodeAt),o3=g_([].join),_m=g_([].push),nce=g_("".replace),rce=g_("".split),ice=g_("".toLowerCase),a3=function(e){return e+22+75*(e<26)},sce=function(e,r,i){var o=0;for(e=i?sv(e/700):e>>1,e+=sv(e/r);e>455;)e=sv(e/35),o+=36;return sv(o+36*e/(e+38))},oce=function(e){var r=[];e=function(q){for(var Y=[],ce=0,_e=q.length;ce<_e;){var ye=s3(q,ce++);if(ye>=55296&&ye<=56319&&ce<_e){var me=s3(q,ce++);(64512&me)==56320?_m(Y,((1023&ye)<<10)+(1023&me)+65536):(_m(Y,ye),ce--)}else _m(Y,ye)}return Y}(e);var i,o,c=e.length,u=128,h=0,m=72;for(i=0;i<e.length;i++)(o=e[i])<128&&_m(r,KN(o));var _=r.length,y=_;for(_&&_m(r,"-");y<c;){var S=$N;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<S&&(S=o);var R=y+1;if(S-u>sv(($N-h)/R))throw i3(r3);for(h+=(S-u)*R,u=S,i=0;i<e.length;i++){if((o=e[i])<u&&++h>$N)throw i3(r3);if(o==u){for(var P=h,k=36;;){var W=k<=m?1:k>=m+26?26:k-m;if(P<W)break;var U=P-W,V=36-W;_m(r,KN(a3(W+U%V))),P=sv(U/V),k+=36}_m(r,KN(a3(P))),m=sce(h,R,y==_),h=0,y++}}h++,u++}return o3(r,"")},ace=Mn,qN=rt,cce=DN,YN=j,c3=De,tu=A,kI=Qu,nu=Ry,lce=i_,XN=hi,JN=Wae,ov=function(e){var r=Kae(e),i=Xae(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Hae(c,o>2?arguments[2]:void 0));var h,m,_,y,S,R,P=Zae(r),k=0;if(!P||this===t3&&Yae(P))for(h=Jae(r),m=i?new this(h):t3(h);h>k;k++)R=u?c(r[k],k):r[k],e3(m,k,R);else for(S=(y=Qae(r,P)).next,m=i?new this:[];!(_=$ae(S,y)).done;k++)R=u?qae(y,c,[_.value,k],!0):_.value,e3(m,k,R);return m.length=k,m},id=LN,uce=PN.codeAt,dce=function(e){var r,i,o=[],c=rce(nce(ice(e),n3,"."),".");for(r=0;r<c.length;r++)i=c[r],_m(o,tce(ece,i)?"xn--"+oce(i):i);return o3(o,".")},xp=ua,hce=Zu,pce=ll,l3=Nae,u3=Ju,fce=u3.set,NI=u3.getterFor("URL"),mce=l3.URLSearchParams,gce=l3.getState,jT=YN.URL,QN=YN.TypeError,DI=YN.parseInt,_ce=Math.floor,d3=Math.pow,ru=tu("".charAt),sd=tu(/./.exec),BT=tu([].join),Ece=tu(1 .toString),yce=tu([].pop),av=tu([].push),ZN=tu("".replace),vce=tu([].shift),Sce=tu("".split),WT=tu("".slice),LI=tu("".toLowerCase),Tce=tu([].unshift),eD="Invalid scheme",__="Invalid host",h3="Invalid port",p3=/[a-z]/i,bce=/[\d+-.a-z]/i,tD=/\d/,wce=/^0x/i,Rce=/^[0-7]+$/,Cce=/^\d+$/,f3=/^[\da-f]+$/i,Ice=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Ace=/[\0\t\n\r #/:<>?@[\\\]^|]/,Pce=/^[\u0000-\u0020]+/,Oce=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,kce=/[\t\n\r]/g,zT=function(e){var r,i,o,c;if(typeof e=="number"){for(r=[],i=0;i<4;i++)Tce(r,e%256),e=_ce(e/256);return BT(r,".")}if(typeof e=="object"){for(r="",o=function(u){for(var h=null,m=1,_=null,y=0,S=0;S<8;S++)u[S]!==0?(y>m&&(h=_,m=y),_=null,y=0):(_===null&&(_=S),++y);return y>m&&(h=_,m=y),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(r+=i?":":"::",c=!0):(r+=Ece(e[i],16),i<7&&(r+=":")));return"["+r+"]"}return e},xI={},m3=JN({},xI,{" ":1,'"':1,"<":1,">":1,"`":1}),g3=JN({},m3,{"#":1,"?":1,"{":1,"}":1}),nD=JN({},g3,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Em=function(e,r){var i=uce(e,0);return i>32&&i<127&&!XN(r,e)?e:encodeURIComponent(e)},MI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},GT=function(e,r){var i;return e.length==2&&sd(p3,ru(e,0))&&((i=ru(e,1))==":"||!r&&i=="|")},_3=function(e){var r;return e.length>1&&GT(WT(e,0,2))&&(e.length==2||(r=ru(e,2))==="/"||r==="\\"||r==="?"||r==="#")},Nce=function(e){return e==="."||LI(e)==="%2e"},rD={},E3={},iD={},y3={},v3={},sD={},S3={},T3={},UI={},VI={},oD={},aD={},cD={},lD={},b3={},uD={},cv={},ah={},w3={},E_={},Mp={},dD=function(e,r,i){var o,c,u,h=xp(e);if(r){if(c=this.parse(h))throw QN(c);this.searchParams=null}else{if(i!==void 0&&(o=new dD(i,!0)),c=this.parse(h,null,o))throw QN(c);(u=gce(new mce)).bindURL(this),this.searchParams=u}};dD.prototype={type:"URL",parse:function(e,r,i){var o,c,u,h,m,_=this,y=r||rD,S=0,R="",P=!1,k=!1,W=!1;for(e=xp(e),r||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=ZN(e,Pce,""),e=ZN(e,Oce,"$1")),e=ZN(e,kce,""),o=ov(e);S<=o.length;){switch(c=o[S],y){case rD:if(!c||!sd(p3,c)){if(r)return eD;y=iD;continue}R+=LI(c),y=E3;break;case E3:if(c&&(sd(bce,c)||c=="+"||c=="-"||c=="."))R+=LI(c);else{if(c!=":"){if(r)return eD;R="",y=iD,S=0;continue}if(r&&(_.isSpecial()!=XN(MI,R)||R=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=R,r)return void(_.isSpecial()&&MI[_.scheme]==_.port&&(_.port=null));R="",_.scheme=="file"?y=lD:_.isSpecial()&&i&&i.scheme==_.scheme?y=y3:_.isSpecial()?y=T3:o[S+1]=="/"?(y=v3,S++):(_.cannotBeABaseURL=!0,av(_.path,""),y=w3)}break;case iD:if(!i||i.cannotBeABaseURL&&c!="#")return eD;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=id(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,y=Mp;break}y=i.scheme=="file"?lD:sD;continue;case y3:if(c!="/"||o[S+1]!="/"){y=sD;continue}y=UI,S++;break;case v3:if(c=="/"){y=VI;break}y=ah;continue;case sD:if(_.scheme=i.scheme,c==eu)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=id(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())y=S3;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=id(i.path),_.query="",y=E_;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=id(i.path),_.path.length--,y=ah;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=id(i.path),_.query=i.query,_.fragment="",y=Mp}break;case S3:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,y=ah;continue}y=VI}else y=UI;break;case T3:if(y=UI,c!="/"||ru(R,S+1)!="/")continue;S++;break;case UI:if(c!="/"&&c!="\\"){y=VI;continue}break;case VI:if(c=="@"){P&&(R="%40"+R),P=!0,u=ov(R);for(var U=0;U<u.length;U++){var V=u[U];if(V!=":"||W){var q=Em(V,nD);W?_.password+=q:_.username+=q}else W=!0}R=""}else if(c==eu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(P&&R=="")return"Invalid authority";S-=ov(R).length+1,R="",y=oD}else R+=c;break;case oD:case aD:if(r&&_.scheme=="file"){y=uD;continue}if(c!=":"||k){if(c==eu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&R=="")return __;if(r&&R==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(R))return h;if(R="",y=cv,r)return;continue}c=="["?k=!0:c=="]"&&(k=!1),R+=c}else{if(R=="")return __;if(h=_.parseHost(R))return h;if(R="",y=cD,r==aD)return}break;case cD:if(!sd(tD,c)){if(c==eu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||r){if(R!=""){var Y=DI(R,10);if(Y>65535)return h3;_.port=_.isSpecial()&&Y===MI[_.scheme]?null:Y,R=""}if(r)return;y=cv;continue}return h3}R+=c;break;case lD:if(_.scheme="file",c=="/"||c=="\\")y=b3;else{if(!i||i.scheme!="file"){y=ah;continue}if(c==eu)_.host=i.host,_.path=id(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=id(i.path),_.query="",y=E_;else{if(c!="#"){_3(BT(id(o,S),""))||(_.host=i.host,_.path=id(i.path),_.shortenPath()),y=ah;continue}_.host=i.host,_.path=id(i.path),_.query=i.query,_.fragment="",y=Mp}}break;case b3:if(c=="/"||c=="\\"){y=uD;break}i&&i.scheme=="file"&&!_3(BT(id(o,S),""))&&(GT(i.path[0],!0)?av(_.path,i.path[0]):_.host=i.host),y=ah;continue;case uD:if(c==eu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&GT(R))y=ah;else if(R==""){if(_.host="",r)return;y=cv}else{if(h=_.parseHost(R))return h;if(_.host=="localhost"&&(_.host=""),r)return;R="",y=cv}continue}R+=c;break;case cv:if(_.isSpecial()){if(y=ah,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=eu&&(y=ah,c!="/"))continue}else _.fragment="",y=Mp;else _.query="",y=E_;break;case ah:if(c==eu||c=="/"||c=="\\"&&_.isSpecial()||!r&&(c=="?"||c=="#")){if((m=LI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||av(_.path,"")):Nce(R)?c=="/"||c=="\\"&&_.isSpecial()||av(_.path,""):(_.scheme=="file"&&!_.path.length&&GT(R)&&(_.host&&(_.host=""),R=ru(R,0)+":"),av(_.path,R)),R="",_.scheme=="file"&&(c==eu||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)vce(_.path);c=="?"?(_.query="",y=E_):c=="#"&&(_.fragment="",y=Mp)}else R+=Em(c,g3);break;case w3:c=="?"?(_.query="",y=E_):c=="#"?(_.fragment="",y=Mp):c!=eu&&(_.path[0]+=Em(c,xI));break;case E_:r||c!="#"?c!=eu&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":Em(c,xI)):(_.fragment="",y=Mp);break;case Mp:c!=eu&&(_.fragment+=Em(c,m3))}S++}},parseHost:function(e){var r,i,o;if(ru(e,0)=="["){if(ru(e,e.length-1)!="]"||(r=function(c){var u,h,m,_,y,S,R,P=[0,0,0,0,0,0,0,0],k=0,W=null,U=0,V=function(){return ru(c,U)};if(V()==":"){if(ru(c,1)!=":")return;U+=2,W=++k}for(;V();){if(k==8)return;if(V()!=":"){for(u=h=0;h<4&&sd(f3,V());)u=16*u+DI(V(),16),U++,h++;if(V()=="."){if(h==0||(U-=h,k>6))return;for(m=0;V();){if(_=null,m>0){if(!(V()=="."&&m<4))return;U++}if(!sd(tD,V()))return;for(;sd(tD,V());){if(y=DI(V(),10),_===null)_=y;else{if(_==0)return;_=10*_+y}if(_>255)return;U++}P[k]=256*P[k]+_,++m!=2&&m!=4||k++}if(m!=4)return;break}if(V()==":"){if(U++,!V())return}else if(V())return;P[k++]=u}else{if(W!==null)return;U++,W=++k}}if(W!==null)for(S=k-W,k=7;k!=0&&S>0;)R=P[k],P[k--]=P[W+S-1],P[W+--S]=R;else if(k!=8)return;return P}(WT(e,1,-1)),!r))return __;this.host=r}else if(this.isSpecial()){if(e=dce(e),sd(Ice,e)||(r=function(c){var u,h,m,_,y,S,R,P=Sce(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=P[m])=="")return c;if(y=10,_.length>1&&ru(_,0)=="0"&&(y=sd(wce,_)?16:8,_=WT(_,y==8?1:2)),_==="")S=0;else{if(!sd(y==10?Cce:y==8?Rce:f3,_))return c;S=DI(_,y)}av(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=d3(256,5-u))return null}else if(S>255)return null;for(R=yce(h),m=0;m<h.length;m++)R+=h[m]*d3(256,3-m);return R}(e),r===null))return __;this.host=r}else{if(sd(Ace,e))return __;for(r="",i=ov(e),o=0;o<i.length;o++)r+=Em(i[o],xI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return XN(MI,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&GT(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,y=r+":";return c!==null?(y+="//",e.includesCredentials()&&(y+=i+(o?":"+o:"")+"@"),y+=zT(c),u!==null&&(y+=":"+u)):r=="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+BT(h,"/"):"",m!==null&&(y+="?"+m),_!==null&&(y+="#"+_),y},setHref:function(e){var r=this.parse(e);if(r)throw QN(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new lv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+zT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(xp(e)+":",rD)},getUsername:function(){return this.username},setUsername:function(e){var r=ov(xp(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=Em(r[i],nD)}},getPassword:function(){return this.password},setPassword:function(e){var r=ov(xp(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=Em(r[i],nD)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?zT(e):zT(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,oD)},getHostname:function(){var e=this.host;return e===null?"":zT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,aD)},getPort:function(){var e=this.port;return e===null?"":xp(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=xp(e))==""?this.port=null:this.parse(e,cD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+BT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,cv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=xp(e))==""?this.query=null:(ru(e,0)=="?"&&(e=WT(e,1)),this.query="",this.parse(e,E_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=xp(e))!=""?(ru(e,0)=="#"&&(e=WT(e,1)),this.fragment="",this.parse(e,Mp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var lv=function(e){var r=lce(this,Xa),i=pce(arguments.length,1)>1?arguments[1]:void 0,o=fce(r,new dD(e,!1,i));qN||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},Xa=lv.prototype,iu=function(e,r){return{get:function(){return NI(this)[e]()},set:r&&function(i){return NI(this)[r](i)},configurable:!0,enumerable:!0}};if(qN&&(nu(Xa,"href",iu("serialize","setHref")),nu(Xa,"origin",iu("getOrigin")),nu(Xa,"protocol",iu("getProtocol","setProtocol")),nu(Xa,"username",iu("getUsername","setUsername")),nu(Xa,"password",iu("getPassword","setPassword")),nu(Xa,"host",iu("getHost","setHost")),nu(Xa,"hostname",iu("getHostname","setHostname")),nu(Xa,"port",iu("getPort","setPort")),nu(Xa,"pathname",iu("getPathname","setPathname")),nu(Xa,"search",iu("getSearch","setSearch")),nu(Xa,"searchParams",iu("getSearchParams")),nu(Xa,"hash",iu("getHash","setHash"))),kI(Xa,"toJSON",function(){return NI(this).serialize()},{enumerable:!0}),kI(Xa,"toString",function(){return NI(this).serialize()},{enumerable:!0}),jT){var R3=jT.createObjectURL,C3=jT.revokeObjectURL;R3&&kI(lv,"createObjectURL",c3(R3,jT)),C3&&kI(lv,"revokeObjectURL",c3(C3,jT))}hce(lv,"URL"),ace({global:!0,forced:!cce,sham:!qN},{URL:lv});var Dce=Mn,Lce=d,xce=ll,I3=ua,Mce=DN,A3=an("URL");Dce({target:"URL",stat:!0,forced:!(Mce&&Lce(function(){A3.canParse()}))},{canParse:function(e){var r=xce(arguments.length,1),i=I3(e),o=r<2||arguments[1]===void 0?void 0:I3(arguments[1]);try{return!!new A3(i,o)}catch{return!1}}});var FI=l(vt.URL);let P3=!0,O3=!0;function jI(e,r,i){const o=e.match(r);return o&&o.length>=i&&parseInt(o[i],10)}function y_(e,r,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const _=y=>{const S=i(y);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const _=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Uce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(P3=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Vce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(O3=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function k3(){if(typeof window=="object"){if(P3)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function hD(e,r){O3&&console.warn(e+" is deprecated, please use "+r+" instead.")}function N3(e){return Object.prototype.toString.call(e)==="[object Object]"}function D3(e){var r;return N3(e)?Ga(r=Object.keys(e)).call(r,function(i,o){const c=N3(e[o]),u=c?D3(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function pD(e,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?pD(e,e.get(r[o]),i):o.endsWith("Ids")&&r[o].forEach(c=>{pD(e,e.get(c),i)})}))}function L3(e,r,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&pD(e,m,c)})}),c}const x3=k3;function M3(e,r){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const y=typeof h[_]=="object"?h[_]:{ideal:h[_]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(y.ideal!==void 0){m.optional=m.optional||[];let R={};typeof y.ideal=="number"?(R[S("min",_)]=y.ideal,m.optional.push(R),R={},R[S("max",_)]=y.ideal,m.optional.push(R)):(R[S("",_)]=y.ideal,m.optional.push(R))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=y.exact):["min","max"].forEach(R=>{y[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,_)]=y[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(y,S,R){S in y&&!(R in y)&&(y[R]=y[S],delete y[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const y=r.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||y)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(k=>k.kind==="videoinput")).find(k=>S.some(W=>{var U;return ot(U=k.label.toLowerCase()).call(U,W)}));return!P&&R.length&&ot(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=_.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),x3("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return x3("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,_){c(h,y=>{i.webkitGetUserMedia(y,m,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(y=>{if(_.audio&&!y.getAudioTracks().length||_.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return y},y=>lt.reject(u(y))))}}}function U3(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function V3(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else y_(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function F3(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=r(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function j3(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const u=function(m){const _={};return m.result().forEach(y=>{const S={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(R=>{S[R]=y.stat(R)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return r.apply(this,[m,i])}return new lt((m,_)=>{r.apply(this,[function(y){m(h(u(y)))},_])}).then(o,c)}}function B3(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>L3(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),y_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>L3(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?lt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():lt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function W3(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function z3(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return W3(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(R=>R.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new e.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(k.id,"g"),P.id)}),new RTCSessionDescription({type:y.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[y.id];if(P)P.addTrack(_),lt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new e.MediaStream([_]);this._streams[y.id]=k,this._reverseStreams[k.id]=y,this.addStream(k)}return this.getSenders().find(k=>k.track===_)},["createOffer","createAnswer"].forEach(function(_){const y=e.RTCPeerConnection.prototype[_],S={[_](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[P=>{const k=u(this,P);R[0].apply(null,[k])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):y.apply(this,arguments).then(P=>u(this,P))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(P.id,"g"),k.id)}),new RTCSessionDescription({type:y.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>_.track===R)&&(y=this._streams[S])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function fD(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function G3(e,r){y_(e,"negotiationneeded",i=>{const o=i.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var H3=Object.freeze({__proto__:null,fixNegotiationNeeded:G3,shimAddTrackRemoveTrack:z3,shimAddTrackRemoveTrackWithNative:W3,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:F3,shimGetStats:j3,shimGetUserMedia:M3,shimMediaStream:U3,shimOnTrack:V3,shimPeerConnection:fD,shimSenderReceiverGetStats:B3});function $3(e,r){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){hD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function K3(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mD(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((y,S)=>{m.set(S,Object.assign({},y,{type:i[y.type]||y.type}))})}return m}).then(u,h)}}function q3(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):lt.resolve(new Map)}}function Y3(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i}),y_(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function X3(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){hD("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&ot(o=r.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function J3(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Q3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function Z3(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function e5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function t5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var n5=Object.freeze({__proto__:null,shimAddTransceiver:Q3,shimCreateAnswer:t5,shimCreateOffer:e5,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,lt.reject(o)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:Z3,shimGetUserMedia:$3,shimOnTrack:K3,shimPeerConnection:mD,shimRTCDataChannel:J3,shimReceiverGetStats:Y3,shimRemoveStream:X3,shimSenderGetStats:q3});function r5(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),ot(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?ot(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const o=r.getTracks();this.getSenders().forEach(c=>{ot(o).call(o,c.track)&&this.removeTrack(c)})})}}function i5(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),ot(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),r.apply(i,arguments)}}}function s5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=i.apply(this,[S]);return y?(R.then(_,y),lt.resolve()):R},r.createAnswer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return y?(R.then(_,y),lt.resolve()):R};let m=function(_,y,S){const R=c.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R};r.setLocalDescription=m,m=function(_,y,S){const R=u.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R},r.setRemoteDescription=m,m=function(_,y,S){const R=h.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R},r.addIceCandidate=m}function o5(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,o=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>o(a5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,o,c){r.mediaDevices.getUserMedia(i).then(o,c)}).bind(r))}function a5(e){return e&&e.video!==void 0?Object.assign({},e,{video:D3(e.video)}):e}function c5(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(hD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new r(i,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function l5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function u5(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function d5(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var h5=Object.freeze({__proto__:null,shimAudioContext:d5,shimCallbacksAPI:s5,shimConstraints:a5,shimCreateOfferLegacy:u5,shimGetUserMedia:o5,shimLocalStreamsAPI:r5,shimRTCIceServerUrls:c5,shimRemoteStreamsAPI:i5,shimTrackEventTransceiver:l5}),p5=`	
\v\f\r \u2028\u2029\uFEFF`,Fce=Yt,jce=ua,gD=p5,f5=A("".replace),Bce=RegExp("^["+gD+"]+"),Wce=RegExp("(^|[^"+gD+"])["+gD+"]+$"),zce=function(e){return function(r){var i=jce(Fce(r));return 1&e&&(i=f5(i,Bce,"")),2&e&&(i=f5(i,Wce,"$1")),i}},Gce={trim:zce(3)},Hce=KC.PROPER,$ce=d,m5=p5,Kce=Gce.trim;Mn({target:"String",proto:!0,forced:function(e){return $ce(function(){return!!m5[e]()||""[e]()!==""||Hce&&m5[e].name!==e})}("trim")},{trim:function(){return Kce(this)}});var qce=za("String").trim,Yce=N,Xce=qce,_D=String.prototype,Jce=function(e){var r=e.trim;return typeof e=="string"||e===_D||Yce(_D,e)&&r===_D.trim?Xce:r},Js=l(Jce),g5={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(i){const o=r.splitSections(i);return o&&o[0]},r.getMediaSections=function(i){const o=r.splitSections(i);return o.shift(),o},r.matchPrefix=function(i,o){return r.splitLines(i).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},r.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(i){const o=r.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:r.matchPrefix(i+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,o){return r.matchPrefix(i+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,o){const c=r.matchPrefix(i+o,"a=ice-ufrag:")[0],u=r.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=r.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(_){const y=r.parseRtpMap(_),S=r.matchPrefix(i,"a=fmtp:"+m+" ");switch(y.parameters=S.length?r.parseFmtp(S[0]):{},y.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(y.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(i){const o=[],c=r.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(i,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),_=m.length>0&&m[0].ssrc;let y;const S=r.matchPrefix(i,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(k=>parseInt(k,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(y=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let k={ssrc:_,codecPayloadType:parseInt(P.parameters.apt,10)};_&&y&&(k.rtx={ssrc:y}),o.push(k),u&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(k))}}),o.length===0&&_&&o.push({ssrc:_});let R=r.matchPrefix(i,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(i){const o={},c=r.matchPrefix(i,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},r.parseMsid=function(i){let o;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(i){const o=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(i,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},r.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,o){const c=r.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const o=r.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(i){const o=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=r.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=r})(g5);var _5=g5.exports,uv=l(_5),Qce=s({__proto__:null,default:uv},[_5]);function BI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new r(i),c=uv.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(i)},e.RTCIceCandidate.prototype=r.prototype,y_(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function ED(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||y_(e,"icecandidate",r=>{if(r.candidate){const i=uv.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function WI(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const _=uv.splitSections(m.sdp);return _.shift(),_.some(y=>{const S=uv.parseMLine(y);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const y=parseInt(_[1],10);return y!=y?-1:y},c=function(m){let _=65536;return r.browser==="firefox"&&(_=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),_},u=function(m,_){let y=65536;r.browser==="firefox"&&r.version===57&&(y=65535);const S=uv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?y=parseInt(S[0].substr(19),10):r.browser==="firefox"&&_!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=o(arguments[0]),_=c(m),y=u(arguments[0],m);let S;S=_===0&&y===0?Number.POSITIVE_INFINITY:_===0||y===0?Math.max(_,y):Math.min(_,y);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function zI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return r(o,this),o},y_(e,"datachannel",o=>(r(o.channel,o.target),o))}function yD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function vD(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>Js(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function GI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?lt.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),lt.resolve())})}function HI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Zce=Object.freeze({__proto__:null,removeExtmapAllowMixed:vD,shimAddIceCandidateNullOrEmpty:GI,shimConnectionState:yD,shimMaxMessageSize:WI,shimParameterlessSetLocalDescription:HI,shimRTCIceCandidate:BI,shimRTCIceCandidateRelayProtocol:ED,shimSendThrowTypeError:zI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=k3,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=jI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=jI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=jI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:Zce,extractVersion:jI,disableLog:Uce,disableWarnings:Vce,sdp:Qce};switch(o.browser){case"chrome":if(!H3||!fD||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=H3,GI(e,o),HI(e),M3(e,o),U3(e),fD(e,o),V3(e),z3(e,o),F3(e),j3(e),B3(e),G3(e,o),BI(e),ED(e),yD(e),WI(e,o),zI(e),vD(e,o);break;case"firefox":if(!n5||!mD||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=n5,GI(e,o),HI(e),$3(e,o),mD(e,o),K3(e),X3(e),q3(e),Y3(e),J3(e),Q3(e),Z3(e),e5(e),t5(e),BI(e),yD(e),WI(e,o),zI(e);break;case"safari":if(!h5||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=h5,GI(e,o),HI(e),c5(e),u5(e),s5(e),r5(e),i5(e),l5(e),o5(e),d5(e),BI(e),ED(e),WI(e,o),zI(e),vD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var E5=lc,ele=TypeError,y5=ir.match(/firefox\/(\d+)/i),tle=!!y5&&+y5[1],nle=/MSIE|Trident/.test(ir),v5=ir.match(/AppleWebKit\/(\d+)\./),rle=!!v5&&+v5[1],ile=Mn,S5=A,sle=ls,ole=Io,T5=ii,ale=function(e,r){if(!delete e[r])throw ele("Cannot delete property "+E5(r)+" of "+E5(e))},b5=ua,SD=d,cle=D4,lle=pp,w5=tle,ule=nle,R5=dr,C5=rle,ym=[],I5=S5(ym.sort),dle=S5(ym.push),hle=SD(function(){ym.sort(void 0)}),ple=SD(function(){ym.sort(null)}),fle=lle("sort"),A5=!SD(function(){if(R5)return R5<70;if(!(w5&&w5>3)){if(ule)return!0;if(C5)return C5<603;var e,r,i,o,c="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)ym.push({k:r+o,v:i})}for(ym.sort(function(u,h){return h.v-u.v}),o=0;o<ym.length;o++)r=ym[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});ile({target:"Array",proto:!0,forced:hle||!ple||!fle||!A5},{sort:function(e){e!==void 0&&sle(e);var r=ole(this);if(A5)return e===void 0?I5(r):I5(r,e);var i,o,c=[],u=T5(r);for(o=0;o<u;o++)o in r&&dle(c,r[o]);for(cle(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:b5(m)>b5(_)?1:-1}}(e)),i=T5(c),o=0;o<i;)r[o]=c[o++];for(;o<u;)ale(r,o++);return r}});var mle=za("Array").sort,gle=N,_le=mle,TD=Array.prototype,Ele=function(e){var r=e.sort;return e===TD||gle(TD,e)&&r===TD.sort?_le:r},HT=l(Ele),bD=j;Mn({global:!0,forced:bD.globalThis!==bD},{globalThis:bD});var P5=l(j),wD={exports:{}};(function(e,r){(function(i,o){var c="function",u="undefined",h="object",m="string",_="major",y="model",S="name",R="type",P="vendor",k="version",W="architecture",U="console",V="mobile",q="tablet",Y="smarttv",ce="wearable",_e="embedded",ye="Amazon",me="Apple",ke="ASUS",Ye="BlackBerry",ut="Browser",pt="Chrome",yn="Firefox",vn="Google",cr="Huawei",Zr="LG",Wr="Microsoft",Xo="Motorola",je="Opera",st="Samsung",St="Sharp",We="Sony",x="Xiaomi",ie="Zebra",ue="Facebook",Qe="Chromium OS",Ht="Mac OS",tr=function(Ei){for(var Fi={},vr=0;vr<Ei.length;vr++)Fi[Ei[vr].toUpperCase()]=Ei[vr];return Fi},Vi=function(Ei,Fi){return typeof Ei===m&&ba(Fi).indexOf(ba(Ei))!==-1},ba=function(Ei){return Ei.toLowerCase()},Zp=function(Ei,Fi){if(typeof Ei===m)return Ei=Ei.replace(/^\s\s*/,""),typeof Fi===u?Ei:Ei.substring(0,350)},X_=function(Ei,Fi){for(var vr,Za,Ch,ei,Fn,wa,Bm=0;Bm<Fi.length&&!Fn;){var yd=Fi[Bm],n$=Fi[Bm+1];for(vr=Za=0;vr<yd.length&&!Fn&&yd[vr];)if(Fn=yd[vr++].exec(Ei))for(Ch=0;Ch<n$.length;Ch++)wa=Fn[++Za],typeof(ei=n$[Ch])===h&&ei.length>0?ei.length===2?typeof ei[1]==c?this[ei[0]]=ei[1].call(this,wa):this[ei[0]]=ei[1]:ei.length===3?typeof ei[1]!==c||ei[1].exec&&ei[1].test?this[ei[0]]=wa?wa.replace(ei[1],ei[2]):o:this[ei[0]]=wa?ei[1].call(this,wa,ei[2]):o:ei.length===4&&(this[ei[0]]=wa?ei[3].call(this,wa.replace(ei[1],ei[2])):o):this[ei]=wa||o;Bm+=2}},qb=function(Ei,Fi){for(var vr in Fi)if(typeof Fi[vr]===h&&Fi[vr].length>0){for(var Za=0;Za<Fi[vr].length;Za++)if(Vi(Fi[vr][Za],Ei))return vr==="?"?o:vr}else if(Vi(Fi[vr],Ei))return vr==="?"?o:vr;return Ei},WP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},zP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,k],[/opios[\/ ]+([\w\.]+)/i],[k,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[S,"UC"+ut]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+ut],k],[/\bfocus\/([\w\.]+)/i],[k,[S,yn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[S,"MIUI "+ut]],[/fxios\/([-\w\.]+)/i],[k,[S,yn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+ut]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+ut],k],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,ue],k],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[S,pt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,pt+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[S,"Android "+ut]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[k,qb,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[S,yn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,k],[/(cobalt)\/([\w\.]+)/i],[S,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[W,"amd64"]],[/(ia32(?=;))/i],[[W,ba]],[/((?:i[346]|x)86)[;\)]/i],[[W,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[W,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[W,"armhf"]],[/windows (ce|mobile); ppc;/i],[[W,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[W,/ower/,"",ba]],[/(sun4\w)[;\)]/i],[[W,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[W,ba]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[P,st],[R,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[P,st],[R,V]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[P,me],[R,V]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[P,me],[R,q]],[/(macintosh);/i],[y,[P,me]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[P,St],[R,V]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[P,cr],[R,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[P,cr],[R,V]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[P,x],[R,V]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[P,x],[R,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[P,"OPPO"],[R,V]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[P,"Vivo"],[R,V]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[P,"Realme"],[R,V]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[P,Xo],[R,V]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[P,Xo],[R,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[P,Zr],[R,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[P,Zr],[R,V]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[P,"Lenovo"],[R,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[P,"Nokia"],[R,V]],[/(pixel c)\b/i],[y,[P,vn],[R,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[P,vn],[R,V]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[P,We],[R,V]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[P,We],[R,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[P,"OnePlus"],[R,V]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[P,ye],[R,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[P,ye],[R,V]],[/(playbook);[-\w\),; ]+(rim)/i],[y,P,[R,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[P,Ye],[R,V]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[P,ke],[R,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[P,ke],[R,V]],[/(nexus 9)/i],[y,[P,"HTC"],[R,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[y,/_/g," "],[R,V]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[P,"Acer"],[R,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[P,"Meizu"],[R,V]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,y,[R,V]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,y,[R,q]],[/(surface duo)/i],[y,[P,Wr],[R,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[P,"Fairphone"],[R,V]],[/(u304aa)/i],[y,[P,"AT&T"],[R,V]],[/\bsie-(\w*)/i],[y,[P,"Siemens"],[R,V]],[/\b(rct\w+) b/i],[y,[P,"RCA"],[R,q]],[/\b(venue[\d ]{2,7}) b/i],[y,[P,"Dell"],[R,q]],[/\b(q(?:mv|ta)\w+) b/i],[y,[P,"Verizon"],[R,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[P,"Barnes & Noble"],[R,q]],[/\b(tm\d{3}\w+) b/i],[y,[P,"NuVision"],[R,q]],[/\b(k88) b/i],[y,[P,"ZTE"],[R,q]],[/\b(nx\d{3}j) b/i],[y,[P,"ZTE"],[R,V]],[/\b(gen\d{3}) b.+49h/i],[y,[P,"Swiss"],[R,V]],[/\b(zur\d{3}) b/i],[y,[P,"Swiss"],[R,q]],[/\b((zeki)?tb.*\b) b/i],[y,[P,"Zeki"],[R,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],y,[R,q]],[/\b(ns-?\w{0,9}) b/i],[y,[P,"Insignia"],[R,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[P,"NextBook"],[R,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],y,[R,V]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],y,[R,V]],[/\b(ph-1) /i],[y,[P,"Essential"],[R,V]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[P,"Envizen"],[R,q]],[/\b(trio[-\w\. ]+) b/i],[y,[P,"MachSpeed"],[R,q]],[/\btu_(1491) b/i],[y,[P,"Rotor"],[R,q]],[/(shield[\w ]+) b/i],[y,[P,"Nvidia"],[R,q]],[/(sprint) (\w+)/i],[P,y,[R,V]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[P,Wr],[R,V]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[P,ie],[R,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[P,ie],[R,V]],[/smart-tv.+(samsung)/i],[P,[R,Y]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[P,st],[R,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,Zr],[R,Y]],[/(apple) ?tv/i],[P,[y,me+" TV"],[R,Y]],[/crkey/i],[[y,pt+"cast"],[P,vn],[R,Y]],[/droid.+aft(\w)( bui|\))/i],[y,[P,ye],[R,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[P,St],[R,Y]],[/(bravia[\w ]+)( bui|\))/i],[y,[P,We],[R,Y]],[/(mitv-\w{5}) bui/i],[y,[P,x],[R,Y]],[/Hbbtv.*(technisat) (.*);/i],[P,y,[R,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,Zp],[y,Zp],[R,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,y,[R,U]],[/droid.+; (shield) bui/i],[y,[P,"Nvidia"],[R,U]],[/(playstation [345portablevi]+)/i],[y,[P,We],[R,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[P,Wr],[R,U]],[/((pebble))app/i],[P,y,[R,ce]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[P,me],[R,ce]],[/droid.+; (glass) \d/i],[y,[P,vn],[R,ce]],[/droid.+; (wt63?0{2,3})\)/i],[y,[P,ie],[R,ce]],[/(quest( 2| pro)?)/i],[y,[P,ue],[R,ce]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,_e]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[R,V]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[R,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,V]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[k,qb,WP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[k,qb,WP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Ht],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,k],[/\(bb(10);/i],[k,[S,Ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[S,yn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[S,pt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Qe],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,k],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,k]]},Sl=function(Ei,Fi){if(typeof Ei===h&&(Fi=Ei,Ei=o),!(this instanceof Sl))return new Sl(Ei,Fi).getResult();var vr=typeof i!==u&&i.navigator?i.navigator:o,Za=Ei||(vr&&vr.userAgent?vr.userAgent:""),Ch=vr&&vr.userAgentData?vr.userAgentData:o,ei=Fi?function(Fn,wa){var Bm={};for(var yd in Fn)wa[yd]&&wa[yd].length%2==0?Bm[yd]=wa[yd].concat(Fn[yd]):Bm[yd]=Fn[yd];return Bm}(zP,Fi):zP;return this.getBrowser=function(){var Fn={};return Fn[S]=o,Fn[k]=o,X_.call(Fn,Za,ei.browser),Fn[_]=function(wa){return typeof wa===m?wa.replace(/[^\d\.]/g,"").split(".")[0]:o}(Fn[k]),vr&&vr.brave&&typeof vr.brave.isBrave==c&&(Fn[S]="Brave"),Fn},this.getCPU=function(){var Fn={};return Fn[W]=o,X_.call(Fn,Za,ei.cpu),Fn},this.getDevice=function(){var Fn={};return Fn[P]=o,Fn[y]=o,Fn[R]=o,X_.call(Fn,Za,ei.device),!Fn[R]&&Ch&&Ch.mobile&&(Fn[R]=V),Fn[y]=="Macintosh"&&vr&&typeof vr.standalone!==u&&vr.maxTouchPoints&&vr.maxTouchPoints>2&&(Fn[y]="iPad",Fn[R]=q),Fn},this.getEngine=function(){var Fn={};return Fn[S]=o,Fn[k]=o,X_.call(Fn,Za,ei.engine),Fn},this.getOS=function(){var Fn={};return Fn[S]=o,Fn[k]=o,X_.call(Fn,Za,ei.os),!Fn[S]&&Ch&&Ch.platform!="Unknown"&&(Fn[S]=Ch.platform.replace(/chrome os/i,Qe).replace(/macos/i,Ht)),Fn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Za},this.setUA=function(Fn){return Za=typeof Fn===m&&Fn.length>350?Zp(Fn,350):Fn,this},this.setUA(Za),this};Sl.VERSION="0.7.34",Sl.BROWSER=tr([S,k,_]),Sl.CPU=tr([W]),Sl.DEVICE=tr([y,P,R,U,V,Y,q,ce,_e]),Sl.ENGINE=Sl.OS=tr([S,k]),e.exports&&(r=e.exports=Sl),r.UAParser=Sl;var jm=typeof i!==u&&(i.jQuery||i.Zepto);if(jm&&!jm.ua){var J_=new Sl;jm.ua=J_.getResult(),jm.ua.get=function(){return J_.getUA()},jm.ua.set=function(Ei){J_.setUA(Ei);var Fi=J_.getResult();for(var vr in Fi)jm.ua[vr]=Fi[vr]}}})(typeof window=="object"?window:a)})(wD,wD.exports);var yle=l(wD.exports),vle=gc,Sle=hi,Tle=Ut,ble=qd,wle=hr("iterator"),Rle=Object,Cle=function(e){if(Tle(e))return!1;var r=Rle(e);return r[wle]!==void 0||"@@iterator"in r||Sle(ble,vle(r))},Ile=l(Cle),O5=jy.clear;Mn({global:!0,bind:!0,forced:j.clearImmediate!==O5},{clearImmediate:O5});var Ale=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",k5=j,Ple=ne,Ole=Me,kle=Ale,Nle=ir,Dle=fs,Lle=ll,xle=k5.Function,Mle=/MSIE .\./.test(Nle)||kle&&function(){var e=k5.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),Ule=Mn,N5=j,D5=jy.set,Vle=function(e,r){var i=1;return Mle?function(o,c){var u=Lle(arguments.length,1)>i,h=Ole(o)?o:xle(o),m=u?Dle(arguments,i):[],_=u?function(){Ple(h,this,m)}:h;return e(_)}:e},L5=N5.setImmediate?Vle(D5):D5;Ule({global:!0,bind:!0,forced:N5.setImmediate!==L5},{setImmediate:L5});var x5=l(vt.setImmediate),Fle=Mn,jle=qa,Ble=ls,Wle=ll,zle=fp,Gle=j.process;Fle({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){Wle(arguments.length,1),Ble(e);var r=zle&&Gle.domain;jle(r?r.bind(e):e)}});var M5=l(vt.queueMicrotask);function U5(e,r){return function(){return e.apply(r,arguments)}}const{toString:Hle}=Object.prototype,{getPrototypeOf:RD}=Object,$I=(CD=Object.create(null),e=>{const r=Hle.call(e);return CD[r]||(CD[r]=r.slice(8,-1).toLowerCase())});var CD;const od=e=>(e=e.toLowerCase(),r=>$I(r)===e),KI=e=>r=>typeof r===e,{isArray:dv}=Array,$T=KI("undefined"),V5=od("ArrayBuffer"),$le=KI("string"),dl=KI("function"),F5=KI("number"),qI=e=>e!==null&&typeof e=="object",YI=e=>{if($I(e)!=="object")return!1;const r=RD(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||Ile(e))},Kle=od("Date"),qle=od("File"),Yle=od("Blob"),Xle=od("FileList"),Jle=od("URLSearchParams"),[Qle,Zle,eue,tue]=["ReadableStream","Request","Response","Headers"].map(od);function KT(e,r){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),dv(e))for(i=0,o=e.length;i<o;i++)r.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(i=0;i<h;i++)m=u[i],r.call(null,e[m],m,e)}}function j5(e,r){r=r.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],r===o.toLowerCase())return o;return null}const v_=P5!==void 0?P5:typeof self<"u"?self:typeof window<"u"?window:sE,B5=e=>!$T(e)&&e!==v_,nue=(ID=typeof Uint8Array<"u"&&RD(Uint8Array),e=>ID&&e instanceof ID);var ID;const rue=od("HTMLFormElement"),W5=(e=>{let{hasOwnProperty:r}=e;return(i,o)=>r.call(i,o)})(Object.prototype),iue=od("RegExp"),z5=(e,r)=>{const i=Object.getOwnPropertyDescriptors(e),o={};KT(i,(c,u)=>{let h;(h=r(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},AD="abcdefghijklmnopqrstuvwxyz",G5="0123456789",H5={DIGIT:G5,ALPHA:AD,ALPHA_DIGIT:AD+AD.toUpperCase()+G5},sue=od("AsyncFunction"),$5=(K5=typeof x5=="function",q5=dl(v_.postMessage),K5?x5:q5?(PD="axios@".concat(Math.random()),XI=[],v_.addEventListener("message",e=>{let{source:r,data:i}=e;r===v_&&i===PD&&XI.length&&XI.shift()()},!1),e=>{XI.push(e),v_.postMessage(PD,"*")}):e=>setTimeout(e));var K5,q5,PD,XI;const oue=M5!==void 0?M5.bind(v_):typeof process<"u"&&process.nextTick||$5;var ct={isArray:dv,isArrayBuffer:V5,isBuffer:function(e){return e!==null&&!$T(e)&&e.constructor!==null&&!$T(e.constructor)&&dl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||dl(e.append)&&((r=$I(e))==="formdata"||r==="object"&&dl(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&V5(e.buffer),r},isString:$le,isNumber:F5,isBoolean:e=>e===!0||e===!1,isObject:qI,isPlainObject:YI,isReadableStream:Qle,isRequest:Zle,isResponse:eue,isHeaders:tue,isUndefined:$T,isDate:Kle,isFile:qle,isBlob:Yle,isRegExp:iue,isFunction:dl,isStream:e=>qI(e)&&dl(e.pipe),isURLSearchParams:Jle,isTypedArray:nue,isFileList:Xle,forEach:KT,merge:function e(){const{caseless:r}=B5(this)&&this||{},i={},o=(c,u)=>{const h=r&&j5(i,u)||u;YI(i[h])&&YI(c)?i[h]=e(i[h],c):YI(c)?i[h]=e({},c):dv(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&KT(arguments[c],o);return i},extend:function(e,r,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return KT(r,(c,u)=>{i&&dl(c)?e[u]=U5(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>Js(e)?Js(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,i,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,r,i,o)=>{let c,u,h;const m={};if(r=r||{},e==null)return r;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,r)||m[h]||(r[h]=e[h],m[h]=!0);e=i!==!1&&RD(e)}while(e&&(!i||i(e,r))&&e!==Object.prototype);return r},kindOf:$I,kindOfTest:od,endsWith:(e,r,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=r.length;const o=e.indexOf(r,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(dv(e))return e;let r=e.length;if(!F5(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=e[r];return i},forEachEntry:(e,r)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;r.call(e,c[0],c[1])}},matchAll:(e,r)=>{let i;const o=[];for(;(i=e.exec(r))!==null;)o.push(i);return o},isHTMLForm:rue,hasOwnProperty:W5,hasOwnProp:W5,reduceDescriptors:z5,freezeMethods:e=>{z5(e,(r,i)=>{if(dl(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];dl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,r)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return dv(e)?o(e):o(String(e).split(r)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:j5,global:v_,isContextDefined:B5,ALPHABET:H5,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:H5.ALPHA_DIGIT,i="";const{length:o}=r;for(;e--;)i+=r[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&dl(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const r=new Array(10),i=(o,c)=>{if(qI(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=dv(o)?[]:{};return KT(o,(h,m)=>{const _=i(h,c+1);!$T(_)&&(u[m]=_)}),r[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:sue,isThenable:e=>e&&(qI(e)||dl(e))&&dl(e.then)&&dl(e.catch),setImmediate:$5,asap:oue};function Zn(e,r,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}ct.inherits(Zn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ct.toJSONObject(this.config),code:this.code,status:this.status}}});const Y5=Zn.prototype,X5={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{X5[e]={value:e}}),Object.defineProperties(Zn,X5),Object.defineProperty(Y5,"isAxiosError",{value:!0}),Zn.from=(e,r,i,o,c,u)=>{const h=Object.create(Y5);return ct.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),Zn.call(h,e.message,r,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function OD(e){return ct.isPlainObject(e)||ct.isArray(e)}function J5(e){return ct.endsWith(e,"[]")?e.slice(0,-2):e}function Q5(e,r,i){return e?e.concat(r).map(function(o,c){return o=J5(o),!i&&c?"["+o+"]":o}).join(i?".":""):r}const aue=ct.toFlatObject(ct,{},null,function(e){return/^is[A-Z]/.test(e)});function JI(e,r,i){if(!ct.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const o=(i=ct.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,k){return!ct.isUndefined(k[P])})).metaTokens,c=i.visitor||y,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&ct.isSpecCompliantForm(r);if(!ct.isFunction(c))throw new TypeError("visitor must be a function");function _(P){if(P===null)return"";if(ct.isDate(P))return P.toISOString();if(!m&&ct.isBlob(P))throw new Zn("Blob is not supported. Use a Buffer instead.");return ct.isArrayBuffer(P)||ct.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function y(P,k,W){let U=P;if(P&&!W&&typeof P=="object"){if(ct.endsWith(k,"{}"))k=o?k:k.slice(0,-2),P=JSON.stringify(P);else if(ct.isArray(P)&&function(V){return ct.isArray(V)&&!V.some(OD)}(P)||(ct.isFileList(P)||ct.endsWith(k,"[]"))&&(U=ct.toArray(P)))return k=J5(k),U.forEach(function(V,q){!ct.isUndefined(V)&&V!==null&&r.append(h===!0?Q5([k],q,u):h===null?k:k+"[]",_(V))}),!1}return!!OD(P)||(r.append(Q5(W,k,u),_(P)),!1)}const S=[],R=Object.assign(aue,{defaultVisitor:y,convertValue:_,isVisitable:OD});if(!ct.isObject(e))throw new TypeError("data must be an object");return function P(k,W){if(!ct.isUndefined(k)){if(S.indexOf(k)!==-1)throw Error("Circular reference detected in "+W.join("."));S.push(k),ct.forEach(k,function(U,V){(!(ct.isUndefined(U)||U===null)&&c.call(r,U,ct.isString(V)?Js(V).call(V):V,W,R))===!0&&P(U,W?W.concat(V):[V])}),S.pop()}}(e),r}function Z5(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function kD(e,r){this._pairs=[],e&&JI(e,this,r)}const eB=kD.prototype;function cue(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tB(e,r,i){if(!r)return e;const o=i&&i.encode||cue;ct.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(r,i):ct.isURLSearchParams(r)?r.toString():new kD(r,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}eB.append=function(e,r){this._pairs.push([e,r])},eB.toString=function(e){const r=e?function(i){return e.call(this,i,Z5)}:Z5;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var nB=class{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ct.forEach(this.handlers,function(r){r!==null&&e(r)})}},rB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},iB={exports:{}},lue=Mn,uue=rt,sB=tt.f;lue({target:"Object",stat:!0,forced:Object.defineProperty!==sB,sham:!uue},{defineProperty:sB});var oB=vt.Object,due=iB.exports=function(e,r,i){return oB.defineProperty(e,r,i)};oB.defineProperty.sham&&(due.sham=!0);var aB=l(iB.exports),hue=TypeError,cB=Vg,pue=a_,fue=_t,mue=hr("species"),lB=Array,gue=function(e){var r;return cB(e)&&(r=e.constructor,(pue(r)&&(r===lB||cB(r.prototype))||fue(r)&&(r=r[mue])===null)&&(r=void 0)),r===void 0?lB:r},uB=function(e,r){return new(gue(e))(r===0?0:r)},_ue=d,Eue=dr,yue=hr("species"),dB=function(e){return Eue>=51||!_ue(function(){var r=[];return(r.constructor={})[yue]=function(){return{foo:1}},r[e](Boolean).foo!==1})},vue=Mn,Sue=d,Tue=Vg,bue=_t,wue=Io,Rue=ii,hB=function(e){if(e>9007199254740991)throw hue("Maximum allowed index exceeded");return e},pB=II,Cue=uB,Iue=dB,Aue=dr,fB=hr("isConcatSpreadable"),Pue=Aue>=51||!Sue(function(){var e=[];return e[fB]=!1,e.concat()[0]!==e}),Oue=function(e){if(!bue(e))return!1;var r=e[fB];return r!==void 0?!!r:Tue(e)};vue({target:"Array",proto:!0,forced:!Pue||!Iue("concat")},{concat:function(e){var r,i,o,c,u,h=wue(this),m=Cue(h,0),_=0;for(r=-1,o=arguments.length;r<o;r++)if(Oue(u=r===-1?h:arguments[r]))for(c=Rue(u),hB(_+c),i=0;i<c;i++,_++)i in u&&pB(m,_,u[i]);else hB(_+1),pB(m,_++,u);return m.length=_,m}});var mB={},kue=ee,Nue=Re,gB=Hd.f,Due=LN,_B=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];mB.f=function(e){return _B&&kue(e)=="Window"?function(r){try{return gB(r)}catch{return Due(_B)}}(e):gB(Nue(e))};var hv={},Lue=hr;hv.f=Lue;var EB=vt,xue=hi,Mue=hv,Uue=tt.f,_s=function(e){var r=EB.Symbol||(EB.Symbol={});xue(r,e)||Uue(r,e,{value:Mue.f(e)})},Vue=ve,Fue=an,jue=hr,Bue=Qu,yB=function(){var e=Fue("Symbol"),r=e&&e.prototype,i=r&&r.valueOf,o=jue("toPrimitive");r&&!r[o]&&Bue(r,o,function(c){return Vue(i,this)},{})},Wue=De,zue=hn,Gue=Io,Hue=ii,$ue=uB,vB=A([].push),Kue=function(e){var r=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,y,S,R){for(var P,k,W=Gue(_),U=zue(W),V=Wue(y,S),q=Hue(U),Y=0,ce=R||$ue,_e=r?ce(_,q):i||h?ce(_,0):void 0;q>Y;Y++)if((m||Y in U)&&(k=V(P=U[Y],Y,W),e))if(r)_e[Y]=k;else if(k)switch(e){case 3:return!0;case 5:return P;case 6:return Y;case 2:vB(_e,P)}else switch(e){case 4:return!1;case 7:vB(_e,P)}return u?-1:o||c?c:_e}},SB={forEach:Kue(0)},QI=Mn,ND=j,DD=ve,que=A,pv=rt,fv=lo,Yue=d,_o=hi,Xue=N,LD=cn,ZI=Re,xD=Ba,Jue=ua,MD=et,qT=Fo,TB=yc,Que=Hd,bB=mB,Zue=Ec,wB=He,RB=tt,ede=ZE,CB=Ne,IB=Qu,tde=Ry,UD=Fa,AB=_c,PB=Vd,nde=hr,rde=hv,ide=_s,sde=yB,ode=Zu,OB=Ju,eA=SB.forEach,Ac=jg("hidden"),tA="Symbol",YT="prototype",ade=OB.set,kB=OB.getterFor(tA),ad=Object[YT],S_=ND.Symbol,nA=S_&&S_[YT],cde=ND.TypeError,VD=ND.QObject,NB=wB.f,T_=RB.f,DB=bB.f,lde=CB.f,LB=que([].push),Up=UD("symbols"),XT=UD("op-symbols"),ude=UD("wks"),FD=!VD||!VD[YT]||!VD[YT].findChild,jD=pv&&Yue(function(){return qT(T_({},"a",{get:function(){return T_(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=NB(ad,r);o&&delete ad[r],T_(e,r,i),o&&e!==ad&&T_(ad,r,o)}:T_,BD=function(e,r){var i=Up[e]=qT(nA);return ade(i,{type:tA,tag:e,description:r}),pv||(i.description=r),i},rA=function(e,r,i){e===ad&&rA(XT,r,i),LD(e);var o=xD(r);return LD(i),_o(Up,o)?(i.enumerable?(_o(e,Ac)&&e[Ac][o]&&(e[Ac][o]=!1),i=qT(i,{enumerable:MD(0,!1)})):(_o(e,Ac)||T_(e,Ac,MD(1,{})),e[Ac][o]=!0),jD(e,o,i)):T_(e,o,i)},WD=function(e,r){LD(e);var i=ZI(r),o=TB(i).concat(VB(i));return eA(o,function(c){pv&&!DD(xB,i,c)||rA(e,c,i[c])}),e},xB=function(e){var r=xD(e),i=DD(lde,this,r);return!(this===ad&&_o(Up,r)&&!_o(XT,r))&&(!(i||!_o(this,r)||!_o(Up,r)||_o(this,Ac)&&this[Ac][r])||i)},MB=function(e,r){var i=ZI(e),o=xD(r);if(i!==ad||!_o(Up,o)||_o(XT,o)){var c=NB(i,o);return!c||!_o(Up,o)||_o(i,Ac)&&i[Ac][o]||(c.enumerable=!0),c}},UB=function(e){var r=DB(ZI(e)),i=[];return eA(r,function(o){_o(Up,o)||_o(AB,o)||LB(i,o)}),i},VB=function(e){var r=e===ad,i=DB(r?XT:ZI(e)),o=[];return eA(i,function(c){!_o(Up,c)||r&&!_o(ad,c)||LB(o,Up[c])}),o};fv||(S_=function(){if(Xue(nA,this))throw cde("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Jue(arguments[0]):void 0,r=PB(e),i=function(o){this===ad&&DD(i,XT,o),_o(this,Ac)&&_o(this[Ac],r)&&(this[Ac][r]=!1),jD(this,r,MD(1,o))};return pv&&FD&&jD(ad,r,{configurable:!0,set:i}),BD(r,e)},IB(nA=S_[YT],"toString",function(){return kB(this).tag}),IB(S_,"withoutSetter",function(e){return BD(PB(e),e)}),CB.f=xB,RB.f=rA,ede.f=WD,wB.f=MB,Que.f=bB.f=UB,Zue.f=VB,rde.f=function(e){return BD(nde(e),e)},pv&&tde(nA,"description",{configurable:!0,get:function(){return kB(this).description}})),QI({global:!0,wrap:!0,forced:!fv,sham:!fv},{Symbol:S_}),eA(TB(ude),function(e){ide(e)}),QI({target:tA,stat:!0,forced:!fv},{useSetter:function(){FD=!0},useSimple:function(){FD=!1}}),QI({target:"Object",stat:!0,forced:!fv,sham:!pv},{create:function(e,r){return r===void 0?qT(e):WD(qT(e),r)},defineProperty:rA,defineProperties:WD,getOwnPropertyDescriptor:MB}),QI({target:"Object",stat:!0,forced:!fv},{getOwnPropertyNames:UB}),sde(),ode(S_,tA),AB[Ac]=!0;var FB=lo&&!!Symbol.for&&!!Symbol.keyFor,dde=Mn,hde=an,pde=hi,fde=ua,jB=Fa,mde=FB,zD=jB("string-to-symbol-registry"),gde=jB("symbol-to-string-registry");dde({target:"Symbol",stat:!0,forced:!mde},{for:function(e){var r=fde(e);if(pde(zD,r))return zD[r];var i=hde("Symbol")(r);return zD[r]=i,gde[i]=r,i}});var _de=Mn,Ede=hi,yde=el,vde=lc,Sde=FB,BB=Fa("symbol-to-string-registry");_de({target:"Symbol",stat:!0,forced:!Sde},{keyFor:function(e){if(!yde(e))throw TypeError(vde(e)+" is not a symbol");if(Ede(BB,e))return BB[e]}});var WB=Vg,Tde=Me,zB=ee,bde=ua,GB=A([].push),wde=Mn,HB=an,$B=ne,Rde=ve,JT=A,KB=d,qB=Me,YB=el,XB=fs,Cde=function(e){if(Tde(e))return e;if(WB(e)){for(var r=e.length,i=[],o=0;o<r;o++){var c=e[o];typeof c=="string"?GB(i,c):typeof c!="number"&&zB(c)!="Number"&&zB(c)!="String"||GB(i,bde(c))}var u=i.length,h=!0;return function(m,_){if(h)return h=!1,_;if(WB(this))return _;for(var y=0;y<u;y++)if(i[y]===m)return _}}},Ide=lo,Ade=String,vm=HB("JSON","stringify"),iA=JT(/./.exec),JB=JT("".charAt),Pde=JT("".charCodeAt),Ode=JT("".replace),kde=JT(1 .toString),Nde=/[\uD800-\uDFFF]/g,QB=/^[\uD800-\uDBFF]$/,ZB=/^[\uDC00-\uDFFF]$/,e6=!Ide||KB(function(){var e=HB("Symbol")();return vm([e])!="[null]"||vm({a:e})!="{}"||vm(Object(e))!="{}"}),t6=KB(function(){return vm("\uDF06\uD834")!=='"\\udf06\\ud834"'||vm("\uDEAD")!=='"\\udead"'}),Dde=function(e,r){var i=XB(arguments),o=Cde(r);if(qB(o)||e!==void 0&&!YB(e))return i[1]=function(c,u){if(qB(o)&&(u=Rde(o,this,Ade(c),u)),!YB(u))return u},$B(vm,null,i)},Lde=function(e,r,i){var o=JB(i,r-1),c=JB(i,r+1);return iA(QB,e)&&!iA(ZB,c)||iA(ZB,e)&&!iA(QB,o)?"\\u"+kde(Pde(e,0),16):e};vm&&wde({target:"JSON",stat:!0,forced:e6||t6},{stringify:function(e,r,i){var o=XB(arguments),c=$B(e6?Dde:vm,null,o);return t6&&typeof c=="string"?Ode(c,Nde,Lde):c}});var n6=Ec,xde=Io;Mn({target:"Object",stat:!0,forced:!lo||d(function(){n6.f(1)})},{getOwnPropertySymbols:function(e){var r=n6.f;return r?r(xde(e)):[]}}),_s("asyncIterator"),_s("hasInstance"),_s("isConcatSpreadable"),_s("iterator"),_s("match"),_s("matchAll"),_s("replace"),_s("search"),_s("species"),_s("split");var Mde=yB;_s("toPrimitive"),Mde();var Ude=an,Vde=Zu;_s("toStringTag"),Vde(Ude("Symbol"),"Symbol"),_s("unscopables"),Zu(j.JSON,"JSON",!0);var Fde=vt.Symbol,jde=hr,Bde=tt.f,r6=jde("metadata"),i6=Function.prototype;i6[r6]===void 0&&Bde(i6,r6,{value:null}),_s("dispose"),_s("metadata");var Wde=Fde;_s("asyncDispose");var zde=A,GD=an("Symbol"),Gde=GD.keyFor,Hde=zde(GD.prototype.valueOf),s6=GD.isRegisteredSymbol||function(e){try{return Gde(Hde(e))!==void 0}catch{return!1}};Mn({target:"Symbol",stat:!0},{isRegisteredSymbol:s6});for(var $de=Fa,o6=an,Kde=A,qde=el,Yde=hr,sA=o6("Symbol"),a6=sA.isWellKnownSymbol,c6=o6("Object","getOwnPropertyNames"),Xde=Kde(sA.prototype.valueOf),l6=$de("wks"),HD=0,u6=c6(sA),Jde=u6.length;HD<Jde;HD++)try{var d6=u6[HD];qde(sA[d6])&&Yde(d6)}catch{}var h6=function(e){if(a6&&a6(e))return!0;try{for(var r=Xde(e),i=0,o=c6(l6),c=o.length;i<c;i++)if(l6[o[i]]==r)return!0}catch{}return!1};Mn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:h6}),_s("matcher"),_s("observable"),Mn({target:"Symbol",stat:!0},{isRegistered:s6}),Mn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:h6}),_s("metadataKey"),_s("patternMatch"),_s("replaceAll");var mv=l(Wde),p6=l(hv.f("iterator"));function QT(e){return QT=typeof mv=="function"&&typeof p6=="symbol"?function(r){return typeof r}:function(r){return r&&typeof mv=="function"&&r.constructor===mv&&r!==mv.prototype?"symbol":typeof r},QT(e)}var Qde=l(hv.f("toPrimitive"));function Zde(e){var r=function(i,o){if(QT(i)!=="object"||i===null)return i;var c=i[Qde];if(c!==void 0){var u=c.call(i,o);if(QT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return QT(r)==="symbol"?r:String(r)}function $(e,r,i){return(r=Zde(r))in e?aB(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}var f6=l(Dae),ehe={isBrowser:!0,classes:{URLSearchParams:f6!==void 0?f6:kD,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const $D=typeof window<"u"&&typeof document<"u",KD=typeof navigator=="object"&&navigator||void 0,the=$D&&(!KD||["ReactNative","NativeScript","NS"].indexOf(KD.product)<0),nhe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",rhe=$D&&window.location.href||"http://localhost";function m6(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function g6(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?m6(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):m6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Ea=g6(g6({},Object.freeze({__proto__:null,hasBrowserEnv:$D,hasStandardBrowserEnv:the,hasStandardBrowserWebWorkerEnv:nhe,navigator:KD,origin:rhe})),ehe),ihe=cn,she=ve,ohe=hi,ahe=N,che=function(){var e=ihe(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},_6=RegExp.prototype,E6=function(e){var r=e.flags;return r!==void 0||"flags"in _6||ohe(e,"flags")||!ahe(_6,e)?r:she(che,e)},lhe=PN.charAt,y6=ve,uhe=cn,dhe=Me,hhe=ee,phe=/./.exec,fhe=TypeError,mhe=Mn,v6=ve,S6=se,ghe=_y,oA=Ty,T6=Yt,b6=xt,ZT=ua,_he=cn,Ehe=Ut,yhe=ee,vhe=aC,w6=E6,She=uc,The=d,bhe=qi,whe=function(e,r,i){return r+(i?lhe(e,r).length:1)},Rhe=function(e,r){var i=e.exec;if(dhe(i)){var o=y6(i,e,r);return o!==null&&uhe(o),o}if(hhe(e)==="RegExp")return y6(phe,e,r);throw fhe("RegExp#exec called on incompatible receiver")},R6=Ju,Che=hr("matchAll"),C6="RegExp String",I6=C6+" Iterator",Ihe=R6.set,Ahe=R6.getterFor(I6),Phe=TypeError,qD=S6("".indexOf),aA=S6("".matchAll),YD=!!aA&&!The(function(){aA("a",/./)}),Ohe=ghe(function(e,r,i,o){Ihe(this,{type:I6,regexp:e,string:r,global:i,unicode:o,done:!1})},C6,function(){var e=Ahe(this);if(e.done)return oA(void 0,!0);var r=e.regexp,i=e.string,o=Rhe(r,i);return o===null?(e.done=!0,oA(void 0,!0)):e.global?(ZT(o[0])===""&&(r.lastIndex=whe(i,b6(r.lastIndex),e.unicode)),oA(o,!1)):(e.done=!0,oA(o,!1))}),A6=function(e){var r,i,o,c=_he(this),u=ZT(e),h=bhe(c,RegExp),m=ZT(w6(c));return r=new h(h===RegExp?c.source:c,m),i=!!~qD(m,"g"),o=!!~qD(m,"u"),r.lastIndex=b6(c.lastIndex),new Ohe(r,u,i,o)};mhe({target:"String",proto:!0,forced:YD},{matchAll:function(e){var r,i,o,c,u=T6(this);if(Ehe(e)){if(YD)return aA(u,e)}else{if(vhe(e)&&(r=ZT(T6(w6(e))),!~qD(r,"g")))throw Phe("`.matchAll` does not allow non-global regexes");if(YD)return aA(u,e);if((o=She(e,Che))===void 0&&yhe(e)=="RegExp"&&(o=A6),o)return v6(o,e,u)}return i=ZT(u),c=new RegExp(e,"g"),v6(A6,c,i)}});var khe=za("String").matchAll,Nhe=N,Dhe=khe,XD=String.prototype,Lhe=function(e){var r=e.matchAll;return typeof e=="string"||e===XD||Nhe(XD,e)&&r===XD.matchAll?Dhe:r},xhe=l(Lhe);function P6(e){function r(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=i.length;return h=!h&&ct.isArray(c)?c.length:h,_?(ct.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&ct.isObject(c[h])||(c[h]=[]),r(i,o,c[h],u)&&ct.isArray(c[h])&&(c[h]=function(y){const S={},R=Object.keys(y);let P;const k=R.length;let W;for(P=0;P<k;P++)W=R[P],S[W]=y[W];return S}(c[h])),!m)}if(ct.isFormData(e)&&ct.isFunction(e.entries)){const i={};return ct.forEachEntry(e,(o,c)=>{r(function(u){return xhe(ct).call(ct,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const JD={transitional:rB,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const i=r.getContentType()||"",o=i.indexOf("application/json")>-1,c=ct.isObject(e);if(c&&ct.isHTMLForm(e)&&(e=new FormData(e)),ct.isFormData(e))return o?JSON.stringify(P6(e)):e;if(ct.isArrayBuffer(e)||ct.isBuffer(e)||ct.isStream(e)||ct.isFile(e)||ct.isBlob(e)||ct.isReadableStream(e))return e;if(ct.isArrayBufferView(e))return e.buffer;if(ct.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return JI(h,new Ea.classes.URLSearchParams,Object.assign({visitor:function(_,y,S,R){return Ea.isNode&&ct.isBuffer(_)?(this.append(y,_.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=ct.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return JI(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,_){if(ct.isString(h))try{return(m||JSON.parse)(h),Js(ct).call(ct,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const r=this.transitional||JD.transitional,i=r&&r.forcedJSONParsing,o=this.responseType==="json";if(ct.isResponse(e)||ct.isReadableStream(e))return e;if(e&&ct.isString(e)&&(i&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?Zn.from(u,Zn.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ea.classes.FormData,Blob:Ea.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ct.forEach(["delete","get","head","post","put","patch"],e=>{JD.headers[e]={}});var QD=JD;const Mhe=ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),O6=Symbol("internals");function eb(e){var r;return e&&Js(r=String(e)).call(r).toLowerCase()}function cA(e){return e===!1||e==null?e:ct.isArray(e)?e.map(cA):String(e)}function ZD(e,r,i,o,c){return ct.isFunction(o)?o.call(this,r,i):(c&&(r=i),ct.isString(r)?ct.isString(o)?r.indexOf(o)!==-1:ct.isRegExp(o)?o.test(r):void 0:void 0)}class lA{constructor(r){r&&this.set(r)}set(r,i,o){const c=this;function u(_,y,S){const R=eb(y);if(!R)throw new Error("header name must be a non-empty string");const P=ct.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||y]=cA(_))}const h=(_,y)=>ct.forEach(_,(S,R)=>u(S,R,y));if(ct.isPlainObject(r)||r instanceof this.constructor)h(r,i);else if(ct.isString(r)&&(r=Js(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Js(m=r).call(m)))h((_=>{const y={};let S,R,P;return _&&_.split(`
`).forEach(function(k){var W,U;P=k.indexOf(":"),S=Js(W=k.substring(0,P)).call(W).toLowerCase(),R=Js(U=k.substring(P+1)).call(U),!S||y[S]&&Mhe[S]||(S==="set-cookie"?y[S]?y[S].push(R):y[S]=[R]:y[S]=y[S]?y[S]+", "+R:R)}),y})(r),i);else if(ct.isHeaders(r))for(const[_,y]of r.entries())u(y,_,o);else r!=null&&u(i,r,o);var m;return this}get(r,i){if(r=eb(r)){const o=ct.findKey(this,r);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(ct.isFunction(i))return i.call(this,c,o);if(ct.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=eb(r)){const o=ct.findKey(this,r);return!(!o||this[o]===void 0||i&&!ZD(0,this[o],o,i))}return!1}delete(r,i){const o=this;let c=!1;function u(h){if(h=eb(h)){const m=ct.findKey(o,h);!m||i&&!ZD(0,o[m],m,i)||(delete o[m],c=!0)}}return ct.isArray(r)?r.forEach(u):u(r),c}clear(r){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];r&&!ZD(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const i=this,o={};return ct.forEach(this,(c,u)=>{var h;const m=ct.findKey(o,u);if(m)return i[m]=cA(c),void delete i[u];const _=r?function(y){return Js(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):Js(h=String(u)).call(h);_!==u&&delete i[u],i[_]=cA(c),o[_]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return ct.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=r&&ct.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,o]=r;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(r){const i=(this[O6]=this[O6]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=eb(u);i[h]||(function(m,_){const y=ct.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+y,{value:function(R,P,k){return this[S].call(this,_,R,P,k)},configurable:!0})})}(o,u),i[h]=!0)}return ct.isArray(r)?r.forEach(c):c(r),this}}lA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ct.reduceDescriptors(lA.prototype,(e,r)=>{let{value:i}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[o]=c}}}),ct.freezeMethods(lA);var cd=lA;function eL(e,r){const i=this||QD,o=r||i,c=cd.from(o.headers);let u=o.data;return ct.forEach(e,function(h){u=h.call(i,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function k6(e){return!(!e||!e.__CANCEL__)}function gv(e,r,i){Zn.call(this,e??"canceled",Zn.ERR_CANCELED,r,i),this.name="CanceledError"}function N6(e,r,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?r(new Zn("Request failed with status code "+i.status,[Zn.ERR_BAD_REQUEST,Zn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}ct.inherits(gv,Zn,{__CANCEL__:!0});const uA=function(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let y,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const k=Date.now(),W=_[R];y||(y=k),m[S]=P,_[S]=k;let U=R,V=0;for(;U!==S;)V+=m[U++],U%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),k-y<h)return;const q=W&&k-W;return q?Math.round(1e3*V/q):void 0}}(50,250);return function(u,h){let m,_,y=0,S=1e3/h;const R=function(P){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,P)};return[function(){const P=Date.now(),k=P-y;for(var W=arguments.length,U=new Array(W),V=0;V<W;V++)U[V]=arguments[V];k>=S?R(U,P):(m=U,_||(_=setTimeout(()=>{_=null,R(m)},S-k)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,y=c(_);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},i)},D6=(e,r)=>{const i=e!=null;return[o=>r[0]({lengthComputable:i,total:e,loaded:o}),r[1]]},L6=e=>function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return ct.asap(()=>e(...i))};var Uhe=Ea.hasStandardBrowserEnv?((e,r)=>i=>(i=new FI(i,Ea.origin),e.protocol===i.protocol&&e.host===i.host&&(r||e.port===i.port)))(new FI(Ea.origin),Ea.navigator&&/(msie|trident)/i.test(Ea.navigator.userAgent)):()=>!0,Vhe=Ea.hasStandardBrowserEnv?{write(e,r,i,o,c,u){const h=[e+"="+encodeURIComponent(r)];ct.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),ct.isString(o)&&h.push("path="+o),ct.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function x6(e,r){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(r)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,r):r}function M6(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const U6=e=>e instanceof cd?function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?M6(Object(o),!0).forEach(function(c){$(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):M6(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e):e;function b_(e,r){r=r||{};const i={};function o(y,S,R,P){return ct.isPlainObject(y)&&ct.isPlainObject(S)?ct.merge.call({caseless:P},y,S):ct.isPlainObject(S)?ct.merge({},S):ct.isArray(S)?S.slice():S}function c(y,S,R,P){return ct.isUndefined(S)?ct.isUndefined(y)?void 0:o(void 0,y,0,P):o(y,S,0,P)}function u(y,S){if(!ct.isUndefined(S))return o(void 0,S)}function h(y,S){return ct.isUndefined(S)?ct.isUndefined(y)?void 0:o(void 0,y):o(void 0,S)}function m(y,S,R){return R in r?o(y,S):R in e?o(void 0,y):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,S,R)=>c(U6(y),U6(S),0,!0)};return ct.forEach(Object.keys(Object.assign({},e,r)),function(y){const S=_[y]||c,R=S(e[y],r[y],y);ct.isUndefined(R)&&S!==m||(i[y]=R)}),i}var V6=e=>{const r=b_({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=r;if(r.headers=m=cd.from(m),r.url=tB(x6(r.baseURL,r.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),ct.isFormData(o)){if(Ea.hasStandardBrowserEnv||Ea.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((i=m.getContentType())!==!1){const[y,...S]=i?i.split(";").map(R=>Js(R).call(R)).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...S].join("; "))}}if(Ea.hasStandardBrowserEnv&&(c&&ct.isFunction(c)&&(c=c(r)),c||c!==!1&&Uhe(r.url))){const y=u&&h&&Vhe.read(h);y&&m.set(u,y)}return r},Fhe=typeof XMLHttpRequest<"u"&&function(e){return new lt(function(r,i){const o=V6(e);let c=o.data;const u=cd.from(o.headers).normalize();let h,m,_,y,S,{responseType:R,onUploadProgress:P,onDownloadProgress:k}=o;function W(){y&&y(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function V(){if(!U)return;const Y=cd.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());N6(function(ce){r(ce),W()},function(ce){i(ce),W()},{data:R&&R!=="text"&&R!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Y,config:e,request:U}),U=null}U.open(o.method.toUpperCase(),o.url,!0),U.timeout=o.timeout,"onloadend"in U?U.onloadend=V:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(V)},U.onabort=function(){U&&(i(new Zn("Request aborted",Zn.ECONNABORTED,e,U)),U=null)},U.onerror=function(){i(new Zn("Network Error",Zn.ERR_NETWORK,e,U)),U=null},U.ontimeout=function(){let Y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const ce=o.transitional||rB;o.timeoutErrorMessage&&(Y=o.timeoutErrorMessage),i(new Zn(Y,ce.clarifyTimeoutError?Zn.ETIMEDOUT:Zn.ECONNABORTED,e,U)),U=null},c===void 0&&u.setContentType(null),"setRequestHeader"in U&&ct.forEach(u.toJSON(),function(Y,ce){U.setRequestHeader(ce,Y)}),ct.isUndefined(o.withCredentials)||(U.withCredentials=!!o.withCredentials),R&&R!=="json"&&(U.responseType=o.responseType),k&&([_,S]=uA(k,!0),U.addEventListener("progress",_)),P&&U.upload&&([m,y]=uA(P),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(h=Y=>{U&&(i(!Y||Y.type?new gv(null,e,U):Y),U.abort(),U=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function(Y){const ce=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return ce&&ce[1]||""}(o.url);q&&Ea.protocols.indexOf(q)===-1?i(new Zn("Unsupported protocol "+q+":",Zn.ERR_BAD_REQUEST,e)):U.send(c||null)})},jhe=(e,r)=>{const{length:i}=e=e?e.filter(Boolean):[];if(r||i){let o,c=new AbortController;const u=function(y){if(!o){o=!0,m();const S=y instanceof Error?y:this.reason;c.abort(S instanceof Zn?S:new gv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new Zn("timeout ".concat(r," of ms exceeded"),Zn.ETIMEDOUT))},r);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>ct.asap(m),_}},Bhe=O4,Whe=ul;Mn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=Whe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var zhe=ul,Ghe=nh;Mn({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=zhe.f(this),i=Ghe(e);return(i.error?r.reject:r.resolve)(i.value),r.promise}});var tL=l(Bhe),F6=hv.f("asyncIterator"),Hhe=l(F6);function nL(e,r){this.v=e,this.k=r}function tb(e){var r,i;function o(u,h){try{var m=e[u](h),_=m.value,y=_ instanceof nL;tL.resolve(y?_.v:_).then(function(S){if(y){var R=u==="return"?"return":"next";if(!_.k||S.done)return o(R,S);S=e[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):i=null}this._invoke=function(u,h){return new tL(function(m,_){var y={key:u,arg:h,resolve:m,reject:_,next:null};i?i=i.next=y:(r=i=y,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function hl(e){return function(){return new tb(e.apply(this,arguments))}}function wn(e){return new nL(e,0)}function dA(e){var r={},i=!1;function o(c,u){return i=!0,{done:!1,value:new nL(u=new tL(function(h){h(e[c](u))}),1)}}return r[mv!==void 0&&p6||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(r.return=function(c){return i?(i=!1,c):o("return",c)}),r}tb.prototype[typeof mv=="function"&&Hhe||"@@asyncIterator"]=function(){return this},tb.prototype.next=function(e){return this._invoke("next",e)},tb.prototype.throw=function(e){return this._invoke("throw",e)},tb.prototype.return=function(e){return this._invoke("return",e)};var rL=l(F6);function iL(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=rL,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new hA(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function hA(e){function r(i){if(Object(i)!==i)return lt.reject(new TypeError(i+" is not an object."));var o=i.done;return lt.resolve(i.value).then(function(c){return{value:c,done:o}})}return hA=function(i){this.s=i,this.n=i.next},hA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?lt.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?lt.reject(i):r(o.apply(this.s,arguments))}},new hA(e)}const $he=function*(e,r){let i=e.byteLength;if(!r||i<r)return void(yield e);let o,c=0;for(;c<i;)o=c+r,yield e.slice(c,o),c=o},Khe=function(){var e=hl(function*(r,i){var o,c=!1,u=!1;try{for(var h,m=iL(qhe(r));c=!(h=yield wn(m.next())).done;c=!1){const _=h.value;yield*dA(iL($he(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield wn(m.return()))}finally{if(u)throw o}}});return function(r,i){return e.apply(this,arguments)}}(),qhe=function(){var e=hl(function*(r){if(r[rL])return void(yield*dA(iL(r)));const i=r.getReader();try{for(;;){const{done:o,value:c}=yield wn(i.read());if(o)break;yield c}}finally{yield wn(i.cancel())}});return function(r){return e.apply(this,arguments)}}(),j6=(e,r,i,o)=>{const c=Khe(e,r);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:y,value:S}=await c.next();if(y)return m(),void _.close();let R=S.byteLength;if(i){let P=h+=R;i(P)}_.enqueue(new Uint8Array(S))}catch(y){throw m(y),y}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function B6(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function W6(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?B6(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):B6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const pA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",z6=pA&&typeof ReadableStream=="function",Yhe=pA&&(typeof TextEncoder=="function"?(G6=new TextEncoder,e=>G6.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var G6;const H6=function(e){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},Xhe=z6&&H6(()=>{let e=!1;const r=new Request(Ea.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),sL=z6&&H6(()=>ct.isReadableStream(new Response("").body)),fA={stream:sL&&(e=>e.body)};var $6;pA&&($6=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!fA[e]&&(fA[e]=ct.isFunction($6[e])?r=>r[e]():(r,i)=>{throw new Zn("Response type '".concat(e,"' is not supported"),Zn.ERR_NOT_SUPPORT,i)})}));const Jhe=async(e,r)=>{const i=ct.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:ct.isBlob(o)?o.size:ct.isSpecCompliantForm(o)?(await new Request(Ea.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:ct.isArrayBufferView(o)||ct.isArrayBuffer(o)?o.byteLength:(ct.isURLSearchParams(o)&&(o+=""),ct.isString(o)?(await Yhe(o)).byteLength:void 0))(r)};var Qhe=pA&&(async e=>{let{url:r,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:y,headers:S,withCredentials:R="same-origin",fetchOptions:P}=V6(e);y=y?(y+"").toLowerCase():"text";let k,W=jhe([c,u&&u.toAbortSignal()],h);const U=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let V;try{if(_&&Xhe&&i!=="get"&&i!=="head"&&(V=await Jhe(S,o))!==0){let ye,me=new Request(r,{method:"POST",body:o,duplex:"half"});if(ct.isFormData(o)&&(ye=me.headers.get("content-type"))&&S.setContentType(ye),me.body){const[ke,Ye]=D6(V,uA(L6(_)));o=j6(me.body,65536,ke,Ye)}}ct.isString(R)||(R=R?"include":"omit");const q="credentials"in Request.prototype;k=new Request(r,W6(W6({},P),{},{signal:W,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?R:void 0}));let Y=await fetch(k);const ce=sL&&(y==="stream"||y==="response");if(sL&&(m||ce&&U)){const ye={};["status","statusText","headers"].forEach(ut=>{ye[ut]=Y[ut]});const me=ct.toFiniteNumber(Y.headers.get("content-length")),[ke,Ye]=m&&D6(me,uA(L6(m),!0))||[];Y=new Response(j6(Y.body,65536,ke,()=>{Ye&&Ye(),U&&U()}),ye)}y=y||"text";let _e=await fA[ct.findKey(fA,y)||"text"](Y,e);return!ce&&U&&U(),await new lt((ye,me)=>{N6(ye,me,{data:_e,headers:cd.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:k})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new Zn("Network Error",Zn.ERR_NETWORK,e,k),{cause:q.cause||q}):Zn.from(q,q&&q.code,e,k)}});const oL={http:null,xhr:Fhe,fetch:Qhe};ct.forEach(oL,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const K6=e=>"- ".concat(e),Zhe=e=>ct.isFunction(e)||e===null||e===!1;var q6={getAdapter:e=>{e=ct.isArray(e)?e:[e];const{length:r}=e;let i,o;const c={};for(let u=0;u<r;u++){let h;if(i=e[u],o=i,!Zhe(i)&&(o=oL[(h=String(i)).toLowerCase()],o===void 0))throw new Zn("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new Zn("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(K6).join(`
`):" "+K6(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:oL};function aL(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new gv(null,e)}function Y6(e){return aL(e),e.headers=cd.from(e.headers),e.data=eL.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),q6.getAdapter(e.adapter||QD.adapter)(e).then(function(r){return aL(e),r.data=eL.call(e,e.transformResponse,r),r.headers=cd.from(r.headers),r},function(r){return k6(r)||(aL(e),r&&r.response&&(r.response.data=eL.call(e,e.transformResponse,r.response),r.response.headers=cd.from(r.response.headers))),lt.reject(r)})}const X6="1.7.9",mA={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{mA[e]=function(i){return typeof i===e||"a"+(r<1?"n ":" ")+e}});const J6={};mA.transitional=function(e,r,i){function o(c,u){return"[Axios v"+X6+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new Zn(o(u," has been removed"+(r?" in "+r:"")),Zn.ERR_DEPRECATED);return r&&!J6[u]&&(J6[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(c,u,h)}},mA.spelling=function(e){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var gA={assertOptions:function(e,r,i){if(typeof e!="object")throw new Zn("options must be an object",Zn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new Zn("option "+u+" must be "+_,Zn.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new Zn("Unknown option "+u,Zn.ERR_BAD_OPTION)}},validators:mA};const ch=gA.validators;let _A=class{constructor(e){this.defaults=e,this.interceptors={request:new nB,response:new nB}}async request(e,r){try{return await this._request(e,r)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=b_(this.defaults,r);const{transitional:i,paramsSerializer:o,headers:c}=r;i!==void 0&&gA.assertOptions(i,{silentJSONParsing:ch.transitional(ch.boolean),forcedJSONParsing:ch.transitional(ch.boolean),clarifyTimeoutError:ch.transitional(ch.boolean)},!1),o!=null&&(ct.isFunction(o)?r.paramsSerializer={serialize:o}:gA.assertOptions(o,{encode:ch.function,serialize:ch.function},!0)),gA.assertOptions(r,{baseUrl:ch.spelling("baseURL"),withXsrfToken:ch.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&ct.merge(c.common,c[r.method]);c&&ct.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),r.headers=cd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const _=[];let y;this.interceptors.response.forEach(function(k){_.push(k.fulfilled,k.rejected)});let S,R=0;if(!m){const k=[Y6.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,_),S=k.length,y=lt.resolve(r);R<S;)y=y.then(k[R++],k[R++]);return y}S=h.length;let P=r;for(R=0;R<S;){const k=h[R++],W=h[R++];try{P=k(P)}catch(U){W.call(this,U);break}}try{y=Y6.call(this,P)}catch(k){return lt.reject(k)}for(R=0,S=_.length;R<S;)y=y.then(_[R++],_[R++]);return y}getUri(e){return tB(x6((e=b_(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};ct.forEach(["delete","get","head","options"],function(e){_A.prototype[e]=function(r,i){return this.request(b_(i||{},{method:e,url:r,data:(i||{}).data}))}}),ct.forEach(["post","put","patch"],function(e){function r(i){return function(o,c,u){return this.request(b_(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}_A.prototype[e]=r(),_A.prototype[e+"Form"]=r(!0)});var EA=_A;class cL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new lt(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new lt(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new gv(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=o=>{r.abort(o)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new cL(function(o){r=o}),cancel:r}}}var epe=cL;const lL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(lL).forEach(e=>{let[r,i]=e;lL[i]=r});var tpe=lL;const Bs=function e(r){const i=new EA(r),o=U5(EA.prototype.request,i);return ct.extend(o,EA.prototype,i,{allOwnKeys:!0}),ct.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(b_(r,c))},o}(QD);Bs.Axios=EA,Bs.CanceledError=gv,Bs.CancelToken=epe,Bs.isCancel=k6,Bs.VERSION=X6,Bs.toFormData=JI,Bs.AxiosError=Zn,Bs.Cancel=Bs.CanceledError,Bs.all=function(e){return lt.all(e)},Bs.spread=function(e){return function(r){return e.apply(null,r)}},Bs.isAxiosError=function(e){return ct.isObject(e)&&e.isAxiosError===!0},Bs.mergeConfig=b_,Bs.AxiosHeaders=cd,Bs.formToJSON=e=>P6(ct.isHTMLForm(e)?new FormData(e):e),Bs.getAdapter=q6.getAdapter,Bs.HttpStatusCode=tpe,Bs.default=Bs;var Go=Bs;const npe=()=>{};function nb(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:npe};return e.promise=new lt((r,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const yA=new Map,vA=new Map,lh=new Map;let xi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Un=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const Q6=new yle;let ld=Q6.getResult(),uL=null;function Rn(e){if(!uL){ld=Q6.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Un.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Un.CHROME;case"Safari":case"Mobile Safari":return Un.SAFARI;case"Edge":return Un.EDGE;case"Firefox":return Un.FIREFOX;case"QQ":case"QQBrowser":return Un.QQ;case"Opera":return Un.OPERA;case"WeChat":return Un.WECHAT;default:return m.browser.name||""}}(ld),i=Z6(ld),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(ld),c=ld.os.version,u=Z6(ld,!1),h=ld.device.type;if(!(r&&i&&o&&c))return{name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};uL={name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return uL}function Z6(e){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?r.split(".")[0]:r}function SA(){return Rn().os}function e8(){const e=Rn();return"".concat(e.os," ").concat(e.osVersion)}function TA(){const e=Rn();return!!(ld.engine.name==="WebKit"&&e.os===xi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Un.SAFARI||Eo()&&e.name!==Un.SAFARI)}function Vp(){return Rn().name===Un.CHROME}function Es(){return Rn().name===Un.SAFARI}function t8(){return Rn().name===Un.EDGE}function Dr(){return Rn().name===Un.FIREFOX}function Eo(){return Rn().os===xi.IOS}function rb(e){const r=Rn();return!(r.name!==Un.CHROME||!r.osVersion)&&Number(r.version)>=e}function n8(e){const r=Rn();return!(r.name!==Un.CHROME||!r.osVersion)&&Number(r.version)<e}function dL(e,r,i){const o=Rn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=r&&Number(o.version)<=i:Number(o.version)===r)}function hL(e){const r=Rn();return!(r.name!==Un.EDGE||!r.osVersion)&&Number(r.version)>=e}function r8(e){const r=Rn();return!(r.name!==Un.SAFARI||!r.osVersion)&&Number(r.version)>=e}function i8(e,r,i){const o=Rn();if(o.os!==xi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e}function s8(e,r,i){const o=Rn();if(o.name!==Un.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e:r?Number(c[0])===e&&Number(c[1])<=r||Number(c[0])<e:Number(c[0])<=e}function pL(e){const r=Rn();return!(r.name!==Un.OPERA||!r.osVersion)&&Number(r.version)>=e}function o8(){const e=Rn();if(e.os!==xi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function _v(){const e=Rn();if(e.os!==xi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function fL(){const e=Rn();if(e.os!==xi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function a8(){const e=Rn();if(e.os!==xi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function su(){return Es()&&navigator.maxTouchPoints>0}function c8(){return Rn().name===Un.WECHAT}function l8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function mL(){const e=SA();return function(){const{deviceType:r}=Rn();return r==="mobile"||r==="tablet"}()||e===xi.ANDROID||e===xi.IOS||e===xi.HARMONY_OS}function Fp(){const e=Rn();return e.name!==Un.EDGE&&e.name!==Un.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function bA(){return SA()===xi.ANDROID}function ib(){const e=Rn();return bA()&&(e.name===Un.CHROME||e.name===Un.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function u8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ft(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?u8(Object(i),!0).forEach(function(o){zt(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function zt(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}let X=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Le=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),zt(this,"code",void 0),zt(this,"message",void 0),zt(this,"data",void 0),zt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function jp(e,r){if(typeof e!="boolean")throw new Le(X.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Pi(e,r,i){if(!ot(i).call(i,e))throw new Le(X.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function er(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Le(X.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function gL(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Le(X.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&er(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&er(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&er(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&er(e.ideal,"".concat(r,".ideal"),1,1/0)}else er(e,r,1,1/0)}function rs(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Le(X.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!d8(e,i,o,c))throw new Le(X.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Bp(e,r){if(!Array.isArray(e))throw new Le(X.INVALID_PARAMS,"".concat(r," should be an array"))}function Lr(e){return e==null}function d8(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var sb=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(sb||{}),_L=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(_L||{});const h8=new class{constructor(){zt(this,"_clientSize",null),zt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),zt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),zt(this,"getStyle",e=>window.getComputedStyle(e,null)),zt(this,"checkCssVisibleProperty",e=>{var r;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||ot(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(_=>{var y;const S=_.split("(")[0];return ot(y=["brightness","blur","opacity"]).call(y,S)}).map(_=>{const[y,S]=_.split(/\(|\)/);return[y,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[y,S]=_;switch(y){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),zt(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let i=!0,o=!0;const c=h=>r(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),zt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),zt(this,"getSizeAboutClient",e=>{const{width:r,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:r,height:i,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),zt(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,r,i)}),zt(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),zt(this,"checkCoverForAPoint",(e,r,i)=>{const o=this.elementFromPoint(e,r);return o!==null&&o!==i}),zt(this,"getPointPositionList",()=>{const{width:e,height:r,left:i,top:o}=this._clientSize,c=e/6,u=r/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let y=0;y<5;y++){const S=(i*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,R=(o*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:S,y:R})}return[...h]}),zt(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),zt(this,"checkSizeIsVisible",(e,r,i)=>(e>50||i/e<=10)&&(r>50||i/r<=10)),zt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,y,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(r<0)return!1;if(_=r<u?r:u,i<0)y=0;else{if(!(i<c))return!1;y=i}if(o<0)return!1;S=o<c?o:c;const R=_-m,P=S-y;return this.checkSizeIsVisible(R,P,h)}),zt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),zt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(sb.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(sb.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(sb.SIZE)}}return this.returnHiddenResult(sb.STYLE)}return this.returnHiddenResult(_L.UNMOUNTED)}return this.returnHiddenResult(_L.INVALID_HTML_ELEMENT)}),zt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function EL(e){return new TextEncoder().encode(e)}const p8=function(e,r){const i=new Uint8Array(e.byteLength+r.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(r),e.byteLength),i},yL=async e=>function(r,i){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",EL(e)),16);let Ar=class{constructor(){zt(this,"_events",{}),zt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,r);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const r=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,r){let i=e.length;for(;i--;)if(e[i].listener===r)return i;return-1}},ob=null;function f8(){if(ob)return ob;if(window.electron)return ob=window.electron;if(!window.require)return null;try{return ob=window.require("electron"),ob}catch{return null}}let mi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),xr=function(e){return e.TRACER="tracer",e}({});function m8(e){return er(e.timeout,"config.timeout",0,1e5),er(e.timeoutFactor,"config.timeoutFactor",0,100,!1),er(e.maxRetryCount,"config.maxRetryConfig",0,1/0),er(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let rpe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Bn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function ab(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function g8(e){return rs(e.turnServerURL,"turnServerURL"),rs(e.username,"username"),rs(e.password,"password"),e.udpport&&er(e.udpport,"udpport",1,99999,!0),e.forceturn&&jp(e.forceturn,"forceturn"),e.security&&jp(e.security,"security"),e.tcpport&&er(e.tcpport,"tcpport",1,99999,!0),!0}function vL(e){return e.level!==void 0&&Pi(e.level,"level",[1,2,3]),e.delay!==void 0&&er(e.delay,"delay",0,3e3,!0),!0}let mn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ys=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Ja=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Ev=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function vs(e,r){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(r).length===0?lt.reject(new Le(X.UNEXPECTED_ERROR,"can not emit promise")):new lt((u,h)=>{e.emit(r,...o,u,h)})}function sr(e,r){if(e.getListeners(r).length===0)return lt.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return vs(e,r,...o)}function Pc(e,r){if(e.getListeners(r).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return cb(e,r,...o)}function cb(e,r){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(r,...u,m=>{i=m},m=>{o=m}),o!==null)throw o;if(i===null)throw new Le(X.UNEXPECTED_ERROR,"handler is not sync");return i}const oi=new class extends Ar{set networkState(e){this.emit(Ev.NETWORK_STATE_CHANGE,e,this._networkState),e===Ja.ONLINE?this.emit(Ev.ONLINE):e===Ja.OFFLINE&&(this.onlineWaiter=new lt(r=>{this.once(Ev.ONLINE,()=>{this.onlineWaiter=void 0,r(Ja.ONLINE)})}),this.emit(Ev.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ja.ONLINE}constructor(){super(),zt(this,"_moduleName","network-indicator"),zt(this,"_networkState",Ja.ONLINE),zt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ja.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ja.OFFLINE})}};function wA(e,r){const i=e.indexOf(r);i!==-1&&e.splice(i,1)}function yv(e){const r=[];return e.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function RA(e){lt!==void 0?lt.resolve().then(e):setTimeout(e,0)}function Mr(e){return JSON.parse(JSON.stringify(e))}function w_(e){try{return Mr(e)}catch{return e}}const _8={};function Sm(e,r){_8[r]||(_8[r]=!0,e())}function R_(e){const r=window.atob(e),i=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)i[o]=r.charCodeAt(o);return i}function Tm(e){let r="";for(let i=0;i<e.length;i+=1)r+=String.fromCharCode(e[i]);return window.btoa(r)}function E8(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const o=new Uint8Array(r);o.set(i),i=o}return i}function y8(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=Ga(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function uh(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function v8(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{r+=typeof i=="string"?uh(i):i.size}),r+138}function ipe(e){const r=new Le(X.TIMEOUT,"timeout");return new lt((i,o)=>{window.setTimeout(()=>o(r),e)})}function is(e){return new lt(r=>{window.setTimeout(r,e)})}function or(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(r).concat(i):"".concat(r).concat(i)+or(e-i.length,"")}function C_(){return or(32,"").toUpperCase()}const CA=()=>{},S8=new class{constructor(){zt(this,"fnMap",new Map)}throttleByKey(e,r,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,ft(ft({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:m,args:u,skipFn:o})}}},T8=S8.throttleByKey.bind(S8);function b8(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function SL(e,r){if(!b8(e)||!b8(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const i=[...e];for(let o=0;o<r.length;o++)i[o]=SL(e[o],r[o]);return i}{const i=ft({},e);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=SL(e[o],r[o]):i[o]=r[o]);return i}}function w8(e,r){let i=[0];if(i=new Array(r).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==r););return i}function TL(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function R8(e){const r="0123456789abcdef";function i(ce){let _e,ye="";for(_e=0;_e<=3;_e++)ye+=r.charAt(ce>>8*_e+4&15)+r.charAt(ce>>8*_e&15);return ye}function o(ce,_e){const ye=(65535&ce)+(65535&_e);return(ce>>16)+(_e>>16)+(ye>>16)<<16|65535&ye}function c(ce,_e,ye,me,ke,Ye){return o(function(ut,pt){return ut<<pt|ut>>>32-pt}(o(o(_e,ce),o(me,Ye)),ke),ye)}function u(ce,_e,ye,me,ke,Ye,ut){return c(_e&ye|~_e&me,ce,_e,ke,Ye,ut)}function h(ce,_e,ye,me,ke,Ye,ut){return c(_e&me|ye&~me,ce,_e,ke,Ye,ut)}function m(ce,_e,ye,me,ke,Ye,ut){return c(_e^ye^me,ce,_e,ke,Ye,ut)}function _(ce,_e,ye,me,ke,Ye,ut){return c(ye^(_e|~me),ce,_e,ke,Ye,ut)}const y=function(ce){let _e;const ye=1+(ce.length+8>>6),me=new Array(16*ye);for(_e=0;_e<16*ye;_e++)me[_e]=0;for(_e=0;_e<ce.length;_e++)me[_e>>2]|=ce.charCodeAt(_e)<<_e%4*8;return me[_e>>2]|=128<<_e%4*8,me[16*ye-2]=8*ce.length,me}(e);let S,R,P,k,W,U=1732584193,V=-271733879,q=-1732584194,Y=271733878;for(S=0;S<y.length;S+=16)R=U,P=V,k=q,W=Y,U=u(U,V,q,Y,y[S+0],7,-680876936),Y=u(Y,U,V,q,y[S+1],12,-389564586),q=u(q,Y,U,V,y[S+2],17,606105819),V=u(V,q,Y,U,y[S+3],22,-1044525330),U=u(U,V,q,Y,y[S+4],7,-176418897),Y=u(Y,U,V,q,y[S+5],12,1200080426),q=u(q,Y,U,V,y[S+6],17,-1473231341),V=u(V,q,Y,U,y[S+7],22,-45705983),U=u(U,V,q,Y,y[S+8],7,1770035416),Y=u(Y,U,V,q,y[S+9],12,-1958414417),q=u(q,Y,U,V,y[S+10],17,-42063),V=u(V,q,Y,U,y[S+11],22,-1990404162),U=u(U,V,q,Y,y[S+12],7,1804603682),Y=u(Y,U,V,q,y[S+13],12,-40341101),q=u(q,Y,U,V,y[S+14],17,-1502002290),V=u(V,q,Y,U,y[S+15],22,1236535329),U=h(U,V,q,Y,y[S+1],5,-165796510),Y=h(Y,U,V,q,y[S+6],9,-1069501632),q=h(q,Y,U,V,y[S+11],14,643717713),V=h(V,q,Y,U,y[S+0],20,-373897302),U=h(U,V,q,Y,y[S+5],5,-701558691),Y=h(Y,U,V,q,y[S+10],9,38016083),q=h(q,Y,U,V,y[S+15],14,-660478335),V=h(V,q,Y,U,y[S+4],20,-405537848),U=h(U,V,q,Y,y[S+9],5,568446438),Y=h(Y,U,V,q,y[S+14],9,-1019803690),q=h(q,Y,U,V,y[S+3],14,-187363961),V=h(V,q,Y,U,y[S+8],20,1163531501),U=h(U,V,q,Y,y[S+13],5,-1444681467),Y=h(Y,U,V,q,y[S+2],9,-51403784),q=h(q,Y,U,V,y[S+7],14,1735328473),V=h(V,q,Y,U,y[S+12],20,-1926607734),U=m(U,V,q,Y,y[S+5],4,-378558),Y=m(Y,U,V,q,y[S+8],11,-2022574463),q=m(q,Y,U,V,y[S+11],16,1839030562),V=m(V,q,Y,U,y[S+14],23,-35309556),U=m(U,V,q,Y,y[S+1],4,-1530992060),Y=m(Y,U,V,q,y[S+4],11,1272893353),q=m(q,Y,U,V,y[S+7],16,-155497632),V=m(V,q,Y,U,y[S+10],23,-1094730640),U=m(U,V,q,Y,y[S+13],4,681279174),Y=m(Y,U,V,q,y[S+0],11,-358537222),q=m(q,Y,U,V,y[S+3],16,-722521979),V=m(V,q,Y,U,y[S+6],23,76029189),U=m(U,V,q,Y,y[S+9],4,-640364487),Y=m(Y,U,V,q,y[S+12],11,-421815835),q=m(q,Y,U,V,y[S+15],16,530742520),V=m(V,q,Y,U,y[S+2],23,-995338651),U=_(U,V,q,Y,y[S+0],6,-198630844),Y=_(Y,U,V,q,y[S+7],10,1126891415),q=_(q,Y,U,V,y[S+14],15,-1416354905),V=_(V,q,Y,U,y[S+5],21,-57434055),U=_(U,V,q,Y,y[S+12],6,1700485571),Y=_(Y,U,V,q,y[S+3],10,-1894986606),q=_(q,Y,U,V,y[S+10],15,-1051523),V=_(V,q,Y,U,y[S+1],21,-2054922799),U=_(U,V,q,Y,y[S+8],6,1873313359),Y=_(Y,U,V,q,y[S+15],10,-30611744),q=_(q,Y,U,V,y[S+6],15,-1560198380),V=_(V,q,Y,U,y[S+13],21,1309151649),U=_(U,V,q,Y,y[S+4],6,-145523070),Y=_(Y,U,V,q,y[S+11],10,-1120210379),q=_(q,Y,U,V,y[S+2],15,718787259),V=_(V,q,Y,U,y[S+9],21,-343485551),U=o(U,R),V=o(V,P),q=o(q,k),Y=o(Y,W);return i(U)+i(V)+i(q)+i(Y)}let spe=1,C8=console,As=class{static setLogger(e){C8=e}constructor(e,r){zt(this,"id",void 0),zt(this,"lockingPromise",lt.resolve()),zt(this,"locks",0),zt(this,"name",""),zt(this,"lockId",void 0),this.lockId=spe++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");C8.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const i=new lt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function vv(e,r){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,y=new Array(_),S=0;S<_;S++)y[S]=arguments[S];return await u.apply(this,y)}finally{m()}},c}}const gi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function bL(e,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,i)}function ud(e,r,i,o){const c=Object.assign({},gi,o);let u=c.timeout;const h=async()=>{await function(y){return new lt(S=>{window.setTimeout(S,y)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new lt(async(y,S)=>{r=r||(()=>!1),i=i||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Le(X.OPERATION_ABORTED));try{const P=await e();if(!r(P,R)||R+1===c.maxRetryCount)return y(P);await h()}catch(P){if(!i(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return _.cancel=()=>m=!0,_}let IA,I8=class{constructor(e){zt(this,"input",[]),zt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ga(e=this.input).call(e,(r,i)=>r+i)/this.input.length}},AA=0,wL=0;function RL(e,r,i,o){return new lt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),AA+=uh(r.data)):i&&(r.data.size?AA+=r.data.size:r.data instanceof FormData?AA+=v8(r.data):AA+=uh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Go.request(r).then(h=>{typeof h.data=="string"?wL+=uh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?wL+=h.data.byteLength:wL+=uh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Go.isCancel(h)?u(new Le(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Le(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Le(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Le(X.NETWORK_ERROR,h.message))})})}async function ope(e,r){const i=new Blob([r.data],{type:"buffer"});return await RL(e,ft(ft({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const A8=()=>window.isSecureContext!==void 0;function ou(e){if(Array.isArray(e))return e.map(i=>i);if(!P8(e))return e;const r={};for(const i in e){const o=e[i];P8(o)||Array.isArray(o)?r[i]=ou(o):r[i]=o}return r}function P8(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let CL=class{constructor(e){zt(this,"input",[]),zt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const dh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},lb={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:dh,remoteCandidate:dh},updateInterval:0},O8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},k8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},N8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},D8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let IL=class{constructor(e,r){zt(this,"onFirstVideoReceived",void 0),zt(this,"onFirstVideoDecoded",void 0),zt(this,"onFirstAudioReceived",void 0),zt(this,"onFirstVideoDecodedTimeout",void 0),zt(this,"onFirstAudioDecoded",void 0),zt(this,"onSelectedLocalCandidateChanged",void 0),zt(this,"onSelectedRemoteCandidateChanged",void 0),zt(this,"videoIsReady",!1),zt(this,"videoIsReady2",{}),zt(this,"pc",void 0),zt(this,"options",void 0),zt(this,"intervalTimer",void 0),zt(this,"stats",ou(lb)),zt(this,"isFirstVideoReceived",{}),zt(this,"isFirstVideoDecoded",{}),zt(this,"isFirstAudioReceived",{}),zt(this,"isFirstAudioDecoded",{}),zt(this,"isFirstVideoDecodedTimeout",{}),zt(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new lt(e=>{e({local:ft({},dh),remote:ft({},dh)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of i)e[m].forEach((_,y)=>{if(!this.lossRateWindowStats[r-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const S=this.lossRateWindowStats[r-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,R=this.lossRateWindowStats[r-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},ape=class extends IL{constructor(){super(...arguments),zt(this,"_stats",lb),zt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=ou(lb);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var i;const o=ot(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=ou(k8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=ou(O8),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:ft({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=ou(D8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=ou(N8);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new lt((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),r.push(o)}),r}},ub=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),PA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),AL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Oc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Sv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Sv||{});function db(e,r,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Sv.kNone;if(!r)return;const u=Number(r[i]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[i]);if(typeof m!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const y=h-_;return y?(u-m)/y*c:void 0}let L8=class extends IL{constructor(){super(...arguments),zt(this,"_stats",lb),zt(this,"report",void 0),zt(this,"lastDecodeVideoReceiverStats",new Map),zt(this,"lastVideoFramesRecv",new Map),zt(this,"lastVideoFramesSent",new Map),zt(this,"lastVideoFramesDecode",new Map),zt(this,"lastVideoFramesOutput",new Map),zt(this,"lastVideoJBDelay",new Map),zt(this,"lastAudioJBDelay",new Map),zt(this,"mediaBytesSent",new Map),zt(this,"mediaBytesRetransmit",new Map),zt(this,"mediaBytesTargetEncode",new Map),zt(this,"lastDecodeAudioReceiverStats",new Map),zt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ou(lb),this.report.forEach(e=>{switch(e.type){case Oc.OUTBOUND:case Oc.INBOUND:{const r=e.mediaType||e.kind,i=!r&&"frameWidth"in e,o=!r&&!("frameWidth"in e);e.type===Oc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(e):(r==="video"||i)&&this.processVideoOutboundStats(e):e.type===Oc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(e):(r==="video"||i)&&this.processVideoInboundStats(e));break}case Oc.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Oc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:ft({},dh),remote:ft({},dh)};return e.forEach(i=>{let o;if(i.type===Oc.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===Oc.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===Oc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===Oc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===Oc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ft({},r),ft({},this.stats.selectedCandidatePair.localCandidate)),e.type===Oc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ft({},r),ft({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);r||(r=ou(D8),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=db(i,r,"totalProcessingDelay","jitterBufferEmittedCount",Sv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,ft({},r))}processVideoInboundStats(e){let r=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);r||(r=ou(O8),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=db(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=db(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",Sv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=db(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Sv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=db(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",Sv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:ft({},r),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);r||(r=ou(k8),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new CL(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new CL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new CL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const o=this.findRemoteStatsId(e.ssrc,Oc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(r||(r=ou(N8),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const i=this.findRemoteStatsId(e.ssrc,Oc.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}findRemoteStatsId(e,r){var i;const o=Array.from(Ic(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,r){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,r){const i=this.report.get(e);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let y=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof S=="number"||(y=0,S=0),R==null){const P=Date.now(),k=this.lastVideoFramesSent.get(i.ssrc);k&&P-k.lts>=800?(R=Math.round((_-k.count)/((P-k.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:R})):k?R=k.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:0})}i.sentFrame={width:y,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,r,i){var o,c,u,h,m;const _=r?this.report.get(r):void 0,y=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,P=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,k=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){const W=this.lastVideoFramesRecv.get(i.ssrc),U=Date.now();i.framesReceivedCount=y;let V=0;W&&U-W.lts>=800?(V=Math.round((y-W.count)/((U-W.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:V})):W?V=W.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:0}),i.receivedFrame={width:S||0,height:R||0,frameRate:V||0},i.decodedFrame={width:S||0,height:R||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:R||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(P&&k){const W=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=W.jitterBufferMs;const V=k-W.jitterBufferEmittedCount;V>0&&(U=1e3*(P-W.jitterBufferDelay)/V),i.jitterBufferMs=U,i.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:k,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,y=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,r,i){var o,c,u,h,m,_,y;const S=r?this.report.get(r):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,W=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,U=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,V=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,q=(y=S==null?void 0:S.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples;if(typeof P=="number"&&(i.totalSamplesReceived=P),R&&P&&(i.accelerateRate=R/P),k&&W){const ce=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _e=ce.jitterBufferMs;const ye=W-ce.jitterBufferEmittedCount;ye>0&&(_e=1e3*(k-ce.jitterBufferDelay)/ye),i.jitterBufferMs=Math.round(_e),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:W,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=U;let Y=1920;V&&P&&(Y=P/V/50,i.receivedFrames=Math.round(P/Y)),q&&(i.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(e,r){const i=this.report.get(e);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},cpe=class extends IL{updateStats(){return lt.resolve()}};function PL(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new ape(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new L8(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof lt||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new L8(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new cpe(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const x8="websdk_ng_install_id";function OL(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let e=window.localStorage.getItem(x8);return e||(e=C_(),window.localStorage.setItem(x8,e)),Xn("INSTALL_ID",e),e}catch{return}}const pl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],o=r[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),kL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let I_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Ss=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ss;const OA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},NL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},DL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",LL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},mr=ft(ft(ft({},LL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:NL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},OA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Xn(e,r,i){var o,c,u;ot(o=Object.keys(mr)).call(o,e)&&(!i&&ot(c=Object.keys(dd)).call(c,e)||(mr[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(mr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(mr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,mr.USE_NEW_NETWORK_CONFIG=u,u&&(mr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],mr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],mr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],mr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],mr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",mr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",mr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(mr.ENABLE_INSTANT_VIDEO=!0,mr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(mr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(mr.NEW_TURN_MODE||(mr.NEW_TURN_MODE=4))))}function re(e){return mr[e]}kL||(mr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],mr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],mr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],mr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],mr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],mr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],mr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",mr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",mr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",mr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",mr.AREAS=["NORTH_AMERICA","OVERSEA"]);let M8=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const dd={};var gn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(gn||{});let kA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const U8=128,lpe=96,V8=1e3,Tv=10;let upe=0;var F8=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>ut,Printer:()=>Zr,parse:()=>st,print:()=>St});const h=`
`,m="".concat("\r").concat(h),_=" ";let y;function S(We){return We>="0"&&We<="9"}function R(We){return We>="!"&&We<="~"}function P(We){return R(We)||We>=""&&We<=""}function k(We){return We==="!"||We>="#"&&We<="'"||We>="*"&&We<="+"||We>="-"&&We<="."||We>="0"&&We<="9"||We>="A"&&We<="Z"||We>="^"&&We<="~"}function W(We){return We>="1"&&We<="9"}function U(We){return We>="A"&&We<="Z"||We>="a"&&We<="z"}function V(We){return We==="d"||We==="h"||We==="m"||We==="s"}function q(We){return We>""&&We<"	"||We>"\v"&&We<"\f"||We>""&&We<""}function Y(We){return U(We)||S(We)||We==="+"||We==="/"}function ce(We){return S(We)||U(We)||We==="+"||We==="/"||We==="-"||We==="_"}function _e(We){return U(We)||S(We)||We==="+"||We==="/"}function ye(We,x){var ie=Object.keys(We);if(Object.getOwnPropertySymbols){var ue=Object.getOwnPropertySymbols(We);x&&(ue=ue.filter(function(Qe){return Object.getOwnPropertyDescriptor(We,Qe).enumerable})),ie.push.apply(ie,ue)}return ie}function me(We){for(var x=1;x<arguments.length;x++){var ie=arguments[x]!=null?arguments[x]:{};x%2?ye(Object(ie),!0).forEach(function(ue){ke(We,ue,ie[ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(We,Object.getOwnPropertyDescriptors(ie)):ye(Object(ie)).forEach(function(ue){Object.defineProperty(We,ue,Object.getOwnPropertyDescriptor(ie,ue))})}return We}function ke(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}(function(We){We.VERSION="v",We.ORIGIN="o",We.SESSION_NAME="s",We.INFORMATION="i",We.URI="u",We.EMAIL="e",We.PHONE="p",We.CONNECTION="c",We.BANDWIDTH="b",We.TIME="t",We.REPEAT="r",We.ZONE_ADJUSTMENTS="z",We.KEY="k",We.ATTRIBUTE="a",We.MEDIA="m"})(y||(y={}));class Ye{consumeText(x,ie){let ue=ie;for(;ue<x.length;){const Qe=x[ue];if(Qe==="\0"||Qe==="\r"||Qe===h)break;ue+=1}if(ue-ie==0)throw new Error("Invalid text, at ".concat(x));return ue}consumeUnicastAddress(x,ie,ue){return this.consumeTill(x,ie,_)}consumeOneOrMore(x,ie,ue){let Qe=ie;for(;ue(x[Qe]);)Qe++;if(Qe-ie==0)throw new Error("Invalid rule at ".concat(ie,"."));return Qe}consumeSpace(x,ie){if(x[ie]===_)return ie+1;throw new Error("Invalid space at ".concat(ie,"."))}consumeIP4Address(x,ie){let ue=ie;for(let Qe=0;Qe<4;Qe++)if(ue=this.consumeDecimalUChar(x,ue),Qe!==3){if(x[ue]!==".")throw new Error("Invalid IP4 address.");ue++}return ue}consumeDecimalUChar(x,ie){let ue=ie;for(let Ht=0;Ht<3&&S(x[ue]);Ht++,ue++);if(ue-ie==0)throw new Error("Invalid decimal uchar.");const Qe=parseInt(x.slice(ie,ue));if(Qe>=0&&Qe<=255)return ue;throw new Error("Invalid decimal uchar")}consumeIP6Address(x,ie){let ue=this.consumeHexpart(x,ie);return x[ue]===":"&&(ue+=1,ue=this.consumeIP4Address(x,ue)),ue}consumeHexpart(x,ie){let ue=ie;if(x[ue]===":"&&x[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(x,ue)}catch{}return ue}if(ue=this.consumeHexseq(x,ue),x[ue]===":"&&x[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(x,ue)}catch{}return ue}return ue}consumeHexseq(x,ie){let ue=ie;for(;ue=this.consumeHex4(x,ue),x[ue]===":"&&x[ue+1]!==":";)ue+=1;return ue}consumeHex4(x,ie){let ue=0;for(;ue<4;ue++)if(!((Qe=x[ie+ue])>="0"&&Qe<="9"||Qe>="a"&&Qe<="f"||Qe>="A"&&Qe<="F")){if(ue===0)throw new Error("Invalid hex 4");break}var Qe;return ie+ue}consumeFQDN(x,ie){let ue=ie;for(;S(x[ue])||U(x[ue])||x[ue]==="-"||x[ue]===".";)ue+=1;if(ue-ie<4)throw new Error("Invalid FQDN");return ue}consumeExtnAddr(x,ie){return this.consumeOneOrMore(x,ie,P)}consumeMulticastAddress(x,ie,ue){switch(ue){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(x,ie);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(x,ie);default:try{return this.consumeFQDN(x,ie)}catch{return this.consumeExtnAddr(x,ie)}}}consumeIP6MulticastAddress(x,ie){const ue=this.consumeHexpart(x,ie);return x[ue]==="/"?this.consumeInteger(x,ue+1):ue}consumeIP4MulticastAddress(x,ie){let ue=ie+3;const Qe=x.slice(ie,ue),Ht=parseInt(Qe);if(Ht<224||Ht>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let tr=0;tr<3;tr++){if(x[ue]!==".")throw new Error("Invalid IP4 multicast address.");ue+=1,ue=this.consumeDecimalUChar(x,ue)}return x[ue]==="/"&&(ue+=1),ue=this.consumeTTL(x,ue),x[ue]==="/"&&(ue=this.consumeInteger(x,ue)),ue}consumeInteger(x,ie){if(!W(x[ie]))throw new Error("Invalid integer.");for(ie+=1;S(x[ie]);)ie+=1;return ie}consumeTTL(x,ie){if(x[ie]==="0")return ie+1;if(!W(x[ie]))throw new Error("Invalid TTL.");ie+=1;for(let ue=0;ue<2&&S(x[ie]);ue++)ie+=1;return ie}consumeToken(x,ie){return this.consumeOneOrMore(x,ie,k)}consumeTime(x,ie){let ue=ie;if(x[ue]==="0")return ue+1;for(W(x[ue])&&(ue+=1);S(x[ue]);)ue++;if(ue-ie<10)throw new Error("Invalid time");return ue}consumeAddress(x,ie){return this.consumeTill(x,ie,_)}consumeTypedTime(x,ie){let ue=ie;return ue=this.consumeOneOrMore(x,ue,S),V(x[ue])?ue+1:ue}consumeRepeatInterval(x,ie){if(!W(x[ie]))throw new Error("Invalid repeat interval");for(ie+=1;S(x[ie]);)ie+=1;return V(x[ie])&&(ie+=1),ie}consumePort(x,ie){return this.consumeOneOrMore(x,ie,S)}consume(x,ie,ue){for(let Qe=0;Qe<ue.length;Qe++){if(ie+Qe>=x.length)throw new Error("consume exceeding value length");if(x[ie+Qe]!==ue[Qe])throw new Error("consume ".concat(ue," failed at ").concat(Qe))}return ie+ue.length}consumeTill(x,ie,ue){let Qe=ie;for(;Qe<x.length&&(typeof ue!="string"||x[Qe]!==ue)&&(typeof ue!="function"||!ue(x[Qe]));)Qe++;return Qe}}class ut extends Ye{constructor(){super(),ke(this,"records",[]),ke(this,"currentLine",0)}parse(x){const ie=this.probeEOL(x);this.records=x.split(ie).filter(J_=>!!Js(J_).call(J_)).map(this.parseLine),this.currentLine=0;const ue=this.parseVersion(),Qe=this.parseOrigin(),Ht=this.parseSessionName(),tr=this.parseInformation(),Vi=this.parseUri(),ba=this.parseEmail(),Zp=this.parsePhone(),X_=this.parseConnection(),qb=this.parseBandWidth(),WP=this.parseTimeFields(),zP=this.parseKey(),Sl=this.parseSessionAttribute(),jm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ue,origin:Qe,sessionName:Ht,information:tr,uri:Vi,emails:ba,phones:Zp,connection:X_,bandwidths:qb,timeFields:WP,key:zP,attributes:Sl,mediaDescriptions:jm}}getCurrentRecord(){const x=this.records[this.currentLine];if(!x)throw new Error("Record doesn't exit.");return x}probeEOL(x){for(let ie=0;ie<x.length;ie++)if(x[ie]===h)return x[ie-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(x,ie){if(x.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ue=x[0];if(x[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ue,value:x.slice(2),line:ie,cur:0}}parseSessionAttribute(){const x=new yn;for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(ie,Qe=>k(Qe)&&Qe!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,ue.attValue=this.extractOneOrMore(ie,q)),x.parse(ue),this.currentLine++}return x.digest()}parseMediaAttributes(x){const ie=new vn(x);for(;this.currentLine<this.records.length;){const ue=this.getCurrentRecord();if(ue.type!==y.ATTRIBUTE)break;const Qe={attField:this.extractOneOrMore(ue,Ht=>k(Ht)&&Ht!==":"),_cur:0};ue.value[ue.cur]===":"&&(ue.cur+=1,Qe.attValue=this.extractOneOrMore(ue,q)),ie.parse(Qe),this.currentLine++}return ie.digest()}parseKey(){const x=this.getCurrentRecord();if(x.type===y.KEY){if(x.value==="prompt"||x.value==="clear:"||x.value==="base64:"||x.value==="uri:")return x.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const x=this.getCurrentRecord();if(x.type===y.ZONE_ADJUSTMENTS){const ie=[];for(;;)try{const ue=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);let Qe=!1;x.value[x.cur]==="-"&&(Qe=!0,x.cur+=1);const Ht=this.extract(x,this.consumeTypedTime);ie.push({time:ue,typedTime:Ht,back:Qe})}catch{break}if(ie.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ie}return[]}parseRepeat(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.REPEAT)break;{const ue=this.extract(ie,this.consumeRepeatInterval),Qe=this.parseTypedTime(ie);x.push({repeatInterval:ue,typedTimes:Qe}),this.currentLine++}}return x}parseTypedTime(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeTypedTime))}catch{break}if(ie.length===0)throw new Error("Invalid typed time.");return ie}parseTime(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);const ue=this.extract(x,this.consumeTime);return this.currentLine++,{startTime:ie,stopTime:ue}}parseBandWidth(){const x=[];for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.BANDWIDTH)break;{const ue=this.extractOneOrMore(ie,k);if(ie.value[ie.cur]!==":")throw new Error("Invalid bandwidth field.");ie.cur++;const Qe=this.extractOneOrMore(ie,S);x.push({bwtype:ue,bandwidth:Qe}),this.currentLine++}}return x}parseVersion(){const x=this.getCurrentRecord();if(x.type!==y.VERSION)throw new Error("first sdp record must be version");const ie=x.value.slice(0,this.consumeOneOrMore(x.value,0,S));if(ie.length!==x.value.length)throw new Error('invalid proto version, "v='.concat(x.value,'"'));return this.currentLine++,ie}parseOrigin(){const x=this.getCurrentRecord();if(x.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const ie=this.extractOneOrMore(x,P);this.consumeSpaceForRecord(x);const ue=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Qe=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Ht=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const tr=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Vi=this.extract(x,this.consumeUnicastAddress);return this.currentLine++,{username:ie,sessId:ue,sessVersion:Qe,nettype:Ht,addrtype:tr,unicastAddress:Vi}}parseSessionName(){const x=this.getCurrentRecord();if(x.type===y.SESSION_NAME){const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}}parseInformation(){const x=this.getCurrentRecord();if(x.type!==y.INFORMATION)return;const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}parseUri(){const x=this.getCurrentRecord();if(x.type===y.URI)return this.currentLine++,x.value}parseEmail(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.EMAIL)break;x.push(ie.value),this.currentLine++}return x}parsePhone(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.PHONE)break;x.push(ie.value),this.currentLine++}return x}parseConnection(){const x=this.getCurrentRecord();if(x.type===y.CONNECTION){const ie=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const ue=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Qe=this.extract(x,this.consumeAddress);return this.currentLine++,{nettype:ie,addrtype:ue,address:Qe}}}parseMedia(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeToken);this.consumeSpaceForRecord(x);let ue=this.extract(x,this.consumePort);x.value[x.cur]==="/"&&(x.cur+=1,ue+=this.extract(x,this.consumeInteger)),this.consumeSpaceForRecord(x);const Qe=[];for(Qe.push(this.extract(x,this.consumeToken));x.value[x.cur]==="/";)x.cur+=1,Qe.push(this.extract(x,this.consumeToken));if(Qe.length===0)throw new Error("Invalid proto");const Ht=this.parseFmt(x);return this.currentLine++,{mediaType:ie,port:ue,protos:Qe,fmts:Ht}}parseTimeFields(){const x=[];for(;this.getCurrentRecord().type===y.TIME;){const ie=this.parseTime(),ue=this.parseRepeat(),Qe=this.parseZone();x.push({time:ie,repeats:ue,zones:Qe})}return x}parseMediaDescription(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const ie=this.parseMedia(),ue=this.parseInformation(),Qe=this.parseConnections(),Ht=this.parseBandWidth(),tr=this.parseKey(),Vi=this.parseMediaAttributes(ie);x.push({media:ie,information:ue,connections:Qe,bandwidths:Ht,key:tr,attributes:Vi})}return x}parseConnections(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)x.push(this.parseConnection());return x}parseFmt(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeToken))}catch{break}if(ie.length===0)throw new Error("Invalid fmts");return ie}extract(x,ie){for(var ue=arguments.length,Qe=new Array(ue>2?ue-2:0),Ht=2;Ht<ue;Ht++)Qe[Ht-2]=arguments[Ht];const tr=ie.call(this,x.value,x.cur,...Qe),Vi=x.value.slice(x.cur,tr);return x.cur=tr,Vi}extractOneOrMore(x,ie){const ue=this.consumeOneOrMore(x.value,x.cur,ie),Qe=x.value.slice(x.cur,ue);return x.cur=ue,Qe}consumeSpaceForRecord(x){if(x.value[x.cur]!==_)throw new Error("Invalid space at ".concat(x.cur,"."));x.cur+=1}}class pt extends Ye{constructor(){super(...arguments),ke(this,"attributes",void 0),ke(this,"digested",!1)}extractOneOrMore(x,ie,ue){const Qe=this.consumeOneOrMore(x.attValue,x._cur,ie),Ht=x.attValue.slice(x._cur,Qe),[tr,Vi]=ue||[];if(typeof tr=="number"&&Ht.length<tr)throw new Error("error in length, should be more or equal than ".concat(tr," characters."));if(typeof Vi=="number"&&Ht.length>Vi)throw new Error("error in length, should be less or equal than ".concat(Vi," characters."));return x._cur=Qe,Ht}consumeAttributeSpace(x){if(x.attValue[x._cur]!==_)throw new Error("Invalid space at ".concat(x._cur,"."));x._cur+=1}extract(x,ie){if(!x.attValue)throw new Error("Nothing to extract from attValue.");for(var ue=arguments.length,Qe=new Array(ue>2?ue-2:0),Ht=2;Ht<ue;Ht++)Qe[Ht-2]=arguments[Ht];const tr=ie.call(this,x.attValue,x._cur,...Qe),Vi=x.attValue.slice(x._cur,tr);return x._cur=tr,Vi}atEnd(x){if(!x.attValue)throw new Error;return x._cur>=x.attValue.length}peekChar(x){if(!x.attValue)throw new Error;return x.attValue[x._cur]}peek(x,ie){if(!x.attValue)throw new Error;for(let ue=0;ue<ie.length;ue++)if(ie[ue]!==x.attValue[x._cur+ue])return!1;return!0}parseIceUfrag(x){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(x,Y,[4,256])}parseIcePwd(x){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(x,Y,[22,256])}parseIceOptions(x){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ie=[];for(;!this.atEnd(x);){ie.push(this.extractOneOrMore(x,Y));try{this.consumeAttributeSpace(x)}catch(ue){if(this.atEnd(x))break;throw ue}}this.attributes.iceOptions=ie}parseFingerprint(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ie,fingerprint:ue})}parseExtmap(x){const ie=this.extractOneOrMore(x,S);let ue;this.peekChar(x)==="/"&&(this.extract(x,this.consume,"/"),ue=this.extract(x,this.consumeToken)),this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeTill,_),Ht=me(me({entry:parseInt(ie,10)},ue&&{direction:ue}),{},{extensionName:Qe});this.peekChar(x)===_&&(this.consumeAttributeSpace(x),Ht.extensionAttributes=this.extract(x,this.consumeTill)),this.attributes.extmaps.push(Ht)}parseSetup(x){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ie=this.extract(x,this.consumeTill);if(ie!=="active"&&ie!=="passive"&&ie!=="actpass"&&ie!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ie}}class yn extends pt{constructor(){super(...arguments),ke(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"group":this.parseGroup(x);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"fingerprint":this.parseFingerprint(x);break;case"setup":this.parseSetup(x);break;case"tls-id":this.parseTlsId(x);break;case"identity":this.parseIdentity(x);break;case"extmap":this.parseExtmap(x);break;case"msid-semantic":this.parseMsidSemantic(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing session attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(x){const ie=this.extract(x,this.consumeToken),ue=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;)this.consumeAttributeSpace(x),ue.push(this.extract(x,this.consumeToken));this.attributes.groups.push({semantic:ie,identificationTag:ue})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(x){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(x,ce)}parseIdentity(x){const ie=this.extractOneOrMore(x,_e),ue=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeToken);this.extract(x,this.consume,"=");const Ht=this.extractOneOrMore(x,tr=>tr!==_&&q(tr));ue.push({name:Qe,value:Ht})}this.attributes.identities.push({assertionValue:ie,extensions:ue})}parseMsidSemantic(x){this.peekChar(x)===_&&this.consumeAttributeSpace(x);const ie={semantic:this.extract(x,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(x)}catch{break}if(this.peekChar(x)==="*"){this.extract(x,this.consume,"*"),ie.applyForAll=!0;break}{const ue=this.extract(x,this.consumeTill,_);ie.identifierList.push(ue)}}this.attributes.msidSemantic=ie}}class vn extends pt{constructor(x){super(),ke(this,"attributes",void 0),x.protos.indexOf("RTP")!==-1||x.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"extmap":this.parseExtmap(x);break;case"setup":this.parseSetup(x);break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"candidate":this.parseCandidate(x);break;case"remote-candidate":this.parseRemoteCandidate(x);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(x);break;case"rtpmap":this.parseRtpmap(x);break;case"ptime":this.parsePtime(x);break;case"maxptime":this.parseMaxPtime(x);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(x);break;case"ssrc":this.parseSSRC(x);break;case"fmtp":this.parseFmtp(x);break;case"rtcp-fb":this.parseRtcpFb(x);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(x);break;case"mid":this.parseMid(x);break;case"msid":this.parseMsid(x);break;case"imageattr":this.parseImageAttr(x);break;case"rid":this.parseRid(x);break;case"simulcast":this.parseSimulcast(x);break;case"sctp-port":this.parseSctpPort(x);break;case"max-message-size":this.parseMaxMessageSize(x);break;case"ssrc-group":this.parseSSRCGroup(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing media attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}parseCandidate(x){const ie=this.extractOneOrMore(x,Y,[1,32]);this.consumeAttributeSpace(x);const ue=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const Ht=this.extractOneOrMore(x,S,[1,10]);this.consumeAttributeSpace(x);const tr=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const Vi=this.extract(x,this.consumePort);this.consumeAttributeSpace(x),this.extract(x,this.consume,"typ"),this.consumeAttributeSpace(x);const ba={foundation:ie,componentId:ue,transport:Qe,priority:Ht,connectionAddress:tr,port:Vi,type:this.extract(x,this.consumeToken),extension:{}};for(this.peek(x," raddr")&&(this.extract(x,this.consume," raddr"),this.consumeAttributeSpace(x),ba.relAddr=this.extract(x,this.consumeAddress)),this.peek(x," rport")&&(this.extract(x,this.consume," rport"),this.consumeAttributeSpace(x),ba.relPort=this.extract(x,this.consumePort));this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Zp=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x),ba.extension[Zp]=this.extractOneOrMore(x,R)}this.attributes.candidates.push(ba)}parseRemoteCandidate(x){const ie=[];for(;;){const ue=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const Ht=this.extract(x,this.consumePort);ie.push({componentId:ue,connectionAddress:Qe,port:Ht});try{this.consumeAttributeSpace(x)}catch{break}}this.attributes.remoteCandidatesList.push(ie)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,"/");this.extract(x,this.consume,"/");const Qe={encodingName:ue,clockRate:this.extractOneOrMore(x,S)};this.atEnd(x)||this.peekChar(x)!=="/"||(this.extract(x,this.consume,"/"),Qe.encodingParameters=parseInt(this.extract(x,this.consumeTill),10));const Ht=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Ht?Ht.rtpMap=Qe:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtpMap:Qe,rtcpFeedbacks:[]})}parsePtime(x){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(x,this.consumeTill)}parseMaxPtime(x){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(x,this.consumeTill)}parseDirection(x){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=x.attField}parseSSRC(x){const ie=this.extractOneOrMore(x,S);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,":");let Qe;this.peekChar(x)===":"&&(this.extract(x,this.consume,":"),Qe=this.extract(x,this.consumeTill));const Ht=this.attributes.ssrcs.find(tr=>tr.ssrcId===parseInt(ie,10));Ht?Ht.attributes[ue]=Qe:this.attributes.ssrcs.push({ssrcId:parseInt(ie,10),attributes:{[ue]:Qe}})}parseFmtp(x){const ie=this.extract(x,this.consumeTill,_);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill),Qe={};ue.split(";").forEach(tr=>{let[Vi,ba]=tr.split("=");Vi=Js(Vi).call(Vi);const Zp=typeof ba=="string"?Js(ba).call(ba):null;typeof Vi=="string"&&Vi.length>0&&(Qe[Vi]=Zp)});const Ht=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Ht?Ht.fmtp={parameters:Qe}:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[],fmtp:{parameters:Qe}})}parseFmtParameters(x){const ie={},ue=this.extract(x,this.consumeTill,"=");x._cur++;const Qe=this.extract(x,this.consumeTill,";");for(ie[ue]=Qe;x.attValue[x._cur]===";";){const Ht=this.extract(x,this.consumeTill,"=");x._cur++;const tr=this.extract(x,this.consumeTill,";");ie[Ht]=tr}return ie}parseRtcpFb(x){let ie="";ie=this.peekChar(x)==="*"?this.extract(x,this.consume,"*"):this.extract(x,this.consumeTill,_),this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,_);let Qe;if(ue==="trr-int")Qe={type:ue,interval:this.extract(x,this.consumeTill)};else{const Ht={type:ue};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),Ht.parameter=this.extract(x,this.consumeToken),this.peekChar(x)===_&&(Ht.additional=this.extract(x,this.consumeTill))),Qe=Ht}if(ie==="*")this.attributes.rtcpFeedbackWildcards.push(Qe);else{const Ht=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Ht?Ht.rtcpFeedbacks.push(Qe):this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[Qe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(x){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ie={port:this.extract(x,this.consumePort)};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.netType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.addressType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.address=this.extract(x,this.consumeAddress)),this.attributes.rtcp=ie}parseMsid(x){const ie={id:this.extractOneOrMore(x,k,[1,64])};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.appdata=this.extractOneOrMore(x,k,[1,64])),this.attributes.msids.push(ie)}parseImageAttr(x){this.attributes.imageattr.push(x.attValue)}parseRid(x){const ie=this.extractOneOrMore(x,Qe=>U(Qe)||S(Qe)||Qe==="_"||Qe==="-");this.consumeAttributeSpace(x);const ue={id:ie,direction:this.extract(x,this.consumeToken),params:[]};if(this.peekChar(x)===_){if(this.consumeAttributeSpace(x),this.peek(x,"pt=")){this.extract(x,this.consume,"pt=");const Qe=[];for(;;){const Ht=this.extract(x,this.consumeToken);Qe.push(Ht);try{this.extract(x,this.consume,",")}catch{break}}ue.payloads=Qe,this.peekChar(x)===_&&this.extract(x,this.consume,_)}for(;;){const Qe=this.extract(x,this.consumeToken);switch(Qe){case"depend":{const Ht={type:Qe,rids:this.extract(x,this.consume,"=").split(",")};ue.params.push(Ht);break}default:{const Ht={type:Qe};this.peekChar(x)==="="&&(this.extract(x,this.consume,"="),Ht.val=this.extract(x,this.consumeTill,";")),ue.params.push(Ht)}}try{this.extract(x,this.consume,";")}catch{break}}}this.attributes.rids.push(ue)}parseSimulcast(x){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=x.attValue,this.extract(x,this.consumeTill)}parseSctpPort(x){this.attributes.sctpPort=this.extractOneOrMore(x,S,[1,5])}parseMaxMessageSize(x){this.attributes.maxMessageSize=this.extractOneOrMore(x,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(x){this.attributes.mid=this.extract(x,this.consumeToken)}parseSSRCGroup(x){const ie=this.extract(x,this.consumeToken),ue=[];for(;;)try{this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeInteger);ue.push(parseInt(Qe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ie,ssrcIds:ue})}}function cr(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}class Zr{constructor(){cr(this,"eol",m)}print(x,ie){let ue="";return ie&&(this.eol=ie),ue+=this.printVersion(x.version),ue+=this.printOrigin(x.origin),ue+=this.printSessionName(x.sessionName),ue+=this.printInformation(x.information),ue+=this.printUri(x.uri),ue+=this.printEmail(x.emails),ue+=this.printPhone(x.phones),ue+=this.printConnection(x.connection),ue+=this.printBandwidth(x.bandwidths),ue+=this.printTimeFields(x.timeFields),ue+=this.printKey(x.key),ue+=this.printSessionAttributes(x.attributes),ue+=this.printMediaDescription(x.mediaDescriptions),ue}printVersion(x){return"v=".concat(x).concat(this.eol)}printOrigin(x){return"o=".concat(x.username," ").concat(x.sessId," ").concat(x.sessVersion," ").concat(x.nettype," ").concat(x.addrtype," ").concat(x.unicastAddress).concat(this.eol)}printSessionName(x){return x?"s=".concat(x).concat(this.eol):""}printInformation(x){return x?"i=".concat(x).concat(this.eol):""}printUri(x){return x?"u=".concat(x).concat(this.eol):""}printEmail(x){let ie="";for(const ue of x)ie+="e=".concat(ue).concat(this.eol);return ie}printPhone(x){let ie="";for(const ue of x)ie+="e=".concat(ue).concat(this.eol);return ie}printConnection(x){return x?"c=".concat(x.nettype," ").concat(x.addrtype," ").concat(x.address).concat(this.eol):""}printBandwidth(x){let ie="";for(const ue of x)ie+="b=".concat(ue.bwtype,":").concat(ue.bandwidth).concat(this.eol);return ie}printTimeFields(x){let ie="";for(const ue of x){ie+="t=".concat(ue.time.startTime," ").concat(ue.time.startTime).concat(this.eol);for(const Qe of ue.repeats)ie+="r=".concat(Qe.repeatInterval," ").concat(Qe.typedTimes.join(" ")).concat(this.eol);ue.zoneAdjustments&&(ie+="z=",ie+="z=".concat(ue.zoneAdjustments.map(Qe=>"".concat(Qe.time," ").concat(Qe.back?"-":""," ").concat(Qe.typedTime)).join(" ")).concat(this.eol),ie+=this.eol)}return ie}printKey(x){return x?"k=".concat(x).concat(this.eol):""}printAttributes(x){let ie="";for(const ue of x)ie+="a=".concat(ue.attField).concat(ue.attValue?":".concat(ue.attValue):"").concat(this.eol);return ie}printMediaDescription(x){let ie="";for(const ue of x)ie+=this.printMedia(ue.media),ie+=this.printInformation(ue.information),ie+=this.printConnections(ue.connections),ie+=this.printBandwidth(ue.bandwidths),ie+=this.printKey(ue.key),ie+=this.printMediaAttributes(ue);return ie}printConnections(x){let ie="";for(const ue of x)ie+=this.printConnection(ue);return ie}printMedia(x){return"m=".concat(x.mediaType," ").concat(x.port," ").concat(x.protos.join("/")," ").concat(x.fmts.join(" ")).concat(this.eol)}printSessionAttributes(x){return new Xo(this.eol).print(x)}printMediaAttributes(x){return new je(this.eol).print(x)}}class Wr{constructor(x){cr(this,"eol",void 0),this.eol=x}printIceUfrag(x){return x===void 0?"":"a=ice-ufrag:".concat(x).concat(this.eol)}printIcePwd(x){return x===void 0?"":"a=ice-pwd:".concat(x).concat(this.eol)}printIceOptions(x){return x===void 0?"":"a=ice-options:".concat(x.join(_)).concat(this.eol)}printFingerprints(x){return x.length>0?x.map(ie=>"a=fingerprint:".concat(ie.hashFunction).concat(_).concat(ie.fingerprint)).join(this.eol)+this.eol:""}printExtmap(x){return x.map(ie=>"a=extmap:".concat(ie.entry).concat(ie.direction?"/".concat(ie.direction):"").concat(_).concat(ie.extensionName).concat(ie.extensionAttributes?"".concat(_).concat(ie.extensionAttributes):"").concat(this.eol)).join("")}printSetup(x){return x===void 0?"":"a=setup:".concat(x).concat(this.eol)}printUnrecognized(x){return x.map(ie=>"a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol)).join("")}}class Xo extends Wr{print(x){let ie="";return ie+=this.printGroups(x.groups),ie+=this.printMsidSemantic(x.msidSemantic),ie+=this.printIceLite(x.iceLite),ie+=this.printIceUfrag(x.iceUfrag),ie+=this.printIcePwd(x.icePwd),ie+=this.printIceOptions(x.iceOptions),ie+=this.printFingerprints(x.fingerprints),ie+=this.printSetup(x.setup),ie+=this.printTlsId(x.tlsId),ie+=this.printIdentity(x.identities),ie+=this.printExtmap(x.extmaps),ie+=this.printUnrecognized(x.unrecognized),ie}printGroups(x){let ie="";return x.length>0&&(ie+=x.map(ue=>"a=group:".concat(ue.semantic).concat(ue.identificationTag.map(Qe=>"".concat(_).concat(Qe)).join("")).concat(this.eol)).join("")),ie}printIceLite(x){return x===void 0?"":"a=ice-lite"+this.eol}printTlsId(x){return x?"a=tls-id:".concat(x).concat(this.eol):""}printIdentity(x){return x.length===0?"":x.map(ie=>"a=identity:".concat(ie.assertionValue).concat(ie.extensions.map(ue=>"".concat(_).concat(ue.name).concat(ue.value?"=".concat(ue.value):"")))).join(this.eol)+this.eol}printMsidSemantic(x){if(!x)return"";let ie="a=msid-semantic:".concat(x.semantic);return x.applyForAll?ie+="".concat(_,"*"):x.identifierList.length>0&&(ie+=x.identifierList.map(ue=>"".concat(_).concat(ue))),ie+this.eol}}class je extends Wr{print(x){const ie=x.attributes;let ue="";return ue+=this.printRTCP(ie.rtcp),ue+=this.printIceUfrag(ie.iceUfrag),ue+=this.printIcePwd(ie.icePwd),ue+=this.printIceOptions(ie.iceOptions),ue+=this.printCandidates(ie.candidates),ue+=this.printRemoteCandidatesList(ie.remoteCandidatesList),ue+=this.printEndOfCandidates(ie.endOfCandidates),ue+=this.printFingerprints(ie.fingerprints),ue+=this.printSetup(ie.setup),ue+=this.printMid(ie.mid),ue+=this.printExtmap(ie.extmaps),ue+=this.printRTPRelated(ie),ue+=this.printPtime(ie.ptime),ue+=this.printMaxPtime(ie.maxPtime),ue+=this.printDirection(ie.direction),ue+=this.printSSRCGroups(ie.ssrcGroups),ue+=this.printSSRC(ie.ssrcs),ue+=this.printRTCPMux(ie.rtcpMux),ue+=this.printRTCPMuxOnly(ie.rtcpMuxOnly),ue+=this.printRTCPRsize(ie.rtcpRsize),ue+=this.printMSId(ie.msids),ue+=this.printImageattr(ie.imageattr),ue+=this.printRid(ie.rids),ue+=this.printSimulcast(ie.simulcast),ue+=this.printSCTPPort(ie.sctpPort),ue+=this.printMaxMessageSize(ie.maxMessageSize),ue+=this.printUnrecognized(ie.unrecognized),ue}printCandidates(x){return x.map(ie=>"a=candidate:".concat(ie.foundation).concat(_).concat(ie.componentId).concat(_).concat(ie.transport).concat(_).concat(ie.priority).concat(_).concat(ie.connectionAddress).concat(_).concat(ie.port).concat(_,"typ").concat(_).concat(ie.type).concat(ie.relAddr?"".concat(_,"raddr").concat(_).concat(ie.relAddr):"").concat(ie.relPort?"".concat(_,"rport").concat(_).concat(ie.relPort):"").concat(Object.keys(ie.extension).map(ue=>"".concat(_).concat(ue).concat(_).concat(ie.extension[ue])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(x){return x.map(ie=>"a=remote-candidates:".concat(ie.join(_)).concat(this.eol)).join("")}printEndOfCandidates(x){return x===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(x){if(!x.payloads)return"";const ie=x.payloads;let ue="";ue+=x.rtcpFeedbackWildcards.map(Qe=>this.printRTCPFeedback("*",Qe)).join("");for(const Qe of ie)ue+=this.printRtpMap(Qe.payloadType,Qe.rtpMap),ue+=this.printFmtp(Qe.payloadType,Qe.fmtp),ue+=Qe.rtcpFeedbacks.map(Ht=>this.printRTCPFeedback(Qe.payloadType,Ht)).join("");return ue}printFmtp(x,ie){if(!ie)return"";const ue=Object.keys(ie.parameters);return ue.length===1&&ie.parameters[ue[0]]===null?"a=fmtp:".concat(x).concat(_).concat(ue[0]).concat(this.eol):"a=fmtp:".concat(x).concat(_).concat(Object.keys(ie.parameters).map(Qe=>"".concat(Qe,"=").concat(ie.parameters[Qe])).join(";")).concat(this.eol)}printRtpMap(x,ie){return ie?"a=rtpmap:".concat(x).concat(_).concat(ie.encodingName,"/").concat(ie.clockRate).concat(ie.encodingParameters?"/".concat(ie.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(x,ie){let ue="a=rtcp-fb:".concat(x).concat(_),Qe=ie;return Qe.type==="trr-int"?ue+="ttr-int".concat(_).concat(Qe.interval):(ue+="".concat(Qe.type),Qe.parameter&&(ue+="".concat(_).concat(Qe.parameter),Qe.additional&&(ue+="".concat(_).concat(Qe.additional)))),ue+this.eol}printPtime(x){return x===void 0?"":"a=ptime:".concat(x).concat(this.eol)}printMaxPtime(x){return x===void 0?"":"a=maxptime:".concat(x).concat(this.eol)}printDirection(x){return x===void 0?"":"a=".concat(x).concat(this.eol)}printSSRC(x){return x.map(ie=>Object.keys(ie.attributes).map(ue=>"a=ssrc:".concat(ie.ssrcId.toString(10)).concat(_).concat(ue).concat(ie.attributes[ue]?":".concat(ie.attributes[ue]):"").concat(this.eol)).join("")).join("")}printRTCPMux(x){return x===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(x){return x===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(x){return x===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(x){if(x===void 0)return"";let ie="a=rtcp:".concat(x.port);return x.netType&&(ie+="".concat(_).concat(x.netType)),x.addressType&&(ie+="".concat(_).concat(x.addressType)),x.address&&(ie+="".concat(_).concat(x.address)),ie+this.eol}printMSId(x){return x.map(ie=>"a=msid:".concat(ie.id).concat(ie.appdata?"".concat(_).concat(ie.appdata):"").concat(this.eol)).join("")}printImageattr(x){return x.map(ie=>"a=imageattr:".concat(ie).concat(this.eol)).join("")}printRid(x){return x.map(ie=>{let ue="a=rid:".concat(ie.id).concat(_).concat(ie.direction);return ie.payloads&&(ue+="".concat(_,"pt=").concat(ie.payloads.join(","))),ie.params.length>0&&(ue+="".concat(_).concat(ie.params.map(Qe=>Qe.type==="depend"?"depend=".concat(Qe.rids.join(",")):"".concat(Qe.type,"=").concat(Qe.val)).join(";"))),ue+this.eol}).join("")}printSimulcast(x){return x===void 0?"":"a=simulcast:".concat(x).concat(this.eol)}printSCTPPort(x){return x===void 0?"":"a=sctp-port:".concat(x).concat(this.eol)}printMaxMessageSize(x){return x===void 0?"":"a=max-message-size:".concat(x).concat(this.eol)}printMid(x){return x===void 0?"":"a=mid:".concat(x).concat(this.eol)}printSSRCGroups(x){return x.map(ie=>"a=ssrc-group:".concat(ie.semantic).concat(ie.ssrcIds.map(ue=>"".concat(_).concat(ue.toString(10))).join("")).concat(this.eol)).join("")}}function st(We){return new ut().parse(We)}function St(We,x){return new Zr().print(We,x)}}},r={};function i(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function ya(e){return F8.parse(e)}function bm(e,r){return F8.print(e,r)}var dpe=za("Array").keys,hpe=gc,ppe=hi,fpe=N,mpe=dpe,xL=Array.prototype,gpe={DOMTokenList:!0,NodeList:!0},_pe=function(e){var r=e.keys;return e===xL||fpe(xL,e)&&r===xL.keys||ppe(gpe,hpe(e))?mpe:r},kc=l(_pe);function j8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function nn(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?j8(Object(i),!0).forEach(function(o){Ur(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):j8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Ur(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}const B8=new class extends Ar{constructor(){super(...arguments),Ur(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Epe{constructor(r){Ur(this,"logger",void 0),Ur(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function ML(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function W8(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const fl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},NA=Date.now(),hb=e=>{for(const r in fl)if(Object.prototype.hasOwnProperty.call(fl,r)&&fl[r]===e)return r;return"DEFAULT"},D=new class{constructor(){Ur(this,"proxyServerURL",void 0),Ur(this,"logLevel",fl.DEBUG),Ur(this,"uploadState","collecting"),Ur(this,"uploadLogWaitingList",[]),Ur(this,"uploadLogUploadingList",[]),Ur(this,"uploadErrorCount",0),Ur(this,"currentLogID",0),Ur(this,"url",void 0),Ur(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[fl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[fl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[fl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[fl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[fl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Xn("UPLOAD_LOG",!0)}disableLogUpload(){Xn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Epe(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-NA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-NA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=ML()+" Agora-SDK [".concat(hb(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=ML()+" %cAgora-SDK [".concat(hb(o),"]:");let u=[];if(!re("USE_NEW_LOG"))switch(o){case fl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case fl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case fl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case fl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-NA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-NA);const o=Math.max(0,Math.min(4,r[0]));r[0]=ML()+" Agora-SDK [".concat(hb(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!re("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=W8()+" Agora-SDK [".concat(hb(e),"]:"):i[0]=W8()+" Agora-SDK [".concat(hb(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:pl,process_id:re("PROCESS_ID"),payload:JSON.stringify(e)};return ud(async()=>{const i=await Go.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),B8.reportLogUploadError(o),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var z8;function ype(e){return rs(e.reportId,"params.reportId",0,100,!1),rs(e.category,"params.category",0,100,!1),rs(e.event,"params.event",0,100,!1),rs(e.label,"params.label",0,100,!1),er(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(z8={}).FREE="free",z8.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const vpe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Mi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),wr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Spe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Mt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),y=0;y<m;y++)_[y]=arguments[y];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(P){D.warning(P),S=[]}try{JSON.stringify(S)}catch{D.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const R=(e.report||wt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:xr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const P=c.apply(this,_);return P instanceof lt?P.then(k=>(R.onSuccess(e.reportResult&&k),k)).catch(k=>{throw R.onError(k),k}):(R.onSuccess(e.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const wt=new class{constructor(){Ur(this,"baseInfoMap",new Map),Ur(this,"proxyServer",void 0),Ur(this,"eventUploadTimer",void 0),Ur(this,"setSessionIdTimer",void 0),Ur(this,"url",void 0),Ur(this,"sids",new Set),Ur(this,"backupUrl",void 0),Ur(this,"_appId",void 0),Ur(this,"_aid",0),Ur(this,"keyEventUploadPendingItems",[]),Ur(this,"normalEventUploadPendingItems",[]),Ur(this,"apiInvokeUploadPendingItems",[]),Ur(this,"apiInvokeCount",0),Ur(this,"apiInvokeLoggedCount",0),Ur(this,"ltsList",[]),Ur(this,"lastSendNormalEventTime",Date.now()),Ur(this,"customReportCounterTimer",void 0),Ur(this,"customReportCount",0),Ur(this,"extApiInvoke",async e=>{for(const r of e){const i=nn(nn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:xr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,o]=r;return i+o}),16)||0}reportApiInvoke(e,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!re("SHOW_REPORT_INVOKER_LOG"),h=!!re("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function y(k,W){if(m){let U="[apiInvoke-".concat(_,"]");r.id&&(U+="[".concat(r.id,"]")),r.name&&(U+="[".concat(r.name,"]")),D.info("".concat(U," ").concat(k),k==="start"?r.options:W||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:e,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});y("start");let R=!1;is(r.timeout).then(()=>{R||(this.sendApiInvoke(nn(nn({},S()),{},{error:X.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const P=new Le(X.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:k=>{const W=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(nn(nn({},S()),{},{success:!0},r.reportResult&&{result:k})),y("onSuccess"),k};return i?T8(W,r.name+"Success",i,()=>R=!0):W()},onError:k=>{const W=()=>{if(R)throw k;R=!0,this.sendApiInvoke(nn(nn({},S()),{},{success:!1,error:k})),y("onFailure",k.toString())};return i?T8(W,r.name+"Error",i,()=>R=!0):W()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:kL?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientRole:S}=r,R=Date.now(),P=nn(nn({},o),{},{eventType:Mi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:DL,lts:R,elapse:R-i,extend:JSON.stringify(c),mode:r.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:pl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientType:ot(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:S,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var k;this.send({type:wr.SESSION,data:P},!0)}joinChooseServer(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{role:r.role,eventType:Mi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:wr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Mi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:wr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=r,y=c-(u&&h?h:i.startTime),S=nn(nn({},o),{},{eventType:Mi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:y,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:OL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:wr.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(_){const W=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:W&&W.length?W[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:_?1:0}}else{const W=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:W&&W.length?W[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const k=Object.assign({},S,P,{eventType:Mi.REJOIN_GATEWAY});this.send({type:wr.RE_JOIN_GATEWAY,data:k},!0)}}joinChannelTimeout(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=nn(nn({},i.info),{},{lts:o,timeout:r,elapse:o-i.startTime});this.send({type:wr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Mi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:wr.PUBLISH,data:u},!0)}subscribe(e,r,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=nn(nn({},c),{},{eventType:Mi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:wr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var r;const i=[...kc(r=this.baseInfoMap).call(r)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=nn(nn({},u),{},{eventType:Mi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:wr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=nn(nn(nn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=nn(nn(nn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:i,data:m},!0)}abTest(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Mi.AB_TEST,lts:c});this.send({type:wr.AB_TEST,data:u},!0)}pcStats(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Mi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:wr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,r){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Mi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:wr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=nn(nn(nn({},u),o),{},{eventType:r,lts:h});this.send({type:i,data:m},!0)}streamSwitch(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Mi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:wr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Mi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:wr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Mi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:wr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?D.debug("reportProxyServerurl: ".concat(e)):D.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:wr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const y=uh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let k=0;k<_.length;k++)P+=_.charCodeAt(k)<=127?1:3,P<=m-y||(R[R.length]=ft(ft({},u),{},{[h]:_.substring(S,k)}),S=k,P=_.charCodeAt(k)<=127?1:3);return S!==_.length-1&&(R[R.length]=ft(ft({},u),{},{[h]:_.substring(S)})),R})(nn(nn(nn({},o),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:wr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:wr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:wr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:wr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new Le(X.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=r.map(c=>({type:wr.USER_ANALYTICS,data:nn(nn({sid:e},c),{},{lts:i})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw D.error("send custom report message failed",c.toString()),new Le(X.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const r=re("NOT_REPORT_EVENT");if(e.tag&&ot(r)&&ot(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Le){const{code:_,message:y}=e.error;h=_||y||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:wr.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&e.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),HT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&i.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{re("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),D.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){oi.networkState===Ja.OFFLINE&&await lt.race([oi.onlineWaiter,is(2*gi.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=EL(JSON.stringify(h.data)),_=new ArrayBuffer(5),y=(R=>{let P=0;return Object.entries(wr).forEach(k=>{let[W,U]=k;U===R.type&&(P=Spe[W])}),P})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&y),S.setUint8(3,y>>>8&255),S.setUint8(4,y>>>16&255),u=p8(u,new Uint8Array(_)),u=p8(u,m)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await RL(o,{timeout:1e4,data:r(e),headers:nn(nn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:i,aid:o};oi.networkState===Ja.OFFLINE&&await lt.race([oi.onlineWaiter,is(2*gi.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u)));try{r?await ope(h,{timeout:1e4,data:c}):await RL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,r){const i=Object.assign({},vpe);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:r}),i}reportResourceTiming(e,r){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:xr.TRACER}).onSuccess()}};B8.on("REPORT_LOG_UPLOAD",e=>{e.networkState=oi.networkState,wt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:xr.TRACER}).onSuccess("logUploadError")});class Oe extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ur(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,D)}throw(){super.throw(D)}}const ss={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function kn(){return ss}function G8(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(Vp()||t8())&&!mL())}function H8(){return!ss.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Fp()}let os=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function bv(e,r,i){return{sampleRate:e,stereo:r,bitrate:i}}function Cn(e,r,i,o,c){return{width:e,height:r,frameRate:i,bitrateMin:o,bitrateMax:c}}function au(e,r,i,o,c){return{width:{max:e},height:{max:r},frameRate:i,bitrateMin:o,bitrateMax:c}}function UL(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const Tpe={"90p":Cn(160,90),"90p_1":Cn(160,90),"120p":Cn(160,120,15,30,65),"120p_1":Cn(160,120,15,30,65),"120p_3":Cn(120,120,15,30,50),"120p_4":Cn(212,120),"180p":Cn(320,180,15,30,140),"180p_1":Cn(320,180,15,30,140),"180p_3":Cn(180,180,15,30,100),"180p_4":Cn(240,180,15,30,120),"240p":Cn(320,240,15,40,200),"240p_1":Cn(320,240,15,40,200),"240p_3":Cn(240,240,15,40,140),"240p_4":Cn(424,240,15,40,220),"360p":Cn(640,360,15,80,400),"360p_1":Cn(640,360,15,80,400),"360p_3":Cn(360,360,15,80,260),"360p_4":Cn(640,360,30,80,600),"360p_6":Cn(360,360,30,80,400),"360p_7":Cn(480,360,15,80,320),"360p_8":Cn(480,360,30,80,490),"360p_9":Cn(640,360,15,80,800),"360p_10":Cn(640,360,24,80,800),"360p_11":Cn(640,360,24,80,1e3),"480p":Cn(640,480,15,100,500),"480p_1":Cn(640,480,15,100,500),"480p_2":Cn(640,480,30,100,1e3),"480p_3":Cn(480,480,15,100,400),"480p_4":Cn(640,480,30,100,750),"480p_6":Cn(480,480,30,100,600),"480p_8":Cn(848,480,15,100,610),"480p_9":Cn(848,480,30,100,930),"480p_10":Cn(640,480,10,100,400),"720p":Cn(1280,720,15,120,1130),"720p_auto":Cn(1280,720,30,900,3e3),"720p_1":Cn(1280,720,15,120,1130),"720p_2":Cn(1280,720,30,120,2e3),"720p_3":Cn(1280,720,30,120,1710),"720p_5":Cn(960,720,15,120,910),"720p_6":Cn(960,720,30,120,1380),"1080p":Cn(1920,1080,15,120,2080),"1080p_1":Cn(1920,1080,15,120,2080),"1080p_2":Cn(1920,1080,30,120,3e3),"1080p_3":Cn(1920,1080,30,120,3150),"1080p_5":Cn(1920,1080,60,120,4780),"1440p":Cn(2560,1440,30,120,4850),"1440p_1":Cn(2560,1440,30,120,4850),"1440p_2":Cn(2560,1440,60,120,7350),"4k":Cn(3840,2160,30,120,8910),"4k_1":Cn(3840,2160,30,120,8910),"4k_3":Cn(3840,2160,60,120,13500)},bpe={"480p":au(640,480,5),"480p_1":au(640,480,5),"480p_2":au(640,480,30),"480p_3":au(640,480,15),"720p":au(1280,720,5),"720p_auto":Cn(1280,720,30,900,3e3),"720p_1":au(1280,720,5),"720p_2":au(1280,720,30),"720p_3":au(1280,720,15),"1080p":au(1920,1080,5),"1080p_1":au(1920,1080,5),"1080p_2":au(1920,1080,30),"1080p_3":au(1920,1080,15)},wpe={"1SL1TL":UL(1,1),"3SL3TL":UL(3,3),"2SL3TL":UL(2,3)};function hh(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Tpe[e]):e}function VL(e){return typeof e=="string"?Object.assign({},bpe[e]):e}function DA(e){return typeof e=="string"?Object.assign({},wpe[e]):e}const Rpe={speech_low_quality:bv(16e3,!1),speech_standard:bv(32e3,!1,18),music_standard:bv(48e3,!1),standard_stereo:bv(48e3,!0,56),high_quality:bv(48e3,!1,128),high_quality_stereo:bv(48e3,!0,192)};function LA(e){return typeof e=="string"?Object.assign({},Rpe[e]):e}const wv=[];function $8(e){return Pi(e,"mediaSource",["screen","window","application"]),!0}let gt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),ar=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Rv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Cpe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Ipe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),A_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Cv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Iv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Av=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Nc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const FL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},jL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},K8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Ape={uplinkNetworkQuality:0,downlinkNetworkQuality:0},q8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let yo=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Dc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),pb=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),P_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Qs=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ph=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const BL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let xA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Y8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Rr(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Y8(Object(i),!0).forEach(function(o){Pe(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Pe(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function In(e,r,i,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ga(u=qf(h=i.slice()).call(h)).call(u,function(_,y){return y(e,r,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,r,m),m=null),m}class X8 extends Ar{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(A_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=i||or(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){ot(wv).call(wv,o)||wv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Sm(()=>{var i;wt.reportApiInvoke(null,{name:mi.GET_MEDIA_STREAM_TRACK,options:[],tag:xr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Rv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=wv.indexOf(r);i!==-1&&wv.splice(i,1)}(this),this.emit(Cv.CLOSED),this.removeAllListeners(A_.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Rv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(A_.TRANSCEIVER_UPDATED,r,i)}}class Pv extends X8{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new As("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,D.debug("[".concat(this.getTrackId(),"] close")),this.emit(gt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Cv.TRACK_ENDED)}stateCheck(r,i){if(D.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),jp(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",D);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",D)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():lt.resolve([])}}const J8=window.AudioContext||window.webkitAudioContext;let Lc=null;const Jn=new class extends Ar{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{D.info("ios15-interruption-start"),this.emit(os.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{D.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?D.info("ios15-interruption-end-canceled"):(Lc&&await Lc.suspend(),this.emit(os.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){D.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){D.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Ov(){if(!Lc){if(function(){if(!J8)return void D.error("your browser is not support web audio");D.info("create audio context");const e=Rr({},re("WEBAUDIO_INIT_OPTIONS"));D.debug("audio context init option:",JSON.stringify(e)),Lc=new J8(e),Jn.curState=Lc.state,Lc.onstatechange=()=>{Jn.prevState=Jn.curState,Jn.curState=Lc?Lc.state:void 0;const{prevState:r,curState:i}=Jn,o=i==="running",c=i==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",_=Rn().osVersion;(Eo()||su())&&u&&c&&(D.info("ios".concat(_,"-interruption-start")),Jn.emit(os.IOS_INTERRUPTION_START)),(Eo()||su())&&(h||m)&&o&&(D.info("ios".concat(_,"-interruption-end")),Jn.emit(os.IOS_INTERRUPTION_END)),r!==i&&Jn.emit(os.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Lc)===null||r===void 0?void 0:r.currentTime;Jn.currentTime!==i?(Jn.currentTimeStuckAt&&(D.debug("AudioContext current time resume at ".concat(i)),Jn.currentTimeStuckAt=void 0),Jn.currentTime=i):(i!==Jn.currentTimeStuckAt&&(wt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:xr.TRACER}).onSuccess(),D.warning("AudioContext current time stuck at ".concat(i))),Jn.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(U){r.state==="running"?_(!1):Eo()||su()?r.state==="suspended"&&(_(!0),U&&r.resume().then(y,y)):r.state!=="closed"&&(_(!0),U&&r.resume().then(y,y))}function _(U){if(c!==U){c=U;for(let V=0,q=i;V<q.length;V+=1){const Y=q[V];U?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function y(){m(!1)}function S(){m(!0)}function R(U){if(!h)if(o.paused)if(U){let V;P(!1),h=!0;try{V=o.play(),V?V.then(k,k):(o.addEventListener("playing",k),o.addEventListener("abort",k),o.addEventListener("error",k))}catch{k()}}else P(!0);else P(!1)}function P(U){if(u!==U){u=U;for(let V=0,q=i;V<q.length;V++){const Y=q[V];U?window.addEventListener(Y,W,{capture:!0,passive:!0}):window.removeEventListener(Y,W,{capture:!0,passive:!0})}}}function k(){o.removeEventListener("playing",k),o.removeEventListener("abort",k),o.removeEventListener("error",k),h=!1,R(!1)}function W(){R(!0)}if(Eo()){const U=r.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=V.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=U.stream,R(!0)}Jn.on(os.STATE_CHANGE,function(){m(!0)}),m(!1)}(Lc)}(),!Lc)throw new Le(X.NOT_SUPPORTED,"can not create audio context");return Lc}return Lc}function O_(e){if(function(){if(WL!==null)return WL;const o=Ov(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),WL=m,m}())return;const r=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),ot(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,c,u)):r.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?wA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)r.call(e,h)}}let WL=null;function zL(e,r){let i=!1;const o=1/r;if(re("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Ov();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class Q8{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Ov(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Eo()||su()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const i=Ga(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{D.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Z8 extends Ar{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Ov(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),O_(this.outputNode),this.volumeLevelAnalyser=new Q8}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Nc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!kn().webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&RA(()=>{Jn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Eo()||su()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await is(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class eW extends Z8{get isFreeze(){return!1}constructor(r,i,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(D.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void D.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>D.info("resume success")),D.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),O_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),O_(this.outputNode),this.emit(Nc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(X.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),O_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,D.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));O_(_),this.originVolumeLevelAnalyser=new Q8,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Rn();i&&h.os===xi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Jn.on(os.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),O_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Nc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),Jn.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),D.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));O_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function tW(e,r,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Ppe(e,r){const i=await nW(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new lt((m,_)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const W=document.createElement("button");W.innerHTML="cancel",W.setAttribute("style","width: 85px;"),W.onclick=()=>{document.body.removeChild(q);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",_(Y)};let U=h;const V=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const ce=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),ce.innerText="Share audio",Y.checked=U,Y.onchange=()=>{U=Y.checked},V.appendChild(Y),V.appendChild(ce)}k.appendChild(V),k.appendChild(W),S.appendChild(R),S.appendChild(P),S.appendChild(k);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(y),q.appendChild(S),document.body.appendChild(q),u.map(Y=>{if(Y.id){const ce=document.createElement("div");ce.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _e=Y.thumbnail;try{const{width:ye}=_e.getSize();ye>1920&&(_e=_e.resize({width:1920}))}catch(ye){throw ye&&ye.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ye}ce.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_e.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(ye){return"&#"+ye.charCodeAt(0)+";"})+"</span>",ce.onclick=()=>{document.body.removeChild(q),m({sourceId:Y.id,audio:U})},P.appendChild(ce)}})})}(i,r);return await tW(o,e,c)}async function nW(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const i=f8();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Le(X.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new lt((u,h)=>{i.desktopCapturer.getSources({types:r},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new Le(X.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const GL=new As("safari");let rW=!1,iW=!1;async function xc(e,r){let i=0,o=null;for(;i<2;)try{o=await Ope(e,r,i>0);break}catch(c){if(c instanceof Le)throw D.error("[".concat(r,"] ").concat(c.toString())),c;const u=MA(c.name||c.code||c,c.message);if(u.code===X.MEDIA_OPTION_INVALID){D.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await is(500);continue}throw D.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new Le(X.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Ope(e,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(X.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=kn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return D.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(f8())e.screen.sourceId?kv(c,await tW(e.screen.sourceId,e.screen,!!e.screenAudio)):kv(c,await Ppe(e.screen,!!e.screenAudio));else if(Vp()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");D.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=e.screen.extensionId,m=r,new lt((k,W)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},U=>{if(!U||!U.streamId)return D.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void W(new Le(X.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(U.streamId)})}catch(U){D.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),W(new Le(X.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=P,kv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&$8(e.screen.mediaSource);const P={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:W,systemAudio:U,preferCurrentTab:V}=e.screen,q={selfBrowserSurface:k,surfaceSwitching:W,systemAudio:U,preferCurrentTab:V};!k&&delete q.selfBrowserSurface,!W&&delete q.surfaceSwitching,!U&&delete q.systemAudio,!V&&delete q.preferCurrentTab,D.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:e.screenAudio,controls:q})),kv(c,await navigator.mediaDevices.getDisplayMedia(Rr({video:P,audio:e.screenAudio},q)))}else{if(!Dr())throw D.error("[".concat(r,"] This browser does not support screenSharing")),new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&$8(e.screen.mediaSource);const P={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};D.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),kv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},y=re("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),_=SL(_,y)}catch{}D.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(_)),Rn();let S,R=null;(Es()||Eo()||TA())&&(R=await GL.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(P){throw R&&R(),P}return _.audio&&(rW=!0),_.video&&(iW=!0),kv(c,S),R&&R(),c}function MA(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(X.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(X.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new Le(X.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new Le(X.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(X.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(X.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return D.error("getUserMedia unexpected error",e),new Le(X.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function kv(e,r){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const Mc=new class extends Ar{get state(){return this._state}set state(e){e!==this._state&&(this.emit(P_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Pe(this,"_state",pb.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(bA()||SA()===xi.HARMONY_OS)&&Fp())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>D.error(e.toString()))}async enumerateDevices(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(X.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,y=null;if(!i&&(u||h)){if(GL.isLocked&&(D.debug("[device manager] wait GUM lock"),(await GL.lock())(),D.debug("[device manager] GUM unlock")),rW&&(u=!1,this.isAccessMicrophonePermission=!0),iW&&(h=!1,this.isAccessCameraPermission=!0),D.debug("[device manager] check media device permissions",e,r,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=MA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=MA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=MA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}D.debug("[device manager] mic permission",e,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,new Le(X.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!r)throw new Le(X.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=pb.INITING;try{await this.updateDevicesInfo(),this.state=pb.INITEND}catch(e){throw D.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=pb.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(X.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):D.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==pb.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(P_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(P_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(P_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let HL=!1;const Uc=new class extends Ar{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function sW(){if(Rn(),!HL){const e=r=>{r.preventDefault(),HL=!1,ib()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};HL=!0,ib()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),D.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Uc.onAutoplayFailed?Uc.onAutoplayFailed():Uc.onAudioAutoplayFailed?D.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):D.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Uc.emit("autoplay-failed")}}function oW(e,r,i,o){if(!e)return;const c=wt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=Rr(Rr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Uc.onAutoplayFailed||Uc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:o,extend:void 0});wt.send({type:wr.AUTOPLAY_FAILED,data:m},!0)}const kpe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ho=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,o]=r;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(D.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(Jn.curState==="running")return _v()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(D.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Jn.on(os.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.on(os.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Jn.on(os.STATE_CHANGE,()=>{Eo()&&Jn.prevState==="suspended"&&Jn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),i)try{await i.setSinkId(r)}catch(o){throw new Le(X.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,i,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,Qs.INIT),this.setVolume(r,i);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{D.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){D.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&oW(o,"audio",m.message,r),D.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(D.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),RA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),sW()}))})}updateTrack(e,r){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const i=this.elementMap.get(e);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){kpe.forEach(i=>{r.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(D.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&D.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{D.debug("Auto resume audio element success")}).catch(i=>{D.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new lt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{ib()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Jr(){return function(e,r,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new Le(X.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",D);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof lt?new lt((_,y)=>{m.then(_).catch(y)}):m}),i}}class aW extends Ar{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(yo.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(yo.ON_TRACK,void 0)}}class cW extends Ar{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await vs(this,Dc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var o;return D.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),sr(this,Dc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ic(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return D.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),sr(this,Dc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ic(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){D.error(new Le(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof lt&&(o=await o),r.push(Rr(Rr({},o),{},{direction:this.direction}))}catch(o){D.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class lW extends Ar{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(yo.ON_TRACK,void 0),this.emit(yo.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(yo.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(yo.ON_NODE,this.inputNode))}}class uW extends Ar{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=o}async getConstraints(){return vs(this,Dc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var o;return D.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),sr(this,Dc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ic(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),sr(this,Dc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ic(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){D.error(new Le(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof lt&&(o=await o),r.push(Rr(Rr({},o),{},{direction:this.direction}))}catch(o){D.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class $L extends Ar{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new Npe}setVolume(){}createOutputTrack(){throw new Le(X.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Npe{disconnect(){}connect(){}}function dW(e){return new lt((r,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=Eo()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Dr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(CA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function UA(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const i=hh(e.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!l8()&&i.frameRate&&(r.frameRate=i.frameRate),t8()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Dr()&&(r.frameRate={ideal:30,max:30}),r}function hW(e){const r={};return l8()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,Vp()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function pW(e){const r=hW(e);if(e.encoderConfig){const i=LA(e.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),bA()&&(r.sampleRate=void 0),r}const Dpe=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=TL(h),m=TL(m),u=TL(u);const{max:_,min:y}=function(k,W,U){const V=200*Math.pow(U/15,.6)*Math.pow(k*W/640/360,.75);return{min:Math.floor(V),max:Math.floor(4*V)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||D.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=re("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||_,bitrateMin:R||y,scaleResolutionDownBy:1,scale:0}},fW=async(e,r,i)=>await(async(o,c,u)=>{const h=function(y){const S=[];for(let R=0;R<y.length;R+=2)S.push(parseInt(y.slice(R,R+2),16));return Uint8Array.from(S)}(R8(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(e.buffer,r,i),KL=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new lt((i,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await mW(c);i({buffer:u,width:r.width,height:r.height})}else o(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},mW=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var gW,_W,EW,yW,vW,SW,TW,bW,wW,RW,CW,IW,AW,PW,OW,kW,NW,DW,Pr,LW,xW,MW,UW,VW,FW,fh,jW,BW,WW,zW,GW,HW,$W,KW,qW,YW,XW,JW,QW,Ts;let Br=(gW=Mt({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),_W=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),EW=Jr(),yW=vv("LocalAudioTrack","_enabledMutex"),vW=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),SW=Jr(),TW=vv("LocalAudioTrack","_enabledMutex"),bW=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),wW=Jr(),RW=Jr(),CW=Jr(),IW=Mt({argsMap:e=>[e.getTrackId()]}),AW=Jr(),PW=Mt({argsMap:e=>[e.getTrackId()]}),OW=Jr(),kW=Mt({argsMap:e=>[e.getTrackId()]}),NW=Mt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),DW=Mt({argsMap:e=>[e.getTrackId()]}),In((Pr=class extends Pv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ho.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,i,o){super(e,i),Pe(this,"trackMediaType",Av.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new $L,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Es()&&!Lc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){er(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ho.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void D.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,sr(this,gt.NEED_REPLACE_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{D.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!G8())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ho.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,i){return this._setEnabled(e,r,i)}async _setEnabled(e,r,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await sr(this,gt.NEED_ENABLE_TRACK,this),D.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await sr(this,gt.NEED_MUTE_TRACK,this):await sr(this,gt.NEED_UNMUTE_TRACK,this))}getStats(){return Sm(()=>{D.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Pc(this,gt.GET_STATS)||Rr({},FL)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Nc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Nc.ON_AUDIO_BUFFER),this._source.on(Nc.ON_AUDIO_BUFFER,i=>e(i))}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ho.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ho.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ho.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return lt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Le(X.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(yo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this))}),e.on(yo.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(yo.ON_TRACK),e.removeAllListeners(yo.ON_NODE)}bindProcessorContextEvents(e){e.on(Dc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Dc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof $L&&(this._trackSource=new eW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new uW(this._source.context,this.getTrackId(),"local"),r=new lW(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(Nc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ho.stop(this.getTrackId()),this._source.play()),sr(this,gt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{D.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[gW],Object.getOwnPropertyDescriptor(Pr.prototype,"setVolume"),Pr.prototype),In(Pr.prototype,"setPlaybackDevice",[_W,EW],Object.getOwnPropertyDescriptor(Pr.prototype,"setPlaybackDevice"),Pr.prototype),In(Pr.prototype,"setEnabled",[yW,vW,SW],Object.getOwnPropertyDescriptor(Pr.prototype,"setEnabled"),Pr.prototype),In(Pr.prototype,"setMuted",[TW,bW,wW],Object.getOwnPropertyDescriptor(Pr.prototype,"setMuted"),Pr.prototype),In(Pr.prototype,"getStats",[RW],Object.getOwnPropertyDescriptor(Pr.prototype,"getStats"),Pr.prototype),In(Pr.prototype,"setAudioFrameCallback",[CW],Object.getOwnPropertyDescriptor(Pr.prototype,"setAudioFrameCallback"),Pr.prototype),In(Pr.prototype,"play",[IW,AW],Object.getOwnPropertyDescriptor(Pr.prototype,"play"),Pr.prototype),In(Pr.prototype,"stop",[PW,OW],Object.getOwnPropertyDescriptor(Pr.prototype,"stop"),Pr.prototype),In(Pr.prototype,"close",[kW],Object.getOwnPropertyDescriptor(Pr.prototype,"close"),Pr.prototype),In(Pr.prototype,"pipe",[NW],Object.getOwnPropertyDescriptor(Pr.prototype,"pipe"),Pr.prototype),In(Pr.prototype,"unpipe",[DW],Object.getOwnPropertyDescriptor(Pr.prototype,"unpipe"),Pr.prototype),Pr),VA=(LW=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),xW=Jr(),MW=vv("MicrophoneAudioTrack","_enabledMutex"),UW=Mt({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),VW=Jr(),FW=Mt({argsMap:e=>[e.getTrackId()]}),In((fh=class extends Br{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,i,o){super(e,r.encoderConfig?LA(r.encoderConfig):{},o,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(_v()||fL())&&Jn.bindInterruptDetectorTrack(this)}async setDevice(e){if(D.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await Mc.getDeviceById(e),i={};i.audio=Rr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await xc(i,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await xc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Mc.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}D.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,i){if(r)return D.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),re("AUTO_RESET_AUDIO_ROUTE")&&(Eo()||su())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(h){throw D.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Rr({},this._constraints),u=Mc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await xc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}D.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(_v()||fL())&&Jn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Eo()||su())&&this._enabled&&!this._isClosed&&Jn.duringInterruption){const e=async()=>{Jn.off(os.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Jn.on(os.IOS_INTERRUPTION_END,e)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Cv.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,i=Mc.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await xc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Dc.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Dc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[LW,xW],Object.getOwnPropertyDescriptor(fh.prototype,"setDevice"),fh.prototype),In(fh.prototype,"setEnabled",[MW,UW,VW],Object.getOwnPropertyDescriptor(fh.prototype,"setEnabled"),fh.prototype),In(fh.prototype,"close",[FW],Object.getOwnPropertyDescriptor(fh.prototype,"close"),fh.prototype),fh),Lpe=(jW=Mt({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),BW=Jr(),WW=Mt({argsMap:e=>[e.getTrackId()]}),zW=Jr(),GW=Mt({argsMap:e=>[e.getTrackId()]}),HW=Jr(),$W=Mt({argsMap:e=>[e.getTrackId()]}),KW=Jr(),qW=Mt({argsMap:e=>[e.getTrackId()]}),YW=Jr(),XW=Mt({argsMap:e=>[e.getTrackId()]}),JW=Mt({argsMap:e=>[e.getTrackId()]}),QW=Jr(),In((Ts=class extends Br{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,i,o){super(r.createOutputTrack(),i,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(Nc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Cv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){er(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[jW,BW],Object.getOwnPropertyDescriptor(Ts.prototype,"startProcessAudioBuffer"),Ts.prototype),In(Ts.prototype,"pauseProcessAudioBuffer",[WW,zW],Object.getOwnPropertyDescriptor(Ts.prototype,"pauseProcessAudioBuffer"),Ts.prototype),In(Ts.prototype,"seekAudioBuffer",[GW,HW],Object.getOwnPropertyDescriptor(Ts.prototype,"seekAudioBuffer"),Ts.prototype),In(Ts.prototype,"resumeProcessAudioBuffer",[$W,KW],Object.getOwnPropertyDescriptor(Ts.prototype,"resumeProcessAudioBuffer"),Ts.prototype),In(Ts.prototype,"stopProcessAudioBuffer",[qW,YW],Object.getOwnPropertyDescriptor(Ts.prototype,"stopProcessAudioBuffer"),Ts.prototype),In(Ts.prototype,"close",[XW],Object.getOwnPropertyDescriptor(Ts.prototype,"close"),Ts.prototype),In(Ts.prototype,"setAudioBufferPlaybackSpeed",[JW,QW],Object.getOwnPropertyDescriptor(Ts.prototype,"setAudioBufferPlaybackSpeed"),Ts.prototype),Ts);class Ti extends Br{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Ov().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,or(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(D.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):D.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){D.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}wA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof Ti?i.emit(A_.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class xpe extends Z8{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Nc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):D.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const ZW=new Map;class qL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(D.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",ph.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",Qs.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return D.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Jn.curState==="running"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(e8())),a8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Qs.PLAYING;break;case"loadeddata":if(this.videoState=ph.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Qs.CANPLAY;break;case"stalled":this.videoElementStatus=Qs.STALLED;break;case"suspend":this.videoElementStatus=Qs.SUSPEND;break;case"pause":this.videoElementStatus=Qs.PAUSED,Eo()||su()||Es()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Qs.WAITING;break;case"abort":this.videoElementStatus=Qs.ABORT;break;case"ended":this.videoElementStatus=Qs.ENDED;break;case"emptied":this.videoElementStatus=Qs.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Qs.ERROR,D.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Wp.lastVisibleTime<Wp.lastHiddenTime||u<Wp.lastHiddenTime||u<Wp.lastVisibleTime)return;for(c>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(e8())),a8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),Jn.on(os.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.on(os.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&oW(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(D.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):D.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Rn();if((o.name==="Safari"&&Number(o.version)===15||_v())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return D.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const o=i.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new lt((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await mW(m);u({buffer:_,width:o.width,height:o.height})}else h(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await KL(r)}destroy(){this.renderStats=void 0,Jn.off(os.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.off(os.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ph.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Qs.INIT,!this.videoElementCheckInterval&&(ez.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=Qs.DESTROYED)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ph.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ph.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(y,S)=>{if(this.videoElementStatus===Qs.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const k=S.presentationTime-u.presentationTime;this.videoState===ph.VideoStateStarting&&(this.videoState=ph.VideoStateDecoding),this.videoState===ph.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION"))),k<re("VIDEO_FREEZE_DURATION")&&this.videoState===ph.VideoStateFrozen&&(this.videoState=ph.VideoStateDecoding),k>re("VIDEO_FREEZE_DURATION")&&Wp.lastVisibleTime>=Wp.lastHiddenTime&&u.timestamp>Wp.lastVisibleTime&&u.timestamp>Wp.lastHiddenTime&&(this.renderFreezeAccTime+=k)}u=Rr(Rr({},S),{},{timestamp:y})}var R,P;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,_))};(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),bA()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Rn();o.name==="Safari"&&Number(o.version)===15||_v()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{D.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){ez.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Qs.NONE}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{D.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{D.error(o)}),this.autoplayFailed=!1,ib()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};ib()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),sW()}}const ez=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class tz extends qL{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await KL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var nz,rz,iz,sz,oz,az,cz,lz,uz,dz,hz,pz,fz,mz,gz,_z,Ez,yz,vz,Sz,Tz,bz,wz,Rz,Tn,Cz,Iz,Az,Pz,Oz,kz,Nz,Dz,Vc;let gr=(nz=Mt({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),rz=Jr(),iz=Mt({argsMap:e=>[e.getTrackId()]}),sz=vv("LocalVideoTrack","_enabledMutex"),oz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),az=Jr(),cz=vv("LocalVideoTrack","_enabledMutex"),lz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),uz=Jr(),dz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),hz=Jr(),pz=Jr(),fz=Mt({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),mz=Jr(),gz=Jr(),_z=Jr(),Ez=Jr(),yz=Jr(),vz=Jr(),Sz=Jr(),Tz=Mt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),bz=Mt({argsMap:e=>[e.getTrackId()]}),wz=Mt({argsMap:e=>[e.getTrackId()]}),Rz=Mt({argsMap:(e,r,i)=>[e.getTrackId(),r.label,i]}),Tn=class vse extends Pv{get videoHeight(){if(Es()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Es()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,o,c,u,h){if(super(r,u),Pe(this,"trackMediaType",Av.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Es()){const{width:m,height:_}=r.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(ar.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(dL(Un.CHROME,115)&&SA().indexOf("Windows")!==-1){const m=function(_,y){if("VideoFrame"in window&&"TransformStream"in window&&kn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),R=new MediaStreamTrackGenerator({kind:"video"});let P,k,W=Date.now();const U=()=>{V&&(clearInterval(V),V=void 0),P&&(P.close(),P=void 0),_.stop(),k=void 0,R.removeEventListener("ended",U)};let V=window.setInterval(()=>{if(k&&P&&Date.now()-W>1e3)try{R.readyState==="live"?k.enqueue(P.clone()):U()}catch{U()}},1e3);const q=new TransformStream({transform:(Y,ce)=>{R.readyState==="live"?(k=ce,W=Date.now(),P===void 0?(P=Y,ce.enqueue(Y.clone())):(ce.enqueue(P),P=Y)):Y.close()}});return R.addEventListener("ended",U),S.readable.pipeThrough(q).pipeTo(R.writable),R}}(r);m&&(D.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(ar.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new cW(this.getTrackId(),"local"),this._processorDestination=new aW(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=Rr(Rr(Rr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new qL(o):this._player=new tz(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Cv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await sr(this,gt.NEED_MUTE_TRACK,this):await sr(this,gt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,i){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=hh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=UA({encoderConfig:r});(Es()||Eo()||su())&&(o.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Le(X.UNEXPECTED_ERROR,c.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(D)}}getStats(){return Sm(()=>{D.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Pc(this,gt.GET_STATS)||Rr({},jL)}async setBeautyEffect(r){D.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await KL(r)}async setBitrateLimit(r){D.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void D.error(X.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await sr(this,gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,D.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return D.error(X.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,D.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){dW(this._originMediaStreamTrack).then(r=>{let[i,o]=r;this._videoHeight=o,this._videoWidth=i}).catch(CA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");D.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=hh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(D)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,y,S,R,P){const k=re("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var W;const V=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*y/640/360,.75));P=k==="STANDARD_BITRATE"?4*V:2*V,R=(W=R)!==null&&W!==void 0?W:V}else{var U;R=(U=R)!==null&&U!==void 0?U:Math.floor(P/10)}return{min:R,max:P}}(r,i,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,D.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,i;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=h8.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const y=wt.reportApiInvoke(null,{tag:xr.TRACER,name:mi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Rr(Rr({},o),hh(r))),o=w_(o);const c=or(8,"track-video-cloned-"),u=new vse(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,w_(this._scalabilityMode),this._optimizationMode,c,w_(this._hints));return r&&o&&u.setEncoderConfiguration(o),D.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new Le(X.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(X.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Sm(()=>{wt.reportApiInvoke(null,{name:mi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:xr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void D.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(X.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void D.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):D.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(yo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(yo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Dc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Dc.REQUEST_CONSTRAINTS)}},In(Tn.prototype,"play",[nz,rz],Object.getOwnPropertyDescriptor(Tn.prototype,"play"),Tn.prototype),In(Tn.prototype,"stop",[iz],Object.getOwnPropertyDescriptor(Tn.prototype,"stop"),Tn.prototype),In(Tn.prototype,"setEnabled",[sz,oz,az],Object.getOwnPropertyDescriptor(Tn.prototype,"setEnabled"),Tn.prototype),In(Tn.prototype,"setMuted",[cz,lz,uz],Object.getOwnPropertyDescriptor(Tn.prototype,"setMuted"),Tn.prototype),In(Tn.prototype,"setEncoderConfiguration",[dz,hz],Object.getOwnPropertyDescriptor(Tn.prototype,"setEncoderConfiguration"),Tn.prototype),In(Tn.prototype,"getStats",[pz],Object.getOwnPropertyDescriptor(Tn.prototype,"getStats"),Tn.prototype),In(Tn.prototype,"setBeautyEffect",[fz,mz],Object.getOwnPropertyDescriptor(Tn.prototype,"setBeautyEffect"),Tn.prototype),In(Tn.prototype,"getCurrentFrameData",[gz],Object.getOwnPropertyDescriptor(Tn.prototype,"getCurrentFrameData"),Tn.prototype),In(Tn.prototype,"getCurrentFrameImage",[_z],Object.getOwnPropertyDescriptor(Tn.prototype,"getCurrentFrameImage"),Tn.prototype),In(Tn.prototype,"setBitrateLimit",[Ez],Object.getOwnPropertyDescriptor(Tn.prototype,"setBitrateLimit"),Tn.prototype),In(Tn.prototype,"setOptimizationMode",[yz],Object.getOwnPropertyDescriptor(Tn.prototype,"setOptimizationMode"),Tn.prototype),In(Tn.prototype,"setScalabiltyMode",[vz],Object.getOwnPropertyDescriptor(Tn.prototype,"setScalabiltyMode"),Tn.prototype),In(Tn.prototype,"updateMediaStreamTrackResolution",[Sz],Object.getOwnPropertyDescriptor(Tn.prototype,"updateMediaStreamTrackResolution"),Tn.prototype),In(Tn.prototype,"pipe",[Tz],Object.getOwnPropertyDescriptor(Tn.prototype,"pipe"),Tn.prototype),In(Tn.prototype,"unpipe",[bz],Object.getOwnPropertyDescriptor(Tn.prototype,"unpipe"),Tn.prototype),In(Tn.prototype,"close",[wz],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),In(Tn.prototype,"replaceTrack",[Rz],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),Tn),YL=(Cz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),Iz=Jr(),Az=vv("CameraVideoTrack","_enabledMutex"),Pz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),Oz=Jr(),kz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),Nz=Jr(),Dz=Mt({argsMap:e=>[e.getTrackId()]}),Vc=class Sse extends gr{get __className__(){return"CameraVideoTrack"}constructor(r,i,o,c,u,h){super(r,hh(i.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(_v()||fL())&&!function(){const m=Rn();if(m.os!==xi.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&c8()&&this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=hh(this._config.encoderConfig),Jn.on(os.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Jn.on(os.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(D.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await Mc.getDeviceById(r),o={};o.video=Rr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await xc(o,this.getTrackId())}catch(u){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await xc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Mc.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}D.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){D.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:Rr(Rr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await xc(i,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await xc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Rr({},i.video),D.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await xc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=hh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=Mr(this._config);o.encoderConfig=r;const c=UA(o);(Es()||Eo()||su())&&(c.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Le(X.UNEXPECTED_ERROR,u.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(D)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Eo()||su())&&this._enabled&&!this._isClosed&&Jn.duringInterruption){const r=async()=>{Jn.off(os.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Jn.on(os.IOS_INTERRUPTION_END,r)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Cv.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,o=Mc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await xc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Jn.off(os.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Jn.off(os.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Rr(Rr({},o),hh(r))),o=w_(o);const c=or(8,"track-cam-cloned-"),u=new Sse(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,w_(Rr(Rr({},this._config),{},{encoderConfig:o})),w_(this._constraints),w_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),D.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Dc.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(Dc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},In(Vc.prototype,"setDevice",[Cz,Iz],Object.getOwnPropertyDescriptor(Vc.prototype,"setDevice"),Vc.prototype),In(Vc.prototype,"setEnabled",[Az,Pz,Oz],Object.getOwnPropertyDescriptor(Vc.prototype,"setEnabled"),Vc.prototype),In(Vc.prototype,"setEncoderConfiguration",[kz,Nz],Object.getOwnPropertyDescriptor(Vc.prototype,"setEncoderConfiguration"),Vc.prototype),In(Vc.prototype,"close",[Dz],Object.getOwnPropertyDescriptor(Vc.prototype,"close"),Vc.prototype),Vc);function XL(e,r,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=Rr(Rr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?D.debug("[".concat(e,"] set content hint to"),i.optimizationMode):D.debug("[".concat(e,"] set content hint failed")))):D.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Lz,xz,Mz,Uz,ml,Vz,Fz,jz,Bz,Wz,zz,Zs;class Gz extends X8{getUserId(){return this._userId}constructor(r,i,o,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(or(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,D.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Nv=(Lz=Mt({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),xz=Mt({argsMap:e=>[e.getTrackId()]}),Mz=Mt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),Uz=Mt({argsMap:e=>[e.getTrackId()]}),In((ml=class extends Gz{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,i,o){super(e,r,i,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",Av.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new cW(this.getTrackId(),"remote"),this.processorDestination=new aW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Sm(()=>{D.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Pc(this,gt.GET_STATS)||Rr({},q8)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=Rr(Rr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new qL(i):this._player=new tz(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Iv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Iv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Iv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){dW(this._originMediaStreamTrack).then(e=>{let[r,i]=e;this._videoHeight=i,this._videoWidth=r}).catch(CA)}_updatePlayerSource(){D.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=h8.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=wt.reportApiInvoke(null,{tag:xr.TRACER,name:mi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(yo.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(yo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(A_.SEI_RECEIVED,e)}}).prototype,"play",[Lz],Object.getOwnPropertyDescriptor(ml.prototype,"play"),ml.prototype),In(ml.prototype,"stop",[xz],Object.getOwnPropertyDescriptor(ml.prototype,"stop"),ml.prototype),In(ml.prototype,"pipe",[Mz],Object.getOwnPropertyDescriptor(ml.prototype,"pipe"),ml.prototype),In(ml.prototype,"unpipe",[Uz],Object.getOwnPropertyDescriptor(ml.prototype,"unpipe"),ml.prototype),ml),Dv=(Vz=Mt({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),Fz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),jz=Mt({argsMap:e=>[e.getTrackId()]}),Bz=Mt({argsMap:e=>[e.getTrackId()]}),Wz=Mt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),zz=Mt({argsMap:e=>[e.getTrackId()]}),In((Zs=class extends Gz{get isPlaying(){return this._useAudioElement?Ho.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,i,o){super(e,r,i,o),Pe(this,"trackMediaType",Av.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new $L,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new eW(e,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Nc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Iv.FIRST_FRAME_DECODED)}),this.processorContext=new uW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new lW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Nc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Nc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Nc.ON_AUDIO_BUFFER),this._source.on(Nc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?Ho.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!G8())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ho.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Sm(()=>{D.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Pc(this,gt.GET_STATS)||Rr({},K8)}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ho.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ho.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ho.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(yo.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(yo.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(yo.ON_TRACK),this.processorDestination.removeAllListeners(yo.ON_NODE)}}).prototype,"setVolume",[Vz],Object.getOwnPropertyDescriptor(Zs.prototype,"setVolume"),Zs.prototype),In(Zs.prototype,"setPlaybackDevice",[Fz],Object.getOwnPropertyDescriptor(Zs.prototype,"setPlaybackDevice"),Zs.prototype),In(Zs.prototype,"play",[jz],Object.getOwnPropertyDescriptor(Zs.prototype,"play"),Zs.prototype),In(Zs.prototype,"stop",[Bz],Object.getOwnPropertyDescriptor(Zs.prototype,"stop"),Zs.prototype),In(Zs.prototype,"pipe",[Wz],Object.getOwnPropertyDescriptor(Zs.prototype,"pipe"),Zs.prototype),In(Zs.prototype,"unpipe",[zz],Object.getOwnPropertyDescriptor(Zs.prototype,"unpipe"),Zs.prototype),Zs);const Wp=new class extends Ar{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),D.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Hz extends Ar{constructor(r,i){super(),Pe(this,"trackMediaType",Av.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new lt((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;i(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Le(X.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[xA.OPEN,xA.CLOSE,xA.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),r.addEventListener(i,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Mpe extends Hz{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&D.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(xA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Upe extends Hz{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function FA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>FI.revokeObjectURL(e),0),new Worker(FI.createObjectURL(e))}const $z=71,JL=1,QL=2,ZL=1,Kz=2;var zp=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(zp||{});function qz(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==$z)return;const o=e.getUint16(1),c=JL+QL+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let m=JL+QL;for(;m<c;){const _=e.getUint8(m),y=e.getUint16(m+ZL),S=ZL+Kz;if(_===zp.AUDIO_LEVEL){let R=e.getUint8(m+S);for(let P=1;P<y;P++)R=R<<8|e.getUint8(m+S+P);h.tlv.push({tag:_,length:y,value:r?127^R>>1:127&R})}else if(_===zp.METADATA||_===zp.AUDIO_64_BIT_PTS){const R=new Uint8Array(y);for(let P=0;P<y;P++)R[P]=e.getUint8(m+S+P);h.tlv.push({tag:_,length:y,value:R})}m+=S+y}return h}const jA=new Map,BA=127,k_=1e-10,ex=139/13,WA=new Map;function tx(e,r,i){const o="".concat(e,"-").concat(r,"-").concat(i);let c=0;return WA.has(o)?c=WA.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let y=1;for(let S=h,R=1;S>m;S--,R++)y=y*S/R;return y}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(i)+i*e,WA.set(o,c)),c<k_&&(c=k_),c}function Yz(e,r,i){const o=r.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let y=m+c;m<y;m++)e[m]>i&&_++;r[h]!==_&&(r[h]=_,u=!0)}return u}window.cache=WA;let Vpe=0;class Xz{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",k_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",k_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",k_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(Vpe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,o=this.minLevel+ex;let c=!1;for(let u=0;u<r.length;++u){let h=i[u];h<o&&(h=0);const m=Math.floor(h/ex);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return Yz(this.mediums,this.longs,4)}computeMediums(){return Yz(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=tx(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=tx(this.longs[0],10,47),this.longSpeechActivityScore>k_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=tx(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(qf(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=r;return r<0&&(o=0),r>BA&&(o=BA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+ex?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>BA&&(i=BA),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Fpe{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class nx{constructor(r,i,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=o}}class jpe extends Ar{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new Xz(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,o){const c=r.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==r;)++_;return new nx(c,_,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new nx(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new nx(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Fpe(this),this.decisionMaker.execute())}makeDecision(r){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Ic(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const _=this.relativeSpeechActivities;let y=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let V=0;V<_.length;++V){const q=m==null?k_:m.getSpeechActivityScore(V);_[V]=Math.log(P.getSpeechActivityScore(V)/q)}const k=_[0],W=_[1],U=_[2];k>3&&W>2&&U>0&&W>y&&(y=W,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const i=[];for(const c of Ic(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Lv=new Map;let hd=null,zA=null;const Jz=3;let N_=[];const pd=new Map,GA=new Map;class Bpe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=i,this.setActive(pd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(Ic(pd).call(pd)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let o;return Array.from(Ic(pd).call(pd)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let o;return Array.from(Ic(pd).call(pd)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let HA;function Qz(e){const r=pd.get(e);r&&(pd.delete(e),r.clearTimer())}const $A=new Map,Wpe=new Map;function zpe(e,r,i){let o=new Uint8Array(e,r,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const KA=new Map,fb=new Map;(function(){const e=Rn();ss.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ss.getStreamFromExtension=e.name===Un.CHROME&&Number(e.version)>34,ss.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),ss.supportMinBitrate=e.name===Un.CHROME||e.name===Un.EDGE,ss.supportSetRtpSenderParameters=function(){const r=Rn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Fp()||!(!Es()&&!TA())||r.name===Un.FIREFOX&&Number(r.version)>=64)}(),e.name===Un.SAFARI&&(Number(e.version)>=14?ss.supportDualStream=!0:ss.supportDualStream=!1),ss.webAudioMediaStreamDest=function(){const r=Rn();return!(r.name===Un.SAFARI&&Number(r.version)<12)}(),ss.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ss.supportWebGL=typeof WebGLRenderingContext<"u",ss.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Fp()||(ss.webAudioWithAEC=!0),ss.supportShareAudio=function(){const r=Rn();return(r.os===xi.WIN_10||r.os===xi.WIN_81||r.os===xi.WIN_7||r.os===xi.LINUX||r.os===xi.MAC_OS||r.os===xi.CHROMIUM_OS)&&r.name===Un.CHROME&&Number(r.version)>=74}(),ss.supportDataChannel=!!(rb(76)||function(r){const i=Rn();return!(i.name!==Un.FIREFOX||!i.osVersion)&&Number(i.version)>=r}(68)||r8(14)),ss.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Dr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),ss.supportWebRTCEncodedTransform=function(){const r=Rn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),ss.supportWebRTCInsertableStream=function(){const r=Rn();return(r.name===Un.CHROME||r.name===Un.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ss.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ss.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,RA(()=>{ss.supportDualStreamEncoding=function(){const r=Rn();return!!re("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),D.debug("browser ua: ",navigator.userAgent),D.info("browser info: ",e),D.info("browser compatibility: ",ss)})})();const Gpe=["CHINA","GLOBAL"],Zz=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],D_=[],xv=[];function L_(e,r){return!!r&&D_.some(i=>i.uid===e&&i.channelName===r)}function rx(){return xv.length>0}var Hpe=SB.forEach,eG=pp("forEach")?[].forEach:function(e){return Hpe(this,e,arguments.length>1?arguments[1]:void 0)};Mn({target:"Array",proto:!0,forced:[].forEach!=eG},{forEach:eG});var $pe=za("Array").forEach,Kpe=gc,qpe=hi,Ype=N,Xpe=$pe,ix=Array.prototype,Jpe={DOMTokenList:!0,NodeList:!0},Qpe=function(e){var r=e.forEach;return e===ix||Ype(ix,e)&&r===ix.forEach||qpe(Jpe,Kpe(e))?Xpe:r},Zpe=l(Qpe),efe=Io,tG=yc;Mn({target:"Object",stat:!0,forced:d(function(){tG(1)})},{keys:function(e){return tG(efe(e))}});var nG=l(vt.Object.keys),tfe=l(HE),nfe=l(KE),rfe=Mn,rG=Vg,ife=a_,sfe=_t,iG=fe,ofe=ii,afe=Re,cfe=II,lfe=hr,ufe=fs,dfe=dB("slice"),hfe=lfe("species"),sx=Array,pfe=Math.max;rfe({target:"Array",proto:!0,forced:!dfe},{slice:function(e,r){var i,o,c,u=afe(this),h=ofe(u),m=iG(e,h),_=iG(r===void 0?h:r,h);if(rG(u)&&(i=u.constructor,(ife(i)&&(i===sx||rG(i.prototype))||sfe(i)&&(i=i[hfe])===null)&&(i=void 0),i===sx||i===void 0))return ufe(u,m,_);for(o=new(i===void 0?sx:i)(pfe(_-m,0)),c=0;m<_;m++,c++)m in u&&cfe(o,c,u[m]);return o.length=c,o}});var ffe=za("Array").slice,mfe=N,gfe=ffe,ox=Array.prototype,_fe=function(e){var r=e.slice;return e===ox||mfe(ox,e)&&r===ox.slice?gfe:r},Efe=l(_fe);function yt(e,r,i,o,c){var u,h,m,_={};return Zpe(u=nG(o)).call(u,function(y){_[y]=o[y]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=tfe(h=nfe(m=Efe(i).call(i)).call(m)).call(h,function(y,S){return S(e,r,y)||y},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(aB(e,r,_),_=null),_}let qA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),ax=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),cu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),vo=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Lt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),lr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Bt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),jt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),mb=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),_n=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),So=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),qt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function YA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw D.error("Invalid Channel Name ".concat(e)),new Oe(X.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function XA(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||d8(e,1,255)))throw new Oe(X.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&D.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Gp=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const yfe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},cx={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function lx(e,r){rs(e.url,"".concat(r,".url"),1,1e3,!1),Lr(e.x)||er(e.x,"".concat(r,".x"),0,1e4),Lr(e.y)||er(e.y,"".concat(r,".y"),0,1e4),Lr(e.width)||er(e.width,"".concat(r,".width"),0,1e4),Lr(e.height)||er(e.height,"".concat(r,".height"),0,1e4),Lr(e.zOrder)||er(e.zOrder,"".concat(r,".zOrder"),0,255),Lr(e.alpha)||er(e.alpha,"".concat(r,".alpha"),0,1,!1)}const vfe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let wm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),ux=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),bi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function sG(e){if(!e.channelName)throw new Oe(X.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Oe(X.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&rs(e.token,"info.token",1,2047),XA(e.uid),YA(e.channelName),!0}let To=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Hp=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),va=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Mv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),zn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Xi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),JA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Ui=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Vn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const oG=[Vn.AFRICA,Vn.ASIA,Vn.CHINA,Vn.EUROPE,Vn.GLOBAL,Vn.INDIA,Vn.JAPAN,Vn.NORTH_AMERICA,Vn.OCEANIA,Vn.OVERSEA,Vn.SOUTH_AMERICA];let Ps=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const QA={CHINA:{},ASIA:{CODE:Ps.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ps.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ps.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ps.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ps.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ps.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ps.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ps.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ps.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ps.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ps.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ps.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ps.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};kL&&(QA.CHINA={CODE:Ps.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let gb=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function aG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class cG extends Ar{constructor(r,i){super(),$(this,"onICEConnectionStateChange",void 0),$(this,"onConnectionStateChange",void 0),$(this,"onDTLSTransportStateChange",void 0),$(this,"onDTLSTransportError",void 0),$(this,"onICETransportStateChange",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoReceived",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"onICECandidateError",void 0),$(this,"getLocalVideoStats",void 0)}}class lG extends cG{constructor(r,i){super(r,i),$(this,"establishPromise",void 0)}}let mt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Os=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),$p=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const uG=["disconnected","failed"];let $e=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Wn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),kt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),lu=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),uu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Ji=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),dG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),mh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),gl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),fd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Uv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Qr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Vv=function(e){return e.ABORT="abort",e}({}),Rm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Sfe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Tfe={[qA.ACCESS_POINT]:{[vo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[vo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[vo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[vo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[vo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[vo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[vo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[qA.UNILBS]:{[cu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[cu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[cu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[cu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[cu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[cu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[cu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[cu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[cu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[cu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[cu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[cu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[qA.STRING_UID_ALLOCATOR]:{[ax.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[ax.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[ax.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Fv(e){const r=Tfe[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[e%1e4];if(!i){if(Math.floor(e/1e4)===qA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const bfe={[Lt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Lt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Lt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Lt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Lt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Lt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Lt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Lt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Lt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Lt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Lt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Lt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Lt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Lt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Lt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Lt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Lt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Lt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Lt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Lt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Lt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Lt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Lt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Lt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Lt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Lt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Lt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Lt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Lt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Lt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Lt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Lt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Lt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Lt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Lt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Lt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Lt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Lt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Lt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Lt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Lt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Lt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Lt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Lt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Lt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Lt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Lt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Lt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Lt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Lt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Lt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Lt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Lt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Lt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Lt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Lt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function _b(e){return bfe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function hG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function dx(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?hG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):hG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function pG(e,r){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(r){const u=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const wfe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Rfe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Cfe=/wss:\/\/(.+):([0-9]+)\/?/,Ife=/wss:\/\/(.[^\/]+)\/?/;let Afe=0;class Pfe{constructor(r,i){$(this,"id",0),$(this,"store",void 0),$(this,"recordIndex",void 0),$(this,"websockets",[]),$(this,"try443PortDuration",2e3),$(this,"forceCloseWSDuration",5e3),$(this,"try443PortTimeout",null),$(this,"forceCloseTimeout",null),$(this,"isTry443PortFailed",!1),$(this,"isNormalPortFailed",!1),$(this,"useDoubleDomain",!1),$(this,"useProxy",!1),$(this,"startTime",Date.now()),this.id=++Afe,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];D.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,o){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:o});const c=re("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var k;return ot(k=r.host).call(k,P)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(P=>{_.push(pG(dx(dx({},r),{},{host:r.host.replace(m,P)}),i))});else{const P=dx({},r);if(i&&m){const k=c.find(W=>W!==m);k&&(P.host=P.host.replace(m,k))}_.push(pG(P,i))}try{_.forEach(P=>{const k=new WebSocket(P);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,o);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Oe(X.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const y=nb();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(k=>{k!==P&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,y.resolve(P)},P.onclose=k=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const W=h.every(U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(W)),W&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),y.reject({code:k.code,reason:JA.A_ROUND_WS_FAILED})):!i&&W&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),i?this.isTry443PortFailed=W:this.isNormalPortFailed=W},P.onmessage=k=>this.logger("".concat(P.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(y.isResolved)return S();Rn().os===xi.MAC_OS&&Dr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{y.resolve(P)}).catch(P=>{this.isNormalPortFailed&&y.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(r,i,o,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(u){let h,m,_;return[,h,m,_]=u.match(wfe)||[],h||([,m,_]=u.match(Rfe)||[]),m&&_||([,m,_]=u.match(Cfe)||[]),m&&_||([,m]=u.match(Ife)||[]),m||D.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(D.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function fG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class mG extends Ar{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;ot(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(qt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(qt.CONNECTED):this._state==="closed"?this.emit(qt.CLOSED):this._state==="failed"&&this.emit(qt.FAILED))}resetReconnectCount(r){D.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"urls",[]),$(this,"_reconnectMode","tryNext"),$(this,"reconnectReason",void 0),$(this,"_initMutex",void 0),$(this,"name",void 0),$(this,"_state","closed"),$(this,"reconnectInterrupter",void 0),$(this,"websocket",void 0),$(this,"retryConfig",void 0),$(this,"reconnectCount",0),$(this,"forceCloseTimeout",5e3),$(this,"onlineReconnectListener",void 0),$(this,"useCompress",void 0),$(this,"tryDoubleDomain",!1),$(this,"use443PortOnly",!1),$(this,"wsInflateLength",0),$(this,"wsDeflateLength",0),$(this,"closeEstablishingWs",()=>{}),$(this,"store",void 0),$(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var k=arguments[P]!=null?arguments[P]:{};P%2?fG(Object(k),!0).forEach(function(W){$(R,W,k[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(k)):fG(Object(k)).forEach(function(W){Object.defineProperty(R,W,Object.getOwnPropertyDescriptor(k,W))})}return R}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new As("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=i,y=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);Ja.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S),oi.on(Ev.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===Ja.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{const c=nb(),u=this.urls[this.currentURLIndex];re("ENABLE_PREALLOC_PC")&&this.emit(dG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(qt.CLOSED,()=>{c.reject(new Le(X.WS_DISCONNECT))}),this.once(qt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void D.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),D.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(X.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new Le(X.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const o=nb();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),D.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(D.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Le(X.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Pc(this,qt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,k=await this.reconnectWithAction(P);if(this.state==="closed")return void D.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return o.reject(new Le(X.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(qt.ON_MESSAGE,S)},m=S=>{D.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=re("GATEWAY_WSS_ADDRESS")),D.debug("[".concat(this.name,"] start connect, url:"),r);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const R=this.state==="closed",P=S instanceof Le,k=P&&S.code===X.WS_ABORT,W=P&&S.code===X.WS_ERR,U=P?S.message:S&&(S.reason||S.toString());D.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[S]},_),R||W?(o.reject(R?new Le(X.WS_DISCONNECT,"websocket is closed: ".concat(U)):new Le(X.WS_ERR,"init websocket failed: ".concat(U))),W&&D.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(S)}return o.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;D.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||oi.isOnline||!oi.onlineWaiter||(this.onlineReconnectListener=oi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=bL(this.reconnectCount,this.retryConfig);D.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await lt.race([is(h),this.onlineReconnectListener||new lt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(qt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);D.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(D.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await vs(this,qt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;D.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&ot(m).call(m,"dynamic key expired")?(this.emit(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,i)}return!0}}class hx extends mG{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const o=nb(),c=function(h,m){return new Pfe(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Le(X.WS_ABORT,"choose best websocket aborted"))};const u=re("GATEWAY_DOMAINS");return D.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Eb extends mG{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new lt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),h.forEach(W=>{W.onclose=null,W.onopen=null,W.onmessage=null,W.close()}),c(new Le(X.WS_ABORT,"choose best websocket aborted"))};const m=re("GATEWAY_DOMAINS");let _;const y=r.indexOf("?h="),S=m.find(W=>y!==-1?ot(r).call(r,W,y):ot(r).call(r,W));D.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const W=Date.now();try{m.forEach(U=>{const V=y===-1?r.replace(S,U):r.substr(0,y)+r.substr(y).replace(S,U),q=new WebSocket(V);q.binaryType="arraybuffer",h.push(q),D.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(D.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(V=>V.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(U=>U.url),service:"gateway"},i),h.forEach(U=>{U.onopen=()=>{if(u)return;const V=Date.now()-W;D.debug("[choose-best-ws] ws open cost ".concat(V,"ms")),h.filter(q=>q!==U).forEach(q=>{D.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(U)},U.onclose=V=>{_=V,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(D.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},U.onmessage=V=>{D.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(V.data))}}),is(this.forceCloseTimeout).then(()=>{h.forEach(U=>{U.readyState!==WebSocket.OPEN&&U.close()})})}if(R){var k;let W;D.debug("[choose-best-ws] use single url: ",r),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[r],service:"gateway"},i);try{W=new WebSocket(r),h.push(W),W.binaryType="arraybuffer"}catch(U){const V=new Le(X.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return D.error("[".concat(this.name,"]").concat(V)),void c(V)}W.onopen=()=>{o(W)},W.onclose=U=>{c(U)},W.onmessage=U=>{D.debug("[choose-best-ws]".concat(W.url," onmessage: ").concat(U.data))},is(this.forceCloseTimeout).then(()=>{W&&W.readyState!==WebSocket.OPEN&&W.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Ofe extends Ar{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lr.CONNECTED?this.emit(Bt.WS_CONNECTED):r===lr.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):r===lr.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new I8(5)),$(this,"pingpongTimer",void 0),$(this,"wsInflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Bn.UID_BANNED);break;case 15:this.close(Bn.IP_BANNED);break;case 16:this.close(Bn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Bn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Bn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Bn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Bn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Bn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Bn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new hx("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",ys.OFFLINE)})}async request(r,i,o,c){const u=or(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new lt((W,U)=>{if(this.connectionState===lr.CONNECTED)return W();const V=()=>{this.off(Bt.WS_CLOSED,q),W()},q=()=>{this.off(Bt.WS_CONNECTED,V),U(new Oe(X.WS_ABORT))};this.once(Bt.WS_CONNECTED,V),this.once(Bt.WS_CLOSED,q),r!==jt.PUBLISH&&r!==jt.PUBLISH_DATASTREAM&&r!==jt.SUBSCRIBE&&r!==jt.SUBSCRIBE_DATASTREAM&&r!==jt.UNSUBSCRIBE&&r!==jt.UNSUBSCRIBE_DATASTREAM&&r!==jt.UNPUBLISH&&r!==jt.UNPUBLISH_DATASTREAM&&r!==jt.CONTROL&&r!==jt.RESTART_ICE||this.once(Bt.DISCONNECT_P2P,()=>{U(new Oe(X.DISCONNECT_P2P))}),r!==jt.PUBLISH&&r!==jt.RESTART_ICE||this.once(Bt.ABORT_P2P_EXECUTION,()=>{U(new Oe(X.DISCONNECT_P2P))})});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new lt((W,U)=>{let V=!1;const q=(ce,_e)=>{V=!0,W({isSuccess:ce==="success",message:_e||{}}),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.emit(Bt.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Oe(X.WS_ABORT,"type: ".concat(r))),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Bt.WS_CLOSED,Y),this.once(Bt.WS_RECONNECTING,Y),is(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Bt.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await y}catch(W){if(this.connectionState===lr.CLOSED||r===jt.LEAVE)throw new Oe(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?W.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=_b(R),k=new Oe(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ys.MULTI_IP)):this.reconnect(P.action,ys.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new lt(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(mb.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((i,o)=>{this.once(Bt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Bt.WS_CLOSED,c=>o(this.initError||new Oe(X.WS_ABORT,c))),this.connectionState=lr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Bn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION);const r=await vs(this,Bt.REQUEST_JOIN_INFO),i=await this.request(jt.JOIN,r);if(!i)return this.emit(Bt.REPORT_JOIN_GATEWAY,JA.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(X.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=cb(this,Bt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(jt.REJOIN,r);return!!i&&(this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(_n.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(_n.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(_n.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(_n.MUTE_AUDIO,{uid:o.uid}):this.emit(_n.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(_n.MUTE_VIDEO,{uid:o.uid}):this.emit(_n.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(_n.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(_n.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(_n.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleNotification(r){D.debug("[".concat(this.clientId,"] receive notification: "),r);const i=_b(r.code);if(r.code===28&&"detail"in r&&(D.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Bt.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Bn.UID_BANNED),void this.close()):void this.reconnect(i.action,ys.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(D.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ys.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(mb.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(qt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(qt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(qt.FAILED,()=>{this._disconnectedReason=Bn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(qt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(qt.WILL_RECONNECT,(r,i,o)=>{const c=cb(this,Bt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(D.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=JA.P2P_DISCONNECTED),u&&(D.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Bt.REPORT_JOIN_GATEWAY,i||JA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Bt.DISCONNECT_P2P)),o(r)}),this.websocket.on(qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{D.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",ys.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Lt.ERR_NO_AUTHORIZED)return this.initError=new Oe(X.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Bn.TOKEN_EXPIRE);D.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ys.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(qt.REQUEST_NEW_URLS,(r,i)=>{vs(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(dG.PRE_CONNECT_PC,()=>{this.emit(Bt.PRE_CONNECT_PC)})}}let kfe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ai=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function gG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ZA(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?gG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):gG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Cm(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(D.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function px(e,r){e.addresses||(e.addresses=[]);const i=function(m,_){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:k}=R;return{address:"".concat(P,":").concat(k)}});const y=re("GATEWAY_DOMAINS");let S=y[1]&&ot(_).call(_,y[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:k,ip:W}=R;if(P)return{address:"".concat(P,".").concat(y[S++%y.length],":").concat(k)};const U=/^[\.\:\d]+$/.test(W),V=U?"".concat(W.replace(/[^\d]/g,"-"),".").concat(y[S++%y.length],":").concat(k):"".concat(W,":").concat(k);return U||D.debug("Cannot recognized as ip address: ".concat(W,", use as host")),{ip:W,port:k,address:V}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const y=Js(c=m[_]).call(c);i[_]&&y&&(i[_].ip6=y)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Qa(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function _G(e){const r=e._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(Qa(r.width),"x").concat(Qa(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function EG(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function yb(e,r){let i,o,c;switch(r){case ai.CHOOSE_SERVER:o=4096,c="choose server";break;case ai.CLOUD_PROXY:o=1048576,c="proxy";break;case ai.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case ai.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(X.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>ZA(ZA({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:ZA(ZA({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new Oe(X.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function yG(e,r){return await lt.all(e.addresses.map(async i=>({address:re("USE_TURN_IP")?i.ip:Cm(i.ip),tcpport:i.port,udpport:i.port,username:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Ss.username,password:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await yL(r.toString()):Ss.password})))}function fx(e,r){const i=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||i.height,c=r.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Qa(e.height),Qa(e.width)),1):(D.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Im(e){let{candidateType:r,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:r,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function eP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(r){return r in PA}(e)?e:PA.L1T3}const vG={[mt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[mt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function tP(e,r,i){r.forEach(o=>{var c;const u=vG[e].find(m=>{var _;let{key:y}=m;return ot(_=o.extensionName).call(_,y)});if(!u)return;const h=i.find(m=>{let{extensionName:_}=m;return ot(_).call(_,u.key)});h&&ot(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function jv(e,r){r.forEach(i=>{var o;const c=vG[e].find(u=>{var h;let{key:m}=u;return ot(h=i.extensionName).call(h,m)});ot(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function SG(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ot(e).call(e,"abs-send-time")}function nP(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ot(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function TG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function bG(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?TG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function vb(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=r,{useXR:y}=i;let S=[],R=[],P=[],k=[],W=!1,U=!1;if(ya(e).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||W||(R=q.attributes.payloads,k=q.attributes.extmaps,W=!0),q.media.mediaType!=="audio"||U||(S=q.attributes.payloads,P=q.attributes.extmaps,U=!0))}),!k||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(S=S.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var Y;return ot(m).call(m,((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=R.filter(Y=>{var ce;return ot(_).call(_,((ce=Y.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLowerCase())||"")});R=q.concat(c?[]:_x(q,R))}const V=re("UNSUPPORTED_VIDEO_CODEC");return V&&V.length>0&&(R=R.filter(q=>!(q.rtpMap&&ot(V).call(V,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:k}}function Am(e){const r=ya(e);let i,o;for(const c of r.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function wG(e,r){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:r?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function RG(e,r,i){const{cname:o}=e;let c=[];r&&(c=CG(r)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),D.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=iP(e.rtpCapabilities),y=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{y.push({kind:mt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:mt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:y}}function CG(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],D.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),D.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function x_(e,r,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=or(8,"track-"),y={ssrcId:h,attributes:bG({label:_,mslabel:i=i||or(10,""),msid:"".concat(i," ").concat(_)},r&&{cname:r})};if(o.push(y),m!==void 0){const S={ssrcId:m,attributes:bG({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function Bv(e,r){r instanceof Br&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Dr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function mx(e){const r=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function gx(e,r){var i;if(!(r instanceof gr&&r._encoderConfig&&r._hints.indexOf(ar.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;kn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),kn().supportMinBitrate&&!ot(i=r._hints).call(i,ar.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function IG(e){if(e.media.mediaType!=="video")return;const r=Rn();if(r.name!==Un.SAFARI&&r.os!==xi.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function rP(e,r,i){if(!r)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const u=o.find(h=>nP(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>nP(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>nP(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>SG(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=e.attributes.extmaps.findIndex(h=>SG(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function AG(e,r,i){if(Dr()||e.media.mediaType!=="video"||!(r instanceof gr)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!re("SIMULCAST")||i==="vp9"&&re("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Mr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Mr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function PG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=vb(y,m,_,"sendonly"),R=vb(y,m,_,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(du(S,R,"videoExtensions",P,k,W),du(S,R,"videoCodecs",P,k,W),du(S,R,"audioExtensions",P,k,W),du(S,R,"audioCodecs",P,k,W),re("RAISE_H264_BASELINE_PRIORITY")){const U=[],V=[];W.videoCodecs.forEach((q,Y)=>{var ce;if(((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){var _e,ye;const me=W.videoCodecs[Y+1],ke=me&&LG(q,me),Ye=(_e=q.fmtp)===null||_e===void 0?void 0:_e.parameters["profile-level-id"],ut=(ye=q.fmtp)===null||ye===void 0?void 0:ye.parameters["packetization-mode"];!Ye||Ye!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&ut!==re("FIRST_PACKETIZATION_MODE")?ke?V.push([q,me]):V.push([q]):ke?U.push([q,me]):U.push([q])}}),U.length>0&&V.length>0&&(D.debug("raising H264 baseline profile priority"),W.videoCodecs.forEach((q,Y)=>{var ce;if(((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){const _e=LG(q,W.videoCodecs[Y+1]),ye=U.shift()||V.shift()||[];ye.length>0&&(_e?W.videoCodecs.splice(Y,2,...ye):W.videoCodecs.splice(Y,1,...ye))}}),k.videoCodecs=k.videoCodecs.filter(q=>{var Y,ce;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((ce=q.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}),re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>{var Y,ce;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((ce=q.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:k,sendrecv:W}}(e,r,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function OG(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=vb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(du(e,r,"videoExtensions",i,o,c),du(e,r,"videoCodecs",i,o,c),du(e,r,"audioExtensions",i,o,c),du(e,r,"audioCodecs",i,o,c),re("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){D.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function du(e,r,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(m=>{r[i].some((_,y)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(m=>{r[i].some((_,y)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}}function iP(e){const{send:r,recv:i,sendrecv:o}=e;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function Wv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function Sb(e,r,i,o){let c=[];if(e===mt.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(i.videoCodecs.forEach(y=>{const S=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";ot(S).call(S,o)?u.push(y):ot(S).call(S,"vp9")?h.push(y):ot(S).call(S,"vp8")?m.push(y):ot(S).call(S,"h264")&&_.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):_.length!==0&&(u=_,y="h264"),D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=r.videoCodecs.filter(y=>u.some(S=>S.payloadType===y.payloadType)))}if(c.length===0&&(D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const u=_x(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function _x(e,r){const i=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&ot(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function Tb(e,r,i){const o=r.toString(),c=NG(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=kG(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function kG(e,r,i){const o=ya(e),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!ot(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&Wv(u),c&&ot(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),bm(o)}function NG(e,r,i,o){if(re("SDP_LOGGING"))return D.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?c=>{NG(c,"answer",i==="local"?"remote":"local",o)}:void 0}function DG(e){const r=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>ot(e).call(e,i))}function LG(e,r){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function xG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _l(e,r){return typeof re(e)===r?re(e):void 0}function Nfe(){try{const e=re("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?xG(Object(o),!0).forEach(function(c){$(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):xG(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e)}catch(e){return D.debug("handle gateway attributes failed: ",e),{}}}const MG={};function Pm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&D.debug("install service ".concat(e.name)),MG[e.name]=e}function Kp(e){const r=MG[e];if(!r)throw new Le(X.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function UG(e,r){return Kp("DataStream").create(e,r)}function sP(){return Kp("InterceptFrame").create()}function VG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function qp(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?VG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):VG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Ex=new Map;class Dfe extends Ar{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(Xi.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(Xi.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){D.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var o,c,u;super(),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"key",void 0),$(this,"ntpOffset",0),$(this,"signal",void 0),$(this,"role",void 0),$(this,"inChannelInfo",{joinAt:null,duration:0}),$(this,"spec",void 0),$(this,"_state","DISCONNECTED"),$(this,"_statsCollector",void 0),$(this,"_disconnectedReason",void 0),$(this,"isSignalRecover",!1),$(this,"hasChangeBGPAddress",!1),$(this,"trafficStatsInterval",void 0),$(this,"networkQualityInterval",void 0),$(this,"_joinGatewayStartTime",0),$(this,"_signalTimeout",!1),$(this,"_clientRoleOptions",void 0),$(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(o={spec:qp(qp({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(u=Kp("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Ofe(qp(qp({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(r,i,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=Ex.get(r.cname);if(u||(u=new Map,Ex.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const y=new Oe(X.UID_CONFLICT);throw wt.joinGateway(r.sid,{lts:c,succ:!1,ec:y.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),y}u.set(r.uid,!0),this.joinInfo=r,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{D.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const y=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,k]=R.split(":"),W={host:P,port:k};return r.proxyServer&&(W.proxy=r.proxyServer),W});h=(await this.signal.init(y)).uid,D.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var _;throw D.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),wt.joinGateway(r.sid,{lts:c,succ:!1,ec:((_=y.data)===null||_===void 0?void 0:_.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),D.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{D.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Xi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Xi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Xi.NETWORK_QUALITY,{uplinkNetworkQuality:EG(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:EG(this._statsCollector.trafficStats.B_dnq)}):this.emit(Xi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Bn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==lr.CONNECTED||await function(o,c){return c===1/0?o:lt.race([o,ipe(c)])}(this.signal.request(jt.LEAVE,void 0,!0),3e3)}catch(o){D.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Bn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(jt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw u}}async publishDataChannel(r,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(jt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw h}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(jt.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(o){D.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(r.map(i=>this.signal.request(jt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){D.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,i,!1);throw u}}async subscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(jt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw u}}async subscribeDataChannel(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(jt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw u}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(i)return this.signal.request(jt.SET_VIDEO_PROFILE,i);D.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(o){D.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(r.map(o=>this.signal.request(jt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){D.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){D.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(jt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(jt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(jt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(jt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,i){await this.signal.request(jt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(jt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(jt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(jt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(jt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),qp({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(jt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=Ex.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Ss.username,password:Ss.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(qp(qp({},Ss),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(jt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&RA(()=>{this.emit(Xi.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(X.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=re("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Xi.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,ot(xv).call(xv,c)||xv.push(c);const u=!(Dr()||n8(87)||H8())&&typeof re("ENABLE_PRE_SUB")=="boolean"&&re("ENABLE_PRE_SUB"),h=!H8()&&_l("ENABLE_PREALLOC_PC","boolean"),m=Nfe(),_=rb(87)||function(){const S=Rn();if(S.name!==Un.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),y=qp({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:pl,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:qp({enableEncodedTransform:!!re("ENABLE_AUDIO_METADATA")&&_||!!re("ENABLE_AUDIO_TOPN")&&dL(Un.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!re("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:_l("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:_l("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:_l("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!re("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:_l("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:_l("USE_XR","boolean"),enableLossbasedBwe:_l("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("ENABLE_AUT_CC")||void 0,enableCCFallback:_l("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?_l("PRE_SUB_NUM","number"):void 0,enablePubTWCC:_l("PUBLISH_TWCC","boolean"),enableSubTWCC:_l("SUBSCRIBE_TWCC","boolean"),enablePubRTX:_l("USE_PUB_RTX","boolean"),enableSubRTX:_l("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new Oe(X.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Bt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Bt.WS_RECONNECTING,r=>{this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||ys.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",wt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Bt.WS_CLOSED,r=>{let i;switch(r){case Bn.LEAVE:i=ys.LEAVE;break;case Bn.UID_BANNED:case Bn.IP_BANNED:case Bn.CHANNEL_BANNED:case Bn.SERVER_ERROR:i=ys.SERVER_ERROR;break;case Bn.FALLBACK:i=ys.FALLBACK;break;case Bn.LICENSE_MISSING:case Bn.LICENSE_EXPIRED:case Bn.LICENSE_MINUTES_EXCEEDED:case Bn.LICENSE_PERIOD_INVALID:case Bn.LICENSE_MULTIPLE_SDK_SERVICE:case Bn.LICENSE_ILLEGAL:case Bn.TOKEN_EXPIRE:i=r;break;default:i=ys.NETWORK_ERROR}D.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+ys.NETWORK_ERROR)),this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Bn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==Bn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Bt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(D.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void D.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));Xn("EVENT_REPORT_DOMAIN",r[1]),Xn("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Xn("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(_n.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Bt.REQUEST_RECOVER,(r,i,o)=>{if(!this.joinInfo)return o(new Oe(X.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,vs(this,Xi.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Bt.REQUEST_JOIN_INFO,async(r,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=Mr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(re("NEW_TURN_MODE")&&u){let y=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;y.length>0&&(y=[y[R%y.length]],u.servers=y),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),D.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await vs(this,Xi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(y){i(y)}}),this.signal.on(Bt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Bt.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Oe?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Bt.IS_P2P_DISCONNECTED,r=>{r(cb(this,Xi.IS_P2P_DISCONNECTED))}),this.signal.on(Bt.DISCONNECT_P2P,()=>{this.emit(Xi.DISCONNECT_P2P)}),this.signal.on(Bt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Bt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Bt.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit(Xi.JOIN_RESPONSE,r,i)}),this.signal.on(Bt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),i=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&i){const o=CG(r);this.emit(Xi.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(Bt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(jt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw D.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(jt.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(jt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw D.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const i={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,i){const o={action:r.find(c=>c.stream_type===zn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const o={action:r.find(c=>c.stream_type===zn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const o={action:r===mt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const o={action:r===mt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(jt.RESTART_ICE,i,!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||ys.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(D.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(jt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let oP=0,yx=0;function md(e,r,i,o){return new lt((c,u)=>{r.timeout=r.timeout||re("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),oP+=uh(r.data)):i&&(r.data.size?oP+=r.data.size:r.data instanceof FormData?oP+=v8(r.data):oP+=uh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Go.request(r).then(h=>{typeof h.data=="string"?yx+=uh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?yx+=h.data.byteLength:yx+=uh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Go.isCancel(h)?u(new Oe(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(X.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(je){var st=0;return function(){return st<je.length?{done:!1,value:je[st++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,st,St){return je==Array.prototype||je==Object.prototype||(je[st]=St.value),je},o,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var st=0;st<je.length;++st){var St=je[st];if(St&&St.Math==Math)return St}throw Error("Cannot find global object")}(this);function u(je,st){if(st)e:{var St=c;je=je.split(".");for(var We=0;We<je.length-1;We++){var x=je[We];if(!(x in St))break e;St=St[x]}(st=st(We=St[je=je[je.length-1]]))!=We&&st!=null&&i(St,je,{configurable:!0,writable:!0,value:st})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var st=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return st?st.call(je):{next:r(je)}}if(u("Symbol",function(je){function st(x,ie){this.A=x,i(this,"description",{configurable:!0,writable:!0,value:ie})}if(je)return je;st.prototype.toString=function(){return this.A};var St="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",We=0;return function x(ie){if(this instanceof x)throw new TypeError("Symbol is not a constructor");return new st(St+(ie||"")+"_"+We++,ie)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var st="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),St=0;St<st.length;St++){var We=c[st[St]];typeof We=="function"&&typeof We.prototype[je]!="function"&&i(We.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var y={};try{y.__proto__={a:!0},_=y.a;break e}catch{}_=!1}o=_?function(je,st){if(je.__proto__=st,je.__proto__!==st)throw new TypeError(je+" is not extensible");return je}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function k(je,st){return je.h=3,{value:st}}function W(je){this.g=new R,this.G=je}function U(je,st,St,We){try{var x=st.call(je.g.j,St);if(!(x instanceof Object))throw new TypeError("Iterator result "+x+" is not an object");if(!x.done)return je.g.m=!1,x;var ie=x.value}catch(ue){return je.g.j=null,je.g.s(ue),V(je)}return je.g.j=null,We.call(je.g,ie),V(je)}function V(je){for(;je.g.h;)try{var st=je.G(je.g);if(st)return je.g.m=!1,{value:st.value,done:!1}}catch(St){je.g.v=void 0,je.g.s(St)}if(je.g.m=!1,je.g.l){if(st=je.g.l,je.g.l=null,st.F)throw st.D;return{value:st.return,done:!0}}return{value:void 0,done:!0}}function q(je){this.next=function(st){return je.o(st)},this.throw=function(st){return je.s(st)},this.return=function(st){return function(St,We){P(St.g);var x=St.g.j;return x?U(St,"return"in x?x.return:function(ie){return{value:ie,done:!0}},We,St.g.return):(St.g.return(We),V(St))}(je,st)},this[Symbol.iterator]=function(){return this}}function Y(je,st){return st=new q(new W(st)),S&&je.prototype&&S(st,je.prototype),st}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},W.prototype.o=function(je){return P(this.g),this.g.j?U(this,this.g.j.next,je,this.g.o):(this.g.o(je),V(this))},W.prototype.s=function(je){return P(this.g),this.g.j?U(this,this.g.j.throw,je,this.g.o):(this.g.s(je),V(this))},u("Array.prototype.entries",function(je){return je||function(){return function(st,St){st instanceof String&&(st+="");var We=0,x=!1,ie={next:function(){if(!x&&We<st.length){var ue=We++;return{value:St(ue,st[ue]),done:!1}}return x=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(st,St){return[st,St]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ce=function(je,st){for(var St=0;St<je.length;St++)st(je[St])},_e=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},ye=function(je,st,St){return st instanceof Blob?(St=St!==void 0?St+"":typeof st.name=="string"?st.name:"blob",st.name===St&&Object.prototype.toString.call(st)!=="[object Blob]"||(st=new File([st],St)),[String(je),st]):[String(je),String(st)]},me=function(je,st){if(je.length<st)throw new TypeError(st+" argument required, but only "+je.length+" present.")},ke=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ye=ke.FormData,ut=ke.XMLHttpRequest&&ke.XMLHttpRequest.prototype.send,pt=ke.Request&&ke.fetch,yn=ke.navigator&&ke.navigator.sendBeacon,vn=ke.Element&&ke.Element.prototype,cr=ke.Symbol&&Symbol.toStringTag;cr&&(Blob.prototype[cr]||(Blob.prototype[cr]="Blob"),"File"in ke&&!File.prototype[cr]&&(File.prototype[cr]="File"));try{new File([],"")}catch{ke.File=function(st,St,We){return st=new Blob(st,We||{}),Object.defineProperties(st,{name:{value:St},lastModified:{value:+(We&&We.lastModified!==void 0?new Date(We.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),cr&&Object.defineProperty(st,cr,{value:"File"}),st}}var Zr=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Wr=function(je){this.i=[];var st=this;je&&ce(je.elements,function(St){if(St.name&&!St.disabled&&St.type!=="submit"&&St.type!=="button"&&!St.matches("form fieldset[disabled] *"))if(St.type==="file"){var We=St.files&&St.files.length?St.files:[new File([],"",{type:"application/octet-stream"})];ce(We,function(x){st.append(St.name,x)})}else St.type==="select-multiple"||St.type==="select-one"?ce(St.options,function(x){!x.disabled&&x.selected&&st.append(St.name,x.value)}):St.type==="checkbox"||St.type==="radio"?St.checked&&st.append(St.name,St.value):(We=St.type==="textarea"?_e(St.value):St.value,st.append(St.name,We))})};if((e=Wr.prototype).append=function(je,st,St){me(arguments,2),this.i.push(ye(je,st,St))},e.delete=function(je){me(arguments,1);var st=[];je=String(je),ce(this.i,function(St){St[0]!==je&&st.push(St)}),this.i=st},e.entries=function je(){var st,St=this;return Y(je,function(We){if(We.h==1&&(st=0),We.h!=3)return st<St.i.length?We=k(We,St.i[st]):(We.h=0,We=void 0),We;st++,We.h=2})},e.forEach=function(je,st){me(arguments,1);for(var St=m(this),We=St.next();!We.done;We=St.next()){var x=m(We.value);We=x.next().value,x=x.next().value,je.call(st,x,We,this)}},e.get=function(je){me(arguments,1);var st=this.i;je=String(je);for(var St=0;St<st.length;St++)if(st[St][0]===je)return st[St][1];return null},e.getAll=function(je){me(arguments,1);var st=[];return je=String(je),ce(this.i,function(St){St[0]===je&&st.push(St[1])}),st},e.has=function(je){me(arguments,1),je=String(je);for(var st=0;st<this.i.length;st++)if(this.i[st][0]===je)return!0;return!1},e.keys=function je(){var st,St,We,x,ie=this;return Y(je,function(ue){if(ue.h==1&&(st=m(ie),St=st.next()),ue.h!=3)return St.done?void(ue.h=0):(We=St.value,x=m(We),k(ue,x.next().value));St=st.next(),ue.h=2})},e.set=function(je,st,St){me(arguments,2),je=String(je);var We=[],x=ye(je,st,St),ie=!0;ce(this.i,function(ue){ue[0]===je?ie&&(ie=!We.push(x)):We.push(ue)}),ie&&We.push(x),this.i=We},e.values=function je(){var st,St,We,x,ie=this;return Y(je,function(ue){if(ue.h==1&&(st=m(ie),St=st.next()),ue.h!=3)return St.done?void(ue.h=0):(We=St.value,(x=m(We)).next(),k(ue,x.next().value));St=st.next(),ue.h=2})},Wr.prototype._asNative=function(){for(var je=new Ye,st=m(this),St=st.next();!St.done;St=st.next()){var We=m(St.value);St=We.next().value,We=We.next().value,je.append(St,We)}return je},Wr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),st=[],St="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(We,x){return typeof We=="string"?st.push(St+Zr(_e(x))+`"\r
\r
`+_e(We)+`\r
`):st.push(St+Zr(_e(x))+'"; filename="'+Zr(We.name)+`"\r
Content-Type: `+(We.type||"application/octet-stream")+`\r
\r
`,We,`\r
`)}),st.push("--"+je+"--"),new Blob(st,{type:"multipart/form-data; boundary="+je})},Wr.prototype[Symbol.iterator]=function(){return this.entries()},Wr.prototype.toString=function(){return"[object FormData]"},vn&&!vn.matches&&(vn.matches=vn.matchesSelector||vn.mozMatchesSelector||vn.msMatchesSelector||vn.oMatchesSelector||vn.webkitMatchesSelector||function(je){for(var st=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--st&&je.item(st)!==this;);return-1<st}),cr&&(Wr.prototype[cr]="FormData"),ut){var Xo=ke.XMLHttpRequest.prototype.setRequestHeader;ke.XMLHttpRequest.prototype.setRequestHeader=function(je,st){Xo.call(this,je,st),je.toLowerCase()==="content-type"&&(this.B=!0)},ke.XMLHttpRequest.prototype.send=function(je){je instanceof Wr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),ut.call(this,je)):ut.call(this,je)}}pt&&(ke.fetch=function(je,st){return st&&st.body&&st.body instanceof Wr&&(st.body=st.body._blob()),pt.call(this,je,st)}),yn&&(ke.navigator.sendBeacon=function(je,st){return st instanceof Wr&&(st=st._asNative()),yn.call(this,je,st)}),ke.FormData=Wr}})();const bb=()=>{const e=re("AREAS");return e.length===0&&e.push(Vn.GLOBAL),Ga(e).call(e,(r,i,o)=>{const c=FG(i);return c?o===0?c:"".concat(r,",").concat(c):r},"")},FG=e=>e===Vn.OVERSEA?"".concat(Ps.ASIA,",").concat(Ps.EUROPE,",").concat(Ps.AFRICA,",").concat(Ps.NORTH_AMERICA,",").concat(Ps.SOUTH_AMERICA,",").concat(Ps.OCEANIA):Ps[e],Lfe=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=QA[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},aP={GLOBAL:{ASIA:[Vn.CHINA,Vn.JAPAN,Vn.INDIA,Vn.KOREA,Vn.HKMC],EUROPE:[],NORTH_AMERICA:[Vn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},cP=Object.keys(aP[Vn.GLOBAL]),vx=[Vn.CHINA,Vn.NORTH_AMERICA,Vn.EUROPE,Vn.ASIA,Vn.JAPAN,Vn.INDIA,Vn.OCEANIA,Vn.SOUTH_AMERICA,Vn.AFRICA,Vn.KOREA,Vn.HKMC,Vn.US],xfe=function(e,r){let i=[];if(ot(e).call(e,Vn.GLOBAL)){const u=[Vn.GLOBAL,Vn.OVERSEA],h=Object.keys(QA);if(r===Vn.GLOBAL)throw new Oe(X.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Vn.CHINA)i=[Vn.OVERSEA];else if(c=r,ot(cP).call(cP,c)){const m=(o=r,aP[Vn.GLOBAL][o]||[]),_=[...u,r,...m];i=h.filter(y=>!ot(_).call(_,y))}else if(function(m){let _=!1;return cP.forEach(y=>{var S;ot(S=aP[Vn.GLOBAL][y]).call(S,m)&&(_=!0)}),_}(r)){const m=function(y){let S;return cP.forEach(R=>{var P;ot(P=aP[Vn.GLOBAL][R]).call(P,y)&&(S=R)}),S}(r),_=[...u,m,r];i=h.filter(y=>!ot(_).call(_,y))}else i=e;i=function(m){const _=[];return vx.forEach(y=>{ot(m).call(m,y)&&_.push(y)}),_.concat(m.filter(y=>!ot(vx).call(vx,y)))}(i)}else i=e;var o,c;return i};function jG(e){var r,i;if(!e&&ot(r=re("AREAS")).call(r,Vn.EXTENSIONS))return D.debug("update area from ap : reset"),void Sx(Gpe,!0);if(!ot(i=re("AREAS")).call(i,Vn.GLOBAL)||!e)return;let o=QA.EXTENSIONS;o&&(o={CODE:FG(Vn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},D.debug("update area from ap success: ".concat(e,",config is "),o),Xn("AREAS",[Vn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Xn(c,o[c][0]):Xn(c,o[c])}))}function Sx(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=wt.reportApiInvoke(null,{name:mi.SET_AREA,options:e,tag:xr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!ot(oG).call(oG,u))throw new Oe(X.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Oe(X.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?xfe(m,h):m}if(!r){if(dd.AREAS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void D.warning("setArea is prohibited because of config-distribute")}if(ot(o).call(o,Vn.GLOBAL)&&re("AREAS")===Vn.EXTENSIONS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void D.warning("setArea is prohibited because of ap extensions")}}Xn("AREAS",o,r);const c=Lfe(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Xn(u,c[u][0]):Xn(u,c[u])}),D.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function BG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function gh(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?BG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Tx=1;function Mfe(e,r,i,o,c){Tx+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:Tx,requestId:Tx,version:pl,cname:i.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,_,y=e[0];return ud(async()=>{m=Date.now();const S=await md(y,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw D.error(k.toString()),k}const R=JSON.parse(S.json_body);if(R.code!==200){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:_});throw D.error(k.toString()),k}if(!R.servers||R.servers.length===0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:_});throw D.error(k.toString()),k}const P=function(k,W){return{addressList:k.servers.map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(W))),workerToken:k.workerToken,vid:k.vid}}(R,r);return re("LIVE_STREAMING_ADDRESS")&&(P.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),gh(gh({},P),{},{responseTime:_})},(S,R)=>(wt.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:_,serverIp:e[R%e.length]}),!1),(S,R)=>(wt.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:_,serverIp:e[R%e.length]}),!!(S.code!==X.OPERATION_ABORTED&&S.code!==X.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(y=e[(R+1)%e.length],!0)),c)}let bx=1;function WG(e,r,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=r,_=Date.now();let y;const S=r.role,[R,P]=Rx(r,u,[ai.CHOOSE_SERVER]);let k=oi.networkState;return ud(async()=>{k&&oi.networkState===Ja.OFFLINE&&oi.onlineWaiter&&await lt.race([oi.onlineWaiter,is(o&&o.maxRetryTimeout||gi.maxRetryTimeout)]),k=oi.networkState;const{data:W,headers:U}=await md(c,{data:R,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=U.http3==="1"?1:-1,wt.reportResourceTiming(c,m),GG(W,c,r,_,[ai.CHOOSE_SERVER],y);const V=yb(W,ai.CHOOSE_SERVER);return wx(V),px(V,c)},W=>(W&&wt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:P,serverList:W.gatewayAddrs.map(U=>U.address),ec:null,cid:W.cid.toString(),uid:W.uid.toString(),csIp:W.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:W.res.detail&&W.res.detail[38]}),!1),W=>W.code!==X.OPERATION_ABORTED&&(W.code===X.CAN_NOT_GET_GATEWAY_SERVER?W.data.retry:(wt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:P,ec:W.code,csIp:W.data&&W.data.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:y,corssRegionTagReq:r.apRequestDetail}),D.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),W),!0)),o)}function zG(e,r,i,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),y=r.role,[S,R]=Rx(r,h,m);let P;return ud(async()=>{P&&oi.networkState===Ja.OFFLINE&&oi.onlineWaiter&&await lt.race([oi.onlineWaiter,is(o&&o.maxRetryTimeout||gi.maxRetryTimeout)]),P=oi.networkState;const{data:k,headers:W}=await md(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=W.http3==="1"?1:-1,wt.reportResourceTiming(u,r.sid),GG(k,u,r,_,m,c);const U=yb(k,ai.CHOOSE_SERVER),V=yb(k,r.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK);return wx(U),{gatewayInfo:px(U,u),proxyInfo:V,url:u}},k=>(k.gatewayInfo&&wt.joinChooseServer(r.sid,{role:y,lts:_,succ:!0,csAddr:u,serverList:k.gatewayInfo.gatewayAddrs.map(W=>W.address),ec:null,opid:R,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38]}),k.proxyInfo&&wt.joinWebProxyAP(r.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:k.proxyInfo.addresses.map(W=>W.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==X.OPERATION_ABORTED&&(k.code===X.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(wt.joinWebProxyAP(r.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:k.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),D.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),k),!0)),o)}const GG=(e,r,i,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=i,y=[],S=R=>{R.flag===4096?wt.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||wt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const k={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};y.push(k),S(k)}if(P!==0){const k=Fv(P),W={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?D.warning(W.error.toString()):y.push(W),S(W)}}),y.length)throw D.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!y.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},wx=e=>{var r,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(re("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?jG(e.detail[23].toLowerCase()):jG()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const y=Js(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=y)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){D.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const h=re("GATEWAY_ADDRESS").map(m=>{var _,y;const S=(_=(y=e.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},Ufe=(e,r)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=Fv(i.buffer.code);throw new Oe(X.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw D.debug("update ticket request received ap response without response body:",r),new Oe(X.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Rx=(e,r,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:gh(gh(gh({6:e.stringUid,11:r,12:re("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Vfe=(e,r)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let zv=0;function Gv(e){return lt.all(e.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const wb=async e=>{let{fragementLength:r,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=r;let _,y=0;const S=async()=>{const R=(()=>{const P=h*m,k=P+m;return i.slice(P,k).map(o)})();u&&u.push(...R);try{_=await Gv(R)}catch(P){if(y+=m,h++,!(y>=i.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),_},HG=async e=>{let{referenceList:r,asyncMapHandler:i,closeFn:o}=e;const c=r.length;let u=0;const h=async()=>{const m=i(r.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function Cx(e,r,i,o){return{gatewayInfo:await async function(u,h,m,_){let y=null;const S=[],R=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:bb()})),W=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await wb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to choose_server:"),V.url),WG(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U},P=async()=>{if(await is(1e3),y!==null)return y;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:bb()})),W=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await wb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),V.url),WG(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U};try{return y=await Gv([R(),P()]),S.length&&S.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),y}catch(k){throw k[0]}}(e,r,i,o)}}async function $G(e,r,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await Cx(e,r,i,c);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:k}=await YG(e,r,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:P};const W=k.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||Ss.tcpport,udpport:U.udpport||Ss.udpport,username:U.username||Ss.username,password:U.password||Ss.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const U=(h=e.uid)!==null&&h!==void 0?h:P.uid,V="glb:".concat(U.toString()),q=await yL(V),Y=k.map(ce=>({turnServerURL:ce.address,tcpport:ce.tcpport||Ss.tcpport,udpport:ce.udpport||Ss.udpport,username:V,password:q,forceturn:!1,security:!0}));W.push(...Y)}return e.turnServer={mode:"manual",servers:W},{gatewayInfo:P}}return await Cx(e,r,i,c)}const{proxyInfo:m,gatewayInfo:_}=await YG(e,r,i,c),y={gatewayInfo:_},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:Ss.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:Ss.udpport,username:P.username||Ss.username,password:P.password||Ss.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=e.uid)!==null&&R!==void 0?R:_.uid,k="glb:".concat(P.toString()),W=await yL(k),U=m.map(V=>({turnServerURL:V.address,tcpport:u==="proxy3"?void 0:V.tcpport||Ss.tcpport,udpport:u==="proxy4"?void 0:V.udpport||Ss.udpport,username:k,password:W,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...U)}return e.turnServer={mode:"manual",servers:S},D.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function KG(e,r,i,o,c){const u=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(_=>"https://".concat(r.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(y,S,R,P,k){const W=Date.now(),U={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let V=y[0];const q=await ud(()=>md(V+"".concat(V.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,ce)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw D.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),wt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:X.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return wt.reqUserAccount(U.sid,{lts:W,success:!0,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:null,extend:U}),!1}const _e=Fv(Y.code);return _e.retry&&(V=y[(ce+1)%y.length]),wt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:_e.desc,extend:U}),_e.retry},(Y,ce)=>Y.code!==X.OPERATION_ABORTED&&(wt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:null,errorCode:Y.code,extend:U}),V=y[(ce+1)%y.length],!0),k);if(q.code!==0){const Y=Fv(q.code);throw new Oe(X.UNEXPECTED_RESPONSE,Y.desc)}return q}(h,e,r,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function Ffe(e,r,i){const o=re("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await HG({referenceList:c,asyncMapHandler:h=>async function(m,_,y,S){const R=Date.now(),P={sid:y.sid,opid:10,appid:y.appId,string_uid:_};try{const k=await md(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const W=Fv(k.code);throw new Oe(X.UNEXPECTED_RESPONSE,"preload sua error:".concat(W.desc),W)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:k.uid,elapse:Date.now()-R}}catch(k){throw k}}(h,e,r,i),closeFn:h=>h.code===X.OPERATION_ABORTED||h.code===X.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function jfe(e,r,i){const o=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(y,S,R,P){const k=Rn(),W={flag:64,cipher_method:0,features:gh(gh(gh(gh(gh({install_id:OL(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:S.appId,version:pl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:kfe.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return ud(()=>md(y,{data:W,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,U=>U.code!==X.OPERATION_ABORTED,P)}(_,e,r,i));let u=null,h=null,m={};try{u=await Gv(c)}catch(_){if(_.code===X.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),wt.reportApiInvoke(e.sid,{name:mi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const y=_.test_tags,S=Object.keys(y),R={};return S.forEach(P=>{var k;const W=Js(k=P.slice(4)).call(k),U=JSON.parse(y[P]),V=U[1];R[W]={tag:U[0]||"",value:V}}),R}(u)}catch{}return m}async function qG(e,r){const i=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:bb(),serviceIds:[ai.CHOOSE_SERVER,ai.CLOUD_PROXY_FALLBACK]}));try{return await HG({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let _,{url:y,areaCode:S,serviceIds:R}=u;const P=Date.now(),[k,W]=Rx(h,S,R);let U=oi.networkState;try{U&&oi.networkState===Ja.OFFLINE&&oi.onlineWaiter&&await lt.race([oi.onlineWaiter,is(gi.maxRetryTimeout)]),U=oi.networkState;const{data:V,headers:q}=await md(y,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(ye=>{const me=[];if(ye.response_body.forEach(ke=>{const Ye=ke.buffer.code;if(ke.uri===23&&Ye===0&&!ke.buffer.edges_services)if(ke.buffer.flag===4194310)ke.buffer.edges_services=[];else{const ut={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ye.detail[502]}),flag:ke.buffer.flag};me.push(ut)}if(Ye!==0){const ut=Fv(Ye),pt={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,ut.desc,{desc:ut.desc,retry:ut.retry,csIp:ye.detail[502]}),flag:ke.buffer.flag};ke.buffer.flag===4194310?D.warning(pt.error.toString()):me.push(pt)}}),me.length)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,me.map(ke=>"flag: ".concat(ke.flag,", message: ").concat(ke.error.message)).join(" | "),{retry:!!me.find(ke=>ke.error.data.retry),csIp:ye.detail[502],desc:[...new Set(me.map(ke=>{var Ye;return ke==null||(Ye=ke.error)===null||Ye===void 0||(Ye=Ye.data)===null||Ye===void 0?void 0:Ye.desc}).filter(ke=>!!ke))]})})(V);const ce=yb(V,ai.CHOOSE_SERVER),_e=yb(V,ai.CLOUD_PROXY_FALLBACK);return wx(ce),{gatewayInfo:px(ce,y),proxyInfo:_e,opid:W,requestTime:P,url:y,isHttp3:_,elapse:Date.now()-P}}catch(V){throw V}}(c,e,r),closeFn:c=>c.code===X.OPERATION_ABORTED||c.code===X.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function YG(e,r,i,o){const c=re("PROXY_SERVER_TYPE3"),u=(k,W,U)=>{let V=U||c;return Array.isArray(V)&&(V=W%2==0?c[1]:c[0]),"https://".concat(V,"/ap/?url=").concat(k)};let h=null;const m=[],_=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:bb(),serviceIds:[ai.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK]}}),W=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await wb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to choose_server:"),V.url),zG(V,e,r,i)),allFailedhandler:V=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U},y=async()=>{if(await is(1e3),h!==null)return h;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:bb(),serviceIds:[ai.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK]}}),W=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await wb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),V.url),zG(V,e,r,i)),allFailedhandler:V=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await Gv([_(),y()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!S||!R)throw new Oe(X.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=P,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];ot(c).call(c,k)&&(e.proxyServer=k,D.setProxyServer(k),wt.setProxyServer(k))}return h={gatewayInfo:S,proxyInfo:await yG(R,S.uid)},h}async function Bfe(e,r,i){const o=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,y){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:pl,cname:m.cname,uid:m.uid.toString(),requestId:bx,seq:bx};bx+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return ud(async()=>{const P=await md(h,{data:R,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const W=new Oe(X.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw D.error(W.toString()),W}const k=JSON.parse(P.json_body);if(k.code!==200){const W=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw D.error(W.toString()),W}if(!k.servers||k.servers.length===0){const W=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw D.error(W.toString()),W}return{vid:k.vid,workerToken:k.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(W=>"wss://".concat(W.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(W.wss))}},void 0,P=>!!(P.code!==X.OPERATION_ABORTED&&P.code!==X.UNEXPECTED_RESPONSE||P.data&&P.data.retry),y)}(u,e,r,i));try{const u=await Gv(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Wfe(e,r,i){let o=null;const c=[],u=async h=>{const m=re(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await is(1e3),o!==null)?o:await wb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(D.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(y,S,R,P){const[k]=Vfe(S,[ai.CHOOSE_SERVER]);let W=oi.networkState;return ud(async()=>{W&&oi.networkState===Ja.OFFLINE&&oi.onlineWaiter&&await lt.race([oi.onlineWaiter,is(P&&P.maxRetryTimeout||gi.maxRetryTimeout)]),W=oi.networkState;const U=await md(y,{data:k,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Ufe(U,y)},()=>!1,U=>U.code!==X.OPERATION_ABORTED&&(U.code===X.UPDATE_TICKET_FAILED?U.data.retry:(D.warning("[".concat(S.clientId,"] update ticket network error, retry"),U),!0)),P)}(_,e,r,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await Gv([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function XG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ix(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?XG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class zfe extends Ar{get isSuccess(){return!!this.configs}constructor(r,i){super(),$(this,"configs",void 0),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"cancelToken",void 0),$(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),$(this,"interval",void 0),$(this,"mutex",void 0),$(this,"mutableParamsRead",!1),$(this,"configCache",{}),$(this,"limit_bitrate",void 0),this.mutex=new As("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,wt.reportApiInvoke(null,{options:void 0,name:mi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:xr.TRACER}).onSuccess(JSON.stringify(dd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void D.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await jfe(this.joinInfo,this.cancelToken,this.retryConfig),D.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=HT(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let S=h.length-1;S>y;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const k=P.__priority,W=h[S-1],U=c[W].value;if(typeof U.__priority=="number"){if(!(k>U.__priority))continue;{const V=R;h[S]=h[S-1],h[S-1]=V}}else{const V=R;h[S]=h[S-1],h[S-1]=V}}}const m=Date.now();let _={};return h.forEach(y=>{const S=c[y].value.__expires;S&&S<=m||(_[y]=c[y])}),_}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(X.NETWORK_RESPONSE_ERROR,o);D.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){aG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(gb.UPDATE_BITRATE_LIMIT,r):this.emit(gb.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Ix({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,y=r[u].value,S=r[u].tag;let R=0;_?_===M8.REALTIME&&(R=1):Object.keys(y).some(P=>Object.prototype.hasOwnProperty.call(LL,P)||!rx()&&Object.prototype.hasOwnProperty.call(OA,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:y}=u;this.store.sessionId&&wt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){D.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,y=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=Ix(Ix({value:m[S]},_&&{expires:_}),y&&{type:y}))})}),u}(r);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&aG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(m){try{const _=Date.now();Object.keys(m).forEach(y=>{const{value:S,type:R,expires:P}=m[y];P&&P<=_||((R===M8.REALTIME||Object.prototype.hasOwnProperty.call(LL,y))&&(dd[y]=S,mr[y]=S,D.debug("Update realtime parameters from config distribute",y,S)),R||rx()||!Object.prototype.hasOwnProperty.call(OA,y)||(dd[y]=S,mr[y]=S,D.debug("Update gateway parameters from config distribute",y,S)))})}catch(_){D.error("Error update config immediately: ".concat(m),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),D.debug("Caching global parameters ".concat(u))}catch(c){D.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(mr,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(mr[o],c)||(dd[o]=c,mr[o]=c,this.emit(gb.UPDATE_CLIENT_ROLE_OPTIONS,c),D.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){D.error("Error handling global parameter config:",i.message)}}}class Gfe extends Ar{constructor(){super(...arguments),$(this,"resultStorage",new Map)}setLocalAudioStats(r,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(r,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,i){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(r,i,o){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=ot(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",JG[r],r,i),!c.isPrevNormal&&h&&this.emit("exception",JG[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof Ti&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=Qa(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof Ti&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const JG={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ks=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function QG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function M_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?QG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):QG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Rb{constructor(r){$(this,"store",void 0),$(this,"onStatsException",void 0),$(this,"onUploadPublishDuration",void 0),$(this,"onStatsChanged",void 0),$(this,"localStats",new Map),$(this,"remoteStats",new Map),$(this,"updateStatsInterval",void 0),$(this,"trafficStats",void 0),$(this,"trafficStatsPeerList",[]),$(this,"uplinkStats",void 0),$(this,"exceptionMonitor",void 0),$(this,"p2pChannel",void 0),$(this,"scalabilityMode",PA.L1T1),$(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Gfe,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($e.LocalAudioTrack)||M_({},FL)}getLocalVideoTrackStats(){return this.localStats.get($e.LocalVideoTrack)||M_({},jL)}getRemoteAudioTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRemoteNetworkQualityStats(r){const i={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRTCStats(){let r=0,i=0,o=0,c=0;const u=this.localStats.get($e.LocalAudioTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get($e.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get($e.LocalVideoLowTrack);m&&(r+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:S,videoStats:R}=y;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?ks.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?ks.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&D.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,o){if(!r)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case $e.LocalVideoTrack:case $e.LocalVideoLowTrack:{const h=c,m=M_({},jL),_=r.getStats(),y=r.getLocalMedia(o);if(_){const S=_.videoSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig($e.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(D.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case $e.LocalAudioTrack:{const h=c,m=M_({},FL),_=r.getStats(),y=r.getLocalMedia(o);if(_){const S=_.audioSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set($e.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=i;const y=m,S=h,R=_,P=M_({},K8),k=M_({},q8),W=M_({},Ape),{audioTrack:U,videoTrack:V,audioSSRC:q,videoSSRC:Y}=r.getRemoteMedia(u);let ce;ce=this.store.useP2P?r.getStats(!0):r.getStats();const _e=(o=ce)===null||o===void 0?void 0:o.audioRecv.find(Ye=>Ye.ssrc===q),ye=(c=ce)===null||c===void 0?void 0:c.videoRecv.find(Ye=>Ye.ssrc===Y),me=this.trafficStats&&this.trafficStats.peer_delay.find(Ye=>Ye.peer_uid===u);if(_e&&(_e.codec!=="opus"&&_e.codec!=="aac"&&_e.codec!=="PCMU"&&_e.codec!=="PCMA"&&_e.codec!=="G722"||(P.codecType=_e.codec),_e.outputLevel?P.receiveLevel=Math.round(32767*_e.outputLevel):U&&(P.receiveLevel=Math.round(32767*U.getVolumeLevel())),P.receiveBytes=_e.bytes,P.receivePackets=_e.packets,P.receivePacketsLost=_e.packetsLost,P.receivePacketsDiscarded=_e.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=y?8*Math.max(0,P.receiveBytes-y.receiveBytes):0,P.totalDuration=y?y.totalDuration+1:1,P.totalFreezeTime=y?y.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=_e.jitterBufferMs,P.totalDuration>10&&Rb.isRemoteAudioFreeze(U)&&(P.totalFreezeTime+=1)),ye){var ke;ye.codec!=="H264"&&ye.codec!=="H265"&&ye.codec!=="VP8"&&ye.codec!=="VP9"&&ye.codec!=="AV1X"&&ye.codec!=="AV1"||(k.codecType=ye.codec),k.receiveBytes=ye.bytes,k.receiveBitrate=S?8*Math.max(0,k.receiveBytes-S.receiveBytes):0,k.decodeFrameRate=ye.decodeFrameRate<0?0:ye.decodeFrameRate,k.renderFrameRate=ye.decodeFrameRate<0?0:ye.decodeFrameRate,ye.outputFrame&&(k.renderFrameRate=ye.outputFrame.frameRate),ye.receivedFrame?(k.receiveFrameRate=ye.receivedFrame.frameRate,k.receiveResolutionHeight=ye.receivedFrame.height,k.receiveResolutionWidth=ye.receivedFrame.width):V&&(k.receiveResolutionHeight=V._videoHeight||0,k.receiveResolutionWidth=V._videoWidth||0),ye.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(ye.framesRateFirefox)),k.receivePackets=ye.packets,k.receivePacketsLost=ye.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const Ye=S?S.totalFreezeTime:0,ut=S?S.totalDuration:0;k.totalDuration=S?S.totalDuration+1:1,k.totalFreezeTime=(ke=ye.totalFreezesDuration)!==null&&ke!==void 0?ke:Ye||0,k.receiveDelay=ye.jitterBufferMs||0;const pt=!!Y&&r.getRemoteVideoIsReady(Y);ye.totalFreezesDuration===void 0&&V&&pt&&Rb.isRemoteVideoFreeze(V,ye,R)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-Ye)/(k.totalDuration-ut),1))}me&&(P.end2EndDelay=me.B_ad,k.end2EndDelay=me.B_vd,P.transportDelay=me.B_ed,k.transportDelay=me.B_ed,P.currentPacketLossRate=me.B_ealr4/100,k.currentPacketLossRate=me.B_evlr4/100,W.uplinkNetworkQuality=me.B_punq?me.B_punq:0,W.downlinkNetworkQuality=me.B_pdnq?me.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:k,videoPcStats:ye,networkStats:W}),U&&this.exceptionMonitor.setRemoteAudioStats(U,P),V&&this.exceptionMonitor.setRemoteVideoStats(V,k)})}}class ZG{constructor(){$(this,"destChannelMediaInfos",new Map),$(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){sG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){sG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){YA(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function e9(e){if(!(e instanceof ZG))return new Oe(X.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!r)return new Oe(X.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new Oe(X.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Om{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){$(this,"uid",void 0),$(this,"_uintid",void 0),$(this,"_trust_in_room_",!0),$(this,"_trust_audio_enabled_state_",!0),$(this,"_trust_video_enabled_state_",!0),$(this,"_trust_audio_mute_state_",!0),$(this,"_trust_video_mute_state_",!0),$(this,"_audio_muted_",!1),$(this,"_video_muted_",!1),$(this,"_audio_enabled_",!0),$(this,"_video_enabled_",!0),$(this,"_audio_added_",!1),$(this,"_video_added_",!1),$(this,"_is_pre_created",!1),$(this,"_video_pre_subscribed",!1),$(this,"_audio_pre_subscribed",!1),$(this,"_trust_video_stream_added_state_",!0),$(this,"_trust_audio_stream_added_state_",!0),$(this,"_audioTrack",void 0),$(this,"_videoTrack",void 0),$(this,"_dataChannels",[]),$(this,"_audioSSRC",void 0),$(this,"_videoSSRC",void 0),$(this,"_audioOrtc",void 0),$(this,"_videoOrtc",void 0),$(this,"_cname",void 0),$(this,"_rtxSsrcId",void 0),$(this,"_videoMid",void 0),$(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function t9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function n9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?t9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Cb="9",r9=4e4;function i9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Yp(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?i9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):i9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Hv=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Hv||{});const lP=new Map;function s9(e,r,i,o){let{scale:c}=e;if(c===0&&o===Hv.UP||c>=r.length-1&&o===Hv.DOWN)return e;let u=Yp(Yp({},e),{},{scale:o===Hv.DOWN?++c:--c});switch(i){case"maintain-framerate":u=Yp(Yp({},u),r[c].motion);break;case"maintain-resolution":u=Yp(Yp({},u),r[c].detail);break;case"balanced":u=Yp(Yp({},u),r[c].balanced)}return u}function o9(e,r){if(r){const i={overUse:0,underUse:0,adaptationList:a9(r)};lP.set(e,i)}else lP.delete(e)}function a9(e){const r=Yp({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:W,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:V,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:ce,DETAIL_FRAMERATE_FACTOR:_e,DETAIL_BITRATE_FACTOR:ye}=NL,me=Math.min(r.frameRate,m),ke=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(k,1)*me),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let Ye=1;Ye<=_;Ye++){const ut={bwe_up:Math.round(Math.pow(R,Ye)*i),bwe_down:Math.round(Math.pow(P,Ye+1)*i),fps_up:Math.round(Math.pow(W,Ye)*me),fps_down:Math.round(Math.pow(k,Ye+1)*me)},pt={scaleResolutionDownBy:c/Math.pow(q,Ye),frameRate:Math.max(Math.round(Math.pow(V,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(U,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(U,Ye)*u),y)},yn={scaleResolutionDownBy:c/Math.pow(Y,Ye),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ce,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ce,Ye)*u),y)},vn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_e,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(ye,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ye,Ye)*u),y)};ke.push({scale:Ye,threshold:ut,balanced:pt,motion:yn,detail:vn})}return ke}function Hfe(e,r,i,o,c,u){const h=lP.get(e)||{overUse:0,underUse:0,adaptationList:a9(c)},{adaptationList:m}=h;lP.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:y}=NL,{scale:S}=o;let R,P;return typeof r=="number"&&r>0&&function(k,W,U,V){if(W>=U.length)return!1;let{threshold:{fps_down:q}}=U[W];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[0].threshold.fps_down),k<q}(r,S,m,u)&&(h.overUse++,P=ub.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(k,W,U){if(W>=U.length)return!1;const{threshold:{bwe_down:V}}=U[W];return k<V}(i,S,m)&&(h.overUse++,P=ub.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,R=s9(o,m,u,Hv.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(k,W,U,V){if(W===0)return;let{threshold:{fps_up:q}}=U[W];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[1].threshold.fps_up),k>q}(r,S,m,u)&&function(k,W,U){if(W===0)return;const{threshold:{bwe_up:V}}=U[W];return k>V}(i,S,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,R=s9(o,m,u,Hv.UP),R.scale===0&&(P=ub.NONE))),[R,P])}function c9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ax(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?c9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function $fe(e){var r;return!!re("ENABLE_AG_ADAPTATION")&&!!(e instanceof YL||ot(r=e._hints).call(r,ar.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=Rn();if(o.os!==xi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&i8(17,4)||r8(14)&&s8(17,4,!0)))}const uP=new Map;function dP(e,r){const i=uP.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),uP.delete(e)}r.qualityLimitationReason=ub.NONE,o9(e)}function Kfe(e,r){var i;let o;switch(r){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=e._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return o}function Px(e){const r=kn();if(e.some(i=>i._bypassWebAudio))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function Ox(e,r){Px(e);const i=new Ti;return e.forEach(o=>i.addAudioTrack(o)),i}const qfe=!kn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Fp();function hP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return qfe?(i={spec:r,store:e},Kp("PlanBConnection").create(i)):new _h(r,e)}function kx(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function l9(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(ab(e.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var bn;function u9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function gd(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?u9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let _h=(bn=class rE extends lG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return ot(i=Object.keys(kA)).call(i,r)}))]}constructor(r,i){super(r,i),$(this,"id",or(5,"connection-")),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"forceTurn",!1),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"extension",{useXR:re("USE_XR")}),$(this,"localCapabilities",void 0),$(this,"remoteCodecs",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"isPreallocation",!1),$(this,"preSSRCMap",new Map),$(this,"dataStreamChannelMap",new Map),$(this,"establishPromise",void 0),$(this,"recoveredDataChannelIds",[]),$(this,"currentDataChannelId",1),$(this,"supportAV1RtpSpec",!1),$(this,"mutex",void 0),$(this,"qualityLimitationReason",ub.NONE),$(this,"isFirstConnected",!1),this.store=i,this.forceTurn=l9(r),this.mutex=new As("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(rE.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=PL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const i=this.preSSRCMap.get(r);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void D.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else D.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Am(o.sdp),u=await PG({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=iP(u),this.initialOffer=o,re("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:PA.L1T3}]});const y=await _.createOffer();if(!y.sdp)return void _.close();const S=ya(y.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&DG(o.sdp)&&(h=Mr(u),(i=h).send&&(jv(mt.VIDEO,i.send.videoExtensions),jv(mt.AUDIO,i.send.audioExtensions)),i.recv&&(jv(mt.VIDEO,i.recv.videoExtensions),jv(mt.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(jv(mt.VIDEO,i.sendrecv.videoExtensions),jv(mt.AUDIO,i.sendrecv.audioExtensions))),gd(gd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&DG(this.initialOffer.sdp)&&(i=r.rtpCapabilities,o=this.localCapabilities,i.send&&(tP(mt.VIDEO,i.send.videoExtensions,o.send.videoExtensions),tP(mt.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(tP(mt.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),tP(mt.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Mr(this._localCapabilities)}get rtpCapabilities(){return Mr(this._rtpCapabilities)}get candidates(){return Mr(this._candidates)}get iceParameters(){return Mr(this._iceParameters)}get dtlsParameters(){return Mr(this._dtlsParameters)}constructor(y){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_originCandidates",void 0),$(this,"_iceParameters",void 0),$(this,"_isUseExtmapAllowMixed",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,y=Mr(y);const{iceParameters:R,dtlsParameters:P,candidates:k,rtpCapabilities:W,setup:U,localCapabilities:V,cname:q}=y;this._rtpCapabilities=W,this._candidates=k,this._originCandidates=Mr(k),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=V,this.setup=U,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(W),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(y){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,k=this.rtpCapabilities.send;let W=this.sessionDesc.mediaDescriptions.length-1;for(let U=1;U<y;U++){const V=2*U+2e4,q=2*U+r9,{ssrcs:Y,ssrcGroups:ce}=x_([{ssrcId:V}],this.cname),{ssrcs:_e,ssrcGroups:ye}=x_([{ssrcId:q,rtx:re("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Cb,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.videoCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_e,ssrcGroups:ye,rtcpFeedbackWildcards:[],payloads:k.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++W)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Cb,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.audioCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:ce,rtcpFeedbackWildcards:[],payloads:k.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++W)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return bm(this.sessionDesc)}send(y,S,R,P){const{ssrcs:k,ssrcGroups:W}=x_(S,this.cname,re("SYNC_GROUP")?R:void 0),U=this.findPreloadMediaDesc(k);if(U){if(Dr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,U.attributes.mid),P&&(P.twcc||P.remb)){const V=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(U,P),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const V=this.findAvailableMediaIndex(y,k);let q;return V===-1||V===1&&(Es()||function(){const Y=Rn();return!(Y.name!==Un.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||re("ENABLE_ENCODED_TRANSFORM")&&Vp())||V===0&&re("USE_SUB_RTX")||o8()?(q=this.createOrRecycleSendMedia(y,k,W,"sendonly",P),this.updateBundleMids()):(q=Mr(this.sessionDesc.mediaDescriptions[V]),q.attributes.direction="sendonly",q.attributes.ssrcs=k,q.attributes.ssrcGroups=W,this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(q,P)),Dr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:S}}batchSend(y){const S=y.map(k=>{let{kind:W,ssrcMsg:U,mslabel:V}=k;return this.send(W,U,V)}),R=[];let P=!1;return S.forEach(k=>{let{mid:W,needExchangeSDP:U}=k;U&&(P=!0),R.push(W)}),{mids:R,needExchangeSDP:P}}stopSending(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Dr()||o8()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(y,S,R,P){y.forEach((k,W)=>{this.createOrRecycleRecvMedia(k,[],"recvonly",S,R,P[W])}),this.updateBundleMids()}stopReceiving(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(y){const S=this.sessionDesc||ya((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=y;const P=this.rtpCapabilities.send,k=this.localCapabilities.send;for(const W of S.mediaDescriptions){if(W.attributes.iceUfrag=this._iceParameters.iceUfrag,W.attributes.icePwd=this._iceParameters.icePwd,W.attributes.fingerprints=this._dtlsParameters.fingerprints,W.attributes.candidates=this._candidates,W.attributes.setup=this.setup,W.media.mediaType==="application"&&(W.attributes.sctpPort="5000"),W.media.mediaType==="video"){if(P.videoCodecs.length===0){const U=k.videoCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:ot(Y=q.encodingName.toLowerCase()).call(Y,"vp8")})||[k.videoCodecs[0]];W.media.fmts=U.map(V=>V.payloadType.toString(10)),W.attributes.payloads=U,W.attributes.extmaps=[]}else if(W.media.fmts=P.videoCodecs.map(U=>U.payloadType.toString(10)),W.attributes.payloads=P.videoCodecs,W.attributes.extmaps=P.videoExtensions,re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=x_([{ssrcId:r9,rtx:re("USE_SUB_RTX")?40001:void 0}],this.cname);W.attributes.ssrcs=U,W.attributes.ssrcGroups=V}}if(W.media.mediaType==="audio"){if(P.audioCodecs.length===0){const U=k.audioCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:ot(Y=q.encodingName.toLowerCase()).call(Y,"opus")})||[k.audioCodecs[0]];W.media.fmts=U.map(V=>V.payloadType.toString(10)),W.attributes.payloads=U,W.attributes.extmaps=[]}else if(W.media.fmts=P.audioCodecs.map(U=>U.payloadType.toString(10)),W.attributes.payloads=P.audioCodecs,W.attributes.extmaps=P.audioExtensions,Wv(W),re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=x_([{ssrcId:2e4}],this.cname);W.attributes.ssrcs=U,W.attributes.ssrcGroups=V}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(y){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(n9(n9({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(y){case Os.TCP_RELAY:this._candidates=R;break;case Os.UDP_TCP_RELAY:case Os.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(y){y=Mr(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=y.iceUfrag,S.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const S=[];for(let R=0;R<y;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(y,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===y&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Dr()){if(P){const k=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(k||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!k||k!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:Cb,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,S,R,P,k,W){const U=y._mediaStreamTrack.kind,V=this.rtpCapabilities.recv,q=Sb(U,V,this.localCapabilities.send,U===mt.VIDEO?P:k),Y=U===mt.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const ce="".concat(this.currentMidIndex);let _e={media:{mediaType:U,port:Cb,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ce)}};_e=this.mungRecvMediaDsec(_e,y,W);const ye=this.findFirstClosedMedia(U);if(ye){const me=this.sessionDesc.mediaDescriptions.indexOf(ye);this.sessionDesc.mediaDescriptions[me]=_e}else this.sessionDesc.mediaDescriptions.push(_e);return _e}updateRemoteCodec(y,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").filter(_e=>{var ye;return ot(ye=Object.keys(kA)).call(ye,_e)}))],k=new Set(S);if(P.every(_e=>k.has(_e)))return D.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const W=this._rtpCapabilities.recv.videoCodecs.filter(_e=>S.some(ye=>{var me;return ot(me=_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").call(me,ye)}));if(W.length===0)return D.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const U=[...new Set(W.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||""))];let V;if(D.debug("updateRemoteCodec, from ".concat(P," to ").concat(U)),y.length===0)V=this.sessionDesc.mediaDescriptions.filter(_e=>_e.media.mediaType==="video"&&_e.attributes.direction==="recvonly");else if(V=this.sessionDesc.mediaDescriptions.filter(_e=>_e.attributes.mid&&ot(y).call(y,_e.attributes.mid)&&_e.attributes.direction==="recvonly"),V.length!==y.length)return D.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(S)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const _e=_x(W,this.rtpCapabilities.recv.videoCodecs);W.push(..._e)}this._rtpCapabilities.recv.videoCodecs=W;const q=this.localCapabilities.send,Y=this.rtpCapabilities.recv,ce=Sb(mt.VIDEO,Y,q,R);return V.forEach(_e=>{const ye=ce.map(me=>me.payloadType.toString(10));D.debug("updateRemoteCodec mid: ".concat(_e.attributes.mid,", from"),_e.attributes.payloads,"to",ce),_e.attributes.payloads=ce,_e.media.fmts=ye}),!0}createOrRecycleSendMedia(y,S,R,P,k){const W=this.rtpCapabilities.send,U=y===mt.VIDEO?W.videoCodecs:W.audioCodecs,V=y===mt.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Y={media:{mediaType:y,port:Cb,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:V,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Y=this.mungSendMediaDesc(Y,k);const ce=this.findFirstClosedMedia(y);if(ce){const _e=this.sessionDesc.mediaDescriptions.indexOf(ce);this.sessionDesc.mediaDescriptions[_e]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,S,R){const P=Mr(y);return mx(P),Bv(P,S),gx(P,S),IG(P),rP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(y,S){const R=Mr(y);return rP(R,S,this.localCapabilities.recv),Wv(R),R}updateRecvMedia(y,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===y);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(S=>Dr()?S.media.port==="0"&&S.media.mediaType===y:S.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===y[0].ssrcId})}getSSRC(y){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y))===null||S===void 0?void 0:S.attributes.ssrcs}}(gd(gd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=kG(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),re("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(re("PRELOAD_MEDIA_COUNT"));const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=r;if(Array.isArray(_)&&_.length>0){const{mids:y}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));y.forEach((S,R)=>{this.preSSRCMap.set(_[R].ssrcId,S)}),await Tb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=r;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await Tb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return hl(function*(){const u=yield wn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=eP();r.forEach(V=>{const q=c.peerConnection.addTransceiver(V._mediaStreamTrack,gd({direction:"sendonly"},V.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),V._updateRtpTransceiver(q)}),Dr()&&re("SIMULCAST")===!0&&(yield wn(c.applySimulcastForFirefox(h,r)));const _=yield wn(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(_.sdp,r,y),R=ya(S),P=y.map(V=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return wG(q,re("USE_PUB_RTX"))});let k;try{k=yield P}catch(V){k=[],c.remoteSDP.receive(r,i,o,k);const q=c.remoteSDP.toString();throw yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield wn(c.stopSending(y,!0)),V}c.remoteSDP.receive(r,i,o,k);const W=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.applySimulcastEncodings(h,r)),yield wn(c.applySendEncodings(h,r)),U==null||U(W),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),h.map((V,q)=>{const Y=y[q];return{localSSRC:P[q],id:Y,transceiver:V}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")D.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),D.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else D.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Le?o:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof Le?i:new Le(X.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var y;dP(this.id+_.mid,this),_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);h&&(await Tb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await Tb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return hl(function*(){const o=yield wn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=kn().supportPCSetConfiguration,u=re("FORCE_TURN_TCP")||i.forceTurn;if(r===Os.RELAY&&!c)return;if(c&&!u){const R=r===Os.RELAY?"relay":"all",P=i.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(D.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,i.peerConnection.setConfiguration(P))}i.remoteSDP.updateCandidates(r);const h=yield wn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Am(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;i.remoteSDP.restartICE(_);const y=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield wn(i.peerConnection.setLocalDescription(h)),S==null||S(y),yield wn(i.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){D.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Os.TCP_RELAY),await Tb(this.peerConnection,this.remoteSDP,this.extension)}catch(i){D.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{dP(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return gd(gd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?Dr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:gd(gd({},dh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:gd(gd({},dh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(ab(r.turnServer.servers)?i.iceServers=r.turnServer.servers:re("NEW_TURN_MODE")&&i.iceServers?(re("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...rE.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...rE.newTurnServerConfigToIceServers(r.turnServer.servers)),re("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...rE.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...rE.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&kn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Cm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{const c=re("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Cm(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Cm(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(V=>V.track===r._mediaStreamTrack)),!i)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!kn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(U,V){return U.getTransceivers().find(q=>q.sender.track===V||q.receiver.track===V)}(this.peerConnection,r._mediaStreamTrack),_=Dpe(r);if($fe(r)&&m&&i&&_&&this.getLocalVideoStats&&ot(o=["vp8","vp9"]).call(o,this.store.codec)){var y;const U=u.degradationPreference||(ot(y=r._hints).call(y,ar.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(V,q,Y,ce,_e,ye){if(dP(V,Y),_e(q),ce!=="balanced"&&ce!=="maintain-framerate"&&ce!=="maintain-resolution")return;let me=-1;o9(V,q);const ke=window.setInterval(()=>{const ut=uP.get(V);if(!re("ENABLE_AG_ADAPTATION")||!ut)return dP(V,Y),void _e(q);const pt=ye();if(pt.sendPackets>0&&pt.OutgoingAvailableBandwidth>0){if(me===-1)return void(me=Date.now());if(Date.now()-me<1e3)return;const yn=pt.sendFrameRate,vn=pt.OutgoingAvailableBandwidth,[cr,Zr]=Hfe(V,yn,vn,ut.adaptationConfig,q,ce);Zr&&(Y.qualityLimitationReason=Zr),cr&&ut.adaptationConfig.scale!==cr.scale&&(D.debug("[".concat(V,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(yn,", bwe ").concat(vn,", switch from ").concat(ut.adaptationConfig.scale," to ").concat(cr.scale," ")),ut.adaptationConfig=Ax(Ax({},ut.adaptationConfig),cr),_e(cr))}},re("CHECK_LOCAL_STATS_INTERVAL")),Ye=Ax({},q);uP.set(V,{timer:ke,adaptationConfig:Ye,originConfig:q,adaptationFunc:_e}),D.debug("[".concat(V,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(ce))})(this.id+m.mid,_,this,U,V=>{i&&this.updateAdaptation(i,V)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:U,frameRate:V,scaleResolutionDownBy:q}=r._encoderConfig;U&&(h.maxBitrate=1e3*U),(ot(S=r._hints).call(S,ar.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(V&&(h.maxFramerate=Qa(V)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:R}=re("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),re("DSCP_TYPE")&&Fp()){var P;const U=re("DSCP_TYPE");ot(P=["very-low","low","medium","high"]).call(P,U)&&(h.networkPriority=U)}const k=i.getParameters(),W=(c=k.encodings)===null||c===void 0?void 0:c[0];Dr()&&!W&&(u.encodings=[h]),W&&Object.assign(W,h),Object.assign(k,u),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await i.setParameters(k),await async function(U,V,q){try{var Y;if(!kn().supportSetRtpSenderParameters||!function(ke){return ke==="vp9"||ke==="av1"}(U)||!re("ENABLE_SVC"))return;const ce={},_e={},ye=V.getParameters(),me=(Y=ye.encodings)===null||Y===void 0?void 0:Y[0];_e.scalabilityMode=eP(q),me&&Object.assign(me,_e),Object.assign(ye,ce),await V.setParameters(ye),D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ye.encodings)))}catch(ce){D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ce)}}(this.store.codec,i,re("SVC_MODE"))}async updateAdaptation(r,i){var o,c;if(!r)return D.debug("[updateAdaptation] no rtpSender found");if(!kn().supportSetRtpSenderParameters)return D.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=Qa(m)),_&&_>=1&&ot(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const y=r.getParameters(),S=(c=y.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(y,{});try{await r.setParameters(y),D.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?D.debug("[updateAdaptation] peerConnection not connected}"):D.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):D.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!kn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof gr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=ya(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(Bv(_,u),AG(_,u,this.store.codec))}),bm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const y=r[_],S=i[_];if(S instanceof gr&&!ot(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,i){if(!Dr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof gr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof gr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!ot(i=r._hints).call(i,ar.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(kn().supportPCSetConfiguration){const i=rE.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},yt(bn.prototype,"updateRemoteRTPCapabilities",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"updateRemoteRTPCapabilities"),bn.prototype),yt(bn.prototype,"connect",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"connect"),bn.prototype),yt(bn.prototype,"updateRemoteConnect",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"updateRemoteConnect"),bn.prototype),yt(bn.prototype,"createDataChannels",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"createDataChannels"),bn.prototype),yt(bn.prototype,"receive",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"receive"),bn.prototype),yt(bn.prototype,"batchReceive",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"batchReceive"),bn.prototype),yt(bn.prototype,"stopReceiving",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"stopReceiving"),bn.prototype),yt(bn.prototype,"muteRemote",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"muteRemote"),bn.prototype),yt(bn.prototype,"unmuteRemote",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteRemote"),bn.prototype),yt(bn.prototype,"muteLocal",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"muteLocal"),bn.prototype),yt(bn.prototype,"unmuteLocal",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteLocal"),bn.prototype),yt(bn.prototype,"close",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),yt(bn.prototype,"updateEncoderConfig",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"updateEncoderConfig"),bn.prototype),yt(bn.prototype,"updateSendParameters",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"updateSendParameters"),bn.prototype),yt(bn.prototype,"replaceTrack",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),yt(bn.prototype,"updateAdaptation",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"updateAdaptation"),bn.prototype),yt(bn.prototype,"getRemoteSSRC",[$o],Object.getOwnPropertyDescriptor(bn.prototype,"getRemoteSSRC"),bn.prototype),bn);function $o(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function Nx(e,r){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=Qa(r.width),o.height=Qa(r.height);const c=Qa(r.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new Oe(X.UNEXPECTED_ERROR,"can not get canvas context");const m=kn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,R=i.videoHeight/S,P=o.width*R;Math.abs(P-o.height)>=2&&(D.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=zL(()=>o.startCapture&&o.startCapture(),c);const y=_.stop;return _.stop=()=>{y.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),D.debug("clean low stream renderer")},_}var pP=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(pP||{}),ci=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(ci||{}),U_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(U_||{}),li=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(li||{}),V_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(V_||{}),d9=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(d9||{}),Eh=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Eh||{}),Ko=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Ko||{}),h9=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(h9||{}),qo=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(qo||{}),fP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(fP||{});const F_=1e3,j_=6,mP=3,Yfe=Math.max(j_,mP);function Ft(e,r,i){i!=null&&Number.isFinite(i)&&(e[r]=Math.round(Math.max(0,i)))}function p9(e){const r={[qo.CONN_TYPE]:0,[qo.RTT]:e.rtt,[qo.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[qo.CONN_TYPE]=1),i==="tcp"&&(r[qo.CONN_TYPE]=3),i==="tls"&&(r[qo.CONN_TYPE]=4);break}case"srflx":r[qo.CONN_TYPE]=2;break;case"unknown":r[qo.CONN_TYPE]=5;break;default:r[qo.CONN_TYPE]=0}return r}function f9(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class m9 extends Ar{constructor(r){super(),$(this,"store",void 0),$(this,"uploadWRTCStatsTimer",void 0),$(this,"uploadOutboundDenoiserStatsTimer",void 0),$(this,"uploadExtStatsTimer",void 0),$(this,"uploadExtUsageStatsTimer",void 0),$(this,"uploadInboundExtStatsTimer",void 0),$(this,"requestStats",void 0),$(this,"requestTransportStats",void 0),$(this,"requestLocalMedia",void 0),$(this,"requestRemoteMedia",void 0),$(this,"requestAllTracks",void 0),$(this,"requestVideoIsReady",void 0),$(this,"requestUploadStats",void 0),$(this,"requestUpload",void 0),$(this,"uploadOutboundStarted",!1),$(this,"uploadInboundStarted",!1),$(this,"uploadTransportStarted",!1),$(this,"uploadBaseStatsStarted",!1),$(this,"uploadExtensionUsageStarted",!1),$(this,"lastRecvStats",void 0),$(this,"lastSendStats",void 0),$(this,"lastRefRecvStats",void 0),$(this,"lastRefSendStats",void 0),$(this,"lastFullRecvStats",void 0),$(this,"lastFullSendStats",void 0),$(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%mP==0,o=r%j_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const y=this.getTransportStats(c,u,i);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&c){const y=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&u){const y=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);y&&(m.inbound=y)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[fP.RTC_PEER_CONNECTION_STATE]=AL[_]):m.misc=[{addition:{[fP.RTC_PEER_CONNECTION_STATE]:AL[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[fP.RTC_PEER_CONNECTION_STATE]:AL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Yfe+1&&(r=1)},F_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,i,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[qo.RTT]:r.rtt,[qo.CONN_TYPE]:void 0,[qo.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=p9(r);if(this.store.useP2P){if(i){const u=p9(i);c[qo.CONN_TYPE]+=u[qo.CONN_TYPE]<<3}c[qo.CONN_TYPE]+=110}else c[qo.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(y=>{let[S,{track:R,ssrcs:P}]=y;switch(S){case $e.LocalVideoLowTrack:case $e.LocalVideoTrack:if(S===$e.LocalVideoTrack){const k=function(V,q,Y,ce,_e,ye){const me=q.videoSend.find(pt=>pt.ssrc===V);if(!me)return;const ke={},{sentFrame:Ye,inputFrame:ut}=me;if(ye&&(Ft(ke,ci.QP_SUM,me.qpSumPerFrame),ut&&Ye)){const pt=ut.frameRate,yn=Ye.frameRate;ke[ci.FREEZE]=function(vn,cr){let Zr=!0;return Zr=!(vn<=5)&&(vn<=10?cr<3:vn<=20?cr<4:cr<5),Zr}(pt,yn)?1:0}if(_e){switch(Ye&&(Ft(ke,ci.HEIGHT,Ye.height),Ft(ke,ci.WIDTH,Ye.width),Ft(ke,ci.FRAME_RATE,Ye.frameRate)),ke[ci.DISABLED]=ce._originMediaStreamTrack&&!ce._originMediaStreamTrack.enabled||ce._mediaStreamTrack&&!ce._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":ke[ci.ADAPTATION]=0;break;case"cpu":ke[ci.ADAPTATION]=1;break;case"bandwidth":ke[ci.ADAPTATION]=2;break;case"other":ke[ci.ADAPTATION]=3}let pt=0;me.adaptionChangeReason&&(pt+=f9(me.adaptionChangeReason)),q.qualityLimitationReason&&(pt+=f9(q.qualityLimitationReason)<<3),ke[ci.ADAPTATION]=pt,ke[ci.PLAYER_STATUS]=BL[ce._player?ce._player.videoElementStatus:"uninit"],Ft(ke,ci.NACKS,me.nacksCount),Ft(ke,ci.PLIS,me.plisCount),Ft(ke,ci.FIRS,me.firsCount),Ft(ke,ci.AVG_ENCODE,me.avgEncodeMs),Ft(ke,ci.HUGE_FRAME_SENT,me.hugeFramesSent),Ft(ke,ci.BYTES_RETRANSMIT,me.retransmittedBytesSent),Ft(ke,ci.PACKAGES_RETRANSMIT,me.retransmittedPacketsSent),Ft(ke,ci.KEY_FRAMES_ENCODED,me.keyFramesEncoded);const yn=Y&&Y.videoSend.find(vn=>vn.ssrc===V);if(yn){let vn=_e?F_:F_*j_;yn.timestamp&&me.timestamp&&(vn=me.timestamp-yn.timestamp),yn.packets!=null&&me.packets!=null&&Ft(ke,ci.PACKAGE_RATE,1e3*(me.packets-yn.packets)/vn),me.packetsLost!=null&&yn.packetsLost!=null&&Ft(ke,ci.PACKAGE_LOST,me.packetsLost-yn.packetsLost),yn.bytes!=null&&me.bytes!=null&&Ft(ke,ci.BITRATE,8*(me.bytes-yn.bytes)/vn)}}return ke}(P[0].ssrcId,r,i,R,o,c),W=R&&function(V,q,Y,ce){const _e=q.videoSend.find(me=>me.ssrc===V);if(!_e)return null;const ye={};if(ce){const me=_e.inputFrame,ke=me&&me.height||Y.videoHeight||0,Ye=me&&me.width||Y.videoWidth||0,ut=me&&me.frameRate||0;Ft(ye,pP.HEIGHT,ke),Ft(ye,pP.WIDTH,Ye),Ft(ye,pP.FRAME_RATE,ut)}return ye}(P[0].ssrcId,r,R,o),U=function(V,q){const Y={};return q&&(Ft(Y,ci.RETRANSMIT,V.bitrate.retransmit),Ft(Y,ci.TARGET_ENCODED,V.bitrate.targetEncoded),Ft(Y,ci.ACTUAL_ENCODED,V.bitrate.actualEncoded),Ft(Y,ci.TRANSMIT,V.bitrate.transmit),Ft(Y,ci.BANDWIDTH,V.sendBandwidth)),Y}(r,o);m=Object.assign({},k,W,U)}else _=function(k,W,U,V){const q=W.videoSend.find(ce=>ce.ssrc===k);if(!q)return;const Y={};if(V){const ce=q.sentFrame;if(ce&&(Ft(Y,U_.HEIGHT,ce.height),Ft(Y,U_.WIDTH,ce.width),Ft(Y,U_.FRAME_RATE,ce.frameRate)),U){const _e=U.videoSend.find(ye=>ye.ssrc===k);if(_e){let ye=F_*j_;_e.timestamp&&q.timestamp&&(ye=q.timestamp-_e.timestamp),_e.packets!=null&&q.packets!=null&&Ft(Y,U_.PACKAGE_RATE,1e3*(q.packets-_e.packets)/ye),q.packetsLost!=null&&_e.packetsLost!=null&&Ft(Y,U_.PACKAGE_LOST,q.packetsLost-_e.packetsLost),_e.bytes!=null&&q.bytes!=null&&Ft(Y,U_.BITRATE,8*(q.bytes-_e.bytes)/ye)}}}return Y}(P[0].ssrcId,r,i,o);break;case $e.LocalAudioTrack:h=R&&function(k,W,U,V,q){const Y=W.audioSend.find(_e=>_e.ssrc===k);if(!Y)return;const ce={};if(q){ce[Eh.DISABLED]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0;const _e=100*V._source.getAccurateVolumeLevel(),ye=Y.inputLevel;if(ye!=null){const ke=Math.ceil(50*Math.log10(100*ye+1));Ft(ce,Eh.LEVEL,ke)}Ft(ce,d9.PCM_LEVEL,_e),Ft(ce,Eh.AEC_RETURN_LOSS,Y.aecReturnLoss),Ft(ce,Eh.AEC_RETURN_LOSS_ENH,Y.aecReturnLossEnhancement),Ft(ce,Eh.BYTES_RETRANSMIT,Y.retransmittedBytesSent),Ft(ce,Eh.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),ce[Eh.FREEZE]=0;const me=U&&U.audioSend.find(ke=>ke.ssrc===k);if(me){let ke=F_*j_;me.timestamp&&Y.timestamp&&(ke=Y.timestamp-me.timestamp),me.bytes!=null&&Y.bytes!=null&&Ft(ce,Eh.BITRATE,8*(Y.bytes-me.bytes)/ke),me.packets!=null&&Y.packets!=null&&Ft(ce,Eh.PACKAGE_RATE,1e3*(Y.packets-me.packets)/ke)}}return ce}(P[0].ssrcId,r,i,R,o)}}),{high:m,low:_,audio:h}}getInboundStats(r,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,y]=m;const S={peer:_.uid};if(y.has(mt.VIDEO)&&_.videoTrack){const R=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,P=_.videoTrack?function(k,W,U,V,q,Y,ce,_e){const ye=W.videoRecv.find(vn=>vn.ssrc===k);if(!ye)return;const me={},{receivedFrame:ke,outputFrame:Ye,decodeFrameRate:ut}=ye,pt=U&&U.videoRecv.find(vn=>vn.ssrc===k);if(Ft(me,V_.FRAME_RATE_DECODE,ut),ye.framesRateFirefox&&Ft(me,li.FRAME_RATE,ye.framesRateFirefox),ke&&Ft(me,li.FRAME_RATE,ke.frameRate),Ft(me,li.FRAMES_DROPPED,ye.framesDroppedCount),Ft(me,li.BYTES_RETRANSMIT,ye.retransmittedBytesReceived),Ft(me,li.PACKAGES_RETRANSMIT,ye.retransmittedPacketsReceived),Ft(me,li.PACKAGES_DISCARDED,ye.packetsDiscarded),Ft(me,li.AVG_DECODE,ye.avgDecodeMs),Ft(me,li.AVG_PROCESSING_DELAY,ye.avgProcessingDelayMs),Ft(me,li.AVG_ASSEMBLY_TIME,ye.avgFramesAssembledFromMultiplePacketsMs),Ft(me,li.AVG_INTER_FRAME_DELAY,ye.avgInterFrameDelayMs),Ft(me,li.KEY_FRAMES_DECODED,ye.keyFramesDecoded),pt){const vn=W.timestamp-U.timestamp||F_*(_e?j_:ce?mP:1);ye.packetsLost!=null&&pt.packetsLost!=null&&Ft(me,li.PACKAGE_LOST,ye.packetsLost-pt.packetsLost),pt.bytes!=null&&ye.bytes!=null&&Ft(me,li.BITRATE,8*(ye.bytes-pt.bytes)/vn),pt.packets!=null&&ye.packets!=null&&Ft(me,li.PACKAGE_RATE,1e3*(ye.packets-pt.packets)/vn)}if(_e&&(Ft(me,li.QP_SUM,ye.qpSumPerFrame),me[li.FREEZE]=q&&Rb.isRemoteVideoFreeze(V,ye,pt)?1:0),ce){var yn;ke?(Ft(me,li.HEIGHT,ke.height),Ft(me,li.WIDTH,ke.width)):V&&(Ft(me,li.HEIGHT,V._videoHeight||0),Ft(me,li.WIDTH,V._videoWidth||0)),Ye&&Ft(me,V_.FRAME_RATE_OUTPUT,Ye.frameRate);const vn=(yn=V._player)===null||yn===void 0?void 0:yn.rendFrameRate.toFixed(0);if(vn&&Ft(me,V_.FRAME_RATE_RENDER,+vn),Ft(me,li.JITTER_BUFFER,ye.jitterBufferMs),Ft(me,li.CURRENT_DELAY,ye.currentDelayMs),Ft(me,li.FIRS,ye.firsCount),Ft(me,li.NACKS,ye.nacksCount),Ft(me,li.PLIS,ye.plisCount),V){me[li.DISABLED]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1;const cr=V._player;if(cr){const{freezeTimeCounterList:Zr,renderFreezeAccTime:Wr,videoElementStatus:Xo}=cr;if(Zr&&Zr.length>0&&Ft(me,V_.FREEZE_TIME,Zr.splice(0,1)[0]),Y&&Wp.visibility==="visible"&&Xo===Qs.PLAYING&&kn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Wr);cr.renderFreezeAccTime=Math.max(0,Wr-je),Ft(me,V_.FREEZE_TIME_RENDER,je)}if(typeof ye.totalFreezesDuration=="number"){const je=pt&&pt.totalFreezesDuration?ye.totalFreezesDuration-pt.totalFreezesDuration:ye.totalFreezesDuration;Ft(me,V_.FREEZE_DURATION,1e3*je)}}}if(me[li.PLAYER_STATUS]=BL[V._player?V._player.videoElementStatus:"uninit"],pt&&ye.totalInterFrameDelay!==void 0&&ye.totalSquaredInterFrameDelay!==void 0&&pt.totalInterFrameDelay!==void 0&&pt.totalSquaredInterFrameDelay!==void 0){const cr=ye.totalInterFrameDelay-pt.totalInterFrameDelay,Zr=ye.totalSquaredInterFrameDelay-pt.totalSquaredInterFrameDelay,Wr=ye.framesDecodeCount-pt.framesDecodeCount,Xo=cr/Wr*1e3,je=Math.round(1e3*Math.sqrt((Zr-Math.pow(cr,2)/Wr)/Wr));!isNaN(je)&&Xo+je>Math.max(3*Xo,Xo+150)&&(me[li.I_FRAME_DELAY]=je)}}return me}(_._videoSSRC,r,i,_.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(y.has(mt.AUDIO)&&_.audioTrack){const R=_.audioTrack?function(P,k,W,U,V,q){const Y=k.audioRecv.find(me=>me.ssrc===P);if(!Y)return;const ce={},_e=W&&W.audioRecv.find(me=>me.ssrc===P);if(Ft(ce,Ko.JITTER,Y.jitterMs),Ft(ce,Ko.BYTES_RETRANSMIT,Y.retransmittedBytesReceived),Ft(ce,Ko.PACKAGES_RETRANSMIT,Y.retransmittedPacketsReceived),Ft(ce,Ko.PACKAGES_DISCARDED,Y.packetsDiscarded),Ft(ce,Ko.AVG_PROCESSING_DELAY,Y.avgProcessingDelayMs),_e){const me=k.timestamp-W.timestamp||F_*(q?j_:V?mP:1);Y.packets!=null&&_e.packets!=null&&Ft(ce,Ko.PACKAGE_RATE,1e3*(Y.packets-_e.packets)/me),V&&_e.bytes!=null&&Y.bytes!=null&&Ft(ce,Ko.BITRATE,8*(Y.bytes-_e.bytes)/me),Y.packetsLost!=null&&_e.packetsLost!=null&&Ft(ce,Ko.PACKAGE_LOST,Y.packetsLost-_e.packetsLost)}if(q){const{receivedFrames:me,droppedFrames:ke}=Y;me!=null&&ke!=null&&(ce[Ko.FREEZE]=(ye=me)===0||100*ke/ye>20?1:0)}var ye;if(V){const me=100*U._source.getAccurateVolumeLevel(),ke=Y.outputLevel;if(ke!=null){const Ye=Math.ceil(50*Math.log10(100*ke+1));Ft(ce,h9.LEVEL,Ye)}if(Ft(ce,Ko.PCM_LEVEL,me),U&&(ce[Ko.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),Ft(ce,Ko.JITTER_BUFFER,Y.jitterBufferMs),Ft(ce,Ko.CURRENT_DELAY,Y.jitterBufferMs),ce[Ko.PLAYER_STATUS]=BL[Ho.getPlayerState(U.getTrackId())],_e){const Ye=Y.concealedSamples-_e.concealedSamples;Ye>0&&Ft(ce,Ko.CONCEALED_SAMPLES,Ye);const ut=Y.totalSamplesReceived-_e.totalSamplesReceived;ut>0&&Ft(ce,Ko.TOTAL_SAMPLES_RECEIVED,ut)}}return ce}(_._audioSSRC,r,i,_.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof VA);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(mb.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,o]=r;o.has(mt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(mt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,S]of h)S.has(mt.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),S.has(mt.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(y,S){const R={};for(const{id:U,value:V,level:q,direction:Y}of y){var P;const ce=(P=S.get(U))!==null&&P!==void 0?P:0,_e=V===2?ce+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ce;var k,W;S.set(U,_e),R[U]?(V===2&&(R[U].value=V),q>R[U].level&&(R[U].level=q),Y==="remote"&&(R[U].remoteUidCount+=1),R[U].totalTs=(k=S.get(U))!==null&&k!==void 0?k:0):R[U]={value:V,level:q,remoteUidCount:Y==="local"?0:1,totalTs:(W=S.get(U))!==null&&W!==void 0?W:0}}return Object.keys(R).map(U=>{const{level:V,value:q,totalTs:Y}=R[U];return{id:U,level:V,value:q,totalTs:Y}})}(c,r);const m=Date.now(),_=m>i?m:i+1;this.requestUpload&&this.requestUpload(mb.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Xfe=re("ICE_RESTART_INTERVAL");let gP=new Map,$v=new Map,km=[Os.UDP_TCP_RELAY,Os.TCP_RELAY,Os.RELAY],Dx=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&kn().supportPCSetConfiguration;function g9(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=gP.get(e.id);i&&(window.clearTimeout(i),gP.delete(e.id));const o=$v.get(e.id);r&&o&&o.index===km.length-1&&(D.debug("[".concat(e.id,"] reset ICE restart policy")),$v.delete(e.id))}function _9(e,r,i){if(gP.size===0&&$v.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let y=0;y<m.length;y+=1){const S=m[y];if(m.filter(R=>R===S).length!==_.filter(R=>R===S).length)return!1}return!0}(km,re("RESTART_SEQUENCE"))&&(km=re("RESTART_SEQUENCE").filter(m=>{var _;if(ot(_=Object.values(Os)).call(_,m))return!0}),D.debug("use reconnection policy from config distribution, queues: ".concat(km.join(" => ")))),Dx=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&kn().supportPCSetConfiguration),km.length===0)return void i();let o,{index:c=0,type:u}=$v.get(e.id)||{};if(Dx&&u===Os.RELAY)return void i();let h=u&&c>=km.length-1;if(Dx)u=Os.RELAY;else{if(h)return void i();u?(c++,u=km[c]):(u=km[0],c=0)}D.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),$v.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>_9(e,r,i),Xfe),gP.set(e.id,o)}var un;function E9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function yh(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?E9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):E9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function y9(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=rL,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new _P(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function _P(e){function r(i){if(Object(i)!==i)return lt.reject(new TypeError(i+" is not an object."));var o=i.done;return lt.resolve(i.value).then(function(c){return{value:c,done:o}})}return _P=function(i){this.s=i,this.n=i.next},_P.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?lt.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?lt.reject(i):r(o.apply(this.s,arguments))}},new _P(e)}let Ib=(un=class extends Ar{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(kt.StateChange,r,this._state)}constructor(e,r){super(),$(this,"isPlanB",void 0),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"connection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"remoteDataChannelMap",new Map),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"pendingLocalDataChannels",[]),$(this,"pendingRemoteDataChannels",[]),$(this,"statsCollector",void 0),$(this,"shouldForwardP2PCreation",void 0),$(this,"iceFailedCount",0),$(this,"dtlsFailedCount",0),$(this,"mutex",void 0),$(this,"_state",Wn.Disconnected),$(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?$p.FIRST_CONNECTION:$p.OLD_FIRST_CONNECTION),$(this,"_isStartRestartIce",!1),$(this,"_restartTimer",void 0),$(this,"_isTryConnecting",!1),$(this,"_iceError",null),$(this,"_forceTurn",!1),$(this,"_isWaitPcToRePub",!1),$(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Wn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createMuteMessage(h);await sr(this,kt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Wn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(y.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}else{const S=Nx(i,cb(this,kt.RequestLowStreamParameter));y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}await new lt((S,R)=>{this.handleReplaceTrack(y.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createUnmuteMessage(h);await sr(this,kt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==Wn.Connected)return void o();const{id:y,track:S}=_;await this.connection.updateSendParameters(y,S),await this.connection.updateEncoderConfig(y,S),this.emit(kt.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Wn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==Wn.Connected)return void o();const h=Ox([i]);let m;D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(y){c(y)}finally{var _;(_=m)===null||_===void 0||_()}}),$(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.connection||!y||this.state!==Wn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),this.isPlanB){const S=y[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(y[0],S)}if(y[0]===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new lt((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new m9(this.store),this.bindStatsUploaderEvents(),this.mutex=new As("P2PChannel-mutex",this.store.clientId),this.isPlanB=!kn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Fp(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&kn().supportPCSetConfiguration&&mL(),this.shouldForwardP2PCreation&&(this.connection=hP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=Wn.New,this._forceTurn=l9(e),D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=hP(this.store,e),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?$p.FIRST_CONNECTION:$p.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");re("ENABLE_PREALLOC_PC")&&this.state===Wn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Wn.Connected)}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return ot(u=[$e.LocalVideoLowTrack,$e.LocalVideoTrack]).call(u,h)}),i=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof _h){if(wt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ot(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>ot(e).call(e,u));c&&(this.store.codec=c,D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof _h&&this.connection.peerConnectionState!=="closed"&&ot(e=[Wn.New,Wn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Wn.Connected){if(this.state===Wn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;ot(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,r,i){var o=this;return hl(function*(){const c=yield wn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&ot(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Wn.Connected||h){if(o.state===Wn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,ks.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,r,i);if(m.length===0)return void(yield wn(o.tryToUnmuteAudio(e)));yield*dA(y9(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,r){var i=this;return hl(function*(){r.forEach(P=>{let{track:k,type:W}=P;const U=Date.now();i.store.publish(k.getTrackId(),W===$e.LocalAudioTrack?"audio":"video",U)}),i.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:k}=P;return k}),c=yield wn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield wn(c.next())).value,h=i.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===X.WS_ABORT&&r.forEach(k=>{let{track:W}=k;i.pendingLocalTracks.indexOf(W)===-1&&i.pendingLocalTracks.push(W)}),i.unbindLocalTrackEvents(r),P}const _=i.mapPubResToRemoteConfig(h,m,o),y=(yield wn(c.next(_))).value;if(i.state===Wn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const S=re("ENABLE_ENCODED_TRANSFORM"),R=re("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const k=P.getRTCRtpTransceiver();if(!k||!S)return;const{interceptLocalVideoFrame:W,interceptLocalAudioFrame:U}=sP();P.trackMediaType===mt.VIDEO?await W(k.sender,P):P.trackMediaType===mt.AUDIO&&await U(k.sender,{metadata:R?()=>{const V=P.metadata.shift();return V&&V.value}:void 0})}),r.forEach(P=>{let{type:k}=P;i.statsCollector.addLocalStats(k)}),i.assignLocalTracks(r,y),i.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:k,type:W}=P;const U=Date.now();i.store.publish(k.getTrackId(),W===$e.LocalAudioTrack?"audio":"video",void 0,U)})})()}async updateVideoStreamParameter(e,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof gr))return D.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=fx(u,h)),m.maxFramerate=u.framerate?Qa(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==$e.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return D.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=Qa(m.width)),m.height&&(_.height=Qa(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=zL(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},Qa(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),D.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return hl(function*(){if(!r.connection||r.state!==Wn.Connected)return;const i=yield wn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get($e.LocalVideoTrack);if(!c)throw new Le(X.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has($e.LocalVideoLowTrack))throw new Le(X.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,e),type:$e.LocalVideoLowTrack}];if(yield*dA(y9(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get($e.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield wn(r.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await vs(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(D.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await vs(this,kt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:o}=this.pendingRemoteTracks[r];(o!==mt.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==mt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await vs(this,kt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===mt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(kt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Wn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==Wn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Wn.Connected)return;const e=this.localTrackMap.get($e.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[$e.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const i=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,r){if(!this.connection||this.state!==Wn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,r,i,o,c){var u;if(!this.connection||this.state!==Wn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(r))return;let h,m,_;const y=this.connection.getPreMedia(i);if(y)D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=y.transceiver,h=y.track,m=y.id;else if(c){const P=c.find(W=>{let{stream_type:U}=W;return U===r});if(!P)throw new Le(X.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const k=await this.connection.receive(r,P.ssrcs,String(e._uintid),P.attributes);this.connection instanceof _h&&(_=k.transceiver),h=k.track,m=k.id}else{const P=await this.connection.receive(r,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof _h&&(_=P.transceiver),h=P.track,m=P.id}if(r===mt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Dv(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Nv(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:k}=sP();r==mt.VIDEO?await P(_.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(W=>{var U;return(U=e._videoTrack)===null||U===void 0?void 0:U._onSei(W)})}):r==mt.AUDIO&&await k(_.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:W=>{this.safeEmit(kt.AudioMetadata,W)}})}const S=this.remoteUserMap.get(e);S?S.set(r,m):this.remoteUserMap.set(e,new Map([[r,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:k,kind:W}=P;return k.uid===e.uid&&r===W});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(kt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Wn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=i.get(h);if(!m)return void D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:y,transceiver:S}=m;if(S&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:W}=sP();u==mt.VIDEO?await k(S.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(U=>{var V;return(V=c._videoTrack)===null||V===void 0?void 0:V._onSei(U)})}):u==mt.AUDIO&&await W(S.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(kt.AudioMetadata,U)}})}if(u===mt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new Dv(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Nv(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),re("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:W}=sP();u==mt.VIDEO?await k(S.receiver,{onSei:U=>{var V;(V=c._videoTrack)===null||V===void 0||V._onSei(U)}}):u==mt.AUDIO&&await W(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(k=>{let{user:W,kind:U}=k;return W.uid===c.uid&&u===U});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(kt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return r!==void 0?m.uid===e.uid&&r===_:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Wn.Connected||i||o.forEach(h=>{let{kind:m}=h;var _;if(m===mt.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===mt.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Wn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var y,S;if(_===mt.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===mt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===mt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,r);if(i.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:y}=m;return u!==void 0?_.uid===c.uid&&u===y:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),r=r.concat(h)}if(!this.connection||this.state!==Wn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===mt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===mt.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=Ga(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===mt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===mt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===mt.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Wn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===mt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get($e.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ti){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===$e.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Br),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof gr);wt.publish(this.store.sessionId,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===mt.VIDEO?i._videoSSRC:i._audioSSRC;c&&wt.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===mt.VIDEO,audio:o===mt.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:ks.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new As("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=hP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($e.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ti){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Wn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($e.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($e.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof gr||r&&r.track instanceof Br?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(kc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=HT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Wn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=hP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case $e.LocalVideoTrack:ot(r=o._hints).call(r,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ti?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(kc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,i]=e;Array.from(kc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof Om?e.uid:e)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Om?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return hl(function*(){if(!r.connection||r.state!==Wn.Connected)return;const i=yield wn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield wn(r.connection.restartICE(e));const u=yield wn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(kx(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case Os.UDP_TCP_RELAY:r._pcStatsUploadType=$p.UDP_TCP_RESTART;break;case Os.TCP_RELAY:r._pcStatsUploadType=$p.TCP_RESTART;break;case Os.RELAY:r._pcStatsUploadType=$p.RELAY_RESTART;break;default:r._pcStatsUploadType=$p.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalAudioTrack),o=e.videoSend.find(k=>k.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=e.audioSend.find(k=>k.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Pc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,W=e.bitrate.actualEncoded;if(k&&W){const U=(1e3*k-W)/(1e3*k);return Zz[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(W=>W.ssrc===c),m=e.videoRecv.find(W=>W.ssrc===u);if(!h&&!m)return void(r+=1);const _=Pc(this,kt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new lt((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}async replaceTrack(e,r){var i;if(D.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Wn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const u=this.localTrackMap.get($e.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new lt((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,r,i){const o=[],c=this.getAllTracks();e=yv(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get($e.LocalAudioTrack);for(const _ of e){if(_ instanceof gr&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:$e.LocalVideoLowTrack})}if(_ instanceof Br)if(m){const y=m.track;if(y instanceof Ti)Px([_]),y.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=Ox([y,_]);D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(y,S)}}else u instanceof Ti?(Px([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&kn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=Ox(u?[_,u]:[_]):u=_}return u&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:$e.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=yv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Br){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ti?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(o instanceof gr){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(e){return e=(e=yv(e)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=yv(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case $e.LocalVideoTrack:i.addListener(gt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(gt.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ti?e.trackList.forEach(i=>{i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(gt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case $e.LocalVideoTrack:i.off(gt.GET_STATS,this.handleGetLocalVideoStats),i.off(gt.GET_RTC_STATS,this.handleGetRTCStats),i.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ti?e.trackList.forEach(r=>{r.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(gt.GET_STATS,this.handleGetLocalAudioStats),r.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(gt.GET_STATS,this.handleGetLocalAudioStats),e.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(gt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Nv&&r.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof Dv&&r.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(gt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(mt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(mt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,h,{track:m,type:_}=i;switch(_){case $e.LocalAudioTrack:u=zn.Audio,h={dtx:m instanceof VA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $e.LocalVideoTrack:u=ot(c=m._hints).call(c,ar.SCREEN_TRACK)?zn.Screen:zn.High,h=yh(yh({},_G(m)),{},{codec:this.store.codec,svc_mode:eP()});break;case $e.LocalVideoLowTrack:u=zn.Low,h=yh(yh({},_G(m)),{},{codec:this.store.codec,svc_mode:eP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r==="connecting"&&e instanceof _h&&!Dr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof _h&&g9(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=$p.DISCONNECTED_OR_FAILED,Pc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));wt.reportApiInvoke(this.store.sessionId,{name:mi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:xr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&e instanceof _h&&!Dr()&&!this._forceTurn){if(ot(uG).call(uG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{kx(e)&&(D.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Pc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE,c))},o=()=>{kx(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),D.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{_9(e,i,o)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&Pc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:xr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(kc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Iv.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,Mi.FIRST_AUDIO_DECODE,wr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(kc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&wt.firstRemoteFrame(this.store.sessionId,Mi.FIRST_AUDIO_RECEIVED,wr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(kc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&wt.firstRemoteFrame(this.store.sessionId,Mi.FIRST_VIDEO_RECEIVED,wr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Im(i))," -> ").concat(JSON.stringify(Im(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Im(i))," -> ").concat(JSON.stringify(Im(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return yh(yh({},r),i)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof _h&&function(r){$v.delete(r.id),g9(r)}(e),e.close(),this.emit(kt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive||r.push([$e.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive&&r.push([$e.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===$e.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,r){const i=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case mt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:mt.VIDEO,ssrcId:o._videoSSRC}));case mt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:mt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(r.has(o)){let u=r.get(o);c===mt.VIDEO?u|=Ui.Video:u|=Ui.Audio,r.set(o,u)}else c===mt.VIDEO?r.set(o,Ui.Video):r.set(o,Ui.Audio)}),{users:Array.from(r.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new lt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new lt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(_=>{let{stream_type:y}=_;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&re("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(ot(_).call(_,ar.SCREEN_TRACK)||ot(_).call(_,ar.SCREEN_LOW_TRACK))&&(m.remb=!1,D.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Br){var r;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await sr(this,kt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(kt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await is(bL(this.dtlsFailedCount,gi)),this.emit(kt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await vs(this,kt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(kt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof gr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof gr).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Br).length>1&&(e.some(r=>r instanceof Br&&r._bypassWebAudio)||!kn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof gr&&this.pendingLocalTracks.some(i=>i instanceof gr))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Br&&this.pendingLocalTracks.some(i=>i instanceof Br)&&(!kn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Br&&i._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var i;const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding,c=yh(yh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?e._mediaStreamTrack.clone():Nx(e,c);const h=or(8,"track-low-"),m=new gr(u,yh(yh({},o&&{scaleResolutionDownBy:fx(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(A_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,Rv.LOW_STREAM)}),m._hints.push(ar.LOW_STREAM),ot(i=e._hints).call(i,ar.SCREEN_TRACK)&&m._hints.push(ar.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(gt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof _h){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:k}=await this.connection.getSelectedCandidatePair();wt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:y,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(kc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,Mi.FIRST_VIDEO_DECODE,wr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===$e.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Rv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},yt(un.prototype,"startP2PConnection",[eo],Object.getOwnPropertyDescriptor(un.prototype,"startP2PConnection"),un.prototype),yt(un.prototype,"connect",[eo],Object.getOwnPropertyDescriptor(un.prototype,"connect"),un.prototype),yt(un.prototype,"updateRemoteRTPCapabilities",[eo],Object.getOwnPropertyDescriptor(un.prototype,"updateRemoteRTPCapabilities"),un.prototype),yt(un.prototype,"publishDataChannel",[eo],Object.getOwnPropertyDescriptor(un.prototype,"publishDataChannel"),un.prototype),yt(un.prototype,"unpublish",[eo],Object.getOwnPropertyDescriptor(un.prototype,"unpublish"),un.prototype),yt(un.prototype,"unpublishDataChannel",[eo],Object.getOwnPropertyDescriptor(un.prototype,"unpublishDataChannel"),un.prototype),yt(un.prototype,"unpublishLowStream",[eo],Object.getOwnPropertyDescriptor(un.prototype,"unpublishLowStream"),un.prototype),yt(un.prototype,"subscribeDataChannel",[eo],Object.getOwnPropertyDescriptor(un.prototype,"subscribeDataChannel"),un.prototype),yt(un.prototype,"subscribe",[eo],Object.getOwnPropertyDescriptor(un.prototype,"subscribe"),un.prototype),yt(un.prototype,"massSubscribe",[eo],Object.getOwnPropertyDescriptor(un.prototype,"massSubscribe"),un.prototype),yt(un.prototype,"unsubscribe",[eo],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribe"),un.prototype),yt(un.prototype,"unsubscribeDataChannel",[eo],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribeDataChannel"),un.prototype),yt(un.prototype,"massUnsubscribe",[eo],Object.getOwnPropertyDescriptor(un.prototype,"massUnsubscribe"),un.prototype),yt(un.prototype,"muteRemote",[eo],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),yt(un.prototype,"unmuteRemote",[eo],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),yt(un.prototype,"hasRemoteMediaWithLock",[eo],Object.getOwnPropertyDescriptor(un.prototype,"hasRemoteMediaWithLock"),un.prototype),yt(un.prototype,"disconnectForReconnect",[eo],Object.getOwnPropertyDescriptor(un.prototype,"disconnectForReconnect"),un.prototype),yt(un.prototype,"updateBitrateLimit",[eo],Object.getOwnPropertyDescriptor(un.prototype,"updateBitrateLimit"),un.prototype),yt(un.prototype,"remoteMediaSsrcChanged",[eo],Object.getOwnPropertyDescriptor(un.prototype,"remoteMediaSsrcChanged"),un.prototype),un);function eo(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function v9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function S9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?v9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):v9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Jfe=Date.now(),Qfe=20,Lx=new Map,EP=new Map;async function T9(e){const r=Lx.get(e),i=Array.isArray(r)&&r[r.length-1],o=EP.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(r.pop(),b9(i.context,c),m=0):m=Math.min(m,Qfe),setTimeout(()=>r.length&&T9(e),m)}function b9(e,r){e.safeEmit(mn.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function Zfe(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return b9(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=Lx.get(o)||[],u=c.findIndex(y=>e.sendTs>=y.sendTs),h=S9(S9({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),Lx.set(o,c);let m=!1;var _;EP.has(o)?m=!((_=EP.get(o))===null||_===void 0||!_.isSyncing):EP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||T9(o)}const eme=Rn().name;function w9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function R9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?w9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Kv="websdk_ng_cache_parameter",tme=re("MAX_PRELOAD_ASYNC_LENGTH"),nme=1e4,B_=new Map,W_=[];let xx=null,Mx=0,Ux=0;const yP=new Map,rme=function(e,r){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new lt(async(_,y)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){y(S)}}),o<r&&(o++,c())})}}(C9,tme),Vx=Go.CancelToken.source();async function C9(e,r,i,o,c,u){try{if(!re("ENABLE_PRELOAD"))return;if(!kn().supportWebCrypto)return void Sm(()=>{D.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Le(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&rs(i,"token",1,2047),rs(e,"appid",1,2047),YA(r),o&&XA(o);const h=C_();D.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:e,cname:r,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,y;typeof o=="string"?(m.stringUid=o,[y,_]=await lt.all([Ffe(o,{sid:h,appId:e},Vx.token),qG(R9(R9({},m),{},{token:i||e,uid:0}),Vx.token)]),m.uid=y.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await qG(m,Vx.token));const S={sid:h,appId:e,cname:r,token:i||e,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:_};await async function(R){let P;try{R.uid&&A9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const k=N9(R),W=await async function(V,q){try{const Y=await window.crypto.subtle.importKey("raw",E8(q),"AES-GCM",!1,["encrypt"]),ce=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,R_(window.btoa(JSON.stringify(V))));return Tm(new Uint8Array(ce))}catch{return}}(R,R.token||R.appId);if(!W)return;P=k9(Kv);const U=P?JSON.parse(P):[];U.push({[k]:W}),U.length>re("AP_CACHE_NUM")&&U.shift(),vP(Kv,JSON.stringify(U))}catch(k){D.warn("Error caching server parameters:",k.message),vP(Kv,"")}}(S),Mx++}catch(h){throw Ux++,function(m){xx||(xx=window.setTimeout(()=>{let y="";yP.forEach((S,R)=>{y+="".concat(R,": ").concat(S," ;")}),wt.reportApiInvoke(null,{name:mi.PRELOAD,options:{success:Mx,failed:Ux,err:y}}).onError(m),Mx=0,Ux=0,yP.clear(),xx=null},nme));const _=yP.get(m.code)||0;yP.set(m.code,_+1)}(h),h}}async function I9(e){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const r=A9(e);if(!r||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",E8(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,R_(o));return JSON.parse(window.atob(Tm(new Uint8Array(h))))}catch{return}}(r,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<re("AP_CACHE_LIFETIME"))return i}catch(r){D.warn("Error get preloadInfo",r.message)}}function A9(e){let r;try{if(r=k9(Kv),!r)return;const i=JSON.parse(r),o=N9(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return vP(Kv,JSON.stringify(i)),u[o]}catch(i){D.warn("Error delete preload info: ".concat(r),i.message),vP(Kv,"")}}function Fx(e){if(e){let r=B_.get(e);r&&(window.clearTimeout(r),r=null,B_.delete(e)),ot(W_).call(W_,e)||e.cloudProxyServer!=="disabled"||W_.push(e)}if(B_.size<re("AP_CACHE_NUM")&&W_.length>0){const r=W_.shift();B_.set(r,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await rme(i,o,c,h,m,u),B_.has(r)&&Fx(r)}catch(_){D.warn("update preload failed",_.message),P9(r)}},re("AP_UPDATE_INTERVAL")))}}function P9(e){const r=W_.indexOf(e);r!==-1&&W_.splice(r,1);let i=B_.get(e);i&&(window.clearTimeout(i),i=null,B_.delete(e),Fx())}function O9(e,r){const i=e.sua,o=e.ap;r&&i&&wt.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:e.intUid,errorCode:null,extend:i.req}),wt.reportResourceTiming(e.ap.url,e.sid),wt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ai.CHOOSE_SERVER,ai.CLOUD_PROXY_FALLBACK].toString()}),wt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function k9(e){return window.atob(window.localStorage.getItem(e)||"")}function vP(e,r){window.localStorage.setItem(e,window.btoa(r))}function N9(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),R8(r)}function ime(e){let r=function(){const i=ame.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(ui(o,10),Nm(o,c));let u=i.cid;u!==void 0&&(ui(o,16),ui(o,u));let h=i.cname;h!==void 0&&(ui(o,26),Nm(o,h));let m=i.deviceId;m!==void 0&&(ui(o,34),Nm(o,m));let _=i.elapse;_!==void 0&&(ui(o,40),Dm(o,_));let y=i.fileSize;y!==void 0&&(ui(o,48),Dm(o,qv(y)));let S=i.height;S!==void 0&&(ui(o,56),Dm(o,qv(S)));let R=i.jpg;R!==void 0&&(ui(o,66),ui(o,R.length),L9(o,R));let P=i.networkType;P!==void 0&&(ui(o,72),Dm(o,qv(P)));let k=i.osType;k!==void 0&&(ui(o,80),Dm(o,qv(k)));let W=i.requestId;W!==void 0&&(ui(o,90),Nm(o,W));let U=i.sdkVersion;U!==void 0&&(ui(o,98),Nm(o,U));let V=i.sequence;V!==void 0&&(ui(o,104),Dm(o,qv(V)));let q=i.sid;q!==void 0&&(ui(o,114),Nm(o,q));let Y=i.timestamp;Y!==void 0&&(ui(o,120),Dm(o,Y));let ce=i.uid;ce!==void 0&&(ui(o,128),ui(o,ce));let _e=i.vid;_e!==void 0&&(ui(o,136),ui(o,_e));let ye=i.width;ye!==void 0&&(ui(o,144),Dm(o,qv(ye)));let me=i.service;me!==void 0&&(ui(o,152),ui(o,me));let ke=i.callbackData;ke!==void 0&&(ui(o,162),ui(o,ke.length),L9(o,ke));let Ye=i.ticket;Ye!==void 0&&(ui(o,170),Nm(o,Ye));let ut=i.vendorConfigs;ut!==void 0&&(ui(o,178),Nm(o,ut))}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function sme(e){return function(i){let o={};e:for(;!cme(i);){let c=Ab(i);switch(c>>>3){case 0:break e;case 1:o.code=Ab(i);break;case 2:o.msg=x9(i,Ab(i));break;case 3:o.requestId=x9(i,Ab(i));break;case 4:o.timestamp=lme(i,!1);break;default:ome(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function ome(e,r){switch(r){case 0:for(;128&hu(e););break;case 2:jx(e,Ab(e));break;case 5:jx(e,4);break;case 1:jx(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function qv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let ame=[];function jx(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function cme(e){return e.offset>=e.limit}function SP(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function D9(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function L9(e,r){let i=SP(e,r.length);e.bytes.set(r,i)}function x9(e,r){let i=D9(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,y,S,R,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Nm(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}ui(e,o);let c=SP(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function hu(e){return e.bytes[D9(e,1)]}function M9(e,r){let i=SP(e,1);e.bytes[i]=r}function Ab(e){let r,i=0,o=0;do r=hu(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function ui(e,r){for(r>>>=0;r>=128;)M9(e,127&r|128),r>>>=7;M9(e,r)}function lme(e,r){let i,o=0,c=0,u=0;return i=hu(e),o=127&i,128&i&&(i=hu(e),o|=(127&i)<<7,128&i&&(i=hu(e),o|=(127&i)<<14,128&i&&(i=hu(e),o|=(127&i)<<21,128&i&&(i=hu(e),c=127&i,128&i&&(i=hu(e),c|=(127&i)<<7,128&i&&(i=hu(e),c|=(127&i)<<14,128&i&&(i=hu(e),c|=(127&i)<<21,128&i&&(i=hu(e),u=127&i,128&i&&(i=hu(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function Dm(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=SP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const U9={},V9={},TP=4294967296,ume=TP*TP,dme=ume/2;j9(0,!0);const F9=j9(0),hme=Pb(0,-2147483648,!1),pme=Pb(-1,2147483647,!1);function j9(e,r){let i,o,c;return r?(c=0<=(e>>>=0)&&e<256)&&(o=V9[e],o)?o:(i=Pb(e,0,!0),c&&(V9[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=U9[e],o)?o:(i=Pb(e,e<0?-1:0,!1),c&&(U9[e]=i),i)}function Pb(e,r,i){return{low:0|e,high:0|r,unsigned:!!i}}function B9(e,r){if(isNaN(e))return F9;{if(e<=-9223372036854776e3)return hme;if(e+1>=dme)return pme}return e<0?F9:Pb(e%TP|0,e/TP|0,r)}function W9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class Bx extends Ar{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(fd.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),$(this,"name","AgoraRTCImageModeration"),$(this,"_connectionState",gl.CONNECTING),$(this,"_sequence",0),$(this,"_moderationStartTime",void 0),$(this,"_workerConnection",void 0),$(this,"_workerMessageLengthLimit",void 0),$(this,"_qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Go.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"_moderationInterval",void 0),$(this,"_moderationTimer",null),$(this,"_moderationMode",1),$(this,"_quality",1),$(this,"_qualityTimer",null),$(this,"_ticket",void 0),$(this,"_moderationIntervalMinimum",void 0),$(this,"_uploadFailedNum",0),$(this,"_uploadNum",0),$(this,"_uploadTimer",null),$(this,"_extraInfo",void 0),$(this,"_vendor",""),$(this,"_encoder",new TextEncoder),$(this,"_moderationId",void 0),$(this,"inspectImage",()=>{if(this.connectionState!==gl.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===gl.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=or(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Eb("worker-"+this._moderationId,gi),this.on(fd.STATE_CHANGE,(o,c)=>{D.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Uv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(fd.STATE_CHANGE,Uv.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new lt((c,u)=>{this.on(fd.CONNECTION_STATE_CHANGE,(h,m)=>{h===gl.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),D.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===gl.CONNECTED&&this.inspectImage()}async requestAP(r,i,o){const c=re("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,y,S,R){let{appId:P,areaCode:k,cname:W,sid:U,token:V,uid:q}=y;zv++;const Y="moderation_plugin",ce={service_name:Y,json_body:JSON.stringify({appId:P,areaCode:k,cname:W,command:"allocateEdge",requestId:zv,seq:zv,sid:U,appToken:V,ts:Date.now(),uid:q+""})};let _e,ye,me=_[0];return ud(async()=>{_e=Date.now();const ke=await md(me,{data:ce,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-_e,ke.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ke.code,{retry:!0,responseTime:ye});throw D.error(pt.toString()),pt}const Ye=JSON.parse(ke.json_body);if(Ye.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ye.code,", reason: ").concat(Ye.reason),{code:Ye.code,responseTime:ye});throw D.error(pt.toString()),pt}if(!Ye.servers||!Array.isArray(Ye.servers)||Ye.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ye.code,responseTime:ye});throw D.error(pt.toString()),pt}if(!Ye.servers.some(pt=>!!pt.wss)){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ye.code,responseTime:ye});throw D.error(pt.toString()),pt}const ut=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ye.servers.map(pt=>{let{address:yn,wss:vn}=pt;if(yn&&vn)return"wss://".concat(yn.replace(/\./g,"-"),".").concat(ut,":").concat(vn,"/moderation")}).filter(pt=>!!pt),workerToken:Ye.workerToken,vid:Ye.vid,ticket:Ye.appTicket,responseTime:ye}},(ke,Ye)=>(wt.apworkerEvent(U,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ke.addressList),firstSuccess:Ye===0,responseTime:ye,serverIp:_[Ye%_.length]}),!1),(ke,Ye)=>(wt.apworkerEvent(U,{success:!1,sc:ke.data&&ke.data.code||200,serviceName:Y,responseTime:ye,serverIp:_[Ye%_.length]}),!!(ke.code!==X.OPERATION_ABORTED&&ke.code!==X.UNEXPECTED_RESPONSE||ke.data&&ke.data.retry)&&(me=_[(Ye+1)%_.length],!0)),R)}(c,r,i,o);this.emit(fd.STATE_CHANGE,Uv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(fd.STATE_CHANGE,Uv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(qt.CONNECTED,async()=>{this.emit(fd.STATE_CHANGE,Uv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=gl.CONNECTED}),this._workerConnection.on(qt.CLOSED,()=>{this.connectionState=gl.CLOSED}),this._workerConnection.on(qt.FAILED,()=>{this.connectionState=gl.CLOSED}),this._workerConnection.on(qt.RECONNECTING,()=>{this.connectionState=this.connectionState===gl.CONNECTED?gl.RECONNECTING:gl.CONNECTING}),this._workerConnection.on(qt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=sme(new Uint8Array(r.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,D.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{wt.reportApiInvoke(this._connectInfo.sid||null,{name:mi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:xr.TRACER}).onError(new Oe(X.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else D.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(qt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(qt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Pc(this,fd.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,i);this._workerConnection.sendMessage(o,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await fW(S,o,c),P=this._sequence+"-"+u+"-"+_+"-"+y+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:Bx.intToLong(Number(y-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:B9(y),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const W=ime(k);if(W.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=function(V){for(var q=1;q<arguments.length;q++){var Y=arguments[q]!=null?arguments[q]:{};q%2?W9(Object(Y),!0).forEach(function(ce){$(V,ce,Y[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Y)):W9(Object(Y)).forEach(function(ce){Object.defineProperty(V,ce,Object.getOwnPropertyDescriptor(Y,ce))})}return V}({},k);delete U.jpg,D.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return W}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Go.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=gl.CLOSED,this.emit(fd.STATE_CHANGE,Uv.CLOSED)}}function z9(e){if(er(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Oe(X.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fme={name:"ImageModeration",create:function(e){let{config:r}=e;return z9(r),new Bx(r)}};var G9,H9,$9,K9,q9,Y9,X9,J9,Q9,Z9,eH,tH,nH,rH,iH,sH,oH,aH,cH,lH,uH,dH,hH,pH,fH,mH,gH,_H,EH,yH,vH,SH,TH,bH,wH,RH,CH,IH,AH,PH,OH,ht;function kH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function pu(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?kH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}As.setLogger(D);let mme=(G9=Mt(),H9=Mt({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof Pv))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),$9=Mt({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Av.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),K9=Mt({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),q9=Mt({argsMap:(e,r,i)=>[r,i]}),Y9=Mt({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),X9=Mt({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),J9=Mt({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),Q9=Mt(),Z9=Mt(),eH=Mt(),tH=Mt(),nH=Mt(),rH=Mt(),iH=Mt(),sH=Mt(),oH=Mt(),aH=Mt(),cH=Mt(),lH=Mt(),uH=Mt(),dH=Mt(),hH=Mt(),pH=Mt({argsMap:(e,r)=>[r]}),fH=Mt(),mH=Mt(),gH=Mt(),_H=Mt(),EH=Mt(),yH=Mt(),vH=Mt(),SH=Mt(),TH=Mt({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),bH=Mt(),wH=Mt(),RH=Mt(),CH=Mt(),IH=Mt(),AH=Mt(),PH=Mt({reportResult:!0}),OH=Mt(),ht=class extends Ar{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let i;if(super(),$(this,"store",void 0),$(this,"_uid",void 0),$(this,"_channelName",void 0),$(this,"_uintUid",void 0),$(this,"_users",[]),$(this,"_config",void 0),$(this,"_clientId",void 0),$(this,"_appId",void 0),$(this,"_sessionId",null),$(this,"_key",void 0),$(this,"_rtmConfig",{}),$(this,"_joinInfo",void 0),$(this,"_gateway",void 0),$(this,"_statsCollector",void 0),$(this,"_configDistribute",void 0),$(this,"_leaveMutex",void 0),$(this,"_publishMutex",void 0),$(this,"_renewTokenMutex",void 0),$(this,"_subscribeMutex",void 0),$(this,"_encryptionMode","none"),$(this,"_encryptionSecret",null),$(this,"_encryptionSalt",null),$(this,"_encryptDataStream",!1),$(this,"_encryptDataStreamKey",null),$(this,"_encryptDataStreamIv",null),$(this,"_proxyServer",void 0),$(this,"_turnServer",{servers:[],mode:"auto"}),$(this,"_cloudProxyServerMode","disabled"),$(this,"_isDualStreamEnabled",!1),$(this,"_defaultStreamFallbackType",void 0),$(this,"_lowStreamParameter",void 0),$(this,"_streamFallbackTypeCacheMap",new Map),$(this,"_remoteStreamTypeCacheMap",new Map),$(this,"_axiosCancelSource",Go.CancelToken.source()),$(this,"_audioVolumeIndicationInterval",void 0),$(this,"_networkQualityInterval",void 0),$(this,"_userOfflineTimeout",void 0),$(this,"_streamRemovedTimeout",void 0),$(this,"_liveTranscodeStreamingClient",void 0),$(this,"_liveRawStreamingClient",void 0),$(this,"_channelMediaRelayClient",void 0),$(this,"_networkQualitySensitivity","normal"),$(this,"_p2pChannel",void 0),$(this,"_useLocalAccessPoint",!1),$(this,"_setLocalAPVersion",void 0),$(this,"_joinAndNotLeaveYet",!1),$(this,"_numberOfJoinCount",0),$(this,"_remoteDefaultVideoStreamType",void 0),$(this,"_inspect",void 0),$(this,"_moderation",void 0),$(this,"_license",void 0),$(this,"_pendingPublishedUsers",[]),$(this,"ntpAlignErrorCount",0),$(this,"remoteInboundOffset",0),$(this,"_peerConnectionState",void 0),$(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),$(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),$(this,"_handleUserOnline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(c.uid,this.channelName))return void D.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&D.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(mn.USER_JOINED,u));else{const h=new Om(c.uid,c.uint_id||c.uid);this._users.push(h),D.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(mn.USER_JOINED,h)}}),$(this,"_handleUserOffline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:wA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),D.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(mn.USER_LEAVED,u,c.reason))}),$(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,y,S)=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(u,this.channelName))return;const R=this._users.find(k=>k.uid===u);if(!R)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=_||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),y&&(R._audioOrtc=y)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),y&&(R._videoOrtc=y)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(D.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,R,c)),c==="video"?wt.onGatewayStream(this._sessionId,Mi.ON_ADD_VIDEO_STREAM,wr.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:R._videoSSRC}):wt.onGatewayStream(this._sessionId,Mi.ON_ADD_AUDIO_STREAM,wr.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(k=>{if(k&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ib))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(W=>{D.error("[".concat(this._clientId,"] resubscribe error"),W.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(k=>{D.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),$(this,"_handleRemoveStream",c=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));D.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio"),D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Ib&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),wt.onGatewayStream(this._sessionId,Mi.ON_REMOVE_STREAM,wr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),$(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void D.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));D.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";D.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}const y=c==="audio"?m.hasAudio:m.hasVideo;return _!==y?!_&&y?(D.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(mn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),D.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(mn.USER_UNPUBLISHED,m,c)):void 0}),$(this,"_handleMuteStream",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(c,this.channelName))return;D.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(_!==y){if(!_&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(D.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(mn.USER_PUBLISHED,m,u)):void D.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),D.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(mn.USER_UNPUBLISHED,m,u)}}),$(this,"_handleP2PLost",async c=>{D.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():D.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),$(this,"_handleTokenWillExpire",()=>{D.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),$(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),D.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),$(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(mn.NETWORK_QUALITY,c)}),$(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const y=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!y&&(D.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{D.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=r||or(5,"client-"),this.store=new class{constructor(c,u,h,m){zt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:I_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case gn.SET_SESSION_ID:return ft(ft({},u),{},{sessionId:h.sessionId});case gn.SET_P2P_ID:return ft(ft({},u),{},{p2pId:h.p2pId});case gn.SET_UID:return ft(ft({},u),{},{uid:h.uid});case gn.SET_INT_UID:return ft(ft({},u),{},{intUid:h.intUid});case gn.SET_PUB_ID:return ft(ft({},u),{},{pubId:h.pubId});case gn.KEY_METRIC_CLIENT_CREATED:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{clientCreated:h.metric})});case gn.KEY_METRIC_JOIN_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{joinStart:h.metric})});case gn.AVOID_JOIN_START:return ft(ft({},u),{},{avoidJoinStart:h.avoidJoinStart});case gn.KEY_METRIC_JOIN_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{joinEnd:h.metric})});case gn.KEY_METRIC_REQUEST_AP_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{requestAPStart:h.metric})});case gn.KEY_METRIC_REQUEST_AP_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{requestAPEnd:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case gn.KEY_METRIC_DESCRIPTION_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{descriptionStart:h.metric})});case gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case gn.KEY_METRIC_ICE_CONNECTION_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case gn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(y=>y.trackId===h.metric.trackId);return _!==-1?(m[_]=ft(ft({},m[_]),h.metric),ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{publish:[...m]})})):ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case gn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return _!==-1?(m[_]=ft(ft({},m[_]),h.metric),ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{subscribe:[...m]})})):ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case gn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case gn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=ft(ft({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case gn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case gn.SET_USE_P2P:return ft(ft({},u),{},{useP2P:h.val});case gn.SET_TRANSPORT_TYPE:return ft(ft({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:gn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:gn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:gn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:gn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:gn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:gn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:gn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:gn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:gn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:gn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:gn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:gn.KEY_METRIC_PUBLISH,metric:ft(ft({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,y,S){this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:ft(ft(ft(ft(ft({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),y&&{streamAdded:y}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:ft(ft(ft({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:ft(ft({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:gn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:gn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new As("client-leave",this._clientId),this._publishMutex=new As("client-publish",this._clientId),this._renewTokenMutex=new As("client-renewtoken",this._clientId),this._subscribeMutex=new As("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),D.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(pl," build: ").concat(DL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{vL(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){D.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new Rb(this.store),this._statsCollector.onStatsException=(c,u,h)=>{D.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(mn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(y=>y.uid===c);_&&wt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Dfe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||gi,httpRetryConfig:e.httpRetryConfig||gi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new zfe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Kp("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new Ib(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Xn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Xn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof hx&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,y,S){yA.get(_)||yA.set(_,[]),vA.get(_)||vA.set(_,y),lh.get(_)||lh.set(_,0);const R=yA.get(_),P=vA.get(_);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(lh.get(_)===P){const q=nb();R.push(q),await q.promise}lh.set(_,lh.get(_)+1);for(var k=arguments.length,W=new Array(k>3?k-3:0),U=3;U<k;U++)W[U-3]=arguments[U];const V=await S(...W);return lh.set(_,lh.get(_)-1),lh.get(_)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),lh.get(_)===0&&(yA.set(_,[]),vA.set(_,0),lh.set(_,0)),V}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,i,o,c)}async join(e,r,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(IA||IA||(IA=(window.location.protocol.split(":")[0]||"").toUpperCase(),IA))==="HTTPS",m=A8()?window.isSecureContext:"Browser Not Support";(!A8()&&!h||!window.isSecureContext)&&D.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),D.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),wt.setAppId(e);try{if(!i&&i!==null)throw new Oe(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&rs(i,"token",1,2047),rs(e,"appid",1,2047),YA(r),o&&XA(o),c&&rs(c,"optionalInfo",1,2047)}catch(U){throw wt.reportApiInvoke(C_(),{name:mi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(D.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),D.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw wt.reportApiInvoke(C_(),{name:mi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}).onError(U),U}this._gateway.state="CONNECTING";const _=await I9({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(_==null?void 0:_.sid)||C_();D.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const S=wt.reportApiInvoke(y,{id:this._clientId,name:mi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}),R=pu(pu(pu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async U=>{const V=function(_e){const ye=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),me=new Uint8Array(new ArrayBuffer(ye.length));for(let ke=0;ke<ye.length;ke+=1)me[ke]=ye.charCodeAt(ke);return me}(),q=await window.crypto.subtle.importKey("spki",V,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=EL(U),ce=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Y);return function(_e){let ye="";for(let me=0;me<_e.length;me+=1)ye+=String.fromCharCode(_e[me]);return window.btoa(ye)}(new Uint8Array(ce))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,V=re("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(R.appId+this._encryptionSecret+this._encryptionSecret):U.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,Y,ce){const _e=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),ye=q==="aes-128-gcm2"?128:256,me=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:V8,hash:"SHA-256",salt:ce},_e,ye+lpe);return new Uint8Array(me).subarray(ye/8)}(this._encryptionMode,V,R_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,Y,ce){const _e=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),ye=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:V8,hash:"SHA-256",salt:ce},_e,{name:"AES-GCM",length:ye},!0,["encrypt","decrypt"])}(this._encryptionMode,V,R_(this._encryptionSalt))}else m?D.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):D.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,D.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&wt.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let U;const V=R.cloudProxyServer;if(ot(k=["proxy3","proxy4","proxy5"]).call(k,V)){const ye=re("PROXY_SERVER_TYPE3");Array.isArray(ye)?R.proxyServer=ye[0]:R.proxyServer=ye}if(wt.setProxyServer(R.proxyServer),D.setProxyServer(R.proxyServer),this.store.requestAPStart(),_){if(D.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(_.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=_.intUid),U={gatewayInfo:_.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ye=(await yG(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(me=>({turnServerURL:me.address,tcpport:me.tcpport||Ss.tcpport,udpport:me.udpport||Ss.udpport,username:me.username||Ss.username,password:me.password||Ss.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:ye}}O9(_,R.stringUid)}else{if(R.stringUid&&!R.uid){let ye;[ye,U]=await lt.all([KG(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||gi,this.store),$G(R,this._axiosCancelSource.token,this._config.httpRetryConfig||gi,!0,this.store)]),D.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(ye)),R.uid=ye,U.gatewayInfo.uid=ye,U.gatewayInfo.res.uid=ye}else U=await $G(R,this._axiosCancelSource.token,this._config.httpRetryConfig||gi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(gb.UPDATE_BITRATE_LIMIT,ye=>{this._p2pChannel.updateBitrateLimit(ye)}),this._configDistribute.on(gb.UPDATE_CLIENT_ROLE_OPTIONS,ye=>{this._setClientRoleOptions(ye)})},0),this._key=i||e;const q=U.gatewayInfo,Y=R.uid?R.uid:q.uid;this._joinInfo=pu(pu({},R),{},{cid:q.cid,uid:Y,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Y,this.store.cid=q.cid;const ce=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(ce),this._appId=e,this._channelName=R.cname,this._uid=ce,this.store.uid=ce,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Es()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _e=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return D.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_e)),setTimeout(()=>{D.startUpload()},5e3),this.store.joinEnd(),W=this,ot(D_).call(D_,W)||D_.push(W),this._cloudProxyServerMode==="disabled"&&kn().supportWebCrypto&&re("ENABLE_PRELOAD")&&Fx(this._joinInfo),ce}catch(U){const V=Array.isArray(U)?U[0]:U;throw V&&V.code===X.OPERATION_ABORTED?D.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V):D.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V),V.code!==X.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(V),V}var W}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(X.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){D.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Es()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const i=D_.indexOf(r);i!==-1&&D_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return D.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Bn.LEAVE),D.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Pv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Oe(X.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new Oe(X.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof Pv))throw new Oe(X.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(X.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}D.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof gr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),D.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw D.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){er(e.id,"id",0,65535,!0),jp(e.ordered,"ordered"),rs(e.metadata,"metadata",0,512),D.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Oe(X.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return UG(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(X.CREATE_DATACHANNEL_ERROR);try{await lt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==X.DISCONNECT_P2P)throw c}}return D.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw D.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof Pv))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);D.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(Qr.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),D.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw D.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),D.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),D.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw D.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(e,r,i){if(!(e instanceof Om)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,r)}async presubscribe(e,r){if(Pi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(X.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===mt.AUDIO,o=r===mt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:y}=await this._gateway.presubscribe(e,r,!0);if(u==null)throw new Oe(X.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===e);S||(S=new Om(e,y||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=y||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),D.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=i?S._audioTrack:S._videoTrack;if(!R)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw D.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,r){var i;if(er(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Oe(X.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===r);if(!c)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&ot(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(X.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,r,i){if(Pi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const u=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const h=r==="audio"?e._audioSSRC:e._videoSSRC,m=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,h,m)}catch(h){throw h}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,r,i){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(Pi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===e)){const y=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),y}if(!e.hasAudio&&!e.hasVideo){const y=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),y}if(!(i||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const y=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),y}let c=r==="audio"?e._audioSSRC:e._videoSSRC,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?mt.AUDIO:mt.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const S=r==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?mt.AUDIO:mt.VIDEO,ssrcId:c}),ks.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),R;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,r),S}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const y=r==="audio"?e._audioTrack:e._videoTrack;if(!y)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return y}catch(y){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),y),y}finally{_()}}async massSubscribe(e){if(Bp(e,"subscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,o=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:y}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(y)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:y}=m;return{user:_,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y;if(Pi(R,"mediaType",["audio","video"]),!S){const U=new Oe(X.INVALID_PARAMS,"user property does not exist in subscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===S)){const U=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");D.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=U,e.splice(_,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const U=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);D.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[_].error=U,e.splice(_,1);continue}const k=Ui.Video|Ui.LwoVideo,W=i.get(S);if(W){if(R==="video"?W&k:W&Ui.Audio){e.splice(_,1),D.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}i.set(S,W|(R==="video"?k:Ui.Audio))}else i.set(S,R==="video"?k:Ui.Audio)}for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y,P=Ui.Video|Ui.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const k=i.get(S);i.set(S,R==="video"?k^P:k^Ui.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),r);let m=Ga(h=Array.from(i.entries())).call(h,(_,y)=>{let[S,R]=y;if(R===0)return _;const P={stream_id:S.uid,stream_type:R};return R&Ui.Audio&&(P.audio_ssrc=S._audioSSRC),R&Ui.Video&&(P.video_ssrc=S._videoSSRC),_.push(P),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:S,mediaType:R}=y;return{user:S,mediaType:R,ssrcId:R===mt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===mt.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:k,error_code:W}=S;(P||k||W)&&_.set(R,{video_error_code:P,audio_error_code:k,error_code:W})})}if(Array.from(_.entries()).length>0){const y=[];Array.from(_.entries()).forEach(S=>{let[R,P]=S;const k=this.remoteUsers.find(W=>W.uid===R);if(k){let W;P.error_code||P.video_error_code&&P.audio_error_code?W=void 0:P.video_error_code?W=mt.VIDEO:P.audio_error_code&&(W=mt.AUDIO),y.push({user:k,mediaType:W})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of c){const S=_.get(y.user.uid);if(S){const R=S.error_code||y.mediaType==="audio"&&S.audio_error_code||y.mediaType==="video"&&S.video_error_code;if(R){const P=_b(R);D.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(P.desc)),y.error=new Oe(X.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var S;wt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((S=y.error)===null||S===void 0?void 0:S.code)||null,video:y.mediaType===mt.VIDEO,audio:y.mediaType===mt.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===mt.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),D.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:S,mediaType:R}=y;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,r,i){if(!(e instanceof Om)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(r&&Pi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const u=await this._p2pChannel.unsubscribe(e,r);u&&await this._gateway.unsubscribe(u,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&wA(this._users,e),D.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,r){if(r&&er(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=e._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),c}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),D.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Bp(e,"unsubscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");D.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const r=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const m=new Oe(X.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Pi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){D.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=Ui.Video|Ui.LwoVideo;if(r.has(o)){const m=r.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&Ui.Audio;break;default:_=m&(Ui.Audio|h)}if(_){D.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?r.set(o,m|Ui.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Ui.Audio|h)}else c?c==="audio"?r.set(o,Ui.Audio):c==="video"&&r.set(o,h):r.set(o,Ui.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),D.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===X.DISCONNECT_P2P)return void D.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw D.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Le(X.INVALID_PARAMS);Lr(i.width)||gL(i.width,"streamParameter.width"),Lr(i.height)||gL(i.height,"streamParameter.height"),Lr(i.framerate)||gL(i.framerate,"streamParameter.framerate"),Lr(i.bitrate)||er(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&D.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),D.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,$e.LocalVideoLowTrack)}async enableDualStream(){if(!kn().supportDualStream)throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(X.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(X.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),D.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($e.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),D.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(o){Pi(o,"role",["audience","host"])}(e),r&&vL(r),this.mode==="rtc"||this.mode==="p2p")throw D.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(X.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new Oe(X.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(X.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",ys.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),D.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&vL(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{D.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(rs(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,wt.setProxyServer(this._proxyServer),D.setProxyServer(this._proxyServer),D.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}if(ab(e))return this._turnServer={servers:e,mode:"original-manual"},void D.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>g8(i)),this._turnServer={servers:e,mode:"manual"},D.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"you should set license before join channel");if(rs(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Oe(X.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,D.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Oe(X.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new Oe(X.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Stop proxy server after leave channel");wt.setProxyServer(),D.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Oe(X.INVALID_PARAMS,"accessPoints is required.");Bp(e.accessPoints.serverList,"accessPoints.serverList"),rs(e.accessPoints.domain,"accessPoints.domain");const r=(P,k)=>{er(P,k,0,65535,!0)};let i=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(Xn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Xn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Xn("WEBCS_DOMAIN",h),Xn("WEBCS_DOMAIN_BACKUP_LIST",h),Xn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Bp(e.report.hostname,"report.hostname"),Xn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Xn("EVENT_REPORT_DOMAIN",u[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),m=e.report.port),Xn("STATS_COLLECTOR_PORT",m),e.report?Xn("ENABLE_EVENT_REPORT",!0):Xn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Bp(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let y=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),y=e.log.port),Xn("LOG_UPLOAD_SERVER","".concat(_,":").concat(y));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Bp(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),R=e.cds.port),Xn("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),e.cds?Xn("ENABLE_CONFIG_DISTRIBUTE",!0):Xn("ENABLE_CONFIG_DISTRIBUTE",!1),D.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(Bp(e,"serverList"),rs(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Xn("WEBCS_DOMAIN",e),Xn("WEBCS_DOMAIN_BACKUP_LIST",e),Xn("GATEWAY_DOMAINS",[r]),Xn("EVENT_REPORT_DOMAIN",e[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Xn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),D.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Pi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw D.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else D.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){Pi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw D.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}D.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){Pi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(i){throw D.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}D.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,i,o){(function(u){Pi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),rs(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(ot(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new Oe(X.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(jp(o,"encryptDataStream"),!ot(c).call(c,e))throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||D.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,i&&(this._encryptionSalt=Tm(i))}async renewToken(e){if(rs(e,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){D.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Wfe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||gi);D.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else D.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});D.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,D.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?D.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(mn.VOLUME_INDICATOR,e)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Oe(X.LIVE_STREAMING_TASK_CONFLICT);const i=r?Gp.TRANSCODE:Gp.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Gp.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!r.length)throw new Oe(X.INVALID_PARAMS,"can not find live streaming url to stop");await lt.all(r.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){e9(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){e9(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Ib&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const _=Ga(m=Array.from(h)).call(m,(U,V)=>U+V,0),y={serverTs:0,seq:upe++,length:h.length,checkSum:_},S=new Uint8Array(w8(_,2)),R=new ArrayBuffer(Tv),P=new DataView(R);P.setUint32(0,y.serverTs),P.setUint16(4,y.seq),P.setUint16(6,y.length),P.setUint16(8,y.checkSum);const k=16-h.length%16;h=y8(h,new Uint8Array(k));const W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:U8,additionalData:S},u,h);return y8(new Uint8Array(R),new Uint8Array(W))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Oe(X.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(jt.DATA_STREAM,{payload:Tm(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Jfe},!i)}sendMetadata(e){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Oe(X.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(jt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Tm(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(ype),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send custom report, not joined");await wt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){Pi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Pi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(i){throw D.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:i}=e;if(jp(r,"apRTM"),er(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,D.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(D.debug("[".concat(this._clientId,"] reset client")),function(e){const r=xv.indexOf(e);r!==-1&&xv.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Go.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&P9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&wt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new As("client-publish",this._clientId),this._subscribeMutex=new As("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var i;const o=e||C_();e?D.debug("[".concat(this._clientId,"] new Session ").concat(o)):D.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,wt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};wt.sessionInit(this._sessionId,pu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");D.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Qr.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof gr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{D.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));D.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(X.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Kp("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{wt.reportApiInvoke(this._sessionId,{name:mi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:xr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{wt.reportApiInvoke(this._sessionId,{name:mi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:xr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_WARNING,c,u)},i.on(ux.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(X.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,y,S){const R=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(P=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Mfe(R,m,_,y,S)})(c,this._joinInfo,this._axiosCancelSource.token,gi).then(u).catch(h)}),i};return e===Gp.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(X.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},Kp("ChannelMediaRelay").create(e));o.on("state",c=>{c===va.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(mn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(mn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:i,deleted:o}=e,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:y,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(D.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ot(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!_,maxRetransmits:y,metadata:S},k=function(W){return UG(W,!0)}(P);R._dataChannels.push(k),D.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(mn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(D.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{D.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(mn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=_._dataChannels.find(S=>S.id===u.stream_id);y&&(D.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[y]).then(S=>{if(_._dataChannels=_._dataChannels.filter(R=>R!==y),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),D.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(mn.USER_UNPUBLISHED,_,"datachannel",y._config))})}_handleRemoveDataChannels(e){const r=this._users.find(i=>i.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){D.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(mn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),i()}}else D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Xi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void D.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=i||u||rx()||!Object.prototype.hasOwnProperty.call(OA,o)||(dd[o]=c,mr[o]=c,D.debug("Update gateway parameters from config distribute",o,c))})}catch(r){D.error("Error update config from local cache",r.message)}})()}),this._gateway.on(Xi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Xi.CONNECTION_STATE_CHANGE,(e,r,i)=>{var o;if(i===Bn.FALLBACK)return;const c=()=>{this.safeEmit(mn.CONNECTION_STATE_CHANGE,e,r,i)};if(wt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:mi.CONNECTION_STATE_CHANGE,options:[e,r,i],tag:xr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:i})),D.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{D.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{D.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{D.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,mt.AUDIO,!1)),h._trust_video_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,mt.VIDEO,!1)),h._trust_audio_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(D.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(Xi.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new Oe(X.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await I9(pu(pu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,O9(o),this._joinInfo.preload=!0):(i=await Cx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||gi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(i){r(i)}}),this._gateway.on(Xi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(mn.NETWORK_QUALITY,e)}),this._gateway.on(Xi.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(mn.STREAM_TYPE_CHANGED,e,r),wt.reportApiInvoke(this._sessionId,{name:mi.STREAM_TYPE_CHANGE,options:[e,r],tag:xr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(Xi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Xi.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,i)=>{try{let o=await this._p2pChannel.getEstablishParams();re("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){i(o)}}),this._gateway.on(Xi.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:D.debug("no attributes in joinResponse");const o=RG(e.ortc,r,i);this._p2pChannel.connect(o)}),this._gateway.on(Xi.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:i}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=re("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(_n.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(_n.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(_n.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(_n.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(_n.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(_n.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(_n.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(_n.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(_n.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,mt.AUDIO,!0)),this._gateway.signal.on(_n.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,mt.AUDIO,!1)),this._gateway.signal.on(_n.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,mt.VIDEO,!0)),this._gateway.signal.on(_n.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,mt.VIDEO,!1)),this._gateway.signal.on(_n.RECEIVE_METADATA,e=>{const r=R_(e.metadata);this.safeEmit(mn.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(_n.ON_DATA_STREAM,async e=>{var r;if(!e)return;let i=R_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<Tv)throw new Oe(X.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Tv));i=await async function(u,h,m){const _=m.subarray(0,Tv),y=_.slice(8,Tv),S=(y[0]<<8)+y[1],R=(_[6]<<8)+_[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:U8,additionalData:new Uint8Array(w8(S,2))},h,m.subarray(Tv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Zfe(pu(pu({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(_n.ON_CRYPT_ERROR,()=>{Sm(()=>{D.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(mn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{D.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Bn.TOKEN_EXPIRE),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(_n.ON_STREAM_FALLBACK_UPDATE,e=>{D.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(mn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(_n.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),D.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(_n.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(_n.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Bt.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case jt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:y}=_;return y===zn.Audio}),h=c.some(_=>{let{stream_type:y}=_;return y!==zn.Audio}),m=c.some(_=>{let{stream_type:y}=_;return y===zn.Screen||y===zn.ScreenLow});r.state==="offer"&&wt.publish(this._joinInfo.sid,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:X.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(_=>{let{stream_type:y}=_;return y===zn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:y}=_;return y!==zn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case jt.SUBSCRIBE:r&&wt.subscribe(this._joinInfo.sid,{succ:!1,ec:X.TIMEOUT,audio:r.stream_type===mt.AUDIO,video:r.stream_type===mt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:ks.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(_n.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(_n.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;re("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!L_(o.string_id||o.stream_id,this.channelName)));const r=[],i=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Om(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(mn.USER_JOINED,c)));const u=Ui.Audio&o.stream_type,h=(Ui.Video|Ui.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(mn.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(mn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!y||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(D.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{D.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(mn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(D.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(mn.PUBLISHED_USER_LIST,r)):D.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(_n.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof Ib&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var o;return ot(o=Object.keys(kA)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(_n.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Qr.PUBLISH,(e,r,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const y=this._users.find(S=>S.uid===o);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{r()}).catch(i):r(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(Qr.CALL,async(e,r,i)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(Bt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Qr.UNPUBLISH,async(e,r,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===zn.Audio?mt.AUDIO:mt.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),r()}catch(h){i(h)}}}),this._gateway.signal.on(Qr.CONTROL,async(e,r)=>{const{action:i}=e;switch(i){case Rm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,mt.VIDEO,!0);break;case Rm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,mt.AUDIO,!0);break;case Rm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,mt.VIDEO,!1);break;case Rm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,mt.AUDIO,!1)}}),this._gateway.signal.on(Qr.RESTART_ICE,async(e,r,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==So.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){i(o)}}),this._gateway.signal.on(Qr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:i}=e;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(kt.RequestP2PRestartICE,async(e,r,i)=>{try{const{direction:o}=e;r(await this._gateway.sendExtensionMessage(Qr.RESTART_ICE,e,o===So.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(kt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Qr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(kt.RequestP2PMuteLocal,async(e,r,i)=>{try{await this._gateway.sendExtensionMessage(Qr.CONTROL,e,!0),r()}catch(o){i(o)}}),this._p2pChannel.on(kt.RequestP2PUnmuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestP2PMuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.StateChange,(e,r)=>{r===Wn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(kt.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(mn.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(kt.RequestMuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestUnmuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestRePublish,(e,r,i)=>{this.publish(e,!1).then(r).catch(i)}),this._p2pChannel.on(kt.RequestRePublishDataChannel,(e,r,i)=>{lt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==X.DISCONNECT_P2P)throw u}})).then(r).catch(i)}),this._p2pChannel.on(kt.RequestReSubscribe,async(e,r,i)=>{try{for(const{user:o,kind:c}of e)c===mt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){i(o)}}),this._p2pChannel.on(kt.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(kt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(kt.MediaReconnectStart,e=>{this.safeEmit(mn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(kt.MediaReconnectEnd,e=>{this.safeEmit(mn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(kt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(kt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(kt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(kt.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:o}),h=RG(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(kt.RequestUnpublishForReconnectPC,async(e,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):i()}),this._p2pChannel.on(kt.P2PLost,()=>{this.safeEmit(mn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(kt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(kt.ConnectionTypeChange,e=>{this.safeEmit(mn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(kt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(kt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(kt.AudioMetadata,e=>{this.safeEmit(mn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:e},Kp("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:y}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:y?Number(y):0},gi)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(e){e.on(Ji.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(mn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===lu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(mn.CONTENT_INSPECT_ERROR,new Oe(X.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Ji.INSPECT_RESULT,(r,i)=>{var o;if((i==null?void 0:i.code)===X.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return D.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(mn.CONTENT_INSPECT_RESULT,r,i)}),e.on(Ji.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(jp(e,"enabled"),e){if(!r)throw new Oe(X.INVALID_PARAMS,"config is required");if(z9(r),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(i={config:r},Kp("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:y,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:y,vid:S?Number(S):0},gi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(fd.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(mn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===gl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(X.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(fd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){Pi(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Oe(X.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,D.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return D.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){jp(e,"enabled"),Xn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},yt(ht.prototype,"leave",[G9],Object.getOwnPropertyDescriptor(ht.prototype,"leave"),ht.prototype),yt(ht.prototype,"publish",[H9],Object.getOwnPropertyDescriptor(ht.prototype,"publish"),ht.prototype),yt(ht.prototype,"unpublish",[$9],Object.getOwnPropertyDescriptor(ht.prototype,"unpublish"),ht.prototype),yt(ht.prototype,"subscribe",[K9],Object.getOwnPropertyDescriptor(ht.prototype,"subscribe"),ht.prototype),yt(ht.prototype,"presubscribe",[q9],Object.getOwnPropertyDescriptor(ht.prototype,"presubscribe"),ht.prototype),yt(ht.prototype,"massSubscribe",[Y9],Object.getOwnPropertyDescriptor(ht.prototype,"massSubscribe"),ht.prototype),yt(ht.prototype,"unsubscribe",[X9],Object.getOwnPropertyDescriptor(ht.prototype,"unsubscribe"),ht.prototype),yt(ht.prototype,"massUnsubscribe",[J9],Object.getOwnPropertyDescriptor(ht.prototype,"massUnsubscribe"),ht.prototype),yt(ht.prototype,"setLowStreamParameter",[Q9],Object.getOwnPropertyDescriptor(ht.prototype,"setLowStreamParameter"),ht.prototype),yt(ht.prototype,"enableDualStream",[Z9],Object.getOwnPropertyDescriptor(ht.prototype,"enableDualStream"),ht.prototype),yt(ht.prototype,"disableDualStream",[eH],Object.getOwnPropertyDescriptor(ht.prototype,"disableDualStream"),ht.prototype),yt(ht.prototype,"setClientRole",[tH],Object.getOwnPropertyDescriptor(ht.prototype,"setClientRole"),ht.prototype),yt(ht.prototype,"_setClientRoleOptions",[nH],Object.getOwnPropertyDescriptor(ht.prototype,"_setClientRoleOptions"),ht.prototype),yt(ht.prototype,"setProxyServer",[rH],Object.getOwnPropertyDescriptor(ht.prototype,"setProxyServer"),ht.prototype),yt(ht.prototype,"setTurnServer",[iH],Object.getOwnPropertyDescriptor(ht.prototype,"setTurnServer"),ht.prototype),yt(ht.prototype,"setLicense",[sH],Object.getOwnPropertyDescriptor(ht.prototype,"setLicense"),ht.prototype),yt(ht.prototype,"startProxyServer",[oH],Object.getOwnPropertyDescriptor(ht.prototype,"startProxyServer"),ht.prototype),yt(ht.prototype,"stopProxyServer",[aH],Object.getOwnPropertyDescriptor(ht.prototype,"stopProxyServer"),ht.prototype),yt(ht.prototype,"setLocalAccessPointsV2",[cH],Object.getOwnPropertyDescriptor(ht.prototype,"setLocalAccessPointsV2"),ht.prototype),yt(ht.prototype,"setLocalAccessPoints",[lH],Object.getOwnPropertyDescriptor(ht.prototype,"setLocalAccessPoints"),ht.prototype),yt(ht.prototype,"setRemoteDefaultVideoStreamType",[uH],Object.getOwnPropertyDescriptor(ht.prototype,"setRemoteDefaultVideoStreamType"),ht.prototype),yt(ht.prototype,"setRemoteVideoStreamType",[dH],Object.getOwnPropertyDescriptor(ht.prototype,"setRemoteVideoStreamType"),ht.prototype),yt(ht.prototype,"setStreamFallbackOption",[hH],Object.getOwnPropertyDescriptor(ht.prototype,"setStreamFallbackOption"),ht.prototype),yt(ht.prototype,"setEncryptionConfig",[pH],Object.getOwnPropertyDescriptor(ht.prototype,"setEncryptionConfig"),ht.prototype),yt(ht.prototype,"renewToken",[fH],Object.getOwnPropertyDescriptor(ht.prototype,"renewToken"),ht.prototype),yt(ht.prototype,"enableAudioVolumeIndicator",[mH],Object.getOwnPropertyDescriptor(ht.prototype,"enableAudioVolumeIndicator"),ht.prototype),yt(ht.prototype,"startLiveStreaming",[gH],Object.getOwnPropertyDescriptor(ht.prototype,"startLiveStreaming"),ht.prototype),yt(ht.prototype,"setLiveTranscoding",[_H],Object.getOwnPropertyDescriptor(ht.prototype,"setLiveTranscoding"),ht.prototype),yt(ht.prototype,"stopLiveStreaming",[EH],Object.getOwnPropertyDescriptor(ht.prototype,"stopLiveStreaming"),ht.prototype),yt(ht.prototype,"startChannelMediaRelay",[yH],Object.getOwnPropertyDescriptor(ht.prototype,"startChannelMediaRelay"),ht.prototype),yt(ht.prototype,"updateChannelMediaRelay",[vH],Object.getOwnPropertyDescriptor(ht.prototype,"updateChannelMediaRelay"),ht.prototype),yt(ht.prototype,"stopChannelMediaRelay",[SH],Object.getOwnPropertyDescriptor(ht.prototype,"stopChannelMediaRelay"),ht.prototype),yt(ht.prototype,"sendCustomReportMessage",[TH],Object.getOwnPropertyDescriptor(ht.prototype,"sendCustomReportMessage"),ht.prototype),yt(ht.prototype,"pickSVCLayer",[bH],Object.getOwnPropertyDescriptor(ht.prototype,"pickSVCLayer"),ht.prototype),yt(ht.prototype,"setRTMConfig",[wH],Object.getOwnPropertyDescriptor(ht.prototype,"setRTMConfig"),ht.prototype),yt(ht.prototype,"enableContentInspect",[RH],Object.getOwnPropertyDescriptor(ht.prototype,"enableContentInspect"),ht.prototype),yt(ht.prototype,"disableContentInspect",[CH],Object.getOwnPropertyDescriptor(ht.prototype,"disableContentInspect"),ht.prototype),yt(ht.prototype,"setImageModeration",[IH],Object.getOwnPropertyDescriptor(ht.prototype,"setImageModeration"),ht.prototype),yt(ht.prototype,"setP2PTransport",[AH],Object.getOwnPropertyDescriptor(ht.prototype,"setP2PTransport"),ht.prototype),yt(ht.prototype,"getJoinChannelServiceRecords",[PH],Object.getOwnPropertyDescriptor(ht.prototype,"getJoinChannelServiceRecords"),ht.prototype),yt(ht.prototype,"setPublishAudioFilterEnabled",[OH],Object.getOwnPropertyDescriptor(ht.prototype,"setPublishAudioFilterEnabled"),ht.prototype),ht);class Ob{constructor(r,i){$(this,"id",0),$(this,"element",void 0),$(this,"peerPair",void 0),$(this,"context",void 0),$(this,"audioPlayerElement",void 0),$(this,"audioTrack",void 0),Ob.count+=1,this.id=Ob.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new lt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new Oe(X.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new Oe(X.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new Oe(X.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){D.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var NH,bP;$(Ob,"count",0);const gme=window.AudioContext||window.webkitAudioContext,_me=new(NH=Mt({report:wt}),yt((bP=class{constructor(){$(this,"units",[]),$(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return D.debug("the system does not need to process local aec"),-1;this.context||(this.context=new gme);let r=this.units.find(i=>i&&i.getElement()===e);return r||(r=new Ob(e,this.context),this.units.push(r)),r.startEchoCancellation(),D.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Rn().name!==Un.SAFARI}}).prototype,"processExternalMediaAEC",[NH],Object.getOwnPropertyDescriptor(bP.prototype,"processExternalMediaAEC"),bP.prototype),bP);function DH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function LH(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?DH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):DH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Wx=window||document;function xH(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Wx)return;const i=_i._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const o=c=>{if(!(c&&c.blockedURI&&(_i.onSecurityPolicyViolation||_i.getListeners(mh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(h=>ot(u).call(u,h))&&(_i.onSecurityPolicyViolation&&typeof _i.onSecurityPolicyViolation=="function"&&_i.onSecurityPolicyViolation(c),_i.getListeners(mh.SECURITY_POLICY_VIOLATION).length>0&&_i.safeEmit(mh.SECURITY_POLICY_VIOLATION,c))};i&&Wx.removeEventListener("securitypolicyviolation",i),(r||e&&typeof e=="function"||_i.getListeners(mh.SECURITY_POLICY_VIOLATION).length>0)&&Wx.addEventListener("securitypolicyviolation",o),_i._cspEventHandlerPointer=o}var Eme=N,yme=E6,MH=RegExp.prototype,vme=function(e){return e===MH||Eme(MH,e)?yme(e):e.flags},to=l(vme);function Yv(e){let r=e.length;for(;--r>=0;)e[r]=0}const zx=256,UH=286,kb=30,Nb=15,Gx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),wP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Sme=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),VH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xp=new Array(576);Yv(Xp);const Db=new Array(60);Yv(Db);const Lb=new Array(512);Yv(Lb);const xb=new Array(256);Yv(xb);const Hx=new Array(29);Yv(Hx);const RP=new Array(kb);function $x(e,r,i,o,c){this.static_tree=e,this.extra_bits=r,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let FH,jH,BH;function Kx(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}Yv(RP);const WH=e=>e<256?Lb[e]:Lb[256+(e>>>7)],Mb=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},Fc=(e,r,i)=>{e.bi_valid>16-i?(e.bi_buf|=r<<e.bi_valid&65535,Mb(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=i)},vh=(e,r,i)=>{Fc(e,i[2*r],i[2*r+1])},zH=(e,r)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--r>0);return i>>>1},GH=(e,r,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=Nb;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=e[2*u+1];m!==0&&(e[2*u]=zH(o[m]++,m))}},HH=e=>{let r;for(r=0;r<UH;r++)e.dyn_ltree[2*r]=0;for(r=0;r<kb;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},$H=e=>{e.bi_valid>8?Mb(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},KH=(e,r,i,o)=>{const c=2*r,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[r]<=o[i]},qx=(e,r,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&KH(r,e.heap[c+1],e.heap[c],e.depth)&&c++,!KH(r,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},qH=(e,r,i)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?vh(e,c,r):(u=xb[c],vh(e,u+zx+1,r),h=Gx[u],h!==0&&(c-=Hx[u],Fc(e,c,h)),o--,u=WH(o),vh(e,u,i),h=wP[u],h!==0&&(o-=RP[u],Fc(e,o,h)));while(m<e.sym_next);vh(e,256,r)},Yx=(e,r)=>{const i=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,_,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=y<2?++y:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(r.max_code=y,h=e.heap_len>>1;h>=1;h--)qx(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],qx(e,i,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,i[2*_]=i[2*h]+i[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,i[2*h+1]=i[2*m+1]=_,e.heap[1]=_++,qx(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const P=R.dyn_tree,k=R.max_code,W=R.stat_desc.static_tree,U=R.stat_desc.has_stree,V=R.stat_desc.extra_bits,q=R.stat_desc.extra_base,Y=R.stat_desc.max_length;let ce,_e,ye,me,ke,Ye,ut=0;for(me=0;me<=Nb;me++)S.bl_count[me]=0;for(P[2*S.heap[S.heap_max]+1]=0,ce=S.heap_max+1;ce<573;ce++)_e=S.heap[ce],me=P[2*P[2*_e+1]+1]+1,me>Y&&(me=Y,ut++),P[2*_e+1]=me,_e>k||(S.bl_count[me]++,ke=0,_e>=q&&(ke=V[_e-q]),Ye=P[2*_e],S.opt_len+=Ye*(me+ke),U&&(S.static_len+=Ye*(W[2*_e+1]+ke)));if(ut!==0){do{for(me=Y-1;S.bl_count[me]===0;)me--;S.bl_count[me]--,S.bl_count[me+1]+=2,S.bl_count[Y]--,ut-=2}while(ut>0);for(me=Y;me!==0;me--)for(_e=S.bl_count[me];_e!==0;)ye=S.heap[--ce],ye>k||(P[2*ye+1]!==me&&(S.opt_len+=(me-P[2*ye+1])*P[2*ye],P[2*ye+1]=me),_e--)}})(e,r),GH(i,y,e.bl_count)},YH=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),r[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=r[2*(o+1)+1],++m<_&&c===h||(m<y?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4))},XH=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),o=0;o<=i;o++)if(c=h,h=r[2*(o+1)+1],!(++m<_&&c===h)){if(m<y)do vh(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(vh(e,c,e.bl_tree),m--),vh(e,16,e.bl_tree),Fc(e,m-3,2)):m<=10?(vh(e,17,e.bl_tree),Fc(e,m-3,3)):(vh(e,18,e.bl_tree),Fc(e,m-11,7));m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4)}};let JH=!1;const QH=(e,r,i,o)=>{Fc(e,0+(o?1:0),3),$H(e),Mb(e,i),Mb(e,~i),i&&e.pending_buf.set(e.window.subarray(r,r+i),e.pending),e.pending+=i};var Tme=e=>{JH||((()=>{let r,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(Hx[c]=o,r=0;r<1<<Gx[c];r++)xb[o++]=c;for(xb[o-1]=c,u=0,c=0;c<16;c++)for(RP[c]=u,r=0;r<1<<wP[c];r++)Lb[u++]=c;for(u>>=7;c<kb;c++)for(RP[c]=u<<7,r=0;r<1<<wP[c]-7;r++)Lb[256+u++]=c;for(i=0;i<=Nb;i++)h[i]=0;for(r=0;r<=143;)Xp[2*r+1]=8,r++,h[8]++;for(;r<=255;)Xp[2*r+1]=9,r++,h[9]++;for(;r<=279;)Xp[2*r+1]=7,r++,h[7]++;for(;r<=287;)Xp[2*r+1]=8,r++,h[8]++;for(GH(Xp,287,h),r=0;r<kb;r++)Db[2*r+1]=5,Db[2*r]=zH(r,5);FH=new $x(Xp,Gx,257,UH,Nb),jH=new $x(Db,wP,0,kb,Nb),BH=new $x(new Array(0),Sme,0,19,7)})(),JH=!0),e.l_desc=new Kx(e.dyn_ltree,FH),e.d_desc=new Kx(e.dyn_dtree,jH),e.bl_desc=new Kx(e.bl_tree,BH),e.bi_buf=0,e.bi_valid=0,HH(e)},bme=(e,r,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,y=4093624447;for(_=0;_<=31;_++,y>>>=1)if(1&y&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<zx;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),Yx(e,e.l_desc),Yx(e,e.d_desc),h=(m=>{let _;for(YH(m,m.dyn_ltree,m.l_desc.max_code),YH(m,m.dyn_dtree,m.d_desc.max_code),Yx(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*VH[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&r!==-1?QH(e,r,i,o):e.strategy===4||u===c?(Fc(e,2+(o?1:0),3),qH(e,Xp,Db)):(Fc(e,4+(o?1:0),3),((m,_,y,S)=>{let R;for(Fc(m,_-257,5),Fc(m,y-1,5),Fc(m,S-4,4),R=0;R<S;R++)Fc(m,m.bl_tree[2*VH[R]+1],3);XH(m,m.dyn_ltree,_-1),XH(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),qH(e,e.dyn_ltree,e.dyn_dtree)),HH(e),o&&$H(e)},wme=(e,r,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,r===0?e.dyn_ltree[2*i]++:(e.matches++,r--,e.dyn_ltree[2*(xb[i]+zx+1)]++,e.dyn_dtree[2*WH(r)]++),e.sym_next===e.sym_end),Rme=e=>{Fc(e,2,3),vh(e,256,Xp),(r=>{r.bi_valid===16?(Mb(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},Cme={_tr_init:Tme,_tr_stored_block:QH,_tr_flush_block:bme,_tr_tally:wme,_tr_align:Rme},Ub=(e,r,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Ime=new Uint32Array((()=>{let e,r=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[i]=e}return r})());var bo=(e,r,i,o)=>{const c=Ime,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^r[h])];return-1^e},z_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},CP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Ame,_tr_stored_block:Xx,_tr_flush_block:Pme,_tr_tally:Lm,_tr_align:Ome}=Cme,{Z_NO_FLUSH:xm,Z_PARTIAL_FLUSH:kme,Z_FULL_FLUSH:Nme,Z_FINISH:fu,Z_BLOCK:ZH,Z_OK:Yo,Z_STREAM_END:e7,Z_STREAM_ERROR:Sh,Z_DATA_ERROR:Dme,Z_BUF_ERROR:Jx,Z_DEFAULT_COMPRESSION:Lme,Z_FILTERED:xme,Z_HUFFMAN_ONLY:IP,Z_RLE:Mme,Z_FIXED:Ume,Z_DEFAULT_STRATEGY:Vme,Z_UNKNOWN:Fme,Z_DEFLATED:AP}=CP,Qx=286,jme=30,Bme=19,Wme=2*Qx+1,zme=15,G_=258,Th=262,Xv=42,H_=113,Vb=666,$_=(e,r)=>(e.msg=z_[r],r),t7=e=>2*e-(e>4?9:0),Mm=e=>{let r=e.length;for(;--r>=0;)e[r]=0},Gme=e=>{let r,i,o,c=e.w_size;r=e.hash_size,o=r;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--r);r=c,o=r;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--r)};let Um=(e,r,i)=>(r<<e.hash_shift^i)&e.hash_mask;const El=e=>{const r=e.state;let i=r.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),e.next_out),e.next_out+=i,r.pending_out+=i,e.total_out+=i,e.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},yl=(e,r)=>{Pme(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,El(e.strm)},Hr=(e,r)=>{e.pending_buf[e.pending++]=r},Fb=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},Zx=(e,r,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,r.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=Ub(e.adler,r,c,i):e.state.wrap===2&&(e.adler=bo(e.adler,r,c,i)),e.next_in+=c,e.total_in+=c,c)},n7=(e,r)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-Th?e.strstart-(e.w_size-Th):0,y=e.window,S=e.w_mask,R=e.prev,P=e.strstart+G_;let k=y[u+h-1],W=y[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(i=r,y[i+h]===W&&y[i+h-1]===k&&y[i]===y[u]&&y[++i]===y[u+1]){u+=2,i++;do;while(y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&u<P);if(o=G_-(P-u),u=P-G_,o>h){if(e.match_start=r,h=o,o>=m)break;k=y[u+h-1],W=y[u+h]}}while((r=R[r&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},Jv=e=>{const r=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-Th)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),Gme(e),o+=r),e.strm.avail_in===0)break;if(i=Zx(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Um(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Um(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Th&&e.strm.avail_in!==0)},r7=(e,r)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&r!==fu||r===xm||i!==o+e.strm.avail_in)))break;h=r===fu&&i===o+e.strm.avail_in?1:0,Xx(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,El(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(Zx(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:r!==xm&&r!==fu&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(Zx(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||r===fu)&&r!==xm&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=r===fu&&e.strm.avail_in===0&&i===o?1:0,Xx(e,e.block_start,i,h),e.block_start+=i,El(e.strm)),h?3:1)},eM=(e,r)=>{let i,o;for(;;){if(e.lookahead<Th){if(Jv(e),e.lookahead<Th&&r===xm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Um(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Th&&(e.match_length=n7(e,i)),e.match_length>=3)if(o=Lm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Um(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Um(e,e.ins_h,e.window[e.strstart+1]);else o=Lm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(yl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===fu?(yl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(yl(e,!1),e.strm.avail_out===0)?1:2},Qv=(e,r)=>{let i,o,c;for(;;){if(e.lookahead<Th){if(Jv(e),e.lookahead<Th&&r===xm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Um(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Th&&(e.match_length=n7(e,i),e.match_length<=5&&(e.strategy===xme||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Lm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Um(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(yl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Lm(e,0,e.window[e.strstart-1]),o&&yl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Lm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===fu?(yl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(yl(e,!1),e.strm.avail_out===0)?1:2};function bh(e,r,i,o,c){this.good_length=e,this.max_lazy=r,this.nice_length=i,this.max_chain=o,this.func=c}const jb=[new bh(0,0,0,0,r7),new bh(4,4,8,4,eM),new bh(4,5,16,8,eM),new bh(4,6,32,32,eM),new bh(4,4,16,16,Qv),new bh(8,16,32,32,Qv),new bh(8,16,128,128,Qv),new bh(8,32,128,256,Qv),new bh(32,128,258,1024,Qv),new bh(32,258,258,4096,Qv)];function Hme(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=AP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Wme),this.dyn_dtree=new Uint16Array(2*(2*jme+1)),this.bl_tree=new Uint16Array(2*(2*Bme+1)),Mm(this.dyn_ltree),Mm(this.dyn_dtree),Mm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(zme+1),this.heap=new Uint16Array(2*Qx+1),Mm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Qx+1),Mm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Bb=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==Xv&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==H_&&r.status!==Vb?1:0},i7=e=>{if(Bb(e))return $_(e,Sh);e.total_in=e.total_out=0,e.data_type=Fme;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?Xv:H_,e.adler=r.wrap===2?0:1,r.last_flush=-2,Ame(r),Yo},s7=e=>{const r=i7(e);return r===Yo&&(i=>{i.window_size=2*i.w_size,Mm(i.head),i.max_lazy_match=jb[i.level].max_lazy,i.good_match=jb[i.level].good_length,i.nice_match=jb[i.level].nice_length,i.max_chain_length=jb[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),r},o7=(e,r,i,o,c,u)=>{if(!e)return Sh;let h=1;if(r===Lme&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==AP||o<8||o>15||r<0||r>9||u<0||u>Ume||o===8&&h!==1)return $_(e,Sh);o===8&&(o=9);const m=new Hme;return e.state=m,m.strm=e,m.status=Xv,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=i,s7(e)};var $me=(e,r)=>{if(Bb(e)||r>ZH||r<0)return e?$_(e,Sh):Sh;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===Vb&&r!==fu)return $_(e,e.avail_out===0?Jx:Sh);const o=i.last_flush;if(i.last_flush=r,i.pending!==0){if(El(e),e.avail_out===0)return i.last_flush=-1,Yo}else if(e.avail_in===0&&t7(r)<=t7(o)&&r!==fu)return $_(e,Jx);if(i.status===Vb&&e.avail_in!==0)return $_(e,Jx);if(i.status===Xv&&i.wrap===0&&(i.status=H_),i.status===Xv){let c=AP+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=IP||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,Fb(i,c),i.strstart!==0&&(Fb(i,e.adler>>>16),Fb(i,65535&e.adler)),e.adler=1,i.status=H_,El(e),i.pending!==0)return i.last_flush=-1,Yo}if(i.status===57){if(e.adler=0,Hr(i,31),Hr(i,139),Hr(i,8),i.gzhead)Hr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Hr(i,255&i.gzhead.time),Hr(i,i.gzhead.time>>8&255),Hr(i,i.gzhead.time>>16&255),Hr(i,i.gzhead.time>>24&255),Hr(i,i.level===9?2:i.strategy>=IP||i.level<2?4:0),Hr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Hr(i,255&i.gzhead.extra.length),Hr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=bo(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Hr(i,0),Hr(i,0),Hr(i,0),Hr(i,0),Hr(i,0),Hr(i,i.level===9?2:i.strategy>=IP||i.level<2?4:0),Hr(i,3),i.status=H_,El(e),i.pending!==0)return i.last_flush=-1,Yo}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=bo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,El(e),i.pending!==0)return i.last_flush=-1,Yo;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=bo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=bo(e.adler,i.pending_buf,i.pending-u,u)),El(e),i.pending!==0)return i.last_flush=-1,Yo;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Hr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=bo(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=bo(e.adler,i.pending_buf,i.pending-u,u)),El(e),i.pending!==0)return i.last_flush=-1,Yo;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Hr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=bo(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(El(e),i.pending!==0))return i.last_flush=-1,Yo;Hr(i,255&e.adler),Hr(i,e.adler>>8&255),e.adler=0}if(i.status=H_,El(e),i.pending!==0)return i.last_flush=-1,Yo}if(e.avail_in!==0||i.lookahead!==0||r!==xm&&i.status!==Vb){let c=i.level===0?r7(i,r):i.strategy===IP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(Jv(u),u.lookahead===0)){if(h===xm)return 1;break}if(u.match_length=0,m=Lm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(yl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===fu?(yl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(yl(u,!1),u.strm.avail_out===0)?1:2})(i,r):i.strategy===Mme?((u,h)=>{let m,_,y,S;const R=u.window;for(;;){if(u.lookahead<=G_){if(Jv(u),u.lookahead<=G_&&h===xm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,_=R[y],_===R[++y]&&_===R[++y]&&_===R[++y])){S=u.strstart+G_;do;while(_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&y<S);u.match_length=G_-(S-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Lm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Lm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(yl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===fu?(yl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(yl(u,!1),u.strm.avail_out===0)?1:2})(i,r):jb[i.level].func(i,r);if(c!==3&&c!==4||(i.status=Vb),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),Yo;if(c===2&&(r===kme?Ome(i):r!==ZH&&(Xx(i,0,0,!1),r===Nme&&(Mm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),El(e),e.avail_out===0))return i.last_flush=-1,Yo}return r!==fu?Yo:i.wrap<=0?e7:(i.wrap===2?(Hr(i,255&e.adler),Hr(i,e.adler>>8&255),Hr(i,e.adler>>16&255),Hr(i,e.adler>>24&255),Hr(i,255&e.total_in),Hr(i,e.total_in>>8&255),Hr(i,e.total_in>>16&255),Hr(i,e.total_in>>24&255)):(Fb(i,e.adler>>>16),Fb(i,65535&e.adler)),El(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Yo:e7)},Kme=(e,r)=>{let i=r.length;if(Bb(e))return Sh;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==Xv||o.lookahead)return Sh;if(c===1&&(e.adler=Ub(e.adler,r,i,0)),o.wrap=0,i>=o.w_size){c===0&&(Mm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(r.subarray(i-o.w_size,i),0),r=_,i=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=i,e.next_in=0,e.input=r,Jv(o);o.lookahead>=3;){let _=o.strstart,y=o.lookahead-2;do o.ins_h=Um(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--y);o.strstart=_,o.lookahead=2,Jv(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,Yo},Wb={deflateInit:(e,r)=>o7(e,r,AP,15,8,Vme),deflateInit2:o7,deflateReset:s7,deflateResetKeep:i7,deflateSetHeader:(e,r)=>Bb(e)||e.state.wrap!==2?Sh:(e.state.gzhead=r,Yo),deflate:$me,deflateEnd:e=>{if(Bb(e))return Sh;const r=e.state.status;return e.state=null,r===H_?$_(e,Dme):Yo},deflateSetDictionary:Kme,deflateInfo:"pako deflate (from Nodeca project)"};const qme=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var PP={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)qme(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,c=e.length;o<c;o++)r+=e[o].length;const i=new Uint8Array(r);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let a7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a7=!1}const zb=new Uint8Array(256);for(let e=0;e<256;e++)zb[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;zb[254]=zb[254]=1;var Gb={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,i,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?r[u++]=i:i<2048?(r[u++]=192|i>>>6,r[u++]=128|63&i):i<65536?(r[u++]=224|i>>>12,r[u++]=128|i>>>6&63,r[u++]=128|63&i):(r[u++]=240|i>>>18,r[u++]=128|i>>>12&63,r[u++]=128|i>>>6&63,r[u++]=128|63&i);return r},buf2string:(e,r)=>{const i=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=zb[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<i;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&a7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let y=0;y<m;y++)_+=String.fromCharCode(h[y]);return _})(u,c)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let i=r-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?r:i+zb[e[i]]>r?i:r}},c7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const l7=Object.prototype.toString,{Z_NO_FLUSH:Yme,Z_SYNC_FLUSH:Xme,Z_FULL_FLUSH:Jme,Z_FINISH:Qme,Z_OK:OP,Z_STREAM_END:Zme,Z_DEFAULT_COMPRESSION:ege,Z_DEFAULT_STRATEGY:tge,Z_DEFLATED:nge}=CP;function kP(e){this.options=PP.assign({level:ege,method:nge,chunkSize:16384,windowBits:15,memLevel:8,strategy:tge},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c7,this.strm.avail_out=0;let i=Wb.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==OP)throw new Error(z_[i]);if(r.header&&Wb.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?Gb.string2buf(r.dictionary):l7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=Wb.deflateSetDictionary(this.strm,o),i!==OP)throw new Error(z_[i]);this._dict_set=!0}}function rge(e,r){const i=new kP(r);if(i.push(e,!0),i.err)throw i.msg||z_[i.err];return i.result}kP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?Qme:Yme,typeof e=="string"?i.input=Gb.string2buf(e):l7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===Xme||u===Jme)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=Wb.deflate(i,u),c===Zme)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=Wb.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===OP;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},kP.prototype.onData=function(e){this.chunks.push(e)},kP.prototype.onEnd=function(e){e===OP&&(this.result=PP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ige={deflate:rge};const NP=16209;var sge=function(e,r){let i,o,c,u,h,m,_,y,S,R,P,k,W,U,V,q,Y,ce,_e,ye,me,ke,Ye,ut;const pt=e.state;i=e.next_in,Ye=e.input,o=i+(e.avail_in-5),c=e.next_out,ut=e.output,u=c-(r-e.avail_out),h=c+(e.avail_out-257),m=pt.dmax,_=pt.wsize,y=pt.whave,S=pt.wnext,R=pt.window,P=pt.hold,k=pt.bits,W=pt.lencode,U=pt.distcode,V=(1<<pt.lenbits)-1,q=(1<<pt.distbits)-1;e:do{k<15&&(P+=Ye[i++]<<k,k+=8,P+=Ye[i++]<<k,k+=8),Y=W[P&V];t:for(;;){if(ce=Y>>>24,P>>>=ce,k-=ce,ce=Y>>>16&255,ce===0)ut[c++]=65535&Y;else{if(!(16&ce)){if((64&ce)==0){Y=W[(65535&Y)+(P&(1<<ce)-1)];continue t}if(32&ce){pt.mode=16191;break e}e.msg="invalid literal/length code",pt.mode=NP;break e}_e=65535&Y,ce&=15,ce&&(k<ce&&(P+=Ye[i++]<<k,k+=8),_e+=P&(1<<ce)-1,P>>>=ce,k-=ce),k<15&&(P+=Ye[i++]<<k,k+=8,P+=Ye[i++]<<k,k+=8),Y=U[P&q];n:for(;;){if(ce=Y>>>24,P>>>=ce,k-=ce,ce=Y>>>16&255,!(16&ce)){if((64&ce)==0){Y=U[(65535&Y)+(P&(1<<ce)-1)];continue n}e.msg="invalid distance code",pt.mode=NP;break e}if(ye=65535&Y,ce&=15,k<ce&&(P+=Ye[i++]<<k,k+=8,k<ce&&(P+=Ye[i++]<<k,k+=8)),ye+=P&(1<<ce)-1,ye>m){e.msg="invalid distance too far back",pt.mode=NP;break e}if(P>>>=ce,k-=ce,ce=c-u,ye>ce){if(ce=ye-ce,ce>y&&pt.sane){e.msg="invalid distance too far back",pt.mode=NP;break e}if(me=0,ke=R,S===0){if(me+=_-ce,ce<_e){_e-=ce;do ut[c++]=R[me++];while(--ce);me=c-ye,ke=ut}}else if(S<ce){if(me+=_+S-ce,ce-=S,ce<_e){_e-=ce;do ut[c++]=R[me++];while(--ce);if(me=0,S<_e){ce=S,_e-=ce;do ut[c++]=R[me++];while(--ce);me=c-ye,ke=ut}}}else if(me+=S-ce,ce<_e){_e-=ce;do ut[c++]=R[me++];while(--ce);me=c-ye,ke=ut}for(;_e>2;)ut[c++]=ke[me++],ut[c++]=ke[me++],ut[c++]=ke[me++],_e-=3;_e&&(ut[c++]=ke[me++],_e>1&&(ut[c++]=ke[me++]))}else{me=c-ye;do ut[c++]=ut[me++],ut[c++]=ut[me++],ut[c++]=ut[me++],_e-=3;while(_e>2);_e&&(ut[c++]=ut[me++],_e>1&&(ut[c++]=ut[me++]))}break}}break}}while(i<o&&c<h);_e=k>>3,i-=_e,k-=_e<<3,P&=(1<<k)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),pt.hold=P,pt.bits=k};const DP=15,oge=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),age=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),cge=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),lge=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Hb=(e,r,i,o,c,u,h,m)=>{const _=m.bits;let y,S,R,P,k,W,U=0,V=0,q=0,Y=0,ce=0,_e=0,ye=0,me=0,ke=0,Ye=0,ut=null;const pt=new Uint16Array(16),yn=new Uint16Array(16);let vn,cr,Zr,Wr=null;for(U=0;U<=DP;U++)pt[U]=0;for(V=0;V<o;V++)pt[r[i+V]]++;for(ce=_,Y=DP;Y>=1&&pt[Y]===0;Y--);if(ce>Y&&(ce=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<Y&&pt[q]===0;q++);for(ce<q&&(ce=q),me=1,U=1;U<=DP;U++)if(me<<=1,me-=pt[U],me<0)return-1;if(me>0&&(e===0||Y!==1))return-1;for(yn[1]=0,U=1;U<DP;U++)yn[U+1]=yn[U]+pt[U];for(V=0;V<o;V++)r[i+V]!==0&&(h[yn[r[i+V]]++]=V);if(e===0?(ut=Wr=h,W=20):e===1?(ut=oge,Wr=age,W=257):(ut=cge,Wr=lge,W=0),Ye=0,V=0,U=q,k=u,_e=ce,ye=0,R=-1,ke=1<<ce,P=ke-1,e===1&&ke>852||e===2&&ke>592)return 1;for(;;){vn=U-ye,h[V]+1<W?(cr=0,Zr=h[V]):h[V]>=W?(cr=Wr[h[V]-W],Zr=ut[h[V]-W]):(cr=96,Zr=0),y=1<<U-ye,S=1<<_e,q=S;do S-=y,c[k+(Ye>>ye)+S]=vn<<24|cr<<16|Zr|0;while(S!==0);for(y=1<<U-1;Ye&y;)y>>=1;if(y!==0?(Ye&=y-1,Ye+=y):Ye=0,V++,--pt[U]==0){if(U===Y)break;U=r[i+h[V]]}if(U>ce&&(Ye&P)!==R){for(ye===0&&(ye=ce),k+=q,_e=U-ye,me=1<<_e;_e+ye<Y&&(me-=pt[_e+ye],!(me<=0));)_e++,me<<=1;if(ke+=1<<_e,e===1&&ke>852||e===2&&ke>592)return 1;R=Ye&P,c[R]=ce<<24|_e<<16|k-u|0}}return Ye!==0&&(c[k+Ye]=U-ye<<24|64<<16|0),m.bits=ce,0};const{Z_FINISH:u7,Z_BLOCK:uge,Z_TREES:LP,Z_OK:K_,Z_STREAM_END:dge,Z_NEED_DICT:hge,Z_STREAM_ERROR:mu,Z_DATA_ERROR:d7,Z_MEM_ERROR:h7,Z_BUF_ERROR:pge,Z_DEFLATED:p7}=CP,xP=16180,MP=16190,Jp=16191,tM=16192,nM=16194,UP=16199,VP=16200,rM=16206,Qi=16209,f7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function fge(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const q_=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<xP||r.mode>16211?1:0},m7=e=>{if(q_(e))return mu;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=xP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,K_},g7=e=>{if(q_(e))return mu;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,m7(e)},_7=(e,r)=>{let i;if(q_(e))return mu;const o=e.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?mu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=i,o.wbits=r,g7(e))},E7=(e,r)=>{if(!e)return mu;const i=new fge;e.state=i,i.strm=e,i.window=null,i.mode=xP;const o=_7(e,r);return o!==K_&&(e.state=null),o};let iM,sM,y7=!0;const mge=e=>{if(y7){iM=new Int32Array(512),sM=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(Hb(1,e.lens,0,288,iM,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;Hb(2,e.lens,0,32,sM,0,e.work,{bits:5}),y7=!1}e.lencode=iM,e.lenbits=9,e.distcode=sM,e.distbits=5},v7=(e,r,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var gge=(e,r)=>{let i,o,c,u,h,m,_,y,S,R,P,k,W,U,V,q,Y,ce,_e,ye,me,ke,Ye=0;const ut=new Uint8Array(4);let pt,yn;const vn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(q_(e)||!e.output||!e.input&&e.avail_in!==0)return mu;i=e.state,i.mode===Jp&&(i.mode=tM),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,R=m,P=_,ke=K_;e:for(;;)switch(i.mode){case xP:if(i.wrap===0){i.mode=tM;break}for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(2&i.wrap&&y===35615){i.wbits===0&&(i.wbits=15),i.check=0,ut[0]=255&y,ut[1]=y>>>8&255,i.check=bo(i.check,ut,2,0),y=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",i.mode=Qi;break}if((15&y)!==p7){e.msg="unknown compression method",i.mode=Qi;break}if(y>>>=4,S-=4,me=8+(15&y),i.wbits===0&&(i.wbits=me),me>15||me>i.wbits){e.msg="invalid window size",i.mode=Qi;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&y?16189:Jp,y=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.flags=y,(255&to(i))!==p7){e.msg="unknown compression method",i.mode=Qi;break}if(57344&to(i)){e.msg="unknown header flags set",i.mode=Qi;break}i.head&&(i.head.text=y>>8&1),512&to(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=bo(i.check,ut,2,0)),y=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.time=y),512&to(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,ut[2]=y>>>16&255,ut[3]=y>>>24&255,i.check=bo(i.check,ut,4,0)),y=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&to(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=bo(i.check,ut,2,0)),y=0,S=0,i.mode=16184;case 16184:if(1024&to(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length=y,i.head&&(i.head.extra_len=y),512&to(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=bo(i.check,ut,2,0)),y=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&to(i)&&(k=i.length,k>m&&(k=m),k&&(i.head&&(me=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+k),me)),512&to(i)&&4&i.wrap&&(i.check=bo(i.check,o,k,u)),m-=k,u+=k,i.length-=k),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&to(i)){if(m===0)break e;k=0;do me=o[u+k++],i.head&&me&&i.length<65536&&(i.head.name+=String.fromCharCode(me));while(me&&k<m);if(512&to(i)&&4&i.wrap&&(i.check=bo(i.check,o,k,u)),m-=k,u+=k,me)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&to(i)){if(m===0)break e;k=0;do me=o[u+k++],i.head&&me&&i.length<65536&&(i.head.comment+=String.fromCharCode(me));while(me&&k<m);if(512&to(i)&&4&i.wrap&&(i.check=bo(i.check,o,k,u)),m-=k,u+=k,me)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&to(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Qi;break}y=0,S=0}i.head&&(i.head.hcrc=to(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Jp;break;case 16189:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}e.adler=i.check=f7(y),y=0,S=0,i.mode=MP;case MP:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,hge;e.adler=i.check=1,i.mode=Jp;case Jp:if(r===uge||r===LP)break e;case tM:if(i.last){y>>>=7&S,S-=7&S,i.mode=rM;break}for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}switch(i.last=1&y,y>>>=1,S-=1,3&y){case 0:i.mode=16193;break;case 1:if(mge(i),i.mode=UP,r===LP){y>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Qi}y>>>=2,S-=2;break;case 16193:for(y>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Qi;break}if(i.length=65535&y,y=0,S=0,i.mode=nM,r===LP)break e;case nM:i.mode=16195;case 16195:if(k=i.length,k){if(k>m&&(k=m),k>_&&(k=_),k===0)break e;c.set(o.subarray(u,u+k),h),m-=k,u+=k,_-=k,h+=k,i.length-=k;break}i.mode=Jp;break;case 16196:for(;S<14;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.nlen=257+(31&y),y>>>=5,S-=5,i.ndist=1+(31&y),y>>>=5,S-=5,i.ncode=4+(15&y),y>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Qi;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.lens[vn[i.have++]]=7&y,y>>>=3,S-=3}for(;i.have<19;)i.lens[vn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,pt={bits:i.lenbits},ke=Hb(0,i.lens,0,19,i.lencode,0,i.work,pt),i.lenbits=pt.bits,ke){e.msg="invalid code lengths set",i.mode=Qi;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Ye=i.lencode[y&(1<<i.lenbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(Y<16)y>>>=V,S-=V,i.lens[i.have++]=Y;else{if(Y===16){for(yn=V+2;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(y>>>=V,S-=V,i.have===0){e.msg="invalid bit length repeat",i.mode=Qi;break}me=i.lens[i.have-1],k=3+(3&y),y>>>=2,S-=2}else if(Y===17){for(yn=V+3;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=V,S-=V,me=0,k=3+(7&y),y>>>=3,S-=3}else{for(yn=V+7;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=V,S-=V,me=0,k=11+(127&y),y>>>=7,S-=7}if(i.have+k>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Qi;break}for(;k--;)i.lens[i.have++]=me}}if(i.mode===Qi)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Qi;break}if(i.lenbits=9,pt={bits:i.lenbits},ke=Hb(1,i.lens,0,i.nlen,i.lencode,0,i.work,pt),i.lenbits=pt.bits,ke){e.msg="invalid literal/lengths set",i.mode=Qi;break}if(i.distbits=6,i.distcode=i.distdyn,pt={bits:i.distbits},ke=Hb(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,pt),i.distbits=pt.bits,ke){e.msg="invalid distances set",i.mode=Qi;break}if(i.mode=UP,r===LP)break e;case UP:i.mode=VP;case VP:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,sge(e,P),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,i.mode===Jp&&(i.back=-1);break}for(i.back=0;Ye=i.lencode[y&(1<<i.lenbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(ce=V,_e=q,ye=Y;Ye=i.lencode[ye+((y&(1<<ce+_e)-1)>>ce)],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(ce+V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=ce,S-=ce,i.back+=ce}if(y>>>=V,S-=V,i.back+=V,i.length=Y,q===0){i.mode=16205;break}if(32&q){i.back=-1,i.mode=Jp;break}if(64&q){e.msg="invalid literal/length code",i.mode=Qi;break}i.extra=15&q,i.mode=16201;case 16201:if(i.extra){for(yn=i.extra;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Ye=i.distcode[y&(1<<i.distbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((240&q)==0){for(ce=V,_e=q,ye=Y;Ye=i.distcode[ye+((y&(1<<ce+_e)-1)>>ce)],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(ce+V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=ce,S-=ce,i.back+=ce}if(y>>>=V,S-=V,i.back+=V,64&q){e.msg="invalid distance code",i.mode=Qi;break}i.offset=Y,i.extra=15&q,i.mode=16203;case 16203:if(i.extra){for(yn=i.extra;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Qi;break}i.mode=16204;case 16204:if(_===0)break e;if(k=P-_,i.offset>k){if(k=i.offset-k,k>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Qi;break}k>i.wnext?(k-=i.wnext,W=i.wsize-k):W=i.wnext-k,k>i.length&&(k=i.length),U=i.window}else U=c,W=h-i.offset,k=i.length;k>_&&(k=_),_-=k,i.length-=k;do c[h++]=U[W++];while(--k);i.length===0&&(i.mode=VP);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=VP;break;case rM:if(i.wrap){for(;S<32;){if(m===0)break e;m--,y|=o[u++]<<S,S+=8}if(P-=_,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=to(i)?bo(i.check,c,P,h-P):Ub(i.check,c,P,h-P)),P=_,4&i.wrap&&(to(i)?y:f7(y))!==i.check){e.msg="incorrect data check",i.mode=Qi;break}y=0,S=0}i.mode=16207;case 16207:if(i.wrap&&to(i)){for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Qi;break}y=0,S=0}i.mode=16208;case 16208:ke=dge;break e;case Qi:ke=d7;break e;case 16210:return h7;default:return mu}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,(i.wsize||P!==e.avail_out&&i.mode<Qi&&(i.mode<rM||r!==u7))&&v7(e,e.output,e.next_out,P-e.avail_out),R-=e.avail_in,P-=e.avail_out,e.total_in+=R,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=to(i)?bo(i.check,c,P,e.next_out-P):Ub(i.check,c,P,e.next_out-P)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Jp?128:0)+(i.mode===UP||i.mode===nM?256:0),(R===0&&P===0||r===u7)&&ke===K_&&(ke=pge),ke},Qp={inflateReset:g7,inflateReset2:_7,inflateResetKeep:m7,inflateInit:e=>E7(e,15),inflateInit2:E7,inflate:gge,inflateEnd:e=>{if(q_(e))return mu;let r=e.state;return r.window&&(r.window=null),e.state=null,K_},inflateGetHeader:(e,r)=>{if(q_(e))return mu;const i=e.state;return(2&i.wrap)==0?mu:(i.head=r,r.done=!1,K_)},inflateSetDictionary:(e,r)=>{const i=r.length;let o,c,u;return q_(e)?mu:(o=e.state,o.wrap!==0&&o.mode!==MP?mu:o.mode===MP&&(c=1,c=Ub(c,r,i,0),c!==o.check)?d7:(u=v7(e,r,i,i),u?(o.mode=16210,h7):(o.havedict=1,K_)))},inflateInfo:"pako inflate (from Nodeca project)"},_ge=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const S7=Object.prototype.toString,{Z_NO_FLUSH:Ege,Z_FINISH:yge,Z_OK:$b,Z_STREAM_END:oM,Z_NEED_DICT:aM,Z_STREAM_ERROR:vge,Z_DATA_ERROR:T7,Z_MEM_ERROR:Sge}=CP;function FP(e){this.options=PP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c7,this.strm.avail_out=0;let i=Qp.inflateInit2(this.strm,r.windowBits);if(i!==$b)throw new Error(z_[i]);if(this.header=new _ge,Qp.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=Gb.string2buf(r.dictionary):S7.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=Qp.inflateSetDictionary(this.strm,r.dictionary),i!==$b)))throw new Error(z_[i])}function Tge(e,r){const i=new FP(r);if(i.push(e),i.err)throw i.msg||z_[i.err];return i.result}FP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?yge:Ege,S7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=Qp.inflate(i,h),u===aM&&c&&(u=Qp.inflateSetDictionary(i,c),u===$b?u=Qp.inflate(i,h):u===T7&&(u=aM));i.avail_in>0&&u===oM&&i.state.wrap>0&&e[i.next_in]!==0;)Qp.inflateReset(i),u=Qp.inflate(i,h);switch(u){case vge:case T7:case aM:case Sge:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===oM))if(this.options.to==="string"){let _=Gb.utf8border(i.output,i.next_out),y=i.next_out-_,S=Gb.buf2string(i.output,_);i.next_out=y,i.avail_out=o-y,y&&i.output.set(i.output.subarray(_,_+y),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==$b||m!==0){if(u===oM)return u=Qp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},FP.prototype.onData=function(e){this.chunks.push(e)},FP.prototype.onEnd=function(e){e===$b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=PP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bge={inflate:Tge};const{deflate:wge}=ige,{inflate:Rge}=bge;var Cge=wge,Ige=Rge,b7=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(b7||{});class Age{constructor(){$(this,"_sequence",0),$(this,"_startTime",Date.now()),$(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=y,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&D.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,m;if(o+=4,re("SHOW_DATASTREAM2_LOG")&&D.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let _=!1;if(m.datas.length>0){const y=m.datas.find(S=>S.id===0);y&&(_=(1&new DataView(y.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:i,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,i),m.setUint8(_++,o),c.forEach(y=>{i?(m.setUint8(_++,y.id),m.setUint8(_++,y.length),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength):(m.setUint8(_++,y.id|y.length<<4),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(r){const i=new DataView(r);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===b7.TWO_BYTE,m=[],_=new DataView(r,2);let y=0;for(;y<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=_.getUint8(y),y++,R=_.getUint8(y),y++):(S=15&_.getUint8(y),R=_.getUint8(y)>>4,y++),R>0&&(P=_.buffer.slice(y+2,y+2+R),y+=P.byteLength),m.push({id:S,length:R,data:P})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return Ige(new Uint8Array(r))}compress(r){return Cge(new Uint8Array(r))}}const Pge={name:"DataStream",create:(e,r)=>{const i=r?new Mpe(e):new Upe(e);return i.useDataStream(new Age),i}};class Oge extends Ar{constructor(r,i,o){super(),$(this,"ws",void 0),$(this,"requestId",1),$(this,"heartBeatTimer",void 0),$(this,"joinInfo",void 0),$(this,"clientId",void 0),$(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),$(this,"onClose",c=>{this.emit("close"),this.dispose()}),$(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=i,this.ws=new Eb("cross-channel-".concat(this.clientId),o),this.ws.on(qt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(qt.CONNECTED,this.onOpen),this.ws.on(qt.ON_MESSAGE,this.onMessage),this.ws.on(qt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new lt((i,o)=>{const c=window.setTimeout(()=>{o(new Oe(X.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Oe(X.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(X.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(X.WS_DISCONNECT);const i=()=>new lt((h,m)=>{this.ws.once(qt.CLOSED,()=>m(new Oe(X.WS_ABORT))),this.ws.once(qt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(r),c=new lt((h,m)=>{const _=()=>{m(new Oe(X.WS_ABORT))};this.ws.once(qt.RECONNECTING,_),this.ws.once(qt.CLOSED,_),this.once("req_".concat(o),h),is(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(qt.RECONNECTING,_),this.ws.off(qt.CLOSED,_),m(new Oe(X.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(X.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(qt.REQUEST_NEW_URLS),this.ws.on(qt.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class kge extends Ar{set state(r){r!==this._state&&(r!==va.RELAY_STATE_FAILURE&&(this.errorCode=Mv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,o,c,u){super(),$(this,"joinInfo",void 0),$(this,"sid",void 0),$(this,"clientId",void 0),$(this,"cancelToken",Go.CancelToken.source()),$(this,"workerToken",void 0),$(this,"requestId",0),$(this,"signal",void 0),$(this,"prevChannelMediaConfig",void 0),$(this,"httpRetryConfig",void 0),$(this,"_resolution",void 0),$(this,"_state",va.RELAY_STATE_IDLE),$(this,"errorCode",Mv.RELAY_OK),$(this,"onStatus",h=>{D.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Hp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Hp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Mv.SRC_TOKEN_EXPIRED,this.state=va.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Mv.DEST_TOKEN_EXPIRED,this.state=va.RELAY_STATE_FAILURE))}),$(this,"onReconnect",async()=>{D.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Hp.NETWORK_DISCONNECTED),this.state=va.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==va.RELAY_STATE_IDLE&&(D.error("auto restart channel media relay failed",h.toString()),this.errorCode=Mv.SERVER_CONNECTION_LOST,this.state=va.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=C_(),this.signal=new Oge(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==va.RELAY_STATE_IDLE)throw new Oe(X.INVALID_OPERATION);this.state=va.RELAY_STATE_CONNECTING,await this.connect(),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new Oe(X.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==va.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==va.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);const i=this.genMessage(To.SetVideoProfile);await this.signal.request(i),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),D.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=va.RELAY_STATE_IDLE,this.dispose()}dispose(){D.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Go.CancelToken.source(),this.state=va.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Bfe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",Hp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(To.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(To.SetSdkProfile,r);await this.signal.request(o),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(To.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Hp.PACKET_JOINED_SRC_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(To.SetSourceUserId,r);await this.signal.request(u),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(To.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Hp.PACKET_JOINED_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(To.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",Hp.PACKET_SENT_TO_DEST_CHANNEL),this.state=va.RELAY_STATE_RUNNING,D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(To.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",Hp.PACKET_UPDATE_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(To.StopPacketTransfer);await this.signal.request(r),D.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:pl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(r){case To.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case To.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case To.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case To.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case To.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case To.Reconnect:return h.clientRequest={command:"Reconnect"},h;case To.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case To.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case To.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Nge={name:"ChannelMediaRelay",create:function(e){return new kge(e.joinInfo,e.clientId,e.websocketRetryConfig||gi,e.httpRetryConfig||gi,e.resolution)}};function w7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Kb(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?w7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Dge extends Ar{constructor(r,i,o,c){super(),$(this,"spec",void 0),$(this,"token",void 0),$(this,"websocket",void 0),$(this,"pingpongTimer",void 0),$(this,"reconnectMode","retry"),$(this,"serviceMode",void 0),$(this,"reqId",0),$(this,"commandReqId",0),$(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),$(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(wt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Gp.TRANSCODE?1:2}),this.emit(wm.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new Eb("live-streaming",o),this.websocket.on(qt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(qt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(qt.REQUEST_NEW_URLS,(u,h)=>{vs(this,wm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(qt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(X.UNEXPECTED_ERROR);const m=Kb({command:r,sdkVersion:pl==="4.23.2"?"0.0.1":pl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new Oe(X.WS_DISCONNECT);const _=()=>new lt((P,k)=>{this.websocket.once(qt.CLOSED,()=>k(new Oe(X.WS_ABORT))),this.websocket.once(qt.CONNECTED,P)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new lt((P,k)=>{const W=()=>{k(new Oe(X.WS_ABORT))};this.websocket.once(qt.RECONNECTING,W),this.websocket.once(qt.CLOSED,W),this.once("@".concat(h,"-").concat(this.spec.sid),U=>{P(U)})});c&&wt.workerEvent(this.spec.sid,Kb(Kb({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await y}catch(P){if(this.websocket.state==="closed")throw P;return await _(),await this.request(r,i,o)}return c&&wt.workerEvent(this.spec.sid,Kb(Kb({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=pl==="4.23.2"?"0.0.1":pl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case bi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void D.warning("live stream response already exists stream");case bi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case bi.LIVE_STREAM_RESPONSE_BAD_STREAM:case bi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(X.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case bi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case bi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(X.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case bi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(wm.WARNING,i,r.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new Oe(X.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(wm.WARNING,i,r.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case bi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(X.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case bi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new Oe(X.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(wm.WARNING,i,r.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case bi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case bi.LIVE_STREAM_RESPONSE_WORKER_LOST:case bi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case bi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case bi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(CA)},6e3)}}function R7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Sa(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?R7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):R7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Lge extends Ar{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gi;super(),$(this,"onLiveStreamWarning",void 0),$(this,"onLiveStreamError",void 0),$(this,"spec",void 0),$(this,"retryTimeout",1e4),$(this,"connection",void 0),$(this,"httpRetryConfig",void 0),$(this,"wsRetryConfig",void 0),$(this,"streamingTasks",new Map),$(this,"isStartingStreamingTask",!1),$(this,"taskMutex",new As("live-streaming")),$(this,"cancelToken",Go.CancelToken.source()),$(this,"transcodingConfig",void 0),$(this,"uapResponse",void 0),$(this,"lastTaskId",1),$(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=Sa(Sa({},vfe),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(D.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>Sa(Sa(Sa({},yfe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Lr(h.width)||er(h.width,"config.width",0,1e4),Lr(h.height)||er(h.height,"config.height",0,1e4),Lr(h.videoBitrate)||er(h.videoBitrate,"config.videoBitrate",1,1e6),Lr(h.videoFrameRate)||er(h.videoFrameRate,"config.videoFrameRate"),Lr(h.lowLatency)||jp(h.lowLatency,"config.lowLatency"),Lr(h.audioSampleRate)||Pi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Lr(h.audioBitrate)||er(h.audioBitrate,"config.audioBitrate",1,128),Lr(h.audioChannels)||Pi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Lr(h.videoGop)||er(h.videoGop,"config.videoGop"),Lr(h.videoCodecProfile)||Pi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Lr(h.userCount)||er(h.userCount,"config.userCount",0,17),Lr(h.backgroundColor)||er(h.backgroundColor,"config.backgroundColor",0,16777215),Lr(h.userConfigExtraInfo)||rs(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Lr(h.transcodingUsers)&&(Bp(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{XA(m.uid),Lr(m.x)||er(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Lr(m.y)||er(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Lr(m.width)||er(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Lr(m.height)||er(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Lr(m.zOrder)||er(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Lr(m.alpha)||er(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Lr(h.watermark)||lx(h.watermark,"watermark"),Lr(h.backgroundImage)||lx(h.backgroundImage,"backgroundImage"),h.images&&!Lr(h.images)&&(Bp(h.images,"config.images"),h.images.forEach((m,_)=>{lx(m,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>Sa(Sa(Sa({},cx),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(Sa(Sa(Sa({},cx),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(Sa(Sa(Sa({},cx),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>Sa({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?lt.resolve(h.uid):KG(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await lt.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ic(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});D.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{D.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{D.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{D.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(r,i,o){if(!this.transcodingConfig&&i===Gp.TRANSCODE)throw new Oe(X.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};D.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Oe(X.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case Gp.TRANSCODE:c.transcodingConfig=Sa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new lt((y,S)=>{is(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),_=await lt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===Gp.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,D.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,m)):await this.startLiveStreamingTask(r,i,m)}}stopLiveStreamingTask(r){return new lt((i,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(X.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===Gp.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var r;const i=Array.from(Ic(r=this.streamingTasks).call(r));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Go.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(X.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await vs(this,ux.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new Dge(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(wm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(wm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(wm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(X.UNEXPECTED_ERROR,"can not get new live streaming address list"));vs(this,ux.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=r.reason;switch(r.code){case bi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return D.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case bi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case bi.LIVE_STREAM_RESPONSE_WORKER_LOST:case bi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Ic(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(D.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{D.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{D.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const xge={name:"LiveStreaming",create:function(e){return new Lge(e.joinInfo,e.websocketRetryConfig||gi,e.httpRetryConfig||gi)}};function Mge(e){let r=A7();return function(i,o){let c=i.appId;c!==void 0&&($n(o,10),wh(o,c));let u=i.cid;u!==void 0&&($n(o,16),$n(o,u));let h=i.cname;h!==void 0&&($n(o,26),wh(o,h));let m=i.deviceId;m!==void 0&&($n(o,34),wh(o,m));let _=i.elapse;_!==void 0&&($n(o,40),Vm(o,_));let y=i.fileSize;y!==void 0&&($n(o,48),Vm(o,Zv(y)));let S=i.height;S!==void 0&&($n(o,56),Vm(o,Zv(S)));let R=i.jpg;R!==void 0&&($n(o,66),$n(o,R.length),function(Xo,je){let st=eS(Xo,je.length);Xo.bytes.set(je,st)}(o,R));let P=i.networkType;P!==void 0&&($n(o,72),Vm(o,Zv(P)));let k=i.osType;k!==void 0&&($n(o,80),Vm(o,Zv(k)));let W=i.requestId;W!==void 0&&($n(o,90),wh(o,W));let U=i.sdkVersion;U!==void 0&&($n(o,98),wh(o,U));let V=i.sequence;V!==void 0&&($n(o,104),Vm(o,Zv(V)));let q=i.sid;q!==void 0&&($n(o,114),wh(o,q));let Y=i.timestamp;Y!==void 0&&($n(o,120),Vm(o,Y));let ce=i.uid;ce!==void 0&&($n(o,128),$n(o,ce));let _e=i.vid;_e!==void 0&&($n(o,136),$n(o,_e));let ye=i.width;ye!==void 0&&($n(o,144),Vm(o,Zv(ye)));let me=i.service;me!==void 0&&($n(o,152),$n(o,me));let ke=i.callbackData;ke!==void 0&&($n(o,162),wh(o,ke));let Ye=i.jpgEncryption;Ye!==void 0&&($n(o,168),$n(o,Ye));let ut=i.requestType;ut!==void 0&&($n(o,176),$n(o,ut));let pt=i.scorePorn;pt!==void 0&&($n(o,185),hM(o,pt));let yn=i.scoreSexy;yn!==void 0&&($n(o,193),hM(o,yn));let vn=i.scoreNeutral;vn!==void 0&&($n(o,201),hM(o,vn));let cr=i.scene;cr!==void 0&&($n(o,208),$n(o,cr));let Zr=i.ossFilePrefix;Zr!==void 0&&($n(o,218),wh(o,Zr));let Wr=i.serviceVendor;if(Wr!==void 0)for(let Xo of Wr){$n(o,226);let je=A7();Fge(Xo,je),$n(o,je.limit),zge(o,je),Wge(je)}}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function Uge(e){return function(i){let o={};e:for(;!P7(i);){let c=Rh(i);switch(c>>>3){case 0:break e;case 1:o.code=Rh(i);break;case 2:o.msg=O7(i,Rh(i));break;case 3:{let u=jge(i);o.data=Vge(i),i.limit=u;break}default:C7(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function Vge(e){let r={};e:for(;!P7(e);){let i=Rh(e);switch(i>>>3){case 0:break e;case 1:r.requestId=O7(e,Rh(e));break;case 2:r.requestType=Rh(e)>>>0;break;case 3:r.scorePorn=dM(e);break;case 4:r.scoreSexy=dM(e);break;case 5:r.scoreNeutral=dM(e);break;case 6:r.requestScene=Rh(e)>>>0;break;case 7:r.scene=Rh(e)>>>0;break;default:C7(e,7&i)}}return r}function Fge(e,r){let i=e.service;i!==void 0&&($n(r,8),$n(r,i));let o=e.vendor;o!==void 0&&($n(r,16),$n(r,o));let c=e.token;c!==void 0&&($n(r,26),wh(r,c));let u=e.callbackUrl;u!==void 0&&($n(r,34),wh(r,u))}function jge(e){let r=Rh(e),i=e.limit;return e.limit=e.offset+r,i}function C7(e,r){switch(r){case 0:for(;128&k7(e););break;case 2:lM(e,Rh(e));break;case 5:lM(e,4);break;case 1:lM(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let Bge=new Float32Array(1);new Uint8Array(Bge.buffer);let cM=new Float64Array(1),Ta=new Uint8Array(cM.buffer);function Zv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let I7=[];function A7(){const e=I7.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Wge(e){I7.push(e)}function lM(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function P7(e){return e.offset>=e.limit}function eS(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function uM(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function O7(e,r){let i=uM(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,y,S,R,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function wh(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}$n(e,o);let c=eS(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function zge(e,r){let i=eS(e,r.limit),o=e.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+i]=c[u]}function k7(e){return e.bytes[uM(e,1)]}function N7(e,r){let i=eS(e,1);e.bytes[i]=r}function dM(e){let r=uM(e,8),i=e.bytes;return Ta[0]=i[r++],Ta[1]=i[r++],Ta[2]=i[r++],Ta[3]=i[r++],Ta[4]=i[r++],Ta[5]=i[r++],Ta[6]=i[r++],Ta[7]=i[r++],cM[0]}function hM(e,r){let i=eS(e,8),o=e.bytes;cM[0]=r,o[i++]=Ta[0],o[i++]=Ta[1],o[i++]=Ta[2],o[i++]=Ta[3],o[i++]=Ta[4],o[i++]=Ta[5],o[i++]=Ta[6],o[i++]=Ta[7]}function Rh(e){let r,i=0,o=0;do r=k7(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function $n(e,r){for(r>>>=0;r>=128;)N7(e,127&r|128),r>>>=7;N7(e,r)}function Vm(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=eS(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function D7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const Gge=new Map([["moderation",1],["supervise",2]]);class Hge extends Ar{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Ji.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=Ga(i=r.map(o=>Gge.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),$(this,"name","AgoraRTCVideoContentInspect"),$(this,"_connectionState",lu.CONNECTING),$(this,"_innerConnectionState",void 0),$(this,"sequence",0),$(this,"inspectStartTime",void 0),$(this,"workerManagerConnection",void 0),$(this,"workerConnection",void 0),$(this,"workerMessageLengthLimit",void 0),$(this,"inspectIntervalMinimum",void 0),$(this,"qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Go.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"wmSequence",0),$(this,"inspectInterval",void 0),$(this,"inspectTimer",null),$(this,"ossFilePrefix",void 0),$(this,"extraInfo",void 0),$(this,"_inspectType",void 0),$(this,"_inspectMode",void 0),$(this,"_quality",1),$(this,"qualityTimer",null),$(this,"_inspectId",void 0),$(this,"_needWorkUrlOnly",!1),$(this,"inspectImage",()=>{if(this.connectionState!==lu.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===lu.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=or(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Eb("worker-manager-"+this._inspectId,gi),this.on(Ji.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,D.debug("[".concat(this._inspectId,"] Inspect operation :").concat(uu[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Eb("worker-"+this._inspectId,gi),this.handleWorkerEvents()}async init(r,i){this.emit(Ji.STATE_CHANGE,uu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new lt((c,u)=>{this.on(Ji.CONNECTION_STATE_CHANGE,(h,m)=>{m===lu.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,i,o){const c=re("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,y,S){let{appId:R,areaCode:P,cname:k,sid:W,token:U,uid:V}=_;zv++;const q="image_moderation_api",Y={service_name:q,json_body:JSON.stringify({appId:R,areaCode:P,cname:k,command:"allocateEdge",requestId:zv,seq:zv,sid:W,token:U,ts:Date.now(),uid:V+""})};let ce,_e,ye=m[0];return ud(async()=>{ce=Date.now();const me=await md(ye,{data:Y,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ce,me.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code"+me.code,{retry:!0,responseTime:_e});throw D.error(pt.toString()),pt}const ke=JSON.parse(me.json_body);if(ke.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ke.code,", reason: ").concat(ke.reason),{code:ke.code,responseTime:_e});throw D.error(pt.toString()),pt}if(!ke.servers||!Array.isArray(ke.servers)||ke.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ke.code,responseTime:_e});throw D.error(pt.toString()),pt}const Ye=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ut=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ke.servers.map(pt=>{let{address:yn,wss:vn}=pt;if(yn&&vn)return"wss://".concat(yn.replace(/\./g,"-"),".").concat(Ye,":").concat(ut||vn)}).filter(pt=>!!pt),workerToken:ke.workerToken,vid:ke.vid,responseTime:_e}},(me,ke)=>(wt.apworkerEvent(W,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(me.addressList),firstSuccess:ke===0,responseTime:_e,serverIp:m[ke%m.length]}),!1),(me,ke)=>(wt.apworkerEvent(W,{success:!1,sc:me.data&&me.data.code||200,serviceName:q,responseTime:_e,serverIp:m[ke%m.length]}),!!(me.code!==X.OPERATION_ABORTED&&me.code!==X.UNEXPECTED_RESPONSE||me.data&&me.data.retry)&&(ye=m[(ke+1)%m.length],!0)),S)}(c,r,i,o);this.emit(Ji.STATE_CHANGE,uu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Ji.STATE_CHANGE,uu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(qt.CONNECTED,async()=>{this.emit(Ji.STATE_CHANGE,uu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(qt.CLOSED,()=>{this._innerConnectionState<uu.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(qt.FAILED,()=>{this._innerConnectionState<uu.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(qt.RECONNECTING,()=>{this._innerConnectionState<uu.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(qt.ON_MESSAGE,async r=>{this.emit(Ji.STATE_CHANGE,uu.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw D.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(X.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw D.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(X.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=re("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Ji.STATE_CHANGE,uu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Ji.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(qt.WILL_RECONNECT,(r,i,o)=>{o(r)}),this.workerManagerConnection.on(qt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(qt.CONNECTED,async()=>{this.emit(Ji.STATE_CHANGE,uu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=lu.CONNECTED}),this.workerConnection.on(qt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=Uge(new Uint8Array(r.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&D.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ji.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Ga(i=Object.keys(c)).call(i,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(Ji.INSPECT_RESULT,h)}else this.emit(Ji.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Ji.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else D.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ji.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(qt.CLOSED,()=>{this.connectionState=lu.CLOSED}),this.workerConnection.on(qt.FAILED,()=>{this.connectionState=lu.CLOSED}),this.workerConnection.on(qt.RECONNECTING,()=>{this.connectionState=this.connectionState===lu.CONNECTED?lu.RECONNECTING:lu.CONNECTING}),this.workerConnection.on(qt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(qt.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(Ji.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const r=Pc(this,Ji.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(Ji.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Ji.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await fW(S,o,c),P=this.sequence+"-"+u+"-"+_+"-"+y+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:(W=Number(y-this.inspectStartTime),{low:W|=0,high:W>>31,unsigned:W>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:B9(y),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var W;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const U=Mge(k);if(U.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const V=function(q){for(var Y=1;Y<arguments.length;Y++){var ce=arguments[Y]!=null?arguments[Y]:{};Y%2?D7(Object(ce),!0).forEach(function(_e){$(q,_e,ce[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(ce)):D7(Object(ce)).forEach(function(_e){Object.defineProperty(q,_e,Object.getOwnPropertyDescriptor(ce,_e))})}return q}({},k);delete V.jpg,D.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(V))}return U}{const V=this.quality*this.qualityRatio;return this.quality=V,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Go.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=lu.CLOSED,this.emit(Ji.STATE_CHANGE,uu.CLOSED)}}const $ge={name:"ContentInspect",create:function(e){let{config:r}=e;return function(i){if(!i)throw new Oe(X.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new Oe(X.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!ot(u=["supervise","moderation"]).call(u,c))throw new Oe(X.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new Hge(r)}};var L7=l(vt.Object.getOwnPropertySymbols),Kge=Mn,qge=Vo.indexOf,Yge=pp,pM=se([].indexOf),x7=!!pM&&1/pM([1],1,-0)<0;Kge({target:"Array",proto:!0,forced:x7||!Yge("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return x7?pM(this,e,r)||0:qge(this,e,r)}});var Xge=za("Array").indexOf,Jge=N,Qge=Xge,fM=Array.prototype,Zge=function(e){var r=e.indexOf;return e===fM||Jge(fM,e)&&r===fM.indexOf?Qge:r},M7=l(Zge);function e_e(e,r){if(e==null)return{};var i,o,c=function(h,m){if(h==null)return{};var _,y,S={},R=nG(h);for(y=0;y<R.length;y++)_=R[y],M7(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,r);if(L7){var u=L7(e);for(o=0;o<u.length;o++)i=u[o],M7(r).call(r,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let U7=class{get localCapabilities(){return Mr(this._localCapabilities)}get rtpCapabilities(){return Mr(this._rtpCapabilities)}get candidates(){return Mr(this._candidates)}get iceParameters(){return Mr(this._iceParameters)}get dtlsParameters(){return Mr(this._dtlsParameters)}constructor(e){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname","o/i14u9pJrxRKAsu"),$(this,"firefoxSsrcMidMap",new Map),e=Mr(e);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:y}=e;let S;this.setup=m,S=h===So.RECEIVE_ONLY?ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u;const R=h===So.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===So.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===So.RECEIVE_ONLY?c.send.videoCodecs:Sb(mt.VIDEO,R,P,_),W=h===So.RECEIVE_ONLY?c.send.audioCodecs:Sb(mt.AUDIO,R,P,y);for(const U of S.mediaDescriptions)U.attributes.iceUfrag=r.iceUfrag,U.attributes.icePwd=r.icePwd,U.attributes.fingerprints=i.fingerprints,U.attributes.candidates=o,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=k.map(V=>V.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=R.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=W.map(V=>V.payloadType.toString(10)),U.attributes.payloads=W,U.attributes.extmaps=R.audioExtensions,Wv(U));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return bm(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=x_(r,this.cname,re("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Dr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let y;return _===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(y=Mr(this.sessionDesc.mediaDescriptions[_]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(y,c)),Dr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(m=Mr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),y={foundation:r??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===y.priority&&S.connectionAddress===y.connectionAddress&&S.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=Sb(u,h,this.localCapabilities.send,u===mt.AUDIO?c:o),_=u===mt.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>ot(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>ot(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Dr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(e){const r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(e){e=Mr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,i,o,c,u){const h=this.rtpCapabilities.send,m=e===mt.VIDEO?h.videoCodecs:h.audioCodecs,_=e===mt.VIDEO?h.videoExtensions:h.audioExtensions;Dr()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,r,i){const o=Mr(e);return mx(o),Bv(o,r),gx(o,r),IG(o),rP(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,r){const i=Mr(e);return rP(i,r,this.localCapabilities.recv),Wv(i),i}updateRecvMedia(e,r){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>Dr()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const t_e=["sdp"];var pr;function V7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Fm(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?V7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):V7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let F7=(pr=class pS extends cG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,o){super(r,i),$(this,"direction",void 0),$(this,"name",void 0),$(this,"store",void 0),$(this,"spec",void 0),$(this,"peerConnection",void 0),$(this,"initialOffer",void 0),$(this,"transport",void 0),$(this,"statsFilter",void 0),$(this,"localCandidateCount",0),$(this,"_isInRestartIce",!1),$(this,"mutex",void 0),$(this,"onLocalCandidate",void 0),$(this,"remoteSDP",void 0),$(this,"pendingCandidates",[]),$(this,"localCapabilities",void 0),$(this,"isReady",!1),$(this,"restartCnt",0),$(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new As("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(pS.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??So.SEND_ONLY,this.name=this.direction===So.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=PL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await PG();if(this.localCapabilities=iP(i),r){const{sdp:o}=r,c=e_e(r,t_e),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=vb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(du(R,S,"videoExtensions",P,k,W),du(R,S,"videoCodecs",P,k,W),du(R,S,"audioExtensions",P,k,W),du(R,S,"audioCodecs",P,k,W),re("RAISE_H264_BASELINE_PRIORITY")){const U=W.videoCodecs.findIndex(V=>V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&V.fmtp&&V.fmtp.parameters["profile-level-id"]==="42001f");if(U!==-1){const V=W.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(V<U){D.debug("raising H264 baseline profile priority");const q=W.videoCodecs[U];W.videoCodecs.splice(U,1),W.videoCodecs.splice(V,0,q)}V!==-1&&re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:k,sendrecv:W}}({},{},o);this.remoteSDP=new U7({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Am(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await OG({},{},h.sdp);this.localCapabilities=iP(_);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),Fm(Fm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Am(o.sdp);return this.initialOffer=o,Fm(Fm({},c),{},{sdp:o.sdp})}}catch(i){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=r,u=await OG({},{},i);this.remoteSDP=new U7({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Le(X.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return hl(function*(){const u=yield wn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,i,o);r.forEach((V,q)=>{if(m[q].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(V._mediaStreamTrack,{direction:"sendonly"});h.push(Y),V._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(ce=>ce.mid===m[q].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(Y),V._updateRtpTransceiver(Y)}}),Dr()&&re("SIMULCAST")===!0&&(yield wn(c.applySimulcastForFirefox(h,r)));const _=m.map(V=>V.mid),y=yield wn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(y.sdp,r,_),R=ya(S),P=_.map(V=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return wG(q,re("USE_PUB_RTX"))}),k=h.map((V,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}});yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield k}catch(V){const q=c.remoteSDP.toString();throw yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield wn(c.stopSending(_,!0)),V}yield wn(c.applySimulcastEncodings(h,r)),yield wn(c.applySendEncodings(h,r));const W=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return U==null||U(W),yield wn(c.setRemoteDescription({type:"answer",sdp:W})),h.map((V,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var y;_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const _=this.remoteSDP.toString(),y=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);y==null||y(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(y.sdp,u,r);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===I_.Auto&&(this.store.p2pTransport=I_.SdRtn,kn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(pS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,kn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(pS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Am(i.sdp);return this.store.descriptionStart(),this.direction===So.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===So.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Am(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?Dr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Fm(Fm({},dh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Fm(Fm({},dh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;ot(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(ab(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...pS.turnServerConfigToIceServers(r.turnServer.servers,i,o)),re("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...pS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,o)),ot(u=[I_.Relay,I_.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&kn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),D.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);D.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case I_.SdRtn:const m=r.filter(y=>{var S;return ot(S=y.username).call(S,"glb:")&&y.turnServerURL==y.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Cm(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Cm(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case I_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Cm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Cm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!i)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!kn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),ot(h=r._hints).call(h,ar.LOW_STREAM)&&(R&&(u.maxFramerate=Qa(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(re("DSCP_TYPE")&&Fp()){var m;const S=re("DSCP_TYPE");ot(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=i.getParameters(),y=(o=_.encodings)===null||o===void 0?void 0:o[0];Dr()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(_,c),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(r,i){try{if(!kn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof gr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=ya(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(Bv(_,u),AG(_,u,this.store.codec))}),bm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const y=r[_],S=i[_];if(S instanceof gr&&!ot(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,i){if(!Dr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof gr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof gr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!ot(i=r._hints).call(i,ar.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=ya(i).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),ot(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,o){const c=ya(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===mt.AUDIO&&u.media.mediaType==="audio"&&Wv(u),bm(c)}},yt(pr.prototype,"establish",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"establish"),pr.prototype),yt(pr.prototype,"connect",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"connect"),pr.prototype),yt(pr.prototype,"receive",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"receive"),pr.prototype),yt(pr.prototype,"mockReceive",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"mockReceive"),pr.prototype),yt(pr.prototype,"stopReceiving",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"stopReceiving"),pr.prototype),yt(pr.prototype,"restartICE",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"restartICE"),pr.prototype),yt(pr.prototype,"close",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"close"),pr.prototype),yt(pr.prototype,"updateEncoderConfig",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"updateEncoderConfig"),pr.prototype),yt(pr.prototype,"updateSendParameters",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"updateSendParameters"),pr.prototype),yt(pr.prototype,"replaceTrack",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"replaceTrack"),pr.prototype),yt(pr.prototype,"muteLocal",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"muteLocal"),pr.prototype),yt(pr.prototype,"unmuteLocal",[gu],Object.getOwnPropertyDescriptor(pr.prototype,"unmuteLocal"),pr.prototype),pr);function gu(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}let _d=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var j7,B7,W7,z7,G7,H7,$7,K7,q7,Y7,X7,Cr;function J7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function jP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?J7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):J7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let n_e=(j7=Ed(_d.SEND_ONLY),B7=Ed(_d.SEND_ONLY),W7=Ed(),z7=Ed(_d.RECEIVE_ONLY),G7=Ed(_d.RECEIVE_ONLY),H7=Ed(_d.RECEIVE_ONLY),$7=Ed(_d.RECEIVE_ONLY),K7=Ed(_d.RECEIVE_ONLY),q7=Ed(_d.RECEIVE_ONLY),Y7=Ed(),X7=Ed(_d.RECEIVE_ONLY),Cr=class extends Ar{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(kt.StateChange,r,this._state)}constructor(e,r){super(),$(this,"isPlanB",!1),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"sendConnection",void 0),$(this,"recvConnection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"statsCollector",void 0),$(this,"dtlsFailedCount",0),$(this,"sendMutex",void 0),$(this,"recvMutex",void 0),$(this,"_state",Wn.Disconnected),$(this,"_restartStates",["disconnected","failed"]),$(this,"reconnectInterval",void 0),$(this,"uploadUnplinkStarted",!1),$(this,"uploadDownlinkStarted",!1),$(this,"uplinkStateUploadInterval",void 0),$(this,"downlinkStatsUploadInterval",void 0),$(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Wn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const y=_.find(k=>k[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(k=>{let[,{id:W}]=k;return W}));let S=!1;var h,m;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get($e.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get($e.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(_);await sr(this,kt.RequestMuteLocal,R);const P=i.trackMediaType==="video"?Rm.MUTE_LOCAL_VIDEO:Rm.MUTE_LOCAL_AUDIO;await sr(this,kt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Wn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const m=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?Rm.UNMUTE_LOCAL_VIDEO:Rm.UNMUTE_LOCAL_AUDIO;await sr(this,kt.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==Wn.Connected)return void o();const{id:y,track:S}=_;y&&(await this.sendConnection.updateSendParameters(y,S),await this.sendConnection.updateEncoderConfig(y,S),this.emit(kt.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Wn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Wn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),y[0]===$e.LocalVideoTrack&&kn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new lt((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new m9(e),this.bindStatsUploaderEvents(),this.sendMutex=new As("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new As("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let i;try{if(r){this.recvConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new F7(e,this.store,So.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Wn.New,this.sendConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new F7(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Wn.Connected}async addRemoteCandidate(e,r){if(r===So.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,i){var o=this;return hl(function*(){const c=yield wn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Wn.Connected){o.throwIfTrackTypeNotMatch(e);const y=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(y))}o.store.pubId=o.store.pubId+1,ks.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,r,i);if(u.length===0)return void(yield wn(o.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:S,type:R}=y;const P=Date.now();o.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield wn(o.sendConnection.send(u.map(y=>{let{track:S}=y;return S}),o.store.codec,o.store.audioCodec)),m=(yield wn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(y){throw h.throw(y),(y==null?void 0:y.code)===X.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),y}yield wn(h.next()),u.forEach(y=>{let{type:S}=y;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(y=>{let{track:S,type:R}=y;const P=Date.now();o.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Wn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ot(e).call(e,c)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Wn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:Kfe(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):i.push(m)}),r.length>0&&r.forEach(o=>{sr(this,kt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{sr(this,kt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return hl(function*(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await vs(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,i,o){var c;if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:i}],String(e.uid),o);r===mt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Dv(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Nv(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===e.uid&&r===P});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(kt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,i,o){if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===e.uid&&r===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var m;if(h===mt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===mt.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,y;if(m===mt.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===mt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===mt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;sr(this,kt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[mt.VIDEO,mt.AUDIO].forEach(o=>{i.has(o)?sr(this,kt.RequestP2PUnmuteRemote,o):sr(this,kt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===mt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ti){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===$e.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Br),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof gr);wt.publish(this.store.sessionId,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===mt.VIDEO?i._videoSSRC:i._audioSSRC;c&&wt.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===mt.VIDEO,audio:o===mt.AUDIO,peerid:i.uid,subscribeRequestid:o===mt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:ks.measureFromSubscribeStart(this.store.clientId,c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new As("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new As("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($e.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ti){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Wn.Disconnected}getStats(e){var r,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($e.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($e.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof gr||r&&r.track instanceof Br?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(kc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=HT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Wn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case $e.LocalVideoTrack:ot(r=o._hints).call(r,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ti?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(kc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Om?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let i,o;if(e===So.SEND_ONLY){if(!this.sendConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await vs(this,kt.RequestP2PRestartICE,{direction:So.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalAudioTrack),o=e.videoSend.find(k=>{var W;return k.ssrc===(r==null||(W=r.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)}),c=e.audioSend.find(k=>{var W;return k.ssrc===(i==null||(W=i.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)});if(!o||!c)return 1;const u=Pc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,W=e.bitrate.actualEncoded;if(k&&W){const U=(1e3*k-W)/(1e3*k);return Zz[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(W=>W.ssrc===c),m=e.videoRecv.find(W=>W.ssrc===u);if(!h&&!m)return void(r+=1);const _=Pc(this,kt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new lt((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}filterTobePublishedTracks(e,r,i){const o=[],c=kn(),u=this.getAllTracks();e=yv(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof gr&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:$e.LocalVideoLowTrack})}if(_ instanceof Br){const y=this.localTrackMap.get($e.LocalAudioTrack);if(y){if(!(y.track instanceof Ti))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(R=>{let{type:P}=R;return P===$e.LocalAudioTrack});if(!(S.track instanceof Ti))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ti||_._bypassWebAudio)o.push({track:_,type:$e.LocalAudioTrack});else{const S=new Ti;S.addAudioTrack(_),o.push({track:S,type:$e.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=yv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Br){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ti?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(o instanceof gr){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case $e.LocalVideoTrack:i.addListener(gt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ti?e.trackList.forEach(i=>{i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case $e.LocalVideoTrack:i.off(gt.GET_STATS,this.handleGetLocalVideoStats),i.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ti?e.trackList.forEach(r=>{r.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(gt.GET_STATS,this.handleGetLocalAudioStats),r.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(gt.GET_STATS,this.handleGetLocalAudioStats),e.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Nv&&r.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof Dv&&r.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(gt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(mt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(mt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,{track:h,type:m}=i;switch(m){case $e.LocalAudioTrack:u=zn.Audio;break;case $e.LocalVideoTrack:u=ot(c=h._hints).call(c,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:u=zn.Low}return{kind:m===$e.LocalAudioTrack?mt.AUDIO:mt.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var i;D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),ot(i=this._restartStates).call(i,r)&&!e.isInRestartIce&&(r==="disconnected"&&await is(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:xr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(kc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Iv.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,Mi.FIRST_AUDIO_DECODE,wr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(kc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&wt.firstRemoteFrame(this.store.sessionId,Mi.FIRST_AUDIO_RECEIVED,wr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(kc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&wt.firstRemoteFrame(this.store.sessionId,Mi.FIRST_VIDEO_RECEIVED,wr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Im(i))," -> ").concat(JSON.stringify(Im(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Im(i))," -> ").concat(JSON.stringify(Im(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(kt.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===So.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,D.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===So.SEND_ONLY?this.restartICE(e):vs(this,kt.RequestP2PRestartICE,{direction:So.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive||r.push([$e.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive&&r.push([$e.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===$e.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case mt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:mt.VIDEO,ssrcId:o._videoSSRC}));case mt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:mt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new lt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new lt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Br){const i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await sr(this,kt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(kt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await is(bL(this.dtlsFailedCount,gi)),this.emit(kt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof gr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof gr).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Br).length>1&&(e.some(r=>r instanceof Br&&r._bypassWebAudio)||!kn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof gr&&this.pendingLocalTracks.some(i=>i instanceof gr))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Br&&this.pendingLocalTracks.some(i=>i instanceof Br)&&(!kn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Br&&i._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const i=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding,o=jP(jP({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?e._mediaStreamTrack.clone():Nx(e,o);const u=or(8,"track-low-"),h=new gr(c,jP(jP({},i&&{scaleResolutionDownBy:fx(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(A_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Rv.LOW_STREAM)}),h._hints.push(ar.LOW_STREAM),e.addListener(gt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(kc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,Mi.FIRST_VIDEO_DECODE,wr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Le(X.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Le(X.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}async preConnect(e){throw new Le(X.NOT_SUPPORTED)}getEstablishParams(){throw new Le(X.NOT_SUPPORTED)}async reSubscribe(e){throw new Le(X.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new Le(X.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===$e.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Rv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},yt(Cr.prototype,"p2pConnect",[j7],Object.getOwnPropertyDescriptor(Cr.prototype,"p2pConnect"),Cr.prototype),yt(Cr.prototype,"unpublish",[B7],Object.getOwnPropertyDescriptor(Cr.prototype,"unpublish"),Cr.prototype),yt(Cr.prototype,"unpublishLowStream",[W7],Object.getOwnPropertyDescriptor(Cr.prototype,"unpublishLowStream"),Cr.prototype),yt(Cr.prototype,"subscribe",[z7],Object.getOwnPropertyDescriptor(Cr.prototype,"subscribe"),Cr.prototype),yt(Cr.prototype,"mockSubscribe",[G7],Object.getOwnPropertyDescriptor(Cr.prototype,"mockSubscribe"),Cr.prototype),yt(Cr.prototype,"unsubscribe",[H7],Object.getOwnPropertyDescriptor(Cr.prototype,"unsubscribe"),Cr.prototype),yt(Cr.prototype,"muteRemote",[$7],Object.getOwnPropertyDescriptor(Cr.prototype,"muteRemote"),Cr.prototype),yt(Cr.prototype,"unmuteRemote",[K7],Object.getOwnPropertyDescriptor(Cr.prototype,"unmuteRemote"),Cr.prototype),yt(Cr.prototype,"hasRemoteMediaWithLock",[q7],Object.getOwnPropertyDescriptor(Cr.prototype,"hasRemoteMediaWithLock"),Cr.prototype),yt(Cr.prototype,"disconnectForReconnect",[Y7],Object.getOwnPropertyDescriptor(Cr.prototype,"disconnectForReconnect"),Cr.prototype),yt(Cr.prototype,"remoteMediaSsrcChanged",[X7],Object.getOwnPropertyDescriptor(Cr.prototype,"remoteMediaSsrcChanged"),Cr.prototype),Cr);function Ed(e){return function(r,i,o){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case _d.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case _d.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),y=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),y()}}}},o}}class Y_ extends Ar{constructor(r,i){super(),$(this,"signal",void 0),$(this,"token",void 0),$(this,"tokenTimeout",void 0),$(this,"tokenInterval",void 0),$(this,"_sequence",0),$(this,"userMap",new Map),$(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const o=()=>{this.signal.connectionState===lr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*re("P2P_TOKEN_INTERVAL"))};o()}async send(r,i,o,c,u){var h,m,_;if(this.userMap.size===0)return;const y=Array.from(Ic(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(m=c)!==null&&m!==void 0?m:or(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:i,token:"".concat(this.token,"_").concat(y)};re("SHOW_P2P_LOG")&&D.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(jt.DATA_STREAM,{payload:Tm(this.encoder.encode(P))})});const R=new lt((P,k)=>{const W=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),this.off(Vv.ABORT,V),D.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?k(new Le(X.INVALID_REMOTE_USER)):k(new Le(X.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),U=()=>{W&&window.clearTimeout(W),this.off(Vv.ABORT,V),o&&P()},V=()=>{W&&window.clearTimeout(W),this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),k(new Le(X.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Vv.ABORT,V),this.once("res-@".concat(c,"_ack"),U);const q=(ce,_e)=>{Y=!0,W&&window.clearTimeout(W),this.off("res-@".concat(c,"_ack"),U),this.off(Vv.ABORT,V),ce==="success"?P(_e):k(new Le(X.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let Y=!1;o||(this.once("res-@".concat(c),q),is(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Y||D.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===X.TIMEOUT)return await this.send(r,i,o,c,u);throw P}}onMessage(r){var i;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Qr.CHECK)return;const{token:y}=r;c=new Map,u={uid:o,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(_n.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:y,total:S}=r,R=(h=c.get(y))!==null&&h!==void 0?h:[];if(R.push(r),c.has(y)||c.set(y,R),R.length!==S)return;{const P=HT(R).call(R,(k,W)=>k.index-W.index).map(k=>k.payload).join("");c.delete(y),(r=JSON.parse(P))._uid=o}}const{_type:m,token:_}=r;if(ot(i=[Qr.ACK,Qr.CHECK]).call(i,m))return m===Qr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(r);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):D.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:or(6,""),token:this.token,_type:Qr.CHECK};re("SHOW_P2P_LOG")&&D.debug("send message",r),this.signal.request(jt.DATA_STREAM,{payload:Tm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:Qr.ACK,token:this.token};re("SHOW_P2P_LOG")&&D.debug("send message",i),this.signal.request(jt.DATA_STREAM,{payload:Tm(this.encoder.encode(JSON.stringify(i)))})}response(r,i,o){this.send(Qr.RESPONSE,JSON.stringify({success:!o,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=y;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),y.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(r._id),void D.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===_&&(this.receiveMessage(r),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:o,_message:c,_uid:u}=r;if(re("SHOW_P2P_LOG")&&D.debug("receive message",r),i){let h;switch(r._type!==Qr.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Qr.CANDIDATE:case Qr.CONTROL:this.signal.emit(o,h,u);break;case Qr.PUBLISH:case Qr.UNPUBLISH:case Qr.RESTART_ICE:case Qr.CALL:h.uid=u,vs(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Qr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Qr.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(i),m?"success":"failed",_);break}}}}splitMessage(r){if(r.length<Y_.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:o}=JSON.parse(r),c=or(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const _={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>Y_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),r=r.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(r,i){return r.token!==i?(D.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{D.debug("token timeout, ".concat(i)),this.reset(r.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await vs(this.signal,Qr.CALL,void 0),i=await this.send(Qr.CALL,r);this.signal.emit(Bt.P2P_CONNECTION,i,!0)}async reset(r,i){const o=this.userMap.get(r);o&&(this.emit(Vv.ABORT),this.signal.emit(_n.ON_USER_OFFLINE,{uid:o.uid,reason:Sfe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(D.debug("change local token from ".concat(i," to ").concat(i)),this.token=or(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Vv.ABORT)}}$(Y_,"MAX_SIZE",1),$(Y_,"MAX_MESSAGE_SIZE",1024);class r_e extends Ar{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lr.CONNECTED?this.emit(Bt.WS_CONNECTED):r===lr.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):r===lr.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"p2pToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new I8(5)),$(this,"pingpongTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"_external_signal",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case _n.ON_DATA_STREAM:return void this.handleDataStream(c._message);case _n.MUTE_AUDIO:case _n.MUTE_VIDEO:case _n.ON_P2P_LOST:case _n.ON_USER_ONLINE:return;case _n.ON_USER_OFFLINE:const{uid:u}=c._message;return D.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Bn.UID_BANNED);break;case 15:this.close(Bn.IP_BANNED);break;case 16:this.close(Bn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Bn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Bn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Bn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Bn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Bn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Bn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new hx("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",ys.OFFLINE)}),this.p2pToken=or(6,""),this._external_signal=new Y_(this,this.p2pToken)}async request(r,i,o,c){const u=or(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new lt((W,U)=>{if(this.connectionState===lr.CONNECTED)return W();const V=()=>{this.off(Bt.WS_CLOSED,q),W()},q=()=>{this.off(Bt.WS_CONNECTED,V),U(new Le(X.WS_ABORT))};this.once(Bt.WS_CONNECTED,V),this.once(Bt.WS_CLOSED,q)});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new lt((W,U)=>{let V=!1;const q=(ce,_e)=>{V=!0,W({isSuccess:ce==="success",message:_e||{}}),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.emit(Bt.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Le(X.WS_ABORT,"type: ".concat(r))),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Bt.WS_CLOSED,Y),this.once(Bt.WS_RECONNECTING,Y),is(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Bt.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await y}catch(W){if(this.connectionState===lr.CLOSED||r===jt.LEAVE)throw new Le(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?W.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=_b(R),k=new Le(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ys.MULTI_IP)):this.reconnect(P.action,ys.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new lt(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(mb.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(r,i,o){return await this._external_signal.send(r,i,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((i,o)=>{this.once(Bt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Bt.WS_CLOSED,()=>o(this.initError||new Le(X.WS_ABORT))),this.connectionState=lr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Bn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=or(6,""),this._external_signal.clear(),this._external_signal=new Y_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION);const r=await vs(this,Bt.REQUEST_JOIN_INFO),i=await this.request(jt.JOIN,r);if(!i)return this.emit(Bt.REPORT_JOIN_GATEWAY,X.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleDataStream(r){try{var i;const o=R_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||ot(i=Object.values(Qr)).call(i,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(_n.ON_DATA_STREAM,r)}catch{this.emit(_n.ON_DATA_STREAM,r)}}handleNotification(r){D.debug("[".concat(this.clientId,"] receive notification: "),r);const i=_b(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Bn.UID_BANNED),void this.close()):void this.reconnect(i.action,ys.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(D.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ys.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(qt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(qt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(qt.FAILED,()=>{this._disconnectedReason=Bn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(qt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(qt.WILL_RECONNECT,(r,i,o)=>{r!=="retry"?(D.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):D.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Lt.ERR_NO_AUTHORIZED)return D.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ys.SERVER_ERROR);D.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ys.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(qt.REQUEST_NEW_URLS,(r,i)=>{vs(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const i_e={name:"P2PChannel",create:function(e){let{store:r,statsCollector:i}=e;return new n_e(r,i)},createSubmodule:function(e){let{store:r,spec:i}=e;return new r_e(i,r)}};function Q7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Z7(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Q7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class s_e{constructor(r){$(this,"sessionDesc",void 0),$(this,"localCapabilities",void 0),$(this,"rtpCapabilities",void 0),$(this,"candidates",void 0),$(this,"_originCandidates",void 0),$(this,"iceParameters",void 0),$(this,"dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),r=Mr(r);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:y}=r,S=ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Mr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=y;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=i.iceUfrag,P.attributes.icePwd=i.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(W=>W.payloadType.toString(10));let k=u.videoCodecs.filter(W=>{var U,V;return(U=W.rtpMap)===null||U===void 0?void 0:ot(V=U.encodingName.toLowerCase()).call(V,_)});k.length===0&&(k=u.videoCodecs),P.attributes.payloads=k,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(k=>k.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return bm(this.sessionDesc)}send(r,i,o){const{ssrcs:c,ssrcGroups:u}=x_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>r===mt.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(r){return r.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{ot(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;ot(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(Z7(Z7({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case Os.TCP_RELAY:this.candidates=o;break;case Os.UDP_TCP_RELAY:case Os.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Mr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let o=0;o<r;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(r,i){const o=Mr(r);return Bv(o,i),gx(o,i),o}updateRecvMedia(r,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===mt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(r){const i=Mr(r);return mx(i),function(o){const c=o.attributes.extmaps.find(u=>nP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var rr;function e$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function BP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?e$(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):e$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let o_e=(rr=class Nw extends lG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return ot(i=Object.keys(kA)).call(i,r)}))]}constructor(r,i){super(r,i),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"statsFilter",void 0),$(this,"useRTX",!1),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",void 0),this.store=i,this.mutex=new As("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Nw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=PL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Am(r.sdp),o=vb(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,BP(BP({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new s_e(BP(BP({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var o=this;return hl(function*(){const c=yield wn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield wn(o.peerConnection.createOffer()),m=ya(h.sdp),_=r.map(P=>{const k=P._mediaStreamTrack,W=m.mediaDescriptions.find(U=>U.attributes.mid===k.kind);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return function(U,V,q){const Y=U.attributes.ssrcs.filter(_e=>_e.attributes.label===V),ce=U.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ce&&Y.length>1){const _e=ce.find(ye=>ye.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return _e?[{ssrcId:_e.ssrcIds[0],rtx:q?_e.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(W,k.id,o.useRTX)});let y;try{y=yield _}catch(P){throw u.forEach(k=>{Es()&&k.replaceTrack(null),o.peerConnection.removeTrack(k)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,i,y);const R=o.remoteSDP.toString();return yield wn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(o.applySendEncodings(u,r)),yield wn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,k)=>{const W=P._mediaStreamTrack.id;return{localSSRC:_[k],id:W}})}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{Es()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,i,c),m=new lt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),k=W=>{const U=Rn();if((U.name==="Safari"&&Number(U.version)===11||Eo())&&W.track.id!==u&&W.streams[0].id===h){var V;const q=W.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(r,u,W.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(q)}if(W.track.id===u)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(W.track)};this.peerConnection.addEventListener("track",k)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(Es()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(Es()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return hl(function*(){const o=yield wn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=kn().supportPCSetConfiguration;if(r===Os.RELAY&&!c)return;if(c){const y=i.peerConnection.getConfiguration(),S=r===Os.RELAY?"relay":"all";y.iceTransportPolicy!==S&&(D.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(S,"]")),y.iceTransportPolicy=S,i.peerConnection.setConfiguration(y))}r!==Os.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield wn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Am(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const _=i.remoteSDP.toString();yield wn(i.peerConnection.setLocalDescription(u)),yield wn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){D.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(ab(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...Nw.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...Nw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(y=>{var S;return((S=y.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!i)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!kn().supportSetRtpSenderParameters)return D.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof gr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(re("DSCP_TYPE")&&Fp()){var h;const y=re("DSCP_TYPE");ot(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(r,i){try{if(!kn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const o=ya(r);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&Bv(m,c)}),bm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:y}=r[h];return new lt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=W=>{const U=Rn();if(U.name==="Safari"&&Number(U.version)===11&&W.track.id!==m&&W.streams[0].id===_){var V;const q=W.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(y,m,W.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:q,id:m})}if(W.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:W.track,id:m})};this.peerConnection.addEventListener("track",k)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await lt.all(i)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(kn().supportPCSetConfiguration){const i=Nw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},yt(rr.prototype,"connect",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"connect"),rr.prototype),yt(rr.prototype,"stopSending",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"stopSending"),rr.prototype),yt(rr.prototype,"receive",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"receive"),rr.prototype),yt(rr.prototype,"stopReceiving",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"stopReceiving"),rr.prototype),yt(rr.prototype,"muteRemote",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"muteRemote"),rr.prototype),yt(rr.prototype,"unmuteRemote",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteRemote"),rr.prototype),yt(rr.prototype,"muteLocal",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"muteLocal"),rr.prototype),yt(rr.prototype,"unmuteLocal",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteLocal"),rr.prototype),yt(rr.prototype,"close",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"close"),rr.prototype),yt(rr.prototype,"updateEncoderConfig",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"updateEncoderConfig"),rr.prototype),yt(rr.prototype,"updateSendParameters",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"updateSendParameters"),rr.prototype),yt(rr.prototype,"replaceTrack",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"replaceTrack"),rr.prototype),yt(rr.prototype,"getRemoteSSRC",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"getRemoteSSRC"),rr.prototype),rr);function vl(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}const a_e={name:"PlanBConnection",create:function(e){let{store:r,spec:i}=e;return new o_e(i,r)}},c_e={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(jA.has(e)||!e.track)return;const i={track:e.track};if(Vp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=r.metadata&&r.metadata();_?function(y,S){const{chunk:R,controller:P}=S,k=re("ENABLE_AUDIO_PTS_METADATA")?zp.AUDIO_64_BIT_PTS:zp.METADATA;R.data=function(W,U,V){const q=V.byteLength,Y=q+ZL+Kz,ce=JL+QL+Y,_e=new ArrayBuffer(W.byteLength+ce),ye=new DataView(_e);ye.setUint8(0,$z),ye.setUint16(1,Y),ye.setUint8(3,U),ye.setUint16(4,q);for(let ke=0;ke<q;ke++)ye.setUint8(6+ke,V[ke]);const me=new Uint8Array(ye.buffer);return me.set(new Uint8Array(W),ce),me.buffer}(R.data,k,y),P.enqueue(R)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Es()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=FA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(m.data.getMetadata){const y=r.metadata&&r.metadata();y&&u.port1.postMessage({metadata:y})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=jA.get(e);if(c){jA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}jA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if($A.has(e))return;const i={track:e.track,onMetadata:r.onMetadata};if(Vp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");dL(Un.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),r.enableTopn?function(_,y,S){var R;const P=qz(new DataView(y.data));if(!P)return S.enqueue(y);const k=_.track.id;Wpe.set(k,_.track);const W=(R=P.tlv.find(_e=>_e.tag===zp.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let U=0;typeof W=="number"&&(U=127-W);const V=Math.round(Math.pow(10,U/60)-1),{selected:q,speaker:Y}=function(_e,ye){let me=Lv.get(_e);if(me||(me=function(ke){const Ye=new Xz;return Lv.set(ke,Ye),hd||(hd=new jpe(re("TOPN_SILENCE_THRESHOLD")||500),hd.on("ActiveSpeakerChanged",ut=>{ut!=null&&(zA=ut)})),hd.addSpeakers([Ye]),Ye}(_e)),Lv.size<=Jz)return{selected:!0,speaker:me};if(!hd)throw new Error("no active speaker detector");return hd.levelChanged(me.id,ye),N_=hd.loudest.map(ke=>ke.id),zA&&!ot(N_).call(N_,zA)&&N_.length>=Jz&&N_.pop(),{selected:ot(N_).call(N_,me.id)||me.id===zA,speaker:me}}(_,V),ce=function(_e,ye,me){const ke=pd.get(_e)||new Bpe(_e,ye);return ke.score=me,pd.set(_e,ke),function(Ye){if(GA.set(Ye,!0),!HA)return void(HA=Date.now());const ut=Date.now();ut-HA>1e3&&(GA.get(Ye)?GA.set(Ye,!1):(Qz(Ye),GA.delete(Ye)),HA=ut)}(_e),ke}(k,_.track,Y.energyScore);ce.addSample(q),ce.active&&(y.data=P.frame.buffer,S.enqueue(y))}(e,h,m):r.enableMetadata?function(_,y,S){const R=qz(new DataView(_.data));if(!R)return y.enqueue(_);const P=R.tlv.find(k=>k.tag===zp.METADATA||k.tag===zp.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),_.data=R.frame.buffer,y.enqueue(_)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Es()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=FA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.metadata&&i.onMetadata&&i.onMetadata(m.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=$A.get(c);if(u){(function(_){const y=Lv.get(_);y&&(Lv.delete(_),hd&&(hd.removeSpeakers([y]),Lv.size===0&&(hd.destroy(),hd=null)))})(c),Qz(c.track.id),$A.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}}(e)}$A.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,r){if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(KA.has(e)||!e.track)return;const i={track:e.track};if(Vp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void D.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const y=u.shift();y&&(m.data=function(S,R){const P=function(Y){const ce=Y.length;let _e=[],ye=0;for(;ye<ce;)ye+2<ce&&Y[ye]===0&&Y[ye+1]===0&&(Y[ye+2]===0||Y[ye+2]===1||Y[ye+2]===2||Y[ye+2]===3)?(_e.push(Y[ye],Y[ye+1],3,Y[ye+2]),ye+=3):(_e.push(Y[ye]),ye++);return new Uint8Array(_e)}(R),k=P.length,W=Math.floor(k/255),U=k%255,V=new Uint8Array(6+W+1+k+S.byteLength);V[0]=0,V[1]=0,V[2]=0,V[3]=1,V[4]=6,V[5]=101;let q=0;for(;q<W;)V[6+q]=255,q++;return V[6+q]=U,q++,V.set(P,6+q),V.set(new Uint8Array(S),6+q+k),V.buffer}(m.data,y)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Es())return;{if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=FA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=KA.get(e);if(c){KA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}KA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(!e.track)return;if(fb.has(e)){const c=fb.get(e);return void(c&&(c.onSei=r.onSei))}const i={track:e.track,onSei:r.onSei};if(Vp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(y){const S=new DataView(y.data);let R=0;for(;R+4<y.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,k=0,W=0;for(;(W=S.getUint8(P++))===255;)k+=255;k+=W;const U=zpe(y.data,P,k);return new Uint8Array(U)}R++}return null}(h);_&&i.onSei&&i.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Es()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=FA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.sei&&i.onSei&&i.onSei(m.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=fb.get(c);if(u){fb.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}})(e)}fb.set(e,i),e.track.addEventListener("ended",o)}},l_e={name:"InterceptFrame",create:()=>c_e};OL(),Xn("PROCESS_ID","process-".concat(or(8,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void D.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();D.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(mr,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;dd[o]=c,mr[o]=c}})}catch(r){D.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(dd.AREAS)&&dd.AREAS.length>0&&Sx(dd.AREAS,!0);const t$=(e,r,i)=>{D.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),Xn(e,r,i)};Pm(Nge,!1),Pm(xge,!1),Pm(fme,!1),Pm($ge,!1),Pm(Pge,!1),Pm(i_e,!1),Pm(a_e,!1),Pm(l_e,!1);const _i=function(e){const r=new Ar,i=e,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===mh.SECURITY_POLICY_VIOLATION&&xH(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return LH(LH({},i),o)}({__TRACK_LIST__:wv,VERSION:pl,BUILD:DL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:t$,getParameter:re,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(o){let c;return kn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return e;r.close(),r=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new Oe(X.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=wt.reportApiInvoke(null,{name:mi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:xr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&mL()&&n8(75)&&new u().close()}catch(u){return D.error("check system requirement failed: ",u),!1}let i=!1;const o=Rn();o.name===Un.CHROME&&Number(o.version)>=58&&(ld.engine.name!=="WebKit"||function(){const u=Rn();if(TA()){if(u.os===xi.MAC_OS)return!0;if(u.os===xi.IOS){const h=ld.os.version&&ld.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===Un.FIREFOX&&Number(o.version)>=56||o.name===Un.OPERA&&Number(o.version)>=45||o.name===Un.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Eo()||su())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||c8()||Rn().name===Un.QQ)&&(i=!0),D.debug("checkSystemRequirements, api:",r,"browser",i);const c=r&&i;return e.onSuccess(c),c},getDevices:function(e){return Mc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Mc.getRecordingDevices(e)},getCameras:function(e){return Mc.getCamerasDevices(e)},getElectronScreenSources:nW,getPlaybackDevices:function(e){return Mc.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=or(5,"client-"),o=wt.reportApiInvoke(null,{id:i,name:mi.CREATE_CLIENT,options:[r],tag:xr.TRACER});try{(function(c){Pi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Pi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Pi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&rs(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&g8(c.turnServer),c.httpRetryConfig!==void 0&&m8(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&m8(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(i8(16,0)||s8(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",D.debug("browser not support vp9, force use vp8")),Xn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new mme(pu(pu({forceWaitGatewayResponse:!0},r),{},{role:ot(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=re("CAMERA_CAPTURE_CONFIG"),i=or(8,"track-cam-"),o=wt.reportApiInvoke(null,{id:i,tag:xr.TRACER,name:mi.CREATE_CAM_VIDEO_TRACK,options:[Rr({},e),r]});r&&(e.encoderConfig=r);const c=UA(e);let u=null;D.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await xc({video:c},i)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(D)}e.optimizationMode&&XL(i,u,e,hh(e.encoderConfig));const h=new YL(u,e,c,e.scalabiltyMode?DA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),D.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const r=or(8,"track-cus-"),i=wt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:mi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new gr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?DA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[ar.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),D.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(P){return hW(P)}(r):void 0;i&&(r="auto");const o=or(8,"track-scr-v-"),c=wt.reportApiInvoke(null,{id:o,tag:xr.TRACER,name:mi.CREATE_SCREEN_VIDEO_TRACK,options:[Rr({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(P){const k={};P.screenSourceType&&(k.mediaSource=P.screenSourceType),P.extensionId&&Vp()&&(k.extensionId=P.extensionId);const{displaySurface:W,selfBrowserSurface:U,surfaceSwitching:V,systemAudio:q,preferCurrentTab:Y}=P;(rb(107)||hL(107)||pL(93))&&(W&&(Pi(W,"displaySurface",["browser","window","monitor"]),k.displaySurface=W),U?(Pi(U,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=U):k.selfBrowserSurface="include",V&&(Pi(V,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=V)),(rb(105)||hL(105)||pL(91))&&q&&(Pi(q,"systemAudio",["exclude","include"]),k.systemAudio=q),(rb(94)||hL(94)||pL(80))&&Y&&(k.preferCurrentTab=!0),P.electronScreenSourceId&&(k.sourceId=P.electronScreenSourceId);const ce=P.encoderConfig?VL(P.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:ce?ce.width:void 0,maxHeight:ce?ce.height:void 0},ce&&(ce.frameRate&&(typeof ce.frameRate=="number"?(k.mandatory.maxFrameRate=ce.frameRate,k.mandatory.minFrameRate=ce.frameRate):(k.mandatory.maxFrameRate=ce.frameRate.max||ce.frameRate.ideal||ce.frameRate.exact||void 0,k.mandatory.minFrameRate=ce.frameRate.min||ce.frameRate.ideal||ce.frameRate.exact||void 0),k.frameRate=ce.frameRate),ce.width&&(k.width=ce.width),ce.height&&(k.height=ce.height)),k}(e);let h=null,m=null;const _=kn();if(!_.supportShareAudio&&r==="enable"){const P=new Le(X.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(D)}D.info("start create screen video track with config",e,"withAudio",r,"trackId",o);const y=_.supportShareAudio&&r!=="disable";try{const P=await xc({screen:u,screenAudio:y?i||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(D)}if(!m&&r==="enable"){h&&h.stop();const P=new Le(X.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(D)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(XL(o,h,e,e.encoderConfig&&VL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new gr(h,e.encoderConfig?VL(e.encoderConfig):{},e.scalabiltyMode?DA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[ar.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),D.info("create screen video track success","video:",S.getTrackId()),S;const R=new Br(m,void 0,or(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),D.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=re("CAMERA_CAPTURE_CONFIG"),o=or(8,"track-mic-"),c=or(8,"track-cam-"),u=wt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:xr.TRACER,name:mi.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,i]});i&&(r.encoderConfig=i);const h=UA(r),m=pW(e);let _=null,y=null;D.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const P=await xc({audio:m,video:h},"".concat(o,"-").concat(c));_=P.getAudioTracks()[0],y=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!_||!y){const P=new Le(X.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(D)}r.optimizationMode&&XL(c,y,r,hh(r.encoderConfig));const S=new VA(_,e,m,o),R=new YL(y,r,h,r.scalabiltyMode?DA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),D.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=or(8,"track-mic-"),i=wt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:mi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=pW(e);let c=null;D.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{c=(await xc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(D)}const u=new VA(c,e,o,r);return i.onSuccess(u.getTrackId()),D.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(e){const r=or(8,"track-cus-"),i=wt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:mi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Br(e.mediaStreamTrack,e.encoderConfig?LA(e.encoderConfig):{},r,!1);return D.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:o},h=or(8,"track-buf-"),m=wt.reportApiInvoke(null,{id:h,tag:xr.TRACER,name:mi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(re("DISABLE_WEBAUDIO"))throw new Le(X.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");D.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let k=null;if(typeof R=="string"){const U=ZW.get(R);if(U)return D.debug("use cached audio resource: ",R),U;try{k=(await ud(()=>Go.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(V){throw new Le(X.FETCH_AUDIO_FILE_FAILED,V.toString())}}else k=await new lt((V,q)=>{const Y=new FileReader;Y.onload=ce=>{ce.target?V(ce.target.result):q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(R)});const W=await function(U){const V=Ov();return new lt((q,Y)=>{V.decodeAudioData(U,ce=>{q(ce)},ce=>{Y(new Le(X.DECODE_AUDIO_FILE_FAILED,ce.toString()))})})}(k);return typeof R=="string"&&P&&ZW.set(R,W),W}(c,i)}catch(R){return m.onError(R),R.throw(D)}const y=new xpe(c),S=new Lpe(_,y,o?LA(o):{},h);return D.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(D.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw D.debug("Invalid appType"),new Oe(X.INVALID_PARAMS,"invalid app type",e);Xn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){D.setLogLevel(e)},enableLogUpload:function(){re("USE_NEW_LOG")?Xn("UPLOAD_LOG",!0):D.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?Xn("UPLOAD_LOG",!1):D.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new ZG},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=wt.reportApiInvoke(null,{tag:xr.TRACER,name:mi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Br||e instanceof Dv)){const _=new Oe(X.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof Br?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new lt(_=>{const y=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(y);const k=R,W={duration:P,deviceLabel:o,maxVolumeLevel:u,result:k};D.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(W))),i.onSuccess(W),_(k)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=wt.reportApiInvoke(null,{tag:xr.TRACER,name:mi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof gr||e instanceof Nv)){const R=new Oe(X.INVALID_TRACK,"the parameter is not a video track");return i.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof gr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Es()||TA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const R=Date.now();m=await function(P,k,W,U){let V,q=0,Y=null;return new lt((ce,_e)=>{function ye(){q>U&&V&&(V(),ce(q));const me=W.getContext("2d");if(!me){const ut=new Oe(X.UNEXPECTED_ERROR,"can not get canvas 2d context.");return D.error(ut.toString()),void _e(ut)}me.drawImage(P,0,0,160,120);const ke=me.getImageData(0,0,W.width,W.height),Ye=Math.floor(ke.data.length/3);if(Y){for(let ut=0;ut<Ye;ut+=3)if(ke.data[ut]!==Y[ut])return q+=1,void(Y=ke.data);Y=ke.data}else Y=ke.data}setTimeout(()=>{V&&(V(),ce(q))},k),V=zL(()=>{ye()},30)})}(u,r,h,4),_=Date.now()-R}catch(R){throw i.onError(R),R}eme===Un.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:y};return D.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),y},setArea:Sx,audioElementPlayCenter:Ho,resumeAudioContext:function(){Ho.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){_me.processExternalMediaAEC(e)},registerExtensions:function(e){const r=re("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!ot(r).call(r,i.name)&&r.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=D.extLog,o.reporter.hookApiInvoke=wt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=re(c)})}),t$("PLUGIN_INFO",r)},ChannelMediaRelayError:Mv,ChannelMediaRelayEvent:Hp,ChannelMediaRelayState:va,RemoteStreamFallbackType:Ipe,RemoteStreamType:Cpe,ConnectionDisconnectedReason:Bn,AudienceLatencyLevelType:rpe,AREAS:Vn,preload:async function(e,r,i,o){return C9(e,r,i,o)}});return Object.defineProperties(_i,{onAudioAutoplayFailed:{get:()=>Uc.onAudioAutoplayFailed,set:e=>{Uc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Uc.onAutoplayFailed,set:e=>{Uc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>_i._onSecurityPolicyViolation,set(e){_i._onSecurityPolicyViolation=e,xH(e)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?D_:[]}}),Mc.on(P_.CAMERA_DEVICE_CHANGED,e=>{D.info("camera device changed",JSON.stringify(e)),_i.onCameraChanged&&_i.onCameraChanged(e),_i.safeEmit(mh.CAMERA_CHANGED,e)}),Mc.on(P_.RECORDING_DEVICE_CHANGED,e=>{D.info("microphone device changed",JSON.stringify(e)),_i.onMicrophoneChanged&&_i.onMicrophoneChanged(e),_i.safeEmit(mh.MICROPHONE_CHANGED,e)}),Mc.on(P_.PLAYOUT_DEVICE_CHANGED,e=>{D.debug("playout device changed",JSON.stringify(e)),_i.onPlaybackDeviceChanged&&_i.onPlaybackDeviceChanged(e),_i.safeEmit(mh.PLAYBACK_DEVICE_CHANGED,e)}),Ho.onAutoplayFailed=()=>{D.info("detect audio element autoplay failed"),Uc.onAudioAutoplayFailed&&Uc.onAudioAutoplayFailed()},Jn.on("autoplay-failed",()=>{D.info("detect webaudio autoplay failed"),Uc.onAudioAutoplayFailed&&Uc.onAudioAutoplayFailed(),_i.safeEmit(mh.AUTOPLAY_FAILED)}),Jn.on(os.STATE_CHANGE,(e,r)=>{D.info("audio context state changed: ".concat(r," => ").concat(e)),_i.onAudioContextStateChanged&&_i.onAudioContextStateChanged(e,r),_i.safeEmit(mh.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),oi.on(Ev.NETWORK_STATE_CHANGE,(e,r)=>{D.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=_i),_i})}(ek)),ek.exports}var E6e=_6e();const PR=g0(E6e),y6e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"9442a472625f44e7b2c5065b9f9b3988",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"},Tse="9442a472625f44e7b2c5065b9f9b3988";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",Tse);console.log("AgoraProvider: import.meta.env:",y6e);const v6e=PR.createClient({mode:"rtc",codec:"vp8"});let fw=null;const bse=L.createContext(null),wse=({children:n,appId:t=Tse,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:E=()=>{}})=>{console.log("AgoraProvider: appId prop:",t);const[v,T]=L.useState(!1),[w,A]=L.useState(!1),[N,F]=L.useState([]),[j,z]=L.useState(null),[H,te]=L.useState(null),[K,ne]=L.useState(null),[de,oe]=L.useState(!1),[ge,ee]=L.useState(!1),[Z,J]=L.useState(!1),[se,he]=L.useState(null),[pe,le]=L.useState(!1),Me=kd(),He=L.useRef(v6e),rt=L.useRef({appId:t,channel:s,uid:l,enabled:d}),we=L.useRef(!1),Ce=L.useRef(null);L.useRef(null),L.useEffect(()=>{rt.current={appId:t,channel:s,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:s,uid:l,enabled:d})},[t,s,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:s,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,s,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",s),te(s)},[s]),L.useEffect(()=>{if(!He.current)return;const nt=dt=>{console.log(`Connection state changed to: ${dt}`),dt==="DISCONNECTED"?(T(!1),console.log("Disconnected from Agora")):dt==="CONNECTED"&&(T(!0),z(null))};return He.current.on("connection-state-change",nt),()=>{He.current.off("connection-state-change",nt)}},[]),L.useEffect(()=>{if(!s||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:s,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",s,"with UID",l);const nt=async(Ut,ln)=>{console.log("AgoraProvider: User published:",Ut.uid,ln);try{await He.current.subscribe(Ut,ln),console.log("AgoraProvider: Subscribed to user:",Ut.uid,"mediaType:",ln),ln==="audio"&&(Ut.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Ut.uid)),F(xn=>xn.some(Yt=>Yt.uid===Ut.uid)?xn:[...xn,Ut])}catch(xn){console.error("AgoraProvider: Error subscribing to user:",xn)}},dt=(Ut,ln)=>{console.log("AgoraProvider: User unpublished:",Ut.uid,ln),ln==="audio"&&Ut.audioTrack&&(Ut.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Ut.uid))},Xe=Ut=>{console.log("AgoraProvider: User joined:",Ut.uid),F(ln=>ln.some(xn=>xn.uid===Ut.uid)?ln:[...ln,Ut])},Ct=Ut=>{console.log("AgoraProvider: User left:",Ut.uid),F(ln=>ln.filter(xn=>xn.uid!==Ut.uid))};He.current.on("user-published",nt),He.current.on("user-unpublished",dt),He.current.on("user-joined",Xe),He.current.on("user-left",Ct);const hn=async()=>{if(we.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}we.current=!0;try{if(v&&Ce.current===s){console.log("AgoraProvider: Already joined to channel",s),oe(!0),E(He.current);return}if(He.current.connectionState==="CONNECTING"||He.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",He.current.connectionState),Ce.current&&Ce.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await be()}catch(Ut){console.error("AgoraProvider: Error leaving channel:",Ut)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),T(!0),oe(!0),Ce.current=s,fw=s,E(He.current);return}console.log("AgoraProvider: Joining channel",s,"current joined channel:",Ce.current),await Ne(),console.log("AgoraProvider: Join channel completed")}catch(Ut){console.error("AgoraProvider: Error during initialization:",Ut)}finally{we.current=!1}};return console.log("AgoraProvider: Running initialization"),hn(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),He.current.off("user-published",nt),He.current.off("user-unpublished",dt),He.current.off("user-joined",Xe),He.current.off("user-left",Ct)}},[s,d,l,E,v]);const ve=async()=>{if(!d||K)return K;console.log("Initializing microphone");try{const nt=await PR.createMicrophoneAudioTrack();return await nt.setMuted(f),ne(nt),console.log("Microphone initialized successfully"),nt}catch(nt){return console.error("Error initializing microphone:",nt),z("Failed to initialize microphone. Please check your permissions."),null}};L.useEffect(()=>{(async()=>{if(s)try{const Ct=await ug(s);Ct&&Ct.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),le(!0),v&&await be()):le(!1)}catch(Xe){console.error("AgoraProvider: Error checking if voice is disabled:",Xe)}})();const dt=Xe=>{Xe.detail&&typeof Xe.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",Xe.detail.voiceDisabled),le(Xe.detail.voiceDisabled),Xe.detail.voiceDisabled&&v?be():!Xe.detail.voiceDisabled&&!v&&d&&s&&Ne())};return window.addEventListener("SpaceVoiceSettingChanged",dt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",dt)}},[s,v,d]);const Ne=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(pe)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),z("Voice chat is disabled for this space"),!1;if(!s)return console.error("AgoraProvider: No channel specified"),z("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",s,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:ge,connectionState:He.current.connectionState,joinedChannel:Ce.current}),v&&Ce.current===s)return console.log("AgoraProvider: Already joined to channel:",s),!0;if(ge)return console.log("AgoraProvider: Already in the process of joining"),!1;if(He.current.connectionState==="CONNECTED")if(Ce.current&&Ce.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await be()}catch(nt){console.error("AgoraProvider: Error leaving channel:",nt)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),T(!0),oe(!0),Ce.current=s,fw=s,E(He.current),!0;if(He.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),ee(!0),new Promise(nt=>{const dt=setInterval(()=>{He.current.connectionState==="CONNECTED"&&(clearInterval(dt),T(!0),ee(!1),oe(!0),Ce.current=s,fw=s,E(He.current),nt(!0))},500);setTimeout(()=>{clearInterval(dt),console.log("AgoraProvider: Connection timeout, considering join failed"),ee(!1),nt(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",s,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",t,"Type:",typeof t,"Length:",t.length),!t||t.trim()===""){const dt="AgoraProvider: App ID is empty or invalid";return console.error(dt),z(dt),ee(!1),!1}ee(!0);const nt=l||Math.floor(Math.random()*1e6);return await He.current.join(t,s,a,nt),console.log("AgoraProvider: Joined channel successfully with UID:",He.current.uid),T(!0),ee(!1),oe(!0),Ce.current=s,fw=s,E(He.current),!0}catch(nt){return console.error("AgoraProvider: Error joining channel:",nt),z(`Error joining channel: ${nt.toString()}`),ee(!1),!1}},be=async()=>{if(v)try{K&&await He.current.unpublish(K),await He.current.leave(),fw=null,Ce.current=null,console.log("Left channel successfully"),T(!1),F([])}catch(nt){console.error("Error leaving channel:",nt),z(nt.message||"Failed to leave channel")}};L.useEffect(()=>()=>{K&&K.close()},[]),L.useEffect(()=>{d&&s&&(!v||Ce.current!==s)&&Ne()},[d,s,v]);const Te=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(nt){return console.error("Error checking microphone status:",nt),!1}};L.useEffect(()=>{const nt=()=>{const Xe=Te();Xe!==w&&(console.log("Syncing microphone state:",{actualStatus:Xe,currentState:w}),A(Xe),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Xe}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Xe,window.agoraClient.microphoneTrack=K))};K&&nt();const dt=setInterval(nt,1e3);return()=>{clearInterval(dt)}},[K,w]);const Ae=async()=>{var nt;if(pe)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Me({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const dt=w!==void 0?w:K?!K.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:dt,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ve()))return console.error("AgoraProvider: Failed to initialize microphone"),dt;const Xe=!dt;if(console.log("AgoraProvider: New voice state will be:",Xe),dt){if(K)try{console.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(Ct){return console.error("Error muting track:",Ct),dt}}else if(K)try{He.current&&v&&!((nt=He.current.localTracks)!=null&&nt.includes(K))&&(console.log("AgoraProvider: Publishing microphone track"),await He.current.publish(K),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(Ct){return console.error("Error unmuting track:",Ct),dt}return A(Xe),Xe}catch(dt){return console.error("AgoraProvider: Error toggling voice:",dt),w}},Ue=async nt=>{try{ne(nt),console.log("Microphone track updated successfully")}catch(dt){throw console.error("Error updating microphone track:",dt),dt}},ze=async()=>{if(!He.current||!s)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(Z)return console.log("AgoraProvider: Stopping screen share"),se&&(Array.isArray(se)?(await He.current.unpublish(se),se.forEach(nt=>nt.close())):(await He.current.unpublish(se),se.close()),he(null)),J(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const nt=await PR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",nt),nt.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),He.current.unpublish(nt),nt.close(),he(null),J(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await He.current.publish(nt),he(nt),J(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=nt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(nt){return console.error("AgoraProvider: Error creating screen track:",nt),J(!1),he(null),!1}}catch(nt){return console.error("AgoraProvider: Error toggling screen share:",nt),J(!1),he(null),!1}};L.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current,isScreenSharing:!1,screenTrack:null};const nt=Xe=>{console.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(Ct=>{Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!0,Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Ct),Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!1,Z)})},dt=Xe=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Ne().then(Ct=>{Xe.detail&&Xe.detail.callback&&Xe.detail.callback(Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Ct),Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",nt),window.addEventListener("JoinVoiceChat",dt),()=>{window.removeEventListener("ToggleScreenShare",nt),window.removeEventListener("JoinVoiceChat",dt),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),L.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=K,window.agoraClient.client=He.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,K]);const et={client:He.current,isJoined:v,isVoiceEnabled:w,users:N,error:j,channel:H,appId:t,toggleVoice:Ae,leaveChannel:be,joinChannel:Ne,microphoneTrack:K,isReady:de,createMicrophoneTrack:Ue,isScreenSharing:Z,screenTrack:se,toggleScreenShare:ze,voiceDisabled:pe};return I.jsx(bse.Provider,{value:et,children:n})},Rse=()=>{const n=L.useContext(bse);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};wse.propTypes={children:kr.node.isRequired,appId:kr.string.isRequired,channel:kr.string.isRequired,token:kr.string,uid:kr.oneOfType([kr.string,kr.number])};const S6e=()=>{var we,Ce;const{client:n,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:f,channel:E,appId:v,toggleVoice:T,joinChannel:w,leaveChannel:A,createMicrophoneTrack:N,isScreenSharing:F,screenTrack:j,toggleScreenShare:z,voiceDisabled:H}=Rse(),[te,K]=L.useState(t!==void 0?t:((we=window.agoraClient)==null?void 0:we.isVoiceEnabled)||!1),[ne,de]=L.useState(F!==void 0?F:((Ce=window.agoraClient)==null?void 0:Ce.isScreenSharing)||!1),[oe,ge]=L.useState(H!==void 0?H:!1),[ee,Z]=L.useState(!0);L.useEffect(()=>{var ve;t!==void 0?K(t):((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):d&&K(!d.muted)},[t,d]),L.useEffect(()=>{var ve;F!==void 0?de(F):((ve=window.agoraClient)==null?void 0:ve.isScreenSharing)!==void 0&&de(window.agoraClient.isScreenSharing)},[F]),L.useEffect(()=>{H!==void 0&&ge(H)},[H]);const J=L.useRef({isVoiceEnabled:te,isScreenSharing:ne,isJoined:s,users:a,error:l,isReady:f,channel:E,appId:v,voiceDisabled:oe});L.useEffect(()=>{J.current={isVoiceEnabled:te,isScreenSharing:ne,isJoined:s,users:a,error:l,isReady:f,channel:E,appId:v,voiceDisabled:oe}},[te,ne,s,a,l,f,E,v,oe]),L.useEffect(()=>{const ve=setTimeout(()=>{Z(!1)},5e3);return()=>clearTimeout(ve)},[]),L.useEffect(()=>{f&&Z(!1)},[f]),L.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:te,contextIsScreenSharing:F,localScreenSharing:ne,isJoined:s,users:a.length,error:l,isReady:f,channel:E,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!j})},[t,te,F,ne,s,a,l,f,E,v,d,j]);const se=async()=>{try{console.log("useVoiceChat: Toggling voice from:",te);const ve=await T();if(console.log("useVoiceChat: Toggle result:",ve),ve!==void 0)K(ve);else{const Ne=!te;K(Ne),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ne)}return ve!==void 0?ve:!te}catch(ve){return console.error("useVoiceChat: Error toggling voice:",ve),te}},he=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ne);const ve=await z();if(console.log("useVoiceChat: Screen share toggle result:",ve),ve!==void 0)de(ve);else{const Ne=!ne;de(Ne),window.agoraClient&&(window.agoraClient.isScreenSharing=Ne)}return ve!==void 0?ve:!ne}catch(ve){return console.error("useVoiceChat: Error toggling screen share:",ve),ne}},pe=async()=>{te&&d&&await se()},le=async()=>{!te&&d&&await se()},Me=ve=>a.some(Ne=>{var be;return Ne.uid===ve&&((be=Ne.audioTrack)==null?void 0:be.isPlaying)}),He=L.useCallback(()=>{if(!d||!te)return 0;try{return d.getVolumeLevel()}catch(ve){return console.error("Error getting volume level:",ve),0}},[d,te]);return{isVoiceEnabled:te,isScreenSharing:ne,isJoined:s,users:a,error:l,toggleVoice:se,toggleScreenShare:he,mute:pe,unmute:le,isUserSpeaking:Me,getVolumeLevel:He,microphoneTrack:d,screenTrack:j,isLoading:ee,channel:E,appId:v,joinChannel:w,leaveChannel:A,client:n,setMicrophoneDevice:async ve=>{try{if(!ve){console.error("No device ID provided");return}if(!n||!s){console.error("Client not initialized or not joined to a channel");return}d&&(te&&await n.unpublish(d),await d.close());const Ne=await PR.createMicrophoneAudioTrack({microphoneId:ve,encoderConfig:"music_standard"});N&&await N(Ne),te&&await n.publish(Ne),console.log("Microphone device changed successfully")}catch(Ne){throw console.error("Error changing microphone device:",Ne),Ne}},voiceDisabled:oe}},T6e=({size:n="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:E,joinChannel:v,channel:T,client:w,voiceDisabled:A}=S6e(),[N,F]=L.useState(!1),[j,z]=L.useState(!1);L.useEffect(()=>{const K=()=>{Ee.log("VoiceButton: Player instantiated, showing button"),z(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(Ee.log("VoiceButton: Player was already instantiated"),z(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),L.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:T,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:j,voiceDisabled:A})},[d,E,T,w,j,A]);const H=async()=>{if(!(N||A)){F(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(ne){ne.message&&ne.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ne)}console.log("VoiceButton: Toggling voice state from:",d);const K=await f();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{F(!1)}}},te=()=>A?"Voice chat is disabled for this space":j?N?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!j||A?null:I.jsx(sg,{label:te(),placement:t,hasArrow:!0,children:I.jsxs(Pt,{position:"relative",cursor:"pointer",onClick:H,children:[I.jsx(wf,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?I.jsx(EV,{color:"white"}):I.jsx(_V,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&I.jsx(Pt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:I.jsx(tp,{size:"sm",color:"white"})})]})})},b6e=ni.createContext({user:null}),w6e=({userNickname:n})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Rse(),[f,E]=L.useState([]),[v,T]=L.useState(!1),[w,A]=L.useState(!0);L.useRef({});const N=L.useRef(null);L.useRef(null);const{user:F}=L.useContext(b6e)||{user:null},[j,z]=L.useState({}),H=L.useRef(a),[te,K]=L.useState(null),{isOpen:ne,onOpen:de,onClose:oe}=Sf(),[ge,ee]=L.useState(!1),Z=L.useRef(null),J=L.useRef(null);L.useEffect(()=>{H.current=a},[a]),L.useEffect(()=>{if(!t||!s){T(!1);return}const Me=setTimeout(()=>{A(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const He=t.connectionState;if(console.log("Current connection state:",He),He==="CONNECTED")T(!0),A(!1);else{T(!1);const rt=we=>{console.log("Connection state changed:",we),we==="CONNECTED"?(T(!0),A(!1)):T(!1)};return t.on("connection-state-change",rt),()=>{t.off("connection-state-change",rt),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[t,s]),L.useEffect(()=>{const Me=async()=>{const He={...j};let rt=!1;for(const we of f){if(j[we.uid])continue;let Ce=null,ve=we.uid;if(typeof ve=="string"&&(ve.includes("-")?(Ce=ve.split("-")[0],ve=ve.split("-")[1]):ve.includes("_")&&(Ce=ve.split("_")[0],ve=ve.split("_")[1])),ve)try{console.log("Trying to fetch nickname for user ID:",ve);const Ne=await ep(ve);Ne&&Ne.Nickname?(console.log("Found nickname in Firebase for user ID:",ve,"Nickname:",Ne.Nickname),He[we.uid]=Ne.Nickname,rt=!0):Ce?(console.log("Using extracted name for user ID:",ve,"Name:",Ce),He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}catch(Ne){console.error("Error fetching user profile:",Ne),Ce?(He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}else Ce?(He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}rt&&z(He)};f.length>0&&Me()},[f,j]),L.useEffect(()=>{if(!t||!s||!v)return;console.log("Setting up screen share event handlers");const Me=async(we,Ce)=>{if(console.log("User published:",we.uid,Ce,we),Ce==="video"){console.log("Remote video track detected:",we.uid);try{await t.subscribe(we,Ce),console.log("Subscribed to remote video track:",we.uid),E(ve=>ve.some(Ne=>Ne.uid===we.uid)?ve:[...ve,we])}catch(ve){console.error("Error subscribing to remote video track:",ve)}}},He=(we,Ce)=>{if(console.log("User unpublished:",we.uid,Ce),Ce==="video"){if(console.log("Remote video track unpublished:",we.uid),we.videoTrack)try{we.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(E(ve=>ve.filter(Ne=>Ne.uid!==we.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),H.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}}},rt=we=>{console.log("User left:",we.uid);const Ce=f.find(ve=>ve.uid===we.uid);if(Ce&&Ce.videoTrack)try{Ce.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(E(ve=>ve.filter(Ne=>Ne.uid!==we.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),H.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}};return t.on("user-published",Me),t.on("user-unpublished",He),t.on("user-left",rt),()=>{t.off("user-published",Me),t.off("user-unpublished",He),t.off("user-left",rt)}},[t,s,v,f,l]),L.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error("Error playing video track:",He)}}),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),H.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[f,l]),L.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),L.useEffect(()=>()=>{if(f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(He){console.error("Error stopping video track on unmount:",He)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[f,a]);const se=()=>{console.log("Stopping local screen share"),d()},he=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&F&&(Me===F.uid||Me===(t==null?void 0:t.uid))?n||"You":j[Me]?j[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),pe=Me=>{console.log("Opening modal for remote screen",Me),K(Me),de()},le=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),de()};return L.useEffect(()=>{ne&&te?(console.log("Modal opened, activeScreen:",te),setTimeout(()=>{if(te.isLocal&&H.current)try{console.log("Playing local screen in modal"),H.current.play("modal-screen-container"),ee(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(te.videoTrack)try{console.log("Playing remote screen in modal"),te.videoTrack.play("modal-screen-container"),ee(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):ne||(ee(!1),K(null),setTimeout(()=>{if(l&&H.current)try{H.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error(`Error playing remote screen ${Me.uid} in small container:`,He)}})},500))},[ne,te,l,f]),!v||w&&f.length===0&&!l||f.length===0&&!l?null:I.jsxs(I.Fragment,{children:[!ne&&I.jsxs(Pt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Z,children:[l&&a&&I.jsxs(Pt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[I.jsx(Pt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),I.jsx(Pt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Me=>{const He=j[Me.uid]||he(Me.uid);return I.jsxs(Pt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>pe(Me),children:[I.jsx(Pt,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),I.jsx(Pt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${He}'s Screen`})]},Me.uid)})]}),ne&&I.jsx(Pt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:oe,children:I.jsxs(Pt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!ge&&I.jsxs(Pt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[I.jsx(tp,{size:"xl"}),I.jsx(Et,{mt:4,children:"Loading screen share..."})]}),I.jsx(Pt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:J}),I.jsx(Pt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:oe,children:""}),I.jsx(Pt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:te!=null&&te.isLocal?n?`${n}'s Screen`:"Your Screen":`${j[te==null?void 0:te.uid]||he(te==null?void 0:te.uid)}'s Screen`}),(te==null?void 0:te.isLocal)&&I.jsx(Pt,{position:"absolute",bottom:4,right:4,children:I.jsx(Ri,{colorScheme:"red",size:"sm",onClick:se,children:"Stop Sharing"})})]})})]})},R6e=({onClose:n})=>{const t=kd(),[s,a]=L.useState(!1),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const T=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(T),window.removeEventListener("ScreenShareToggled",w)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const T=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(T)}}catch(T){console.error("Error in screen share handler:",T),a(!1),t({title:"Screen sharing error",description:T.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(T,w)=>{a(!1),T?(d(w),t(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return I.jsx(Et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function C6e({open:n,onClose:t}){const[s,a]=L.useState(0);return I.jsxs(Na,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[I.jsx(xa,{backdropFilter:"blur(4px)"}),I.jsxs(Da,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[I.jsx(Nl,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),I.jsx(sc,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),I.jsx(La,{p:0,display:"flex",children:I.jsxs(GR,{orientation:"vertical",variant:"unstyled",index:s,onChange:a,display:"flex",flexGrow:1,children:[I.jsxs(HR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:e6e,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Movement"})]}),I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:t6e,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Camera"})]}),I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:QBe,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Actions"})]}),I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:ZBe,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Tips"})]})]}),I.jsxs(g1,{flexGrow:1,display:"flex",flexDirection:"column",children:[I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),I.jsxs(io,{wrap:"wrap",gap:3,children:[I.jsx(Tl,{keyLabel:"W",description:"Move Forward"}),I.jsx(Tl,{keyLabel:"A",description:"Move Left"}),I.jsx(Tl,{keyLabel:"S",description:"Move Backward"}),I.jsx(Tl,{keyLabel:"D",description:"Move Right"}),I.jsx(Tl,{keyLabel:"Shift",description:"Run"}),I.jsx(Tl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),I.jsxs(io,{wrap:"wrap",gap:3,children:[I.jsx(Tl,{keyLabel:"Mouse",description:"Look Around"}),I.jsx(Tl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),I.jsx(Tl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),I.jsxs(io,{wrap:"wrap",gap:3,children:[I.jsx(Tl,{keyLabel:"E",description:"Interact"}),I.jsx(Tl,{keyLabel:"F",description:"Emote Menu"}),I.jsx(Tl,{keyLabel:"T",description:"Chat"}),I.jsx(Tl,{keyLabel:"M",description:"Mute Mic"})]})]}),I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),I.jsxs(zi,{align:"stretch",spacing:2,children:[I.jsx(Et,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),I.jsx(Et,{fontSize:"xs",children:" Press ESC to access settings"}),I.jsx(Et,{fontSize:"xs",children:" Click on players to view their profile"}),I.jsx(Et,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Tl=({keyLabel:n,description:t})=>I.jsx(Pt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:I.jsxs(wi,{spacing:2,children:[I.jsx(Pt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),I.jsx(Et,{fontSize:"xs",children:t})]})}),I6e=()=>{const[n,t]=L.useState([]),[s,a]=L.useState(""),[l,d]=L.useState(0),[f,E]=L.useState(100),[v,T]=L.useState(100),[w,A]=L.useState(!0),[N,F]=L.useState(!0),[j,z]=L.useState(!1);L.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const oe=await PR.getMicrophones();t(oe),oe.length>0&&a(oe[0].deviceId)}catch(oe){console.error("Error getting audio devices:",oe)}})()},[]),L.useEffect(()=>{const de=setInterval(()=>{d(j?Math.random()*50:0)},100);return()=>clearInterval(de)},[j]);const H=de=>{const oe=de.target.value;a(oe),console.log("Microphone changed to:",oe)},te=de=>{E(de),console.log("Microphone volume set to:",de)},K=de=>{T(de),console.log("Speaker volume set to:",de)},ne=()=>{z(!j)};return I.jsxs(zi,{spacing:6,align:"stretch",children:[I.jsxs(Zi,{children:[I.jsxs(bl,{children:["Microphone",I.jsx(uf,{ml:2,colorScheme:j?"green":"red",children:j?"Enabled":"Muted"})]}),I.jsxs(Bte,{value:s,onChange:H,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(de=>I.jsx("option",{value:de.deviceId,children:de.label||`Microphone ${de.deviceId.slice(0,5)}...`},de.deviceId)),n.length===0&&I.jsx("option",{value:"",children:"No microphones found"})]})]}),I.jsxs(Pt,{children:[I.jsx(Et,{mb:2,children:"Microphone Level"}),I.jsx(i0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),I.jsxs(Zi,{children:[I.jsxs(bl,{children:["Microphone Volume: ",f,"%"]}),I.jsxs(LU,{value:f,onChange:te,min:0,max:100,step:1,colorScheme:"blue",children:[I.jsx(MU,{bg:"gray.700",children:I.jsx(UU,{})}),I.jsx(xU,{boxSize:6})]})]}),I.jsxs(Zi,{children:[I.jsxs(bl,{children:["Speaker Volume: ",v,"%"]}),I.jsxs(LU,{value:v,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[I.jsx(MU,{bg:"gray.700",children:I.jsx(UU,{})}),I.jsx(xU,{boxSize:6})]})]}),I.jsxs(Zi,{display:"flex",alignItems:"center",children:[I.jsx(bl,{mb:"0",children:"Microphone Enabled"}),I.jsx(ig,{isChecked:j,onChange:ne,colorScheme:"green",size:"lg"})]}),I.jsxs(Zi,{display:"flex",alignItems:"center",children:[I.jsx(bl,{mb:"0",children:"Echo Cancellation"}),I.jsx(ig,{isChecked:w,onChange:()=>A(!w),colorScheme:"green",size:"lg"})]}),I.jsxs(Zi,{display:"flex",alignItems:"center",children:[I.jsx(bl,{mb:"0",children:"Noise Suppression"}),I.jsx(ig,{isChecked:N,onChange:()=>F(!N),colorScheme:"green",size:"lg"})]}),I.jsxs(ng,{status:"info",borderRadius:"md",children:[I.jsx(rg,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function A6e({open:n,onClose:t,containerRef:s}){return I.jsx(ku,{containerRef:s,children:I.jsxs(Na,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[I.jsx(xa,{}),I.jsxs(Da,{bg:"gray.900",color:"white",borderRadius:"lg",children:[I.jsx(Nl,{children:"Settings"}),I.jsx(sc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),I.jsx(La,{children:I.jsxs(GR,{variant:"enclosed",children:[I.jsxs(HR,{mb:4,children:[I.jsx(Hc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),I.jsx(Hc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),I.jsxs(g1,{children:[I.jsx(Tu,{children:I.jsx(Pt,{p:4,bg:"gray.800",borderRadius:"md",children:I.jsx(I6e,{})})}),I.jsx(Tu,{children:I.jsx(Pt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function P6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function O6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function HS(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function Cse(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function k6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function N6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function D6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function tR(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function vV(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function pJ(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function yO(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function L6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const x6e=async()=>{try{Ee.log("tagsFirestore: Fetching all tags");const n=p0(Ci,"tags"),t=await IR(n),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),s}catch(n){throw Ee.error("tagsFirestore: Error fetching tags:",n),n}},M6e=async n=>{try{Ee.log(`tagsFirestore: Fetching tag with ID: ${n}`);const t=Hi(Ci,"tags",n),s=await Pu(t);return s.exists()?{id:s.id,...s.data()}:(Ee.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(t){throw Ee.error(`tagsFirestore: Error fetching tag with ID ${n}:`,t),t}},U6e=async({id:n,name:t,color:s,description:a})=>{try{Ee.log(`tagsFirestore: Creating new tag: ${t}`);const l={name:t,color:s||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const f=Hi(Ci,"tags",n);await Uk(f,l),d=n}else{const f=p0(Ci,"tags");d=(await v3e(f,l)).id}return{id:d,...l}}catch(l){throw Ee.error("tagsFirestore: Error creating tag:",l),l}},V6e=async(n,t)=>{try{Ee.log(`tagsFirestore: Adding tag ${t} to space ${n}`);const s=Hi(Ci,"tags",t);if(!(await Pu(s)).exists())throw new Error(`Tag with ID ${t} does not exist`);const l=Hi(Ci,"spaces",n);return await Dl(l,{tags:T3e(t)}),!0}catch(s){throw Ee.error(`tagsFirestore: Error adding tag ${t} to space ${n}:`,s),s}},F6e=async(n,t)=>{try{Ee.log(`tagsFirestore: Removing tag ${t} from space ${n}`);const s=Hi(Ci,"spaces",n);return await Dl(s,{tags:b3e(t)}),!0}catch(s){throw Ee.error(`tagsFirestore: Error removing tag ${t} from space ${n}:`,s),s}},j6e=async n=>{try{Ee.log(`tagsFirestore: Getting tags for space ${n}`);const t=Hi(Ci,"spaces",n),s=await Pu(t);if(!s.exists())throw new Error(`Space with ID ${n} not found`);const l=s.data().tags||[];if(l.length===0)return[];const d=[];for(const f of l){const E=await M6e(f);E&&d.push(E)}return d}catch(t){throw Ee.error(`tagsFirestore: Error getting tags for space ${n}:`,t),t}},B6e=async()=>{Ee.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let t=0,s=0;for(const a of n){Ee.log(`tagsFirestore: Processing tag: ${a.name}`);const l=Hi(Ci,"tags",a.id);(await Pu(l)).exists()?(Ee.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),s++):(await U6e(a),t++,Ee.log(`tagsFirestore: Created tag: ${a.name}`))}return Ee.log(`tagsFirestore: Tags initialization complete. Created: ${t}, Skipped: ${s}`),{created:t,skipped:s}}catch(t){throw Ee.error("tagsFirestore: Error initializing default tags:",t),t}},Ise=({spaceID:n})=>{const[t,s]=L.useState([]),[a,l]=L.useState([]),[d,f]=L.useState(!0),[E,v]=L.useState(!1),[T,w]=L.useState(!1),[A,N]=L.useState(null),{isOpen:F,onOpen:j,onClose:z}=Sf(),H=kd(),{user:te}=L.useContext(Ll),K=(te==null?void 0:te.groups)&&(te.groups.includes("disruptiveAdmin")||te.groups.includes("admin"));L.useEffect(()=>{ne()},[n]);const ne=async()=>{f(!0);try{let J=[];try{J=await x6e(),s(J)}catch(se){Ee.error("SpaceTagsManager: Error loading available tags:",se),s([]),H({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const se=await j6e(n);l(se)}catch(se){Ee.error("SpaceTagsManager: Error loading space tags:",se),l([]),H({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(J){Ee.error("SpaceTagsManager: Error in loadTags:",J),H({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},de=async()=>{w(!0),N(null);try{const J=await B6e();console.log("Tag initialization result:",J),N(J),H({title:"Tags initialized",description:`Successfully created ${J.created} tags. Skipped ${J.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ne()}catch(J){Ee.error("SpaceTagsManager: Error initializing tags:",J),N(!1),H({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{w(!1)}},oe=async J=>{if(!(!n||!J)){v(!0);try{await V6e(n,J);const se=t.find(he=>he.id===J);se&&l(he=>[...he,se]),H({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(se){Ee.error(`SpaceTagsManager: Error adding tag ${J} to space:`,se),H({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},ge=async J=>{if(!(!n||!J)){v(!0);try{await F6e(n,J),l(se=>se.filter(he=>he.id!==J)),H({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(se){Ee.error(`SpaceTagsManager: Error removing tag ${J} from space:`,se),H({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},ee=()=>{const J=a.map(se=>se.id);return t.filter(se=>!J.includes(se.id))},Z=ee().length===0;return I.jsxs(Pt,{children:[I.jsx(io,{mb:3,justifyContent:"space-between",alignItems:"center",children:I.jsxs(wi,{spacing:2,ml:"auto",children:[K&&I.jsx(Ri,{size:"xs",leftIcon:I.jsx(VBe,{}),onClick:j,variant:"outline",colorScheme:"purple",children:"Admin"}),I.jsxs(a1,{children:[I.jsx(c1,{as:Ri,size:"xs",leftIcon:I.jsx(UBe,{}),rightIcon:I.jsx(jBe,{}),isDisabled:d||E||Z,children:Z?"No Available Tags":"Add Tag"}),I.jsx(l1,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:ee().length>0?ee().map(J=>I.jsx(FS,{onClick:()=>oe(J.id),icon:I.jsx(Pt,{width:"12px",height:"12px",borderRadius:"full",bg:J.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:J.name},J.id)):I.jsx(FS,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?I.jsx(io,{justify:"center",py:4,children:I.jsx(tp,{size:"sm",color:"blue.300"})}):t.length===0?I.jsx(Pt,{children:I.jsxs(Et,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",K?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?I.jsx(Et,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):I.jsx(Qte,{spacing:2,children:a.map(J=>I.jsx(ZF,{children:I.jsxs(Kte,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${J.color||"#888"}`,children:[I.jsx(Pt,{width:"8px",height:"8px",borderRadius:"full",bg:J.color||"#888",mr:1}),I.jsx(qte,{children:J.name}),I.jsx(Xte,{onClick:()=>ge(J.id),isDisabled:E})]})},J.id))}),I.jsxs(Na,{isOpen:F,onClose:z,size:"md",children:[I.jsx(xa,{backdropFilter:"blur(4px)"}),I.jsxs(Da,{bg:"gray.800",color:"white",children:[I.jsx(Nl,{fontSize:"md",children:"Tag System Administration"}),I.jsx(sc,{}),I.jsxs(La,{children:[I.jsx(Et,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),A&&I.jsxs(ng,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[I.jsx(rg,{}),I.jsxs(Et,{fontSize:"sm",children:["Tags initialized. Created: ",I.jsx("b",{children:A.created}),", Skipped: ",I.jsx("b",{children:A.skipped})]})]}),I.jsx(Ri,{colorScheme:"blue",onClick:de,isLoading:T,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),I.jsx(mg,{children:I.jsx(Ri,{variant:"ghost",size:"sm",onClick:z,children:"Close"})})]})]})]})};Ise.propTypes={spaceID:kr.string.isRequired};const W6e=({isOpen:n,onClose:t})=>{const{spaceID:s}=Qc(),[a,l]=L.useState(0),[d,f]=L.useState(""),[E,v]=L.useState(""),[T,w]=L.useState(!1),[A,N]=L.useState(null),[F,j]=L.useState(null),[z,H]=L.useState(!1),[te,K]=L.useState(0),[ne,de]=L.useState(null),oe=L.useRef(null),[ge,ee]=L.useState(null),[Z,J]=L.useState(null),[se,he]=L.useState(!1),[pe,le]=L.useState(0),[Me,He]=L.useState(null),rt=L.useRef(null),[we,Ce]=L.useState([]),[ve,Ne]=L.useState([]),[be,Te]=L.useState(!1),[Ae,Ue]=L.useState(!1),[ze,et]=L.useState(!0),[nt,dt]=L.useState(!1),Xe=kd();L.useEffect(()=>{n&&s&&Ct()},[n,s]);const Ct=async()=>{try{const Ge=await ug(s);Ge.logoUrl&&de(Ge.logoUrl),Ge.backgroundUrl&&He(Ge.backgroundUrl),Ge.voiceDisabled!==void 0&&Ue(Ge.voiceDisabled),Ge.accessibleToAllUsers!==void 0&&et(Ge.accessibleToAllUsers),f(Ge.name||""),v(Ge.description||""),hn(Ge)}catch(Ge){Ee.error("Error fetching space data:",Ge),Xe({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}},hn=async Ge=>{if(s&&n){Te(!0);try{const Ot=dV(),Xt=`space_${s}_owners`,pn=kX(p0(Ot,"users"),NX("groups","array-contains",Xt)),an=await IR(pn),ir=[];for(const di of an.docs){const yi=di.data(),dr=await ep(di.id);ir.push({uid:di.id,email:yi.email,displayName:yi.displayName||dr.Nickname||"Unknown User",photoURL:yi.photoURL||dr.photoURL,firstName:dr.firstName,lastName:dr.lastName})}Ce(ir);const na=`space_${s}_hosts`,Vt=kX(p0(Ot,"users"),NX("groups","array-contains",na)),sn=await IR(Vt),Ii=[];for(const di of sn.docs){const yi=di.data(),dr=await ep(di.id);Ii.push({uid:di.id,email:yi.email,displayName:yi.displayName||dr.Nickname||"Unknown User",photoURL:yi.photoURL||dr.photoURL,firstName:dr.firstName,lastName:dr.lastName})}Ne(Ii)}catch(Ot){Ee.error("Error fetching space users:",Ot),Xe({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{Te(!1)}}};L.useEffect(()=>{s&&n&&a===4&&hn()},[s,n,a]);const Ut=Ge=>{const Ot=Ge.target.files[0];if(Ot){if(!Ot.type.startsWith("image/")){Xe({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}N(Ot);const Xt=new FileReader;Xt.onloadend=()=>{j(Xt.result)},Xt.readAsDataURL(Ot)}},ln=Ge=>{const Ot=Ge.target.files[0];if(Ot){if(!Ot.type.startsWith("image/")){Xe({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}ee(Ot);const Xt=new FileReader;Xt.onloadend=()=>{J(Xt.result)},Xt.readAsDataURL(Ot)}},xn=async()=>{if(!A){Xe({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{H(!0);const Ge=setInterval(()=>{K(Xt=>{const pn=Xt+10;return pn>=90?90:pn})},300),Ot=await G5e(s,A);clearInterval(Ge),K(100),de(Ot),Xe({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{N(null),j(null),K(0),H(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:Ot}}))}catch(Ge){console.error("Error uploading logo:",Ge),Xe({title:"Upload failed",description:Ge.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),H(!1),K(0)}},Yt=async()=>{if(!ge){Xe({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{he(!0);const Ge=setInterval(()=>{le(Xt=>{const pn=Xt+10;return pn>=90?90:pn})},300),Ot=await $5e(s,ge);clearInterval(Ge),le(100),He(Ot),Xe({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{ee(null),J(null),le(0),he(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:Ot}}))}catch(Ge){console.error("Error uploading background:",Ge),Xe({title:"Upload failed",description:Ge.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),he(!1),le(0)}},Yn=async()=>{if(ne)try{H(!0),await H5e(s),de(null),Xe({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),H(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ge){console.error("Error deleting logo:",Ge),Xe({title:"Deletion failed",description:Ge.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),H(!1)}},Kt=async()=>{if(Me)try{he(!0),await K5e(s),He(null),Xe({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),he(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ge){console.error("Error deleting background:",Ge),Xe({title:"Deletion failed",description:Ge.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),he(!1)}},Re=()=>{oe.current&&oe.current.click()},Fe=()=>{rt.current&&rt.current.click()},Ke=async()=>{dt(!0);try{await q5e(s,{voiceDisabled:!Ae}),Ue(!Ae),Xe({title:"Settings Updated",description:`Voice chat has been ${Ae?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ge){Ee.error("Error updating voice settings:",Ge),Xe({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},_t=async()=>{dt(!0);try{await Y5e(s,!ze),et(!ze),Xe({title:"Settings Updated",description:`Space is now ${ze?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ge){Ee.error("Error updating accessibility settings:",Ge),Xe({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},vt=async()=>{if(s){w(!0);try{const Ge=dV(),Ot=Hi(Ge,"spaces",s);await Dl(Ot,{name:d,description:E}),Xe({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:E}}))}catch(Ge){Ee.error("Error updating space details:",Ge),Xe({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}}};return I.jsxs(Na,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[I.jsx(xa,{backdropFilter:"blur(4px)"}),I.jsxs(Da,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",h:"500px",overflow:"hidden",children:[I.jsx(Nl,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),I.jsx(sc,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),I.jsx(La,{p:0,display:"flex",children:I.jsxs(GR,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",flexGrow:1,children:[I.jsxs(HR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:Cse,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Details"})]}),I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:HS,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Logo"})]}),I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:O6e,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Background"})]}),I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:N6e,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Settings"})]}),I.jsxs(Hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Dn,{as:pJ,mb:1}),I.jsx(Et,{fontSize:"xs",children:"Users"})]})]}),I.jsxs(g1,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",children:[I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),I.jsxs(zi,{spacing:4,align:"stretch",children:[I.jsxs(Zi,{children:[I.jsx(bl,{fontSize:"xs",children:"Space Name"}),I.jsx(Ro,{value:d,onChange:Ge=>f(Ge.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),I.jsxs(Zi,{children:[I.jsx(bl,{fontSize:"xs",children:"Description"}),I.jsx(Jte,{value:E,onChange:Ge=>v(Ge.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),I.jsxs(Zi,{children:[I.jsx(bl,{fontSize:"xs",children:"Space Tags"}),I.jsx(Pt,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:s?I.jsx(Ise,{spaceID:s}):I.jsxs(ng,{status:"warning",variant:"subtle",borderRadius:"md",children:[I.jsx(rg,{}),I.jsx(zw,{fontSize:"sm",children:"Space ID missing"}),I.jsx(Gw,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),I.jsx(Ri,{colorScheme:"blue",size:"sm",onClick:vt,isLoading:T,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),I.jsx(Et,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ne||F)&&I.jsxs(io,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ne&&I.jsxs(Pt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[I.jsx(Et,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),I.jsx(Vh,{src:ne,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),I.jsx(Ri,{mt:3,colorScheme:"red",leftIcon:I.jsx(Dn,{as:tR}),onClick:Yn,isLoading:z,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),F&&I.jsxs(Pt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[I.jsx(Et,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),I.jsx(Vh,{src:F,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),I.jsxs(Zi,{children:[I.jsx(bl,{fontSize:"xs",children:"Upload New Logo"}),I.jsx(Ro,{type:"file",accept:"image/*",onChange:Ut,ref:oe,display:"none"}),z&&I.jsxs(Pt,{mt:3,mb:3,children:[I.jsxs(Et,{fontSize:"xs",mb:1,children:["Uploading... ",te,"%"]}),I.jsx(i0,{value:te,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),I.jsxs(wi,{mt:3,spacing:3,children:[I.jsx(Ri,{colorScheme:"blue",leftIcon:I.jsx(Dn,{as:HS}),onClick:Re,isDisabled:z,size:"sm",variant:"outline",children:"Browse"}),I.jsx(Ri,{colorScheme:"green",leftIcon:I.jsx(Dn,{as:vV}),onClick:xn,isLoading:z,loadingText:"Uploading...",isDisabled:!A||z,size:"sm",children:"Upload"})]}),I.jsx(SU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),I.jsx(Et,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Me||Z)&&I.jsxs(io,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Me&&I.jsxs(Pt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[I.jsx(Et,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),I.jsx(Vh,{src:Me,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),I.jsx(Ri,{mt:3,colorScheme:"red",leftIcon:I.jsx(Dn,{as:tR}),onClick:Kt,isLoading:se,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),Z&&I.jsxs(Pt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[I.jsx(Et,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),I.jsx(Vh,{src:Z,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),I.jsxs(Zi,{children:[I.jsx(bl,{fontSize:"xs",children:"Upload New Background"}),I.jsx(Ro,{type:"file",accept:"image/*",onChange:ln,ref:rt,display:"none"}),se&&I.jsxs(Pt,{mt:3,mb:3,children:[I.jsxs(Et,{fontSize:"xs",mb:1,children:["Uploading... ",pe,"%"]}),I.jsx(i0,{value:pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),I.jsxs(wi,{mt:3,spacing:3,children:[I.jsx(Ri,{colorScheme:"blue",leftIcon:I.jsx(Dn,{as:HS}),onClick:Fe,isDisabled:se,size:"sm",variant:"outline",children:"Browse"}),I.jsx(Ri,{colorScheme:"green",leftIcon:I.jsx(Dn,{as:vV}),onClick:Yt,isLoading:se,loadingText:"Uploading...",isDisabled:!ge||se,size:"sm",children:"Upload"})]}),I.jsx(SU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),I.jsx(Et,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),I.jsxs(zi,{spacing:4,align:"stretch",children:[I.jsx(Pt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:I.jsxs(wi,{justify:"space-between",align:"center",children:[I.jsxs(Pt,{children:[I.jsxs(wi,{mb:1,spacing:2,children:[I.jsxs(Pt,{position:"relative",w:"16px",h:"16px",children:[I.jsx(Dn,{as:L6e,color:Ae?"red.400":"green.400"}),Ae&&I.jsx(Pt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),I.jsx(Et,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),I.jsx(Et,{fontSize:"xs",color:"whiteAlpha.800",children:Ae?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),I.jsx(ig,{isChecked:!Ae,onChange:Ke,colorScheme:"green",size:"md",isDisabled:nt})]})}),I.jsx(Pt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:I.jsxs(wi,{justify:"space-between",align:"center",children:[I.jsxs(Pt,{children:[I.jsxs(wi,{mb:1,spacing:2,children:[I.jsx(Pt,{position:"relative",w:"16px",h:"16px",children:I.jsx(Dn,{as:pJ,color:ze?"green.400":"red.400"})}),I.jsx(Et,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),I.jsx(Et,{fontSize:"xs",color:"whiteAlpha.800",children:ze?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),I.jsx(Et,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),I.jsx(ig,{isChecked:ze,onChange:_t,colorScheme:"green",size:"md",isDisabled:nt})]})}),I.jsxs(ng,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[I.jsx(rg,{color:"blue.300"}),I.jsxs(Pt,{children:[I.jsx(zw,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),I.jsx(Gw,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),I.jsxs(Tu,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(Et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),I.jsx(Et,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),be?I.jsx(io,{justify:"center",align:"center",h:"200px",children:I.jsx(tp,{color:"blue.300"})}):I.jsxs(zi,{spacing:4,align:"stretch",children:[I.jsxs(Pt,{children:[I.jsxs(wi,{mb:2,children:[I.jsx(Dn,{as:P6e,color:"green.400"}),I.jsx(Et,{fontSize:"sm",fontWeight:"600",children:"Owners"}),I.jsx(uf,{colorScheme:"green",ml:2,children:we.length})]}),I.jsx(Pt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:we.length===0?I.jsx(Et,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):I.jsx(zi,{spacing:1,align:"stretch",children:we.map(Ge=>I.jsxs(wi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[I.jsx(wf,{size:"xs",src:Ge.photoURL,name:Ge.displayName}),I.jsxs(Pt,{children:[I.jsx(Et,{fontSize:"xs",children:Ge.displayName}),I.jsx(Et,{fontSize:"xs",color:"whiteAlpha.600",children:Ge.firstName&&Ge.lastName?`${Ge.firstName} ${Ge.lastName}`:"Full name not available"})]}),I.jsx(mk,{}),I.jsx(uf,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ge.uid))})})]}),I.jsxs(Pt,{children:[I.jsxs(wi,{mb:2,children:[I.jsx(Dn,{as:D6e,color:"purple.400"}),I.jsx(Et,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),I.jsx(uf,{colorScheme:"purple",ml:2,children:ve.length})]}),I.jsx(Pt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ve.length===0?I.jsx(Et,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):I.jsx(zi,{spacing:1,align:"stretch",children:ve.map(Ge=>I.jsxs(wi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[I.jsx(wf,{size:"xs",src:Ge.photoURL,name:Ge.displayName}),I.jsxs(Pt,{children:[I.jsx(Et,{fontSize:"xs",children:Ge.displayName}),I.jsx(Et,{fontSize:"xs",color:"whiteAlpha.600",children:Ge.firstName&&Ge.lastName?`${Ge.firstName} ${Ge.lastName}`:"Full name not available"})]}),I.jsx(mk,{}),I.jsx(uf,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ge.uid))})})]}),I.jsx(gE,{borderColor:"whiteAlpha.200"}),I.jsxs(ng,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[I.jsx(rg,{color:"blue.300",boxSize:4}),I.jsxs(Pt,{children:[I.jsx(zw,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),I.jsx(Gw,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]})]})]})})]})]})},z6e=({onTogglePlayerList:n,spaceID:t})=>{const{fullscreenRef:s}=Nd(),[a,l]=L.useState(!0),[d,f]=L.useState(!1),[E,v]=L.useState(!1),[T,w]=L.useState(!1),[A,N]=L.useState(!1),[F,j]=L.useState(!1),[z,H]=L.useState(null),[te,K]=L.useState(!1),[ne,de]=L.useState(!1),[oe,ge]=L.useState(!1),[ee,Z]=L.useState(!1),J=kd(),{user:se}=L.useContext(Ll),he=(se==null?void 0:se.Nickname)||"Unknown",[pe,le]=L.useState(!1),Me=async()=>{if(se!=null&&se.uid&&t)try{const Te=await ep(se.uid);let Ae=!1,Ue=!1;if(Te.groups){const et=`space_${t}_owners`,nt=`space_${t}_hosts`;Ae=Te.groups.includes(et),Ue=Te.groups.includes(nt)}const ze=await xie(se.uid,"disruptiveAdmin");if(Z(ze),H({rpmURL:Te.rpmURL?Te.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),de(Ae||ze),ge(Ue),!Ae&&!ze&&te){K(!1);const et=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(et),J({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(Te){console.error("Error fetching profile data:",Te),de(!1),ge(!1),Z(!1)}else de(!1),ge(!1),Z(!1)};L.useEffect(()=>{Me()},[se==null?void 0:se.uid,t,te]),L.useEffect(()=>{const Te=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",Te),()=>{window.removeEventListener("PlayerInstantiated",Te)}},[]),L.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&le(window.agoraClient.voiceDisabled)}catch(Ue){console.error("Error checking if voice is disabled:",Ue)}})();const Ae=Ue=>{Ue.detail&&typeof Ue.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Ue.detail.voiceDisabled),le(Ue.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ae),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ae)}},[]);const He=()=>v(!E),rt=()=>w(!T),we=()=>{j(!F),Ne()},Ce=()=>{N(!1),Me()},ve=Te=>{Te.stopPropagation(),typeof n=="function"&&(Ee.log("CanvasMainMenu: Toggling player list"),n())},Ne=()=>{f(!1)},be=Te=>{if(Te.stopPropagation(),!ne){J({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ae=!te;K(Ae);const Ue=new CustomEvent("editModeChanged",{detail:{enabled:Ae}});window.dispatchEvent(Ue),J({title:Ae?"Edit Mode Enabled":"Edit Mode Disabled",description:Ae?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ae?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return I.jsxs(I.Fragment,{children:[I.jsxs(a1,{isOpen:d,onClose:()=>f(!1),children:[I.jsx(c1,{as:Pa,icon:I.jsx(zBe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!d)}),I.jsx(ku,{containerRef:s,children:I.jsx(l1,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:I.jsxs(zi,{align:"stretch",spacing:4,children:[I.jsxs(wi,{children:[I.jsx(wf,{size:"md",src:z==null?void 0:z.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),I.jsxs(zi,{align:"start",spacing:0,children:[I.jsxs(wi,{children:[I.jsx(Et,{fontWeight:"bold",children:he}),ne&&!ee&&I.jsx(sg,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:I.jsx(Pt,{display:"inline-block",children:I.jsx(Dn,{as:gV,color:"green.400",boxSize:3})})}),!ne&&oe&&!ee&&I.jsx(sg,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:I.jsx(Pt,{display:"inline-block",children:I.jsx(Dn,{as:yV,color:"purple.400",boxSize:3})})}),ee&&I.jsx(sg,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:I.jsx(Pt,{display:"inline-block",children:I.jsx(Dn,{as:r6e,color:"blue.400",boxSize:3})})})]}),I.jsx(Et,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),I.jsxs(wi,{spacing:4,justify:"center",children:[I.jsx(Pa,{icon:I.jsx(s6e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ve}),ne&&I.jsx(Pa,{icon:I.jsx(XBe,{}),variant:"ghost",colorScheme:te?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:be}),I.jsx(Pa,{icon:I.jsx(Pt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),I.jsx(Pa,{icon:I.jsx(Pt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),I.jsx(gE,{borderColor:"whiteAlpha.300"}),I.jsxs(zi,{align:"stretch",spacing:2,children:[ne&&I.jsxs(wi,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:Te=>Te.stopPropagation(),justify:"space-between",children:[I.jsx(Et,{fontSize:"md",children:"Edit Mode"}),I.jsx(ig,{id:"edit-mode-toggle",isChecked:te,onChange:be,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:te?"green.500":"black"}}})]}),ne&&I.jsx(Et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:we,children:"Manage Space"}),se&&t&&!pe&&I.jsx(R6e,{onClose:Ne}),I.jsx(Et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:He,children:"Settings"}),I.jsx(Et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:rt,children:"Controls"}),I.jsx(Et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),I.jsx(Et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),T&&I.jsx(C6e,{open:T,onClose:rt}),E&&I.jsx(A6e,{open:E,onClose:He}),A&&I.jsx(yse,{open:A,onClose:Ce}),I.jsx(W6e,{isOpen:F,onClose:we})]})},G6e=({isOpen:n,onClose:t,mediaScreenId:s,onImageChange:a})=>{const{spaceID:l}=Qc(),d=Pg(),f=kd(),E=L.useRef(null),v=L.useRef(null),T=L.useRef(),[w,A]=L.useState(null),[N,F]=L.useState(""),[j,z]=L.useState(!1),[H,te]=L.useState(0),[K,ne]=L.useState(null),[de,oe]=L.useState(!0),[ge,ee]=L.useState(!1),[Z,J]=L.useState(!1),[se,he]=L.useState(0),[pe,le]=L.useState("image"),[Me,He]=L.useState(""),[rt,we]=L.useState(!1);L.useEffect(()=>{(async()=>{if(n&&s&&l){oe(!0);try{const Ct=await ff(l,s);if(Ct&&(Ct.imageUrl||Ct.videoUrl)){ne(Ct);const hn=Ct.mediaType==="video";le(hn?"video":"image"),we(Ct.displayAsVideo||!1),hn&&Ct.videoUrl&&(He(Ct.videoUrl),he(1))}else ne(null)}catch(Ct){Ee.error("Error fetching existing image:",Ct),ne(null)}finally{oe(!1)}}})()},[n,s,l]),L.useEffect(()=>{n||(A(null),F(""),te(0),He(""))},[n]);const Ce=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation(),J(!0)},[]),ve=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation(),J(!1)},[]),Ne=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation()},[]),be=L.useCallback(Xe=>{if(Xe.preventDefault(),Xe.stopPropagation(),J(!1),Xe.dataTransfer.files&&Xe.dataTransfer.files.length>0){const Ct=Xe.dataTransfer.files[0];Te(Ct)}},[]);L.useEffect(()=>{const Xe=v.current;if(Xe)return Xe.addEventListener("dragenter",Ce),Xe.addEventListener("dragleave",ve),Xe.addEventListener("dragover",Ne),Xe.addEventListener("drop",be),()=>{Xe.removeEventListener("dragenter",Ce),Xe.removeEventListener("dragleave",ve),Xe.removeEventListener("dragover",Ne),Xe.removeEventListener("drop",be)}},[Ce,ve,Ne,be]);const Te=Xe=>{if(!Xe)return;if(!Xe.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}A(Xe);const Ct=new FileReader;Ct.onloadend=()=>{F(Ct.result)},Ct.readAsDataURL(Xe)},Ae=Xe=>{const Ct=Xe.target.files[0];Te(Ct)},Ue=async Xe=>{const Ct=Xe.target.checked;if(we(Ct),K)try{await fBe(l,s,Ct),Ct?d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),ne({...K,displayAsVideo:Ct}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${Ct?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),Ee.log(`Updated display mode for media screen ${s} to ${Ct?"video":"image"}`),a&&a({type:"update",mediaScreenId:s,displayAsVideo:Ct})}catch(hn){Ee.error("Error updating display mode:",hn),f({title:"Update failed",description:hn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),we(!Ct)}},ze=async()=>{if(pe==="image"&&!w){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(pe==="video"&&!Me){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{z(!0);const Xe=setInterval(()=>{te(ln=>{const xn=ln+10;return xn>=90?90:xn})},300);let Ct;pe==="image"?Ct=await QX(l,s,w,{mediaType:pe,displayAsVideo:rt}):(Ct=Me,await QX(l,s,null,{mediaType:"video",directUrl:Me,displayAsVideo:rt})),clearInterval(Xe),te(100);let hn=null,Ut=null;pe==="image"?(hn=rt?null:Ct,Ut=(K==null?void 0:K.videoUrl)||null):(hn=!rt&&(K!=null&&K.imageUrl)?K.imageUrl:null,Ut=Ct),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:hn,videoUrl:Ut,mediaType:pe,displayAsVideo:rt}),Ee.log(`Uploaded and sent ${pe} for media screen ${s} (display as video: ${rt})`),a&&a({type:"upload",mediaScreenId:s,imageUrl:pe==="image"?Ct:K==null?void 0:K.imageUrl,videoUrl:pe==="video"?Ct:K==null?void 0:K.videoUrl,mediaType:pe,displayAsVideo:rt}),f({title:"Upload successful",description:`The ${pe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{A(null),F(""),z(!1),te(0),t()},1e3)}catch(Xe){Ee.error(`Error uploading ${pe}:`,Xe),f({title:"Upload failed",description:Xe.message||`An error occurred while uploading the ${pe}`,status:"error",duration:5e3,isClosable:!0}),z(!1),te(0)}},et=async()=>{ee(!1);try{z(!0),await pBe(l,s),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:pe==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:pe==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),Ee.log(`Deleted ${pe} for media screen ${s}`),a&&a({type:"delete",mediaScreenId:s}),f({title:`${pe==="image"?"Image":"Video"} deleted`,description:`The ${pe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ne(null),z(!1),He(""),we(!1),setTimeout(()=>{t()},500)}catch(Xe){Ee.error(`Error deleting ${pe}:`,Xe),f({title:"Deletion failed",description:Xe.message||`An error occurred while deleting the ${pe}`,status:"error",duration:5e3,isClosable:!0}),z(!1)}},nt=()=>{j||(A(null),F(""),te(0),t())},dt=Xe=>{he(Xe),le(Xe===0?"image":"video")};return I.jsxs(I.Fragment,{children:[I.jsxs(Na,{isOpen:n,onClose:nt,size:"xl",children:[I.jsx(xa,{backdropFilter:"blur(10px)"}),I.jsxs(Da,{bg:"gray.800",color:"white",maxW:"900px",children:[I.jsx(Nl,{children:"Media Screen Content"}),I.jsx(sc,{isDisabled:j}),I.jsxs(Pt,{px:6,pb:2,children:[I.jsxs(io,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[I.jsxs(wi,{spacing:4,children:[I.jsx(Et,{fontWeight:"medium",children:"Display as:"}),I.jsxs(wi,{spacing:2,children:[I.jsx(Dn,{as:HS,color:rt?"gray.400":"green.300"}),I.jsx(ig,{colorScheme:"purple",size:"md",isChecked:rt,onChange:Ue}),I.jsx(Dn,{as:yO,color:rt?"purple.300":"gray.400"})]})]}),I.jsx(uf,{colorScheme:rt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:rt?"Video Output":"Image Output"})]}),I.jsxs(Et,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",I.jsx("strong",{children:s})]}),I.jsx(Et,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),I.jsx(gE,{mb:4})]}),I.jsx(La,{children:I.jsxs(io,{children:[I.jsx(GR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:se,onChange:dt,h:"100%",minW:"120px",mr:4,children:I.jsxs(HR,{children:[I.jsxs(Hc,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[I.jsx(Dn,{as:HS,mr:2})," Image"]}),I.jsxs(Hc,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[I.jsx(Dn,{as:yO,mr:2})," Video"]})]})}),I.jsx(Pt,{flex:"1",children:de?I.jsx(io,{justify:"center",align:"center",h:"150px",children:I.jsx(tp,{size:"xl",color:"blue.400"})}):I.jsxs(I.Fragment,{children:[I.jsx(Pt,{children:se===0?I.jsxs(zi,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&pe==="image"&&I.jsxs(Pt,{children:[I.jsx(Et,{fontWeight:"semibold",mb:2,children:"Current Image:"}),I.jsxs(io,{children:[I.jsx(Pt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:I.jsx(Vh,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),I.jsxs(zi,{align:"flex-start",spacing:2,children:[I.jsxs(Et,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),I.jsxs(Et,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),I.jsx(Ri,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:I.jsx(Dn,{as:tR}),onClick:()=>ee(!0),isDisabled:j,children:"Delete"})]})]}),I.jsx(gE,{my:4})]}),I.jsx(Et,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&pe==="image"?"Replace with new image:":"Upload new image:"}),I.jsxs(Pt,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Z?"blue.400":"gray.500",bg:Z?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>E.current.click(),children:[N?I.jsx(Pt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:I.jsx(Vh,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):I.jsxs(zi,{spacing:2,children:[I.jsx(Dn,{as:vV,boxSize:"24px",color:"gray.400"}),I.jsx(Et,{children:"Drag and drop an image here, or click to browse"}),I.jsx(Et,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),I.jsx(Ro,{type:"file",accept:"image/*",onChange:Ae,ref:E,display:"none"})]}),w&&I.jsxs(Et,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):I.jsxs(zi,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&pe==="video"&&I.jsxs(Pt,{children:[I.jsx(Et,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),I.jsxs(io,{children:[I.jsx(Pt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:I.jsx(Et,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),I.jsxs(zi,{align:"flex-start",spacing:2,children:[I.jsxs(Et,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),I.jsxs(Et,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),I.jsx(Ri,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:I.jsx(Dn,{as:tR}),onClick:()=>ee(!0),isDisabled:j,children:"Delete"})]})]}),I.jsx(gE,{my:4})]}),I.jsx(Et,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&pe==="video"?"Replace with new video:":"Add video URL:"}),I.jsx(Pt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:I.jsxs(wi,{children:[I.jsx(Dn,{as:Cse,color:"blue.300"}),I.jsx(Et,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),I.jsxs(Zi,{children:[I.jsx(bl,{fontSize:"sm",children:"Video URL"}),I.jsx(Ro,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Me,onChange:Xe=>He(Xe.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),I.jsx(Et,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),I.jsxs(Pt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[I.jsxs(wi,{children:[I.jsx(Dn,{as:yO,color:"blue.300"}),I.jsx(Et,{fontWeight:"medium",children:"Video Support"})]}),I.jsx(Et,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),I.jsx(Et,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Me&&I.jsxs(Pt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[I.jsxs(wi,{mb:2,children:[I.jsx(Dn,{as:k6e,color:"blue.300"}),I.jsx(Et,{fontWeight:"medium",children:"URL Preview"})]}),I.jsx(Et,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Me}),I.jsx(Et,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),j&&I.jsxs(Pt,{mt:4,children:[I.jsxs(Et,{mb:2,children:["Uploading: ",H,"%"]}),I.jsx(i0,{value:H,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),I.jsxs(mg,{children:[I.jsx(Ri,{variant:"ghost",mr:3,onClick:nt,isDisabled:j,children:"Cancel"}),I.jsx(Ri,{colorScheme:"blue",onClick:ze,isLoading:j,loadingText:"Uploading",isDisabled:pe==="image"&&!w||pe==="video"&&!Me||j||de,leftIcon:I.jsx(Dn,{as:pe==="image"?HS:yO}),size:"lg",px:6,children:pe==="image"?"Upload Image":"Save Video URL"})]})]})]}),I.jsx(yxe,{isOpen:ge,leastDestructiveRef:T,onClose:()=>ee(!1),children:I.jsx(xa,{children:I.jsxs(vxe,{bg:"gray.800",color:"white",children:[I.jsxs(Nl,{fontSize:"lg",fontWeight:"bold",children:["Delete ",pe==="video"?"Video":"Image"]}),I.jsxs(La,{children:["Are you sure you want to delete this ",pe,"? This will revert the media screen to its blank state."]}),I.jsxs(mg,{children:[I.jsx(Ri,{ref:T,onClick:()=>ee(!1),children:"Cancel"}),I.jsx(Ri,{colorScheme:"red",onClick:et,ml:3,leftIcon:I.jsx(Dn,{as:tR}),children:"Delete"})]})]})})})]})},H6e=n=>{const[t,s]=L.useState(null),[a,l]=L.useState(""),[d,f]=L.useState(null),[E,v]=L.useState(!1),T=Lf(),{spaceID:w}=Qc(),A=L.useCallback(j=>{var z,H;try{if(!j)return null;if(j.includes("youtube.com")||j.includes("youtu.be")){let te="";return j.includes("youtube.com/watch")?te=new URLSearchParams(new URL(j).search).get("v"):j.includes("youtu.be/")&&(te=j.split("youtu.be/")[1].split("?")[0]),te?`https://www.youtube.com/embed/${te}?autoplay=1`:j}if(j.includes("vimeo.com")){if(j.includes("player.vimeo.com/video"))return j;const te=(H=(z=j.split("vimeo.com/")[1])==null?void 0:z.split("?")[0])==null?void 0:H.split("/")[0];return te?`https://player.vimeo.com/video/${te}?autoplay=1`:j}return j}catch(te){return Ee.error("Error converting to embed URL:",te),j}},[]),N=L.useCallback(()=>{setTimeout(()=>{v(!1),Ee.log("Video processing state reset")},100)},[]);L.useEffect(()=>{let j=!0,z=null;const te=T("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:ne,videoUrl:de}=K||{};if(!ne){Ee.error("Media screen ID is missing in Unity event data."),N();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ne}, setting ID but not playing video`),Ee.log("Edit mode is active, setting media screen ID but not playing video"),f(ne);return}if(v(!0),z=setTimeout(()=>{j&&(Ee.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),de){if(console.log(`Using direct video URL from event: ${de}`),j)try{const oe=A(de);console.log(`Setting video URL to: ${oe} (original: ${de})`),s(oe),l(`Media Screen ${ne}`),f(ne),Ee.log("Media screen video URL set directly from event:",oe)}catch(oe){Ee.error("Error setting video URL from direct URL:",oe)}finally{N(),clearTimeout(z)}return}console.log(`Fetching media screen data for ID: ${ne}`);try{const oe=await ff(w,ne);if(console.log("Media screen data from Firestore:",oe),!oe||!oe.videoUrl){Ee.error("No video URL found for media screen:",ne),N(),clearTimeout(z);return}if(!oe.displayAsVideo){Ee.log("Media screen is not set to display as video:",ne),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(z);return}if(j)try{const ge=A(oe.videoUrl);console.log(`Setting video URL to: ${ge} (original: ${oe.videoUrl})`),s(ge),l(oe.title||`Media Screen ${ne}`),f(ne),Ee.log("Media screen video URL set to:",ge)}catch(ge){Ee.error("Error setting video URL from Firestore:",ge)}finally{N(),clearTimeout(z)}}catch(oe){Ee.error(`Error fetching media screen data for ${ne}:`,oe),N(),clearTimeout(z)}}catch(ne){Ee.error("Error handling media screen video play:",ne),console.error("Error handling media screen video play:",ne),N(),clearTimeout(z)}});return()=>{j=!1,z&&clearTimeout(z),te()}},[T,w,n,A,N]);const F=L.useCallback(()=>{s(null),l(""),f(null),v(!1),Ee.log("Video player state reset")},[]);return[t,a,d,F,E]},$6e=()=>{const{spaceID:n}=Qc(),t=Pg(),s=Lf(),[a,l]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Ee.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const T=()=>{Ee.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",T),()=>{window.removeEventListener("PlayerInstantiated",T)}},[]);const d=L.useCallback(async T=>{try{return T.includes("vimeo.com")?await f(T):T.includes("youtube.com")||T.includes("youtu.be")?await E(T):"https://via.placeholder.com/640x360?text=Video"}catch(w){return Ee.error(`Error fetching thumbnail for ${T}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async T=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(T)}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${A.statusText}`);const N=await A.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let z=null;for(let H of j){const te=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(te,{method:"HEAD"})).ok){z=te;break}}catch(K){Ee.warn(`Failed to validate thumbnail URL: ${te}`,K)}}return z||N.thumbnail_url}catch(w){return Ee.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},E=async T=>{let w="";if(T.includes("youtube.com/watch")?w=new URLSearchParams(new URL(T).search).get("v"):T.includes("youtu.be/")&&(w=T.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const A=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(A,{method:"HEAD"})).ok)return A}catch(N){Ee.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,N)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=L.useCallback(async T=>{try{if(!n||!T)return;Ee.log(`Refreshing thumbnail for media screen ${T}`);const w=await ff(n,T);if(!w){Ee.log(`No media screen found with ID ${T}`);return}if(Ee.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){Ee.log(`Media screen ${T} is not set to display as video or has no video URL`);return}const A=await d(w.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:T,thumbnailUrl:A}),Ee.log(`Sent refreshed thumbnail for media screen ${T}: ${A}`)}catch(w){Ee.error(`Error refreshing thumbnail for media screen ${T}:`,w)}},[n,d,t]);L.useEffect(()=>{if(!a){Ee.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}Ee.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=s("SetMediaScreenThumbnail",async A=>{try{const{mediaScreenId:N,thumbnailUrl:F}=A;F==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{w()}},[s,v,a]),L.useEffect(()=>{if(!a){Ee.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}Ee.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const T=async()=>{try{if(!n)throw new Error("spaceID is not defined.");Ee.log("Fetching media screens for thumbnails...");const A=await t4(n);Ee.log("All media screens:",A);const N=A.filter(z=>z.displayAsVideo&&z.videoUrl);if(Ee.log("Media screens set to display as videos:",N),N.length===0){Ee.log("No media screens set to display as videos found.");return}Ee.log(`Found ${N.length} media screens set to display as videos.`);const F=N.map(async z=>{try{const H=await d(z.videoUrl);return Ee.log(`Fetched thumbnail for ${z.id}: ${H}`),{mediaScreenId:z.id,thumbnailUrl:H}}catch(H){return Ee.error(`Error processing thumbnail for media screen ${z.id}:`,H),{mediaScreenId:z.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),j=await Promise.all(F);Ee.log("Fetched Media Screen Thumbnails",j),j.forEach(({mediaScreenId:z,thumbnailUrl:H})=>{t("SetMediaScreenThumbnail",{mediaScreenId:z,thumbnailUrl:H}),Ee.log(`Sent thumbnail to Unity for media screen ${z}: ${H}`)})}catch(A){Ee.error("Error fetching media screen thumbnails:",A)}};T();const w=setInterval(T,5*60*1e3);return()=>{clearInterval(w)}},[t,n,d,a])},fJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},K6e=()=>I.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),q6e=({videoUrl:n,videoTitle:t,mediaScreenId:s,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Nd();return z1(a,`video-modal-${s}`),L.useEffect(()=>{if(a){const f=T=>{T.target.classList&&T.target.classList.contains("chakra-modal__overlay")&&(T.stopPropagation(),T.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const E=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(E&&(E.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(T){console.error("Error disabling Unity input:",T)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),E&&(E.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(T){console.error("Error re-enabling Unity input:",T)}}}},[a]),I.jsxs(I.Fragment,{children:[I.jsx(K6e,{}),I.jsxs(Na,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${s}`,children:[I.jsx(xa,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),I.jsxs(Da,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[I.jsx(sc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),I.jsx(La,{p:0,width:"100%",children:n?I.jsx(Pt,{className:"iframe-container",style:fJ.iframeContainer,children:I.jsx("iframe",{className:"video-iframe",src:n,style:fJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):I.jsxs(io,{direction:"column",align:"center",justify:"center",h:"400px",children:[I.jsx(tp,{size:"xl",mb:4}),I.jsx(Et,{children:"Unable to load video"}),I.jsx(Et,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Ns=(...n)=>{},Y6e=()=>{const{isOpen:n,onOpen:t,onClose:s}=Sf(),[a,l]=L.useState(null),[d,f]=L.useState("image"),E=L.useRef(null);z1(n,"image-viewer-modal");const v=L.useCallback(A=>{A.stopPropagation()},[]);return L.useEffect(()=>{if(n&&E.current){const A=E.current;A.addEventListener("mousemove",v),A.addEventListener("mousedown",v),A.addEventListener("mouseup",v),A.addEventListener("wheel",v);const N=document.getElementById("unity-canvas");return N&&(N.style.pointerEvents="none"),()=>{A.removeEventListener("mousemove",v),A.removeEventListener("mousedown",v),A.removeEventListener("mouseup",v),A.removeEventListener("wheel",v),N&&(N.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(A,N="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${A} and original media type: ${N}`);const F=typeof A=="string"&&(A.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||A.includes("firebasestorage")&&!A.includes("video")),j=F?"image":N;console.log(`[DEBUG] Detected URL as ${F?"image":"non-image"}, using media type: ${j}`),l(A),f(j),t()},closeImageViewer:()=>{s(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:E,preventPropagation:v}},X6e=()=>I.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),V2=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),Ns(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},J6e=()=>{const{spaceID:n}=Qc(),[t,s]=L.useState(!1),[a,l]=L.useState([]),[d,f]=L.useState(null),{isOpen:E,onOpen:v,onClose:T}=Sf(),[w,A]=L.useState({}),[N,F]=L.useState(0);L.useRef(null);const j=Pg(),{fullscreenRef:z}=Nd(),H=Lf(),[te,K]=L.useState(!1),{isOpen:ne,currentImageUrl:de,currentMediaType:oe,openImageViewer:ge,closeImageViewer:ee,modalContentRef:Z,preventPropagation:J}=Y6e(),[se,he,pe,le,Me]=H6e(t),{isOpen:He,onOpen:rt,onClose:we}=Sf();$6e(),ise(),L.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const Te=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",Te),()=>{window.removeEventListener("PlayerInstantiated",Te)}},[]);const Ce=L.useCallback(Te=>{if(Array.isArray(a)&&a.length>0){const Ae=a.find(Ue=>Ue.mediaScreenId===Te);if(Ae){const Ue=Ae.imageUrl,ze=Ae.videoUrl;return{screen:Ae,imageUrl:Ue,videoUrl:ze,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(de){let Ae=null;return Array.isArray(a)&&(Ae=a.find(Ue=>Ue.mediaScreenId===Te)),{screen:Ae||{mediaScreenId:Te},imageUrl:de,videoUrl:null,mediaType:(Ae==null?void 0:Ae.mediaType)||"image",displayAsVideo:(Ae==null?void 0:Ae.displayAsVideo)||!1}}return n&&Te&&ff(n,Te).then(Ae=>{Ae&&l(Ue=>Array.isArray(Ue)&&Ue.some(et=>et.mediaScreenId===Te)?Ue.map(et=>et.mediaScreenId===Te?{...et,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:et):[...Array.isArray(Ue)?Ue:[],{mediaScreenId:Te,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ae=>{console.error(`Error fetching media screen data for ${Te}:`,Ae)}),console.warn("No screen data found for:",Te),null},[a,de,n,l]),ve=L.useCallback(Te=>{if(console.log(`[DEBUG] Processing click on screen: ${Te}, isEditMode: ${t}`),f(Te),t)console.log(`[DEBUG] Opening upload modal for screen: ${Te} in edit mode`),v();else{const Ae=Ce(Te);if(Ae){if(console.log(`[DEBUG] Screen data for ${Te}:`,Ae),Ns("Screen data details:",{mediaScreenId:Te,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType,displayAsVideo:Ae.displayAsVideo}),He&&pe===Te)return;if(Ae.displayAsVideo&&Ae.videoUrl)Ns(`Opening video player for: ${Ae.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Te,videoUrl:Ae.videoUrl});else if(Ae.imageUrl){Ns(`Opening viewer modal with ${Ae.mediaType}: ${Ae.imageUrl}`);const ze=V2(Ae.imageUrl);ge(ze,Ae.mediaType||"image")}else n&&ff(n,Te).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)Ns(`Opening video player for: ${ze.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Te,videoUrl:ze.videoUrl});else if(ze.imageUrl){Ns(`Opening viewer modal with image: ${ze.imageUrl}`);const et=V2(ze.imageUrl);ge(et,ze.mediaType||"image")}l(et=>Array.isArray(et)&&et.some(dt=>dt.mediaScreenId===Te)?et.map(dt=>dt.mediaScreenId===Te?{...dt,...ze,mediaScreenId:Te,source:"firestore-click",lastUpdated:new Date().toISOString()}:dt):[...Array.isArray(et)?et:[],{...ze,mediaScreenId:Te,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${Te}:`,ze)})}else n&&ff(n,Te).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)Ns(`Opening video player for: ${Ue.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Te,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){Ns(`Opening viewer modal with image: ${Ue.imageUrl}`);const ze=V2(Ue.imageUrl);ge(ze,Ue.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(nt=>nt.mediaScreenId===Te)?ze.map(nt=>nt.mediaScreenId===Te?{...nt,...Ue,mediaScreenId:Te,source:"firestore-click",lastUpdated:new Date().toISOString()}:nt):[...Array.isArray(ze)?ze:[],{...Ue,mediaScreenId:Te,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${Te}:`,Ue)})}},[t,v,Ce,He,pe,j,ge,n]);L.useEffect(()=>{if(!te)return;const Te=async()=>{if(n)try{const Ue=await t4(n),ze={};Ue.forEach(et=>{et.id&&et.imageUrl&&(ze[et.id]=et.imageUrl)}),l(et=>et.map(nt=>{const dt=!!ze[nt.mediaScreenId],Xe=ze[nt.mediaScreenId],Ct=nt.mediaType||"image";return{...nt,hasImage:dt,imageUrl:Xe,mediaType:Ct}}))}catch(Ue){console.error("Error fetching media screen images:",Ue)}};Te();let Ae=null;return t&&(Ae=setInterval(Te,5e3)),()=>{Ae&&clearInterval(Ae)}},[n,t,N,te]);const Ne=Te=>{l(Ae=>Ae.map(Ue=>{if(Ue.mediaScreenId===Te.mediaScreenId){if(Te.type==="upload")return{...Ue,hasImage:!0,imageUrl:Te.imageUrl,mediaType:Te.mediaType||"image"};if(Te.type==="delete")return{...Ue,hasImage:!1,imageUrl:null,mediaType:null}}return Ue})),Te.type==="delete"?(setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==Te.mediaScreenId))},100),setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==Te.mediaScreenId))},1500)):setTimeout(()=>{l(Ae=>Ae.some(ze=>ze.mediaScreenId===Te.mediaScreenId)?Ae.map(ze=>ze.mediaScreenId===Te.mediaScreenId?{...ze,imageUrl:Te.imageUrl,hasImage:!0,mediaType:Te.mediaType||"image"}:ze):[...Ae,{mediaScreenId:Te.mediaScreenId,imageUrl:Te.imageUrl,hasImage:!0,mediaType:Te.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};L.useEffect(()=>{const Te=Ae=>{const Ue=Ae.detail.enabled;s(Ue),Ue?j("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):j("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",Te),()=>{window.removeEventListener("editModeChanged",Te)}},[j]),L.useEffect(()=>(window.JsSendMediaScreenClick=function(Te){console.log("Unity: MediaScreenClick received with data:",Te);try{const Ae=JSON.parse(Te),Ue=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ae)});window.dispatchEvent(Ue)}catch(Ae){console.error("Error processing MediaScreenClick data:",Ae)}},window.handleMediaScreenClick=function(Te){console.log("Direct call to handleMediaScreenClick with ID:",Te),ve(Te)},window.TestJavaScriptFromUnity=function(Te){console.log("Unity called TestJavaScriptFromUnity with:",Te),alert("Unity called JavaScript: "+Te)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ve]),L.useEffect(()=>{const Te=ze=>{try{const et=JSON.parse(ze.detail);Ee.log(`MediaScreen registered: ${et.mediaScreenId}`),Ns("MediaScreen registered from Unity:",et),l(dt=>dt.some(Ct=>Ct.mediaScreenId===et.mediaScreenId)?dt.map(Ct=>Ct.mediaScreenId===et.mediaScreenId?{...Ct,...et,source:"event",lastUpdated:new Date().toISOString()}:Ct):[...dt,{...et,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:et.mediaScreenId,enabled:!0,showUploadIcon:!0});const nt=et.mediaScreenId;nt&&ff(n,nt).then(dt=>{dt&&(Ns(`Media screen data for ${nt}:`,dt),dt.displayAsVideo&&dt.videoUrl&&(Ns(`Media screen ${nt} should display as video, sending null imageUrl`),j("SetMediaScreenImage",{mediaScreenId:nt,imageUrl:null,displayAsVideo:!0})))}).catch(dt=>{console.error(`Error fetching media screen data for ${nt}:`,dt)})}catch(et){console.error("Error handling MediaScreen registration:",et)}},Ae=ze=>{try{Ns("MediaScreenClick event received:",ze);let et;if(typeof ze=="string")et=ze,Ns("MediaScreenClick: Direct call with ID:",et);else{Ns("MediaScreenClick: Event from Unity:",ze),Ns("MediaScreenClick: Event detail:",ze.detail);try{et=JSON.parse(ze.detail).mediaScreenId,Ns("MediaScreenClick: Parsed mediaScreenId:",et)}catch(nt){if(console.error("MediaScreenClick: Error parsing event detail:",nt),ze.detail&&ze.detail.mediaScreenId)et=ze.detail.mediaScreenId,Ns("MediaScreenClick: Using direct mediaScreenId from detail:",et);else throw new Error("Could not extract mediaScreenId from event")}}Ee.log(`MediaScreen clicked: ${et}`),Ns("MediaScreen clicked:",et),ve(et)}catch(et){console.error("Error handling MediaScreen click:",et)}},Ue=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")Te({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Ae({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const et=JSON.parse(ze.detail.eventData);et.mediaScreenId&&(Ns("SetMediaScreenImage event received:",et),l(nt=>Array.isArray(nt)&&nt.some(Xe=>Xe.mediaScreenId===et.mediaScreenId)?nt.map(Xe=>Xe.mediaScreenId===et.mediaScreenId?{...Xe,imageUrl:et.imageUrl,hasImage:!!et.imageUrl,displayAsVideo:et.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Xe):[...Array.isArray(nt)?nt:[],{mediaScreenId:et.mediaScreenId,imageUrl:et.imageUrl,hasImage:!!et.imageUrl,displayAsVideo:et.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(et){console.error("Error handling SetMediaScreenImage event:",et)}};return window.addEventListener("RegisterMediaScreen",Te),window.addEventListener("MediaScreenClick",Ae),window.addEventListener("reactUnityEvent",Ue),()=>{window.removeEventListener("RegisterMediaScreen",Te),window.removeEventListener("MediaScreenClick",Ae),window.removeEventListener("reactUnityEvent",Ue)}},[t,v,j,a,ne,He,ge,ve,n]),L.useEffect(()=>{const Te=Ae=>{try{Ns("Direct MediaScreenClick event received:",Ae);let Ue;if(Ae.detail)try{Ue=JSON.parse(Ae.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!Ue){console.error("No mediaScreenId found in MediaScreenClick event");return}Ns(`Direct handler: Processing click for media screen ${Ue}`),ve(Ue)}catch(Ue){console.error("Error in direct MediaScreenClick handler:",Ue)}};return window.addEventListener("MediaScreenClick",Te),()=>{window.removeEventListener("MediaScreenClick",Te)}},[ve]),L.useEffect(()=>{se&&rt()},[se,rt]);const be=()=>{le(),we()};return L.useEffect(()=>{const Ae=H("RegisterMediaScreen",Ue=>{try{if(Ee.log("Direct RegisterMediaScreen event received with data:",Ue),!Ue||!Ue.mediaScreenId){Ee.warn("RegisterMediaScreen event received with invalid data");return}const ze=Ue.mediaScreenId;Ee.log(`Media screen registered directly: ${ze}`),l(et=>et.some(dt=>dt.mediaScreenId===ze)?et.map(dt=>dt.mediaScreenId===ze?{...dt,...Ue,source:"direct-event",lastUpdated:new Date().toISOString()}:dt):[...et,{...Ue,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Ae()}},[H,t,j]),L.useEffect(()=>{const Ae=H("MediaScreenClick",Ue=>{try{if(Ee.log("Direct MediaScreenClick event received with data:",Ue),!Ue||!Ue.mediaScreenId){Ee.warn("MediaScreenClick event received with invalid data");return}const ze=Ue.mediaScreenId;Ee.log(`Media screen clicked directly: ${ze}`),ve(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Ae()}},[H,ve]),L.useEffect(()=>{t&&pe&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${pe}`),f(pe),v(),le())},[t,pe,v,le]),I.jsxs(I.Fragment,{children:[I.jsx(G6e,{isOpen:E,onClose:T,mediaScreenId:d,onImageChange:Ne}),I.jsx(X6e,{}),I.jsx(ku,{containerRef:z,children:I.jsxs(Na,{isOpen:ne,onClose:ee,size:"lg",isCentered:!0,portalProps:{containerRef:z},id:"image-viewer-modal",blockScrollOnMount:!0,children:[I.jsx(xa,{bg:"rgba(0, 0, 0, 0.8)",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J}),I.jsxs(Da,{ref:Z,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:[I.jsx(sc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),I.jsx(La,{p:0,width:"100%",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:de?I.jsx(Pt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:oe==="image"?I.jsx(Vh,{src:de,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",de),onError:Te=>console.error("Error loading image:",Te,de),onClick:J}):I.jsxs(Pt,{width:"100%",textAlign:"center",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:[I.jsx(Et,{mb:4,fontSize:"lg",children:"Video URL:"}),I.jsx(Et,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:de}),I.jsx(Et,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):I.jsx(io,{direction:"column",align:"center",justify:"center",h:"400px",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:I.jsx(Et,{children:"No image available"})})})]})]})}),I.jsx(q6e,{videoUrl:se,videoTitle:he,mediaScreenId:pe,isOpen:He,onClose:be})]})},Ase=({backgroundUrl:n=null,containerRef:t})=>{const[s,a]=L.useState(!1),[l,d]=L.useState(n),f=L.useRef(null),E=L.useRef(null);return L.useEffect(()=>{const v=T=>{const{backgroundUrl:w}=T.detail;d(w),f.current&&(w?(f.current.style.backgroundImage=`url('${w}')`,f.current.style.display="block",E.current&&(E.current.style.display="block")):(f.current.style.display="none",E.current&&(E.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),L.useEffect(()=>{d(n),f.current&&n!==l&&(f.current.style.backgroundImage=`url('${n}')`)},[n]),L.useEffect(()=>{if(!t||!t.current)return;const v=document.createElement("div");f.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const T=document.createElement("div");E.current=T,Object.assign(T.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),t.current.appendChild(v),t.current.appendChild(T);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",T.style.opacity="0",setTimeout(()=>{t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(T)&&t.current.removeChild(T)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Id.subscribe(Cd.playerInstantiated,w);const A=()=>w();window.addEventListener("PlayerInstantiated",A);const N=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Id.unsubscribe(Cd.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",A),clearTimeout(N),t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(T)&&t.current.removeChild(T)}}},[l,t]),null};Ase.propTypes={backgroundUrl:kr.string,containerRef:kr.shape({current:kr.instanceOf(Element)})};const Pse=({containerRef:n})=>{const{spaceID:t}=Qc(),[s,a]=L.useState(!1),[l,d]=L.useState(!1),[f,E]=L.useState(0),[v,T]=L.useState("Initialising World"),[w,A]=L.useState(null),N=L.useRef(null),F=L.useRef(null),j=L.useRef(null),z=L.useRef(null);L.useEffect(()=>(Ee.log("PersistentLoader: Component mounted with spaceID:",t),Ee.log("PersistentLoader: Container ref:",n),()=>{Ee.log("PersistentLoader: Component unmounting")}),[]);const{error:H}=Qc(),[te,K]=L.useState(!1);return L.useEffect(()=>{H&&(Ee.error("PersistentLoader: Unity error detected:",H),K(!0),setTimeout(()=>{if(N.current){const ne=N.current.querySelector("div:first-child");ne&&(ne.textContent="Reconnecting...")}},3e3))},[H]),L.useEffect(()=>{(async()=>{if(t){Ee.log(`PersistentLoader: Fetching logo for space ${t}`);try{const de=await ug(t);de&&de.logoUrl?(Ee.log(`PersistentLoader: Found logo URL: ${de.logoUrl}`),A(de.logoUrl)):Ee.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(de){Ee.error("PersistentLoader: Error fetching space logo:",de)}}else Ee.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),L.useEffect(()=>{const ne=de=>{const{logoUrl:oe}=de.detail;Ee.log(`PersistentLoader: Logo update event received with URL: ${oe}`),A(oe),F.current?oe?(Ee.log("PersistentLoader: Updating logo element with new URL"),F.current.src=oe,j.current.style.display="flex"):(Ee.log("PersistentLoader: Hiding logo element (no URL)"),j.current.style.display="none"):Ee.warn("PersistentLoader: Logo ref is null during update")};return Ee.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",ne),()=>{Ee.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",ne)}},[]),L.useEffect(()=>{if(!n||!n.current){Ee.error("PersistentLoader: Container ref is null or has no current property");return}Ee.log("PersistentLoader: Creating loader elements");const ne=document.createElement("div");if(N.current=ne,Object.assign(ne.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){Ee.log(`PersistentLoader: Creating logo element with URL: ${w}`);const He=document.createElement("div");j.current=He,Object.assign(He.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const rt=document.createElement("img");F.current=rt,rt.src=w,rt.alt="Space Logo",rt.style.maxHeight="100px",rt.style.maxWidth="100%",rt.style.objectFit="contain",rt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",He.appendChild(rt),n.current.appendChild(He),Ee.log("PersistentLoader: Logo container added to main container")}else Ee.log("PersistentLoader: No logo URL available, skipping logo creation");const de=document.createElement("style");de.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(de),Ee.log("PersistentLoader: Animation styles added to document head");const oe=document.createElement("div");oe.style.fontSize="16px",oe.style.fontWeight="bold",oe.style.textAlign="center",oe.style.marginBottom="16px",oe.style.color="#ffffff",oe.textContent="Initialising World";const ge=document.createElement("div");ge.style.width="100%",ge.style.height="12px",ge.style.backgroundColor="rgba(255, 255, 255, 0.2)",ge.style.borderRadius="6px",ge.style.overflow="hidden",ge.style.position="relative",ge.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const ee=document.createElement("div");ee.style.height="100%",ee.style.width="0%",ee.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",ee.style.backgroundSize="200% 200%",ee.style.animation="progress-glow 2s ease infinite",ee.style.transition="width 0.5s ease-out",ee.style.borderRadius="6px",ee.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",ge.appendChild(ee);const Z=document.createElement("div");Z.style.marginTop="8px",Z.style.fontSize="14px",Z.style.fontWeight="bold",Z.style.color="#ffffff",Z.textContent="0%",ne.appendChild(oe),ne.appendChild(ge),ne.appendChild(Z),n.current.appendChild(ne),Ee.log("PersistentLoader: Loader element added to container");const J=He=>{E(He),ee.style.width=`${Math.round(He*100)}%`,Z.textContent=`${Math.round(He*100)}%`,Ee.log(`PersistentLoader: Progress updated to ${Math.round(He*100)}%`)},se=He=>{T(He),oe.textContent=He,Ee.log(`PersistentLoader: Loading stage updated to "${He}"`)},he=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];te&&(he[0].stage="Connecting to Space",he[1].stage="Reconnecting...",he[2].stage="Please Wait"),se(he[0].stage),J(.05);const pe=He=>{const rt=He.detail.progress;Ee.log(`PersistentLoader: Progress event received with value: ${rt}`),J(rt),rt<.33?se(he[0].stage):rt<.66?se(he[1].stage):se(he[2].stage)},le=()=>{Ee.log("PersistentLoader: First scene loaded event received"),a(!0),se(he[1].stage),J(.66)},Me=()=>{if(Ee.log("PersistentLoader: Player instantiated event received"),z.current&&(clearInterval(z.current),Ee.log("PersistentLoader: Progress interval cleared")),d(!0),se(he[2].stage),J(1),te){Ee.log("PersistentLoader: Keeping loader visible due to Unity error");return}ne.style.opacity="0",j.current&&(j.current.style.opacity="0"),setTimeout(()=>{n.current&&n.current.contains(ne)?(n.current.removeChild(ne),Ee.log("PersistentLoader: Loader element removed after fade")):Ee.warn("PersistentLoader: Could not remove loader element (not found in container)"),j.current&&n.current&&n.current.contains(j.current)?(n.current.removeChild(j.current),Ee.log("PersistentLoader: Logo container removed after fade")):j.current&&Ee.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)Ee.log("PersistentLoader: Player was already instantiated"),Me();else{Ee.log("PersistentLoader: Subscribing to playerInstantiated event"),Id.subscribe(Cd.playerInstantiated,Me);const He=()=>Me();Ee.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",He),Ee.log("PersistentLoader: Adding firstSceneLoaded event listener"),Id.subscribe(Cd.firstSceneLoaded,le),Ee.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",pe),z.current=setInterval(()=>{l||E(we=>{const Ce=Math.min(we+.01,.95);return ee.style.width=`${Math.round(Ce*100)}%`,Z.textContent=`${Math.round(Ce*100)}%`,Ce<.33&&v!==he[0].stage?se(he[0].stage):Ce>=.33&&Ce<.66&&v!==he[1].stage?se(he[1].stage):Ce>=.66&&v!==he[2].stage&&se(he[2].stage),Ce})},500);const rt=setTimeout(()=>{Ee.log("PersistentLoader: Forcing loader removal after timeout"),Me()},6e4);return()=>{Ee.log("PersistentLoader: Cleaning up event listeners"),Id.unsubscribe(Cd.playerInstantiated,Me),window.removeEventListener("PlayerInstantiated",He),Id.unsubscribe(Cd.firstSceneLoaded,le),window.removeEventListener("UnityProgress",pe),clearInterval(z.current),clearTimeout(rt),n.current&&n.current.contains(ne)&&(n.current.removeChild(ne),Ee.log("PersistentLoader: Loader element removed during cleanup")),j.current&&n.current&&n.current.contains(j.current)&&(n.current.removeChild(j.current),Ee.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};Pse.propTypes={containerRef:kr.shape({current:kr.instanceOf(Element)})};const m0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,c4=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],t=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),E=document.activeElement===d;!l&&(f||E)&&a.preventDefault()}},s=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",t),document.addEventListener("click",s),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",t),document.removeEventListener("click",s)}},Ose=()=>{document.body.classList.remove("unity-focused")};function Bk(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?c4():Ose(),new Promise(t=>{try{const s=m0();if(s){try{n?s.SendMessage("WebGLInput","EnableKeyboardCapture"):s.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),t(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{s.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),t(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(s.Module){!n&&s.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=s.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(s.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(s.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),t(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),SV(n)),t(!1)}catch(s){console.error("Error setting Unity keyboard capture:",s),t(!1)}})}function SV(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const t=20;let s=0;const a=()=>{s++;const l=m0();if(l){console.log(`Unity instance found after ${s} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(s<t){const d=Math.min(500*Math.pow(1.2,s),5e3);console.log(`Unity instance not found (attempt ${s}/${t}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${t} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function Q6e(){const n=m0();if(!n)return!1;const t=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(t&&document.activeElement===t||n.Module&&n.Module.WebGLInputHandler)}function fS(n=!0){return console.log("Focusing Unity canvas"),n?c4():Ose(),new Promise(t=>{try{const s=document.querySelector("canvas")||document.getElementById("unity-canvas");if(s){try{s.focus({preventScroll:!0})}catch{s.focus()}if(s.style.pointerEvents="auto",n){Bk(!0).then(t);return}t(!0)}else console.warn("Unity canvas not found"),t(!1)}catch(s){console.error("Error focusing Unity canvas:",s),t(!1)}})}function IS(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),c4(),new Promise(t=>{try{if(n)Bk(!1).then(s=>{var d;s&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=m0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),t(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const s=m0();s!=null&&s.Module&&window._savedWebGLInputHandler&&(s.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),Bk(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),t(!0)})}}catch(s){console.error("Error in blockUnityKeyboardInput:",s),t(!1)}})}function Z6e(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const t=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${t}`);try{t?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${t} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(s){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",s);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",t),console.log(`Applied pending keyboard state: ${t} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(t){console.error("Error applying pending keyboard state:",t)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function e8e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=Bk,window.focusUnity=fS,window.blockUnityKeyboardInput=IS,window.hasUnityKeyboardFocus=Q6e,window.getUnityInstance=m0,window.registerUnityInstance=Z6e,document.getElementById("webgl-root")){const n=new MutationObserver(t=>{for(const s of t)if(s.addedNodes.length)for(let a=0;a<s.addedNodes.length;a++){const l=s.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),SV(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),SV(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[s,a]=n.useState(!1);return n.useEffect(()=>(s?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),IS(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),IS(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{s&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),IS(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[s]),[s,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(e8e,0);const t8e="9442a472625f44e7b2c5065b9f9b3988",F2=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),l4=L.forwardRef(({settings:n},t)=>{const{unityProvider:s,isLoaded:a,error:l}=Qc(),d=cBe();uBe();const f=Pg(),E=gBe(d),{user:v}=L.useContext(Ll),[T,w]=L.useState(!1),[A,N]=L.useState(window.devicePixelRatio),[F,j]=hBe();rse().find(Ne=>Ne.isLocalPlayer);const[H,te]=L.useState(!0),[K,ne]=L.useState(!0),[de,oe]=L.useState(!1),[ge,ee]=L.useState(!1),[Z,J]=L.useState(!1);L.useEffect(()=>{Z?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),IS(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!ge&&IS(!1).then(()=>{setTimeout(()=>{fS(!0)},100)}))},[Z,a,ge]);const se=n.spaceID||"default",he=L.useMemo(()=>{const Te=new URLSearchParams(window.location.search).get("sessionId")||se;return console.log("WebGLRenderer: Using session ID:",Te),Te},[se]),[pe,le]=L.useState(null);L.useEffect(()=>{v!=null&&v.uid&&ep(v.uid).then(Ne=>{le(Ne),console.log("WebGLRenderer: User profile loaded:",(Ne==null?void 0:Ne.Nickname)||"Unknown")}).catch(Ne=>{console.error("Error fetching user profile:",Ne)})},[v==null?void 0:v.uid]),L.useEffect(()=>{if(l||!v){Ee.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const Ne=setTimeout(()=>{ee(!0),J(!0)},1e3);return()=>clearTimeout(Ne)}else ee(!1)},[l,v]),L.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Ne=()=>{console.log("WebGLRenderer: Player instantiated event received"),ne(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ne(!0)),Id.subscribe(Cd.playerInstantiated,Ne);const be=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ne(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Id.unsubscribe(Cd.playerInstantiated,Ne),clearTimeout(be)}},[K]),L.useEffect(()=>{const Ne=()=>{console.log("WebGLRenderer: Modal opened"),J(!0)},be=()=>{console.log("WebGLRenderer: Modal closed"),J(!1)};return window.addEventListener("modal-opened",Ne),window.addEventListener("modal-closed",be),()=>{window.removeEventListener("modal-opened",Ne),window.removeEventListener("modal-closed",be)}},[]),L.useEffect(()=>{J(F!==null)},[F]),L.useEffect(()=>{a||d?setTimeout(()=>{w(!0),Ee.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Ee.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),L.useEffect(()=>{a&&s&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(Ne){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",Ne)}},1e3)},[a,s]),L.useEffect(()=>{const Ne=document.getElementById("webgl-root");return Ne?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),Ne.style.display="block",Ne.getAttribute("data-space-id")!==se&&(Ne.setAttribute("data-space-id",se),console.log(`WebGLRenderer: Set data-space-id attribute to ${se}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[se]),L.useEffect(()=>{const Ne=()=>{const Ae=F2();Ae?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ae.tabIndex=1,Ae.style.outline="none",Ae.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Z||fS(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};Ne();const be=setTimeout(Ne,1e3),Te=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),Ne()};return window.addEventListener("unityReady",Te),()=>{clearTimeout(be),window.removeEventListener("unityReady",Te)}},[a,Z]);const Me=L.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Z||fS(!0)},[Z]);L.useEffect(()=>{if(a&&s){const Ne=F2();if(Ne)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),Ne.addEventListener("click",Me),()=>{Ne.removeEventListener("click",Me)}}},[a,s,Me]),L.useEffect(()=>{if(a&&s){console.log("WebGLRenderer: Setting up global click handler for focus management");const Ne=be=>{if(Z){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(be.target.tagName==="INPUT"||be.target.tagName==="TEXTAREA"||be.target.tagName==="SELECT"||be.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(be.target.closest(".chakra-modal__content")||be.target.closest('[role="dialog"]')||be.target.closest('[role="menu"]')||be.target.closest(".chakra-popover__content")||be.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const Te=F2();if(Te&&(be.target===Te||Te.contains(be.target)))return;if(be.target.closest(".webgl-overlay")||be.target.closest(".game-ui")||be.target.closest(".player-list")||be.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Z||fS(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{Te&&!Z&&((Te.tabIndex===void 0||Te.tabIndex<0)&&(Te.tabIndex=1),Te.focus(),fS(!0))},50)};return document.addEventListener("click",Ne,!0),()=>{document.removeEventListener("click",Ne,!0)}}},[a,s,Z]),L.useEffect(()=>{const Ne=be=>{Ee.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",be)};return Id.subscribe(Cd.sendUserToUnity,Ne),()=>Id.unsubscribe(Cd.sendUserToUnity,Ne)},[f]);const{setFullscreenRef:He,fullscreenRef:rt}=Nd();L.useEffect(()=>{He(t.current)},[t,He]);const we=()=>{te(!H)},Ce=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:K,showVoiceChat:Ce,sessionId:he}),L.useEffect(()=>{const Ne=be=>{oe(be.detail.enabled)};return window.addEventListener("editModeChanged",Ne),()=>{window.removeEventListener("editModeChanged",Ne)}},[]),ise(),dBe();const ve=L.useRef(null);return I.jsxs(Pt,{className:"webgl-renderer",children:[n.urlLoadingBackground&&I.jsx(Ase,{backgroundUrl:n.urlLoadingBackground,containerRef:ve}),!ge&&I.jsx(Pse,{containerRef:ve}),ge&&I.jsx(Pt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:I.jsx(a4,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),I.jsx(WV,{containerRef:rt.current?rt:document.body,children:I.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[I.jsxs(Pt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&I.jsx(HBe,{}),Ce&&I.jsxs(wse,{appId:t8e,channel:he,uid:v==null?void 0:v.uid,enabled:!0,children:[I.jsx(T6e,{size:"md",defaultMuted:!0,joinOnClick:!0}),I.jsx(w6e,{userNickname:pe==null?void 0:pe.Nickname})]}),I.jsx(l6e,{}),I.jsx(Pt,{position:"relative",zIndex:"9999",children:I.jsx(z6e,{onTogglePlayerList:we,spaceID:se})})]}),I.jsxs(Pt,{ref:ve,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[I.jsx(Pt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),I.jsx(Pt,{...E,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:s?I.jsx(nse.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:A,tabIndex:1}):I.jsx(Pt,{width:"100%",height:"100%"})}),I.jsx(Pt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:I.jsx(GBe,{})})]}),I.jsx(Pt,{...E,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&I.jsx(Vh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),I.jsx(Pt,{...E,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),I.jsxs(Pt,{...E,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&I.jsx($Be,{}),I.jsx(h6e,{})]}),I.jsx(p6e,{}),I.jsx(f6e,{isOpen:F!==null,onClose:()=>{console.log(" Closing nameplate modal"),j()},playerName:(F==null?void 0:F.playerName)||"Unknown Player",playerId:(F==null?void 0:F.playerId)||"Unknown ID"}),I.jsx(m6e,{isVisible:H,onToggleVisibility:te,spaceID:se}),I.jsx(J6e,{})]})})]})});l4.displayName="WebGLRenderer";l4.propTypes={settings:kr.shape({urlLoadingBackground:kr.string,showAuthButton:kr.bool,showDisruptiveLogo:kr.bool,urlDisruptiveLogo:kr.string,showHelpButton:kr.bool,enableVoiceChat:kr.bool,spaceID:kr.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:t=>(console.log("HISPlayer: mute called with state:",t),!0),isMuted:!1,seek:t=>(console.log("HISPlayer: seek called with time:",t),!0),setVolume:t=>(console.log("HISPlayer: setVolume called with volume:",t),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:t=>(console.log("HISPlayer: setUnityContext called with:",t),window.hisPlayerContextId=t,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:t=>(console.log("HISPlayer: setProperties called with:",t),!0),setMultiPaths:t=>(console.log("HISPlayer: setMultiPaths called with:",t),window._hisplayer_paths=t,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(Ee.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),Ee.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const t=new window.MultipleView;if(t&&t.multiView&&typeof t.multiView.setUnityContext=="function")return t.multiView.setUnityContext(n),window._hisplayer_instance=t,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const t=new window.MultipleView;return t.multiView.setUnityContext(n),window._hisplayer_instance=t,!0}}catch(t){console.error("HISPlayer: Error in setUpContext:",t);const s=document.getElementById("hisplayer-error");s&&(s.innerHTML="Error: "+t.message)}return!1}}const kse=({spaceID:n,overrideSettings:t})=>{const s=L.useRef(null),[a,l]=L.useState(!0),[d,f]=L.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,v]=L.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return L.useEffect(()=>{(async()=>{try{const w=await ug(n);if(w){f(F=>({...F,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const A=await JO(E.urlDisruptiveLogo);let N="";if(w.backgroundUrl)N=w.backgroundUrl;else if(w.backgroundGsUrl)try{N=await JO(w.backgroundGsUrl)}catch(F){Ee.warn("WebGLLoader: Error fetching background from GS URL:",F)}else if(w.gsUrlLoadingBackground)try{N=await JO(w.gsUrlLoadingBackground)}catch(F){Ee.warn("WebGLLoader: Error fetching background from legacy GS URL:",F)}v(F=>({...F,urlLoadingBackground:N,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:A,spaceID:n,...t||{}})),l(!1)}else Ee.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){Ee.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,E.urlDisruptiveLogo,t]),L.useEffect(()=>{a||(Ee.log("WebGLLoader: Unity config from Firebase",d),Ee.log("WebGLLoader: Space settings from Firebase",E))},[a]),I.jsx(I.Fragment,{children:a?I.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):I.jsx(aBe,{...d,children:I.jsx(l4,{ref:s,settings:E})})})};kse.propTypes={spaceID:kr.string.isRequired,overrideSettings:kr.object};function mJ(){const n=document.getElementById("webgl-root");if(n){const t=n.getAttribute("data-space-id"),s=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=L.useState(null);return L.useEffect(()=>{gMe(s).then(d)},[]),l?I.jsx(Ake,{theme:l,children:I.jsx(X5e,{children:I.jsx(J5e,{children:I.jsx(kse,{spaceID:t})})})}):I.jsx("div",{children:"Loading theme..."})};try{y_e.createRoot(n).render(I.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",mJ):mJ());export{L_e as a,rve as b,ki as c,eve as d,r8e as e,n8e as f,$ye as g,wu as i,Uh as m,tRe as t};
