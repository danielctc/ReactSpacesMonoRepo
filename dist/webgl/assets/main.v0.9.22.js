function uye(n,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var dy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var x2={exports:{}},iw={},M2={exports:{}},yr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j$;function dye(){if(j$)return yr;j$=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),I=Symbol.iterator;function k(we){return we===null||typeof we!="object"?null:(we=I&&we[I]||we["@@iterator"],typeof we=="function"?we:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},F=Object.assign,B={};function z(we,be,Ie){this.props=we,this.context=be,this.refs=B,this.updater=Ie||x}z.prototype.isReactComponent={},z.prototype.setState=function(we,be){if(typeof we!="object"&&typeof we!="function"&&we!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,we,be,"setState")},z.prototype.forceUpdate=function(we){this.updater.enqueueForceUpdate(this,we,"forceUpdate")};function J(){}J.prototype=z.prototype;function $(we,be,Ie){this.props=we,this.context=be,this.refs=B,this.updater=Ie||x}var ie=$.prototype=new J;ie.constructor=$,F(ie,z.prototype),ie.isPureReactComponent=!0;var ue=Array.isArray,re=Object.prototype.hasOwnProperty,fe={current:null},q={key:!0,ref:!0,__self:!0,__source:!0};function X(we,be,Ie){var Me,ze={},Je=null,tt=null;if(be!=null)for(Me in be.ref!==void 0&&(tt=be.ref),be.key!==void 0&&(Je=""+be.key),be)re.call(be,Me)&&!q.hasOwnProperty(Me)&&(ze[Me]=be[Me]);var ut=arguments.length-2;if(ut===1)ze.children=Ie;else if(1<ut){for(var Ze=Array(ut),vt=0;vt<ut;vt++)Ze[vt]=arguments[vt+2];ze.children=Ze}if(we&&we.defaultProps)for(Me in ut=we.defaultProps,ut)ze[Me]===void 0&&(ze[Me]=ut[Me]);return{$$typeof:n,type:we,key:Je,ref:tt,props:ze,_owner:fe.current}}function Q(we,be){return{$$typeof:n,type:we.type,key:be,ref:we.ref,props:we.props,_owner:we._owner}}function se(we){return typeof we=="object"&&we!==null&&we.$$typeof===n}function me(we){var be={"=":"=0",":":"=2"};return"$"+we.replace(/[=:]/g,function(Ie){return be[Ie]})}var pe=/\/+/g;function le(we,be){return typeof we=="object"&&we!==null&&we.key!=null?me(""+we.key):be.toString(36)}function Le(we,be,Ie,Me,ze){var Je=typeof we;(Je==="undefined"||Je==="boolean")&&(we=null);var tt=!1;if(we===null)tt=!0;else switch(Je){case"string":case"number":tt=!0;break;case"object":switch(we.$$typeof){case n:case t:tt=!0}}if(tt)return tt=we,ze=ze(tt),we=Me===""?"."+le(tt,0):Me,ue(ze)?(Ie="",we!=null&&(Ie=we.replace(pe,"$&/")+"/"),Le(ze,be,Ie,"",function(vt){return vt})):ze!=null&&(se(ze)&&(ze=Q(ze,Ie+(!ze.key||tt&&tt.key===ze.key?"":(""+ze.key).replace(pe,"$&/")+"/")+we)),be.push(ze)),1;if(tt=0,Me=Me===""?".":Me+":",ue(we))for(var ut=0;ut<we.length;ut++){Je=we[ut];var Ze=Me+le(Je,ut);tt+=Le(Je,be,Ie,Ze,ze)}else if(Ze=k(we),typeof Ze=="function")for(we=Ze.call(we),ut=0;!(Je=we.next()).done;)Je=Je.value,Ze=Me+le(Je,ut++),tt+=Le(Je,be,Ie,Ze,ze);else if(Je==="object")throw be=String(we),Error("Objects are not valid as a React child (found: "+(be==="[object Object]"?"object with keys {"+Object.keys(we).join(", ")+"}":be)+"). If you meant to render a collection of children, use an array instead.");return tt}function We(we,be,Ie){if(we==null)return we;var Me=[],ze=0;return Le(we,Me,"","",function(Je){return be.call(Ie,Je,ze++)}),Me}function $e(we){if(we._status===-1){var be=we._result;be=be(),be.then(function(Ie){(we._status===0||we._status===-1)&&(we._status=1,we._result=Ie)},function(Ie){(we._status===0||we._status===-1)&&(we._status=2,we._result=Ie)}),we._status===-1&&(we._status=0,we._result=be)}if(we._status===1)return we._result.default;throw we._result}var ve={current:null},_e={transition:null},Ee={ReactCurrentDispatcher:ve,ReactCurrentBatchConfig:_e,ReactCurrentOwner:fe};function ke(){throw Error("act(...) is not supported in production builds of React.")}return yr.Children={map:We,forEach:function(we,be,Ie){We(we,function(){be.apply(this,arguments)},Ie)},count:function(we){var be=0;return We(we,function(){be++}),be},toArray:function(we){return We(we,function(be){return be})||[]},only:function(we){if(!se(we))throw Error("React.Children.only expected to receive a single React element child.");return we}},yr.Component=z,yr.Fragment=s,yr.Profiler=l,yr.PureComponent=$,yr.StrictMode=a,yr.Suspense=v,yr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ee,yr.act=ke,yr.cloneElement=function(we,be,Ie){if(we==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+we+".");var Me=F({},we.props),ze=we.key,Je=we.ref,tt=we._owner;if(be!=null){if(be.ref!==void 0&&(Je=be.ref,tt=fe.current),be.key!==void 0&&(ze=""+be.key),we.type&&we.type.defaultProps)var ut=we.type.defaultProps;for(Ze in be)re.call(be,Ze)&&!q.hasOwnProperty(Ze)&&(Me[Ze]=be[Ze]===void 0&&ut!==void 0?ut[Ze]:be[Ze])}var Ze=arguments.length-2;if(Ze===1)Me.children=Ie;else if(1<Ze){ut=Array(Ze);for(var vt=0;vt<Ze;vt++)ut[vt]=arguments[vt+2];Me.children=ut}return{$$typeof:n,type:we.type,key:ze,ref:Je,props:Me,_owner:tt}},yr.createContext=function(we){return we={$$typeof:f,_currentValue:we,_currentValue2:we,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},we.Provider={$$typeof:d,_context:we},we.Consumer=we},yr.createElement=X,yr.createFactory=function(we){var be=X.bind(null,we);return be.type=we,be},yr.createRef=function(){return{current:null}},yr.forwardRef=function(we){return{$$typeof:y,render:we}},yr.isValidElement=se,yr.lazy=function(we){return{$$typeof:w,_payload:{_status:-1,_result:we},_init:$e}},yr.memo=function(we,be){return{$$typeof:b,type:we,compare:be===void 0?null:be}},yr.startTransition=function(we){var be=_e.transition;_e.transition={};try{we()}finally{_e.transition=be}},yr.unstable_act=ke,yr.useCallback=function(we,be){return ve.current.useCallback(we,be)},yr.useContext=function(we){return ve.current.useContext(we)},yr.useDebugValue=function(){},yr.useDeferredValue=function(we){return ve.current.useDeferredValue(we)},yr.useEffect=function(we,be){return ve.current.useEffect(we,be)},yr.useId=function(){return ve.current.useId()},yr.useImperativeHandle=function(we,be,Ie){return ve.current.useImperativeHandle(we,be,Ie)},yr.useInsertionEffect=function(we,be){return ve.current.useInsertionEffect(we,be)},yr.useLayoutEffect=function(we,be){return ve.current.useLayoutEffect(we,be)},yr.useMemo=function(we,be){return ve.current.useMemo(we,be)},yr.useReducer=function(we,be,Ie){return ve.current.useReducer(we,be,Ie)},yr.useRef=function(we){return ve.current.useRef(we)},yr.useState=function(we){return ve.current.useState(we)},yr.useSyncExternalStore=function(we,be,Ie){return ve.current.useSyncExternalStore(we,be,Ie)},yr.useTransition=function(){return ve.current.useTransition()},yr.version="18.3.1",yr}var B$;function ku(){return B$||(B$=1,M2.exports=dye()),M2.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W$;function hye(){if(W$)return iw;W$=1;var n=ku(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(y,v,b){var w,I={},k=null,x=null;b!==void 0&&(k=""+b),v.key!==void 0&&(k=""+v.key),v.ref!==void 0&&(x=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(I[w]=v[w]);if(y&&y.defaultProps)for(w in v=y.defaultProps,v)I[w]===void 0&&(I[w]=v[w]);return{$$typeof:t,type:y,key:k,ref:x,props:I,_owner:l.current}}return iw.Fragment=s,iw.jsx=f,iw.jsxs=f,iw}var z$;function pye(){return z$||(z$=1,x2.exports=hye()),x2.exports}var R=pye(),D=ku();const ui=Pg(D),G$=uye({__proto__:null,default:ui},[D]);var JP={},U2={exports:{}},Zc={},V2={exports:{}},F2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H$;function fye(){return H$||(H$=1,function(n){function t(_e,Ee){var ke=_e.length;_e.push(Ee);e:for(;0<ke;){var we=ke-1>>>1,be=_e[we];if(0<l(be,Ee))_e[we]=Ee,_e[ke]=be,ke=we;else break e}}function s(_e){return _e.length===0?null:_e[0]}function a(_e){if(_e.length===0)return null;var Ee=_e[0],ke=_e.pop();if(ke!==Ee){_e[0]=ke;e:for(var we=0,be=_e.length,Ie=be>>>1;we<Ie;){var Me=2*(we+1)-1,ze=_e[Me],Je=Me+1,tt=_e[Je];if(0>l(ze,ke))Je<be&&0>l(tt,ze)?(_e[we]=tt,_e[Je]=ke,we=Je):(_e[we]=ze,_e[Me]=ke,we=Me);else if(Je<be&&0>l(tt,ke))_e[we]=tt,_e[Je]=ke,we=Je;else break e}}return Ee}function l(_e,Ee){var ke=_e.sortIndex-Ee.sortIndex;return ke!==0?ke:_e.id-Ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var f=Date,y=f.now();n.unstable_now=function(){return f.now()-y}}var v=[],b=[],w=1,I=null,k=3,x=!1,F=!1,B=!1,z=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ie(_e){for(var Ee=s(b);Ee!==null;){if(Ee.callback===null)a(b);else if(Ee.startTime<=_e)a(b),Ee.sortIndex=Ee.expirationTime,t(v,Ee);else break;Ee=s(b)}}function ue(_e){if(B=!1,ie(_e),!F)if(s(v)!==null)F=!0,$e(re);else{var Ee=s(b);Ee!==null&&ve(ue,Ee.startTime-_e)}}function re(_e,Ee){F=!1,B&&(B=!1,J(X),X=-1),x=!0;var ke=k;try{for(ie(Ee),I=s(v);I!==null&&(!(I.expirationTime>Ee)||_e&&!me());){var we=I.callback;if(typeof we=="function"){I.callback=null,k=I.priorityLevel;var be=we(I.expirationTime<=Ee);Ee=n.unstable_now(),typeof be=="function"?I.callback=be:I===s(v)&&a(v),ie(Ee)}else a(v);I=s(v)}if(I!==null)var Ie=!0;else{var Me=s(b);Me!==null&&ve(ue,Me.startTime-Ee),Ie=!1}return Ie}finally{I=null,k=ke,x=!1}}var fe=!1,q=null,X=-1,Q=5,se=-1;function me(){return!(n.unstable_now()-se<Q)}function pe(){if(q!==null){var _e=n.unstable_now();se=_e;var Ee=!0;try{Ee=q(!0,_e)}finally{Ee?le():(fe=!1,q=null)}}else fe=!1}var le;if(typeof $=="function")le=function(){$(pe)};else if(typeof MessageChannel<"u"){var Le=new MessageChannel,We=Le.port2;Le.port1.onmessage=pe,le=function(){We.postMessage(null)}}else le=function(){z(pe,0)};function $e(_e){q=_e,fe||(fe=!0,le())}function ve(_e,Ee){X=z(function(){_e(n.unstable_now())},Ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(_e){_e.callback=null},n.unstable_continueExecution=function(){F||x||(F=!0,$e(re))},n.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<_e?Math.floor(1e3/_e):5},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return s(v)},n.unstable_next=function(_e){switch(k){case 1:case 2:case 3:var Ee=3;break;default:Ee=k}var ke=k;k=Ee;try{return _e()}finally{k=ke}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(_e,Ee){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var ke=k;k=_e;try{return Ee()}finally{k=ke}},n.unstable_scheduleCallback=function(_e,Ee,ke){var we=n.unstable_now();switch(typeof ke=="object"&&ke!==null?(ke=ke.delay,ke=typeof ke=="number"&&0<ke?we+ke:we):ke=we,_e){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=ke+be,_e={id:w++,callback:Ee,priorityLevel:_e,startTime:ke,expirationTime:be,sortIndex:-1},ke>we?(_e.sortIndex=ke,t(b,_e),s(v)===null&&_e===s(b)&&(B?(J(X),X=-1):B=!0,ve(ue,ke-we))):(_e.sortIndex=be,t(v,_e),F||x||(F=!0,$e(re))),_e},n.unstable_shouldYield=me,n.unstable_wrapCallback=function(_e){var Ee=k;return function(){var ke=k;k=Ee;try{return _e.apply(this,arguments)}finally{k=ke}}}}(F2)),F2}var $$;function mye(){return $$||($$=1,V2.exports=fye()),V2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K$;function gye(){if(K$)return Zc;K$=1;var n=ku(),t=mye();function s(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},I={};function k(p){return v.call(I,p)?!0:v.call(w,p)?!1:b.test(p)?I[p]=!0:(w[p]=!0,!1)}function x(p,g,T,O){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:T!==null?!T.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function F(p,g,T,O){if(g===null||typeof g>"u"||x(p,g,T,O))return!0;if(O)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(p,g,T,O,U,H,ce){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=U,this.mustUseProperty=T,this.propertyName=p,this.type=g,this.sanitizeURL=H,this.removeEmptyString=ce}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){z[p]=new B(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];z[g]=new B(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){z[p]=new B(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){z[p]=new B(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){z[p]=new B(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){z[p]=new B(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){z[p]=new B(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){z[p]=new B(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){z[p]=new B(p,5,!1,p.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function $(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(J,$);z[g]=new B(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(J,$);z[g]=new B(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(J,$);z[g]=new B(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){z[p]=new B(p,1,!1,p.toLowerCase(),null,!1,!1)}),z.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){z[p]=new B(p,1,!1,p.toLowerCase(),null,!0,!0)});function ie(p,g,T,O){var U=z.hasOwnProperty(g)?z[g]:null;(U!==null?U.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(F(g,T,U,O)&&(T=null),O||U===null?k(g)&&(T===null?p.removeAttribute(g):p.setAttribute(g,""+T)):U.mustUseProperty?p[U.propertyName]=T===null?U.type===3?!1:"":T:(g=U.attributeName,O=U.attributeNamespace,T===null?p.removeAttribute(g):(U=U.type,T=U===3||U===4&&T===!0?"":""+T,O?p.setAttributeNS(O,g,T):p.setAttribute(g,T))))}var ue=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,re=Symbol.for("react.element"),fe=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),X=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),me=Symbol.for("react.context"),pe=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),Le=Symbol.for("react.suspense_list"),We=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),ve=Symbol.for("react.offscreen"),_e=Symbol.iterator;function Ee(p){return p===null||typeof p!="object"?null:(p=_e&&p[_e]||p["@@iterator"],typeof p=="function"?p:null)}var ke=Object.assign,we;function be(p){if(we===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);we=g&&g[1]||""}return`
`+we+p}var Ie=!1;function Me(p,g){if(!p||Ie)return"";Ie=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(rt){var O=rt}Reflect.construct(p,[],g)}else{try{g.call()}catch(rt){O=rt}p.call(g.prototype)}else{try{throw Error()}catch(rt){O=rt}p()}}catch(rt){if(rt&&O&&typeof rt.stack=="string"){for(var U=rt.stack.split(`
`),H=O.stack.split(`
`),ce=U.length-1,Ae=H.length-1;1<=ce&&0<=Ae&&U[ce]!==H[Ae];)Ae--;for(;1<=ce&&0<=Ae;ce--,Ae--)if(U[ce]!==H[Ae]){if(ce!==1||Ae!==1)do if(ce--,Ae--,0>Ae||U[ce]!==H[Ae]){var Ue=`
`+U[ce].replace(" at new "," at ");return p.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",p.displayName)),Ue}while(1<=ce&&0<=Ae);break}}}finally{Ie=!1,Error.prepareStackTrace=T}return(p=p?p.displayName||p.name:"")?be(p):""}function ze(p){switch(p.tag){case 5:return be(p.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 2:case 15:return p=Me(p.type,!1),p;case 11:return p=Me(p.type.render,!1),p;case 1:return p=Me(p.type,!0),p;default:return""}}function Je(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case q:return"Fragment";case fe:return"Portal";case Q:return"Profiler";case X:return"StrictMode";case le:return"Suspense";case Le:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case me:return(p.displayName||"Context")+".Consumer";case se:return(p._context.displayName||"Context")+".Provider";case pe:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case We:return g=p.displayName||null,g!==null?g:Je(p.type)||"Memo";case $e:g=p._payload,p=p._init;try{return Je(p(g))}catch{}}return null}function tt(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Je(g);case 8:return g===X?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ut(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Ze(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function vt(p){var g=Ze(p)?"checked":"value",T=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),O=""+p[g];if(!p.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var U=T.get,H=T.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return U.call(this)},set:function(ce){O=""+ce,H.call(this,ce)}}),Object.defineProperty(p,g,{enumerable:T.enumerable}),{getValue:function(){return O},setValue:function(ce){O=""+ce},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function sn(p){p._valueTracker||(p._valueTracker=vt(p))}function Mt(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var T=g.getValue(),O="";return p&&(O=Ze(p)?p.checked?"true":"false":p.value),p=O,p!==T?(g.setValue(p),!0):!1}function Qt(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function on(p,g){var T=g.checked;return ke({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??p._wrapperState.initialChecked})}function Ht(p,g){var T=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;T=ut(g.value!=null?g.value:T),p._wrapperState={initialChecked:O,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function jn(p,g){g=g.checked,g!=null&&ie(p,"checked",g,!1)}function Wt(p,g){jn(p,g);var T=ut(g.value),O=g.type;if(T!=null)O==="number"?(T===0&&p.value===""||p.value!=T)&&(p.value=""+T):p.value!==""+T&&(p.value=""+T);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Fe(p,g.type,T):g.hasOwnProperty("defaultValue")&&Fe(p,g.type,ut(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Re(p,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,T||g===p.value||(p.value=g),p.defaultValue=g}T=p.name,T!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,T!==""&&(p.name=T)}function Fe(p,g,T){(g!=="number"||Qt(p.ownerDocument)!==p)&&(T==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+T&&(p.defaultValue=""+T))}var Ge=Array.isArray;function ot(p,g,T,O){if(p=p.options,g){g={};for(var U=0;U<T.length;U++)g["$"+T[U]]=!0;for(T=0;T<p.length;T++)U=g.hasOwnProperty("$"+p[T].value),p[T].selected!==U&&(p[T].selected=U),U&&O&&(p[T].defaultSelected=!0)}else{for(T=""+ut(T),g=null,U=0;U<p.length;U++){if(p[U].value===T){p[U].selected=!0,O&&(p[U].defaultSelected=!0);return}g!==null||p[U].disabled||(g=p[U])}g!==null&&(g.selected=!0)}}function _t(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(s(91));return ke({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function yt(p,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(s(92));if(Ge(T)){if(1<T.length)throw Error(s(93));T=T[0]}g=T}g==null&&(g=""),T=g}p._wrapperState={initialValue:ut(T)}}function Gt(p,g){var T=ut(g.value),O=ut(g.defaultValue);T!=null&&(T=""+T,T!==p.value&&(p.value=T),g.defaultValue==null&&p.defaultValue!==T&&(p.defaultValue=T)),O!=null&&(p.defaultValue=""+O)}function mn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function Pn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function un(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?Pn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var bt,lr=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,O,U){MSApp.execUnsafeLocalFunction(function(){return p(g,T,O,U)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(bt=bt||document.createElement("div"),bt.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=bt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Nt(p,g){if(g){var T=p.firstChild;if(T&&T===p.lastChild&&T.nodeType===3){T.nodeValue=g;return}}p.textContent=g}var Kt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qr=["Webkit","ms","Moz","O"];Object.keys(Kt).forEach(function(p){qr.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),Kt[g]=Kt[p]})});function ji(p,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||Kt.hasOwnProperty(p)&&Kt[p]?(""+g).trim():g+"px"}function Ms(p,g){p=p.style;for(var T in g)if(g.hasOwnProperty(T)){var O=T.indexOf("--")===0,U=ji(T,g[T],O);T==="float"&&(T="cssFloat"),O?p.setProperty(T,U):p[T]=U}}var ii=ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ot(p,g){if(g){if(ii[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(s(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(s(61))}if(g.style!=null&&typeof g.style!="object")throw Error(s(62))}}function On(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var or=null;function xi(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var bc=null,cs=null,Sa=null;function vo(p){if(p=om(p)){if(typeof bc!="function")throw Error(s(280));var g=p.stateNode;g&&(g=am(g),bc(p.stateNode,p.type,g))}}function ba(p){cs?Sa?Sa.push(p):Sa=[p]:cs=p}function Ta(){if(cs){var p=cs,g=Sa;if(Sa=cs=null,vo(p),g)for(p=0;p<g.length;p++)vo(g[p])}}function ro(p,g){return p(g)}function _s(){}var ls=!1;function jo(p,g,T){if(ls)return p(g,T);ls=!0;try{return ro(p,g,T)}finally{ls=!1,(cs!==null||Sa!==null)&&(_s(),Ta())}}function Bi(p,g){var T=p.stateNode;if(T===null)return null;var O=am(T);if(O===null)return null;T=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(T&&typeof T!="function")throw Error(s(231,g,typeof T));return T}var ys=!1;if(y)try{var Za={};Object.defineProperty(Za,"passive",{get:function(){ys=!0}}),window.addEventListener("test",Za,Za),window.removeEventListener("test",Za,Za)}catch{ys=!1}function Uu(p,g,T,O,U,H,ce,Ae,Ue){var rt=Array.prototype.slice.call(arguments,3);try{g.apply(T,rt)}catch(Pt){this.onError(Pt)}}var Tc=!1,wa=null,Ca=!1,Ud=null,Mg={onError:function(p){Tc=!0,wa=p}};function Vu(p,g,T,O,U,H,ce,Ae,Ue){Tc=!1,wa=null,Uu.apply(Mg,arguments)}function hp(p,g,T,O,U,H,ce,Ae,Ue){if(Vu.apply(this,arguments),Tc){if(Tc){var rt=wa;Tc=!1,wa=null}else throw Error(s(198));Ca||(Ca=!0,Ud=rt)}}function qs(p){var g=p,T=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(T=g.return),p=g.return;while(p)}return g.tag===3?T:null}function Fu(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function Ra(p){if(qs(p)!==p)throw Error(s(188))}function Vd(p){var g=p.alternate;if(!g){if(g=qs(p),g===null)throw Error(s(188));return g!==p?null:p}for(var T=p,O=g;;){var U=T.return;if(U===null)break;var H=U.alternate;if(H===null){if(O=U.return,O!==null){T=O;continue}break}if(U.child===H.child){for(H=U.child;H;){if(H===T)return Ra(U),p;if(H===O)return Ra(U),g;H=H.sibling}throw Error(s(188))}if(T.return!==O.return)T=U,O=H;else{for(var ce=!1,Ae=U.child;Ae;){if(Ae===T){ce=!0,T=U,O=H;break}if(Ae===O){ce=!0,O=U,T=H;break}Ae=Ae.sibling}if(!ce){for(Ae=H.child;Ae;){if(Ae===T){ce=!0,T=H,O=U;break}if(Ae===O){ce=!0,O=H,T=U;break}Ae=Ae.sibling}if(!ce)throw Error(s(189))}}if(T.alternate!==O)throw Error(s(190))}if(T.tag!==3)throw Error(s(188));return T.stateNode.current===T?p:g}function Fd(p){return p=Vd(p),p!==null?ec(p):null}function ec(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=ec(p);if(g!==null)return g;p=p.sibling}return null}var jd=t.unstable_scheduleCallback,ju=t.unstable_cancelCallback,Bo=t.unstable_shouldYield,Bd=t.unstable_requestPaint,zr=t.unstable_now,Si=t.unstable_getCurrentPriorityLevel,wc=t.unstable_ImmediatePriority,dl=t.unstable_UserBlockingPriority,Ia=t.unstable_NormalPriority,pp=t.unstable_LowPriority,Wd=t.unstable_IdlePriority,Wl=null,So=null;function Hf(p){if(So&&typeof So.onCommitFiberRoot=="function")try{So.onCommitFiberRoot(Wl,p,void 0,(p.current.flags&128)===128)}catch{}}var io=Math.clz32?Math.clz32:zd,fp=Math.log,hl=Math.LN2;function zd(p){return p>>>=0,p===0?32:31-(fp(p)/hl|0)|0}var Gd=64,gr=4194304;function zl(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Gl(p,g){var T=p.pendingLanes;if(T===0)return 0;var O=0,U=p.suspendedLanes,H=p.pingedLanes,ce=T&268435455;if(ce!==0){var Ae=ce&~U;Ae!==0?O=zl(Ae):(H&=ce,H!==0&&(O=zl(H)))}else ce=T&~U,ce!==0?O=zl(ce):H!==0&&(O=zl(H));if(O===0)return 0;if(g!==0&&g!==O&&(g&U)===0&&(U=O&-O,H=g&-g,U>=H||U===16&&(H&4194240)!==0))return g;if((O&4)!==0&&(O|=T&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=O;0<g;)T=31-io(g),U=1<<T,O|=p[T],g&=~U;return O}function Bu(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tc(p,g){for(var T=p.suspendedLanes,O=p.pingedLanes,U=p.expirationTimes,H=p.pendingLanes;0<H;){var ce=31-io(H),Ae=1<<ce,Ue=U[ce];Ue===-1?((Ae&T)===0||(Ae&O)!==0)&&(U[ce]=Bu(Ae,g)):Ue<=g&&(p.expiredLanes|=Ae),H&=~Ae}}function Wo(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Wu(){var p=Gd;return Gd<<=1,(Gd&4194240)===0&&(Gd=64),p}function pl(p){for(var g=[],T=0;31>T;T++)g.push(p);return g}function Hl(p,g,T){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-io(g),p[g]=T}function Yr(p,g){var T=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<T;){var U=31-io(T),H=1<<U;g[U]=0,O[U]=-1,p[U]=-1,T&=~H}}function nc(p,g){var T=p.entangledLanes|=g;for(p=p.entanglements;T;){var O=31-io(T),U=1<<O;U&g|p[O]&g&&(p[O]|=g),T&=~U}}var ar=0;function Cc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var $f,$l,Hd,mp,Kf,gp=!1,zo=[],us=null,Go=null,Ho=null,Kl=new Map,$o=new Map,Ko=[],qf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rc(p,g){switch(p){case"focusin":case"focusout":us=null;break;case"dragenter":case"dragleave":Go=null;break;case"mouseover":case"mouseout":Ho=null;break;case"pointerover":case"pointerout":Kl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":$o.delete(g.pointerId)}}function Es(p,g,T,O,U,H){return p===null||p.nativeEvent!==H?(p={blockedOn:g,domEventName:T,eventSystemFlags:O,nativeEvent:H,targetContainers:[U]},g!==null&&(g=om(g),g!==null&&$l(g)),p):(p.eventSystemFlags|=O,g=p.targetContainers,U!==null&&g.indexOf(U)===-1&&g.push(U),p)}function zu(p,g,T,O,U){switch(g){case"focusin":return us=Es(us,p,g,T,O,U),!0;case"dragenter":return Go=Es(Go,p,g,T,O,U),!0;case"mouseover":return Ho=Es(Ho,p,g,T,O,U),!0;case"pointerover":var H=U.pointerId;return Kl.set(H,Es(Kl.get(H)||null,p,g,T,O,U)),!0;case"gotpointercapture":return H=U.pointerId,$o.set(H,Es($o.get(H)||null,p,g,T,O,U)),!0}return!1}function _p(p){var g=Cp(p.target);if(g!==null){var T=qs(g);if(T!==null){if(g=T.tag,g===13){if(g=Fu(T),g!==null){p.blockedOn=g,Kf(p.priority,function(){Hd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){p.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}p.blockedOn=null}function fl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var T=Sr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(T===null){T=p.nativeEvent;var O=new T.constructor(T.type,T);or=O,T.target.dispatchEvent(O),or=null}else return g=om(T),g!==null&&$l(g),p.blockedOn=T,!1;g.shift()}return!0}function ql(p,g,T){fl(p)&&T.delete(g)}function Yf(){gp=!1,us!==null&&fl(us)&&(us=null),Go!==null&&fl(Go)&&(Go=null),Ho!==null&&fl(Ho)&&(Ho=null),Kl.forEach(ql),$o.forEach(ql)}function Aa(p,g){p.blockedOn===g&&(p.blockedOn=null,gp||(gp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Yf)))}function Pa(p){function g(U){return Aa(U,p)}if(0<zo.length){Aa(zo[0],p);for(var T=1;T<zo.length;T++){var O=zo[T];O.blockedOn===p&&(O.blockedOn=null)}}for(us!==null&&Aa(us,p),Go!==null&&Aa(Go,p),Ho!==null&&Aa(Ho,p),Kl.forEach(g),$o.forEach(g),T=0;T<Ko.length;T++)O=Ko[T],O.blockedOn===p&&(O.blockedOn=null);for(;0<Ko.length&&(T=Ko[0],T.blockedOn===null);)_p(T),T.blockedOn===null&&Ko.shift()}var ml=ue.ReactCurrentBatchConfig,Ce=!0;function De(p,g,T,O){var U=ar,H=ml.transition;ml.transition=null;try{ar=1,Jt(p,g,T,O)}finally{ar=U,ml.transition=H}}function nt(p,g,T,O){var U=ar,H=ml.transition;ml.transition=null;try{ar=4,Jt(p,g,T,O)}finally{ar=U,ml.transition=H}}function Jt(p,g,T,O){if(Ce){var U=Sr(p,g,T,O);if(U===null)iE(p,g,O,Jn,T),Rc(p,O);else if(zu(U,p,g,T,O))O.stopPropagation();else if(Rc(p,O),g&4&&-1<qf.indexOf(p)){for(;U!==null;){var H=om(U);if(H!==null&&$f(H),H=Sr(p,g,T,O),H===null&&iE(p,g,O,Jn,T),H===U)break;U=H}U!==null&&O.stopPropagation()}else iE(p,g,O,null,T)}}var Jn=null;function Sr(p,g,T,O){if(Jn=null,p=xi(O),p=Cp(p),p!==null)if(g=qs(p),g===null)p=null;else if(T=g.tag,T===13){if(p=Fu(g),p!==null)return p;p=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return Jn=p,null}function Gr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Si()){case wc:return 1;case dl:return 4;case Ia:case pp:return 16;case Wd:return 536870912;default:return 16}default:return 16}}var hn=null,Ur=null,bi=null;function Us(){if(bi)return bi;var p,g=Ur,T=g.length,O,U="value"in hn?hn.value:hn.textContent,H=U.length;for(p=0;p<T&&g[p]===U[p];p++);var ce=T-p;for(O=1;O<=ce&&g[T-O]===U[H-O];O++);return bi=U.slice(p,1<O?1-O:void 0)}function qo(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function Yo(){return!0}function Gu(){return!1}function es(p){function g(T,O,U,H,ce){this._reactName=T,this._targetInst=U,this.type=O,this.nativeEvent=H,this.target=ce,this.currentTarget=null;for(var Ae in p)p.hasOwnProperty(Ae)&&(T=p[Ae],this[Ae]=T?T(H):H[Ae]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?Yo:Gu,this.isPropagationStopped=Gu,this}return ke(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Yo)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Yo)},persist:function(){},isPersistent:Yo}),g}var gl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$d=es(gl),Ic=ke({},gl,{view:0,detail:0}),Ug=es(Ic),Xf,Hu,Xo,Yl=ke({},Ic,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ac,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Xo&&(Xo&&p.type==="mousemove"?(Xf=p.screenX-Xo.screenX,Hu=p.screenY-Xo.screenY):Hu=Xf=0,Xo=p),Xf)},movementY:function(p){return"movementY"in p?p.movementY:Hu}}),Jf=es(Yl),Vg=ke({},Yl,{dataTransfer:0}),Xy=es(Vg),Qf=ke({},Ic,{relatedTarget:0}),Zf=es(Qf),$u=ke({},gl,{animationName:0,elapsedTime:0,pseudoElement:0}),Ku=es($u),qu=ke({},gl,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Fg=es(qu),Jy=ke({},gl,{data:0}),Wn=es(Jy),em={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Zy(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=Qy[p])?!!g[p]:!1}function Ac(){return Zy}var A=ke({},Ic,{key:function(p){if(p.key){var g=em[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=qo(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Jo[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ac,charCode:function(p){return p.type==="keypress"?qo(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?qo(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),W=es(A),ne=ke({},Yl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ge=es(ne),qe=ke({},Ic,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ac}),at=es(qe),Vt=ke({},gl,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xr=es(Vt),hi=ke({},Yl,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),br=es(hi),Ys=[9,13,27,32],vs=y&&"CompositionEvent"in window,rc=null;y&&"documentMode"in document&&(rc=document.documentMode);var Qo=y&&"TextEvent"in window&&!rc,yp=y&&(!vs||rc&&8<rc&&11>=rc),tm=" ",ic=!1;function hR(p,g){switch(p){case"keyup":return Ys.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var nm=!1;function u1(p,g){switch(p){case"compositionend":return pR(g);case"keypress":return g.which!==32?null:(ic=!0,tm);case"textInput":return p=g.data,p===tm&&ic?null:p;default:return null}}function fR(p,g){if(nm)return p==="compositionend"||!vs&&hR(p,g)?(p=Us(),bi=Ur=hn=null,nm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return yp&&g.locale!=="ko"?null:g.data;default:return null}}var d1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mR(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!d1[p.type]:g==="textarea"}function W0(p,g,T,O){ba(O),g=sE(g,"onChange"),0<g.length&&(T=new $d("onChange","change",null,T,O),p.push({event:T,listeners:g}))}var Ep=null,jg=null;function h1(p){Y0(p,0)}function vp(p){var g=Rp(p);if(Mt(g))return p}function p1(p,g){if(p==="change")return g}var gR=!1;if(y){var z0;if(y){var Pc="oninput"in document;if(!Pc){var _R=document.createElement("div");_R.setAttribute("oninput","return;"),Pc=typeof _R.oninput=="function"}z0=Pc}else z0=!1;gR=z0&&(!document.documentMode||9<document.documentMode)}function yR(){Ep&&(Ep.detachEvent("onpropertychange",Oa),jg=Ep=null)}function Oa(p){if(p.propertyName==="value"&&vp(jg)){var g=[];W0(g,jg,p,xi(p)),jo(h1,g)}}function f1(p,g,T){p==="focusin"?(yR(),Ep=g,jg=T,Ep.attachEvent("onpropertychange",Oa)):p==="focusout"&&yR()}function m1(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return vp(jg)}function g1(p,g){if(p==="click")return vp(g)}function _1(p,g){if(p==="input"||p==="change")return vp(g)}function ER(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var _l=typeof Object.is=="function"?Object.is:ER;function Bg(p,g){if(_l(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var T=Object.keys(p),O=Object.keys(g);if(T.length!==O.length)return!1;for(O=0;O<T.length;O++){var U=T[O];if(!v.call(g,U)||!_l(p[U],g[U]))return!1}return!0}function vR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function G0(p,g){var T=vR(p);p=0;for(var O;T;){if(T.nodeType===3){if(O=p+T.textContent.length,p<=g&&O>=g)return{node:T,offset:g-p};p=O}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=vR(T)}}function SR(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?SR(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function bR(){for(var p=window,g=Qt();g instanceof p.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)p=g.contentWindow;else break;g=Qt(p.document)}return g}function Wg(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function H0(p){var g=bR(),T=p.focusedElem,O=p.selectionRange;if(g!==T&&T&&T.ownerDocument&&SR(T.ownerDocument.documentElement,T)){if(O!==null&&Wg(T)){if(g=O.start,p=O.end,p===void 0&&(p=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(p,T.value.length);else if(p=(g=T.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var U=T.textContent.length,H=Math.min(O.start,U);O=O.end===void 0?H:Math.min(O.end,U),!p.extend&&H>O&&(U=O,O=H,H=U),U=G0(T,H);var ce=G0(T,O);U&&ce&&(p.rangeCount!==1||p.anchorNode!==U.node||p.anchorOffset!==U.offset||p.focusNode!==ce.node||p.focusOffset!==ce.offset)&&(g=g.createRange(),g.setStart(U.node,U.offset),p.removeAllRanges(),H>O?(p.addRange(g),p.extend(ce.node,ce.offset)):(g.setEnd(ce.node,ce.offset),p.addRange(g)))}}for(g=[],p=T;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)p=g[T],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var y1=y&&"documentMode"in document&&11>=document.documentMode,st=null,$0=null,zg=null,K0=!1;function TR(p,g,T){var O=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;K0||st==null||st!==Qt(O)||(O=st,"selectionStart"in O&&Wg(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),zg&&Bg(zg,O)||(zg=O,O=sE($0,"onSelect"),0<O.length&&(g=new $d("onSelect","select",null,g,T),p.push({event:g,listeners:O}),g.target=st)))}function eE(p,g){var T={};return T[p.toLowerCase()]=g.toLowerCase(),T["Webkit"+p]="webkit"+g,T["Moz"+p]="moz"+g,T}var rm={animationend:eE("Animation","AnimationEnd"),animationiteration:eE("Animation","AnimationIteration"),animationstart:eE("Animation","AnimationStart"),transitionend:eE("Transition","TransitionEnd")},q0={},wR={};y&&(wR=document.createElement("div").style,"AnimationEvent"in window||(delete rm.animationend.animation,delete rm.animationiteration.animation,delete rm.animationstart.animation),"TransitionEvent"in window||delete rm.transitionend.transition);function Sp(p){if(q0[p])return q0[p];if(!rm[p])return p;var g=rm[p],T;for(T in g)if(g.hasOwnProperty(T)&&T in wR)return q0[p]=g[T];return p}var bp=Sp("animationend"),CR=Sp("animationiteration"),RR=Sp("animationstart"),IR=Sp("transitionend"),AR=new Map,tE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Kd(p,g){AR.set(p,g),d(g,[p])}for(var nE=0;nE<tE.length;nE++){var sc=tE[nE],E1=sc.toLowerCase(),Gg=sc[0].toUpperCase()+sc.slice(1);Kd(E1,"on"+Gg)}Kd(bp,"onAnimationEnd"),Kd(CR,"onAnimationIteration"),Kd(RR,"onAnimationStart"),Kd("dblclick","onDoubleClick"),Kd("focusin","onFocus"),Kd("focusout","onBlur"),Kd(IR,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),v1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hg));function PR(p,g,T){var O=p.type||"unknown-event";p.currentTarget=T,hp(O,g,void 0,p),p.currentTarget=null}function Y0(p,g){g=(g&4)!==0;for(var T=0;T<p.length;T++){var O=p[T],U=O.event;O=O.listeners;e:{var H=void 0;if(g)for(var ce=O.length-1;0<=ce;ce--){var Ae=O[ce],Ue=Ae.instance,rt=Ae.currentTarget;if(Ae=Ae.listener,Ue!==H&&U.isPropagationStopped())break e;PR(U,Ae,rt),H=Ue}else for(ce=0;ce<O.length;ce++){if(Ae=O[ce],Ue=Ae.instance,rt=Ae.currentTarget,Ae=Ae.listener,Ue!==H&&U.isPropagationStopped())break e;PR(U,Ae,rt),H=Ue}}}if(Ca)throw p=Ud,Ca=!1,Ud=null,p}function Pi(p,g){var T=g[Yg];T===void 0&&(T=g[Yg]=new Set);var O=p+"__bubble";T.has(O)||(OR(g,p,2,!1),T.add(O))}function X0(p,g,T){var O=0;g&&(O|=4),OR(T,p,O,g)}var rE="_reactListening"+Math.random().toString(36).slice(2);function Tp(p){if(!p[rE]){p[rE]=!0,a.forEach(function(T){T!=="selectionchange"&&(v1.has(T)||X0(T,!1,p),X0(T,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[rE]||(g[rE]=!0,X0("selectionchange",!1,g))}}function OR(p,g,T,O){switch(Gr(g)){case 1:var U=De;break;case 4:U=nt;break;default:U=Jt}T=U.bind(null,g,T,p),U=void 0,!ys||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(U=!0),O?U!==void 0?p.addEventListener(g,T,{capture:!0,passive:U}):p.addEventListener(g,T,!0):U!==void 0?p.addEventListener(g,T,{passive:U}):p.addEventListener(g,T,!1)}function iE(p,g,T,O,U){var H=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ce=O.tag;if(ce===3||ce===4){var Ae=O.stateNode.containerInfo;if(Ae===U||Ae.nodeType===8&&Ae.parentNode===U)break;if(ce===4)for(ce=O.return;ce!==null;){var Ue=ce.tag;if((Ue===3||Ue===4)&&(Ue=ce.stateNode.containerInfo,Ue===U||Ue.nodeType===8&&Ue.parentNode===U))return;ce=ce.return}for(;Ae!==null;){if(ce=Cp(Ae),ce===null)return;if(Ue=ce.tag,Ue===5||Ue===6){O=H=ce;continue e}Ae=Ae.parentNode}}O=O.return}jo(function(){var rt=H,Pt=xi(T),kt=[];e:{var At=AR.get(p);if(At!==void 0){var Yt=$d,nn=p;switch(p){case"keypress":if(qo(T)===0)break e;case"keydown":case"keyup":Yt=W;break;case"focusin":nn="focus",Yt=Zf;break;case"focusout":nn="blur",Yt=Zf;break;case"beforeblur":case"afterblur":Yt=Zf;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Yt=Jf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Yt=Xy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Yt=at;break;case bp:case CR:case RR:Yt=Ku;break;case IR:Yt=Xr;break;case"scroll":Yt=Ug;break;case"wheel":Yt=br;break;case"copy":case"cut":case"paste":Yt=Fg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Yt=ge}var rn=(g&4)!==0,ns=!rn&&p==="scroll",Xe=rn?At!==null?At+"Capture":null:At;rn=[];for(var Ve=rt,et;Ve!==null;){et=Ve;var xt=et.stateNode;if(et.tag===5&&xt!==null&&(et=xt,Xe!==null&&(xt=Bi(Ve,Xe),xt!=null&&rn.push(im(Ve,xt,et)))),ns)break;Ve=Ve.return}0<rn.length&&(At=new Yt(At,nn,null,T,Pt),kt.push({event:At,listeners:rn}))}}if((g&7)===0){e:{if(At=p==="mouseover"||p==="pointerover",Yt=p==="mouseout"||p==="pointerout",At&&T!==or&&(nn=T.relatedTarget||T.fromElement)&&(Cp(nn)||nn[Oc]))break e;if((Yt||At)&&(At=Pt.window===Pt?Pt:(At=Pt.ownerDocument)?At.defaultView||At.parentWindow:window,Yt?(nn=T.relatedTarget||T.toElement,Yt=rt,nn=nn?Cp(nn):null,nn!==null&&(ns=qs(nn),nn!==ns||nn.tag!==5&&nn.tag!==6)&&(nn=null)):(Yt=null,nn=rt),Yt!==nn)){if(rn=Jf,xt="onMouseLeave",Xe="onMouseEnter",Ve="mouse",(p==="pointerout"||p==="pointerover")&&(rn=ge,xt="onPointerLeave",Xe="onPointerEnter",Ve="pointer"),ns=Yt==null?At:Rp(Yt),et=nn==null?At:Rp(nn),At=new rn(xt,Ve+"leave",Yt,T,Pt),At.target=ns,At.relatedTarget=et,xt=null,Cp(Pt)===rt&&(rn=new rn(Xe,Ve+"enter",nn,T,Pt),rn.target=et,rn.relatedTarget=ns,xt=rn),ns=xt,Yt&&nn)t:{for(rn=Yt,Xe=nn,Ve=0,et=rn;et;et=wp(et))Ve++;for(et=0,xt=Xe;xt;xt=wp(xt))et++;for(;0<Ve-et;)rn=wp(rn),Ve--;for(;0<et-Ve;)Xe=wp(Xe),et--;for(;Ve--;){if(rn===Xe||Xe!==null&&rn===Xe.alternate)break t;rn=wp(rn),Xe=wp(Xe)}rn=null}else rn=null;Yt!==null&&$g(kt,At,Yt,rn,!1),nn!==null&&ns!==null&&$g(kt,ns,nn,rn,!0)}}e:{if(At=rt?Rp(rt):window,Yt=At.nodeName&&At.nodeName.toLowerCase(),Yt==="select"||Yt==="input"&&At.type==="file")var an=p1;else if(mR(At))if(gR)an=_1;else{an=m1;var gn=f1}else(Yt=At.nodeName)&&Yt.toLowerCase()==="input"&&(At.type==="checkbox"||At.type==="radio")&&(an=g1);if(an&&(an=an(p,rt))){W0(kt,an,T,Pt);break e}gn&&gn(p,At,rt),p==="focusout"&&(gn=At._wrapperState)&&gn.controlled&&At.type==="number"&&Fe(At,"number",At.value)}switch(gn=rt?Rp(rt):window,p){case"focusin":(mR(gn)||gn.contentEditable==="true")&&(st=gn,$0=rt,zg=null);break;case"focusout":zg=$0=st=null;break;case"mousedown":K0=!0;break;case"contextmenu":case"mouseup":case"dragend":K0=!1,TR(kt,T,Pt);break;case"selectionchange":if(y1)break;case"keydown":case"keyup":TR(kt,T,Pt)}var vn;if(vs)e:{switch(p){case"compositionstart":var Un="onCompositionStart";break e;case"compositionend":Un="onCompositionEnd";break e;case"compositionupdate":Un="onCompositionUpdate";break e}Un=void 0}else nm?hR(p,T)&&(Un="onCompositionEnd"):p==="keydown"&&T.keyCode===229&&(Un="onCompositionStart");Un&&(yp&&T.locale!=="ko"&&(nm||Un!=="onCompositionStart"?Un==="onCompositionEnd"&&nm&&(vn=Us()):(hn=Pt,Ur="value"in hn?hn.value:hn.textContent,nm=!0)),gn=sE(rt,Un),0<gn.length&&(Un=new Wn(Un,p,null,T,Pt),kt.push({event:Un,listeners:gn}),vn?Un.data=vn:(vn=pR(T),vn!==null&&(Un.data=vn)))),(vn=Qo?u1(p,T):fR(p,T))&&(rt=sE(rt,"onBeforeInput"),0<rt.length&&(Pt=new Wn("onBeforeInput","beforeinput",null,T,Pt),kt.push({event:Pt,listeners:rt}),Pt.data=vn))}Y0(kt,g)})}function im(p,g,T){return{instance:p,listener:g,currentTarget:T}}function sE(p,g){for(var T=g+"Capture",O=[];p!==null;){var U=p,H=U.stateNode;U.tag===5&&H!==null&&(U=H,H=Bi(p,T),H!=null&&O.unshift(im(p,H,U)),H=Bi(p,g),H!=null&&O.push(im(p,H,U))),p=p.return}return O}function wp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function $g(p,g,T,O,U){for(var H=g._reactName,ce=[];T!==null&&T!==O;){var Ae=T,Ue=Ae.alternate,rt=Ae.stateNode;if(Ue!==null&&Ue===O)break;Ae.tag===5&&rt!==null&&(Ae=rt,U?(Ue=Bi(T,H),Ue!=null&&ce.unshift(im(T,Ue,Ae))):U||(Ue=Bi(T,H),Ue!=null&&ce.push(im(T,Ue,Ae)))),T=T.return}ce.length!==0&&p.push({event:g,listeners:ce})}var S1=/\r\n?/g,b1=/\u0000|\uFFFD/g;function kR(p){return(typeof p=="string"?p:""+p).replace(S1,`
`).replace(b1,"")}function oE(p,g,T){if(g=kR(g),kR(p)!==g&&T)throw Error(s(425))}function aE(){}var cE=null,Kg=null;function J0(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var qg=typeof setTimeout=="function"?setTimeout:void 0,T1=typeof clearTimeout=="function"?clearTimeout:void 0,NR=typeof Promise=="function"?Promise:void 0,w1=typeof queueMicrotask=="function"?queueMicrotask:typeof NR<"u"?function(p){return NR.resolve(null).then(p).catch(C1)}:qg;function C1(p){setTimeout(function(){throw p})}function Q0(p,g){var T=g,O=0;do{var U=T.nextSibling;if(p.removeChild(T),U&&U.nodeType===8)if(T=U.data,T==="/$"){if(O===0){p.removeChild(U),Pa(g);return}O--}else T!=="$"&&T!=="$?"&&T!=="$!"||O++;T=U}while(T);Pa(g)}function qd(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function DR(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var T=p.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return p;g--}else T==="/$"&&g++}p=p.previousSibling}return null}var sm=Math.random().toString(36).slice(2),Xl="__reactFiber$"+sm,Yd="__reactProps$"+sm,Oc="__reactContainer$"+sm,Yg="__reactEvents$"+sm,R1="__reactListeners$"+sm,I1="__reactHandles$"+sm;function Cp(p){var g=p[Xl];if(g)return g;for(var T=p.parentNode;T;){if(g=T[Oc]||T[Xl]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(p=DR(p);p!==null;){if(T=p[Xl])return T;p=DR(p)}return g}p=T,T=p.parentNode}return null}function om(p){return p=p[Xl]||p[Oc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Rp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function am(p){return p[Yd]||null}var Z0=[],cm=-1;function kc(p){return{current:p}}function Oi(p){0>cm||(p.current=Z0[cm],Z0[cm]=null,cm--)}function Ti(p,g){cm++,Z0[cm]=p.current,p.current=g}var Xd={},bo=kc(Xd),ka=kc(!1),Ip=Xd;function Ap(p,g){var T=p.type.contextTypes;if(!T)return Xd;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var U={},H;for(H in T)U[H]=g[H];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=U),U}function Na(p){return p=p.childContextTypes,p!=null}function lE(){Oi(ka),Oi(bo)}function LR(p,g,T){if(bo.current!==Xd)throw Error(s(168));Ti(bo,g),Ti(ka,T)}function uE(p,g,T){var O=p.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return T;O=O.getChildContext();for(var U in O)if(!(U in g))throw Error(s(108,tt(p)||"Unknown",U));return ke({},T,O)}function dE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Xd,Ip=bo.current,Ti(bo,p),Ti(ka,ka.current),!0}function xR(p,g,T){var O=p.stateNode;if(!O)throw Error(s(169));T?(p=uE(p,g,Ip),O.__reactInternalMemoizedMergedChildContext=p,Oi(ka),Oi(bo),Ti(bo,p)):Oi(ka),Ti(ka,T)}var Nc=null,hE=!1,eb=!1;function MR(p){Nc===null?Nc=[p]:Nc.push(p)}function A1(p){hE=!0,MR(p)}function Jd(){if(!eb&&Nc!==null){eb=!0;var p=0,g=ar;try{var T=Nc;for(ar=1;p<T.length;p++){var O=T[p];do O=O(!0);while(O!==null)}Nc=null,hE=!1}catch(U){throw Nc!==null&&(Nc=Nc.slice(p+1)),jd(wc,Jd),U}finally{ar=g,eb=!1}}return null}var lm=[],Yu=0,Xg=null,pE=0,Dc=[],oc=0,Pp=null,Xu=1,Ju="";function Qu(p,g){lm[Yu++]=pE,lm[Yu++]=Xg,Xg=p,pE=g}function fE(p,g,T){Dc[oc++]=Xu,Dc[oc++]=Ju,Dc[oc++]=Pp,Pp=p;var O=Xu;p=Ju;var U=32-io(O)-1;O&=~(1<<U),T+=1;var H=32-io(g)+U;if(30<H){var ce=U-U%5;H=(O&(1<<ce)-1).toString(32),O>>=ce,U-=ce,Xu=1<<32-io(g)+U|T<<U|O,Ju=H+p}else Xu=1<<H|T<<U|O,Ju=p}function mE(p){p.return!==null&&(Qu(p,1),fE(p,1,0))}function Jg(p){for(;p===Xg;)Xg=lm[--Yu],lm[Yu]=null,pE=lm[--Yu],lm[Yu]=null;for(;p===Pp;)Pp=Dc[--oc],Dc[oc]=null,Ju=Dc[--oc],Dc[oc]=null,Xu=Dc[--oc],Dc[oc]=null}var Da=null,La=null,pi=!1,Zo=null;function UR(p,g){var T=lc(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=p,g=p.deletions,g===null?(p.deletions=[T],p.flags|=16):g.push(T)}function VR(p,g){switch(p.tag){case 5:var T=p.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,Da=p,La=qd(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,Da=p,La=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=Pp!==null?{id:Xu,overflow:Ju}:null,p.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=lc(18,null,null,0),T.stateNode=g,T.return=p,p.child=T,Da=p,La=null,!0):!1;default:return!1}}function gE(p){return(p.mode&1)!==0&&(p.flags&128)===0}function tb(p){if(pi){var g=La;if(g){var T=g;if(!VR(p,g)){if(gE(p))throw Error(s(418));g=qd(T.nextSibling);var O=Da;g&&VR(p,g)?UR(O,T):(p.flags=p.flags&-4097|2,pi=!1,Da=p)}}else{if(gE(p))throw Error(s(418));p.flags=p.flags&-4097|2,pi=!1,Da=p}}}function FR(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Da=p}function Qg(p){if(p!==Da)return!1;if(!pi)return FR(p),pi=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!J0(p.type,p.memoizedProps)),g&&(g=La)){if(gE(p))throw jR(),Error(s(418));for(;g;)UR(p,g),g=qd(g.nextSibling)}if(FR(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var T=p.data;if(T==="/$"){if(g===0){La=qd(p.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}p=p.nextSibling}La=null}}else La=Da?qd(p.stateNode.nextSibling):null;return!0}function jR(){for(var p=La;p;)p=qd(p.nextSibling)}function um(){La=Da=null,pi=!1}function nb(p){Zo===null?Zo=[p]:Zo.push(p)}var P1=ue.ReactCurrentBatchConfig;function Zg(p,g,T){if(p=T.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(s(309));var O=T.stateNode}if(!O)throw Error(s(147,p));var U=O,H=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(ce){var Ae=U.refs;ce===null?delete Ae[H]:Ae[H]=ce},g._stringRef=H,g)}if(typeof p!="string")throw Error(s(284));if(!T._owner)throw Error(s(290,p))}return p}function _E(p,g){throw p=Object.prototype.toString.call(g),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function rb(p){var g=p._init;return g(p._payload)}function Qd(p){function g(Xe,Ve){if(p){var et=Xe.deletions;et===null?(Xe.deletions=[Ve],Xe.flags|=16):et.push(Ve)}}function T(Xe,Ve){if(!p)return null;for(;Ve!==null;)g(Xe,Ve),Ve=Ve.sibling;return null}function O(Xe,Ve){for(Xe=new Map;Ve!==null;)Ve.key!==null?Xe.set(Ve.key,Ve):Xe.set(Ve.index,Ve),Ve=Ve.sibling;return Xe}function U(Xe,Ve){return Xe=od(Xe,Ve),Xe.index=0,Xe.sibling=null,Xe}function H(Xe,Ve,et){return Xe.index=et,p?(et=Xe.alternate,et!==null?(et=et.index,et<Ve?(Xe.flags|=2,Ve):et):(Xe.flags|=2,Ve)):(Xe.flags|=1048576,Ve)}function ce(Xe){return p&&Xe.alternate===null&&(Xe.flags|=2),Xe}function Ae(Xe,Ve,et,xt){return Ve===null||Ve.tag!==6?(Ve=jb(et,Xe.mode,xt),Ve.return=Xe,Ve):(Ve=U(Ve,et),Ve.return=Xe,Ve)}function Ue(Xe,Ve,et,xt){var an=et.type;return an===q?Pt(Xe,Ve,et.props.children,xt,et.key):Ve!==null&&(Ve.elementType===an||typeof an=="object"&&an!==null&&an.$$typeof===$e&&rb(an)===Ve.type)?(xt=U(Ve,et.props),xt.ref=Zg(Xe,Ve,et),xt.return=Xe,xt):(xt=rv(et.type,et.key,et.props,null,Xe.mode,xt),xt.ref=Zg(Xe,Ve,et),xt.return=Xe,xt)}function rt(Xe,Ve,et,xt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==et.containerInfo||Ve.stateNode.implementation!==et.implementation?(Ve=Bb(et,Xe.mode,xt),Ve.return=Xe,Ve):(Ve=U(Ve,et.children||[]),Ve.return=Xe,Ve)}function Pt(Xe,Ve,et,xt,an){return Ve===null||Ve.tag!==7?(Ve=Bp(et,Xe.mode,xt,an),Ve.return=Xe,Ve):(Ve=U(Ve,et),Ve.return=Xe,Ve)}function kt(Xe,Ve,et){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=jb(""+Ve,Xe.mode,et),Ve.return=Xe,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case re:return et=rv(Ve.type,Ve.key,Ve.props,null,Xe.mode,et),et.ref=Zg(Xe,null,Ve),et.return=Xe,et;case fe:return Ve=Bb(Ve,Xe.mode,et),Ve.return=Xe,Ve;case $e:var xt=Ve._init;return kt(Xe,xt(Ve._payload),et)}if(Ge(Ve)||Ee(Ve))return Ve=Bp(Ve,Xe.mode,et,null),Ve.return=Xe,Ve;_E(Xe,Ve)}return null}function At(Xe,Ve,et,xt){var an=Ve!==null?Ve.key:null;if(typeof et=="string"&&et!==""||typeof et=="number")return an!==null?null:Ae(Xe,Ve,""+et,xt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case re:return et.key===an?Ue(Xe,Ve,et,xt):null;case fe:return et.key===an?rt(Xe,Ve,et,xt):null;case $e:return an=et._init,At(Xe,Ve,an(et._payload),xt)}if(Ge(et)||Ee(et))return an!==null?null:Pt(Xe,Ve,et,xt,null);_E(Xe,et)}return null}function Yt(Xe,Ve,et,xt,an){if(typeof xt=="string"&&xt!==""||typeof xt=="number")return Xe=Xe.get(et)||null,Ae(Ve,Xe,""+xt,an);if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case re:return Xe=Xe.get(xt.key===null?et:xt.key)||null,Ue(Ve,Xe,xt,an);case fe:return Xe=Xe.get(xt.key===null?et:xt.key)||null,rt(Ve,Xe,xt,an);case $e:var gn=xt._init;return Yt(Xe,Ve,et,gn(xt._payload),an)}if(Ge(xt)||Ee(xt))return Xe=Xe.get(et)||null,Pt(Ve,Xe,xt,an,null);_E(Ve,xt)}return null}function nn(Xe,Ve,et,xt){for(var an=null,gn=null,vn=Ve,Un=Ve=0,Cs=null;vn!==null&&Un<et.length;Un++){vn.index>Un?(Cs=vn,vn=null):Cs=vn.sibling;var Tr=At(Xe,vn,et[Un],xt);if(Tr===null){vn===null&&(vn=Cs);break}p&&vn&&Tr.alternate===null&&g(Xe,vn),Ve=H(Tr,Ve,Un),gn===null?an=Tr:gn.sibling=Tr,gn=Tr,vn=Cs}if(Un===et.length)return T(Xe,vn),pi&&Qu(Xe,Un),an;if(vn===null){for(;Un<et.length;Un++)vn=kt(Xe,et[Un],xt),vn!==null&&(Ve=H(vn,Ve,Un),gn===null?an=vn:gn.sibling=vn,gn=vn);return pi&&Qu(Xe,Un),an}for(vn=O(Xe,vn);Un<et.length;Un++)Cs=Yt(vn,Xe,Un,et[Un],xt),Cs!==null&&(p&&Cs.alternate!==null&&vn.delete(Cs.key===null?Un:Cs.key),Ve=H(Cs,Ve,Un),gn===null?an=Cs:gn.sibling=Cs,gn=Cs);return p&&vn.forEach(function(lh){return g(Xe,lh)}),pi&&Qu(Xe,Un),an}function rn(Xe,Ve,et,xt){var an=Ee(et);if(typeof an!="function")throw Error(s(150));if(et=an.call(et),et==null)throw Error(s(151));for(var gn=an=null,vn=Ve,Un=Ve=0,Cs=null,Tr=et.next();vn!==null&&!Tr.done;Un++,Tr=et.next()){vn.index>Un?(Cs=vn,vn=null):Cs=vn.sibling;var lh=At(Xe,vn,Tr.value,xt);if(lh===null){vn===null&&(vn=Cs);break}p&&vn&&lh.alternate===null&&g(Xe,vn),Ve=H(lh,Ve,Un),gn===null?an=lh:gn.sibling=lh,gn=lh,vn=Cs}if(Tr.done)return T(Xe,vn),pi&&Qu(Xe,Un),an;if(vn===null){for(;!Tr.done;Un++,Tr=et.next())Tr=kt(Xe,Tr.value,xt),Tr!==null&&(Ve=H(Tr,Ve,Un),gn===null?an=Tr:gn.sibling=Tr,gn=Tr);return pi&&Qu(Xe,Un),an}for(vn=O(Xe,vn);!Tr.done;Un++,Tr=et.next())Tr=Yt(vn,Xe,Un,Tr.value,xt),Tr!==null&&(p&&Tr.alternate!==null&&vn.delete(Tr.key===null?Un:Tr.key),Ve=H(Tr,Ve,Un),gn===null?an=Tr:gn.sibling=Tr,gn=Tr);return p&&vn.forEach(function(H1){return g(Xe,H1)}),pi&&Qu(Xe,Un),an}function ns(Xe,Ve,et,xt){if(typeof et=="object"&&et!==null&&et.type===q&&et.key===null&&(et=et.props.children),typeof et=="object"&&et!==null){switch(et.$$typeof){case re:e:{for(var an=et.key,gn=Ve;gn!==null;){if(gn.key===an){if(an=et.type,an===q){if(gn.tag===7){T(Xe,gn.sibling),Ve=U(gn,et.props.children),Ve.return=Xe,Xe=Ve;break e}}else if(gn.elementType===an||typeof an=="object"&&an!==null&&an.$$typeof===$e&&rb(an)===gn.type){T(Xe,gn.sibling),Ve=U(gn,et.props),Ve.ref=Zg(Xe,gn,et),Ve.return=Xe,Xe=Ve;break e}T(Xe,gn);break}else g(Xe,gn);gn=gn.sibling}et.type===q?(Ve=Bp(et.props.children,Xe.mode,xt,et.key),Ve.return=Xe,Xe=Ve):(xt=rv(et.type,et.key,et.props,null,Xe.mode,xt),xt.ref=Zg(Xe,Ve,et),xt.return=Xe,Xe=xt)}return ce(Xe);case fe:e:{for(gn=et.key;Ve!==null;){if(Ve.key===gn)if(Ve.tag===4&&Ve.stateNode.containerInfo===et.containerInfo&&Ve.stateNode.implementation===et.implementation){T(Xe,Ve.sibling),Ve=U(Ve,et.children||[]),Ve.return=Xe,Xe=Ve;break e}else{T(Xe,Ve);break}else g(Xe,Ve);Ve=Ve.sibling}Ve=Bb(et,Xe.mode,xt),Ve.return=Xe,Xe=Ve}return ce(Xe);case $e:return gn=et._init,ns(Xe,Ve,gn(et._payload),xt)}if(Ge(et))return nn(Xe,Ve,et,xt);if(Ee(et))return rn(Xe,Ve,et,xt);_E(Xe,et)}return typeof et=="string"&&et!==""||typeof et=="number"?(et=""+et,Ve!==null&&Ve.tag===6?(T(Xe,Ve.sibling),Ve=U(Ve,et),Ve.return=Xe,Xe=Ve):(T(Xe,Ve),Ve=jb(et,Xe.mode,xt),Ve.return=Xe,Xe=Ve),ce(Xe)):T(Xe,Ve)}return ns}var dm=Qd(!0),BR=Qd(!1),yE=kc(null),e_=null,hm=null,EE=null;function ib(){EE=hm=e_=null}function sb(p){var g=yE.current;Oi(yE),p._currentValue=g}function ob(p,g,T){for(;p!==null;){var O=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),p===T)break;p=p.return}}function Zu(p,g){e_=p,EE=hm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Ma=!0),p.firstContext=null)}function Lc(p){var g=p._currentValue;if(EE!==p)if(p={context:p,memoizedValue:g,next:null},hm===null){if(e_===null)throw Error(s(308));hm=p,e_.dependencies={lanes:0,firstContext:p}}else hm=hm.next=p;return g}var Op=null;function ab(p){Op===null?Op=[p]:Op.push(p)}function WR(p,g,T,O){var U=g.interleaved;return U===null?(T.next=T,ab(g)):(T.next=U.next,U.next=T),g.interleaved=T,ed(p,O)}function ed(p,g){p.lanes|=g;var T=p.alternate;for(T!==null&&(T.lanes|=g),T=p,p=p.return;p!==null;)p.childLanes|=g,T=p.alternate,T!==null&&(T.childLanes|=g),T=p,p=p.return;return T.tag===3?T.stateNode:null}var Zd=!1;function t_(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zR(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Jl(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function eh(p,g,T){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(Pr&2)!==0){var U=O.pending;return U===null?g.next=g:(g.next=U.next,U.next=g),O.pending=g,ed(p,T)}return U=O.interleaved,U===null?(g.next=g,ab(O)):(g.next=U.next,U.next=g),O.interleaved=g,ed(p,T)}function n_(p,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var O=g.lanes;O&=p.pendingLanes,T|=O,g.lanes=T,nc(p,T)}}function GR(p,g){var T=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,T===O)){var U=null,H=null;if(T=T.firstBaseUpdate,T!==null){do{var ce={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};H===null?U=H=ce:H=H.next=ce,T=T.next}while(T!==null);H===null?U=H=g:H=H.next=g}else U=H=g;T={baseState:O.baseState,firstBaseUpdate:U,lastBaseUpdate:H,shared:O.shared,effects:O.effects},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=g:p.next=g,T.lastBaseUpdate=g}function vE(p,g,T,O){var U=p.updateQueue;Zd=!1;var H=U.firstBaseUpdate,ce=U.lastBaseUpdate,Ae=U.shared.pending;if(Ae!==null){U.shared.pending=null;var Ue=Ae,rt=Ue.next;Ue.next=null,ce===null?H=rt:ce.next=rt,ce=Ue;var Pt=p.alternate;Pt!==null&&(Pt=Pt.updateQueue,Ae=Pt.lastBaseUpdate,Ae!==ce&&(Ae===null?Pt.firstBaseUpdate=rt:Ae.next=rt,Pt.lastBaseUpdate=Ue))}if(H!==null){var kt=U.baseState;ce=0,Pt=rt=Ue=null,Ae=H;do{var At=Ae.lane,Yt=Ae.eventTime;if((O&At)===At){Pt!==null&&(Pt=Pt.next={eventTime:Yt,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var nn=p,rn=Ae;switch(At=g,Yt=T,rn.tag){case 1:if(nn=rn.payload,typeof nn=="function"){kt=nn.call(Yt,kt,At);break e}kt=nn;break e;case 3:nn.flags=nn.flags&-65537|128;case 0:if(nn=rn.payload,At=typeof nn=="function"?nn.call(Yt,kt,At):nn,At==null)break e;kt=ke({},kt,At);break e;case 2:Zd=!0}}Ae.callback!==null&&Ae.lane!==0&&(p.flags|=64,At=U.effects,At===null?U.effects=[Ae]:At.push(Ae))}else Yt={eventTime:Yt,lane:At,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},Pt===null?(rt=Pt=Yt,Ue=kt):Pt=Pt.next=Yt,ce|=At;if(Ae=Ae.next,Ae===null){if(Ae=U.shared.pending,Ae===null)break;At=Ae,Ae=At.next,At.next=null,U.lastBaseUpdate=At,U.shared.pending=null}}while(!0);if(Pt===null&&(Ue=kt),U.baseState=Ue,U.firstBaseUpdate=rt,U.lastBaseUpdate=Pt,g=U.shared.interleaved,g!==null){U=g;do ce|=U.lane,U=U.next;while(U!==g)}else H===null&&(U.shared.lanes=0);Mp|=ce,p.lanes=ce,p.memoizedState=kt}}function HR(p,g,T){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var O=p[g],U=O.callback;if(U!==null){if(O.callback=null,O=T,typeof U!="function")throw Error(s(191,U));U.call(O)}}}var r_={},Ql=kc(r_),i_=kc(r_),pm=kc(r_);function kp(p){if(p===r_)throw Error(s(174));return p}function cb(p,g){switch(Ti(pm,g),Ti(i_,p),Ti(Ql,r_),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:un(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=un(g,p)}Oi(Ql),Ti(Ql,g)}function Np(){Oi(Ql),Oi(i_),Oi(pm)}function $R(p){kp(pm.current);var g=kp(Ql.current),T=un(g,p.type);g!==T&&(Ti(i_,p),Ti(Ql,T))}function fm(p){i_.current===p&&(Oi(Ql),Oi(i_))}var Mi=kc(0);function th(p){for(var g=p;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var lb=[];function ub(){for(var p=0;p<lb.length;p++)lb[p]._workInProgressVersionPrimary=null;lb.length=0}var SE=ue.ReactCurrentDispatcher,db=ue.ReactCurrentBatchConfig,Zl=0,Wi=null,Ss=null,bs=null,mm=!1,s_=!1,o_=0,O1=0;function To(){throw Error(s(321))}function hb(p,g){if(g===null)return!1;for(var T=0;T<g.length&&T<p.length;T++)if(!_l(p[T],g[T]))return!1;return!0}function gm(p,g,T,O,U,H){if(Zl=H,Wi=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,SE.current=p===null||p.memoizedState===null?D1:rI,p=T(O,U),s_){H=0;do{if(s_=!1,o_=0,25<=H)throw Error(s(301));H+=1,bs=Ss=null,g.updateQueue=null,SE.current=L1,p=T(O,U)}while(s_)}if(SE.current=CE,g=Ss!==null&&Ss.next!==null,Zl=0,bs=Ss=Wi=null,mm=!1,g)throw Error(s(300));return p}function pb(){var p=o_!==0;return o_=0,p}function ea(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bs===null?Wi.memoizedState=bs=p:bs=bs.next=p,bs}function xa(){if(Ss===null){var p=Wi.alternate;p=p!==null?p.memoizedState:null}else p=Ss.next;var g=bs===null?Wi.memoizedState:bs.next;if(g!==null)bs=g,Ss=p;else{if(p===null)throw Error(s(310));Ss=p,p={memoizedState:Ss.memoizedState,baseState:Ss.baseState,baseQueue:Ss.baseQueue,queue:Ss.queue,next:null},bs===null?Wi.memoizedState=bs=p:bs=bs.next=p}return bs}function nh(p,g){return typeof g=="function"?g(p):g}function Dp(p){var g=xa(),T=g.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var O=Ss,U=O.baseQueue,H=T.pending;if(H!==null){if(U!==null){var ce=U.next;U.next=H.next,H.next=ce}O.baseQueue=U=H,T.pending=null}if(U!==null){H=U.next,O=O.baseState;var Ae=ce=null,Ue=null,rt=H;do{var Pt=rt.lane;if((Zl&Pt)===Pt)Ue!==null&&(Ue=Ue.next={lane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),O=rt.hasEagerState?rt.eagerState:p(O,rt.action);else{var kt={lane:Pt,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null};Ue===null?(Ae=Ue=kt,ce=O):Ue=Ue.next=kt,Wi.lanes|=Pt,Mp|=Pt}rt=rt.next}while(rt!==null&&rt!==H);Ue===null?ce=O:Ue.next=Ae,_l(O,g.memoizedState)||(Ma=!0),g.memoizedState=O,g.baseState=ce,g.baseQueue=Ue,T.lastRenderedState=O}if(p=T.interleaved,p!==null){U=p;do H=U.lane,Wi.lanes|=H,Mp|=H,U=U.next;while(U!==p)}else U===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function _m(p){var g=xa(),T=g.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var O=T.dispatch,U=T.pending,H=g.memoizedState;if(U!==null){T.pending=null;var ce=U=U.next;do H=p(H,ce.action),ce=ce.next;while(ce!==U);_l(H,g.memoizedState)||(Ma=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),T.lastRenderedState=H}return[H,O]}function KR(){}function fb(p,g){var T=Wi,O=xa(),U=g(),H=!_l(O.memoizedState,U);if(H&&(O.memoizedState=U,Ma=!0),O=O.queue,xc(YR.bind(null,T,O,p),[p]),O.getSnapshot!==g||H||bs!==null&&bs.memoizedState.tag&1){if(T.flags|=2048,a_(9,mb.bind(null,T,O,U,g),void 0,null),Xs===null)throw Error(s(349));(Zl&30)!==0||qR(T,g,U)}return U}function qR(p,g,T){p.flags|=16384,p={getSnapshot:g,value:T},g=Wi.updateQueue,g===null?(g={lastEffect:null,stores:null},Wi.updateQueue=g,g.stores=[p]):(T=g.stores,T===null?g.stores=[p]:T.push(p))}function mb(p,g,T,O){g.value=T,g.getSnapshot=O,XR(g)&&bE(p)}function YR(p,g,T){return T(function(){XR(g)&&bE(p)})}function XR(p){var g=p.getSnapshot;p=p.value;try{var T=g();return!_l(p,T)}catch{return!0}}function bE(p){var g=ed(p,1);g!==null&&Fc(g,p,1,-1)}function TE(p){var g=ea();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:nh,lastRenderedState:p},g.queue=p,p=p.dispatch=N1.bind(null,Wi,p),[g.memoizedState,p]}function a_(p,g,T,O){return p={tag:p,create:g,destroy:T,deps:O,next:null},g=Wi.updateQueue,g===null?(g={lastEffect:null,stores:null},Wi.updateQueue=g,g.lastEffect=p.next=p):(T=g.lastEffect,T===null?g.lastEffect=p.next=p:(O=T.next,T.next=p,p.next=O,g.lastEffect=p)),p}function JR(){return xa().memoizedState}function c_(p,g,T,O){var U=ea();Wi.flags|=p,U.memoizedState=a_(1|g,T,void 0,O===void 0?null:O)}function ym(p,g,T,O){var U=xa();O=O===void 0?null:O;var H=void 0;if(Ss!==null){var ce=Ss.memoizedState;if(H=ce.destroy,O!==null&&hb(O,ce.deps)){U.memoizedState=a_(g,T,H,O);return}}Wi.flags|=p,U.memoizedState=a_(1|g,T,H,O)}function QR(p,g){return c_(8390656,8,p,g)}function xc(p,g){return ym(2048,8,p,g)}function Lp(p,g){return ym(4,2,p,g)}function rh(p,g){return ym(4,4,p,g)}function gb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function _b(p,g,T){return T=T!=null?T.concat([p]):null,ym(4,4,gb.bind(null,g,p),T)}function td(){}function wE(p,g){var T=xa();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&hb(g,O[1])?O[0]:(T.memoizedState=[p,g],p)}function ZR(p,g){var T=xa();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&hb(g,O[1])?O[0]:(p=p(),T.memoizedState=[p,g],p)}function yb(p,g,T){return(Zl&21)===0?(p.baseState&&(p.baseState=!1,Ma=!0),p.memoizedState=T):(_l(T,g)||(T=Wu(),Wi.lanes|=T,Mp|=T,p.baseState=!0),g)}function k1(p,g){var T=ar;ar=T!==0&&4>T?T:4,p(!0);var O=db.transition;db.transition={};try{p(!1),g()}finally{ar=T,db.transition=O}}function Eb(){return xa().memoizedState}function eI(p,g,T){var O=Vc(p);if(T={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null},nd(p))tI(g,T);else if(T=WR(p,g,T,O),T!==null){var U=ao();Fc(T,p,O,U),nI(T,g,O)}}function N1(p,g,T){var O=Vc(p),U={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null};if(nd(p))tI(g,U);else{var H=p.alternate;if(p.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var ce=g.lastRenderedState,Ae=H(ce,T);if(U.hasEagerState=!0,U.eagerState=Ae,_l(Ae,ce)){var Ue=g.interleaved;Ue===null?(U.next=U,ab(g)):(U.next=Ue.next,Ue.next=U),g.interleaved=U;return}}catch{}finally{}T=WR(p,g,U,O),T!==null&&(U=ao(),Fc(T,p,O,U),nI(T,g,O))}}function nd(p){var g=p.alternate;return p===Wi||g!==null&&g===Wi}function tI(p,g){s_=mm=!0;var T=p.pending;T===null?g.next=g:(g.next=T.next,T.next=g),p.pending=g}function nI(p,g,T){if((T&4194240)!==0){var O=g.lanes;O&=p.pendingLanes,T|=O,g.lanes=T,nc(p,T)}}var CE={readContext:Lc,useCallback:To,useContext:To,useEffect:To,useImperativeHandle:To,useInsertionEffect:To,useLayoutEffect:To,useMemo:To,useReducer:To,useRef:To,useState:To,useDebugValue:To,useDeferredValue:To,useTransition:To,useMutableSource:To,useSyncExternalStore:To,useId:To,unstable_isNewReconciler:!1},D1={readContext:Lc,useCallback:function(p,g){return ea().memoizedState=[p,g===void 0?null:g],p},useContext:Lc,useEffect:QR,useImperativeHandle:function(p,g,T){return T=T!=null?T.concat([p]):null,c_(4194308,4,gb.bind(null,g,p),T)},useLayoutEffect:function(p,g){return c_(4194308,4,p,g)},useInsertionEffect:function(p,g){return c_(4,2,p,g)},useMemo:function(p,g){var T=ea();return g=g===void 0?null:g,p=p(),T.memoizedState=[p,g],p},useReducer:function(p,g,T){var O=ea();return g=T!==void 0?T(g):g,O.memoizedState=O.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},O.queue=p,p=p.dispatch=eI.bind(null,Wi,p),[O.memoizedState,p]},useRef:function(p){var g=ea();return p={current:p},g.memoizedState=p},useState:TE,useDebugValue:td,useDeferredValue:function(p){return ea().memoizedState=p},useTransition:function(){var p=TE(!1),g=p[0];return p=k1.bind(null,p[1]),ea().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,T){var O=Wi,U=ea();if(pi){if(T===void 0)throw Error(s(407));T=T()}else{if(T=g(),Xs===null)throw Error(s(349));(Zl&30)!==0||qR(O,g,T)}U.memoizedState=T;var H={value:T,getSnapshot:g};return U.queue=H,QR(YR.bind(null,O,H,p),[p]),O.flags|=2048,a_(9,mb.bind(null,O,H,T,g),void 0,null),T},useId:function(){var p=ea(),g=Xs.identifierPrefix;if(pi){var T=Ju,O=Xu;T=(O&~(1<<32-io(O)-1)).toString(32)+T,g=":"+g+"R"+T,T=o_++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=O1++,g=":"+g+"r"+T.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},rI={readContext:Lc,useCallback:wE,useContext:Lc,useEffect:xc,useImperativeHandle:_b,useInsertionEffect:Lp,useLayoutEffect:rh,useMemo:ZR,useReducer:Dp,useRef:JR,useState:function(){return Dp(nh)},useDebugValue:td,useDeferredValue:function(p){var g=xa();return yb(g,Ss.memoizedState,p)},useTransition:function(){var p=Dp(nh)[0],g=xa().memoizedState;return[p,g]},useMutableSource:KR,useSyncExternalStore:fb,useId:Eb,unstable_isNewReconciler:!1},L1={readContext:Lc,useCallback:wE,useContext:Lc,useEffect:xc,useImperativeHandle:_b,useInsertionEffect:Lp,useLayoutEffect:rh,useMemo:ZR,useReducer:_m,useRef:JR,useState:function(){return _m(nh)},useDebugValue:td,useDeferredValue:function(p){var g=xa();return Ss===null?g.memoizedState=p:yb(g,Ss.memoizedState,p)},useTransition:function(){var p=_m(nh)[0],g=xa().memoizedState;return[p,g]},useMutableSource:KR,useSyncExternalStore:fb,useId:Eb,unstable_isNewReconciler:!1};function ac(p,g){if(p&&p.defaultProps){g=ke({},g),p=p.defaultProps;for(var T in p)g[T]===void 0&&(g[T]=p[T]);return g}return g}function RE(p,g,T,O){g=p.memoizedState,T=T(O,g),T=T==null?g:ke({},g,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}var IE={isMounted:function(p){return(p=p._reactInternals)?qs(p)===p:!1},enqueueSetState:function(p,g,T){p=p._reactInternals;var O=ao(),U=Vc(p),H=Jl(O,U);H.payload=g,T!=null&&(H.callback=T),g=eh(p,H,U),g!==null&&(Fc(g,p,U,O),n_(g,p,U))},enqueueReplaceState:function(p,g,T){p=p._reactInternals;var O=ao(),U=Vc(p),H=Jl(O,U);H.tag=1,H.payload=g,T!=null&&(H.callback=T),g=eh(p,H,U),g!==null&&(Fc(g,p,U,O),n_(g,p,U))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var T=ao(),O=Vc(p),U=Jl(T,O);U.tag=2,g!=null&&(U.callback=g),g=eh(p,U,O),g!==null&&(Fc(g,p,O,T),n_(g,p,O))}};function vb(p,g,T,O,U,H,ce){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,H,ce):g.prototype&&g.prototype.isPureReactComponent?!Bg(T,O)||!Bg(U,H):!0}function iI(p,g,T){var O=!1,U=Xd,H=g.contextType;return typeof H=="object"&&H!==null?H=Lc(H):(U=Na(g)?Ip:bo.current,O=g.contextTypes,H=(O=O!=null)?Ap(p,U):Xd),g=new g(T,H),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=IE,p.stateNode=g,g._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=U,p.__reactInternalMemoizedMaskedChildContext=H),g}function sI(p,g,T,O){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,O),g.state!==p&&IE.enqueueReplaceState(g,g.state,null)}function Sb(p,g,T,O){var U=p.stateNode;U.props=T,U.state=p.memoizedState,U.refs={},t_(p);var H=g.contextType;typeof H=="object"&&H!==null?U.context=Lc(H):(H=Na(g)?Ip:bo.current,U.context=Ap(p,H)),U.state=p.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(RE(p,g,H,T),U.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(g=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),g!==U.state&&IE.enqueueReplaceState(U,U.state,null),vE(p,T,U,O),U.state=p.memoizedState),typeof U.componentDidMount=="function"&&(p.flags|=4194308)}function Em(p,g){try{var T="",O=g;do T+=ze(O),O=O.return;while(O);var U=T}catch(H){U=`
Error generating stack: `+H.message+`
`+H.stack}return{value:p,source:g,stack:U,digest:null}}function bb(p,g,T){return{value:p,source:null,stack:T??null,digest:g??null}}function Tb(p,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var x1=typeof WeakMap=="function"?WeakMap:Map;function wb(p,g,T){T=Jl(-1,T),T.tag=3,T.payload={element:null};var O=g.value;return T.callback=function(){HE||(HE=!0,xb=O),Tb(p,g)},T}function rd(p,g,T){T=Jl(-1,T),T.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var U=g.value;T.payload=function(){return O(U)},T.callback=function(){Tb(p,g)}}var H=p.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(T.callback=function(){Tb(p,g),typeof O!="function"&&(ih===null?ih=new Set([this]):ih.add(this));var ce=g.stack;this.componentDidCatch(g.value,{componentStack:ce!==null?ce:""})}),T}function oI(p,g,T){var O=p.pingCache;if(O===null){O=p.pingCache=new x1;var U=new Set;O.set(g,U)}else U=O.get(g),U===void 0&&(U=new Set,O.set(g,U));U.has(T)||(U.add(T),p=OI.bind(null,p,g,T),g.then(p,p))}function aI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function cI(p,g,T,O,U){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=Jl(-1,1),g.tag=2,eh(T,g,1))),T.lanes|=1),p):(p.flags|=65536,p.lanes=U,p)}var M1=ue.ReactCurrentOwner,Ma=!1;function ta(p,g,T,O){g.child=p===null?BR(g,null,T,O):dm(g,p.child,T,O)}function AE(p,g,T,O,U){T=T.render;var H=g.ref;return Zu(g,U),O=gm(p,g,T,O,H,U),T=pb(),p!==null&&!Ma?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~U,eu(p,g,U)):(pi&&T&&mE(g),g.flags|=1,ta(p,g,O,U),g.child)}function lI(p,g,T,O,U){if(p===null){var H=T.type;return typeof H=="function"&&!oh(H)&&H.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=H,uI(p,g,H,O,U)):(p=rv(T.type,null,O,g,g.mode,U),p.ref=g.ref,p.return=g,g.child=p)}if(H=p.child,(p.lanes&U)===0){var ce=H.memoizedProps;if(T=T.compare,T=T!==null?T:Bg,T(ce,O)&&p.ref===g.ref)return eu(p,g,U)}return g.flags|=1,p=od(H,O),p.ref=g.ref,p.return=g,g.child=p}function uI(p,g,T,O,U){if(p!==null){var H=p.memoizedProps;if(Bg(H,O)&&p.ref===g.ref)if(Ma=!1,g.pendingProps=O=H,(p.lanes&U)!==0)(p.flags&131072)!==0&&(Ma=!0);else return g.lanes=p.lanes,eu(p,g,U)}return Cb(p,g,T,O,U)}function dI(p,g,T){var O=g.pendingProps,U=O.children,H=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ti(yl,cc),cc|=T;else{if((T&1073741824)===0)return p=H!==null?H.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,Ti(yl,cc),cc|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=H!==null?H.baseLanes:T,Ti(yl,cc),cc|=O}else H!==null?(O=H.baseLanes|T,g.memoizedState=null):O=T,Ti(yl,cc),cc|=O;return ta(p,g,U,T),g.child}function hI(p,g){var T=g.ref;(p===null&&T!==null||p!==null&&p.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Cb(p,g,T,O,U){var H=Na(T)?Ip:bo.current;return H=Ap(g,H),Zu(g,U),T=gm(p,g,T,O,H,U),O=pb(),p!==null&&!Ma?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~U,eu(p,g,U)):(pi&&O&&mE(g),g.flags|=1,ta(p,g,T,U),g.child)}function pI(p,g,T,O,U){if(Na(T)){var H=!0;dE(g)}else H=!1;if(Zu(g,U),g.stateNode===null)LE(p,g),iI(g,T,O),Sb(g,T,O,U),O=!0;else if(p===null){var ce=g.stateNode,Ae=g.memoizedProps;ce.props=Ae;var Ue=ce.context,rt=T.contextType;typeof rt=="object"&&rt!==null?rt=Lc(rt):(rt=Na(T)?Ip:bo.current,rt=Ap(g,rt));var Pt=T.getDerivedStateFromProps,kt=typeof Pt=="function"||typeof ce.getSnapshotBeforeUpdate=="function";kt||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==O||Ue!==rt)&&sI(g,ce,O,rt),Zd=!1;var At=g.memoizedState;ce.state=At,vE(g,O,ce,U),Ue=g.memoizedState,Ae!==O||At!==Ue||ka.current||Zd?(typeof Pt=="function"&&(RE(g,T,Pt,O),Ue=g.memoizedState),(Ae=Zd||vb(g,T,Ae,O,At,Ue,rt))?(kt||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=Ue),ce.props=O,ce.state=Ue,ce.context=rt,O=Ae):(typeof ce.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ce=g.stateNode,zR(p,g),Ae=g.memoizedProps,rt=g.type===g.elementType?Ae:ac(g.type,Ae),ce.props=rt,kt=g.pendingProps,At=ce.context,Ue=T.contextType,typeof Ue=="object"&&Ue!==null?Ue=Lc(Ue):(Ue=Na(T)?Ip:bo.current,Ue=Ap(g,Ue));var Yt=T.getDerivedStateFromProps;(Pt=typeof Yt=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==kt||At!==Ue)&&sI(g,ce,O,Ue),Zd=!1,At=g.memoizedState,ce.state=At,vE(g,O,ce,U);var nn=g.memoizedState;Ae!==kt||At!==nn||ka.current||Zd?(typeof Yt=="function"&&(RE(g,T,Yt,O),nn=g.memoizedState),(rt=Zd||vb(g,T,rt,O,At,nn,Ue)||!1)?(Pt||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(O,nn,Ue),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(O,nn,Ue)),typeof ce.componentDidUpdate=="function"&&(g.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ce.componentDidUpdate!="function"||Ae===p.memoizedProps&&At===p.memoizedState||(g.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&At===p.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=nn),ce.props=O,ce.state=nn,ce.context=Ue,O=rt):(typeof ce.componentDidUpdate!="function"||Ae===p.memoizedProps&&At===p.memoizedState||(g.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&At===p.memoizedState||(g.flags|=1024),O=!1)}return PE(p,g,T,O,H,U)}function PE(p,g,T,O,U,H){hI(p,g);var ce=(g.flags&128)!==0;if(!O&&!ce)return U&&xR(g,T,!1),eu(p,g,H);O=g.stateNode,M1.current=g;var Ae=ce&&typeof T.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,p!==null&&ce?(g.child=dm(g,p.child,null,H),g.child=dm(g,null,Ae,H)):ta(p,g,Ae,H),g.memoizedState=O.state,U&&xR(g,T,!0),g.child}function Rb(p){var g=p.stateNode;g.pendingContext?LR(p,g.pendingContext,g.pendingContext!==g.context):g.context&&LR(p,g.context,!1),cb(p,g.containerInfo)}function fI(p,g,T,O,U){return um(),nb(U),g.flags|=256,ta(p,g,T,O),g.child}var Ib={dehydrated:null,treeContext:null,retryLane:0};function vm(p){return{baseLanes:p,cachePool:null,transitions:null}}function OE(p,g,T){var O=g.pendingProps,U=Mi.current,H=!1,ce=(g.flags&128)!==0,Ae;if((Ae=ce)||(Ae=p!==null&&p.memoizedState===null?!1:(U&2)!==0),Ae?(H=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(U|=1),Ti(Mi,U&1),p===null)return tb(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ce=O.children,p=O.fallback,H?(O=g.mode,H=g.child,ce={mode:"hidden",children:ce},(O&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ce):H=ah(ce,O,0,null),p=Bp(p,O,T,null),H.return=g,p.return=g,H.sibling=p,g.child=H,g.child.memoizedState=vm(T),g.memoizedState=Ib,p):kE(g,ce));if(U=p.memoizedState,U!==null&&(Ae=U.dehydrated,Ae!==null))return mI(p,g,ce,O,Ae,U,T);if(H){H=O.fallback,ce=g.mode,U=p.child,Ae=U.sibling;var Ue={mode:"hidden",children:O.children};return(ce&1)===0&&g.child!==U?(O=g.child,O.childLanes=0,O.pendingProps=Ue,g.deletions=null):(O=od(U,Ue),O.subtreeFlags=U.subtreeFlags&14680064),Ae!==null?H=od(Ae,H):(H=Bp(H,ce,T,null),H.flags|=2),H.return=g,O.return=g,O.sibling=H,g.child=O,O=H,H=g.child,ce=p.child.memoizedState,ce=ce===null?vm(T):{baseLanes:ce.baseLanes|T,cachePool:null,transitions:ce.transitions},H.memoizedState=ce,H.childLanes=p.childLanes&~T,g.memoizedState=Ib,O}return H=p.child,p=H.sibling,O=od(H,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=T),O.return=g,O.sibling=null,p!==null&&(T=g.deletions,T===null?(g.deletions=[p],g.flags|=16):T.push(p)),g.child=O,g.memoizedState=null,O}function kE(p,g){return g=ah({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function xp(p,g,T,O){return O!==null&&nb(O),dm(g,p.child,null,T),p=kE(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function mI(p,g,T,O,U,H,ce){if(T)return g.flags&256?(g.flags&=-257,O=bb(Error(s(422))),xp(p,g,ce,O)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(H=O.fallback,U=g.mode,O=ah({mode:"visible",children:O.children},U,0,null),H=Bp(H,U,ce,null),H.flags|=2,O.return=g,H.return=g,O.sibling=H,g.child=O,(g.mode&1)!==0&&dm(g,p.child,null,ce),g.child.memoizedState=vm(ce),g.memoizedState=Ib,H);if((g.mode&1)===0)return xp(p,g,ce,null);if(U.data==="$!"){if(O=U.nextSibling&&U.nextSibling.dataset,O)var Ae=O.dgst;return O=Ae,H=Error(s(419)),O=bb(H,O,void 0),xp(p,g,ce,O)}if(Ae=(ce&p.childLanes)!==0,Ma||Ae){if(O=Xs,O!==null){switch(ce&-ce){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}U=(U&(O.suspendedLanes|ce))!==0?0:U,U!==0&&U!==H.retryLane&&(H.retryLane=U,ed(p,U),Fc(O,p,U,-1))}return Vb(),O=bb(Error(s(421))),xp(p,g,ce,O)}return U.data==="$?"?(g.flags|=128,g.child=p.child,g=ev.bind(null,p),U._reactRetry=g,null):(p=H.treeContext,La=qd(U.nextSibling),Da=g,pi=!0,Zo=null,p!==null&&(Dc[oc++]=Xu,Dc[oc++]=Ju,Dc[oc++]=Pp,Xu=p.id,Ju=p.overflow,Pp=g),g=kE(g,O.children),g.flags|=4096,g)}function gI(p,g,T){p.lanes|=g;var O=p.alternate;O!==null&&(O.lanes|=g),ob(p.return,g,T)}function NE(p,g,T,O,U){var H=p.memoizedState;H===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:T,tailMode:U}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=O,H.tail=T,H.tailMode=U)}function DE(p,g,T){var O=g.pendingProps,U=O.revealOrder,H=O.tail;if(ta(p,g,O.children,T),O=Mi.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&gI(p,T,g);else if(p.tag===19)gI(p,T,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(Ti(Mi,O),(g.mode&1)===0)g.memoizedState=null;else switch(U){case"forwards":for(T=g.child,U=null;T!==null;)p=T.alternate,p!==null&&th(p)===null&&(U=T),T=T.sibling;T=U,T===null?(U=g.child,g.child=null):(U=T.sibling,T.sibling=null),NE(g,!1,U,T,H);break;case"backwards":for(T=null,U=g.child,g.child=null;U!==null;){if(p=U.alternate,p!==null&&th(p)===null){g.child=U;break}p=U.sibling,U.sibling=T,T=U,U=p}NE(g,!0,T,null,H);break;case"together":NE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function LE(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function eu(p,g,T){if(p!==null&&(g.dependencies=p.dependencies),Mp|=g.lanes,(T&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(s(153));if(g.child!==null){for(p=g.child,T=od(p,p.pendingProps),g.child=T,T.return=g;p.sibling!==null;)p=p.sibling,T=T.sibling=od(p,p.pendingProps),T.return=g;T.sibling=null}return g.child}function _I(p,g,T){switch(g.tag){case 3:Rb(g),um();break;case 5:$R(g);break;case 1:Na(g.type)&&dE(g);break;case 4:cb(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,U=g.memoizedProps.value;Ti(yE,O._currentValue),O._currentValue=U;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(Ti(Mi,Mi.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?OE(p,g,T):(Ti(Mi,Mi.current&1),p=eu(p,g,T),p!==null?p.sibling:null);Ti(Mi,Mi.current&1);break;case 19:if(O=(T&g.childLanes)!==0,(p.flags&128)!==0){if(O)return DE(p,g,T);g.flags|=128}if(U=g.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),Ti(Mi,Mi.current),O)break;return null;case 22:case 23:return g.lanes=0,dI(p,g,T)}return eu(p,g,T)}var yI,xE,Ab,EI;yI=function(p,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)p.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},xE=function(){},Ab=function(p,g,T,O){var U=p.memoizedProps;if(U!==O){p=g.stateNode,kp(Ql.current);var H=null;switch(T){case"input":U=on(p,U),O=on(p,O),H=[];break;case"select":U=ke({},U,{value:void 0}),O=ke({},O,{value:void 0}),H=[];break;case"textarea":U=_t(p,U),O=_t(p,O),H=[];break;default:typeof U.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=aE)}Ot(T,O);var ce;T=null;for(rt in U)if(!O.hasOwnProperty(rt)&&U.hasOwnProperty(rt)&&U[rt]!=null)if(rt==="style"){var Ae=U[rt];for(ce in Ae)Ae.hasOwnProperty(ce)&&(T||(T={}),T[ce]="")}else rt!=="dangerouslySetInnerHTML"&&rt!=="children"&&rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&rt!=="autoFocus"&&(l.hasOwnProperty(rt)?H||(H=[]):(H=H||[]).push(rt,null));for(rt in O){var Ue=O[rt];if(Ae=U!=null?U[rt]:void 0,O.hasOwnProperty(rt)&&Ue!==Ae&&(Ue!=null||Ae!=null))if(rt==="style")if(Ae){for(ce in Ae)!Ae.hasOwnProperty(ce)||Ue&&Ue.hasOwnProperty(ce)||(T||(T={}),T[ce]="");for(ce in Ue)Ue.hasOwnProperty(ce)&&Ae[ce]!==Ue[ce]&&(T||(T={}),T[ce]=Ue[ce])}else T||(H||(H=[]),H.push(rt,T)),T=Ue;else rt==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ae=Ae?Ae.__html:void 0,Ue!=null&&Ae!==Ue&&(H=H||[]).push(rt,Ue)):rt==="children"?typeof Ue!="string"&&typeof Ue!="number"||(H=H||[]).push(rt,""+Ue):rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&(l.hasOwnProperty(rt)?(Ue!=null&&rt==="onScroll"&&Pi("scroll",p),H||Ae===Ue||(H=[])):(H=H||[]).push(rt,Ue))}T&&(H=H||[]).push("style",T);var rt=H;(g.updateQueue=rt)&&(g.flags|=4)}},EI=function(p,g,T,O){T!==O&&(g.flags|=4)};function l_(p,g){if(!pi)switch(p.tailMode){case"hidden":g=p.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var O=null;T!==null;)T.alternate!==null&&(O=T),T=T.sibling;O===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function wo(p){var g=p.alternate!==null&&p.alternate.child===p.child,T=0,O=0;if(g)for(var U=p.child;U!==null;)T|=U.lanes|U.childLanes,O|=U.subtreeFlags&14680064,O|=U.flags&14680064,U.return=p,U=U.sibling;else for(U=p.child;U!==null;)T|=U.lanes|U.childLanes,O|=U.subtreeFlags,O|=U.flags,U.return=p,U=U.sibling;return p.subtreeFlags|=O,p.childLanes=T,g}function ME(p,g,T){var O=g.pendingProps;switch(Jg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wo(g),null;case 1:return Na(g.type)&&lE(),wo(g),null;case 3:return O=g.stateNode,Np(),Oi(ka),Oi(bo),ub(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&(Qg(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Zo!==null&&(XE(Zo),Zo=null))),xE(p,g),wo(g),null;case 5:fm(g);var U=kp(pm.current);if(T=g.type,p!==null&&g.stateNode!=null)Ab(p,g,T,O,U),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(s(166));return wo(g),null}if(p=kp(Ql.current),Qg(g)){O=g.stateNode,T=g.type;var H=g.memoizedProps;switch(O[Xl]=g,O[Yd]=H,p=(g.mode&1)!==0,T){case"dialog":Pi("cancel",O),Pi("close",O);break;case"iframe":case"object":case"embed":Pi("load",O);break;case"video":case"audio":for(U=0;U<Hg.length;U++)Pi(Hg[U],O);break;case"source":Pi("error",O);break;case"img":case"image":case"link":Pi("error",O),Pi("load",O);break;case"details":Pi("toggle",O);break;case"input":Ht(O,H),Pi("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!H.multiple},Pi("invalid",O);break;case"textarea":yt(O,H),Pi("invalid",O)}Ot(T,H),U=null;for(var ce in H)if(H.hasOwnProperty(ce)){var Ae=H[ce];ce==="children"?typeof Ae=="string"?O.textContent!==Ae&&(H.suppressHydrationWarning!==!0&&oE(O.textContent,Ae,p),U=["children",Ae]):typeof Ae=="number"&&O.textContent!==""+Ae&&(H.suppressHydrationWarning!==!0&&oE(O.textContent,Ae,p),U=["children",""+Ae]):l.hasOwnProperty(ce)&&Ae!=null&&ce==="onScroll"&&Pi("scroll",O)}switch(T){case"input":sn(O),Re(O,H,!0);break;case"textarea":sn(O),mn(O);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(O.onclick=aE)}O=U,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ce=U.nodeType===9?U:U.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Pn(T)),p==="http://www.w3.org/1999/xhtml"?T==="script"?(p=ce.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=ce.createElement(T,{is:O.is}):(p=ce.createElement(T),T==="select"&&(ce=p,O.multiple?ce.multiple=!0:O.size&&(ce.size=O.size))):p=ce.createElementNS(p,T),p[Xl]=g,p[Yd]=O,yI(p,g,!1,!1),g.stateNode=p;e:{switch(ce=On(T,O),T){case"dialog":Pi("cancel",p),Pi("close",p),U=O;break;case"iframe":case"object":case"embed":Pi("load",p),U=O;break;case"video":case"audio":for(U=0;U<Hg.length;U++)Pi(Hg[U],p);U=O;break;case"source":Pi("error",p),U=O;break;case"img":case"image":case"link":Pi("error",p),Pi("load",p),U=O;break;case"details":Pi("toggle",p),U=O;break;case"input":Ht(p,O),U=on(p,O),Pi("invalid",p);break;case"option":U=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},U=ke({},O,{value:void 0}),Pi("invalid",p);break;case"textarea":yt(p,O),U=_t(p,O),Pi("invalid",p);break;default:U=O}Ot(T,U),Ae=U;for(H in Ae)if(Ae.hasOwnProperty(H)){var Ue=Ae[H];H==="style"?Ms(p,Ue):H==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ue!=null&&lr(p,Ue)):H==="children"?typeof Ue=="string"?(T!=="textarea"||Ue!=="")&&Nt(p,Ue):typeof Ue=="number"&&Nt(p,""+Ue):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Ue!=null&&H==="onScroll"&&Pi("scroll",p):Ue!=null&&ie(p,H,Ue,ce))}switch(T){case"input":sn(p),Re(p,O,!1);break;case"textarea":sn(p),mn(p);break;case"option":O.value!=null&&p.setAttribute("value",""+ut(O.value));break;case"select":p.multiple=!!O.multiple,H=O.value,H!=null?ot(p,!!O.multiple,H,!1):O.defaultValue!=null&&ot(p,!!O.multiple,O.defaultValue,!0);break;default:typeof U.onClick=="function"&&(p.onclick=aE)}switch(T){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return wo(g),null;case 6:if(p&&g.stateNode!=null)EI(p,g,p.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(s(166));if(T=kp(pm.current),kp(Ql.current),Qg(g)){if(O=g.stateNode,T=g.memoizedProps,O[Xl]=g,(H=O.nodeValue!==T)&&(p=Da,p!==null))switch(p.tag){case 3:oE(O.nodeValue,T,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&oE(O.nodeValue,T,(p.mode&1)!==0)}H&&(g.flags|=4)}else O=(T.nodeType===9?T:T.ownerDocument).createTextNode(O),O[Xl]=g,g.stateNode=O}return wo(g),null;case 13:if(Oi(Mi),O=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(pi&&La!==null&&(g.mode&1)!==0&&(g.flags&128)===0)jR(),um(),g.flags|=98560,H=!1;else if(H=Qg(g),O!==null&&O.dehydrated!==null){if(p===null){if(!H)throw Error(s(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(s(317));H[Xl]=g}else um(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;wo(g),H=!1}else Zo!==null&&(XE(Zo),Zo=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(Mi.current&1)!==0?ws===0&&(ws=3):Vb())),g.updateQueue!==null&&(g.flags|=4),wo(g),null);case 4:return Np(),xE(p,g),p===null&&Tp(g.stateNode.containerInfo),wo(g),null;case 10:return sb(g.type._context),wo(g),null;case 17:return Na(g.type)&&lE(),wo(g),null;case 19:if(Oi(Mi),H=g.memoizedState,H===null)return wo(g),null;if(O=(g.flags&128)!==0,ce=H.rendering,ce===null)if(O)l_(H,!1);else{if(ws!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(ce=th(p),ce!==null){for(g.flags|=128,l_(H,!1),O=ce.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=T,T=g.child;T!==null;)H=T,p=O,H.flags&=14680066,ce=H.alternate,ce===null?(H.childLanes=0,H.lanes=p,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ce.childLanes,H.lanes=ce.lanes,H.child=ce.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ce.memoizedProps,H.memoizedState=ce.memoizedState,H.updateQueue=ce.updateQueue,H.type=ce.type,p=ce.dependencies,H.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),T=T.sibling;return Ti(Mi,Mi.current&1|2),g.child}p=p.sibling}H.tail!==null&&zr()>Tm&&(g.flags|=128,O=!0,l_(H,!1),g.lanes=4194304)}else{if(!O)if(p=th(ce),p!==null){if(g.flags|=128,O=!0,T=p.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),l_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ce.alternate&&!pi)return wo(g),null}else 2*zr()-H.renderingStartTime>Tm&&T!==1073741824&&(g.flags|=128,O=!0,l_(H,!1),g.lanes=4194304);H.isBackwards?(ce.sibling=g.child,g.child=ce):(T=H.last,T!==null?T.sibling=ce:g.child=ce,H.last=ce)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=zr(),g.sibling=null,T=Mi.current,Ti(Mi,O?T&1|2:T&1),g):(wo(g),null);case 22:case 23:return __(),O=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(cc&1073741824)!==0&&(wo(g),g.subtreeFlags&6&&(g.flags|=8192)):wo(g),null;case 24:return null;case 25:return null}throw Error(s(156,g.tag))}function U1(p,g){switch(Jg(g),g.tag){case 1:return Na(g.type)&&lE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Np(),Oi(ka),Oi(bo),ub(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return fm(g),null;case 13:if(Oi(Mi),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(s(340));um()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Oi(Mi),null;case 4:return Np(),null;case 10:return sb(g.type._context),null;case 22:case 23:return __(),null;case 24:return null;default:return null}}var UE=!1,Co=!1,vI=typeof WeakSet=="function"?WeakSet:Set,en=null;function Sm(p,g){var T=p.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(O){zi(p,g,O)}else T.current=null}function u_(p,g,T){try{T()}catch(O){zi(p,g,O)}}var SI=!1;function Pb(p,g){if(cE=Ce,p=bR(),Wg(p)){if("selectionStart"in p)var T={start:p.selectionStart,end:p.selectionEnd};else e:{T=(T=p.ownerDocument)&&T.defaultView||window;var O=T.getSelection&&T.getSelection();if(O&&O.rangeCount!==0){T=O.anchorNode;var U=O.anchorOffset,H=O.focusNode;O=O.focusOffset;try{T.nodeType,H.nodeType}catch{T=null;break e}var ce=0,Ae=-1,Ue=-1,rt=0,Pt=0,kt=p,At=null;t:for(;;){for(var Yt;kt!==T||U!==0&&kt.nodeType!==3||(Ae=ce+U),kt!==H||O!==0&&kt.nodeType!==3||(Ue=ce+O),kt.nodeType===3&&(ce+=kt.nodeValue.length),(Yt=kt.firstChild)!==null;)At=kt,kt=Yt;for(;;){if(kt===p)break t;if(At===T&&++rt===U&&(Ae=ce),At===H&&++Pt===O&&(Ue=ce),(Yt=kt.nextSibling)!==null)break;kt=At,At=kt.parentNode}kt=Yt}T=Ae===-1||Ue===-1?null:{start:Ae,end:Ue}}else T=null}T=T||{start:0,end:0}}else T=null;for(Kg={focusedElem:p,selectionRange:T},Ce=!1,en=g;en!==null;)if(g=en,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,en=p;else for(;en!==null;){g=en;try{var nn=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(nn!==null){var rn=nn.memoizedProps,ns=nn.memoizedState,Xe=g.stateNode,Ve=Xe.getSnapshotBeforeUpdate(g.elementType===g.type?rn:ac(g.type,rn),ns);Xe.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var et=g.stateNode.containerInfo;et.nodeType===1?et.textContent="":et.nodeType===9&&et.documentElement&&et.removeChild(et.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(xt){zi(g,g.return,xt)}if(p=g.sibling,p!==null){p.return=g.return,en=p;break}en=g.return}return nn=SI,SI=!1,nn}function d_(p,g,T){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var U=O=O.next;do{if((U.tag&p)===p){var H=U.destroy;U.destroy=void 0,H!==void 0&&u_(g,T,H)}U=U.next}while(U!==O)}}function h_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&p)===p){var O=T.create;T.destroy=O()}T=T.next}while(T!==g)}}function Ob(p){var g=p.ref;if(g!==null){var T=p.stateNode;switch(p.tag){case 5:p=T;break;default:p=T}typeof g=="function"?g(p):g.current=p}}function bI(p){var g=p.alternate;g!==null&&(p.alternate=null,bI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[Xl],delete g[Yd],delete g[Yg],delete g[R1],delete g[I1])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function kb(p){return p.tag===5||p.tag===3||p.tag===4}function TI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||kb(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Nb(p,g,T){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(p,g):T.insertBefore(p,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(p,T)):(g=T,g.appendChild(p)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=aE));else if(O!==4&&(p=p.child,p!==null))for(Nb(p,g,T),p=p.sibling;p!==null;)Nb(p,g,T),p=p.sibling}function VE(p,g,T){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?T.insertBefore(p,g):T.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(VE(p,g,T),p=p.sibling;p!==null;)VE(p,g,T),p=p.sibling}var so=null,Mc=!1;function tu(p,g,T){for(T=T.child;T!==null;)wI(p,g,T),T=T.sibling}function wI(p,g,T){if(So&&typeof So.onCommitFiberUnmount=="function")try{So.onCommitFiberUnmount(Wl,T)}catch{}switch(T.tag){case 5:Co||Sm(T,g);case 6:var O=so,U=Mc;so=null,tu(p,g,T),so=O,Mc=U,so!==null&&(Mc?(p=so,T=T.stateNode,p.nodeType===8?p.parentNode.removeChild(T):p.removeChild(T)):so.removeChild(T.stateNode));break;case 18:so!==null&&(Mc?(p=so,T=T.stateNode,p.nodeType===8?Q0(p.parentNode,T):p.nodeType===1&&Q0(p,T),Pa(p)):Q0(so,T.stateNode));break;case 4:O=so,U=Mc,so=T.stateNode.containerInfo,Mc=!0,tu(p,g,T),so=O,Mc=U;break;case 0:case 11:case 14:case 15:if(!Co&&(O=T.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){U=O=O.next;do{var H=U,ce=H.destroy;H=H.tag,ce!==void 0&&((H&2)!==0||(H&4)!==0)&&u_(T,g,ce),U=U.next}while(U!==O)}tu(p,g,T);break;case 1:if(!Co&&(Sm(T,g),O=T.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=T.memoizedProps,O.state=T.memoizedState,O.componentWillUnmount()}catch(Ae){zi(T,g,Ae)}tu(p,g,T);break;case 21:tu(p,g,T);break;case 22:T.mode&1?(Co=(O=Co)||T.memoizedState!==null,tu(p,g,T),Co=O):tu(p,g,T);break;default:tu(p,g,T)}}function CI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var T=p.stateNode;T===null&&(T=p.stateNode=new vI),g.forEach(function(O){var U=kI.bind(null,p,O);T.has(O)||(T.add(O),O.then(U,U))})}}function na(p,g){var T=g.deletions;if(T!==null)for(var O=0;O<T.length;O++){var U=T[O];try{var H=p,ce=g,Ae=ce;e:for(;Ae!==null;){switch(Ae.tag){case 5:so=Ae.stateNode,Mc=!1;break e;case 3:so=Ae.stateNode.containerInfo,Mc=!0;break e;case 4:so=Ae.stateNode.containerInfo,Mc=!0;break e}Ae=Ae.return}if(so===null)throw Error(s(160));wI(H,ce,U),so=null,Mc=!1;var Ue=U.alternate;Ue!==null&&(Ue.return=null),U.return=null}catch(rt){zi(U,g,rt)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Db(g,p),g=g.sibling}function Db(p,g){var T=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(na(g,p),Ua(p),O&4){try{d_(3,p,p.return),h_(3,p)}catch(rn){zi(p,p.return,rn)}try{d_(5,p,p.return)}catch(rn){zi(p,p.return,rn)}}break;case 1:na(g,p),Ua(p),O&512&&T!==null&&Sm(T,T.return);break;case 5:if(na(g,p),Ua(p),O&512&&T!==null&&Sm(T,T.return),p.flags&32){var U=p.stateNode;try{Nt(U,"")}catch(rn){zi(p,p.return,rn)}}if(O&4&&(U=p.stateNode,U!=null)){var H=p.memoizedProps,ce=T!==null?T.memoizedProps:H,Ae=p.type,Ue=p.updateQueue;if(p.updateQueue=null,Ue!==null)try{Ae==="input"&&H.type==="radio"&&H.name!=null&&jn(U,H),On(Ae,ce);var rt=On(Ae,H);for(ce=0;ce<Ue.length;ce+=2){var Pt=Ue[ce],kt=Ue[ce+1];Pt==="style"?Ms(U,kt):Pt==="dangerouslySetInnerHTML"?lr(U,kt):Pt==="children"?Nt(U,kt):ie(U,Pt,kt,rt)}switch(Ae){case"input":Wt(U,H);break;case"textarea":Gt(U,H);break;case"select":var At=U._wrapperState.wasMultiple;U._wrapperState.wasMultiple=!!H.multiple;var Yt=H.value;Yt!=null?ot(U,!!H.multiple,Yt,!1):At!==!!H.multiple&&(H.defaultValue!=null?ot(U,!!H.multiple,H.defaultValue,!0):ot(U,!!H.multiple,H.multiple?[]:"",!1))}U[Yd]=H}catch(rn){zi(p,p.return,rn)}}break;case 6:if(na(g,p),Ua(p),O&4){if(p.stateNode===null)throw Error(s(162));U=p.stateNode,H=p.memoizedProps;try{U.nodeValue=H}catch(rn){zi(p,p.return,rn)}}break;case 3:if(na(g,p),Ua(p),O&4&&T!==null&&T.memoizedState.isDehydrated)try{Pa(g.containerInfo)}catch(rn){zi(p,p.return,rn)}break;case 4:na(g,p),Ua(p);break;case 13:na(g,p),Ua(p),U=p.child,U.flags&8192&&(H=U.memoizedState!==null,U.stateNode.isHidden=H,!H||U.alternate!==null&&U.alternate.memoizedState!==null||(GE=zr())),O&4&&CI(p);break;case 22:if(Pt=T!==null&&T.memoizedState!==null,p.mode&1?(Co=(rt=Co)||Pt,na(g,p),Co=rt):na(g,p),Ua(p),O&8192){if(rt=p.memoizedState!==null,(p.stateNode.isHidden=rt)&&!Pt&&(p.mode&1)!==0)for(en=p,Pt=p.child;Pt!==null;){for(kt=en=Pt;en!==null;){switch(At=en,Yt=At.child,At.tag){case 0:case 11:case 14:case 15:d_(4,At,At.return);break;case 1:Sm(At,At.return);var nn=At.stateNode;if(typeof nn.componentWillUnmount=="function"){O=At,T=At.return;try{g=O,nn.props=g.memoizedProps,nn.state=g.memoizedState,nn.componentWillUnmount()}catch(rn){zi(O,T,rn)}}break;case 5:Sm(At,At.return);break;case 22:if(At.memoizedState!==null){p_(kt);continue}}Yt!==null?(Yt.return=At,en=Yt):p_(kt)}Pt=Pt.sibling}e:for(Pt=null,kt=p;;){if(kt.tag===5){if(Pt===null){Pt=kt;try{U=kt.stateNode,rt?(H=U.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ae=kt.stateNode,Ue=kt.memoizedProps.style,ce=Ue!=null&&Ue.hasOwnProperty("display")?Ue.display:null,Ae.style.display=ji("display",ce))}catch(rn){zi(p,p.return,rn)}}}else if(kt.tag===6){if(Pt===null)try{kt.stateNode.nodeValue=rt?"":kt.memoizedProps}catch(rn){zi(p,p.return,rn)}}else if((kt.tag!==22&&kt.tag!==23||kt.memoizedState===null||kt===p)&&kt.child!==null){kt.child.return=kt,kt=kt.child;continue}if(kt===p)break e;for(;kt.sibling===null;){if(kt.return===null||kt.return===p)break e;Pt===kt&&(Pt=null),kt=kt.return}Pt===kt&&(Pt=null),kt.sibling.return=kt.return,kt=kt.sibling}}break;case 19:na(g,p),Ua(p),O&4&&CI(p);break;case 21:break;default:na(g,p),Ua(p)}}function Ua(p){var g=p.flags;if(g&2){try{e:{for(var T=p.return;T!==null;){if(kb(T)){var O=T;break e}T=T.return}throw Error(s(160))}switch(O.tag){case 5:var U=O.stateNode;O.flags&32&&(Nt(U,""),O.flags&=-33);var H=TI(p);VE(p,H,U);break;case 3:case 4:var ce=O.stateNode.containerInfo,Ae=TI(p);Nb(p,Ae,ce);break;default:throw Error(s(161))}}catch(Ue){zi(p,p.return,Ue)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function bm(p,g,T){en=p,Lb(p)}function Lb(p,g,T){for(var O=(p.mode&1)!==0;en!==null;){var U=en,H=U.child;if(U.tag===22&&O){var ce=U.memoizedState!==null||UE;if(!ce){var Ae=U.alternate,Ue=Ae!==null&&Ae.memoizedState!==null||Co;Ae=UE;var rt=Co;if(UE=ce,(Co=Ue)&&!rt)for(en=U;en!==null;)ce=en,Ue=ce.child,ce.tag===22&&ce.memoizedState!==null?RI(U):Ue!==null?(Ue.return=ce,en=Ue):RI(U);for(;H!==null;)en=H,Lb(H),H=H.sibling;en=U,UE=Ae,Co=rt}FE(p)}else(U.subtreeFlags&8772)!==0&&H!==null?(H.return=U,en=H):FE(p)}}function FE(p){for(;en!==null;){var g=en;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:Co||h_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!Co)if(T===null)O.componentDidMount();else{var U=g.elementType===g.type?T.memoizedProps:ac(g.type,T.memoizedProps);O.componentDidUpdate(U,T.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&HR(g,H,O);break;case 3:var ce=g.updateQueue;if(ce!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}HR(g,ce,T)}break;case 5:var Ae=g.stateNode;if(T===null&&g.flags&4){T=Ae;var Ue=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ue.autoFocus&&T.focus();break;case"img":Ue.src&&(T.src=Ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var rt=g.alternate;if(rt!==null){var Pt=rt.memoizedState;if(Pt!==null){var kt=Pt.dehydrated;kt!==null&&Pa(kt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Co||g.flags&512&&Ob(g)}catch(At){zi(g,g.return,At)}}if(g===p){en=null;break}if(T=g.sibling,T!==null){T.return=g.return,en=T;break}en=g.return}}function p_(p){for(;en!==null;){var g=en;if(g===p){en=null;break}var T=g.sibling;if(T!==null){T.return=g.return,en=T;break}en=g.return}}function RI(p){for(;en!==null;){var g=en;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{h_(4,g)}catch(Ue){zi(g,T,Ue)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var U=g.return;try{O.componentDidMount()}catch(Ue){zi(g,U,Ue)}}var H=g.return;try{Ob(g)}catch(Ue){zi(g,H,Ue)}break;case 5:var ce=g.return;try{Ob(g)}catch(Ue){zi(g,ce,Ue)}}}catch(Ue){zi(g,g.return,Ue)}if(g===p){en=null;break}var Ae=g.sibling;if(Ae!==null){Ae.return=g.return,en=Ae;break}en=g.return}}var V1=Math.ceil,jE=ue.ReactCurrentDispatcher,BE=ue.ReactCurrentOwner,Uc=ue.ReactCurrentBatchConfig,Pr=0,Xs=null,ts=null,Ts=0,cc=0,yl=kc(0),ws=0,oo=null,Mp=0,WE=0,zE=0,f_=null,ra=null,GE=0,Tm=1/0,nu=null,HE=!1,xb=null,ih=null,wm=!1,ru=null,$E=0,Up=0,Mb=null,m_=-1,KE=0;function ao(){return(Pr&6)!==0?zr():m_!==-1?m_:m_=zr()}function Vc(p){return(p.mode&1)===0?1:(Pr&2)!==0&&Ts!==0?Ts&-Ts:P1.transition!==null?(KE===0&&(KE=Wu()),KE):(p=ar,p!==0||(p=window.event,p=p===void 0?16:Gr(p.type)),p)}function Fc(p,g,T,O){if(50<Up)throw Up=0,Mb=null,Error(s(185));Hl(p,T,O),((Pr&2)===0||p!==Xs)&&(p===Xs&&((Pr&2)===0&&(WE|=T),ws===4&&id(p,Ts)),Ro(p,O),T===1&&Pr===0&&(g.mode&1)===0&&(Tm=zr()+500,hE&&Jd()))}function Ro(p,g){var T=p.callbackNode;tc(p,g);var O=Gl(p,p===Xs?Ts:0);if(O===0)T!==null&&ju(T),p.callbackNode=null,p.callbackPriority=0;else if(g=O&-O,p.callbackPriority!==g){if(T!=null&&ju(T),g===1)p.tag===0?A1(Vp.bind(null,p)):MR(Vp.bind(null,p)),w1(function(){(Pr&6)===0&&Jd()}),T=null;else{switch(Cc(O)){case 1:T=wc;break;case 4:T=dl;break;case 16:T=Ia;break;case 536870912:T=Wd;break;default:T=Ia}T=y_(T,qE.bind(null,p))}p.callbackPriority=g,p.callbackNode=T}}function qE(p,g){if(m_=-1,KE=0,(Pr&6)!==0)throw Error(s(327));var T=p.callbackNode;if(Cm()&&p.callbackNode!==T)return null;var O=Gl(p,p===Xs?Ts:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||g)g=iu(p,O);else{g=O;var U=Pr;Pr|=2;var H=II();(Xs!==p||Ts!==g)&&(nu=null,Tm=zr()+500,sh(p,g));do try{F1();break}catch(Ae){Ub(p,Ae)}while(!0);ib(),jE.current=H,Pr=U,ts!==null?g=0:(Xs=null,Ts=0,g=ws)}if(g!==0){if(g===2&&(U=Wo(p),U!==0&&(O=U,g=YE(p,U))),g===1)throw T=oo,sh(p,0),id(p,O),Ro(p,zr()),T;if(g===6)id(p,O);else{if(U=p.current.alternate,(O&30)===0&&!JE(U)&&(g=iu(p,O),g===2&&(H=Wo(p),H!==0&&(O=H,g=YE(p,H))),g===1))throw T=oo,sh(p,0),id(p,O),Ro(p,zr()),T;switch(p.finishedWork=U,p.finishedLanes=O,g){case 0:case 1:throw Error(s(345));case 2:Fp(p,ra,nu);break;case 3:if(id(p,O),(O&130023424)===O&&(g=GE+500-zr(),10<g)){if(Gl(p,0)!==0)break;if(U=p.suspendedLanes,(U&O)!==O){ao(),p.pingedLanes|=p.suspendedLanes&U;break}p.timeoutHandle=qg(Fp.bind(null,p,ra,nu),g);break}Fp(p,ra,nu);break;case 4:if(id(p,O),(O&4194240)===O)break;for(g=p.eventTimes,U=-1;0<O;){var ce=31-io(O);H=1<<ce,ce=g[ce],ce>U&&(U=ce),O&=~H}if(O=U,O=zr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*V1(O/1960))-O,10<O){p.timeoutHandle=qg(Fp.bind(null,p,ra,nu),O);break}Fp(p,ra,nu);break;case 5:Fp(p,ra,nu);break;default:throw Error(s(329))}}}return Ro(p,zr()),p.callbackNode===T?qE.bind(null,p):null}function YE(p,g){var T=f_;return p.current.memoizedState.isDehydrated&&(sh(p,g).flags|=256),p=iu(p,g),p!==2&&(g=ra,ra=T,g!==null&&XE(g)),p}function XE(p){ra===null?ra=p:ra.push.apply(ra,p)}function JE(p){for(var g=p;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var O=0;O<T.length;O++){var U=T[O],H=U.getSnapshot;U=U.value;try{if(!_l(H(),U))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function id(p,g){for(g&=~zE,g&=~WE,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var T=31-io(g),O=1<<T;p[T]=-1,g&=~O}}function Vp(p){if((Pr&6)!==0)throw Error(s(327));Cm();var g=Gl(p,0);if((g&1)===0)return Ro(p,zr()),null;var T=iu(p,g);if(p.tag!==0&&T===2){var O=Wo(p);O!==0&&(g=O,T=YE(p,O))}if(T===1)throw T=oo,sh(p,0),id(p,g),Ro(p,zr()),T;if(T===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Fp(p,ra,nu),Ro(p,zr()),null}function g_(p,g){var T=Pr;Pr|=1;try{return p(g)}finally{Pr=T,Pr===0&&(Tm=zr()+500,hE&&Jd())}}function sd(p){ru!==null&&ru.tag===0&&(Pr&6)===0&&Cm();var g=Pr;Pr|=1;var T=Uc.transition,O=ar;try{if(Uc.transition=null,ar=1,p)return p()}finally{ar=O,Uc.transition=T,Pr=g,(Pr&6)===0&&Jd()}}function __(){cc=yl.current,Oi(yl)}function sh(p,g){p.finishedWork=null,p.finishedLanes=0;var T=p.timeoutHandle;if(T!==-1&&(p.timeoutHandle=-1,T1(T)),ts!==null)for(T=ts.return;T!==null;){var O=T;switch(Jg(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&lE();break;case 3:Np(),Oi(ka),Oi(bo),ub();break;case 5:fm(O);break;case 4:Np();break;case 13:Oi(Mi);break;case 19:Oi(Mi);break;case 10:sb(O.type._context);break;case 22:case 23:__()}T=T.return}if(Xs=p,ts=p=od(p.current,null),Ts=cc=g,ws=0,oo=null,zE=WE=Mp=0,ra=f_=null,Op!==null){for(g=0;g<Op.length;g++)if(T=Op[g],O=T.interleaved,O!==null){T.interleaved=null;var U=O.next,H=T.pending;if(H!==null){var ce=H.next;H.next=U,O.next=ce}T.pending=O}Op=null}return p}function Ub(p,g){do{var T=ts;try{if(ib(),SE.current=CE,mm){for(var O=Wi.memoizedState;O!==null;){var U=O.queue;U!==null&&(U.pending=null),O=O.next}mm=!1}if(Zl=0,bs=Ss=Wi=null,s_=!1,o_=0,BE.current=null,T===null||T.return===null){ws=1,oo=g,ts=null;break}e:{var H=p,ce=T.return,Ae=T,Ue=g;if(g=Ts,Ae.flags|=32768,Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var rt=Ue,Pt=Ae,kt=Pt.tag;if((Pt.mode&1)===0&&(kt===0||kt===11||kt===15)){var At=Pt.alternate;At?(Pt.updateQueue=At.updateQueue,Pt.memoizedState=At.memoizedState,Pt.lanes=At.lanes):(Pt.updateQueue=null,Pt.memoizedState=null)}var Yt=aI(ce);if(Yt!==null){Yt.flags&=-257,cI(Yt,ce,Ae,H,g),Yt.mode&1&&oI(H,rt,g),g=Yt,Ue=rt;var nn=g.updateQueue;if(nn===null){var rn=new Set;rn.add(Ue),g.updateQueue=rn}else nn.add(Ue);break e}else{if((g&1)===0){oI(H,rt,g),Vb();break e}Ue=Error(s(426))}}else if(pi&&Ae.mode&1){var ns=aI(ce);if(ns!==null){(ns.flags&65536)===0&&(ns.flags|=256),cI(ns,ce,Ae,H,g),nb(Em(Ue,Ae));break e}}H=Ue=Em(Ue,Ae),ws!==4&&(ws=2),f_===null?f_=[H]:f_.push(H),H=ce;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Xe=wb(H,Ue,g);GR(H,Xe);break e;case 1:Ae=Ue;var Ve=H.type,et=H.stateNode;if((H.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||et!==null&&typeof et.componentDidCatch=="function"&&(ih===null||!ih.has(et)))){H.flags|=65536,g&=-g,H.lanes|=g;var xt=rd(H,Ae,g);GR(H,xt);break e}}H=H.return}while(H!==null)}PI(T)}catch(an){g=an,ts===T&&T!==null&&(ts=T=T.return);continue}break}while(!0)}function II(){var p=jE.current;return jE.current=CE,p===null?CE:p}function Vb(){(ws===0||ws===3||ws===2)&&(ws=4),Xs===null||(Mp&268435455)===0&&(WE&268435455)===0||id(Xs,Ts)}function iu(p,g){var T=Pr;Pr|=2;var O=II();(Xs!==p||Ts!==g)&&(nu=null,sh(p,g));do try{AI();break}catch(U){Ub(p,U)}while(!0);if(ib(),Pr=T,jE.current=O,ts!==null)throw Error(s(261));return Xs=null,Ts=0,ws}function AI(){for(;ts!==null;)QE(ts)}function F1(){for(;ts!==null&&!Bo();)QE(ts)}function QE(p){var g=tv(p.alternate,p,cc);p.memoizedProps=p.pendingProps,g===null?PI(p):ts=g,BE.current=null}function PI(p){var g=p;do{var T=g.alternate;if(p=g.return,(g.flags&32768)===0){if(T=ME(T,g,cc),T!==null){ts=T;return}}else{if(T=U1(T,g),T!==null){T.flags&=32767,ts=T;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{ws=6,ts=null;return}}if(g=g.sibling,g!==null){ts=g;return}ts=g=p}while(g!==null);ws===0&&(ws=5)}function Fp(p,g,T){var O=ar,U=Uc.transition;try{Uc.transition=null,ar=1,j1(p,g,T,O)}finally{Uc.transition=U,ar=O}return null}function j1(p,g,T,O){do Cm();while(ru!==null);if((Pr&6)!==0)throw Error(s(327));T=p.finishedWork;var U=p.finishedLanes;if(T===null)return null;if(p.finishedWork=null,p.finishedLanes=0,T===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var H=T.lanes|T.childLanes;if(Yr(p,H),p===Xs&&(ts=Xs=null,Ts=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||wm||(wm=!0,y_(Ia,function(){return Cm(),null})),H=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||H){H=Uc.transition,Uc.transition=null;var ce=ar;ar=1;var Ae=Pr;Pr|=4,BE.current=null,Pb(p,T),Db(T,p),H0(Kg),Ce=!!cE,Kg=cE=null,p.current=T,bm(T),Bd(),Pr=Ae,ar=ce,Uc.transition=H}else p.current=T;if(wm&&(wm=!1,ru=p,$E=U),H=p.pendingLanes,H===0&&(ih=null),Hf(T.stateNode),Ro(p,zr()),g!==null)for(O=p.onRecoverableError,T=0;T<g.length;T++)U=g[T],O(U.value,{componentStack:U.stack,digest:U.digest});if(HE)throw HE=!1,p=xb,xb=null,p;return($E&1)!==0&&p.tag!==0&&Cm(),H=p.pendingLanes,(H&1)!==0?p===Mb?Up++:(Up=0,Mb=p):Up=0,Jd(),null}function Cm(){if(ru!==null){var p=Cc($E),g=Uc.transition,T=ar;try{if(Uc.transition=null,ar=16>p?16:p,ru===null)var O=!1;else{if(p=ru,ru=null,$E=0,(Pr&6)!==0)throw Error(s(331));var U=Pr;for(Pr|=4,en=p.current;en!==null;){var H=en,ce=H.child;if((en.flags&16)!==0){var Ae=H.deletions;if(Ae!==null){for(var Ue=0;Ue<Ae.length;Ue++){var rt=Ae[Ue];for(en=rt;en!==null;){var Pt=en;switch(Pt.tag){case 0:case 11:case 15:d_(8,Pt,H)}var kt=Pt.child;if(kt!==null)kt.return=Pt,en=kt;else for(;en!==null;){Pt=en;var At=Pt.sibling,Yt=Pt.return;if(bI(Pt),Pt===rt){en=null;break}if(At!==null){At.return=Yt,en=At;break}en=Yt}}}var nn=H.alternate;if(nn!==null){var rn=nn.child;if(rn!==null){nn.child=null;do{var ns=rn.sibling;rn.sibling=null,rn=ns}while(rn!==null)}}en=H}}if((H.subtreeFlags&2064)!==0&&ce!==null)ce.return=H,en=ce;else e:for(;en!==null;){if(H=en,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:d_(9,H,H.return)}var Xe=H.sibling;if(Xe!==null){Xe.return=H.return,en=Xe;break e}en=H.return}}var Ve=p.current;for(en=Ve;en!==null;){ce=en;var et=ce.child;if((ce.subtreeFlags&2064)!==0&&et!==null)et.return=ce,en=et;else e:for(ce=Ve;en!==null;){if(Ae=en,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:h_(9,Ae)}}catch(an){zi(Ae,Ae.return,an)}if(Ae===ce){en=null;break e}var xt=Ae.sibling;if(xt!==null){xt.return=Ae.return,en=xt;break e}en=Ae.return}}if(Pr=U,Jd(),So&&typeof So.onPostCommitFiberRoot=="function")try{So.onPostCommitFiberRoot(Wl,p)}catch{}O=!0}return O}finally{ar=T,Uc.transition=g}}return!1}function ZE(p,g,T){g=Em(T,g),g=wb(p,g,1),p=eh(p,g,1),g=ao(),p!==null&&(Hl(p,1,g),Ro(p,g))}function zi(p,g,T){if(p.tag===3)ZE(p,p,T);else for(;g!==null;){if(g.tag===3){ZE(g,p,T);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(ih===null||!ih.has(O))){p=Em(T,p),p=rd(g,p,1),g=eh(g,p,1),p=ao(),g!==null&&(Hl(g,1,p),Ro(g,p));break}}g=g.return}}function OI(p,g,T){var O=p.pingCache;O!==null&&O.delete(g),g=ao(),p.pingedLanes|=p.suspendedLanes&T,Xs===p&&(Ts&T)===T&&(ws===4||ws===3&&(Ts&130023424)===Ts&&500>zr()-GE?sh(p,0):zE|=T),Ro(p,g)}function Fb(p,g){g===0&&((p.mode&1)===0?g=1:(g=gr,gr<<=1,(gr&130023424)===0&&(gr=4194304)));var T=ao();p=ed(p,g),p!==null&&(Hl(p,g,T),Ro(p,T))}function ev(p){var g=p.memoizedState,T=0;g!==null&&(T=g.retryLane),Fb(p,T)}function kI(p,g){var T=0;switch(p.tag){case 13:var O=p.stateNode,U=p.memoizedState;U!==null&&(T=U.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(s(314))}O!==null&&O.delete(g),Fb(p,T)}var tv;tv=function(p,g,T){if(p!==null)if(p.memoizedProps!==g.pendingProps||ka.current)Ma=!0;else{if((p.lanes&T)===0&&(g.flags&128)===0)return Ma=!1,_I(p,g,T);Ma=(p.flags&131072)!==0}else Ma=!1,pi&&(g.flags&1048576)!==0&&fE(g,pE,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;LE(p,g),p=g.pendingProps;var U=Ap(g,bo.current);Zu(g,T),U=gm(null,g,O,p,U,T);var H=pb();return g.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Na(O)?(H=!0,dE(g)):H=!1,g.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,t_(g),U.updater=IE,g.stateNode=U,U._reactInternals=g,Sb(g,O,p,T),g=PE(null,g,O,!0,H,T)):(g.tag=0,pi&&H&&mE(g),ta(null,g,U,T),g=g.child),g;case 16:O=g.elementType;e:{switch(LE(p,g),p=g.pendingProps,U=O._init,O=U(O._payload),g.type=O,U=g.tag=jp(O),p=ac(O,p),U){case 0:g=Cb(null,g,O,p,T);break e;case 1:g=pI(null,g,O,p,T);break e;case 11:g=AE(null,g,O,p,T);break e;case 14:g=lI(null,g,O,ac(O.type,p),T);break e}throw Error(s(306,O,""))}return g;case 0:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:ac(O,U),Cb(p,g,O,U,T);case 1:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:ac(O,U),pI(p,g,O,U,T);case 3:e:{if(Rb(g),p===null)throw Error(s(387));O=g.pendingProps,H=g.memoizedState,U=H.element,zR(p,g),vE(g,O,null,T);var ce=g.memoizedState;if(O=ce.element,H.isDehydrated)if(H={element:O,isDehydrated:!1,cache:ce.cache,pendingSuspenseBoundaries:ce.pendingSuspenseBoundaries,transitions:ce.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){U=Em(Error(s(423)),g),g=fI(p,g,O,T,U);break e}else if(O!==U){U=Em(Error(s(424)),g),g=fI(p,g,O,T,U);break e}else for(La=qd(g.stateNode.containerInfo.firstChild),Da=g,pi=!0,Zo=null,T=BR(g,null,O,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(um(),O===U){g=eu(p,g,T);break e}ta(p,g,O,T)}g=g.child}return g;case 5:return $R(g),p===null&&tb(g),O=g.type,U=g.pendingProps,H=p!==null?p.memoizedProps:null,ce=U.children,J0(O,U)?ce=null:H!==null&&J0(O,H)&&(g.flags|=32),hI(p,g),ta(p,g,ce,T),g.child;case 6:return p===null&&tb(g),null;case 13:return OE(p,g,T);case 4:return cb(g,g.stateNode.containerInfo),O=g.pendingProps,p===null?g.child=dm(g,null,O,T):ta(p,g,O,T),g.child;case 11:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:ac(O,U),AE(p,g,O,U,T);case 7:return ta(p,g,g.pendingProps,T),g.child;case 8:return ta(p,g,g.pendingProps.children,T),g.child;case 12:return ta(p,g,g.pendingProps.children,T),g.child;case 10:e:{if(O=g.type._context,U=g.pendingProps,H=g.memoizedProps,ce=U.value,Ti(yE,O._currentValue),O._currentValue=ce,H!==null)if(_l(H.value,ce)){if(H.children===U.children&&!ka.current){g=eu(p,g,T);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ae=H.dependencies;if(Ae!==null){ce=H.child;for(var Ue=Ae.firstContext;Ue!==null;){if(Ue.context===O){if(H.tag===1){Ue=Jl(-1,T&-T),Ue.tag=2;var rt=H.updateQueue;if(rt!==null){rt=rt.shared;var Pt=rt.pending;Pt===null?Ue.next=Ue:(Ue.next=Pt.next,Pt.next=Ue),rt.pending=Ue}}H.lanes|=T,Ue=H.alternate,Ue!==null&&(Ue.lanes|=T),ob(H.return,T,g),Ae.lanes|=T;break}Ue=Ue.next}}else if(H.tag===10)ce=H.type===g.type?null:H.child;else if(H.tag===18){if(ce=H.return,ce===null)throw Error(s(341));ce.lanes|=T,Ae=ce.alternate,Ae!==null&&(Ae.lanes|=T),ob(ce,T,g),ce=H.sibling}else ce=H.child;if(ce!==null)ce.return=H;else for(ce=H;ce!==null;){if(ce===g){ce=null;break}if(H=ce.sibling,H!==null){H.return=ce.return,ce=H;break}ce=ce.return}H=ce}ta(p,g,U.children,T),g=g.child}return g;case 9:return U=g.type,O=g.pendingProps.children,Zu(g,T),U=Lc(U),O=O(U),g.flags|=1,ta(p,g,O,T),g.child;case 14:return O=g.type,U=ac(O,g.pendingProps),U=ac(O.type,U),lI(p,g,O,U,T);case 15:return uI(p,g,g.type,g.pendingProps,T);case 17:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:ac(O,U),LE(p,g),g.tag=1,Na(O)?(p=!0,dE(g)):p=!1,Zu(g,T),iI(g,O,U),Sb(g,O,U,T),PE(null,g,O,!0,p,T);case 19:return DE(p,g,T);case 22:return dI(p,g,T)}throw Error(s(156,g.tag))};function y_(p,g){return jd(p,g)}function nv(p,g,T,O){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lc(p,g,T,O){return new nv(p,g,T,O)}function oh(p){return p=p.prototype,!(!p||!p.isReactComponent)}function jp(p){if(typeof p=="function")return oh(p)?1:0;if(p!=null){if(p=p.$$typeof,p===pe)return 11;if(p===We)return 14}return 2}function od(p,g){var T=p.alternate;return T===null?(T=lc(p.tag,g,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=g,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&14680064,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,g=p.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T}function rv(p,g,T,O,U,H){var ce=2;if(O=p,typeof p=="function")oh(p)&&(ce=1);else if(typeof p=="string")ce=5;else e:switch(p){case q:return Bp(T.children,U,H,g);case X:ce=8,U|=8;break;case Q:return p=lc(12,T,g,U|2),p.elementType=Q,p.lanes=H,p;case le:return p=lc(13,T,g,U),p.elementType=le,p.lanes=H,p;case Le:return p=lc(19,T,g,U),p.elementType=Le,p.lanes=H,p;case ve:return ah(T,U,H,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case se:ce=10;break e;case me:ce=9;break e;case pe:ce=11;break e;case We:ce=14;break e;case $e:ce=16,O=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return g=lc(ce,T,g,U),g.elementType=p,g.type=O,g.lanes=H,g}function Bp(p,g,T,O){return p=lc(7,p,O,g),p.lanes=T,p}function ah(p,g,T,O){return p=lc(22,p,O,g),p.elementType=ve,p.lanes=T,p.stateNode={isHidden:!1},p}function jb(p,g,T){return p=lc(6,p,null,g),p.lanes=T,p}function Bb(p,g,T){return g=lc(4,p.children!==null?p.children:[],p.key,g),g.lanes=T,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function B1(p,g,T,O,U){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pl(0),this.expirationTimes=pl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pl(0),this.identifierPrefix=O,this.onRecoverableError=U,this.mutableSourceEagerHydrationData=null}function Wb(p,g,T,O,U,H,ce,Ae,Ue){return p=new B1(p,g,T,Ae,Ue),g===1?(g=1,H===!0&&(g|=8)):g=0,H=lc(3,null,null,g),p.current=H,H.stateNode=p,H.memoizedState={element:O,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},t_(H),p}function W1(p,g,T){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fe,key:O==null?null:""+O,children:p,containerInfo:g,implementation:T}}function NI(p){if(!p)return Xd;p=p._reactInternals;e:{if(qs(p)!==p||p.tag!==1)throw Error(s(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Na(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(s(171))}if(p.tag===1){var T=p.type;if(Na(T))return uE(p,T,g)}return g}function iv(p,g,T,O,U,H,ce,Ae,Ue){return p=Wb(T,O,!0,p,U,H,ce,Ae,Ue),p.context=NI(null),T=p.current,O=ao(),U=Vc(T),H=Jl(O,U),H.callback=g??null,eh(T,H,U),p.current.lanes=U,Hl(p,U,O),Ro(p,O),p}function E_(p,g,T,O){var U=g.current,H=ao(),ce=Vc(U);return T=NI(T),g.context===null?g.context=T:g.pendingContext=T,g=Jl(H,ce),g.payload={element:p},O=O===void 0?null:O,O!==null&&(g.callback=O),p=eh(U,g,ce),p!==null&&(Fc(p,U,ce,H),n_(p,U,ce)),ce}function sv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function zb(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<g?T:g}}function Gb(p,g){zb(p,g),(p=p.alternate)&&zb(p,g)}function v_(){return null}var El=typeof reportError=="function"?reportError:function(p){console.error(p)};function ov(p){this._internalRoot=p}av.prototype.render=ov.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(s(409));E_(p,g,null,null)},av.prototype.unmount=ov.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;sd(function(){E_(null,p,null,null)}),g[Oc]=null}};function av(p){this._internalRoot=p}av.prototype.unstable_scheduleHydration=function(p){if(p){var g=mp();p={blockedOn:null,target:p,priority:g};for(var T=0;T<Ko.length&&g!==0&&g<Ko[T].priority;T++);Ko.splice(T,0,p),T===0&&_p(p)}};function Hb(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Rm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function $b(){}function z1(p,g,T,O,U){if(U){if(typeof O=="function"){var H=O;O=function(){var rt=sv(ce);H.call(rt)}}var ce=iv(g,O,p,0,null,!1,!1,"",$b);return p._reactRootContainer=ce,p[Oc]=ce.current,Tp(p.nodeType===8?p.parentNode:p),sd(),ce}for(;U=p.lastChild;)p.removeChild(U);if(typeof O=="function"){var Ae=O;O=function(){var rt=sv(Ue);Ae.call(rt)}}var Ue=Wb(p,0,!1,null,null,!1,!1,"",$b);return p._reactRootContainer=Ue,p[Oc]=Ue.current,Tp(p.nodeType===8?p.parentNode:p),sd(function(){E_(g,Ue,T,O)}),Ue}function Wp(p,g,T,O,U){var H=T._reactRootContainer;if(H){var ce=H;if(typeof U=="function"){var Ae=U;U=function(){var Ue=sv(ce);Ae.call(Ue)}}E_(g,ce,p,U)}else ce=z1(T,g,p,U,O);return sv(ce)}$f=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var T=zl(g.pendingLanes);T!==0&&(nc(g,T|1),Ro(g,zr()),(Pr&6)===0&&(Tm=zr()+500,Jd()))}break;case 13:sd(function(){var O=ed(p,1);if(O!==null){var U=ao();Fc(O,p,1,U)}}),Gb(p,1)}},$l=function(p){if(p.tag===13){var g=ed(p,134217728);if(g!==null){var T=ao();Fc(g,p,134217728,T)}Gb(p,134217728)}},Hd=function(p){if(p.tag===13){var g=Vc(p),T=ed(p,g);if(T!==null){var O=ao();Fc(T,p,g,O)}Gb(p,g)}},mp=function(){return ar},Kf=function(p,g){var T=ar;try{return ar=p,g()}finally{ar=T}},bc=function(p,g,T){switch(g){case"input":if(Wt(p,T),g=T.name,T.type==="radio"&&g!=null){for(T=p;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var O=T[g];if(O!==p&&O.form===p.form){var U=am(O);if(!U)throw Error(s(90));Mt(O),Wt(O,U)}}}break;case"textarea":Gt(p,T);break;case"select":g=T.value,g!=null&&ot(p,!!T.multiple,g,!1)}},ro=g_,_s=sd;var ch={usingClientEntryPoint:!1,Events:[om,Rp,am,ba,Ta,g_]},ad={findFiberByHostInstance:Cp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},G1={bundleType:ad.bundleType,version:ad.version,rendererPackageName:ad.rendererPackageName,rendererConfig:ad.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ue.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Fd(p),p===null?null:p.stateNode},findFiberByHostInstance:ad.findFiberByHostInstance||v_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cv.isDisabled&&cv.supportsFiber)try{Wl=cv.inject(G1),So=cv}catch{}}return Zc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ch,Zc.createPortal=function(p,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hb(g))throw Error(s(200));return W1(p,g,null,T)},Zc.createRoot=function(p,g){if(!Hb(p))throw Error(s(299));var T=!1,O="",U=El;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(U=g.onRecoverableError)),g=Wb(p,1,!1,null,null,T,!1,O,U),p[Oc]=g.current,Tp(p.nodeType===8?p.parentNode:p),new ov(g)},Zc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=Fd(g),p=p===null?null:p.stateNode,p},Zc.flushSync=function(p){return sd(p)},Zc.hydrate=function(p,g,T){if(!Rm(g))throw Error(s(200));return Wp(null,p,g,!0,T)},Zc.hydrateRoot=function(p,g,T){if(!Hb(p))throw Error(s(405));var O=T!=null&&T.hydratedSources||null,U=!1,H="",ce=El;if(T!=null&&(T.unstable_strictMode===!0&&(U=!0),T.identifierPrefix!==void 0&&(H=T.identifierPrefix),T.onRecoverableError!==void 0&&(ce=T.onRecoverableError)),g=iv(g,null,p,1,T??null,U,!1,H,ce),p[Oc]=g.current,Tp(p),O)for(p=0;p<O.length;p++)T=O[p],U=T._getVersion,U=U(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,U]:g.mutableSourceEagerHydrationData.push(T,U);return new av(g)},Zc.render=function(p,g,T){if(!Rm(g))throw Error(s(200));return Wp(null,p,g,!1,T)},Zc.unmountComponentAtNode=function(p){if(!Rm(p))throw Error(s(40));return p._reactRootContainer?(sd(function(){Wp(null,null,p,!1,function(){p._reactRootContainer=null,p[Oc]=null})}),!0):!1},Zc.unstable_batchedUpdates=g_,Zc.unstable_renderSubtreeIntoContainer=function(p,g,T,O){if(!Rm(T))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return Wp(p,g,T,!1,O)},Zc.version="18.3.1-next-f1338f8080-20240426",Zc}var q$;function IQ(){if(q$)return U2.exports;q$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),U2.exports=gye(),U2.exports}var Y$;function _ye(){if(Y$)return JP;Y$=1;var n=IQ();return JP.createRoot=n.createRoot,JP.hydrateRoot=n.hydrateRoot,JP}var yye=_ye();const Eye=Pg(yye);function vye(n,t,s,a){return n.addEventListener(t,s,a),()=>{n.removeEventListener(t,s,a)}}function nN(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function Sye(){return!!(globalThis!=null&&globalThis.document)}function AQ(n){return n.parentElement&&AQ(n.parentElement)?!0:n.hidden}function bye(n){const t=n.getAttribute("contenteditable");return t!=="false"&&t!=null}function Tye(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function wye(n){var t;return((t=PQ(n))==null?void 0:t.defaultView)??window}function PQ(n){return nN(n)?n.ownerDocument:document}function Cye(n){return n.view??window}function Rye(n){return PQ(n).activeElement}function Iye(n){const t=Cye(n);return typeof t.PointerEvent<"u"&&n instanceof t.PointerEvent?n.pointerType==="mouse":n instanceof t.MouseEvent}function OQ(n){return!!n.touches}function Aye(n){return OQ(n)&&n.touches.length>1}function Pye(n,t="page"){const s=n.touches[0]||n.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function Oye(n,t="page"){return{x:n[`${t}X`],y:n[`${t}Y`]}}function kQ(n,t="page"){return OQ(n)?Pye(n,t):Oye(n,t)}function kye(n){return t=>{const s=Iye(t);(!s||s&&t.button===0)&&n(t)}}function Nye(n,t=!1){function s(l){n(l,{point:kQ(l)})}return t?kye(s):s}function AO(n,t,s,a){return vye(n,t,Nye(s,t==="pointerdown"),a)}function Dye(n,...t){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const s={...n};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const Zn=n=>n?"":void 0,wf=n=>n?!0:void 0;function Lye(n){return Array.isArray(n)}function Au(n){const t=typeof n;return n!=null&&(t==="object"||t==="function")&&!Lye(n)}function xye(n){const t=n==null?0:n.length;return t?n[t-1]:void 0}function Mye(n){const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function lU(n){if(n==null)return n;const{unitless:t}=Mye(n);return t||typeof n=="number"?`${n}px`:n}const NQ=(n,t)=>parseInt(n[1],10)>parseInt(t[1],10)?1:-1,JV=n=>Object.fromEntries(Object.entries(n).sort(NQ));function X$(n){const t=JV(n);return Object.assign(Object.values(t),t)}function Uye(n){const t=Object.keys(JV(n));return new Set(t)}function J$(n){if(!n)return n;n=lU(n)??n;const t=-.02;return typeof n=="number"?`${n+t}`:n.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function ww(n,t){const s=["@media screen"];return n&&s.push("and",`(min-width: ${lU(n)})`),t&&s.push("and",`(max-width: ${lU(t)})`),s.join(" ")}function Vye(n){if(!n)return null;n.base=n.base??"0px";const t=X$(n),s=Object.entries(n).sort(NQ).map(([d,f],y,v)=>{let[,b]=v[y+1]??[];return b=parseFloat(b)>0?J$(b):void 0,{_minW:J$(f),breakpoint:d,minW:f,maxW:b,maxWQuery:ww(null,b),minWQuery:ww(f),minMaxQuery:ww(f,b)}}),a=Uye(n),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(y=>a.has(y))},asObject:JV(n),asArray:X$(n),details:s,get(d){return s.find(f=>f.breakpoint===d)},media:[null,...t.map(d=>ww(d)).slice(1)],toArrayValue(d){if(!Au(d))throw new Error("toArrayValue: value must be an object");const f=l.map(y=>d[y]??null);for(;xye(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,y,v)=>{const b=l[v];return b!=null&&y!=null&&(f[b]=y),f},{})}}}function DQ(...n){return function(...s){n.forEach(a=>a==null?void 0:a(...s))}}function An(...n){return function(s){n.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function QV(n){return D.Children.toArray(n).filter(t=>D.isValidElement(t))}function rN(n){const t=Object.assign({},n);for(let s in t)t[s]===void 0&&delete t[s];return t}function Fye(n,t){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Ai(n={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=n,y=D.createContext(f);y.displayName=t;function v(){var w;const b=D.useContext(y);if(!b&&s){const I=new Error(d??Fye(a,l));throw I.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,I,v),I}return b}return[y.Provider,v,y]}const pn=(...n)=>n.filter(Boolean).join(" "),LQ=n=>n.hasAttribute("tabindex"),jye=n=>LQ(n)&&n.tabIndex===-1;function fk(n){if(!nN(n)||AQ(n)||Tye(n))return!1;const{localName:t}=n;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return t in a?a[t]():bye(n)?!0:LQ(n)}function Bye(n){return n?nN(n)&&fk(n)&&!jye(n):!1}const Wye=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],zye=Wye.join(),Gye=n=>n.offsetWidth>0&&n.offsetHeight>0;function xQ(n){const t=Array.from(n.querySelectorAll(zye));return t.unshift(n),t.filter(s=>fk(s)&&Gye(s))}function Hye(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const $ye=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const y=t.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,f);return y.set(l,v),v}},MQ=$ye(Hye),Kye=n=>n.default||n;function ZV(n){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=n;return!!(!s||a||l==="keepMounted"&&t)}function qye(n){const t=parseFloat(n);return typeof t!="number"||Number.isNaN(t)?0:t}function eF(n,t){let s=qye(n);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function uU(n){if(!Number.isFinite(n))return 0;let t=1,s=0;for(;Math.round(n*t)/t!==n;)t*=10,s+=1;return s}function Q$(n,t,s){return(n-t)*100/(s-t)}function Yye(n,t,s){return(s-t)*n+t}function Z$(n,t,s){const a=Math.round((n-t)/s)*s+t,l=uU(s);return eF(a,l)}function PO(n,t,s){return n==null?n:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,t),s))}function A0(n,t=[]){const s=Object.assign({},n);for(const a of t)a in s&&delete s[a];return s}function UQ(n,t){const s={};for(const a of t)a in n&&(s[a]=n[a]);return s}function tF(n,t){return Array.isArray(n)?n.map(s=>s===null?null:t(s)):Au(n)?Object.keys(n).reduce((s,a)=>(s[a]=t(n[a]),s),{}):n!=null?t(n):null}const Xye=n=>typeof n=="function";function sl(n,...t){return Xye(n)?n(...t):n}function Jye(n){const t=n.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(s+l+a)}function Qye(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function VQ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:nN(n)&&Jye(n)?n:VQ(Qye(n))}function Zye(n,t){const s={},a={};for(const[l,d]of Object.entries(n))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function eEe(n,...t){const s=Object.getOwnPropertyDescriptors(n),a=Object.keys(s),l=f=>{const y={};for(let v=0;v<f.length;v++){const b=f[v];s[b]&&(Object.defineProperty(y,b,s[b]),delete s[b])}return y},d=f=>l(Array.isArray(f)?f:a.filter(f));return t.map(d).concat(l(a))}function eK(n,t,s={}){const{stop:a,getKey:l}=s;function d(f,y=[]){if(Au(f)||Array.isArray(f)){const v={};for(const[b,w]of Object.entries(f)){const I=(l==null?void 0:l(b))??b,k=[...y,I];if(a!=null&&a(f,k))return t(f,y);v[I]=d(w,k)}return v}return t(f,y)}return d(n)}var Cw={exports:{}};Cw.exports;var tK;function tEe(){return tK||(tK=1,function(n,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,y="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",w="[object Boolean]",I="[object Date]",k="[object Error]",x="[object Function]",F="[object GeneratorFunction]",B="[object Map]",z="[object Number]",J="[object Null]",$="[object Object]",ie="[object Proxy]",ue="[object RegExp]",re="[object Set]",fe="[object String]",q="[object Undefined]",X="[object WeakMap]",Q="[object ArrayBuffer]",se="[object DataView]",me="[object Float32Array]",pe="[object Float64Array]",le="[object Int8Array]",Le="[object Int16Array]",We="[object Int32Array]",$e="[object Uint8Array]",ve="[object Uint8ClampedArray]",_e="[object Uint16Array]",Ee="[object Uint32Array]",ke=/[\\^$.*+?()[\]{}|]/g,we=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,Ie={};Ie[me]=Ie[pe]=Ie[le]=Ie[Le]=Ie[We]=Ie[$e]=Ie[ve]=Ie[_e]=Ie[Ee]=!0,Ie[y]=Ie[v]=Ie[Q]=Ie[w]=Ie[se]=Ie[I]=Ie[k]=Ie[x]=Ie[B]=Ie[z]=Ie[$]=Ie[ue]=Ie[re]=Ie[fe]=Ie[X]=!1;var Me=typeof dy=="object"&&dy&&dy.Object===Object&&dy,ze=typeof self=="object"&&self&&self.Object===Object&&self,Je=Me||ze||Function("return this")(),tt=t&&!t.nodeType&&t,ut=tt&&!0&&n&&!n.nodeType&&n,Ze=ut&&ut.exports===tt,vt=Ze&&Me.process,sn=function(){try{var Ce=ut&&ut.require&&ut.require("util").types;return Ce||vt&&vt.binding&&vt.binding("util")}catch{}}(),Mt=sn&&sn.isTypedArray;function Qt(Ce,De,nt){switch(nt.length){case 0:return Ce.call(De);case 1:return Ce.call(De,nt[0]);case 2:return Ce.call(De,nt[0],nt[1]);case 3:return Ce.call(De,nt[0],nt[1],nt[2])}return Ce.apply(De,nt)}function on(Ce,De){for(var nt=-1,Jt=Array(Ce);++nt<Ce;)Jt[nt]=De(nt);return Jt}function Ht(Ce){return function(De){return Ce(De)}}function jn(Ce,De){return Ce==null?void 0:Ce[De]}function Wt(Ce,De){return function(nt){return Ce(De(nt))}}var Re=Array.prototype,Fe=Function.prototype,Ge=Object.prototype,ot=Je["__core-js_shared__"],_t=Fe.toString,yt=Ge.hasOwnProperty,Gt=function(){var Ce=/[^.]+$/.exec(ot&&ot.keys&&ot.keys.IE_PROTO||"");return Ce?"Symbol(src)_1."+Ce:""}(),mn=Ge.toString,Pn=_t.call(Object),un=RegExp("^"+_t.call(yt).replace(ke,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bt=Ze?Je.Buffer:void 0,lr=Je.Symbol,Nt=Je.Uint8Array;bt&&bt.allocUnsafe;var Kt=Wt(Object.getPrototypeOf,Object),qr=Object.create,ji=Ge.propertyIsEnumerable,Ms=Re.splice,ii=lr?lr.toStringTag:void 0,Ot=function(){try{var Ce=tc(Object,"defineProperty");return Ce({},"",{}),Ce}catch{}}(),On=bt?bt.isBuffer:void 0,or=Math.max,xi=Date.now,bc=tc(Je,"Map"),cs=tc(Object,"create"),Sa=function(){function Ce(){}return function(De){if(!Rc(De))return{};if(qr)return qr(De);Ce.prototype=De;var nt=new Ce;return Ce.prototype=void 0,nt}}();function vo(Ce){var De=-1,nt=Ce==null?0:Ce.length;for(this.clear();++De<nt;){var Jt=Ce[De];this.set(Jt[0],Jt[1])}}function ba(){this.__data__=cs?cs(null):{},this.size=0}function Ta(Ce){var De=this.has(Ce)&&delete this.__data__[Ce];return this.size-=De?1:0,De}function ro(Ce){var De=this.__data__;if(cs){var nt=De[Ce];return nt===a?void 0:nt}return yt.call(De,Ce)?De[Ce]:void 0}function _s(Ce){var De=this.__data__;return cs?De[Ce]!==void 0:yt.call(De,Ce)}function ls(Ce,De){var nt=this.__data__;return this.size+=this.has(Ce)?0:1,nt[Ce]=cs&&De===void 0?a:De,this}vo.prototype.clear=ba,vo.prototype.delete=Ta,vo.prototype.get=ro,vo.prototype.has=_s,vo.prototype.set=ls;function jo(Ce){var De=-1,nt=Ce==null?0:Ce.length;for(this.clear();++De<nt;){var Jt=Ce[De];this.set(Jt[0],Jt[1])}}function Bi(){this.__data__=[],this.size=0}function ys(Ce){var De=this.__data__,nt=Bd(De,Ce);if(nt<0)return!1;var Jt=De.length-1;return nt==Jt?De.pop():Ms.call(De,nt,1),--this.size,!0}function Za(Ce){var De=this.__data__,nt=Bd(De,Ce);return nt<0?void 0:De[nt][1]}function Uu(Ce){return Bd(this.__data__,Ce)>-1}function Tc(Ce,De){var nt=this.__data__,Jt=Bd(nt,Ce);return Jt<0?(++this.size,nt.push([Ce,De])):nt[Jt][1]=De,this}jo.prototype.clear=Bi,jo.prototype.delete=ys,jo.prototype.get=Za,jo.prototype.has=Uu,jo.prototype.set=Tc;function wa(Ce){var De=-1,nt=Ce==null?0:Ce.length;for(this.clear();++De<nt;){var Jt=Ce[De];this.set(Jt[0],Jt[1])}}function Ca(){this.size=0,this.__data__={hash:new vo,map:new(bc||jo),string:new vo}}function Ud(Ce){var De=Bu(this,Ce).delete(Ce);return this.size-=De?1:0,De}function Mg(Ce){return Bu(this,Ce).get(Ce)}function Vu(Ce){return Bu(this,Ce).has(Ce)}function hp(Ce,De){var nt=Bu(this,Ce),Jt=nt.size;return nt.set(Ce,De),this.size+=nt.size==Jt?0:1,this}wa.prototype.clear=Ca,wa.prototype.delete=Ud,wa.prototype.get=Mg,wa.prototype.has=Vu,wa.prototype.set=hp;function qs(Ce){var De=this.__data__=new jo(Ce);this.size=De.size}function Fu(){this.__data__=new jo,this.size=0}function Ra(Ce){var De=this.__data__,nt=De.delete(Ce);return this.size=De.size,nt}function Vd(Ce){return this.__data__.get(Ce)}function Fd(Ce){return this.__data__.has(Ce)}function ec(Ce,De){var nt=this.__data__;if(nt instanceof jo){var Jt=nt.__data__;if(!bc||Jt.length<s-1)return Jt.push([Ce,De]),this.size=++nt.size,this;nt=this.__data__=new wa(Jt)}return nt.set(Ce,De),this.size=nt.size,this}qs.prototype.clear=Fu,qs.prototype.delete=Ra,qs.prototype.get=Vd,qs.prototype.has=Fd,qs.prototype.set=ec;function jd(Ce,De){var nt=Go(Ce),Jt=!nt&&us(Ce),Jn=!nt&&!Jt&&$o(Ce),Sr=!nt&&!Jt&&!Jn&&_p(Ce),Gr=nt||Jt||Jn||Sr,hn=Gr?on(Ce.length,String):[],Ur=hn.length;for(var bi in Ce)Gr&&(bi=="length"||Jn&&(bi=="offset"||bi=="parent")||Sr&&(bi=="buffer"||bi=="byteLength"||bi=="byteOffset")||pl(bi,Ur))||hn.push(bi);return hn}function ju(Ce,De,nt){(nt!==void 0&&!zo(Ce[De],nt)||nt===void 0&&!(De in Ce))&&zr(Ce,De,nt)}function Bo(Ce,De,nt){var Jt=Ce[De];(!(yt.call(Ce,De)&&zo(Jt,nt))||nt===void 0&&!(De in Ce))&&zr(Ce,De,nt)}function Bd(Ce,De){for(var nt=Ce.length;nt--;)if(zo(Ce[nt][0],De))return nt;return-1}function zr(Ce,De,nt){De=="__proto__"&&Ot?Ot(Ce,De,{configurable:!0,enumerable:!0,value:nt,writable:!0}):Ce[De]=nt}var Si=Gl();function wc(Ce){return Ce==null?Ce===void 0?q:J:ii&&ii in Object(Ce)?Wo(Ce):$f(Ce)}function dl(Ce){return Es(Ce)&&wc(Ce)==y}function Ia(Ce){if(!Rc(Ce)||nc(Ce))return!1;var De=Ko(Ce)?un:we;return De.test(gp(Ce))}function pp(Ce){return Es(Ce)&&qf(Ce.length)&&!!Ie[wc(Ce)]}function Wd(Ce){if(!Rc(Ce))return Cc(Ce);var De=ar(Ce),nt=[];for(var Jt in Ce)Jt=="constructor"&&(De||!yt.call(Ce,Jt))||nt.push(Jt);return nt}function Wl(Ce,De,nt,Jt,Jn){Ce!==De&&Si(De,function(Sr,Gr){if(Jn||(Jn=new qs),Rc(Sr))So(Ce,De,Gr,nt,Wl,Jt,Jn);else{var hn=Jt?Jt(Hd(Ce,Gr),Sr,Gr+"",Ce,De,Jn):void 0;hn===void 0&&(hn=Sr),ju(Ce,Gr,hn)}},ql)}function So(Ce,De,nt,Jt,Jn,Sr,Gr){var hn=Hd(Ce,nt),Ur=Hd(De,nt),bi=Gr.get(Ur);if(bi){ju(Ce,nt,bi);return}var Us=Sr?Sr(hn,Ur,nt+"",Ce,De,Gr):void 0,qo=Us===void 0;if(qo){var Yo=Go(Ur),Gu=!Yo&&$o(Ur),es=!Yo&&!Gu&&_p(Ur);Us=Ur,Yo||Gu||es?Go(hn)?Us=hn:Kl(hn)?Us=Gd(hn):Gu?(qo=!1,Us=fp(Ur)):es?(qo=!1,Us=zd(Ur)):Us=[]:zu(Ur)||us(Ur)?(Us=hn,us(hn)?Us=fl(hn):(!Rc(hn)||Ko(hn))&&(Us=Wu(Ur))):qo=!1}qo&&(Gr.set(Ur,Us),Jn(Us,Ur,Jt,Sr,Gr),Gr.delete(Ur)),ju(Ce,nt,Us)}function Hf(Ce,De){return mp($l(Ce,De,Pa),Ce+"")}var io=Ot?function(Ce,De){return Ot(Ce,"toString",{configurable:!0,enumerable:!1,value:Aa(De),writable:!0})}:Pa;function fp(Ce,De){return Ce.slice()}function hl(Ce){var De=new Ce.constructor(Ce.byteLength);return new Nt(De).set(new Nt(Ce)),De}function zd(Ce,De){var nt=hl(Ce.buffer);return new Ce.constructor(nt,Ce.byteOffset,Ce.length)}function Gd(Ce,De){var nt=-1,Jt=Ce.length;for(De||(De=Array(Jt));++nt<Jt;)De[nt]=Ce[nt];return De}function gr(Ce,De,nt,Jt){var Jn=!nt;nt||(nt={});for(var Sr=-1,Gr=De.length;++Sr<Gr;){var hn=De[Sr],Ur=void 0;Ur===void 0&&(Ur=Ce[hn]),Jn?zr(nt,hn,Ur):Bo(nt,hn,Ur)}return nt}function zl(Ce){return Hf(function(De,nt){var Jt=-1,Jn=nt.length,Sr=Jn>1?nt[Jn-1]:void 0,Gr=Jn>2?nt[2]:void 0;for(Sr=Ce.length>3&&typeof Sr=="function"?(Jn--,Sr):void 0,Gr&&Hl(nt[0],nt[1],Gr)&&(Sr=Jn<3?void 0:Sr,Jn=1),De=Object(De);++Jt<Jn;){var hn=nt[Jt];hn&&Ce(De,hn,Jt,Sr)}return De})}function Gl(Ce){return function(De,nt,Jt){for(var Jn=-1,Sr=Object(De),Gr=Jt(De),hn=Gr.length;hn--;){var Ur=Gr[++Jn];if(nt(Sr[Ur],Ur,Sr)===!1)break}return De}}function Bu(Ce,De){var nt=Ce.__data__;return Yr(De)?nt[typeof De=="string"?"string":"hash"]:nt.map}function tc(Ce,De){var nt=jn(Ce,De);return Ia(nt)?nt:void 0}function Wo(Ce){var De=yt.call(Ce,ii),nt=Ce[ii];try{Ce[ii]=void 0;var Jt=!0}catch{}var Jn=mn.call(Ce);return Jt&&(De?Ce[ii]=nt:delete Ce[ii]),Jn}function Wu(Ce){return typeof Ce.constructor=="function"&&!ar(Ce)?Sa(Kt(Ce)):{}}function pl(Ce,De){var nt=typeof Ce;return De=De??f,!!De&&(nt=="number"||nt!="symbol"&&be.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<De}function Hl(Ce,De,nt){if(!Rc(nt))return!1;var Jt=typeof De;return(Jt=="number"?Ho(nt)&&pl(De,nt.length):Jt=="string"&&De in nt)?zo(nt[De],Ce):!1}function Yr(Ce){var De=typeof Ce;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Ce!=="__proto__":Ce===null}function nc(Ce){return!!Gt&&Gt in Ce}function ar(Ce){var De=Ce&&Ce.constructor,nt=typeof De=="function"&&De.prototype||Ge;return Ce===nt}function Cc(Ce){var De=[];if(Ce!=null)for(var nt in Object(Ce))De.push(nt);return De}function $f(Ce){return mn.call(Ce)}function $l(Ce,De,nt){return De=or(De===void 0?Ce.length-1:De,0),function(){for(var Jt=arguments,Jn=-1,Sr=or(Jt.length-De,0),Gr=Array(Sr);++Jn<Sr;)Gr[Jn]=Jt[De+Jn];Jn=-1;for(var hn=Array(De+1);++Jn<De;)hn[Jn]=Jt[Jn];return hn[De]=nt(Gr),Qt(Ce,this,hn)}}function Hd(Ce,De){if(!(De==="constructor"&&typeof Ce[De]=="function")&&De!="__proto__")return Ce[De]}var mp=Kf(io);function Kf(Ce){var De=0,nt=0;return function(){var Jt=xi(),Jn=d-(Jt-nt);if(nt=Jt,Jn>0){if(++De>=l)return arguments[0]}else De=0;return Ce.apply(void 0,arguments)}}function gp(Ce){if(Ce!=null){try{return _t.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function zo(Ce,De){return Ce===De||Ce!==Ce&&De!==De}var us=dl(function(){return arguments}())?dl:function(Ce){return Es(Ce)&&yt.call(Ce,"callee")&&!ji.call(Ce,"callee")},Go=Array.isArray;function Ho(Ce){return Ce!=null&&qf(Ce.length)&&!Ko(Ce)}function Kl(Ce){return Es(Ce)&&Ho(Ce)}var $o=On||ml;function Ko(Ce){if(!Rc(Ce))return!1;var De=wc(Ce);return De==x||De==F||De==b||De==ie}function qf(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=f}function Rc(Ce){var De=typeof Ce;return Ce!=null&&(De=="object"||De=="function")}function Es(Ce){return Ce!=null&&typeof Ce=="object"}function zu(Ce){if(!Es(Ce)||wc(Ce)!=$)return!1;var De=Kt(Ce);if(De===null)return!0;var nt=yt.call(De,"constructor")&&De.constructor;return typeof nt=="function"&&nt instanceof nt&&_t.call(nt)==Pn}var _p=Mt?Ht(Mt):pp;function fl(Ce){return gr(Ce,ql(Ce))}function ql(Ce){return Ho(Ce)?jd(Ce):Wd(Ce)}var Yf=zl(function(Ce,De,nt,Jt){Wl(Ce,De,nt,Jt)});function Aa(Ce){return function(){return Ce}}function Pa(Ce){return Ce}function ml(){return!1}n.exports=Yf}(Cw,Cw.exports)),Cw.exports}var nEe=tEe();const Wh=Pg(nEe);function Hs(n,t=[]){const s=D.useRef(n);return D.useEffect(()=>{s.current=n}),D.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function gy(n,t,s,a){const l=Hs(s);return D.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,n,a,l,s]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(t,l,a)}}function FQ(n){const{isOpen:t,ref:s}=n,[a,l]=D.useState(t),[d,f]=D.useState(!1);return D.useEffect(()=>{d||(l(t),f(!0))},[t,d,a]),gy(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var w;const v=wye(s.current),b=new v.CustomEvent("animationend",{bubbles:!0});(w=s.current)==null||w.dispatchEvent(b)}}}var j2,nK;function rEe(){return nK||(nK=1,j2=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var t=document.activeElement,s=[],a=0;a<n.rangeCount;a++)s.push(n.getRangeAt(a));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||s.forEach(function(l){n.addRange(l)}),t&&t.focus()}}),j2}var B2,rK;function iEe(){if(rK)return B2;rK=1;var n=rEe(),t={"text/plain":"Text","text/html":"Url",default:"Text"},s="Copy to clipboard: #{key}, Enter";function a(d){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,f)}function l(d,f){var y,v,b,w,I,k,x=!1;f||(f={}),y=f.debug||!1;try{b=n(),w=document.createRange(),I=document.getSelection(),k=document.createElement("span"),k.textContent=d,k.ariaHidden="true",k.style.all="unset",k.style.position="fixed",k.style.top=0,k.style.clip="rect(0, 0, 0, 0)",k.style.whiteSpace="pre",k.style.webkitUserSelect="text",k.style.MozUserSelect="text",k.style.msUserSelect="text",k.style.userSelect="text",k.addEventListener("copy",function(B){if(B.stopPropagation(),f.format)if(B.preventDefault(),typeof B.clipboardData>"u"){y&&console.warn("unable to use e.clipboardData"),y&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var z=t[f.format]||t.default;window.clipboardData.setData(z,d)}else B.clipboardData.clearData(),B.clipboardData.setData(f.format,d);f.onCopy&&(B.preventDefault(),f.onCopy(B.clipboardData))}),document.body.appendChild(k),w.selectNodeContents(k),I.addRange(w);var F=document.execCommand("copy");if(!F)throw new Error("copy command was unsuccessful");x=!0}catch(B){y&&console.error("unable to copy using execCommand: ",B),y&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",d),f.onCopy&&f.onCopy(window.clipboardData),x=!0}catch(z){y&&console.error("unable to copy using clipboardData: ",z),y&&console.error("falling back to prompt"),v=a("message"in f?f.message:s),window.prompt(v,d)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(w):I.removeAllRanges()),k&&document.body.removeChild(k),b()}return x}return B2=l,B2}var sEe=iEe();const iK=Pg(sEe);function sK(n,t={}){const[s,a]=D.useState(!1),[l,d]=D.useState(n);D.useEffect(()=>d(n),[n]);const{timeout:f=1500,...y}=typeof t=="number"?{timeout:t}:t,v=D.useCallback(b=>{const w=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(w).then(()=>a(!0)).catch(()=>a(iK(w,y))):a(iK(w,y))},[l,y]);return D.useEffect(()=>{let b=null;return s&&(b=window.setTimeout(()=>{a(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,s]),{value:l,setValue:d,onCopy:v,hasCopied:s}}function jQ(n){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(k,x)=>k!==x}=n,d=Hs(a),f=Hs(l),[y,v]=D.useState(s),b=t!==void 0,w=b?t:y,I=Hs(k=>{const F=typeof k=="function"?k(w):k;f(w,F)&&(b||v(F),d(F))},[b,d,w,f]);return[w,I]}function oEe(n={}){const{onChange:t,precision:s,defaultValue:a,value:l,step:d=1,min:f=Number.MIN_SAFE_INTEGER,max:y=Number.MAX_SAFE_INTEGER,keepWithinRange:v=!0}=n,b=Hs(t),[w,I]=D.useState(()=>a==null?"":W2(a,d,s)??""),k=typeof l<"u",x=k?l:w,F=BQ(tg(x),d),B=s??F,z=D.useCallback(se=>{se!==x&&(k||I(se.toString()),b==null||b(se.toString(),tg(se)))},[b,k,x]),J=D.useCallback(se=>{let me=se;return v&&(me=PO(me,f,y)),eF(me,B)},[B,v,y,f]),$=D.useCallback((se=d)=>{let me;x===""?me=tg(se):me=tg(x)+se,me=J(me),z(me)},[J,d,z,x]),ie=D.useCallback((se=d)=>{let me;x===""?me=tg(-se):me=tg(x)-se,me=J(me),z(me)},[J,d,z,x]),ue=D.useCallback(()=>{let se;a==null?se="":se=W2(a,d,s)??f,z(se)},[a,s,d,z,f]),re=D.useCallback(se=>{const me=W2(se,d,B)??f;z(me)},[B,d,z,f]),fe=tg(x);return{isOutOfRange:fe>y||fe<f,isAtMax:fe===y,isAtMin:fe===f,precision:B,value:x,valueAsNumber:fe,update:z,reset:ue,increment:$,decrement:ie,clamp:J,cast:re,setValue:I}}function tg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function BQ(n,t){return Math.max(uU(t),uU(n))}function W2(n,t,s){const a=tg(n);if(Number.isNaN(a))return;const l=BQ(a,t);return eF(a,s??l)}function kf(n={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=n,d=Hs(s),f=Hs(t),[y,v]=D.useState(n.defaultIsOpen||!1),b=a!==void 0?a:y,w=a!==void 0,I=D.useId(),k=l??`disclosure-${I}`,x=D.useCallback(()=>{w||v(!1),f==null||f()},[w,f]),F=D.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),B=D.useCallback(()=>{b?x():F()},[b,F,x]);function z($={}){return{...$,"aria-expanded":b,"aria-controls":k,onClick(ie){var ue;(ue=$.onClick)==null||ue.call($,ie),B()}}}function J($={}){return{...$,hidden:!b,id:k}}return{isOpen:b,onOpen:F,onClose:x,onToggle:B,isControlled:w,getButtonProps:z,getDisclosureProps:J}}const $h=globalThis!=null&&globalThis.document?D.useLayoutEffect:D.useEffect,Nf=(n,t)=>{const s=D.useRef(!1),a=D.useRef(!1);D.useEffect(()=>{if(s.current&&a.current)return n();a.current=!0},t),D.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function aEe(n){const t=n.current;if(!t)return!1;const s=Rye(t);return!s||t.contains(s)?!1:!!Bye(s)}function WQ(n,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;Nf(()=>{if(!d||aEe(n))return;const f=(l==null?void 0:l.current)||n.current;let y;if(f)return y=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[d,n,l])}const cEe={preventScroll:!0,shouldFocus:!1};function lEe(n,t=cEe){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,f=uEe(n)?n.current:n,y=l&&d,v=D.useRef(y),b=D.useRef(d);$h(()=>{!b.current&&d&&(v.current=y),b.current=d},[d,y]);const w=D.useCallback(()=>{if(!(!d||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var I;(I=s.current)==null||I.focus({preventScroll:a})});else{const I=xQ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[d,a,f,s]);Nf(()=>{w()},[w]),gy(f,"transitionend",w)}function uEe(n){return"current"in n}function dEe(n){return"current"in n}const zQ=()=>typeof window<"u";function hEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const pEe=n=>zQ()&&n.test(navigator.vendor),fEe=n=>zQ()&&n.test(hEe()),mEe=()=>fEe(/mac|iphone|ipad|ipod/i),gEe=()=>mEe()&&pEe(/apple/i);function _Ee(n){const{ref:t,elements:s,enabled:a}=n,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};gy(l,"pointerdown",d=>{var b,w;if(!gEe()||!a)return;const f=((w=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:w[0])??d.target,v=(s??[t]).some(I=>{const k=dEe(I)?I.current:I;return(k==null?void 0:k.contains(f))||k===f});l().activeElement!==f&&v&&(d.preventDefault(),f.focus())})}function yEe(n,t){const s=D.useId();return D.useMemo(()=>n||[t,s].filter(Boolean).join("-"),[n,t,s])}function EEe(n,...t){const s=yEe(n);return D.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function vEe(n,t){const s=Hs(n);D.useEffect(()=>{let a=null;const l=()=>s();return t!==null&&(a=window.setInterval(l,t)),()=>{a&&window.clearInterval(a)}},[t,s])}function GQ(n){const t=D.useRef(null);return t.current=n,t}function SEe(n,t){if(n!=null){if(typeof n=="function"){n(t);return}try{n.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${n}'`)}}}function Li(...n){return t=>{n.forEach(s=>{SEe(s,t)})}}function bEe(...n){return D.useMemo(()=>Li(...n),n)}function HQ(n){const{ref:t,handler:s,enabled:a=!0}=n,l=Hs(s),f=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;D.useEffect(()=>{if(!a)return;const y=I=>{z2(I,t)&&(f.isPointerDown=!0)},v=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&s&&z2(I,t)&&(f.isPointerDown=!1,l(I))},b=I=>{f.ignoreEmulatedMouseEvents=!0,s&&f.isPointerDown&&z2(I,t)&&(f.isPointerDown=!1,l(I))},w=$Q(t.current);return w.addEventListener("mousedown",y,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",y,!0),w.addEventListener("touchend",b,!0),()=>{w.removeEventListener("mousedown",y,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",y,!0),w.removeEventListener("touchend",b,!0)}},[s,t,l,f,a])}function z2(n,t){var a,l;const s=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return s&&!$Q(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function $Q(n){return(n==null?void 0:n.ownerDocument)??document}function TEe(n,t){const s=Hs(n);D.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const KQ=1/60*1e3,wEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),qQ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(wEe()),KQ);function CEe(n){let t=[],s=[],a=0,l=!1,d=!1;const f=new WeakSet,y={schedule:(v,b=!1,w=!1)=>{const I=w&&l,k=I?t:s;return b&&f.add(v),k.indexOf(v)===-1&&(k.push(v),I&&l&&(a=t.length)),v},cancel:v=>{const b=s.indexOf(v);b!==-1&&s.splice(b,1),f.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let b=0;b<a;b++){const w=t[b];w(v),f.has(w)&&(y.schedule(w),n())}l=!1,d&&(d=!1,y.process(v))}};return y}const REe=40;let dU=!0,lC=!1,hU=!1;const WS={delta:0,timestamp:0},UC=["read","update","preRender","render","postRender"],iN=UC.reduce((n,t)=>(n[t]=CEe(()=>lC=!0),n),{}),IEe=UC.reduce((n,t)=>{const s=iN[t];return n[t]=(a,l=!1,d=!1)=>(lC||OEe(),s.schedule(a,l,d)),n},{}),AEe=UC.reduce((n,t)=>(n[t]=iN[t].cancel,n),{});UC.reduce((n,t)=>(n[t]=()=>iN[t].process(WS),n),{});const PEe=n=>iN[n].process(WS),YQ=n=>{lC=!1,WS.delta=dU?KQ:Math.max(Math.min(n-WS.timestamp,REe),1),WS.timestamp=n,hU=!0,UC.forEach(PEe),hU=!1,lC&&(dU=!1,qQ(YQ))},OEe=()=>{lC=!0,dU=!0,hU||qQ(YQ)},oK=()=>WS;var kEe=Object.defineProperty,NEe=(n,t,s)=>t in n?kEe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,wd=(n,t,s)=>(NEe(n,typeof t!="symbol"?t+"":t,s),s);class DEe{constructor(t,s,a){if(wd(this,"history",[]),wd(this,"startEvent",null),wd(this,"lastEvent",null),wd(this,"lastEventInfo",null),wd(this,"handlers",{}),wd(this,"removeListeners",()=>{}),wd(this,"threshold",3),wd(this,"win"),wd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=G2(this.lastEventInfo,this.history),v=this.startEvent!==null,b=UEe(y.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:w}=oK();this.history.push({...y.point,timestamp:w});const{onStart:I,onMove:k}=this.handlers;v||(I==null||I(this.lastEvent,y),this.startEvent=this.lastEvent),k==null||k(this.lastEvent,y)}),wd(this,"onPointerMove",(y,v)=>{this.lastEvent=y,this.lastEventInfo=v,IEe.update(this.updatePoint,!0)}),wd(this,"onPointerUp",(y,v)=>{const b=G2(v,this.history),{onEnd:w,onSessionEnd:I}=this.handlers;I==null||I(y,b),this.end(),!(!w||!this.startEvent)&&(w==null||w(y,b))}),this.win=t.view??window,Aye(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:kQ(t)},{timestamp:d}=oK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=s;f==null||f(t,G2(l,this.history)),this.removeListeners=MEe(AO(this.win,"pointermove",this.onPointerMove),AO(this.win,"pointerup",this.onPointerUp),AO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),AEe.update(this.updatePoint)}}function aK(n,t){return{x:n.x-t.x,y:n.y-t.y}}function G2(n,t){return{point:n.point,delta:aK(n.point,t[t.length-1]),offset:aK(n.point,t[0]),velocity:xEe(t,.1)}}const LEe=n=>n*1e3;function xEe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=n[n.length-1];for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>LEe(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function MEe(...n){return t=>n.reduce((s,a)=>a(s),t)}function H2(n,t){return Math.abs(n-t)}function cK(n){return"x"in n&&"y"in n}function UEe(n,t){if(typeof n=="number"&&typeof t=="number")return H2(n,t);if(cK(n)&&cK(t)){const s=H2(n.x,t.x),a=H2(n.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function VEe(n,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:y}=t,v=!!(s||a||l||d||f),b=D.useRef(null),w=GQ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:s,onEnd(I,k){b.current=null,l==null||l(I,k)}});D.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(w.current)}),D.useEffect(()=>{const I=n.current;if(!I||!v)return;function k(x){b.current=new DEe(x,w.current,y)}return AO(I,"pointerdown",k)},[n,v,w,y]),D.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const fo={open:(n,t)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${t}`,closed:(n,t)=>`${n}[data-closed], ${n}[data-state=closed] ${t}`,hover:(n,t)=>`${n}:hover ${t}, ${n}[data-hover] ${t}`,focus:(n,t)=>`${n}:focus ${t}, ${n}[data-focus] ${t}`,focusVisible:(n,t)=>`${n}:focus-visible ${t}`,focusWithin:(n,t)=>`${n}:focus-within ${t}`,active:(n,t)=>`${n}:active ${t}, ${n}[data-active] ${t}`,disabled:(n,t)=>`${n}:disabled ${t}, ${n}[data-disabled] ${t}`,invalid:(n,t)=>`${n}:invalid ${t}, ${n}[data-invalid] ${t}`,checked:(n,t)=>`${n}:checked ${t}, ${n}[data-checked] ${t}`,placeholderShown:(n,t)=>`${n}:placeholder-shown ${t}`},kh=n=>XQ(t=>n(t,"&"),"[role=group]","[data-group]",".group"),lf=n=>XQ(t=>n(t,"~ &"),"[data-peer]",".peer"),XQ=(n,...t)=>t.map(n).join(", "),zS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:kh(fo.open),_groupClosed:kh(fo.closed),_groupHover:kh(fo.hover),_peerHover:lf(fo.hover),_groupFocus:kh(fo.focus),_peerFocus:lf(fo.focus),_groupFocusVisible:kh(fo.focusVisible),_peerFocusVisible:lf(fo.focusVisible),_groupActive:kh(fo.active),_peerActive:lf(fo.active),_groupDisabled:kh(fo.disabled),_peerDisabled:lf(fo.disabled),_groupInvalid:kh(fo.invalid),_peerInvalid:lf(fo.invalid),_groupChecked:kh(fo.checked),_peerChecked:lf(fo.checked),_groupFocusWithin:kh(fo.focusWithin),_peerFocusWithin:lf(fo.focusWithin),_peerPlaceholderShown:lf(fo.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},JQ=Object.keys(zS),FEe=n=>/!(important)?$/.test(n),lK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,jEe=(n,t)=>s=>{const a=String(t),l=FEe(a),d=lK(a),f=n?`${n}.${d}`:d;let y=Au(s.__cssMap)&&f in s.__cssMap?s.__cssMap[f].varRef:t;return y=lK(y),l?`${y} !important`:y};function nF(n){const{scale:t,transform:s,compose:a}=n;return(d,f)=>{const y=jEe(t,d)(f);let v=(s==null?void 0:s(y,f))??y;return a&&(v=a(v,f)),v}}const QP=(...n)=>t=>n.reduce((s,a)=>a(s),t);function Tu(n,t){return s=>{const a={property:s,scale:n};return a.transform=nF({scale:n,transform:t}),a}}const BEe=({rtl:n,ltr:t})=>s=>s.direction==="rtl"?n:t;function WEe(n){const{property:t,scale:s,transform:a}=n;return{scale:s,property:BEe(t),transform:s?nF({scale:s,compose:a}):a}}const QQ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function zEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...QQ].join(" ")}function GEe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...QQ].join(" ")}const HEe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},$Ee={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function KEe(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const qEe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},pU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},YEe=new Set(Object.values(pU)),fU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),XEe=n=>n.trim();function JEe(n,t){if(n==null||fU.has(n))return n;if(!(mU(n)||fU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return n;const y=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=f.split(",").map(XEe).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const w=v in pU?pU[v]:v;b.unshift(w);const I=b.map(k=>{if(YEe.has(k))return k;const x=k.indexOf(" "),[F,B]=x!==-1?[k.substr(0,x),k.substr(x+1)]:[k],z=mU(B)?B:B&&B.split(" "),J=`colors.${F}`,$=J in t.__cssMap?t.__cssMap[J].varRef:F;return z?[$,...Array.isArray(z)?z:[z]].join(" "):$});return`${y}(${I.join(", ")})`}const mU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),QEe=(n,t)=>JEe(n,t??{});function ZEe(n){return/^var\(--.+\)$/.test(n)}const eve=n=>{const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},Nh=n=>t=>`${n}(${t})`,Dr={filter(n){return n!=="auto"?n:HEe},backdropFilter(n){return n!=="auto"?n:$Ee},ring(n){return KEe(Dr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?zEe():n==="auto-gpu"?GEe():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:t}=eve(n);return t||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[n]:n},degree(n){if(ZEe(n)||n==null)return n;const t=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||t?`${n}deg`:n},gradient:QEe,blur:Nh("blur"),opacity:Nh("opacity"),brightness:Nh("brightness"),contrast:Nh("contrast"),dropShadow:Nh("drop-shadow"),grayscale:Nh("grayscale"),hueRotate:n=>Nh("hue-rotate")(Dr.degree(n)),invert:Nh("invert"),saturate:Nh("saturate"),sepia:Nh("sepia"),bgImage(n){return n==null||mU(n)||fU.has(n)?n:`url(${n})`},outline(n){const t=String(n)==="0"||String(n)==="none";return n!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:t,divide:s}=qEe[n]??{},a={flexDirection:n};return t&&(a[t]=1),s&&(a[s]=1),a}},Be={borderWidths:Tu("borderWidths"),borderStyles:Tu("borderStyles"),colors:Tu("colors"),borders:Tu("borders"),gradients:Tu("gradients",Dr.gradient),radii:Tu("radii",Dr.px),space:Tu("space",QP(Dr.vh,Dr.px)),spaceT:Tu("space",QP(Dr.vh,Dr.px)),degreeT(n){return{property:n,transform:Dr.degree}},prop(n,t,s){return{property:n,scale:t,...t&&{transform:nF({scale:t,transform:s})}}},propT(n,t){return{property:n,transform:t}},sizes:Tu("sizes",QP(Dr.vh,Dr.px)),sizesT:Tu("sizes",QP(Dr.vh,Dr.fraction)),shadows:Tu("shadows"),logical:WEe,blur:Tu("blur",Dr.blur)},OO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Dr.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Dr.bgClip}};Object.assign(OO,{bgImage:OO.backgroundImage,bgImg:OO.backgroundImage});const Qr={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Qr,{rounded:Qr.borderRadius,roundedTop:Qr.borderTopRadius,roundedTopLeft:Qr.borderTopLeftRadius,roundedTopRight:Qr.borderTopRightRadius,roundedTopStart:Qr.borderStartStartRadius,roundedTopEnd:Qr.borderStartEndRadius,roundedBottom:Qr.borderBottomRadius,roundedBottomLeft:Qr.borderBottomLeftRadius,roundedBottomRight:Qr.borderBottomRightRadius,roundedBottomStart:Qr.borderEndStartRadius,roundedBottomEnd:Qr.borderEndEndRadius,roundedLeft:Qr.borderLeftRadius,roundedRight:Qr.borderRightRadius,roundedStart:Qr.borderInlineStartRadius,roundedEnd:Qr.borderInlineEndRadius,borderStart:Qr.borderInlineStart,borderEnd:Qr.borderInlineEnd,borderTopStartRadius:Qr.borderStartStartRadius,borderTopEndRadius:Qr.borderStartEndRadius,borderBottomStartRadius:Qr.borderEndStartRadius,borderBottomEndRadius:Qr.borderEndEndRadius,borderStartRadius:Qr.borderInlineStartRadius,borderEndRadius:Qr.borderInlineEndRadius,borderStartWidth:Qr.borderInlineStartWidth,borderEndWidth:Qr.borderInlineEndWidth,borderStartColor:Qr.borderInlineStartColor,borderEndColor:Qr.borderInlineEndColor,borderStartStyle:Qr.borderInlineStartStyle,borderEndStyle:Qr.borderInlineEndStyle});const tve={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},mk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Dr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(mk,{flexDir:mk.flexDirection});const Ru={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Dr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Ru,{w:Ru.width,h:Ru.height,minW:Ru.minWidth,maxW:Ru.maxWidth,minH:Ru.minHeight,maxH:Ru.maxHeight,overscroll:Ru.overscrollBehavior,overscrollX:Ru.overscrollBehaviorX,overscrollY:Ru.overscrollBehaviorY});const nve={filter:{transform:Dr.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Dr.brightness),contrast:Be.propT("--chakra-contrast",Dr.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Dr.hueRotate),invert:Be.propT("--chakra-invert",Dr.invert),saturate:Be.propT("--chakra-saturate",Dr.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Dr.dropShadow),backdropFilter:{transform:Dr.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Dr.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Dr.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Dr.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Dr.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Dr.saturate)},rve={ring:{transform:Dr.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},ive={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Dr.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},ZQ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function sve(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const ove=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const y=t.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,f);return y.set(l,v),v}},ave=ove(sve),cve={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},lve={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},$2=(n,t,s)=>{const a={},l=ave(n,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},uve={srOnly:{transform(n){return n===!0?cve:n==="focusable"?lve:{}}},layerStyle:{processResult:!0,transform:(n,t,s)=>$2(t,`layerStyles.${n}`,s)},textStyle:{processResult:!0,transform:(n,t,s)=>$2(t,`textStyles.${n}`,s)},apply:{processResult:!0,transform:(n,t,s)=>$2(t,n,s)}},Ww={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Ww,{insetStart:Ww.insetInlineStart,insetEnd:Ww.insetInlineEnd});const gU={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(gU,{shadow:gU.boxShadow});const Yi={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(Yi,{m:Yi.margin,mt:Yi.marginTop,mr:Yi.marginRight,me:Yi.marginInlineEnd,marginEnd:Yi.marginInlineEnd,mb:Yi.marginBottom,ml:Yi.marginLeft,ms:Yi.marginInlineStart,marginStart:Yi.marginInlineStart,mx:Yi.marginX,my:Yi.marginY,p:Yi.padding,pt:Yi.paddingTop,py:Yi.paddingY,px:Yi.paddingX,pb:Yi.paddingBottom,pl:Yi.paddingLeft,ps:Yi.paddingInlineStart,paddingStart:Yi.paddingInlineStart,pr:Yi.paddingRight,pe:Yi.paddingInlineEnd,paddingEnd:Yi.paddingInlineEnd});const dve={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},hve={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Dr.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},pve={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},fve={clipPath:!0,transform:Be.propT("transform",Dr.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},mve={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},gve={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},rF=Wh({},OO,Qr,tve,mk,Ru,nve,rve,ive,ZQ,uve,Ww,gU,Yi,dve,hve,pve,fve,mve,gve),_ve=Object.assign({},Yi,Ru,mk,ZQ,Ww),yve=Object.keys(_ve),Eve=[...Object.keys(rF),...JQ],vve={...rF,...zS},Sve=n=>n in vve,bve=n=>t=>{if(!t.__breakpoints)return n;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const f in n){let y=sl(n[f],t);if(y==null)continue;if(y=Au(y)&&s(y)?a(y):y,!Array.isArray(y)){d[f]=y;continue}const v=y.slice(0,l.length).length;for(let b=0;b<v;b+=1){const w=l==null?void 0:l[b];if(!w){d[f]=y[b];continue}d[w]=d[w]||{},y[b]!=null&&(d[w][f]=y[b])}}return d};function Tve(n){const t=[];let s="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function wve(n){return/^var\(--.+\)$/.test(n)}const Cve=(n,t)=>n.startsWith("--")&&typeof t=="string"&&!wve(t),Rve=(n,t)=>{if(t==null)return t;const s=f=>{var y,v;return(v=(y=n.__cssMap)==null?void 0:y[f])==null?void 0:v.varRef},a=f=>s(f)??f,[l,d]=Tve(t);return t=s(l)??a(d)??a(t),t};function Ive(n){const{configs:t={},pseudos:s={},theme:a}=n,l=(d,f=!1)=>{var w;const y=sl(d,a),v=bve(y)(a);let b={};for(let I in v){const k=v[I];let x=sl(k,a);I in s&&(I=s[I]),Cve(I,x)&&(x=Rve(a,x));let F=t[I];if(F===!0&&(F={property:I}),Au(x)){b[I]=b[I]??{},b[I]=Wh({},b[I],l(x,!0));continue}let B=((w=F==null?void 0:F.transform)==null?void 0:w.call(F,x,a,y))??x;B=F!=null&&F.processResult?l(B,!0):B;const z=sl(F==null?void 0:F.property,a);if(!f&&(F!=null&&F.static)){const J=sl(F.static,a);b=Wh({},b,J)}if(z&&Array.isArray(z)){for(const J of z)b[J]=B;continue}if(z){z==="&"&&Au(B)?b=Wh({},b,B):b[z]=B;continue}if(Au(B)){b=Wh({},b,B);continue}b[I]=B}return b};return l}const eZ=n=>t=>Ive({theme:t,pseudos:zS,configs:rF})(n);function YWe(n){return n}function XWe(n){return n}function Vi(n){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:n,...t}}}}function Ave(n,t,s){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function Pve(n,t){if(Array.isArray(n))return n;if(Au(n))return t(n);if(n!=null)return[n]}function Ove(n,t){for(let s=t+1;s<n.length;s++)if(n[s]!=null)return s;return-1}function kve(n){const t=n.__breakpoints;return function(a,l,d,f){var k,x;if(!t)return;const y={},v=Pve(d,t.toArrayValue);if(!v)return y;const b=v.length,w=b===1,I=!!a.parts;for(let F=0;F<b;F++){const B=t.details[F],z=t.details[Ove(v,F)],J=ww(B.minW,z==null?void 0:z._minW),$=sl((k=a[l])==null?void 0:k[v[F]],f);if($){if(I){(x=a.parts)==null||x.forEach(ie=>{Wh(y,{[ie]:w?$[ie]:{[J]:$[ie]}})});continue}if(!I){w?Wh(y,$):y[J]=$;continue}y[J]=$}}return y}}function Nve(n){return t=>{const{variant:s,size:a,theme:l}=t,d=kve(l);return Wh({},sl(n.baseStyle??{},t),d(n,"sizes",a,t),d(n,"variants",s,t))}}function Fi(n){return A0(n,["styleConfig","size","variant","colorScheme"])}function tZ(n){return Au(n)&&n.reference?n.reference:String(n)}const sN=(n,...t)=>t.map(tZ).join(` ${n} `).replace(/calc/g,""),uK=(...n)=>`calc(${sN("+",...n)})`,dK=(...n)=>`calc(${sN("-",...n)})`,_U=(...n)=>`calc(${sN("*",...n)})`,hK=(...n)=>`calc(${sN("/",...n)})`,pK=n=>{const t=tZ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:_U(t,-1)},pf=Object.assign(n=>({add:(...t)=>pf(uK(n,...t)),subtract:(...t)=>pf(dK(n,...t)),multiply:(...t)=>pf(_U(n,...t)),divide:(...t)=>pf(hK(n,...t)),negate:()=>pf(pK(n)),toString:()=>n.toString()}),{add:uK,subtract:dK,multiply:_U,divide:hK,negate:pK});function Dve(n,t="-"){return n.replace(/\s+/g,t)}function Lve(n){const t=Dve(n.toString());return Mve(xve(t))}function xve(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function Mve(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Uve(n,t=""){return[t,n].filter(Boolean).join("-")}function Vve(n,t){return`var(${n}${t?`, ${t}`:""})`}function Fve(n,t=""){return Lve(`--${Uve(n,t)}`)}function Mn(n,t,s){const a=Fve(n,s);return{variable:a,reference:Vve(a,t)}}function jve(n,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=Mn(`${n}-${l}`,d);continue}s[a]=Mn(`${n}-${a}`)}return s}const Bve=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Wve(n){return UQ(n,Bve)}function zve(n){return n.semanticTokens}function Gve(n){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=n;return l}function Hve(n){const t=Wve(n),s=zve(n),a=d=>JQ.includes(d)||d==="default",l={};return eK(t,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),eK(s,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function fK(n,t){return Mn(String(n).replace(/\./g,"-"),void 0,t)}function $ve(n){var f;const t=Hve(n),s=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(y,v){const w=[String(y).split(".")[0],v].join(".");if(!t[w])return v;const{reference:k}=fK(w,s);return k}for(const[y,v]of Object.entries(t)){const{isSemantic:b,value:w}=v,{variable:I,reference:k}=fK(y,s);if(!b){if(y.startsWith("space")){const F=y.split("."),[B,...z]=F,J=`${B}.-${z.join(".")}`,$=pf.negate(w),ie=pf.negate(k);l[J]={value:$,var:I,varRef:ie}}a[I]=w,l[y]={value:w,var:I,varRef:k};continue}const x=Au(w)?w:{default:w};a=Wh(a,Object.entries(x).reduce((F,[B,z])=>{if(!z)return F;const J=d(y,`${z}`);if(B==="default")return F[I]=J,F;const $=(zS==null?void 0:zS[B])??B;return F[$]={[I]:J},F},{})),l[y]={value:k,var:I,varRef:k}}return{cssVars:a,cssMap:l}}function Kve(n){const t=Gve(n),{cssMap:s,cssVars:a}=$ve(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:Vye(t.breakpoints)}),t}function ni(n,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const I of w)t[I]=v(I);return ni(n,t)}function d(...w){for(const I of w)I in t||(t[I]=v(I));return ni(n,t)}function f(){return Object.fromEntries(Object.entries(t).map(([I,k])=>[I,k.selector]))}function y(){return Object.fromEntries(Object.entries(t).map(([I,k])=>[I,k.className]))}function v(w){const x=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:x,selector:`.${x}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:f,classnames:y,get keys(){return Object.keys(t)},__type:{}}}const qve=ni("accordion").parts("root","container","button","panel","icon"),Yve=ni("alert").parts("title","description","container","icon","spinner"),Xve=ni("avatar").parts("label","badge","container","excessLabel","group"),Jve=ni("breadcrumb").parts("link","item","container","separator");ni("button").parts();const Qve=ni("checkbox").parts("control","icon","container","label");ni("progress").parts("track","filledTrack","label");const Zve=ni("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),eSe=ni("editable").parts("preview","input","textarea"),tSe=ni("form").parts("container","requiredIndicator","helperText"),nSe=ni("formError").parts("text","icon"),rSe=ni("input").parts("addon","field","element","group"),iSe=ni("list").parts("container","item","icon"),sSe=ni("menu").parts("button","list","item","groupTitle","icon","command","divider"),oSe=ni("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),aSe=ni("numberinput").parts("root","field","stepperGroup","stepper");ni("pininput").parts("field");const cSe=ni("popover").parts("content","header","body","footer","popper","arrow","closeButton"),lSe=ni("progress").parts("label","filledTrack","track"),uSe=ni("radio").parts("container","control","label"),dSe=ni("select").parts("field","icon"),hSe=ni("slider").parts("container","track","thumb","filledTrack","mark"),pSe=ni("stat").parts("container","label","helpText","number","icon"),fSe=ni("switch").parts("container","track","thumb","label"),mSe=ni("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),gSe=ni("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),_Se=ni("tag").parts("container","label","closeButton"),ySe=ni("card").parts("container","header","body","footer");ni("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:ESe,defineMultiStyleConfig:vSe}=Vi(qve.keys),SSe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},bSe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},TSe={pt:"2",px:"4",pb:"5"},wSe={fontSize:"1.25em"},CSe=ESe({container:SSe,button:bSe,panel:TSe,icon:wSe}),RSe=vSe({baseStyle:CSe});function hy(n,t,s){return Math.min(Math.max(n,s),t)}class ISe extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var Rw=ISe;function iF(n){if(typeof n!="string")throw new Rw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=xSe.test(n)?OSe(n):n;const s=kSe.exec(t);if(s){const f=Array.from(s).slice(1);return[...f.slice(0,3).map(y=>parseInt(uC(y,2),16)),parseInt(uC(f[3]||"f",2),16)/255]}const a=NSe.exec(t);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(y=>parseInt(y,16)),parseInt(f[3]||"ff",16)/255]}const l=DSe.exec(t);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(y=>parseInt(y,10)),parseFloat(f[3]||"1")]}const d=LSe.exec(t);if(d){const[f,y,v,b]=Array.from(d).slice(1).map(parseFloat);if(hy(0,100,y)!==y)throw new Rw(n);if(hy(0,100,v)!==v)throw new Rw(n);return[...MSe(f,y,v),Number.isNaN(b)?1:b]}throw new Rw(n)}function ASe(n){let t=5381,s=n.length;for(;s;)t=t*33^n.charCodeAt(--s);return(t>>>0)%2341}const mK=n=>parseInt(n.replace(/_/g,""),36),PSe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const s=mK(t.substring(0,3)),a=mK(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[s]=`${l}${a}`,n},{});function OSe(n){const t=n.toLowerCase().trim(),s=PSe[ASe(t)];if(!s)throw new Rw(n);return`#${s}`}const uC=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),kSe=new RegExp(`^#${uC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),NSe=new RegExp(`^#${uC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),DSe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${uC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),LSe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,xSe=/^[a-z]+$/i,gK=n=>Math.round(n*255),MSe=(n,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(gK);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),f=d*(1-Math.abs(l%2-1));let y=0,v=0,b=0;l>=0&&l<1?(y=d,v=f):l>=1&&l<2?(y=f,v=d):l>=2&&l<3?(v=d,b=f):l>=3&&l<4?(v=f,b=d):l>=4&&l<5?(y=f,b=d):l>=5&&l<6&&(y=d,b=f);const w=a-d/2,I=y+w,k=v+w,x=b+w;return[I,k,x].map(gK)};function USe(n,t,s,a){return`rgba(${hy(0,255,n).toFixed()}, ${hy(0,255,t).toFixed()}, ${hy(0,255,s).toFixed()}, ${parseFloat(hy(0,1,a).toFixed(3))})`}function VSe(n,t){const[s,a,l,d]=iF(n);return USe(s,a,l,d-t)}function FSe(n){const[t,s,a,l]=iF(n);let d=f=>{const y=hy(0,255,f).toString(16);return y.length===1?`0${y}`:y};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const jSe=n=>Object.keys(n).length===0;function BSe(n,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)n=n?n[t[a]]:l;return n===l?s:n}const yc=(n,t,s)=>{const a=BSe(n,`colors.${t}`,t);try{return FSe(a),a}catch{return s??"#000000"}},WSe=n=>{const[t,s,a]=iF(n);return(t*299+s*587+a*114)/1e3},zSe=n=>t=>{const s=yc(t,n);return WSe(s)<128?"dark":"light"},GSe=n=>t=>zSe(n)(t)==="dark",i0=(n,t)=>s=>{const a=yc(s,n);return VSe(a,1-t)};function _K(n="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const HSe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function $Se(n){const t=HSe();return!n||jSe(n)?t:n.string&&n.colors?qSe(n.string,n.colors):n.string&&!n.colors?KSe(n.string):n.colors&&!n.string?YSe(n.colors):t}function KSe(n){let t=0;if(n.length===0)return t.toString();for(let a=0;a<n.length;a+=1)t=n.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function qSe(n,t){let s=0;if(n.length===0)return t[0];for(let a=0;a<n.length;a+=1)s=n.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function YSe(n){return n[Math.floor(Math.random()*n.length)]}function xn(n,t){return s=>s.colorMode==="dark"?t:n}function sF(n){const{orientation:t,vertical:s,horizontal:a}=n;return t?t==="vertical"?s:a:{}}function nZ(n){return Au(n)&&n.reference?n.reference:String(n)}const oN=(n,...t)=>t.map(nZ).join(` ${n} `).replace(/calc/g,""),yK=(...n)=>`calc(${oN("+",...n)})`,EK=(...n)=>`calc(${oN("-",...n)})`,yU=(...n)=>`calc(${oN("*",...n)})`,vK=(...n)=>`calc(${oN("/",...n)})`,SK=n=>{const t=nZ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:yU(t,-1)},ff=Object.assign(n=>({add:(...t)=>ff(yK(n,...t)),subtract:(...t)=>ff(EK(n,...t)),multiply:(...t)=>ff(yU(n,...t)),divide:(...t)=>ff(vK(n,...t)),negate:()=>ff(SK(n)),toString:()=>n.toString()}),{add:yK,subtract:EK,multiply:yU,divide:vK,negate:SK});function XSe(n){return!Number.isInteger(parseFloat(n.toString()))}function JSe(n,t="-"){return n.replace(/\s+/g,t)}function rZ(n){const t=JSe(n.toString());return t.includes("\\.")?n:XSe(n)?t.replace(".","\\."):n}function QSe(n,t=""){return[t,rZ(n)].filter(Boolean).join("-")}function ZSe(n,t){return`var(${rZ(n)}${t?`, ${t}`:""})`}function e0e(n,t=""){return`--${QSe(n,t)}`}function Eo(n,t){const s=e0e(n,t==null?void 0:t.prefix);return{variable:s,reference:ZSe(s,t0e(t==null?void 0:t.fallback))}}function t0e(n){return n==null?void 0:n.reference}const{definePartsStyle:VC,defineMultiStyleConfig:n0e}=Vi(Yve.keys),Ul=Mn("alert-fg"),Df=Mn("alert-bg"),r0e=VC({container:{bg:Df.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Ul.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Ul.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function oF(n){const{theme:t,colorScheme:s}=n,a=i0(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const i0e=VC(n=>{const{colorScheme:t}=n,s=oF(n);return{container:{[Ul.variable]:`colors.${t}.600`,[Df.variable]:s.light,_dark:{[Ul.variable]:`colors.${t}.200`,[Df.variable]:s.dark}}}}),s0e=VC(n=>{const{colorScheme:t}=n,s=oF(n);return{container:{[Ul.variable]:`colors.${t}.600`,[Df.variable]:s.light,_dark:{[Ul.variable]:`colors.${t}.200`,[Df.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Ul.reference}}}),o0e=VC(n=>{const{colorScheme:t}=n,s=oF(n);return{container:{[Ul.variable]:`colors.${t}.600`,[Df.variable]:s.light,_dark:{[Ul.variable]:`colors.${t}.200`,[Df.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Ul.reference}}}),a0e=VC(n=>{const{colorScheme:t}=n;return{container:{[Ul.variable]:"colors.white",[Df.variable]:`colors.${t}.600`,_dark:{[Ul.variable]:"colors.gray.900",[Df.variable]:`colors.${t}.200`},color:Ul.reference}}}),c0e={subtle:i0e,"left-accent":s0e,"top-accent":o0e,solid:a0e},l0e=n0e({baseStyle:r0e,variants:c0e,defaultProps:{variant:"subtle",colorScheme:"blue"}}),iZ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},u0e={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},d0e={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},sZ={...iZ,...u0e,container:d0e},h0e=n=>typeof n=="function";function Ec(n,...t){return h0e(n)?n(...t):n}const{definePartsStyle:oZ,defineMultiStyleConfig:p0e}=Vi(Xve.keys),GS=Mn("avatar-border-color"),zw=Mn("avatar-bg"),dC=Mn("avatar-font-size"),s0=Mn("avatar-size"),f0e={borderRadius:"full",border:"0.2em solid",borderColor:GS.reference,[GS.variable]:"white",_dark:{[GS.variable]:"colors.gray.800"}},m0e={bg:zw.reference,fontSize:dC.reference,width:s0.reference,height:s0.reference,lineHeight:"1",[zw.variable]:"colors.gray.200",_dark:{[zw.variable]:"colors.whiteAlpha.400"}},g0e=n=>{const{name:t,theme:s}=n,a=t?$Se({string:t}):"colors.gray.400",l=GSe(a)(s);let d="white";return l||(d="gray.800"),{bg:zw.reference,fontSize:dC.reference,color:d,borderColor:GS.reference,verticalAlign:"top",width:s0.reference,height:s0.reference,"&:not([data-loaded])":{[zw.variable]:a},[GS.variable]:"colors.white",_dark:{[GS.variable]:"colors.gray.800"}}},_0e={fontSize:dC.reference,lineHeight:"1"},y0e=oZ(n=>({badge:Ec(f0e,n),excessLabel:Ec(m0e,n),container:Ec(g0e,n),label:_0e}));function Qm(n){const t=n!=="100%"?sZ[n]:void 0;return oZ({container:{[s0.variable]:t??n,[dC.variable]:`calc(${t??n} / 2.5)`},excessLabel:{[s0.variable]:t??n,[dC.variable]:`calc(${t??n} / 2.5)`}})}const E0e={"2xs":Qm(4),xs:Qm(6),sm:Qm(8),md:Qm(12),lg:Qm(16),xl:Qm(24),"2xl":Qm(32),full:Qm("100%")},v0e=p0e({baseStyle:y0e,sizes:E0e,defaultProps:{size:"md"}}),$s=jve("badge",["bg","color","shadow"]),S0e={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:$s.bg.reference,color:$s.color.reference,boxShadow:$s.shadow.reference},b0e=n=>{const{colorScheme:t,theme:s}=n,a=i0(`${t}.500`,.6)(s);return{[$s.bg.variable]:`colors.${t}.500`,[$s.color.variable]:"colors.white",_dark:{[$s.bg.variable]:a,[$s.color.variable]:"colors.whiteAlpha.800"}}},T0e=n=>{const{colorScheme:t,theme:s}=n,a=i0(`${t}.200`,.16)(s);return{[$s.bg.variable]:`colors.${t}.100`,[$s.color.variable]:`colors.${t}.800`,_dark:{[$s.bg.variable]:a,[$s.color.variable]:`colors.${t}.200`}}},w0e=n=>{const{colorScheme:t,theme:s}=n,a=i0(`${t}.200`,.8)(s);return{[$s.color.variable]:`colors.${t}.500`,_dark:{[$s.color.variable]:a},[$s.shadow.variable]:`inset 0 0 0px 1px ${$s.color.reference}`}},C0e={solid:b0e,subtle:T0e,outline:w0e},Gw={baseStyle:S0e,variants:C0e,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:R0e,definePartsStyle:I0e}=Vi(Jve.keys),K2=Mn("breadcrumb-link-decor"),A0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:K2.reference,[K2.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[K2.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},P0e=I0e({link:A0e}),O0e=R0e({baseStyle:P0e}),k0e={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},aZ=n=>{const{colorScheme:t,theme:s}=n;if(t==="gray")return{color:xn("gray.800","whiteAlpha.900")(n),_hover:{bg:xn("gray.100","whiteAlpha.200")(n)},_active:{bg:xn("gray.200","whiteAlpha.300")(n)}};const a=i0(`${t}.200`,.12)(s),l=i0(`${t}.200`,.24)(s);return{color:xn(`${t}.600`,`${t}.200`)(n),bg:"transparent",_hover:{bg:xn(`${t}.50`,a)(n)},_active:{bg:xn(`${t}.100`,l)(n)}}},N0e=n=>{const{colorScheme:t}=n,s=xn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Ec(aZ,n)}},D0e={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},L0e=n=>{const{colorScheme:t}=n;if(t==="gray"){const y=xn("gray.100","whiteAlpha.200")(n);return{bg:y,color:xn("gray.800","whiteAlpha.900")(n),_hover:{bg:xn("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:xn("gray.300","whiteAlpha.400")(n)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=D0e[t]??{},f=xn(s,`${t}.200`)(n);return{bg:f,color:xn(a,"gray.800")(n),_hover:{bg:xn(l,`${t}.300`)(n),_disabled:{bg:f}},_active:{bg:xn(d,`${t}.400`)(n)}}},x0e=n=>{const{colorScheme:t}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:xn(`${t}.500`,`${t}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:xn(`${t}.700`,`${t}.500`)(n)}}},M0e={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},U0e={ghost:aZ,outline:N0e,solid:L0e,link:x0e,unstyled:M0e},V0e={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},F0e={baseStyle:k0e,variants:U0e,sizes:V0e,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:_y,defineMultiStyleConfig:j0e}=Vi(ySe.keys),gk=Mn("card-bg"),Cf=Mn("card-padding"),cZ=Mn("card-shadow"),kO=Mn("card-radius"),lZ=Mn("card-border-width","0"),uZ=Mn("card-border-color"),B0e=_y({container:{[gk.variable]:"colors.chakra-body-bg",backgroundColor:gk.reference,boxShadow:cZ.reference,borderRadius:kO.reference,color:"chakra-body-text",borderWidth:lZ.reference,borderColor:uZ.reference},body:{padding:Cf.reference,flex:"1 1 0%"},header:{padding:Cf.reference},footer:{padding:Cf.reference}}),W0e={sm:_y({container:{[kO.variable]:"radii.base",[Cf.variable]:"space.3"}}),md:_y({container:{[kO.variable]:"radii.md",[Cf.variable]:"space.5"}}),lg:_y({container:{[kO.variable]:"radii.xl",[Cf.variable]:"space.7"}})},z0e={elevated:_y({container:{[cZ.variable]:"shadows.base",_dark:{[gk.variable]:"colors.gray.700"}}}),outline:_y({container:{[lZ.variable]:"1px",[uZ.variable]:"colors.chakra-border-color"}}),filled:_y({container:{[gk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Cf.variable]:0},header:{[Cf.variable]:0},footer:{[Cf.variable]:0}}},G0e=j0e({baseStyle:B0e,variants:z0e,sizes:W0e,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:NO,defineMultiStyleConfig:H0e}=Vi(Qve.keys),Hw=Mn("checkbox-size"),$0e=n=>{const{colorScheme:t}=n;return{w:Hw.reference,h:Hw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:xn(`${t}.500`,`${t}.200`)(n),borderColor:xn(`${t}.500`,`${t}.200`)(n),color:xn("white","gray.900")(n),_hover:{bg:xn(`${t}.600`,`${t}.300`)(n),borderColor:xn(`${t}.600`,`${t}.300`)(n)},_disabled:{borderColor:xn("gray.200","transparent")(n),bg:xn("gray.200","whiteAlpha.300")(n),color:xn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:xn(`${t}.500`,`${t}.200`)(n),borderColor:xn(`${t}.500`,`${t}.200`)(n),color:xn("white","gray.900")(n)},_disabled:{bg:xn("gray.100","whiteAlpha.100")(n),borderColor:xn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:xn("red.500","red.300")(n)}}},K0e={_disabled:{cursor:"not-allowed"}},q0e={userSelect:"none",_disabled:{opacity:.4}},Y0e={transitionProperty:"transform",transitionDuration:"normal"},X0e=NO(n=>({icon:Y0e,container:K0e,control:Ec($0e,n),label:q0e})),J0e={sm:NO({control:{[Hw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:NO({control:{[Hw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:NO({control:{[Hw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},rg=H0e({baseStyle:X0e,sizes:J0e,defaultProps:{size:"md",colorScheme:"blue"}}),$w=Eo("close-button-size"),sw=Eo("close-button-bg"),Q0e={w:[$w.reference],h:[$w.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[sw.variable]:"colors.blackAlpha.100",_dark:{[sw.variable]:"colors.whiteAlpha.100"}},_active:{[sw.variable]:"colors.blackAlpha.200",_dark:{[sw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:sw.reference},Z0e={lg:{[$w.variable]:"sizes.10",fontSize:"md"},md:{[$w.variable]:"sizes.8",fontSize:"xs"},sm:{[$w.variable]:"sizes.6",fontSize:"2xs"}},ebe={baseStyle:Q0e,sizes:Z0e,defaultProps:{size:"md"}},{variants:tbe,defaultProps:nbe}=Gw,rbe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:$s.bg.reference,color:$s.color.reference,boxShadow:$s.shadow.reference},ibe={baseStyle:rbe,variants:tbe,defaultProps:nbe},sbe={w:"100%",mx:"auto",maxW:"prose",px:"4"},obe={baseStyle:sbe},abe={opacity:.6,borderColor:"inherit"},cbe={borderStyle:"solid"},lbe={borderStyle:"dashed"},ube={solid:cbe,dashed:lbe},dbe={baseStyle:abe,variants:ube,defaultProps:{variant:"solid"}},{definePartsStyle:EU,defineMultiStyleConfig:hbe}=Vi(Zve.keys),q2=Mn("drawer-bg"),Y2=Mn("drawer-box-shadow");function hS(n){return EU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const pbe={bg:"blackAlpha.600",zIndex:"modal"},fbe={display:"flex",zIndex:"modal",justifyContent:"center"},mbe=n=>{const{isFullHeight:t}=n;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[q2.variable]:"colors.white",[Y2.variable]:"shadows.lg",_dark:{[q2.variable]:"colors.gray.700",[Y2.variable]:"shadows.dark-lg"},bg:q2.reference,boxShadow:Y2.reference}},gbe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},_be={position:"absolute",top:"2",insetEnd:"3"},ybe={px:"6",py:"2",flex:"1",overflow:"auto"},Ebe={px:"6",py:"4"},vbe=EU(n=>({overlay:pbe,dialogContainer:fbe,dialog:Ec(mbe,n),header:gbe,closeButton:_be,body:ybe,footer:Ebe})),Sbe={xs:hS("xs"),sm:hS("md"),md:hS("lg"),lg:hS("2xl"),xl:hS("4xl"),full:hS("full")},bbe=hbe({baseStyle:vbe,sizes:Sbe,defaultProps:{size:"xs"}}),{definePartsStyle:Tbe,defineMultiStyleConfig:wbe}=Vi(eSe.keys),Cbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Rbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Ibe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Abe=Tbe({preview:Cbe,input:Rbe,textarea:Ibe}),Pbe=wbe({baseStyle:Abe}),{definePartsStyle:Obe,defineMultiStyleConfig:kbe}=Vi(tSe.keys),HS=Mn("form-control-color"),Nbe={marginStart:"1",[HS.variable]:"colors.red.500",_dark:{[HS.variable]:"colors.red.300"},color:HS.reference},Dbe={mt:"2",[HS.variable]:"colors.gray.600",_dark:{[HS.variable]:"colors.whiteAlpha.600"},color:HS.reference,lineHeight:"normal",fontSize:"sm"},Lbe=Obe({container:{width:"100%",position:"relative"},requiredIndicator:Nbe,helperText:Dbe}),xbe=kbe({baseStyle:Lbe}),{definePartsStyle:Mbe,defineMultiStyleConfig:Ube}=Vi(nSe.keys),$S=Mn("form-error-color"),Vbe={[$S.variable]:"colors.red.500",_dark:{[$S.variable]:"colors.red.300"},color:$S.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Fbe={marginEnd:"0.5em",[$S.variable]:"colors.red.500",_dark:{[$S.variable]:"colors.red.300"},color:$S.reference},jbe=Mbe({text:Vbe,icon:Fbe}),Bbe=Ube({baseStyle:jbe}),Wbe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},zbe={baseStyle:Wbe},Gbe={fontFamily:"heading",fontWeight:"bold"},Hbe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},$be={baseStyle:Gbe,sizes:Hbe,defaultProps:{size:"xl"}},{definePartsStyle:gf,defineMultiStyleConfig:Kbe}=Vi(rSe.keys),RS=Mn("input-height"),IS=Mn("input-font-size"),AS=Mn("input-padding"),PS=Mn("input-border-radius"),qbe=gf({addon:{height:RS.reference,fontSize:IS.reference,px:AS.reference,borderRadius:PS.reference},field:{width:"100%",height:RS.reference,fontSize:IS.reference,px:AS.reference,borderRadius:PS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),Zm={lg:{[IS.variable]:"fontSizes.lg",[AS.variable]:"space.4",[PS.variable]:"radii.md",[RS.variable]:"sizes.12"},md:{[IS.variable]:"fontSizes.md",[AS.variable]:"space.4",[PS.variable]:"radii.md",[RS.variable]:"sizes.10"},sm:{[IS.variable]:"fontSizes.sm",[AS.variable]:"space.3",[PS.variable]:"radii.sm",[RS.variable]:"sizes.8"},xs:{[IS.variable]:"fontSizes.xs",[AS.variable]:"space.2",[PS.variable]:"radii.sm",[RS.variable]:"sizes.6"}},Ybe={lg:gf({field:Zm.lg,group:Zm.lg}),md:gf({field:Zm.md,group:Zm.md}),sm:gf({field:Zm.sm,group:Zm.sm}),xs:gf({field:Zm.xs,group:Zm.xs})};function aF(n){const{focusBorderColor:t,errorBorderColor:s}=n;return{focusBorderColor:t||xn("blue.500","blue.300")(n),errorBorderColor:s||xn("red.500","red.300")(n)}}const Xbe=gf(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=aF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:xn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:yc(t,a),boxShadow:`0 0 0 1px ${yc(t,a)}`},_focusVisible:{zIndex:1,borderColor:yc(t,s),boxShadow:`0 0 0 1px ${yc(t,s)}`}},addon:{border:"1px solid",borderColor:xn("inherit","whiteAlpha.50")(n),bg:xn("gray.100","whiteAlpha.300")(n)}}}),Jbe=gf(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=aF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:xn("gray.100","whiteAlpha.50")(n),_hover:{bg:xn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:yc(t,a)},_focusVisible:{bg:"transparent",borderColor:yc(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:xn("gray.100","whiteAlpha.50")(n)}}}),Qbe=gf(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=aF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:yc(t,a),boxShadow:`0px 1px 0px 0px ${yc(t,a)}`},_focusVisible:{borderColor:yc(t,s),boxShadow:`0px 1px 0px 0px ${yc(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),Zbe=gf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),eTe={outline:Xbe,filled:Jbe,flushed:Qbe,unstyled:Zbe},ti=Kbe({baseStyle:qbe,sizes:Ybe,variants:eTe,defaultProps:{size:"md",variant:"outline"}}),X2=Mn("kbd-bg"),tTe={[X2.variable]:"colors.gray.100",_dark:{[X2.variable]:"colors.whiteAlpha.100"},bg:X2.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},nTe={baseStyle:tTe},rTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},iTe={baseStyle:rTe},{defineMultiStyleConfig:sTe,definePartsStyle:oTe}=Vi(iSe.keys),aTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},cTe=oTe({icon:aTe}),lTe=sTe({baseStyle:cTe}),{defineMultiStyleConfig:uTe,definePartsStyle:dTe}=Vi(sSe.keys),Dh=Mn("menu-bg"),J2=Mn("menu-shadow"),hTe={[Dh.variable]:"#fff",[J2.variable]:"shadows.sm",_dark:{[Dh.variable]:"colors.gray.700",[J2.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Dh.reference,boxShadow:J2.reference},pTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Dh.variable]:"colors.gray.100",_dark:{[Dh.variable]:"colors.whiteAlpha.100"}},_active:{[Dh.variable]:"colors.gray.200",_dark:{[Dh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Dh.variable]:"colors.gray.100",_dark:{[Dh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Dh.reference},fTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},mTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},gTe={opacity:.6},_Te={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},yTe={transitionProperty:"common",transitionDuration:"normal"},ETe=dTe({button:yTe,list:hTe,item:pTe,groupTitle:fTe,icon:mTe,command:gTe,divider:_Te}),vTe=uTe({baseStyle:ETe}),{defineMultiStyleConfig:STe,definePartsStyle:vU}=Vi(oSe.keys),Q2=Mn("modal-bg"),Z2=Mn("modal-shadow"),bTe={bg:"blackAlpha.600",zIndex:"modal"},TTe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},wTe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[Q2.variable]:"colors.white",[Z2.variable]:"shadows.lg",_dark:{[Q2.variable]:"colors.gray.700",[Z2.variable]:"shadows.dark-lg"},bg:Q2.reference,boxShadow:Z2.reference}},CTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},RTe={position:"absolute",top:"2",insetEnd:"3"},ITe=n=>{const{scrollBehavior:t}=n;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},ATe={px:"6",py:"4"},PTe=vU(n=>({overlay:bTe,dialogContainer:Ec(TTe,n),dialog:Ec(wTe,n),header:CTe,closeButton:RTe,body:Ec(ITe,n),footer:ATe}));function Cd(n){return vU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const OTe={xs:Cd("xs"),sm:Cd("sm"),md:Cd("md"),lg:Cd("lg"),xl:Cd("xl"),"2xl":Cd("2xl"),"3xl":Cd("3xl"),"4xl":Cd("4xl"),"5xl":Cd("5xl"),"6xl":Cd("6xl"),full:Cd("full")},kTe=STe({baseStyle:PTe,sizes:OTe,defaultProps:{size:"md"}}),dZ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:NTe,definePartsStyle:hZ}=Vi(aSe.keys),cF=Eo("number-input-stepper-width"),pZ=Eo("number-input-input-padding"),DTe=ff(cF).add("0.5rem").toString(),eM=Eo("number-input-bg"),tM=Eo("number-input-color"),nM=Eo("number-input-border-color"),LTe={[cF.variable]:"sizes.6",[pZ.variable]:DTe},xTe=n=>{var t;return((t=Ec(ti.baseStyle,n))==null?void 0:t.field)??{}},MTe={width:cF.reference},UTe={borderStart:"1px solid",borderStartColor:nM.reference,color:tM.reference,bg:eM.reference,[tM.variable]:"colors.chakra-body-text",[nM.variable]:"colors.chakra-border-color",_dark:{[tM.variable]:"colors.whiteAlpha.800",[nM.variable]:"colors.whiteAlpha.300"},_active:{[eM.variable]:"colors.gray.200",_dark:{[eM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},VTe=hZ(n=>({root:LTe,field:Ec(xTe,n)??{},stepperGroup:MTe,stepper:UTe}));function ZP(n){var d,f;const t=(d=ti.sizes)==null?void 0:d[n],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=t.field)==null?void 0:f.fontSize)??"md",l=dZ.fontSizes[a];return hZ({field:{...t.field,paddingInlineEnd:pZ.reference,verticalAlign:"top"},stepper:{fontSize:ff(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[n]},_last:{borderBottomEndRadius:s[n],mt:"-1px",borderTopWidth:1}}})}const FTe={xs:ZP("xs"),sm:ZP("sm"),md:ZP("md"),lg:ZP("lg")},jTe=NTe({baseStyle:VTe,sizes:FTe,variants:ti.variants,defaultProps:ti.defaultProps});var uQ;const BTe={...(uQ=ti.baseStyle)==null?void 0:uQ.field,textAlign:"center"},WTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var dQ;const zTe={outline:n=>{var t,s;return((s=Ec((t=ti.variants)==null?void 0:t.outline,n))==null?void 0:s.field)??{}},flushed:n=>{var t,s;return((s=Ec((t=ti.variants)==null?void 0:t.flushed,n))==null?void 0:s.field)??{}},filled:n=>{var t,s;return((s=Ec((t=ti.variants)==null?void 0:t.filled,n))==null?void 0:s.field)??{}},unstyled:((dQ=ti.variants)==null?void 0:dQ.unstyled.field)??{}},GTe={baseStyle:BTe,sizes:WTe,variants:zTe,defaultProps:ti.defaultProps},{defineMultiStyleConfig:HTe,definePartsStyle:$Te}=Vi(cSe.keys),eO=Eo("popper-bg"),KTe=Eo("popper-arrow-bg"),bK=Eo("popper-arrow-shadow-color"),qTe={zIndex:"popover"},YTe={[eO.variable]:"colors.white",bg:eO.reference,[KTe.variable]:eO.reference,[bK.variable]:"colors.gray.200",_dark:{[eO.variable]:"colors.gray.700",[bK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},XTe={px:3,py:2,borderBottomWidth:"1px"},JTe={px:3,py:2},QTe={px:3,py:2,borderTopWidth:"1px"},ZTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},ewe=$Te({popper:qTe,content:YTe,header:XTe,body:JTe,footer:QTe,closeButton:ZTe}),twe=HTe({baseStyle:ewe}),{defineMultiStyleConfig:nwe,definePartsStyle:Iw}=Vi(lSe.keys),rwe=n=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=n,d=xn(_K(),_K("1rem","rgba(0,0,0,0.1)"))(n),f=xn(`${t}.500`,`${t}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${yc(s,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:y}:{bgColor:f}}},iwe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},swe=n=>({bg:xn("gray.100","whiteAlpha.300")(n)}),owe=n=>({transitionProperty:"common",transitionDuration:"slow",...rwe(n)}),awe=Iw(n=>({label:iwe,filledTrack:owe(n),track:swe(n)})),cwe={xs:Iw({track:{h:"1"}}),sm:Iw({track:{h:"2"}}),md:Iw({track:{h:"3"}}),lg:Iw({track:{h:"4"}})},lwe=nwe({sizes:cwe,baseStyle:awe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:uwe,definePartsStyle:DO}=Vi(uSe.keys),dwe=n=>{var s;const t=(s=Ec(rg.baseStyle,n))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},hwe=DO(n=>{var t,s;return{label:(t=rg.baseStyle)==null?void 0:t.call(rg,n).label,container:(s=rg.baseStyle)==null?void 0:s.call(rg,n).container,control:dwe(n)}}),pwe={md:DO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:DO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:DO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},fwe=uwe({baseStyle:hwe,sizes:pwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:mwe,definePartsStyle:gwe}=Vi(dSe.keys),tO=Mn("select-bg");var hQ;const _we={...(hQ=ti.baseStyle)==null?void 0:hQ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:tO.reference,[tO.variable]:"colors.white",_dark:{[tO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:tO.reference}},ywe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},Ewe=gwe({field:_we,icon:ywe}),nO={paddingInlineEnd:"8"};var pQ,fQ,mQ,gQ,_Q,yQ,EQ,vQ;const vwe={lg:{...(pQ=ti.sizes)==null?void 0:pQ.lg,field:{...(fQ=ti.sizes)==null?void 0:fQ.lg.field,...nO}},md:{...(mQ=ti.sizes)==null?void 0:mQ.md,field:{...(gQ=ti.sizes)==null?void 0:gQ.md.field,...nO}},sm:{...(_Q=ti.sizes)==null?void 0:_Q.sm,field:{...(yQ=ti.sizes)==null?void 0:yQ.sm.field,...nO}},xs:{...(EQ=ti.sizes)==null?void 0:EQ.xs,field:{...(vQ=ti.sizes)==null?void 0:vQ.xs.field,...nO},icon:{insetEnd:"1"}}},Swe=mwe({baseStyle:Ewe,sizes:vwe,variants:ti.variants,defaultProps:ti.defaultProps}),rM=Mn("skeleton-start-color"),iM=Mn("skeleton-end-color"),bwe={[rM.variable]:"colors.gray.100",[iM.variable]:"colors.gray.400",_dark:{[rM.variable]:"colors.gray.800",[iM.variable]:"colors.gray.600"},background:rM.reference,borderColor:iM.reference,opacity:.7,borderRadius:"sm"},Twe={baseStyle:bwe},sM=Mn("skip-link-bg"),wwe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[sM.variable]:"colors.white",_dark:{[sM.variable]:"colors.gray.700"},bg:sM.reference}},Cwe={baseStyle:wwe},{defineMultiStyleConfig:Rwe,definePartsStyle:aN}=Vi(hSe.keys),Iy=Mn("slider-thumb-size"),hC=Mn("slider-track-size"),ig=Mn("slider-bg"),Iwe=n=>{const{orientation:t}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...sF({orientation:t,vertical:{h:"100%",px:pf(Iy.reference).divide(2).toString()},horizontal:{w:"100%",py:pf(Iy.reference).divide(2).toString()}})}},Awe=n=>({...sF({orientation:n.orientation,horizontal:{h:hC.reference},vertical:{w:hC.reference}}),overflow:"hidden",borderRadius:"sm",[ig.variable]:"colors.gray.200",_dark:{[ig.variable]:"colors.whiteAlpha.200"},_disabled:{[ig.variable]:"colors.gray.300",_dark:{[ig.variable]:"colors.whiteAlpha.300"}},bg:ig.reference}),Pwe=n=>{const{orientation:t}=n;return{...sF({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Iy.reference,h:Iy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},Owe=n=>{const{colorScheme:t}=n;return{width:"inherit",height:"inherit",[ig.variable]:`colors.${t}.500`,_dark:{[ig.variable]:`colors.${t}.200`},bg:ig.reference}},kwe=aN(n=>({container:Iwe(n),track:Awe(n),thumb:Pwe(n),filledTrack:Owe(n)})),Nwe=aN({container:{[Iy.variable]:"sizes.4",[hC.variable]:"sizes.1"}}),Dwe=aN({container:{[Iy.variable]:"sizes.3.5",[hC.variable]:"sizes.1"}}),Lwe=aN({container:{[Iy.variable]:"sizes.2.5",[hC.variable]:"sizes.0.5"}}),xwe={lg:Nwe,md:Dwe,sm:Lwe},Mwe=Rwe({baseStyle:kwe,sizes:xwe,defaultProps:{size:"md",colorScheme:"blue"}}),uy=Eo("spinner-size"),Uwe={width:[uy.reference],height:[uy.reference]},Vwe={xs:{[uy.variable]:"sizes.3"},sm:{[uy.variable]:"sizes.4"},md:{[uy.variable]:"sizes.6"},lg:{[uy.variable]:"sizes.8"},xl:{[uy.variable]:"sizes.12"}},Fwe={baseStyle:Uwe,sizes:Vwe,defaultProps:{size:"md"}},{defineMultiStyleConfig:jwe,definePartsStyle:fZ}=Vi(pSe.keys),Bwe={fontWeight:"medium"},Wwe={opacity:.8,marginBottom:"2"},zwe={verticalAlign:"baseline",fontWeight:"semibold"},Gwe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},Hwe=fZ({container:{},label:Bwe,helpText:Wwe,number:zwe,icon:Gwe}),$we={md:fZ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},Kwe=jwe({baseStyle:Hwe,sizes:$we,defaultProps:{size:"md"}}),{defineMultiStyleConfig:qwe,definePartsStyle:Aw}=Vi(["stepper","step","title","description","indicator","separator","icon","number"]),mf=Mn("stepper-indicator-size"),OS=Mn("stepper-icon-size"),kS=Mn("stepper-title-font-size"),Pw=Mn("stepper-description-font-size"),ow=Mn("stepper-accent-color"),Ywe=Aw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[ow.variable]:`colors.${n}.500`,_dark:{[ow.variable]:`colors.${n}.200`}},title:{fontSize:kS.reference,fontWeight:"medium"},description:{fontSize:Pw.reference,color:"chakra-subtle-text"},number:{fontSize:kS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:OS.reference,height:OS.reference},indicator:{flexShrink:0,borderRadius:"full",width:mf.reference,height:mf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:ow.reference},"&[data-status=complete]":{bg:ow.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:ow.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${mf.reference} - 8px)`,top:`calc(${mf.reference} + 4px)`,insetStart:`calc(${mf.reference} / 2 - 1px)`}}})),Xwe=qwe({baseStyle:Ywe,sizes:{xs:Aw({stepper:{[mf.variable]:"sizes.4",[OS.variable]:"sizes.3",[kS.variable]:"fontSizes.xs",[Pw.variable]:"fontSizes.xs"}}),sm:Aw({stepper:{[mf.variable]:"sizes.6",[OS.variable]:"sizes.4",[kS.variable]:"fontSizes.sm",[Pw.variable]:"fontSizes.xs"}}),md:Aw({stepper:{[mf.variable]:"sizes.8",[OS.variable]:"sizes.5",[kS.variable]:"fontSizes.md",[Pw.variable]:"fontSizes.sm"}}),lg:Aw({stepper:{[mf.variable]:"sizes.10",[OS.variable]:"sizes.6",[kS.variable]:"fontSizes.lg",[Pw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Jwe,definePartsStyle:LO}=Vi(fSe.keys),Kw=Eo("switch-track-width"),yy=Eo("switch-track-height"),oM=Eo("switch-track-diff"),Qwe=ff.subtract(Kw,yy),SU=Eo("switch-thumb-x"),aw=Eo("switch-bg"),Zwe=n=>{const{colorScheme:t}=n;return{borderRadius:"full",p:"0.5",width:[Kw.reference],height:[yy.reference],transitionProperty:"common",transitionDuration:"fast",[aw.variable]:"colors.gray.300",_dark:{[aw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[aw.variable]:`colors.${t}.500`,_dark:{[aw.variable]:`colors.${t}.200`}},bg:aw.reference}},eCe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[yy.reference],height:[yy.reference],_checked:{transform:`translateX(${SU.reference})`}},tCe=LO(n=>({container:{[oM.variable]:Qwe,[SU.variable]:oM.reference,_rtl:{[SU.variable]:ff(oM).negate().toString()}},track:Zwe(n),thumb:eCe})),nCe={sm:LO({container:{[Kw.variable]:"1.375rem",[yy.variable]:"sizes.3"}}),md:LO({container:{[Kw.variable]:"1.875rem",[yy.variable]:"sizes.4"}}),lg:LO({container:{[Kw.variable]:"2.875rem",[yy.variable]:"sizes.6"}})},rCe=Jwe({baseStyle:tCe,sizes:nCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:iCe,definePartsStyle:KS}=Vi(mSe.keys),sCe=KS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),_k={"&[data-is-numeric=true]":{textAlign:"end"}},oCe=KS(n=>{const{colorScheme:t}=n;return{th:{color:xn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:xn(`${t}.100`,`${t}.700`)(n),..._k},td:{borderBottom:"1px",borderColor:xn(`${t}.100`,`${t}.700`)(n),..._k},caption:{color:xn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),aCe=KS(n=>{const{colorScheme:t}=n;return{th:{color:xn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:xn(`${t}.100`,`${t}.700`)(n),..._k},td:{borderBottom:"1px",borderColor:xn(`${t}.100`,`${t}.700`)(n),..._k},caption:{color:xn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:xn(`${t}.100`,`${t}.700`)(n)},td:{background:xn(`${t}.100`,`${t}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),cCe={simple:oCe,striped:aCe,unstyled:{}},lCe={sm:KS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:KS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:KS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},uCe=iCe({baseStyle:sCe,variants:cCe,sizes:lCe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),rl=Mn("tabs-color"),Pd=Mn("tabs-bg"),rO=Mn("tabs-border-color"),{defineMultiStyleConfig:dCe,definePartsStyle:Kh}=Vi(gSe.keys),hCe=n=>{const{orientation:t}=n;return{display:t==="vertical"?"flex":"block"}},pCe=n=>{const{isFitted:t}=n;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},fCe=n=>{const{align:t="start",orientation:s}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},mCe={p:4},gCe=Kh(n=>({root:hCe(n),tab:pCe(n),tablist:fCe(n),tabpanel:mCe})),_Ce={sm:Kh({tab:{py:1,px:4,fontSize:"sm"}}),md:Kh({tab:{fontSize:"md",py:2,px:4}}),lg:Kh({tab:{fontSize:"lg",py:3,px:4}})},yCe=Kh(n=>{const{colorScheme:t,orientation:s}=n,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[rl.variable]:`colors.${t}.600`,_dark:{[rl.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[Pd.variable]:"colors.gray.200",_dark:{[Pd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:rl.reference,bg:Pd.reference}}}),ECe=Kh(n=>{const{colorScheme:t}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[rO.variable]:"transparent",_selected:{[rl.variable]:`colors.${t}.600`,[rO.variable]:"colors.white",_dark:{[rl.variable]:`colors.${t}.300`,[rO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:rO.reference},color:rl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),vCe=Kh(n=>{const{colorScheme:t}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Pd.variable]:"colors.gray.50",_dark:{[Pd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Pd.variable]:"colors.white",[rl.variable]:`colors.${t}.600`,_dark:{[Pd.variable]:"colors.gray.800",[rl.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:rl.reference,bg:Pd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),SCe=Kh(n=>{const{colorScheme:t,theme:s}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:yc(s,`${t}.700`),bg:yc(s,`${t}.100`)}}}}),bCe=Kh(n=>{const{colorScheme:t}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[rl.variable]:"colors.gray.600",_dark:{[rl.variable]:"inherit"},_selected:{[rl.variable]:"colors.white",[Pd.variable]:`colors.${t}.600`,_dark:{[rl.variable]:"colors.gray.800",[Pd.variable]:`colors.${t}.300`}},color:rl.reference,bg:Pd.reference}}}),TCe=Kh({}),wCe={line:yCe,enclosed:ECe,"enclosed-colored":vCe,"soft-rounded":SCe,"solid-rounded":bCe,unstyled:TCe},CCe=dCe({baseStyle:gCe,sizes:_Ce,variants:wCe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:RCe,definePartsStyle:Ey}=Vi(_Se.keys),TK=Mn("tag-bg"),wK=Mn("tag-color"),aM=Mn("tag-shadow"),xO=Mn("tag-min-height"),MO=Mn("tag-min-width"),UO=Mn("tag-font-size"),VO=Mn("tag-padding-inline"),ICe={fontWeight:"medium",lineHeight:1.2,outline:0,[wK.variable]:$s.color.reference,[TK.variable]:$s.bg.reference,[aM.variable]:$s.shadow.reference,color:wK.reference,bg:TK.reference,boxShadow:aM.reference,borderRadius:"md",minH:xO.reference,minW:MO.reference,fontSize:UO.reference,px:VO.reference,_focusVisible:{[aM.variable]:"shadows.outline"}},ACe={lineHeight:1.2,overflow:"visible"},PCe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},OCe=Ey({container:ICe,label:ACe,closeButton:PCe}),kCe={sm:Ey({container:{[xO.variable]:"sizes.5",[MO.variable]:"sizes.5",[UO.variable]:"fontSizes.xs",[VO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Ey({container:{[xO.variable]:"sizes.6",[MO.variable]:"sizes.6",[UO.variable]:"fontSizes.sm",[VO.variable]:"space.2"}}),lg:Ey({container:{[xO.variable]:"sizes.8",[MO.variable]:"sizes.8",[UO.variable]:"fontSizes.md",[VO.variable]:"space.3"}})},NCe={subtle:Ey(n=>{var t;return{container:(t=Gw.variants)==null?void 0:t.subtle(n)}}),solid:Ey(n=>{var t;return{container:(t=Gw.variants)==null?void 0:t.solid(n)}}),outline:Ey(n=>{var t;return{container:(t=Gw.variants)==null?void 0:t.outline(n)}})},DCe=RCe({variants:NCe,baseStyle:OCe,sizes:kCe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var SQ;const LCe={...(SQ=ti.baseStyle)==null?void 0:SQ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var bQ;const xCe={outline:n=>{var t;return((t=ti.variants)==null?void 0:t.outline(n).field)??{}},flushed:n=>{var t;return((t=ti.variants)==null?void 0:t.flushed(n).field)??{}},filled:n=>{var t;return((t=ti.variants)==null?void 0:t.filled(n).field)??{}},unstyled:((bQ=ti.variants)==null?void 0:bQ.unstyled.field)??{}};var TQ,wQ,CQ,RQ;const MCe={xs:((TQ=ti.sizes)==null?void 0:TQ.xs.field)??{},sm:((wQ=ti.sizes)==null?void 0:wQ.sm.field)??{},md:((CQ=ti.sizes)==null?void 0:CQ.md.field)??{},lg:((RQ=ti.sizes)==null?void 0:RQ.lg.field)??{}},UCe={baseStyle:LCe,sizes:MCe,variants:xCe,defaultProps:{size:"md",variant:"outline"}},iO=Eo("tooltip-bg"),cM=Eo("tooltip-fg"),VCe=Eo("popper-arrow-bg"),FCe={bg:iO.reference,color:cM.reference,[iO.variable]:"colors.gray.700",[cM.variable]:"colors.whiteAlpha.900",_dark:{[iO.variable]:"colors.gray.300",[cM.variable]:"colors.gray.900"},[VCe.variable]:iO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},jCe={baseStyle:FCe},BCe={Accordion:RSe,Alert:l0e,Avatar:v0e,Badge:Gw,Breadcrumb:O0e,Button:F0e,Checkbox:rg,CloseButton:ebe,Code:ibe,Container:obe,Divider:dbe,Drawer:bbe,Editable:Pbe,Form:xbe,FormError:Bbe,FormLabel:zbe,Heading:$be,Input:ti,Kbd:nTe,Link:iTe,List:lTe,Menu:vTe,Modal:kTe,NumberInput:jTe,PinInput:GTe,Popover:twe,Progress:lwe,Radio:fwe,Select:Swe,Skeleton:Twe,SkipLink:Cwe,Slider:Mwe,Spinner:Fwe,Stat:Kwe,Switch:rCe,Table:uCe,Tabs:CCe,Tag:DCe,Textarea:UCe,Tooltip:jCe,Card:G0e,Stepper:Xwe},WCe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},zCe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},GCe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},HCe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},$Ce={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},KCe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},qCe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},YCe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},XCe={property:KCe,easing:qCe,duration:YCe},JCe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},QCe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},ZCe={breakpoints:zCe,zIndices:JCe,radii:HCe,blur:QCe,colors:GCe,...dZ,sizes:sZ,shadows:$Ce,space:iZ,borders:WCe,transition:XCe},eRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},tRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},nRe="ltr",rRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},iRe={semanticTokens:eRe,direction:nRe,...ZCe,components:BCe,styles:tRe,config:rRe};function sRe(n){if(n.sheet)return n.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===n)return document.styleSheets[t]}function oRe(n){var t=document.createElement("style");return t.setAttribute("data-emotion",n.key),n.nonce!==void 0&&t.setAttribute("nonce",n.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var aRe=function(){function n(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=n.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(oRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=sRe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),$a="-ms-",yk="-moz-",Zr="-webkit-",mZ="comm",lF="rule",uF="decl",cRe="@import",gZ="@keyframes",lRe="@layer",uRe=Math.abs,cN=String.fromCharCode,dRe=Object.assign;function hRe(n,t){return fa(n,0)^45?(((t<<2^fa(n,0))<<2^fa(n,1))<<2^fa(n,2))<<2^fa(n,3):0}function _Z(n){return n.trim()}function pRe(n,t){return(n=t.exec(n))?n[0]:n}function ei(n,t,s){return n.replace(t,s)}function bU(n,t){return n.indexOf(t)}function fa(n,t){return n.charCodeAt(t)|0}function pC(n,t,s){return n.slice(t,s)}function Mh(n){return n.length}function dF(n){return n.length}function sO(n,t){return t.push(n),n}function fRe(n,t){return n.map(t).join("")}var lN=1,o0=1,yZ=0,cl=0,eo=0,P0="";function uN(n,t,s,a,l,d,f){return{value:n,root:t,parent:s,type:a,props:l,children:d,line:lN,column:o0,length:f,return:""}}function cw(n,t){return dRe(uN("",null,null,"",null,null,0),n,{length:-n.length},t)}function mRe(){return eo}function gRe(){return eo=cl>0?fa(P0,--cl):0,o0--,eo===10&&(o0=1,lN--),eo}function Vl(){return eo=cl<yZ?fa(P0,cl++):0,o0++,eo===10&&(o0=1,lN++),eo}function qh(){return fa(P0,cl)}function FO(){return cl}function FC(n,t){return pC(P0,n,t)}function fC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function EZ(n){return lN=o0=1,yZ=Mh(P0=n),cl=0,[]}function vZ(n){return P0="",n}function jO(n){return _Z(FC(cl-1,TU(n===91?n+2:n===40?n+1:n)))}function _Re(n){for(;(eo=qh())&&eo<33;)Vl();return fC(n)>2||fC(eo)>3?"":" "}function yRe(n,t){for(;--t&&Vl()&&!(eo<48||eo>102||eo>57&&eo<65||eo>70&&eo<97););return FC(n,FO()+(t<6&&qh()==32&&Vl()==32))}function TU(n){for(;Vl();)switch(eo){case n:return cl;case 34:case 39:n!==34&&n!==39&&TU(eo);break;case 40:n===41&&TU(n);break;case 92:Vl();break}return cl}function ERe(n,t){for(;Vl()&&n+eo!==57;)if(n+eo===84&&qh()===47)break;return"/*"+FC(t,cl-1)+"*"+cN(n===47?n:Vl())}function vRe(n){for(;!fC(qh());)Vl();return FC(n,cl)}function SRe(n){return vZ(BO("",null,null,null,[""],n=EZ(n),0,[0],n))}function BO(n,t,s,a,l,d,f,y,v){for(var b=0,w=0,I=f,k=0,x=0,F=0,B=1,z=1,J=1,$=0,ie="",ue=l,re=d,fe=a,q=ie;z;)switch(F=$,$=Vl()){case 40:if(F!=108&&fa(q,I-1)==58){bU(q+=ei(jO($),"&","&\f"),"&\f")!=-1&&(J=-1);break}case 34:case 39:case 91:q+=jO($);break;case 9:case 10:case 13:case 32:q+=_Re(F);break;case 92:q+=yRe(FO()-1,7);continue;case 47:switch(qh()){case 42:case 47:sO(bRe(ERe(Vl(),FO()),t,s),v);break;default:q+="/"}break;case 123*B:y[b++]=Mh(q)*J;case 125*B:case 59:case 0:switch($){case 0:case 125:z=0;case 59+w:J==-1&&(q=ei(q,/\f/g,"")),x>0&&Mh(q)-I&&sO(x>32?RK(q+";",a,s,I-1):RK(ei(q," ","")+";",a,s,I-2),v);break;case 59:q+=";";default:if(sO(fe=CK(q,t,s,b,w,l,y,ie,ue=[],re=[],I),d),$===123)if(w===0)BO(q,t,fe,fe,ue,d,I,y,re);else switch(k===99&&fa(q,3)===110?100:k){case 100:case 108:case 109:case 115:BO(n,fe,fe,a&&sO(CK(n,fe,fe,0,0,l,y,ie,l,ue=[],I),re),l,re,I,y,a?ue:re);break;default:BO(q,fe,fe,fe,[""],re,0,y,re)}}b=w=x=0,B=J=1,ie=q="",I=f;break;case 58:I=1+Mh(q),x=F;default:if(B<1){if($==123)--B;else if($==125&&B++==0&&gRe()==125)continue}switch(q+=cN($),$*B){case 38:J=w>0?1:(q+="\f",-1);break;case 44:y[b++]=(Mh(q)-1)*J,J=1;break;case 64:qh()===45&&(q+=jO(Vl())),k=qh(),w=I=Mh(ie=q+=vRe(FO())),$++;break;case 45:F===45&&Mh(q)==2&&(B=0)}}return d}function CK(n,t,s,a,l,d,f,y,v,b,w){for(var I=l-1,k=l===0?d:[""],x=dF(k),F=0,B=0,z=0;F<a;++F)for(var J=0,$=pC(n,I+1,I=uRe(B=f[F])),ie=n;J<x;++J)(ie=_Z(B>0?k[J]+" "+$:ei($,/&\f/g,k[J])))&&(v[z++]=ie);return uN(n,t,s,l===0?lF:y,v,b,w)}function bRe(n,t,s){return uN(n,t,s,mZ,cN(mRe()),pC(n,2,-2),0)}function RK(n,t,s,a){return uN(n,t,s,uF,pC(n,0,a),pC(n,a+1,-1),a)}function qS(n,t){for(var s="",a=dF(n),l=0;l<a;l++)s+=t(n[l],l,n,t)||"";return s}function TRe(n,t,s,a){switch(n.type){case lRe:if(n.children.length)break;case cRe:case uF:return n.return=n.return||n.value;case mZ:return"";case gZ:return n.return=n.value+"{"+qS(n.children,a)+"}";case lF:n.value=n.props.join(",")}return Mh(s=qS(n.children,a))?n.return=n.value+"{"+s+"}":""}function wRe(n){var t=dF(n);return function(s,a,l,d){for(var f="",y=0;y<t;y++)f+=n[y](s,a,l,d)||"";return f}}function CRe(n){return function(t){t.root||(t=t.return)&&n(t)}}var IK=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function SZ(n){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=n(s)),t[s]}}var RRe=function(t,s,a){for(var l=0,d=0;l=d,d=qh(),l===38&&d===12&&(s[a]=1),!fC(d);)Vl();return FC(t,cl)},IRe=function(t,s){var a=-1,l=44;do switch(fC(l)){case 0:l===38&&qh()===12&&(s[a]=1),t[a]+=RRe(cl-1,s,a);break;case 2:t[a]+=jO(l);break;case 4:if(l===44){t[++a]=qh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=cN(l)}while(l=Vl());return t},ARe=function(t,s){return vZ(IRe(EZ(t),s))},AK=new WeakMap,PRe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!AK.get(a))&&!l){AK.set(t,!0);for(var d=[],f=ARe(s,d),y=a.props,v=0,b=0;v<f.length;v++)for(var w=0;w<y.length;w++,b++)t.props[b]=d[v]?f[v].replace(/&\f/g,y[w]):y[w]+" "+f[v]}}},ORe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function bZ(n,t){switch(hRe(n,t)){case 5103:return Zr+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Zr+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Zr+n+yk+n+$a+n+n;case 6828:case 4268:return Zr+n+$a+n+n;case 6165:return Zr+n+$a+"flex-"+n+n;case 5187:return Zr+n+ei(n,/(\w+).+(:[^]+)/,Zr+"box-$1$2"+$a+"flex-$1$2")+n;case 5443:return Zr+n+$a+"flex-item-"+ei(n,/flex-|-self/,"")+n;case 4675:return Zr+n+$a+"flex-line-pack"+ei(n,/align-content|flex-|-self/,"")+n;case 5548:return Zr+n+$a+ei(n,"shrink","negative")+n;case 5292:return Zr+n+$a+ei(n,"basis","preferred-size")+n;case 6060:return Zr+"box-"+ei(n,"-grow","")+Zr+n+$a+ei(n,"grow","positive")+n;case 4554:return Zr+ei(n,/([^-])(transform)/g,"$1"+Zr+"$2")+n;case 6187:return ei(ei(ei(n,/(zoom-|grab)/,Zr+"$1"),/(image-set)/,Zr+"$1"),n,"")+n;case 5495:case 3959:return ei(n,/(image-set\([^]*)/,Zr+"$1$`$1");case 4968:return ei(ei(n,/(.+:)(flex-)?(.*)/,Zr+"box-pack:$3"+$a+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Zr+n+n;case 4095:case 3583:case 4068:case 2532:return ei(n,/(.+)-inline(.+)/,Zr+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Mh(n)-1-t>6)switch(fa(n,t+1)){case 109:if(fa(n,t+4)!==45)break;case 102:return ei(n,/(.+:)(.+)-([^]+)/,"$1"+Zr+"$2-$3$1"+yk+(fa(n,t+3)==108?"$3":"$2-$3"))+n;case 115:return~bU(n,"stretch")?bZ(ei(n,"stretch","fill-available"),t)+n:n}break;case 4949:if(fa(n,t+1)!==115)break;case 6444:switch(fa(n,Mh(n)-3-(~bU(n,"!important")&&10))){case 107:return ei(n,":",":"+Zr)+n;case 101:return ei(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Zr+(fa(n,14)===45?"inline-":"")+"box$3$1"+Zr+"$2$3$1"+$a+"$2box$3")+n}break;case 5936:switch(fa(n,t+11)){case 114:return Zr+n+$a+ei(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Zr+n+$a+ei(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Zr+n+$a+ei(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return Zr+n+$a+n+n}return n}var kRe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case uF:t.return=bZ(t.value,t.length);break;case gZ:return qS([cw(t,{value:ei(t.value,"@","@"+Zr)})],l);case lF:if(t.length)return fRe(t.props,function(d){switch(pRe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return qS([cw(t,{props:[ei(d,/:(read-\w+)/,":"+yk+"$1")]})],l);case"::placeholder":return qS([cw(t,{props:[ei(d,/:(plac\w+)/,":"+Zr+"input-$1")]}),cw(t,{props:[ei(d,/:(plac\w+)/,":"+yk+"$1")]}),cw(t,{props:[ei(d,/:(plac\w+)/,$a+"input-$1")]})],l)}return""})}},NRe=[kRe],DRe=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(B){var z=B.getAttribute("data-emotion");z.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=t.stylisPlugins||NRe,d={},f,y=[];f=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(B){for(var z=B.getAttribute("data-emotion").split(" "),J=1;J<z.length;J++)d[z[J]]=!0;y.push(B)});var v,b=[PRe,ORe];{var w,I=[TRe,CRe(function(B){w.insert(B)})],k=wRe(b.concat(l,I)),x=function(z){return qS(SRe(z),k)};v=function(z,J,$,ie){w=$,x(z?z+"{"+J.styles+"}":J.styles),ie&&(F.inserted[J.name]=!0)}}var F={key:s,sheet:new aRe({key:s,container:f,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return F.sheet.hydrate(y),F};function Ay(){return Ay=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},Ay.apply(null,arguments)}var lM={exports:{}},li={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PK;function LRe(){if(PK)return li;PK=1;var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,s=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,k=n?Symbol.for("react.suspense_list"):60120,x=n?Symbol.for("react.memo"):60115,F=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,z=n?Symbol.for("react.fundamental"):60117,J=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function ie(re){if(typeof re=="object"&&re!==null){var fe=re.$$typeof;switch(fe){case t:switch(re=re.type,re){case v:case b:case a:case d:case l:case I:return re;default:switch(re=re&&re.$$typeof,re){case y:case w:case F:case x:case f:return re;default:return fe}}case s:return fe}}}function ue(re){return ie(re)===b}return li.AsyncMode=v,li.ConcurrentMode=b,li.ContextConsumer=y,li.ContextProvider=f,li.Element=t,li.ForwardRef=w,li.Fragment=a,li.Lazy=F,li.Memo=x,li.Portal=s,li.Profiler=d,li.StrictMode=l,li.Suspense=I,li.isAsyncMode=function(re){return ue(re)||ie(re)===v},li.isConcurrentMode=ue,li.isContextConsumer=function(re){return ie(re)===y},li.isContextProvider=function(re){return ie(re)===f},li.isElement=function(re){return typeof re=="object"&&re!==null&&re.$$typeof===t},li.isForwardRef=function(re){return ie(re)===w},li.isFragment=function(re){return ie(re)===a},li.isLazy=function(re){return ie(re)===F},li.isMemo=function(re){return ie(re)===x},li.isPortal=function(re){return ie(re)===s},li.isProfiler=function(re){return ie(re)===d},li.isStrictMode=function(re){return ie(re)===l},li.isSuspense=function(re){return ie(re)===I},li.isValidElementType=function(re){return typeof re=="string"||typeof re=="function"||re===a||re===b||re===d||re===l||re===I||re===k||typeof re=="object"&&re!==null&&(re.$$typeof===F||re.$$typeof===x||re.$$typeof===f||re.$$typeof===y||re.$$typeof===w||re.$$typeof===z||re.$$typeof===J||re.$$typeof===$||re.$$typeof===B)},li.typeOf=ie,li}var OK;function xRe(){return OK||(OK=1,lM.exports=LRe()),lM.exports}var uM,kK;function MRe(){if(kK)return uM;kK=1;var n=xRe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function f(F){return n.isMemo(F)?l:d[F.$$typeof]||t}var y=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,k=Object.prototype;function x(F,B,z){if(typeof B!="string"){if(k){var J=I(B);J&&J!==k&&x(F,J,z)}var $=v(B);b&&($=$.concat(b(B)));for(var ie=f(F),ue=f(B),re=0;re<$.length;++re){var fe=$[re];if(!s[fe]&&!(z&&z[fe])&&!(ue&&ue[fe])&&!(ie&&ie[fe])){var q=w(B,fe);try{y(F,fe,q)}catch{}}}}return F}return uM=x,uM}var URe=MRe();const VRe=Pg(URe);var FRe=!0;function TZ(n,t,s){var a="";return s.split(" ").forEach(function(l){n[l]!==void 0?t.push(n[l]+";"):l&&(a+=l+" ")}),a}var hF=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||FRe===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},pF=function(t,s,a){hF(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function jRe(n){for(var t=0,s,a=0,l=n.length;l>=4;++a,l-=4)s=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(n.charCodeAt(a+2)&255)<<16;case 2:t^=(n.charCodeAt(a+1)&255)<<8;case 1:t^=n.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var BRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},WRe=/[A-Z]|^ms/g,zRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,wZ=function(t){return t.charCodeAt(1)===45},NK=function(t){return t!=null&&typeof t!="boolean"},dM=SZ(function(n){return wZ(n)?n:n.replace(WRe,"-$&").toLowerCase()}),DK=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(zRe,function(a,l,d){return Uh={name:l,styles:d,next:Uh},l})}return BRe[t]!==1&&!wZ(t)&&typeof s=="number"&&s!==0?s+"px":s};function mC(n,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return Uh={name:l.name,styles:l.styles,next:Uh},l.name;var d=s;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)Uh={name:f.name,styles:f.styles,next:Uh},f=f.next;var y=d.styles+";";return y}return GRe(n,t,s)}case"function":{if(n!==void 0){var v=Uh,b=s(n);return Uh=v,mC(n,t,b)}break}}var w=s;if(t==null)return w;var I=t[w];return I!==void 0?I:w}function GRe(n,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=mC(n,t,s[l])+";";else for(var d in s){var f=s[d];if(typeof f!="object"){var y=f;t!=null&&t[y]!==void 0?a+=d+"{"+t[y]+"}":NK(y)&&(a+=dM(d)+":"+DK(d,y)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(t==null||t[f[0]]===void 0))for(var v=0;v<f.length;v++)NK(f[v])&&(a+=dM(d)+":"+DK(d,f[v])+";");else{var b=mC(n,t,f);switch(d){case"animation":case"animationName":{a+=dM(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var LK=/label:\s*([^\s;{]+)\s*(;|$)/g,Uh;function dN(n,t,s){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Uh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=mC(s,t,d);else{var f=d;l+=f[0]}for(var y=1;y<n.length;y++)if(l+=mC(s,t,n[y]),a){var v=d;l+=v[y]}LK.lastIndex=0;for(var b="",w;(w=LK.exec(l))!==null;)b+="-"+w[1];var I=jRe(l)+b;return{name:I,styles:l,next:Uh}}var HRe=function(t){return t()},CZ=G$.useInsertionEffect?G$.useInsertionEffect:!1,RZ=CZ||HRe,xK=CZ||D.useLayoutEffect,fF=D.createContext(typeof HTMLElement<"u"?DRe({key:"css"}):null);fF.Provider;var $Re=function(){return D.useContext(fF)},mF=function(t){return D.forwardRef(function(s,a){var l=D.useContext(fF);return t(s,l,a)})},a0=D.createContext({}),KRe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return Ay({},t,s)},qRe=IK(function(n){return IK(function(t){return KRe(n,t)})}),YRe=function(t){var s=D.useContext(a0);return t.theme!==s&&(s=qRe(s)(t.theme)),D.createElement(a0.Provider,{value:s},t.children)},gF={}.hasOwnProperty,wU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",XRe=function(t,s){var a={};for(var l in s)gF.call(s,l)&&(a[l]=s[l]);return a[wU]=t,a},JRe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return hF(s,a,l),RZ(function(){return pF(s,a,l)}),null},QRe=mF(function(n,t,s){var a=n.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=n[wU],d=[a],f="";typeof n.className=="string"?f=TZ(t.registered,d,n.className):n.className!=null&&(f=n.className+" ");var y=dN(d,void 0,D.useContext(a0));f+=t.key+"-"+y.name;var v={};for(var b in n)gF.call(n,b)&&b!=="css"&&b!==wU&&(v[b]=n[b]);return v.className=f,s&&(v.ref=s),D.createElement(D.Fragment,null,D.createElement(JRe,{cache:t,serialized:y,isStringTag:typeof l=="string"}),D.createElement(l,v))}),ZRe=QRe,MK=function(t,s){var a=arguments;if(s==null||!gF.call(s,"css"))return D.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=ZRe,d[1]=XRe(t,s);for(var f=2;f<l;f++)d[f]=a[f];return D.createElement.apply(null,d)};(function(n){var t;t||(t=n.JSX||(n.JSX={}))})(MK||(MK={}));var hN=mF(function(n,t){var s=n.styles,a=dN([s],void 0,D.useContext(a0)),l=D.useRef();return xK(function(){var d=t.key+"-global",f=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),y=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(f.before=t.sheet.tags[0]),v!==null&&(y=!0,v.setAttribute("data-emotion",d),f.hydrate([v])),l.current=[f,y],function(){f.flush()}},[t]),xK(function(){var d=l.current,f=d[0],y=d[1];if(y){d[1]=!1;return}if(a.next!==void 0&&pF(t,a.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}t.insert("",a,f,!1)},[t,a.name]),null});function eIe(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return dN(t)}function jC(){var n=eIe.apply(void 0,arguments),t="animation-"+n.name;return{name:t,styles:"@keyframes "+t+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const _F=D.createContext({});_F.displayName="ColorModeContext";function pN(){const n=D.useContext(_F);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function tIe(n,t){const{colorMode:s}=pN();return s==="dark"?t:n}const oO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function nIe(n={}){const{preventTransition:t=!0,nonce:s}=n,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?oO.dark:oO.light),document.body.classList.remove(l?oO.light:oO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=y=>{l(y.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const rIe="chakra-ui-color-mode";function iIe(n){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(n)||t}catch{}return s||t},set(t){try{localStorage.setItem(n,t)}catch{}}}}const sIe=iIe(rIe),UK=()=>{},oIe=Sye()?D.useLayoutEffect:D.useEffect;function VK(n,t){return n.type==="cookie"&&n.ssr?n.get(t):t}const IZ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:y=sIe}=t,v=$Re(),b=d==="dark"?"dark":"light",[w,I]=D.useState(()=>VK(y,b)),[k,x]=D.useState(()=>VK(y)),{getSystemTheme:F,setClassName:B,setDataset:z,addListener:J}=D.useMemo(()=>nIe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),$=d==="system"&&!w?k:w,ie=D.useCallback(fe=>{const q=fe==="system"?F():fe;I(q),B(q==="dark"),z(q),y.set(q)},[y,F,B,z]);oIe(()=>{d==="system"&&x(F())},[]),D.useEffect(()=>{const fe=y.get();if(fe){ie(fe);return}if(d==="system"){ie("system");return}ie(b)},[y,b,d,ie]);const ue=D.useCallback(()=>{ie($==="dark"?"light":"dark")},[$,ie]);D.useEffect(()=>{if(l)return J(ie)},[l,J,ie]);const re=D.useMemo(()=>({colorMode:s??$,toggleColorMode:s?UK:ue,setColorMode:s?UK:ie,forced:s!==void 0}),[$,ue,ie,s]);return R.jsx(_F.Provider,{value:re,children:a})};IZ.displayName="ColorModeProvider";const AZ=String.raw,PZ=AZ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,aIe=()=>R.jsx(hN,{styles:PZ}),cIe=({scope:n=""})=>R.jsx(hN,{styles:AZ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${PZ}
    `});function lIe(n){const{cssVarsRoot:t,theme:s,children:a}=n,l=D.useMemo(()=>Kve(s),[s]);return R.jsxs(YRe,{theme:l,children:[R.jsx(uIe,{root:t}),a]})}function uIe({root:n=":host, :root"}){const t=[n,"[data-theme]"].join(",");return R.jsx(hN,{styles:s=>({[t]:s.__cssVars})})}Ai({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function dIe(){const{colorMode:n}=pN();return R.jsx(hN,{styles:t=>{const s=MQ(t,"styles.global"),a=sl(s,{theme:t,colorMode:n});return a?eZ(a)(t):void 0}})}const[hIe,pIe]=Ai({strict:!1,name:"PortalManagerContext"});function yF(n){const{children:t,zIndex:s}=n;return R.jsx(hIe,{value:{zIndex:s},children:t})}yF.displayName="PortalManager";const EF=D.createContext({getDocument(){return document},getWindow(){return window}});EF.displayName="EnvironmentContext";function fIe({defer:n}={}){const[,t]=D.useReducer(s=>s+1,0);return $h(()=>{n&&t()},[n]),D.useContext(EF)}function OZ(n){const{children:t,environment:s,disabled:a}=n,l=D.useRef(null),d=D.useMemo(()=>s||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[s]),f=!a||!s;return R.jsxs(EF.Provider,{value:d,children:[t,f&&R.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}OZ.displayName="EnvironmentProvider";const mIe=n=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:y,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:w}=n,I=R.jsx(OZ,{environment:y,disabled:b,children:t});return R.jsx(lIe,{theme:f,cssVarsRoot:v,children:R.jsxs(IZ,{colorModeManager:s,options:f.config,children:[d?R.jsx(cIe,{scope:l}):R.jsx(aIe,{}),!w&&R.jsx(dIe,{}),a?R.jsx(yF,{zIndex:a,children:I}):I]})})},vF=D.createContext({});function SF(n){const t=D.useRef(null);return t.current===null&&(t.current=n()),t.current}const BC=D.createContext(null),bF=D.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class gIe extends D.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function _Ie({children:n,isPresent:t}){const s=D.useId(),a=D.useRef(null),l=D.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=D.useContext(bF);return D.useInsertionEffect(()=>{const{width:f,height:y,top:v,left:b}=l.current;if(t||!a.current||!f||!y)return;a.current.dataset.motionPopId=s;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${y}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[t]),R.jsx(gIe,{isPresent:t,childRef:a,sizeRef:l,children:D.cloneElement(n,{ref:a})})}const yIe=({children:n,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const y=SF(EIe),v=D.useId(),b=D.useCallback(I=>{y.set(I,!0);for(const k of y.values())if(!k)return;a&&a()},[y,a]),w=D.useMemo(()=>({id:v,initial:t,isPresent:s,custom:l,onExitComplete:b,register:I=>(y.set(I,!1),()=>y.delete(I))}),d?[Math.random(),b]:[s,b]);return D.useMemo(()=>{y.forEach((I,k)=>y.set(k,!1))},[s]),D.useEffect(()=>{!s&&!y.size&&a&&a()},[s]),f==="popLayout"&&(n=R.jsx(_Ie,{isPresent:s,children:n})),R.jsx(BC.Provider,{value:w,children:n})};function EIe(){return new Map}function TF(n=!0){const t=D.useContext(BC);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=D.useId();D.useEffect(()=>{n&&l(d)},[n]);const f=D.useCallback(()=>n&&a&&a(d),[d,a,n]);return!s&&a?[!1,f]:[!0]}function vIe(){return SIe(D.useContext(BC))}function SIe(n){return n===null?!0:n.isPresent}const aO=n=>n.key||"";function FK(n){const t=[];return D.Children.forEach(n,s=>{D.isValidElement(s)&&t.push(s)}),t}const wF=typeof window<"u",kZ=wF?D.useLayoutEffect:D.useEffect,O0=({children:n,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[y,v]=TF(f),b=D.useMemo(()=>FK(n),[n]),w=f&&!y?[]:b.map(aO),I=D.useRef(!0),k=D.useRef(b),x=SF(()=>new Map),[F,B]=D.useState(b),[z,J]=D.useState(b);kZ(()=>{I.current=!1,k.current=b;for(let ue=0;ue<z.length;ue++){const re=aO(z[ue]);w.includes(re)?x.delete(re):x.get(re)!==!0&&x.set(re,!1)}},[z,w.length,w.join("-")]);const $=[];if(b!==F){let ue=[...b];for(let re=0;re<z.length;re++){const fe=z[re],q=aO(fe);w.includes(q)||(ue.splice(re,0,fe),$.push(fe))}d==="wait"&&$.length&&(ue=$),J(FK(ue)),B(b);return}const{forceRender:ie}=D.useContext(vF);return R.jsx(R.Fragment,{children:z.map(ue=>{const re=aO(ue),fe=f&&!y?!1:b===z||w.includes(re),q=()=>{if(x.has(re))x.set(re,!0);else return;let X=!0;x.forEach(Q=>{Q||(X=!1)}),X&&(ie==null||ie(),J(k.current),f&&(v==null||v()),a&&a())};return R.jsx(yIe,{isPresent:fe,initial:!I.current||s?void 0:!1,custom:fe?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:fe?void 0:q,children:ue},re)})})},Fl=n=>n;let NZ=Fl;function CF(n){let t;return()=>(t===void 0&&(t=n()),t)}const c0=(n,t,s)=>{const a=t-n;return a===0?1:(s-n)/a},Rf=n=>n*1e3,If=n=>n/1e3,bIe={useManualTiming:!1};function TIe(n){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function y(b){d.has(b)&&(v.schedule(b),n()),b(f)}const v={schedule:(b,w=!1,I=!1)=>{const x=I&&a?t:s;return w&&d.add(b),x.has(b)||x.add(b),b},cancel:b=>{s.delete(b),d.delete(b)},process:b=>{if(f=b,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(y),t.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const cO=["read","resolveKeyframes","update","preRender","render","postRender"],wIe=40;function DZ(n,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,f=cO.reduce((J,$)=>(J[$]=TIe(d),J),{}),{read:y,resolveKeyframes:v,update:b,preRender:w,render:I,postRender:k}=f,x=()=>{const J=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(J-l.timestamp,wIe),1),l.timestamp=J,l.isProcessing=!0,y.process(l),v.process(l),b.process(l),w.process(l),I.process(l),k.process(l),l.isProcessing=!1,s&&t&&(a=!1,n(x))},F=()=>{s=!0,a=!0,l.isProcessing||n(x)};return{schedule:cO.reduce((J,$)=>{const ie=f[$];return J[$]=(ue,re=!1,fe=!1)=>(s||F(),ie.schedule(ue,re,fe)),J},{}),cancel:J=>{for(let $=0;$<cO.length;$++)f[cO[$]].cancel(J)},state:l,steps:f}}const{schedule:Zi,cancel:Eg,state:ha,steps:hM}=DZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Fl,!0),LZ=D.createContext({strict:!1}),jK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},l0={};for(const n in jK)l0[n]={isEnabled:t=>jK[n].some(s=>!!t[s])};function CIe(n){for(const t in n)l0[t]={...l0[t],...n[t]}}const RIe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ek(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||RIe.has(n)}let xZ=n=>!Ek(n);function IIe(n){n&&(xZ=t=>t.startsWith("on")?!Ek(t):n(t))}try{IIe(require("@emotion/is-prop-valid").default)}catch{}function AIe(n,t,s){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(xZ(l)||s===!0&&Ek(l)||!t&&!Ek(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function PIe(n){if(typeof Proxy>"u")return n;const t=new Map,s=(...a)=>n(...a);return new Proxy(s,{get:(a,l)=>l==="create"?n:(t.has(l)||t.set(l,n(l)),t.get(l))})}const fN=D.createContext({});function gC(n){return typeof n=="string"||Array.isArray(n)}function mN(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const RF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],IF=["initial",...RF];function gN(n){return mN(n.animate)||IF.some(t=>gC(n[t]))}function MZ(n){return!!(gN(n)||n.variants)}function OIe(n,t){if(gN(n)){const{initial:s,animate:a}=n;return{initial:s===!1||gC(s)?s:void 0,animate:gC(a)?a:void 0}}return n.inherit!==!1?t:{}}function kIe(n){const{initial:t,animate:s}=OIe(n,D.useContext(fN));return D.useMemo(()=>({initial:t,animate:s}),[BK(t),BK(s)])}function BK(n){return Array.isArray(n)?n.join(" "):n}const NIe=Symbol.for("motionComponentSymbol");function NS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function DIe(n,t,s){return D.useCallback(a=>{a&&n.onMount&&n.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):NS(s)&&(s.current=a))},[t])}const AF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),LIe="framerAppearId",UZ="data-"+AF(LIe),{schedule:PF}=DZ(queueMicrotask,!1),VZ=D.createContext({});function xIe(n,t,s,a,l){var d,f;const{visualElement:y}=D.useContext(fN),v=D.useContext(LZ),b=D.useContext(BC),w=D.useContext(bF).reducedMotion,I=D.useRef(null);a=a||v.renderer,!I.current&&a&&(I.current=a(n,{visualState:t,parent:y,props:s,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:w}));const k=I.current,x=D.useContext(VZ);k&&!k.projection&&l&&(k.type==="html"||k.type==="svg")&&MIe(I.current,s,l,x);const F=D.useRef(!1);D.useInsertionEffect(()=>{k&&F.current&&k.update(s,b)});const B=s[UZ],z=D.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,B)));return kZ(()=>{k&&(F.current=!0,window.MotionIsMounted=!0,k.updateFeatures(),PF.render(k.render),z.current&&k.animationState&&k.animationState.animateChanges())}),D.useEffect(()=>{k&&(!z.current&&k.animationState&&k.animationState.animateChanges(),z.current&&(queueMicrotask(()=>{var J;(J=window.MotionHandoffMarkAsComplete)===null||J===void 0||J.call(window,B)}),z.current=!1))}),k}function MIe(n,t,s,a){const{layoutId:l,layout:d,drag:f,dragConstraints:y,layoutScroll:v,layoutRoot:b}=t;n.projection=new s(n.latestValues,t["data-framer-portal-id"]?void 0:FZ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||y&&NS(y),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function FZ(n){if(n)return n.options.allowProjection!==!1?n.projection:FZ(n.parent)}function UIe({preloadedFeatures:n,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,f;n&&CIe(n);function y(b,w){let I;const k={...D.useContext(bF),...b,layoutId:VIe(b)},{isStatic:x}=k,F=kIe(b),B=a(b,x);if(!x&&wF){FIe();const z=jIe(k);I=z.MeasureLayout,F.visualElement=xIe(l,B,k,t,z.ProjectionNode)}return R.jsxs(fN.Provider,{value:F,children:[I&&F.visualElement?R.jsx(I,{visualElement:F.visualElement,...k}):null,s(l,b,DIe(B,F.visualElement,w),B,x,F.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const v=D.forwardRef(y);return v[NIe]=l,v}function VIe({layoutId:n}){const t=D.useContext(vF).id;return t&&n!==void 0?t+"-"+n:n}function FIe(n,t){D.useContext(LZ).strict}function jIe(n){const{drag:t,layout:s}=l0;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(n)||s!=null&&s.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const BIe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function OF(n){return typeof n!="string"||n.includes("-")?!1:!!(BIe.indexOf(n)>-1||/[A-Z]/u.test(n))}function WK(n){const t=[{},{}];return n==null||n.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function kF(n,t,s,a){if(typeof t=="function"){const[l,d]=WK(a);t=t(s!==void 0?s:n.custom,l,d)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[l,d]=WK(a);t=t(s!==void 0?s:n.custom,l,d)}return t}const CU=n=>Array.isArray(n),WIe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),zIe=n=>CU(n)?n[n.length-1]||0:n,Xa=n=>!!(n&&n.getVelocity);function WO(n){const t=Xa(n)?n.get():n;return WIe(t)?t.toValue():t}function GIe({scrapeMotionValuesFromProps:n,createRenderState:t,onUpdate:s},a,l,d){const f={latestValues:HIe(a,l,d,n),renderState:t()};return s&&(f.onMount=y=>s({props:a,current:y,...f}),f.onUpdate=y=>s(y)),f}const jZ=n=>(t,s)=>{const a=D.useContext(fN),l=D.useContext(BC),d=()=>GIe(n,t,a,l);return s?d():SF(d)};function HIe(n,t,s,a){const l={},d=a(n,{});for(const k in d)l[k]=WO(d[k]);let{initial:f,animate:y}=n;const v=gN(n),b=MZ(n);t&&b&&!v&&n.inherit!==!1&&(f===void 0&&(f=t.initial),y===void 0&&(y=t.animate));let w=s?s.initial===!1:!1;w=w||f===!1;const I=w?y:f;if(I&&typeof I!="boolean"&&!mN(I)){const k=Array.isArray(I)?I:[I];for(let x=0;x<k.length;x++){const F=kF(n,k[x]);if(F){const{transitionEnd:B,transition:z,...J}=F;for(const $ in J){let ie=J[$];if(Array.isArray(ie)){const ue=w?ie.length-1:0;ie=ie[ue]}ie!==null&&(l[$]=ie)}for(const $ in B)l[$]=B[$]}}}return l}const k0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],By=new Set(k0),BZ=n=>t=>typeof t=="string"&&t.startsWith(n),WZ=BZ("--"),$Ie=BZ("var(--"),NF=n=>$Ie(n)?KIe.test(n.split("/*")[0].trim()):!1,KIe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,zZ=(n,t)=>t&&typeof n=="number"?t.transform(n):n,Lf=(n,t,s)=>s>t?t:s<n?n:s,N0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},_C={...N0,transform:n=>Lf(0,1,n)},lO={...N0,default:1},WC=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),ng=WC("deg"),Yh=WC("%"),Fn=WC("px"),qIe=WC("vh"),YIe=WC("vw"),zK={...Yh,parse:n=>Yh.parse(n)/100,transform:n=>Yh.transform(n*100)},XIe={borderWidth:Fn,borderTopWidth:Fn,borderRightWidth:Fn,borderBottomWidth:Fn,borderLeftWidth:Fn,borderRadius:Fn,radius:Fn,borderTopLeftRadius:Fn,borderTopRightRadius:Fn,borderBottomRightRadius:Fn,borderBottomLeftRadius:Fn,width:Fn,maxWidth:Fn,height:Fn,maxHeight:Fn,top:Fn,right:Fn,bottom:Fn,left:Fn,padding:Fn,paddingTop:Fn,paddingRight:Fn,paddingBottom:Fn,paddingLeft:Fn,margin:Fn,marginTop:Fn,marginRight:Fn,marginBottom:Fn,marginLeft:Fn,backgroundPositionX:Fn,backgroundPositionY:Fn},JIe={rotate:ng,rotateX:ng,rotateY:ng,rotateZ:ng,scale:lO,scaleX:lO,scaleY:lO,scaleZ:lO,skew:ng,skewX:ng,skewY:ng,distance:Fn,translateX:Fn,translateY:Fn,translateZ:Fn,x:Fn,y:Fn,z:Fn,perspective:Fn,transformPerspective:Fn,opacity:_C,originX:zK,originY:zK,originZ:Fn},GK={...N0,transform:Math.round},DF={...XIe,...JIe,zIndex:GK,size:Fn,fillOpacity:_C,strokeOpacity:_C,numOctaves:GK},QIe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},ZIe=k0.length;function eAe(n,t,s){let a="",l=!0;for(let d=0;d<ZIe;d++){const f=k0[d],y=n[f];if(y===void 0)continue;let v=!0;if(typeof y=="number"?v=y===(f.startsWith("scale")?1:0):v=parseFloat(y)===0,!v||s){const b=zZ(y,DF[f]);if(!v){l=!1;const w=QIe[f]||f;a+=`${w}(${b}) `}s&&(t[f]=b)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function LF(n,t,s){const{style:a,vars:l,transformOrigin:d}=n;let f=!1,y=!1;for(const v in t){const b=t[v];if(By.has(v)){f=!0;continue}else if(WZ(v)){l[v]=b;continue}else{const w=zZ(b,DF[v]);v.startsWith("origin")?(y=!0,d[v]=w):a[v]=w}}if(t.transform||(f||s?a.transform=eAe(t,n.transform,s):a.transform&&(a.transform="none")),y){const{originX:v="50%",originY:b="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${b} ${w}`}}const tAe={offset:"stroke-dashoffset",array:"stroke-dasharray"},nAe={offset:"strokeDashoffset",array:"strokeDasharray"};function rAe(n,t,s=1,a=0,l=!0){n.pathLength=1;const d=l?tAe:nAe;n[d.offset]=Fn.transform(-a);const f=Fn.transform(t),y=Fn.transform(s);n[d.array]=`${f} ${y}`}function HK(n,t,s){return typeof n=="string"?n:Fn.transform(t+s*n)}function iAe(n,t,s){const a=HK(t,n.x,n.width),l=HK(s,n.y,n.height);return`${a} ${l}`}function xF(n,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:y=1,pathOffset:v=0,...b},w,I){if(LF(n,b,I),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:k,style:x,dimensions:F}=n;k.transform&&(F&&(x.transform=k.transform),delete k.transform),F&&(l!==void 0||d!==void 0||x.transform)&&(x.transformOrigin=iAe(F,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(k.x=t),s!==void 0&&(k.y=s),a!==void 0&&(k.scale=a),f!==void 0&&rAe(k,f,y,v,!1)}const MF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),GZ=()=>({...MF(),attrs:{}}),UF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function HZ(n,{style:t,vars:s},a,l){Object.assign(n.style,t,l&&l.getProjectionStyles(a));for(const d in s)n.style.setProperty(d,s[d])}const $Z=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function KZ(n,t,s,a){HZ(n,t,void 0,a);for(const l in t.attrs)n.setAttribute($Z.has(l)?l:AF(l),t.attrs[l])}const vk={};function sAe(n){Object.assign(vk,n)}function qZ(n,{layout:t,layoutId:s}){return By.has(n)||n.startsWith("origin")||(t||s!==void 0)&&(!!vk[n]||n==="opacity")}function VF(n,t,s){var a;const{style:l}=n,d={};for(const f in l)(Xa(l[f])||t.style&&Xa(t.style[f])||qZ(f,n)||((a=s==null?void 0:s.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function YZ(n,t,s){const a=VF(n,t,s);for(const l in n)if(Xa(n[l])||Xa(t[l])){const d=k0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function oAe(n,t){try{t.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const $K=["x","y","width","height","cx","cy","r"],aAe={useVisualState:jZ({scrapeMotionValuesFromProps:YZ,createRenderState:GZ,onUpdate:({props:n,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!n.drag;if(!d){for(const y in l)if(By.has(y)){d=!0;break}}if(!d)return;let f=!t;if(t)for(let y=0;y<$K.length;y++){const v=$K[y];n[v]!==t[v]&&(f=!0)}f&&Zi.read(()=>{oAe(s,a),Zi.render(()=>{xF(a,l,UF(s.tagName),n.transformTemplate),KZ(s,a)})})}})},cAe={useVisualState:jZ({scrapeMotionValuesFromProps:VF,createRenderState:MF})};function XZ(n,t,s){for(const a in t)!Xa(t[a])&&!qZ(a,s)&&(n[a]=t[a])}function lAe({transformTemplate:n},t){return D.useMemo(()=>{const s=MF();return LF(s,t,n),Object.assign({},s.vars,s.style)},[t])}function uAe(n,t){const s=n.style||{},a={};return XZ(a,s,n),Object.assign(a,lAe(n,t)),a}function dAe(n,t){const s={},a=uAe(n,t);return n.drag&&n.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(s.tabIndex=0),s.style=a,s}function hAe(n,t,s,a){const l=D.useMemo(()=>{const d=GZ();return xF(d,t,UF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(n.style){const d={};XZ(d,n.style,n),l.style={...d,...l.style}}return l}function pAe(n=!1){return(s,a,l,{latestValues:d},f)=>{const v=(OF(s)?hAe:dAe)(a,d,f,s),b=AIe(a,typeof s=="string",n),w=s!==D.Fragment?{...b,...v,ref:l}:{},{children:I}=a,k=D.useMemo(()=>Xa(I)?I.get():I,[I]);return D.createElement(s,{...w,children:k})}}function fAe(n,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...OF(a)?aAe:cAe,preloadedFeatures:n,useRender:pAe(l),createVisualElement:t,Component:a};return UIe(f)}}function JZ(n,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==n.length)return!1;for(let a=0;a<s;a++)if(t[a]!==n[a])return!1;return!0}function _N(n,t,s){const a=n.getProps();return kF(a,t,s!==void 0?s:a.custom,n)}const mAe=CF(()=>window.ScrollTimeline!==void 0);class gAe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(mAe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class _Ae extends gAe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function FF(n,t){return n?n[t]||n.default||n:void 0}const RU=2e4;function QZ(n){let t=0;const s=50;let a=n.next(t);for(;!a.done&&t<RU;)t+=s,a=n.next(t);return t>=RU?1/0:t}function jF(n){return typeof n=="function"}function KK(n,t){n.timeline=t,n.onfinish=null}const BF=n=>Array.isArray(n)&&typeof n[0]=="number",yAe={linearEasing:void 0};function EAe(n,t){const s=CF(n);return()=>{var a;return(a=yAe[t])!==null&&a!==void 0?a:s()}}const Sk=EAe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ZZ=(n,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=n(c0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function eee(n){return!!(typeof n=="function"&&Sk()||!n||typeof n=="string"&&(n in IU||Sk())||BF(n)||Array.isArray(n)&&n.every(eee))}const Ow=([n,t,s,a])=>`cubic-bezier(${n}, ${t}, ${s}, ${a})`,IU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ow([0,.65,.55,1]),circOut:Ow([.55,0,1,.45]),backIn:Ow([.31,.01,.66,-.59]),backOut:Ow([.33,1.53,.69,.99])};function tee(n,t){if(n)return typeof n=="function"&&Sk()?ZZ(n,t):BF(n)?Ow(n):Array.isArray(n)?n.map(s=>tee(s,t)||IU.easeOut):IU[n]}const Ad={x:!1,y:!1};function nee(){return Ad.x||Ad.y}function vAe(n,t,s){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function ree(n,t){const s=vAe(n),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function qK(n){return t=>{t.pointerType==="touch"||nee()||n(t)}}function SAe(n,t,s={}){const[a,l,d]=ree(n,s),f=qK(y=>{const{target:v}=y,b=t(y);if(typeof b!="function"||!v)return;const w=qK(I=>{b(I),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(y=>{y.addEventListener("pointerenter",f,l)}),d}const iee=(n,t)=>t?n===t?!0:iee(n,t.parentElement):!1,WF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,bAe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function TAe(n){return bAe.has(n.tagName)||n.tabIndex!==-1}const kw=new WeakSet;function YK(n){return t=>{t.key==="Enter"&&n(t)}}function pM(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const wAe=(n,t)=>{const s=n.currentTarget;if(!s)return;const a=YK(()=>{if(kw.has(s))return;pM(s,"down");const l=YK(()=>{pM(s,"up")}),d=()=>pM(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function XK(n){return WF(n)&&!nee()}function CAe(n,t,s={}){const[a,l,d]=ree(n,s),f=y=>{const v=y.currentTarget;if(!XK(y)||kw.has(v))return;kw.add(v);const b=t(y),w=(x,F)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",k),!(!XK(x)||!kw.has(v))&&(kw.delete(v),typeof b=="function"&&b(x,{success:F}))},I=x=>{w(x,s.useGlobalTarget||iee(v,x.target))},k=x=>{w(x,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",k,l)};return a.forEach(y=>{!TAe(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(s.useGlobalTarget?window:y).addEventListener("pointerdown",f,l),y.addEventListener("focus",b=>wAe(b,l),l)}),d}function RAe(n){return n==="x"||n==="y"?Ad[n]?null:(Ad[n]=!0,()=>{Ad[n]=!1}):Ad.x||Ad.y?null:(Ad.x=Ad.y=!0,()=>{Ad.x=Ad.y=!1})}const see=new Set(["width","height","top","left","right","bottom",...k0]);let zO;function IAe(){zO=void 0}const Xh={now:()=>(zO===void 0&&Xh.set(ha.isProcessing||bIe.useManualTiming?ha.timestamp:performance.now()),zO),set:n=>{zO=n,queueMicrotask(IAe)}};function zF(n,t){n.indexOf(t)===-1&&n.push(t)}function GF(n,t){const s=n.indexOf(t);s>-1&&n.splice(s,1)}class HF{constructor(){this.subscriptions=[]}add(t){return zF(this.subscriptions,t),()=>GF(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function oee(n,t){return t?n*(1e3/t):0}const JK=30,AAe=n=>!isNaN(parseFloat(n));class PAe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Xh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Xh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=AAe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new HF);const a=this.events[t].add(s);return t==="change"?()=>{a(),Zi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Xh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>JK)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,JK);return oee(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function yC(n,t){return new PAe(n,t)}function OAe(n,t,s){n.hasValue(t)?n.getValue(t).set(s):n.addValue(t,yC(s))}function kAe(n,t){const s=_N(n,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const f in d){const y=zIe(d[f]);OAe(n,f,y)}}function NAe(n){return!!(Xa(n)&&n.add)}function AU(n,t){const s=n.getValue("willChange");if(NAe(s))return s.add(t)}function aee(n){return n.props[UZ]}const cee=(n,t,s)=>(((1-3*s+3*t)*n+(3*s-6*t))*n+3*t)*n,DAe=1e-7,LAe=12;function xAe(n,t,s,a,l){let d,f,y=0;do f=t+(s-t)/2,d=cee(f,a,l)-n,d>0?s=f:t=f;while(Math.abs(d)>DAe&&++y<LAe);return f}function zC(n,t,s,a){if(n===t&&s===a)return Fl;const l=d=>xAe(d,0,1,n,s);return d=>d===0||d===1?d:cee(l(d),t,a)}const lee=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,uee=n=>t=>1-n(1-t),dee=zC(.33,1.53,.69,.99),$F=uee(dee),hee=lee($F),pee=n=>(n*=2)<1?.5*$F(n):.5*(2-Math.pow(2,-10*(n-1))),KF=n=>1-Math.sin(Math.acos(n)),fee=uee(KF),mee=lee(KF),gee=n=>/^0[^.\s]+$/u.test(n);function MAe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||gee(n):!0}const qw=n=>Math.round(n*1e5)/1e5,qF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function UAe(n){return n==null}const VAe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,YF=(n,t)=>s=>!!(typeof s=="string"&&VAe.test(s)&&s.startsWith(n)||t&&!UAe(s)&&Object.prototype.hasOwnProperty.call(s,t)),_ee=(n,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,f,y]=a.match(qF);return{[n]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(f),alpha:y!==void 0?parseFloat(y):1}},FAe=n=>Lf(0,255,n),fM={...N0,transform:n=>Math.round(FAe(n))},py={test:YF("rgb","red"),parse:_ee("red","green","blue"),transform:({red:n,green:t,blue:s,alpha:a=1})=>"rgba("+fM.transform(n)+", "+fM.transform(t)+", "+fM.transform(s)+", "+qw(_C.transform(a))+")"};function jAe(n){let t="",s="",a="",l="";return n.length>5?(t=n.substring(1,3),s=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(t=n.substring(1,2),s=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const PU={test:YF("#"),parse:jAe,transform:py.transform},DS={test:YF("hsl","hue"),parse:_ee("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(n)+", "+Yh.transform(qw(t))+", "+Yh.transform(qw(s))+", "+qw(_C.transform(a))+")"},Ka={test:n=>py.test(n)||PU.test(n)||DS.test(n),parse:n=>py.test(n)?py.parse(n):DS.test(n)?DS.parse(n):PU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?py.transform(n):DS.transform(n)},BAe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function WAe(n){var t,s;return isNaN(n)&&typeof n=="string"&&(((t=n.match(qF))===null||t===void 0?void 0:t.length)||0)+(((s=n.match(BAe))===null||s===void 0?void 0:s.length)||0)>0}const yee="number",Eee="color",zAe="var",GAe="var(",QK="${}",HAe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function EC(n){const t=n.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const y=t.replace(HAe,v=>(Ka.test(v)?(a.color.push(d),l.push(Eee),s.push(Ka.parse(v))):v.startsWith(GAe)?(a.var.push(d),l.push(zAe),s.push(v)):(a.number.push(d),l.push(yee),s.push(parseFloat(v))),++d,QK)).split(QK);return{values:s,split:y,indexes:a,types:l}}function vee(n){return EC(n).values}function See(n){const{split:t,types:s}=EC(n),a=t.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=t[f],l[f]!==void 0){const y=s[f];y===yee?d+=qw(l[f]):y===Eee?d+=Ka.transform(l[f]):d+=l[f]}return d}}const $Ae=n=>typeof n=="number"?0:n;function KAe(n){const t=vee(n);return See(n)(t.map($Ae))}const vg={test:WAe,parse:vee,createTransformer:See,getAnimatableNone:KAe},qAe=new Set(["brightness","contrast","saturate","opacity"]);function YAe(n){const[t,s]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[a]=s.match(qF)||[];if(!a)return n;const l=s.replace(a,"");let d=qAe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const XAe=/\b([a-z-]*)\(.*?\)/gu,OU={...vg,getAnimatableNone:n=>{const t=n.match(XAe);return t?t.map(YAe).join(" "):n}},JAe={...DF,color:Ka,backgroundColor:Ka,outlineColor:Ka,fill:Ka,stroke:Ka,borderColor:Ka,borderTopColor:Ka,borderRightColor:Ka,borderBottomColor:Ka,borderLeftColor:Ka,filter:OU,WebkitFilter:OU},XF=n=>JAe[n];function bee(n,t){let s=XF(n);return s!==OU&&(s=vg),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const QAe=new Set(["auto","none","0"]);function ZAe(n,t,s){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!QAe.has(d)&&EC(d).values.length&&(l=n[a]),a++}if(l&&s)for(const d of t)n[d]=bee(s,l)}const ZK=n=>n===N0||n===Fn,eq=(n,t)=>parseFloat(n.split(", ")[t]),tq=(n,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return eq(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?eq(d[1],n):0}},ePe=new Set(["x","y","z"]),tPe=k0.filter(n=>!ePe.has(n));function nPe(n){const t=[];return tPe.forEach(s=>{const a=n.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const u0={width:({x:n},{paddingLeft:t="0",paddingRight:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),height:({y:n},{paddingTop:t="0",paddingBottom:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:tq(4,13),y:tq(5,14)};u0.translateX=u0.x;u0.translateY=u0.y;const vy=new Set;let kU=!1,NU=!1;function Tee(){if(NU){const n=Array.from(vy).filter(a=>a.needsMeasurement),t=new Set(n.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=nPe(a);l.length&&(s.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,f])=>{var y;(y=a.getValue(d))===null||y===void 0||y.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}NU=!1,kU=!1,vy.forEach(n=>n.complete()),vy.clear()}function wee(){vy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(NU=!0)})}function rPe(){wee(),Tee()}class JF{constructor(t,s,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(vy.add(this),kU||(kU=!0,Zi.read(wee),Zi.resolveKeyframes(Tee))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const f=l==null?void 0:l.get(),y=t[t.length-1];if(f!==void 0)t[0]=f;else if(a&&s){const v=a.readValue(s,y);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=y),l&&f===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),vy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,vy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Cee=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),iPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function sPe(n){const t=iPe.exec(n);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function Ree(n,t,s=1){const[a,l]=sPe(n);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const f=d.trim();return Cee(f)?parseFloat(f):f}return NF(l)?Ree(l,t,s+1):l}const Iee=n=>t=>t.test(n),oPe={test:n=>n==="auto",parse:n=>n},Aee=[N0,Fn,Yh,ng,YIe,qIe,oPe],nq=n=>Aee.find(Iee(n));class Pee extends JF{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let b=t[v];if(typeof b=="string"&&(b=b.trim(),NF(b))){const w=Ree(b,s.current);w!==void 0&&(t[v]=w),v===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!see.has(a)||t.length!==2)return;const[l,d]=t,f=nq(l),y=nq(d);if(f!==y)if(ZK(f)&&ZK(y))for(let v=0;v<t.length;v++){const b=t[v];typeof b=="string"&&(t[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)MAe(t[l])&&a.push(l);a.length&&ZAe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=u0[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,y=l[f];l[f]=u0[a](s.measureViewportBox(),window.getComputedStyle(s.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,b])=>{s.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const rq=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(vg.test(n)||n==="0")&&!n.startsWith("url("));function aPe(n){const t=n[0];if(n.length===1)return!0;for(let s=0;s<n.length;s++)if(n[s]!==t)return!0}function cPe(n,t,s,a){const l=n[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=n[n.length-1],f=rq(l,t),y=rq(d,t);return!f||!y?!1:aPe(n)||(s==="spring"||jF(s))&&a}const lPe=n=>n!==null;function yN(n,{repeat:t,repeatType:s="loop"},a){const l=n.filter(lPe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const uPe=40;class Oee{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Xh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:f,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>uPe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&rPe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Xh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:y,onUpdate:v,isGenerator:b}=this.options;if(!b&&!cPe(t,a,l,d))if(f)this.options.duration=0;else{v&&v(yN(t,this.options,s)),y&&y(),this.resolveFinishedPromise();return}const w=this.initPlayback(t,s);w!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...w},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const ms=(n,t,s)=>n+(t-n)*s;function mM(n,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?n+(t-n)*6*s:s<1/2?t:s<2/3?n+(t-n)*(2/3-s)*6:n}function dPe({hue:n,saturation:t,lightness:s,alpha:a}){n/=360,t/=100,s/=100;let l=0,d=0,f=0;if(!t)l=d=f=s;else{const y=s<.5?s*(1+t):s+t-s*t,v=2*s-y;l=mM(v,y,n+1/3),d=mM(v,y,n),f=mM(v,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function bk(n,t){return s=>s>0?t:n}const gM=(n,t,s)=>{const a=n*n,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},hPe=[PU,py,DS],pPe=n=>hPe.find(t=>t.test(n));function iq(n){const t=pPe(n);if(!t)return!1;let s=t.parse(n);return t===DS&&(s=dPe(s)),s}const sq=(n,t)=>{const s=iq(n),a=iq(t);if(!s||!a)return bk(n,t);const l={...s};return d=>(l.red=gM(s.red,a.red,d),l.green=gM(s.green,a.green,d),l.blue=gM(s.blue,a.blue,d),l.alpha=ms(s.alpha,a.alpha,d),py.transform(l))},fPe=(n,t)=>s=>t(n(s)),GC=(...n)=>n.reduce(fPe),DU=new Set(["none","hidden"]);function mPe(n,t){return DU.has(n)?s=>s<=0?n:t:s=>s>=1?t:n}function gPe(n,t){return s=>ms(n,t,s)}function QF(n){return typeof n=="number"?gPe:typeof n=="string"?NF(n)?bk:Ka.test(n)?sq:EPe:Array.isArray(n)?kee:typeof n=="object"?Ka.test(n)?sq:_Pe:bk}function kee(n,t){const s=[...n],a=s.length,l=n.map((d,f)=>QF(d)(d,t[f]));return d=>{for(let f=0;f<a;f++)s[f]=l[f](d);return s}}function _Pe(n,t){const s={...n,...t},a={};for(const l in s)n[l]!==void 0&&t[l]!==void 0&&(a[l]=QF(n[l])(n[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function yPe(n,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],y=n.indexes[f][l[f]],v=(s=n.values[y])!==null&&s!==void 0?s:0;a[d]=v,l[f]++}return a}const EPe=(n,t)=>{const s=vg.createTransformer(t),a=EC(n),l=EC(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?DU.has(n)&&!l.values.length||DU.has(t)&&!a.values.length?mPe(n,t):GC(kee(yPe(a,l),l.values),s):bk(n,t)};function Nee(n,t,s){return typeof n=="number"&&typeof t=="number"&&typeof s=="number"?ms(n,t,s):QF(n)(n,t)}const vPe=5;function Dee(n,t,s){const a=Math.max(t-vPe,0);return oee(s-n(a),t-a)}const Ds={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},oq=.001;function SPe({duration:n=Ds.duration,bounce:t=Ds.bounce,velocity:s=Ds.velocity,mass:a=Ds.mass}){let l,d,f=1-t;f=Lf(Ds.minDamping,Ds.maxDamping,f),n=Lf(Ds.minDuration,Ds.maxDuration,If(n)),f<1?(l=b=>{const w=b*f,I=w*n,k=w-s,x=LU(b,f),F=Math.exp(-I);return oq-k/x*F},d=b=>{const I=b*f*n,k=I*s+s,x=Math.pow(f,2)*Math.pow(b,2)*n,F=Math.exp(-I),B=LU(Math.pow(b,2),f);return(-l(b)+oq>0?-1:1)*((k-x)*F)/B}):(l=b=>{const w=Math.exp(-b*n),I=(b-s)*n+1;return-.001+w*I},d=b=>{const w=Math.exp(-b*n),I=(s-b)*(n*n);return w*I});const y=5/n,v=TPe(l,d,y);if(n=Rf(n),isNaN(v))return{stiffness:Ds.stiffness,damping:Ds.damping,duration:n};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:f*2*Math.sqrt(a*b),duration:n}}}const bPe=12;function TPe(n,t,s){let a=s;for(let l=1;l<bPe;l++)a=a-n(a)/t(a);return a}function LU(n,t){return n*Math.sqrt(1-t*t)}const wPe=["duration","bounce"],CPe=["stiffness","damping","mass"];function aq(n,t){return t.some(s=>n[s]!==void 0)}function RPe(n){let t={velocity:Ds.velocity,stiffness:Ds.stiffness,damping:Ds.damping,mass:Ds.mass,isResolvedFromDuration:!1,...n};if(!aq(n,CPe)&&aq(n,wPe))if(n.visualDuration){const s=n.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*Lf(.05,1,1-(n.bounce||0))*Math.sqrt(l);t={...t,mass:Ds.mass,stiffness:l,damping:d}}else{const s=SPe(n);t={...t,...s,mass:Ds.mass},t.isResolvedFromDuration=!0}return t}function Lee(n=Ds.visualDuration,t=Ds.bounce){const s=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],f=s.keyframes[s.keyframes.length-1],y={done:!1,value:d},{stiffness:v,damping:b,mass:w,duration:I,velocity:k,isResolvedFromDuration:x}=RPe({...s,velocity:-If(s.velocity||0)}),F=k||0,B=b/(2*Math.sqrt(v*w)),z=f-d,J=If(Math.sqrt(v/w)),$=Math.abs(z)<5;a||(a=$?Ds.restSpeed.granular:Ds.restSpeed.default),l||(l=$?Ds.restDelta.granular:Ds.restDelta.default);let ie;if(B<1){const re=LU(J,B);ie=fe=>{const q=Math.exp(-B*J*fe);return f-q*((F+B*J*z)/re*Math.sin(re*fe)+z*Math.cos(re*fe))}}else if(B===1)ie=re=>f-Math.exp(-J*re)*(z+(F+J*z)*re);else{const re=J*Math.sqrt(B*B-1);ie=fe=>{const q=Math.exp(-B*J*fe),X=Math.min(re*fe,300);return f-q*((F+B*J*z)*Math.sinh(X)+re*z*Math.cosh(X))/re}}const ue={calculatedDuration:x&&I||null,next:re=>{const fe=ie(re);if(x)y.done=re>=I;else{let q=0;B<1&&(q=re===0?Rf(F):Dee(ie,re,fe));const X=Math.abs(q)<=a,Q=Math.abs(f-fe)<=l;y.done=X&&Q}return y.value=y.done?f:fe,y},toString:()=>{const re=Math.min(QZ(ue),RU),fe=ZZ(q=>ue.next(re*q).value,re,30);return re+"ms "+fe}};return ue}function cq({keyframes:n,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:y,max:v,restDelta:b=.5,restSpeed:w}){const I=n[0],k={done:!1,value:I},x=X=>y!==void 0&&X<y||v!==void 0&&X>v,F=X=>y===void 0?v:v===void 0||Math.abs(y-X)<Math.abs(v-X)?y:v;let B=s*t;const z=I+B,J=f===void 0?z:f(z);J!==z&&(B=J-I);const $=X=>-B*Math.exp(-X/a),ie=X=>J+$(X),ue=X=>{const Q=$(X),se=ie(X);k.done=Math.abs(Q)<=b,k.value=k.done?J:se};let re,fe;const q=X=>{x(k.value)&&(re=X,fe=Lee({keyframes:[k.value,F(k.value)],velocity:Dee(ie,X,k.value),damping:l,stiffness:d,restDelta:b,restSpeed:w}))};return q(0),{calculatedDuration:null,next:X=>{let Q=!1;return!fe&&re===void 0&&(Q=!0,ue(X),q(X)),re!==void 0&&X>=re?fe.next(X-re):(!Q&&ue(X),k)}}}const IPe=zC(.42,0,1,1),APe=zC(0,0,.58,1),xee=zC(.42,0,.58,1),PPe=n=>Array.isArray(n)&&typeof n[0]!="number",OPe={linear:Fl,easeIn:IPe,easeInOut:xee,easeOut:APe,circIn:KF,circInOut:mee,circOut:fee,backIn:$F,backInOut:hee,backOut:dee,anticipate:pee},lq=n=>{if(BF(n)){NZ(n.length===4);const[t,s,a,l]=n;return zC(t,s,a,l)}else if(typeof n=="string")return OPe[n];return n};function kPe(n,t,s){const a=[],l=s||Nee,d=n.length-1;for(let f=0;f<d;f++){let y=l(n[f],n[f+1]);if(t){const v=Array.isArray(t)?t[f]||Fl:t;y=GC(v,y)}a.push(y)}return a}function NPe(n,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=n.length;if(NZ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const f=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),t=[...t].reverse());const y=kPe(t,a,l),v=y.length,b=w=>{if(f&&w<n[0])return t[0];let I=0;if(v>1)for(;I<n.length-2&&!(w<n[I+1]);I++);const k=c0(n[I],n[I+1],w);return y[I](k)};return s?w=>b(Lf(n[0],n[d-1],w)):b}function DPe(n,t){const s=n[n.length-1];for(let a=1;a<=t;a++){const l=c0(0,t,a);n.push(ms(s,1,l))}}function LPe(n){const t=[0];return DPe(t,n.length-1),t}function xPe(n,t){return n.map(s=>s*t)}function MPe(n,t){return n.map(()=>t||xee).splice(0,n.length-1)}function Tk({duration:n=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=PPe(a)?a.map(lq):lq(a),d={done:!1,value:t[0]},f=xPe(s&&s.length===t.length?s:LPe(t),n),y=NPe(f,t,{ease:Array.isArray(l)?l:MPe(t,l)});return{calculatedDuration:n,next:v=>(d.value=y(v),d.done=v>=n,d)}}const UPe=n=>{const t=({timestamp:s})=>n(s);return{start:()=>Zi.update(t,!0),stop:()=>Eg(t),now:()=>ha.isProcessing?ha.timestamp:Xh.now()}},VPe={decay:cq,inertia:cq,tween:Tk,keyframes:Tk,spring:Lee},FPe=n=>n/100;class ZF extends Oee{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||JF,y=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new f(d,y,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,y=jF(s)?s:VPe[s]||Tk;let v,b;y!==Tk&&typeof t[0]!="number"&&(v=GC(FPe,Nee(t[0],t[1])),t=[0,100]);const w=y({...this.options,keyframes:t});d==="mirror"&&(b=y({...this.options,keyframes:[...t].reverse(),velocity:-f})),w.calculatedDuration===null&&(w.calculatedDuration=QZ(w));const{calculatedDuration:I}=w,k=I+l,x=k*(a+1)-l;return{generator:w,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:I,resolvedDuration:k,totalDuration:x}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:X}=this.options;return{done:!0,value:X[X.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:y,keyframes:v,calculatedDuration:b,totalDuration:w,resolvedDuration:I}=a;if(this.startTime===null)return d.next(0);const{delay:k,repeat:x,repeatType:F,repeatDelay:B,onUpdate:z}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-w/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const J=this.currentTime-k*(this.speed>=0?1:-1),$=this.speed>=0?J<0:J>w;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let ie=this.currentTime,ue=d;if(x){const X=Math.min(this.currentTime,w)/I;let Q=Math.floor(X),se=X%1;!se&&X>=1&&(se=1),se===1&&Q--,Q=Math.min(Q,x+1),!!(Q%2)&&(F==="reverse"?(se=1-se,B&&(se-=B/I)):F==="mirror"&&(ue=f)),ie=Lf(0,1,se)*I}const re=$?{done:!1,value:v[0]}:ue.next(ie);y&&(re.value=y(re.value));let{done:fe}=re;!$&&b!==null&&(fe=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const q=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&fe);return q&&l!==void 0&&(re.value=yN(v,this.options,l)),z&&z(re.value),q&&this.finish(),re}get duration(){const{resolved:t}=this;return t?If(t.calculatedDuration):0}get time(){return If(this.currentTime)}set time(t){t=Rf(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=If(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=UPe,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const jPe=new Set(["opacity","clipPath","filter","transform"]);function BPe(n,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:y="easeInOut",times:v}={}){const b={[t]:s};v&&(b.offset=v);const w=tee(y,l);return Array.isArray(w)&&(b.easing=w),n.animate(b,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const WPe=CF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),wk=10,zPe=2e4;function GPe(n){return jF(n.type)||n.type==="spring"||!eee(n.ease)}function HPe(n,t){const s=new ZF({...t,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<zPe;)a=s.sample(d),l.push(a.value),d+=wk;return{times:void 0,keyframes:l,duration:d-wk,ease:"linear"}}const Mee={anticipate:pee,backInOut:hee,circInOut:mee};function $Pe(n){return n in Mee}class uq extends Oee{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new Pee(d,(f,y)=>this.onKeyframesResolved(f,y),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:f,motionValue:y,name:v,startTime:b}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof d=="string"&&Sk()&&$Pe(d)&&(d=Mee[d]),GPe(this.options)){const{onComplete:I,onUpdate:k,motionValue:x,element:F,...B}=this.options,z=HPe(t,B);t=z.keyframes,t.length===1&&(t[1]=t[0]),a=z.duration,l=z.times,d=z.ease,f="keyframes"}const w=BPe(y.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return w.startTime=b??this.calcStartTime(),this.pendingTimeline?(KK(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:I}=this.options;y.set(yN(t,this.options,s)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:f,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return If(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return If(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=Rf(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Fl;const{animation:a}=s;KK(a,t)}return Fl}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:f,times:y}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:w,onComplete:I,element:k,...x}=this.options,F=new ZF({...x,keyframes:a,duration:l,type:d,ease:f,times:y,isGenerator:!0}),B=Rf(this.time);b.setWithVelocity(F.sample(B-wk).value,F.sample(B).value,wk)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:f,type:y}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=s.owner.getProps();return WPe()&&a&&jPe.has(a)&&!v&&!b&&!l&&d!=="mirror"&&f!==0&&y!=="inertia"}}const KPe={type:"spring",stiffness:500,damping:25,restSpeed:10},qPe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),YPe={type:"keyframes",duration:.8},XPe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},JPe=(n,{keyframes:t})=>t.length>2?YPe:By.has(n)?n.startsWith("scale")?qPe(t[1]):KPe:XPe;function QPe({when:n,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:y,from:v,elapsed:b,...w}){return!!Object.keys(w).length}const ej=(n,t,s,a={},l,d)=>f=>{const y=FF(a,n)||{},v=y.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Rf(v);let w={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...y,delay:-b,onUpdate:k=>{t.set(k),y.onUpdate&&y.onUpdate(k)},onComplete:()=>{f(),y.onComplete&&y.onComplete()},name:n,motionValue:t,element:d?void 0:l};QPe(y)||(w={...w,...JPe(n,w)}),w.duration&&(w.duration=Rf(w.duration)),w.repeatDelay&&(w.repeatDelay=Rf(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let I=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(I=!0)),I&&!d&&t.get()!==void 0){const k=yN(w.keyframes,y);if(k!==void 0)return Zi.update(()=>{w.onUpdate(k),w.onComplete()}),new _Ae([])}return!d&&uq.supports(w)?new uq(w):new ZF(w)};function ZPe({protectedKeys:n,needsAnimating:t},s){const a=n.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function Uee(n,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:f=n.getDefaultTransition(),transitionEnd:y,...v}=t;a&&(f=a);const b=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const I in v){const k=n.getValue(I,(d=n.latestValues[I])!==null&&d!==void 0?d:null),x=v[I];if(x===void 0||w&&ZPe(w,I))continue;const F={delay:s,...FF(f||{},I)};let B=!1;if(window.MotionHandoffAnimation){const J=aee(n);if(J){const $=window.MotionHandoffAnimation(J,I,Zi);$!==null&&(F.startTime=$,B=!0)}}AU(n,I),k.start(ej(I,k,x,n.shouldReduceMotion&&see.has(I)?{type:!1}:F,n,B));const z=k.animation;z&&b.push(z)}return y&&Promise.all(b).then(()=>{Zi.update(()=>{y&&kAe(n,y)})}),b}function xU(n,t,s={}){var a;const l=_N(n,t,s.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const f=l?()=>Promise.all(Uee(n,l,s)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:w=0,staggerChildren:I,staggerDirection:k}=d;return eOe(n,t,w+b,I,k,s)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,w]=v==="beforeChildren"?[f,y]:[y,f];return b().then(()=>w())}else return Promise.all([f(),y(s.delay)])}function eOe(n,t,s=0,a=0,l=1,d){const f=[],y=(n.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>y-b*a;return Array.from(n.variantChildren).sort(tOe).forEach((b,w)=>{b.notify("AnimationStart",t),f.push(xU(b,t,{...d,delay:s+v(w)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(f)}function tOe(n,t){return n.sortNodePosition(t)}function nOe(n,t,s={}){n.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>xU(n,d,s));a=Promise.all(l)}else if(typeof t=="string")a=xU(n,t,s);else{const l=typeof t=="function"?_N(n,t,s.custom):t;a=Promise.all(Uee(n,l,s))}return a.then(()=>{n.notify("AnimationComplete",t)})}const rOe=IF.length;function Vee(n){if(!n)return;if(!n.isControllingVariants){const s=n.parent?Vee(n.parent)||{}:{};return n.props.initial!==void 0&&(s.initial=n.props.initial),s}const t={};for(let s=0;s<rOe;s++){const a=IF[s],l=n.props[a];(gC(l)||l===!1)&&(t[a]=l)}return t}const iOe=[...RF].reverse(),sOe=RF.length;function oOe(n){return t=>Promise.all(t.map(({animation:s,options:a})=>nOe(n,s,a)))}function aOe(n){let t=oOe(n),s=dq(),a=!0;const l=v=>(b,w)=>{var I;const k=_N(n,w,v==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(k){const{transition:x,transitionEnd:F,...B}=k;b={...b,...B,...F}}return b};function d(v){t=v(n)}function f(v){const{props:b}=n,w=Vee(n.parent)||{},I=[],k=new Set;let x={},F=1/0;for(let z=0;z<sOe;z++){const J=iOe[z],$=s[J],ie=b[J]!==void 0?b[J]:w[J],ue=gC(ie),re=J===v?$.isActive:null;re===!1&&(F=z);let fe=ie===w[J]&&ie!==b[J]&&ue;if(fe&&a&&n.manuallyAnimateOnMount&&(fe=!1),$.protectedKeys={...x},!$.isActive&&re===null||!ie&&!$.prevProp||mN(ie)||typeof ie=="boolean")continue;const q=cOe($.prevProp,ie);let X=q||J===v&&$.isActive&&!fe&&ue||z>F&&ue,Q=!1;const se=Array.isArray(ie)?ie:[ie];let me=se.reduce(l(J),{});re===!1&&(me={});const{prevResolvedValues:pe={}}=$,le={...pe,...me},Le=ve=>{X=!0,k.has(ve)&&(Q=!0,k.delete(ve)),$.needsAnimating[ve]=!0;const _e=n.getValue(ve);_e&&(_e.liveStyle=!1)};for(const ve in le){const _e=me[ve],Ee=pe[ve];if(x.hasOwnProperty(ve))continue;let ke=!1;CU(_e)&&CU(Ee)?ke=!JZ(_e,Ee):ke=_e!==Ee,ke?_e!=null?Le(ve):k.add(ve):_e!==void 0&&k.has(ve)?Le(ve):$.protectedKeys[ve]=!0}$.prevProp=ie,$.prevResolvedValues=me,$.isActive&&(x={...x,...me}),a&&n.blockInitialAnimation&&(X=!1),X&&(!(fe&&q)||Q)&&I.push(...se.map(ve=>({animation:ve,options:{type:J}})))}if(k.size){const z={};k.forEach(J=>{const $=n.getBaseTarget(J),ie=n.getValue(J);ie&&(ie.liveStyle=!0),z[J]=$??null}),I.push({animation:z})}let B=!!I.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(B=!1),a=!1,B?t(I):Promise.resolve()}function y(v,b){var w;if(s[v].isActive===b)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(k=>{var x;return(x=k.animationState)===null||x===void 0?void 0:x.setActive(v,b)}),s[v].isActive=b;const I=f(v);for(const k in s)s[k].protectedKeys={};return I}return{animateChanges:f,setActive:y,setAnimateFunction:d,getState:()=>s,reset:()=>{s=dq(),a=!0}}}function cOe(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!JZ(t,n):!1}function iy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function dq(){return{animate:iy(!0),whileInView:iy(),whileHover:iy(),whileTap:iy(),whileDrag:iy(),whileFocus:iy(),exit:iy()}}class Og{constructor(t){this.isMounted=!1,this.node=t}update(){}}class lOe extends Og{constructor(t){super(t),t.animationState||(t.animationState=aOe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();mN(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let uOe=0;class dOe extends Og{constructor(){super(...arguments),this.id=uOe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const hOe={animation:{Feature:lOe},exit:{Feature:dOe}};function vC(n,t,s,a={passive:!0}){return n.addEventListener(t,s,a),()=>n.removeEventListener(t,s)}function HC(n){return{point:{x:n.pageX,y:n.pageY}}}const pOe=n=>t=>WF(t)&&n(t,HC(t));function Yw(n,t,s,a){return vC(n,t,pOe(s),a)}const hq=(n,t)=>Math.abs(n-t);function fOe(n,t){const s=hq(n.x,t.x),a=hq(n.y,t.y);return Math.sqrt(s**2+a**2)}class Fee{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=yM(this.lastMoveEventInfo,this.history),k=this.startEvent!==null,x=fOe(I.offset,{x:0,y:0})>=3;if(!k&&!x)return;const{point:F}=I,{timestamp:B}=ha;this.history.push({...F,timestamp:B});const{onStart:z,onMove:J}=this.handlers;k||(z&&z(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,I)},this.handlePointerMove=(I,k)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=_M(k,this.transformPagePoint),Zi.update(this.updatePoint,!0)},this.handlePointerUp=(I,k)=>{this.end();const{onEnd:x,onSessionEnd:F,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=yM(I.type==="pointercancel"?this.lastMoveEventInfo:_M(k,this.transformPagePoint),this.history);this.startEvent&&x&&x(I,z),F&&F(I,z)},!WF(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const f=HC(t),y=_M(f,this.transformPagePoint),{point:v}=y,{timestamp:b}=ha;this.history=[{...v,timestamp:b}];const{onSessionStart:w}=s;w&&w(t,yM(y,this.history)),this.removeListeners=GC(Yw(this.contextWindow,"pointermove",this.handlePointerMove),Yw(this.contextWindow,"pointerup",this.handlePointerUp),Yw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Eg(this.updatePoint)}}function _M(n,t){return t?{point:t(n.point)}:n}function pq(n,t){return{x:n.x-t.x,y:n.y-t.y}}function yM({point:n},t){return{point:n,delta:pq(n,jee(t)),offset:pq(n,mOe(t)),velocity:gOe(t,.1)}}function mOe(n){return n[0]}function jee(n){return n[n.length-1]}function gOe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=jee(n);for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>Rf(t)));)s--;if(!a)return{x:0,y:0};const d=If(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const Bee=1e-4,_Oe=1-Bee,yOe=1+Bee,Wee=.01,EOe=0-Wee,vOe=0+Wee;function jl(n){return n.max-n.min}function SOe(n,t,s){return Math.abs(n-t)<=s}function fq(n,t,s,a=.5){n.origin=a,n.originPoint=ms(t.min,t.max,n.origin),n.scale=jl(s)/jl(t),n.translate=ms(s.min,s.max,n.origin)-n.originPoint,(n.scale>=_Oe&&n.scale<=yOe||isNaN(n.scale))&&(n.scale=1),(n.translate>=EOe&&n.translate<=vOe||isNaN(n.translate))&&(n.translate=0)}function Xw(n,t,s,a){fq(n.x,t.x,s.x,a?a.originX:void 0),fq(n.y,t.y,s.y,a?a.originY:void 0)}function mq(n,t,s){n.min=s.min+t.min,n.max=n.min+jl(t)}function bOe(n,t,s){mq(n.x,t.x,s.x),mq(n.y,t.y,s.y)}function gq(n,t,s){n.min=t.min-s.min,n.max=n.min+jl(t)}function Jw(n,t,s){gq(n.x,t.x,s.x),gq(n.y,t.y,s.y)}function TOe(n,{min:t,max:s},a){return t!==void 0&&n<t?n=a?ms(t,n,a.min):Math.max(n,t):s!==void 0&&n>s&&(n=a?ms(s,n,a.max):Math.min(n,s)),n}function _q(n,t,s){return{min:t!==void 0?n.min+t:void 0,max:s!==void 0?n.max+s-(n.max-n.min):void 0}}function wOe(n,{top:t,left:s,bottom:a,right:l}){return{x:_q(n.x,s,l),y:_q(n.y,t,a)}}function yq(n,t){let s=t.min-n.min,a=t.max-n.max;return t.max-t.min<n.max-n.min&&([s,a]=[a,s]),{min:s,max:a}}function COe(n,t){return{x:yq(n.x,t.x),y:yq(n.y,t.y)}}function ROe(n,t){let s=.5;const a=jl(n),l=jl(t);return l>a?s=c0(t.min,t.max-a,n.min):a>l&&(s=c0(n.min,n.max-l,t.min)),Lf(0,1,s)}function IOe(n,t){const s={};return t.min!==void 0&&(s.min=t.min-n.min),t.max!==void 0&&(s.max=t.max-n.min),s}const MU=.35;function AOe(n=MU){return n===!1?n=0:n===!0&&(n=MU),{x:Eq(n,"left","right"),y:Eq(n,"top","bottom")}}function Eq(n,t,s){return{min:vq(n,t),max:vq(n,s)}}function vq(n,t){return typeof n=="number"?n:n[t]||0}const Sq=()=>({translate:0,scale:1,origin:0,originPoint:0}),LS=()=>({x:Sq(),y:Sq()}),bq=()=>({min:0,max:0}),zs=()=>({x:bq(),y:bq()});function Iu(n){return[n("x"),n("y")]}function zee({top:n,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:n,max:a}}}function POe({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function OOe(n,t){if(!t)return n;const s=t({x:n.left,y:n.top}),a=t({x:n.right,y:n.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function EM(n){return n===void 0||n===1}function UU({scale:n,scaleX:t,scaleY:s}){return!EM(n)||!EM(t)||!EM(s)}function oy(n){return UU(n)||Gee(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Gee(n){return Tq(n.x)||Tq(n.y)}function Tq(n){return n&&n!=="0%"}function Ck(n,t,s){const a=n-s,l=t*a;return s+l}function wq(n,t,s,a,l){return l!==void 0&&(n=Ck(n,l,a)),Ck(n,s,a)+t}function VU(n,t=0,s=1,a,l){n.min=wq(n.min,t,s,a,l),n.max=wq(n.max,t,s,a,l)}function Hee(n,{x:t,y:s}){VU(n.x,t.translate,t.scale,t.originPoint),VU(n.y,s.translate,s.scale,s.originPoint)}const Cq=.999999999999,Rq=1.0000000000001;function kOe(n,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,f;for(let y=0;y<l;y++){d=s[y],f=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&MS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,Hee(n,f)),a&&oy(d.latestValues)&&MS(n,d.latestValues))}t.x<Rq&&t.x>Cq&&(t.x=1),t.y<Rq&&t.y>Cq&&(t.y=1)}function xS(n,t){n.min=n.min+t,n.max=n.max+t}function Iq(n,t,s,a,l=.5){const d=ms(n.min,n.max,l);VU(n,t,s,d,a)}function MS(n,t){Iq(n.x,t.x,t.scaleX,t.scale,t.originX),Iq(n.y,t.y,t.scaleY,t.scale,t.originY)}function $ee(n,t){return zee(OOe(n.getBoundingClientRect(),t))}function NOe(n,t,s){const a=$ee(n,s),{scroll:l}=t;return l&&(xS(a.x,l.offset.x),xS(a.y,l.offset.y)),a}const Kee=({current:n})=>n?n.ownerDocument.defaultView:null,DOe=new WeakMap;class LOe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=zs(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(HC(w).point)},d=(w,I)=>{const{drag:k,dragPropagation:x,onDragStart:F}=this.getProps();if(k&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=RAe(k),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Iu(z=>{let J=this.getAxisMotionValue(z).get()||0;if(Yh.test(J)){const{projection:$}=this.visualElement;if($&&$.layout){const ie=$.layout.layoutBox[z];ie&&(J=jl(ie)*(parseFloat(J)/100))}}this.originPoint[z]=J}),F&&Zi.postRender(()=>F(w,I)),AU(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},f=(w,I)=>{const{dragPropagation:k,dragDirectionLock:x,onDirectionLock:F,onDrag:B}=this.getProps();if(!k&&!this.openDragLock)return;const{offset:z}=I;if(x&&this.currentDirection===null){this.currentDirection=xOe(z),this.currentDirection!==null&&F&&F(this.currentDirection);return}this.updateAxis("x",I.point,z),this.updateAxis("y",I.point,z),this.visualElement.render(),B&&B(w,I)},y=(w,I)=>this.stop(w,I),v=()=>Iu(w=>{var I;return this.getAnimationState(w)==="paused"&&((I=this.getAxisMotionValue(w).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Fee(t,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:y,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Kee(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Zi.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!uO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let f=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(f=TOe(f,this.constraints[t],this.elastic[t])),d.set(f)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&NS(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=wOe(l.layoutBox,s):this.constraints=!1,this.elastic=AOe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Iu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=IOe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!NS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=NOe(a,l.root,this.visualElement.getTransformPagePoint());let f=COe(l.layout.layoutBox,d);if(s){const y=s(POe(f));this.hasMutatedConstraints=!!y,y&&(f=zee(y))}return f}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:y}=this.getProps(),v=this.constraints||{},b=Iu(w=>{if(!uO(w,s,this.currentDirection))return;let I=v&&v[w]||{};f&&(I={min:0,max:0});const k=l?200:1e6,x=l?40:1e7,F={type:"inertia",velocity:a?t[w]:0,bounceStiffness:k,bounceDamping:x,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(w,F)});return Promise.all(b).then(y)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return AU(this.visualElement,t),a.start(ej(t,a,0,s,this.visualElement,!1))}stopAnimation(){Iu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Iu(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){Iu(s=>{const{drag:a}=this.getProps();if(!uO(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:f,max:y}=l.layout.layoutBox[s];d.set(t[s]-ms(f,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!NS(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Iu(f=>{const y=this.getAxisMotionValue(f);if(y&&this.constraints!==!1){const v=y.get();l[f]=ROe({min:v,max:v},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Iu(f=>{if(!uO(f,t,null))return;const y=this.getAxisMotionValue(f),{min:v,max:b}=this.constraints[f];y.set(ms(v,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;DOe.set(this.visualElement,this);const t=this.visualElement.current,s=Yw(t,"pointerdown",v=>{const{drag:b,dragListener:w=!0}=this.getProps();b&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();NS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Zi.read(a);const f=vC(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(Iu(w=>{const I=this.getAxisMotionValue(w);I&&(this.originPoint[w]+=v[w].translate,I.set(I.get()+v[w].translate))}),this.visualElement.render())});return()=>{f(),s(),d(),y&&y()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=MU,dragMomentum:y=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:y}}}function uO(n,t,s){return(t===!0||t===n)&&(s===null||s===n)}function xOe(n,t=10){let s=null;return Math.abs(n.y)>t?s="y":Math.abs(n.x)>t&&(s="x"),s}class MOe extends Og{constructor(t){super(t),this.removeGroupControls=Fl,this.removeListeners=Fl,this.controls=new LOe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Fl}unmount(){this.removeGroupControls(),this.removeListeners()}}const Aq=n=>(t,s)=>{n&&Zi.postRender(()=>n(t,s))};class UOe extends Og{constructor(){super(...arguments),this.removePointerDownListener=Fl}onPointerDown(t){this.session=new Fee(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Kee(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:Aq(t),onStart:Aq(s),onMove:a,onEnd:(d,f)=>{delete this.session,l&&Zi.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=Yw(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const GO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Pq(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const lw={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(Fn.test(n))n=parseFloat(n);else return n;const s=Pq(n,t.target.x),a=Pq(n,t.target.y);return`${s}% ${a}%`}},VOe={correct:(n,{treeScale:t,projectionDelta:s})=>{const a=n,l=vg.parse(n);if(l.length>5)return a;const d=vg.createTransformer(n),f=typeof l[0]!="number"?1:0,y=s.x.scale*t.x,v=s.y.scale*t.y;l[0+f]/=y,l[1+f]/=v;const b=ms(y,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),d(l)}};class FOe extends D.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;sAe(jOe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),GO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||t.layoutDependency!==s||s===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?f.promote():f.relegate()||Zi.postRender(()=>{const y=f.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),PF.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function qee(n){const[t,s]=TF(),a=D.useContext(vF);return R.jsx(FOe,{...n,layoutGroup:a,switchLayoutGroup:D.useContext(VZ),isPresent:t,safeToRemove:s})}const jOe={borderRadius:{...lw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:lw,borderTopRightRadius:lw,borderBottomLeftRadius:lw,borderBottomRightRadius:lw,boxShadow:VOe};function BOe(n,t,s){const a=Xa(n)?n:yC(n);return a.start(ej("",a,t,s)),a.animation}function WOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const zOe=(n,t)=>n.depth-t.depth;class GOe{constructor(){this.children=[],this.isDirty=!1}add(t){zF(this.children,t),this.isDirty=!0}remove(t){GF(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(zOe),this.isDirty=!1,this.children.forEach(t)}}function HOe(n,t){const s=Xh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(Eg(a),n(d-t))};return Zi.read(a,!0),()=>Eg(a)}const Yee=["TopLeft","TopRight","BottomLeft","BottomRight"],$Oe=Yee.length,Oq=n=>typeof n=="string"?parseFloat(n):n,kq=n=>typeof n=="number"||Fn.test(n);function KOe(n,t,s,a,l,d){l?(n.opacity=ms(0,s.opacity!==void 0?s.opacity:1,qOe(a)),n.opacityExit=ms(t.opacity!==void 0?t.opacity:1,0,YOe(a))):d&&(n.opacity=ms(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let f=0;f<$Oe;f++){const y=`border${Yee[f]}Radius`;let v=Nq(t,y),b=Nq(s,y);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||kq(v)===kq(b)?(n[y]=Math.max(ms(Oq(v),Oq(b),a),0),(Yh.test(b)||Yh.test(v))&&(n[y]+="%")):n[y]=b}(t.rotate||s.rotate)&&(n.rotate=ms(t.rotate||0,s.rotate||0,a))}function Nq(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const qOe=Xee(0,.5,fee),YOe=Xee(.5,.95,Fl);function Xee(n,t,s){return a=>a<n?0:a>t?1:s(c0(n,t,a))}function Dq(n,t){n.min=t.min,n.max=t.max}function wu(n,t){Dq(n.x,t.x),Dq(n.y,t.y)}function Lq(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function xq(n,t,s,a,l){return n-=t,n=Ck(n,1/s,a),l!==void 0&&(n=Ck(n,1/l,a)),n}function XOe(n,t=0,s=1,a=.5,l,d=n,f=n){if(Yh.test(t)&&(t=parseFloat(t),t=ms(f.min,f.max,t/100)-f.min),typeof t!="number")return;let y=ms(d.min,d.max,a);n===d&&(y-=t),n.min=xq(n.min,t,s,y,l),n.max=xq(n.max,t,s,y,l)}function Mq(n,t,[s,a,l],d,f){XOe(n,t[s],t[a],t[l],t.scale,d,f)}const JOe=["x","scaleX","originX"],QOe=["y","scaleY","originY"];function Uq(n,t,s,a){Mq(n.x,t,JOe,s?s.x:void 0,a?a.x:void 0),Mq(n.y,t,QOe,s?s.y:void 0,a?a.y:void 0)}function Vq(n){return n.translate===0&&n.scale===1}function Jee(n){return Vq(n.x)&&Vq(n.y)}function Fq(n,t){return n.min===t.min&&n.max===t.max}function ZOe(n,t){return Fq(n.x,t.x)&&Fq(n.y,t.y)}function jq(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function Qee(n,t){return jq(n.x,t.x)&&jq(n.y,t.y)}function Bq(n){return jl(n.x)/jl(n.y)}function Wq(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class eke{constructor(){this.members=[]}add(t){zF(this.members,t),t.scheduleRender()}remove(t){if(GF(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function tke(n,t,s){let a="";const l=n.x.translate/t.x,d=n.y.translate/t.y,f=(s==null?void 0:s.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:b,rotate:w,rotateX:I,rotateY:k,skewX:x,skewY:F}=s;b&&(a=`perspective(${b}px) ${a}`),w&&(a+=`rotate(${w}deg) `),I&&(a+=`rotateX(${I}deg) `),k&&(a+=`rotateY(${k}deg) `),x&&(a+=`skewX(${x}deg) `),F&&(a+=`skewY(${F}deg) `)}const y=n.x.scale*t.x,v=n.y.scale*t.y;return(y!==1||v!==1)&&(a+=`scale(${y}, ${v})`),a||"none"}const ay={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Nw=typeof window<"u"&&window.MotionDebug!==void 0,vM=["","X","Y","Z"],nke={visibility:"hidden"},zq=1e3;let rke=0;function SM(n,t,s,a){const{latestValues:l}=t;l[n]&&(s[n]=l[n],t.setStaticValue(n,0),a&&(a[n]=0))}function Zee(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const s=aee(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(s,"transform",Zi,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&Zee(a)}function ete({attachResizeListener:n,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},y=t==null?void 0:t()){this.id=rke++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Nw&&(ay.totalNodes=ay.resolvedTargetDeltas=ay.recalculatedProjection=0),this.nodes.forEach(oke),this.nodes.forEach(dke),this.nodes.forEach(hke),this.nodes.forEach(ake),Nw&&window.MotionDebug.record(ay)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new GOe)}addEventListener(f,y){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new HF),this.eventHandlers.get(f).add(y)}notifyListeners(f,...y){const v=this.eventHandlers.get(f);v&&v.notify(...y)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=WOe(f),this.instance=f;const{layoutId:v,layout:b,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(b||v)&&(this.isLayoutDirty=!0),n){let I;const k=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=HOe(k,250),GO.hasAnimatedSinceResize&&(GO.hasAnimatedSinceResize=!1,this.nodes.forEach(Hq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:k,hasRelativeTargetChanged:x,layout:F})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||w.getDefaultTransition()||_ke,{onLayoutAnimationStart:z,onLayoutAnimationComplete:J}=w.getProps(),$=!this.targetLayout||!Qee(this.targetLayout,F)||x,ie=!k&&x;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ie||k&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,ie);const ue={...FF(B,"layout"),onPlay:z,onComplete:J};(w.shouldReduceMotion||this.options.layoutRoot)&&(ue.delay=0,ue.type=!1),this.startAnimation(ue)}else k||Hq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=F})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Eg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(pke),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Zee(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const I=this.path[w];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:y,layout:v}=this.options;if(y===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Gq);return}this.isUpdating||this.nodes.forEach(lke),this.isUpdating=!1,this.nodes.forEach(uke),this.nodes.forEach(ike),this.nodes.forEach(ske),this.clearAllSnapshots();const y=Xh.now();ha.delta=Lf(0,1e3/60,y-ha.timestamp),ha.timestamp=y,ha.isProcessing=!0,hM.update.process(ha),hM.preRender.process(ha),hM.render.process(ha),ha.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,PF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(cke),this.sharedNodes.forEach(fke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Zi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Zi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=zs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(y=!1),y){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!Jee(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,w=b!==this.prevTransformTemplateValue;f&&(y||oy(this.latestValues)||w)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const y=this.measurePageBox();let v=this.removeElementScroll(y);return f&&(v=this.removeTransform(v)),yke(v),{animationId:this.root.animationId,measuredBox:y,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:y}=this.options;if(!y)return zs();const v=y.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(Eke))){const{scroll:w}=this.root;w&&(xS(v.x,w.offset.x),xS(v.y,w.offset.y))}return v}removeElementScroll(f){var y;const v=zs();if(wu(v,f),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return v;for(let b=0;b<this.path.length;b++){const w=this.path[b],{scroll:I,options:k}=w;w!==this.root&&I&&k.layoutScroll&&(I.wasRoot&&wu(v,f),xS(v.x,I.offset.x),xS(v.y,I.offset.y))}return v}applyTransform(f,y=!1){const v=zs();wu(v,f);for(let b=0;b<this.path.length;b++){const w=this.path[b];!y&&w.options.layoutScroll&&w.scroll&&w!==w.root&&MS(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),oy(w.latestValues)&&MS(v,w.latestValues)}return oy(this.latestValues)&&MS(v,this.latestValues),v}removeTransform(f){const y=zs();wu(y,f);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!oy(b.latestValues))continue;UU(b.latestValues)&&b.updateSnapshot();const w=zs(),I=b.measurePageBox();wu(w,I),Uq(y,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,w)}return oy(this.latestValues)&&Uq(y,this.latestValues),y}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ha.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var y;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:k}=this.options;if(!(!this.layout||!(I||k))){if(this.resolvedRelativeTargetAt=ha.timestamp,!this.targetDelta&&!this.relativeTarget){const x=this.getClosestProjectingParent();x&&x.layout&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zs(),this.relativeTargetOrigin=zs(),Jw(this.relativeTargetOrigin,this.layout.layoutBox,x.layout.layoutBox),wu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=zs(),this.targetWithTransforms=zs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),bOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):wu(this.target,this.layout.layoutBox),Hee(this.target,this.targetDelta)):wu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const x=this.getClosestProjectingParent();x&&!!x.resumingFrom==!!this.resumingFrom&&!x.options.layoutScroll&&x.target&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zs(),this.relativeTargetOrigin=zs(),Jw(this.relativeTargetOrigin,this.target,x.target),wu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Nw&&ay.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||UU(this.parent.latestValues)||Gee(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const y=this.getLead(),v=!!this.resumingFrom||this!==y;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===ha.timestamp&&(b=!1),b)return;const{layout:w,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||I))return;wu(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,x=this.treeScale.y;kOe(this.layoutCorrected,this.treeScale,this.path,v),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=zs());const{target:F}=y;if(!F){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Lq(this.prevProjectionDelta.x,this.projectionDelta.x),Lq(this.prevProjectionDelta.y,this.projectionDelta.y)),Xw(this.projectionDelta,this.layoutCorrected,F,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==x||!Wq(this.projectionDelta.x,this.prevProjectionDelta.x)||!Wq(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",F)),Nw&&ay.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=LS(),this.projectionDelta=LS(),this.projectionDeltaWithTransform=LS()}setAnimationOrigin(f,y=!1){const v=this.snapshot,b=v?v.latestValues:{},w={...this.latestValues},I=LS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const k=zs(),x=v?v.source:void 0,F=this.layout?this.layout.source:void 0,B=x!==F,z=this.getStack(),J=!z||z.members.length<=1,$=!!(B&&!J&&this.options.crossfade===!0&&!this.path.some(gke));this.animationProgress=0;let ie;this.mixTargetDelta=ue=>{const re=ue/1e3;$q(I.x,f.x,re),$q(I.y,f.y,re),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Jw(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mke(this.relativeTarget,this.relativeTargetOrigin,k,re),ie&&ZOe(this.relativeTarget,ie)&&(this.isProjectionDirty=!1),ie||(ie=zs()),wu(ie,this.relativeTarget)),B&&(this.animationValues=w,KOe(w,b,this.latestValues,re,$,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=re},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Eg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Zi.update(()=>{GO.hasAnimatedSinceResize=!0,this.currentAnimation=BOe(0,zq,{...f,onUpdate:y=>{this.mixTargetDelta(y),f.onUpdate&&f.onUpdate(y)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(zq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:y,target:v,layout:b,latestValues:w}=f;if(!(!y||!v||!b)){if(this!==f&&this.layout&&b&&tte(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||zs();const I=jl(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+I;const k=jl(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+k}wu(y,v),MS(y,w),Xw(this.projectionDeltaWithTransform,this.layoutCorrected,y,w)}}registerSharedNode(f,y){this.sharedNodes.has(f)||this.sharedNodes.set(f,new eke),this.sharedNodes.get(f).add(y);const b=y.options.initialPromotionConfig;y.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(y):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:y}=this.options;return y?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:y}=this.options;return y?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:y,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let y=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(y=!0),!y)return;const b={};v.z&&SM("z",f,b,this.animationValues);for(let w=0;w<vM.length;w++)SM(`rotate${vM[w]}`,f,b,this.animationValues),SM(`skew${vM[w]}`,f,b,this.animationValues);f.render();for(const w in b)f.setStaticValue(w,b[w]),this.animationValues&&(this.animationValues[w]=b[w]);f.scheduleRender()}getProjectionStyles(f){var y,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return nke;const b={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=WO(f==null?void 0:f.pointerEvents)||"",b.transform=w?w(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=WO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!oy(this.latestValues)&&(B.transform=w?w({},""):"none",this.hasProjected=!1),B}const k=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=tke(this.projectionDeltaWithTransform,this.treeScale,k),w&&(b.transform=w(k,b.transform));const{x,y:F}=this.projectionDelta;b.transformOrigin=`${x.origin*100}% ${F.origin*100}% 0`,I.animationValues?b.opacity=I===this?(v=(y=k.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:k.opacityExit:b.opacity=I===this?k.opacity!==void 0?k.opacity:"":k.opacityExit!==void 0?k.opacityExit:0;for(const B in vk){if(k[B]===void 0)continue;const{correct:z,applyTo:J}=vk[B],$=b.transform==="none"?k[B]:z(k[B],I);if(J){const ie=J.length;for(let ue=0;ue<ie;ue++)b[J[ue]]=$}else b[B]=$}return this.options.layoutId&&(b.pointerEvents=I===this?WO(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var y;return(y=f.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach(Gq),this.root.sharedNodes.clear()}}}function ike(n){n.updateLayout()}function ske(n){var t;const s=((t=n.resumeFrom)===null||t===void 0?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&s&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,f=s.source!==n.layout.source;d==="size"?Iu(I=>{const k=f?s.measuredBox[I]:s.layoutBox[I],x=jl(k);k.min=a[I].min,k.max=k.min+x}):tte(d,s.layoutBox,a)&&Iu(I=>{const k=f?s.measuredBox[I]:s.layoutBox[I],x=jl(a[I]);k.max=k.min+x,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+x)});const y=LS();Xw(y,a,s.layoutBox);const v=LS();f?Xw(v,n.applyTransform(l,!0),s.measuredBox):Xw(v,a,s.layoutBox);const b=!Jee(y);let w=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:k,layout:x}=I;if(k&&x){const F=zs();Jw(F,s.layoutBox,k.layoutBox);const B=zs();Jw(B,a,x.layoutBox),Qee(F,B)||(w=!0),I.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=F,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:v,layoutDelta:y,hasLayoutChanged:b,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function oke(n){Nw&&ay.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function ake(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function cke(n){n.clearSnapshot()}function Gq(n){n.clearMeasurements()}function lke(n){n.isLayoutDirty=!1}function uke(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function Hq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function dke(n){n.resolveTargetDelta()}function hke(n){n.calcProjection()}function pke(n){n.resetSkewAndRotation()}function fke(n){n.removeLeadSnapshot()}function $q(n,t,s){n.translate=ms(t.translate,0,s),n.scale=ms(t.scale,1,s),n.origin=t.origin,n.originPoint=t.originPoint}function Kq(n,t,s,a){n.min=ms(t.min,s.min,a),n.max=ms(t.max,s.max,a)}function mke(n,t,s,a){Kq(n.x,t.x,s.x,a),Kq(n.y,t.y,s.y,a)}function gke(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const _ke={duration:.45,ease:[.4,0,.1,1]},qq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),Yq=qq("applewebkit/")&&!qq("chrome/")?Math.round:Fl;function Xq(n){n.min=Yq(n.min),n.max=Yq(n.max)}function yke(n){Xq(n.x),Xq(n.y)}function tte(n,t,s){return n==="position"||n==="preserve-aspect"&&!SOe(Bq(t),Bq(s),.2)}function Eke(n){var t;return n!==n.root&&((t=n.scroll)===null||t===void 0?void 0:t.wasRoot)}const vke=ete({attachResizeListener:(n,t)=>vC(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),bM={current:void 0},nte=ete({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!bM.current){const n=new vke({});n.mount(window),n.setOptions({layoutScroll:!0}),bM.current=n}return bM.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Ske={pan:{Feature:UOe},drag:{Feature:MOe,ProjectionNode:nte,MeasureLayout:qee}};function Jq(n,t,s){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&Zi.postRender(()=>d(t,HC(t)))}class bke extends Og{mount(){const{current:t}=this.node;t&&(this.unmount=SAe(t,s=>(Jq(this.node,s,"Start"),a=>Jq(this.node,a,"End"))))}unmount(){}}class Tke extends Og{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=GC(vC(this.node.current,"focus",()=>this.onFocus()),vC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Qq(n,t,s){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&Zi.postRender(()=>d(t,HC(t)))}class wke extends Og{mount(){const{current:t}=this.node;t&&(this.unmount=CAe(t,s=>(Qq(this.node,s,"Start"),(a,{success:l})=>Qq(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const FU=new WeakMap,TM=new WeakMap,Cke=n=>{const t=FU.get(n.target);t&&t(n)},Rke=n=>{n.forEach(Cke)};function Ike({root:n,...t}){const s=n||document;TM.has(s)||TM.set(s,{});const a=TM.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(Rke,{root:n,...t})),a[l]}function Ake(n,t,s){const a=Ike(t);return FU.set(n,s),a.observe(n),()=>{FU.delete(n),a.unobserve(n)}}const Pke={some:0,all:1};class Oke extends Og{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,f={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:Pke[l]},y=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:w,onViewportLeave:I}=this.node.getProps(),k=b?w:I;k&&k(v)};return Ake(this.node.current,f,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(kke(t,s))&&this.startObserver()}unmount(){}}function kke({viewport:n={}},{viewport:t={}}={}){return s=>n[s]!==t[s]}const Nke={inView:{Feature:Oke},tap:{Feature:wke},focus:{Feature:Tke},hover:{Feature:bke}},Dke={layout:{ProjectionNode:nte,MeasureLayout:qee}},jU={current:null},rte={current:!1};function Lke(){if(rte.current=!0,!!wF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>jU.current=n.matches;n.addListener(t),t()}else jU.current=!1}const xke=[...Aee,Ka,vg],Mke=n=>xke.find(Iee(n)),Zq=new WeakMap;function Uke(n,t,s){for(const a in t){const l=t[a],d=s[a];if(Xa(l))n.addValue(a,l);else if(Xa(d))n.addValue(a,yC(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,yC(f!==void 0?f:l,{owner:n}))}}for(const a in s)t[a]===void 0&&n.removeValue(a);return t}const eY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Vke{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=JF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const x=Xh.now();this.renderScheduledAt<x&&(this.renderScheduledAt=x,Zi.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:w}=f;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=s.initial?{...v}:{},this.renderState=b,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!d,this.isControllingVariants=gN(s),this.isVariantNode=MZ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:I,...k}=this.scrapeMotionValuesFromProps(s,{},this);for(const x in k){const F=k[x];v[x]!==void 0&&Xa(F)&&F.set(v[x],!1)}}mount(t){this.current=t,Zq.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),rte.current||Lke(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:jU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Zq.delete(this.current),this.projection&&this.projection.unmount(),Eg(this.notifyUpdate),Eg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=By.has(t),l=s.on("change",y=>{this.latestValues[t]=y,this.props.onUpdate&&Zi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),f&&f(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in l0){const s=l0[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):zs()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<eY.length;a++){const l=eY[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=t[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=Uke(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=yC(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(Cee(l)||gee(l))?l=parseFloat(l):!Mke(l)&&vg.test(s)&&(l=bee(t,s)),this.setBaseTarget(t,Xa(l)?l.get():l)),Xa(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=kF(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);f&&(l=f[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Xa(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new HF),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class ite extends Vke{constructor(){super(...arguments),this.KeyframeResolver=Pee}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Xa(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function Fke(n){return window.getComputedStyle(n)}class jke extends ite{constructor(){super(...arguments),this.type="html",this.renderInstance=HZ}readValueFromInstance(t,s){if(By.has(s)){const a=XF(s);return a&&a.default||0}else{const a=Fke(t),l=(WZ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return $ee(t,s)}build(t,s,a){LF(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return VF(t,s,a)}}class Bke extends ite{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=zs}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(By.has(s)){const a=XF(s);return a&&a.default||0}return s=$Z.has(s)?s:AF(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return YZ(t,s,a)}build(t,s,a){xF(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){KZ(t,s,a,l)}mount(t){this.isSVGTag=UF(t.tagName),super.mount(t)}}const Wke=(n,t)=>OF(n)?new Bke(t):new jke(t,{allowProjection:n!==D.Fragment}),zke=fAe({...hOe,...Nke,...Ske,...Dke},Wke),Wf=PIe(zke),Gke=(n,t)=>n.find(s=>s.id===t);function tY(n,t){const s=ste(n,t),a=s?n[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function ste(n,t){for(const[s,a]of Object.entries(n))if(Gke(a,t))return s}function Hke(n){const t=n.includes("right"),s=n.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function $ke(n){const s=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:f}}var Kke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,qke=SZ(function(n){return Kke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),Yke=qke,Xke=function(t){return t!=="theme"},nY=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?Yke:Xke},rY=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(f){return t.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},Jke=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return hF(s,a,l),RZ(function(){return pF(s,a,l)}),null},Qke=function n(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,f;s!==void 0&&(d=s.label,f=s.target);var y=rY(t,s,a),v=y||nY(l),b=!v("as");return function(){var w=arguments,I=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)I.push.apply(I,w);else{var k=w[0];I.push(k[0]);for(var x=w.length,F=1;F<x;F++)I.push(w[F],k[F])}var B=mF(function(z,J,$){var ie=b&&z.as||l,ue="",re=[],fe=z;if(z.theme==null){fe={};for(var q in z)fe[q]=z[q];fe.theme=D.useContext(a0)}typeof z.className=="string"?ue=TZ(J.registered,re,z.className):z.className!=null&&(ue=z.className+" ");var X=dN(I.concat(re),J.registered,fe);ue+=J.key+"-"+X.name,f!==void 0&&(ue+=" "+f);var Q=b&&y===void 0?nY(ie):v,se={};for(var me in z)b&&me==="as"||Q(me)&&(se[me]=z[me]);return se.className=ue,$&&(se.ref=$),D.createElement(D.Fragment,null,D.createElement(Jke,{cache:J,serialized:X,isStringTag:typeof ie=="string"}),D.createElement(ie,se))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=t.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=I,B.__emotion_forwardProp=y,Object.defineProperty(B,"toString",{value:function(){return"."+f}}),B.withComponent=function(z,J){var $=n(z,Ay({},s,J,{shouldForwardProp:rY(B,J,!0)}));return $.apply(void 0,I)},B}},Zke=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],BU=Qke.bind(null);Zke.forEach(function(n){BU[n]=BU(n)});const eNe=new Set([...Eve,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),tNe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function nNe(n){return(tNe.has(n)||!eNe.has(n))&&n[0]!=="_"}const rNe=Kye(BU),iNe=({baseStyle:n})=>t=>{const{theme:s,css:a,__css:l,sx:d,...f}=t,[y]=eEe(f,Sve),v=sl(n,t),b=Dye({},l,v,rN(y),d),w=eZ(b)(t.theme);return a?[w,a]:w};function wM(n,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=nNe);const l=iNe({baseStyle:s}),d=rNe(n,a)(l);return D.forwardRef(function(v,b){const{children:w,...I}=v,{colorMode:k,forced:x}=pN(),F=x?k:void 0;return D.createElement(d,{ref:b,"data-theme":F,...I},w)})}function sNe(){const n=new Map;return new Proxy(wM,{apply(t,s,a){return wM(...a)},get(t,s){return n.has(s)||n.set(s,wM(s)),n.get(s)}})}const Dt=sNe(),oNe={initial:n=>{const{position:t}=n,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},ote=D.memo(n=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:y=5e3,containerStyle:v,motionVariants:b=oNe,toastSpacing:w="0.5rem"}=n,[I,k]=D.useState(y),x=vIe();Nf(()=>{x||a==null||a()},[x]),Nf(()=>{k(y)},[y]);const F=()=>k(null),B=()=>k(y),z=()=>{x&&l()};D.useEffect(()=>{x&&d&&l()},[x,d,l]),TEe(z,I);const J=D.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),$=D.useMemo(()=>Hke(f),[f]);return R.jsx(Wf.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:F,onHoverEnd:B,custom:{position:f},style:$,children:R.jsx(Dt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:J,children:sl(s,{id:t,onClose:z})})})});ote.displayName="ToastComponent";function jt(n){return D.forwardRef(n)}var CM,iY;function aNe(){if(iY)return CM;iY=1;var n=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var y,v,b;if(Array.isArray(d)){if(y=d.length,y!=f.length)return!1;for(v=y;v--!==0;)if(!l(d[v],f[v]))return!1;return!0}var w;if(t&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(s&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(y=d.length,y!=f.length)return!1;for(v=y;v--!==0;)if(d[v]!==f[v])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(b=Object.keys(d),y=b.length,y!==Object.keys(f).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[v]))return!1;if(n&&d instanceof Element)return!1;for(v=y;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],f[b[v]]))return!1;return!0}return d!==d&&f!==f}return CM=function(f,y){try{return l(f,y)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},CM}var cNe=aNe();const lNe=Pg(cNe);function D0(){const n=D.useContext(a0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function ate(){const n=pN(),t=D0();return{...n,theme:t}}function uNe(n,t,s){if(t==null)return t;const a=l=>{var d,f;return(f=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(t)??a(s)??s}function dNe(n,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const f=l.filter(Boolean),y=a.map((v,b)=>{const w=`${n}.${v}`;return uNe(d,w,f[b]??v)});return Array.isArray(t)?y:y[0]}}function cte(n,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=ate(),f=n?MQ(l,`components.${n}`):void 0,y=s||f,v=Wh({theme:l,colorMode:d},(y==null?void 0:y.defaultProps)??{},rN(A0(a,["children"])),(w,I)=>w?void 0:I),b=D.useRef({});if(y){const I=Nve(y)(v);lNe(b.current,I)||(b.current=I)}return b.current}function xu(n,t={}){return cte(n,t)}function Qa(n,t={}){return cte(n,t)}const sY={path:R.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[R.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),R.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),R.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},In=jt((n,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:y,__css:v,...b}=n,w=pn("chakra-icon",y),I=xu("Icon",n),k={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...I},x={ref:t,focusable:d,className:w,__css:k},F=a??sY.viewBox;if(s&&typeof s!="string")return R.jsx(Dt.svg,{as:s,...x,...b});const B=f??sY.path;return R.jsx(Dt.svg,{verticalAlign:"middle",viewBox:F,...x,...b,children:B})});In.displayName="Icon";function hNe(n){return R.jsx(In,{viewBox:"0 0 24 24",...n,children:R.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function pNe(n){return R.jsx(In,{viewBox:"0 0 24 24",...n,children:R.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function oY(n){return R.jsx(In,{viewBox:"0 0 24 24",...n,children:R.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const fNe=jC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),ap=jt((n,t)=>{const s=xu("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:y,...v}=Fi(n),b=pn("chakra-spinner",y),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${fNe} ${d} linear infinite`,...s};return R.jsx(Dt.div,{ref:t,__css:w,className:b,...v,children:a&&R.jsx(Dt.span,{srOnly:!0,children:a})})});ap.displayName="Spinner";const[mNe,tj]=Ai({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[gNe,nj]=Ai({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),lte={info:{icon:pNe,colorScheme:"blue"},warning:{icon:oY,colorScheme:"orange"},success:{icon:hNe,colorScheme:"green"},error:{icon:oY,colorScheme:"red"},loading:{icon:ap,colorScheme:"blue"}};function _Ne(n){return lte[n].colorScheme}function yNe(n){return lte[n].icon}const _f=jt(function(t,s){const{status:a="info",addRole:l=!0,...d}=Fi(t),f=t.colorScheme??_Ne(a),y=Qa("Alert",{...t,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return R.jsx(mNe,{value:{status:a},children:R.jsx(gNe,{value:y,children:R.jsx(Dt.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:pn("chakra-alert",t.className),__css:v})})})});_f.displayName="Alert";function yf(n){const{status:t}=tj(),s=yNe(t),a=nj(),l=t==="loading"?a.spinner:a.icon;return R.jsx(Dt.span,{display:"inherit","data-status":t,...n,className:pn("chakra-alert__icon",n.className),__css:l,children:n.children||R.jsx(s,{h:"100%",w:"100%"})})}yf.displayName="AlertIcon";const US=jt(function(t,s){const a=nj(),{status:l}=tj();return R.jsx(Dt.div,{ref:s,"data-status":l,...t,className:pn("chakra-alert__title",t.className),__css:a.title})});US.displayName="AlertTitle";const VS=jt(function(t,s){const{status:a}=tj(),l=nj(),d={display:"inline",...l.description};return R.jsx(Dt.div,{ref:s,"data-status":a,...t,className:pn("chakra-alert__desc",t.className),__css:d})});VS.displayName="AlertDescription";function ENe(n){return R.jsx(In,{focusable:"false","aria-hidden":!0,...n,children:R.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const rj=jt(function(t,s){const a=xu("CloseButton",t),{children:l,isDisabled:d,__css:f,...y}=Fi(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return R.jsx(Dt.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...v,...a,...f},...y,children:l||R.jsx(ENe,{width:"1em",height:"1em"})})});rj.displayName="CloseButton";const vNe=n=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:f,description:y,colorScheme:v,icon:b}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return R.jsxs(_f,{addRole:!1,status:t,variant:s,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[R.jsx(yf,{children:b}),R.jsxs(Dt.div,{flex:"1",maxWidth:"100%",children:[l&&R.jsx(US,{id:w==null?void 0:w.title,children:l}),y&&R.jsx(VS,{id:w==null?void 0:w.description,display:"block",children:y})]}),d&&R.jsx(rj,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function ute(n={}){const{render:t,toastComponent:s=vNe}=n;return l=>typeof t=="function"?t({...l,...n}):R.jsx(s,{...l,...n})}const SNe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Fh=bNe(SNe);function bNe(n){let t=n;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>n),s.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(y=>y.id!=l)}))},notify:(l,d)=>{const f=TNe(l,d),{position:y,id:v}=f;return a(b=>{const I=y.includes("top")?[f,...b[y]??[]]:[...b[y]??[],f];return{...b,[y]:I}}),v},update:(l,d)=>{l&&a(f=>{const y={...f},{position:v,index:b}=tY(y,l);return v&&b!==-1&&(y[v][b]={...y[v][b],...d,message:ute(d)}),y})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const f=ste(d,l);return f?{...d,[f]:d[f].map(y=>y.id==l?{...y,requestClose:!0}:y)}:d})},isActive:l=>!!tY(Fh.getState(),l).position}}let aY=0;function TNe(n,t={}){aY+=1;const s=t.id??aY,a=t.position??"bottom";return{id:s,message:n,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>Fh.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var dte=IQ();const[hte,wNe]=Ai({strict:!1,name:"PortalContext"}),ij="chakra-portal",CNe=".chakra-portal",RNe=n=>R.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),INe=n=>{const{appendToParentPortal:t,children:s}=n,[a,l]=D.useState(null),d=D.useRef(null),[,f]=D.useState({});D.useEffect(()=>f({}),[]);const y=wNe(),v=pIe();$h(()=>{if(!a)return;const w=a.ownerDocument,I=t?y??w.body:w.body;if(!I)return;d.current=w.createElement("div"),d.current.className=ij,I.appendChild(d.current),f({});const k=d.current;return()=>{I.contains(k)&&I.removeChild(k)}},[a]);const b=v!=null&&v.zIndex?R.jsx(RNe,{zIndex:v==null?void 0:v.zIndex,children:s}):s;return d.current?dte.createPortal(R.jsx(hte,{value:d.current,children:b}),d.current):R.jsx("span",{ref:w=>{w&&l(w)}})},ANe=n=>{const{children:t,containerRef:s,appendToParentPortal:a}=n,l=s.current,d=l??(typeof window<"u"?document.body:void 0),f=D.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=ij),v},[l]),[,y]=D.useState({});return $h(()=>y({}),[]),$h(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?dte.createPortal(R.jsx(hte,{value:a?f:null,children:t}),f):null};function Mu(n){const t={appendToParentPortal:!0,...n},{containerRef:s,...a}=t;return s?R.jsx(ANe,{containerRef:s,...a}):R.jsx(INe,{...a})}Mu.className=ij;Mu.selector=CNe;Mu.displayName="Portal";const[PNe,ONe]=Ai({name:"ToastOptionsContext",strict:!1}),kNe=n=>{const t=D.useSyncExternalStore(Fh.subscribe,Fh.getState,Fh.getState),{motionVariants:s,component:a=ote,portalProps:l,animatePresenceProps:d}=n,y=Object.keys(t).map(v=>{const b=t[v];return R.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:$ke(v),children:R.jsx(O0,{...d,initial:!1,children:b.map(w=>R.jsx(a,{motionVariants:s,...w},w.id))})},v)});return R.jsx(Mu,{...l,children:y})},NNe=n=>function({children:s,theme:a=n,toastOptions:l,...d}){return R.jsxs(mIe,{theme:a,...d,children:[R.jsx(PNe,{value:l==null?void 0:l.defaultOptions,children:s}),R.jsx(kNe,{...l})]})},DNe=NNe(iRe);function cY(n){return n.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const LNe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function lY(n,t,s){let a=n+1;return s&&a>=t&&(a=0),a}function uY(n,t,s){let a=n-1;return s&&a<0&&(a=t),a}const RM=typeof window<"u"?D.useLayoutEffect:D.useEffect,dY=n=>n;var xNe=Object.defineProperty,MNe=(n,t,s)=>t in n?xNe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,Ns=(n,t,s)=>(MNe(n,typeof t!="symbol"?t+"":t,s),s);class UNe{constructor(){Ns(this,"descendants",new Map),Ns(this,"register",t=>{if(t!=null)return LNe(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),Ns(this,"unregister",t=>{this.descendants.delete(t);const s=cY(Array.from(this.descendants.keys()));this.assignIndex(s)}),Ns(this,"destroy",()=>{this.descendants.clear()}),Ns(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),Ns(this,"count",()=>this.descendants.size),Ns(this,"enabledCount",()=>this.enabledValues().length),Ns(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),Ns(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),Ns(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),Ns(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),Ns(this,"first",()=>this.item(0)),Ns(this,"firstEnabled",()=>this.enabledItem(0)),Ns(this,"last",()=>this.item(this.descendants.size-1)),Ns(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),Ns(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),Ns(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),Ns(this,"next",(t,s=!0)=>{const a=lY(t,this.count(),s);return this.item(a)}),Ns(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=lY(l,this.enabledCount(),s);return this.enabledItem(d)}),Ns(this,"prev",(t,s=!0)=>{const a=uY(t,this.count()-1,s);return this.item(a)}),Ns(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=uY(l,this.enabledCount()-1,s);return this.enabledItem(d)}),Ns(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=cY(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function pte(){const[n,t]=Ai({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,t,()=>{const l=D.useRef(new UNe);return RM(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[f,y]=D.useState(-1),v=D.useRef(null);RM(()=>()=>{v.current&&d.unregister(v.current)},[]),RM(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);f!=w&&!Number.isNaN(w)&&y(w)});const b=dY(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(v.current),register:Li(b,v)}}]}const hY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Sy={enter:{duration:.2,ease:hY.easeOut},exit:{duration:.1,ease:hY.easeIn}},by={enter:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[VNe,FNe]=Ai({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function jNe(n){const t=n.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function fte(n){const{name:t,getInitials:s,...a}=n,l=FNe();return R.jsx(Dt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}fte.displayName="AvatarName";const mte=n=>R.jsxs(Dt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[R.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),R.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function gte(n){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:y,ignoreFallback:v}=n,[b,w]=D.useState("pending");D.useEffect(()=>{w(s?"loading":"pending")},[s]);const I=D.useRef(null),k=D.useCallback(()=>{if(!s)return;x();const F=new Image;F.src=s,f&&(F.crossOrigin=f),a&&(F.srcset=a),y&&(F.sizes=y),t&&(F.loading=t),F.onload=B=>{x(),w("loaded"),l==null||l(B)},F.onerror=B=>{x(),w("failed"),d==null||d(B)},I.current=F},[s,f,a,y,l,d,t]),x=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return $h(()=>{if(!v)return b==="loading"&&k(),()=>{x()}},[b,k,v]),v?"loaded":b}const BNe=(n,t)=>n!=="loaded"&&t==="beforeLoadOrError"||n==="failed"&&t==="onError";function _te(n){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:y,loading:v,iconLabel:b,icon:w=R.jsx(mte,{}),ignoreFallback:I,referrerPolicy:k,crossOrigin:x}=n,B=gte({src:t,onError:a,crossOrigin:x,ignoreFallback:I})==="loaded";return!t||!B?f?R.jsx(fte,{className:"chakra-avatar__initials",getInitials:d,name:f}):D.cloneElement(w,{role:"img","aria-label":b}):R.jsx(Dt.img,{src:t,srcSet:s,alt:f??b,onLoad:l,referrerPolicy:k,crossOrigin:x??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}_te.displayName="AvatarImage";const WNe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},ip=jt((n,t)=>{const s=Qa("Avatar",n),[a,l]=D.useState(!1),{src:d,srcSet:f,name:y,showBorder:v,borderRadius:b="full",onError:w,onLoad:I,getInitials:k=jNe,icon:x=R.jsx(mte,{}),iconLabel:F=" avatar",loading:B,children:z,borderColor:J,ignoreFallback:$,crossOrigin:ie,referrerPolicy:ue,...re}=Fi(n),fe={borderRadius:b,borderWidth:v?"2px":void 0,...WNe,...s.container};return J&&(fe.borderColor=J),R.jsx(Dt.span,{ref:t,...re,className:pn("chakra-avatar",n.className),"data-loaded":Zn(a),__css:fe,children:R.jsxs(VNe,{value:s,children:[R.jsx(_te,{src:d,srcSet:f,loading:B,onLoad:An(I,()=>{l(!0)}),onError:w,getInitials:k,name:y,borderRadius:b,icon:x,iconLabel:F,ignoreFallback:$,crossOrigin:ie,referrerPolicy:ue}),z]})})});ip.displayName="Avatar";const Ef=jt(function(t,s){const a=xu("Badge",t),{className:l,...d}=Fi(t);return R.jsx(Dt.span,{ref:s,className:pn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});Ef.displayName="Badge";const wt=Dt("div");wt.displayName="Box";const[QWe,zNe]=Ai({strict:!1,name:"ButtonGroupContext"});function Dw(n){const{children:t,className:s,...a}=n,l=D.isValidElement(t)?D.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=pn("chakra-button__icon",s);return R.jsx(Dt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}Dw.displayName="ButtonIcon";function WU(n){const{label:t,placement:s,spacing:a="0.5rem",children:l=R.jsx(ap,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,...y}=n,v=pn("chakra-button__spinner",d),b=s==="start"?"marginEnd":"marginStart",w=D.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,t,b,a]);return R.jsx(Dt.div,{className:v,...y,__css:w,children:l})}WU.displayName="ButtonSpinner";function GNe(n){const[t,s]=D.useState(!n);return{ref:D.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const Kr=jt((n,t)=>{const s=zNe(),a=xu("Button",{...s,...n}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:f,children:y,leftIcon:v,rightIcon:b,loadingText:w,iconSpacing:I="0.5rem",type:k,spinner:x,spinnerPlacement:F="start",className:B,as:z,shouldWrapChildren:J,...$}=Fi(n),ie=D.useMemo(()=>{const q={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:q}}},[a,s]),{ref:ue,type:re}=GNe(z),fe={rightIcon:b,leftIcon:v,iconSpacing:I,children:y,shouldWrapChildren:J};return R.jsxs(Dt.button,{disabled:l||d,ref:bEe(t,ue),as:z,type:k??re,"data-active":Zn(f),"data-loading":Zn(d),__css:ie,className:pn("chakra-button",B),...$,children:[d&&F==="start"&&R.jsx(WU,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:I,children:x}),d?w||R.jsx(Dt.span,{opacity:0,children:R.jsx(pY,{...fe})}):R.jsx(pY,{...fe}),d&&F==="end"&&R.jsx(WU,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:I,children:x})]})});Kr.displayName="Button";function pY(n){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?R.jsxs("span",{style:{display:"contents"},children:[t&&R.jsx(Dw,{marginEnd:l,children:t}),a,s&&R.jsx(Dw,{marginStart:l,children:s})]}):R.jsxs(R.Fragment,{children:[t&&R.jsx(Dw,{marginEnd:l,children:t}),a,s&&R.jsx(Dw,{marginStart:l,children:s})]})}const xo=jt((n,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...f}=n,y=s||a,v=D.isValidElement(y)?D.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return R.jsx(Kr,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...f,children:v})});xo.displayName="IconButton";const yte=Dt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});yte.displayName="Center";const HNe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};jt(function(t,s){const{axis:a="both",...l}=t;return R.jsx(Dt.div,{ref:s,__css:HNe[a],...l,position:"absolute"})});var $Ne=()=>typeof document<"u",fY=!1,$C=null,Py=!1,zU=!1,GU=new Set;function sj(n,t){GU.forEach(s=>s(n,t))}var KNe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function qNe(n){return!(n.metaKey||!KNe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function mY(n){Py=!0,qNe(n)&&($C="keyboard",sj("keyboard",n))}function pS(n){if($C="pointer",n.type==="mousedown"||n.type==="pointerdown"){Py=!0;const t=n.composedPath?n.composedPath()[0]:n.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;sj("pointer",n)}}function YNe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function XNe(n){YNe(n)&&(Py=!0,$C="virtual")}function JNe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Py&&!zU&&($C="virtual",sj("virtual",n)),Py=!1,zU=!1)}function QNe(){Py=!1,zU=!0}function gY(){return $C!=="pointer"}function ZNe(){if(!$Ne()||fY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){Py=!0,n.apply(this,s)},document.addEventListener("keydown",mY,!0),document.addEventListener("keyup",mY,!0),document.addEventListener("click",XNe,!0),window.addEventListener("focus",JNe,!0),window.addEventListener("blur",QNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",pS,!0),document.addEventListener("pointermove",pS,!0),document.addEventListener("pointerup",pS,!0)):(document.addEventListener("mousedown",pS,!0),document.addEventListener("mousemove",pS,!0),document.addEventListener("mouseup",pS,!0)),fY=!0}function e1e(n){ZNe(),n(gY());const t=()=>n(gY());return GU.add(t),()=>{GU.delete(t)}}const[t1e,Ete]=Ai({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[n1e,L0]=Ai({strict:!1,name:"FormControlContext"});function r1e(n){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=n,y=D.useId(),v=t||`field-${y}`,b=`${v}-label`,w=`${v}-feedback`,I=`${v}-helptext`,[k,x]=D.useState(!1),[F,B]=D.useState(!1),[z,J]=D.useState(!1),$=D.useCallback((q={},X=null)=>({id:I,...q,ref:Li(X,Q=>{Q&&B(!0)})}),[I]),ie=D.useCallback((q={},X=null)=>({...q,ref:X,"data-focus":Zn(z),"data-disabled":Zn(l),"data-invalid":Zn(a),"data-readonly":Zn(d),id:q.id!==void 0?q.id:b,htmlFor:q.htmlFor!==void 0?q.htmlFor:v}),[v,l,z,a,d,b]),ue=D.useCallback((q={},X=null)=>({id:w,...q,ref:Li(X,Q=>{Q&&x(!0)}),"aria-live":"polite"}),[w]),re=D.useCallback((q={},X=null)=>({...q,...f,ref:X,role:"group","data-focus":Zn(z),"data-disabled":Zn(l),"data-invalid":Zn(a),"data-readonly":Zn(d)}),[f,l,z,a,d]),fe=D.useCallback((q={},X=null)=>({...q,ref:X,role:"presentation","aria-hidden":!0,children:q.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!z,onFocus:()=>J(!0),onBlur:()=>J(!1),hasFeedbackText:k,setHasFeedbackText:x,hasHelpText:F,setHasHelpText:B,id:v,labelId:b,feedbackId:w,helpTextId:I,htmlProps:f,getHelpTextProps:$,getErrorMessageProps:ue,getRootProps:re,getLabelProps:ie,getRequiredIndicatorProps:fe}}const vi=jt(function(t,s){const a=Qa("Form",t),l=Fi(t),{getRootProps:d,htmlProps:f,...y}=r1e(l),v=pn("chakra-form-control",t.className);return R.jsx(n1e,{value:y,children:R.jsx(t1e,{value:a,children:R.jsx(Dt.div,{...d({},s),className:v,__css:a.container})})})});vi.displayName="FormControl";const SC=jt(function(t,s){const a=L0(),l=Ete(),d=pn("chakra-form__helper-text",t.className);return R.jsx(Dt.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});SC.displayName="FormHelperText";function oj(n){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=aj(n);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":wf(s),"aria-required":wf(l),"aria-readonly":wf(a)}}function aj(n){const t=L0(),{id:s,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:y,isReadOnly:v,isDisabled:b,onFocus:w,onBlur:I,...k}=n,x=n["aria-describedby"]?[n["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&x.push(t.feedbackId),t!=null&&t.hasHelpText&&x.push(t.helpTextId),{...k,"aria-describedby":x.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??b??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??f??(t==null?void 0:t.isRequired),isInvalid:y??(t==null?void 0:t.isInvalid),onFocus:An(t==null?void 0:t.onFocus,w),onBlur:An(t==null?void 0:t.onBlur,I)}}const i1e={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function s1e(n={}){const t=aj(n),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:y,onFocus:v,"aria-describedby":b}=t,{defaultChecked:w,isChecked:I,isFocusable:k,onChange:x,isIndeterminate:F,name:B,value:z,tabIndex:J=void 0,"aria-label":$,"aria-labelledby":ie,"aria-invalid":ue,...re}=n,fe=A0(re,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),q=Hs(x),X=Hs(y),Q=Hs(v),[se,me]=D.useState(!1),[pe,le]=D.useState(!1),[Le,We]=D.useState(!1),[$e,ve]=D.useState(!1);D.useEffect(()=>e1e(me),[]);const _e=D.useRef(null),[Ee,ke]=D.useState(!0),[we,be]=D.useState(!!w),Ie=I!==void 0,Me=Ie?I:we,ze=D.useCallback(Ht=>{if(a||s){Ht.preventDefault();return}Ie||be(Me?Ht.currentTarget.checked:F?!0:Ht.currentTarget.checked),q==null||q(Ht)},[a,s,Me,Ie,F,q]);$h(()=>{_e.current&&(_e.current.indeterminate=!!F)},[F]),Nf(()=>{s&&le(!1)},[s,le]),$h(()=>{const Ht=_e.current;if(!(Ht!=null&&Ht.form))return;const jn=()=>{be(!!w)};return Ht.form.addEventListener("reset",jn),()=>{var Wt;return(Wt=Ht.form)==null?void 0:Wt.removeEventListener("reset",jn)}},[]);const Je=s&&!k,tt=D.useCallback(Ht=>{Ht.key===" "&&ve(!0)},[ve]),ut=D.useCallback(Ht=>{Ht.key===" "&&ve(!1)},[ve]);$h(()=>{if(!_e.current)return;_e.current.checked!==Me&&be(_e.current.checked)},[_e.current]);const Ze=D.useCallback((Ht={},jn=null)=>{const Wt=Re=>{pe&&Re.preventDefault(),ve(!0)};return{...Ht,ref:jn,"data-active":Zn($e),"data-hover":Zn(Le),"data-checked":Zn(Me),"data-focus":Zn(pe),"data-focus-visible":Zn(pe&&se),"data-indeterminate":Zn(F),"data-disabled":Zn(s),"data-invalid":Zn(d),"data-readonly":Zn(a),"aria-hidden":!0,onMouseDown:An(Ht.onMouseDown,Wt),onMouseUp:An(Ht.onMouseUp,()=>ve(!1)),onMouseEnter:An(Ht.onMouseEnter,()=>We(!0)),onMouseLeave:An(Ht.onMouseLeave,()=>We(!1))}},[$e,Me,s,pe,se,Le,F,d,a]),vt=D.useCallback((Ht={},jn=null)=>({...Ht,ref:jn,"data-active":Zn($e),"data-hover":Zn(Le),"data-checked":Zn(Me),"data-focus":Zn(pe),"data-focus-visible":Zn(pe&&se),"data-indeterminate":Zn(F),"data-disabled":Zn(s),"data-invalid":Zn(d),"data-readonly":Zn(a)}),[$e,Me,s,pe,se,Le,F,d,a]),sn=D.useCallback((Ht={},jn=null)=>({...fe,htmlFor:Ee?f:void 0,...Ht,ref:Li(jn,Wt=>{Wt&&ke(Wt.tagName==="LABEL")}),onClick:An(Ht.onClick,()=>{var Wt;Ee||((Wt=_e.current)==null||Wt.click(),requestAnimationFrame(()=>{var Re;(Re=_e.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":Zn(s),"data-checked":Zn(Me),"data-invalid":Zn(d)}),[fe,s,Me,d,Ee,f]),Mt=D.useCallback((Ht={},jn=null)=>({...Ht,ref:Li(_e,jn),type:"checkbox",name:B,value:z,id:f,tabIndex:J,onChange:An(Ht.onChange,ze),onBlur:An(Ht.onBlur,X,()=>le(!1)),onFocus:An(Ht.onFocus,Q,()=>le(!0)),onKeyDown:An(Ht.onKeyDown,tt),onKeyUp:An(Ht.onKeyUp,ut),required:l,checked:Me,disabled:Je,readOnly:a,"aria-label":$,"aria-labelledby":ie,"aria-invalid":ue?!!ue:d,"aria-describedby":b,"aria-disabled":s,"aria-checked":F?"mixed":Me,style:i1e}),[B,z,f,J,ze,X,Q,tt,ut,l,Me,Je,a,$,ie,ue,d,b,s,F]),Qt=D.useCallback((Ht={},jn=null)=>({...Ht,ref:jn,onMouseDown:An(Ht.onMouseDown,o1e),"data-disabled":Zn(s),"data-checked":Zn(Me),"data-invalid":Zn(d)}),[Me,s,d]);return{state:{isInvalid:d,isFocused:pe,isChecked:Me,isActive:$e,isHovered:Le,isIndeterminate:F,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:sn,getCheckboxProps:Ze,getIndicatorProps:vt,getInputProps:Mt,getLabelProps:Qt,htmlProps:fe}}function o1e(n){n.preventDefault(),n.stopPropagation()}const hg=jt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:y,borderStyle:v,borderColor:b,...w}=xu("Divider",t),{className:I,orientation:k="horizontal",__css:x,...F}=Fi(t),B={vertical:{borderLeftWidth:a||f||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||y||"1px",width:"100%"}};return R.jsx(Dt.hr,{ref:s,"aria-orientation":k,...F,__css:{...w,border:"0",borderColor:b,borderStyle:v,...B[k],...x},className:pn("chakra-divider",I)})});hg.displayName="Divider";const Qi=jt(function(t,s){const{direction:a,align:l,justify:d,wrap:f,basis:y,grow:v,shrink:b,...w}=t,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:y,flexGrow:v,flexShrink:b};return R.jsx(Dt.div,{ref:s,__css:I,...w})});Qi.displayName="Flex";function a1e(n,t){if(n==null)return{};var s={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(t.indexOf(a)!==-1)continue;s[a]=n[a]}return s}var IM={exports:{}},AM,_Y;function c1e(){if(_Y)return AM;_Y=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return AM=n,AM}var PM,yY;function l1e(){if(yY)return PM;yY=1;var n=c1e();function t(){}function s(){}return s.resetWarningCache=t,PM=function(){function a(f,y,v,b,w,I){if(I!==n){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},PM}var EY;function u1e(){return EY||(EY=1,IM.exports=l1e()()),IM.exports}var d1e=u1e();const Tn=Pg(d1e);var HU="data-focus-lock",vte="data-focus-lock-disabled",h1e="data-no-focus-lock",p1e="data-autofocus-inside",f1e="data-no-autofocus";function OM(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function m1e(n,t){var s=D.useState(function(){return{value:n,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var g1e=typeof window<"u"?D.useLayoutEffect:D.useEffect,vY=new WeakMap;function Ste(n,t){var s=m1e(null,function(a){return n.forEach(function(l){return OM(l,a)})});return g1e(function(){var a=vY.get(s);if(a){var l=new Set(a),d=new Set(n),f=s.current;l.forEach(function(y){d.has(y)||OM(y,null)}),d.forEach(function(y){l.has(y)||OM(y,f)})}vY.set(s,n)},[n]),s}var kM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},jh=function(){return jh=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},jh.apply(this,arguments)};function KC(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s}function _1e(n,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return n.concat(d||Array.prototype.slice.call(t))}function bte(n){return n}function Tte(n,t){t===void 0&&(t=bte);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:n},useMedium:function(d){var f=t(d,a);return s.push(f),function(){s=s.filter(function(y){return y!==f})}},assignSyncMedium:function(d){for(a=!0;s.length;){var f=s;s=[],f.forEach(d)}s={push:function(y){return d(y)},filter:function(){return s}}},assignMedium:function(d){a=!0;var f=[];if(s.length){var y=s;s=[],y.forEach(d),f=s}var v=function(){var w=f;f=[],w.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),s={push:function(w){f.push(w),b()},filter:function(w){return f=f.filter(w),s}}}};return l}function cj(n,t){return t===void 0&&(t=bte),Tte(n,t)}function wte(n){n===void 0&&(n={});var t=Tte(null);return t.options=jh({async:!0,ssr:!1},n),t}var Cte=function(n){var t=n.sideCar,s=KC(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return D.createElement(a,jh({},s))};Cte.isSideCarExport=!0;function y1e(n,t){return n.useMedium(t),Cte}var Rte=cj({},function(n){var t=n.target,s=n.currentTarget;return{target:t,currentTarget:s}}),Ite=cj(),E1e=cj(),v1e=wte({async:!0,ssr:typeof document<"u"}),S1e=D.createContext(void 0),b1e=[],lj=D.forwardRef(function(t,s){var a,l=D.useState(),d=l[0],f=l[1],y=D.useRef(),v=D.useRef(!1),b=D.useRef(null),w=D.useState({}),I=w[1],k=t.children,x=t.disabled,F=x===void 0?!1:x,B=t.noFocusGuards,z=B===void 0?!1:B,J=t.persistentFocus,$=J===void 0?!1:J,ie=t.crossFrame,ue=ie===void 0?!0:ie,re=t.autoFocus,fe=re===void 0?!0:re;t.allowTextSelection;var q=t.group,X=t.className,Q=t.whiteList,se=t.hasPositiveIndices,me=t.shards,pe=me===void 0?b1e:me,le=t.as,Le=le===void 0?"div":le,We=t.lockProps,$e=We===void 0?{}:We,ve=t.sideCar,_e=t.returnFocus,Ee=_e===void 0?!1:_e,ke=t.focusOptions,we=t.onActivation,be=t.onDeactivation,Ie=D.useState({}),Me=Ie[0],ze=D.useCallback(function(jn){var Wt=jn.captureFocusRestore;if(!b.current){var Re,Fe=(Re=document)==null?void 0:Re.activeElement;b.current=Fe,Fe!==document.body&&(b.current=Wt(Fe))}y.current&&we&&we(y.current),v.current=!0,I()},[we]),Je=D.useCallback(function(){v.current=!1,be&&be(y.current),I()},[be]),tt=D.useCallback(function(jn){var Wt=b.current;if(Wt){var Re=(typeof Wt=="function"?Wt():Wt)||document.body,Fe=typeof Ee=="function"?Ee(Re):Ee;if(Fe){var Ge=typeof Fe=="object"?Fe:void 0;b.current=null,jn?Promise.resolve().then(function(){return Re.focus(Ge)}):Re.focus(Ge)}}},[Ee]),ut=D.useCallback(function(jn){v.current&&Rte.useMedium(jn)},[]),Ze=Ite.useMedium,vt=D.useCallback(function(jn){y.current!==jn&&(y.current=jn,f(jn))},[]),sn=Ay((a={},a[vte]=F&&"disabled",a[HU]=q,a),$e),Mt=z!==!0,Qt=Mt&&z!=="tail",on=Ste([s,vt]),Ht=D.useMemo(function(){return{observed:y,shards:pe,enabled:!F,active:v.current}},[F,v.current,pe,d]);return ui.createElement(D.Fragment,null,Mt&&[ui.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:F?-1:0,style:kM}),se?ui.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:F?-1:1,style:kM}):null],!F&&ui.createElement(ve,{id:Me,sideCar:v1e,observed:d,disabled:F,persistentFocus:$,crossFrame:ue,autoFocus:fe,whiteList:Q,shards:pe,onActivation:ze,onDeactivation:Je,returnFocus:tt,focusOptions:ke,noFocusGuards:z}),ui.createElement(Le,Ay({ref:on},sn,{className:X,onBlur:Ze,onFocus:ut}),ui.createElement(S1e.Provider,{value:Ht},k)),Qt&&ui.createElement("div",{"data-focus-guard":!0,tabIndex:F?-1:0,style:kM}))});lj.propTypes={};function $U(n,t){return $U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},$U(n,t)}function T1e(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,$U(n,t)}function bC(n){"@babel/helpers - typeof";return bC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bC(n)}function w1e(n,t){if(bC(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,t);if(bC(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function C1e(n){var t=w1e(n,"string");return bC(t)=="symbol"?t:t+""}function R1e(n,t,s){return(t=C1e(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function I1e(n,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function y(){f=n(d.map(function(b){return b.props})),t(f)}var v=function(b){T1e(w,b);function w(){return b.apply(this,arguments)||this}w.peek=function(){return f};var I=w.prototype;return I.componentDidMount=function(){d.push(this),y()},I.componentDidUpdate=function(){y()},I.componentWillUnmount=function(){var x=d.indexOf(this);d.splice(x,1),y()},I.render=function(){return ui.createElement(l,this.props)},w}(D.PureComponent);return R1e(v,"displayName","SideEffect("+s(l)+")"),v}}var cp=function(n){for(var t=Array(n.length),s=0;s<n.length;++s)t[s]=n[s];return t},Oy=function(n){return Array.isArray(n)?n:[n]},Ate=function(n){return Array.isArray(n)?n[0]:n},A1e=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(n,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},Pte=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Ote=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},P1e=function(n){return n.hasAttribute("inert")},O1e=function(n,t){return!n||Ote(n)||!A1e(n)&&!P1e(n)&&t(Pte(n))},kte=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=O1e(t,kte.bind(void 0,n));return n.set(t,a),a},k1e=function(n,t){return n&&!Ote(n)?L1e(n)?t(Pte(n)):!1:!0},Nte=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=k1e(t,Nte.bind(void 0,n));return n.set(t,a),a},Dte=function(n){return n.dataset},N1e=function(n){return n.tagName==="BUTTON"},Lte=function(n){return n.tagName==="INPUT"},xte=function(n){return Lte(n)&&n.type==="radio"},D1e=function(n){return!((Lte(n)||N1e(n))&&(n.type==="hidden"||n.disabled))},L1e=function(n){var t=n.getAttribute(f1e);return![!0,"true",""].includes(t)},uj=function(n){var t;return!!(n&&(!((t=Dte(n))===null||t===void 0)&&t.focusGuard))},KU=function(n){return!uj(n)},x1e=function(n){return!!n},M1e=function(n,t){var s=Math.max(0,n.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=n.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},U1e=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},dj=function(n,t,s){return cp(n).map(function(a,l){var d=U1e(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(M1e)},V1e=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],hj=V1e.join(","),F1e="".concat(hj,", [data-focus-guard]"),Mte=function(n,t){return cp((n.shadowRoot||n).children).reduce(function(s,a){return s.concat(a.matches(t?F1e:hj)?[a]:[],Mte(a))},[])},j1e=function(n,t){var s;return n instanceof HTMLIFrameElement&&(!((s=n.contentDocument)===null||s===void 0)&&s.body)?d0([n.contentDocument.body],t):[n]},d0=function(n,t){return n.reduce(function(s,a){var l,d=Mte(a,t),f=(l=[]).concat.apply(l,d.map(function(y){return j1e(y,t)}));return s.concat(f,a.parentNode?cp(a.parentNode.querySelectorAll(hj)).filter(function(y){return y===a}):[])},[])},B1e=function(n){var t=n.querySelectorAll("[".concat(p1e,"]"));return cp(t).map(function(s){return d0([s])}).reduce(function(s,a){return s.concat(a)},[])},pj=function(n,t){return cp(n).filter(function(s){return kte(t,s)}).filter(function(s){return D1e(s)})},SY=function(n,t){return t===void 0&&(t=new Map),cp(n).filter(function(s){return Nte(t,s)})},fj=function(n,t,s){return dj(pj(d0(n,s),t),!0,s)},TC=function(n,t){return dj(pj(d0(n),t),!1)},W1e=function(n,t){return pj(B1e(n),t)},Ty=function(n,t){return n.shadowRoot?Ty(n.shadowRoot,t):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,t)?!0:cp(n.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?Ty(l,t):!1}return Ty(s,t)})},z1e=function(n){for(var t=new Set,s=n.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return n.filter(function(f,y){return!t.has(y)})},Ute=function(n){return n.parentNode?Ute(n.parentNode):n},mj=function(n){var t=Oy(n);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(HU);return s.push.apply(s,l?z1e(cp(Ute(a).querySelectorAll("[".concat(HU,'="').concat(l,'"]:not([').concat(vte,'="disabled"])')))):[a]),s},[])},G1e=function(n){try{return n()}catch{return}},wC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var t=n.activeElement;return t.shadowRoot?wC(t.shadowRoot):t instanceof HTMLIFrameElement&&G1e(function(){return t.contentWindow.document})?wC(t.contentWindow.document):t}},H1e=function(n,t){return n===t},$1e=function(n,t){return!!cp(n.querySelectorAll("iframe")).some(function(s){return H1e(s,t)})},Vte=function(n,t){return t===void 0&&(t=wC(Ate(n).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:mj(n).some(function(s){return Ty(s,t)||$1e(s,t)})},K1e=function(n){n===void 0&&(n=document);var t=wC(n);return t?cp(n.querySelectorAll("[".concat(h1e,"]"))).some(function(s){return Ty(s,t)}):!1},q1e=function(n,t){return t.filter(xte).filter(function(s){return s.name===n.name}).filter(function(s){return s.checked})[0]||n},gj=function(n,t){return xte(n)&&n.name?q1e(n,t):n},Y1e=function(n){var t=new Set;return n.forEach(function(s){return t.add(gj(s,n))}),n.filter(function(s){return t.has(s)})},bY=function(n){return n[0]&&n.length>1?gj(n[0],n):n[0]},TY=function(n,t){return n.indexOf(gj(t,n))},qU="NEW_FOCUS",X1e=function(n,t,s,a,l){var d=n.length,f=n[0],y=n[d-1],v=uj(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?s.indexOf(a):-1,w=l?s.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:qU;if(I===-1)return qU;var k=b-w,x=s.indexOf(f),F=s.indexOf(y),B=Y1e(s),z=a!==void 0?B.indexOf(a):-1,J=l?B.indexOf(l):z,$=B.filter(function(X){return X.tabIndex>=0}),ie=a!==void 0?$.indexOf(a):-1,ue=l?$.indexOf(l):ie,re=ie>=0&&ue>=0?ue-ie:J-z;if(!k&&I>=0||t.length===0)return I;var fe=TY(n,t[0]),q=TY(n,t[t.length-1]);if(b<=x&&v&&Math.abs(k)>1)return q;if(b>=F&&v&&Math.abs(k)>1)return fe;if(k&&Math.abs(re)>1)return I;if(b<=x)return q;if(b>F)return fe;if(k)return Math.abs(k)>1?I:(d+I+k)%d}},J1e=function(n){return function(t){var s,a=(s=Dte(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||n.indexOf(t)>=0}},wY=function(n,t,s){var a=n.map(function(d){var f=d.node;return f}),l=SY(a.filter(J1e(s)));return l&&l.length?bY(l):bY(SY(t))},YU=function(n,t){return t===void 0&&(t=[]),t.push(n),n.parentNode&&YU(n.parentNode.host||n.parentNode,t),t},NM=function(n,t){for(var s=YU(n),a=YU(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},Fte=function(n,t,s){var a=Oy(n),l=Oy(t),d=a[0],f=!1;return l.filter(Boolean).forEach(function(y){f=NM(f||y,y)||f,s.filter(Boolean).forEach(function(v){var b=NM(d,v);b&&(!f||Ty(b,f)?f=b:f=NM(b,f))})}),f},CY=function(n,t){return n.reduce(function(s,a){return s.concat(W1e(a,t))},[])},Q1e=function(n,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),n.map(function(a){return s.get(a)}).filter(x1e)},Z1e=function(n,t){var s=wC(Oy(n).length>0?document:Ate(n).ownerDocument),a=mj(n).filter(KU),l=Fte(s||n,n,a),d=new Map,f=TC(a,d),y=f.filter(function(F){var B=F.node;return KU(B)});if(y[0]){var v=TC([l],d).map(function(F){var B=F.node;return B}),b=Q1e(v,y),w=b.map(function(F){var B=F.node;return B}),I=b.filter(function(F){var B=F.tabIndex;return B>=0}).map(function(F){var B=F.node;return B}),k=X1e(w,I,v,s,t);if(k===qU){var x=wY(f,I,CY(a,d))||wY(f,w,CY(a,d));if(x)return{node:x};console.warn("focus-lock: cannot find any node to move focus into");return}return k===void 0?k:b[k]}},eDe=function(n){var t=mj(n).filter(KU),s=Fte(n,n,t),a=dj(d0([s],!0),!0,!0),l=d0(t,!1);return a.map(function(d){var f=d.node,y=d.index;return{node:f,index:y,lockItem:l.indexOf(f)>=0,guard:uj(f)}})},_j=function(n,t){n&&("focus"in n&&n.focus(t),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},DM=0,LM=!1,jte=function(n,t,s){s===void 0&&(s={});var a=Z1e(n,t);if(!LM&&a){if(DM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),LM=!0,setTimeout(function(){LM=!1},1);return}DM++,_j(a.node,s.focusOptions),DM--}};function uw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var t=n?new WeakRef(n):null;return function(){return(t==null?void 0:t.deref())||null}}var tDe=function(n){if(!n)return null;for(var t=[],s=n;s&&s!==document.body;)t.push({current:uw(s),parent:uw(s.parentElement),left:uw(s.previousElementSibling),right:uw(s.nextElementSibling)}),s=s.parentElement;return{element:uw(n),stack:t,ownerDocument:n.ownerDocument}},nDe=function(n){var t,s,a,l,d;if(n)for(var f=n.stack,y=n.ownerDocument,v=new Map,b=0,w=f;b<w.length;b++){var I=w[b],k=(t=I.parent)===null||t===void 0?void 0:t.call(I);if(k&&y.contains(k)){for(var x=(s=I.left)===null||s===void 0?void 0:s.call(I),F=I.current(),B=k.contains(F)?F:void 0,z=(a=I.right)===null||a===void 0?void 0:a.call(I),J=fj([k],v),$=(d=(l=B??(x==null?void 0:x.nextElementSibling))!==null&&l!==void 0?l:z)!==null&&d!==void 0?d:x;$;){for(var ie=0,ue=J;ie<ue.length;ie++){var re=ue[ie];if($!=null&&$.contains(re.node))return re.node}$=$.nextElementSibling}if(J.length)return J[0].node}}},Bte=function(n){var t=tDe(n);return function(){return nDe(t)}},rDe=function(n,t,s){if(!n||!t)return console.error("no element or scope given"),{};var a=Oy(t);if(a.every(function(f){return!Ty(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=s?fj(a,new Map):TC(a,new Map),d=l.findIndex(function(f){var y=f.node;return y===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},iDe=function(n,t){var s=t?fj(Oy(n),new Map):TC(Oy(n),new Map);return{first:s[0],last:s[s.length-1]}},sDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Wte=function(n,t,s){t===void 0&&(t={});var a=sDe(t),l=rDe(n,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&_j(d.node,a.focusOptions)}},oDe=function(n,t){t===void 0&&(t={}),Wte(n,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},aDe=function(n,t){t===void 0&&(t={}),Wte(n,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},zte=function(n,t,s){var a,l=iDe(n,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&_j(d.node,t.focusOptions)},cDe=function(n,t){t===void 0&&(t={}),zte(n,t,"first")},lDe=function(n,t){t===void 0&&(t={}),zte(n,t,"last")};function yj(n){setTimeout(n,1)}var uDe=function(t){return t&&"current"in t?t.current:t},Gte=function(){return document&&document.activeElement===document.body},dDe=function(){return Gte()||K1e()},YS=null,el=null,RY=function(){return null},XS=null,CC=!1,Ej=!1,hDe=function(){return!0},pDe=function(t){return(YS.whiteList||hDe)(t)},fDe=function(t,s){XS={observerNode:t,portaledElement:s}},mDe=function(t){return XS&&XS.portaledElement===t};function IY(n,t,s,a){var l=null,d=n;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==n)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var gDe=function(t){return t?!!CC:CC==="meanwhile"},_De=function n(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&n(t,s.parentNode,a))},yDe=function(t,s){return s.some(function(a){return _De(t,a,a)})},Hte=function(t){return TC(t,new Map)},EDe=function(t){return!Hte([t.parentNode]).some(function(s){return s.node===t})},Rk=function(){var t=!1;if(YS){var s=YS,a=s.observed,l=s.persistentFocus,d=s.autoFocus,f=s.shards,y=s.crossFrame,v=s.focusOptions,b=s.noFocusGuards,w=a||XS&&XS.portaledElement;if(Gte()&&el&&el!==document.body&&(!document.body.contains(el)||EDe(el))){var I=RY();I&&I.focus()}var k=document&&document.activeElement;if(w){var x=[w].concat(f.map(uDe).filter(Boolean)),F=function(){if(!gDe(y)||!b||!el||Ej)return!1;var ie=Hte(x),ue=ie.findIndex(function(re){var fe=re.node;return fe===el});return ue===0||ue===ie.length-1};if((!k||pDe(k))&&(l||F()||!dDe()||!el&&d)&&(w&&!(Vte(x)||k&&yDe(k,x)||mDe(k))&&(document&&!el&&k&&!d?(k.blur&&k.blur(),document.body.focus()):(t=jte(x,el,{focusOptions:v}),XS={})),el=document&&document.activeElement,el!==document.body&&(RY=Bte(el)),CC=!1),document&&k!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,z=eDe(x),J=z.map(function($){var ie=$.node;return ie}).indexOf(B);J>-1&&(z.filter(function($){var ie=$.guard,ue=$.node;return ie&&ue.dataset.focusAutoGuard}).forEach(function($){var ie=$.node;return ie.removeAttribute("tabIndex")}),IY(J,z.length,1,z),IY(J,-1,-1,z))}}}return t},$te=function(t){Rk()&&t&&(t.stopPropagation(),t.preventDefault())},vj=function(){return yj(Rk)},vDe=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||fDe(a,s)},SDe=function(){return null},Kte=function(){Ej=!0},qte=function(){Ej=!1,CC="just",yj(function(){CC="meanwhile"})},bDe=function(){document.addEventListener("focusin",$te),document.addEventListener("focusout",vj),window.addEventListener("focus",Kte),window.addEventListener("blur",qte)},TDe=function(){document.removeEventListener("focusin",$te),document.removeEventListener("focusout",vj),window.removeEventListener("focus",Kte),window.removeEventListener("blur",qte)};function wDe(n){return n.filter(function(t){var s=t.disabled;return!s})}var Yte={moveFocusInside:jte,focusInside:Vte,focusNextElement:oDe,focusPrevElement:aDe,focusFirstElement:cDe,focusLastElement:lDe,captureFocusRestore:Bte};function CDe(n){var t=n.slice(-1)[0];t&&!YS&&bDe();var s=YS,a=s&&t&&t.id===s.id;YS=t,s&&!a&&(s.onDeactivation(),n.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(el=null,(!a||s.observed!==t.observed)&&t.onActivation(Yte),Rk(),yj(Rk)):(TDe(),el=null)}Rte.assignSyncMedium(vDe);Ite.assignMedium(vj);E1e.assignMedium(function(n){return n(Yte)});const RDe=I1e(wDe,CDe)(SDe);var XU=D.forwardRef(function(t,s){return ui.createElement(lj,Ay({sideCar:RDe,ref:s},t))}),Xte=lj.propTypes||{};Xte.sideCar;a1e(Xte,["sideCar"]);XU.propTypes={};const IDe=XU.default??XU,Jte=n=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:y,persistentFocus:v,lockFocusAcrossFrames:b}=n,w=D.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&xQ(a.current).length===0&&requestAnimationFrame(()=>{var F;(F=a.current)==null||F.focus()})},[t,a]),I=D.useCallback(()=>{var x;(x=s==null?void 0:s.current)==null||x.focus()},[s]),k=l&&!s;return R.jsx(IDe,{crossFrame:b,persistentFocus:v,autoFocus:y,disabled:f,onActivation:w,onDeactivation:I,returnFocus:k,children:d})};Jte.displayName="FocusLock";const[ADe,PDe]=Ai({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Vh=jt((n,t)=>{const s=Qa("FormError",n),a=Fi(n),l=L0();return l!=null&&l.isInvalid?R.jsx(ADe,{value:s,children:R.jsx(Dt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:pn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});Vh.displayName="FormErrorMessage";const ODe=jt((n,t)=>{const s=PDe(),a=L0();if(!(a!=null&&a.isInvalid))return null;const l=pn("chakra-form__error-icon",n.className);return R.jsx(In,{ref:t,"aria-hidden":!0,...n,__css:s.icon,className:l,children:R.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});ODe.displayName="FormErrorIcon";const go=jt(function(t,s){const a=xu("FormLabel",t),l=Fi(t),{className:d,children:f,requiredIndicator:y=R.jsx(Qte,{}),optionalIndicator:v=null,...b}=l,w=L0(),I=(w==null?void 0:w.getLabelProps(b,s))??{ref:s,...b};return R.jsxs(Dt.label,{...I,className:pn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,w!=null&&w.isRequired?y:v]})});go.displayName="FormLabel";const Qte=jt(function(t,s){const a=L0(),l=Ete();if(!(a!=null&&a.isRequired))return null;const d=pn("chakra-form__required-indicator",t.className);return R.jsx(Dt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});Qte.displayName="RequiredIndicator";const Zte=jt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:y,row:v,autoFlow:b,autoRows:w,templateRows:I,autoColumns:k,templateColumns:x,...F}=t,B={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:k,gridColumn:y,gridRow:v,gridAutoFlow:b,gridAutoRows:w,gridTemplateRows:I,gridTemplateColumns:x};return R.jsx(Dt.div,{ref:s,__css:B,...F})});Zte.displayName="Grid";const ene=jt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:y,...v}=t,b=D0(),w=y?NDe(y,b):DDe(a);return R.jsx(Zte,{ref:s,gap:f,columnGap:l,rowGap:d,templateColumns:w,...v})});ene.displayName="SimpleGrid";function kDe(n){return typeof n=="number"?`${n}px`:n}function NDe(n,t){return tF(n,s=>{const a=dNe("sizes",s,kDe(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function DDe(n){return tF(n,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function kg(n){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=n,d=D.Children.toArray(n.path),f=jt((y,v)=>R.jsx(In,{ref:v,viewBox:t,...l,...y,children:d.length?d:R.jsx("path",{fill:"currentColor",d:s})}));return f.displayName=a,f}const JU=jt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=t;return R.jsx("img",{width:a,height:l,ref:s,alt:d,...f})});JU.displayName="NativeImage";const zh=jt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:y,fit:v,loading:b,ignoreFallback:w,crossOrigin:I,fallbackStrategy:k="beforeLoadOrError",referrerPolicy:x,...F}=t,B=a!==void 0||l!==void 0,z=b!=null||w||!B,J=gte({...t,crossOrigin:I,ignoreFallback:z}),$=BNe(J,k),ie={ref:s,objectFit:v,objectPosition:y,...z?F:A0(F,["onError","onLoad"])};return $?l||R.jsx(Dt.img,{as:JU,className:"chakra-image__placeholder",src:a,...ie}):R.jsx(Dt.img,{as:JU,src:d,srcSet:f,crossOrigin:I,loading:b,referrerPolicy:x,className:"chakra-image",...ie})});zh.displayName="Image";const os=jt(function(t,s){const{htmlSize:a,...l}=t,d=Qa("Input",l),f=Fi(l),y=oj(f),v=pn("chakra-input",t.className);return R.jsx(Dt.input,{size:a,...y,__css:d.field,ref:s,className:v})});os.displayName="Input";os.id="Input";const[LDe,tne]=Ai({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),wy=jt(function(t,s){const a=Qa("Input",t),{children:l,className:d,...f}=Fi(t),y=pn("chakra-input__group",d),v={},b=QV(l),w=a.field;b.forEach(k=>{a&&(w&&k.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&k.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),k.type.id==="InputRightAddon"&&(v.borderEndRadius=0),k.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const I=b.map(k=>{var F,B;const x=rN({size:((F=k.props)==null?void 0:F.size)||t.size,variant:((B=k.props)==null?void 0:B.variant)||t.variant});return k.type.id!=="Input"?D.cloneElement(k,x):D.cloneElement(k,Object.assign(x,v,k.props))});return R.jsx(Dt.div,{className:y,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:R.jsx(LDe,{value:a,children:I})})});wy.displayName="InputGroup";const xDe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},MDe=Dt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),Sj=jt(function(t,s){const{placement:a="left",...l}=t,d=xDe[a]??{},f=tne();return R.jsx(MDe,{ref:s,...l,__css:{...f.addon,...d}})});Sj.displayName="InputAddon";const bj=jt(function(t,s){return R.jsx(Sj,{ref:s,placement:"left",...t,className:pn("chakra-input__left-addon",t.className)})});bj.displayName="InputLeftAddon";bj.id="InputLeftAddon";const nne=jt(function(t,s){return R.jsx(Sj,{ref:s,placement:"right",...t,className:pn("chakra-input__right-addon",t.className)})});nne.displayName="InputRightAddon";nne.id="InputRightAddon";const UDe=Dt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),EN=jt(function(t,s){const{placement:a="left",...l}=t,d=tne(),f=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return R.jsx(UDe,{ref:s,__css:v,...l})});EN.id="InputElement";EN.displayName="InputElement";const Qw=jt(function(t,s){const{className:a,...l}=t,d=pn("chakra-input__left-element",a);return R.jsx(EN,{ref:s,placement:"left",className:d,...l})});Qw.id="InputLeftElement";Qw.displayName="InputLeftElement";const Ik=jt(function(t,s){const{className:a,...l}=t,d=pn("chakra-input__right-element",a);return R.jsx(EN,{ref:s,placement:"right",className:d,...l})});Ik.id="InputRightElement";Ik.displayName="InputRightElement";const Ll=jt(function(t,s){const a=xu("Link",t),{className:l,isExternal:d,...f}=Fi(t);return R.jsx(Dt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:pn("chakra-link",l),...f,__css:a})});Ll.displayName="Link";function VDe(n,t={}){const{ssr:s=!0,fallback:a}=t,{getWindow:l}=fIe(),d=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(b=>b!=null);const[y,v]=D.useState(()=>d.map((b,w)=>({media:b,matches:s?!!f[w]:l().matchMedia(b).matches})));return D.useEffect(()=>{const b=l();v(d.map(k=>({media:k,matches:b.matchMedia(k).matches})));const w=d.map(k=>b.matchMedia(k)),I=k=>{v(x=>x.slice().map(F=>F.media===k.media?{...F,matches:k.matches}:F))};return w.forEach(k=>{typeof k.addListener=="function"?k.addListener(I):k.addEventListener("change",I)}),()=>{w.forEach(k=>{typeof k.removeListener=="function"?k.removeListener(I):k.removeEventListener("change",I)})}},[l]),y.map(b=>b.matches)}function FDe(n,t,s,a){if(t==null)return a;if(!a)return n.find(f=>s(f).toLowerCase().startsWith(t.toLowerCase()));const l=n.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function jDe(n){const{key:t}=n;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function BDe(n={}){const{timeout:t=300,preventDefault:s=()=>!0}=n,[a,l]=D.useState([]),d=D.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},y=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},t)};D.useEffect(()=>f,[]);function v(b){return w=>{if(w.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(jDe(w)){const I=a.concat(w.key);s(w)&&(w.preventDefault(),w.stopPropagation()),l(I),b(I.join("")),y()}}}return v}var ol="top",Nu="bottom",Du="right",al="left",Tj="auto",qC=[ol,Nu,Du,al],h0="start",RC="end",WDe="clippingParents",rne="viewport",dw="popper",zDe="reference",AY=qC.reduce(function(n,t){return n.concat([t+"-"+h0,t+"-"+RC])},[]),ine=[].concat(qC,[Tj]).reduce(function(n,t){return n.concat([t,t+"-"+h0,t+"-"+RC])},[]),GDe="beforeRead",HDe="read",$De="afterRead",KDe="beforeMain",qDe="main",YDe="afterMain",XDe="beforeWrite",JDe="write",QDe="afterWrite",ZDe=[GDe,HDe,$De,KDe,qDe,YDe,XDe,JDe,QDe];function sp(n){return n?(n.nodeName||"").toLowerCase():null}function Bl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function ky(n){var t=Bl(n).Element;return n instanceof t||n instanceof Element}function Pu(n){var t=Bl(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function wj(n){if(typeof ShadowRoot>"u")return!1;var t=Bl(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function eLe(n){var t=n.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!Pu(d)||!sp(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var y=l[f];y===!1?d.removeAttribute(f):d.setAttribute(f,y===!0?"":y)}))})}function tLe(n){var t=n.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},f=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),y=f.reduce(function(v,b){return v[b]="",v},{});!Pu(l)||!sp(l)||(Object.assign(l.style,y),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const nLe={name:"applyStyles",enabled:!0,phase:"write",fn:eLe,effect:tLe,requires:["computeStyles"]};function Jh(n){return n.split("-")[0]}var Cy=Math.max,Ak=Math.min,p0=Math.round;function QU(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function sne(){return!/^((?!chrome|android).)*safari/i.test(QU())}function f0(n,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=n.getBoundingClientRect(),l=1,d=1;t&&Pu(n)&&(l=n.offsetWidth>0&&p0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&p0(a.height)/n.offsetHeight||1);var f=ky(n)?Bl(n):window,y=f.visualViewport,v=!sne()&&s,b=(a.left+(v&&y?y.offsetLeft:0))/l,w=(a.top+(v&&y?y.offsetTop:0))/d,I=a.width/l,k=a.height/d;return{width:I,height:k,top:w,right:b+I,bottom:w+k,left:b,x:b,y:w}}function Cj(n){var t=f0(n),s=n.offsetWidth,a=n.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:n.offsetLeft,y:n.offsetTop,width:s,height:a}}function one(n,t){var s=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(s&&wj(s)){var a=t;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function xf(n){return Bl(n).getComputedStyle(n)}function rLe(n){return["table","td","th"].indexOf(sp(n))>=0}function Ng(n){return((ky(n)?n.ownerDocument:n.document)||window.document).documentElement}function vN(n){return sp(n)==="html"?n:n.assignedSlot||n.parentNode||(wj(n)?n.host:null)||Ng(n)}function PY(n){return!Pu(n)||xf(n).position==="fixed"?null:n.offsetParent}function iLe(n){var t=/firefox/i.test(QU()),s=/Trident/i.test(QU());if(s&&Pu(n)){var a=xf(n);if(a.position==="fixed")return null}var l=vN(n);for(wj(l)&&(l=l.host);Pu(l)&&["html","body"].indexOf(sp(l))<0;){var d=xf(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function YC(n){for(var t=Bl(n),s=PY(n);s&&rLe(s)&&xf(s).position==="static";)s=PY(s);return s&&(sp(s)==="html"||sp(s)==="body"&&xf(s).position==="static")?t:s||iLe(n)||t}function Rj(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function Zw(n,t,s){return Cy(n,Ak(t,s))}function sLe(n,t,s){var a=Zw(n,t,s);return a>s?s:a}function ane(){return{top:0,right:0,bottom:0,left:0}}function cne(n){return Object.assign({},ane(),n)}function lne(n,t){return t.reduce(function(s,a){return s[a]=n,s},{})}var oLe=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,cne(typeof t!="number"?t:lne(t,qC))};function aLe(n){var t,s=n.state,a=n.name,l=n.options,d=s.elements.arrow,f=s.modifiersData.popperOffsets,y=Jh(s.placement),v=Rj(y),b=[al,Du].indexOf(y)>=0,w=b?"height":"width";if(!(!d||!f)){var I=oLe(l.padding,s),k=Cj(d),x=v==="y"?ol:al,F=v==="y"?Nu:Du,B=s.rects.reference[w]+s.rects.reference[v]-f[v]-s.rects.popper[w],z=f[v]-s.rects.reference[v],J=YC(d),$=J?v==="y"?J.clientHeight||0:J.clientWidth||0:0,ie=B/2-z/2,ue=I[x],re=$-k[w]-I[F],fe=$/2-k[w]/2+ie,q=Zw(ue,fe,re),X=v;s.modifiersData[a]=(t={},t[X]=q,t.centerOffset=q-fe,t)}}function cLe(n){var t=n.state,s=n.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||one(t.elements.popper,l)&&(t.elements.arrow=l))}const lLe={name:"arrow",enabled:!0,phase:"main",fn:aLe,effect:cLe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function m0(n){return n.split("-")[1]}var uLe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function dLe(n,t){var s=n.x,a=n.y,l=t.devicePixelRatio||1;return{x:p0(s*l)/l||0,y:p0(a*l)/l||0}}function OY(n){var t,s=n.popper,a=n.popperRect,l=n.placement,d=n.variation,f=n.offsets,y=n.position,v=n.gpuAcceleration,b=n.adaptive,w=n.roundOffsets,I=n.isFixed,k=f.x,x=k===void 0?0:k,F=f.y,B=F===void 0?0:F,z=typeof w=="function"?w({x,y:B}):{x,y:B};x=z.x,B=z.y;var J=f.hasOwnProperty("x"),$=f.hasOwnProperty("y"),ie=al,ue=ol,re=window;if(b){var fe=YC(s),q="clientHeight",X="clientWidth";if(fe===Bl(s)&&(fe=Ng(s),xf(fe).position!=="static"&&y==="absolute"&&(q="scrollHeight",X="scrollWidth")),fe=fe,l===ol||(l===al||l===Du)&&d===RC){ue=Nu;var Q=I&&fe===re&&re.visualViewport?re.visualViewport.height:fe[q];B-=Q-a.height,B*=v?1:-1}if(l===al||(l===ol||l===Nu)&&d===RC){ie=Du;var se=I&&fe===re&&re.visualViewport?re.visualViewport.width:fe[X];x-=se-a.width,x*=v?1:-1}}var me=Object.assign({position:y},b&&uLe),pe=w===!0?dLe({x,y:B},Bl(s)):{x,y:B};if(x=pe.x,B=pe.y,v){var le;return Object.assign({},me,(le={},le[ue]=$?"0":"",le[ie]=J?"0":"",le.transform=(re.devicePixelRatio||1)<=1?"translate("+x+"px, "+B+"px)":"translate3d("+x+"px, "+B+"px, 0)",le))}return Object.assign({},me,(t={},t[ue]=$?B+"px":"",t[ie]=J?x+"px":"",t.transform="",t))}function hLe(n){var t=n.state,s=n.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,f=d===void 0?!0:d,y=s.roundOffsets,v=y===void 0?!0:y,b={placement:Jh(t.placement),variation:m0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,OY(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,OY(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const pLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:hLe,data:{}};var dO={passive:!0};function fLe(n){var t=n.state,s=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,y=f===void 0?!0:f,v=Bl(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(w){w.addEventListener("scroll",s.update,dO)}),y&&v.addEventListener("resize",s.update,dO),function(){d&&b.forEach(function(w){w.removeEventListener("scroll",s.update,dO)}),y&&v.removeEventListener("resize",s.update,dO)}}const mLe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:fLe,data:{}};var gLe={left:"right",right:"left",bottom:"top",top:"bottom"};function HO(n){return n.replace(/left|right|bottom|top/g,function(t){return gLe[t]})}var _Le={start:"end",end:"start"};function kY(n){return n.replace(/start|end/g,function(t){return _Le[t]})}function Ij(n){var t=Bl(n),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function Aj(n){return f0(Ng(n)).left+Ij(n).scrollLeft}function yLe(n,t){var s=Bl(n),a=Ng(n),l=s.visualViewport,d=a.clientWidth,f=a.clientHeight,y=0,v=0;if(l){d=l.width,f=l.height;var b=sne();(b||!b&&t==="fixed")&&(y=l.offsetLeft,v=l.offsetTop)}return{width:d,height:f,x:y+Aj(n),y:v}}function ELe(n){var t,s=Ng(n),a=Ij(n),l=(t=n.ownerDocument)==null?void 0:t.body,d=Cy(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=Cy(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-a.scrollLeft+Aj(n),v=-a.scrollTop;return xf(l||s).direction==="rtl"&&(y+=Cy(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:y,y:v}}function Pj(n){var t=xf(n),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function une(n){return["html","body","#document"].indexOf(sp(n))>=0?n.ownerDocument.body:Pu(n)&&Pj(n)?n:une(vN(n))}function eC(n,t){var s;t===void 0&&(t=[]);var a=une(n),l=a===((s=n.ownerDocument)==null?void 0:s.body),d=Bl(a),f=l?[d].concat(d.visualViewport||[],Pj(a)?a:[]):a,y=t.concat(f);return l?y:y.concat(eC(vN(f)))}function ZU(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function vLe(n,t){var s=f0(n,!1,t==="fixed");return s.top=s.top+n.clientTop,s.left=s.left+n.clientLeft,s.bottom=s.top+n.clientHeight,s.right=s.left+n.clientWidth,s.width=n.clientWidth,s.height=n.clientHeight,s.x=s.left,s.y=s.top,s}function NY(n,t,s){return t===rne?ZU(yLe(n,s)):ky(t)?vLe(t,s):ZU(ELe(Ng(n)))}function SLe(n){var t=eC(vN(n)),s=["absolute","fixed"].indexOf(xf(n).position)>=0,a=s&&Pu(n)?YC(n):n;return ky(a)?t.filter(function(l){return ky(l)&&one(l,a)&&sp(l)!=="body"}):[]}function bLe(n,t,s,a){var l=t==="clippingParents"?SLe(n):[].concat(t),d=[].concat(l,[s]),f=d[0],y=d.reduce(function(v,b){var w=NY(n,b,a);return v.top=Cy(w.top,v.top),v.right=Ak(w.right,v.right),v.bottom=Ak(w.bottom,v.bottom),v.left=Cy(w.left,v.left),v},NY(n,f,a));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function dne(n){var t=n.reference,s=n.element,a=n.placement,l=a?Jh(a):null,d=a?m0(a):null,f=t.x+t.width/2-s.width/2,y=t.y+t.height/2-s.height/2,v;switch(l){case ol:v={x:f,y:t.y-s.height};break;case Nu:v={x:f,y:t.y+t.height};break;case Du:v={x:t.x+t.width,y};break;case al:v={x:t.x-s.width,y};break;default:v={x:t.x,y:t.y}}var b=l?Rj(l):null;if(b!=null){var w=b==="y"?"height":"width";switch(d){case h0:v[b]=v[b]-(t[w]/2-s[w]/2);break;case RC:v[b]=v[b]+(t[w]/2-s[w]/2);break}}return v}function IC(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?n.placement:a,d=s.strategy,f=d===void 0?n.strategy:d,y=s.boundary,v=y===void 0?WDe:y,b=s.rootBoundary,w=b===void 0?rne:b,I=s.elementContext,k=I===void 0?dw:I,x=s.altBoundary,F=x===void 0?!1:x,B=s.padding,z=B===void 0?0:B,J=cne(typeof z!="number"?z:lne(z,qC)),$=k===dw?zDe:dw,ie=n.rects.popper,ue=n.elements[F?$:k],re=bLe(ky(ue)?ue:ue.contextElement||Ng(n.elements.popper),v,w,f),fe=f0(n.elements.reference),q=dne({reference:fe,element:ie,placement:l}),X=ZU(Object.assign({},ie,q)),Q=k===dw?X:fe,se={top:re.top-Q.top+J.top,bottom:Q.bottom-re.bottom+J.bottom,left:re.left-Q.left+J.left,right:Q.right-re.right+J.right},me=n.modifiersData.offset;if(k===dw&&me){var pe=me[l];Object.keys(se).forEach(function(le){var Le=[Du,Nu].indexOf(le)>=0?1:-1,We=[ol,Nu].indexOf(le)>=0?"y":"x";se[le]+=pe[We]*Le})}return se}function TLe(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,f=s.padding,y=s.flipVariations,v=s.allowedAutoPlacements,b=v===void 0?ine:v,w=m0(a),I=w?y?AY:AY.filter(function(F){return m0(F)===w}):qC,k=I.filter(function(F){return b.indexOf(F)>=0});k.length===0&&(k=I);var x=k.reduce(function(F,B){return F[B]=IC(n,{placement:B,boundary:l,rootBoundary:d,padding:f})[Jh(B)],F},{});return Object.keys(x).sort(function(F,B){return x[F]-x[B]})}function wLe(n){if(Jh(n)===Tj)return[];var t=HO(n);return[kY(n),t,kY(t)]}function CLe(n){var t=n.state,s=n.options,a=n.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,y=f===void 0?!0:f,v=s.fallbackPlacements,b=s.padding,w=s.boundary,I=s.rootBoundary,k=s.altBoundary,x=s.flipVariations,F=x===void 0?!0:x,B=s.allowedAutoPlacements,z=t.options.placement,J=Jh(z),$=J===z,ie=v||($||!F?[HO(z)]:wLe(z)),ue=[z].concat(ie).reduce(function(Me,ze){return Me.concat(Jh(ze)===Tj?TLe(t,{placement:ze,boundary:w,rootBoundary:I,padding:b,flipVariations:F,allowedAutoPlacements:B}):ze)},[]),re=t.rects.reference,fe=t.rects.popper,q=new Map,X=!0,Q=ue[0],se=0;se<ue.length;se++){var me=ue[se],pe=Jh(me),le=m0(me)===h0,Le=[ol,Nu].indexOf(pe)>=0,We=Le?"width":"height",$e=IC(t,{placement:me,boundary:w,rootBoundary:I,altBoundary:k,padding:b}),ve=Le?le?Du:al:le?Nu:ol;re[We]>fe[We]&&(ve=HO(ve));var _e=HO(ve),Ee=[];if(d&&Ee.push($e[pe]<=0),y&&Ee.push($e[ve]<=0,$e[_e]<=0),Ee.every(function(Me){return Me})){Q=me,X=!1;break}q.set(me,Ee)}if(X)for(var ke=F?3:1,we=function(ze){var Je=ue.find(function(tt){var ut=q.get(tt);if(ut)return ut.slice(0,ze).every(function(Ze){return Ze})});if(Je)return Q=Je,"break"},be=ke;be>0;be--){var Ie=we(be);if(Ie==="break")break}t.placement!==Q&&(t.modifiersData[a]._skip=!0,t.placement=Q,t.reset=!0)}}const RLe={name:"flip",enabled:!0,phase:"main",fn:CLe,requiresIfExists:["offset"],data:{_skip:!1}};function DY(n,t,s){return s===void 0&&(s={x:0,y:0}),{top:n.top-t.height-s.y,right:n.right-t.width+s.x,bottom:n.bottom-t.height+s.y,left:n.left-t.width-s.x}}function LY(n){return[ol,Du,Nu,al].some(function(t){return n[t]>=0})}function ILe(n){var t=n.state,s=n.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,f=IC(t,{elementContext:"reference"}),y=IC(t,{altBoundary:!0}),v=DY(f,a),b=DY(y,l,d),w=LY(v),I=LY(b);t.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:w,hasPopperEscaped:I},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":I})}const ALe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ILe};function PLe(n,t,s){var a=Jh(n),l=[al,ol].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:n})):s,f=d[0],y=d[1];return f=f||0,y=(y||0)*l,[al,Du].indexOf(a)>=0?{x:y,y:f}:{x:f,y}}function OLe(n){var t=n.state,s=n.options,a=n.name,l=s.offset,d=l===void 0?[0,0]:l,f=ine.reduce(function(w,I){return w[I]=PLe(I,t.rects,d),w},{}),y=f[t.placement],v=y.x,b=y.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=f}const kLe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:OLe};function NLe(n){var t=n.state,s=n.name;t.modifiersData[s]=dne({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const DLe={name:"popperOffsets",enabled:!0,phase:"read",fn:NLe,data:{}};function LLe(n){return n==="x"?"y":"x"}function xLe(n){var t=n.state,s=n.options,a=n.name,l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,y=f===void 0?!1:f,v=s.boundary,b=s.rootBoundary,w=s.altBoundary,I=s.padding,k=s.tether,x=k===void 0?!0:k,F=s.tetherOffset,B=F===void 0?0:F,z=IC(t,{boundary:v,rootBoundary:b,padding:I,altBoundary:w}),J=Jh(t.placement),$=m0(t.placement),ie=!$,ue=Rj(J),re=LLe(ue),fe=t.modifiersData.popperOffsets,q=t.rects.reference,X=t.rects.popper,Q=typeof B=="function"?B(Object.assign({},t.rects,{placement:t.placement})):B,se=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),me=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,pe={x:0,y:0};if(fe){if(d){var le,Le=ue==="y"?ol:al,We=ue==="y"?Nu:Du,$e=ue==="y"?"height":"width",ve=fe[ue],_e=ve+z[Le],Ee=ve-z[We],ke=x?-X[$e]/2:0,we=$===h0?q[$e]:X[$e],be=$===h0?-X[$e]:-q[$e],Ie=t.elements.arrow,Me=x&&Ie?Cj(Ie):{width:0,height:0},ze=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:ane(),Je=ze[Le],tt=ze[We],ut=Zw(0,q[$e],Me[$e]),Ze=ie?q[$e]/2-ke-ut-Je-se.mainAxis:we-ut-Je-se.mainAxis,vt=ie?-q[$e]/2+ke+ut+tt+se.mainAxis:be+ut+tt+se.mainAxis,sn=t.elements.arrow&&YC(t.elements.arrow),Mt=sn?ue==="y"?sn.clientTop||0:sn.clientLeft||0:0,Qt=(le=me==null?void 0:me[ue])!=null?le:0,on=ve+Ze-Qt-Mt,Ht=ve+vt-Qt,jn=Zw(x?Ak(_e,on):_e,ve,x?Cy(Ee,Ht):Ee);fe[ue]=jn,pe[ue]=jn-ve}if(y){var Wt,Re=ue==="x"?ol:al,Fe=ue==="x"?Nu:Du,Ge=fe[re],ot=re==="y"?"height":"width",_t=Ge+z[Re],yt=Ge-z[Fe],Gt=[ol,al].indexOf(J)!==-1,mn=(Wt=me==null?void 0:me[re])!=null?Wt:0,Pn=Gt?_t:Ge-q[ot]-X[ot]-mn+se.altAxis,un=Gt?Ge+q[ot]+X[ot]-mn-se.altAxis:yt,bt=x&&Gt?sLe(Pn,Ge,un):Zw(x?Pn:_t,Ge,x?un:yt);fe[re]=bt,pe[re]=bt-Ge}t.modifiersData[a]=pe}}const MLe={name:"preventOverflow",enabled:!0,phase:"main",fn:xLe,requiresIfExists:["offset"]};function ULe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function VLe(n){return n===Bl(n)||!Pu(n)?Ij(n):ULe(n)}function FLe(n){var t=n.getBoundingClientRect(),s=p0(t.width)/n.offsetWidth||1,a=p0(t.height)/n.offsetHeight||1;return s!==1||a!==1}function jLe(n,t,s){s===void 0&&(s=!1);var a=Pu(t),l=Pu(t)&&FLe(t),d=Ng(t),f=f0(n,l,s),y={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((sp(t)!=="body"||Pj(d))&&(y=VLe(t)),Pu(t)?(v=f0(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=Aj(d))),{x:f.left+y.scrollLeft-v.x,y:f.top+y.scrollTop-v.y,width:f.width,height:f.height}}function BLe(n){var t=new Map,s=new Set,a=[];n.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(y){if(!s.has(y)){var v=t.get(y);v&&l(v)}}),a.push(d)}return n.forEach(function(d){s.has(d.name)||l(d)}),a}function WLe(n){var t=BLe(n);return ZDe.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function zLe(n){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(n())})})),t}}function GLe(n){var t=n.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var xY={placement:"bottom",modifiers:[],strategy:"absolute"};function MY(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function HLe(n){n===void 0&&(n={});var t=n,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?xY:l;return function(y,v,b){b===void 0&&(b=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},xY,d),modifiersData:{},elements:{reference:y,popper:v},attributes:{},styles:{}},I=[],k=!1,x={state:w,setOptions:function(J){var $=typeof J=="function"?J(w.options):J;B(),w.options=Object.assign({},d,w.options,$),w.scrollParents={reference:ky(y)?eC(y):y.contextElement?eC(y.contextElement):[],popper:eC(v)};var ie=WLe(GLe([].concat(a,w.options.modifiers)));return w.orderedModifiers=ie.filter(function(ue){return ue.enabled}),F(),x.update()},forceUpdate:function(){if(!k){var J=w.elements,$=J.reference,ie=J.popper;if(MY($,ie)){w.rects={reference:jLe($,YC(ie),w.options.strategy==="fixed"),popper:Cj(ie)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(se){return w.modifiersData[se.name]=Object.assign({},se.data)});for(var ue=0;ue<w.orderedModifiers.length;ue++){if(w.reset===!0){w.reset=!1,ue=-1;continue}var re=w.orderedModifiers[ue],fe=re.fn,q=re.options,X=q===void 0?{}:q,Q=re.name;typeof fe=="function"&&(w=fe({state:w,options:X,name:Q,instance:x})||w)}}}},update:zLe(function(){return new Promise(function(z){x.forceUpdate(),z(w)})}),destroy:function(){B(),k=!0}};if(!MY(y,v))return x;x.setOptions(b).then(function(z){!k&&b.onFirstUpdate&&b.onFirstUpdate(z)});function F(){w.orderedModifiers.forEach(function(z){var J=z.name,$=z.options,ie=$===void 0?{}:$,ue=z.effect;if(typeof ue=="function"){var re=ue({state:w,name:J,instance:x,options:ie}),fe=function(){};I.push(re||fe)}})}function B(){I.forEach(function(z){return z()}),I=[]}return x}}var $Le=[mLe,DLe,pLe,nLe,kLe,RLe,MLe,lLe,ALe],KLe=HLe({defaultModifiers:$Le});const fS=(n,t)=>({var:n,varRef:t?`var(${n}, ${t})`:`var(${n})`}),to={arrowShadowColor:fS("--popper-arrow-shadow-color"),arrowSize:fS("--popper-arrow-size","8px"),arrowSizeHalf:fS("--popper-arrow-size-half"),arrowBg:fS("--popper-arrow-bg"),transformOrigin:fS("--popper-transform-origin"),arrowOffset:fS("--popper-arrow-offset")};function qLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const YLe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},XLe=n=>YLe[n],UY={scroll:!0,resize:!0};function JLe(n){let t;return typeof n=="object"?t={enabled:!0,options:{...UY,...n}}:t={enabled:n,options:UY},t}const QLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const t=n.elements.reference;n.elements.popper.style.width=`${t.offsetWidth}px`}},ZLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{VY(n)},effect:({state:n})=>()=>{VY(n)}},VY=n=>{n.elements.popper.style.setProperty(to.transformOrigin.var,XLe(n.placement))},exe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{txe(n)}},txe=n=>{var s;if(!n.placement)return;const t=nxe(n.placement);if((s=n.elements)!=null&&s.arrow&&t){Object.assign(n.elements.arrow.style,{[t.property]:t.value,width:to.arrowSize.varRef,height:to.arrowSize.varRef,zIndex:-1});const a={[to.arrowSizeHalf.var]:`calc(${to.arrowSize.varRef} / 2 - 1px)`,[to.arrowOffset.var]:`calc(${to.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},nxe=n=>{if(n.startsWith("top"))return{property:"bottom",value:to.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:to.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:to.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:to.arrowOffset.varRef}},rxe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{FY(n)},effect:({state:n})=>()=>{FY(n)}},FY=n=>{if(!n.elements.arrow)return;const t=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=qLe(n.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:to.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},ixe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},sxe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function oxe(n,t="ltr"){var a;const s=((a=ixe[n])==null?void 0:a[t])||n;return t==="ltr"?s:sxe[n]??s}function Oj(n={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:y,gutter:v=8,flip:b=!0,boundary:w="clippingParents",preventOverflow:I=!0,matchWidth:k,direction:x="ltr"}=n,F=D.useRef(null),B=D.useRef(null),z=D.useRef(null),J=oxe(a,x),$=D.useRef(()=>{}),ie=D.useCallback(()=>{var se;!t||!F.current||!B.current||((se=$.current)==null||se.call($),z.current=KLe(F.current,B.current,{placement:J,modifiers:[rxe,exe,ZLe,{...QLe,enabled:!!k},{name:"eventListeners",...JLe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:y??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:w}},...s??[]],strategy:l}),z.current.forceUpdate(),$.current=z.current.destroy)},[J,t,s,k,f,d,y,v,b,I,w,l]);D.useEffect(()=>()=>{var se;!F.current&&!B.current&&((se=z.current)==null||se.destroy(),z.current=null)},[]);const ue=D.useCallback(se=>{F.current=se,ie()},[ie]),re=D.useCallback((se={},me=null)=>({...se,ref:Li(ue,me)}),[ue]),fe=D.useCallback(se=>{B.current=se,ie()},[ie]),q=D.useCallback((se={},me=null)=>({...se,ref:Li(fe,me),style:{...se.style,position:l,minWidth:k?void 0:"max-content",inset:"0 auto auto 0"}}),[l,fe,k]),X=D.useCallback((se={},me=null)=>{const{size:pe,shadowColor:le,bg:Le,style:We,...$e}=se;return{...$e,ref:me,"data-popper-arrow":"",style:axe(se)}},[]),Q=D.useCallback((se={},me=null)=>({...se,ref:me,"data-popper-arrow-inner":""}),[]);return{update(){var se;(se=z.current)==null||se.update()},forceUpdate(){var se;(se=z.current)==null||se.forceUpdate()},transformOrigin:to.transformOrigin.varRef,referenceRef:ue,popperRef:fe,getPopperProps:q,getArrowProps:X,getArrowInnerProps:Q,getReferenceProps:re}}function axe(n){const{size:t,shadowColor:s,bg:a,style:l}=n,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function cxe(){const n=D.useRef(new Map),t=n.current,s=D.useCallback((l,d,f,y)=>{n.current.set(f,{type:d,el:l,options:y}),l.addEventListener(d,f,y)},[]),a=D.useCallback((l,d,f,y)=>{l.removeEventListener(d,f,y),n.current.delete(f)},[]);return D.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function xM(n){var l,d;const t=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function hne(n={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:y,onClick:v,onKeyDown:b,onKeyUp:w,tabIndex:I,onMouseOver:k,onMouseLeave:x,...F}=n,[B,z]=D.useState(!0),[J,$]=D.useState(!1),ie=cxe(),ue=ve=>{ve&&ve.tagName!=="BUTTON"&&z(!1)},re=B?I:I||0,fe=s&&!a,q=D.useCallback(ve=>{if(s){ve.stopPropagation(),ve.preventDefault();return}ve.currentTarget.focus(),v==null||v(ve)},[s,v]),X=D.useCallback(ve=>{J&&xM(ve)&&(ve.preventDefault(),ve.stopPropagation(),$(!1),ie.remove(document,"keyup",X,!1))},[J,ie]),Q=D.useCallback(ve=>{if(b==null||b(ve),s||ve.defaultPrevented||ve.metaKey||!xM(ve.nativeEvent)||B)return;const _e=l&&ve.key==="Enter";d&&ve.key===" "&&(ve.preventDefault(),$(!0)),_e&&(ve.preventDefault(),ve.currentTarget.click()),ie.add(document,"keyup",X,!1)},[s,B,b,l,d,ie,X]),se=D.useCallback(ve=>{if(w==null||w(ve),s||ve.defaultPrevented||ve.metaKey||!xM(ve.nativeEvent)||B)return;d&&ve.key===" "&&(ve.preventDefault(),$(!1),ve.currentTarget.click())},[d,B,s,w]),me=D.useCallback(ve=>{ve.button===0&&($(!1),ie.remove(document,"mouseup",me,!1))},[ie]),pe=D.useCallback(ve=>{if(ve.button!==0)return;if(s){ve.stopPropagation(),ve.preventDefault();return}B||$(!0),ve.currentTarget.focus({preventScroll:!0}),ie.add(document,"mouseup",me,!1),f==null||f(ve)},[s,B,f,ie,me]),le=D.useCallback(ve=>{ve.button===0&&(B||$(!1),y==null||y(ve))},[y,B]),Le=D.useCallback(ve=>{if(s){ve.preventDefault();return}k==null||k(ve)},[s,k]),We=D.useCallback(ve=>{J&&(ve.preventDefault(),$(!1)),x==null||x(ve)},[J,x]),$e=Li(t,ue);return B?{...F,ref:$e,type:"button","aria-disabled":fe?void 0:s,disabled:fe,onClick:q,onMouseDown:f,onMouseUp:y,onKeyUp:w,onKeyDown:b,onMouseOver:k,onMouseLeave:x}:{...F,ref:$e,role:"button","data-active":Zn(J),"aria-disabled":s?"true":void 0,tabIndex:fe?void 0:re,onClick:q,onMouseDown:pe,onMouseUp:le,onKeyUp:se,onKeyDown:Q,onMouseOver:Le,onMouseLeave:We}}const[lxe,uxe,dxe,hxe]=pte(),[pxe,XC]=Ai({strict:!1,name:"MenuContext"});function pne(n){return(n==null?void 0:n.ownerDocument)??document}function fxe(n){return pne(n).activeElement===n}function mxe(n={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:y,defaultIsOpen:v,onClose:b,onOpen:w,placement:I="bottom-start",lazyBehavior:k="unmount",direction:x,computePositionOnMount:F=!1,...B}=n,z=D.useRef(null),J=D.useRef(null),$=D.useRef(!0),ie=dxe(),ue=D.useCallback(()=>{requestAnimationFrame(()=>{var Ie;(Ie=z.current)==null||Ie.focus({preventScroll:!1})})},[]),re=D.useCallback(()=>{const Ie=setTimeout(()=>{var Me,ze;if(l)(Me=l.current)==null||Me.focus();else if(!ie.count())(ze=z.current)==null||ze.focus({preventScroll:!1});else{const Je=ie.firstEnabled();Je&&Le(Je.index)}});Ee.current.add(Ie)},[ie,l]),fe=D.useCallback(()=>{const Ie=setTimeout(()=>{var Me;if(!ie.count())(Me=z.current)==null||Me.focus({preventScroll:!1});else{const ze=ie.lastEnabled();ze&&Le(ze.index)}});Ee.current.add(Ie)},[ie]),q=D.useCallback(()=>{w==null||w(),d?re():ue()},[d,re,ue,w]),{isOpen:X,onOpen:Q,onClose:se,onToggle:me}=kf({isOpen:y,defaultIsOpen:v,onClose:b,onOpen:q});HQ({enabled:X&&a,ref:z,handler:Ie=>{var ze,Je,tt;const Me=((Je=(ze=Ie.composedPath)==null?void 0:ze.call(Ie))==null?void 0:Je[0])??Ie.target;(tt=J.current)!=null&&tt.contains(Me)||se()}});const pe=Oj({...B,enabled:X||F,placement:I,direction:x}),[le,Le]=D.useState(-1);WQ(z,{focusRef:J,visible:X,shouldFocus:!0});const We=FQ({isOpen:X,ref:z}),[$e,ve]=EEe(t,"menu-button","menu-list"),_e=D.useCallback(()=>{Q(),ue()},[Q,ue]),Ee=D.useRef(new Set([]));D.useEffect(()=>{const Ie=Ee.current;return()=>{Ie.forEach(Me=>clearTimeout(Me)),Ie.clear()}},[]),Nf(()=>{var Ie;X||(Le(-1),(Ie=z.current)==null||Ie.scrollTo(0,0))},[X]),Nf(()=>{X&&le===-1&&ue()},[le,X]),D.useEffect(()=>{var Me;if(!X)return;const Ie=ie.item(le);(Me=Ie==null?void 0:Ie.node)==null||Me.focus({preventScroll:!$.current})},[ie,le,X]);const ke=D.useCallback(()=>{Q(),re()},[re,Q]),we=D.useCallback(()=>{$.current=!0,Q(),fe()},[Q,fe]),be=D.useCallback(()=>{var tt,ut;const Ie=pne(z.current),Me=(tt=z.current)==null?void 0:tt.contains(Ie.activeElement);if(!(X&&!Me))return;const Je=(ut=ie.item(le))==null?void 0:ut.node;Je==null||Je.focus({preventScroll:!$.current})},[X,le,ie]);return{openAndFocusMenu:_e,openAndFocusFirstItem:ke,openAndFocusLastItem:we,onTransitionEnd:be,unstable__animationState:We,descendants:ie,popper:pe,buttonId:$e,menuId:ve,forceUpdate:pe.forceUpdate,orientation:"vertical",isOpen:X,onToggle:me,onOpen:Q,onClose:se,menuRef:z,buttonRef:J,focusedIndex:le,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Le,isLazy:f,lazyBehavior:k,initialFocusRef:l,scrollIntoViewRef:$}}function gxe(n={},t=null){const s=XC(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:y}=s,v=D.useCallback(b=>{const w=b.key,k={Enter:d,ArrowDown:d,ArrowUp:f}[w];k&&(y.current=!0,b.preventDefault(),b.stopPropagation(),k(b))},[d,f,y]);return{...n,ref:Li(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":Zn(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:An(n.onClick,a),onKeyDown:An(n.onKeyDown,v)}}function eV(n){var t;return vxe(n)&&!!((t=n==null?void 0:n.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function _xe(n={},t=null){const s=XC();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:y,menuId:v,isLazy:b,lazyBehavior:w,scrollIntoViewRef:I,unstable__animationState:k}=s,x=uxe(),F=BDe({preventDefault:$=>$.key!==" "&&eV($.target)}),B=D.useCallback($=>{if(!$.currentTarget.contains($.target))return;const ie=$.key,re={Tab:q=>q.preventDefault(),Escape:q=>{q.stopPropagation(),y()},ArrowDown:()=>{I.current=!0;const q=x.nextEnabled(a)??x.firstEnabled();q&&l(q.index)},ArrowUp:()=>{I.current=!0;const q=x.prevEnabled(a)??x.firstEnabled();q&&l(q.index)}}[ie];if(re){$.preventDefault(),re($);return}const fe=F(q=>{const X=FDe(x.values(),q,Q=>{var se;return((se=Q==null?void 0:Q.node)==null?void 0:se.textContent)??""},x.item(a));if(X){const Q=x.indexOf(X.node);l(Q)}});eV($.target)&&fe($)},[x,a,F,y,l,I]),z=D.useRef(!1);f&&(z.current=!0);const J=ZV({wasSelected:z.current,enabled:b,mode:w,isSelected:k.present});return{...n,ref:Li(d,t),children:J?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:An(n.onKeyDown,B)}}function yxe(n={}){const{popper:t,isOpen:s}=XC();return t.getPopperProps({...n,style:{visibility:s?"visible":"hidden",...n.style}})}function Exe(n={},t=null){const{onMouseEnter:s,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:y,isFocusable:v,closeOnSelect:b,type:w,...I}=n,k=XC(),{setFocusedIndex:x,focusedIndex:F,closeOnSelect:B,onClose:z,menuId:J,scrollIntoViewRef:$}=k,ie=D.useRef(null),ue=`${J}-menuitem-${D.useId()}`,{index:re,register:fe}=hxe({disabled:y&&!v}),q=D.useCallback(Le=>{s==null||s(Le),!y&&($.current=!1,x(re))},[x,re,y,s,$]),X=D.useCallback(Le=>{a==null||a(Le),ie.current&&!fxe(ie.current)&&q(Le)},[q,a]),Q=D.useCallback(Le=>{l==null||l(Le),!y&&x(-1)},[x,y,l]),se=D.useCallback(Le=>{d==null||d(Le),eV(Le.currentTarget)&&(b??B)&&z()},[z,d,B,b]),me=D.useCallback(Le=>{f==null||f(Le),x(re)},[x,f,re]),pe=re===F,le=hne({onClick:se,onFocus:me,onMouseEnter:q,onMouseMove:X,onMouseLeave:Q,ref:Li(fe,ie,t),isDisabled:y,isFocusable:v});return{...I,...le,type:w??le.type,id:ue,role:"menuitem",tabIndex:pe?0:-1}}function vxe(n){if(!Sxe(n))return!1;const t=n.ownerDocument.defaultView??window;return n instanceof t.HTMLElement}function Sxe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[bxe,x0]=Ai({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),SN=n=>{const{children:t}=n,s=Qa("Menu",n),a=Fi(n),{direction:l}=D0(),{descendants:d,...f}=mxe({...a,direction:l}),y=D.useMemo(()=>f,[f]),{isOpen:v,onClose:b,forceUpdate:w}=y;return R.jsx(lxe,{value:d,children:R.jsx(pxe,{value:y,children:R.jsx(bxe,{value:s,children:sl(t,{isOpen:v,onClose:b,forceUpdate:w})})})})};SN.displayName="Menu";const Txe=jt((n,t)=>{const s=x0();return R.jsx(Dt.button,{ref:t,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),bN=jt((n,t)=>{const{children:s,as:a,...l}=n,d=gxe(l,t),f=a||Txe;return R.jsx(f,{...d,className:pn("chakra-menu__menu-button",n.className),children:R.jsx(Dt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});bN.displayName="MenuButton";const fne=jt((n,t)=>{const s=x0();return R.jsx(Dt.span,{ref:t,...n,__css:s.command,className:"chakra-menu__command"})});fne.displayName="MenuCommand";const mne=n=>{const{className:t,...s}=n,a=x0();return R.jsx(Dt.hr,{"aria-orientation":"horizontal",className:pn("chakra-menu__divider",t),...s,__css:a.divider})};mne.displayName="MenuDivider";const gne=n=>{const{className:t,children:s,...a}=n,l=x0(),d=D.Children.only(s),f=D.isValidElement(d)?D.cloneElement(d,{focusable:"false","aria-hidden":!0,className:pn("chakra-menu__icon",d.props.className)}):null,y=pn("chakra-menu__icon-wrapper",t);return R.jsx(Dt.span,{className:y,...a,__css:l.icon,children:f})};gne.displayName="MenuIcon";const wxe=jt((n,t)=>{const{type:s,...a}=n,l=x0(),d=a.as||s?s??void 0:"button",f=D.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return R.jsx(Dt.button,{ref:t,type:d,...a,__css:f})}),JS=jt((n,t)=>{const{icon:s,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,...y}=n,v=Exe(y,t),w=s||l?R.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return R.jsxs(wxe,{...v,className:pn("chakra-menu__menuitem",v.className),children:[s&&R.jsx(gne,{fontSize:"0.8em",marginEnd:a,children:s}),w,l&&R.jsx(fne,{marginStart:d,children:l})]})});JS.displayName="MenuItem";const Cxe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},Rxe=Dt(Wf.div),TN=jt(function(t,s){var k;const{rootProps:a,motionProps:l,...d}=t,{isOpen:f,onTransitionEnd:y,unstable__animationState:v}=XC(),b=_xe(d,s),w=yxe(a),I=x0();return R.jsx(Dt.div,{...w,__css:{zIndex:t.zIndex??((k=I.list)==null?void 0:k.zIndex)},children:R.jsx(Rxe,{variants:Cxe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:pn("chakra-menu__menu-list",b.className),onUpdate:y,onAnimationComplete:DQ(v.onComplete,b.onAnimationComplete)})})});TN.displayName="MenuList";var Ixe=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},mS=new WeakMap,hO=new WeakMap,pO={},MM=0,_ne=function(n){return n&&(n.host||_ne(n.parentNode))},Axe=function(n,t){return t.map(function(s){if(n.contains(s))return s;var a=_ne(s);return a&&n.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",n,". Doing nothing"),null)}).filter(function(s){return!!s})},Pxe=function(n,t,s,a){var l=Axe(t,Array.isArray(n)?n:[n]);pO[s]||(pO[s]=new WeakMap);var d=pO[s],f=[],y=new Set,v=new Set(l),b=function(I){!I||y.has(I)||(y.add(I),b(I.parentNode))};l.forEach(b);var w=function(I){!I||v.has(I)||Array.prototype.forEach.call(I.children,function(k){if(y.has(k))w(k);else try{var x=k.getAttribute(a),F=x!==null&&x!=="false",B=(mS.get(k)||0)+1,z=(d.get(k)||0)+1;mS.set(k,B),d.set(k,z),f.push(k),B===1&&F&&hO.set(k,!0),z===1&&k.setAttribute(s,"true"),F||k.setAttribute(a,"true")}catch(J){console.error("aria-hidden: cannot operate on ",k,J)}})};return w(t),y.clear(),MM++,function(){f.forEach(function(I){var k=mS.get(I)-1,x=d.get(I)-1;mS.set(I,k),d.set(I,x),k||(hO.has(I)||I.removeAttribute(a),hO.delete(I)),x||I.removeAttribute(s)}),MM--,MM||(mS=new WeakMap,mS=new WeakMap,hO=new WeakMap,pO={})}},Oxe=function(n,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=Ixe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),Pxe(a,l,s,"aria-hidden")):function(){return null}},kxe=Object.defineProperty,Nxe=(n,t,s)=>t in n?kxe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,Dxe=(n,t,s)=>(Nxe(n,t+"",s),s);class Lxe{constructor(){Dxe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const tV=new Lxe;function yne(n,t){const[s,a]=D.useState(0);return D.useEffect(()=>{const l=n.current;if(l){if(t){const d=tV.add(l);a(d)}return()=>{tV.remove(l),a(0)}}},[t,n]),s}function xxe(n){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:y,onEsc:v}=n,b=D.useRef(null),w=D.useRef(null),[I,k,x]=Uxe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");Mxe(b,t&&f);const F=yne(b,t),B=D.useRef(null),z=D.useCallback(Q=>{B.current=Q.target},[]),J=D.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),d&&(s==null||s()),v==null||v())},[d,s,v]),[$,ie]=D.useState(!1),[ue,re]=D.useState(!1),fe=D.useCallback((Q={},se=null)=>({role:"dialog",...Q,ref:Li(se,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":$?k:void 0,"aria-describedby":ue?x:void 0,onClick:An(Q.onClick,me=>me.stopPropagation())}),[x,ue,I,k,$]),q=D.useCallback(Q=>{Q.stopPropagation(),B.current===Q.target&&tV.isTopModal(b.current)&&(l&&(s==null||s()),y==null||y())},[s,l,y]),X=D.useCallback((Q={},se=null)=>({...Q,ref:Li(se,w),onClick:An(Q.onClick,q),onKeyDown:An(Q.onKeyDown,J),onMouseDown:An(Q.onMouseDown,z)}),[J,z,q]);return{isOpen:t,onClose:s,headerId:k,bodyId:x,setBodyMounted:re,setHeaderMounted:ie,dialogRef:b,overlayRef:w,getDialogProps:fe,getDialogContainerProps:X,index:F}}function Mxe(n,t){const s=n.current;D.useEffect(()=>{if(!(!n.current||!t))return Oxe(n.current)},[t,n,s])}function Uxe(n,...t){const s=D.useId(),a=n||s;return D.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[Vxe,M0]=Ai({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[Fxe,Ny]=Ai({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Mo=n=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:x,animatePresenceProps:F,onCloseComplete:B}=t,z=Qa("Modal",t),$={...xxe(t),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:x};return R.jsx(Fxe,{value:$,children:R.jsx(Vxe,{value:z,children:R.jsx(O0,{...F,onExitComplete:B,children:$.isOpen&&R.jsx(Mu,{...s,children:a})})})})};Mo.displayName="Modal";var $O="right-scroll-bar-position",KO="width-before-scroll-bar",jxe="with-scroll-bars-hidden",Bxe="--removed-body-scroll-bar-size",Ene=wte(),UM=function(){},wN=D.forwardRef(function(n,t){var s=D.useRef(null),a=D.useState({onScrollCapture:UM,onWheelCapture:UM,onTouchMoveCapture:UM}),l=a[0],d=a[1],f=n.forwardProps,y=n.children,v=n.className,b=n.removeScrollBar,w=n.enabled,I=n.shards,k=n.sideCar,x=n.noIsolation,F=n.inert,B=n.allowPinchZoom,z=n.as,J=z===void 0?"div":z,$=n.gapMode,ie=KC(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ue=k,re=Ste([s,t]),fe=jh(jh({},ie),l);return D.createElement(D.Fragment,null,w&&D.createElement(ue,{sideCar:Ene,removeScrollBar:b,shards:I,noIsolation:x,inert:F,setCallbacks:d,allowPinchZoom:!!B,lockRef:s,gapMode:$}),f?D.cloneElement(D.Children.only(y),jh(jh({},fe),{ref:re})):D.createElement(J,jh({},fe,{className:v,ref:re}),y))});wN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};wN.classNames={fullWidth:KO,zeroRight:$O};var Wxe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function zxe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=Wxe();return t&&n.setAttribute("nonce",t),n}function Gxe(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function Hxe(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var $xe=function(){var n=0,t=null;return{add:function(s){n==0&&(t=zxe())&&(Gxe(t,s),Hxe(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Kxe=function(){var n=$xe();return function(t,s){D.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&s])}},vne=function(){var n=Kxe(),t=function(s){var a=s.styles,l=s.dynamic;return n(a,l),null};return t},qxe={left:0,top:0,right:0,gap:0},VM=function(n){return parseInt(n||"",10)||0},Yxe=function(n){var t=window.getComputedStyle(document.body),s=t[n==="padding"?"paddingLeft":"marginLeft"],a=t[n==="padding"?"paddingTop":"marginTop"],l=t[n==="padding"?"paddingRight":"marginRight"];return[VM(s),VM(a),VM(l)]},Xxe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return qxe;var t=Yxe(n),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},Jxe=vne(),QS="data-scroll-locked",Qxe=function(n,t,s,a){var l=n.left,d=n.top,f=n.right,y=n.gap;return s===void 0&&(s="margin"),`
  .`.concat(jxe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(y,"px ").concat(a,`;
  }
  body[`).concat(QS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(y,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat($O,` {
    right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(KO,` {
    margin-right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat($O," .").concat($O,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(KO," .").concat(KO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(QS,`] {
    `).concat(Bxe,": ").concat(y,`px;
  }
`)},jY=function(){var n=parseInt(document.body.getAttribute(QS)||"0",10);return isFinite(n)?n:0},Zxe=function(){D.useEffect(function(){return document.body.setAttribute(QS,(jY()+1).toString()),function(){var n=jY()-1;n<=0?document.body.removeAttribute(QS):document.body.setAttribute(QS,n.toString())}},[])},e2e=function(n){var t=n.noRelative,s=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;Zxe();var d=D.useMemo(function(){return Xxe(l)},[l]);return D.createElement(Jxe,{styles:Qxe(d,!t,l,s?"":"!important")})},nV=!1;if(typeof window<"u")try{var fO=Object.defineProperty({},"passive",{get:function(){return nV=!0,!0}});window.addEventListener("test",fO,fO),window.removeEventListener("test",fO,fO)}catch{nV=!1}var gS=nV?{passive:!1}:!1,t2e=function(n){return n.tagName==="TEXTAREA"},Sne=function(n,t){if(!(n instanceof Element))return!1;var s=window.getComputedStyle(n);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!t2e(n)&&s[t]==="visible")},n2e=function(n){return Sne(n,"overflowY")},r2e=function(n){return Sne(n,"overflowX")},BY=function(n,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=bne(n,a);if(l){var d=Tne(n,a),f=d[1],y=d[2];if(f>y)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},i2e=function(n){var t=n.scrollTop,s=n.scrollHeight,a=n.clientHeight;return[t,s,a]},s2e=function(n){var t=n.scrollLeft,s=n.scrollWidth,a=n.clientWidth;return[t,s,a]},bne=function(n,t){return n==="v"?n2e(t):r2e(t)},Tne=function(n,t){return n==="v"?i2e(t):s2e(t)},o2e=function(n,t){return n==="h"&&t==="rtl"?-1:1},a2e=function(n,t,s,a,l){var d=o2e(n,window.getComputedStyle(t).direction),f=d*a,y=s.target,v=t.contains(y),b=!1,w=f>0,I=0,k=0;do{var x=Tne(n,y),F=x[0],B=x[1],z=x[2],J=B-z-d*F;(F||J)&&bne(n,y)&&(I+=J,k+=F),y instanceof ShadowRoot?y=y.host:y=y.parentNode}while(!v&&y!==document.body||v&&(t.contains(y)||t===y));return(w&&Math.abs(I)<1||!w&&Math.abs(k)<1)&&(b=!0),b},mO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},WY=function(n){return[n.deltaX,n.deltaY]},zY=function(n){return n&&"current"in n?n.current:n},c2e=function(n,t){return n[0]===t[0]&&n[1]===t[1]},l2e=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},u2e=0,_S=[];function d2e(n){var t=D.useRef([]),s=D.useRef([0,0]),a=D.useRef(),l=D.useState(u2e++)[0],d=D.useState(vne)[0],f=D.useRef(n);D.useEffect(function(){f.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=_1e([n.lockRef.current],(n.shards||[]).map(zY),!0).filter(Boolean);return B.forEach(function(z){return z.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(z){return z.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=D.useCallback(function(B,z){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!f.current.allowPinchZoom;var J=mO(B),$=s.current,ie="deltaX"in B?B.deltaX:$[0]-J[0],ue="deltaY"in B?B.deltaY:$[1]-J[1],re,fe=B.target,q=Math.abs(ie)>Math.abs(ue)?"h":"v";if("touches"in B&&q==="h"&&fe.type==="range")return!1;var X=BY(q,fe);if(!X)return!0;if(X?re=q:(re=q==="v"?"h":"v",X=BY(q,fe)),!X)return!1;if(!a.current&&"changedTouches"in B&&(ie||ue)&&(a.current=re),!re)return!0;var Q=a.current||re;return a2e(Q,z,B,Q==="h"?ie:ue)},[]),v=D.useCallback(function(B){var z=B;if(!(!_S.length||_S[_S.length-1]!==d)){var J="deltaY"in z?WY(z):mO(z),$=t.current.filter(function(re){return re.name===z.type&&(re.target===z.target||z.target===re.shadowParent)&&c2e(re.delta,J)})[0];if($&&$.should){z.cancelable&&z.preventDefault();return}if(!$){var ie=(f.current.shards||[]).map(zY).filter(Boolean).filter(function(re){return re.contains(z.target)}),ue=ie.length>0?y(z,ie[0]):!f.current.noIsolation;ue&&z.cancelable&&z.preventDefault()}}},[]),b=D.useCallback(function(B,z,J,$){var ie={name:B,delta:z,target:J,should:$,shadowParent:h2e(J)};t.current.push(ie),setTimeout(function(){t.current=t.current.filter(function(ue){return ue!==ie})},1)},[]),w=D.useCallback(function(B){s.current=mO(B),a.current=void 0},[]),I=D.useCallback(function(B){b(B.type,WY(B),B.target,y(B,n.lockRef.current))},[]),k=D.useCallback(function(B){b(B.type,mO(B),B.target,y(B,n.lockRef.current))},[]);D.useEffect(function(){return _S.push(d),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:k}),document.addEventListener("wheel",v,gS),document.addEventListener("touchmove",v,gS),document.addEventListener("touchstart",w,gS),function(){_S=_S.filter(function(B){return B!==d}),document.removeEventListener("wheel",v,gS),document.removeEventListener("touchmove",v,gS),document.removeEventListener("touchstart",w,gS)}},[]);var x=n.removeScrollBar,F=n.inert;return D.createElement(D.Fragment,null,F?D.createElement(d,{styles:l2e(l)}):null,x?D.createElement(e2e,{gapMode:n.gapMode}):null)}function h2e(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const p2e=y1e(Ene,d2e);var wne=D.forwardRef(function(n,t){return D.createElement(wN,jh({},n,{ref:t,sideCar:p2e}))});wne.classNames=wN.classNames;function f2e(n){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:y,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:w,isOpen:I}=Ny(),[k,x]=TF();D.useEffect(()=>{!k&&x&&setTimeout(x)},[k,x]);const F=yne(a,I);return R.jsx(Jte,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:y,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:R.jsx(wne,{removeScrollBar:!b,allowPinchZoom:f,enabled:F===1&&d,forwardProps:!0,children:n.children})})}const m2e={initial:({offsetX:n,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:t,transition:(s==null?void 0:s.exit)??by.exit(Sy.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??by.enter(Sy.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:n,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const f={x:t,y:n};return{opacity:0,transition:(s==null?void 0:s.exit)??by.exit(Sy.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},Lw={initial:"initial",animate:"enter",exit:"exit",variants:m2e},g2e=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:y=0,offsetY:v=8,transition:b,transitionEnd:w,delay:I,animatePresenceProps:k,...x}=t,F=a?l&&a:!0,B=l||a?"enter":"exit",z={offsetX:y,offsetY:v,reverse:d,transition:b,transitionEnd:w,delay:I};return R.jsx(O0,{...k,custom:z,children:F&&R.jsx(Wf.div,{ref:s,className:pn("chakra-offset-slide",f),custom:z,...Lw,animate:B,...x})})});g2e.displayName="SlideFade";const _2e={exit:({reverse:n,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??by.exit(Sy.exit,l)}),enter:({transitionEnd:n,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??by.enter(Sy.enter,s),transitionEnd:n==null?void 0:n.enter})},Cne={initial:"exit",animate:"enter",exit:"exit",variants:_2e},y2e=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:y,transition:v,transitionEnd:b,delay:w,animatePresenceProps:I,...k}=t,x=a?l&&a:!0,F=l||a?"enter":"exit",B={initialScale:f,reverse:d,transition:v,transitionEnd:b,delay:w};return R.jsx(O0,{...I,custom:B,children:x&&R.jsx(Wf.div,{ref:s,className:pn("chakra-offset-slide",y),...Cne,animate:F,custom:B,...k})})});y2e.displayName="ScaleFade";const E2e={slideInBottom:{...Lw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Lw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Lw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Lw,custom:{offsetX:-16,reverse:!0}},scale:{...Cne,custom:{initialScale:.95,reverse:!0}},none:{}},v2e=Dt(Wf.section),S2e=n=>E2e[n||"none"],Rne=D.forwardRef((n,t)=>{const{preset:s,motionProps:a=S2e(s),...l}=n;return R.jsx(v2e,{ref:t,...a,...l})});Rne.displayName="ModalTransition";const Uo=jt((n,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...f}=n,{getDialogProps:y,getDialogContainerProps:v}=Ny(),b=y(f,t),w=v(l),I=pn("chakra-modal__content",s),k=M0(),x={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...k.dialog},F={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...k.dialogContainer},{motionPreset:B}=Ny();return R.jsx(f2e,{children:R.jsx(Dt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:F,children:R.jsx(Rne,{preset:B,motionProps:d,className:I,...b,__css:x,children:a})})})});Uo.displayName="ModalContent";const Vo=jt((n,t)=>{const{className:s,...a}=n,{bodyId:l,setBodyMounted:d}=Ny();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=pn("chakra-modal__body",s),y=M0();return R.jsx(Dt.div,{ref:t,className:f,id:l,...a,__css:y.body})});Vo.displayName="ModalBody";const _a=jt((n,t)=>{const{onClick:s,className:a,...l}=n,{onClose:d}=Ny(),f=pn("chakra-modal__close-btn",a),y=M0();return R.jsx(rj,{ref:t,__css:y.closeButton,className:f,onClick:An(s,v=>{v.stopPropagation(),d()}),...l})});_a.displayName="ModalCloseButton";const Mf=jt((n,t)=>{const{className:s,...a}=n,l=pn("chakra-modal__footer",s),d=M0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return R.jsx(Dt.footer,{ref:t,...a,__css:f,className:l})});Mf.displayName="ModalFooter";const Sc=jt((n,t)=>{const{className:s,...a}=n,{headerId:l,setHeaderMounted:d}=Ny();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=pn("chakra-modal__header",s),y=M0(),v={flex:0,...y.header};return R.jsx(Dt.header,{ref:t,className:f,id:l,...a,__css:v})});Sc.displayName="ModalHeader";const b2e={enter:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??by.enter(Sy.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??by.exit(Sy.exit,s),transitionEnd:t==null?void 0:t.exit})},Ine={initial:"exit",animate:"enter",exit:"exit",variants:b2e},T2e=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:y,delay:v,animatePresenceProps:b,...w}=t,I=l||a?"enter":"exit",k=a?l&&a:!0,x={transition:f,transitionEnd:y,delay:v};return R.jsx(O0,{...b,custom:x,children:k&&R.jsx(Wf.div,{ref:s,className:pn("chakra-fade",d),custom:x,...Ine,animate:I,...w})})});T2e.displayName="Fade";const w2e=Dt(Wf.div),Fo=jt((n,t)=>{const{className:s,transition:a,motionProps:l,...d}=n,f=pn("chakra-modal__overlay",s),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...M0().overlay},{motionPreset:b}=Ny(),I=l||(b==="none"?{}:Ine);return R.jsx(w2e,{...I,__css:v,ref:t,className:f,...d})});Fo.displayName="ModalOverlay";function C2e(n){const{leastDestructiveRef:t,...s}=n;return R.jsx(Mo,{...s,initialFocusRef:t})}const R2e=jt((n,t)=>R.jsx(Uo,{ref:t,role:"alertdialog",...n})),I2e=n=>R.jsx(In,{viewBox:"0 0 24 24",...n,children:R.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),A2e=n=>R.jsx(In,{viewBox:"0 0 24 24",...n,children:R.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function GY(n,t,s,a){D.useEffect(()=>{if(!n.current||!a)return;const l=n.current.ownerDocument.defaultView??window,d=Array.isArray(t)?t:[t],f=new l.MutationObserver(y=>{for(const v of y)v.type==="attributes"&&v.attributeName&&d.includes(v.attributeName)&&s(v)});return f.observe(n.current,{attributes:!0,attributeFilter:d}),()=>f.disconnect()})}const P2e=50,HY=300;function O2e(n,t){const[s,a]=D.useState(!1),[l,d]=D.useState(null),[f,y]=D.useState(!0),v=D.useRef(null),b=()=>clearTimeout(v.current);vEe(()=>{l==="increment"&&n(),l==="decrement"&&t()},s?P2e:null);const w=D.useCallback(()=>{f&&n(),v.current=setTimeout(()=>{y(!1),a(!0),d("increment")},HY)},[n,f]),I=D.useCallback(()=>{f&&t(),v.current=setTimeout(()=>{y(!1),a(!0),d("decrement")},HY)},[t,f]),k=D.useCallback(()=>{y(!0),a(!1),b()},[]);return D.useEffect(()=>()=>b(),[]),{up:w,down:I,stop:k,isSpinning:s}}const k2e=/^[Ee0-9+\-.]$/;function N2e(n){return k2e.test(n)}function D2e(n,t){if(n.key==null)return!0;const s=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||s?!0:t(n.key)}function L2e(n={}){const{focusInputOnChange:t=!0,clampValueOnBlur:s=!0,keepWithinRange:a=!0,min:l=Number.MIN_SAFE_INTEGER,max:d=Number.MAX_SAFE_INTEGER,step:f=1,isReadOnly:y,isDisabled:v,isRequired:b,isInvalid:w,pattern:I="[0-9]*(.[0-9]+)?",inputMode:k="decimal",allowMouseWheel:x,id:F,onChange:B,precision:z,name:J,"aria-describedby":$,"aria-label":ie,"aria-labelledby":ue,onFocus:re,onBlur:fe,onInvalid:q,getAriaValueText:X,isValidCharacter:Q,format:se,parse:me,...pe}=n,le=Hs(re),Le=Hs(fe),We=Hs(q),$e=Hs(Q??N2e),ve=Hs(X),_e=oEe(n),{update:Ee,increment:ke,decrement:we}=_e,[be,Ie]=D.useState(!1),Me=!(y||v),ze=D.useRef(null),Je=D.useRef(null),tt=D.useRef(null),ut=D.useRef(null),Ze=D.useCallback(bt=>bt.split("").filter($e).join(""),[$e]),vt=D.useCallback(bt=>(me==null?void 0:me(bt))??bt,[me]),sn=D.useCallback(bt=>((se==null?void 0:se(bt))??bt).toString(),[se]);Nf(()=>{(_e.valueAsNumber>d||_e.valueAsNumber<l)&&(We==null||We("rangeOverflow",sn(_e.value),_e.valueAsNumber))},[_e.valueAsNumber,_e.value,sn,We]),$h(()=>{if(!ze.current)return;if(ze.current.value!=_e.value){const lr=vt(ze.current.value);_e.setValue(Ze(lr))}},[vt,Ze]);const Mt=D.useCallback((bt=f)=>{Me&&ke(bt)},[ke,Me,f]),Qt=D.useCallback((bt=f)=>{Me&&we(bt)},[we,Me,f]),on=O2e(Mt,Qt);GY(tt,"disabled",on.stop,on.isSpinning),GY(ut,"disabled",on.stop,on.isSpinning);const Ht=D.useCallback(bt=>{if(bt.nativeEvent.isComposing)return;const Nt=vt(bt.currentTarget.value);Ee(Ze(Nt)),Je.current={start:bt.currentTarget.selectionStart,end:bt.currentTarget.selectionEnd}},[Ee,Ze,vt]),jn=D.useCallback(bt=>{var lr;le==null||le(bt),Je.current&&(bt.currentTarget.selectionStart=Je.current.start??((lr=bt.currentTarget.value)==null?void 0:lr.length),bt.currentTarget.selectionEnd=Je.current.end??bt.currentTarget.selectionStart)},[le]),Wt=D.useCallback(bt=>{if(bt.nativeEvent.isComposing)return;D2e(bt,$e)||bt.preventDefault();const lr=Re(bt)*f,Nt=bt.key,qr={ArrowUp:()=>Mt(lr),ArrowDown:()=>Qt(lr),Home:()=>Ee(l),End:()=>Ee(d)}[Nt];qr&&(bt.preventDefault(),qr(bt))},[$e,f,Mt,Qt,Ee,l,d]),Re=bt=>{let lr=1;return(bt.metaKey||bt.ctrlKey)&&(lr=.1),bt.shiftKey&&(lr=10),lr},Fe=D.useMemo(()=>{const bt=ve==null?void 0:ve(_e.value);if(bt!=null)return bt;const lr=_e.value.toString();return lr||void 0},[_e.value,ve]),Ge=D.useCallback(()=>{let bt=_e.value;if(_e.value==="")return;/^[eE]/.test(_e.value.toString())?_e.setValue(""):(_e.valueAsNumber<l&&(bt=l),_e.valueAsNumber>d&&(bt=d),_e.cast(bt))},[_e,d,l]),ot=D.useCallback(()=>{Ie(!1),s&&Ge()},[s,Ie,Ge]),_t=D.useCallback(()=>{t&&requestAnimationFrame(()=>{var bt;(bt=ze.current)==null||bt.focus()})},[t]),yt=D.useCallback(bt=>{bt.preventDefault(),on.up(),_t()},[_t,on]),Gt=D.useCallback(bt=>{bt.preventDefault(),on.down(),_t()},[_t,on]);gy(()=>ze.current,"wheel",bt=>{var ji;const Nt=(((ji=ze.current)==null?void 0:ji.ownerDocument)??document).activeElement===ze.current;if(!x||!Nt)return;bt.preventDefault();const Kt=Re(bt)*f,qr=Math.sign(bt.deltaY);qr===-1?Mt(Kt):qr===1&&Qt(Kt)},{passive:!1});const mn=D.useCallback((bt={},lr=null)=>{const Nt=v||a&&_e.isAtMax;return{...bt,ref:Li(lr,tt),role:"button",tabIndex:-1,onPointerDown:An(bt.onPointerDown,Kt=>{Kt.button!==0||Nt||yt(Kt)}),onPointerLeave:An(bt.onPointerLeave,on.stop),onPointerUp:An(bt.onPointerUp,on.stop),disabled:Nt,"aria-disabled":wf(Nt)}},[_e.isAtMax,a,yt,on.stop,v]),Pn=D.useCallback((bt={},lr=null)=>{const Nt=v||a&&_e.isAtMin;return{...bt,ref:Li(lr,ut),role:"button",tabIndex:-1,onPointerDown:An(bt.onPointerDown,Kt=>{Kt.button!==0||Nt||Gt(Kt)}),onPointerLeave:An(bt.onPointerLeave,on.stop),onPointerUp:An(bt.onPointerUp,on.stop),disabled:Nt,"aria-disabled":wf(Nt)}},[_e.isAtMin,a,Gt,on.stop,v]),un=D.useCallback((bt={},lr=null)=>({name:J,inputMode:k,type:"text",pattern:I,"aria-labelledby":ue,"aria-label":ie,"aria-describedby":$,id:F,disabled:v,role:"spinbutton",...bt,readOnly:bt.readOnly??y,"aria-readonly":bt.readOnly??y,"aria-required":bt.required??b,required:bt.required??b,ref:Li(ze,lr),value:sn(_e.value),"aria-valuemin":l,"aria-valuemax":d,"aria-valuenow":Number.isNaN(_e.valueAsNumber)?void 0:_e.valueAsNumber,"aria-invalid":wf(w??_e.isOutOfRange),"aria-valuetext":Fe,autoComplete:"off",autoCorrect:"off",onChange:An(bt.onChange,Ht),onKeyDown:An(bt.onKeyDown,Wt),onFocus:An(bt.onFocus,jn,()=>Ie(!0)),onBlur:An(bt.onBlur,Le,ot)}),[J,k,I,ue,ie,sn,$,F,v,b,y,w,_e.value,_e.valueAsNumber,_e.isOutOfRange,l,d,Fe,Ht,Wt,jn,Le,ot]);return{value:sn(_e.value),valueAsNumber:_e.valueAsNumber,isFocused:be,isDisabled:v,isReadOnly:y,getIncrementButtonProps:mn,getDecrementButtonProps:Pn,getInputProps:un,htmlProps:pe}}const[x2e,CN]=Ai({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[M2e,kj]=Ai({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),qO=jt(function(t,s){const a=Qa("NumberInput",t),l=Fi(t),d=aj(l),{htmlProps:f,...y}=L2e(d),v=D.useMemo(()=>y,[y]);return R.jsx(M2e,{value:v,children:R.jsx(x2e,{value:a,children:R.jsx(Dt.div,{...f,ref:s,className:pn("chakra-numberinput",t.className),__css:{position:"relative",zIndex:0,...a.root}})})})});qO.displayName="NumberInput";const YO=jt(function(t,s){const a=CN();return R.jsx(Dt.div,{"aria-hidden":!0,ref:s,...t,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...a.stepperGroup}})});YO.displayName="NumberInputStepper";const XO=jt(function(t,s){const{getInputProps:a}=kj(),l=a(t,s),d=CN();return R.jsx(Dt.input,{...l,className:pn("chakra-numberinput__field",t.className),__css:{width:"100%",...d.field}})});XO.displayName="NumberInputField";const Ane=Dt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),JO=jt(function(t,s){const a=CN(),{getDecrementButtonProps:l}=kj(),d=l(t,s);return R.jsx(Ane,{...d,__css:a.stepper,children:t.children??R.jsx(I2e,{})})});JO.displayName="NumberDecrementStepper";const QO=jt(function(t,s){const{getIncrementButtonProps:a}=kj(),l=a(t,s),d=CN();return R.jsx(Ane,{...l,__css:d.stepper,children:t.children??R.jsx(A2e,{})})});QO.displayName="NumberIncrementStepper";const[U2e,RN]=Ai({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[V2e,Pne]=Ai({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),yS={click:"click",hover:"hover"};function F2e(n={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:y,arrowShadowColor:v,trigger:b=yS.click,openDelay:w=200,closeDelay:I=200,isLazy:k,lazyBehavior:x="unmount",computePositionOnMount:F,...B}=n,{isOpen:z,onClose:J,onOpen:$,onToggle:ie}=kf(n),[ue,re]=D.useState(d);D.useEffect(()=>re(d),[d]);const fe=D.useRef(null),q=D.useRef(null),X=D.useRef(null),Q=D.useRef(!1),se=D.useRef(!1);z&&(se.current=!0);const[me,pe]=D.useState(!1),[le,Le]=D.useState(!1),We=D.useId(),$e=l??We,[ve,_e,Ee,ke]=["popover-trigger","popover-content","popover-header","popover-body"].map(Wt=>`${Wt}-${$e}`),{referenceRef:we,getArrowProps:be,getPopperProps:Ie,getArrowInnerProps:Me,forceUpdate:ze}=Oj({...B,enabled:z||!!F}),Je=FQ({isOpen:z,ref:X});_Ee({enabled:z,ref:q}),WQ(X,{focusRef:q,visible:z,shouldFocus:ue&&b===yS.click}),lEe(X,{focusRef:a,visible:z,shouldFocus:f&&b===yS.click}),HQ({enabled:z&&t,ref:X,handler(Wt){var Fe;const Re=((Fe=Wt.composedPath)==null?void 0:Fe.call(Wt)[0])??[Wt.target];gO(q.current,Re)||(Re&&re(!fk(Re)),J())}});const tt=ZV({wasSelected:se.current,enabled:k,mode:x,isSelected:Je.present}),ut=D.useCallback((Wt={},Re=null)=>{const Fe={...Wt,style:{...Wt.style,transformOrigin:to.transformOrigin.varRef,[to.arrowSize.var]:y?`${y}px`:void 0,[to.arrowShadowColor.var]:v},ref:Li(X,Re),children:tt?Wt.children:null,id:_e,tabIndex:-1,role:"dialog",onKeyDown:An(Wt.onKeyDown,Ge=>{Ge.nativeEvent.isComposing||s&&Ge.key==="Escape"&&(Ge.preventDefault(),Ge.stopPropagation(),J())}),onBlur:An(Wt.onBlur,Ge=>{const ot=$Y(Ge),_t=gO(X.current,ot),yt=gO(q.current,ot),Gt=!_t&&!yt;ot&&re(!fk(ot)),z&&t&&Gt&&J()}),"aria-labelledby":me?Ee:void 0,"aria-describedby":le?ke:void 0};return b===yS.hover&&(Fe.role="tooltip",Fe.onMouseEnter=An(Wt.onMouseEnter,()=>{Q.current=!0}),Fe.onMouseLeave=An(Wt.onMouseLeave,Ge=>{Ge.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>J(),I))})),Fe},[tt,_e,me,Ee,le,ke,b,s,J,z,t,I,v,y]),Ze=D.useCallback((Wt={},Re=null)=>Ie({...Wt,style:{visibility:z?"visible":"hidden",...Wt.style}},Re),[z,Ie]),vt=D.useCallback((Wt,Re=null)=>({...Wt,ref:Li(Re,fe,we)}),[fe,we]),sn=D.useRef(void 0),Mt=D.useRef(void 0),Qt=D.useCallback(Wt=>{fe.current==null&&we(Wt)},[we]),on=D.useCallback((Wt={},Re=null)=>{const Fe={...Wt,ref:Li(q,Re,Qt),id:ve,"aria-haspopup":"dialog","aria-expanded":z,"aria-controls":_e};return b===yS.click&&(Fe.onClick=An(Wt.onClick,ie)),b===yS.hover&&(Fe.onFocus=An(Wt.onFocus,()=>{sn.current===void 0&&$()}),Fe.onBlur=An(Wt.onBlur,Ge=>{const ot=$Y(Ge),_t=!gO(X.current,ot);z&&t&&_t&&J()}),Fe.onKeyDown=An(Wt.onKeyDown,Ge=>{Ge.key==="Escape"&&J()}),Fe.onMouseEnter=An(Wt.onMouseEnter,()=>{Q.current=!0,sn.current=window.setTimeout(()=>$(),w)}),Fe.onMouseLeave=An(Wt.onMouseLeave,()=>{Q.current=!1,sn.current&&(clearTimeout(sn.current),sn.current=void 0),Mt.current=window.setTimeout(()=>{Q.current===!1&&J()},I)})),Fe},[ve,z,_e,b,Qt,ie,$,t,J,w,I]);D.useEffect(()=>()=>{sn.current&&clearTimeout(sn.current),Mt.current&&clearTimeout(Mt.current)},[]);const Ht=D.useCallback((Wt={},Re=null)=>({...Wt,id:Ee,ref:Li(Re,Fe=>{pe(!!Fe)})}),[Ee]),jn=D.useCallback((Wt={},Re=null)=>({...Wt,id:ke,ref:Li(Re,Fe=>{Le(!!Fe)})}),[ke]);return{forceUpdate:ze,isOpen:z,onAnimationComplete:Je.onComplete,onClose:J,getAnchorProps:vt,getArrowProps:be,getArrowInnerProps:Me,getPopoverPositionerProps:Ze,getPopoverProps:ut,getTriggerProps:on,getHeaderProps:Ht,getBodyProps:jn}}function gO(n,t){return n===t||(n==null?void 0:n.contains(t))}function $Y(n){const t=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??t}function One(n){const t=Qa("Popover",n),{children:s,...a}=Fi(n),l=D0(),d=F2e({...a,direction:l.direction});return R.jsx(U2e,{value:d,children:R.jsx(V2e,{value:t,children:sl(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}One.displayName="Popover";function kne(n){var s;const t=D.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(s=n==null?void 0:n.props)==null?void 0:s.ref}const Nne=jt(function(t,s){const{getBodyProps:a}=RN(),l=Pne();return R.jsx(Dt.div,{...a(t,s),className:pn("chakra-popover__body",t.className),__css:l.body})});Nne.displayName="PopoverBody";function j2e(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const B2e={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},W2e=Dt(Wf.section),Dne=jt(function(t,s){const{variants:a=B2e,...l}=t,{isOpen:d}=RN();return R.jsx(W2e,{ref:s,variants:j2e(a),initial:!1,animate:d?"enter":"exit",...l})});Dne.displayName="PopoverTransition";const Lne=jt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:f,getPopoverPositionerProps:y,onAnimationComplete:v}=RN(),b=Pne(),w={position:"relative",display:"flex",flexDirection:"column",...b.content};return R.jsx(Dt.div,{...y(a),__css:b.popper,className:"chakra-popover__popper",children:R.jsx(Dne,{...l,...f(d,s),onAnimationComplete:DQ(v,d.onAnimationComplete),className:pn("chakra-popover__content",t.className),__css:w})})});Lne.displayName="PopoverContent";function xne(n){const t=D.Children.only(n.children),{getTriggerProps:s}=RN();return R.jsx(R.Fragment,{children:D.cloneElement(t,s(t.props,kne(t)))})}xne.displayName="PopoverTrigger";function z2e(n,t,s){return(n-t)*100/(s-t)}jC({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});jC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const G2e=jC({"0%":{left:"-40%"},"100%":{left:"100%"}}),H2e=jC({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function $2e(n){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:y="progressbar"}=n,v=z2e(t,s,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":f?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:y},percent:v,value:t}}const[K2e,q2e]=Ai({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),Y2e=jt((n,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:f,...y}=n,v=$2e({value:l,min:s,max:a,isIndeterminate:d,role:f}),w={height:"100%",...q2e().filledTrack};return R.jsx(Dt.div,{ref:t,style:{width:`${v.percent}%`,...y.style},...v.bind,...y,__css:w})}),g0=jt((n,t)=>{var q;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:y,borderRadius:v,isIndeterminate:b,"aria-label":w,"aria-labelledby":I,"aria-valuetext":k,title:x,role:F,...B}=Fi(n),z=Qa("Progress",n),J=v??((q=z.track)==null?void 0:q.borderRadius),$={animation:`${H2e} 1s linear infinite`},re={...!b&&d&&f&&$,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${G2e} 1s ease infinite normal none running`}},fe={overflow:"hidden",position:"relative",...z.track};return R.jsx(Dt.div,{ref:t,borderRadius:J,__css:fe,...B,children:R.jsxs(K2e,{value:z,children:[R.jsx(Y2e,{"aria-label":w,"aria-labelledby":I,"aria-valuetext":k,min:a,max:l,value:s,isIndeterminate:b,css:re,borderRadius:J,title:x,role:F}),y]})})});g0.displayName="Progress";const Mne=jt(function(t,s){const{children:a,placeholder:l,className:d,...f}=t;return R.jsxs(Dt.select,{...f,ref:s,className:pn("chakra-select",d),children:[l&&R.jsx("option",{value:"",children:l}),a]})});Mne.displayName="SelectField";const Une=jt((n,t)=>{var ie;const s=Qa("Select",n),{rootProps:a,placeholder:l,icon:d,color:f,height:y,h:v,minH:b,minHeight:w,iconColor:I,iconSize:k,...x}=Fi(n),[F,B]=Zye(x,yve),z=oj(B),J={width:"100%",height:"fit-content",position:"relative",color:f},$={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(ie=s.field)==null?void 0:ie._focus}};return R.jsxs(Dt.div,{className:"chakra-select__wrapper",__css:J,...F,...a,children:[R.jsx(Mne,{ref:t,height:v??y,minH:b??w,placeholder:l,...z,__css:$,children:n.children}),R.jsx(Vne,{"data-disabled":Zn(z.disabled),...(I||f)&&{color:I||f},__css:s.icon,...k&&{fontSize:k},children:d})]})});Une.displayName="Select";const X2e=n=>R.jsx("svg",{viewBox:"0 0 24 24",...n,children:R.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),J2e=Dt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Vne=n=>{const{children:t=R.jsx(X2e,{}),...s}=n,a=D.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return R.jsx(J2e,{...s,className:"chakra-select__icon-wrapper",children:D.isValidElement(t)?a:null})};Vne.displayName="SelectIcon";function FM(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function Q2e(n){const{orientation:t,thumbPercents:s,isReversed:a}=n,l=x=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...FM({orientation:t,vertical:{bottom:`calc(${s[x]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[x]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...FM({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=s.length===1,v=[0,a?100-s[0]:s[0]],b=y?v:s;let w=b[0];!y&&a&&(w=100-w);const I=Math.abs(b[b.length-1]-b[0]),k={...f,...FM({orientation:t,vertical:a?{height:`${I}%`,top:`${w}%`}:{height:`${I}%`,bottom:`${w}%`},horizontal:a?{width:`${I}%`,right:`${w}%`}:{width:`${I}%`,left:`${w}%`}})};return{trackStyle:f,innerTrackStyle:k,rootStyle:d,getThumbStyle:l}}function Z2e(n){const{isReversed:t,direction:s,orientation:a}=n;return s==="ltr"||a==="vertical"?t:!t}function eMe(n){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:y="ltr",orientation:v="horizontal",id:b,isDisabled:w,isReadOnly:I,onChangeStart:k,onChangeEnd:x,step:F=1,getAriaValueText:B,"aria-valuetext":z,"aria-label":J,"aria-labelledby":$,name:ie,focusThumbOnChange:ue=!0,...re}=n,fe=Hs(k),q=Hs(x),X=Hs(B),Q=Z2e({isReversed:f,direction:y,orientation:v}),[se,me]=jQ({value:l,defaultValue:d??nMe(t,s),onChange:a}),[pe,le]=D.useState(!1),[Le,We]=D.useState(!1),$e=!(w||I),ve=(s-t)/10,_e=F||(s-t)/100,Ee=PO(se,t,s),ke=s-Ee+t,be=Q$(Q?ke:Ee,t,s),Ie=v==="vertical",Me=GQ({min:t,max:s,step:F,isDisabled:w,value:Ee,isInteractive:$e,isReversed:Q,isVertical:Ie,eventSource:null,focusThumbOnChange:ue,orientation:v}),ze=D.useRef(null),Je=D.useRef(null),tt=D.useRef(null),ut=D.useId(),Ze=b??ut,[vt,sn]=[`slider-thumb-${Ze}`,`slider-track-${Ze}`],Mt=D.useCallback(Nt=>{var xi;if(!ze.current)return;const Kt=Me.current;Kt.eventSource="pointer";const qr=ze.current.getBoundingClientRect(),{clientX:ji,clientY:Ms}=((xi=Nt.touches)==null?void 0:xi[0])??Nt,ii=Ie?qr.bottom-Ms:ji-qr.left,Ot=Ie?qr.height:qr.width;let On=ii/Ot;Q&&(On=1-On);let or=Yye(On,Kt.min,Kt.max);return Kt.step&&(or=parseFloat(Z$(or,Kt.min,Kt.step))),or=PO(or,Kt.min,Kt.max),or},[Ie,Q,Me]),Qt=D.useCallback(Nt=>{const Kt=Me.current;Kt.isInteractive&&(Nt=parseFloat(Z$(Nt,Kt.min,_e)),Nt=PO(Nt,Kt.min,Kt.max),me(Nt))},[_e,me,Me]),on=D.useMemo(()=>({stepUp(Nt=_e){const Kt=Q?Ee-Nt:Ee+Nt;Qt(Kt)},stepDown(Nt=_e){const Kt=Q?Ee+Nt:Ee-Nt;Qt(Kt)},reset(){Qt(d||0)},stepTo(Nt){Qt(Nt)}}),[Qt,Q,Ee,_e,d]),Ht=D.useCallback(Nt=>{const Kt=Me.current,ji={ArrowRight:()=>on.stepUp(),ArrowUp:()=>on.stepUp(),ArrowLeft:()=>on.stepDown(),ArrowDown:()=>on.stepDown(),PageUp:()=>on.stepUp(ve),PageDown:()=>on.stepDown(ve),Home:()=>Qt(Kt.min),End:()=>Qt(Kt.max)}[Nt.key];ji&&(Nt.preventDefault(),Nt.stopPropagation(),ji(Nt),Kt.eventSource="keyboard")},[on,Qt,ve,Me]),jn=(X==null?void 0:X(Ee))??z,{getThumbStyle:Wt,rootStyle:Re,trackStyle:Fe,innerTrackStyle:Ge}=D.useMemo(()=>{const Nt=Me.current;return Q2e({isReversed:Q,orientation:Nt.orientation,thumbPercents:[be]})},[Q,be,Me]),ot=D.useCallback(()=>{Me.current.focusThumbOnChange&&setTimeout(()=>{var Kt;return(Kt=Je.current)==null?void 0:Kt.focus()})},[Me]);Nf(()=>{const Nt=Me.current;ot(),Nt.eventSource==="keyboard"&&(q==null||q(Nt.value))},[Ee,q]);function _t(Nt){const Kt=Mt(Nt);Kt!=null&&Kt!==Me.current.value&&me(Kt)}VEe(tt,{onPanSessionStart(Nt){const Kt=Me.current;Kt.isInteractive&&(le(!0),ot(),_t(Nt),fe==null||fe(Kt.value))},onPanSessionEnd(){const Nt=Me.current;Nt.isInteractive&&(le(!1),q==null||q(Nt.value))},onPan(Nt){Me.current.isInteractive&&_t(Nt)}});const yt=D.useCallback((Nt={},Kt=null)=>({...Nt,...re,ref:Li(Kt,tt),tabIndex:-1,"aria-disabled":wf(w),"data-focused":Zn(Le),style:{...Nt.style,...Re}}),[re,w,Le,Re]),Gt=D.useCallback((Nt={},Kt=null)=>({...Nt,ref:Li(Kt,ze),id:sn,"data-disabled":Zn(w),style:{...Nt.style,...Fe}}),[w,sn,Fe]),mn=D.useCallback((Nt={},Kt=null)=>({...Nt,ref:Kt,style:{...Nt.style,...Ge}}),[Ge]),Pn=D.useCallback((Nt={},Kt=null)=>({...Nt,ref:Li(Kt,Je),role:"slider",tabIndex:$e?0:void 0,id:vt,"data-active":Zn(pe),"aria-valuetext":jn,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":Ee,"aria-orientation":v,"aria-disabled":wf(w),"aria-readonly":wf(I),"aria-label":J,"aria-labelledby":J?void 0:$,style:{...Nt.style,...Wt(0)},onKeyDown:An(Nt.onKeyDown,Ht),onFocus:An(Nt.onFocus,()=>We(!0)),onBlur:An(Nt.onBlur,()=>We(!1))}),[$e,vt,pe,jn,t,s,Ee,v,w,I,J,$,Wt,Ht]),un=D.useCallback((Nt,Kt=null)=>{const qr=!(Nt.value<t||Nt.value>s),ji=Ee>=Nt.value,Ms=Q$(Nt.value,t,s),ii={position:"absolute",pointerEvents:"none",...tMe({orientation:v,vertical:{bottom:Q?`${100-Ms}%`:`${Ms}%`},horizontal:{left:Q?`${100-Ms}%`:`${Ms}%`}})};return{...Nt,ref:Kt,role:"presentation","aria-hidden":!0,"data-disabled":Zn(w),"data-invalid":Zn(!qr),"data-highlighted":Zn(ji),style:{...Nt.style,...ii}}},[w,Q,s,t,v,Ee]),bt=D.useCallback((Nt={},Kt=null)=>({...Nt,ref:Kt,type:"hidden",value:Ee,name:ie}),[ie,Ee]);return{state:{value:Ee,isFocused:Le,isDragging:pe},actions:on,getRootProps:yt,getTrackProps:Gt,getInnerTrackProps:mn,getThumbProps:Pn,getMarkerProps:un,getInputProps:bt}}function tMe(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function nMe(n,t){return t<n?n:n+(t-n)/2}const[rMe,IN]=Ai({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[iMe,AN]=Ai({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),rV=jt((n,t)=>{const s={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=Qa("Slider",s),l=Fi(s),{direction:d}=D0();l.direction=d;const{getInputProps:f,getRootProps:y,...v}=eMe(l),b=y(),w=f({},t);return R.jsx(rMe,{value:v,children:R.jsx(iMe,{value:a,children:R.jsxs(Dt.div,{...b,className:pn("chakra-slider",s.className),__css:a.container,children:[s.children,R.jsx("input",{...w})]})})})});rV.displayName="Slider";const iV=jt((n,t)=>{const{getThumbProps:s}=IN(),a=AN(),l=s(n,t);return R.jsx(Dt.div,{...l,className:pn("chakra-slider__thumb",n.className),__css:a.thumb})});iV.displayName="SliderThumb";const sV=jt((n,t)=>{const{getTrackProps:s}=IN(),a=AN(),l=s(n,t);return R.jsx(Dt.div,{...l,className:pn("chakra-slider__track",n.className),__css:a.track})});sV.displayName="SliderTrack";const oV=jt((n,t)=>{const{getInnerTrackProps:s}=IN(),a=AN(),l=s(n,t);return R.jsx(Dt.div,{...l,className:pn("chakra-slider__filled-track",n.className),__css:a.filledTrack})});oV.displayName="SliderFilledTrack";const sMe=jt((n,t)=>{const{getMarkerProps:s}=IN(),a=AN(),l=s(n,t);return R.jsx(Dt.div,{...l,className:pn("chakra-slider__marker",n.className),__css:a.mark})});sMe.displayName="SliderMark";const Pk=Dt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Pk.displayName="Spacer";const Fne=n=>R.jsx(Dt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Fne.displayName="StackItem";function oMe(n){const{spacing:t,direction:s}=n,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":tF(s,l=>a[l])}}const Nj=jt((n,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:y,children:v,divider:b,className:w,shouldWrapChildren:I,...k}=n,x=s?"row":a??"column",F=D.useMemo(()=>oMe({spacing:f,direction:x}),[f,x]),B=!!b,z=!I&&!B,J=D.useMemo(()=>{const ie=QV(v);return z?ie:ie.map((ue,re)=>{const fe=typeof ue.key<"u"?ue.key:re,q=re+1===ie.length,Q=I?R.jsx(Fne,{children:ue},fe):ue;if(!B)return Q;const se=D.cloneElement(b,{__css:F}),me=q?null:se;return R.jsxs(D.Fragment,{children:[Q,me]},fe)})},[b,F,B,z,I,v]),$=pn("chakra-stack",w);return R.jsx(Dt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:x,flexWrap:y,gap:B?void 0:f,className:$,...k,children:J})});Nj.displayName="Stack";const Ei=jt((n,t)=>R.jsx(Nj,{align:"center",...n,direction:"row",ref:t}));Ei.displayName="HStack";const Di=jt((n,t)=>R.jsx(Nj,{align:"center",...n,direction:"column",ref:t}));Di.displayName="VStack";const Qh=jt(function(t,s){const a=Qa("Switch",t),{spacing:l="0.5rem",children:d,...f}=Fi(t),{getIndicatorProps:y,getInputProps:v,getCheckboxProps:b,getRootProps:w,getLabelProps:I}=s1e(f),k=D.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),x=D.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),F=D.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return R.jsxs(Dt.label,{...w(),className:pn("chakra-switch",t.className),__css:k,children:[R.jsx("input",{className:"chakra-switch__input",...v({},s)}),R.jsx(Dt.span,{...b(),className:"chakra-switch__track",__css:x,children:R.jsx(Dt.span,{__css:a.thumb,className:"chakra-switch__thumb",...y()})}),d&&R.jsx(Dt.span,{className:"chakra-switch__label",...I(),__css:F,children:d})]})});Qh.displayName="Switch";const[aMe,cMe,lMe,uMe]=pte();function dMe(n){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:y="horizontal",direction:v="ltr",...b}=n,[w,I]=D.useState(t??0),[k,x]=jQ({defaultValue:t??0,value:a,onChange:s});D.useEffect(()=>{a!=null&&I(a)},[a]);const F=lMe(),B=D.useId();return{id:`tabs-${n.id??B}`,selectedIndex:k,focusedIndex:w,setSelectedIndex:x,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:f,orientation:y,descendants:F,direction:v,htmlProps:b}}const[hMe,PN]=Ai({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function pMe(n){const{focusedIndex:t,orientation:s,direction:a}=PN(),l=cMe(),d=D.useCallback(f=>{const y=()=>{var ie;const $=l.nextEnabled(t);$&&((ie=$.node)==null||ie.focus())},v=()=>{var ie;const $=l.prevEnabled(t);$&&((ie=$.node)==null||ie.focus())},b=()=>{var ie;const $=l.firstEnabled();$&&((ie=$.node)==null||ie.focus())},w=()=>{var ie;const $=l.lastEnabled();$&&((ie=$.node)==null||ie.focus())},I=s==="horizontal",k=s==="vertical",x=f.key,F=a==="ltr"?"ArrowLeft":"ArrowRight",B=a==="ltr"?"ArrowRight":"ArrowLeft",J={[F]:()=>I&&v(),[B]:()=>I&&y(),ArrowDown:()=>k&&y(),ArrowUp:()=>k&&v(),Home:b,End:w}[x];J&&(f.preventDefault(),J(f))},[l,t,s,a]);return{...n,role:"tablist","aria-orientation":s,onKeyDown:An(n.onKeyDown,d)}}function fMe(n){const{isDisabled:t=!1,isFocusable:s=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:y,selectedIndex:v}=PN(),{index:b,register:w}=uMe({disabled:t&&!s}),I=b===v,k=()=>{l(b)},x=()=>{y(b),!d&&!(t&&s)&&l(b)};return{...hne({...a,ref:Li(w,n.ref),isDisabled:t,isFocusable:s,onClick:An(n.onClick,k)}),id:jne(f,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":Bne(f,b),onFocus:t?void 0:An(n.onFocus,x)}}const[mMe,gMe]=Ai({});function _Me(n){const t=PN(),{id:s,selectedIndex:a}=t,d=QV(n.children).map((f,y)=>D.createElement(mMe,{key:f.key??y,value:{isSelected:y===a,id:Bne(s,y),tabId:jne(s,y),selectedIndex:a}},f));return{...n,children:d}}function yMe(n){const{children:t,...s}=n,{isLazy:a,lazyBehavior:l}=PN(),{isSelected:d,id:f,tabId:y}=gMe(),v=D.useRef(!1);d&&(v.current=!0);const b=ZV({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:b?t:null,role:"tabpanel","aria-labelledby":y,hidden:!d,id:f}}function jne(n,t){return`${n}--tab-${t}`}function Bne(n,t){return`${n}--tabpanel-${t}`}const[EMe,ON]=Ai({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),JC=jt(function(t,s){const a=Qa("Tabs",t),{children:l,className:d,...f}=Fi(t),{htmlProps:y,descendants:v,...b}=dMe(f),w=D.useMemo(()=>b,[b]),{isFitted:I,...k}=y,x={position:"relative",...a.root};return R.jsx(aMe,{value:v,children:R.jsx(hMe,{value:w,children:R.jsx(EMe,{value:a,children:R.jsx(Dt.div,{className:pn("chakra-tabs",d),ref:s,...k,__css:x,children:l})})})})});JC.displayName="Tabs";const _c=jt(function(t,s){const a=ON(),l=fMe({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return R.jsx(Dt.button,{...l,className:pn("chakra-tabs__tab",t.className),__css:d})});_c.displayName="Tab";const QC=jt(function(t,s){const a=pMe({...t,ref:s}),l=ON(),d={display:"flex",...l.tablist};return R.jsx(Dt.div,{...a,className:pn("chakra-tabs__tablist",t.className),__css:d})});QC.displayName="TabList";const Nl=jt(function(t,s){const a=yMe({...t,ref:s}),l=ON();return R.jsx(Dt.div,{outline:"0",...a,className:pn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});Nl.displayName="TabPanel";const kN=jt(function(t,s){const a=_Me(t),l=ON();return R.jsx(Dt.div,{...a,width:"100%",ref:s,className:pn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});kN.displayName="TabPanels";const[vMe,Wne]=Ai({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),zne=jt((n,t)=>{const s=Qa("Tag",n),a=Fi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...s.container};return R.jsx(vMe,{value:s,children:R.jsx(Dt.span,{ref:t,...a,__css:l})})});zne.displayName="Tag";const Gne=jt((n,t)=>{const s=Wne();return R.jsx(Dt.span,{ref:t,noOfLines:1,...n,__css:s.label})});Gne.displayName="TagLabel";const SMe=jt((n,t)=>R.jsx(In,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...n}));SMe.displayName="TagLeftIcon";const bMe=jt((n,t)=>R.jsx(In,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...n}));bMe.displayName="TagRightIcon";const Hne=n=>R.jsx(In,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:R.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Hne.displayName="TagCloseIcon";const $ne=jt((n,t)=>{const{isDisabled:s,children:a,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Wne().closeButton};return R.jsx(Dt.button,{ref:t,"aria-label":"close",...l,type:"button",disabled:s,__css:f,children:a||R.jsx(Hne,{})})});$ne.displayName="TagCloseButton";const TMe=["h","minH","height","minHeight"],Kne=jt((n,t)=>{const s=xu("Textarea",n),{className:a,rows:l,...d}=Fi(n),f=oj(d),y=l?A0(s,TMe):s;return R.jsx(Dt.textarea,{ref:t,rows:l,...f,className:pn("chakra-textarea",a),__css:y})});Kne.displayName="Textarea";function wMe(n,t){const s=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function CMe(n,t){const s=l=>({...t,...l,position:wMe((l==null?void 0:l.position)??(t==null?void 0:t.position),n)}),a=l=>{const d=s(l),f=ute(d);return Fh.notify(f,d)};return a.update=(l,d)=>{Fh.update(l,s(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(y=>a.update(f,{status:"success",duration:5e3,...sl(d.success,y)})).catch(y=>a.update(f,{status:"error",duration:5e3,...sl(d.error,y)}))},a.closeAll=Fh.closeAll,a.close=Fh.close,a.isActive=Fh.isActive,a}function ll(n){const{theme:t}=ate(),s=ONe();return D.useMemo(()=>CMe(t.direction,{...s,...n}),[n,t.direction,s])}const RMe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},aV=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},ZO=n=>{var t,s;return((s=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function IMe(n={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:y=!0,onOpen:v,onClose:b,placement:w,id:I,isOpen:k,defaultIsOpen:x,arrowSize:F=10,arrowShadowColor:B,arrowPadding:z,modifiers:J,isDisabled:$,gutter:ie,offset:ue,direction:re,...fe}=n,{isOpen:q,onOpen:X,onClose:Q}=kf({isOpen:k,defaultIsOpen:x,onOpen:v,onClose:b}),{referenceRef:se,getPopperProps:me,getArrowInnerProps:pe,getArrowProps:le}=Oj({enabled:q,placement:w,arrowPadding:z,modifiers:J,gutter:ie,offset:ue,direction:re}),Le=D.useId(),$e=`tooltip-${I??Le}`,ve=D.useRef(null),_e=D.useRef(void 0),Ee=D.useCallback(()=>{_e.current&&(clearTimeout(_e.current),_e.current=void 0)},[]),ke=D.useRef(void 0),we=D.useCallback(()=>{ke.current&&(clearTimeout(ke.current),ke.current=void 0)},[]),be=D.useCallback(()=>{we(),Q()},[Q,we]),Ie=AMe(ve,be),Me=D.useCallback(()=>{if(!$&&!_e.current){q&&Ie();const Mt=ZO(ve);_e.current=Mt.setTimeout(X,t)}},[Ie,$,q,X,t]),ze=D.useCallback(()=>{Ee();const Mt=ZO(ve);ke.current=Mt.setTimeout(be,s)},[s,be,Ee]),Je=D.useCallback(()=>{q&&a&&ze()},[a,ze,q]),tt=D.useCallback(()=>{q&&f&&ze()},[f,ze,q]),ut=D.useCallback(Mt=>{q&&Mt.key==="Escape"&&ze()},[q,ze]);gy(()=>aV(ve),"keydown",y?ut:void 0),gy(()=>{if(!d)return null;const Mt=ve.current;if(!Mt)return null;const Qt=VQ(Mt);return Qt.localName==="body"?ZO(ve):Qt},"scroll",()=>{q&&d&&be()},{passive:!0,capture:!0}),D.useEffect(()=>{$&&(Ee(),q&&Q())},[$,q,Q,Ee]),D.useEffect(()=>()=>{Ee(),we()},[Ee,we]),gy(()=>ve.current,"pointerleave",ze);const Ze=D.useCallback((Mt={},Qt=null)=>({...Mt,ref:Li(ve,Qt,se),onPointerEnter:An(Mt.onPointerEnter,Ht=>{Ht.pointerType!=="touch"&&Me()}),onClick:An(Mt.onClick,Je),onPointerDown:An(Mt.onPointerDown,tt),onFocus:An(Mt.onFocus,Me),onBlur:An(Mt.onBlur,ze),"aria-describedby":q?$e:void 0}),[Me,ze,tt,q,$e,Je,se]),vt=D.useCallback((Mt={},Qt=null)=>me({...Mt,style:{...Mt.style,[to.arrowSize.var]:F?`${F}px`:void 0,[to.arrowShadowColor.var]:B}},Qt),[me,F,B]),sn=D.useCallback((Mt={},Qt=null)=>{const on={...Mt.style,position:"relative",transformOrigin:to.transformOrigin.varRef};return{ref:Qt,...fe,...Mt,id:$e,role:"tooltip",style:on}},[fe,$e]);return{isOpen:q,show:Me,hide:ze,getTriggerProps:Ze,getTooltipProps:sn,getTooltipPositionerProps:vt,getArrowProps:le,getArrowInnerProps:pe}}const jM="chakra-ui:close-tooltip";function AMe(n,t){return D.useEffect(()=>{const s=aV(n);return s.addEventListener(jM,t),()=>s.removeEventListener(jM,t)},[t,n]),()=>{const s=aV(n),a=ZO(n);s.dispatchEvent(new a.CustomEvent(jM))}}const PMe=Dt(Wf.div),Af=jt((n,t)=>{const s=xu("Tooltip",n),a=Fi(n),l=D0(),{children:d,label:f,shouldWrapChildren:y,"aria-label":v,hasArrow:b,bg:w,portalProps:I,background:k,backgroundColor:x,bgColor:F,motionProps:B,animatePresenceProps:z,...J}=a,$=k??x??w??F;if($){s.bg=$;const se=Ave(l,"colors",$);s[to.arrowBg.var]=se}const ie=IMe({...J,direction:l.direction}),ue=!D.isValidElement(d)||y;let re;if(ue)re=R.jsx(Dt.span,{display:"inline-block",tabIndex:0,...ie.getTriggerProps(),children:d});else{const se=D.Children.only(d);re=D.cloneElement(se,ie.getTriggerProps(se.props,kne(se)))}const fe=!!v,q=ie.getTooltipProps({},t),X=fe?A0(q,["role","id"]):q,Q=UQ(q,["role","id"]);return f?R.jsxs(R.Fragment,{children:[re,R.jsx(O0,{...z,children:ie.isOpen&&R.jsx(Mu,{...I,children:R.jsx(Dt.div,{...ie.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:R.jsxs(PMe,{variants:RMe,initial:"exit",animate:"enter",exit:"exit",...B,...X,__css:s,children:[f,fe&&R.jsx(Dt.span,{srOnly:!0,...Q,children:v}),b&&R.jsx(Dt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:R.jsx(Dt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):R.jsx(R.Fragment,{children:d})});Af.displayName="Tooltip";const AC=jt(function(t,s){const a=xu("Heading",t),{className:l,...d}=Fi(t);return R.jsx(Dt.h2,{ref:s,className:pn("chakra-heading",t.className),...d,__css:a})});AC.displayName="Heading";const ct=jt(function(t,s){const a=xu("Text",t),{className:l,align:d,decoration:f,casing:y,...v}=Fi(t),b=rN({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return R.jsx(Dt.p,{ref:s,className:pn("chakra-text",t.className),...b,...v,__css:a})});ct.displayName="Text";const qne=jt(function(t,s){const{spacing:a="0.5rem",spacingX:l,spacingY:d,children:f,justify:y,direction:v,align:b,className:w,shouldWrapChildren:I,...k}=t,x=D.useMemo(()=>I?D.Children.map(f,(F,B)=>R.jsx(Dj,{children:F},B)):f,[f,I]);return R.jsx(Dt.div,{ref:s,className:pn("chakra-wrap",w),...k,children:R.jsx(Dt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:b,flexDirection:v,listStyleType:"none",gap:a,columnGap:l,rowGap:d,padding:"0"},children:x})})});qne.displayName="Wrap";const Dj=jt(function(t,s){const{className:a,...l}=t;return R.jsx(Dt.li,{ref:s,__css:{display:"flex",alignItems:"flex-start"},className:pn("chakra-wrap__listitem",a),...l})});Dj.displayName="WrapItem";const OMe="modulepreload",kMe=function(n,t){return new URL(n,t).href},KY={},BM=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const f=document.getElementsByTagName("link"),y=document.querySelector("meta[property=csp-nonce]"),v=(y==null?void 0:y.nonce)||(y==null?void 0:y.getAttribute("nonce"));l=Promise.allSettled(s.map(b=>{if(b=kMe(b,a),b in KY)return;KY[b]=!0;const w=b.endsWith(".css"),I=w?'[rel="stylesheet"]':"";if(!!a)for(let F=f.length-1;F>=0;F--){const B=f[F];if(B.href===b&&(!w||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${I}`))return;const x=document.createElement("link");if(x.rel=w?"stylesheet":OMe,w||(x.as="script"),x.crossOrigin="",x.href=b,v&&x.setAttribute("nonce",v),document.head.appendChild(x),w)return new Promise((F,B)=>{x.addEventListener("load",F),x.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(f){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=f,window.dispatchEvent(y),!y.defaultPrevented)throw f}return l.then(f=>{for(const y of f||[])y.status==="rejected"&&d(y.reason);return t().catch(d)})},_O=()=>{const n=new Date,t=n.getHours().toString().padStart(2,"0"),s=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},ee={log:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${_O()}] `,...t)}},error:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${_O()}] `,...t)}},warn:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${_O()}]`,...t)}},trace:n=>{console.trace(`[TRACE] [${_O()}] ${n}`)}};async function NMe(n){let t;try{switch(n){case"default":t=await BM(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await BM(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(s){return ee.error("Failed to load theme:",s),t=await BM(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const DMe=()=>{};var qY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yne=function(n){const t=[];let s=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},LMe=function(n){const t=[];let s=0,a=0;for(;s<n.length;){const l=n[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[s++],f=n[s++],y=n[s++],v=((l&7)<<18|(d&63)<<12|(f&63)<<6|y&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[s++],f=n[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return t.join("")},Xne={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],f=l+1<n.length,y=f?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,w=d>>2,I=(d&3)<<4|y>>4;let k=(y&15)<<2|b>>6,x=b&63;v||(x=64,f||(k=64)),a.push(s[w],s[I],s[k],s[x])}return a.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Yne(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):LMe(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=s[n.charAt(l++)],y=l<n.length?s[n.charAt(l)]:0;++l;const b=l<n.length?s[n.charAt(l)]:64;++l;const I=l<n.length?s[n.charAt(l)]:64;if(++l,d==null||y==null||b==null||I==null)throw new xMe;const k=d<<2|y>>4;if(a.push(k),b!==64){const x=y<<4&240|b>>2;if(a.push(x),I!==64){const F=b<<6&192|I;a.push(F)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class xMe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const MMe=function(n){const t=Yne(n);return Xne.encodeByteArray(t,!0)},Ok=function(n){return MMe(n).replace(/\./g,"")},Jne=function(n){try{return Xne.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UMe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VMe=()=>UMe().__FIREBASE_DEFAULTS__,FMe=()=>{if(typeof process>"u"||typeof qY>"u")return;const n=qY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},jMe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&Jne(n[1]);return t&&JSON.parse(t)},NN=()=>{try{return DMe()||VMe()||FMe()||jMe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Qne=n=>{var t,s;return(s=(t=NN())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[n]},Zne=n=>{const t=Qne(n);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},ere=()=>{var n;return(n=NN())===null||n===void 0?void 0:n.config},tre=n=>{var t;return(t=NN())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BMe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nre(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ok(JSON.stringify(s)),Ok(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function WMe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ja())}function zMe(){var n;const t=(n=NN())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function GMe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function HMe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function $Me(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function KMe(){const n=Ja();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function qMe(){return!zMe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function YMe(){try{return typeof indexedDB=="object"}catch{return!1}}function XMe(){return new Promise((n,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JMe="FirebaseError";class lp extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=JMe,Object.setPrototypeOf(this,lp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ZC.prototype.create)}}class ZC{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],f=d?QMe(d,a):"Error",y=`${this.serviceName}: ${f} (${l}).`;return new lp(l,y,a)}}function QMe(n,t){return n.replace(ZMe,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const ZMe=/\{\$([^}]+)}/g;function eUe(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function Uf(n,t){if(n===t)return!0;const s=Object.keys(n),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=n[l],f=t[l];if(YY(d)&&YY(f)){if(!Uf(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function YY(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eR(n){const t=[];for(const[s,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function xw(n){const t={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function Mw(n){const t=n.indexOf("?");if(!t)return"";const s=n.indexOf("#",t);return n.substring(t,s>0?s:void 0)}function tUe(n,t){const s=new nUe(n,t);return s.subscribe.bind(s)}class nUe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");rUe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=WM),l.error===void 0&&(l.error=WM),l.complete===void 0&&(l.complete=WM);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function rUe(n,t){if(typeof n!="object"||n===null)return!1;for(const s of t)if(s in n&&typeof n[s]=="function")return!0;return!1}function WM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function as(n){return n&&n._delegate?n._delegate:n}class Sg{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iUe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new BMe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(oUe(t))try{this.getOrInitializeService({instanceIdentifier:cy})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=cy){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=cy){return this.instances.has(t)}getOptions(t=cy){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,f]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(d);a===y&&f.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&t(f,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:sUe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=cy){return this.component?this.component.multipleInstances?t:cy:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function sUe(n){return n===cy?void 0:n}function oUe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aUe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new iUe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Cr||(Cr={}));const cUe={debug:Cr.DEBUG,verbose:Cr.VERBOSE,info:Cr.INFO,warn:Cr.WARN,error:Cr.ERROR,silent:Cr.SILENT},lUe=Cr.INFO,uUe={[Cr.DEBUG]:"log",[Cr.VERBOSE]:"log",[Cr.INFO]:"info",[Cr.WARN]:"warn",[Cr.ERROR]:"error"},dUe=(n,t,...s)=>{if(t<n.logLevel)return;const a=new Date().toISOString(),l=uUe[t];if(l)console[l](`[${a}]  ${n.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Lj{constructor(t){this.name=t,this._logLevel=lUe,this._logHandler=dUe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Cr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?cUe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Cr.DEBUG,...t),this._logHandler(this,Cr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Cr.VERBOSE,...t),this._logHandler(this,Cr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Cr.INFO,...t),this._logHandler(this,Cr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Cr.WARN,...t),this._logHandler(this,Cr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Cr.ERROR,...t),this._logHandler(this,Cr.ERROR,...t)}}const hUe=(n,t)=>t.some(s=>n instanceof s);let XY,JY;function pUe(){return XY||(XY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fUe(){return JY||(JY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const rre=new WeakMap,cV=new WeakMap,ire=new WeakMap,zM=new WeakMap,xj=new WeakMap;function mUe(n){const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",f)},d=()=>{s(pg(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",f)});return t.then(s=>{s instanceof IDBCursor&&rre.set(s,n)}).catch(()=>{}),xj.set(t,n),t}function gUe(n){if(cV.has(n))return;const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",f),n.removeEventListener("abort",f)},d=()=>{s(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",f),n.addEventListener("abort",f)});cV.set(n,t)}let lV={get(n,t,s){if(n instanceof IDBTransaction){if(t==="done")return cV.get(n);if(t==="objectStoreNames")return n.objectStoreNames||ire.get(n);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return pg(n[t])},set(n,t,s){return n[t]=s,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function _Ue(n){lV=n(lV)}function yUe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=n.call(GM(this),t,...s);return ire.set(a,t.sort?t.sort():[t]),pg(a)}:fUe().includes(n)?function(...t){return n.apply(GM(this),t),pg(rre.get(this))}:function(...t){return pg(n.apply(GM(this),t))}}function EUe(n){return typeof n=="function"?yUe(n):(n instanceof IDBTransaction&&gUe(n),hUe(n,pUe())?new Proxy(n,lV):n)}function pg(n){if(n instanceof IDBRequest)return mUe(n);if(zM.has(n))return zM.get(n);const t=EUe(n);return t!==n&&(zM.set(n,t),xj.set(t,n)),t}const GM=n=>xj.get(n);function vUe(n,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(n,t),y=pg(f);return a&&f.addEventListener("upgradeneeded",v=>{a(pg(f.result),v.oldVersion,v.newVersion,pg(f.transaction),v)}),s&&f.addEventListener("blocked",v=>s(v.oldVersion,v.newVersion,v)),y.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),y}const SUe=["get","getKey","getAll","getAllKeys","count"],bUe=["put","add","delete","clear"],HM=new Map;function QY(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(HM.get(t))return HM.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=bUe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||SUe.includes(s)))return;const d=async function(f,...y){const v=this.transaction(f,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(y.shift())),(await Promise.all([b[s](...y),l&&v.done]))[0]};return HM.set(t,d),d}_Ue(n=>({...n,get:(t,s,a)=>QY(t,s)||n.get(t,s,a),has:(t,s)=>!!QY(t,s)||n.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TUe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(wUe(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function wUe(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const uV="@firebase/app",ZY="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vf=new Lj("@firebase/app"),CUe="@firebase/app-compat",RUe="@firebase/analytics-compat",IUe="@firebase/analytics",AUe="@firebase/app-check-compat",PUe="@firebase/app-check",OUe="@firebase/auth",kUe="@firebase/auth-compat",NUe="@firebase/database",DUe="@firebase/data-connect",LUe="@firebase/database-compat",xUe="@firebase/functions",MUe="@firebase/functions-compat",UUe="@firebase/installations",VUe="@firebase/installations-compat",FUe="@firebase/messaging",jUe="@firebase/messaging-compat",BUe="@firebase/performance",WUe="@firebase/performance-compat",zUe="@firebase/remote-config",GUe="@firebase/remote-config-compat",HUe="@firebase/storage",$Ue="@firebase/storage-compat",KUe="@firebase/firestore",qUe="@firebase/vertexai",YUe="@firebase/firestore-compat",XUe="firebase",JUe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dV="[DEFAULT]",QUe={[uV]:"fire-core",[CUe]:"fire-core-compat",[IUe]:"fire-analytics",[RUe]:"fire-analytics-compat",[PUe]:"fire-app-check",[AUe]:"fire-app-check-compat",[OUe]:"fire-auth",[kUe]:"fire-auth-compat",[NUe]:"fire-rtdb",[DUe]:"fire-data-connect",[LUe]:"fire-rtdb-compat",[xUe]:"fire-fn",[MUe]:"fire-fn-compat",[UUe]:"fire-iid",[VUe]:"fire-iid-compat",[FUe]:"fire-fcm",[jUe]:"fire-fcm-compat",[BUe]:"fire-perf",[WUe]:"fire-perf-compat",[zUe]:"fire-rc",[GUe]:"fire-rc-compat",[HUe]:"fire-gcs",[$Ue]:"fire-gcs-compat",[KUe]:"fire-fst",[YUe]:"fire-fst-compat",[qUe]:"fire-vertex","fire-js":"fire-js",[XUe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kk=new Map,ZUe=new Map,hV=new Map;function eX(n,t){try{n.container.addComponent(t)}catch(s){Vf.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,s)}}function Dy(n){const t=n.name;if(hV.has(t))return Vf.debug(`There were multiple attempts to register component ${t}.`),!1;hV.set(t,n);for(const s of kk.values())eX(s,n);for(const s of ZUe.values())eX(s,n);return!0}function DN(n,t){const s=n.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),n.container.getProvider(t)}function Dl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eVe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fg=new ZC("app","Firebase",eVe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tVe{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Sg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw fg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy=JUe;function sre(n,t={}){let s=n;typeof t!="object"&&(t={name:t});const a=Object.assign({name:dV,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw fg.create("bad-app-name",{appName:String(l)});if(s||(s=ere()),!s)throw fg.create("no-options");const d=kk.get(l);if(d){if(Uf(s,d.options)&&Uf(a,d.config))return d;throw fg.create("duplicate-app",{appName:l})}const f=new aUe(l);for(const v of hV.values())f.addComponent(v);const y=new tVe(s,a,f);return kk.set(l,y),y}function Mj(n=dV){const t=kk.get(n);if(!t&&n===dV&&ere())return sre();if(!t)throw fg.create("no-app",{appName:n});return t}function Zh(n,t,s){var a;let l=(a=QUe[n])!==null&&a!==void 0?a:n;s&&(l+=`-${s}`);const d=l.match(/\s|\//),f=t.match(/\s|\//);if(d||f){const y=[`Unable to register library "${l}" with version "${t}":`];d&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&y.push("and"),f&&y.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Vf.warn(y.join(" "));return}Dy(new Sg(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nVe="firebase-heartbeat-database",rVe=1,PC="firebase-heartbeat-store";let $M=null;function ore(){return $M||($M=vUe(nVe,rVe,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(PC)}catch(s){console.warn(s)}}}}).catch(n=>{throw fg.create("idb-open",{originalErrorMessage:n.message})})),$M}async function iVe(n){try{const s=(await ore()).transaction(PC),a=await s.objectStore(PC).get(are(n));return await s.done,a}catch(t){if(t instanceof lp)Vf.warn(t.message);else{const s=fg.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Vf.warn(s.message)}}}async function tX(n,t){try{const a=(await ore()).transaction(PC,"readwrite");await a.objectStore(PC).put(t,are(n)),await a.done}catch(s){if(s instanceof lp)Vf.warn(s.message);else{const a=fg.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Vf.warn(a.message)}}}function are(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sVe=1024,oVe=30;class aVe{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new lVe(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=nX();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>oVe){const f=uVe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Vf.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=nX(),{heartbeatsToSend:a,unsentEntries:l}=cVe(this._heartbeatsCache.heartbeats),d=Ok(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return Vf.warn(s),""}}}function nX(){return new Date().toISOString().substring(0,10)}function cVe(n,t=sVe){const s=[];let a=n.slice();for(const l of n){const d=s.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),rX(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),rX(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class lVe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return YMe()?XMe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await iVe(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return tX(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return tX(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function rX(n){return Ok(JSON.stringify({version:2,heartbeats:n})).length}function uVe(n){if(n.length===0)return-1;let t=0,s=n[0].date;for(let a=1;a<n.length;a++)n[a].date<s&&(s=n[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dVe(n){Dy(new Sg("platform-logger",t=>new TUe(t),"PRIVATE")),Dy(new Sg("heartbeat",t=>new aVe(t),"PRIVATE")),Zh(uV,ZY,n),Zh(uV,ZY,"esm2017"),Zh("fire-js","")}dVe("");function cre(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const hVe=cre,lre=new ZC("auth","Firebase",cre());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk=new Lj("@firebase/auth");function pVe(n,...t){Nk.logLevel<=Cr.WARN&&Nk.warn(`Auth (${Wy}): ${n}`,...t)}function ek(n,...t){Nk.logLevel<=Cr.ERROR&&Nk.error(`Auth (${Wy}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dd(n,...t){throw Uj(n,...t)}function ep(n,...t){return Uj(n,...t)}function ure(n,t,s){const a=Object.assign(Object.assign({},hVe()),{[t]:s});return new ZC("auth","Firebase",a).create(t,{appName:n.name})}function Pf(n){return ure(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Uj(n,...t){if(typeof n!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(s,...a)}return lre.create(n,...t)}function Bn(n,t,...s){if(!n)throw Uj(t,...s)}function vf(n){const t="INTERNAL ASSERTION FAILED: "+n;throw ek(t),new Error(t)}function Ff(n,t){n||vf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function fVe(){return iX()==="http:"||iX()==="https:"}function iX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mVe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(fVe()||HMe()||"connection"in navigator)?navigator.onLine:!0}function gVe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(t,s){this.shortDelay=t,this.longDelay=s,Ff(s>t,"Short delay should be less than long delay!"),this.isMobile=WMe()||$Me()}get(){return mVe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vj(n,t){Ff(n.emulator,"Emulator should always be set here");const{url:s}=n.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dre{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;vf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;vf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;vf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Ve={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yVe=new tR(3e4,6e4);function zf(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function Gf(n,t,s,a,l={}){return hre(n,l,async()=>{let d={},f={};a&&(t==="GET"?f=a:d={body:JSON.stringify(a)});const y=eR(Object.assign({key:n.config.apiKey},f)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:t,headers:v},d);return GMe()||(b.referrerPolicy="no-referrer"),dre.fetch()(pre(n,n.config.apiHost,s,y),b)})}async function hre(n,t,s){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},_Ve),t);try{const l=new vVe(n),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw yO(n,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const y=d.ok?f.errorMessage:f.error.message,[v,b]=y.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw yO(n,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw yO(n,"email-already-in-use",f);if(v==="USER_DISABLED")throw yO(n,"user-disabled",f);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw ure(n,w,b);Dd(n,w)}}catch(l){if(l instanceof lp)throw l;Dd(n,"network-request-failed",{message:String(l)})}}async function nR(n,t,s,a,l={}){const d=await Gf(n,t,s,a,l);return"mfaPendingCredential"in d&&Dd(n,"multi-factor-auth-required",{_serverResponse:d}),d}function pre(n,t,s,a){const l=`${t}${s}?${a}`;return n.config.emulator?Vj(n.config,l):`${n.config.apiScheme}://${l}`}function EVe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class vVe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(ep(this.auth,"network-request-failed")),yVe.get())})}}function yO(n,t,s){const a={appName:n.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=ep(n,t,a);return l.customData._tokenResponse=s,l}function sX(n){return n!==void 0&&n.enterprise!==void 0}class SVe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return EVe(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function bVe(n,t){return Gf(n,"GET","/v2/recaptchaConfig",zf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TVe(n,t){return Gf(n,"POST","/v1/accounts:delete",t)}async function fre(n,t){return Gf(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tC(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function wVe(n,t=!1){const s=as(n),a=await s.getIdToken(t),l=Fj(a);Bn(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:tC(KM(l.auth_time)),issuedAtTime:tC(KM(l.iat)),expirationTime:tC(KM(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function KM(n){return Number(n)*1e3}function Fj(n){const[t,s,a]=n.split(".");if(t===void 0||s===void 0||a===void 0)return ek("JWT malformed, contained fewer than 3 sections"),null;try{const l=Jne(s);return l?JSON.parse(l):(ek("Failed to decode base64 JWT payload"),null)}catch(l){return ek("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function oX(n){const t=Fj(n);return Bn(t,"internal-error"),Bn(typeof t.exp<"u","internal-error"),Bn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OC(n,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof lp&&CVe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function CVe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RVe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=tC(this.lastLoginAt),this.creationTime=tC(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dk(n){var t;const s=n.auth,a=await n.getIdToken(),l=await OC(n,fre(s,{idToken:a}));Bn(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const f=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?mre(d.providerUserInfo):[],y=AVe(n.providerData,f),v=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(y!=null&&y.length),w=v?b:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:y,metadata:new fV(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,I)}async function IVe(n){const t=as(n);await Dk(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function AVe(n,t){return[...n.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function mre(n){return n.map(t=>{var{providerId:s}=t,a=KC(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PVe(n,t){const s=await hre(n,{},async()=>{const a=eR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,f=pre(n,l,"/v1/token",`key=${d}`),y=await n._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",dre.fetch()(f,{method:"POST",headers:y,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function OVe(n,t){return Gf(n,"POST","/v2/accounts:revokeToken",zf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Bn(t.idToken,"internal-error"),Bn(typeof t.idToken<"u","internal-error"),Bn(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):oX(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Bn(t.length!==0,"internal-error");const s=oX(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Bn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await PVe(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,f=new ZS;return a&&(Bn(typeof a=="string","internal-error",{appName:t}),f.refreshToken=a),l&&(Bn(typeof l=="string","internal-error",{appName:t}),f.accessToken=l),d&&(Bn(typeof d=="number","internal-error",{appName:t}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new ZS,this.toJSON())}_performRefresh(){return vf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(n,t){Bn(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class Sf{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=KC(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new RVe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new fV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await OC(this,this.stsTokenManager.getToken(this.auth,t));return Bn(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return wVe(this,t)}reload(){return IVe(this)}_assign(t){this!==t&&(Bn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new Sf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Bn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await Dk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Dl(this.auth.app))return Promise.reject(Pf(this.auth));const t=await this.getIdToken();return await OC(this,TVe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,f,y,v,b,w;const I=(a=s.displayName)!==null&&a!==void 0?a:void 0,k=(l=s.email)!==null&&l!==void 0?l:void 0,x=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,F=(f=s.photoURL)!==null&&f!==void 0?f:void 0,B=(y=s.tenantId)!==null&&y!==void 0?y:void 0,z=(v=s._redirectEventId)!==null&&v!==void 0?v:void 0,J=(b=s.createdAt)!==null&&b!==void 0?b:void 0,$=(w=s.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:ie,emailVerified:ue,isAnonymous:re,providerData:fe,stsTokenManager:q}=s;Bn(ie&&q,t,"internal-error");const X=ZS.fromJSON(this.name,q);Bn(typeof ie=="string",t,"internal-error"),eg(I,t.name),eg(k,t.name),Bn(typeof ue=="boolean",t,"internal-error"),Bn(typeof re=="boolean",t,"internal-error"),eg(x,t.name),eg(F,t.name),eg(B,t.name),eg(z,t.name),eg(J,t.name),eg($,t.name);const Q=new Sf({uid:ie,auth:t,email:k,emailVerified:ue,displayName:I,isAnonymous:re,photoURL:F,phoneNumber:x,tenantId:B,stsTokenManager:X,createdAt:J,lastLoginAt:$});return fe&&Array.isArray(fe)&&(Q.providerData=fe.map(se=>Object.assign({},se))),z&&(Q._redirectEventId=z),Q}static async _fromIdTokenResponse(t,s,a=!1){const l=new ZS;l.updateFromServerResponse(s);const d=new Sf({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await Dk(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Bn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?mre(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),y=new ZS;y.updateFromIdToken(a);const v=new Sf({uid:l.localId,auth:t,stsTokenManager:y,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new fV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aX=new Map;function bf(n){Ff(n instanceof Function,"Expected a class definition");let t=aX.get(n);return t?(Ff(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,aX.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gre{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}gre.type="NONE";const cX=gre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tk(n,t,s){return`firebase:${n}:${t}:${s}`}class e0{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=tk(this.userKey,l.apiKey,d),this.fullPersistenceKey=tk("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Sf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new e0(bf(cX),t,a);const l=(await Promise.all(s.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||bf(cX);const f=tk(a,t.config.apiKey,t.name);let y=null;for(const b of s)try{const w=await b._get(f);if(w){const I=Sf._fromJSON(t,w);b!==d&&(y=I),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new e0(d,t,a):(d=v[0],y&&await d._set(f,y.toJSON()),await Promise.all(s.map(async b=>{if(b!==d)try{await b._remove(f)}catch{}})),new e0(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lX(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(vre(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(_re(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(bre(t))return"Blackberry";if(Tre(t))return"Webos";if(yre(t))return"Safari";if((t.includes("chrome/")||Ere(t))&&!t.includes("edge/"))return"Chrome";if(Sre(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function _re(n=Ja()){return/firefox\//i.test(n)}function yre(n=Ja()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ere(n=Ja()){return/crios\//i.test(n)}function vre(n=Ja()){return/iemobile/i.test(n)}function Sre(n=Ja()){return/android/i.test(n)}function bre(n=Ja()){return/blackberry/i.test(n)}function Tre(n=Ja()){return/webos/i.test(n)}function jj(n=Ja()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function kVe(n=Ja()){var t;return jj(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function NVe(){return KMe()&&document.documentMode===10}function wre(n=Ja()){return jj(n)||Sre(n)||Tre(n)||bre(n)||/windows phone/i.test(n)||vre(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cre(n,t=[]){let s;switch(n){case"Browser":s=lX(Ja());break;case"Worker":s=`${lX(Ja())}-${n}`;break;default:s=n}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${Wy}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DVe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((f,y)=>{try{const v=t(d);f(v)}catch(v){y(v)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LVe(n,t={}){return Gf(n,"GET","/v2/passwordPolicy",zf(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xVe=6;class MVe{constructor(t){var s,a,l,d;const f=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=f.minPasswordLength)!==null&&s!==void 0?s:xVe,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,f,y;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(s=v.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(y=v.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),v}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UVe{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new uX(this),this.idTokenSubscription=new uX(this),this.beforeStateQueue=new DVe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=lre,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=bf(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await e0.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await fre(this,{idToken:t}),a=await Sf._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(Dl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(y,y))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,y=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!f||f===y)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Bn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await Dk(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=gVe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Dl(this.app))return Promise.reject(Pf(this));const s=t?as(t):null;return s&&Bn(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Bn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Dl(this.app)?Promise.reject(Pf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Dl(this.app)?Promise.reject(Pf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(bf(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await LVe(this),s=new MVe(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new ZC("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await OVe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&bf(t)||this._popupRedirectResolver;Bn(s,this,"argument-error"),this.redirectPersistenceManager=await e0.create(this,[bf(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let f=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Bn(y,this,"internal-error"),y.then(()=>{f||d(this.currentUser)}),typeof s=="function"){const v=t.addObserver(s,a,l);return()=>{f=!0,v()}}else{const v=t.addObserver(s);return()=>{f=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Bn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Cre(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(Dl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&pVe(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Dg(n){return as(n)}class uX{constructor(t){this.auth=t,this.observer=null,this.addObserver=tUe(s=>this.observer=s)}get next(){return Bn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let LN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function VVe(n){LN=n}function Rre(n){return LN.loadJS(n)}function FVe(){return LN.recaptchaEnterpriseScript}function jVe(){return LN.gapiScript}function BVe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class WVe{constructor(){this.enterprise=new zVe}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class zVe{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const GVe="recaptcha-enterprise",Ire="NO_RECAPTCHA";class HVe{constructor(t){this.type=GVe,this.auth=Dg(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,y)=>{bVe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const b=new SVe(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,f(b.siteKey)}}).catch(v=>{y(v)})})}function l(d,f,y){const v=window.grecaptcha;sX(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(b=>{f(b)}).catch(()=>{f(Ire)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new WVe().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(y=>{if(!s&&sX(window.grecaptcha))l(y,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=FVe();v.length!==0&&(v+=y),Rre(v).then(()=>{l(y,d,f)}).catch(b=>{f(b)})}}).catch(y=>{f(y)})})}}async function dX(n,t,s,a=!1,l=!1){const d=new HVe(n);let f;if(l)f=Ire;else try{f=await d.verify(s)}catch{f=await d.verify(s,!0)}const y=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const v=y.phoneEnrollmentInfo.phoneNumber,b=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const v=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return a?Object.assign(y,{captchaResp:f}):Object.assign(y,{captchaResponse:f}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function Lk(n,t,s,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await dX(n,t,s,s==="getOobCode");return a(n,f)}else return a(n,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await dX(n,t,s,s==="getOobCode");return a(n,y)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $Ve(n,t){const s=DN(n,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(Uf(d,t??{}))return l;Dd(l,"already-initialized")}return s.initialize({options:t})}function KVe(n,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(bf);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function qVe(n,t,s){const a=Dg(n);Bn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=Are(t),{host:f,port:y}=YVe(t),v=y===null?"":`:${y}`,b={url:`${d}//${f}${v}/`},w=Object.freeze({host:f,port:y,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Bn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Bn(Uf(b,a.config.emulator)&&Uf(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,XVe()}function Are(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function YVe(n){const t=Are(n),s=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:hX(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:hX(f)}}}function hX(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function XVe(){function n(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bj{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return vf("not implemented")}_getIdTokenResponse(t){return vf("not implemented")}_linkToIdToken(t,s){return vf("not implemented")}_getReauthenticationResolver(t){return vf("not implemented")}}async function JVe(n,t){return Gf(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QVe(n,t){return nR(n,"POST","/v1/accounts:signInWithPassword",zf(n,t))}async function Pre(n,t){return Gf(n,"POST","/v1/accounts:sendOobCode",zf(n,t))}async function ZVe(n,t){return Pre(n,t)}async function eFe(n,t){return Pre(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tFe(n,t){return nR(n,"POST","/v1/accounts:signInWithEmailLink",zf(n,t))}async function nFe(n,t){return nR(n,"POST","/v1/accounts:signInWithEmailLink",zf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC extends Bj{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new kC(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new kC(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Lk(t,s,"signInWithPassword",QVe);case"emailLink":return tFe(t,{email:this._email,oobCode:this._password});default:Dd(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Lk(t,a,"signUpPassword",JVe);case"emailLink":return nFe(t,{idToken:s,email:this._email,oobCode:this._password});default:Dd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t0(n,t){return nR(n,"POST","/v1/accounts:signInWithIdp",zf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rFe="http://localhost";class Ly extends Bj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new Ly(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):Dd("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=KC(s,["providerId","signInMethod"]);if(!a||!l)return null;const f=new Ly(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(t){const s=this.buildRequest();return t0(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,t0(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,t0(t,s)}buildRequest(){const t={requestUri:rFe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=eR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iFe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function sFe(n){const t=xw(Mw(n)).link,s=t?xw(Mw(t)).deep_link_id:null,a=xw(Mw(n)).deep_link_id;return(a?xw(Mw(a)).link:null)||a||s||t||n}class Wj{constructor(t){var s,a,l,d,f,y;const v=xw(Mw(t)),b=(s=v.apiKey)!==null&&s!==void 0?s:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,I=iFe((l=v.mode)!==null&&l!==void 0?l:null);Bn(b&&w&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=v.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(y=v.tenantId)!==null&&y!==void 0?y:null}static parseLink(t){const s=sFe(t);try{return new Wj(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(){this.providerId=U0.PROVIDER_ID}static credential(t,s){return kC._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=Wj.parseLink(s);return Bn(a,"argument-error"),kC._fromEmailAndCode(t,a.code,a.tenantId)}}U0.PROVIDER_ID="password";U0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";U0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ore{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR extends Ore{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg extends rR{constructor(){super("facebook.com")}static credential(t){return Ly._fromParams({providerId:sg.PROVIDER_ID,signInMethod:sg.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return sg.credentialFromTaggedObject(t)}static credentialFromError(t){return sg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return sg.credential(t.oauthAccessToken)}catch{return null}}}sg.FACEBOOK_SIGN_IN_METHOD="facebook.com";sg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og extends rR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return Ly._fromParams({providerId:og.PROVIDER_ID,signInMethod:og.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return og.credentialFromTaggedObject(t)}static credentialFromError(t){return og.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return og.credential(s,a)}catch{return null}}}og.GOOGLE_SIGN_IN_METHOD="google.com";og.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag extends rR{constructor(){super("github.com")}static credential(t){return Ly._fromParams({providerId:ag.PROVIDER_ID,signInMethod:ag.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ag.credentialFromTaggedObject(t)}static credentialFromError(t){return ag.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ag.credential(t.oauthAccessToken)}catch{return null}}}ag.GITHUB_SIGN_IN_METHOD="github.com";ag.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg extends rR{constructor(){super("twitter.com")}static credential(t,s){return Ly._fromParams({providerId:cg.PROVIDER_ID,signInMethod:cg.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return cg.credentialFromTaggedObject(t)}static credentialFromError(t){return cg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return cg.credential(s,a)}catch{return null}}}cg.TWITTER_SIGN_IN_METHOD="twitter.com";cg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oFe(n,t){return nR(n,"POST","/v1/accounts:signUp",zf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await Sf._fromIdTokenResponse(t,a,l),f=pX(a);return new xy({user:d,providerId:f,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=pX(a);return new xy({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function pX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk extends lp{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,xk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new xk(t,s,a,l)}}function kre(n,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(n):s._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?xk._fromErrorAndOperation(n,d,t,a):d})}async function aFe(n,t,s=!1){const a=await OC(n,t._linkToIdToken(n.auth,await n.getIdToken()),s);return xy._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cFe(n,t,s=!1){const{auth:a}=n;if(Dl(a.app))return Promise.reject(Pf(a));const l="reauthenticate";try{const d=await OC(n,kre(a,l,t,n),s);Bn(d.idToken,a,"internal-error");const f=Fj(d.idToken);Bn(f,a,"internal-error");const{sub:y}=f;return Bn(n.uid===y,a,"user-mismatch"),xy._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Dd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nre(n,t,s=!1){if(Dl(n.app))return Promise.reject(Pf(n));const a="signIn",l=await kre(n,a,t),d=await xy._fromIdTokenResponse(n,a,l);return s||await n._updateCurrentUser(d.user),d}async function lFe(n,t){return Nre(Dg(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dre(n){const t=Dg(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function uFe(n,t,s){const a=Dg(n);await Lk(a,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",eFe)}async function dFe(n,t,s){if(Dl(n.app))return Promise.reject(Pf(n));const a=Dg(n),f=await Lk(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",oFe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Dre(n),v}),y=await xy._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(y.user),y}function hFe(n,t,s){return Dl(n.app)?Promise.reject(Pf(n)):lFe(as(n),U0.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Dre(n),a})}async function Lre(n,t){const s=as(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await ZVe(s.auth,l);d!==n.email&&await n.reload()}function pFe(n,t,s,a){return as(n).onIdTokenChanged(t,s,a)}function fFe(n,t,s){return as(n).beforeAuthStateChanged(t,s)}function mFe(n,t,s,a){return as(n).onAuthStateChanged(t,s,a)}function gFe(n){return as(n).signOut()}const Mk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xre{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Mk,"1"),this.storage.removeItem(Mk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Fe=1e3,yFe=10;class Mre extends xre{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=wre(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((f,y,v)=>{this.notifyListeners(f,v)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!s&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);NVe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,yFe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},_Fe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}Mre.type="LOCAL";const EFe=Mre;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ure extends xre{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}Ure.type="SESSION";const Vre=Ure;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vFe(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new xN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const y=Array.from(f).map(async b=>b(s.origin,d)),v=await vFe(y);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}xN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zj(n="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return n+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SFe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((y,v)=>{const b=zj("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const k=I;if(k.data.eventId===b)switch(k.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),y(k.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:t,eventId:b,data:s},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tp(){return window}function bFe(n){tp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fre(){return typeof tp().WorkerGlobalScope<"u"&&typeof tp().importScripts=="function"}async function TFe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function wFe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function CFe(){return Fre()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jre="firebaseLocalStorageDb",RFe=1,Uk="firebaseLocalStorage",Bre="fbase_key";class iR{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function MN(n,t){return n.transaction([Uk],t?"readwrite":"readonly").objectStore(Uk)}function IFe(){const n=indexedDB.deleteDatabase(jre);return new iR(n).toPromise()}function mV(){const n=indexedDB.open(jre,RFe);return new Promise((t,s)=>{n.addEventListener("error",()=>{s(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(Uk,{keyPath:Bre})}catch(l){s(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(Uk)?t(a):(a.close(),await IFe(),t(await mV()))})})}async function fX(n,t,s){const a=MN(n,!0).put({[Bre]:t,value:s});return new iR(a).toPromise()}async function AFe(n,t){const s=MN(n,!1).get(t),a=await new iR(s).toPromise();return a===void 0?null:a.value}function mX(n,t){const s=MN(n,!0).delete(t);return new iR(s).toPromise()}const PFe=800,OFe=3;class Wre{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await mV(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>OFe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Fre()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=xN._getInstance(CFe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await TFe(),!this.activeServiceWorker)return;this.sender=new SFe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||wFe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await mV();return await fX(t,Mk,"1"),await mX(t,Mk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>fX(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>AFe(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>mX(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=MN(l,!1).getAll();return new iR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),PFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Wre.type="LOCAL";const kFe=Wre;new tR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NFe(n,t){return t?bf(t):(Bn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj extends Bj{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return t0(t,this._buildIdpRequest())}_linkToIdToken(t,s){return t0(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return t0(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function DFe(n){return Nre(n.auth,new Gj(n),n.bypassAuthState)}function LFe(n){const{auth:t,user:s}=n;return Bn(s,t,"internal-error"),cFe(s,new Gj(n),n.bypassAuthState)}async function xFe(n){const{auth:t,user:s}=n;return Bn(s,t,"internal-error"),aFe(s,new Gj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zre{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:f,type:y}=t;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(v))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return DFe;case"linkViaPopup":case"linkViaRedirect":return xFe;case"reauthViaPopup":case"reauthViaRedirect":return LFe;default:Dd(this.auth,"internal-error")}}resolve(t){Ff(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ff(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MFe=new tR(2e3,1e4);class FS extends zre{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,FS.currentPopupAction&&FS.currentPopupAction.cancel(),FS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Bn(t,this.auth,"internal-error"),t}async onExecution(){Ff(this.filter.length===1,"Popup operations only handle one event");const t=zj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(ep(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(ep(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,FS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ep(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,MFe.get())};t()}}FS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UFe="pendingRedirect",nk=new Map;class VFe extends zre{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=nk.get(this.auth._key());if(!t){try{const a=await FFe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}nk.set(this.auth._key(),t)}return this.bypassAuthState||nk.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function FFe(n,t){const s=WFe(t),a=BFe(n);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function jFe(n,t){nk.set(n._key(),t)}function BFe(n){return bf(n._redirectPersistence)}function WFe(n){return tk(UFe,n.config.apiKey,n.name)}async function zFe(n,t,s=!1){if(Dl(n.app))return Promise.reject(Pf(n));const a=Dg(n),l=NFe(a,t),f=await new VFe(a,l,s).execute();return f&&!s&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,t)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GFe=10*60*1e3;class HFe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!$Fe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!Gre(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(ep(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=GFe&&this.cachedEventUids.clear(),this.cachedEventUids.has(gX(t))}saveEventToCache(t){this.cachedEventUids.add(gX(t)),this.lastProcessedEventTime=Date.now()}}function gX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function Gre({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function $Fe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Gre(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KFe(n,t={}){return Gf(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qFe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,YFe=/^https?/;async function XFe(n){if(n.config.emulator)return;const{authorizedDomains:t}=await KFe(n);for(const s of t)try{if(JFe(s))return}catch{}Dd(n,"unauthorized-domain")}function JFe(n){const t=pV(),{protocol:s,hostname:a}=new URL(t);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?s==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&f.hostname===a}if(!YFe.test(s))return!1;if(qFe.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QFe=new tR(3e4,6e4);function _X(){const n=tp().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let s=0;s<n.CP.length;s++)n.CP[s]=null}}function ZFe(n){return new Promise((t,s)=>{var a,l,d;function f(){_X(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{_X(),s(ep(n,"network-request-failed"))},timeout:QFe.get()})}if(!((l=(a=tp().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=tp().gapi)===null||d===void 0)&&d.load)f();else{const y=BVe("iframefcb");return tp()[y]=()=>{gapi.load?f():s(ep(n,"network-request-failed"))},Rre(`${jVe()}?onload=${y}`).catch(v=>s(v))}}).catch(t=>{throw rk=null,t})}let rk=null;function eje(n){return rk=rk||ZFe(n),rk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tje=new tR(5e3,15e3),nje="__/auth/iframe",rje="emulator/auth/iframe",ije={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},sje=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function oje(n){const t=n.config;Bn(t.authDomain,n,"auth-domain-config-required");const s=t.emulator?Vj(t,rje):`https://${n.config.authDomain}/${nje}`,a={apiKey:t.apiKey,appName:n.name,v:Wy},l=sje.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${eR(a).slice(1)}`}async function aje(n){const t=await eje(n),s=tp().gapi;return Bn(s,n,"internal-error"),t.open({where:document.body,url:oje(n),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ije,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=ep(n,"network-request-failed"),y=tp().setTimeout(()=>{d(f)},tje.get());function v(){tp().clearTimeout(y),l(a)}a.ping(v).then(v,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cje={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},lje=500,uje=600,dje="_blank",hje="http://localhost";class yX{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function pje(n,t,s,a=lje,l=uje){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let y="";const v=Object.assign(Object.assign({},cje),{width:a.toString(),height:l.toString(),top:d,left:f}),b=Ja().toLowerCase();s&&(y=Ere(b)?dje:s),_re(b)&&(t=t||hje,v.scrollbars="yes");const w=Object.entries(v).reduce((k,[x,F])=>`${k}${x}=${F},`,"");if(kVe(b)&&y!=="_self")return fje(t||"",y),new yX(null);const I=window.open(t||"",y,w);Bn(I,n,"popup-blocked");try{I.focus()}catch{}return new yX(I)}function fje(n,t){const s=document.createElement("a");s.href=n,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mje="__/auth/handler",gje="emulator/auth/handler",_je=encodeURIComponent("fac");async function EX(n,t,s,a,l,d){Bn(n.config.authDomain,n,"auth-domain-config-required"),Bn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:s,redirectUrl:a,v:Wy,eventId:l};if(t instanceof Ore){t.setDefaultLanguage(n.languageCode),f.providerId=t.providerId||"",eUe(t.getCustomParameters())||(f.customParameters=JSON.stringify(t.getCustomParameters()));for(const[w,I]of Object.entries({}))f[w]=I}if(t instanceof rR){const w=t.getScopes().filter(I=>I!=="");w.length>0&&(f.scopes=w.join(","))}n.tenantId&&(f.tid=n.tenantId);const y=f;for(const w of Object.keys(y))y[w]===void 0&&delete y[w];const v=await n._getAppCheckToken(),b=v?`#${_je}=${encodeURIComponent(v)}`:"";return`${yje(n)}?${eR(y).slice(1)}${b}`}function yje({config:n}){return n.emulator?Vj(n,gje):`https://${n.authDomain}/${mje}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qM="webStorageSupport";class Eje{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Vre,this._completeRedirectFn=zFe,this._overrideRedirectResult=jFe}async _openPopup(t,s,a,l){var d;Ff((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await EX(t,s,a,pV(),l);return pje(t,f,zj())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await EX(t,s,a,pV(),l);return bFe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(Ff(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await aje(t),a=new HFe(t);return s.register("authEvent",l=>(Bn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(qM,{type:qM},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[qM];f!==void 0&&s(!!f),Dd(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=XFe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return wre()||yre()||jj()}}const vje=Eje;var vX="@firebase/auth",SX="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sje{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Bn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bje(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Tje(n){Dy(new Sg("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:f,authDomain:y}=a.options;Bn(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:f,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Cre(n)},b=new UVe(a,l,d,v);return KVe(b,s),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),Dy(new Sg("auth-internal",t=>{const s=Dg(t.getProvider("auth").getImmediate());return(a=>new Sje(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Zh(vX,SX,bje(n)),Zh(vX,SX,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wje=5*60,Cje=tre("authIdTokenMaxAge")||wje;let bX=null;const Rje=n=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>Cje)return;const l=s==null?void 0:s.token;bX!==l&&(bX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function UN(n=Mj()){const t=DN(n,"auth");if(t.isInitialized())return t.getImmediate();const s=$Ve(n,{popupRedirectResolver:vje,persistence:[kFe,EFe,Vre]}),a=tre("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=Rje(d.toString());fFe(s,f,()=>f(s.currentUser)),pFe(s,y=>f(y))}}const l=Qne("auth");return l&&qVe(s,`http://${l}`),s}function Ije(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}VVe({loadJS(n){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=t,a.onerror=l=>{const d=ep("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",Ije().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Tje("Browser");var TX=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var mg,Hre;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(q,X){function Q(){}Q.prototype=X.prototype,q.D=X.prototype,q.prototype=new Q,q.prototype.constructor=q,q.C=function(se,me,pe){for(var le=Array(arguments.length-2),Le=2;Le<arguments.length;Le++)le[Le-2]=arguments[Le];return X.prototype[me].apply(se,le)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(q,X,Q){Q||(Q=0);var se=Array(16);if(typeof X=="string")for(var me=0;16>me;++me)se[me]=X.charCodeAt(Q++)|X.charCodeAt(Q++)<<8|X.charCodeAt(Q++)<<16|X.charCodeAt(Q++)<<24;else for(me=0;16>me;++me)se[me]=X[Q++]|X[Q++]<<8|X[Q++]<<16|X[Q++]<<24;X=q.g[0],Q=q.g[1],me=q.g[2];var pe=q.g[3],le=X+(pe^Q&(me^pe))+se[0]+3614090360&4294967295;X=Q+(le<<7&4294967295|le>>>25),le=pe+(me^X&(Q^me))+se[1]+3905402710&4294967295,pe=X+(le<<12&4294967295|le>>>20),le=me+(Q^pe&(X^Q))+se[2]+606105819&4294967295,me=pe+(le<<17&4294967295|le>>>15),le=Q+(X^me&(pe^X))+se[3]+3250441966&4294967295,Q=me+(le<<22&4294967295|le>>>10),le=X+(pe^Q&(me^pe))+se[4]+4118548399&4294967295,X=Q+(le<<7&4294967295|le>>>25),le=pe+(me^X&(Q^me))+se[5]+1200080426&4294967295,pe=X+(le<<12&4294967295|le>>>20),le=me+(Q^pe&(X^Q))+se[6]+2821735955&4294967295,me=pe+(le<<17&4294967295|le>>>15),le=Q+(X^me&(pe^X))+se[7]+4249261313&4294967295,Q=me+(le<<22&4294967295|le>>>10),le=X+(pe^Q&(me^pe))+se[8]+1770035416&4294967295,X=Q+(le<<7&4294967295|le>>>25),le=pe+(me^X&(Q^me))+se[9]+2336552879&4294967295,pe=X+(le<<12&4294967295|le>>>20),le=me+(Q^pe&(X^Q))+se[10]+4294925233&4294967295,me=pe+(le<<17&4294967295|le>>>15),le=Q+(X^me&(pe^X))+se[11]+2304563134&4294967295,Q=me+(le<<22&4294967295|le>>>10),le=X+(pe^Q&(me^pe))+se[12]+1804603682&4294967295,X=Q+(le<<7&4294967295|le>>>25),le=pe+(me^X&(Q^me))+se[13]+4254626195&4294967295,pe=X+(le<<12&4294967295|le>>>20),le=me+(Q^pe&(X^Q))+se[14]+2792965006&4294967295,me=pe+(le<<17&4294967295|le>>>15),le=Q+(X^me&(pe^X))+se[15]+1236535329&4294967295,Q=me+(le<<22&4294967295|le>>>10),le=X+(me^pe&(Q^me))+se[1]+4129170786&4294967295,X=Q+(le<<5&4294967295|le>>>27),le=pe+(Q^me&(X^Q))+se[6]+3225465664&4294967295,pe=X+(le<<9&4294967295|le>>>23),le=me+(X^Q&(pe^X))+se[11]+643717713&4294967295,me=pe+(le<<14&4294967295|le>>>18),le=Q+(pe^X&(me^pe))+se[0]+3921069994&4294967295,Q=me+(le<<20&4294967295|le>>>12),le=X+(me^pe&(Q^me))+se[5]+3593408605&4294967295,X=Q+(le<<5&4294967295|le>>>27),le=pe+(Q^me&(X^Q))+se[10]+38016083&4294967295,pe=X+(le<<9&4294967295|le>>>23),le=me+(X^Q&(pe^X))+se[15]+3634488961&4294967295,me=pe+(le<<14&4294967295|le>>>18),le=Q+(pe^X&(me^pe))+se[4]+3889429448&4294967295,Q=me+(le<<20&4294967295|le>>>12),le=X+(me^pe&(Q^me))+se[9]+568446438&4294967295,X=Q+(le<<5&4294967295|le>>>27),le=pe+(Q^me&(X^Q))+se[14]+3275163606&4294967295,pe=X+(le<<9&4294967295|le>>>23),le=me+(X^Q&(pe^X))+se[3]+4107603335&4294967295,me=pe+(le<<14&4294967295|le>>>18),le=Q+(pe^X&(me^pe))+se[8]+1163531501&4294967295,Q=me+(le<<20&4294967295|le>>>12),le=X+(me^pe&(Q^me))+se[13]+2850285829&4294967295,X=Q+(le<<5&4294967295|le>>>27),le=pe+(Q^me&(X^Q))+se[2]+4243563512&4294967295,pe=X+(le<<9&4294967295|le>>>23),le=me+(X^Q&(pe^X))+se[7]+1735328473&4294967295,me=pe+(le<<14&4294967295|le>>>18),le=Q+(pe^X&(me^pe))+se[12]+2368359562&4294967295,Q=me+(le<<20&4294967295|le>>>12),le=X+(Q^me^pe)+se[5]+4294588738&4294967295,X=Q+(le<<4&4294967295|le>>>28),le=pe+(X^Q^me)+se[8]+2272392833&4294967295,pe=X+(le<<11&4294967295|le>>>21),le=me+(pe^X^Q)+se[11]+1839030562&4294967295,me=pe+(le<<16&4294967295|le>>>16),le=Q+(me^pe^X)+se[14]+4259657740&4294967295,Q=me+(le<<23&4294967295|le>>>9),le=X+(Q^me^pe)+se[1]+2763975236&4294967295,X=Q+(le<<4&4294967295|le>>>28),le=pe+(X^Q^me)+se[4]+1272893353&4294967295,pe=X+(le<<11&4294967295|le>>>21),le=me+(pe^X^Q)+se[7]+4139469664&4294967295,me=pe+(le<<16&4294967295|le>>>16),le=Q+(me^pe^X)+se[10]+3200236656&4294967295,Q=me+(le<<23&4294967295|le>>>9),le=X+(Q^me^pe)+se[13]+681279174&4294967295,X=Q+(le<<4&4294967295|le>>>28),le=pe+(X^Q^me)+se[0]+3936430074&4294967295,pe=X+(le<<11&4294967295|le>>>21),le=me+(pe^X^Q)+se[3]+3572445317&4294967295,me=pe+(le<<16&4294967295|le>>>16),le=Q+(me^pe^X)+se[6]+76029189&4294967295,Q=me+(le<<23&4294967295|le>>>9),le=X+(Q^me^pe)+se[9]+3654602809&4294967295,X=Q+(le<<4&4294967295|le>>>28),le=pe+(X^Q^me)+se[12]+3873151461&4294967295,pe=X+(le<<11&4294967295|le>>>21),le=me+(pe^X^Q)+se[15]+530742520&4294967295,me=pe+(le<<16&4294967295|le>>>16),le=Q+(me^pe^X)+se[2]+3299628645&4294967295,Q=me+(le<<23&4294967295|le>>>9),le=X+(me^(Q|~pe))+se[0]+4096336452&4294967295,X=Q+(le<<6&4294967295|le>>>26),le=pe+(Q^(X|~me))+se[7]+1126891415&4294967295,pe=X+(le<<10&4294967295|le>>>22),le=me+(X^(pe|~Q))+se[14]+2878612391&4294967295,me=pe+(le<<15&4294967295|le>>>17),le=Q+(pe^(me|~X))+se[5]+4237533241&4294967295,Q=me+(le<<21&4294967295|le>>>11),le=X+(me^(Q|~pe))+se[12]+1700485571&4294967295,X=Q+(le<<6&4294967295|le>>>26),le=pe+(Q^(X|~me))+se[3]+2399980690&4294967295,pe=X+(le<<10&4294967295|le>>>22),le=me+(X^(pe|~Q))+se[10]+4293915773&4294967295,me=pe+(le<<15&4294967295|le>>>17),le=Q+(pe^(me|~X))+se[1]+2240044497&4294967295,Q=me+(le<<21&4294967295|le>>>11),le=X+(me^(Q|~pe))+se[8]+1873313359&4294967295,X=Q+(le<<6&4294967295|le>>>26),le=pe+(Q^(X|~me))+se[15]+4264355552&4294967295,pe=X+(le<<10&4294967295|le>>>22),le=me+(X^(pe|~Q))+se[6]+2734768916&4294967295,me=pe+(le<<15&4294967295|le>>>17),le=Q+(pe^(me|~X))+se[13]+1309151649&4294967295,Q=me+(le<<21&4294967295|le>>>11),le=X+(me^(Q|~pe))+se[4]+4149444226&4294967295,X=Q+(le<<6&4294967295|le>>>26),le=pe+(Q^(X|~me))+se[11]+3174756917&4294967295,pe=X+(le<<10&4294967295|le>>>22),le=me+(X^(pe|~Q))+se[2]+718787259&4294967295,me=pe+(le<<15&4294967295|le>>>17),le=Q+(pe^(me|~X))+se[9]+3951481745&4294967295,q.g[0]=q.g[0]+X&4294967295,q.g[1]=q.g[1]+(me+(le<<21&4294967295|le>>>11))&4294967295,q.g[2]=q.g[2]+me&4294967295,q.g[3]=q.g[3]+pe&4294967295}a.prototype.u=function(q,X){X===void 0&&(X=q.length);for(var Q=X-this.blockSize,se=this.B,me=this.h,pe=0;pe<X;){if(me==0)for(;pe<=Q;)l(this,q,pe),pe+=this.blockSize;if(typeof q=="string"){for(;pe<X;)if(se[me++]=q.charCodeAt(pe++),me==this.blockSize){l(this,se),me=0;break}}else for(;pe<X;)if(se[me++]=q[pe++],me==this.blockSize){l(this,se),me=0;break}}this.h=me,this.o+=X},a.prototype.v=function(){var q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);q[0]=128;for(var X=1;X<q.length-8;++X)q[X]=0;var Q=8*this.o;for(X=q.length-8;X<q.length;++X)q[X]=Q&255,Q/=256;for(this.u(q),q=Array(16),X=Q=0;4>X;++X)for(var se=0;32>se;se+=8)q[Q++]=this.g[X]>>>se&255;return q};function d(q,X){var Q=y;return Object.prototype.hasOwnProperty.call(Q,q)?Q[q]:Q[q]=X(q)}function f(q,X){this.h=X;for(var Q=[],se=!0,me=q.length-1;0<=me;me--){var pe=q[me]|0;se&&pe==X||(Q[me]=pe,se=!1)}this.g=Q}var y={};function v(q){return-128<=q&&128>q?d(q,function(X){return new f([X|0],0>X?-1:0)}):new f([q|0],0>q?-1:0)}function b(q){if(isNaN(q)||!isFinite(q))return I;if(0>q)return z(b(-q));for(var X=[],Q=1,se=0;q>=Q;se++)X[se]=q/Q|0,Q*=4294967296;return new f(X,0)}function w(q,X){if(q.length==0)throw Error("number format error: empty string");if(X=X||10,2>X||36<X)throw Error("radix out of range: "+X);if(q.charAt(0)=="-")return z(w(q.substring(1),X));if(0<=q.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=b(Math.pow(X,8)),se=I,me=0;me<q.length;me+=8){var pe=Math.min(8,q.length-me),le=parseInt(q.substring(me,me+pe),X);8>pe?(pe=b(Math.pow(X,pe)),se=se.j(pe).add(b(le))):(se=se.j(Q),se=se.add(b(le)))}return se}var I=v(0),k=v(1),x=v(16777216);n=f.prototype,n.m=function(){if(B(this))return-z(this).m();for(var q=0,X=1,Q=0;Q<this.g.length;Q++){var se=this.i(Q);q+=(0<=se?se:4294967296+se)*X,X*=4294967296}return q},n.toString=function(q){if(q=q||10,2>q||36<q)throw Error("radix out of range: "+q);if(F(this))return"0";if(B(this))return"-"+z(this).toString(q);for(var X=b(Math.pow(q,6)),Q=this,se="";;){var me=ue(Q,X).g;Q=J(Q,me.j(X));var pe=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(q);if(Q=me,F(Q))return pe+se;for(;6>pe.length;)pe="0"+pe;se=pe+se}},n.i=function(q){return 0>q?0:q<this.g.length?this.g[q]:this.h};function F(q){if(q.h!=0)return!1;for(var X=0;X<q.g.length;X++)if(q.g[X]!=0)return!1;return!0}function B(q){return q.h==-1}n.l=function(q){return q=J(this,q),B(q)?-1:F(q)?0:1};function z(q){for(var X=q.g.length,Q=[],se=0;se<X;se++)Q[se]=~q.g[se];return new f(Q,~q.h).add(k)}n.abs=function(){return B(this)?z(this):this},n.add=function(q){for(var X=Math.max(this.g.length,q.g.length),Q=[],se=0,me=0;me<=X;me++){var pe=se+(this.i(me)&65535)+(q.i(me)&65535),le=(pe>>>16)+(this.i(me)>>>16)+(q.i(me)>>>16);se=le>>>16,pe&=65535,le&=65535,Q[me]=le<<16|pe}return new f(Q,Q[Q.length-1]&-2147483648?-1:0)};function J(q,X){return q.add(z(X))}n.j=function(q){if(F(this)||F(q))return I;if(B(this))return B(q)?z(this).j(z(q)):z(z(this).j(q));if(B(q))return z(this.j(z(q)));if(0>this.l(x)&&0>q.l(x))return b(this.m()*q.m());for(var X=this.g.length+q.g.length,Q=[],se=0;se<2*X;se++)Q[se]=0;for(se=0;se<this.g.length;se++)for(var me=0;me<q.g.length;me++){var pe=this.i(se)>>>16,le=this.i(se)&65535,Le=q.i(me)>>>16,We=q.i(me)&65535;Q[2*se+2*me]+=le*We,$(Q,2*se+2*me),Q[2*se+2*me+1]+=pe*We,$(Q,2*se+2*me+1),Q[2*se+2*me+1]+=le*Le,$(Q,2*se+2*me+1),Q[2*se+2*me+2]+=pe*Le,$(Q,2*se+2*me+2)}for(se=0;se<X;se++)Q[se]=Q[2*se+1]<<16|Q[2*se];for(se=X;se<2*X;se++)Q[se]=0;return new f(Q,0)};function $(q,X){for(;(q[X]&65535)!=q[X];)q[X+1]+=q[X]>>>16,q[X]&=65535,X++}function ie(q,X){this.g=q,this.h=X}function ue(q,X){if(F(X))throw Error("division by zero");if(F(q))return new ie(I,I);if(B(q))return X=ue(z(q),X),new ie(z(X.g),z(X.h));if(B(X))return X=ue(q,z(X)),new ie(z(X.g),X.h);if(30<q.g.length){if(B(q)||B(X))throw Error("slowDivide_ only works with positive integers.");for(var Q=k,se=X;0>=se.l(q);)Q=re(Q),se=re(se);var me=fe(Q,1),pe=fe(se,1);for(se=fe(se,2),Q=fe(Q,2);!F(se);){var le=pe.add(se);0>=le.l(q)&&(me=me.add(Q),pe=le),se=fe(se,1),Q=fe(Q,1)}return X=J(q,me.j(X)),new ie(me,X)}for(me=I;0<=q.l(X);){for(Q=Math.max(1,Math.floor(q.m()/X.m())),se=Math.ceil(Math.log(Q)/Math.LN2),se=48>=se?1:Math.pow(2,se-48),pe=b(Q),le=pe.j(X);B(le)||0<le.l(q);)Q-=se,pe=b(Q),le=pe.j(X);F(pe)&&(pe=k),me=me.add(pe),q=J(q,le)}return new ie(me,q)}n.A=function(q){return ue(this,q).h},n.and=function(q){for(var X=Math.max(this.g.length,q.g.length),Q=[],se=0;se<X;se++)Q[se]=this.i(se)&q.i(se);return new f(Q,this.h&q.h)},n.or=function(q){for(var X=Math.max(this.g.length,q.g.length),Q=[],se=0;se<X;se++)Q[se]=this.i(se)|q.i(se);return new f(Q,this.h|q.h)},n.xor=function(q){for(var X=Math.max(this.g.length,q.g.length),Q=[],se=0;se<X;se++)Q[se]=this.i(se)^q.i(se);return new f(Q,this.h^q.h)};function re(q){for(var X=q.g.length+1,Q=[],se=0;se<X;se++)Q[se]=q.i(se)<<1|q.i(se-1)>>>31;return new f(Q,q.h)}function fe(q,X){var Q=X>>5;X%=32;for(var se=q.g.length-Q,me=[],pe=0;pe<se;pe++)me[pe]=0<X?q.i(pe+Q)>>>X|q.i(pe+Q+1)<<32-X:q.i(pe+Q);return new f(me,q.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Hre=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=w,mg=f}).apply(typeof TX<"u"?TX:typeof self<"u"?self:typeof window<"u"?window:{});var EO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $re,Uw,Kre,ik,gV,qre,Yre,Xre;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,W,ne){return A==Array.prototype||A==Object.prototype||(A[W]=ne.value),A};function s(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof EO=="object"&&EO];for(var W=0;W<A.length;++W){var ne=A[W];if(ne&&ne.Math==Math)return ne}throw Error("Cannot find global object")}var a=s(this);function l(A,W){if(W)e:{var ne=a;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var qe=A[ge];if(!(qe in ne))break e;ne=ne[qe]}A=A[A.length-1],ge=ne[A],W=W(ge),W!=ge&&W!=null&&t(ne,A,{configurable:!0,writable:!0,value:W})}}function d(A,W){A instanceof String&&(A+="");var ne=0,ge=!1,qe={next:function(){if(!ge&&ne<A.length){var at=ne++;return{value:W(at,A[at]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(A){return A||function(){return d(this,function(W,ne){return ne})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},y=this||self;function v(A){var W=typeof A;return W=W!="object"?W:A?Array.isArray(A)?"array":W:"null",W=="array"||W=="object"&&typeof A.length=="number"}function b(A){var W=typeof A;return W=="object"&&A!=null||W=="function"}function w(A,W,ne){return A.call.apply(A.bind,arguments)}function I(A,W,ne){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,ge),A.apply(W,qe)}}return function(){return A.apply(W,arguments)}}function k(A,W,ne){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:I,k.apply(null,arguments)}function x(A,W){var ne=Array.prototype.slice.call(arguments,1);return function(){var ge=ne.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function F(A,W){function ne(){}ne.prototype=W.prototype,A.aa=W.prototype,A.prototype=new ne,A.prototype.constructor=A,A.Qb=function(ge,qe,at){for(var Vt=Array(arguments.length-2),Xr=2;Xr<arguments.length;Xr++)Vt[Xr-2]=arguments[Xr];return W.prototype[qe].apply(ge,Vt)}}function B(A){const W=A.length;if(0<W){const ne=Array(W);for(let ge=0;ge<W;ge++)ne[ge]=A[ge];return ne}return[]}function z(A,W){for(let ne=1;ne<arguments.length;ne++){const ge=arguments[ne];if(v(ge)){const qe=A.length||0,at=ge.length||0;A.length=qe+at;for(let Vt=0;Vt<at;Vt++)A[qe+Vt]=ge[Vt]}else A.push(ge)}}class J{constructor(W,ne){this.i=W,this.j=ne,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function $(A){return/^[\s\xa0]*$/.test(A)}function ie(){var A=y.navigator;return A&&(A=A.userAgent)?A:""}function ue(A){return ue[" "](A),A}ue[" "]=function(){};var re=ie().indexOf("Gecko")!=-1&&!(ie().toLowerCase().indexOf("webkit")!=-1&&ie().indexOf("Edge")==-1)&&!(ie().indexOf("Trident")!=-1||ie().indexOf("MSIE")!=-1)&&ie().indexOf("Edge")==-1;function fe(A,W,ne){for(const ge in A)W.call(ne,A[ge],ge,A)}function q(A,W){for(const ne in A)W.call(void 0,A[ne],ne,A)}function X(A){const W={};for(const ne in A)W[ne]=A[ne];return W}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(A,W){let ne,ge;for(let qe=1;qe<arguments.length;qe++){ge=arguments[qe];for(ne in ge)A[ne]=ge[ne];for(let at=0;at<Q.length;at++)ne=Q[at],Object.prototype.hasOwnProperty.call(ge,ne)&&(A[ne]=ge[ne])}}function me(A){var W=1;A=A.split(":");const ne=[];for(;0<W&&A.length;)ne.push(A.shift()),W--;return A.length&&ne.push(A.join(":")),ne}function pe(A){y.setTimeout(()=>{throw A},0)}function le(){var A=Ee;let W=null;return A.g&&(W=A.g,A.g=A.g.next,A.g||(A.h=null),W.next=null),W}class Le{constructor(){this.h=this.g=null}add(W,ne){const ge=We.get();ge.set(W,ne),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var We=new J(()=>new $e,A=>A.reset());class $e{constructor(){this.next=this.g=this.h=null}set(W,ne){this.h=W,this.g=ne,this.next=null}reset(){this.next=this.g=this.h=null}}let ve,_e=!1,Ee=new Le,ke=()=>{const A=y.Promise.resolve(void 0);ve=()=>{A.then(we)}};var we=()=>{for(var A;A=le();){try{A.h.call(A.g)}catch(ne){pe(ne)}var W=We;W.j(A),100>W.h&&(W.h++,A.next=W.g,W.g=A)}_e=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ie(A,W){this.type=A,this.g=this.target=W,this.defaultPrevented=!1}Ie.prototype.h=function(){this.defaultPrevented=!0};var Me=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var A=!1,W=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const ne=()=>{};y.addEventListener("test",ne,W),y.removeEventListener("test",ne,W)}catch{}return A}();function ze(A,W){if(Ie.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var ne=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=W,W=A.relatedTarget){if(re){e:{try{ue(W.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(W=null)}}else ne=="mouseover"?W=A.fromElement:ne=="mouseout"&&(W=A.toElement);this.relatedTarget=W,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:Je[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&ze.aa.h.call(this)}}F(ze,Ie);var Je={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var tt="closure_listenable_"+(1e6*Math.random()|0),ut=0;function Ze(A,W,ne,ge,qe){this.listener=A,this.proxy=null,this.src=W,this.type=ne,this.capture=!!ge,this.ha=qe,this.key=++ut,this.da=this.fa=!1}function vt(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function sn(A){this.src=A,this.g={},this.h=0}sn.prototype.add=function(A,W,ne,ge,qe){var at=A.toString();A=this.g[at],A||(A=this.g[at]=[],this.h++);var Vt=Qt(A,W,ge,qe);return-1<Vt?(W=A[Vt],ne||(W.fa=!1)):(W=new Ze(W,this.src,at,!!ge,qe),W.fa=ne,A.push(W)),W};function Mt(A,W){var ne=W.type;if(ne in A.g){var ge=A.g[ne],qe=Array.prototype.indexOf.call(ge,W,void 0),at;(at=0<=qe)&&Array.prototype.splice.call(ge,qe,1),at&&(vt(W),A.g[ne].length==0&&(delete A.g[ne],A.h--))}}function Qt(A,W,ne,ge){for(var qe=0;qe<A.length;++qe){var at=A[qe];if(!at.da&&at.listener==W&&at.capture==!!ne&&at.ha==ge)return qe}return-1}var on="closure_lm_"+(1e6*Math.random()|0),Ht={};function jn(A,W,ne,ge,qe){if(Array.isArray(W)){for(var at=0;at<W.length;at++)jn(A,W[at],ne,ge,qe);return null}return ne=mn(ne),A&&A[tt]?A.K(W,ne,b(ge)?!!ge.capture:!1,qe):Wt(A,W,ne,!1,ge,qe)}function Wt(A,W,ne,ge,qe,at){if(!W)throw Error("Invalid event type");var Vt=b(qe)?!!qe.capture:!!qe,Xr=yt(A);if(Xr||(A[on]=Xr=new sn(A)),ne=Xr.add(W,ne,ge,Vt,at),ne.proxy)return ne;if(ge=Re(),ne.proxy=ge,ge.src=A,ge.listener=ne,A.addEventListener)Me||(qe=Vt),qe===void 0&&(qe=!1),A.addEventListener(W.toString(),ge,qe);else if(A.attachEvent)A.attachEvent(ot(W.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return ne}function Re(){function A(ne){return W.call(A.src,A.listener,ne)}const W=_t;return A}function Fe(A,W,ne,ge,qe){if(Array.isArray(W))for(var at=0;at<W.length;at++)Fe(A,W[at],ne,ge,qe);else ge=b(ge)?!!ge.capture:!!ge,ne=mn(ne),A&&A[tt]?(A=A.i,W=String(W).toString(),W in A.g&&(at=A.g[W],ne=Qt(at,ne,ge,qe),-1<ne&&(vt(at[ne]),Array.prototype.splice.call(at,ne,1),at.length==0&&(delete A.g[W],A.h--)))):A&&(A=yt(A))&&(W=A.g[W.toString()],A=-1,W&&(A=Qt(W,ne,ge,qe)),(ne=-1<A?W[A]:null)&&Ge(ne))}function Ge(A){if(typeof A!="number"&&A&&!A.da){var W=A.src;if(W&&W[tt])Mt(W.i,A);else{var ne=A.type,ge=A.proxy;W.removeEventListener?W.removeEventListener(ne,ge,A.capture):W.detachEvent?W.detachEvent(ot(ne),ge):W.addListener&&W.removeListener&&W.removeListener(ge),(ne=yt(W))?(Mt(ne,A),ne.h==0&&(ne.src=null,W[on]=null)):vt(A)}}}function ot(A){return A in Ht?Ht[A]:Ht[A]="on"+A}function _t(A,W){if(A.da)A=!0;else{W=new ze(W,this);var ne=A.listener,ge=A.ha||A.src;A.fa&&Ge(A),A=ne.call(ge,W)}return A}function yt(A){return A=A[on],A instanceof sn?A:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function mn(A){return typeof A=="function"?A:(A[Gt]||(A[Gt]=function(W){return A.handleEvent(W)}),A[Gt])}function Pn(){be.call(this),this.i=new sn(this),this.M=this,this.F=null}F(Pn,be),Pn.prototype[tt]=!0,Pn.prototype.removeEventListener=function(A,W,ne,ge){Fe(this,A,W,ne,ge)};function un(A,W){var ne,ge=A.F;if(ge)for(ne=[];ge;ge=ge.F)ne.push(ge);if(A=A.M,ge=W.type||W,typeof W=="string")W=new Ie(W,A);else if(W instanceof Ie)W.target=W.target||A;else{var qe=W;W=new Ie(ge,A),se(W,qe)}if(qe=!0,ne)for(var at=ne.length-1;0<=at;at--){var Vt=W.g=ne[at];qe=bt(Vt,ge,!0,W)&&qe}if(Vt=W.g=A,qe=bt(Vt,ge,!0,W)&&qe,qe=bt(Vt,ge,!1,W)&&qe,ne)for(at=0;at<ne.length;at++)Vt=W.g=ne[at],qe=bt(Vt,ge,!1,W)&&qe}Pn.prototype.N=function(){if(Pn.aa.N.call(this),this.i){var A=this.i,W;for(W in A.g){for(var ne=A.g[W],ge=0;ge<ne.length;ge++)vt(ne[ge]);delete A.g[W],A.h--}}this.F=null},Pn.prototype.K=function(A,W,ne,ge){return this.i.add(String(A),W,!1,ne,ge)},Pn.prototype.L=function(A,W,ne,ge){return this.i.add(String(A),W,!0,ne,ge)};function bt(A,W,ne,ge){if(W=A.i.g[String(W)],!W)return!0;W=W.concat();for(var qe=!0,at=0;at<W.length;++at){var Vt=W[at];if(Vt&&!Vt.da&&Vt.capture==ne){var Xr=Vt.listener,hi=Vt.ha||Vt.src;Vt.fa&&Mt(A.i,Vt),qe=Xr.call(hi,ge)!==!1&&qe}}return qe&&!ge.defaultPrevented}function lr(A,W,ne){if(typeof A=="function")ne&&(A=k(A,ne));else if(A&&typeof A.handleEvent=="function")A=k(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:y.setTimeout(A,W||0)}function Nt(A){A.g=lr(()=>{A.g=null,A.i&&(A.i=!1,Nt(A))},A.l);const W=A.h;A.h=null,A.m.apply(null,W)}class Kt extends be{constructor(W,ne){super(),this.m=W,this.l=ne,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:Nt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qr(A){be.call(this),this.h=A,this.g={}}F(qr,be);var ji=[];function Ms(A){fe(A.g,function(W,ne){this.g.hasOwnProperty(ne)&&Ge(W)},A),A.g={}}qr.prototype.N=function(){qr.aa.N.call(this),Ms(this)},qr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ii=y.JSON.stringify,Ot=y.JSON.parse,On=class{stringify(A){return y.JSON.stringify(A,void 0)}parse(A){return y.JSON.parse(A,void 0)}};function or(){}or.prototype.h=null;function xi(A){return A.h||(A.h=A.i())}function bc(){}var cs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Sa(){Ie.call(this,"d")}F(Sa,Ie);function vo(){Ie.call(this,"c")}F(vo,Ie);var ba={},Ta=null;function ro(){return Ta=Ta||new Pn}ba.La="serverreachability";function _s(A){Ie.call(this,ba.La,A)}F(_s,Ie);function ls(A){const W=ro();un(W,new _s(W))}ba.STAT_EVENT="statevent";function jo(A,W){Ie.call(this,ba.STAT_EVENT,A),this.stat=W}F(jo,Ie);function Bi(A){const W=ro();un(W,new jo(W,A))}ba.Ma="timingevent";function ys(A,W){Ie.call(this,ba.Ma,A),this.size=W}F(ys,Ie);function Za(A,W){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){A()},W)}function Uu(){this.g=!0}Uu.prototype.xa=function(){this.g=!1};function Tc(A,W,ne,ge,qe,at){A.info(function(){if(A.g)if(at)for(var Vt="",Xr=at.split("&"),hi=0;hi<Xr.length;hi++){var br=Xr[hi].split("=");if(1<br.length){var Ys=br[0];br=br[1];var vs=Ys.split("_");Vt=2<=vs.length&&vs[1]=="type"?Vt+(Ys+"="+br+"&"):Vt+(Ys+"=redacted&")}}else Vt=null;else Vt=at;return"XMLHTTP REQ ("+ge+") [attempt "+qe+"]: "+W+`
`+ne+`
`+Vt})}function wa(A,W,ne,ge,qe,at,Vt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+qe+"]: "+W+`
`+ne+`
`+at+" "+Vt})}function Ca(A,W,ne,ge){A.info(function(){return"XMLHTTP TEXT ("+W+"): "+Mg(A,ne)+(ge?" "+ge:"")})}function Ud(A,W){A.info(function(){return"TIMEOUT: "+W})}Uu.prototype.info=function(){};function Mg(A,W){if(!A.g)return W;if(!W)return null;try{var ne=JSON.parse(W);if(ne){for(A=0;A<ne.length;A++)if(Array.isArray(ne[A])){var ge=ne[A];if(!(2>ge.length)){var qe=ge[1];if(Array.isArray(qe)&&!(1>qe.length)){var at=qe[0];if(at!="noop"&&at!="stop"&&at!="close")for(var Vt=1;Vt<qe.length;Vt++)qe[Vt]=""}}}}return ii(ne)}catch{return W}}var Vu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},hp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},qs;function Fu(){}F(Fu,or),Fu.prototype.g=function(){return new XMLHttpRequest},Fu.prototype.i=function(){return{}},qs=new Fu;function Ra(A,W,ne,ge){this.j=A,this.i=W,this.l=ne,this.R=ge||1,this.U=new qr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Vd}function Vd(){this.i=null,this.g="",this.h=!1}var Fd={},ec={};function jd(A,W,ne){A.L=1,A.v=nc(Wo(W)),A.m=ne,A.P=!0,ju(A,null)}function ju(A,W){A.F=Date.now(),zr(A),A.A=Wo(A.v);var ne=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),Kl(ne.i,"t",ge),A.C=0,ne=A.j.J,A.h=new Vd,A.g=Jy(A.j,ne?W:null,!A.m),0<A.O&&(A.M=new Kt(k(A.Y,A,A.g),A.O)),W=A.U,ne=A.g,ge=A.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(ji[0]=qe.toString()),qe=ji);for(var at=0;at<qe.length;at++){var Vt=jn(ne,qe[at],ge||W.handleEvent,!1,W.h||W);if(!Vt)break;W.g[Vt.key]=Vt}W=A.H?X(A.H):{},A.m?(A.u||(A.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,W)):(A.u="GET",A.g.ea(A.A,A.u,null,W)),ls(),Tc(A.i,A.u,A.A,A.l,A.R,A.m)}Ra.prototype.ca=function(A){A=A.target;const W=this.M;W&&bi(A)==3?W.j():this.Y(A)},Ra.prototype.Y=function(A){try{if(A==this.g)e:{const vs=bi(this.g);var W=this.g.Ba();const rc=this.g.Z();if(!(3>vs)&&(vs!=3||this.g&&(this.h.h||this.g.oa()||Us(this.g)))){this.J||vs!=4||W==7||(W==8||0>=rc?ls(3):ls(2)),wc(this);var ne=this.g.Z();this.X=ne;t:if(Bo(this)){var ge=Us(this.g);A="";var qe=ge.length,at=bi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ia(this),dl(this);var Vt="";break t}this.h.i=new y.TextDecoder}for(W=0;W<qe;W++)this.h.h=!0,A+=this.h.i.decode(ge[W],{stream:!(at&&W==qe-1)});ge.length=0,this.h.g+=A,this.C=0,Vt=this.h.g}else Vt=this.g.oa();if(this.o=ne==200,wa(this.i,this.u,this.A,this.l,this.R,vs,ne),this.o){if(this.T&&!this.K){t:{if(this.g){var Xr,hi=this.g;if((Xr=hi.g?hi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(Xr)){var br=Xr;break t}}br=null}if(ne=br)Ca(this.i,this.l,ne,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,pp(this,ne);else{this.o=!1,this.s=3,Bi(12),Ia(this),dl(this);break e}}if(this.P){ne=!0;let Qo;for(;!this.J&&this.C<Vt.length;)if(Qo=Bd(this,Vt),Qo==ec){vs==4&&(this.s=4,Bi(14),ne=!1),Ca(this.i,this.l,null,"[Incomplete Response]");break}else if(Qo==Fd){this.s=4,Bi(15),Ca(this.i,this.l,Vt,"[Invalid Chunk]"),ne=!1;break}else Ca(this.i,this.l,Qo,null),pp(this,Qo);if(Bo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),vs!=4||Vt.length!=0||this.h.h||(this.s=1,Bi(16),ne=!1),this.o=this.o&&ne,!ne)Ca(this.i,this.l,Vt,"[Invalid Chunked Response]"),Ia(this),dl(this);else if(0<Vt.length&&!this.W){this.W=!0;var Ys=this.j;Ys.g==this&&Ys.ba&&!Ys.M&&(Ys.j.info("Great, no buffering proxy detected. Bytes received: "+Vt.length),Vg(Ys),Ys.M=!0,Bi(11))}}else Ca(this.i,this.l,Vt,null),pp(this,Vt);vs==4&&Ia(this),this.o&&!this.J&&(vs==4?Zf(this.j,this):(this.o=!1,zr(this)))}else qo(this.g),ne==400&&0<Vt.indexOf("Unknown SID")?(this.s=3,Bi(12)):(this.s=0,Bi(13)),Ia(this),dl(this)}}}catch{}finally{}};function Bo(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function Bd(A,W){var ne=A.C,ge=W.indexOf(`
`,ne);return ge==-1?ec:(ne=Number(W.substring(ne,ge)),isNaN(ne)?Fd:(ge+=1,ge+ne>W.length?ec:(W=W.slice(ge,ge+ne),A.C=ge+ne,W)))}Ra.prototype.cancel=function(){this.J=!0,Ia(this)};function zr(A){A.S=Date.now()+A.I,Si(A,A.I)}function Si(A,W){if(A.B!=null)throw Error("WatchDog timer not null");A.B=Za(k(A.ba,A),W)}function wc(A){A.B&&(y.clearTimeout(A.B),A.B=null)}Ra.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(Ud(this.i,this.A),this.L!=2&&(ls(),Bi(17)),Ia(this),this.s=2,dl(this)):Si(this,this.S-A)};function dl(A){A.j.G==0||A.J||Zf(A.j,A)}function Ia(A){wc(A);var W=A.M;W&&typeof W.ma=="function"&&W.ma(),A.M=null,Ms(A.U),A.g&&(W=A.g,A.g=null,W.abort(),W.ma())}function pp(A,W){try{var ne=A.j;if(ne.G!=0&&(ne.g==A||io(ne.h,A))){if(!A.K&&io(ne.h,A)&&ne.G==3){try{var ge=ne.Da.g.parse(W)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var qe=ge;if(qe[0]==0){e:if(!ne.u){if(ne.g)if(ne.g.F+3e3<A.F)Qf(ne),gl(ne);else break e;Jf(ne),Bi(18)}}else ne.za=qe[1],0<ne.za-ne.T&&37500>qe[2]&&ne.F&&ne.v==0&&!ne.C&&(ne.C=Za(k(ne.Za,ne),6e3));if(1>=Hf(ne.h)&&ne.ca){try{ne.ca()}catch{}ne.ca=void 0}}else Ku(ne,11)}else if((A.K||ne.g==A)&&Qf(ne),!$(W))for(qe=ne.Da.g.parse(W),W=0;W<qe.length;W++){let br=qe[W];if(ne.T=br[0],br=br[1],ne.G==2)if(br[0]=="c"){ne.K=br[1],ne.ia=br[2];const Ys=br[3];Ys!=null&&(ne.la=Ys,ne.j.info("VER="+ne.la));const vs=br[4];vs!=null&&(ne.Aa=vs,ne.j.info("SVER="+ne.Aa));const rc=br[5];rc!=null&&typeof rc=="number"&&0<rc&&(ge=1.5*rc,ne.L=ge,ne.j.info("backChannelRequestTimeoutMs_="+ge)),ge=ne;const Qo=A.g;if(Qo){const yp=Qo.g?Qo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yp){var at=ge.h;at.g||yp.indexOf("spdy")==-1&&yp.indexOf("quic")==-1&&yp.indexOf("h2")==-1||(at.j=at.l,at.g=new Set,at.h&&(fp(at,at.h),at.h=null))}if(ge.D){const tm=Qo.g?Qo.g.getResponseHeader("X-HTTP-Session-Id"):null;tm&&(ge.ya=tm,Yr(ge.I,ge.D,tm))}}ne.G=3,ne.l&&ne.l.ua(),ne.ba&&(ne.R=Date.now()-A.F,ne.j.info("Handshake RTT: "+ne.R+"ms")),ge=ne;var Vt=A;if(ge.qa=Fg(ge,ge.J?ge.ia:null,ge.W),Vt.K){hl(ge.h,Vt);var Xr=Vt,hi=ge.L;hi&&(Xr.I=hi),Xr.B&&(wc(Xr),zr(Xr)),ge.g=Vt}else Yl(ge);0<ne.i.length&&Ic(ne)}else br[0]!="stop"&&br[0]!="close"||Ku(ne,7);else ne.G==3&&(br[0]=="stop"||br[0]=="close"?br[0]=="stop"?Ku(ne,7):es(ne):br[0]!="noop"&&ne.l&&ne.l.ta(br),ne.v=0)}}ls(4)}catch{}}var Wd=class{constructor(A,W){this.g=A,this.map=W}};function Wl(A){this.l=A||10,y.PerformanceNavigationTiming?(A=y.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function So(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function Hf(A){return A.h?1:A.g?A.g.size:0}function io(A,W){return A.h?A.h==W:A.g?A.g.has(W):!1}function fp(A,W){A.g?A.g.add(W):A.h=W}function hl(A,W){A.h&&A.h==W?A.h=null:A.g&&A.g.has(W)&&A.g.delete(W)}Wl.prototype.cancel=function(){if(this.i=zd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function zd(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let W=A.i;for(const ne of A.g.values())W=W.concat(ne.D);return W}return B(A.i)}function Gd(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(v(A)){for(var W=[],ne=A.length,ge=0;ge<ne;ge++)W.push(A[ge]);return W}W=[],ne=0;for(ge in A)W[ne++]=A[ge];return W}function gr(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(v(A)||typeof A=="string"){var W=[];A=A.length;for(var ne=0;ne<A;ne++)W.push(ne);return W}W=[],ne=0;for(const ge in A)W[ne++]=ge;return W}}}function zl(A,W){if(A.forEach&&typeof A.forEach=="function")A.forEach(W,void 0);else if(v(A)||typeof A=="string")Array.prototype.forEach.call(A,W,void 0);else for(var ne=gr(A),ge=Gd(A),qe=ge.length,at=0;at<qe;at++)W.call(void 0,ge[at],ne&&ne[at],A)}var Gl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Bu(A,W){if(A){A=A.split("&");for(var ne=0;ne<A.length;ne++){var ge=A[ne].indexOf("="),qe=null;if(0<=ge){var at=A[ne].substring(0,ge);qe=A[ne].substring(ge+1)}else at=A[ne];W(at,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function tc(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof tc){this.h=A.h,Wu(this,A.j),this.o=A.o,this.g=A.g,pl(this,A.s),this.l=A.l;var W=A.i,ne=new zo;ne.i=W.i,W.g&&(ne.g=new Map(W.g),ne.h=W.h),Hl(this,ne),this.m=A.m}else A&&(W=String(A).match(Gl))?(this.h=!1,Wu(this,W[1]||"",!0),this.o=ar(W[2]||""),this.g=ar(W[3]||"",!0),pl(this,W[4]),this.l=ar(W[5]||"",!0),Hl(this,W[6]||"",!0),this.m=ar(W[7]||"")):(this.h=!1,this.i=new zo(null,this.h))}tc.prototype.toString=function(){var A=[],W=this.j;W&&A.push(Cc(W,$l,!0),":");var ne=this.g;return(ne||W=="file")&&(A.push("//"),(W=this.o)&&A.push(Cc(W,$l,!0),"@"),A.push(encodeURIComponent(String(ne)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ne=this.s,ne!=null&&A.push(":",String(ne))),(ne=this.l)&&(this.g&&ne.charAt(0)!="/"&&A.push("/"),A.push(Cc(ne,ne.charAt(0)=="/"?mp:Hd,!0))),(ne=this.i.toString())&&A.push("?",ne),(ne=this.m)&&A.push("#",Cc(ne,gp)),A.join("")};function Wo(A){return new tc(A)}function Wu(A,W,ne){A.j=ne?ar(W,!0):W,A.j&&(A.j=A.j.replace(/:$/,""))}function pl(A,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);A.s=W}else A.s=null}function Hl(A,W,ne){W instanceof zo?(A.i=W,Ko(A.i,A.h)):(ne||(W=Cc(W,Kf)),A.i=new zo(W,A.h))}function Yr(A,W,ne){A.i.set(W,ne)}function nc(A){return Yr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function ar(A,W){return A?W?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Cc(A,W,ne){return typeof A=="string"?(A=encodeURI(A).replace(W,$f),ne&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function $f(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var $l=/[#\/\?@]/g,Hd=/[#\?:]/g,mp=/[#\?]/g,Kf=/[#\?@]/g,gp=/#/g;function zo(A,W){this.h=this.g=null,this.i=A||null,this.j=!!W}function us(A){A.g||(A.g=new Map,A.h=0,A.i&&Bu(A.i,function(W,ne){A.add(decodeURIComponent(W.replace(/\+/g," ")),ne)}))}n=zo.prototype,n.add=function(A,W){us(this),this.i=null,A=$o(this,A);var ne=this.g.get(A);return ne||this.g.set(A,ne=[]),ne.push(W),this.h+=1,this};function Go(A,W){us(A),W=$o(A,W),A.g.has(W)&&(A.i=null,A.h-=A.g.get(W).length,A.g.delete(W))}function Ho(A,W){return us(A),W=$o(A,W),A.g.has(W)}n.forEach=function(A,W){us(this),this.g.forEach(function(ne,ge){ne.forEach(function(qe){A.call(W,qe,ge,this)},this)},this)},n.na=function(){us(this);const A=Array.from(this.g.values()),W=Array.from(this.g.keys()),ne=[];for(let ge=0;ge<W.length;ge++){const qe=A[ge];for(let at=0;at<qe.length;at++)ne.push(W[ge])}return ne},n.V=function(A){us(this);let W=[];if(typeof A=="string")Ho(this,A)&&(W=W.concat(this.g.get($o(this,A))));else{A=Array.from(this.g.values());for(let ne=0;ne<A.length;ne++)W=W.concat(A[ne])}return W},n.set=function(A,W){return us(this),this.i=null,A=$o(this,A),Ho(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[W]),this.h+=1,this},n.get=function(A,W){return A?(A=this.V(A),0<A.length?String(A[0]):W):W};function Kl(A,W,ne){Go(A,W),0<ne.length&&(A.i=null,A.g.set($o(A,W),B(ne)),A.h+=ne.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],W=Array.from(this.g.keys());for(var ne=0;ne<W.length;ne++){var ge=W[ne];const at=encodeURIComponent(String(ge)),Vt=this.V(ge);for(ge=0;ge<Vt.length;ge++){var qe=at;Vt[ge]!==""&&(qe+="="+encodeURIComponent(String(Vt[ge]))),A.push(qe)}}return this.i=A.join("&")};function $o(A,W){return W=String(W),A.j&&(W=W.toLowerCase()),W}function Ko(A,W){W&&!A.j&&(us(A),A.i=null,A.g.forEach(function(ne,ge){var qe=ge.toLowerCase();ge!=qe&&(Go(this,ge),Kl(this,qe,ne))},A)),A.j=W}function qf(A,W){const ne=new Uu;if(y.Image){const ge=new Image;ge.onload=x(Es,ne,"TestLoadImage: loaded",!0,W,ge),ge.onerror=x(Es,ne,"TestLoadImage: error",!1,W,ge),ge.onabort=x(Es,ne,"TestLoadImage: abort",!1,W,ge),ge.ontimeout=x(Es,ne,"TestLoadImage: timeout",!1,W,ge),y.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else W(!1)}function Rc(A,W){const ne=new Uu,ge=new AbortController,qe=setTimeout(()=>{ge.abort(),Es(ne,"TestPingServer: timeout",!1,W)},1e4);fetch(A,{signal:ge.signal}).then(at=>{clearTimeout(qe),at.ok?Es(ne,"TestPingServer: ok",!0,W):Es(ne,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout(qe),Es(ne,"TestPingServer: error",!1,W)})}function Es(A,W,ne,ge,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),ge(ne)}catch{}}function zu(){this.g=new On}function _p(A,W,ne){const ge=ne||"";try{zl(A,function(qe,at){let Vt=qe;b(qe)&&(Vt=ii(qe)),W.push(ge+at+"="+encodeURIComponent(Vt))})}catch(qe){throw W.push(ge+"type="+encodeURIComponent("_badmap")),qe}}function fl(A){this.l=A.Ub||null,this.j=A.eb||!1}F(fl,or),fl.prototype.g=function(){return new ql(this.l,this.j)},fl.prototype.i=function(A){return function(){return A}}({});function ql(A,W){Pn.call(this),this.D=A,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}F(ql,Pn),n=ql.prototype,n.open=function(A,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=W,this.readyState=1,Pa(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(W.body=A),(this.D||y).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Aa(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,Pa(this)),this.g&&(this.readyState=3,Pa(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Yf(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function Yf(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var W=A.value?A.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!A.done}))&&(this.response=this.responseText+=W)}A.done?Aa(this):Pa(this),this.readyState==3&&Yf(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,Aa(this))},n.Qa=function(A){this.g&&(this.response=A,Aa(this))},n.ga=function(){this.g&&Aa(this)};function Aa(A){A.readyState=4,A.l=null,A.j=null,A.v=null,Pa(A)}n.setRequestHeader=function(A,W){this.u.append(A,W)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],W=this.h.entries();for(var ne=W.next();!ne.done;)ne=ne.value,A.push(ne[0]+": "+ne[1]),ne=W.next();return A.join(`\r
`)};function Pa(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(ql.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function ml(A){let W="";return fe(A,function(ne,ge){W+=ge,W+=":",W+=ne,W+=`\r
`}),W}function Ce(A,W,ne){e:{for(ge in ne){var ge=!1;break e}ge=!0}ge||(ne=ml(ne),typeof A=="string"?ne!=null&&encodeURIComponent(String(ne)):Yr(A,W,ne))}function De(A){Pn.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}F(De,Pn);var nt=/^https?$/i,Jt=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,W,ne,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);W=W?W.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():qs.g(),this.v=this.o?xi(this.o):xi(qs),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(W,String(A),!0),this.B=!1}catch(at){Jn(this,at);return}if(A=ne||"",ne=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var qe in ge)ne.set(qe,ge[qe]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const at of ge.keys())ne.set(at,ge.get(at));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(ne.keys()).find(at=>at.toLowerCase()=="content-type"),qe=y.FormData&&A instanceof y.FormData,!(0<=Array.prototype.indexOf.call(Jt,W,void 0))||ge||qe||ne.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[at,Vt]of ne)this.g.setRequestHeader(at,Vt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ur(this),this.u=!0,this.g.send(A),this.u=!1}catch(at){Jn(this,at)}};function Jn(A,W){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=W,A.m=5,Sr(A),hn(A)}function Sr(A){A.A||(A.A=!0,un(A,"complete"),un(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,un(this,"complete"),un(this,"abort"),hn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),hn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Gr(this):this.bb())},n.bb=function(){Gr(this)};function Gr(A){if(A.h&&typeof f<"u"&&(!A.v[1]||bi(A)!=4||A.Z()!=2)){if(A.u&&bi(A)==4)lr(A.Ea,0,A);else if(un(A,"readystatechange"),bi(A)==4){A.h=!1;try{const Vt=A.Z();e:switch(Vt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var ne;if(!(ne=W)){var ge;if(ge=Vt===0){var qe=String(A.D).match(Gl)[1]||null;!qe&&y.self&&y.self.location&&(qe=y.self.location.protocol.slice(0,-1)),ge=!nt.test(qe?qe.toLowerCase():"")}ne=ge}if(ne)un(A,"complete"),un(A,"success");else{A.m=6;try{var at=2<bi(A)?A.g.statusText:""}catch{at=""}A.l=at+" ["+A.Z()+"]",Sr(A)}}finally{hn(A)}}}}function hn(A,W){if(A.g){Ur(A);const ne=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,W||un(A,"ready");try{ne.onreadystatechange=ge}catch{}}}function Ur(A){A.I&&(y.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function bi(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<bi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var W=this.g.responseText;return A&&W.indexOf(A)==0&&(W=W.substring(A.length)),Ot(W)}};function Us(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function qo(A){const W={};A=(A.g&&2<=bi(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if($(A[ge]))continue;var ne=me(A[ge]);const qe=ne[0];if(ne=ne[1],typeof ne!="string")continue;ne=ne.trim();const at=W[qe]||[];W[qe]=at,at.push(ne)}q(W,function(ge){return ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Yo(A,W,ne){return ne&&ne.internalChannelParams&&ne.internalChannelParams[A]||W}function Gu(A){this.Aa=0,this.i=[],this.j=new Uu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Yo("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Yo("baseRetryDelayMs",5e3,A),this.cb=Yo("retryDelaySeedMs",1e4,A),this.Wa=Yo("forwardChannelMaxRetries",2,A),this.wa=Yo("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new Wl(A&&A.concurrentRequestLimit),this.Da=new zu,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Gu.prototype,n.la=8,n.G=1,n.connect=function(A,W,ne,ge){Bi(0),this.W=A,this.H=W||{},ne&&ge!==void 0&&(this.H.OSID=ne,this.H.OAID=ge),this.F=this.X,this.I=Fg(this,null,this.W),Ic(this)};function es(A){if($d(A),A.G==3){var W=A.U++,ne=Wo(A.I);if(Yr(ne,"SID",A.K),Yr(ne,"RID",W),Yr(ne,"TYPE","terminate"),Hu(A,ne),W=new Ra(A,A.j,W),W.L=2,W.v=nc(Wo(ne)),ne=!1,y.navigator&&y.navigator.sendBeacon)try{ne=y.navigator.sendBeacon(W.v.toString(),"")}catch{}!ne&&y.Image&&(new Image().src=W.v,ne=!0),ne||(W.g=Jy(W.j,null),W.g.ea(W.v)),W.F=Date.now(),zr(W)}qu(A)}function gl(A){A.g&&(Vg(A),A.g.cancel(),A.g=null)}function $d(A){gl(A),A.u&&(y.clearTimeout(A.u),A.u=null),Qf(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&y.clearTimeout(A.s),A.s=null)}function Ic(A){if(!So(A.h)&&!A.s){A.s=!0;var W=A.Ga;ve||ke(),_e||(ve(),_e=!0),Ee.add(W,A),A.B=0}}function Ug(A,W){return Hf(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=W.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=Za(k(A.Ga,A,W),$u(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const qe=new Ra(this,this.j,A);let at=this.o;if(this.S&&(at?(at=X(at),se(at,this.S)):at=this.S),this.m!==null||this.O||(qe.H=at,at=null),this.P)e:{for(var W=0,ne=0;ne<this.i.length;ne++){t:{var ge=this.i[ne];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(W+=ge,4096<W){W=ne;break e}if(W===4096||ne===this.i.length-1){W=ne+1;break e}}W=1e3}else W=1e3;W=Xo(this,qe,W),ne=Wo(this.I),Yr(ne,"RID",A),Yr(ne,"CVER",22),this.D&&Yr(ne,"X-HTTP-Session-Id",this.D),Hu(this,ne),at&&(this.O?W="headers="+encodeURIComponent(String(ml(at)))+"&"+W:this.m&&Ce(ne,this.m,at)),fp(this.h,qe),this.Ua&&Yr(ne,"TYPE","init"),this.P?(Yr(ne,"$req",W),Yr(ne,"SID","null"),qe.T=!0,jd(qe,ne,null)):jd(qe,ne,W),this.G=2}}else this.G==3&&(A?Xf(this,A):this.i.length==0||So(this.h)||Xf(this))};function Xf(A,W){var ne;W?ne=W.l:ne=A.U++;const ge=Wo(A.I);Yr(ge,"SID",A.K),Yr(ge,"RID",ne),Yr(ge,"AID",A.T),Hu(A,ge),A.m&&A.o&&Ce(ge,A.m,A.o),ne=new Ra(A,A.j,ne,A.B+1),A.m===null&&(ne.H=A.o),W&&(A.i=W.D.concat(A.i)),W=Xo(A,ne,1e3),ne.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),fp(A.h,ne),jd(ne,ge,W)}function Hu(A,W){A.H&&fe(A.H,function(ne,ge){Yr(W,ge,ne)}),A.l&&zl({},function(ne,ge){Yr(W,ge,ne)})}function Xo(A,W,ne){ne=Math.min(A.i.length,ne);var ge=A.l?k(A.l.Na,A.l,A):null;e:{var qe=A.i;let at=-1;for(;;){const Vt=["count="+ne];at==-1?0<ne?(at=qe[0].g,Vt.push("ofs="+at)):at=0:Vt.push("ofs="+at);let Xr=!0;for(let hi=0;hi<ne;hi++){let br=qe[hi].g;const Ys=qe[hi].map;if(br-=at,0>br)at=Math.max(0,qe[hi].g-100),Xr=!1;else try{_p(Ys,Vt,"req"+br+"_")}catch{ge&&ge(Ys)}}if(Xr){ge=Vt.join("&");break e}}}return A=A.i.splice(0,ne),W.D=A,ge}function Yl(A){if(!A.g&&!A.u){A.Y=1;var W=A.Fa;ve||ke(),_e||(ve(),_e=!0),Ee.add(W,A),A.v=0}}function Jf(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=Za(k(A.Fa,A),$u(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,Xy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=Za(k(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Bi(10),gl(this),Xy(this))};function Vg(A){A.A!=null&&(y.clearTimeout(A.A),A.A=null)}function Xy(A){A.g=new Ra(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var W=Wo(A.qa);Yr(W,"RID","rpc"),Yr(W,"SID",A.K),Yr(W,"AID",A.T),Yr(W,"CI",A.F?"0":"1"),!A.F&&A.ja&&Yr(W,"TO",A.ja),Yr(W,"TYPE","xmlhttp"),Hu(A,W),A.m&&A.o&&Ce(W,A.m,A.o),A.L&&(A.g.I=A.L);var ne=A.g;A=A.ia,ne.L=1,ne.v=nc(Wo(W)),ne.m=null,ne.P=!0,ju(ne,A)}n.Za=function(){this.C!=null&&(this.C=null,gl(this),Jf(this),Bi(19))};function Qf(A){A.C!=null&&(y.clearTimeout(A.C),A.C=null)}function Zf(A,W){var ne=null;if(A.g==W){Qf(A),Vg(A),A.g=null;var ge=2}else if(io(A.h,W))ne=W.D,hl(A.h,W),ge=1;else return;if(A.G!=0){if(W.o)if(ge==1){ne=W.m?W.m.length:0,W=Date.now()-W.F;var qe=A.B;ge=ro(),un(ge,new ys(ge,ne)),Ic(A)}else Yl(A);else if(qe=W.s,qe==3||qe==0&&0<W.X||!(ge==1&&Ug(A,W)||ge==2&&Jf(A)))switch(ne&&0<ne.length&&(W=A.h,W.i=W.i.concat(ne)),qe){case 1:Ku(A,5);break;case 4:Ku(A,10);break;case 3:Ku(A,6);break;default:Ku(A,2)}}}function $u(A,W){let ne=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(ne*=2),ne*W}function Ku(A,W){if(A.j.info("Error code "+W),W==2){var ne=k(A.fb,A),ge=A.Xa;const qe=!ge;ge=new tc(ge||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||Wu(ge,"https"),nc(ge),qe?qf(ge.toString(),ne):Rc(ge.toString(),ne)}else Bi(2);A.G=0,A.l&&A.l.sa(W),qu(A),$d(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Bi(2)):(this.j.info("Failed to ping google.com"),Bi(1))};function qu(A){if(A.G=0,A.ka=[],A.l){const W=zd(A.h);(W.length!=0||A.i.length!=0)&&(z(A.ka,W),z(A.ka,A.i),A.h.i.length=0,B(A.i),A.i.length=0),A.l.ra()}}function Fg(A,W,ne){var ge=ne instanceof tc?Wo(ne):new tc(ne);if(ge.g!="")W&&(ge.g=W+"."+ge.g),pl(ge,ge.s);else{var qe=y.location;ge=qe.protocol,W=W?W+"."+qe.hostname:qe.hostname,qe=+qe.port;var at=new tc(null);ge&&Wu(at,ge),W&&(at.g=W),qe&&pl(at,qe),ne&&(at.l=ne),ge=at}return ne=A.D,W=A.ya,ne&&W&&Yr(ge,ne,W),Yr(ge,"VER",A.la),Hu(A,ge),ge}function Jy(A,W,ne){if(W&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=A.Ca&&!A.pa?new De(new fl({eb:ne})):new De(A.pa),W.Ha(A.J),W}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Wn(){}n=Wn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function em(){}em.prototype.g=function(A,W){return new Jo(A,W)};function Jo(A,W){Pn.call(this),this.g=new Gu(W),this.l=A,this.h=W&&W.messageUrlParams||null,A=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(A?A["X-WebChannel-Content-Type"]=W.messageContentType:A={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(A?A["X-WebChannel-Client-Profile"]=W.va:A={"X-WebChannel-Client-Profile":W.va}),this.g.S=A,(A=W&&W.Sb)&&!$(A)&&(this.g.m=A),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!$(W)&&(this.g.D=W,A=this.h,A!==null&&W in A&&(A=this.h,W in A&&delete A[W])),this.j=new Ac(this)}F(Jo,Pn),Jo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Jo.prototype.close=function(){es(this.g)},Jo.prototype.o=function(A){var W=this.g;if(typeof A=="string"){var ne={};ne.__data__=A,A=ne}else this.u&&(ne={},ne.__data__=ii(A),A=ne);W.i.push(new Wd(W.Ya++,A)),W.G==3&&Ic(W)},Jo.prototype.N=function(){this.g.l=null,delete this.j,es(this.g),delete this.g,Jo.aa.N.call(this)};function Qy(A){Sa.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var W=A.__sm__;if(W){e:{for(const ne in W){A=ne;break e}A=void 0}(this.i=A)&&(A=this.i,W=W!==null&&A in W?W[A]:void 0),this.data=W}else this.data=A}F(Qy,Sa);function Zy(){vo.call(this),this.status=1}F(Zy,vo);function Ac(A){this.g=A}F(Ac,Wn),Ac.prototype.ua=function(){un(this.g,"a")},Ac.prototype.ta=function(A){un(this.g,new Qy(A))},Ac.prototype.sa=function(A){un(this.g,new Zy)},Ac.prototype.ra=function(){un(this.g,"b")},em.prototype.createWebChannel=em.prototype.g,Jo.prototype.send=Jo.prototype.o,Jo.prototype.open=Jo.prototype.m,Jo.prototype.close=Jo.prototype.close,Xre=function(){return new em},Yre=function(){return ro()},qre=ba,gV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Vu.NO_ERROR=0,Vu.TIMEOUT=8,Vu.HTTP_ERROR=6,ik=Vu,hp.COMPLETE="complete",Kre=hp,bc.EventType=cs,cs.OPEN="a",cs.CLOSE="b",cs.ERROR="c",cs.MESSAGE="d",Pn.prototype.listen=Pn.prototype.K,Uw=bc,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,$re=De}).apply(typeof EO<"u"?EO:typeof self<"u"?self:typeof window<"u"?window:{});const wX="@firebase/firestore",CX="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}qa.UNAUTHENTICATED=new qa(null),qa.GOOGLE_CREDENTIALS=new qa("google-credentials-uid"),qa.FIRST_PARTY=new qa("first-party-uid"),qa.MOCK_USER=new qa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let V0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const My=new Lj("@firebase/firestore");function vS(){return My.logLevel}function tn(n,...t){if(My.logLevel<=Cr.DEBUG){const s=t.map(Hj);My.debug(`Firestore (${V0}): ${n}`,...s)}}function jf(n,...t){if(My.logLevel<=Cr.ERROR){const s=t.map(Hj);My.error(`Firestore (${V0}): ${n}`,...s)}}function _0(n,...t){if(My.logLevel<=Cr.WARN){const s=t.map(Hj);My.warn(`Firestore (${V0}): ${n}`,...s)}}function Hj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $n(n="Unexpected state"){const t=`FIRESTORE (${V0}) INTERNAL ASSERTION FAILED: `+n;throw jf(t),new Error(t)}function di(n,t){n||$n()}function er(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ln extends lp{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jre{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Aje{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(qa.UNAUTHENTICATED))}shutdown(){}}class Pje{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class Oje{constructor(t){this.t=t,this.currentUser=qa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){di(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,s(v)):Promise.resolve();let d=new Of;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Of,t.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},y=v=>{tn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(v=>y(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?y(v):(tn("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Of)}},0),f()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(tn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(di(typeof a.accessToken=="string"),new Jre(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return di(t===null||typeof t=="string"),new qa(t)}}class kje{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=qa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Nje{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new kje(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(qa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class RX{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Dje{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Dl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){di(this.o===void 0);const a=d=>{d.error!=null&&tn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,tn("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{tn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):tn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new RX(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(di(typeof s.token=="string"),this.R=s.token,new RX(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lje(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<n;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qre(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zre{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=Lje(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function mr(n,t){return n<t?-1:n>t?1:0}function _V(n,t){let s=0;for(;s<n.length&&s<t.length;){const a=n.codePointAt(s),l=t.codePointAt(s);if(a!==l){if(a<128&&l<128)return mr(a,l);{const d=Qre(),f=xje(d.encode(IX(n,s)),d.encode(IX(t,s)));return f!==0?f:mr(a,l)}}s+=a>65535?2:1}return mr(n.length,t.length)}function IX(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function xje(n,t){for(let s=0;s<n.length&&s<t.length;++s)if(n[s]!==t[s])return mr(n[s],t[s]);return mr(n.length,t.length)}function y0(n,t,s){return n.length===t.length&&n.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AX=-62135596800,PX=1e6;class _o{static now(){return _o.fromMillis(Date.now())}static fromDate(t){return _o.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*PX);return new _o(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new ln(Rt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new ln(Rt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<AX)throw new ln(Rt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ln(Rt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/PX}_compareTo(t){return this.seconds===t.seconds?mr(this.nanoseconds,t.nanoseconds):mr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-AX;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{static fromTimestamp(t){return new Xn(t)}static min(){return new Xn(new _o(0,0))}static max(){return new Xn(new _o(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OX="__name__";class Lh{constructor(t,s,a){s===void 0?s=0:s>t.length&&$n(),a===void 0?a=t.length-s:a>t.length-s&&$n(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return Lh.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof Lh?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=Lh.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return mr(t.length,s.length)}static compareSegments(t,s){const a=Lh.isNumericId(t),l=Lh.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?Lh.extractNumericId(t).compare(Lh.extractNumericId(s)):_V(t,s)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return mg.fromString(t.substring(4,t.length-2))}}class Ji extends Lh{construct(t,s,a){return new Ji(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new ln(Rt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new Ji(s)}static emptyPath(){return new Ji([])}}const Mje=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ma extends Lh{construct(t,s,a){return new ma(t,s,a)}static isValidIdentifier(t){return Mje.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ma.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===OX}static keyField(){return new ma([OX])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new ln(Rt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let f=!1;for(;l<t.length;){const y=t[l];if(y==="\\"){if(l+1===t.length)throw new ln(Rt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new ln(Rt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else y==="`"?(f=!f,l++):y!=="."||f?(a+=y,l++):(d(),l++)}if(d(),f)throw new ln(Rt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ma(s)}static emptyPath(){return new ma([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(t){this.path=t}static fromPath(t){return new wn(Ji.fromString(t))}static fromName(t){return new wn(Ji.fromString(t).popFirst(5))}static empty(){return new wn(Ji.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Ji.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return Ji.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new wn(new Ji(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC=-1;function Uje(n,t){const s=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Xn.fromTimestamp(a===1e9?new _o(s+1,0):new _o(s,a));return new bg(l,wn.empty(),t)}function Vje(n){return new bg(n.readTime,n.key,NC)}class bg{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new bg(Xn.min(),wn.empty(),NC)}static max(){return new bg(Xn.max(),wn.empty(),NC)}}function Fje(n,t){let s=n.readTime.compareTo(t.readTime);return s!==0?s:(s=wn.comparator(n.documentKey,t.documentKey),s!==0?s:mr(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jje="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Bje{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F0(n){if(n.code!==Rt.FAILED_PRECONDITION||n.message!==jje)throw n;tn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&$n(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new Ct((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof Ct?s:Ct.resolve(s)}catch(s){return Ct.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):Ct.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):Ct.reject(s)}static resolve(t){return new Ct((s,a)=>{s(t)})}static reject(t){return new Ct((s,a)=>{a(t)})}static waitFor(t){return new Ct((s,a)=>{let l=0,d=0,f=!1;t.forEach(y=>{++l,y.next(()=>{++d,f&&d===l&&s()},v=>a(v))}),f=!0,d===l&&s()})}static or(t){let s=Ct.resolve(!1);for(const a of t)s=s.next(l=>l?Ct.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new Ct((a,l)=>{const d=t.length,f=new Array(d);let y=0;for(let v=0;v<d;v++){const b=v;s(t[b]).next(w=>{f[b]=w,++y,y===d&&a(f)},w=>l(w))}})}static doWhile(t,s){return new Ct((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function Wje(n){const t=n.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function j0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}VN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $j=-1;function FN(n){return n==null}function Vk(n){return n===0&&1/n==-1/0}function zje(n){return typeof n=="number"&&Number.isInteger(n)&&!Vk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eie="";function Gje(n){let t="";for(let s=0;s<n.length;s++)t.length>0&&(t=kX(t)),t=Hje(n.get(s),t);return kX(t)}function Hje(n,t){let s=t;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":s+="";break;case eie:s+="";break;default:s+=d}}return s}function kX(n){return n+eie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NX(n){let t=0;for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t++;return t}function Lg(n,t){for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t(s,n[s])}function tie(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(t,s){this.comparator=t,this.root=s||pa.EMPTY}insert(t,s){return new gs(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,pa.BLACK,null,null))}remove(t){return new gs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,pa.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new vO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new vO(this.root,t,this.comparator,!1)}getReverseIterator(){return new vO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new vO(this.root,t,this.comparator,!0)}}class vO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class pa{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??pa.RED,this.left=l??pa.EMPTY,this.right=d??pa.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new pa(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return pa.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return pa.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,pa.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,pa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw $n();const t=this.left.check();if(t!==this.right.check())throw $n();return t+(this.isRed()?0:1)}}pa.EMPTY=null,pa.RED=!0,pa.BLACK=!1;pa.EMPTY=new class{constructor(){this.size=0}get key(){throw $n()}get value(){throw $n()}get color(){throw $n()}get left(){throw $n()}get right(){throw $n()}copy(t,s,a,l,d){return this}insert(t,s,a){return new pa(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(t){this.comparator=t,this.data=new gs(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new DX(this.data.getIterator())}getIteratorFrom(t){return new DX(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof yo)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new yo(this.comparator);return s.data=t,s}}class DX{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl{constructor(t){this.fields=t,t.sort(ma.comparator)}static empty(){return new xl([])}unionWith(t){let s=new yo(ma.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new xl(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return y0(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nie extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new nie("Invalid base64 string: "+d):d}}(t);return new ya(s)}static fromUint8Array(t){const s=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(t);return new ya(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return mr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ya.EMPTY_BYTE_STRING=new ya("");const $je=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tg(n){if(di(!!n),typeof n=="string"){let t=0;const s=$je.exec(n);if(di(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:Gs(n.seconds),nanos:Gs(n.nanos)}}function Gs(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function wg(n){return typeof n=="string"?ya.fromBase64String(n):ya.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rie="server_timestamp",iie="__type__",sie="__previous_value__",oie="__local_write_time__";function Kj(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[iie])===null||s===void 0?void 0:s.stringValue)===rie}function jN(n){const t=n.mapValue.fields[sie];return Kj(t)?jN(t):t}function DC(n){const t=Tg(n.mapValue.fields[oie].timestampValue);return new _o(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kje{constructor(t,s,a,l,d,f,y,v,b){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=y,this.longPollingOptions=v,this.useFetchStreams=b}}const Fk="(default)";class LC{constructor(t,s){this.projectId=t,this.database=s||Fk}static empty(){return new LC("","")}get isDefaultDatabase(){return this.database===Fk}isEqual(t){return t instanceof LC&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aie="__type__",qje="__max__",SO={mapValue:{}},cie="__vector__",jk="value";function Cg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Kj(n)?4:Xje(n)?9007199254740991:Yje(n)?10:11:$n()}function op(n,t){if(n===t)return!0;const s=Cg(n);if(s!==Cg(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return DC(n).isEqual(DC(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=Tg(l.timestampValue),y=Tg(d.timestampValue);return f.seconds===y.seconds&&f.nanos===y.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(l,d){return wg(l.bytesValue).isEqual(wg(d.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(l,d){return Gs(l.geoPointValue.latitude)===Gs(d.geoPointValue.latitude)&&Gs(l.geoPointValue.longitude)===Gs(d.geoPointValue.longitude)}(n,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Gs(l.integerValue)===Gs(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=Gs(l.doubleValue),y=Gs(d.doubleValue);return f===y?Vk(f)===Vk(y):isNaN(f)&&isNaN(y)}return!1}(n,t);case 9:return y0(n.arrayValue.values||[],t.arrayValue.values||[],op);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},y=d.mapValue.fields||{};if(NX(f)!==NX(y))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(y[v]===void 0||!op(f[v],y[v])))return!1;return!0}(n,t);default:return $n()}}function xC(n,t){return(n.values||[]).find(s=>op(s,t))!==void 0}function E0(n,t){if(n===t)return 0;const s=Cg(n),a=Cg(t);if(s!==a)return mr(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return mr(n.booleanValue,t.booleanValue);case 2:return function(d,f){const y=Gs(d.integerValue||d.doubleValue),v=Gs(f.integerValue||f.doubleValue);return y<v?-1:y>v?1:y===v?0:isNaN(y)?isNaN(v)?0:-1:1}(n,t);case 3:return LX(n.timestampValue,t.timestampValue);case 4:return LX(DC(n),DC(t));case 5:return _V(n.stringValue,t.stringValue);case 6:return function(d,f){const y=wg(d),v=wg(f);return y.compareTo(v)}(n.bytesValue,t.bytesValue);case 7:return function(d,f){const y=d.split("/"),v=f.split("/");for(let b=0;b<y.length&&b<v.length;b++){const w=mr(y[b],v[b]);if(w!==0)return w}return mr(y.length,v.length)}(n.referenceValue,t.referenceValue);case 8:return function(d,f){const y=mr(Gs(d.latitude),Gs(f.latitude));return y!==0?y:mr(Gs(d.longitude),Gs(f.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return xX(n.arrayValue,t.arrayValue);case 10:return function(d,f){var y,v,b,w;const I=d.fields||{},k=f.fields||{},x=(y=I[jk])===null||y===void 0?void 0:y.arrayValue,F=(v=k[jk])===null||v===void 0?void 0:v.arrayValue,B=mr(((b=x==null?void 0:x.values)===null||b===void 0?void 0:b.length)||0,((w=F==null?void 0:F.values)===null||w===void 0?void 0:w.length)||0);return B!==0?B:xX(x,F)}(n.mapValue,t.mapValue);case 11:return function(d,f){if(d===SO.mapValue&&f===SO.mapValue)return 0;if(d===SO.mapValue)return 1;if(f===SO.mapValue)return-1;const y=d.fields||{},v=Object.keys(y),b=f.fields||{},w=Object.keys(b);v.sort(),w.sort();for(let I=0;I<v.length&&I<w.length;++I){const k=_V(v[I],w[I]);if(k!==0)return k;const x=E0(y[v[I]],b[w[I]]);if(x!==0)return x}return mr(v.length,w.length)}(n.mapValue,t.mapValue);default:throw $n()}}function LX(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return mr(n,t);const s=Tg(n),a=Tg(t),l=mr(s.seconds,a.seconds);return l!==0?l:mr(s.nanos,a.nanos)}function xX(n,t){const s=n.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=E0(s[l],a[l]);if(d)return d}return mr(s.length,a.length)}function v0(n){return yV(n)}function yV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(s){const a=Tg(s);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(s){return wg(s).toBase64()}(n.bytesValue):"referenceValue"in n?function(s){return wn.fromName(s).toString()}(n.referenceValue):"geoPointValue"in n?function(s){return`geo(${s.latitude},${s.longitude})`}(n.geoPointValue):"arrayValue"in n?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=yV(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${yV(s.fields[f])}`;return l+"}"}(n.mapValue):$n()}function sk(n){switch(Cg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=jN(n);return t?16+sk(t):16;case 5:return 2*n.stringValue.length;case 6:return wg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+sk(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Lg(a.fields,(d,f)=>{l+=d.length+sk(f)}),l}(n.mapValue);default:throw $n()}}function MX(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function EV(n){return!!n&&"integerValue"in n}function qj(n){return!!n&&"arrayValue"in n}function UX(n){return!!n&&"nullValue"in n}function VX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ok(n){return!!n&&"mapValue"in n}function Yje(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[aie])===null||s===void 0?void 0:s.stringValue)===cie}function nC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Lg(n.mapValue.fields,(s,a)=>t.mapValue.fields[s]=nC(a)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(n.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=nC(n.arrayValue.values[s]);return t}return Object.assign({},n)}function Xje(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===qje}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(t){this.value=t}static empty(){return new il({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!ok(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=nC(s)}setAll(t){let s=ma.emptyPath(),a={},l=[];t.forEach((f,y)=>{if(!s.isImmediateParentOf(y)){const v=this.getFieldsMap(s);this.applyChanges(v,a,l),a={},l=[],s=y.popLast()}f?a[y.lastSegment()]=nC(f):l.push(y.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());ok(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return op(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];ok(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){Lg(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new il(nC(this.value))}}function lie(n){const t=[];return Lg(n.fields,(s,a)=>{const l=new ma([s]);if(ok(a)){const d=lie(a.mapValue).fields;if(d.length===0)t.push(l);else for(const f of d)t.push(l.child(f))}else t.push(l)}),new xl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(t,s,a,l,d,f,y){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=y}static newInvalidDocument(t){return new Ya(t,0,Xn.min(),Xn.min(),Xn.min(),il.empty(),0)}static newFoundDocument(t,s,a,l){return new Ya(t,1,s,Xn.min(),a,l,0)}static newNoDocument(t,s){return new Ya(t,2,s,Xn.min(),Xn.min(),il.empty(),0)}static newUnknownDocument(t,s){return new Ya(t,3,s,Xn.min(),Xn.min(),il.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual(Xn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=il.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=il.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Xn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Ya&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ya(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(t,s){this.position=t,this.inclusive=s}}function FX(n,t,s){let a=0;for(let l=0;l<n.position.length;l++){const d=t[l],f=n.position[l];if(d.field.isKeyField()?a=wn.comparator(wn.fromName(f.referenceValue),s.key):a=E0(f,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function jX(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let s=0;s<n.position.length;s++)if(!op(n.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk{constructor(t,s="asc"){this.field=t,this.dir=s}}function Jje(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uie{}class no extends uie{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new Zje(t,s,a):s==="array-contains"?new n4e(t,a):s==="in"?new r4e(t,a):s==="not-in"?new i4e(t,a):s==="array-contains-any"?new s4e(t,a):new no(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new e4e(t,a):new t4e(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(E0(s,this.value)):s!==null&&Cg(this.value)===Cg(s)&&this.matchesComparison(E0(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return $n()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ld extends uie{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new Ld(t,s)}matches(t){return die(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function die(n){return n.op==="and"}function hie(n){return Qje(n)&&die(n)}function Qje(n){for(const t of n.filters)if(t instanceof Ld)return!1;return!0}function vV(n){if(n instanceof no)return n.field.canonicalString()+n.op.toString()+v0(n.value);if(hie(n))return n.filters.map(t=>vV(t)).join(",");{const t=n.filters.map(s=>vV(s)).join(",");return`${n.op}(${t})`}}function pie(n,t){return n instanceof no?function(a,l){return l instanceof no&&a.op===l.op&&a.field.isEqual(l.field)&&op(a.value,l.value)}(n,t):n instanceof Ld?function(a,l){return l instanceof Ld&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,y)=>d&&pie(f,l.filters[y]),!0):!1}(n,t):void $n()}function fie(n){return n instanceof no?function(s){return`${s.field.canonicalString()} ${s.op} ${v0(s.value)}`}(n):n instanceof Ld?function(s){return s.op.toString()+" {"+s.getFilters().map(fie).join(" ,")+"}"}(n):"Filter"}class Zje extends no{constructor(t,s,a){super(t,s,a),this.key=wn.fromName(a.referenceValue)}matches(t){const s=wn.comparator(t.key,this.key);return this.matchesComparison(s)}}class e4e extends no{constructor(t,s){super(t,"in",s),this.keys=mie("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class t4e extends no{constructor(t,s){super(t,"not-in",s),this.keys=mie("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function mie(n,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>wn.fromName(a.referenceValue))}class n4e extends no{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return qj(s)&&xC(s.arrayValue,this.value)}}class r4e extends no{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&xC(this.value.arrayValue,s)}}class i4e extends no{constructor(t,s){super(t,"not-in",s)}matches(t){if(xC(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!xC(this.value.arrayValue,s)}}class s4e extends no{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!qj(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>xC(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4e{constructor(t,s=null,a=[],l=[],d=null,f=null,y=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=y,this.le=null}}function BX(n,t=null,s=[],a=[],l=null,d=null,f=null){return new o4e(n,t,s,a,l,d,f)}function Yj(n){const t=er(n);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>vV(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),FN(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>v0(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>v0(a)).join(",")),t.le=s}return t.le}function Xj(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!Jje(n.orderBy[s],t.orderBy[s]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if(!pie(n.filters[s],t.filters[s]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!jX(n.startAt,t.startAt)&&jX(n.endAt,t.endAt)}function SV(n){return wn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(t,s=null,a=[],l=[],d=null,f="F",y=null,v=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=y,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function a4e(n,t,s,a,l,d,f,y){return new sR(n,t,s,a,l,d,f,y)}function Jj(n){return new sR(n)}function WX(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function gie(n){return n.collectionGroup!==null}function rC(n){const t=er(n);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(f){let y=new yo(ma.comparator);return f.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(y=y.add(b.field))})}),y})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new Wk(d,a))}),s.has(ma.keyField().canonicalString())||t.he.push(new Wk(ma.keyField(),a))}return t.he}function np(n){const t=er(n);return t.Pe||(t.Pe=c4e(t,rC(n))),t.Pe}function c4e(n,t){if(n.limitType==="F")return BX(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new Wk(l.field,d)});const s=n.endAt?new Bk(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new Bk(n.startAt.position,n.startAt.inclusive):null;return BX(n.path,n.collectionGroup,t,n.filters,n.limit,s,a)}}function bV(n,t){const s=n.filters.concat([t]);return new sR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),s,n.limit,n.limitType,n.startAt,n.endAt)}function zk(n,t,s){return new sR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,s,n.startAt,n.endAt)}function BN(n,t){return Xj(np(n),np(t))&&n.limitType===t.limitType}function _ie(n){return`${Yj(np(n))}|lt:${n.limitType}`}function SS(n){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>fie(l)).join(", ")}]`),FN(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>v0(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>v0(l)).join(",")),`Target(${a})`}(np(n))}; limitType=${n.limitType})`}function WN(n,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):wn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,t)&&function(a,l){for(const d of rC(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,t)&&function(a,l){return!(a.startAt&&!function(f,y,v){const b=FX(f,y,v);return f.inclusive?b<=0:b<0}(a.startAt,rC(a),l)||a.endAt&&!function(f,y,v){const b=FX(f,y,v);return f.inclusive?b>=0:b>0}(a.endAt,rC(a),l))}(n,t)}function l4e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function yie(n){return(t,s)=>{let a=!1;for(const l of rC(n)){const d=u4e(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function u4e(n,t,s){const a=n.field.isKeyField()?wn.comparator(t.key,s.key):function(d,f,y){const v=f.data.field(d),b=y.data.field(d);return v!==null&&b!==null?E0(v,b):$n()}(n.field,t,s);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return $n()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Lg(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return tie(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d4e=new gs(wn.comparator);function Bf(){return d4e}const Eie=new gs(wn.comparator);function Vw(...n){let t=Eie;for(const s of n)t=t.insert(s.key,s);return t}function vie(n){let t=Eie;return n.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function fy(){return iC()}function Sie(){return iC()}function iC(){return new zy(n=>n.toString(),(n,t)=>n.isEqual(t))}const h4e=new gs(wn.comparator),p4e=new yo(wn.comparator);function Rr(...n){let t=p4e;for(const s of n)t=t.add(s);return t}const f4e=new yo(mr);function m4e(){return f4e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qj(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vk(t)?"-0":t}}function bie(n){return{integerValue:""+n}}function g4e(n,t){return zje(t)?bie(t):Qj(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(){this._=void 0}}function _4e(n,t,s){return n instanceof Gk?function(l,d){const f={fields:{[iie]:{stringValue:rie},[oie]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&Kj(d)&&(d=jN(d)),d&&(f.fields[sie]=d),{mapValue:f}}(s,t):n instanceof S0?wie(n,t):n instanceof b0?Cie(n,t):function(l,d){const f=Tie(l,d),y=zX(f)+zX(l.Ie);return EV(f)&&EV(l.Ie)?bie(y):Qj(l.serializer,y)}(n,t)}function y4e(n,t,s){return n instanceof S0?wie(n,t):n instanceof b0?Cie(n,t):s}function Tie(n,t){return n instanceof Hk?function(a){return EV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class Gk extends zN{}class S0 extends zN{constructor(t){super(),this.elements=t}}function wie(n,t){const s=Rie(t);for(const a of n.elements)s.some(l=>op(l,a))||s.push(a);return{arrayValue:{values:s}}}class b0 extends zN{constructor(t){super(),this.elements=t}}function Cie(n,t){let s=Rie(t);for(const a of n.elements)s=s.filter(l=>!op(l,a));return{arrayValue:{values:s}}}class Hk extends zN{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function zX(n){return Gs(n.integerValue||n.doubleValue)}function Rie(n){return qj(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iie{constructor(t,s){this.field=t,this.transform=s}}function E4e(n,t){return n.field.isEqual(t.field)&&function(a,l){return a instanceof S0&&l instanceof S0||a instanceof b0&&l instanceof b0?y0(a.elements,l.elements,op):a instanceof Hk&&l instanceof Hk?op(a.Ie,l.Ie):a instanceof Gk&&l instanceof Gk}(n.transform,t.transform)}class v4e{constructor(t,s){this.version=t,this.transformResults=s}}class Ou{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new Ou}static exists(t){return new Ou(void 0,t)}static updateTime(t){return new Ou(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ak(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class GN{}function Aie(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Zj(n.key,Ou.none()):new oR(n.key,n.data,Ou.none());{const s=n.data,a=il.empty();let l=new yo(ma.comparator);for(let d of t.fields)if(!l.has(d)){let f=s.field(d);f===null&&d.length>1&&(d=d.popLast(),f=s.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new xg(n.key,a,new xl(l.toArray()),Ou.none())}}function S4e(n,t,s){n instanceof oR?function(l,d,f){const y=l.value.clone(),v=HX(l.fieldTransforms,d,f.transformResults);y.setAll(v),d.convertToFoundDocument(f.version,y).setHasCommittedMutations()}(n,t,s):n instanceof xg?function(l,d,f){if(!ak(l.precondition,d))return void d.convertToUnknownDocument(f.version);const y=HX(l.fieldTransforms,d,f.transformResults),v=d.data;v.setAll(Pie(l)),v.setAll(y),d.convertToFoundDocument(f.version,v).setHasCommittedMutations()}(n,t,s):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,t,s)}function sC(n,t,s,a){return n instanceof oR?function(d,f,y,v){if(!ak(d.precondition,f))return y;const b=d.value.clone(),w=$X(d.fieldTransforms,v,f);return b.setAll(w),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null}(n,t,s,a):n instanceof xg?function(d,f,y,v){if(!ak(d.precondition,f))return y;const b=$X(d.fieldTransforms,v,f),w=f.data;return w.setAll(Pie(d)),w.setAll(b),f.convertToFoundDocument(f.version,w).setHasLocalMutations(),y===null?null:y.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(n,t,s,a):function(d,f,y){return ak(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):y}(n,t,s)}function b4e(n,t){let s=null;for(const a of n.fieldTransforms){const l=t.data.field(a.field),d=Tie(a.transform,l||null);d!=null&&(s===null&&(s=il.empty()),s.set(a.field,d))}return s||null}function GX(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&y0(a,l,(d,f)=>E4e(d,f))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class oR extends GN{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class xg extends GN{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function Pie(n){const t=new Map;return n.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=n.data.field(s);t.set(s,a)}}),t}function HX(n,t,s){const a=new Map;di(n.length===s.length);for(let l=0;l<s.length;l++){const d=n[l],f=d.transform,y=t.data.field(d.field);a.set(d.field,y4e(f,y,s[l]))}return a}function $X(n,t,s){const a=new Map;for(const l of n){const d=l.transform,f=s.data.field(l.field);a.set(l.field,_4e(d,f,t))}return a}class Zj extends GN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class T4e extends GN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4e{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&S4e(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=sC(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=sC(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=Sie();return this.mutations.forEach(l=>{const d=t.get(l.key),f=d.overlayedDocument;let y=this.applyToLocalView(f,d.mutatedFields);y=s.has(l.key)?null:y;const v=Aie(f,y);v!==null&&a.set(l.key,v),f.isValidDocument()||f.convertToNoDocument(Xn.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),Rr())}isEqual(t){return this.batchId===t.batchId&&y0(this.mutations,t.mutations,(s,a)=>GX(s,a))&&y0(this.baseMutations,t.baseMutations,(s,a)=>GX(s,a))}}class e4{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){di(t.mutations.length===a.length);let l=function(){return h4e}();const d=t.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new e4(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4e{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R4e{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qs,Mr;function I4e(n){switch(n){case Rt.OK:return $n();case Rt.CANCELLED:case Rt.UNKNOWN:case Rt.DEADLINE_EXCEEDED:case Rt.RESOURCE_EXHAUSTED:case Rt.INTERNAL:case Rt.UNAVAILABLE:case Rt.UNAUTHENTICATED:return!1;case Rt.INVALID_ARGUMENT:case Rt.NOT_FOUND:case Rt.ALREADY_EXISTS:case Rt.PERMISSION_DENIED:case Rt.FAILED_PRECONDITION:case Rt.ABORTED:case Rt.OUT_OF_RANGE:case Rt.UNIMPLEMENTED:case Rt.DATA_LOSS:return!0;default:return $n()}}function Oie(n){if(n===void 0)return jf("GRPC error has no .code"),Rt.UNKNOWN;switch(n){case Qs.OK:return Rt.OK;case Qs.CANCELLED:return Rt.CANCELLED;case Qs.UNKNOWN:return Rt.UNKNOWN;case Qs.DEADLINE_EXCEEDED:return Rt.DEADLINE_EXCEEDED;case Qs.RESOURCE_EXHAUSTED:return Rt.RESOURCE_EXHAUSTED;case Qs.INTERNAL:return Rt.INTERNAL;case Qs.UNAVAILABLE:return Rt.UNAVAILABLE;case Qs.UNAUTHENTICATED:return Rt.UNAUTHENTICATED;case Qs.INVALID_ARGUMENT:return Rt.INVALID_ARGUMENT;case Qs.NOT_FOUND:return Rt.NOT_FOUND;case Qs.ALREADY_EXISTS:return Rt.ALREADY_EXISTS;case Qs.PERMISSION_DENIED:return Rt.PERMISSION_DENIED;case Qs.FAILED_PRECONDITION:return Rt.FAILED_PRECONDITION;case Qs.ABORTED:return Rt.ABORTED;case Qs.OUT_OF_RANGE:return Rt.OUT_OF_RANGE;case Qs.UNIMPLEMENTED:return Rt.UNIMPLEMENTED;case Qs.DATA_LOSS:return Rt.DATA_LOSS;default:return $n()}}(Mr=Qs||(Qs={}))[Mr.OK=0]="OK",Mr[Mr.CANCELLED=1]="CANCELLED",Mr[Mr.UNKNOWN=2]="UNKNOWN",Mr[Mr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Mr[Mr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Mr[Mr.NOT_FOUND=5]="NOT_FOUND",Mr[Mr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Mr[Mr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Mr[Mr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Mr[Mr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Mr[Mr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Mr[Mr.ABORTED=10]="ABORTED",Mr[Mr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Mr[Mr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Mr[Mr.INTERNAL=13]="INTERNAL",Mr[Mr.UNAVAILABLE=14]="UNAVAILABLE",Mr[Mr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4e=new mg([4294967295,4294967295],0);function KX(n){const t=Qre().encode(n),s=new Hre;return s.update(t),new Uint8Array(s.digest())}function qX(n){const t=new DataView(n.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new mg([s,a],0),new mg([l,d],0)]}class t4{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new Fw(`Invalid padding: ${s}`);if(a<0)throw new Fw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new Fw(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new Fw(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=mg.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(mg.fromNumber(a)));return l.compare(A4e)===1&&(l=new mg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=KX(t),[a,l]=qX(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),f=new t4(d,l,s);return a.forEach(y=>f.insert(y)),f}insert(t){if(this.Ee===0)return;const s=KX(t),[a,l]=qX(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class Fw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,aR.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new HN(Xn.min(),l,new gs(mr),Bf(),Rr())}}class aR{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new aR(a,s,Rr(),Rr(),Rr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class kie{constructor(t,s){this.targetId=t,this.ge=s}}class Nie{constructor(t,s,a=ya.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class YX{constructor(){this.pe=0,this.ye=XX(),this.we=ya.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=Rr(),s=Rr(),a=Rr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:$n()}}),new aR(this.we,this.Se,t,s,a)}Me(){this.be=!1,this.ye=XX()}xe(t,s){this.be=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,di(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class P4e{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Bf(),this.$e=bO(),this.Ue=bO(),this.Ke=new gs(mr)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:$n()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(SV(d))if(a===0){const f=new wn(d.path);this.ze(s,f,Ya.newNoDocument(f,Xn.min()))}else di(a===1);else{const f=this.et(s);if(f!==a){const y=this.tt(t),v=y?this.nt(y,t,f):1;if(v!==0){this.Ye(s);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(s,b)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let f,y;try{f=wg(a).toUint8Array()}catch(v){if(v instanceof nie)return _0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{y=new t4(f,l,d)}catch(v){return _0(v instanceof Fw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return y.Ee===0?null:y}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const f=this.ke.it(),y=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;t.mightContain(y)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,f)=>{const y=this.Xe(f);if(y){if(d.current&&SV(y.target)){const v=new wn(y.target.path);this._t(v).has(f)||this.ut(f,v)||this.ze(f,v,Ya.newNoDocument(v,t))}d.ve&&(s.set(f,d.Fe()),d.Me())}});let a=Rr();this.Ue.forEach((d,f)=>{let y=!0;f.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(t));const l=new HN(t,s,this.Ke,this.Qe,a);return this.Qe=Bf(),this.$e=bO(),this.Ue=bO(),this.Ke=new gs(mr),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ue=this.Ue.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ue=this.Ue.insert(s,this.ct(s).delete(t)),this.Ue=this.Ue.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new YX,this.qe.set(t,s)),s}ct(t){let s=this.Ue.get(t);return s||(s=new yo(mr),this.Ue=this.Ue.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new yo(mr),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||tn("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new YX),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function bO(){return new gs(wn.comparator)}function XX(){return new gs(wn.comparator)}const O4e={asc:"ASCENDING",desc:"DESCENDING"},k4e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},N4e={and:"AND",or:"OR"};class D4e{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function TV(n,t){return n.useProto3Json||FN(t)?t:{value:t}}function $k(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Die(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function L4e(n,t){return $k(n,t.toTimestamp())}function rp(n){return di(!!n),Xn.fromTimestamp(function(s){const a=Tg(s);return new _o(a.seconds,a.nanos)}(n))}function n4(n,t){return wV(n,t).canonicalString()}function wV(n,t){const s=function(l){return new Ji(["projects",l.projectId,"databases",l.database])}(n).child("documents");return t===void 0?s:s.child(t)}function Lie(n){const t=Ji.fromString(n);return di(Fie(t)),t}function CV(n,t){return n4(n.databaseId,t.path)}function YM(n,t){const s=Lie(t);if(s.get(1)!==n.databaseId.projectId)throw new ln(Rt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+n.databaseId.projectId);if(s.get(3)!==n.databaseId.database)throw new ln(Rt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+n.databaseId.database);return new wn(Mie(s))}function xie(n,t){return n4(n.databaseId,t)}function x4e(n){const t=Lie(n);return t.length===4?Ji.emptyPath():Mie(t)}function RV(n){return new Ji(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Mie(n){return di(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function JX(n,t,s){return{name:CV(n,t),fields:s.value.mapValue.fields}}function M4e(n,t){let s;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:$n()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,w){return b.useProto3Json?(di(w===void 0||typeof w=="string"),ya.fromBase64String(w||"")):(di(w===void 0||w instanceof Buffer||w instanceof Uint8Array),ya.fromUint8Array(w||new Uint8Array))}(n,t.targetChange.resumeToken),f=t.targetChange.cause,y=f&&function(b){const w=b.code===void 0?Rt.UNKNOWN:Oie(b.code);return new ln(w,b.message||"")}(f);s=new Nie(a,l,d,y||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=YM(n,a.document.name),d=rp(a.document.updateTime),f=a.document.createTime?rp(a.document.createTime):Xn.min(),y=new il({mapValue:{fields:a.document.fields}}),v=Ya.newFoundDocument(l,d,f,y),b=a.targetIds||[],w=a.removedTargetIds||[];s=new ck(b,w,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=YM(n,a.document),d=a.readTime?rp(a.readTime):Xn.min(),f=Ya.newNoDocument(l,d),y=a.removedTargetIds||[];s=new ck([],y,f.key,f)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=YM(n,a.document),d=a.removedTargetIds||[];s=new ck([],d,l,null)}else{if(!("filter"in t))return $n();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new R4e(l,d),y=a.targetId;s=new kie(y,f)}}return s}function U4e(n,t){let s;if(t instanceof oR)s={update:JX(n,t.key,t.value)};else if(t instanceof Zj)s={delete:CV(n,t.key)};else if(t instanceof xg)s={update:JX(n,t.key,t.data),updateMask:$4e(t.fieldMask)};else{if(!(t instanceof T4e))return $n();s={verify:CV(n,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,f){const y=f.transform;if(y instanceof Gk)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof S0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof b0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Hk)return{fieldPath:f.field.canonicalString(),increment:y.Ie};throw $n()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:L4e(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:$n()}(n,t.precondition)),s}function V4e(n,t){return n&&n.length>0?(di(t!==void 0),n.map(s=>function(l,d){let f=l.updateTime?rp(l.updateTime):rp(d);return f.isEqual(Xn.min())&&(f=rp(d)),new v4e(f,l.transformResults||[])}(s,t))):[]}function F4e(n,t){return{documents:[xie(n,t.path)]}}function j4e(n,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=xie(n,l);const d=function(b){if(b.length!==0)return Vie(Ld.create(b,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const f=function(b){if(b.length!==0)return b.map(w=>function(k){return{field:bS(k.field),direction:z4e(k.dir)}}(w))}(t.orderBy);f&&(s.structuredQuery.orderBy=f);const y=TV(n,t.limit);return y!==null&&(s.structuredQuery.limit=y),t.startAt&&(s.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{ht:s,parent:l}}function B4e(n){let t=x4e(n.parent);const s=n.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){di(a===1);const w=s.from[0];w.allDescendants?l=w.collectionId:t=t.child(w.collectionId)}let d=[];s.where&&(d=function(I){const k=Uie(I);return k instanceof Ld&&hie(k)?k.getFilters():[k]}(s.where));let f=[];s.orderBy&&(f=function(I){return I.map(k=>function(F){return new Wk(TS(F.field),function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(F.direction))}(k))}(s.orderBy));let y=null;s.limit&&(y=function(I){let k;return k=typeof I=="object"?I.value:I,FN(k)?null:k}(s.limit));let v=null;s.startAt&&(v=function(I){const k=!!I.before,x=I.values||[];return new Bk(x,k)}(s.startAt));let b=null;return s.endAt&&(b=function(I){const k=!I.before,x=I.values||[];return new Bk(x,k)}(s.endAt)),a4e(t,l,f,d,y,"F",v,b)}function W4e(n,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $n()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function Uie(n){return n.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=TS(s.unaryFilter.field);return no.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=TS(s.unaryFilter.field);return no.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=TS(s.unaryFilter.field);return no.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=TS(s.unaryFilter.field);return no.create(f,"!=",{nullValue:"NULL_VALUE"});default:return $n()}}(n):n.fieldFilter!==void 0?function(s){return no.create(TS(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $n()}}(s.fieldFilter.op),s.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(s){return Ld.create(s.compositeFilter.filters.map(a=>Uie(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return $n()}}(s.compositeFilter.op))}(n):$n()}function z4e(n){return O4e[n]}function G4e(n){return k4e[n]}function H4e(n){return N4e[n]}function bS(n){return{fieldPath:n.canonicalString()}}function TS(n){return ma.fromServerFormat(n.fieldPath)}function Vie(n){return n instanceof no?function(s){if(s.op==="=="){if(VX(s.value))return{unaryFilter:{field:bS(s.field),op:"IS_NAN"}};if(UX(s.value))return{unaryFilter:{field:bS(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(VX(s.value))return{unaryFilter:{field:bS(s.field),op:"IS_NOT_NAN"}};if(UX(s.value))return{unaryFilter:{field:bS(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bS(s.field),op:G4e(s.op),value:s.value}}}(n):n instanceof Ld?function(s){const a=s.getFilters().map(l=>Vie(l));return a.length===1?a[0]:{compositeFilter:{op:H4e(s.op),filters:a}}}(n):$n()}function $4e(n){const t=[];return n.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function Fie(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(t,s,a,l,d=Xn.min(),f=Xn.min(),y=ya.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=y,this.expectedCount=v}withSequenceNumber(t){return new dg(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new dg(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new dg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new dg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4e{constructor(t){this.Tt=t}}function q4e(n){const t=B4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?zk(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4e{constructor(){this.Tn=new X4e}addToCollectionParentIndex(t,s){return this.Tn.add(s),Ct.resolve()}getCollectionParents(t,s){return Ct.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return Ct.resolve()}deleteFieldIndex(t,s){return Ct.resolve()}deleteAllFieldIndexes(t){return Ct.resolve()}createTargetIndexes(t,s){return Ct.resolve()}getDocumentsMatchingTarget(t,s){return Ct.resolve(null)}getIndexType(t,s){return Ct.resolve(0)}getFieldIndexes(t,s){return Ct.resolve([])}getNextCollectionGroupToUpdate(t){return Ct.resolve(null)}getMinOffset(t,s){return Ct.resolve(bg.min())}getMinOffsetFromCollectionGroup(t,s){return Ct.resolve(bg.min())}updateCollectionGroup(t,s,a){return Ct.resolve()}updateIndexEntries(t,s){return Ct.resolve()}}class X4e{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new yo(Ji.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new yo(Ji.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QX={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jie=41943040;class nl{static withCacheSize(t){return new nl(t,nl.DEFAULT_COLLECTION_PERCENTILE,nl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nl.DEFAULT_COLLECTION_PERCENTILE=10,nl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nl.DEFAULT=new nl(jie,nl.DEFAULT_COLLECTION_PERCENTILE,nl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nl.DISABLED=new nl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new T0(0)}static Kn(){return new T0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZX="LruGarbageCollector",J4e=1048576;function eJ([n,t],[s,a]){const l=mr(n,s);return l===0?mr(t,a):l}class Q4e{constructor(t){this.Hn=t,this.buffer=new yo(eJ),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();eJ(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class Z4e{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){tn(ZX,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){j0(s)?tn(ZX,"Ignoring IndexedDB error during garbage collection: ",s):await F0(s)}await this.er(3e5)})}}class e3e{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return Ct.resolve(VN.ae);const a=new Q4e(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(tn("LruGarbageCollector","Garbage collection skipped; disabled"),Ct.resolve(QX)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(tn("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),QX):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,f,y,v,b;const w=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(tn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(t,l))).next(I=>(a=I,y=Date.now(),this.removeTargets(t,a,s))).next(I=>(d=I,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(I=>(b=Date.now(),vS()<=Cr.DEBUG&&tn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-w}ms
	Determined least recently used ${l} in `+(y-f)+`ms
	Removed ${d} targets in `+(v-y)+`ms
	Removed ${I} documents in `+(b-v)+`ms
Total Duration: ${b-w}ms`),Ct.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function t3e(n,t){return new e3e(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3e{constructor(){this.changes=new zy(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,Ya.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?Ct.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r3e{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i3e{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&sC(a.mutation,l,xl.empty(),_o.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,Rr()).next(()=>a))}getLocalViewOfDocuments(t,s,a=Rr()){const l=fy();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let f=Vw();return d.forEach((y,v)=>{f=f.insert(y,v.overlayedDocument)}),f}))}getOverlayedDocuments(t,s){const a=fy();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,Rr()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((f,y)=>{s.set(f,y)})})}computeViews(t,s,a,l){let d=Bf();const f=iC(),y=function(){return iC()}();return s.forEach((v,b)=>{const w=a.get(b.key);l.has(b.key)&&(w===void 0||w.mutation instanceof xg)?d=d.insert(b.key,b):w!==void 0?(f.set(b.key,w.mutation.getFieldMask()),sC(w.mutation,b,w.mutation.getFieldMask(),_o.now())):f.set(b.key,xl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((b,w)=>f.set(b,w)),s.forEach((b,w)=>{var I;return y.set(b,new r3e(w,(I=f.get(b))!==null&&I!==void 0?I:null))}),y))}recalculateAndSaveOverlays(t,s){const a=iC();let l=new gs((f,y)=>f-y),d=Rr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(f=>{for(const y of f)y.keys().forEach(v=>{const b=s.get(v);if(b===null)return;let w=a.get(v)||xl.empty();w=y.applyToLocalView(b,w),a.set(v,w);const I=(l.get(y.batchId)||Rr()).add(v);l=l.insert(y.batchId,I)})}).next(()=>{const f=[],y=l.getReverseIterator();for(;y.hasNext();){const v=y.getNext(),b=v.key,w=v.value,I=Sie();w.forEach(k=>{if(!d.has(k)){const x=Aie(s.get(k),a.get(k));x!==null&&I.set(k,x),d=d.add(k)}}),f.push(this.documentOverlayCache.saveOverlays(t,b,I))}return Ct.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(f){return wn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):gie(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):Ct.resolve(fy());let y=NC,v=d;return f.next(b=>Ct.forEach(b,(w,I)=>(y<I.largestBatchId&&(y=I.largestBatchId),d.get(w)?Ct.resolve():this.remoteDocumentCache.getEntry(t,w).next(k=>{v=v.insert(w,k)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,v,b,Rr())).next(w=>({batchId:y,changes:vie(w)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new wn(s)).next(a=>{let l=Vw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let f=Vw();return this.indexManager.getCollectionParents(t,d).next(y=>Ct.forEach(y,v=>{const b=function(I,k){return new sR(k,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(s,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(w=>{w.forEach((I,k)=>{f=f.insert(I,k)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(f=>{d.forEach((v,b)=>{const w=b.getKey();f.get(w)===null&&(f=f.insert(w,Ya.newInvalidDocument(w)))});let y=Vw();return f.forEach((v,b)=>{const w=d.get(v);w!==void 0&&sC(w.mutation,b,xl.empty(),_o.now()),WN(s,b)&&(y=y.insert(v,b))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s3e{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return Ct.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:rp(l.createTime)}}(s)),Ct.resolve()}getNamedQuery(t,s){return Ct.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:q4e(l.bundledQuery),readTime:rp(l.readTime)}}(s)),Ct.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o3e{constructor(){this.overlays=new gs(wn.comparator),this.Rr=new Map}getOverlay(t,s){return Ct.resolve(this.overlays.get(s))}getOverlays(t,s){const a=fy();return Ct.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),Ct.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),Ct.resolve()}getOverlaysForCollection(t,s,a){const l=fy(),d=s.length+1,f=new wn(s.child("")),y=this.overlays.getIteratorFrom(f);for(;y.hasNext();){const v=y.getNext().value,b=v.getKey();if(!s.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return Ct.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new gs((b,w)=>b-w);const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===s&&b.largestBatchId>a){let w=d.get(b.largestBatchId);w===null&&(w=fy(),d=d.insert(b.largestBatchId,w)),w.set(b.getKey(),b)}}const y=fy(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,w)=>y.set(b,w)),!(y.size()>=l)););return Ct.resolve(y)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new C4e(s,a));let d=this.Rr.get(s);d===void 0&&(d=Rr(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a3e{constructor(){this.sessionToken=ya.EMPTY_BYTE_STRING}getSessionToken(t){return Ct.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,Ct.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(){this.Vr=new yo(Lo.mr),this.gr=new yo(Lo.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new Lo(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new Lo(t,s))}Sr(t,s){t.forEach(a=>this.removeReference(a,s))}br(t){const s=new wn(new Ji([])),a=new Lo(s,t),l=new Lo(s,t+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new wn(new Ji([])),a=new Lo(s,t),l=new Lo(s,t+1);let d=Rr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(t){const s=new Lo(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class Lo{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return wn.comparator(t.key,s.key)||mr(t.Cr,s.Cr)}static pr(t,s){return mr(t.Cr,s.Cr)||wn.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c3e{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new yo(Lo.mr)}checkEmpty(t){return Ct.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new w4e(d,s,a,l);this.mutationQueue.push(f);for(const y of l)this.Mr=this.Mr.add(new Lo(y.key,d)),this.indexManager.addToCollectionParentIndex(t,y.key.path.popLast());return Ct.resolve(f)}lookupMutationBatch(t,s){return Ct.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return Ct.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Ct.resolve(this.mutationQueue.length===0?$j:this.Fr-1)}getAllMutationBatches(t){return Ct.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new Lo(s,0),l=new Lo(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const y=this.Or(f.Cr);d.push(y)}),Ct.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new yo(mr);return s.forEach(l=>{const d=new Lo(l,0),f=new Lo(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],y=>{a=a.add(y.Cr)})}),Ct.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;wn.isDocumentKey(d)||(d=d.child(""));const f=new Lo(new wn(d),0);let y=new yo(mr);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(y=y.add(v.Cr)),!0)},f),Ct.resolve(this.Br(y))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){di(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Ct.forEach(s.mutations,l=>{const d=new Lo(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new Lo(s,0),l=this.Mr.firstAfterOrEqual(a);return Ct.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ct.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l3e{constructor(t){this.kr=t,this.docs=function(){return new gs(wn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return Ct.resolve(a?a.document.mutableCopy():Ya.newInvalidDocument(s))}getEntries(t,s){let a=Bf();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Ya.newInvalidDocument(l))}),Ct.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=Bf();const f=s.path,y=new wn(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(y);for(;v.hasNext();){const{key:b,value:{document:w}}=v.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||Fje(Vje(w),a)<=0||(l.has(w.key)||WN(s,w))&&(d=d.insert(w.key,w.mutableCopy()))}return Ct.resolve(d)}getAllFromCollectionGroup(t,s,a,l){$n()}qr(t,s){return Ct.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new u3e(this)}getSize(t){return Ct.resolve(this.size)}}class u3e extends n3e{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),Ct.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d3e{constructor(t){this.persistence=t,this.Qr=new zy(s=>Yj(s),Xj),this.lastRemoteSnapshotVersion=Xn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new r4,this.targetCount=0,this.Kr=T0.Un()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),Ct.resolve()}getLastRemoteSnapshotVersion(t){return Ct.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ct.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),Ct.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),Ct.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Kr=new T0(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,Ct.resolve()}updateTargetData(t,s){return this.zn(s),Ct.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Ur.br(s.targetId),this.targetCount-=1,Ct.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((f,y)=>{y.sequenceNumber<=s&&a.get(y.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(t,y.targetId)),l++)}),Ct.waitFor(d).next(()=>l)}getTargetCount(t){return Ct.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return Ct.resolve(a)}addMatchingKeys(t,s,a){return this.Ur.yr(s,a),Ct.resolve()}removeMatchingKeys(t,s,a){this.Ur.Sr(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(f=>{d.push(l.markPotentiallyOrphaned(t,f))}),Ct.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Ur.br(s),Ct.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Ur.vr(s);return Ct.resolve(a)}containsKey(t,s){return Ct.resolve(this.Ur.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bie{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new VN(0),this.zr=!1,this.zr=!0,this.jr=new a3e,this.referenceDelegate=t(this),this.Hr=new d3e(this),this.indexManager=new Y4e,this.remoteDocumentCache=function(l){return new l3e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new K4e(s),this.Yr=new s3e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new o3e,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new c3e(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){tn("MemoryPersistence","Starting transaction:",t);const l=new h3e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return Ct.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class h3e extends Bje{constructor(t){super(),this.currentSequenceNumber=t}}class i4{constructor(t){this.persistence=t,this.ti=new r4,this.ni=null}static ri(t){return new i4(t)}get ii(){if(this.ni)return this.ni;throw $n()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),Ct.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),Ct.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),Ct.resolve()}removeTarget(t,s){this.ti.br(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ct.forEach(this.ii,a=>{const l=wn.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,Xn.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return Ct.or([()=>Ct.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class Kk{constructor(t,s){this.persistence=t,this.oi=new zy(a=>Gje(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=t3e(this,s)}static ri(t,s){return new Kk(t,s)}Zr(){}Xr(t){return Ct.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return Ct.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?Ct.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,f=>this.ar(t,f,s).next(y=>{y||(a++,d.removeEntry(f,Xn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),Ct.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),Ct.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),Ct.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),Ct.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=sk(t.data.value)),s}ar(t,s,a){return Ct.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return Ct.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s4{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=Rr(),l=Rr();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new s4(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p3e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f3e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return qMe()?8:Wje(Ja())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new p3e;return this._s(t,s,f).next(y=>{if(d.result=y,this.Xi)return this.us(t,s,f,y.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(vS()<=Cr.DEBUG&&tn("QueryEngine","SDK will not create cache indexes for query:",SS(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Ct.resolve()):(vS()<=Cr.DEBUG&&tn("QueryEngine","Query:",SS(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(vS()<=Cr.DEBUG&&tn("QueryEngine","The SDK decides to create cache indexes for query:",SS(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,np(s))):Ct.resolve())}rs(t,s){if(WX(s))return Ct.resolve(null);let a=np(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=zk(s,null,"F"),a=np(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const f=Rr(...d);return this.ns.getDocuments(t,f).next(y=>this.indexManager.getMinOffset(t,a).next(v=>{const b=this.cs(s,y);return this.ls(s,b,f,v.readTime)?this.rs(t,zk(s,null,"F")):this.hs(t,b,s,v)}))})))}ss(t,s,a,l){return WX(s)||l.isEqual(Xn.min())?Ct.resolve(null):this.ns.getDocuments(t,a).next(d=>{const f=this.cs(s,d);return this.ls(s,f,a,l)?Ct.resolve(null):(vS()<=Cr.DEBUG&&tn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),SS(s)),this.hs(t,f,s,Uje(l,NC)).next(y=>y))})}cs(t,s){let a=new yo(yie(t));return s.forEach((l,d)=>{WN(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return vS()<=Cr.DEBUG&&tn("QueryEngine","Using full collection scan to execute query:",SS(s)),this.ns.getDocumentsMatchingQuery(t,s,bg.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4="LocalStore",m3e=3e8;class g3e{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new gs(mr),this.Is=new zy(d=>Yj(d),Xj),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new i3e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function _3e(n,t,s,a){return new g3e(n,t,s,a)}async function Wie(n,t){const s=er(n);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],y=[];let v=Rr();for(const b of l){f.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}for(const b of d){y.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}return s.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:f,addedBatchIds:y}))})})}function y3e(n,t){const s=er(n);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(y,v,b,w){const I=b.batch,k=I.keys();let x=Ct.resolve();return k.forEach(F=>{x=x.next(()=>w.getEntry(v,F)).next(B=>{const z=b.docVersions.get(F);di(z!==null),B.version.compareTo(z)<0&&(I.applyToRemoteDocument(B,b),B.isValidDocument()&&(B.setReadTime(b.commitVersion),w.addEntry(B)))})}),x.next(()=>y.mutationQueue.removeMutationBatch(v,I))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(y){let v=Rr();for(let b=0;b<y.mutationResults.length;++b)y.mutationResults[b].transformResults.length>0&&(v=v.add(y.batch.mutations[b].key));return v}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function zie(n){const t=er(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function E3e(n,t){const s=er(n),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const y=[];t.targetChanges.forEach((w,I)=>{const k=l.get(I);if(!k)return;y.push(s.Hr.removeMatchingKeys(d,w.removedDocuments,I).next(()=>s.Hr.addMatchingKeys(d,w.addedDocuments,I)));let x=k.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(I)!==null?x=x.withResumeToken(ya.EMPTY_BYTE_STRING,Xn.min()).withLastLimboFreeSnapshotVersion(Xn.min()):w.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(w.resumeToken,a)),l=l.insert(I,x),function(B,z,J){return B.resumeToken.approximateByteSize()===0||z.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=m3e?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0}(k,x,w)&&y.push(s.Hr.updateTargetData(d,x))});let v=Bf(),b=Rr();if(t.documentUpdates.forEach(w=>{t.resolvedLimboDocuments.has(w)&&y.push(s.persistence.referenceDelegate.updateLimboDocument(d,w))}),y.push(v3e(d,f,t.documentUpdates).next(w=>{v=w.Vs,b=w.fs})),!a.isEqual(Xn.min())){const w=s.Hr.getLastRemoteSnapshotVersion(d).next(I=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));y.push(w)}return Ct.waitFor(y).next(()=>f.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(s.Ts=l,d))}function v3e(n,t,s){let a=Rr(),l=Rr();return s.forEach(d=>a=a.add(d)),t.getEntries(n,a).next(d=>{let f=Bf();return s.forEach((y,v)=>{const b=d.get(y);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(y)),v.isNoDocument()&&v.version.isEqual(Xn.min())?(t.removeEntry(y,v.readTime),f=f.insert(y,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(v),f=f.insert(y,v)):tn(o4,"Ignoring outdated watch update for ",y,". Current version:",b.version," Watch version:",v.version)}),{Vs:f,fs:l}})}function S3e(n,t){const s=er(n);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=$j),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function b3e(n,t){const s=er(n);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,Ct.resolve(l)):s.Hr.allocateTargetId(a).next(f=>(l=new dg(t,f,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function IV(n,t,s){const a=er(n),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!j0(f))throw f;tn(o4,`Failed to update sequence numbers for target ${t}: ${f}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function tJ(n,t,s){const a=er(n);let l=Xn.min(),d=Rr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(v,b,w){const I=er(v),k=I.Is.get(w);return k!==void 0?Ct.resolve(I.Ts.get(k)):I.Hr.getTargetData(b,w)}(a,f,np(t)).next(y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,y.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,t,s?l:Xn.min(),s?d:Rr())).next(y=>(T3e(a,l4e(t),y),{documents:y,gs:d})))}function T3e(n,t,s){let a=n.Es.get(t)||Xn.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(t,a)}class nJ{constructor(){this.activeTargetIds=m4e()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class w3e{constructor(){this.ho=new nJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new nJ,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C3e{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rJ="ConnectivityMonitor";class iJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){tn(rJ,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){tn(rJ,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TO=null;function AV(){return TO===null?TO=function(){return 268435456+Math.round(2147483648*Math.random())}():TO++,"0x"+TO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XM="RestConnection",R3e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class I3e{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===Fk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(t,s,a,l,d){const f=AV(),y=this.bo(t,s.toUriEncodedString());tn(XM,`Sending RPC '${t}' ${f}:`,y,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,y,v,a).then(b=>(tn(XM,`Received RPC '${t}' ${f}: `,b),b),b=>{throw _0(XM,`RPC '${t}' ${f} failed with error: `,b,"url: ",y,"request:",a),b})}Co(t,s,a,l,d,f){return this.So(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+V0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}bo(t,s){const a=R3e[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A3e{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha="WebChannelConnection";class P3e extends I3e{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=AV();return new Promise((f,y)=>{const v=new $re;v.setWithCredentials(!0),v.listenOnce(Kre.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case ik.NO_ERROR:const w=v.getResponseJson();tn(Ha,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(w)),f(w);break;case ik.TIMEOUT:tn(Ha,`RPC '${t}' ${d} timed out`),y(new ln(Rt.DEADLINE_EXCEEDED,"Request time out"));break;case ik.HTTP_ERROR:const I=v.getStatus();if(tn(Ha,`RPC '${t}' ${d} failed with status:`,I,"response text:",v.getResponseText()),I>0){let k=v.getResponseJson();Array.isArray(k)&&(k=k[0]);const x=k==null?void 0:k.error;if(x&&x.status&&x.message){const F=function(z){const J=z.toLowerCase().replace(/_/g,"-");return Object.values(Rt).indexOf(J)>=0?J:Rt.UNKNOWN}(x.status);y(new ln(F,x.message))}else y(new ln(Rt.UNKNOWN,"Server responded with status "+v.getStatus()))}else y(new ln(Rt.UNAVAILABLE,"Connection failed."));break;default:$n()}}finally{tn(Ha,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);tn(Ha,`RPC '${t}' ${d} sending request:`,l),v.send(s,"POST",b,a,15)})}Wo(t,s,a){const l=AV(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],f=Xre(),y=Yre(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,s,a),v.encodeInitMessageHeaders=!0;const w=d.join("");tn(Ha,`Creating RPC '${t}' stream ${l}: ${w}`,v);const I=f.createWebChannel(w,v);let k=!1,x=!1;const F=new A3e({Fo:z=>{x?tn(Ha,`Not sending because RPC '${t}' stream ${l} is closed:`,z):(k||(tn(Ha,`Opening RPC '${t}' stream ${l} transport.`),I.open(),k=!0),tn(Ha,`RPC '${t}' stream ${l} sending:`,z),I.send(z))},Mo:()=>I.close()}),B=(z,J,$)=>{z.listen(J,ie=>{try{$(ie)}catch(ue){setTimeout(()=>{throw ue},0)}})};return B(I,Uw.EventType.OPEN,()=>{x||(tn(Ha,`RPC '${t}' stream ${l} transport opened.`),F.Qo())}),B(I,Uw.EventType.CLOSE,()=>{x||(x=!0,tn(Ha,`RPC '${t}' stream ${l} transport closed`),F.Uo())}),B(I,Uw.EventType.ERROR,z=>{x||(x=!0,_0(Ha,`RPC '${t}' stream ${l} transport errored:`,z),F.Uo(new ln(Rt.UNAVAILABLE,"The operation could not be completed")))}),B(I,Uw.EventType.MESSAGE,z=>{var J;if(!x){const $=z.data[0];di(!!$);const ie=$,ue=(ie==null?void 0:ie.error)||((J=ie[0])===null||J===void 0?void 0:J.error);if(ue){tn(Ha,`RPC '${t}' stream ${l} received error:`,ue);const re=ue.status;let fe=function(Q){const se=Qs[Q];if(se!==void 0)return Oie(se)}(re),q=ue.message;fe===void 0&&(fe=Rt.INTERNAL,q="Unknown error status: "+re+" with message "+ue.message),x=!0,F.Uo(new ln(fe,q)),I.close()}else tn(Ha,`RPC '${t}' stream ${l} received:`,$),F.Ko($)}}),B(y,qre.STAT_EVENT,z=>{z.stat===gV.PROXY?tn(Ha,`RPC '${t}' stream ${l} detected buffering proxy`):z.stat===gV.NOPROXY&&tn(Ha,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{F.$o()},0),F}}function JM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $N(n){return new D4e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gie{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&tn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sJ="PersistentStream";class Hie{constructor(t,s,a,l,d,f,y,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=y,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Gie(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===Rt.RESOURCE_EXHAUSTED?(jf(s.toString()),jf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===Rt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new ln(Rt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return tn(sJ,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(tn(sJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class O3e extends Hie{constructor(t,s,a,l,d,f){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=M4e(this.serializer,t),a=function(d){if(!("targetChange"in d))return Xn.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?Xn.min():f.readTime?rp(f.readTime):Xn.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=RV(this.serializer),s.addTarget=function(d,f){let y;const v=f.target;if(y=SV(v)?{documents:F4e(d,v)}:{query:j4e(d,v).ht},y.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){y.resumeToken=Die(d,f.resumeToken);const b=TV(d,f.expectedCount);b!==null&&(y.expectedCount=b)}else if(f.snapshotVersion.compareTo(Xn.min())>0){y.readTime=$k(d,f.snapshotVersion.toTimestamp());const b=TV(d,f.expectedCount);b!==null&&(y.expectedCount=b)}return y}(this.serializer,t);const a=W4e(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=RV(this.serializer),s.removeTarget=t,this.I_(s)}}class k3e extends Hie{constructor(t,s,a,l,d,f){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return di(!!t.streamToken),this.lastStreamToken=t.streamToken,di(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){di(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=V4e(t.writeResults,t.commitTime),a=rp(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=RV(this.serializer),this.I_(t)}b_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>U4e(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N3e{}class D3e extends N3e{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new ln(Rt.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.So(t,wV(s,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===Rt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new ln(Rt.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,y])=>this.connection.Co(t,wV(s,a),l,f,y,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Rt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new ln(Rt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class L3e{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(jf(s),this.N_=!1):tn("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uy="RemoteStore";class x3e{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{Gy(this)&&(tn(Uy,"Restarting streams for network reachability change."),await async function(v){const b=er(v);b.W_.add(4),await cR(b),b.j_.set("Unknown"),b.W_.delete(4),await KN(b)}(this))})}),this.j_=new L3e(a,l)}}async function KN(n){if(Gy(n))for(const t of n.G_)await t(!0)}async function cR(n){for(const t of n.G_)await t(!1)}function $ie(n,t){const s=er(n);s.K_.has(t.targetId)||(s.K_.set(t.targetId,t),u4(s)?l4(s):B0(s).c_()&&c4(s,t))}function a4(n,t){const s=er(n),a=B0(s);s.K_.delete(t),a.c_()&&Kie(s,t),s.K_.size===0&&(a.c_()?a.P_():Gy(s)&&s.j_.set("Unknown"))}function c4(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Xn.min())>0){const s=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}B0(n).y_(t)}function Kie(n,t){n.H_.Ne(t),B0(n).w_(t)}function l4(n){n.H_=new P4e({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.K_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),B0(n).start(),n.j_.B_()}function u4(n){return Gy(n)&&!B0(n).u_()&&n.K_.size>0}function Gy(n){return er(n).W_.size===0}function qie(n){n.H_=void 0}async function M3e(n){n.j_.set("Online")}async function U3e(n){n.K_.forEach((t,s)=>{c4(n,t)})}async function V3e(n,t){qie(n),u4(n)?(n.j_.q_(t),l4(n)):n.j_.set("Unknown")}async function F3e(n,t,s){if(n.j_.set("Online"),t instanceof Nie&&t.state===2&&t.cause)try{await async function(l,d){const f=d.cause;for(const y of d.targetIds)l.K_.has(y)&&(await l.remoteSyncer.rejectListen(y,f),l.K_.delete(y),l.H_.removeTarget(y))}(n,t)}catch(a){tn(Uy,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await qk(n,a)}else if(t instanceof ck?n.H_.We(t):t instanceof kie?n.H_.Ze(t):n.H_.je(t),!s.isEqual(Xn.min()))try{const a=await zie(n.localStore);s.compareTo(a)>=0&&await function(d,f){const y=d.H_.ot(f);return y.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.K_.get(b);w&&d.K_.set(b,w.withResumeToken(v.resumeToken,f))}}),y.targetMismatches.forEach((v,b)=>{const w=d.K_.get(v);if(!w)return;d.K_.set(v,w.withResumeToken(ya.EMPTY_BYTE_STRING,w.snapshotVersion)),Kie(d,v);const I=new dg(w.target,v,b,w.sequenceNumber);c4(d,I)}),d.remoteSyncer.applyRemoteEvent(y)}(n,s)}catch(a){tn(Uy,"Failed to raise snapshot:",a),await qk(n,a)}}async function qk(n,t,s){if(!j0(t))throw t;n.W_.add(1),await cR(n),n.j_.set("Offline"),s||(s=()=>zie(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{tn(Uy,"Retrying IndexedDB access"),await s(),n.W_.delete(1),await KN(n)})}function Yie(n,t){return t().catch(s=>qk(n,s,t))}async function qN(n){const t=er(n),s=Rg(t);let a=t.U_.length>0?t.U_[t.U_.length-1].batchId:$j;for(;j3e(t);)try{const l=await S3e(t.localStore,a);if(l===null){t.U_.length===0&&s.P_();break}a=l.batchId,B3e(t,l)}catch(l){await qk(t,l)}Xie(t)&&Jie(t)}function j3e(n){return Gy(n)&&n.U_.length<10}function B3e(n,t){n.U_.push(t);const s=Rg(n);s.c_()&&s.S_&&s.b_(t.mutations)}function Xie(n){return Gy(n)&&!Rg(n).u_()&&n.U_.length>0}function Jie(n){Rg(n).start()}async function W3e(n){Rg(n).C_()}async function z3e(n){const t=Rg(n);for(const s of n.U_)t.b_(s.mutations)}async function G3e(n,t,s){const a=n.U_.shift(),l=e4.from(a,t,s);await Yie(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await qN(n)}async function H3e(n,t){t&&Rg(n).S_&&await async function(a,l){if(function(f){return I4e(f)&&f!==Rt.ABORTED}(l.code)){const d=a.U_.shift();Rg(a).h_(),await Yie(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await qN(a)}}(n,t),Xie(n)&&Jie(n)}async function oJ(n,t){const s=er(n);s.asyncQueue.verifyOperationInProgress(),tn(Uy,"RemoteStore received new credentials");const a=Gy(s);s.W_.add(3),await cR(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await KN(s)}async function $3e(n,t){const s=er(n);t?(s.W_.delete(2),await KN(s)):t||(s.W_.add(2),await cR(s),s.j_.set("Unknown"))}function B0(n){return n.J_||(n.J_=function(s,a,l){const d=er(s);return d.M_(),new O3e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:M3e.bind(null,n),No:U3e.bind(null,n),Lo:V3e.bind(null,n),p_:F3e.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),u4(n)?l4(n):n.j_.set("Unknown")):(await n.J_.stop(),qie(n))})),n.J_}function Rg(n){return n.Y_||(n.Y_=function(s,a,l){const d=er(s);return d.M_(),new k3e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:W3e.bind(null,n),Lo:H3e.bind(null,n),D_:z3e.bind(null,n),v_:G3e.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await qN(n)):(await n.Y_.stop(),n.U_.length>0&&(tn(Uy,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Of,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const f=Date.now()+a,y=new d4(t,s,f,l,d);return y.start(a),y}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ln(Rt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function h4(n,t){if(jf("AsyncQueue",`${t}: ${n}`),j0(n))return new ln(Rt.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{static emptySet(t){return new n0(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||wn.comparator(s.key,a.key):(s,a)=>wn.comparator(s.key,a.key),this.keyedMap=Vw(),this.sortedSet=new gs(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof n0)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new n0;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aJ{constructor(){this.Z_=new gs(wn.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):$n():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class w0{constructor(t,s,a,l,d,f,y,v,b){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=y,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(t,s,a,l,d){const f=[];return s.forEach(y=>{f.push({type:0,doc:y})}),new w0(t,s,n0.emptySet(s),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&BN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K3e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class q3e{constructor(){this.queries=cJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=er(s),d=l.queries;l.queries=cJ(),d.forEach((f,y)=>{for(const v of y.ta)v.onError(a)})})(this,new ln(Rt.ABORTED,"Firestore shutting down"))}}function cJ(){return new zy(n=>_ie(n),BN)}async function Qie(n,t){const s=er(n);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new K3e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(f){const y=h4(f,`Initialization of query '${SS(t.query)}' failed`);return void t.onError(y)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&p4(s)}async function Zie(n,t){const s=er(n),a=t.query;let l=3;const d=s.queries.get(a);if(d){const f=d.ta.indexOf(t);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function Y3e(n,t){const s=er(n);let a=!1;for(const l of t){const d=l.query,f=s.queries.get(d);if(f){for(const y of f.ta)y.oa(l)&&(a=!0);f.ea=l}}a&&p4(s)}function X3e(n,t,s){const a=er(n),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function p4(n){n.ia.forEach(t=>{t.next()})}var PV,lJ;(lJ=PV||(PV={}))._a="default",lJ.Cache="cache";class ese{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new w0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=w0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==PV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tse{constructor(t){this.key=t}}class nse{constructor(t){this.key=t}}class J3e{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Rr(),this.mutatedKeys=Rr(),this.ya=yie(t),this.wa=new n0(this.ya)}get Sa(){return this.fa}ba(t,s){const a=s?s.Da:new aJ,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,f=l,y=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((w,I)=>{const k=l.get(w),x=WN(this.query,I)?I:null,F=!!k&&this.mutatedKeys.has(k.key),B=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let z=!1;k&&x?k.data.isEqual(x.data)?F!==B&&(a.track({type:3,doc:x}),z=!0):this.va(k,x)||(a.track({type:2,doc:x}),z=!0,(v&&this.ya(x,v)>0||b&&this.ya(x,b)<0)&&(y=!0)):!k&&x?(a.track({type:0,doc:x}),z=!0):k&&!x&&(a.track({type:1,doc:k}),z=!0,(v||b)&&(y=!0)),z&&(x?(f=f.add(x),d=B?d.add(w):d.delete(w)):(f=f.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const w=this.query.limitType==="F"?f.last():f.first();f=f.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:f,Da:a,ls:y,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const f=t.Da.X_();f.sort((w,I)=>function(x,F){const B=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $n()}};return B(x)-B(F)}(w.type,I.type)||this.ya(w.doc,I.doc)),this.Ca(a),l=l!=null&&l;const y=s&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,f.length!==0||b?{snapshot:new w0(this.query,t.wa,d,f,t.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:y}:{Ma:y}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new aJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Rr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new nse(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new tse(a))}),s}Oa(t){this.fa=t.gs,this.pa=Rr();const s=this.ba(t.documents);return this.applyChanges(s,!0)}Na(){return w0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const f4="SyncEngine";class Q3e{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class Z3e{constructor(t){this.key=t,this.Ba=!1}}class e5e{constructor(t,s,a,l,d,f){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new zy(y=>_ie(y),BN),this.qa=new Map,this.Qa=new Set,this.$a=new gs(wn.comparator),this.Ua=new Map,this.Ka=new r4,this.Wa={},this.Ga=new Map,this.za=T0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function t5e(n,t,s=!0){const a=cse(n);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await rse(a,t,s,!0),l}async function n5e(n,t){const s=cse(n);await rse(s,t,!0,!1)}async function rse(n,t,s,a){const l=await b3e(n.localStore,np(t)),d=l.targetId,f=n.sharedClientState.addLocalQueryTarget(d,s);let y;return a&&(y=await r5e(n,t,d,f==="current",l.resumeToken)),n.isPrimaryClient&&s&&$ie(n.remoteStore,l),y}async function r5e(n,t,s,a,l){n.Ha=(I,k,x)=>async function(B,z,J,$){let ie=z.view.ba(J);ie.ls&&(ie=await tJ(B.localStore,z.query,!1).then(({documents:q})=>z.view.ba(q,ie)));const ue=$&&$.targetChanges.get(z.targetId),re=$&&$.targetMismatches.get(z.targetId)!=null,fe=z.view.applyChanges(ie,B.isPrimaryClient,ue,re);return dJ(B,z.targetId,fe.Ma),fe.snapshot}(n,I,k,x);const d=await tJ(n.localStore,t,!0),f=new J3e(t,d.gs),y=f.ba(d.documents),v=aR.createSynthesizedTargetChangeForCurrentChange(s,a&&n.onlineState!=="Offline",l),b=f.applyChanges(y,n.isPrimaryClient,v);dJ(n,s,b.Ma);const w=new Q3e(t,s,f);return n.ka.set(t,w),n.qa.has(s)?n.qa.get(s).push(t):n.qa.set(s,[t]),b.snapshot}async function i5e(n,t,s){const a=er(n),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!BN(f,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await IV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&a4(a.remoteStore,l.targetId),OV(a,l.targetId)}).catch(F0)):(OV(a,l.targetId),await IV(a.localStore,l.targetId,!0))}async function s5e(n,t){const s=er(n),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),a4(s.remoteStore,a.targetId))}async function o5e(n,t,s){const a=p5e(n);try{const l=await function(f,y){const v=er(f),b=_o.now(),w=y.reduce((x,F)=>x.add(F.key),Rr());let I,k;return v.persistence.runTransaction("Locally write mutations","readwrite",x=>{let F=Bf(),B=Rr();return v.ds.getEntries(x,w).next(z=>{F=z,F.forEach((J,$)=>{$.isValidDocument()||(B=B.add(J))})}).next(()=>v.localDocuments.getOverlayedDocuments(x,F)).next(z=>{I=z;const J=[];for(const $ of y){const ie=b4e($,I.get($.key).overlayedDocument);ie!=null&&J.push(new xg($.key,ie,lie(ie.value.mapValue),Ou.exists(!0)))}return v.mutationQueue.addMutationBatch(x,b,J,y)}).next(z=>{k=z;const J=z.applyToLocalDocumentSet(I,B);return v.documentOverlayCache.saveOverlays(x,z.batchId,J)})}).then(()=>({batchId:k.batchId,changes:vie(I)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(f,y,v){let b=f.Wa[f.currentUser.toKey()];b||(b=new gs(mr)),b=b.insert(y,v),f.Wa[f.currentUser.toKey()]=b}(a,l.batchId,s),await lR(a,l.changes),await qN(a.remoteStore)}catch(l){const d=h4(l,"Failed to persist write");s.reject(d)}}async function ise(n,t){const s=er(n);try{const a=await E3e(s.localStore,t);t.targetChanges.forEach((l,d)=>{const f=s.Ua.get(d);f&&(di(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?di(f.Ba):l.removedDocuments.size>0&&(di(f.Ba),f.Ba=!1))}),await lR(s,a,t)}catch(a){await F0(a)}}function uJ(n,t,s){const a=er(n);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,f)=>{const y=f.view.sa(t);y.snapshot&&l.push(y.snapshot)}),function(f,y){const v=er(f);v.onlineState=y;let b=!1;v.queries.forEach((w,I)=>{for(const k of I.ta)k.sa(y)&&(b=!0)}),b&&p4(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function a5e(n,t,s){const a=er(n);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ua.get(t),d=l&&l.key;if(d){let f=new gs(wn.comparator);f=f.insert(d,Ya.newNoDocument(d,Xn.min()));const y=Rr().add(d),v=new HN(Xn.min(),new Map,new gs(mr),f,y);await ise(a,v),a.$a=a.$a.remove(d),a.Ua.delete(t),m4(a)}else await IV(a.localStore,t,!1).then(()=>OV(a,t,s)).catch(F0)}async function c5e(n,t){const s=er(n),a=t.batch.batchId;try{const l=await y3e(s.localStore,t);ose(s,a,null),sse(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await lR(s,l)}catch(l){await F0(l)}}async function l5e(n,t,s){const a=er(n);try{const l=await function(f,y){const v=er(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let w;return v.mutationQueue.lookupMutationBatch(b,y).next(I=>(di(I!==null),w=I.keys(),v.mutationQueue.removeMutationBatch(b,I))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,w,y)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,w)).next(()=>v.localDocuments.getDocuments(b,w))})}(a.localStore,t);ose(a,t,s),sse(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await lR(a,l)}catch(l){await F0(l)}}function sse(n,t){(n.Ga.get(t)||[]).forEach(s=>{s.resolve()}),n.Ga.delete(t)}function ose(n,t,s){const a=er(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function OV(n,t,s=null){n.sharedClientState.removeLocalQueryTarget(t);for(const a of n.qa.get(t))n.ka.delete(a),s&&n.La.Ja(a,s);n.qa.delete(t),n.isPrimaryClient&&n.Ka.br(t).forEach(a=>{n.Ka.containsKey(a)||ase(n,a)})}function ase(n,t){n.Qa.delete(t.path.canonicalString());const s=n.$a.get(t);s!==null&&(a4(n.remoteStore,s),n.$a=n.$a.remove(t),n.Ua.delete(s),m4(n))}function dJ(n,t,s){for(const a of s)a instanceof tse?(n.Ka.addReference(a.key,t),u5e(n,a)):a instanceof nse?(tn(f4,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,t),n.Ka.containsKey(a.key)||ase(n,a.key)):$n()}function u5e(n,t){const s=t.key,a=s.path.canonicalString();n.$a.get(s)||n.Qa.has(a)||(tn(f4,"New document in limbo: "+s),n.Qa.add(a),m4(n))}function m4(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const s=new wn(Ji.fromString(t)),a=n.za.next();n.Ua.set(a,new Z3e(s)),n.$a=n.$a.insert(s,a),$ie(n.remoteStore,new dg(np(Jj(s.path)),a,"TargetPurposeLimboResolution",VN.ae))}}async function lR(n,t,s){const a=er(n),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((y,v)=>{f.push(a.Ha(v,t,s).then(b=>{var w;if((b||s)&&a.isPrimaryClient){const I=b?!b.fromCache:(w=s==null?void 0:s.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,I?"current":"not-current")}if(b){l.push(b);const I=s4.Yi(v.targetId,b);d.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(v,b){const w=er(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Ct.forEach(b,k=>Ct.forEach(k.Hi,x=>w.persistence.referenceDelegate.addReference(I,k.targetId,x)).next(()=>Ct.forEach(k.Ji,x=>w.persistence.referenceDelegate.removeReference(I,k.targetId,x)))))}catch(I){if(!j0(I))throw I;tn(o4,"Failed to update sequence numbers: "+I)}for(const I of b){const k=I.targetId;if(!I.fromCache){const x=w.Ts.get(k),F=x.snapshotVersion,B=x.withLastLimboFreeSnapshotVersion(F);w.Ts=w.Ts.insert(k,B)}}}(a.localStore,d))}async function d5e(n,t){const s=er(n);if(!s.currentUser.isEqual(t)){tn(f4,"User change. New user:",t.toKey());const a=await Wie(s.localStore,t);s.currentUser=t,function(d,f){d.Ga.forEach(y=>{y.forEach(v=>{v.reject(new ln(Rt.CANCELLED,f))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await lR(s,a.Rs)}}function h5e(n,t){const s=er(n),a=s.Ua.get(t);if(a&&a.Ba)return Rr().add(a.key);{let l=Rr();const d=s.qa.get(t);if(!d)return l;for(const f of d){const y=s.ka.get(f);l=l.unionWith(y.view.Sa)}return l}}function cse(n){const t=er(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=ise.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=h5e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=a5e.bind(null,t),t.La.p_=Y3e.bind(null,t.eventManager),t.La.Ja=X3e.bind(null,t.eventManager),t}function p5e(n){const t=er(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=c5e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=l5e.bind(null,t),t}class Yk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=$N(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return _3e(this.persistence,new f3e,t.initialUser,this.serializer)}Xa(t){return new Bie(i4.ri,this.serializer)}Za(t){return new w3e}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Yk.provider={build:()=>new Yk};class f5e extends Yk{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){di(this.persistence.referenceDelegate instanceof Kk);const a=this.persistence.referenceDelegate.garbageCollector;return new Z4e(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?nl.withCacheSize(this.cacheSizeBytes):nl.DEFAULT;return new Bie(a=>Kk.ri(a,s),this.serializer)}}class kV{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>uJ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=d5e.bind(null,this.syncEngine),await $3e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new q3e}()}createDatastore(t){const s=$N(t.databaseInfo.databaseId),a=function(d){return new P3e(d)}(t.databaseInfo);return function(d,f,y,v){return new D3e(d,f,y,v)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,f,y){return new x3e(a,l,d,f,y)}(this.localStore,this.datastore,t.asyncQueue,s=>uJ(this.syncEngine,s,0),function(){return iJ.D()?new iJ:new C3e}())}createSyncEngine(t,s){return function(l,d,f,y,v,b,w){const I=new e5e(l,d,f,y,v,b);return w&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=er(l);tn(Uy,"RemoteStore shutting down."),d.W_.add(5),await cR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}kV.provider={build:()=>new kV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lse{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):jf("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ig="FirestoreClient";class m5e{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=qa.UNAUTHENTICATED,this.clientId=Zre.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{tn(Ig,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(tn(Ig,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Of;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=h4(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function QM(n,t){n.asyncQueue.verifyOperationInProgress(),tn(Ig,"Initializing OfflineComponentProvider");const s=n.configuration;await t.initialize(s);let a=s.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Wie(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function hJ(n,t){n.asyncQueue.verifyOperationInProgress();const s=await g5e(n);tn(Ig,"Initializing OnlineComponentProvider"),await t.initialize(s,n.configuration),n.setCredentialChangeListener(a=>oJ(t.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>oJ(t.remoteStore,l)),n._onlineComponents=t}async function g5e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){tn(Ig,"Using user provided OfflineComponentProvider");try{await QM(n,n._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===Rt.FAILED_PRECONDITION||l.code===Rt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;_0("Error using user provided cache. Falling back to memory cache: "+s),await QM(n,new Yk)}}else tn(Ig,"Using default OfflineComponentProvider"),await QM(n,new f5e(void 0));return n._offlineComponents}async function use(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(tn(Ig,"Using user provided OnlineComponentProvider"),await hJ(n,n._uninitializedComponentsProvider._online)):(tn(Ig,"Using default OnlineComponentProvider"),await hJ(n,new kV))),n._onlineComponents}function _5e(n){return use(n).then(t=>t.syncEngine)}async function dse(n){const t=await use(n),s=t.eventManager;return s.onListen=t5e.bind(null,t.syncEngine),s.onUnlisten=i5e.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=n5e.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=s5e.bind(null,t.syncEngine),s}function y5e(n,t,s={}){const a=new Of;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,y,v,b){const w=new lse({next:k=>{w.su(),f.enqueueAndForget(()=>Zie(d,I));const x=k.docs.has(y);!x&&k.fromCache?b.reject(new ln(Rt.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&k.fromCache&&v&&v.source==="server"?b.reject(new ln(Rt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(k)},error:k=>b.reject(k)}),I=new ese(Jj(y.path),w,{includeMetadataChanges:!0,Ta:!0});return Qie(d,I)}(await dse(n),n.asyncQueue,t,s,a)),a.promise}function E5e(n,t,s={}){const a=new Of;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,y,v,b){const w=new lse({next:k=>{w.su(),f.enqueueAndForget(()=>Zie(d,I)),k.fromCache&&v.source==="server"?b.reject(new ln(Rt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(k)},error:k=>b.reject(k)}),I=new ese(y,w,{includeMetadataChanges:!0,Ta:!0});return Qie(d,I)}(await dse(n),n.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hse(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pse(n,t,s){if(!s)throw new ln(Rt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function v5e(n,t,s,a){if(t===!0&&a===!0)throw new ln(Rt.INVALID_ARGUMENT,`${n} and ${s} cannot be used together.`)}function fJ(n){if(!wn.isDocumentKey(n))throw new ln(Rt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function mJ(n){if(wn.isDocumentKey(n))throw new ln(Rt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function YN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":$n()}function xd(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new ln(Rt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=YN(n);throw new ln(Rt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fse="firestore.googleapis.com",gJ=!0;class _J{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new ln(Rt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=fse,this.ssl=gJ}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:gJ;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=jie;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<J4e)throw new ln(Rt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}v5e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hse((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new ln(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new ln(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new ln(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class XN{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _J({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ln(Rt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new ln(Rt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _J(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new Aje;switch(a.type){case"firstParty":return new Nje(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new ln(Rt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=pJ.get(s);a&&(tn("ComponentProvider","Removing Datastore"),pJ.delete(s),a.terminate())}(this),Promise.resolve()}}function S5e(n,t,s,a={}){var l;const d=(n=xd(n,XN))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),y=`${t}:${s}`;d.host!==fse&&d.host!==y&&_0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:y,ssl:!1,emulatorOptions:a});if(!Uf(v,f)&&(n._setSettings(v),a.mockUserToken)){let b,w;if(typeof a.mockUserToken=="string")b=a.mockUserToken,w=qa.MOCK_USER;else{b=nre(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new ln(Rt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new qa(I)}n._authCredentials=new Pje(new Jre(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new Hy(this.firestore,t,this._query)}}class vc{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gg(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new vc(this.firestore,t,this._key)}}class gg extends Hy{constructor(t,s,a){super(t,s,Jj(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new vc(this.firestore,null,new wn(t))}withConverter(t){return new gg(this.firestore,t,this._path)}}function Ag(n,t,...s){if(n=as(n),pse("collection","path",t),n instanceof XN){const a=Ji.fromString(t,...s);return mJ(a),new gg(n,null,a)}{if(!(n instanceof vc||n instanceof gg))throw new ln(Rt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Ji.fromString(t,...s));return mJ(a),new gg(n.firestore,null,a)}}function ri(n,t,...s){if(n=as(n),arguments.length===1&&(t=Zre.newId()),pse("doc","path",t),n instanceof XN){const a=Ji.fromString(t,...s);return fJ(a),new vc(n,null,new wn(a))}{if(!(n instanceof vc||n instanceof gg))throw new ln(Rt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Ji.fromString(t,...s));return fJ(a),new vc(n.firestore,n instanceof gg?n.converter:null,new wn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yJ="AsyncQueue";class EJ{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Gie(this,"async_queue_retry"),this.Su=()=>{const a=JM();a&&tn(yJ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=t;const s=JM();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=JM();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new Of;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!j0(t))throw t;tn(yJ,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.bu.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let y=f.message||"";return f.stack&&(y=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),y}(a);throw jf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=d4.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&$n()}verifyOperationInProgress(){}async Mu(){let t;do t=this.bu,await t;while(t!==this.bu)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}class $y extends XN{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new EJ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new EJ(t),this._firestoreClient=void 0,await t}}}function NV(n,t){const s=typeof n=="object"?n:Mj(),a=typeof n=="string"?n:Fk,l=DN(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=Zne("firestore");d&&S5e(l,...d)}return l}function g4(n){if(n._terminated)throw new ln(Rt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||b5e(n),n._firestoreClient}function b5e(n){var t,s,a;const l=n._freezeSettings(),d=function(y,v,b,w){return new Kje(y,v,b,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,hse(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new m5e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(y){const v=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new C0(ya.fromBase64String(t))}catch(s){throw new ln(Rt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new C0(ya.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new ln(Rt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ma(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new ln(Rt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new ln(Rt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return mr(this._lat,t._lat)||mr(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T5e=/^__.*__$/;class w5e{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new xg(t,this.data,this.fieldMask,s,this.fieldTransforms):new oR(t,this.data,s,this.fieldTransforms)}}class mse{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new xg(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function gse(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $n()}}class QN{constructor(t,s,a,l,d,f){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new QN(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Uu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return Xk(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(gse(this.Lu)&&T5e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class C5e{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||$N(t)}ju(t,s,a,l=!1){return new QN({Lu:t,methodName:s,zu:a,path:ma.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ZN(n){const t=n._freezeSettings(),s=$N(n._databaseId);return new C5e(n._databaseId,!!t.ignoreUndefinedProperties,s)}function _se(n,t,s,a,l,d={}){const f=n.ju(d.merge||d.mergeFields?2:0,t,s,l);S4("Data must be an object, but it was:",f,a);const y=Ese(a,f);let v,b;if(d.merge)v=new xl(f.fieldMask),b=f.fieldTransforms;else if(d.mergeFields){const w=[];for(const I of d.mergeFields){const k=DV(t,I,s);if(!f.contains(k))throw new ln(Rt.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);Sse(w,k)||w.push(k)}v=new xl(w),b=f.fieldTransforms.filter(I=>v.covers(I.field))}else v=null,b=f.fieldTransforms;return new w5e(new il(y),v,b)}class e1 extends uR{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof e1}}function yse(n,t,s){return new QN({Lu:3,zu:t.settings.zu,methodName:n._methodName,Qu:s},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class E4 extends uR{constructor(t,s){super(t),this.Hu=s}_toFieldTransform(t){const s=yse(this,t,!0),a=this.Hu.map(d=>Ky(d,s)),l=new S0(a);return new Iie(t.path,l)}isEqual(t){return t instanceof E4&&Uf(this.Hu,t.Hu)}}class v4 extends uR{constructor(t,s){super(t),this.Hu=s}_toFieldTransform(t){const s=yse(this,t,!0),a=this.Hu.map(d=>Ky(d,s)),l=new b0(a);return new Iie(t.path,l)}isEqual(t){return t instanceof v4&&Uf(this.Hu,t.Hu)}}function R5e(n,t,s,a){const l=n.ju(1,t,s);S4("Data must be an object, but it was:",l,a);const d=[],f=il.empty();Lg(a,(v,b)=>{const w=b4(t,v,s);b=as(b);const I=l.Uu(w);if(b instanceof e1)d.push(w);else{const k=Ky(b,I);k!=null&&(d.push(w),f.set(w,k))}});const y=new xl(d);return new mse(f,y,l.fieldTransforms)}function I5e(n,t,s,a,l,d){const f=n.ju(1,t,s),y=[DV(t,a,s)],v=[l];if(d.length%2!=0)throw new ln(Rt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let k=0;k<d.length;k+=2)y.push(DV(t,d[k])),v.push(d[k+1]);const b=[],w=il.empty();for(let k=y.length-1;k>=0;--k)if(!Sse(b,y[k])){const x=y[k];let F=v[k];F=as(F);const B=f.Uu(x);if(F instanceof e1)b.push(x);else{const z=Ky(F,B);z!=null&&(b.push(x),w.set(x,z))}}const I=new xl(b);return new mse(w,I,f.fieldTransforms)}function A5e(n,t,s,a=!1){return Ky(s,n.ju(a?4:3,t))}function Ky(n,t){if(vse(n=as(n)))return S4("Unsupported field value:",t,n),Ese(n,t);if(n instanceof uR)return function(a,l){if(!gse(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const y of a){let v=Ky(y,l.Ku(f));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),f++}return{arrayValue:{values:d}}}(n,t)}return function(a,l){if((a=as(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return g4e(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=_o.fromDate(a);return{timestampValue:$k(l.serializer,d)}}if(a instanceof _o){const d=new _o(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:$k(l.serializer,d)}}if(a instanceof _4)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof C0)return{bytesValue:Die(l.serializer,a._byteString)};if(a instanceof vc){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:n4(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof y4)return function(f,y){return{mapValue:{fields:{[aie]:{stringValue:cie},[jk]:{arrayValue:{values:f.toArray().map(b=>{if(typeof b!="number")throw y.Wu("VectorValues must only contain numeric values.");return Qj(y.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${YN(a)}`)}(n,t)}function Ese(n,t){const s={};return tie(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Lg(n,(a,l)=>{const d=Ky(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function vse(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof _o||n instanceof _4||n instanceof C0||n instanceof vc||n instanceof uR||n instanceof y4)}function S4(n,t,s){if(!vse(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=YN(s);throw a==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+a)}}function DV(n,t,s){if((t=as(t))instanceof JN)return t._internalPath;if(typeof t=="string")return b4(n,t);throw Xk("Field path arguments must be of type string or ",n,!1,void 0,s)}const P5e=new RegExp("[~\\*/\\[\\]]");function b4(n,t,s){if(t.search(P5e)>=0)throw Xk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,s);try{return new JN(...t.split("."))._internalPath}catch{throw Xk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,s)}}function Xk(n,t,s,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let y=`Function ${t}() called with invalid data`;s&&(y+=" (via `toFirestore()`)"),y+=". ";let v="";return(d||f)&&(v+=" (found",d&&(v+=` in field ${a}`),f&&(v+=` in document ${l}`),v+=")"),new ln(Rt.INVALID_ARGUMENT,y+n+v)}function Sse(n,t){return n.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bse{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new vc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new O5e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(T4("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class O5e extends bse{data(){return super.data()}}function T4(n,t){return typeof t=="string"?b4(n,t):t instanceof JN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k5e(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ln(Rt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class w4{}class Tse extends w4{}function LV(n,t,...s){let a=[];t instanceof w4&&a.push(t),a=a.concat(s),function(d){const f=d.filter(v=>v instanceof C4).length,y=d.filter(v=>v instanceof t1).length;if(f>1||f>0&&y>0)throw new ln(Rt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class t1 extends Tse{constructor(t,s,a){super(),this._field=t,this._op=s,this._value=a,this.type="where"}static _create(t,s,a){return new t1(t,s,a)}_apply(t){const s=this._parse(t);return wse(t._query,s),new Hy(t.firestore,t.converter,bV(t._query,s))}_parse(t){const s=ZN(t.firestore);return function(d,f,y,v,b,w,I){let k;if(b.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new ln(Rt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){bJ(I,w);const F=[];for(const B of I)F.push(SJ(v,d,B));k={arrayValue:{values:F}}}else k=SJ(v,d,I)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||bJ(I,w),k=A5e(y,f,I,w==="in"||w==="not-in");return no.create(b,w,k)}(t._query,"where",s,t.firestore._databaseId,this._field,this._op,this._value)}}function vJ(n,t,s){const a=t,l=T4("where",n);return t1._create(l,a,s)}class C4 extends w4{constructor(t,s){super(),this.type=t,this._queryConstraints=s}static _create(t,s){return new C4(t,s)}_parse(t){const s=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return s.length===1?s[0]:Ld.create(s,this._getOperator())}_apply(t){const s=this._parse(t);return s.getFilters().length===0?t:(function(l,d){let f=l;const y=d.getFlattenedFilters();for(const v of y)wse(f,v),f=bV(f,v)}(t._query,s),new Hy(t.firestore,t.converter,bV(t._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class R4 extends Tse{constructor(t,s,a){super(),this.type=t,this._limit=s,this._limitType=a}static _create(t,s,a){return new R4(t,s,a)}_apply(t){return new Hy(t.firestore,t.converter,zk(t._query,this._limit,this._limitType))}}function N5e(n){return R4._create("limit",n,"F")}function SJ(n,t,s){if(typeof(s=as(s))=="string"){if(s==="")throw new ln(Rt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gie(t)&&s.indexOf("/")!==-1)throw new ln(Rt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const a=t.path.child(Ji.fromString(s));if(!wn.isDocumentKey(a))throw new ln(Rt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return MX(n,new wn(a))}if(s instanceof vc)return MX(n,s._key);throw new ln(Rt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${YN(s)}.`)}function bJ(n,t){if(!Array.isArray(n)||n.length===0)throw new ln(Rt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function wse(n,t){const s=function(l,d){for(const f of l)for(const y of f.getFlattenedFilters())if(d.indexOf(y.op)>=0)return y.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(s!==null)throw s===t.op?new ln(Rt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ln(Rt.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class D5e{convertValue(t,s="none"){switch(Cg(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Gs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(wg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw $n()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return Lg(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[jk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>Gs(f.doubleValue));return new y4(d)}convertGeoPoint(t){return new _4(Gs(t.latitude),Gs(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=jN(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(DC(t));default:return null}}convertTimestamp(t){const s=Tg(t);return new _o(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=Ji.fromString(t);di(Fie(a));const l=new LC(a.get(1),a.get(3)),d=new wn(a.popFirst(5));return l.isEqual(s)||jf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cse(n,t,s){let a;return a=n?s&&(s.merge||s.mergeFields)?n.toFirestore(t,s):n.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Rse extends bse{constructor(t,s,a,l,d,f){super(t,s,a,l,f),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new lk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(T4("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class lk extends Rse{data(t={}){return super.data(t)}}class L5e{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new jw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new lk(this._firestore,this._userDataWriter,a.key,a,new jw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new ln(Rt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(y=>{const v=new lk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new jw(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(y=>d||y.type!==3).map(y=>{const v=new lk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new jw(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,w=-1;return y.type!==0&&(b=f.indexOf(y.doc.key),f=f.delete(y.doc.key)),y.type!==1&&(f=f.add(y.doc),w=f.indexOf(y.doc.key)),{type:x5e(y.type),doc:v,oldIndex:b,newIndex:w}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function x5e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $n()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ga(n){n=xd(n,vc);const t=xd(n.firestore,$y);return y5e(g4(t),n._key).then(s=>V5e(t,n,s))}class Ise extends D5e{constructor(t){super(),this.firestore=t}convertBytes(t){return new C0(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new vc(this.firestore,null,s)}}function Vy(n){n=xd(n,Hy);const t=xd(n.firestore,$y),s=g4(t),a=new Ise(t);return k5e(n._query),E5e(s,n._query).then(l=>new L5e(t,a,n,l))}function R0(n,t,s){n=xd(n,vc);const a=xd(n.firestore,$y),l=Cse(n.converter,t,s);return n1(a,[_se(ZN(a),"setDoc",n._key,l,n.converter!==null,s).toMutation(n._key,Ou.none())])}function Ea(n,t,s,...a){n=xd(n,vc);const l=xd(n.firestore,$y),d=ZN(l);let f;return f=typeof(t=as(t))=="string"||t instanceof JN?I5e(d,"updateDoc",n._key,t,s,a):R5e(d,"updateDoc",n._key,t),n1(l,[f.toMutation(n._key,Ou.exists(!0))])}function M5e(n){return n1(xd(n.firestore,$y),[new Zj(n._key,Ou.none())])}function U5e(n,t){const s=xd(n.firestore,$y),a=ri(n),l=Cse(n.converter,t);return n1(s,[_se(ZN(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Ou.exists(!1))]).then(()=>a)}function n1(n,t){return function(a,l){const d=new Of;return a.asyncQueue.enqueueAndForget(async()=>o5e(await _5e(a),l,d)),d.promise}(g4(n),t)}function V5e(n,t,s){const a=s.docs.get(t._key),l=new Ise(n);return new Rse(n,l,t._key,a,new jw(s.hasPendingWrites,s.fromCache),t.converter)}function F5e(...n){return new E4("arrayUnion",n)}function j5e(...n){return new v4("arrayRemove",n)}(function(t,s=!0){(function(l){V0=l})(Wy),Dy(new Sg("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),y=new $y(new Oje(a.getProvider("auth-internal")),new Dje(f,a.getProvider("app-check-internal")),function(b,w){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new ln(Rt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new LC(b.options.projectId,w)}(f,l),f);return d=Object.assign({useFetchStreams:s},d),y._setSettings(d),y},"PUBLIC").setMultipleInstances(!0)),Zh(wX,CX,t),Zh(wX,CX,"esm2017")})();var B5e="firebase",W5e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zh(B5e,W5e,"app");const z5e=[{key:"VITE_FIREBASE_API_KEY",value:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU"},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:"disruptive-metaverse.firebaseapp.com"},{key:"VITE_FIREBASE_PROJECT_ID",value:"disruptive-metaverse"},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:"disruptive-metaverse.appspot.com"},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:"294433070603"},{key:"VITE_FIREBASE_APP_ID",value:"1:294433070603:web:136cddd196eea9614fb10e"}],xV=z5e.filter(n=>!n.value);if(xV.length>0){const t=`Missing environment variables: ${xV.map(s=>s.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;ee.warn(t),console.warn(t)}const G5e={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},H5e=xV.length>0;ee.log(`Firebase initializing with ${H5e?"fallback":"environment"} configuration`);let ZM,I4,Ir;try{ZM=sre(G5e),I4=UN(ZM),Ir=NV(ZM),ee.log("Firebase initialized successfully")}catch(n){ee.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const TJ=(n,t)=>{const a=(n+t.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return a+l},Ase=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return ee.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const t=n.toLowerCase().trim();ee.log(`userFirestore: Checking if username "${t}" is taken`);const s=Ag(Ir,"users"),a=LV(s,N5e(100)),l=await Vy(a);let d=!1;return l.forEach(f=>{const y=f.data();y.username&&y.username.toLowerCase()===t&&(d=!0)}),ee.log(`userFirestore: Username "${t}" is ${d?"taken":"available"}`),d}catch(t){return ee.error("userFirestore: Error checking username availability:",t),!0}},$5e=async(n,t)=>{let s=TJ(n,t),a=0;const l=5;for(;a<l;){if(!await Ase(s))return s;s=TJ(n,t),a++}return s+Math.floor(Math.random()*100)},Lu=async n=>{try{ee.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const t=ri(Ir,"users",n),s=await ga(t);if(s.exists()){const a=s.data();return ee.log("userFirestore: Found PUBLIC Profile for : "+a.Nickname),delete a.email,delete a.emailVerified,a}else return ee.error("userFirestore: user profile document not found"),null}catch(t){throw ee.error("userFirestore: Error fetching user public profile data:",t),t}},K5e=async(n,t,s)=>{try{if(ee.log("userFirestore: Starting registerUser process"),ee.log("userFirestore: Fields in additionalData:",Object.keys(s||{}).join(", ")),!s)throw ee.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const a={firstName:s.firstName||"",lastName:s.lastName||"",companyName:s.companyName||"",linkedInProfile:s.linkedInProfile||"",username:s.username||"",Nickname:s.Nickname||"",rpmURL:s.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};ee.log("userFirestore: Critical fields captured for registration"),ee.log("userFirestore: Creating user auth record");const d=(await dFe(I4,n,t)).user;await Lre(d),ee.log("userFirestore: Verification email sent"),ee.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(x=>setTimeout(x,5e3));const f=ri(Ir,"users",d.uid),y=await ga(f);if(y.exists()){ee.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const x=y.data(),F={};x.firstName||(F.firstName=a.firstName),x.lastName||(F.lastName=a.lastName),x.Nickname||(F.Nickname=a.Nickname),x.username||(F.username=a.username),x.companyName||(F.companyName=a.companyName),x.linkedInProfile||(F.linkedInProfile=a.linkedInProfile),x.rpmURL||(F.rpmURL=a.rpmURL),Object.keys(F).length>0&&(ee.log("userFirestore: Updating document with fields:",Object.keys(F).join(", ")),await Ea(f,{...F,lastUpdated:new Date}))}else{ee.error("userFirestore: Cloud Function failed to create user document, creating manually"),await R0(f,{...a,id:d.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const x=ri(Ir,"users",d.uid,"private","data");await R0(x,{email:d.email,emailVerified:!1})}const v=await ga(f);if(!v.exists())throw new Error("User document does not exist even after creation attempts");let b=v.data();b.firstName||(b.firstName=a.firstName),b.lastName||(b.lastName=a.lastName),b.Nickname||(b.Nickname=a.Nickname),b.username||(b.username=a.username),b.companyName||(b.companyName=a.companyName);let w=!1,I={};for(const x in a)(!b[x]||b[x]==="")&&(I[x]=a[x],w=!0);(!b.groups||!b.groups.includes("users"))&&(I.groups=b.groups?[...b.groups,"users"]:["users"],w=!0,ee.log("userFirestore: Adding user to users group")),w&&(ee.log("userFirestore: Updating user document with missing fields"),ee.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await Ea(f,I),b=(await ga(f)).data());const k={...d,...b,firstName:a.firstName,lastName:a.lastName,Nickname:a.Nickname,username:a.username,companyName:a.companyName,linkedInProfile:a.linkedInProfile};return ee.log("userFirestore: Registration complete, returning user data"),ee.log("userFirestore: Fields included in return data:",Object.keys(k).join(", ")),k}catch(a){throw ee.error("userFirestore: Error creating user:",a),a}},Pse=async(n,t)=>{try{ee.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const s=ri(Ir,"users",n);await Ea(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),ee.log("userFirestore: rpmURL updated successfully.")}catch(s){throw ee.error("userFirestore: Error updating rpmURL:",s),s}},q5e=async(n,t)=>{try{const s=await Lu(n);return s&&s.groups?s.groups.includes(t):!1}catch(s){return ee.error("userFirestore: Error checking group membership:",s),!1}};var Y5e={};const Jk=()=>{const n=typeof process<"u"&&Y5e&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},X5e=(n,t)=>{if(!Jk())return ee.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},J5e=(n,t)=>{if(!Jk())return ee.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},A4=typeof Jk=="function"?Jk():!1;A4&&ee.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const Q5e=async(n,t)=>{if(A4)return X5e();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${t}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const a=UN().currentUser;if(a&&a.uid===n.uid)try{const d=(await a.getIdTokenResult(!0)).claims.groups||[],f=`space_${t}_owners`;if(d.includes(f))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(s){return ee.error("Error checking space owner permissions:",s),!1}},Ose=async(n,t)=>{if(A4)return J5e();try{if(ee.log(`userPermissions: Checking if user ${n} belongs to group ${t}`),t==="users")return ee.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const s=await Lu(n);if(ee.log(`userPermissions: User profile for ${n}:`,s),s&&s.groups&&Array.isArray(s.groups)){if(ee.log(`userPermissions: User ${n} has groups:`,s.groups),s.groups.includes(t))return ee.log(`userPermissions: User ${n} belongs to group ${t} (from user document)`),!0}else ee.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(t==="disruptiveAdmin")try{const l=UN().currentUser;if(l&&l.uid===n){const d=await l.getIdTokenResult();if(ee.log(`userPermissions: Token claims for ${n}:`,d.claims),d.claims&&d.claims.groups&&Array.isArray(d.claims.groups)&&d.claims.groups.includes(t))return ee.log(`userPermissions: User ${n} belongs to group ${t} (from token claims)`),!0}}catch(a){ee.error("userPermissions: Error checking token claims:",a)}}return ee.log(`userPermissions: User ${n} does not belong to group ${t}`),!1}catch(s){return ee.error("userPermissions: Error checking if user belongs to group:",s),!1}},Z5e=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],kd={sendUserToUnity:"sendUserToUnity"};class eBe{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),ee.log(`EventBus: Published event '${t}'`)):ee.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const Nd=new eBe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kse="firebasestorage.googleapis.com",Nse="storageBucket",tBe=2*60*1e3,nBe=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs extends lp{constructor(t,s,a=0){super(eU(t),`Firebase Storage: ${s} (${eU(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,xs.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return eU(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ls;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ls||(Ls={}));function eU(n){return"storage/"+n}function P4(){const n="An unknown error occurred, please check the error payload for server response.";return new xs(Ls.UNKNOWN,n)}function rBe(n){return new xs(Ls.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function iBe(n){return new xs(Ls.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function sBe(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new xs(Ls.UNAUTHENTICATED,n)}function oBe(){return new xs(Ls.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function aBe(n){return new xs(Ls.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function cBe(){return new xs(Ls.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function lBe(){return new xs(Ls.CANCELED,"User canceled the upload/download.")}function uBe(n){return new xs(Ls.INVALID_URL,"Invalid URL '"+n+"'.")}function dBe(n){return new xs(Ls.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function hBe(){return new xs(Ls.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Nse+"' property when initializing the app?")}function pBe(){return new xs(Ls.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function fBe(){return new xs(Ls.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function mBe(n){return new xs(Ls.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function MV(n){return new xs(Ls.INVALID_ARGUMENT,n)}function Dse(){return new xs(Ls.APP_DELETED,"The Firebase app was deleted.")}function gBe(n){return new xs(Ls.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function oC(n,t){return new xs(Ls.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function hw(n){throw new xs(Ls.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=Ml.makeFromUrl(t,s)}catch{return new Ml(t,"")}if(a.path==="")return a;throw dBe(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(ue){ue.path.charAt(ue.path.length-1)==="/"&&(ue.path_=ue.path_.slice(0,-1))}const f="(/(.*))?$",y=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function b(ue){ue.path_=decodeURIComponent(ue.path)}const w="v[A-Za-z0-9_]+",I=s.replace(/[.]/g,"\\."),k="(/([^?#]*).*)?$",x=new RegExp(`^https?://${I}/${w}/b/${l}/o${k}`,"i"),F={bucket:1,path:3},B=s===kse?"(?:storage.googleapis.com|storage.cloud.google.com)":s,z="([^?#]*)",J=new RegExp(`^https?://${B}/${l}/${z}`,"i"),ie=[{regex:y,indices:v,postModify:d},{regex:x,indices:F,postModify:b},{regex:J,indices:{bucket:1,path:2},postModify:b}];for(let ue=0;ue<ie.length;ue++){const re=ie[ue],fe=re.regex.exec(t);if(fe){const q=fe[re.indices.bucket];let X=fe[re.indices.path];X||(X=""),a=new Ml(q,X),re.postModify(a);break}}if(a==null)throw uBe(t);return a}}class _Be{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yBe(n,t,s){let a=1,l=null,d=null,f=!1,y=0;function v(){return y===2}let b=!1;function w(...z){b||(b=!0,t.apply(null,z))}function I(z){l=setTimeout(()=>{l=null,n(x,v())},z)}function k(){d&&clearTimeout(d)}function x(z,...J){if(b){k();return}if(z){k(),w.call(null,z,...J);return}if(v()||f){k(),w.call(null,z,...J);return}a<64&&(a*=2);let ie;y===1?(y=2,ie=0):ie=(a+Math.random())*1e3,I(ie)}let F=!1;function B(z){F||(F=!0,k(),!b&&(l!==null?(z||(y=2),clearTimeout(l),I(0)):z||(y=1)))}return I(0),d=setTimeout(()=>{f=!0,B(!0)},s),B}function EBe(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vBe(n){return n!==void 0}function SBe(n){return typeof n=="object"&&!Array.isArray(n)}function O4(n){return typeof n=="string"||n instanceof String}function wJ(n){return k4()&&n instanceof Blob}function k4(){return typeof Blob<"u"}function CJ(n,t,s,a){if(a<t)throw MV(`Invalid value for '${n}'. Expected ${t} or greater.`);if(a>s)throw MV(`Invalid value for '${n}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1(n,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${n}`}function Lse(n){const t=encodeURIComponent;let s="?";for(const a in n)if(n.hasOwnProperty(a)){const l=t(a)+"="+t(n[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var Ry;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Ry||(Ry={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bBe(n,t){const s=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=t.indexOf(n)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TBe{constructor(t,s,a,l,d,f,y,v,b,w,I,k=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=y,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=w,this.connectionFactory_=I,this.retry=k,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((x,F)=>{this.resolve_=x,this.reject_=F,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new wO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=y=>{const v=y.loaded,b=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const y=d.getErrorCode()===Ry.NO_ERROR,v=d.getStatus();if(!y||bBe(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===Ry.ABORT;a(!1,new wO(!1,null,w));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new wO(b,d))})},s=(a,l)=>{const d=this.resolve_,f=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(y,y.getResponse());vBe(v)?d(v):d()}catch(v){f(v)}else if(y!==null){const v=P4();v.serverResponse=y.getErrorText(),this.errorCallback_?f(this.errorCallback_(y,v)):f(v)}else if(l.canceled){const v=this.appDelete_?Dse():lBe();f(v)}else{const v=cBe();f(v)}};this.canceled_?s(!1,new wO(!1,null,!0)):this.backoffId_=yBe(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&EBe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class wO{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function wBe(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function CBe(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function RBe(n,t){t&&(n["X-Firebase-GMPID"]=t)}function IBe(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function ABe(n,t,s,a,l,d,f=!0){const y=Lse(n.urlParams),v=n.url+y,b=Object.assign({},n.headers);return RBe(b,t),wBe(b,s),CBe(b,d),IBe(b,a),new TBe(v,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PBe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function OBe(...n){const t=PBe();if(t!==void 0){const s=new t;for(let a=0;a<n.length;a++)s.append(n[a]);return s.getBlob()}else{if(k4())return new Blob(n);throw new xs(Ls.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function kBe(n,t,s){return n.webkitSlice?n.webkitSlice(t,s):n.mozSlice?n.mozSlice(t,s):n.slice?n.slice(t,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NBe(n){if(typeof atob>"u")throw mBe("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class tU{constructor(t,s){this.data=t,this.contentType=s||null}}function DBe(n,t){switch(n){case Gh.RAW:return new tU(xse(t));case Gh.BASE64:case Gh.BASE64URL:return new tU(Mse(n,t));case Gh.DATA_URL:return new tU(xBe(t),MBe(t))}throw P4()}function xse(n){const t=[];for(let s=0;s<n.length;s++){let a=n.charCodeAt(s);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(s<n.length-1&&(n.charCodeAt(s+1)&64512)===56320))t.push(239,191,189);else{const d=a,f=n.charCodeAt(++s);a=65536|(d&1023)<<10|f&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function LBe(n){let t;try{t=decodeURIComponent(n)}catch{throw oC(Gh.DATA_URL,"Malformed data URL.")}return xse(t)}function Mse(n,t){switch(n){case Gh.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw oC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Gh.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw oC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=NBe(t)}catch(l){throw l.message.includes("polyfill")?l:oC(n,"Invalid character found")}const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}class Use{constructor(t){this.base64=!1,this.contentType=null;const s=t.match(/^data:([^,]+)?,/);if(s===null)throw oC(Gh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=s[1]||null;a!=null&&(this.base64=UBe(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function xBe(n){const t=new Use(n);return t.base64?Mse(Gh.BASE64,t.rest):LBe(t.rest)}function MBe(n){return new Use(n).contentType}function UBe(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(t,s){let a=0,l="";wJ(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(s?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(s?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,s){if(wJ(this.data_)){const a=this.data_,l=kBe(a,t,s);return l===null?null:new lg(l)}else{const a=new Uint8Array(this.data_.buffer,t,s-t);return new lg(a,!0)}}static getBlob(...t){if(k4()){const s=t.map(a=>a instanceof lg?a.data_:a);return new lg(OBe.apply(null,s))}else{const s=t.map(f=>O4(f)?DBe(Gh.RAW,f).data:f.data_);let a=0;s.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return s.forEach(f=>{for(let y=0;y<f.length;y++)l[d++]=f[y]}),new lg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vse(n){let t;try{t=JSON.parse(n)}catch{return null}return SBe(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VBe(n){if(n.length===0)return null;const t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function FBe(n,t){const s=t.split("/").filter(a=>a.length>0).join("/");return n.length===0?s:n+"/"+s}function Fse(n){const t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jBe(n,t){return t}class mc{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||jBe}}let CO=null;function BBe(n){return!O4(n)||n.length<2?n:Fse(n)}function jse(){if(CO)return CO;const n=[];n.push(new mc("bucket")),n.push(new mc("generation")),n.push(new mc("metageneration")),n.push(new mc("name","fullPath",!0));function t(d,f){return BBe(f)}const s=new mc("name");s.xform=t,n.push(s);function a(d,f){return f!==void 0?Number(f):f}const l=new mc("size");return l.xform=a,n.push(l),n.push(new mc("timeCreated")),n.push(new mc("updated")),n.push(new mc("md5Hash",null,!0)),n.push(new mc("cacheControl",null,!0)),n.push(new mc("contentDisposition",null,!0)),n.push(new mc("contentEncoding",null,!0)),n.push(new mc("contentLanguage",null,!0)),n.push(new mc("contentType",null,!0)),n.push(new mc("metadata","customMetadata",!0)),CO=n,CO}function WBe(n,t){function s(){const a=n.bucket,l=n.fullPath,d=new Ml(a,l);return t._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:s})}function zBe(n,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const f=s[d];a[f.local]=f.xform(a,t[f.server])}return WBe(a,n),a}function Bse(n,t,s){const a=Vse(t);return a===null?null:zBe(n,a,s)}function GBe(n,t,s,a){const l=Vse(t);if(l===null||!O4(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(b=>{const w=n.bucket,I=n.fullPath,k="/b/"+f(w)+"/o/"+f(I),x=r1(k,s,a),F=Lse({alt:"media",token:b});return x+F})[0]}function HBe(n,t){const s={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(s[d.server]=n[d.local])}return JSON.stringify(s)}class N4{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wse(n){if(!n)throw P4()}function $Be(n,t){function s(a,l){const d=Bse(n,l,t);return Wse(d!==null),d}return s}function KBe(n,t){function s(a,l){const d=Bse(n,l,t);return Wse(d!==null),GBe(d,l,n.host,n._protocol)}return s}function zse(n){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=oBe():l=sBe():s.getStatus()===402?l=iBe(n.bucket):s.getStatus()===403?l=aBe(n.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function Gse(n){const t=zse(n);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=rBe(n.path)),d.serverResponse=l.serverResponse,d}return s}function qBe(n,t,s){const a=t.fullServerUrl(),l=r1(a,n.host,n._protocol),d="GET",f=n.maxOperationRetryTime,y=new N4(l,d,KBe(n,s),f);return y.errorHandler=Gse(t),y}function YBe(n,t){const s=t.fullServerUrl(),a=r1(s,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function f(v,b){}const y=new N4(a,l,f,d);return y.successCodes=[200,204],y.errorHandler=Gse(t),y}function XBe(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function JBe(n,t,s){const a=Object.assign({},s);return a.fullPath=n.path,a.size=t.size(),a.contentType||(a.contentType=XBe(null,t)),a}function QBe(n,t,s,a,l){const d=t.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function y(){let ie="";for(let ue=0;ue<2;ue++)ie=ie+Math.random().toString().slice(2);return ie}const v=y();f["Content-Type"]="multipart/related; boundary="+v;const b=JBe(t,a,l),w=HBe(b,s),I="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,k=`\r
--`+v+"--",x=lg.getBlob(I,a,k);if(x===null)throw pBe();const F={name:b.fullPath},B=r1(d,n.host,n._protocol),z="POST",J=n.maxUploadRetryTime,$=new N4(B,z,$Be(n,s),J);return $.urlParams=F,$.headers=f,$.body=x.uploadData(),$.errorHandler=zse(t),$}class ZBe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ry.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ry.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ry.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw hw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw hw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw hw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw hw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw hw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class e6e extends ZBe{initXhr(){this.xhr_.responseType="text"}}function D4(){return new e6e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fy{constructor(t,s){this._service=t,s instanceof Ml?this._location=s:this._location=Ml.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new Fy(t,s)}get root(){const t=new Ml(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Fse(this._location.path)}get storage(){return this._service}get parent(){const t=VBe(this._location.path);if(t===null)return null;const s=new Ml(this._location.bucket,t);return new Fy(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw gBe(t)}}function t6e(n,t,s){n._throwIfRoot("uploadBytes");const a=QBe(n.storage,n._location,jse(),new lg(t,!0),s);return n.storage.makeRequestWithTokens(a,D4).then(l=>({metadata:l,ref:n}))}function n6e(n){n._throwIfRoot("getDownloadURL");const t=qBe(n.storage,n._location,jse());return n.storage.makeRequestWithTokens(t,D4).then(s=>{if(s===null)throw fBe();return s})}function r6e(n){n._throwIfRoot("deleteObject");const t=YBe(n.storage,n._location);return n.storage.makeRequestWithTokens(t,D4)}function i6e(n,t){const s=FBe(n._location.path,t),a=new Ml(n._location.bucket,s);return new Fy(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s6e(n){return/^[A-Za-z]+:\/\//.test(n)}function o6e(n,t){return new Fy(n,t)}function Hse(n,t){if(n instanceof L4){const s=n;if(s._bucket==null)throw hBe();const a=new Fy(s,s._bucket);return t!=null?Hse(a,t):a}else return t!==void 0?i6e(n,t):n}function a6e(n,t){if(t&&s6e(t)){if(n instanceof L4)return o6e(n,t);throw MV("To use ref(service, url), the first argument must be a Storage instance.")}else return Hse(n,t)}function RJ(n,t){const s=t==null?void 0:t[Nse];return s==null?null:Ml.makeFromBucketSpec(s,n)}function c6e(n,t,s,a={}){n.host=`${t}:${s}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:nre(l,n.app.options.projectId))}class L4{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=kse,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=tBe,this._maxUploadRetryTime=nBe,this._requests=new Set,l!=null?this._bucket=Ml.makeFromBucketSpec(l,this._host):this._bucket=RJ(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Ml.makeFromBucketSpec(this._url,t):this._bucket=RJ(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){CJ("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){CJ("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(Dl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Fy(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new _Be(Dse());{const f=ABe(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const IJ="@firebase/storage",AJ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $se="storage";function x4(n,t,s){return n=as(n),t6e(n,t,s)}function i1(n){return n=as(n),n6e(n)}function M4(n){return n=as(n),r6e(n)}function qy(n,t){return n=as(n),a6e(n,t)}function Yy(n=Mj(),t){n=as(n);const a=DN(n,$se).getImmediate({identifier:t}),l=Zne("storage");return l&&l6e(a,...l),a}function l6e(n,t,s,a={}){c6e(n,t,s,a)}function u6e(n,{instanceIdentifier:t}){const s=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new L4(s,a,l,t,Wy)}function d6e(){Dy(new Sg($se,u6e,"PUBLIC").setMultipleInstances(!0)),Zh(IJ,AJ,""),Zh(IJ,AJ,"esm2017")}d6e();const uk=async n=>{const t=Yy(),s=qy(t,n);try{return await i1(s)}catch(a){throw ee.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let jy={};const _g=async n=>{try{const t=ri(Ir,"spaces",n),s=await ga(t);if(s.exists()){let a=s.data();const l=a.name,d=a.description;if(a.webglBuildId){const f=ri(Ir,"webglBuilds",a.webglBuildId),y=await ga(f);if(y.exists()){const v=y.data();a={...a,...v,name:l||v.name,description:d||v.description}}else ee.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await h6e(a),a=p6e(a),console.log("Space data:",a),ee.log(`spacesFirestore: Caching space data for: ${n}`),jy[n]=a,a}else return ee.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(t){throw ee.error("spacesFirestore: Error fetching item data:",t),t}},h6e=async n=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await uk(l))});return await Promise.all(s),n},p6e=n=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let nU={};const Kse=async n=>{ee.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(nU[n])return ee.log("spacesFirestore: Returning cached videos for space:",n),nU[n];const t=Ag(Ir,`spaces/${n}/videos`),s=await Vy(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),nU[n]=a,a}catch(t){throw ee.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},f6e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=Yy(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,f=qy(s,`spaces/${n}/logo/${d}`);ee.log(`Uploading logo for space ${n}`);const y=await x4(f,t),v=await i1(y.ref),b=ri(Ir,"spaces",n);return await Ea(b,{logoUrl:v,logoGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),ee.log(`Successfully uploaded logo for space ${n}`),v}catch(s){throw ee.error("Error uploading space logo:",s),s}},m6e=async n=>{try{const t=ri(Ir,"spaces",n),s=await ga(t);if(!s.exists())return ee.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.logoGsUrl){const l=Yy(),d=qy(l,a.logoGsUrl);try{await M4(d),ee.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){ee.warn(`Could not delete logo file from storage: ${f.message}`)}}return await Ea(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),ee.log(`Successfully removed logo for space ${n}`),!0}catch(t){throw ee.error("Error deleting space logo:",t),t}},g6e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=Yy(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,f=qy(s,`spaces/${n}/background/${d}`);ee.log(`Uploading background for space ${n}`);const y=await x4(f,t),v=await i1(y.ref),b=ri(Ir,"spaces",n);return await Ea(b,{backgroundUrl:v,backgroundGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${y.ref.bucket}/${y.ref.fullPath}`,updatedAt:new Date().toISOString()}),ee.log(`Successfully uploaded background for space ${n}`),v}catch(s){throw ee.error("Error uploading space background:",s),s}},_6e=async n=>{try{const t=ri(Ir,"spaces",n),s=await ga(t);if(!s.exists())return ee.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.backgroundGsUrl){const l=Yy(),d=qy(l,a.backgroundGsUrl);try{await M4(d),ee.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){ee.warn(`Could not delete background file from storage: ${f.message}`)}}return await Ea(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),ee.log(`Successfully removed background references for space ${n}`),!0}catch(t){throw ee.error("Error deleting space background:",t),t}},y6e=async(n,t)=>{try{ee.log(`spacesFirestore: Updating settings for space: ${n}`,t);const s=ri(Ir,"spaces",n),a=await ga(s);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Ea(s,d),jy[n]&&delete jy[n],ee.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(s){throw ee.error(`spacesFirestore: Error updating settings for space: ${n}`,s),s}},E6e=async(n,t)=>{try{ee.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${n}`);const s=ri(Ir,"spaces",n);if(!(await ga(s)).exists())throw new Error(`Space with ID ${n} not found`);await Ea(s,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),jy[n]&&delete jy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:t}})),ee.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(s){throw ee.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,s),s}},UV=async(n,t)=>{try{ee.log(`spacesFirestore: Updating HLS stream for space: ${n}`,t);const s=ri(Ir,"spaces",n);if(!(await ga(s)).exists())throw new Error(`Space with ID ${n} not found`);const{streamUrl:l,playerIndex:d="0",enabled:f=!0,rtmpUrl:y="",streamKey:v=""}=t,b={HLSStreamURL:{streamUrl:l,playerIndex:d,enabled:f,rtmpUrl:y,streamKey:v,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()};return await Ea(s,b),jy[n]&&delete jy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceHLSStreamUpdated",{detail:{spaceId:n,streamUrl:l,playerIndex:d,enabled:f,rtmpUrl:y,streamKey:v}})),ee.log(`spacesFirestore: Successfully updated HLS stream for space: ${n}`),!0}catch(s){throw ee.error(`spacesFirestore: Error updating HLS stream for space: ${n}`,s),s}},qse=async n=>{try{ee.log(`spacesFirestore: Getting HLS stream for space: ${n}`);const t=ri(Ir,"spaces",n),s=await ga(t);if(!s.exists())return ee.warn(`spacesFirestore: Space with ID ${n} not found`),null;const a=s.data();return a.HLSStreamURL?(ee.log(`spacesFirestore: Found HLS stream for space: ${n}`,a.HLSStreamURL),a.HLSStreamURL):(ee.log(`spacesFirestore: No HLS stream found for space: ${n}`),null)}catch(t){throw ee.error(`spacesFirestore: Error getting HLS stream for space: ${n}`,t),t}},ul=D.createContext(null),v6e=D.createContext(null),S6e=({children:n})=>{const[t,s]=D.useState(null),a=D.useRef(null),[l,d]=D.useState(!0),[f,y]=D.useState(!1),v=UN(),b=re=>re?re.Nickname?re.Nickname:`${re.firstName} ${re.lastName}`:"Anon";D.useEffect(()=>{const re=mFe(v,async fe=>{if(ee.log("UserProvider: Firebase onAuthStateChanged() fired"),fe)try{const q=await Lu(fe.uid),X=b(q),Q={uid:fe.uid,email:fe.email,emailVerified:fe.emailVerified,...q,displayName:X};ee.log(`UserProvider: User authenticated: ${fe.uid}`),s(Q),a.current=Q,x(Q)}catch(q){ee.error("UserProvider: Error fetching user profile data:",q)}else s(null),a.current=null;d(!1)});return()=>{re&&re()}},[]);const w=async(re,fe,q)=>{try{y(!0),ee.log("UserProvider: Starting registration process"),ee.log("UserProvider: Registration includes fields:",Object.keys(q||{}).join(", "));const X={...q},Q=["firstName","lastName","username","companyName","linkedInProfile"],se=Q.filter(ve=>!X[ve]);se.length>0&&ee.warn(`UserProvider: Registration missing fields: ${se.join(", ")}`);const me=X.firstName&&X.lastName?`${X.firstName}${X.lastName.charAt(0).toUpperCase()}`:"";ee.log("UserProvider: Generated default nickname for registration");const pe={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:X.Nickname||me,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...X};ee.log("UserProvider: Prepared registration data with fields:",Object.keys(pe).join(", "));const le=await K5e(re,fe,pe);ee.log("UserProvider: Registration successful, received user data");const Le=Q.filter(ve=>!le[ve]);Le.length>0&&ee.warn(`UserProvider: Returned user data missing fields: ${Le.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(ve=>{le[ve]||(ee.warn(`UserProvider: ${ve} is missing in returned data, using original value`),le[ve]=pe[ve])});const $e={uid:le.uid,email:le.email,...le,displayName:b(le)};return ee.log("UserProvider: Created user object with fields:",Object.keys($e).join(", ")),s($e),a.current=$e,ee.log("UserProvider: User registered successfully with groups:",pe.groups),await new Promise(ve=>setTimeout(ve,2e3)),y(!1),$e}catch(X){throw y(!1),ee.error("UserProvider: Error during registration:",X),X}},I=async(re,fe,q)=>{try{if(ee.log("UserProvider: Signing in user"),!q)throw new Error("CAPTCHA verification is required");const Q=(await hFe(v,re,fe)).user;return ee.log("UserProvider: User signed in successfully:",Q.email),Q}catch(X){throw ee.error("UserProvider: Error signing in:",X),X}},k=async()=>{try{await gFe(v),s(null),ee.log("UserProvider: User signed out.")}catch(re){throw ee.error("UserProvider: Error signing out:",re),re}},x=()=>{const re=a.current;if(re){const fe=F(re);ee.log("UserProvider: sendUserToUnity() using the eventBus",fe),Nd.publish(kd.sendUserToUnity,fe)}else ee.log("UserProvider: No current user to send to Unity.")},F=re=>{const fe={};return[...Z5e,"uid"].forEach(X=>{re.hasOwnProperty(X)&&(fe[X]=re[X])}),fe},B=async re=>!t||!t.uid?!1:await Ose(t.uid,re),z=async re=>{if(!t||!t.uid)return!1;try{const fe=await _g(re);if(fe.usersAllowed.includes(t.uid)||fe.userAdmin.includes(t.uid)||fe.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const X=`space_${re}_owners`,Q=`space_${re}_hosts`;if(t.groups.includes(X)||t.groups.includes(Q))return ee.log(`UserProvider: User ${t.uid} has access to space ${re} as owner/host`),!0}return fe.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(fe){return ee.error("UserProvider: Error verifying user access to space:",fe),!1}},J=async re=>{if(!t||!t.uid)return!1;try{return(await _g(re)).userAdmin.includes(t.uid)}catch(fe){return ee.error("UserProvider: Error verifying user admin status for space:",fe),!1}},$=async re=>{if(!t||!t.uid)return!1;try{return(await _g(re)).usersModerators.includes(t.uid)}catch(fe){return ee.error("UserProvider: Error verifying user moderator status for space:",fe),!1}},ie=async()=>{try{const re=v.currentUser;return re&&!re.emailVerified?(await Lre(re),ee.log("UserProvider: Verification email resent to:",re.email),!0):!1}catch(re){throw ee.error("UserProvider: Error resending verification email:",re),re}},ue=async()=>{try{const re=v.currentUser;if(!re)return ee.warn("UserProvider: updateUser called but no current user exists"),null;ee.log("UserProvider: Updating user data from Firestore");const fe=await Lu(re.uid);if(!fe)return ee.error("UserProvider: Failed to fetch updated user profile"),null;const q=b(fe),X={uid:re.uid,email:re.email,emailVerified:re.emailVerified,...fe,displayName:q};return ee.log("UserProvider: User data updated with fields:",Object.keys(X).join(", ")),s(X),a.current=X,x(X),X}catch(re){throw ee.error("UserProvider: Error updating user data:",re),re}};return R.jsx(v6e.Provider,{value:{registrationInProgress:f},children:R.jsx(ul.Provider,{value:{user:t,loading:l,register:w,signIn:I,signOut:k,sendUserToUnity:x,isUserInGroup:B,userHasAccessToSpace:z,userIsAdminOfSpace:J,userIsModeratorOfSpace:$,resendVerificationEmail:ie,updateUser:ue},children:n})})},Yse=D.createContext(),Md=()=>D.useContext(Yse),b6e=({children:n})=>{const[t,s]=D.useState(!1),a=D.useRef(null),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=D.useCallback(v=>{a.current=v},[]),y=D.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),s(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),s(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),s(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{s(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),s(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),s(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),s(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return D.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),R.jsx(Yse.Provider,{value:{isFullscreen:t,toggleFullscreen:y,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:R.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})};var rU={},pw={},fw={},PJ;function T6e(){if(PJ)return fw;PJ=1,Object.defineProperty(fw,"__esModule",{value:!0}),fw.useUnityCanvasId=void 0;var n=ku(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[s,++t].join("-")},[]);return d};return fw.useUnityCanvasId=a,fw}var uf={},mw={},OJ;function Xse(){if(OJ)return mw;OJ=1,Object.defineProperty(mw,"__esModule",{value:!0}),mw.UnityLoaderStatus=void 0;var n;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(n||(mw.UnityLoaderStatus=n={})),mw}var gw={},kJ;function U4(){return kJ||(kJ=1,Object.defineProperty(gw,"__esModule",{value:!0}),gw.isBrowserEnvironment=void 0,gw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),gw}var NJ;function w6e(){if(NJ)return uf;NJ=1;var n=uf&&uf.__awaiter||function(f,y,v,b){function w(I){return I instanceof v?I:new v(function(k){k(I)})}return new(v||(v=Promise))(function(I,k){function x(z){try{B(b.next(z))}catch(J){k(J)}}function F(z){try{B(b.throw(z))}catch(J){k(J)}}function B(z){z.done?I(z.value):w(z.value).then(x,F)}B((b=b.apply(f,y||[])).next())})},t=uf&&uf.__generator||function(f,y){var v={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,w,I,k=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return k.next=x(0),k.throw=x(1),k.return=x(2),typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function x(B){return function(z){return F([B,z])}}function F(B){if(b)throw new TypeError("Generator is already executing.");for(;k&&(k=0,B[0]&&(v=0)),v;)try{if(b=1,w&&(I=B[0]&2?w.return:B[0]?w.throw||((I=w.return)&&I.call(w),0):w.next)&&!(I=I.call(w,B[1])).done)return I;switch(w=0,I&&(B=[B[0]&2,I.value]),B[0]){case 0:case 1:I=B;break;case 4:return v.label++,{value:B[1],done:!1};case 5:v.label++,w=B[1],B=[0];continue;case 7:B=v.ops.pop(),v.trys.pop();continue;default:if(I=v.trys,!(I=I.length>0&&I[I.length-1])&&(B[0]===6||B[0]===2)){v=0;continue}if(B[0]===3&&(!I||B[1]>I[0]&&B[1]<I[3])){v.label=B[1];break}if(B[0]===6&&v.label<I[1]){v.label=I[1],I=B;break}if(I&&v.label<I[2]){v.label=I[2],v.ops.push(B);break}I[2]&&v.ops.pop(),v.trys.pop();continue}B=y.call(f,v)}catch(z){B=[6,z],w=0}finally{b=I=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(uf,"__esModule",{value:!0}),uf.useUnityInstance=void 0;var s=ku(),a=Xse(),l=U4(),d=function(f,y,v,b){(0,s.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,I;return t(this,function(k){switch(k.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||y===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];k.label=1;case 1:return k.trys.push([1,3,,4]),[4,window.createUnityInstance(y,v,b.setLoadingProgression)];case 2:return w=k.sent(),b.setUnityInstance(w),b.setInitialisationError(null),[3,4];case 3:return I=k.sent(),b.setUnityInstance(null),b.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,y,v,b])};return uf.useUnityInstance=d,uf}var _w={},DJ;function C6e(){if(DJ)return _w;DJ=1,Object.defineProperty(_w,"__esModule",{value:!0}),_w.useUnityArguments=void 0;var n=ku(),t=function(s){return(0,n.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return _w.useUnityArguments=t,_w}var yw={},LJ;function R6e(){if(LJ)return yw;LJ=1,Object.defineProperty(yw,"__esModule",{value:!0}),yw.useUnityLoader=void 0;var n=ku(),t=U4(),s=Xse(),a=function(l){var d=(0,n.useState)(s.UnityLoaderStatus.Loading),f=d[0],y=d[1];return(0,n.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){y(s.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):y(v.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var b=function(w){return y(w.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return v.addEventListener("load",b),v.addEventListener("error",b),function(){v!==null&&(v.removeEventListener("load",b),v.removeEventListener("error",b),window.document.body.removeChild(v))}}},[l.loaderUrl]),f};return yw.useUnityLoader=a,yw}var xJ;function I6e(){if(xJ)return pw;xJ=1,Object.defineProperty(pw,"__esModule",{value:!0}),pw.Unity=void 0;var n=ku(),t=ku(),s=T6e(),a=w6e(),l=C6e(),d=R6e(),f=(0,t.forwardRef)(function(y,v){var b=(0,t.useRef)(null),w=(0,s.useUnityCanvasId)(y),I=(0,l.useUnityArguments)(y),k=(0,d.useUnityLoader)(y.unityProvider.unityConfig);return(0,a.useUnityInstance)(k,b.current,I,y.unityProvider),(0,n.useImperativeHandle)(v,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:w,style:y.style,className:y.className,tabIndex:y.tabIndex})});return pw.Unity=f,pw}var df={},Ew={},MJ;function Jse(){if(MJ)return Ew;MJ=1,Object.defineProperty(Ew,"__esModule",{value:!0}),Ew.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Ew.errorMessages=n,Ew}var sy={},UJ;function A6e(){if(UJ)return sy;UJ=1;var n=sy&&sy.__spreadArray||function(y,v,b){if(b||arguments.length===2)for(var w=0,I=v.length,k;w<I;w++)(k||!(w in v))&&(k||(k=Array.prototype.slice.call(v,0,w)),k[w]=v[w]);return y.concat(k||Array.prototype.slice.call(v))};Object.defineProperty(sy,"__esModule",{value:!0}),sy.useEventSystem=void 0;var t=ku(),s=Jse(),a=U4(),l=[],d=function(y){for(var v=[],b=1;b<arguments.length;b++)v[b-1]=arguments[b];var w=void 0;return l.forEach(function(I){w=I.apply(void 0,n([y],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var f=function(){var y=(0,t.useRef)([]),v=(0,t.useCallback)(function(I,k){y.current=n(n([],y.current,!0),[{eventName:I,callback:k}],!1)},[y]),b=(0,t.useCallback)(function(I,k){y.current=y.current.filter(function(x){return x.eventName!==I&&x.callback!==k})},[y]),w=(0,t.useCallback)(function(I){for(var k=[],x=1;x<arguments.length;x++)k[x-1]=arguments[x];var F=y.current.find(function(B){return B.eventName===I});if(typeof F>"u"){console.warn(s.errorMessages.noEventListener,{eventName:I});return}return F.callback.apply(F,k)},[y]);return(0,t.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:b}};return sy.useEventSystem=f,sy}var vw={},VJ;function P6e(){if(VJ)return vw;VJ=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.useNullableState=void 0;var n=ku(),t=function(s){return(0,n.useState)(s||null)};return vw.useNullableState=t,vw}var FJ;function O6e(){if(FJ)return df;FJ=1;var n=df&&df.__awaiter||function(y,v,b,w){function I(k){return k instanceof b?k:new b(function(x){x(k)})}return new(b||(b=Promise))(function(k,x){function F(J){try{z(w.next(J))}catch($){x($)}}function B(J){try{z(w.throw(J))}catch($){x($)}}function z(J){J.done?k(J.value):I(J.value).then(F,B)}z((w=w.apply(y,v||[])).next())})},t=df&&df.__generator||function(y,v){var b={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},w,I,k,x=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return x.next=F(0),x.throw=F(1),x.return=F(2),typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function F(z){return function(J){return B([z,J])}}function B(z){if(w)throw new TypeError("Generator is already executing.");for(;x&&(x=0,z[0]&&(b=0)),b;)try{if(w=1,I&&(k=z[0]&2?I.return:z[0]?I.throw||((k=I.return)&&k.call(I),0):I.next)&&!(k=k.call(I,z[1])).done)return k;switch(I=0,k&&(z=[z[0]&2,k.value]),z[0]){case 0:case 1:k=z;break;case 4:return b.label++,{value:z[1],done:!1};case 5:b.label++,I=z[1],z=[0];continue;case 7:z=b.ops.pop(),b.trys.pop();continue;default:if(k=b.trys,!(k=k.length>0&&k[k.length-1])&&(z[0]===6||z[0]===2)){b=0;continue}if(z[0]===3&&(!k||z[1]>k[0]&&z[1]<k[3])){b.label=z[1];break}if(z[0]===6&&b.label<k[1]){b.label=k[1],k=z;break}if(k&&b.label<k[2]){b.label=k[2],b.ops.push(z);break}k[2]&&b.ops.pop(),b.trys.pop();continue}z=v.call(y,b)}catch(J){z=[6,J],I=0}finally{w=k=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}};Object.defineProperty(df,"__esModule",{value:!0}),df.useUnityContext=void 0;var s=ku(),a=Jse(),l=A6e(),d=P6e(),f=function(y){var v=(0,d.useNullableState)(),b=v[0],w=v[1],I=(0,s.useState)(0),k=I[0],x=I[1],F=(0,s.useState)(!1),B=F[0],z=F[1],J=(0,d.useNullableState)(),$=J[0],ie=J[1],ue=(0,l.useEventSystem)(),re=(0,s.useRef)({setLoadingProgression:x,setInitialisationError:ie,setUnityInstance:w,setIsLoaded:z,unityConfig:y}),fe=(0,s.useCallback)(function(pe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(pe===!0?1:0)},[b]),q=(0,s.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),X=(0,s.useCallback)(function(pe,le,Le){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(pe,le,Le)},[b]),Q=(0,s.useCallback)(function(pe,le){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(pe,le)},[b]),se=(0,s.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),me=(0,s.useCallback)(function(){return n(void 0,void 0,void 0,function(){var pe;return t(this,function(le){switch(le.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(pe=b.Module.canvas,document.body.appendChild(pe),pe.style.display="none",[4,se()]);case 1:return le.sent(),pe.remove(),[2]}})})},[b]);return(0,s.useEffect)(function(){z(k===1)},[k]),{unityProvider:re.current,loadingProgression:k,initialisationError:$,isLoaded:B,UNSAFE__unityInstance:b,requestFullscreen:fe,requestPointerLock:q,sendMessage:X,takeScreenshot:Q,unload:se,UNSAFE__detachAndUnloadImmediate:me,addEventListener:ue.addEventListener,removeEventListener:ue.removeEventListener}};return df.useUnityContext=f,df}var jJ;function k6e(){return jJ||(jJ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var t=I6e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=O6e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(rU)),rU}var Qse=k6e();const Rd="[UnityProvider]",VV=D.createContext(),N6e=({spaceID:n,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:y,showDisruptiveLogo:v})=>{ee.log(`${Rd} Initializing with spaceID:`,n),ee.log(`${Rd} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:w,isLoaded:I,sendMessage:k,addEventListener:x,removeEventListener:F,error:B}=Qse.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),z={unityProvider:b,loadingProgression:w,isLoaded:I,sendMessage:k,addEventListener:x,removeEventListener:F,error:B,spaceID:n},J=D.useRef(null),$=D.useRef(Date.now());D.useEffect(()=>{const fe=()=>{document.hidden?(ee.log(`${Rd} Page hidden, starting keep-alive`),ie()):(ee.log(`${Rd} Page visible, stopping keep-alive`),ue())};return document.addEventListener("visibilitychange",fe),()=>{document.removeEventListener("visibilitychange",fe),ue()}},[]),D.useEffect(()=>{const fe=()=>{$.current=Date.now(),document.hidden&&k("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",fe),window.addEventListener("keydown",fe),window.addEventListener("touchstart",fe),()=>{window.removeEventListener("mousemove",fe),window.removeEventListener("keydown",fe),window.removeEventListener("touchstart",fe)}},[k]);const ie=()=>{J.current||(J.current=setInterval(()=>{I&&document.hidden&&(k("WebGLInputManager","KeepAlive"),ee.debug(`${Rd} Sent keep-alive message`))},1e4))},ue=()=>{J.current&&(clearInterval(J.current),J.current=null)};D.useEffect(()=>(ee.log(`${Rd} Component mounted`),()=>{ee.log(`${Rd} Component unmounting`),ue()}),[]),D.useEffect(()=>{ee.log(`${Rd} Loading progress:`,w)},[w]),D.useEffect(()=>{I&&(ee.log(`${Rd} Unity instance loaded for:`,n),document.hidden&&ie())},[I,n]),D.useEffect(()=>{B&&ee.error(`${Rd} Unity error:`,B)},[B]),ee.log(`${Rd} Rendering provider with instance:`,z),D.useEffect(()=>{ee.log("UnityProvider: Unity build URLs:",{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d})},[s,a,l,d]);const re=[];if(s||re.push("loaderUrl"),a||re.push("dataUrl"),l||re.push("frameworkUrl"),d||re.push("codeUrl"),re.length>0)return ee.error(`UnityProvider: Missing required Unity build URLs: ${re.join(", ")}`),R.jsx(VV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${re.join(", ")}`),spaceID:n},children:t});try{return D.useEffect(()=>{ee.log("UnityProvider: Unity context created:",b),b?ee.log("UnityProvider: Unity provider is available"):ee.error("UnityProvider: Unity provider is not available"),I?ee.log("UnityProvider: Unity is loaded"):ee.log("UnityProvider: Unity is not loaded yet")},[b,I]),R.jsx(VV.Provider,{value:z,children:t})}catch(fe){return ee.error("UnityProvider: Error creating Unity context:",fe),R.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[R.jsx("h3",{children:"Unity Error"}),R.jsxs("p",{children:["Error creating Unity context: ",fe.message]}),R.jsx("p",{children:"Please check the console for more details."})]})}},va=()=>D.useContext(VV),up=()=>{const{sendMessage:n,isLoaded:t}=va(),s=D.useRef([]),a=D.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:f}=s.current.shift();ee.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(y){ee.error("useSendUnityEvent: Error sending event to Unity:",y),s.current.unshift({eventName:d,data:f});break}}},[n,t]);return D.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),D.useCallback((d,f)=>{ee.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:f}),a()},[a])},dp=()=>{const{addEventListener:n,removeEventListener:t}=va();return D.useCallback((s,a)=>{const l=d=>{ee.log(s+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(y){ee.warn("Failed to parse JSON data from Unity message:",y)}a(f)};return n(s,l),()=>{t(s,l)}},[n,t])},Zse=()=>{const[n,t]=D.useState({}),[s,a]=D.useState(!1),[l,d]=D.useState(null),[f,y]=D.useState(0),v=up(),b=dp(),{spaceID:w,sendMessage:I,isLoaded:k}=va(),x=D.useCallback((J,$)=>{if(!J)return;ee.log(`useHLSStream: Sending stream URL to Unity: ${J} for player ${$}`);const ie={identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:J};if(v("SetHLSStream",ie),k&&I)try{ee.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(ie)})),ee.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:J})),ee.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",J),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:$.toString(),Url:J}))}catch(ue){ee.error("useHLSStream: Error with direct message:",ue)}else ee.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,I,k]);D.useEffect(()=>{w&&F(w)},[w]);const F=async J=>{try{if(!J){ee.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}a(!0),ee.log(`useHLSStream: Loading stream from Firebase for space ${J}`);const $=await qse(J);if($&&$.streamUrl)if(ee.log(`useHLSStream: Loaded stream data from Firebase for space ${J}`,$),d($),k)ee.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{x($.streamUrl,$.playerIndex||"0")},500),setTimeout(()=>{ee.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),x($.streamUrl,$.playerIndex||"0")},2e3);else{ee.warn("useHLSStream: Unity is not loaded yet, will try again later");const ie=setInterval(()=>{k&&(ee.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),x($.streamUrl,$.playerIndex||"0"),clearInterval(ie))},1e3);setTimeout(()=>{clearInterval(ie)},3e4)}else ee.log(`useHLSStream: No saved stream found for space ${J}`),d(null)}catch($){ee.error(`useHLSStream: Error loading stream from Firebase for space ${J}`,$)}finally{a(!1)}},B=D.useCallback(async()=>{w&&(ee.log(`useHLSStream: Forcing reload of stream data for space ${w}`),y(J=>J+1),await F(w))},[w]),z=D.useCallback(async(J,$=0,ie={})=>{try{if(!J||!J.trim()){ee.error("useHLSStream: Invalid stream URL");return}a(!0),ee.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${$}]`,J);const{enabled:ue=!0,rtmpUrl:re="",streamKey:fe="",skipSendToUnity:q=!1}=ie;if(q||x(J,$),w)try{const X={streamUrl:J,playerIndex:$.toString(),enabled:ue,rtmpUrl:re,streamKey:fe,updatedAt:new Date().toISOString()};ee.log(`useHLSStream: Saving stream URL to Firebase for space ${w}`,X),await UV(w,X),d(X)}catch(X){throw ee.error(`useHLSStream: Error saving stream URL to Firebase for space ${w}`,X),X}else ee.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{a(!1)}},[x,w]);return D.useEffect(()=>{const $=b("SetHLSStream",ie=>{if(ie)try{ee.log("useHLSStream: Received player status update",ie);const{identifier:ue,playerIndex:re,isReady:fe,isPlaying:q}=ie,X=`${ue}_${re}`;t(Q=>({...Q,[X]:{identifier:ue,playerIndex:re,isReady:fe,isPlaying:q}}))}catch(ue){ee.error("useHLSStream: Error handling player status update",ue)}});return()=>{$()}},[b]),D.useEffect(()=>{if(l&&l.streamUrl){ee.log("useHLSStream: Resending saved stream URL to Unity");const J=setTimeout(()=>{x(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(J)}},[l,n,x,f]),D.useEffect(()=>{const J=$=>{if($.detail){if(ee.log("useHLSStream: Received stream update event",$.detail),w===$.detail.spaceId)ee.log(`useHLSStream: Stream update is for our space ${w}, loading stream data`),F(w);else if($.detail.streamUrl){ee.log(`useHLSStream: Using stream URL directly from event: ${$.detail.streamUrl}`);const ie=$.detail.playerIndex||"0";x($.detail.streamUrl,ie),d($.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",J),window.addEventListener("SpaceStreamUpdated",J),()=>{window.removeEventListener("SpaceHLSStreamUpdated",J),window.removeEventListener("SpaceStreamUpdated",J)}},[w,x]),{setHLSStreamUrl:z,playerStatus:n,isLoading:s,savedStreamData:l,reloadStreamData:B}},D6e=()=>{const[n,t]=D.useState(!1),s=dp();return D.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{ee.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),n},L6e=()=>{const[n,t]=D.useState(null),s=dp();return console.log(" Nameplate click hook initialized"),D.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const y=typeof f=="string"?JSON.parse(f):f;t({playerName:y.playerName,playerId:y.playerId,uid:y.uid,isLocalPlayer:y.isLocalPlayer}),console.log(" Processed nameplate data:",y)}catch(y){console.error(" Error processing nameplate data:",y)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[n,()=>{console.log(" Resetting nameplate data"),t(null)}]},x6e=()=>{const n=dp(),{sendUserToUnity:t}=D.useContext(ul);return D.useEffect(()=>{const a=n("RequestUserForUnity",()=>{ee.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[n,t]),!0},BJ=async(n,t,s,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!n||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(s){if(!s.type.startsWith("image/"))throw new Error("File must be an image");const v=Yy(),b=Date.now(),w=s.name.split(".").pop(),I=`${t}_${b}.${w}`,k=qy(v,`spaces/${n}/mediaScreens/${I}`);ee.log(`Uploading image for media screen ${t} in space ${n}`);const x=await x4(k,s);y=await i1(x.ref);const F=ri(Ir,`spaces/${n}/mediaScreens`,t);await R0(F,{imageUrl:y,gsUrl:`gs://${x.ref.bucket}/${x.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){y=f;const v=ri(Ir,`spaces/${n}/mediaScreens`,t);await R0(v,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return ee.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),y}catch(l){throw ee.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},V4=async n=>{ee.log(`Getting media screen images for space: ${n}`);try{const t=Ag(Ir,`spaces/${n}/mediaScreens`),s=await Vy(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw ee.error("Error fetching media screen images from Firestore:",t),t}},Tf=async(n,t)=>{try{const s=ri(Ir,`spaces/${n}/mediaScreens`,t),a=await ga(s);return a.exists()?{id:a.id,...a.data()}:(ee.warn(`No media screen found with ID: ${t}`),null)}catch(s){throw ee.error("Error fetching media screen image:",s),s}},M6e=async(n,t)=>{try{const s=await Tf(n,t);if(!s)return ee.warn(`No media screen found with ID: ${t} to delete`),!1;if(s.gsUrl){const l=Yy(),d=qy(l,s.gsUrl);try{await M4(d),ee.log(`Deleted file from storage: ${s.gsUrl}`)}catch(f){ee.warn(`Could not delete file from storage: ${f.message}`)}}const a=ri(Ir,`spaces/${n}/mediaScreens`,t);return s.mediaType==="video"?(await Ea(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),ee.log(`Successfully removed video for media screen ${t}`)):(await Ea(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),ee.log(`Successfully removed image for media screen ${t}`)),!0}catch(s){throw ee.error("Error deleting media screen image:",s),s}},U6e=async(n,t,s)=>{try{if(!n||!t||typeof s!="boolean")throw new Error("Missing or invalid required parameters");const a=await Tf(n,t);if(!a||!a.imageUrl&&!a.videoUrl)return ee.warn(`No media screen content found with ID: ${t} to update`),!1;const l=ri(Ir,`spaces/${n}/mediaScreens`,t);return await Ea(l,{displayAsVideo:s,updatedAt:new Date().toISOString()}),ee.log(`Successfully updated display mode for media screen ${t} to ${s?"video":"image"}`),!0}catch(a){throw ee.error("Error updating media screen display mode:",a),a}},V6e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},eoe=()=>{const{spaceID:n}=va(),t=up(),[s,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){ee.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{ee.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!s){ee.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}ee.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await V4(n);ee.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:y,imageUrl:v,displayAsVideo:b,videoUrl:w}=f;let I=null;(!b||!w)&&(I=v?V6e(v):null),t("SetMediaScreenImage",{mediaScreenId:y,imageUrl:I,videoUrl:w||null,displayAsVideo:b||!1,timestamp:Date.now()}),ee.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${b})`),b&&w&&(t("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),ee.log(`Set display mode to video for screen ${y}`))})}catch(d){ee.error("Error fetching media screen images:",d)}})()},[t,n,s])},F6e=()=>{const{spaceID:n}=va(),t=up(),[s,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){ee.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{ee.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!s){ee.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}ee.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await Kse(n),f=async b=>{const w=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const k=await I.json(),x=k.thumbnail_url.replace(/_\d+x\d+/,""),F=["640x360","295x166"];let B=null;for(let z of F){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${x}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch($){console.warn(`Failed to validate thumbnail URL: ${J}`,$)}}return B||k.thumbnail_url},y=d.map(async b=>{const w=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:w}}),v=await Promise.all(y);ee.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:w})=>{t("SetThumbnail",{gameObjectName:b,thumbnailUrl:w})})}catch(d){ee.error("Error fetching thumbnails:",d)}})()},[t,n,s])},toe=()=>{const[n,t]=D.useState([]),s=dp();return D.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(ee.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=x=>{if(a){ee.log("UpdatePlayerList unity message received.");try{let F=[];if(typeof x=="object"&&x!==null?F=x.players||[]:F=JSON.parse(x).players||[],Array.isArray(F)){const B=Array.from(new Map(F.map(z=>[z.playerId,z])).values());t(B),l&&(clearTimeout(l),l=null)}}catch(F){ee.error("Error handling player list data:",F),l||(l=setTimeout(d,1e3))}}},y=()=>{ee.log("Player disconnected, requesting fresh player list"),d()},v=()=>{ee.log("Player left, requesting fresh player list"),d()};d();const b=s("UpdatePlayerList",f),w=s("PlayerDisconnected",y),I=s("PlayerLeft",v),k=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof w=="function"&&w(),typeof I=="function"&&I(),clearInterval(k)}},[s]),n},noe=()=>{const n=up(),{isLoaded:t}=va(),[s,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){ee.log("usePlacePrefab: Unity already ready (via window flag)"),a(!0);return}const f=()=>{ee.log("usePlacePrefab: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",f),()=>{window.removeEventListener("PlayerInstantiated",f)}},[]);const l=D.useCallback((f,y,v,b)=>{const w=y||{x:0,y:1,z:0},I=v||{x:0,y:0,z:0},k=b||{x:1,y:1,z:1};try{const x={prefabName:f||"TestPrefab",position:w,rotation:I,scale:k};return ee.log("Sending prefab placement to Unity:",x),n("PlacePrefab",x),!0}catch(x){return ee.error("Error placing prefab:",x),!1}},[n]),d=D.useCallback((f,y,v,b)=>{const w=y||{x:0,y:1,z:0},I=v||{x:0,y:0,z:0},k=b||{x:1,y:1,z:1};if(!window.unityInstance)return ee.error("Unity not loaded, cannot place prefab directly"),!1;try{const x={prefabName:f||"TestPrefab",position:w,rotation:I,scale:k},F={eventName:"PlacePrefab",data:JSON.stringify(x)};return ee.log("Directly sending prefab placement to Unity:",x),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(F)),!0}catch(x){return ee.error("Error directly placing prefab:",x),!1}},[]);return{placePrefab:l,directPlacePrefab:d,isUnityLoaded:s&&t}},j6e=n=>{const[t,s]=D.useState(null),a=dp(),{spaceID:l}=va();return D.useEffect(()=>{let f=!0;const v=a("PlayVideo",async b=>{try{const{gameObjectName:w}=b;if(!w){ee.error("Game object name is missing in Unity event data.");return}const I=await Kse(l);ee.log("SPACES VIDEOS",I);const k=I.find(x=>x.id===w);k&&f?(s(k.url),ee.log("Video URL set to:",k.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{f=!1,v()}},[a,l,n]),[t,()=>{s(null)}]};let RO;const B6e=new Uint8Array(16);function W6e(){if(!RO&&(RO=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!RO))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return RO(B6e)}const da=[];for(let n=0;n<256;++n)da.push((n+256).toString(16).slice(1));function z6e(n,t=0){return da[n[t+0]]+da[n[t+1]]+da[n[t+2]]+da[n[t+3]]+"-"+da[n[t+4]]+da[n[t+5]]+"-"+da[n[t+6]]+da[n[t+7]]+"-"+da[n[t+8]]+da[n[t+9]]+"-"+da[n[t+10]]+da[n[t+11]]+da[n[t+12]]+da[n[t+13]]+da[n[t+14]]+da[n[t+15]]}const G6e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),WJ={randomUUID:G6e};function H6e(n,t,s){if(WJ.randomUUID&&!n)return WJ.randomUUID();n=n||{};const a=n.random||(n.rng||W6e)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,z6e(a)}const s1="spaces",o1="objects",$6e=async(n,t,s)=>{try{const a=ri(Ir,s1,n,o1,t),l={...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),spaceId:n,objectId:t};return await R0(a,l),ee.log(`Saved object ${t} to space ${n}`),!0}catch(a){return ee.error("Error saving object to space:",a),!1}},zJ=async n=>{try{const t=Ag(Ir,s1,n,o1),s=await Vy(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),ee.log(`Retrieved ${a.length} objects for space ${n}`),a}catch(t){return ee.error("Error getting space objects:",t),[]}},K6e=async(n,t)=>{try{const s=ri(Ir,s1,n,o1,t);return await M5e(s),ee.log(`Deleted object ${t} from space ${n}`),!0}catch(s){return ee.error("Error deleting space object:",s),!1}},q6e=async(n,t,s)=>{try{const a=ri(Ir,s1,n,o1,t),l={...s,updatedAt:new Date().toISOString()};return await Ea(a,l),ee.log(`Updated object ${t} in space ${n}`),!0}catch(a){return ee.error("Error updating space object:",a),!1}},Y6e=n=>{const[t,s]=D.useState([]),[a,l]=D.useState(!0),{placePrefab:d,isUnityLoaded:f}=noe();D.useEffect(()=>{(async()=>{if(n){l(!0);try{const k=await zJ(n);s(k),k.forEach(x=>{d(x.prefabName,x.position,x.rotation,x.scale)})}catch(k){ee.error("Error loading space objects:",k)}finally{l(!1)}}})()},[n,d]);const y=D.useCallback(async(I,k,x,F)=>{if(!n)return!1;const B=H6e(),z={prefabName:I,position:k,rotation:x,scale:F,objectId:B},J=await $6e(n,B,z);return J&&(s($=>[...$,{id:B,...z}]),d(I,k,x,F)),J},[n,d]),v=D.useCallback(async I=>{if(!n)return!1;const k=await K6e(n,I);return k&&s(x=>x.filter(F=>F.id!==I)),k},[n]),b=D.useCallback(async(I,k)=>{if(!n)return!1;const x=await q6e(n,I,k);return x&&s(F=>F.map(B=>B.id===I?{...B,...k}:B)),x},[n]),w=D.useCallback(async()=>{if(n){l(!0);try{const I=await zJ(n);s(I),I.forEach(k=>{d(k.prefabName,k.position,k.rotation,k.scale)})}catch(I){ee.error("Error reloading space objects:",I)}finally{l(!1)}}},[n,d]);return{objects:t,isLoading:a,saveObject:y,deleteObject:v,updateObject:b,reloadObjects:w,isUnityLoaded:f}},X6e=n=>({opacity:1});var dR=n=>n.type==="checkbox",my=n=>n instanceof Date,gc=n=>n==null;const roe=n=>typeof n=="object";var Ks=n=>!gc(n)&&!Array.isArray(n)&&roe(n)&&!my(n),J6e=n=>Ks(n)&&n.target?dR(n.target)?n.target.checked:n.target.value:n,Q6e=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,Z6e=(n,t)=>n.has(Q6e(t)),e8e=n=>{const t=n.constructor&&n.constructor.prototype;return Ks(t)&&t.hasOwnProperty("isPrototypeOf")},F4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Cu(n){let t;const s=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)t=new Date(n);else if(n instanceof Set)t=new Set(n);else if(!(F4&&(n instanceof Blob||a))&&(s||Ks(n)))if(t=s?[]:{},!s&&!e8e(n))t=n;else for(const l in n)n.hasOwnProperty(l)&&(t[l]=Cu(n[l]));else return n;return t}var a1=n=>Array.isArray(n)?n.filter(Boolean):[],Zs=n=>n===void 0,dn=(n,t,s)=>{if(!t||!Ks(n))return s;const a=a1(t.split(/[,[\].]+?/)).reduce((l,d)=>gc(l)?l:l[d],n);return Zs(a)||a===n?Zs(n[t])?s:n[t]:a},xh=n=>typeof n=="boolean",j4=n=>/^\w*$/.test(n),ioe=n=>a1(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Xi=(n,t,s)=>{let a=-1;const l=j4(t)?[t]:ioe(t),d=l.length,f=d-1;for(;++a<d;){const y=l[a];let v=s;if(a!==f){const b=n[y];v=Ks(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=v,n=n[y]}return n};const GJ={BLUR:"blur",FOCUS_OUT:"focusout"},Od={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},hf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ui.createContext(null);var t8e=(n,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const f=d;return t._proxyFormState[f]!==Od.all&&(t._proxyFormState[f]=!a||Od.all),n[f]}});return l},tl=n=>Ks(n)&&!Object.keys(n).length,n8e=(n,t,s,a)=>{s(n);const{name:l,...d}=n;return tl(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(f=>t[f]===Od.all)},dk=n=>Array.isArray(n)?n:[n];function r8e(n){const t=ui.useRef(n);t.current=n,ui.useEffect(()=>{const s=!n.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[n.disabled])}var Hh=n=>typeof n=="string",i8e=(n,t,s,a,l)=>Hh(n)?(a&&t.watch.add(n),dn(s,n,l)):Array.isArray(n)?n.map(d=>(a&&t.watch.add(d),dn(s,d))):(a&&(t.watchAll=!0),s),s8e=(n,t,s,a,l)=>t?{...s[n],types:{...s[n]&&s[n].types?s[n].types:{},[a]:l||!0}}:{},HJ=n=>({isOnSubmit:!n||n===Od.onSubmit,isOnBlur:n===Od.onBlur,isOnChange:n===Od.onChange,isOnAll:n===Od.all,isOnTouch:n===Od.onTouched}),$J=(n,t,s)=>!s&&(t.watchAll||t.watch.has(n)||[...t.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const aC=(n,t,s,a)=>{for(const l of s||Object.keys(n)){const d=dn(n,l);if(d){const{_f:f,...y}=d;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!a)return!0;if(f.ref&&t(f.ref,f.name)&&!a)return!0;if(aC(y,t))break}else if(Ks(y)&&aC(y,t))break}}};var o8e=(n,t,s)=>{const a=dk(dn(n,s));return Xi(a,"root",t[s]),Xi(n,s,a),n},B4=n=>n.type==="file",Bh=n=>typeof n=="function",Qk=n=>{if(!F4)return!1;const t=n?n.ownerDocument:0;return n instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},hk=n=>Hh(n),W4=n=>n.type==="radio",Zk=n=>n instanceof RegExp;const KJ={value:!1,isValid:!1},qJ={value:!0,isValid:!0};var soe=n=>{if(Array.isArray(n)){if(n.length>1){const t=n.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Zs(n[0].attributes.value)?Zs(n[0].value)||n[0].value===""?qJ:{value:n[0].value,isValid:!0}:qJ:KJ}return KJ};const YJ={isValid:!1,value:null};var ooe=n=>Array.isArray(n)?n.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,YJ):YJ;function XJ(n,t,s="validate"){if(hk(n)||Array.isArray(n)&&n.every(hk)||xh(n)&&!n)return{type:s,message:hk(n)?n:"",ref:t}}var ES=n=>Ks(n)&&!Zk(n)?n:{value:n,message:""},JJ=async(n,t,s,a,l,d)=>{const{ref:f,refs:y,required:v,maxLength:b,minLength:w,min:I,max:k,pattern:x,validate:F,name:B,valueAsNumber:z,mount:J}=n._f,$=dn(s,B);if(!J||t.has(B))return{};const ie=y?y[0]:f,ue=pe=>{l&&ie.reportValidity&&(ie.setCustomValidity(xh(pe)?"":pe||""),ie.reportValidity())},re={},fe=W4(f),q=dR(f),X=fe||q,Q=(z||B4(f))&&Zs(f.value)&&Zs($)||Qk(f)&&f.value===""||$===""||Array.isArray($)&&!$.length,se=s8e.bind(null,B,a,re),me=(pe,le,Le,We=hf.maxLength,$e=hf.minLength)=>{const ve=pe?le:Le;re[B]={type:pe?We:$e,message:ve,ref:f,...se(pe?We:$e,ve)}};if(d?!Array.isArray($)||!$.length:v&&(!X&&(Q||gc($))||xh($)&&!$||q&&!soe(y).isValid||fe&&!ooe(y).isValid)){const{value:pe,message:le}=hk(v)?{value:!!v,message:v}:ES(v);if(pe&&(re[B]={type:hf.required,message:le,ref:ie,...se(hf.required,le)},!a))return ue(le),re}if(!Q&&(!gc(I)||!gc(k))){let pe,le;const Le=ES(k),We=ES(I);if(!gc($)&&!isNaN($)){const $e=f.valueAsNumber||$&&+$;gc(Le.value)||(pe=$e>Le.value),gc(We.value)||(le=$e<We.value)}else{const $e=f.valueAsDate||new Date($),ve=ke=>new Date(new Date().toDateString()+" "+ke),_e=f.type=="time",Ee=f.type=="week";Hh(Le.value)&&$&&(pe=_e?ve($)>ve(Le.value):Ee?$>Le.value:$e>new Date(Le.value)),Hh(We.value)&&$&&(le=_e?ve($)<ve(We.value):Ee?$<We.value:$e<new Date(We.value))}if((pe||le)&&(me(!!pe,Le.message,We.message,hf.max,hf.min),!a))return ue(re[B].message),re}if((b||w)&&!Q&&(Hh($)||d&&Array.isArray($))){const pe=ES(b),le=ES(w),Le=!gc(pe.value)&&$.length>+pe.value,We=!gc(le.value)&&$.length<+le.value;if((Le||We)&&(me(Le,pe.message,le.message),!a))return ue(re[B].message),re}if(x&&!Q&&Hh($)){const{value:pe,message:le}=ES(x);if(Zk(pe)&&!$.match(pe)&&(re[B]={type:hf.pattern,message:le,ref:f,...se(hf.pattern,le)},!a))return ue(le),re}if(F){if(Bh(F)){const pe=await F($,s),le=XJ(pe,ie);if(le&&(re[B]={...le,...se(hf.validate,le.message)},!a))return ue(le.message),re}else if(Ks(F)){let pe={};for(const le in F){if(!tl(pe)&&!a)break;const Le=XJ(await F[le]($,s),ie,le);Le&&(pe={...Le,...se(le,Le.message)},ue(Le.message),a&&(re[B]=pe))}if(!tl(pe)&&(re[B]={ref:ie,...pe},!a))return re}}return ue(!0),re};function a8e(n,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)n=Zs(n)?a++:n[t[a++]];return n}function c8e(n){for(const t in n)if(n.hasOwnProperty(t)&&!Zs(n[t]))return!1;return!0}function mo(n,t){const s=Array.isArray(t)?t:j4(t)?[t]:ioe(t),a=s.length===1?n:a8e(n,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(Ks(a)&&tl(a)||Array.isArray(a)&&c8e(a))&&mo(n,s.slice(0,-1)),n}var iU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},FV=n=>gc(n)||!roe(n);function ug(n,t){if(FV(n)||FV(t))return n===t;if(my(n)&&my(t))return n.getTime()===t.getTime();const s=Object.keys(n),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=t[l];if(my(d)&&my(f)||Ks(d)&&Ks(f)||Array.isArray(d)&&Array.isArray(f)?!ug(d,f):d!==f)return!1}}return!0}var aoe=n=>n.type==="select-multiple",l8e=n=>W4(n)||dR(n),sU=n=>Qk(n)&&n.isConnected,coe=n=>{for(const t in n)if(Bh(n[t]))return!0;return!1};function eN(n,t={}){const s=Array.isArray(n);if(Ks(n)||s)for(const a in n)Array.isArray(n[a])||Ks(n[a])&&!coe(n[a])?(t[a]=Array.isArray(n[a])?[]:{},eN(n[a],t[a])):gc(n[a])||(t[a]=!0);return t}function loe(n,t,s){const a=Array.isArray(n);if(Ks(n)||a)for(const l in n)Array.isArray(n[l])||Ks(n[l])&&!coe(n[l])?Zs(t)||FV(s[l])?s[l]=Array.isArray(n[l])?eN(n[l],[]):{...eN(n[l])}:loe(n[l],gc(t)?{}:t[l],s[l]):s[l]=!ug(n[l],t[l]);return s}var Sw=(n,t)=>loe(n,t,eN(t)),uoe=(n,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>Zs(n)?n:t?n===""?NaN:n&&+n:s&&Hh(n)?new Date(n):a?a(n):n;function oU(n){const t=n.ref;return B4(t)?t.files:W4(t)?ooe(n.refs).value:aoe(t)?[...t.selectedOptions].map(({value:s})=>s):dR(t)?soe(n.refs).value:uoe(Zs(t.value)?n.ref.value:t.value,n)}var u8e=(n,t,s,a)=>{const l={};for(const d of n){const f=dn(t,d);f&&Xi(l,d,f._f)}return{criteriaMode:s,names:[...n],fields:l,shouldUseNativeValidation:a}},bw=n=>Zs(n)?n:Zk(n)?n.source:Ks(n)?Zk(n.value)?n.value.source:n.value:n;const QJ="AsyncFunction";var d8e=n=>!!n&&!!n.validate&&!!(Bh(n.validate)&&n.validate.constructor.name===QJ||Ks(n.validate)&&Object.values(n.validate).find(t=>t.constructor.name===QJ)),h8e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function ZJ(n,t,s){const a=dn(n,s);if(a||j4(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),f=dn(t,d),y=dn(n,d);if(f&&!Array.isArray(f)&&s!==d)return{name:s};if(y&&y.type)return{name:d,error:y};l.pop()}return{name:s}}var p8e=(n,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||n):(s?a.isOnBlur:l.isOnBlur)?!n:(s?a.isOnChange:l.isOnChange)?n:!0,f8e=(n,t)=>!a1(dn(n,t)).length&&mo(n,t);const m8e={mode:Od.onSubmit,reValidateMode:Od.onChange,shouldFocusError:!0};function g8e(n={}){let t={...m8e,...n},s={submitCount:0,isDirty:!1,isLoading:Bh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=Ks(t.defaultValues)||Ks(t.values)?Cu(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Cu(l),f={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:iU(),array:iU(),state:iU()},k=HJ(t.mode),x=HJ(t.reValidateMode),F=t.criteriaMode===Od.all,B=Re=>Fe=>{clearTimeout(b),b=setTimeout(Re,Fe)},z=async Re=>{if(!t.disabled&&(w.isValid||Re)){const Fe=t.resolver?tl((await X()).errors):await se(a,!0);Fe!==s.isValid&&I.state.next({isValid:Fe})}},J=(Re,Fe)=>{!t.disabled&&(w.isValidating||w.validatingFields)&&((Re||Array.from(y.mount)).forEach(Ge=>{Ge&&(Fe?Xi(s.validatingFields,Ge,Fe):mo(s.validatingFields,Ge))}),I.state.next({validatingFields:s.validatingFields,isValidating:!tl(s.validatingFields)}))},$=(Re,Fe=[],Ge,ot,_t=!0,yt=!0)=>{if(ot&&Ge&&!t.disabled){if(f.action=!0,yt&&Array.isArray(dn(a,Re))){const Gt=Ge(dn(a,Re),ot.argA,ot.argB);_t&&Xi(a,Re,Gt)}if(yt&&Array.isArray(dn(s.errors,Re))){const Gt=Ge(dn(s.errors,Re),ot.argA,ot.argB);_t&&Xi(s.errors,Re,Gt),f8e(s.errors,Re)}if(w.touchedFields&&yt&&Array.isArray(dn(s.touchedFields,Re))){const Gt=Ge(dn(s.touchedFields,Re),ot.argA,ot.argB);_t&&Xi(s.touchedFields,Re,Gt)}w.dirtyFields&&(s.dirtyFields=Sw(l,d)),I.state.next({name:Re,isDirty:pe(Re,Fe),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else Xi(d,Re,Fe)},ie=(Re,Fe)=>{Xi(s.errors,Re,Fe),I.state.next({errors:s.errors})},ue=Re=>{s.errors=Re,I.state.next({errors:s.errors,isValid:!1})},re=(Re,Fe,Ge,ot)=>{const _t=dn(a,Re);if(_t){const yt=dn(d,Re,Zs(Ge)?dn(l,Re):Ge);Zs(yt)||ot&&ot.defaultChecked||Fe?Xi(d,Re,Fe?yt:oU(_t._f)):We(Re,yt),f.mount&&z()}},fe=(Re,Fe,Ge,ot,_t)=>{let yt=!1,Gt=!1;const mn={name:Re};if(!t.disabled){const Pn=!!(dn(a,Re)&&dn(a,Re)._f&&dn(a,Re)._f.disabled);if(!Ge||ot){w.isDirty&&(Gt=s.isDirty,s.isDirty=mn.isDirty=pe(),yt=Gt!==mn.isDirty);const un=Pn||ug(dn(l,Re),Fe);Gt=!!(!Pn&&dn(s.dirtyFields,Re)),un||Pn?mo(s.dirtyFields,Re):Xi(s.dirtyFields,Re,!0),mn.dirtyFields=s.dirtyFields,yt=yt||w.dirtyFields&&Gt!==!un}if(Ge){const un=dn(s.touchedFields,Re);un||(Xi(s.touchedFields,Re,Ge),mn.touchedFields=s.touchedFields,yt=yt||w.touchedFields&&un!==Ge)}yt&&_t&&I.state.next(mn)}return yt?mn:{}},q=(Re,Fe,Ge,ot)=>{const _t=dn(s.errors,Re),yt=w.isValid&&xh(Fe)&&s.isValid!==Fe;if(t.delayError&&Ge?(v=B(()=>ie(Re,Ge)),v(t.delayError)):(clearTimeout(b),v=null,Ge?Xi(s.errors,Re,Ge):mo(s.errors,Re)),(Ge?!ug(_t,Ge):_t)||!tl(ot)||yt){const Gt={...ot,...yt&&xh(Fe)?{isValid:Fe}:{},errors:s.errors,name:Re};s={...s,...Gt},I.state.next(Gt)}},X=async Re=>{J(Re,!0);const Fe=await t.resolver(d,t.context,u8e(Re||y.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return J(Re),Fe},Q=async Re=>{const{errors:Fe}=await X(Re);if(Re)for(const Ge of Re){const ot=dn(Fe,Ge);ot?Xi(s.errors,Ge,ot):mo(s.errors,Ge)}else s.errors=Fe;return Fe},se=async(Re,Fe,Ge={valid:!0})=>{for(const ot in Re){const _t=Re[ot];if(_t){const{_f:yt,...Gt}=_t;if(yt){const mn=y.array.has(yt.name),Pn=_t._f&&d8e(_t._f);Pn&&w.validatingFields&&J([ot],!0);const un=await JJ(_t,y.disabled,d,F,t.shouldUseNativeValidation&&!Fe,mn);if(Pn&&w.validatingFields&&J([ot]),un[yt.name]&&(Ge.valid=!1,Fe))break;!Fe&&(dn(un,yt.name)?mn?o8e(s.errors,un,yt.name):Xi(s.errors,yt.name,un[yt.name]):mo(s.errors,yt.name))}!tl(Gt)&&await se(Gt,Fe,Ge)}}return Ge.valid},me=()=>{for(const Re of y.unMount){const Fe=dn(a,Re);Fe&&(Fe._f.refs?Fe._f.refs.every(Ge=>!sU(Ge)):!sU(Fe._f.ref))&&Je(Re)}y.unMount=new Set},pe=(Re,Fe)=>!t.disabled&&(Re&&Fe&&Xi(d,Re,Fe),!ug(we(),l)),le=(Re,Fe,Ge)=>i8e(Re,y,{...f.mount?d:Zs(Fe)?l:Hh(Re)?{[Re]:Fe}:Fe},Ge,Fe),Le=Re=>a1(dn(f.mount?d:l,Re,t.shouldUnregister?dn(l,Re,[]):[])),We=(Re,Fe,Ge={})=>{const ot=dn(a,Re);let _t=Fe;if(ot){const yt=ot._f;yt&&(!yt.disabled&&Xi(d,Re,uoe(Fe,yt)),_t=Qk(yt.ref)&&gc(Fe)?"":Fe,aoe(yt.ref)?[...yt.ref.options].forEach(Gt=>Gt.selected=_t.includes(Gt.value)):yt.refs?dR(yt.ref)?yt.refs.length>1?yt.refs.forEach(Gt=>(!Gt.defaultChecked||!Gt.disabled)&&(Gt.checked=Array.isArray(_t)?!!_t.find(mn=>mn===Gt.value):_t===Gt.value)):yt.refs[0]&&(yt.refs[0].checked=!!_t):yt.refs.forEach(Gt=>Gt.checked=Gt.value===_t):B4(yt.ref)?yt.ref.value="":(yt.ref.value=_t,yt.ref.type||I.values.next({name:Re,values:{...d}})))}(Ge.shouldDirty||Ge.shouldTouch)&&fe(Re,_t,Ge.shouldTouch,Ge.shouldDirty,!0),Ge.shouldValidate&&ke(Re)},$e=(Re,Fe,Ge)=>{for(const ot in Fe){const _t=Fe[ot],yt=`${Re}.${ot}`,Gt=dn(a,yt);(y.array.has(Re)||Ks(_t)||Gt&&!Gt._f)&&!my(_t)?$e(yt,_t,Ge):We(yt,_t,Ge)}},ve=(Re,Fe,Ge={})=>{const ot=dn(a,Re),_t=y.array.has(Re),yt=Cu(Fe);Xi(d,Re,yt),_t?(I.array.next({name:Re,values:{...d}}),(w.isDirty||w.dirtyFields)&&Ge.shouldDirty&&I.state.next({name:Re,dirtyFields:Sw(l,d),isDirty:pe(Re,yt)})):ot&&!ot._f&&!gc(yt)?$e(Re,yt,Ge):We(Re,yt,Ge),$J(Re,y)&&I.state.next({...s}),I.values.next({name:f.mount?Re:void 0,values:{...d}})},_e=async Re=>{f.mount=!0;const Fe=Re.target;let Ge=Fe.name,ot=!0;const _t=dn(a,Ge),yt=()=>Fe.type?oU(_t._f):J6e(Re),Gt=mn=>{ot=Number.isNaN(mn)||my(mn)&&isNaN(mn.getTime())||ug(mn,dn(d,Ge,mn))};if(_t){let mn,Pn;const un=yt(),bt=Re.type===GJ.BLUR||Re.type===GJ.FOCUS_OUT,lr=!h8e(_t._f)&&!t.resolver&&!dn(s.errors,Ge)&&!_t._f.deps||p8e(bt,dn(s.touchedFields,Ge),s.isSubmitted,x,k),Nt=$J(Ge,y,bt);Xi(d,Ge,un),bt?(_t._f.onBlur&&_t._f.onBlur(Re),v&&v(0)):_t._f.onChange&&_t._f.onChange(Re);const Kt=fe(Ge,un,bt,!1),qr=!tl(Kt)||Nt;if(!bt&&I.values.next({name:Ge,type:Re.type,values:{...d}}),lr)return w.isValid&&(t.mode==="onBlur"&&bt?z():bt||z()),qr&&I.state.next({name:Ge,...Nt?{}:Kt});if(!bt&&Nt&&I.state.next({...s}),t.resolver){const{errors:ji}=await X([Ge]);if(Gt(un),ot){const Ms=ZJ(s.errors,a,Ge),ii=ZJ(ji,a,Ms.name||Ge);mn=ii.error,Ge=ii.name,Pn=tl(ji)}}else J([Ge],!0),mn=(await JJ(_t,y.disabled,d,F,t.shouldUseNativeValidation))[Ge],J([Ge]),Gt(un),ot&&(mn?Pn=!1:w.isValid&&(Pn=await se(a,!0)));ot&&(_t._f.deps&&ke(_t._f.deps),q(Ge,Pn,mn,Kt))}},Ee=(Re,Fe)=>{if(dn(s.errors,Fe)&&Re.focus)return Re.focus(),1},ke=async(Re,Fe={})=>{let Ge,ot;const _t=dk(Re);if(t.resolver){const yt=await Q(Zs(Re)?Re:_t);Ge=tl(yt),ot=Re?!_t.some(Gt=>dn(yt,Gt)):Ge}else Re?(ot=(await Promise.all(_t.map(async yt=>{const Gt=dn(a,yt);return await se(Gt&&Gt._f?{[yt]:Gt}:Gt)}))).every(Boolean),!(!ot&&!s.isValid)&&z()):ot=Ge=await se(a);return I.state.next({...!Hh(Re)||w.isValid&&Ge!==s.isValid?{}:{name:Re},...t.resolver||!Re?{isValid:Ge}:{},errors:s.errors}),Fe.shouldFocus&&!ot&&aC(a,Ee,Re?_t:y.mount),ot},we=Re=>{const Fe={...f.mount?d:l};return Zs(Re)?Fe:Hh(Re)?dn(Fe,Re):Re.map(Ge=>dn(Fe,Ge))},be=(Re,Fe)=>({invalid:!!dn((Fe||s).errors,Re),isDirty:!!dn((Fe||s).dirtyFields,Re),error:dn((Fe||s).errors,Re),isValidating:!!dn(s.validatingFields,Re),isTouched:!!dn((Fe||s).touchedFields,Re)}),Ie=Re=>{Re&&dk(Re).forEach(Fe=>mo(s.errors,Fe)),I.state.next({errors:Re?s.errors:{}})},Me=(Re,Fe,Ge)=>{const ot=(dn(a,Re,{_f:{}})._f||{}).ref,_t=dn(s.errors,Re)||{},{ref:yt,message:Gt,type:mn,...Pn}=_t;Xi(s.errors,Re,{...Pn,...Fe,ref:ot}),I.state.next({name:Re,errors:s.errors,isValid:!1}),Ge&&Ge.shouldFocus&&ot&&ot.focus&&ot.focus()},ze=(Re,Fe)=>Bh(Re)?I.values.subscribe({next:Ge=>Re(le(void 0,Fe),Ge)}):le(Re,Fe,!0),Je=(Re,Fe={})=>{for(const Ge of Re?dk(Re):y.mount)y.mount.delete(Ge),y.array.delete(Ge),Fe.keepValue||(mo(a,Ge),mo(d,Ge)),!Fe.keepError&&mo(s.errors,Ge),!Fe.keepDirty&&mo(s.dirtyFields,Ge),!Fe.keepTouched&&mo(s.touchedFields,Ge),!Fe.keepIsValidating&&mo(s.validatingFields,Ge),!t.shouldUnregister&&!Fe.keepDefaultValue&&mo(l,Ge);I.values.next({values:{...d}}),I.state.next({...s,...Fe.keepDirty?{isDirty:pe()}:{}}),!Fe.keepIsValid&&z()},tt=({disabled:Re,name:Fe,field:Ge,fields:ot})=>{(xh(Re)&&f.mount||Re||y.disabled.has(Fe))&&(Re?y.disabled.add(Fe):y.disabled.delete(Fe),fe(Fe,oU(Ge?Ge._f:dn(ot,Fe)._f),!1,!1,!0))},ut=(Re,Fe={})=>{let Ge=dn(a,Re);const ot=xh(Fe.disabled)||xh(t.disabled);return Xi(a,Re,{...Ge||{},_f:{...Ge&&Ge._f?Ge._f:{ref:{name:Re}},name:Re,mount:!0,...Fe}}),y.mount.add(Re),Ge?tt({field:Ge,disabled:xh(Fe.disabled)?Fe.disabled:t.disabled,name:Re}):re(Re,!0,Fe.value),{...ot?{disabled:Fe.disabled||t.disabled}:{},...t.progressive?{required:!!Fe.required,min:bw(Fe.min),max:bw(Fe.max),minLength:bw(Fe.minLength),maxLength:bw(Fe.maxLength),pattern:bw(Fe.pattern)}:{},name:Re,onChange:_e,onBlur:_e,ref:_t=>{if(_t){ut(Re,Fe),Ge=dn(a,Re);const yt=Zs(_t.value)&&_t.querySelectorAll&&_t.querySelectorAll("input,select,textarea")[0]||_t,Gt=l8e(yt),mn=Ge._f.refs||[];if(Gt?mn.find(Pn=>Pn===yt):yt===Ge._f.ref)return;Xi(a,Re,{_f:{...Ge._f,...Gt?{refs:[...mn.filter(sU),yt,...Array.isArray(dn(l,Re))?[{}]:[]],ref:{type:yt.type,name:Re}}:{ref:yt}}}),re(Re,!1,void 0,yt)}else Ge=dn(a,Re,{}),Ge._f&&(Ge._f.mount=!1),(t.shouldUnregister||Fe.shouldUnregister)&&!(Z6e(y.array,Re)&&f.action)&&y.unMount.add(Re)}}},Ze=()=>t.shouldFocusError&&aC(a,Ee,y.mount),vt=Re=>{xh(Re)&&(I.state.next({disabled:Re}),aC(a,(Fe,Ge)=>{const ot=dn(a,Ge);ot&&(Fe.disabled=ot._f.disabled||Re,Array.isArray(ot._f.refs)&&ot._f.refs.forEach(_t=>{_t.disabled=ot._f.disabled||Re}))},0,!1))},sn=(Re,Fe)=>async Ge=>{let ot;Ge&&(Ge.preventDefault&&Ge.preventDefault(),Ge.persist&&Ge.persist());let _t=Cu(d);if(y.disabled.size)for(const yt of y.disabled)Xi(_t,yt,void 0);if(I.state.next({isSubmitting:!0}),t.resolver){const{errors:yt,values:Gt}=await X();s.errors=yt,_t=Gt}else await se(a);if(mo(s.errors,"root"),tl(s.errors)){I.state.next({errors:{}});try{await Re(_t,Ge)}catch(yt){ot=yt}}else Fe&&await Fe({...s.errors},Ge),Ze(),setTimeout(Ze);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:tl(s.errors)&&!ot,submitCount:s.submitCount+1,errors:s.errors}),ot)throw ot},Mt=(Re,Fe={})=>{dn(a,Re)&&(Zs(Fe.defaultValue)?ve(Re,Cu(dn(l,Re))):(ve(Re,Fe.defaultValue),Xi(l,Re,Cu(Fe.defaultValue))),Fe.keepTouched||mo(s.touchedFields,Re),Fe.keepDirty||(mo(s.dirtyFields,Re),s.isDirty=Fe.defaultValue?pe(Re,Cu(dn(l,Re))):pe()),Fe.keepError||(mo(s.errors,Re),w.isValid&&z()),I.state.next({...s}))},Qt=(Re,Fe={})=>{const Ge=Re?Cu(Re):l,ot=Cu(Ge),_t=tl(Re),yt=_t?l:ot;if(Fe.keepDefaultValues||(l=Ge),!Fe.keepValues){if(Fe.keepDirtyValues){const Gt=new Set([...y.mount,...Object.keys(Sw(l,d))]);for(const mn of Array.from(Gt))dn(s.dirtyFields,mn)?Xi(yt,mn,dn(d,mn)):ve(mn,dn(yt,mn))}else{if(F4&&Zs(Re))for(const Gt of y.mount){const mn=dn(a,Gt);if(mn&&mn._f){const Pn=Array.isArray(mn._f.refs)?mn._f.refs[0]:mn._f.ref;if(Qk(Pn)){const un=Pn.closest("form");if(un){un.reset();break}}}}a={}}d=t.shouldUnregister?Fe.keepDefaultValues?Cu(l):{}:Cu(yt),I.array.next({values:{...yt}}),I.values.next({values:{...yt}})}y={mount:Fe.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!w.isValid||!!Fe.keepIsValid||!!Fe.keepDirtyValues,f.watch=!!t.shouldUnregister,I.state.next({submitCount:Fe.keepSubmitCount?s.submitCount:0,isDirty:_t?!1:Fe.keepDirty?s.isDirty:!!(Fe.keepDefaultValues&&!ug(Re,l)),isSubmitted:Fe.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:_t?{}:Fe.keepDirtyValues?Fe.keepDefaultValues&&d?Sw(l,d):s.dirtyFields:Fe.keepDefaultValues&&Re?Sw(l,Re):Fe.keepDirty?s.dirtyFields:{},touchedFields:Fe.keepTouched?s.touchedFields:{},errors:Fe.keepErrors?s.errors:{},isSubmitSuccessful:Fe.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},on=(Re,Fe)=>Qt(Bh(Re)?Re(d):Re,Fe);return{control:{register:ut,unregister:Je,getFieldState:be,handleSubmit:sn,setError:Me,_executeSchema:X,_getWatch:le,_getDirty:pe,_updateValid:z,_removeUnmounted:me,_updateFieldArray:$,_updateDisabledField:tt,_getFieldArray:Le,_reset:Qt,_resetDefaultValues:()=>Bh(t.defaultValues)&&t.defaultValues().then(Re=>{on(Re,t.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Re=>{s={...s,...Re}},_disableForm:vt,_subjects:I,_proxyFormState:w,_setErrors:ue,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(Re){f=Re},get _defaultValues(){return l},get _names(){return y},set _names(Re){y=Re},get _formState(){return s},set _formState(Re){s=Re},get _options(){return t},set _options(Re){t={...t,...Re}}},trigger:ke,register:ut,handleSubmit:sn,watch:ze,setValue:ve,getValues:we,reset:on,resetField:Mt,clearErrors:Ie,unregister:Je,setError:Me,setFocus:(Re,Fe={})=>{const Ge=dn(a,Re),ot=Ge&&Ge._f;if(ot){const _t=ot.refs?ot.refs[0]:ot.ref;_t.focus&&(_t.focus(),Fe.shouldSelect&&Bh(_t.select)&&_t.select())}},getFieldState:be}}function doe(n={}){const t=ui.useRef(void 0),s=ui.useRef(void 0),[a,l]=ui.useState({isDirty:!1,isValidating:!1,isLoading:Bh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Bh(n.defaultValues)?void 0:n.defaultValues});t.current||(t.current={...g8e(n),formState:a});const d=t.current.control;return d._options=n,r8e({subject:d._subjects.state,next:f=>{n8e(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),ui.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),ui.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),ui.useEffect(()=>{n.values&&!ug(n.values,s.current)?(d._reset(n.values,d._options.resetOptions),s.current=n.values,l(f=>({...f}))):d._resetDefaultValues()},[n.values,d]),ui.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),ui.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),ui.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),t.current.formState=t8e(a,d),t.current}var _8e=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function jV(){return jV=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},jV.apply(this,arguments)}function y8e(n,t){if(n==null)return{};var s={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(s[l]=n[l]);return s}function IO(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function E8e(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,BV(n,t)}function BV(n,t){return BV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,l){return a.__proto__=l,a},BV(n,t)}var c1=function(n){E8e(t,n);function t(){var a;return a=n.call(this)||this,a.handleExpired=a.handleExpired.bind(IO(a)),a.handleErrored=a.handleErrored.bind(IO(a)),a.handleChange=a.handleChange.bind(IO(a)),a.handleRecaptchaRef=a.handleRecaptchaRef.bind(IO(a)),a}var s=t.prototype;return s.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},s.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},s.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},s.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},s.executeAsync=function(){var l=this;return new Promise(function(d,f){l.executionResolve=d,l.executionReject=f,l.execute()})},s.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},s.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},s.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},s.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},s.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},s.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var d=document.createElement("div");this._widgetId=l(d,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(d)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},s.componentDidMount=function(){this.explicitRender()},s.componentDidUpdate=function(){this.explicitRender()},s.handleRecaptchaRef=function(l){this.captcha=l},s.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var d=y8e(l,_8e);return D.createElement("div",jV({},d,{ref:this.handleRecaptchaRef}))},t}(D.Component);c1.displayName="ReCAPTCHA";c1.propTypes={sitekey:Tn.string.isRequired,onChange:Tn.func,grecaptcha:Tn.object,theme:Tn.oneOf(["dark","light"]),type:Tn.oneOf(["image","audio"]),tabindex:Tn.number,onExpired:Tn.func,onErrored:Tn.func,size:Tn.oneOf(["compact","normal","invisible"]),stoken:Tn.string,hl:Tn.string,badge:Tn.oneOf(["bottomright","bottomleft","inline"]),isolated:Tn.bool};c1.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function WV(){return WV=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},WV.apply(this,arguments)}function v8e(n,t){if(n==null)return{};var s={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(s[l]=n[l]);return s}function S8e(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t}var Id={},b8e=0;function T8e(n,t){return t=t||{},function(a){var l=a.displayName||a.name||"Component",d=function(y){S8e(v,y);function v(w,I){var k;return k=y.call(this,w,I)||this,k.state={},k.__scriptURL="",k}var b=v.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+b8e++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(I){var k=this;this.setState(I,function(){return k.props.asyncScriptOnLoad&&k.props.asyncScriptOnLoad(k.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=Id[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var k in I.observers)I.observers[k](I);delete window[t.callbackName]},b.componentDidMount=function(){var I=this,k=this.setupScriptURL(),x=this.asyncScriptLoaderGetScriptLoaderID(),F=t,B=F.globalName,z=F.callbackName,J=F.scriptId;if(B&&typeof window[B]<"u"&&(Id[k]={loaded:!0,observers:{}}),Id[k]){var $=Id[k];if($&&($.loaded||$.errored)){this.asyncScriptLoaderHandleLoad($);return}$.observers[x]=function(q){return I.asyncScriptLoaderHandleLoad(q)};return}var ie={};ie[x]=function(q){return I.asyncScriptLoaderHandleLoad(q)},Id[k]={loaded:!1,observers:ie};var ue=document.createElement("script");ue.src=k,ue.async=!0;for(var re in t.attributes)ue.setAttribute(re,t.attributes[re]);J&&(ue.id=J);var fe=function(X){if(Id[k]){var Q=Id[k],se=Q.observers;for(var me in se)X(se[me])&&delete se[me]}};z&&typeof window<"u"&&(window[z]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),ue.onload=function(){var q=Id[k];q&&(q.loaded=!0,fe(function(X){return z?!1:(X(q),!0)}))},ue.onerror=function(){var q=Id[k];q&&(q.errored=!0,fe(function(X){return X(q),!0}))},document.body.appendChild(ue)},b.componentWillUnmount=function(){var I=this.__scriptURL;if(t.removeOnUnmount===!0)for(var k=document.getElementsByTagName("script"),x=0;x<k.length;x+=1)k[x].src.indexOf(I)>-1&&k[x].parentNode&&k[x].parentNode.removeChild(k[x]);var F=Id[I];F&&(delete F.observers[this.asyncScriptLoaderGetScriptLoaderID()],t.removeOnUnmount===!0&&delete Id[I])},b.render=function(){var I=t.globalName,k=this.props;k.asyncScriptOnLoad;var x=k.forwardedRef,F=v8e(k,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(F[I]=typeof window[I]<"u"?window[I]:void 0),F.ref=x,D.createElement(a,F)},v}(D.Component),f=D.forwardRef(function(y,v){return D.createElement(d,WV({},y,{forwardedRef:v}))});return f.displayName="AsyncScriptLoader("+l+")",f.propTypes={asyncScriptOnLoad:Tn.func},VRe(f,a)}}var zV="onloadcallback",w8e="grecaptcha";function GV(){return typeof window<"u"&&window.recaptchaOptions||{}}function C8e(){var n=GV(),t=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+t+"/recaptcha/enterprise.js?onload="+zV+"&render=explicit":"https://"+t+"/recaptcha/api.js?onload="+zV+"&render=explicit"}const hoe=T8e(C8e,{callbackName:zV,globalName:w8e,attributes:GV().nonce?{nonce:GV().nonce}:{}})(c1),l1=(n,t="generic-modal")=>{D.useEffect(()=>{if(!window.unityInstance)return;const s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),ee.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){ee.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),ee.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):ee.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){ee.error(`Failed to enable Unity input for ${t}:`,l)}};return n?s():a(),()=>{n&&a()}},[n,t])},poe=({isOpen:n,onClose:t,userData:s,onConfirm:a,fullscreenRef:l})=>{const[d,f]=D.useState((s==null?void 0:s.username)||""),[y,v]=D.useState((s==null?void 0:s.Nickname)||""),[b,w]=D.useState(!1),[I,k]=D.useState(null),[x,F]=D.useState(!1),B=ll(),z=ue=>/^[a-z0-9]{1,15}$/.test(ue),J=async ue=>{var re,fe;if(!z(ue))return k("Username must be 1-15 characters, lowercase letters and numbers only"),!1;w(!0),k(null);try{let q=!1,X=0;const Q=3;for(;X<Q;)try{q=await Ase(ue);break}catch(se){if(ee.error(`Attempt ${X+1}: Error checking username:`,se),X++,X>=Q)throw se;await new Promise(me=>setTimeout(me,1e3))}return q?(k("Username is already taken"),!1):!0}catch(q){return ee.error("Error checking username after retries:",q),q.code==="permission-denied"||(re=q.message)!=null&&re.includes("permissions")?k("Username check unavailable. Please try again or pick a unique name."):k("Error checking username availability. Please try again."),q.code==="permission-denied"||((fe=q.message)==null?void 0:fe.includes("permissions"))}finally{w(!1)}};D.useEffect(()=>{if(!d){k("Username cannot be empty");return}if(d!==(s==null?void 0:s.username)){const ue=setTimeout(async()=>{await J(d)},500);return()=>clearTimeout(ue)}},[d]),D.useEffect(()=>{if(s&&s.firstName&&s.lastName){const ue=`${s.firstName}${s.lastName.charAt(0).toUpperCase()}`;v(ue)}},[s]);const $=async()=>{F(!0);try{if(!await J(d)){F(!1);return}if(y.length>15){k("Display Name must be at most 15 characters"),F(!1);return}ee.log("UsernameConfirmation: Preparing to confirm user registration");const re=s.firstName&&s.lastName?`${s.firstName}${s.lastName.charAt(0).toUpperCase()}`:"",fe={...s,firstName:s.firstName||"",lastName:s.lastName||"",companyName:s.companyName||"",linkedInProfile:s.linkedInProfile||"",username:d,Nickname:y||re,email:s.email,password:s.password};ee.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(fe).join(", ")),await a(fe),t()}catch(ue){ee.error("Error during username confirmation:",ue),B({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{F(!1)}},ie=()=>{x||t()};return R.jsxs(Mo,{isOpen:n,onClose:ie,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!x,closeOnEsc:!x,children:[R.jsx(Fo,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),R.jsxs(Uo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[R.jsxs(Sc,{children:[R.jsx(AC,{size:"lg",mb:2,children:"Customize Your Profile"}),R.jsx(ct,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),R.jsx(_a,{color:"gray.400",isDisabled:x}),R.jsx(Vo,{children:R.jsxs(Di,{spacing:6,align:"stretch",children:[R.jsxs(vi,{isInvalid:!!I,children:[R.jsx(go,{children:"Username"}),R.jsxs(wy,{children:[R.jsx(bj,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),R.jsx(os,{placeholder:"username",value:d,onChange:ue=>f(ue.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?R.jsx(Vh,{children:I}):R.jsx(SC,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),R.jsxs(vi,{children:[R.jsx(go,{children:"Nickname"}),R.jsx(os,{placeholder:"Nickname",value:y,onChange:ue=>v(ue.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),R.jsx(SC,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),R.jsx(Mf,{children:R.jsxs(Qi,{gap:3,width:"100%",children:[R.jsx(Kr,{variant:"outline",onClick:ie,flex:"1",isDisabled:x,children:"Back"}),R.jsx(Kr,{colorScheme:"blue",onClick:$,isLoading:x||b,isDisabled:!!I||!d||x,flex:"2",children:"Finish"})]})})]})]})};poe.propTypes={isOpen:Tn.bool.isRequired,onClose:Tn.func.isRequired,userData:Tn.object.isRequired,onConfirm:Tn.func.isRequired,fullscreenRef:Tn.object};const R8e="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function z4({mode:n,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:y}}=doe(),{register:v}=D.useContext(ul),b=ll(),{fullscreenRef:w}=Md(),[I,k]=D.useState(!1),[x,F]=D.useState(!1),[B,z]=D.useState(null),J=D.useRef(null),[$,ie]=D.useState(!1),[ue,re]=D.useState(null),[fe,q]=D.useState(!1),X=a!==void 0?a:I,Q=l||(()=>k(!1));l1(X||$),D.useEffect(()=>{!X&&J.current&&(J.current.reset(),z(null))},[X]);const se=We=>{z(We)},me=async We=>{ee.log("Register.jsx: Processing registration form submission");const{email:$e,password:ve,confirmPassword:_e,...Ee}=We;if(ee.log("Register.jsx: Registration data fields:",Object.keys(Ee).join(", ")),!B){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(ve!==_e){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}F(!0);try{const ke=await $5e(Ee.firstName||"",Ee.lastName||""),we=Ee.firstName&&Ee.lastName?`${Ee.firstName}${Ee.lastName.charAt(0).toUpperCase()}`:"";ee.log("Register.jsx: Generated username and nickname for new user");const be={...Ee,firstName:Ee.firstName||"",lastName:Ee.lastName||"",companyName:Ee.companyName||"",linkedInProfile:Ee.linkedInProfile||"",email:$e,password:ve,username:ke,Nickname:we,captchaToken:B};ee.log("Register.jsx: Prepared registration data with fields:",Object.keys(be).join(", ")),re(be),ie(!0)}catch(ke){ee.error("User: Registration Error:",ke);let we="An error occurred during registration. Please try again.",be=!1;ke.code==="auth/email-already-in-use"?(we="This email address is already registered. Please sign in instead.",be=!0):ke.code==="auth/invalid-email"?we="The email address is not valid. Please check and try again.":ke.code==="auth/weak-password"?we="The password is too weak. Please choose a stronger password.":ke.message&&(we=ke.message),b({title:"Registration Failed",description:R.jsxs(R.Fragment,{children:[we,be&&R.jsx(ct,{mt:2,children:R.jsx(Ll,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{F(!1),J.current&&J.current.reset()}},pe=async We=>{F(!0);try{ee.log("Register.jsx: Completing registration with confirmed username");const{email:$e,password:ve,..._e}=We,Ee={..._e,firstName:_e.firstName||"",lastName:_e.lastName||"",companyName:_e.companyName||"",linkedInProfile:_e.linkedInProfile||"",username:_e.username||"",Nickname:_e.Nickname||""};ee.log("Register.jsx: Final registration data includes fields:",Object.keys(Ee).join(", "));const ke=await v($e,ve,Ee);Q(),ie(!1),ee.log("User: Registration process complete."),re(null),q(!1)}catch($e){ee.error("User: Registration Error during final step:",$e);let ve="An error occurred during registration. Please try again.";$e.code==="auth/email-already-in-use"?ve="This email address is already in use. Please try another one.":$e.message&&(ve=$e.message),b({title:"Registration Failed",description:ve,status:"error",duration:5e3,isClosable:!0,position:"top"}),ie(!1),re(null),q(!1)}finally{F(!1)}},le=()=>{l?l():k(!I)},Le=n==="link"?R.jsx(Ll,{variant:"header",onClick:le,children:t}):R.jsx(Kr,{onClick:le,...s,children:t});return R.jsxs(R.Fragment,{children:[!a&&Le,R.jsxs(Mo,{isOpen:X&&!$,onClose:Q,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[R.jsx(Fo,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),R.jsxs(Uo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:We=>{We.stopPropagation()},children:[R.jsxs(Sc,{p:8,textAlign:"center",children:[R.jsx(AC,{size:"lg",mb:2,children:"Create Account"}),R.jsx(ct,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),R.jsx(_a,{color:"gray.400"}),R.jsx(Vo,{px:8,children:R.jsx("form",{onSubmit:f(me),children:R.jsxs(Di,{spacing:4,children:[R.jsxs(vi,{isInvalid:y.companyName,isRequired:!0,children:[R.jsx(os,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required",setValueAs:We=>We===""?"":We})}),R.jsx(Vh,{children:y.companyName&&y.companyName.message})]}),R.jsxs(Qi,{gap:4,w:"100%",children:[R.jsxs(vi,{isInvalid:y.firstName,isRequired:!0,children:[R.jsx(os,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required",setValueAs:We=>We===""?"":We})}),R.jsx(Vh,{children:y.firstName&&y.firstName.message})]}),R.jsxs(vi,{isInvalid:y.lastName,isRequired:!0,children:[R.jsx(os,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required",setValueAs:We=>We===""?"":We})}),R.jsx(Vh,{children:y.lastName&&y.lastName.message})]})]}),R.jsxs(vi,{isInvalid:y.email,isRequired:!0,children:[R.jsx(os,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),R.jsx(Vh,{children:y.email&&y.email.message})]}),R.jsxs(Qi,{gap:4,w:"100%",children:[R.jsxs(vi,{isInvalid:y.password,isRequired:!0,children:[R.jsx(os,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),R.jsx(Vh,{children:y.password&&y.password.message})]}),R.jsxs(vi,{isInvalid:y.confirmPassword,isRequired:!0,children:[R.jsx(os,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),R.jsx(Vh,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),R.jsx(vi,{children:R.jsx(os,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile",{setValueAs:We=>We===""?"":We})})}),R.jsx(wt,{width:"100%",display:"flex",justifyContent:"center",my:4,children:R.jsx(hoe,{ref:J,sitekey:R8e,onChange:se,theme:"dark"})})]})})}),R.jsxs(Mf,{px:8,pb:8,flexDirection:"column",gap:4,children:[R.jsx(Kr,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(me),isLoading:x,loadingText:"Processing",isDisabled:!B,children:"Next: Set Your Username"}),R.jsxs(ct,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",R.jsx(Ll,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),$&&R.jsx(poe,{isOpen:$,onClose:()=>ie(!1),userData:ue,onConfirm:pe,fullscreenRef:w,isRegistering:fe})]})}z4.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string,buttonProps:Tn.object,isOpen:Tn.bool,onClose:Tn.func};const I8e=kg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),A8e=kg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),P8e=kg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),O8e=kg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),eQ=kg({displayName:"EmailIcon",path:R.jsxs("g",{fill:"currentColor",children:[R.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),R.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),k8e=kg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),N8e=kg({displayName:"QuestionOutlineIcon",path:R.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[R.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),R.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),R.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),D8e=kg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),L8e="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function G4({mode:n="button",label:t="Sign In",buttonProps:s={},initialIsOpen:a=!1}){const{signIn:l}=D.useContext(ul),{fullscreenRef:d}=Md(),f=ll(),{register:y,handleSubmit:v,formState:{errors:b}}=doe({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[w,I]=D.useState(!1),[k,x]=D.useState(a),[F,B]=D.useState(!1),[z,J]=D.useState(!1),[$,ie]=D.useState(""),[ue,re]=D.useState(!1),[fe,q]=D.useState(null),X=D.useRef(null);l1(k||z),D.useEffect(()=>{const $e=()=>{x(!0)};return window.addEventListener("openSignInModal",$e),()=>{window.removeEventListener("openSignInModal",$e)}},[]);const Q=$e=>{q($e)},se=async $e=>{if(!fe){f({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}I(!0);try{await l($e.email,$e.password,fe),ee.log("User: Sign-in process complete."),x(!1),window.location.reload()}catch(ve){ee.error("User: SignIn Error:",ve);const _e=ve.message||"An error occurred while logging in. Please check your credentials.",Ee=_e.includes("verify your email");f({title:Ee?"Email Verification Required":"Error",description:_e,status:Ee?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}finally{I(!1),X.current&&X.current.reset()}},me=async()=>{if(!$){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{re(!0),await uFe(I4,$),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),J(!1)}catch($e){ee.error("User: Reset Password Error:",$e),f({title:"Error",description:$e.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{re(!1)}},pe=()=>x($e=>!$e),le=()=>{x(!1),B(!0)},Le=()=>{J(!0)},We=n==="link"?R.jsx(Ll,{variant:"header",onClick:pe,children:t}):R.jsx(Kr,{onClick:pe,...s,children:t});return R.jsxs(R.Fragment,{children:[We,R.jsxs(Mo,{isOpen:k,onClose:pe,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[R.jsx(Fo,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),R.jsx("form",{onSubmit:v(se),children:R.jsxs(Uo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:$e=>{$e.stopPropagation()},children:[R.jsxs(Sc,{p:8,textAlign:"center",children:[R.jsx(AC,{size:"lg",mb:2,children:"Welcome Back"}),R.jsx(ct,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),R.jsx(_a,{color:"gray.400"}),R.jsx(Vo,{px:8,pb:8,children:R.jsxs(Di,{spacing:4,children:[R.jsxs(vi,{isInvalid:b.email,children:[R.jsxs(wy,{children:[R.jsx(Qw,{pointerEvents:"none",children:R.jsx(eQ,{color:"gray.500"})}),R.jsx(os,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("email",{required:"Email is required."})})]}),R.jsx(Vh,{children:b.email&&b.email.message})]}),R.jsxs(vi,{isInvalid:b.password,children:[R.jsxs(wy,{children:[R.jsx(Qw,{pointerEvents:"none",children:R.jsx(P8e,{color:"gray.500"})}),R.jsx(os,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("password",{required:"Password is required."})})]}),R.jsx(Vh,{children:b.password&&b.password.message})]}),R.jsx(wt,{alignSelf:"flex-end",children:R.jsx(Ll,{color:"blue.400",fontSize:"sm",onClick:Le,children:"Forgot Password?"})}),R.jsx(Qi,{width:"100%",justifyContent:"center",my:4,children:R.jsx(hoe,{ref:X,sitekey:L8e,onChange:Q,theme:"dark"})})]})}),R.jsxs(Mf,{px:8,pb:8,flexDirection:"column",gap:4,children:[R.jsx(Kr,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",isDisabled:!fe,children:"Sign In"}),R.jsxs(ct,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",R.jsx(Ll,{color:"blue.400",onClick:le,children:"Sign Up"})]})]})]})})]}),R.jsxs(Mo,{isOpen:z,onClose:()=>J(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[R.jsx(Fo,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),R.jsxs(Uo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:$e=>{$e.stopPropagation()},children:[R.jsxs(Sc,{p:8,textAlign:"center",children:[R.jsx(AC,{size:"lg",mb:2,children:"Reset Password"}),R.jsx(ct,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),R.jsx(_a,{color:"gray.400"}),R.jsx(Vo,{px:8,pb:4,children:R.jsx(vi,{children:R.jsxs(wy,{children:[R.jsx(Qw,{pointerEvents:"none",children:R.jsx(eQ,{color:"gray.500"})}),R.jsx(os,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:$,onChange:$e=>ie($e.target.value)})]})})}),R.jsxs(Mf,{px:8,pb:8,flexDirection:"column",gap:4,children:[R.jsx(Kr,{colorScheme:"blue",size:"lg",width:"100%",onClick:me,isLoading:ue,loadingText:"Sending",children:"Send Reset Link"}),R.jsxs(ct,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",R.jsx(Ll,{color:"blue.400",onClick:()=>J(!1),children:"Back to Sign In"})]})]})]})]}),R.jsx(z4,{mode:"link",isOpen:F,onClose:()=>B(!1)})]})}G4.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string,buttonProps:Tn.object,initialIsOpen:Tn.bool};function x8e(){const{loadingProgression:n,isLoaded:t,error:s}=va(),{user:a}=D.useContext(ul),[l,d]=D.useState(!1),[f,y]=D.useState(!1),[v,b]=D.useState(!1),[w,I]=D.useState(!1),k=D.useRef(!1),x=D.useRef(!1),F=D.useRef(null),B=D.useRef(null),z=D.useRef(null),J=dp(),$=D.useRef(null),ie=D.useRef(null),ue=D.useRef(null);D.useRef(null),D.useEffect(()=>{d(!a&&n===0)},[a,n]),D.useEffect(()=>{const q=document.createElement("style");return q.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(q),$.current=q,()=>{$.current&&document.head.removeChild($.current)}},[]),D.useEffect(()=>{const q=()=>{const X=document.getElementById("unity-canvas"),Q=document.getElementById("unity-container");X&&(F.current=X,X.style.zIndex="1"),Q&&(B.current=Q,Q.style.zIndex="1"),X&&Q&&ue.current&&(clearInterval(ue.current),ue.current=null)};return q(),ue.current=setInterval(q,100),()=>{ue.current&&(clearInterval(ue.current),ue.current=null)}},[]),D.useEffect(()=>{window.isFirstSceneLoaded&&(x.current=!0,I(!0));const X=J("FirstSceneLoaded",()=>{x.current=!0,I(!0),window.isFirstSceneLoaded=!0}),Q=setTimeout(()=>{x.current||(x.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{X(),clearTimeout(Q)}},[J]),D.useEffect(()=>{window.isPlayerInstantiated&&(k.current=!0,b(!0),x.current||(x.current=!0,I(!0),window.isFirstSceneLoaded=!0));const q=()=>{k.current=!0,b(!0),x.current||(x.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",q);const X=J("PlayerInstantiated",q),Q=setTimeout(()=>{k.current||(k.current=!0,b(!0),x.current||(x.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",q),X(),clearTimeout(Q)}},[J]),D.useEffect(()=>(w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ie.current&&clearTimeout(ie.current),ie.current=setTimeout(()=>{F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),z.current&&(z.current.style.opacity="0",z.current.style.pointerEvents="none",setTimeout(()=>{z.current&&(z.current.style.display="none")},1500))},2e3)),()=>{ie.current&&clearTimeout(ie.current)}),[w,v]);const re=()=>t?t&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",fe=()=>t?t&&!w&&!v?85:w&&!v?95:100:n*80;return R.jsx(R.Fragment,{children:l?R.jsx(wt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:R.jsxs(Di,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[R.jsx(ct,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),R.jsx(ct,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),R.jsx(Kr,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>y(!0),children:"Sign In"})]})}):R.jsx(wt,{ref:z,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:R.jsxs(Qi,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[R.jsx(ct,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),R.jsx(ct,{fontSize:"sm",children:re()}),R.jsx(g0,{value:fe(),size:"lg",width:"100%",marginY:2})]})})})}function foe({mode:n="button",label:t="Sign Out"}){const s=ll(),{signOut:a}=D.useContext(ul),{fullscreenRef:l}=Md(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?R.jsx(Ll,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return R.jsx(R.Fragment,{children:f})}foe.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string};function M8e(){const{user:n}=D.useContext(ul);return R.jsx("div",{children:n!==null?R.jsx("div",{children:R.jsx(foe,{})}):R.jsxs("div",{children:[R.jsx(z4,{}),R.jsx(G4,{})]})})}function U8e(){const{fullscreenRef:n}=Md(),[t,s]=D.useState(!1),a=()=>{s(!t)};return R.jsxs(R.Fragment,{children:[R.jsx(Af,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:R.jsx(xo,{"aria-label":"Controller Help",icon:R.jsx(N8e,{}),onClick:a,variant:"iconButton"})}),R.jsxs(Mo,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:n},children:[R.jsx(Fo,{}),R.jsxs(Uo,{children:[R.jsx(Sc,{children:"Notes"}),R.jsx(_a,{}),R.jsx(Vo,{children:R.jsx(ct,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),R.jsx(Mf,{children:R.jsx(Kr,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var moe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},tQ=ui.createContext&&ui.createContext(moe),yg=function(){return yg=Object.assign||function(n){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])}return n},yg.apply(this,arguments)},V8e=function(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s};function goe(n){return n&&n.map(function(t,s){return ui.createElement(t.tag,yg({key:s},t.attr),goe(t.child))})}function Ar(n){return function(t){return ui.createElement(F8e,yg({attr:yg({},n.attr)},t),goe(n.child))}}function F8e(n){var t=function(s){var a=n.attr,l=n.size,d=n.title,f=V8e(n,["attr","size","title"]),y=l||s.size||"1em",v;return s.className&&(v=s.className),n.className&&(v=(v?v+" ":"")+n.className),ui.createElement("svg",yg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,f,{className:v,style:yg(yg({color:n.color||s.color},s.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),d&&ui.createElement("title",null,d),n.children)};return tQ!==void 0?ui.createElement(tQ.Consumer,null,function(s){return t(s)}):t(moe)}function _oe(n){return Ar({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function j8e(n){return Ar({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function nQ(n){return Ar({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function rQ(n){return Ar({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function HV(n){return Ar({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function B8e(n){return Ar({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function W8e(n){return Ar({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function z8e(n){return Ar({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function yoe(n){return Ar({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function G8e(n){return Ar({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function H8e(n){return Ar({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function $V(n){return Ar({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function KV(n){return Ar({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function $8e(n){return Ar({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function K8e(n){return Ar({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function q8e(n){return Ar({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function qV(n){return Ar({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function Y8e(n){return Ar({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function X8e(n){return Ar({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function J8e(n){return Ar({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function Q8e(n){return Ar({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function Z8e(n){return Ar({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function Eoe({open:n,onClose:t}){const s=D.useRef(null),a=up(),{user:l}=D.useContext(ul),d=v=>{s.current&&!s.current.contains(v.target)&&t()},f=async v=>{const b=y(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const w=b.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await Pse(l.uid,w),t()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},y=v=>{try{return JSON.parse(v.data)}catch{return null}};return D.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[n]),n&&R.jsx(Mu,{children:R.jsx(wt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:R.jsx(wt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:R.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function eWe({isOpen:n,onClose:t}){const[s,a]=D.useState(!1),[l,d]=D.useState(null),{user:f}=D.useContext(ul),y=up(),v=F=>{F.stopPropagation(),a(!0)},b=()=>{a(!1),t()},w=async F=>{if(d(F),f&&f.uid)try{await Pse(f.uid,F.url),y("AvatarUrlFromReact",{url:F.url}),t()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},I=tIe("gray.200","whiteAlpha.300"),k="rgba(0, 0, 0, 0.3)",x=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return R.jsxs(R.Fragment,{children:[R.jsx(Mu,{children:R.jsxs(Mo,{isOpen:n,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[R.jsx(Fo,{bg:"rgba(0, 0, 0, 0.7)"}),R.jsxs(Uo,{bg:"gray.800",color:"white",maxW:"900px",children:[R.jsx(Sc,{fontSize:"lg",children:"Customise Your Avatar"}),R.jsx(_a,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),R.jsx(Vo,{pb:4,children:R.jsxs(Di,{spacing:4,align:"stretch",children:[R.jsx(ct,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),R.jsxs(ene,{columns:5,spacing:2,children:[R.jsx(wt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:k},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:R.jsxs(Di,{spacing:1,children:[R.jsx(In,{as:K8e,boxSize:4}),R.jsx(ct,{fontSize:"xs",children:"Create Custom Avatar"})]})}),x.map(F=>R.jsxs(wt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===F.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>w(F),_hover:{bg:k},transition:"all 0.2s",aspectRatio:"1",children:[R.jsx(zh,{src:F.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:F.name,width:"100%",height:"100%",objectFit:"cover"}),R.jsx(wt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:R.jsx(ct,{fontSize:"xs",children:F.name})})]},F.id))]})]})})]})]})}),s&&R.jsx(Eoe,{open:s,onClose:b})]})}function tWe(){const{fullscreenRef:n}=Md(),[t,s]=D.useState(!1),[a,l]=D.useState(!1),[d,f]=D.useState(!1),[y,v]=D.useState(!1),{user:b}=D.useContext(ul),[w,I]=D.useState(null),[k,x]=D.useState(!0),F=($,ie)=>!$||!ie?"?":`${$.charAt(0)}${ie.charAt(0)}`.toUpperCase(),B=async()=>{if(b!=null&&b.uid){x(!0);try{const $=await Lu(b.uid);I({rpmURL:$.rpmURL?$.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:$.firstName,lastName:$.lastName})}catch($){console.error("Error fetching profile data:",$)}finally{x(!1)}}};D.useEffect(()=>{B()},[b==null?void 0:b.uid]),D.useEffect(()=>{const $=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",$),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const z=()=>l(!a),J=()=>{l(!1),B()};return t?R.jsxs(R.Fragment,{children:[R.jsx(Af,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:R.jsxs(wt,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:"pointer",onClick:z,children:[R.jsx(ip,{src:k||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:k?F(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&R.jsx(wt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:R.jsx(ct,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),R.jsx(eWe,{isOpen:a,onClose:J})]}):null}function nWe(n){return Ar({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function rWe(n){return Ar({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function iWe(){const{isFullscreen:n,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=Md(),l=ll();D.useEffect(()=>{const f=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return R.jsx(Af,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:R.jsx(xo,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?R.jsx(nWe,{}):R.jsx(rWe,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const iQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function sWe(){const{isOpen:n,onOpen:t,onClose:s}=kf(),{fullscreenRef:a}=Md(),[l,d]=j6e(!1);D.useEffect(()=>{ee.log("VideoPlayer: Current video URL:",l),l&&(ee.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const f=()=>{ee.log("VideoPlayer: Closing modal"),d(),s()};return R.jsx(Mu,{containerRef:a,children:R.jsxs(Mo,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[R.jsx(Fo,{bg:"rgba(0, 0, 0, 0.8)"}),R.jsxs(Uo,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[R.jsx(_a,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),R.jsx(Vo,{p:0,width:"100%",children:l&&R.jsx(wt,{style:iQ.iframeContainer,children:R.jsx("iframe",{src:l,style:iQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function oWe({isOpen:n,onClose:t,playerName:s,playerId:a,uid:l}){const[d,f]=D.useState(null),[y,v]=D.useState(!0),[b,w]=D.useState(null);return D.useEffect(()=>{n&&(async()=>{if(v(!0),w(null),!l){ee.warn("NameplateModal: No UID provided for player:",s),w("No user ID available for this player"),v(!1);return}try{ee.log("NameplateModal: Fetching profile for UID:",l);const k=await Lu(l);k?f({firstName:k.firstName,lastName:k.lastName,linkedinUrl:k.linkedinUrl,websiteUrl:k.websiteUrl,rpmURL:k.rpmURL?k.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(k){ee.error("Error fetching profile data:",k),w("Error loading profile data")}finally{v(!1)}})()},[l,n,s]),R.jsxs(Mo,{isOpen:n,onClose:t,isCentered:!0,size:"md",children:[R.jsx(Fo,{backdropFilter:"blur(10px)"}),R.jsxs(Uo,{bg:"gray.900",color:"white",borderRadius:"xl",children:[R.jsx(Sc,{children:"Player Info"}),R.jsx(_a,{}),R.jsx(Vo,{pb:6,children:y?R.jsx(yte,{py:8,children:R.jsx(ap,{size:"xl",color:"blue.400"})}):b?R.jsxs(_f,{status:"warning",variant:"solid",borderRadius:"md",children:[R.jsx(yf,{}),b]}):R.jsxs(Di,{spacing:4,align:"center",children:[R.jsx(ip,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),R.jsxs(Di,{spacing:1,children:[R.jsx(ct,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&R.jsxs(ct,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),R.jsxs(ct,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&R.jsxs(R.Fragment,{children:[R.jsx(hg,{borderColor:"whiteAlpha.300"}),R.jsxs(Ei,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&R.jsx(Ll,{href:d.linkedinUrl,isExternal:!0,children:R.jsx(xo,{icon:R.jsx(_oe,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&R.jsx(Ll,{href:d.websiteUrl,isExternal:!0,children:R.jsx(xo,{icon:R.jsx(yoe,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const aWe=({isVisible:n,onToggleVisibility:t,spaceID:s})=>{const[a]=VDe("(max-width: 768px)"),[l,d]=D.useState(!1);D.useEffect(()=>{(()=>{const _e=navigator.userAgent||navigator.vendor||window.opera,ke=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(_e);d(ke),ke&&ee.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,y=toe(),[v,b]=D.useState(!1),[w,I]=D.useState([]),[k,x]=D.useState(!1),[F,B]=D.useState({}),[z,J]=D.useState({}),[$,ie]=D.useState(null),[ue,re]=D.useState(!1),fe=ll(),q=window.currentUser||{},Q=(()=>{if(s)return s;if(window.spaceID)return window.spaceID;const _e=(window.location.pathname||"").split("/"),Ee=_e[_e.length-1];if(Ee&&Ee.length>5)return Ee;const ke=document.body.getAttribute("data-space-id");if(ke)return ke;const we=localStorage.getItem("currentSpaceId");return we||"fallback-space-id"})();D.useEffect(()=>{(async()=>{try{const Ee=await _g(Q);Ee&&Ee.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),re(!0)):re(!1)}catch(Ee){console.error("UnityPlayerList: Error checking if voice is disabled:",Ee)}})();const _e=Ee=>{Ee.detail&&typeof Ee.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",Ee.detail.voiceDisabled),re(Ee.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",_e),()=>{window.removeEventListener("SpaceVoiceSettingChanged",_e)}},[Q]),D.useEffect(()=>{const ve={};y.forEach(_e=>{if(_e.uid){if(_e.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)ve[_e.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const Ee=window.agoraClient.client.remoteUsers,ke=Ee.find(we=>String(we.uid)===String(_e.uid));if(ke)ve[_e.uid]=ke.uid;else{const we=Ee.find(be=>typeof be.uid=="string"&&be.uid.includes(_e.uid));if(we)ve[_e.uid]=we.uid;else{const be=Ee.find(Ie=>typeof _e.uid=="string"&&_e.uid.includes(String(Ie.uid)));if(be)ve[_e.uid]=be.uid;else{const Ie=Ee.filter(Me=>!(typeof Me.uid=="string"&&Me.uid.startsWith("screen-")));Ie.length===1&&!_e.isLocalPlayer&&(ve[_e.uid]=Ie[0].uid)}}}}}}),J(ve)},[y]);const se=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const ve=window.agoraClient.isVoiceEnabled;ve!==k&&x(ve)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,_e={};ve.forEach(Ee=>{typeof Ee.uid=="string"&&Ee.uid.startsWith("screen-")||(_e[Ee.uid]=!!Ee.audioTrack&&!Ee.audioTrack.muted)}),JSON.stringify(_e)!==JSON.stringify(F)&&B(_e)}};D.useEffect(()=>{const ve=setInterval(se,500),_e=Ee=>{Ee.detail&&typeof Ee.detail.enabled=="boolean"&&x(Ee.detail.enabled)};return window.addEventListener("VoiceToggled",_e),se(),()=>{clearInterval(ve),window.removeEventListener("VoiceToggled",_e)}},[]),D.useEffect(()=>{const ve=()=>{ee.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",ve),window.isPlayerInstantiated&&(ee.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",ve)}},[]),D.useEffect(()=>{(async()=>{const _e=await Promise.all(y.map(async Ee=>{if(Ee.uid)try{const ke=await Lu(Ee.uid);let we=null;if(ke.groups){const be=`space_${Q}_owners`,Ie=`space_${Q}_hosts`;ke.groups.includes(be)?we="owner":ke.groups.includes(Ie)&&(we="host")}return le({uid:Ee.uid})&&ie(we),{...Ee,firstName:ke.firstName,lastName:ke.lastName,linkedInProfile:ke.linkedInProfile,websiteUrl:ke.websiteUrl,rpmURL:ke.rpmURL?ke.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:we}}catch(ke){return ee.error(`Error fetching data for player ${Ee.playerName}:`,ke),Ee}return Ee}));I(_e)})()},[y,Q]);const me=[...w].sort((ve,_e)=>ve.isLocalPlayer?-1:_e.isLocalPlayer?1:0),pe=()=>{ee.log("UnityPlayerList: Toggling visibility"),t&&t()},le=ve=>!!(ve.isLocalPlayer||q&&q.uid&&ve.uid===q.uid),Le=ve=>{try{if(le(ve))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:k;if(ve.uid){if(F[ve.uid])return!0;const _e=z[ve.uid];if(_e&&F[_e])return!0;const Ee=parseInt(ve.uid);if(!isNaN(Ee)&&F[Ee])return!0}return!1}catch(_e){return console.error("Error in hasActiveMic:",_e),!1}},We=({player:ve})=>{const _e=ve.role;return _e==="owner"?R.jsxs(Ei,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[R.jsx(In,{as:HV,color:"green.400",boxSize:5}),R.jsx(Ef,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):_e==="host"?R.jsxs(Ei,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[R.jsx(In,{as:qV,color:"purple.400",boxSize:5}),R.jsx(Ef,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},$e=(ve,_e)=>{switch(console.log(`Action "${ve}" performed on player: ${_e.playerName}`),ve){case"mute":fe({title:"Player Muted",description:`${_e.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":fe({title:"Player Kicked",description:`${_e.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":fe({title:"Player Promoted",description:`${_e.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return R.jsxs(wt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!f?"visible":"hidden",role:"group",children:[R.jsx(wt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:R.jsx(xo,{icon:R.jsx(k8e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:pe,_hover:{opacity:.8}})}),R.jsxs(ct,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),R.jsx(wt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:R.jsx(Di,{align:"stretch",spacing:1,width:"100%",children:me.map((ve,_e)=>{const Ee=le(ve),ke=!ue&&Le(ve);return R.jsx(wt,{children:R.jsxs(One,{placement:"left",trigger:"hover",children:[R.jsx(xne,{children:R.jsxs(Ei,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[R.jsx(ip,{size:"xs",src:ve.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),R.jsx(ct,{fontSize:"xs",children:ve.playerName}),ve.role==="owner"&&R.jsx(In,{as:HV,color:"green.400",boxSize:2.5}),ve.role==="host"&&R.jsx(In,{as:qV,color:"purple.400",boxSize:2.5}),R.jsx(Pk,{}),$==="owner"&&R.jsxs(SN,{closeOnSelect:!0,placement:"bottom-end",children:[R.jsx(bN,{as:xo,"aria-label":"Options",icon:R.jsx(W8e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:we=>we.stopPropagation()}),R.jsxs(TN,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[R.jsx(JS,{icon:R.jsx(Q8e,{}),onClick:()=>$e("mute",ve),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:ue,children:"Mute Player"}),R.jsx(JS,{icon:R.jsx(Y8e,{}),onClick:()=>$e("promote",ve),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),R.jsx(mne,{borderColor:"whiteAlpha.300"}),R.jsx(JS,{icon:R.jsx(j8e,{}),onClick:()=>$e("kick",ve),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!ue&&(ke?R.jsx(wt,{color:"green.400",children:R.jsx(KV,{})}):R.jsx(wt,{color:"red.400",children:R.jsx($V,{})})),Ee&&R.jsx(ct,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),R.jsx(Lne,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:R.jsx(Nne,{children:R.jsxs(Di,{align:"center",spacing:3,children:[R.jsx(ip,{size:"xl",src:ve.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),R.jsx(ct,{fontSize:"xl",fontWeight:"bold",children:ve.playerName}),R.jsx(We,{player:ve}),ve.firstName&&R.jsxs(ct,{fontSize:"sm",color:"gray.300",children:[ve.firstName," ",ve.lastName]}),R.jsxs(Ei,{spacing:4,pt:2,children:[ve.linkedInProfile&&R.jsx(Ll,{href:ve.linkedInProfile,isExternal:!0,children:R.jsx(xo,{icon:R.jsx(_oe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),ve.websiteUrl&&R.jsx(Ll,{href:ve.websiteUrl,isExternal:!0,children:R.jsx(xo,{icon:R.jsx(yoe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!ue&&R.jsx(xo,{icon:ke?R.jsx(KV,{}):R.jsx($V,{}),variant:"ghost",colorScheme:ke?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),ue&&R.jsx(xo,{icon:R.jsx(J8e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},_e)})})})]})};var pk={exports:{}},cWe=pk.exports,sQ;function lWe(){return sQ||(sQ=1,function(n,t){(function(s,a){n.exports=a()})(cWe,function(){function s(e,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof dy<"u"?dy:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=f,v=Function.prototype,b=v.call,w=y&&v.bind.bind(b,b),I=y?w:function(e){return function(){return b.apply(e,arguments)}},k=I({}.isPrototypeOf),x=function(e){return e&&e.Math==Math&&e},F=x(typeof globalThis=="object"&&globalThis)||x(typeof window=="object"&&window)||x(typeof self=="object"&&self)||x(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),B=f,z=Function.prototype,J=z.apply,$=z.call,ie=typeof Reflect=="object"&&Reflect.apply||(B?$.bind(J):function(){return $.apply(J,arguments)}),ue=I,re=ue({}.toString),fe=ue("".slice),q=function(e){return fe(re(e),8,-1)},X=q,Q=I,se=function(e){if(X(e)==="Function")return Q(e)},me=typeof document=="object"&&document.all,pe={all:me,IS_HTMLDDA:me===void 0&&me!==void 0},le=pe.all,Le=pe.IS_HTMLDDA?function(e){return typeof e=="function"||e===le}:function(e){return typeof e=="function"},We={},$e=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),ve=f,_e=Function.prototype.call,Ee=ve?_e.bind(_e):function(){return _e.apply(_e,arguments)},ke={},we={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,Ie=be&&!we.call({1:2},1);ke.f=Ie?function(e){var r=be(this,e);return!!r&&r.enumerable}:we;var Me,ze,Je=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},tt=d,ut=q,Ze=Object,vt=I("".split),sn=tt(function(){return!Ze("z").propertyIsEnumerable(0)})?function(e){return ut(e)=="String"?vt(e,""):Ze(e)}:Ze,Mt=function(e){return e==null},Qt=Mt,on=TypeError,Ht=function(e){if(Qt(e))throw on("Can't call method on "+e);return e},jn=sn,Wt=Ht,Re=function(e){return jn(Wt(e))},Fe=Le,Ge=pe.all,ot=pe.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Fe(e)||e===Ge}:function(e){return typeof e=="object"?e!==null:Fe(e)},_t={},yt=_t,Gt=F,mn=Le,Pn=function(e){return mn(e)?e:void 0},un=function(e,r){return arguments.length<2?Pn(yt[e])||Pn(Gt[e]):yt[e]&&yt[e][r]||Gt[e]&&Gt[e][r]},bt=typeof navigator<"u"&&String(navigator.userAgent)||"",lr=F,Nt=bt,Kt=lr.process,qr=lr.Deno,ji=Kt&&Kt.versions||qr&&qr.version,Ms=ji&&ji.v8;Ms&&(ze=(Me=Ms.split("."))[0]>0&&Me[0]<4?1:+(Me[0]+Me[1])),!ze&&Nt&&(!(Me=Nt.match(/Edge\/(\d+)/))||Me[1]>=74)&&(Me=Nt.match(/Chrome\/(\d+)/))&&(ze=+Me[1]);var ii=ze,Ot=ii,On=d,or=F.String,xi=!!Object.getOwnPropertySymbols&&!On(function(){var e=Symbol();return!or(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ot&&Ot<41}),bc=xi&&!Symbol.sham&&typeof Symbol.iterator=="symbol",cs=un,Sa=Le,vo=k,ba=Object,Ta=bc?function(e){return typeof e=="symbol"}:function(e){var r=cs("Symbol");return Sa(r)&&vo(r.prototype,ba(e))},ro=String,_s=function(e){try{return ro(e)}catch{return"Object"}},ls=Le,jo=_s,Bi=TypeError,ys=function(e){if(ls(e))return e;throw Bi(jo(e)+" is not a function")},Za=ys,Uu=Mt,Tc=function(e,r){var i=e[r];return Uu(i)?void 0:Za(i)},wa=Ee,Ca=Le,Ud=ot,Mg=TypeError,Vu={exports:{}},hp=F,qs=Object.defineProperty,Fu=function(e,r){try{qs(hp,e,{value:r,configurable:!0,writable:!0})}catch{hp[e]=r}return r},Ra="__core-js_shared__",Vd=F[Ra]||Fu(Ra,{}),Fd=Vd;(Vu.exports=function(e,r){return Fd[e]||(Fd[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var ec=Vu.exports,jd=Ht,ju=Object,Bo=function(e){return ju(jd(e))},Bd=Bo,zr=I({}.hasOwnProperty),Si=Object.hasOwn||function(e,r){return zr(Bd(e),r)},wc=I,dl=0,Ia=Math.random(),pp=wc(1 .toString),Wd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+pp(++dl+Ia,36)},Wl=ec,So=Si,Hf=Wd,io=xi,fp=bc,hl=F.Symbol,zd=Wl("wks"),Gd=fp?hl.for||hl:hl&&hl.withoutSetter||Hf,gr=function(e){return So(zd,e)||(zd[e]=io&&So(hl,e)?hl[e]:Gd("Symbol."+e)),zd[e]},zl=Ee,Gl=ot,Bu=Ta,tc=Tc,Wo=function(e,r){var i,o;if(Ca(i=e.toString)&&!Ud(o=wa(i,e))||Ca(i=e.valueOf)&&!Ud(o=wa(i,e)))return o;throw Mg("Can't convert object to primitive value")},Wu=TypeError,pl=gr("toPrimitive"),Hl=function(e,r){if(!Gl(e)||Bu(e))return e;var i,o=tc(e,pl);if(o){if(i=zl(o,e,r),!Gl(i)||Bu(i))return i;throw Wu("Can't convert object to primitive value")}return Wo(e)},Yr=Ta,nc=function(e){var r=Hl(e,"string");return Yr(r)?r:r+""},ar=ot,Cc=F.document,$f=ar(Cc)&&ar(Cc.createElement),$l=function(e){return $f?Cc.createElement(e):{}},Hd=$l,mp=!$e&&!d(function(){return Object.defineProperty(Hd("div"),"a",{get:function(){return 7}}).a!=7}),Kf=$e,gp=Ee,zo=ke,us=Je,Go=Re,Ho=nc,Kl=Si,$o=mp,Ko=Object.getOwnPropertyDescriptor;We.f=Kf?Ko:function(e,r){if(e=Go(e),r=Ho(r),$o)try{return Ko(e,r)}catch{}if(Kl(e,r))return us(!gp(zo.f,e,r),e[r])};var qf=d,Rc=Le,Es=/#|\.prototype\./,zu=function(e,r){var i=fl[_p(e)];return i==Yf||i!=ql&&(Rc(r)?qf(r):!!r)},_p=zu.normalize=function(e){return String(e).replace(Es,".").toLowerCase()},fl=zu.data={},ql=zu.NATIVE="N",Yf=zu.POLYFILL="P",Aa=zu,Pa=ys,ml=f,Ce=se(se.bind),De=function(e,r){return Pa(e),r===void 0?e:ml?Ce(e,r):function(){return e.apply(r,arguments)}},nt={},Jt=$e&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Jn=ot,Sr=String,Gr=TypeError,hn=function(e){if(Jn(e))return e;throw Gr(Sr(e)+" is not an object")},Ur=$e,bi=mp,Us=Jt,qo=hn,Yo=nc,Gu=TypeError,es=Object.defineProperty,gl=Object.getOwnPropertyDescriptor,$d="enumerable",Ic="configurable",Ug="writable";nt.f=Ur?Us?function(e,r,i){if(qo(e),r=Yo(r),qo(i),typeof e=="function"&&r==="prototype"&&"value"in i&&Ug in i&&!i[Ug]){var o=gl(e,r);o&&o[Ug]&&(e[r]=i.value,i={configurable:Ic in i?i[Ic]:o[Ic],enumerable:$d in i?i[$d]:o[$d],writable:!1})}return es(e,r,i)}:es:function(e,r,i){if(qo(e),r=Yo(r),qo(i),bi)try{return es(e,r,i)}catch{}if("get"in i||"set"in i)throw Gu("Accessors not supported");return"value"in i&&(e[r]=i.value),e};var Xf=nt,Hu=Je,Xo=$e?function(e,r,i){return Xf.f(e,r,Hu(1,i))}:function(e,r,i){return e[r]=i,e},Yl=F,Jf=ie,Vg=se,Xy=Le,Qf=We.f,Zf=Aa,$u=_t,Ku=De,qu=Xo,Fg=Si,Jy=function(e){var r=function(i,o,c){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return Jf(e,this,arguments)};return r.prototype=e.prototype,r},Wn=function(e,r){var i,o,c,u,h,m,_,E,S,C=e.target,P=e.global,N=e.stat,G=e.proto,V=P?Yl:N?Yl[C]:(Yl[C]||{}).prototype,j=P?$u:$u[C]||qu($u,C,{})[C],Y=j.prototype;for(u in r)o=!(i=Zf(P?u:C+(N?".":"#")+u,e.forced))&&V&&Fg(V,u),m=j[u],o&&(_=e.dontCallGetSet?(S=Qf(V,u))&&S.value:V[u]),h=o&&_?_:r[u],o&&typeof m==typeof h||(E=e.bind&&o?Ku(h,Yl):e.wrap&&o?Jy(h):G&&Xy(h)?Vg(h):h,(e.sham||h&&h.sham||m&&m.sham)&&qu(E,"sham",!0),qu(j,u,E),G&&(Fg($u,c=C+"Prototype")||qu($u,c,{}),qu($u[c],u,h),e.real&&Y&&(i||!Y[u])&&qu(Y,u,h)))},em=Math.ceil,Jo=Math.floor,Qy=Math.trunc||function(e){var r=+e;return(r>0?Jo:em)(r)},Zy=Qy,Ac=function(e){var r=+e;return r!=r||r===0?0:Zy(r)},A=Ac,W=Math.max,ne=Math.min,ge=function(e,r){var i=A(e);return i<0?W(i+r,0):ne(i,r)},qe=Ac,at=Math.min,Vt=function(e){return e>0?at(qe(e),9007199254740991):0},Xr=Vt,hi=function(e){return Xr(e.length)},br=Re,Ys=ge,vs=hi,rc=function(e){return function(r,i,o){var c,u=br(r),h=vs(u),m=Ys(o,h);if(e&&i!=i){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===i)return e||m||0;return!e&&-1}},Qo={includes:rc(!0),indexOf:rc(!1)},yp=Qo.includes;Wn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return yp(this,e,arguments.length>1?arguments[1]:void 0)}});var tm=_t,ic=function(e){return tm[e+"Prototype"]},hR=ic("Array").includes,pR=ot,nm=q,u1=gr("match"),fR=function(e){var r;return pR(e)&&((r=e[u1])!==void 0?!!r:nm(e)=="RegExp")},d1=fR,mR=TypeError,W0={};W0[gr("toStringTag")]="z";var Ep=String(W0)==="[object z]",jg=Ep,h1=Le,vp=q,p1=gr("toStringTag"),gR=Object,z0=vp(function(){return arguments}())=="Arguments",Pc=jg?vp:function(e){var r,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(r=gR(e),p1))=="string"?i:z0?vp(r):(o=vp(r))=="Object"&&h1(r.callee)?"Arguments":o},_R=Pc,yR=String,Oa=function(e){if(_R(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return yR(e)},f1=gr("match"),m1=Wn,g1=function(e){if(d1(e))throw mR("The method doesn't accept regular expressions");return e},_1=Ht,ER=Oa,_l=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[f1]=!1,"/./"[e](r)}catch{}}return!1},Bg=I("".indexOf);m1({target:"String",proto:!0,forced:!_l("includes")},{includes:function(e){return!!~Bg(ER(_1(this)),ER(g1(e)),arguments.length>1?arguments[1]:void 0)}});var vR=ic("String").includes,G0=k,SR=hR,bR=vR,Wg=Array.prototype,H0=String.prototype,y1=function(e){var r=e.includes;return e===Wg||G0(Wg,e)&&r===Wg.includes?SR:typeof e=="string"||e===H0||G0(H0,e)&&r===H0.includes?bR:r},st=l(y1),$0=ys,zg=Bo,K0=sn,TR=hi,eE=TypeError,rm=function(e){return function(r,i,o,c){$0(i);var u=zg(r),h=K0(u),m=TR(u),_=e?m-1:0,E=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=E;break}if(_+=E,e?_<0:m<=_)throw eE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=E)_ in h&&(c=i(c,h[_],_,u));return c}},q0={left:rm(!1)},wR=d,Sp=function(e,r){var i=[][e];return!!i&&wR(function(){i.call(null,r||function(){return 1},1)})},bp=typeof process<"u"&&q(process)=="process",CR=q0.left;Wn({target:"Array",proto:!0,forced:!bp&&ii>79&&ii<83||!Sp("reduce")},{reduce:function(e){var r=arguments.length;return CR(this,e,r,r>1?arguments[1]:void 0)}});var RR=ic("Array").reduce,IR=k,AR=RR,tE=Array.prototype,Kd=function(e){var r=e.reduce;return e===tE||IR(tE,e)&&r===tE.reduce?AR:r},nE=Kd,sc=l(nE),E1=q,Gg=Array.isArray||function(e){return E1(e)=="Array"},Hg=Wn,v1=Gg,PR=I([].reverse),Y0=[1,2];Hg({target:"Array",proto:!0,forced:String(Y0)===String(Y0.reverse())},{reverse:function(){return v1(this)&&(this.length=this.length),PR(this)}});var Pi=ic("Array").reverse,X0=k,rE=Pi,Tp=Array.prototype,OR=function(e){var r=e.reverse;return e===Tp||X0(Tp,e)&&r===Tp.reverse?rE:r},iE=OR,im=l(iE),sE=Wd,wp=ec("keys"),$g=function(e){return wp[e]||(wp[e]=sE(e))},S1=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),b1=Si,kR=Le,oE=Bo,aE=S1,cE=$g("IE_PROTO"),Kg=Object,J0=Kg.prototype,qg=aE?Kg.getPrototypeOf:function(e){var r=oE(e);if(b1(r,cE))return r[cE];var i=r.constructor;return kR(i)&&r instanceof i?i.prototype:r instanceof Kg?J0:null},T1=I,NR=ys,w1=Le,C1=String,Q0=TypeError,qd=function(e,r,i){try{return T1(NR(Object.getOwnPropertyDescriptor(e,r)[i]))}catch{}},DR=hn,sm=function(e){if(typeof e=="object"||w1(e))return e;throw Q0("Can't set "+C1(e)+" as a prototype")},Xl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,i={};try{(e=qd(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(o,c){return DR(o),sm(c),r?e(o,c):o.__proto__=c,o}}():void 0),Yd={},Oc={},Yg=Si,R1=Re,I1=Qo.indexOf,Cp=Oc,om=I([].push),Rp=function(e,r){var i,o=R1(e),c=0,u=[];for(i in o)!Yg(Cp,i)&&Yg(o,i)&&om(u,i);for(;r.length>c;)Yg(o,i=r[c++])&&(~I1(u,i)||om(u,i));return u},am=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Z0=Rp,cm=am.concat("length","prototype");Yd.f=Object.getOwnPropertyNames||function(e){return Z0(e,cm)};var kc={};kc.f=Object.getOwnPropertySymbols;var Oi=un,Ti=Yd,Xd=kc,bo=hn,ka=I([].concat),Ip=Oi("Reflect","ownKeys")||function(e){var r=Ti.f(bo(e)),i=Xd.f;return i?ka(r,i(e)):r},Ap=Si,Na=Ip,lE=We,LR=nt,uE={},dE=Rp,xR=am,Nc=Object.keys||function(e){return dE(e,xR)},hE=$e,eb=Jt,MR=nt,A1=hn,Jd=Re,lm=Nc;uE.f=hE&&!eb?Object.defineProperties:function(e,r){A1(e);for(var i,o=Jd(r),c=lm(r),u=c.length,h=0;u>h;)MR.f(e,i=c[h++],o[i]);return e};var Yu,Xg=un("document","documentElement"),pE=hn,Dc=uE,oc=am,Pp=Oc,Xu=Xg,Ju=$l,Qu="prototype",fE="script",mE=$g("IE_PROTO"),Jg=function(){},Da=function(e){return"<"+fE+">"+e+"</"+fE+">"},La=function(e){e.write(Da("")),e.close();var r=e.parentWindow.Object;return e=null,r},pi=function(){try{Yu=new ActiveXObject("htmlfile")}catch{}var e,r,i;pi=typeof document<"u"?document.domain&&Yu?La(Yu):(r=Ju("iframe"),i="java"+fE+":",r.style.display="none",Xu.appendChild(r),r.src=String(i),(e=r.contentWindow.document).open(),e.write(Da("document.F=Object")),e.close(),e.F):La(Yu);for(var o=oc.length;o--;)delete pi[Qu][oc[o]];return pi()};Pp[mE]=!0;var Zo=Object.create||function(e,r){var i;return e!==null?(Jg[Qu]=pE(e),i=new Jg,Jg[Qu]=null,i[mE]=e):i=pi(),r===void 0?i:Dc.f(i,r)},UR=ot,VR=Xo,gE=Error,tb=I("".replace),FR=String(gE("zxcasd").stack),Qg=/\n\s*at [^:]*:[^\n]*/,jR=Qg.test(FR),um=Je,nb=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",um(1,7)),e.stack!==7)}),P1=Xo,Zg=function(e,r){if(jR&&typeof e=="string"&&!gE.prepareStackTrace)for(;r--;)e=tb(e,Qg,"");return e},_E=nb,rb=Error.captureStackTrace,Qd={},dm=Qd,BR=gr("iterator"),yE=Array.prototype,e_=function(e){return e!==void 0&&(dm.Array===e||yE[BR]===e)},hm=Pc,EE=Tc,ib=Mt,sb=Qd,ob=gr("iterator"),Zu=function(e){if(!ib(e))return EE(e,ob)||EE(e,"@@iterator")||sb[hm(e)]},Lc=Ee,Op=ys,ab=hn,WR=_s,ed=Zu,Zd=TypeError,t_=function(e,r){var i=arguments.length<2?ed(e):r;if(Op(i))return ab(Lc(i,e));throw Zd(WR(e)+" is not iterable")},zR=Ee,Jl=hn,eh=Tc,n_=function(e,r,i){var o,c;Jl(e);try{if(!(o=eh(e,"return"))){if(r==="throw")throw i;return i}o=zR(o,e)}catch(u){c=!0,o=u}if(r==="throw")throw i;if(c)throw o;return Jl(o),i},GR=De,vE=Ee,HR=hn,r_=_s,Ql=e_,i_=hi,pm=k,kp=t_,cb=Zu,Np=n_,$R=TypeError,fm=function(e,r){this.stopped=e,this.result=r},Mi=fm.prototype,th=function(e,r,i){var o,c,u,h,m,_,E,S=i&&i.that,C=!(!i||!i.AS_ENTRIES),P=!(!i||!i.IS_RECORD),N=!(!i||!i.IS_ITERATOR),G=!(!i||!i.INTERRUPTED),V=GR(r,S),j=function(Z){return o&&Np(o,"normal",Z),new fm(!0,Z)},Y=function(Z){return C?(HR(Z),G?V(Z[0],Z[1],j):V(Z[0],Z[1])):G?V(Z,j):V(Z)};if(P)o=e.iterator;else if(N)o=e;else{if(!(c=cb(e)))throw $R(r_(e)+" is not iterable");if(Ql(c)){for(u=0,h=i_(e);h>u;u++)if((m=Y(e[u]))&&pm(Mi,m))return m;return new fm(!1)}o=kp(e,c)}for(_=P?e.next:o.next;!(E=vE(_,o)).done;){try{m=Y(E.value)}catch(Z){Np(o,"throw",Z)}if(typeof m=="object"&&m&&pm(Mi,m))return m}return new fm(!1)},lb=Oa,ub=Wn,SE=k,db=qg,Zl=Xl,Wi=function(e,r,i){for(var o=Na(r),c=LR.f,u=lE.f,h=0;h<o.length;h++){var m=o[h];Ap(e,m)||i&&Ap(i,m)||c(e,m,u(r,m))}},Ss=Zo,bs=Xo,mm=Je,s_=function(e,r){UR(r)&&"cause"in r&&VR(e,"cause",r.cause)},o_=function(e,r,i,o){_E&&(rb?rb(e,r):P1(e,"stack",Zg(i,o)))},O1=th,To=function(e,r){return e===void 0?arguments.length<2?"":r:lb(e)},hb=gr("toStringTag"),gm=Error,pb=[].push,ea=function(e,r){var i,o=SE(xa,this);Zl?i=Zl(gm(),o?db(this):xa):(i=o?this:Ss(xa),bs(i,hb,"Error")),r!==void 0&&bs(i,"message",To(r)),o_(i,ea,i.stack,1),arguments.length>2&&s_(i,arguments[2]);var c=[];return O1(e,pb,{that:c}),bs(i,"errors",c),i};Zl?Zl(ea,gm):Wi(ea,gm,{name:!0});var xa=ea.prototype=Ss(gm.prototype,{constructor:mm(1,ea),message:mm(1,""),name:mm(1,"AggregateError")});ub({global:!0},{AggregateError:ea});var nh,Dp,_m,KR=Le,fb=F.WeakMap,qR=KR(fb)&&/native code/.test(String(fb)),mb=F,YR=ot,XR=Xo,bE=Si,TE=Vd,a_=$g,JR=Oc,c_="Object already initialized",ym=mb.TypeError,QR=mb.WeakMap;if(qR||TE.state){var xc=TE.state||(TE.state=new QR);xc.get=xc.get,xc.has=xc.has,xc.set=xc.set,nh=function(e,r){if(xc.has(e))throw ym(c_);return r.facade=e,xc.set(e,r),r},Dp=function(e){return xc.get(e)||{}},_m=function(e){return xc.has(e)}}else{var Lp=a_("state");JR[Lp]=!0,nh=function(e,r){if(bE(e,Lp))throw ym(c_);return r.facade=e,XR(e,Lp,r),r},Dp=function(e){return bE(e,Lp)?e[Lp]:{}},_m=function(e){return bE(e,Lp)}}var rh,gb,_b,td={set:nh,get:Dp,has:_m,enforce:function(e){return _m(e)?Dp(e):nh(e,{})},getterFor:function(e){return function(r){var i;if(!YR(r)||(i=Dp(r)).type!==e)throw ym("Incompatible receiver, "+e+" required");return i}}},wE=$e,ZR=Si,yb=Function.prototype,k1=wE&&Object.getOwnPropertyDescriptor,Eb=ZR(yb,"name"),eI={PROPER:Eb&&(function(){}).name==="something",CONFIGURABLE:Eb&&(!wE||wE&&k1(yb,"name").configurable)},N1=Xo,nd=function(e,r,i,o){return o&&o.enumerable?e[r]=i:N1(e,r,i),e},tI=d,nI=Le,CE=ot,D1=Zo,rI=qg,L1=nd,ac=gr("iterator"),RE=!1;[].keys&&("next"in(_b=[].keys())?(gb=rI(rI(_b)))!==Object.prototype&&(rh=gb):RE=!0);var IE=!CE(rh)||tI(function(){var e={};return rh[ac].call(e)!==e});nI((rh=IE?{}:D1(rh))[ac])||L1(rh,ac,function(){return this});var vb={IteratorPrototype:rh,BUGGY_SAFARI_ITERATORS:RE},iI=Pc,sI=Ep?{}.toString:function(){return"[object "+iI(this)+"]"},Sb=Ep,Em=nt.f,bb=Xo,Tb=Si,x1=sI,wb=gr("toStringTag"),rd=function(e,r,i,o){if(e){var c=i?e:e.prototype;Tb(c,wb)||Em(c,wb,{configurable:!0,value:r}),o&&!Sb&&bb(c,"toString",x1)}},oI=vb.IteratorPrototype,aI=Zo,cI=Je,M1=rd,Ma=Qd,ta=function(){return this},AE=function(e,r,i,o){var c=r+" Iterator";return e.prototype=aI(oI,{next:cI(+!o,i)}),M1(e,c,!1,!0),Ma[c]=ta,e},lI=Wn,uI=Ee,dI=eI,hI=AE,Cb=qg,pI=rd,PE=nd,Rb=Qd,fI=vb,Ib=dI.PROPER,vm=fI.BUGGY_SAFARI_ITERATORS,OE=gr("iterator"),kE="keys",xp="values",mI="entries",gI=function(){return this},NE=function(e,r,i,o,c,u,h){hI(i,r,o);var m,_,E,S=function(Y){if(Y===c&&V)return V;if(!vm&&Y in N)return N[Y];switch(Y){case kE:case xp:case mI:return function(){return new i(this,Y)}}return function(){return new i(this)}},C=r+" Iterator",P=!1,N=e.prototype,G=N[OE]||N["@@iterator"]||c&&N[c],V=!vm&&G||S(c),j=r=="Array"&&N.entries||G;if(j&&(m=Cb(j.call(new e)))!==Object.prototype&&m.next&&(pI(m,C,!0,!0),Rb[C]=gI),Ib&&c==xp&&G&&G.name!==xp&&(P=!0,V=function(){return uI(G,this)}),c)if(_={values:S(xp),keys:u?V:S(kE),entries:S(mI)},h)for(E in _)(vm||P||!(E in N))&&PE(N,E,_[E]);else lI({target:r,proto:!0,forced:vm||P},_);return h&&N[OE]!==V&&PE(N,OE,V,{}),Rb[r]=V,_},DE=function(e,r){return{value:e,done:r}},LE=Re,eu=Qd,_I=td;nt.f;var yI=NE,xE=DE,Ab="Array Iterator",EI=_I.set,l_=_I.getterFor(Ab);yI(Array,"Array",function(e,r){EI(this,{type:Ab,target:LE(e),index:0,kind:r})},function(){var e=l_(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,xE(void 0,!0)):xE(i=="keys"?o:i=="values"?r[o]:[o,r[o]],!1)},"values"),eu.Arguments=eu.Array;var wo=nt,ME=function(e,r,i){return wo.f(e,r,i)},U1=un,UE=ME,Co=$e,vI=gr("species"),en=k,Sm=TypeError,u_=function(e,r){if(en(r,e))return e;throw Sm("Incorrect invocation")},SI=Le,Pb=Vd,d_=I(Function.toString);SI(Pb.inspectSource)||(Pb.inspectSource=function(e){return d_(e)});var h_=Pb.inspectSource,Ob=I,bI=d,kb=Le,TI=Pc,Nb=h_,VE=function(){},so=[],Mc=un("Reflect","construct"),tu=/^\s*(?:class|function)\b/,wI=Ob(tu.exec),CI=!tu.exec(VE),na=function(e){if(!kb(e))return!1;try{return Mc(VE,so,e),!0}catch{return!1}},Db=function(e){if(!kb(e))return!1;switch(TI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return CI||!!wI(tu,Nb(e))}catch{return!0}};Db.sham=!0;var Ua,bm,Lb,FE,p_=!Mc||bI(function(){var e;return na(na.call)||!na(Object)||!na(function(){e=!0})||e})?Db:na,RI=p_,V1=_s,jE=TypeError,BE=hn,Uc=function(e){if(RI(e))return e;throw jE(V1(e)+" is not a constructor")},Pr=Mt,Xs=gr("species"),ts=function(e,r){var i,o=BE(e).constructor;return o===void 0||Pr(i=BE(o)[Xs])?r:Uc(i)},Ts=I([].slice),cc=TypeError,yl=function(e,r){if(e<r)throw cc("Not enough arguments");return e},ws=/(?:ipad|iphone|ipod).*applewebkit/i.test(bt),oo=F,Mp=ie,WE=De,zE=Le,f_=Si,ra=d,GE=Xg,Tm=Ts,nu=$l,HE=yl,xb=ws,ih=bp,wm=oo.setImmediate,ru=oo.clearImmediate,$E=oo.process,Up=oo.Dispatch,Mb=oo.Function,m_=oo.MessageChannel,KE=oo.String,ao=0,Vc={},Fc="onreadystatechange";ra(function(){Ua=oo.location});var Ro=function(e){if(f_(Vc,e)){var r=Vc[e];delete Vc[e],r()}},qE=function(e){return function(){Ro(e)}},YE=function(e){Ro(e.data)},XE=function(e){oo.postMessage(KE(e),Ua.protocol+"//"+Ua.host)};wm&&ru||(wm=function(e){HE(arguments.length,1);var r=zE(e)?e:Mb(e),i=Tm(arguments,1);return Vc[++ao]=function(){Mp(r,void 0,i)},bm(ao),ao},ru=function(e){delete Vc[e]},ih?bm=function(e){$E.nextTick(qE(e))}:Up&&Up.now?bm=function(e){Up.now(qE(e))}:m_&&!xb?(FE=(Lb=new m_).port2,Lb.port1.onmessage=YE,bm=WE(FE.postMessage,FE)):oo.addEventListener&&zE(oo.postMessage)&&!oo.importScripts&&Ua&&Ua.protocol!=="file:"&&!ra(XE)?(bm=XE,oo.addEventListener("message",YE,!1)):bm=Fc in nu("script")?function(e){GE.appendChild(nu("script"))[Fc]=function(){GE.removeChild(this),Ro(e)}}:function(e){setTimeout(qE(e),0)});var JE={set:wm,clear:ru},id=function(){this.head=null,this.tail=null};id.prototype={add:function(e){var r={item:e,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Vp,g_,sd,__,sh,Ub=id,II=/ipad|iphone|ipod/i.test(bt)&&typeof Pebble<"u",Vb=/web0s(?!.*chrome)/i.test(bt),iu=F,AI=De,F1=We.f,QE=JE.set,PI=Ub,Fp=ws,j1=II,Cm=Vb,ZE=bp,zi=iu.MutationObserver||iu.WebKitMutationObserver,OI=iu.document,Fb=iu.process,ev=iu.Promise,kI=F1(iu,"queueMicrotask"),tv=kI&&kI.value;if(!tv){var y_=new PI,nv=function(){var e,r;for(ZE&&(e=Fb.domain)&&e.exit();r=y_.get();)try{r()}catch(i){throw y_.head&&Vp(),i}e&&e.enter()};Fp||ZE||Cm||!zi||!OI?!j1&&ev&&ev.resolve?((__=ev.resolve(void 0)).constructor=ev,sh=AI(__.then,__),Vp=function(){sh(nv)}):ZE?Vp=function(){Fb.nextTick(nv)}:(QE=AI(QE,iu),Vp=function(){QE(nv)}):(g_=!0,sd=OI.createTextNode(""),new zi(nv).observe(sd,{characterData:!0}),Vp=function(){sd.data=g_=!g_}),tv=function(e){y_.head||Vp(),y_.add(e)}}var lc=tv,oh=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},jp=F.Promise,od=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",rv=!od&&!bp&&typeof window=="object"&&typeof document=="object",Bp=F,ah=jp,jb=Le,Bb=Aa,B1=h_,Wb=gr,W1=rv,NI=od,iv=ii,E_=ah&&ah.prototype,sv=Wb("species"),zb=jb(Bp.PromiseRejectionEvent),Gb=Bb("Promise",function(){var e=B1(ah),r=e!==String(ah);if(!r&&iv===66||!E_.catch||!E_.finally)return!0;if(!iv||iv<51||!/native code/.test(e)){var i=new ah(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[sv]=o,!(i.then(function(){})instanceof o))return!0}return!r&&(W1||NI)&&!zb}),v_={CONSTRUCTOR:Gb,REJECTION_EVENT:zb},El={},ov=ys,av=TypeError,Hb=function(e){var r,i;this.promise=new e(function(o,c){if(r!==void 0||i!==void 0)throw av("Bad Promise constructor");r=o,i=c}),this.resolve=ov(r),this.reject=ov(i)};El.f=function(e){return new Hb(e)};var Rm,$b,z1=Wn,Wp=bp,ch=F,ad=Ee,G1=nd,cv=rd,p=function(e){var r=U1(e);Co&&r&&!r[vI]&&UE(r,vI,{configurable:!0,get:function(){return this}})},g=ys,T=Le,O=ot,U=u_,H=ts,ce=JE.set,Ae=lc,Ue=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},rt=oh,Pt=Ub,kt=td,At=jp,Yt=v_,nn=El,rn="Promise",ns=Yt.CONSTRUCTOR,Xe=Yt.REJECTION_EVENT,Ve=kt.getterFor(rn),et=kt.set,xt=At&&At.prototype,an=At,gn=xt,vn=ch.TypeError,Un=ch.document,Cs=ch.process,Tr=nn.f,lh=Tr,H1=!!(Un&&Un.createEvent&&ch.dispatchEvent),K4="unhandledrejection",q4=function(e){var r;return!(!O(e)||!T(r=e.then))&&r},Y4=function(e,r){var i,o,c,u=r.value,h=r.state==1,m=h?e.ok:e.fail,_=e.resolve,E=e.reject,S=e.domain;try{m?(h||(r.rejection===2&&Doe(r),r.rejection=1),m===!0?i=u:(S&&S.enter(),i=m(u),S&&(S.exit(),c=!0)),i===e.promise?E(vn("Promise-chain cycle")):(o=q4(i))?ad(o,i,_,E):_(i)):E(u)}catch(C){S&&!c&&S.exit(),E(C)}},X4=function(e,r){e.notified||(e.notified=!0,Ae(function(){for(var i,o=e.reactions;i=o.get();)Y4(i,e);e.notified=!1,r&&!e.rejection&&Noe(e)}))},J4=function(e,r,i){var o,c;H1?((o=Un.createEvent("Event")).promise=r,o.reason=i,o.initEvent(e,!1,!0),ch.dispatchEvent(o)):o={promise:r,reason:i},!Xe&&(c=ch["on"+e])?c(o):e===K4&&Ue("Unhandled promise rejection",i)},Noe=function(e){ad(ce,ch,function(){var r,i=e.facade,o=e.value;if(Q4(e)&&(r=rt(function(){Wp?Cs.emit("unhandledRejection",o,i):J4(K4,i,o)}),e.rejection=Wp||Q4(e)?2:1,r.error))throw r.value})},Q4=function(e){return e.rejection!==1&&!e.parent},Doe=function(e){ad(ce,ch,function(){var r=e.facade;Wp?Cs.emit("rejectionHandled",r):J4("rejectionhandled",r,e.value)})},lv=function(e,r,i){return function(o){e(r,o,i)}},uv=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,X4(e,!0))},$1=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw vn("Promise can't be resolved itself");var o=q4(r);o?Ae(function(){var c={done:!1};try{ad(o,r,lv($1,c,e),lv(uv,c,e))}catch(u){uv(c,u,e)}}):(e.value=r,e.state=1,X4(e,!1))}catch(c){uv({done:!1},c,e)}}};ns&&(gn=(an=function(e){U(this,gn),g(e),ad(Rm,this);var r=Ve(this);try{e(lv($1,r),lv(uv,r))}catch(i){uv(r,i)}}).prototype,(Rm=function(e){et(this,{type:rn,done:!1,notified:!1,parent:!1,reactions:new Pt,rejection:!1,state:0,value:void 0})}).prototype=G1(gn,"then",function(e,r){var i=Ve(this),o=Tr(H(this,an));return i.parent=!0,o.ok=!T(e)||e,o.fail=T(r)&&r,o.domain=Wp?Cs.domain:void 0,i.state==0?i.reactions.add(o):Ae(function(){Y4(o,i)}),o.promise}),$b=function(){var e=new Rm,r=Ve(e);this.promise=e,this.resolve=lv($1,r),this.reject=lv(uv,r)},nn.f=Tr=function(e){return e===an||e===void 0?new $b(e):lh(e)}),z1({global:!0,wrap:!0,forced:ns},{Promise:an}),cv(an,rn,!1,!0),p(rn);var Z4=gr("iterator"),e3=!1;try{var Loe=0,t3={next:function(){return{done:!!Loe++}},return:function(){e3=!0}};t3[Z4]=function(){return this},Array.from(t3,function(){throw 2})}catch{}var xoe=jp,Moe=function(e,r){if(!e3)return!1;var i=!1;try{var o={};o[Z4]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},DI=v_.CONSTRUCTOR||!Moe(function(e){xoe.all(e).then(void 0,function(){})}),Uoe=Ee,Voe=ys,Foe=El,joe=oh,Boe=th;Wn({target:"Promise",stat:!0,forced:DI},{all:function(e){var r=this,i=Foe.f(r),o=i.resolve,c=i.reject,u=joe(function(){var h=Voe(r.resolve),m=[],_=0,E=1;Boe(e,function(S){var C=_++,P=!1;E++,Uoe(h,r,S).then(function(N){P||(P=!0,m[C]=N,--E||o(m))},c)}),--E||o(m)});return u.error&&c(u.value),i.promise}});var Woe=Wn,zoe=v_.CONSTRUCTOR;jp&&jp.prototype,Woe({target:"Promise",proto:!0,forced:zoe,real:!0},{catch:function(e){return this.then(void 0,e)}});var Goe=Ee,Hoe=ys,$oe=El,Koe=oh,qoe=th;Wn({target:"Promise",stat:!0,forced:DI},{race:function(e){var r=this,i=$oe.f(r),o=i.reject,c=Koe(function(){var u=Hoe(r.resolve);qoe(e,function(h){Goe(u,r,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var Yoe=Ee,Xoe=El;Wn({target:"Promise",stat:!0,forced:v_.CONSTRUCTOR},{reject:function(e){var r=Xoe.f(this);return Yoe(r.reject,void 0,e),r.promise}});var Joe=hn,Qoe=ot,Zoe=El,n3=function(e,r){if(Joe(e),Qoe(r)&&r.constructor===e)return r;var i=Zoe.f(e);return(0,i.resolve)(r),i.promise},eae=Wn,tae=jp,nae=v_.CONSTRUCTOR,rae=n3,iae=un("Promise"),sae=!nae;eae({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return rae(sae&&this===iae?tae:this,e)}});var oae=Ee,aae=ys,cae=El,lae=oh,uae=th;Wn({target:"Promise",stat:!0,forced:DI},{allSettled:function(e){var r=this,i=cae.f(r),o=i.resolve,c=i.reject,u=lae(function(){var h=aae(r.resolve),m=[],_=0,E=1;uae(e,function(S){var C=_++,P=!1;E++,oae(h,r,S).then(function(N){P||(P=!0,m[C]={status:"fulfilled",value:N},--E||o(m))},function(N){P||(P=!0,m[C]={status:"rejected",reason:N},--E||o(m))})}),--E||o(m)});return u.error&&c(u.value),i.promise}});var dae=Ee,hae=ys,pae=un,fae=El,mae=oh,gae=th,r3="No one promise resolved";Wn({target:"Promise",stat:!0,forced:DI},{any:function(e){var r=this,i=pae("AggregateError"),o=fae.f(r),c=o.resolve,u=o.reject,h=mae(function(){var m=hae(r.resolve),_=[],E=0,S=1,C=!1;gae(e,function(P){var N=E++,G=!1;S++,dae(m,r,P).then(function(V){G||C||(C=!0,c(V))},function(V){G||C||(G=!0,_[N]=V,--S||u(new i(_,r3)))})}),--S||u(new i(_,r3))});return h.error&&u(h.value),o.promise}});var _ae=Wn,K1=jp,yae=d,Eae=un,vae=Le,Sae=ts,i3=n3,bae=K1&&K1.prototype;_ae({target:"Promise",proto:!0,real:!0,forced:!!K1&&yae(function(){bae.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=Sae(this,Eae("Promise")),i=vae(e);return this.then(i?function(o){return i3(r,e()).then(function(){return o})}:e,i?function(o){return i3(r,e()).then(function(){throw o})}:e)}});var q1=I,Tae=Ac,wae=Oa,Cae=Ht,Rae=q1("".charAt),s3=q1("".charCodeAt),Iae=q1("".slice),o3=function(e){return function(r,i){var o,c,u=wae(Cae(r)),h=Tae(i),m=u.length;return h<0||h>=m?e?"":void 0:(o=s3(u,h))<55296||o>56319||h+1===m||(c=s3(u,h+1))<56320||c>57343?e?Rae(u,h):o:e?Iae(u,h,h+2):c-56320+(o-55296<<10)+65536}},Y1={codeAt:o3(!1),charAt:o3(!0)},Aae=Y1.charAt,Pae=Oa,a3=td,Oae=NE,c3=DE,l3="String Iterator",kae=a3.set,Nae=a3.getterFor(l3);Oae(String,"String",function(e){kae(this,{type:l3,string:Pae(e),index:0})},function(){var e,r=Nae(this),i=r.string,o=r.index;return o>=i.length?c3(void 0,!0):(e=Aae(i,o),r.index+=e.length,c3(e,!1))});var Dae=_t.Promise,Lae={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xae=F,Mae=Pc,Uae=Xo,u3=Qd,d3=gr("toStringTag");for(var X1 in Lae){var h3=xae[X1],J1=h3&&h3.prototype;J1&&Mae(J1)!==d3&&Uae(J1,d3,X1),u3[X1]=u3.Array}var p3=Dae,dt=l(p3),Vae=ic("Array").values,Fae=Pc,jae=Si,Bae=k,Wae=Vae,Q1=Array.prototype,zae={DOMTokenList:!0,NodeList:!0},Gae=function(e){var r=e.values;return e===Q1||Bae(Q1,e)&&r===Q1.values||jae(zae,Fae(e))?Wae:r},jc=l(Gae),Hae=d,$ae=gr("iterator"),Z1=!Hae(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[$ae]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Kae=nd,qae=nc,Yae=nt,Xae=Je,LI=function(e,r,i){var o=qae(r);o in e?Yae.f(e,o,Xae(0,i)):e[o]=i},f3=ge,Jae=hi,Qae=LI,Zae=Array,ece=Math.max,eD=function(e,r,i){for(var o=Jae(e),c=f3(r,o),u=f3(i===void 0?o:i,o),h=Zae(ece(u-c,0)),m=0;c<u;c++,m++)Qae(h,m,e[c]);return h.length=m,h},m3=eD,tce=Math.floor,tD=function(e,r){var i=e.length,o=tce(i/2);return i<8?nce(e,r):rce(e,tD(m3(e,0,o),r),tD(m3(e,o),r),r)},nce=function(e,r){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&r(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},rce=function(e,r,i,o){for(var c=r.length,u=i.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(r[h],i[m])<=0?r[h++]:i[m++]:h<c?r[h++]:i[m++];return e},g3=tD,nD=Wn,dv=F,xI=Ee,uh=I,hv=$e,_3=Z1,y3=nd,ice=ME,sce=function(e,r,i){for(var o in r)i&&i.unsafe&&e[o]?e[o]=r[o]:Kae(e,o,r[o],i);return e},oce=rd,ace=AE,rD=td,E3=u_,iD=Le,cce=Si,lce=De,uce=Pc,dce=hn,v3=ot,uc=Oa,hce=Zo,S3=Je,sD=t_,pce=Zu,pv=yl,fce=g3,mce=gr("iterator"),Kb="URLSearchParams",b3=Kb+"Iterator",T3=rD.set,su=rD.getterFor(Kb),gce=rD.getterFor(b3),_ce=Object.getOwnPropertyDescriptor,oD=function(e){if(!hv)return dv[e];var r=_ce(dv,e);return r&&r.value},w3=oD("fetch"),MI=oD("Request"),qb=oD("Headers"),aD=MI&&MI.prototype,C3=qb&&qb.prototype,yce=dv.RegExp,Ece=dv.TypeError,R3=dv.decodeURIComponent,vce=dv.encodeURIComponent,Sce=uh("".charAt),I3=uh([].join),S_=uh([].push),cD=uh("".replace),bce=uh([].shift),A3=uh([].splice),P3=uh("".split),Tce=uh("".slice),wce=/\+/g,O3=Array(4),Cce=function(e){return O3[e-1]||(O3[e-1]=yce("((?:%[\\da-f]{2}){"+e+"})","gi"))},Rce=function(e){try{return R3(e)}catch{return e}},k3=function(e){var r=cD(e,wce," "),i=4;try{return R3(r)}catch{for(;i;)r=cD(r,Cce(i--),Rce);return r}},Ice=/[!'()~]|%20/g,Ace={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Pce=function(e){return Ace[e]},N3=function(e){return cD(vce(e),Ice,Pce)},lD=ace(function(e,r){T3(this,{type:b3,iterator:sD(su(e).entries),kind:r})},"Iterator",function(){var e=gce(this),r=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),i},!0),D3=function(e){this.entries=[],this.url=null,e!==void 0&&(v3(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Sce(e,0)==="?"?Tce(e,1):e:uc(e)))};D3.prototype={type:Kb,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,i,o,c,u,h,m,_=pce(e);if(_)for(i=(r=sD(e,_)).next;!(o=xI(i,r)).done;){if(u=(c=sD(dce(o.value))).next,(h=xI(u,c)).done||(m=xI(u,c)).done||!xI(u,c).done)throw Ece("Expected sequence with length 2");S_(this.entries,{key:uc(h.value),value:uc(m.value)})}else for(var E in e)cce(e,E)&&S_(this.entries,{key:E,value:uc(e[E])})},parseQuery:function(e){if(e)for(var r,i,o=P3(e,"&"),c=0;c<o.length;)(r=o[c++]).length&&(i=P3(r,"="),S_(this.entries,{key:k3(bce(i)),value:k3(I3(i,"="))}))},serialize:function(){for(var e,r=this.entries,i=[],o=0;o<r.length;)e=r[o++],S_(i,N3(e.key)+"="+N3(e.value));return I3(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var UI=function(){E3(this,fv);var e=T3(this,new D3(arguments.length>0?arguments[0]:void 0));hv||(this.size=e.entries.length)},fv=UI.prototype;if(sce(fv,{append:function(e,r){var i=su(this);pv(arguments.length,2),S_(i.entries,{key:uc(e),value:uc(r)}),hv||this.length++,i.updateURL()},delete:function(e){for(var r=su(this),i=pv(arguments.length,1),o=r.entries,c=uc(e),u=i<2?void 0:arguments[1],h=u===void 0?u:uc(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(A3(o,m,1),h!==void 0)break}hv||(this.size=o.length),r.updateURL()},get:function(e){var r=su(this).entries;pv(arguments.length,1);for(var i=uc(e),o=0;o<r.length;o++)if(r[o].key===i)return r[o].value;return null},getAll:function(e){var r=su(this).entries;pv(arguments.length,1);for(var i=uc(e),o=[],c=0;c<r.length;c++)r[c].key===i&&S_(o,r[c].value);return o},has:function(e){for(var r=su(this).entries,i=pv(arguments.length,1),o=uc(e),c=i<2?void 0:arguments[1],u=c===void 0?c:uc(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,r){var i=su(this);pv(arguments.length,1);for(var o,c=i.entries,u=!1,h=uc(e),m=uc(r),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?A3(c,_--,1):(u=!0,o.value=m));u||S_(c,{key:h,value:m}),hv||(this.size=c.length),i.updateURL()},sort:function(){var e=su(this);fce(e.entries,function(r,i){return r.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,i=su(this).entries,o=lce(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((r=i[c++]).value,r.key,this)},keys:function(){return new lD(this,"keys")},values:function(){return new lD(this,"values")},entries:function(){return new lD(this,"entries")}},{enumerable:!0}),y3(fv,mce,fv.entries,{}),y3(fv,"toString",function(){return su(this).serialize()},{enumerable:!0}),hv&&ice(fv,"size",{get:function(){return su(this).entries.length},configurable:!0,enumerable:!0}),oce(UI,Kb),nD({global:!0,forced:!_3},{URLSearchParams:UI}),!_3&&iD(qb)){var Oce=uh(C3.has),kce=uh(C3.set),L3=function(e){if(v3(e)){var r,i=e.body;if(uce(i)===Kb)return r=e.headers?new qb(e.headers):new qb,Oce(r,"content-type")||kce(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),hce(e,{body:S3(0,uc(i)),headers:S3(0,r)})}return e};if(iD(w3)&&nD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return w3(e,arguments.length>1?L3(arguments[1]):{})}}),iD(MI)){var uD=function(e){return E3(this,aD),new MI(e,arguments.length>1?L3(arguments[1]):{})};aD.constructor=uD,uD.prototype=aD,nD({global:!0,dontCallGetSet:!0,forced:!0},{Request:uD})}}var ou,Nce={URLSearchParams:UI,getState:su},Dce=_t.URLSearchParams,x3=$e,Lce=I,xce=Ee,Mce=d,dD=Nc,Uce=kc,Vce=ke,Fce=Bo,jce=sn,mv=Object.assign,M3=Object.defineProperty,Bce=Lce([].concat),Wce=!mv||Mce(function(){if(x3&&mv({b:1},mv(M3({},"a",{enumerable:!0,get:function(){M3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){r[c]=c}),mv({},e)[i]!=7||dD(mv({},r)).join("")!=o})?function(e,r){for(var i=Fce(e),o=arguments.length,c=1,u=Uce.f,h=Vce.f;o>c;)for(var m,_=jce(arguments[c++]),E=u?Bce(dD(_),u(_)):dD(_),S=E.length,C=0;S>C;)m=E[C++],x3&&!xce(h,_,m)||(i[m]=_[m]);return i}:mv,zce=hn,Gce=n_,Hce=De,$ce=Ee,Kce=Bo,qce=function(e,r,i,o){try{return o?r(zce(i)[0],i[1]):r(i)}catch(c){Gce(e,"throw",c)}},Yce=e_,Xce=p_,Jce=hi,U3=LI,Qce=t_,Zce=Zu,V3=Array,b_=I,hD=2147483647,ele=/[^\0-\u007E]/,F3=/[.\u3002\uFF0E\uFF61]/g,j3="Overflow: input needs wider integers to process",B3=RangeError,tle=b_(F3.exec),gv=Math.floor,pD=String.fromCharCode,W3=b_("".charCodeAt),z3=b_([].join),Im=b_([].push),nle=b_("".replace),rle=b_("".split),ile=b_("".toLowerCase),G3=function(e){return e+22+75*(e<26)},sle=function(e,r,i){var o=0;for(e=i?gv(e/700):e>>1,e+=gv(e/r);e>455;)e=gv(e/35),o+=36;return gv(o+36*e/(e+38))},ole=function(e){var r=[];e=function(Y){for(var Z=[],de=0,Se=Y.length;de<Se;){var Te=W3(Y,de++);if(Te>=55296&&Te<=56319&&de<Se){var ye=W3(Y,de++);(64512&ye)==56320?Im(Z,((1023&Te)<<10)+(1023&ye)+65536):(Im(Z,Te),de--)}else Im(Z,Te)}return Z}(e);var i,o,c=e.length,u=128,h=0,m=72;for(i=0;i<e.length;i++)(o=e[i])<128&&Im(r,pD(o));var _=r.length,E=_;for(_&&Im(r,"-");E<c;){var S=hD;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<S&&(S=o);var C=E+1;if(S-u>gv((hD-h)/C))throw B3(j3);for(h+=(S-u)*C,u=S,i=0;i<e.length;i++){if((o=e[i])<u&&++h>hD)throw B3(j3);if(o==u){for(var P=h,N=36;;){var G=N<=m?1:N>=m+26?26:N-m;if(P<G)break;var V=P-G,j=36-G;Im(r,pD(G3(G+V%j))),P=gv(V/j),N+=36}Im(r,pD(G3(P))),m=sle(h,C,E==_),h=0,E++}}h++,u++}return z3(r,"")},ale=Wn,fD=$e,cle=Z1,mD=F,H3=De,au=I,VI=nd,cu=ME,lle=u_,gD=Si,_D=Wce,_v=function(e){var r=Kce(e),i=Xce(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Hce(c,o>2?arguments[2]:void 0));var h,m,_,E,S,C,P=Zce(r),N=0;if(!P||this===V3&&Yce(P))for(h=Jce(r),m=i?new this(h):V3(h);h>N;N++)C=u?c(r[N],N):r[N],U3(m,N,C);else for(S=(E=Qce(r,P)).next,m=i?new this:[];!(_=$ce(S,E)).done;N++)C=u?qce(E,c,[_.value,N],!0):_.value,U3(m,N,C);return m.length=N,m},cd=eD,ule=Y1.codeAt,dle=function(e){var r,i,o=[],c=rle(nle(ile(e),F3,"."),".");for(r=0;r<c.length;r++)i=c[r],Im(o,tle(ele,i)?"xn--"+ole(i):i);return z3(o,".")},zp=Oa,hle=rd,ple=yl,$3=Nce,K3=td,fle=K3.set,FI=K3.getterFor("URL"),mle=$3.URLSearchParams,gle=$3.getState,Yb=mD.URL,yD=mD.TypeError,jI=mD.parseInt,_le=Math.floor,q3=Math.pow,lu=au("".charAt),ld=au(/./.exec),Xb=au([].join),yle=au(1 .toString),Ele=au([].pop),yv=au([].push),ED=au("".replace),vle=au([].shift),Sle=au("".split),Jb=au("".slice),BI=au("".toLowerCase),ble=au([].unshift),vD="Invalid scheme",T_="Invalid host",Y3="Invalid port",X3=/[a-z]/i,Tle=/[\d+-.a-z]/i,SD=/\d/,wle=/^0x/i,Cle=/^[0-7]+$/,Rle=/^\d+$/,J3=/^[\da-f]+$/i,Ile=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Ale=/[\0\t\n\r #/:<>?@[\\\]^|]/,Ple=/^[\u0000-\u0020]+/,Ole=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,kle=/[\t\n\r]/g,Qb=function(e){var r,i,o,c;if(typeof e=="number"){for(r=[],i=0;i<4;i++)ble(r,e%256),e=_le(e/256);return Xb(r,".")}if(typeof e=="object"){for(r="",o=function(u){for(var h=null,m=1,_=null,E=0,S=0;S<8;S++)u[S]!==0?(E>m&&(h=_,m=E),_=null,E=0):(_===null&&(_=S),++E);return E>m&&(h=_,m=E),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(r+=i?":":"::",c=!0):(r+=yle(e[i],16),i<7&&(r+=":")));return"["+r+"]"}return e},WI={},Q3=_D({},WI,{" ":1,'"':1,"<":1,">":1,"`":1}),Z3=_D({},Q3,{"#":1,"?":1,"{":1,"}":1}),bD=_D({},Z3,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Am=function(e,r){var i=ule(e,0);return i>32&&i<127&&!gD(r,e)?e:encodeURIComponent(e)},zI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Zb=function(e,r){var i;return e.length==2&&ld(X3,lu(e,0))&&((i=lu(e,1))==":"||!r&&i=="|")},e5=function(e){var r;return e.length>1&&Zb(Jb(e,0,2))&&(e.length==2||(r=lu(e,2))==="/"||r==="\\"||r==="?"||r==="#")},Nle=function(e){return e==="."||BI(e)==="%2e"},TD={},t5={},wD={},n5={},r5={},CD={},i5={},s5={},GI={},HI={},RD={},ID={},AD={},PD={},o5={},OD={},Ev={},dh={},a5={},w_={},Gp={},kD=function(e,r,i){var o,c,u,h=zp(e);if(r){if(c=this.parse(h))throw yD(c);this.searchParams=null}else{if(i!==void 0&&(o=new kD(i,!0)),c=this.parse(h,null,o))throw yD(c);(u=gle(new mle)).bindURL(this),this.searchParams=u}};kD.prototype={type:"URL",parse:function(e,r,i){var o,c,u,h,m,_=this,E=r||TD,S=0,C="",P=!1,N=!1,G=!1;for(e=zp(e),r||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=ED(e,Ple,""),e=ED(e,Ole,"$1")),e=ED(e,kle,""),o=_v(e);S<=o.length;){switch(c=o[S],E){case TD:if(!c||!ld(X3,c)){if(r)return vD;E=wD;continue}C+=BI(c),E=t5;break;case t5:if(c&&(ld(Tle,c)||c=="+"||c=="-"||c=="."))C+=BI(c);else{if(c!=":"){if(r)return vD;C="",E=wD,S=0;continue}if(r&&(_.isSpecial()!=gD(zI,C)||C=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=C,r)return void(_.isSpecial()&&zI[_.scheme]==_.port&&(_.port=null));C="",_.scheme=="file"?E=PD:_.isSpecial()&&i&&i.scheme==_.scheme?E=n5:_.isSpecial()?E=s5:o[S+1]=="/"?(E=r5,S++):(_.cannotBeABaseURL=!0,yv(_.path,""),E=a5)}break;case wD:if(!i||i.cannotBeABaseURL&&c!="#")return vD;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=cd(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,E=Gp;break}E=i.scheme=="file"?PD:CD;continue;case n5:if(c!="/"||o[S+1]!="/"){E=CD;continue}E=GI,S++;break;case r5:if(c=="/"){E=HI;break}E=dh;continue;case CD:if(_.scheme=i.scheme,c==ou)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=cd(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())E=i5;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=cd(i.path),_.query="",E=w_;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=cd(i.path),_.path.length--,E=dh;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=cd(i.path),_.query=i.query,_.fragment="",E=Gp}break;case i5:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,E=dh;continue}E=HI}else E=GI;break;case s5:if(E=GI,c!="/"||lu(C,S+1)!="/")continue;S++;break;case GI:if(c!="/"&&c!="\\"){E=HI;continue}break;case HI:if(c=="@"){P&&(C="%40"+C),P=!0,u=_v(C);for(var V=0;V<u.length;V++){var j=u[V];if(j!=":"||G){var Y=Am(j,bD);G?_.password+=Y:_.username+=Y}else G=!0}C=""}else if(c==ou||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(P&&C=="")return"Invalid authority";S-=_v(C).length+1,C="",E=RD}else C+=c;break;case RD:case ID:if(r&&_.scheme=="file"){E=OD;continue}if(c!=":"||N){if(c==ou||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&C=="")return T_;if(r&&C==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(C))return h;if(C="",E=Ev,r)return;continue}c=="["?N=!0:c=="]"&&(N=!1),C+=c}else{if(C=="")return T_;if(h=_.parseHost(C))return h;if(C="",E=AD,r==ID)return}break;case AD:if(!ld(SD,c)){if(c==ou||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||r){if(C!=""){var Z=jI(C,10);if(Z>65535)return Y3;_.port=_.isSpecial()&&Z===zI[_.scheme]?null:Z,C=""}if(r)return;E=Ev;continue}return Y3}C+=c;break;case PD:if(_.scheme="file",c=="/"||c=="\\")E=o5;else{if(!i||i.scheme!="file"){E=dh;continue}if(c==ou)_.host=i.host,_.path=cd(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=cd(i.path),_.query="",E=w_;else{if(c!="#"){e5(Xb(cd(o,S),""))||(_.host=i.host,_.path=cd(i.path),_.shortenPath()),E=dh;continue}_.host=i.host,_.path=cd(i.path),_.query=i.query,_.fragment="",E=Gp}}break;case o5:if(c=="/"||c=="\\"){E=OD;break}i&&i.scheme=="file"&&!e5(Xb(cd(o,S),""))&&(Zb(i.path[0],!0)?yv(_.path,i.path[0]):_.host=i.host),E=dh;continue;case OD:if(c==ou||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&Zb(C))E=dh;else if(C==""){if(_.host="",r)return;E=Ev}else{if(h=_.parseHost(C))return h;if(_.host=="localhost"&&(_.host=""),r)return;C="",E=Ev}continue}C+=c;break;case Ev:if(_.isSpecial()){if(E=dh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=ou&&(E=dh,c!="/"))continue}else _.fragment="",E=Gp;else _.query="",E=w_;break;case dh:if(c==ou||c=="/"||c=="\\"&&_.isSpecial()||!r&&(c=="?"||c=="#")){if((m=BI(m=C))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||yv(_.path,"")):Nle(C)?c=="/"||c=="\\"&&_.isSpecial()||yv(_.path,""):(_.scheme=="file"&&!_.path.length&&Zb(C)&&(_.host&&(_.host=""),C=lu(C,0)+":"),yv(_.path,C)),C="",_.scheme=="file"&&(c==ou||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)vle(_.path);c=="?"?(_.query="",E=w_):c=="#"&&(_.fragment="",E=Gp)}else C+=Am(c,Z3);break;case a5:c=="?"?(_.query="",E=w_):c=="#"?(_.fragment="",E=Gp):c!=ou&&(_.path[0]+=Am(c,WI));break;case w_:r||c!="#"?c!=ou&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":Am(c,WI)):(_.fragment="",E=Gp);break;case Gp:c!=ou&&(_.fragment+=Am(c,Q3))}S++}},parseHost:function(e){var r,i,o;if(lu(e,0)=="["){if(lu(e,e.length-1)!="]"||(r=function(c){var u,h,m,_,E,S,C,P=[0,0,0,0,0,0,0,0],N=0,G=null,V=0,j=function(){return lu(c,V)};if(j()==":"){if(lu(c,1)!=":")return;V+=2,G=++N}for(;j();){if(N==8)return;if(j()!=":"){for(u=h=0;h<4&&ld(J3,j());)u=16*u+jI(j(),16),V++,h++;if(j()=="."){if(h==0||(V-=h,N>6))return;for(m=0;j();){if(_=null,m>0){if(!(j()=="."&&m<4))return;V++}if(!ld(SD,j()))return;for(;ld(SD,j());){if(E=jI(j(),10),_===null)_=E;else{if(_==0)return;_=10*_+E}if(_>255)return;V++}P[N]=256*P[N]+_,++m!=2&&m!=4||N++}if(m!=4)return;break}if(j()==":"){if(V++,!j())return}else if(j())return;P[N++]=u}else{if(G!==null)return;V++,G=++N}}if(G!==null)for(S=N-G,N=7;N!=0&&S>0;)C=P[N],P[N--]=P[G+S-1],P[G+--S]=C;else if(N!=8)return;return P}(Jb(e,1,-1)),!r))return T_;this.host=r}else if(this.isSpecial()){if(e=dle(e),ld(Ile,e)||(r=function(c){var u,h,m,_,E,S,C,P=Sle(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=P[m])=="")return c;if(E=10,_.length>1&&lu(_,0)=="0"&&(E=ld(wle,_)?16:8,_=Jb(_,E==8?1:2)),_==="")S=0;else{if(!ld(E==10?Rle:E==8?Cle:J3,_))return c;S=jI(_,E)}yv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=q3(256,5-u))return null}else if(S>255)return null;for(C=Ele(h),m=0;m<h.length;m++)C+=h[m]*q3(256,3-m);return C}(e),r===null))return T_;this.host=r}else{if(ld(Ale,e))return T_;for(r="",i=_v(e),o=0;o<i.length;o++)r+=Am(i[o],WI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return gD(zI,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&Zb(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,E=r+":";return c!==null?(E+="//",e.includesCredentials()&&(E+=i+(o?":"+o:"")+"@"),E+=Qb(c),u!==null&&(E+=":"+u)):r=="file"&&(E+="//"),E+=e.cannotBeABaseURL?h[0]:h.length?"/"+Xb(h,"/"):"",m!==null&&(E+="?"+m),_!==null&&(E+="#"+_),E},setHref:function(e){var r=this.parse(e);if(r)throw yD(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new vv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+Qb(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(zp(e)+":",TD)},getUsername:function(){return this.username},setUsername:function(e){var r=_v(zp(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=Am(r[i],bD)}},getPassword:function(){return this.password},setPassword:function(e){var r=_v(zp(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=Am(r[i],bD)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?Qb(e):Qb(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,RD)},getHostname:function(){var e=this.host;return e===null?"":Qb(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,ID)},getPort:function(){var e=this.port;return e===null?"":zp(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=zp(e))==""?this.port=null:this.parse(e,AD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Xb(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ev))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=zp(e))==""?this.query=null:(lu(e,0)=="?"&&(e=Jb(e,1)),this.query="",this.parse(e,w_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=zp(e))!=""?(lu(e,0)=="#"&&(e=Jb(e,1)),this.fragment="",this.parse(e,Gp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var vv=function(e){var r=lle(this,dc),i=ple(arguments.length,1)>1?arguments[1]:void 0,o=fle(r,new kD(e,!1,i));fD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},dc=vv.prototype,uu=function(e,r){return{get:function(){return FI(this)[e]()},set:r&&function(i){return FI(this)[r](i)},configurable:!0,enumerable:!0}};if(fD&&(cu(dc,"href",uu("serialize","setHref")),cu(dc,"origin",uu("getOrigin")),cu(dc,"protocol",uu("getProtocol","setProtocol")),cu(dc,"username",uu("getUsername","setUsername")),cu(dc,"password",uu("getPassword","setPassword")),cu(dc,"host",uu("getHost","setHost")),cu(dc,"hostname",uu("getHostname","setHostname")),cu(dc,"port",uu("getPort","setPort")),cu(dc,"pathname",uu("getPathname","setPathname")),cu(dc,"search",uu("getSearch","setSearch")),cu(dc,"searchParams",uu("getSearchParams")),cu(dc,"hash",uu("getHash","setHash"))),VI(dc,"toJSON",function(){return FI(this).serialize()},{enumerable:!0}),VI(dc,"toString",function(){return FI(this).serialize()},{enumerable:!0}),Yb){var c5=Yb.createObjectURL,l5=Yb.revokeObjectURL;c5&&VI(vv,"createObjectURL",H3(c5,Yb)),l5&&VI(vv,"revokeObjectURL",H3(l5,Yb))}hle(vv,"URL"),ale({global:!0,forced:!cle,sham:!fD},{URL:vv});var Dle=Wn,Lle=d,xle=yl,u5=Oa,Mle=Z1,d5=un("URL");Dle({target:"URL",stat:!0,forced:!(Mle&&Lle(function(){d5.canParse()}))},{canParse:function(e){var r=xle(arguments.length,1),i=u5(e),o=r<2||arguments[1]===void 0?void 0:u5(arguments[1]);try{return!!new d5(i,o)}catch{return!1}}});var $I=l(_t.URL);let h5=!0,p5=!0;function KI(e,r,i){const o=e.match(r);return o&&o.length>=i&&parseInt(o[i],10)}function C_(e,r,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const _=E=>{const S=i(E);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const _=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Ule(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(h5=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Vle(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(p5=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function f5(){if(typeof window=="object"){if(h5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ND(e,r){p5&&console.warn(e+" is deprecated, please use "+r+" instead.")}function m5(e){return Object.prototype.toString.call(e)==="[object Object]"}function g5(e){var r;return m5(e)?sc(r=Object.keys(e)).call(r,function(i,o){const c=m5(e[o]),u=c?g5(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function DD(e,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?DD(e,e.get(r[o]),i):o.endsWith("Ids")&&r[o].forEach(c=>{DD(e,e.get(c),i)})}))}function _5(e,r,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&DD(e,m,c)})}),c}const y5=f5;function E5(e,r){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const E=typeof h[_]=="object"?h[_]:{ideal:h[_]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const S=function(C,P){return C?C+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(E.ideal!==void 0){m.optional=m.optional||[];let C={};typeof E.ideal=="number"?(C[S("min",_)]=E.ideal,m.optional.push(C),C={},C[S("max",_)]=E.ideal,m.optional.push(C)):(C[S("",_)]=E.ideal,m.optional.push(C))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=E.exact):["min","max"].forEach(C=>{E[C]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(C,_)]=E[C])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(E,S,C){S in E&&!(C in E)&&(E[C]=E[S],delete E[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const E=r.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||E)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(C=>{let P=(C=C.filter(N=>N.kind==="videoinput")).find(N=>S.some(G=>{var V;return st(V=N.label.toLowerCase()).call(V,G)}));return!P&&C.length&&st(S).call(S,"back")&&(P=C[C.length-1]),P&&(h.video.deviceId=_.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),y5("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return y5("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,_){c(h,E=>{i.webkitGetUserMedia(E,m,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(E=>{if(_.audio&&!E.getAudioTracks().length||_.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>dt.reject(u(E))))}}}function v5(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function S5(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else C_(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function b5(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=r(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function T5(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const u=function(m){const _={};return m.result().forEach(E=>{const S={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(C=>{S[C]=E.stat(C)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return r.apply(this,[m,i])}return new dt((m,_)=>{r.apply(this,[function(E){m(h(u(E)))},_])}).then(o,c)}}function w5(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>_5(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),C_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>_5(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?dt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():dt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function C5(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function R5(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return C5(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(E=>this._reverseStreams[E.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(E=>{if(this.getSenders().find(C=>C.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const E=new e.MediaStream(_.getTracks());this._streams[_.id]=E,this._reverseStreams[E.id]=_,_=E}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(C=>{const P=_._reverseStreams[C],N=_._streams[P.id];S=S.replace(new RegExp(N.id,"g"),P.id)}),new RTCSessionDescription({type:E.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(N=>N===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(N=>N.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[E.id];if(P)P.addTrack(_),dt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const N=new e.MediaStream([_]);this._streams[E.id]=N,this._reverseStreams[N.id]=E,this.addStream(N)}return this.getSenders().find(N=>N.track===_)},["createOffer","createAnswer"].forEach(function(_){const E=e.RTCPeerConnection.prototype[_],S={[_](){const C=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[P=>{const N=u(this,P);C[0].apply(null,[N])},P=>{C[1]&&C[1].apply(null,P)},arguments[2]]):E.apply(this,arguments).then(P=>u(this,P))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(C=>{const P=_._reverseStreams[C],N=_._streams[P.id];S=S.replace(new RegExp(P.id,"g"),N.id)}),new RTCSessionDescription({type:E.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(C=>_.track===C)&&(E=this._streams[S])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function LD(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function I5(e,r){C_(e,"negotiationneeded",i=>{const o=i.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var A5=Object.freeze({__proto__:null,fixNegotiationNeeded:I5,shimAddTrackRemoveTrack:R5,shimAddTrackRemoveTrackWithNative:C5,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:b5,shimGetStats:T5,shimGetUserMedia:E5,shimMediaStream:v5,shimOnTrack:S5,shimPeerConnection:LD,shimSenderReceiverGetStats:w5});function P5(e,r){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){ND("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function O5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function xD(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((E,S)=>{m.set(S,Object.assign({},E,{type:i[E.type]||E.type}))})}return m}).then(u,h)}}function k5(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):dt.resolve(new Map)}}function N5(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i}),C_(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function D5(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){ND("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&st(o=r.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function L5(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function x5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function M5(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function U5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function V5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var F5=Object.freeze({__proto__:null,shimAddTransceiver:x5,shimCreateAnswer:V5,shimCreateOffer:U5,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,dt.reject(o)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:M5,shimGetUserMedia:P5,shimOnTrack:O5,shimPeerConnection:xD,shimRTCDataChannel:L5,shimReceiverGetStats:N5,shimRemoveStream:D5,shimSenderGetStats:k5});function j5(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),st(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?st(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const o=r.getTracks();this.getSenders().forEach(c=>{st(o).call(o,c.track)&&this.removeTrack(c)})})}}function B5(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),st(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),r.apply(i,arguments)}}}function W5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],C=i.apply(this,[S]);return E?(C.then(_,E),dt.resolve()):C},r.createAnswer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],C=o.apply(this,[S]);return E?(C.then(_,E),dt.resolve()):C};let m=function(_,E,S){const C=c.apply(this,[_]);return S?(C.then(E,S),dt.resolve()):C};r.setLocalDescription=m,m=function(_,E,S){const C=u.apply(this,[_]);return S?(C.then(E,S),dt.resolve()):C},r.setRemoteDescription=m,m=function(_,E,S){const C=h.apply(this,[_]);return S?(C.then(E,S),dt.resolve()):C},r.addIceCandidate=m}function z5(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,o=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>o(G5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,o,c){r.mediaDevices.getUserMedia(i).then(o,c)}).bind(r))}function G5(e){return e&&e.video!==void 0?Object.assign({},e,{video:g5(e.video)}):e}function H5(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(ND("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new r(i,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function $5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function K5(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function q5(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Y5=Object.freeze({__proto__:null,shimAudioContext:q5,shimCallbacksAPI:W5,shimConstraints:G5,shimCreateOfferLegacy:K5,shimGetUserMedia:z5,shimLocalStreamsAPI:j5,shimRTCIceServerUrls:H5,shimRemoteStreamsAPI:B5,shimTrackEventTransceiver:$5}),X5=`	
\v\f\r \u2028\u2029\uFEFF`,Fle=Ht,jle=Oa,MD=X5,J5=I("".replace),Ble=RegExp("^["+MD+"]+"),Wle=RegExp("(^|[^"+MD+"])["+MD+"]+$"),zle=function(e){return function(r){var i=jle(Fle(r));return 1&e&&(i=J5(i,Ble,"")),2&e&&(i=J5(i,Wle,"$1")),i}},Gle={trim:zle(3)},Hle=eI.PROPER,$le=d,Q5=X5,Kle=Gle.trim;Wn({target:"String",proto:!0,forced:function(e){return $le(function(){return!!Q5[e]()||""[e]()!==""||Hle&&Q5[e].name!==e})}("trim")},{trim:function(){return Kle(this)}});var qle=ic("String").trim,Yle=k,Xle=qle,UD=String.prototype,Jle=function(e){var r=e.trim;return typeof e=="string"||e===UD||Yle(UD,e)&&r===UD.trim?Xle:r},co=l(Jle),Z5={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(i){const o=r.splitSections(i);return o&&o[0]},r.getMediaSections=function(i){const o=r.splitSections(i);return o.shift(),o},r.matchPrefix=function(i,o){return r.splitLines(i).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},r.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(i){const o=r.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:r.matchPrefix(i+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,o){return r.matchPrefix(i+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,o){const c=r.matchPrefix(i+o,"a=ice-ufrag:")[0],u=r.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=r.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(_){const E=r.parseRtpMap(_),S=r.matchPrefix(i,"a=fmtp:"+m+" ");switch(E.parameters=S.length?r.parseFmtp(S[0]):{},E.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(i){const o=[],c=r.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(i,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),_=m.length>0&&m[0].ssrc;let E;const S=r.matchPrefix(i,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(N=>parseInt(N,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(E=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let N={ssrc:_,codecPayloadType:parseInt(P.parameters.apt,10)};_&&E&&(N.rtx={ssrc:E}),o.push(N),u&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(N))}}),o.length===0&&_&&o.push({ssrc:_});let C=r.matchPrefix(i,"b=");return C.length&&(C=C[0].indexOf("b=TIAS:")===0?parseInt(C[0].substring(7),10):C[0].indexOf("b=AS:")===0?1e3*parseInt(C[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=C})),o},r.parseRtcpParameters=function(i){const o={},c=r.matchPrefix(i,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},r.parseMsid=function(i){let o;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(i){const o=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(i,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},r.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,o){const c=r.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const o=r.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(i){const o=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=r.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=r})(Z5);var eB=Z5.exports,Sv=l(eB),Qle=s({__proto__:null,default:Sv},[eB]);function qI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new r(i),c=Sv.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(i)},e.RTCIceCandidate.prototype=r.prototype,C_(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function VD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||C_(e,"icecandidate",r=>{if(r.candidate){const i=Sv.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function YI(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const _=Sv.splitSections(m.sdp);return _.shift(),_.some(E=>{const S=Sv.parseMLine(E);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const E=parseInt(_[1],10);return E!=E?-1:E},c=function(m){let _=65536;return r.browser==="firefox"&&(_=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),_},u=function(m,_){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const S=Sv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?E=parseInt(S[0].substr(19),10):r.browser==="firefox"&&_!==-1&&(E=2147483637),E},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=o(arguments[0]),_=c(m),E=u(arguments[0],m);let S;S=_===0&&E===0?Number.POSITIVE_INFINITY:_===0||E===0?Math.max(_,E):Math.min(_,E);const C={};Object.defineProperty(C,"maxMessageSize",{get:()=>S}),this._sctp=C}return h.apply(this,arguments)}}function XI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return r(o,this),o},C_(e,"datachannel",o=>(r(o.channel,o.target),o))}function FD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function jD(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>co(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function JI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?dt.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),dt.resolve())})}function QI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Zle=Object.freeze({__proto__:null,removeExtmapAllowMixed:jD,shimAddIceCandidateNullOrEmpty:JI,shimConnectionState:FD,shimMaxMessageSize:YI,shimParameterlessSetLocalDescription:QI,shimRTCIceCandidate:qI,shimRTCIceCandidateRelayProtocol:VD,shimSendThrowTypeError:XI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=f5,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=KI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=KI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=KI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:Zle,extractVersion:KI,disableLog:Ule,disableWarnings:Vle,sdp:Qle};switch(o.browser){case"chrome":if(!A5||!LD||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=A5,JI(e,o),QI(e),E5(e,o),v5(e),LD(e,o),S5(e),R5(e,o),b5(e),T5(e),w5(e),I5(e,o),qI(e),VD(e),FD(e),YI(e,o),XI(e),jD(e,o);break;case"firefox":if(!F5||!xD||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=F5,JI(e,o),QI(e),P5(e,o),xD(e,o),O5(e),D5(e),k5(e),N5(e),L5(e),x5(e),M5(e),U5(e),V5(e),qI(e),FD(e),YI(e,o),XI(e);break;case"safari":if(!Y5||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=Y5,JI(e,o),QI(e),H5(e),K5(e),W5(e),j5(e),B5(e),$5(e),z5(e),q5(e),qI(e),VD(e),YI(e,o),XI(e),jD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var tB=_s,eue=TypeError,nB=bt.match(/firefox\/(\d+)/i),tue=!!nB&&+nB[1],nue=/MSIE|Trident/.test(bt),rB=bt.match(/AppleWebKit\/(\d+)\./),rue=!!rB&&+rB[1],iue=Wn,iB=I,sue=ys,oue=Bo,sB=hi,aue=function(e,r){if(!delete e[r])throw eue("Cannot delete property "+tB(r)+" of "+tB(e))},oB=Oa,BD=d,cue=g3,lue=Sp,aB=tue,uue=nue,cB=ii,lB=rue,Pm=[],uB=iB(Pm.sort),due=iB(Pm.push),hue=BD(function(){Pm.sort(void 0)}),pue=BD(function(){Pm.sort(null)}),fue=lue("sort"),dB=!BD(function(){if(cB)return cB<70;if(!(aB&&aB>3)){if(uue)return!0;if(lB)return lB<603;var e,r,i,o,c="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)Pm.push({k:r+o,v:i})}for(Pm.sort(function(u,h){return h.v-u.v}),o=0;o<Pm.length;o++)r=Pm[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});iue({target:"Array",proto:!0,forced:hue||!pue||!fue||!dB},{sort:function(e){e!==void 0&&sue(e);var r=oue(this);if(dB)return e===void 0?uB(r):uB(r,e);var i,o,c=[],u=sB(r);for(o=0;o<u;o++)o in r&&due(c,r[o]);for(cue(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:oB(m)>oB(_)?1:-1}}(e)),i=sB(c),o=0;o<i;)r[o]=c[o++];for(;o<u;)aue(r,o++);return r}});var mue=ic("Array").sort,gue=k,_ue=mue,WD=Array.prototype,yue=function(e){var r=e.sort;return e===WD||gue(WD,e)&&r===WD.sort?_ue:r},eT=l(yue),zD=F;Wn({global:!0,forced:zD.globalThis!==zD},{globalThis:zD});var hB=l(F),GD={exports:{}};(function(e,r){(function(i,o){var c="function",u="undefined",h="object",m="string",_="major",E="model",S="name",C="type",P="vendor",N="version",G="architecture",V="console",j="mobile",Y="tablet",Z="smarttv",de="wearable",Se="embedded",Te="Amazon",ye="Apple",Ne="ASUS",Ye="BlackBerry",ht="Browser",ft="Chrome",Sn="Firefox",bn="Google",pr="Huawei",ai="LG",$r="Microsoft",ua="Motorola",je="Opera",it="Samsung",Tt="Sharp",He="Sony",M="Xiaomi",ae="Zebra",he="Facebook",Qe="Chromium OS",Xt="Mac OS",sr=function(Ii){for(var qi={},wr=0;wr<Ii.length;wr++)qi[Ii[wr].toUpperCase()]=Ii[wr];return qi},Ki=function(Ii,qi){return typeof Ii===m&&za(qi).indexOf(za(Ii))!==-1},za=function(Ii){return Ii.toLowerCase()},cf=function(Ii,qi){if(typeof Ii===m)return Ii=Ii.replace(/^\s\s*/,""),typeof qi===u?Ii:Ii.substring(0,350)},ny=function(Ii,qi){for(var wr,fc,Oh,ci,Hn,Ga,Jm=0;Jm<qi.length&&!Hn;){var Td=qi[Jm],F$=qi[Jm+1];for(wr=fc=0;wr<Td.length&&!Hn&&Td[wr];)if(Hn=Td[wr++].exec(Ii))for(Oh=0;Oh<F$.length;Oh++)Ga=Hn[++fc],typeof(ci=F$[Oh])===h&&ci.length>0?ci.length===2?typeof ci[1]==c?this[ci[0]]=ci[1].call(this,Ga):this[ci[0]]=ci[1]:ci.length===3?typeof ci[1]!==c||ci[1].exec&&ci[1].test?this[ci[0]]=Ga?Ga.replace(ci[1],ci[2]):o:this[ci[0]]=Ga?ci[1].call(this,Ga,ci[2]):o:ci.length===4&&(this[ci[0]]=Ga?ci[3].call(this,Ga.replace(ci[1],ci[2])):o):this[ci]=Ga||o;Jm+=2}},rw=function(Ii,qi){for(var wr in qi)if(typeof qi[wr]===h&&qi[wr].length>0){for(var fc=0;fc<qi[wr].length;fc++)if(Ki(qi[wr][fc],Ii))return wr==="?"?o:wr}else if(Ki(qi[wr],Ii))return wr==="?"?o:wr;return Ii},YP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},XP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,N],[/opios[\/ ]+([\w\.]+)/i],[N,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[N,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,N],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[S,"UC"+ht]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[N,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[N,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[N,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+ht],N],[/\bfocus\/([\w\.]+)/i],[N,[S,Sn+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[S,"MIUI "+ht]],[/fxios\/([-\w\.]+)/i],[N,[S,Sn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+ht]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+ht],N],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,N],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,he],N],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[S,ft+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,ft+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[S,"Android "+ht]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[N,rw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[S,Sn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,N],[/(cobalt)\/([\w\.]+)/i],[S,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,za]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",za]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,za]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[P,it],[C,Y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[E,[P,it],[C,j]],[/\((ip(?:hone|od)[\w ]*);/i],[E,[P,ye],[C,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[P,ye],[C,Y]],[/(macintosh);/i],[E,[P,ye]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[P,Tt],[C,j]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[P,pr],[C,Y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[P,pr],[C,j]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[E,/_/g," "],[P,M],[C,j]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[P,M],[C,Y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[P,"OPPO"],[C,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[P,"Vivo"],[C,j]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[E,[P,"Realme"],[C,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[P,ua],[C,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[P,ua],[C,Y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[P,ai],[C,Y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[P,ai],[C,j]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[P,"Lenovo"],[C,Y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[P,"Nokia"],[C,j]],[/(pixel c)\b/i],[E,[P,bn],[C,Y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[P,bn],[C,j]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[P,He],[C,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[P,He],[C,Y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[P,"OnePlus"],[C,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[P,Te],[C,Y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[P,Te],[C,j]],[/(playbook);[-\w\),; ]+(rim)/i],[E,P,[C,Y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[P,Ye],[C,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[P,Ne],[C,Y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[P,Ne],[C,j]],[/(nexus 9)/i],[E,[P,"HTC"],[C,Y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[E,/_/g," "],[C,j]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[P,"Acer"],[C,Y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[P,"Meizu"],[C,j]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,E,[C,j]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,E,[C,Y]],[/(surface duo)/i],[E,[P,$r],[C,Y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[P,"Fairphone"],[C,j]],[/(u304aa)/i],[E,[P,"AT&T"],[C,j]],[/\bsie-(\w*)/i],[E,[P,"Siemens"],[C,j]],[/\b(rct\w+) b/i],[E,[P,"RCA"],[C,Y]],[/\b(venue[\d ]{2,7}) b/i],[E,[P,"Dell"],[C,Y]],[/\b(q(?:mv|ta)\w+) b/i],[E,[P,"Verizon"],[C,Y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[P,"Barnes & Noble"],[C,Y]],[/\b(tm\d{3}\w+) b/i],[E,[P,"NuVision"],[C,Y]],[/\b(k88) b/i],[E,[P,"ZTE"],[C,Y]],[/\b(nx\d{3}j) b/i],[E,[P,"ZTE"],[C,j]],[/\b(gen\d{3}) b.+49h/i],[E,[P,"Swiss"],[C,j]],[/\b(zur\d{3}) b/i],[E,[P,"Swiss"],[C,Y]],[/\b((zeki)?tb.*\b) b/i],[E,[P,"Zeki"],[C,Y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],E,[C,Y]],[/\b(ns-?\w{0,9}) b/i],[E,[P,"Insignia"],[C,Y]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[P,"NextBook"],[C,Y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],E,[C,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],E,[C,j]],[/\b(ph-1) /i],[E,[P,"Essential"],[C,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[P,"Envizen"],[C,Y]],[/\b(trio[-\w\. ]+) b/i],[E,[P,"MachSpeed"],[C,Y]],[/\btu_(1491) b/i],[E,[P,"Rotor"],[C,Y]],[/(shield[\w ]+) b/i],[E,[P,"Nvidia"],[C,Y]],[/(sprint) (\w+)/i],[P,E,[C,j]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[P,$r],[C,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[P,ae],[C,Y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[P,ae],[C,j]],[/smart-tv.+(samsung)/i],[P,[C,Z]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[P,it],[C,Z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,ai],[C,Z]],[/(apple) ?tv/i],[P,[E,ye+" TV"],[C,Z]],[/crkey/i],[[E,ft+"cast"],[P,bn],[C,Z]],[/droid.+aft(\w)( bui|\))/i],[E,[P,Te],[C,Z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[P,Tt],[C,Z]],[/(bravia[\w ]+)( bui|\))/i],[E,[P,He],[C,Z]],[/(mitv-\w{5}) bui/i],[E,[P,M],[C,Z]],[/Hbbtv.*(technisat) (.*);/i],[P,E,[C,Z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,cf],[E,cf],[C,Z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[C,Z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,E,[C,V]],[/droid.+; (shield) bui/i],[E,[P,"Nvidia"],[C,V]],[/(playstation [345portablevi]+)/i],[E,[P,He],[C,V]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[P,$r],[C,V]],[/((pebble))app/i],[P,E,[C,de]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[P,ye],[C,de]],[/droid.+; (glass) \d/i],[E,[P,bn],[C,de]],[/droid.+; (wt63?0{2,3})\)/i],[E,[P,ae],[C,de]],[/(quest( 2| pro)?)/i],[E,[P,he],[C,de]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[C,Se]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[E,[C,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[C,Y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[C,Y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[C,j]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,N],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[N,rw,YP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[N,rw,YP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Xt],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,N],[/\(bb(10);/i],[N,[S,Ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[S,Sn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[S,ft+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Qe],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,N],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,N]]},Ol=function(Ii,qi){if(typeof Ii===h&&(qi=Ii,Ii=o),!(this instanceof Ol))return new Ol(Ii,qi).getResult();var wr=typeof i!==u&&i.navigator?i.navigator:o,fc=Ii||(wr&&wr.userAgent?wr.userAgent:""),Oh=wr&&wr.userAgentData?wr.userAgentData:o,ci=qi?function(Hn,Ga){var Jm={};for(var Td in Hn)Ga[Td]&&Ga[Td].length%2==0?Jm[Td]=Ga[Td].concat(Hn[Td]):Jm[Td]=Hn[Td];return Jm}(XP,qi):XP;return this.getBrowser=function(){var Hn={};return Hn[S]=o,Hn[N]=o,ny.call(Hn,fc,ci.browser),Hn[_]=function(Ga){return typeof Ga===m?Ga.replace(/[^\d\.]/g,"").split(".")[0]:o}(Hn[N]),wr&&wr.brave&&typeof wr.brave.isBrave==c&&(Hn[S]="Brave"),Hn},this.getCPU=function(){var Hn={};return Hn[G]=o,ny.call(Hn,fc,ci.cpu),Hn},this.getDevice=function(){var Hn={};return Hn[P]=o,Hn[E]=o,Hn[C]=o,ny.call(Hn,fc,ci.device),!Hn[C]&&Oh&&Oh.mobile&&(Hn[C]=j),Hn[E]=="Macintosh"&&wr&&typeof wr.standalone!==u&&wr.maxTouchPoints&&wr.maxTouchPoints>2&&(Hn[E]="iPad",Hn[C]=Y),Hn},this.getEngine=function(){var Hn={};return Hn[S]=o,Hn[N]=o,ny.call(Hn,fc,ci.engine),Hn},this.getOS=function(){var Hn={};return Hn[S]=o,Hn[N]=o,ny.call(Hn,fc,ci.os),!Hn[S]&&Oh&&Oh.platform!="Unknown"&&(Hn[S]=Oh.platform.replace(/chrome os/i,Qe).replace(/macos/i,Xt)),Hn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return fc},this.setUA=function(Hn){return fc=typeof Hn===m&&Hn.length>350?cf(Hn,350):Hn,this},this.setUA(fc),this};Ol.VERSION="0.7.34",Ol.BROWSER=sr([S,N,_]),Ol.CPU=sr([G]),Ol.DEVICE=sr([E,P,C,V,j,Z,Y,de,Se]),Ol.ENGINE=Ol.OS=sr([S,N]),e.exports&&(r=e.exports=Ol),r.UAParser=Ol;var Xm=typeof i!==u&&(i.jQuery||i.Zepto);if(Xm&&!Xm.ua){var ry=new Ol;Xm.ua=ry.getResult(),Xm.ua.get=function(){return ry.getUA()},Xm.ua.set=function(Ii){ry.setUA(Ii);var qi=ry.getResult();for(var wr in qi)Xm.ua[wr]=qi[wr]}}})(typeof window=="object"?window:a)})(GD,GD.exports);var Eue=l(GD.exports),vue=Pc,Sue=Si,bue=Mt,Tue=Qd,wue=gr("iterator"),Cue=Object,Rue=function(e){if(bue(e))return!1;var r=Cue(e);return r[wue]!==void 0||"@@iterator"in r||Sue(Tue,vue(r))},Iue=l(Rue),pB=JE.clear;Wn({global:!0,bind:!0,forced:F.clearImmediate!==pB},{clearImmediate:pB});var Aue=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",fB=F,Pue=ie,Oue=Le,kue=Aue,Nue=bt,Due=Ts,Lue=yl,xue=fB.Function,Mue=/MSIE .\./.test(Nue)||kue&&function(){var e=fB.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),Uue=Wn,mB=F,gB=JE.set,Vue=function(e,r){var i=1;return Mue?function(o,c){var u=Lue(arguments.length,1)>i,h=Oue(o)?o:xue(o),m=u?Due(arguments,i):[],_=u?function(){Pue(h,this,m)}:h;return e(_)}:e},_B=mB.setImmediate?Vue(gB):gB;Uue({global:!0,bind:!0,forced:mB.setImmediate!==_B},{setImmediate:_B});var yB=l(_t.setImmediate),Fue=Wn,jue=lc,Bue=ys,Wue=yl,zue=bp,Gue=F.process;Fue({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){Wue(arguments.length,1),Bue(e);var r=zue&&Gue.domain;jue(r?r.bind(e):e)}});var EB=l(_t.queueMicrotask);function vB(e,r){return function(){return e.apply(r,arguments)}}const{toString:Hue}=Object.prototype,{getPrototypeOf:HD}=Object,ZI=($D=Object.create(null),e=>{const r=Hue.call(e);return $D[r]||($D[r]=r.slice(8,-1).toLowerCase())});var $D;const ud=e=>(e=e.toLowerCase(),r=>ZI(r)===e),eA=e=>r=>typeof r===e,{isArray:bv}=Array,tT=eA("undefined"),SB=ud("ArrayBuffer"),$ue=eA("string"),vl=eA("function"),bB=eA("number"),tA=e=>e!==null&&typeof e=="object",nA=e=>{if(ZI(e)!=="object")return!1;const r=HD(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||Iue(e))},Kue=ud("Date"),que=ud("File"),Yue=ud("Blob"),Xue=ud("FileList"),Jue=ud("URLSearchParams"),[Que,Zue,ede,tde]=["ReadableStream","Request","Response","Headers"].map(ud);function nT(e,r){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),bv(e))for(i=0,o=e.length;i<o;i++)r.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(i=0;i<h;i++)m=u[i],r.call(null,e[m],m,e)}}function TB(e,r){r=r.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],r===o.toLowerCase())return o;return null}const R_=hB!==void 0?hB:typeof self<"u"?self:typeof window<"u"?window:dy,wB=e=>!tT(e)&&e!==R_,nde=(KD=typeof Uint8Array<"u"&&HD(Uint8Array),e=>KD&&e instanceof KD);var KD;const rde=ud("HTMLFormElement"),CB=(e=>{let{hasOwnProperty:r}=e;return(i,o)=>r.call(i,o)})(Object.prototype),ide=ud("RegExp"),RB=(e,r)=>{const i=Object.getOwnPropertyDescriptors(e),o={};nT(i,(c,u)=>{let h;(h=r(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},qD="abcdefghijklmnopqrstuvwxyz",IB="0123456789",AB={DIGIT:IB,ALPHA:qD,ALPHA_DIGIT:qD+qD.toUpperCase()+IB},sde=ud("AsyncFunction"),PB=(OB=typeof yB=="function",kB=vl(R_.postMessage),OB?yB:kB?(YD="axios@".concat(Math.random()),rA=[],R_.addEventListener("message",e=>{let{source:r,data:i}=e;r===R_&&i===YD&&rA.length&&rA.shift()()},!1),e=>{rA.push(e),R_.postMessage(YD,"*")}):e=>setTimeout(e));var OB,kB,YD,rA;const ode=EB!==void 0?EB.bind(R_):typeof process<"u"&&process.nextTick||PB;var lt={isArray:bv,isArrayBuffer:SB,isBuffer:function(e){return e!==null&&!tT(e)&&e.constructor!==null&&!tT(e.constructor)&&vl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||vl(e.append)&&((r=ZI(e))==="formdata"||r==="object"&&vl(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&SB(e.buffer),r},isString:$ue,isNumber:bB,isBoolean:e=>e===!0||e===!1,isObject:tA,isPlainObject:nA,isReadableStream:Que,isRequest:Zue,isResponse:ede,isHeaders:tde,isUndefined:tT,isDate:Kue,isFile:que,isBlob:Yue,isRegExp:ide,isFunction:vl,isStream:e=>tA(e)&&vl(e.pipe),isURLSearchParams:Jue,isTypedArray:nde,isFileList:Xue,forEach:nT,merge:function e(){const{caseless:r}=wB(this)&&this||{},i={},o=(c,u)=>{const h=r&&TB(i,u)||u;nA(i[h])&&nA(c)?i[h]=e(i[h],c):nA(c)?i[h]=e({},c):bv(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&nT(arguments[c],o);return i},extend:function(e,r,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return nT(r,(c,u)=>{i&&vl(c)?e[u]=vB(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>co(e)?co(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,i,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,r,i,o)=>{let c,u,h;const m={};if(r=r||{},e==null)return r;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,r)||m[h]||(r[h]=e[h],m[h]=!0);e=i!==!1&&HD(e)}while(e&&(!i||i(e,r))&&e!==Object.prototype);return r},kindOf:ZI,kindOfTest:ud,endsWith:(e,r,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=r.length;const o=e.indexOf(r,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(bv(e))return e;let r=e.length;if(!bB(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=e[r];return i},forEachEntry:(e,r)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;r.call(e,c[0],c[1])}},matchAll:(e,r)=>{let i;const o=[];for(;(i=e.exec(r))!==null;)o.push(i);return o},isHTMLForm:rde,hasOwnProperty:CB,hasOwnProp:CB,reduceDescriptors:RB,freezeMethods:e=>{RB(e,(r,i)=>{if(vl(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];vl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,r)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return bv(e)?o(e):o(String(e).split(r)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:TB,global:R_,isContextDefined:wB,ALPHABET:AB,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:AB.ALPHA_DIGIT,i="";const{length:o}=r;for(;e--;)i+=r[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&vl(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const r=new Array(10),i=(o,c)=>{if(tA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=bv(o)?[]:{};return nT(o,(h,m)=>{const _=i(h,c+1);!tT(_)&&(u[m]=_)}),r[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:sde,isThenable:e=>e&&(tA(e)||vl(e))&&vl(e.then)&&vl(e.catch),setImmediate:PB,asap:ode};function rr(e,r,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}lt.inherits(rr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:lt.toJSONObject(this.config),code:this.code,status:this.status}}});const NB=rr.prototype,DB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{DB[e]={value:e}}),Object.defineProperties(rr,DB),Object.defineProperty(NB,"isAxiosError",{value:!0}),rr.from=(e,r,i,o,c,u)=>{const h=Object.create(NB);return lt.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),rr.call(h,e.message,r,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function XD(e){return lt.isPlainObject(e)||lt.isArray(e)}function LB(e){return lt.endsWith(e,"[]")?e.slice(0,-2):e}function xB(e,r,i){return e?e.concat(r).map(function(o,c){return o=LB(o),!i&&c?"["+o+"]":o}).join(i?".":""):r}const ade=lt.toFlatObject(lt,{},null,function(e){return/^is[A-Z]/.test(e)});function iA(e,r,i){if(!lt.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const o=(i=lt.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,N){return!lt.isUndefined(N[P])})).metaTokens,c=i.visitor||E,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&lt.isSpecCompliantForm(r);if(!lt.isFunction(c))throw new TypeError("visitor must be a function");function _(P){if(P===null)return"";if(lt.isDate(P))return P.toISOString();if(!m&&lt.isBlob(P))throw new rr("Blob is not supported. Use a Buffer instead.");return lt.isArrayBuffer(P)||lt.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function E(P,N,G){let V=P;if(P&&!G&&typeof P=="object"){if(lt.endsWith(N,"{}"))N=o?N:N.slice(0,-2),P=JSON.stringify(P);else if(lt.isArray(P)&&function(j){return lt.isArray(j)&&!j.some(XD)}(P)||(lt.isFileList(P)||lt.endsWith(N,"[]"))&&(V=lt.toArray(P)))return N=LB(N),V.forEach(function(j,Y){!lt.isUndefined(j)&&j!==null&&r.append(h===!0?xB([N],Y,u):h===null?N:N+"[]",_(j))}),!1}return!!XD(P)||(r.append(xB(G,N,u),_(P)),!1)}const S=[],C=Object.assign(ade,{defaultVisitor:E,convertValue:_,isVisitable:XD});if(!lt.isObject(e))throw new TypeError("data must be an object");return function P(N,G){if(!lt.isUndefined(N)){if(S.indexOf(N)!==-1)throw Error("Circular reference detected in "+G.join("."));S.push(N),lt.forEach(N,function(V,j){(!(lt.isUndefined(V)||V===null)&&c.call(r,V,lt.isString(j)?co(j).call(j):j,G,C))===!0&&P(V,G?G.concat(j):[j])}),S.pop()}}(e),r}function MB(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function JD(e,r){this._pairs=[],e&&iA(e,this,r)}const UB=JD.prototype;function cde(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function VB(e,r,i){if(!r)return e;const o=i&&i.encode||cde;lt.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(r,i):lt.isURLSearchParams(r)?r.toString():new JD(r,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}UB.append=function(e,r){this._pairs.push([e,r])},UB.toString=function(e){const r=e?function(i){return e.call(this,i,MB)}:MB;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var FB=class{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){lt.forEach(this.handlers,function(r){r!==null&&e(r)})}},jB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},BB={exports:{}},lde=Wn,ude=$e,WB=nt.f;lde({target:"Object",stat:!0,forced:Object.defineProperty!==WB,sham:!ude},{defineProperty:WB});var zB=_t.Object,dde=BB.exports=function(e,r,i){return zB.defineProperty(e,r,i)};zB.defineProperty.sham&&(dde.sham=!0);var GB=l(BB.exports),hde=TypeError,HB=Gg,pde=p_,fde=ot,mde=gr("species"),$B=Array,gde=function(e){var r;return HB(e)&&(r=e.constructor,(pde(r)&&(r===$B||HB(r.prototype))||fde(r)&&(r=r[mde])===null)&&(r=void 0)),r===void 0?$B:r},KB=function(e,r){return new(gde(e))(r===0?0:r)},_de=d,yde=ii,Ede=gr("species"),qB=function(e){return yde>=51||!_de(function(){var r=[];return(r.constructor={})[Ede]=function(){return{foo:1}},r[e](Boolean).foo!==1})},vde=Wn,Sde=d,bde=Gg,Tde=ot,wde=Bo,Cde=hi,YB=function(e){if(e>9007199254740991)throw hde("Maximum allowed index exceeded");return e},XB=LI,Rde=KB,Ide=qB,Ade=ii,JB=gr("isConcatSpreadable"),Pde=Ade>=51||!Sde(function(){var e=[];return e[JB]=!1,e.concat()[0]!==e}),Ode=function(e){if(!Tde(e))return!1;var r=e[JB];return r!==void 0?!!r:bde(e)};vde({target:"Array",proto:!0,forced:!Pde||!Ide("concat")},{concat:function(e){var r,i,o,c,u,h=wde(this),m=Rde(h,0),_=0;for(r=-1,o=arguments.length;r<o;r++)if(Ode(u=r===-1?h:arguments[r]))for(c=Cde(u),YB(_+c),i=0;i<c;i++,_++)i in u&&XB(m,_,u[i]);else YB(_+1),XB(m,_++,u);return m.length=_,m}});var QB={},kde=q,Nde=Re,ZB=Yd.f,Dde=eD,e6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];QB.f=function(e){return e6&&kde(e)=="Window"?function(r){try{return ZB(r)}catch{return Dde(e6)}}(e):ZB(Nde(e))};var Tv={},Lde=gr;Tv.f=Lde;var t6=_t,xde=Si,Mde=Tv,Ude=nt.f,Rs=function(e){var r=t6.Symbol||(t6.Symbol={});xde(r,e)||Ude(r,e,{value:Mde.f(e)})},Vde=Ee,Fde=un,jde=gr,Bde=nd,n6=function(){var e=Fde("Symbol"),r=e&&e.prototype,i=r&&r.valueOf,o=jde("toPrimitive");r&&!r[o]&&Bde(r,o,function(c){return Vde(i,this)},{})},Wde=De,zde=sn,Gde=Bo,Hde=hi,$de=KB,r6=I([].push),Kde=function(e){var r=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,E,S,C){for(var P,N,G=Gde(_),V=zde(G),j=Wde(E,S),Y=Hde(V),Z=0,de=C||$de,Se=r?de(_,Y):i||h?de(_,0):void 0;Y>Z;Z++)if((m||Z in V)&&(N=j(P=V[Z],Z,G),e))if(r)Se[Z]=N;else if(N)switch(e){case 3:return!0;case 5:return P;case 6:return Z;case 2:r6(Se,P)}else switch(e){case 4:return!1;case 7:r6(Se,P)}return u?-1:o||c?c:Se}},i6={forEach:Kde(0)},sA=Wn,QD=F,ZD=Ee,qde=I,wv=$e,Cv=xi,Yde=d,Io=Si,Xde=k,eL=hn,oA=Re,tL=nc,Jde=Oa,nL=Je,rT=Zo,s6=Nc,Qde=Yd,o6=QB,Zde=kc,a6=We,c6=nt,ehe=uE,l6=ke,u6=nd,the=ME,rL=ec,d6=Oc,h6=Wd,nhe=gr,rhe=Tv,ihe=Rs,she=n6,ohe=rd,p6=td,aA=i6.forEach,Bc=$g("hidden"),cA="Symbol",iT="prototype",ahe=p6.set,f6=p6.getterFor(cA),dd=Object[iT],I_=QD.Symbol,lA=I_&&I_[iT],che=QD.TypeError,iL=QD.QObject,m6=a6.f,A_=c6.f,g6=o6.f,lhe=l6.f,_6=qde([].push),Hp=rL("symbols"),sT=rL("op-symbols"),uhe=rL("wks"),sL=!iL||!iL[iT]||!iL[iT].findChild,oL=wv&&Yde(function(){return rT(A_({},"a",{get:function(){return A_(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=m6(dd,r);o&&delete dd[r],A_(e,r,i),o&&e!==dd&&A_(dd,r,o)}:A_,aL=function(e,r){var i=Hp[e]=rT(lA);return ahe(i,{type:cA,tag:e,description:r}),wv||(i.description=r),i},uA=function(e,r,i){e===dd&&uA(sT,r,i),eL(e);var o=tL(r);return eL(i),Io(Hp,o)?(i.enumerable?(Io(e,Bc)&&e[Bc][o]&&(e[Bc][o]=!1),i=rT(i,{enumerable:nL(0,!1)})):(Io(e,Bc)||A_(e,Bc,nL(1,{})),e[Bc][o]=!0),oL(e,o,i)):A_(e,o,i)},cL=function(e,r){eL(e);var i=oA(r),o=s6(i).concat(S6(i));return aA(o,function(c){wv&&!ZD(y6,i,c)||uA(e,c,i[c])}),e},y6=function(e){var r=tL(e),i=ZD(lhe,this,r);return!(this===dd&&Io(Hp,r)&&!Io(sT,r))&&(!(i||!Io(this,r)||!Io(Hp,r)||Io(this,Bc)&&this[Bc][r])||i)},E6=function(e,r){var i=oA(e),o=tL(r);if(i!==dd||!Io(Hp,o)||Io(sT,o)){var c=m6(i,o);return!c||!Io(Hp,o)||Io(i,Bc)&&i[Bc][o]||(c.enumerable=!0),c}},v6=function(e){var r=g6(oA(e)),i=[];return aA(r,function(o){Io(Hp,o)||Io(d6,o)||_6(i,o)}),i},S6=function(e){var r=e===dd,i=g6(r?sT:oA(e)),o=[];return aA(i,function(c){!Io(Hp,c)||r&&!Io(dd,c)||_6(o,Hp[c])}),o};Cv||(I_=function(){if(Xde(lA,this))throw che("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Jde(arguments[0]):void 0,r=h6(e),i=function(o){this===dd&&ZD(i,sT,o),Io(this,Bc)&&Io(this[Bc],r)&&(this[Bc][r]=!1),oL(this,r,nL(1,o))};return wv&&sL&&oL(dd,r,{configurable:!0,set:i}),aL(r,e)},u6(lA=I_[iT],"toString",function(){return f6(this).tag}),u6(I_,"withoutSetter",function(e){return aL(h6(e),e)}),l6.f=y6,c6.f=uA,ehe.f=cL,a6.f=E6,Qde.f=o6.f=v6,Zde.f=S6,rhe.f=function(e){return aL(nhe(e),e)},wv&&the(lA,"description",{configurable:!0,get:function(){return f6(this).description}})),sA({global:!0,wrap:!0,forced:!Cv,sham:!Cv},{Symbol:I_}),aA(s6(uhe),function(e){ihe(e)}),sA({target:cA,stat:!0,forced:!Cv},{useSetter:function(){sL=!0},useSimple:function(){sL=!1}}),sA({target:"Object",stat:!0,forced:!Cv,sham:!wv},{create:function(e,r){return r===void 0?rT(e):cL(rT(e),r)},defineProperty:uA,defineProperties:cL,getOwnPropertyDescriptor:E6}),sA({target:"Object",stat:!0,forced:!Cv},{getOwnPropertyNames:v6}),she(),ohe(I_,cA),d6[Bc]=!0;var b6=xi&&!!Symbol.for&&!!Symbol.keyFor,dhe=Wn,hhe=un,phe=Si,fhe=Oa,T6=ec,mhe=b6,lL=T6("string-to-symbol-registry"),ghe=T6("symbol-to-string-registry");dhe({target:"Symbol",stat:!0,forced:!mhe},{for:function(e){var r=fhe(e);if(phe(lL,r))return lL[r];var i=hhe("Symbol")(r);return lL[r]=i,ghe[i]=r,i}});var _he=Wn,yhe=Si,Ehe=Ta,vhe=_s,She=b6,w6=ec("symbol-to-string-registry");_he({target:"Symbol",stat:!0,forced:!She},{keyFor:function(e){if(!Ehe(e))throw TypeError(vhe(e)+" is not a symbol");if(yhe(w6,e))return w6[e]}});var C6=Gg,bhe=Le,R6=q,The=Oa,I6=I([].push),whe=Wn,A6=un,P6=ie,Che=Ee,oT=I,O6=d,k6=Le,N6=Ta,D6=Ts,Rhe=function(e){if(bhe(e))return e;if(C6(e)){for(var r=e.length,i=[],o=0;o<r;o++){var c=e[o];typeof c=="string"?I6(i,c):typeof c!="number"&&R6(c)!="Number"&&R6(c)!="String"||I6(i,The(c))}var u=i.length,h=!0;return function(m,_){if(h)return h=!1,_;if(C6(this))return _;for(var E=0;E<u;E++)if(i[E]===m)return _}}},Ihe=xi,Ahe=String,Om=A6("JSON","stringify"),dA=oT(/./.exec),L6=oT("".charAt),Phe=oT("".charCodeAt),Ohe=oT("".replace),khe=oT(1 .toString),Nhe=/[\uD800-\uDFFF]/g,x6=/^[\uD800-\uDBFF]$/,M6=/^[\uDC00-\uDFFF]$/,U6=!Ihe||O6(function(){var e=A6("Symbol")();return Om([e])!="[null]"||Om({a:e})!="{}"||Om(Object(e))!="{}"}),V6=O6(function(){return Om("\uDF06\uD834")!=='"\\udf06\\ud834"'||Om("\uDEAD")!=='"\\udead"'}),Dhe=function(e,r){var i=D6(arguments),o=Rhe(r);if(k6(o)||e!==void 0&&!N6(e))return i[1]=function(c,u){if(k6(o)&&(u=Che(o,this,Ahe(c),u)),!N6(u))return u},P6(Om,null,i)},Lhe=function(e,r,i){var o=L6(i,r-1),c=L6(i,r+1);return dA(x6,e)&&!dA(M6,c)||dA(M6,e)&&!dA(x6,o)?"\\u"+khe(Phe(e,0),16):e};Om&&whe({target:"JSON",stat:!0,forced:U6||V6},{stringify:function(e,r,i){var o=D6(arguments),c=P6(U6?Dhe:Om,null,o);return V6&&typeof c=="string"?Ohe(c,Nhe,Lhe):c}});var F6=kc,xhe=Bo;Wn({target:"Object",stat:!0,forced:!xi||d(function(){F6.f(1)})},{getOwnPropertySymbols:function(e){var r=F6.f;return r?r(xhe(e)):[]}}),Rs("asyncIterator"),Rs("hasInstance"),Rs("isConcatSpreadable"),Rs("iterator"),Rs("match"),Rs("matchAll"),Rs("replace"),Rs("search"),Rs("species"),Rs("split");var Mhe=n6;Rs("toPrimitive"),Mhe();var Uhe=un,Vhe=rd;Rs("toStringTag"),Vhe(Uhe("Symbol"),"Symbol"),Rs("unscopables"),rd(F.JSON,"JSON",!0);var Fhe=_t.Symbol,jhe=gr,Bhe=nt.f,j6=jhe("metadata"),B6=Function.prototype;B6[j6]===void 0&&Bhe(B6,j6,{value:null}),Rs("dispose"),Rs("metadata");var Whe=Fhe;Rs("asyncDispose");var zhe=I,uL=un("Symbol"),Ghe=uL.keyFor,Hhe=zhe(uL.prototype.valueOf),W6=uL.isRegisteredSymbol||function(e){try{return Ghe(Hhe(e))!==void 0}catch{return!1}};Wn({target:"Symbol",stat:!0},{isRegisteredSymbol:W6});for(var $he=ec,z6=un,Khe=I,qhe=Ta,Yhe=gr,hA=z6("Symbol"),G6=hA.isWellKnownSymbol,H6=z6("Object","getOwnPropertyNames"),Xhe=Khe(hA.prototype.valueOf),$6=$he("wks"),dL=0,K6=H6(hA),Jhe=K6.length;dL<Jhe;dL++)try{var q6=K6[dL];qhe(hA[q6])&&Yhe(q6)}catch{}var Y6=function(e){if(G6&&G6(e))return!0;try{for(var r=Xhe(e),i=0,o=H6($6),c=o.length;i<c;i++)if($6[o[i]]==r)return!0}catch{}return!1};Wn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Y6}),Rs("matcher"),Rs("observable"),Wn({target:"Symbol",stat:!0},{isRegistered:W6}),Wn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Y6}),Rs("metadataKey"),Rs("patternMatch"),Rs("replaceAll");var Rv=l(Whe),X6=l(Tv.f("iterator"));function aT(e){return aT=typeof Rv=="function"&&typeof X6=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Rv=="function"&&r.constructor===Rv&&r!==Rv.prototype?"symbol":typeof r},aT(e)}var Qhe=l(Tv.f("toPrimitive"));function Zhe(e){var r=function(i,o){if(aT(i)!=="object"||i===null)return i;var c=i[Qhe];if(c!==void 0){var u=c.call(i,o);if(aT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return aT(r)==="symbol"?r:String(r)}function K(e,r,i){return(r=Zhe(r))in e?GB(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}var J6=l(Dce),epe={isBrowser:!0,classes:{URLSearchParams:J6!==void 0?J6:JD,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const hL=typeof window<"u"&&typeof document<"u",pL=typeof navigator=="object"&&navigator||void 0,tpe=hL&&(!pL||["ReactNative","NativeScript","NS"].indexOf(pL.product)<0),npe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",rpe=hL&&window.location.href||"http://localhost";function Q6(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Z6(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Q6(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Va=Z6(Z6({},Object.freeze({__proto__:null,hasBrowserEnv:hL,hasStandardBrowserEnv:tpe,hasStandardBrowserWebWorkerEnv:npe,navigator:pL,origin:rpe})),epe),ipe=hn,spe=Ee,ope=Si,ape=k,cpe=function(){var e=ipe(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},e8=RegExp.prototype,t8=function(e){var r=e.flags;return r!==void 0||"flags"in e8||ope(e,"flags")||!ape(e8,e)?r:spe(cpe,e)},lpe=Y1.charAt,n8=Ee,upe=hn,dpe=Le,hpe=q,ppe=/./.exec,fpe=TypeError,mpe=Wn,r8=Ee,i8=se,gpe=AE,pA=DE,s8=Ht,o8=Vt,cT=Oa,_pe=hn,ype=Mt,Epe=q,vpe=fR,a8=t8,Spe=Tc,bpe=d,Tpe=ts,wpe=function(e,r,i){return r+(i?lpe(e,r).length:1)},Cpe=function(e,r){var i=e.exec;if(dpe(i)){var o=n8(i,e,r);return o!==null&&upe(o),o}if(hpe(e)==="RegExp")return n8(ppe,e,r);throw fpe("RegExp#exec called on incompatible receiver")},c8=td,Rpe=gr("matchAll"),l8="RegExp String",u8=l8+" Iterator",Ipe=c8.set,Ape=c8.getterFor(u8),Ppe=TypeError,fL=i8("".indexOf),fA=i8("".matchAll),mL=!!fA&&!bpe(function(){fA("a",/./)}),Ope=gpe(function(e,r,i,o){Ipe(this,{type:u8,regexp:e,string:r,global:i,unicode:o,done:!1})},l8,function(){var e=Ape(this);if(e.done)return pA(void 0,!0);var r=e.regexp,i=e.string,o=Cpe(r,i);return o===null?(e.done=!0,pA(void 0,!0)):e.global?(cT(o[0])===""&&(r.lastIndex=wpe(i,o8(r.lastIndex),e.unicode)),pA(o,!1)):(e.done=!0,pA(o,!1))}),d8=function(e){var r,i,o,c=_pe(this),u=cT(e),h=Tpe(c,RegExp),m=cT(a8(c));return r=new h(h===RegExp?c.source:c,m),i=!!~fL(m,"g"),o=!!~fL(m,"u"),r.lastIndex=o8(c.lastIndex),new Ope(r,u,i,o)};mpe({target:"String",proto:!0,forced:mL},{matchAll:function(e){var r,i,o,c,u=s8(this);if(ype(e)){if(mL)return fA(u,e)}else{if(vpe(e)&&(r=cT(s8(a8(e))),!~fL(r,"g")))throw Ppe("`.matchAll` does not allow non-global regexes");if(mL)return fA(u,e);if((o=Spe(e,Rpe))===void 0&&Epe(e)=="RegExp"&&(o=d8),o)return r8(o,e,u)}return i=cT(u),c=new RegExp(e,"g"),r8(d8,c,i)}});var kpe=ic("String").matchAll,Npe=k,Dpe=kpe,gL=String.prototype,Lpe=function(e){var r=e.matchAll;return typeof e=="string"||e===gL||Npe(gL,e)&&r===gL.matchAll?Dpe:r},xpe=l(Lpe);function h8(e){function r(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=i.length;return h=!h&&lt.isArray(c)?c.length:h,_?(lt.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&lt.isObject(c[h])||(c[h]=[]),r(i,o,c[h],u)&&lt.isArray(c[h])&&(c[h]=function(E){const S={},C=Object.keys(E);let P;const N=C.length;let G;for(P=0;P<N;P++)G=C[P],S[G]=E[G];return S}(c[h])),!m)}if(lt.isFormData(e)&&lt.isFunction(e.entries)){const i={};return lt.forEachEntry(e,(o,c)=>{r(function(u){return xpe(lt).call(lt,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const _L={transitional:jB,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const i=r.getContentType()||"",o=i.indexOf("application/json")>-1,c=lt.isObject(e);if(c&&lt.isHTMLForm(e)&&(e=new FormData(e)),lt.isFormData(e))return o?JSON.stringify(h8(e)):e;if(lt.isArrayBuffer(e)||lt.isBuffer(e)||lt.isStream(e)||lt.isFile(e)||lt.isBlob(e)||lt.isReadableStream(e))return e;if(lt.isArrayBufferView(e))return e.buffer;if(lt.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return iA(h,new Va.classes.URLSearchParams,Object.assign({visitor:function(_,E,S,C){return Va.isNode&&lt.isBuffer(_)?(this.append(E,_.toString("base64")),!1):C.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=lt.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return iA(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,_){if(lt.isString(h))try{return(m||JSON.parse)(h),co(lt).call(lt,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const r=this.transitional||_L.transitional,i=r&&r.forcedJSONParsing,o=this.responseType==="json";if(lt.isResponse(e)||lt.isReadableStream(e))return e;if(e&&lt.isString(e)&&(i&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?rr.from(u,rr.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Va.classes.FormData,Blob:Va.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};lt.forEach(["delete","get","head","post","put","patch"],e=>{_L.headers[e]={}});var yL=_L;const Mpe=lt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),p8=Symbol("internals");function lT(e){var r;return e&&co(r=String(e)).call(r).toLowerCase()}function mA(e){return e===!1||e==null?e:lt.isArray(e)?e.map(mA):String(e)}function EL(e,r,i,o,c){return lt.isFunction(o)?o.call(this,r,i):(c&&(r=i),lt.isString(r)?lt.isString(o)?r.indexOf(o)!==-1:lt.isRegExp(o)?o.test(r):void 0:void 0)}class gA{constructor(r){r&&this.set(r)}set(r,i,o){const c=this;function u(_,E,S){const C=lT(E);if(!C)throw new Error("header name must be a non-empty string");const P=lt.findKey(c,C);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||E]=mA(_))}const h=(_,E)=>lt.forEach(_,(S,C)=>u(S,C,E));if(lt.isPlainObject(r)||r instanceof this.constructor)h(r,i);else if(lt.isString(r)&&(r=co(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(co(m=r).call(m)))h((_=>{const E={};let S,C,P;return _&&_.split(`
`).forEach(function(N){var G,V;P=N.indexOf(":"),S=co(G=N.substring(0,P)).call(G).toLowerCase(),C=co(V=N.substring(P+1)).call(V),!S||E[S]&&Mpe[S]||(S==="set-cookie"?E[S]?E[S].push(C):E[S]=[C]:E[S]=E[S]?E[S]+", "+C:C)}),E})(r),i);else if(lt.isHeaders(r))for(const[_,E]of r.entries())u(E,_,o);else r!=null&&u(i,r,o);var m;return this}get(r,i){if(r=lT(r)){const o=lt.findKey(this,r);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(lt.isFunction(i))return i.call(this,c,o);if(lt.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=lT(r)){const o=lt.findKey(this,r);return!(!o||this[o]===void 0||i&&!EL(0,this[o],o,i))}return!1}delete(r,i){const o=this;let c=!1;function u(h){if(h=lT(h)){const m=lt.findKey(o,h);!m||i&&!EL(0,o[m],m,i)||(delete o[m],c=!0)}}return lt.isArray(r)?r.forEach(u):u(r),c}clear(r){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];r&&!EL(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const i=this,o={};return lt.forEach(this,(c,u)=>{var h;const m=lt.findKey(o,u);if(m)return i[m]=mA(c),void delete i[u];const _=r?function(E){return co(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,C,P)=>C.toUpperCase()+P)}(u):co(h=String(u)).call(h);_!==u&&delete i[u],i[_]=mA(c),o[_]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return lt.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=r&&lt.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,o]=r;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(r){const i=(this[p8]=this[p8]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=lT(u);i[h]||(function(m,_){const E=lt.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+E,{value:function(C,P,N){return this[S].call(this,_,C,P,N)},configurable:!0})})}(o,u),i[h]=!0)}return lt.isArray(r)?r.forEach(c):c(r),this}}gA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),lt.reduceDescriptors(gA.prototype,(e,r)=>{let{value:i}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[o]=c}}}),lt.freezeMethods(gA);var hd=gA;function vL(e,r){const i=this||yL,o=r||i,c=hd.from(o.headers);let u=o.data;return lt.forEach(e,function(h){u=h.call(i,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function f8(e){return!(!e||!e.__CANCEL__)}function Iv(e,r,i){rr.call(this,e??"canceled",rr.ERR_CANCELED,r,i),this.name="CanceledError"}function m8(e,r,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?r(new rr("Request failed with status code "+i.status,[rr.ERR_BAD_REQUEST,rr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}lt.inherits(Iv,rr,{__CANCEL__:!0});const _A=function(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let E,S=0,C=0;return h=h!==void 0?h:1e3,function(P){const N=Date.now(),G=_[C];E||(E=N),m[S]=P,_[S]=N;let V=C,j=0;for(;V!==S;)j+=m[V++],V%=u;if(S=(S+1)%u,S===C&&(C=(C+1)%u),N-E<h)return;const Y=G&&N-G;return Y?Math.round(1e3*j/Y):void 0}}(50,250);return function(u,h){let m,_,E=0,S=1e3/h;const C=function(P){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,P)};return[function(){const P=Date.now(),N=P-E;for(var G=arguments.length,V=new Array(G),j=0;j<G;j++)V[j]=arguments[j];N>=S?C(V,P):(m=V,_||(_=setTimeout(()=>{_=null,C(m)},S-N)))},()=>m&&C(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,E=c(_);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},i)},g8=(e,r)=>{const i=e!=null;return[o=>r[0]({lengthComputable:i,total:e,loaded:o}),r[1]]},_8=e=>function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return lt.asap(()=>e(...i))};var Upe=Va.hasStandardBrowserEnv?((e,r)=>i=>(i=new $I(i,Va.origin),e.protocol===i.protocol&&e.host===i.host&&(r||e.port===i.port)))(new $I(Va.origin),Va.navigator&&/(msie|trident)/i.test(Va.navigator.userAgent)):()=>!0,Vpe=Va.hasStandardBrowserEnv?{write(e,r,i,o,c,u){const h=[e+"="+encodeURIComponent(r)];lt.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),lt.isString(o)&&h.push("path="+o),lt.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function y8(e,r){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(r)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,r):r}function E8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const v8=e=>e instanceof hd?function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?E8(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):E8(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e):e;function P_(e,r){r=r||{};const i={};function o(E,S,C,P){return lt.isPlainObject(E)&&lt.isPlainObject(S)?lt.merge.call({caseless:P},E,S):lt.isPlainObject(S)?lt.merge({},S):lt.isArray(S)?S.slice():S}function c(E,S,C,P){return lt.isUndefined(S)?lt.isUndefined(E)?void 0:o(void 0,E,0,P):o(E,S,0,P)}function u(E,S){if(!lt.isUndefined(S))return o(void 0,S)}function h(E,S){return lt.isUndefined(S)?lt.isUndefined(E)?void 0:o(void 0,E):o(void 0,S)}function m(E,S,C){return C in r?o(E,S):C in e?o(void 0,E):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,S,C)=>c(v8(E),v8(S),0,!0)};return lt.forEach(Object.keys(Object.assign({},e,r)),function(E){const S=_[E]||c,C=S(e[E],r[E],E);lt.isUndefined(C)&&S!==m||(i[E]=C)}),i}var S8=e=>{const r=P_({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=r;if(r.headers=m=hd.from(m),r.url=VB(y8(r.baseURL,r.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),lt.isFormData(o)){if(Va.hasStandardBrowserEnv||Va.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((i=m.getContentType())!==!1){const[E,...S]=i?i.split(";").map(C=>co(C).call(C)).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...S].join("; "))}}if(Va.hasStandardBrowserEnv&&(c&&lt.isFunction(c)&&(c=c(r)),c||c!==!1&&Upe(r.url))){const E=u&&h&&Vpe.read(h);E&&m.set(u,E)}return r},Fpe=typeof XMLHttpRequest<"u"&&function(e){return new dt(function(r,i){const o=S8(e);let c=o.data;const u=hd.from(o.headers).normalize();let h,m,_,E,S,{responseType:C,onUploadProgress:P,onDownloadProgress:N}=o;function G(){E&&E(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let V=new XMLHttpRequest;function j(){if(!V)return;const Z=hd.from("getAllResponseHeaders"in V&&V.getAllResponseHeaders());m8(function(de){r(de),G()},function(de){i(de),G()},{data:C&&C!=="text"&&C!=="json"?V.response:V.responseText,status:V.status,statusText:V.statusText,headers:Z,config:e,request:V}),V=null}V.open(o.method.toUpperCase(),o.url,!0),V.timeout=o.timeout,"onloadend"in V?V.onloadend=j:V.onreadystatechange=function(){V&&V.readyState===4&&(V.status!==0||V.responseURL&&V.responseURL.indexOf("file:")===0)&&setTimeout(j)},V.onabort=function(){V&&(i(new rr("Request aborted",rr.ECONNABORTED,e,V)),V=null)},V.onerror=function(){i(new rr("Network Error",rr.ERR_NETWORK,e,V)),V=null},V.ontimeout=function(){let Z=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const de=o.transitional||jB;o.timeoutErrorMessage&&(Z=o.timeoutErrorMessage),i(new rr(Z,de.clarifyTimeoutError?rr.ETIMEDOUT:rr.ECONNABORTED,e,V)),V=null},c===void 0&&u.setContentType(null),"setRequestHeader"in V&&lt.forEach(u.toJSON(),function(Z,de){V.setRequestHeader(de,Z)}),lt.isUndefined(o.withCredentials)||(V.withCredentials=!!o.withCredentials),C&&C!=="json"&&(V.responseType=o.responseType),N&&([_,S]=_A(N,!0),V.addEventListener("progress",_)),P&&V.upload&&([m,E]=_A(P),V.upload.addEventListener("progress",m),V.upload.addEventListener("loadend",E)),(o.cancelToken||o.signal)&&(h=Z=>{V&&(i(!Z||Z.type?new Iv(null,e,V):Z),V.abort(),V=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const Y=function(Z){const de=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Z);return de&&de[1]||""}(o.url);Y&&Va.protocols.indexOf(Y)===-1?i(new rr("Unsupported protocol "+Y+":",rr.ERR_BAD_REQUEST,e)):V.send(c||null)})},jpe=(e,r)=>{const{length:i}=e=e?e.filter(Boolean):[];if(r||i){let o,c=new AbortController;const u=function(E){if(!o){o=!0,m();const S=E instanceof Error?E:this.reason;c.abort(S instanceof rr?S:new Iv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new rr("timeout ".concat(r," of ms exceeded"),rr.ETIMEDOUT))},r);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(E=>{E.unsubscribe?E.unsubscribe(u):E.removeEventListener("abort",u)}),e=null)};e.forEach(E=>E.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>lt.asap(m),_}},Bpe=p3,Wpe=El;Wn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=Wpe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var zpe=El,Gpe=oh;Wn({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=zpe.f(this),i=Gpe(e);return(i.error?r.reject:r.resolve)(i.value),r.promise}});var SL=l(Bpe),b8=Tv.f("asyncIterator"),Hpe=l(b8);function bL(e,r){this.v=e,this.k=r}function uT(e){var r,i;function o(u,h){try{var m=e[u](h),_=m.value,E=_ instanceof bL;SL.resolve(E?_.v:_).then(function(S){if(E){var C=u==="return"?"return":"next";if(!_.k||S.done)return o(C,S);S=e[C](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):i=null}this._invoke=function(u,h){return new SL(function(m,_){var E={key:u,arg:h,resolve:m,reject:_,next:null};i?i=i.next=E:(r=i=E,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function Sl(e){return function(){return new uT(e.apply(this,arguments))}}function kn(e){return new bL(e,0)}function yA(e){var r={},i=!1;function o(c,u){return i=!0,{done:!1,value:new bL(u=new SL(function(h){h(e[c](u))}),1)}}return r[Rv!==void 0&&X6||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(r.return=function(c){return i?(i=!1,c):o("return",c)}),r}uT.prototype[typeof Rv=="function"&&Hpe||"@@asyncIterator"]=function(){return this},uT.prototype.next=function(e){return this._invoke("next",e)},uT.prototype.throw=function(e){return this._invoke("throw",e)},uT.prototype.return=function(e){return this._invoke("return",e)};var TL=l(b8);function wL(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=TL,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new EA(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function EA(e){function r(i){if(Object(i)!==i)return dt.reject(new TypeError(i+" is not an object."));var o=i.done;return dt.resolve(i.value).then(function(c){return{value:c,done:o}})}return EA=function(i){this.s=i,this.n=i.next},EA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?dt.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?dt.reject(i):r(o.apply(this.s,arguments))}},new EA(e)}const $pe=function*(e,r){let i=e.byteLength;if(!r||i<r)return void(yield e);let o,c=0;for(;c<i;)o=c+r,yield e.slice(c,o),c=o},Kpe=function(){var e=Sl(function*(r,i){var o,c=!1,u=!1;try{for(var h,m=wL(qpe(r));c=!(h=yield kn(m.next())).done;c=!1){const _=h.value;yield*yA(wL($pe(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield kn(m.return()))}finally{if(u)throw o}}});return function(r,i){return e.apply(this,arguments)}}(),qpe=function(){var e=Sl(function*(r){if(r[TL])return void(yield*yA(wL(r)));const i=r.getReader();try{for(;;){const{done:o,value:c}=yield kn(i.read());if(o)break;yield c}}finally{yield kn(i.cancel())}});return function(r){return e.apply(this,arguments)}}(),T8=(e,r,i,o)=>{const c=Kpe(e,r);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:E,value:S}=await c.next();if(E)return m(),void _.close();let C=S.byteLength;if(i){let P=h+=C;i(P)}_.enqueue(new Uint8Array(S))}catch(E){throw m(E),E}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function w8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function C8(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?w8(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const vA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",R8=vA&&typeof ReadableStream=="function",Ype=vA&&(typeof TextEncoder=="function"?(I8=new TextEncoder,e=>I8.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var I8;const A8=function(e){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},Xpe=R8&&A8(()=>{let e=!1;const r=new Request(Va.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),CL=R8&&A8(()=>lt.isReadableStream(new Response("").body)),SA={stream:CL&&(e=>e.body)};var P8;vA&&(P8=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!SA[e]&&(SA[e]=lt.isFunction(P8[e])?r=>r[e]():(r,i)=>{throw new rr("Response type '".concat(e,"' is not supported"),rr.ERR_NOT_SUPPORT,i)})}));const Jpe=async(e,r)=>{const i=lt.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:lt.isBlob(o)?o.size:lt.isSpecCompliantForm(o)?(await new Request(Va.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:lt.isArrayBufferView(o)||lt.isArrayBuffer(o)?o.byteLength:(lt.isURLSearchParams(o)&&(o+=""),lt.isString(o)?(await Ype(o)).byteLength:void 0))(r)};var Qpe=vA&&(async e=>{let{url:r,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:E,headers:S,withCredentials:C="same-origin",fetchOptions:P}=S8(e);E=E?(E+"").toLowerCase():"text";let N,G=jpe([c,u&&u.toAbortSignal()],h);const V=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let j;try{if(_&&Xpe&&i!=="get"&&i!=="head"&&(j=await Jpe(S,o))!==0){let Te,ye=new Request(r,{method:"POST",body:o,duplex:"half"});if(lt.isFormData(o)&&(Te=ye.headers.get("content-type"))&&S.setContentType(Te),ye.body){const[Ne,Ye]=g8(j,_A(_8(_)));o=T8(ye.body,65536,Ne,Ye)}}lt.isString(C)||(C=C?"include":"omit");const Y="credentials"in Request.prototype;N=new Request(r,C8(C8({},P),{},{signal:G,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:Y?C:void 0}));let Z=await fetch(N);const de=CL&&(E==="stream"||E==="response");if(CL&&(m||de&&V)){const Te={};["status","statusText","headers"].forEach(ht=>{Te[ht]=Z[ht]});const ye=lt.toFiniteNumber(Z.headers.get("content-length")),[Ne,Ye]=m&&g8(ye,_A(_8(m),!0))||[];Z=new Response(T8(Z.body,65536,Ne,()=>{Ye&&Ye(),V&&V()}),Te)}E=E||"text";let Se=await SA[lt.findKey(SA,E)||"text"](Z,e);return!de&&V&&V(),await new dt((Te,ye)=>{m8(Te,ye,{data:Se,headers:hd.from(Z.headers),status:Z.status,statusText:Z.statusText,config:e,request:N})})}catch(Y){throw V&&V(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new rr("Network Error",rr.ERR_NETWORK,e,N),{cause:Y.cause||Y}):rr.from(Y,Y&&Y.code,e,N)}});const RL={http:null,xhr:Fpe,fetch:Qpe};lt.forEach(RL,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const O8=e=>"- ".concat(e),Zpe=e=>lt.isFunction(e)||e===null||e===!1;var k8={getAdapter:e=>{e=lt.isArray(e)?e:[e];const{length:r}=e;let i,o;const c={};for(let u=0;u<r;u++){let h;if(i=e[u],o=i,!Zpe(i)&&(o=RL[(h=String(i)).toLowerCase()],o===void 0))throw new rr("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new rr("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(O8).join(`
`):" "+O8(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:RL};function IL(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Iv(null,e)}function N8(e){return IL(e),e.headers=hd.from(e.headers),e.data=vL.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),k8.getAdapter(e.adapter||yL.adapter)(e).then(function(r){return IL(e),r.data=vL.call(e,e.transformResponse,r),r.headers=hd.from(r.headers),r},function(r){return f8(r)||(IL(e),r&&r.response&&(r.response.data=vL.call(e,e.transformResponse,r.response),r.response.headers=hd.from(r.response.headers))),dt.reject(r)})}const D8="1.7.9",bA={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{bA[e]=function(i){return typeof i===e||"a"+(r<1?"n ":" ")+e}});const L8={};bA.transitional=function(e,r,i){function o(c,u){return"[Axios v"+D8+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new rr(o(u," has been removed"+(r?" in "+r:"")),rr.ERR_DEPRECATED);return r&&!L8[u]&&(L8[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(c,u,h)}},bA.spelling=function(e){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var TA={assertOptions:function(e,r,i){if(typeof e!="object")throw new rr("options must be an object",rr.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new rr("option "+u+" must be "+_,rr.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new rr("Unknown option "+u,rr.ERR_BAD_OPTION)}},validators:bA};const hh=TA.validators;let wA=class{constructor(e){this.defaults=e,this.interceptors={request:new FB,response:new FB}}async request(e,r){try{return await this._request(e,r)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=P_(this.defaults,r);const{transitional:i,paramsSerializer:o,headers:c}=r;i!==void 0&&TA.assertOptions(i,{silentJSONParsing:hh.transitional(hh.boolean),forcedJSONParsing:hh.transitional(hh.boolean),clarifyTimeoutError:hh.transitional(hh.boolean)},!1),o!=null&&(lt.isFunction(o)?r.paramsSerializer={serialize:o}:TA.assertOptions(o,{encode:hh.function,serialize:hh.function},!0)),TA.assertOptions(r,{baseUrl:hh.spelling("baseURL"),withXsrfToken:hh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&lt.merge(c.common,c[r.method]);c&&lt.forEach(["delete","get","head","post","put","patch","common"],N=>{delete c[N]}),r.headers=hd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(m=m&&N.synchronous,h.unshift(N.fulfilled,N.rejected))});const _=[];let E;this.interceptors.response.forEach(function(N){_.push(N.fulfilled,N.rejected)});let S,C=0;if(!m){const N=[N8.bind(this),void 0];for(N.unshift.apply(N,h),N.push.apply(N,_),S=N.length,E=dt.resolve(r);C<S;)E=E.then(N[C++],N[C++]);return E}S=h.length;let P=r;for(C=0;C<S;){const N=h[C++],G=h[C++];try{P=N(P)}catch(V){G.call(this,V);break}}try{E=N8.call(this,P)}catch(N){return dt.reject(N)}for(C=0,S=_.length;C<S;)E=E.then(_[C++],_[C++]);return E}getUri(e){return VB(y8((e=P_(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};lt.forEach(["delete","get","head","options"],function(e){wA.prototype[e]=function(r,i){return this.request(P_(i||{},{method:e,url:r,data:(i||{}).data}))}}),lt.forEach(["post","put","patch"],function(e){function r(i){return function(o,c,u){return this.request(P_(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}wA.prototype[e]=r(),wA.prototype[e+"Form"]=r(!0)});var CA=wA;class AL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new dt(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new dt(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new Iv(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=o=>{r.abort(o)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new AL(function(o){r=o}),cancel:r}}}var efe=AL;const PL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(PL).forEach(e=>{let[r,i]=e;PL[i]=r});var tfe=PL;const Js=function e(r){const i=new CA(r),o=vB(CA.prototype.request,i);return lt.extend(o,CA.prototype,i,{allOwnKeys:!0}),lt.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(P_(r,c))},o}(yL);Js.Axios=CA,Js.CanceledError=Iv,Js.CancelToken=efe,Js.isCancel=f8,Js.VERSION=D8,Js.toFormData=iA,Js.AxiosError=rr,Js.Cancel=Js.CanceledError,Js.all=function(e){return dt.all(e)},Js.spread=function(e){return function(r){return e.apply(null,r)}},Js.isAxiosError=function(e){return lt.isObject(e)&&e.isAxiosError===!0},Js.mergeConfig=P_,Js.AxiosHeaders=hd,Js.formToJSON=e=>h8(lt.isHTMLForm(e)?new FormData(e):e),Js.getAdapter=k8.getAdapter,Js.HttpStatusCode=tfe,Js.default=Js;var ia=Js;const nfe=()=>{};function dT(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:nfe};return e.promise=new dt((r,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const RA=new Map,IA=new Map,ph=new Map;let Gi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),zn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const x8=new Eue;let pd=x8.getResult(),OL=null;function Nn(e){if(!OL){pd=x8.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return zn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return zn.CHROME;case"Safari":case"Mobile Safari":return zn.SAFARI;case"Edge":return zn.EDGE;case"Firefox":return zn.FIREFOX;case"QQ":case"QQBrowser":return zn.QQ;case"Opera":return zn.OPERA;case"WeChat":return zn.WECHAT;default:return m.browser.name||""}}(pd),i=M8(pd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(pd),c=pd.os.version,u=M8(pd,!1),h=pd.device.type;if(!(r&&i&&o&&c))return{name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};OL={name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return OL}function M8(e){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?r.split(".")[0]:r}function AA(){return Nn().os}function U8(){const e=Nn();return"".concat(e.os," ").concat(e.osVersion)}function PA(){const e=Nn();return!!(pd.engine.name==="WebKit"&&e.os===Gi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==zn.SAFARI||Ao()&&e.name!==zn.SAFARI)}function $p(){return Nn().name===zn.CHROME}function Is(){return Nn().name===zn.SAFARI}function V8(){return Nn().name===zn.EDGE}function Vr(){return Nn().name===zn.FIREFOX}function Ao(){return Nn().os===Gi.IOS}function hT(e){const r=Nn();return!(r.name!==zn.CHROME||!r.osVersion)&&Number(r.version)>=e}function F8(e){const r=Nn();return!(r.name!==zn.CHROME||!r.osVersion)&&Number(r.version)<e}function kL(e,r,i){const o=Nn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=r&&Number(o.version)<=i:Number(o.version)===r)}function NL(e){const r=Nn();return!(r.name!==zn.EDGE||!r.osVersion)&&Number(r.version)>=e}function j8(e){const r=Nn();return!(r.name!==zn.SAFARI||!r.osVersion)&&Number(r.version)>=e}function B8(e,r,i){const o=Nn();if(o.os!==Gi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e}function W8(e,r,i){const o=Nn();if(o.name!==zn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e:r?Number(c[0])===e&&Number(c[1])<=r||Number(c[0])<e:Number(c[0])<=e}function DL(e){const r=Nn();return!(r.name!==zn.OPERA||!r.osVersion)&&Number(r.version)>=e}function z8(){const e=Nn();if(e.os!==Gi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Av(){const e=Nn();if(e.os!==Gi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function LL(){const e=Nn();if(e.os!==Gi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function G8(){const e=Nn();if(e.os!==Gi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function du(){return Is()&&navigator.maxTouchPoints>0}function H8(){return Nn().name===zn.WECHAT}function $8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function xL(){const e=AA();return function(){const{deviceType:r}=Nn();return r==="mobile"||r==="tablet"}()||e===Gi.ANDROID||e===Gi.IOS||e===Gi.HARMONY_OS}function Kp(){const e=Nn();return e.name!==zn.EDGE&&e.name!==zn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function OA(){return AA()===Gi.ANDROID}function pT(){const e=Nn();return OA()&&(e.name===zn.CHROME||e.name===zn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function K8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function mt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?K8(Object(i),!0).forEach(function(o){qt(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):K8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function qt(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}let te=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),xe=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),qt(this,"code",void 0),qt(this,"message",void 0),qt(this,"data",void 0),qt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function qp(e,r){if(typeof e!="boolean")throw new xe(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Ui(e,r,i){if(!st(i).call(i,e))throw new xe(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function ir(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new xe(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function ML(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new xe(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&ir(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&ir(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&ir(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&ir(e.ideal,"".concat(r,".ideal"),1,1/0)}else ir(e,r,1,1/0)}function ds(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new xe(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!q8(e,i,o,c))throw new xe(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Yp(e,r){if(!Array.isArray(e))throw new xe(te.INVALID_PARAMS,"".concat(r," should be an array"))}function Fr(e){return e==null}function q8(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var fT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(fT||{}),UL=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(UL||{});const Y8=new class{constructor(){qt(this,"_clientSize",null),qt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),qt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),qt(this,"getStyle",e=>window.getComputedStyle(e,null)),qt(this,"checkCssVisibleProperty",e=>{var r;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||st(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(_=>{var E;const S=_.split("(")[0];return st(E=["brightness","blur","opacity"]).call(E,S)}).map(_=>{const[E,S]=_.split(/\(|\)/);return[E,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[E,S]=_;switch(E){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),qt(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let i=!0,o=!0;const c=h=>r(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),qt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),qt(this,"getSizeAboutClient",e=>{const{width:r,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:r,height:i,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),qt(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,r,i)}),qt(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),qt(this,"checkCoverForAPoint",(e,r,i)=>{const o=this.elementFromPoint(e,r);return o!==null&&o!==i}),qt(this,"getPointPositionList",()=>{const{width:e,height:r,left:i,top:o}=this._clientSize,c=e/6,u=r/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let E=0;E<5;E++){const S=(i*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,C=(o*m+(E===0?.1:E===4?(u*E*m-1e5)/m:u*E)*m)/m;h.push({x:S,y:C})}return[...h]}),qt(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),qt(this,"checkSizeIsVisible",(e,r,i)=>(e>50||i/e<=10)&&(r>50||i/r<=10)),qt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,E,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(r<0)return!1;if(_=r<u?r:u,i<0)E=0;else{if(!(i<c))return!1;E=i}if(o<0)return!1;S=o<c?o:c;const C=_-m,P=S-E;return this.checkSizeIsVisible(C,P,h)}),qt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),qt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(fT.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(fT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(fT.SIZE)}}return this.returnHiddenResult(fT.STYLE)}return this.returnHiddenResult(UL.UNMOUNTED)}return this.returnHiddenResult(UL.INVALID_HTML_ELEMENT)}),qt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function VL(e){return new TextEncoder().encode(e)}const X8=function(e,r){const i=new Uint8Array(e.byteLength+r.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(r),e.byteLength),i},FL=async e=>function(r,i){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",VL(e)),16);let Lr=class{constructor(){qt(this,"_events",{}),qt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,r);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const r=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,r){let i=e.length;for(;i--;)if(e[i].listener===r)return i;return-1}},mT=null;function J8(){if(mT)return mT;if(window.electron)return mT=window.electron;if(!window.require)return null;try{return mT=window.require("electron"),mT}catch{return null}}let wi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),jr=function(e){return e.TRACER="tracer",e}({});function Q8(e){return ir(e.timeout,"config.timeout",0,1e5),ir(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ir(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ir(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let rfe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Kn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function gT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function Z8(e){return ds(e.turnServerURL,"turnServerURL"),ds(e.username,"username"),ds(e.password,"password"),e.udpport&&ir(e.udpport,"udpport",1,99999,!0),e.forceturn&&qp(e.forceturn,"forceturn"),e.security&&qp(e.security,"security"),e.tcpport&&ir(e.tcpport,"tcpport",1,99999,!0),!0}function jL(e){return e.level!==void 0&&Ui(e.level,"level",[1,2,3]),e.delay!==void 0&&ir(e.delay,"delay",0,3e3,!0),!0}let _n=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),As=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),hc=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Pv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Ps(e,r){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(r).length===0?dt.reject(new xe(te.UNEXPECTED_ERROR,"can not emit promise")):new dt((u,h)=>{e.emit(r,...o,u,h)})}function ur(e,r){if(e.getListeners(r).length===0)return dt.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return Ps(e,r,...o)}function Wc(e,r){if(e.getListeners(r).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return _T(e,r,...o)}function _T(e,r){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(r,...u,m=>{i=m},m=>{o=m}),o!==null)throw o;if(i===null)throw new xe(te.UNEXPECTED_ERROR,"handler is not sync");return i}const fi=new class extends Lr{set networkState(e){this.emit(Pv.NETWORK_STATE_CHANGE,e,this._networkState),e===hc.ONLINE?this.emit(Pv.ONLINE):e===hc.OFFLINE&&(this.onlineWaiter=new dt(r=>{this.once(Pv.ONLINE,()=>{this.onlineWaiter=void 0,r(hc.ONLINE)})}),this.emit(Pv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===hc.ONLINE}constructor(){super(),qt(this,"_moduleName","network-indicator"),qt(this,"_networkState",hc.ONLINE),qt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=hc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=hc.OFFLINE})}};function kA(e,r){const i=e.indexOf(r);i!==-1&&e.splice(i,1)}function Ov(e){const r=[];return e.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function NA(e){dt!==void 0?dt.resolve().then(e):setTimeout(e,0)}function Br(e){return JSON.parse(JSON.stringify(e))}function O_(e){try{return Br(e)}catch{return e}}const eW={};function km(e,r){eW[r]||(eW[r]=!0,e())}function k_(e){const r=window.atob(e),i=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)i[o]=r.charCodeAt(o);return i}function Nm(e){let r="";for(let i=0;i<e.length;i+=1)r+=String.fromCharCode(e[i]);return window.btoa(r)}function tW(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const o=new Uint8Array(r);o.set(i),i=o}return i}function nW(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=sc(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function fh(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function rW(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{r+=typeof i=="string"?fh(i):i.size}),r+138}function ife(e){const r=new xe(te.TIMEOUT,"timeout");return new dt((i,o)=>{window.setTimeout(()=>o(r),e)})}function hs(e){return new dt(r=>{window.setTimeout(r,e)})}function dr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(r).concat(i):"".concat(r).concat(i)+dr(e-i.length,"")}function N_(){return dr(32,"").toUpperCase()}const DA=()=>{},iW=new class{constructor(){qt(this,"fnMap",new Map)}throttleByKey(e,r,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,mt(mt({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:m,args:u,skipFn:o})}}},sW=iW.throttleByKey.bind(iW);function oW(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function BL(e,r){if(!oW(e)||!oW(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const i=[...e];for(let o=0;o<r.length;o++)i[o]=BL(e[o],r[o]);return i}{const i=mt({},e);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=BL(e[o],r[o]):i[o]=r[o]);return i}}function aW(e,r){let i=[0];if(i=new Array(r).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==r););return i}function WL(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function cW(e){const r="0123456789abcdef";function i(de){let Se,Te="";for(Se=0;Se<=3;Se++)Te+=r.charAt(de>>8*Se+4&15)+r.charAt(de>>8*Se&15);return Te}function o(de,Se){const Te=(65535&de)+(65535&Se);return(de>>16)+(Se>>16)+(Te>>16)<<16|65535&Te}function c(de,Se,Te,ye,Ne,Ye){return o(function(ht,ft){return ht<<ft|ht>>>32-ft}(o(o(Se,de),o(ye,Ye)),Ne),Te)}function u(de,Se,Te,ye,Ne,Ye,ht){return c(Se&Te|~Se&ye,de,Se,Ne,Ye,ht)}function h(de,Se,Te,ye,Ne,Ye,ht){return c(Se&ye|Te&~ye,de,Se,Ne,Ye,ht)}function m(de,Se,Te,ye,Ne,Ye,ht){return c(Se^Te^ye,de,Se,Ne,Ye,ht)}function _(de,Se,Te,ye,Ne,Ye,ht){return c(Te^(Se|~ye),de,Se,Ne,Ye,ht)}const E=function(de){let Se;const Te=1+(de.length+8>>6),ye=new Array(16*Te);for(Se=0;Se<16*Te;Se++)ye[Se]=0;for(Se=0;Se<de.length;Se++)ye[Se>>2]|=de.charCodeAt(Se)<<Se%4*8;return ye[Se>>2]|=128<<Se%4*8,ye[16*Te-2]=8*de.length,ye}(e);let S,C,P,N,G,V=1732584193,j=-271733879,Y=-1732584194,Z=271733878;for(S=0;S<E.length;S+=16)C=V,P=j,N=Y,G=Z,V=u(V,j,Y,Z,E[S+0],7,-680876936),Z=u(Z,V,j,Y,E[S+1],12,-389564586),Y=u(Y,Z,V,j,E[S+2],17,606105819),j=u(j,Y,Z,V,E[S+3],22,-1044525330),V=u(V,j,Y,Z,E[S+4],7,-176418897),Z=u(Z,V,j,Y,E[S+5],12,1200080426),Y=u(Y,Z,V,j,E[S+6],17,-1473231341),j=u(j,Y,Z,V,E[S+7],22,-45705983),V=u(V,j,Y,Z,E[S+8],7,1770035416),Z=u(Z,V,j,Y,E[S+9],12,-1958414417),Y=u(Y,Z,V,j,E[S+10],17,-42063),j=u(j,Y,Z,V,E[S+11],22,-1990404162),V=u(V,j,Y,Z,E[S+12],7,1804603682),Z=u(Z,V,j,Y,E[S+13],12,-40341101),Y=u(Y,Z,V,j,E[S+14],17,-1502002290),j=u(j,Y,Z,V,E[S+15],22,1236535329),V=h(V,j,Y,Z,E[S+1],5,-165796510),Z=h(Z,V,j,Y,E[S+6],9,-1069501632),Y=h(Y,Z,V,j,E[S+11],14,643717713),j=h(j,Y,Z,V,E[S+0],20,-373897302),V=h(V,j,Y,Z,E[S+5],5,-701558691),Z=h(Z,V,j,Y,E[S+10],9,38016083),Y=h(Y,Z,V,j,E[S+15],14,-660478335),j=h(j,Y,Z,V,E[S+4],20,-405537848),V=h(V,j,Y,Z,E[S+9],5,568446438),Z=h(Z,V,j,Y,E[S+14],9,-1019803690),Y=h(Y,Z,V,j,E[S+3],14,-187363961),j=h(j,Y,Z,V,E[S+8],20,1163531501),V=h(V,j,Y,Z,E[S+13],5,-1444681467),Z=h(Z,V,j,Y,E[S+2],9,-51403784),Y=h(Y,Z,V,j,E[S+7],14,1735328473),j=h(j,Y,Z,V,E[S+12],20,-1926607734),V=m(V,j,Y,Z,E[S+5],4,-378558),Z=m(Z,V,j,Y,E[S+8],11,-2022574463),Y=m(Y,Z,V,j,E[S+11],16,1839030562),j=m(j,Y,Z,V,E[S+14],23,-35309556),V=m(V,j,Y,Z,E[S+1],4,-1530992060),Z=m(Z,V,j,Y,E[S+4],11,1272893353),Y=m(Y,Z,V,j,E[S+7],16,-155497632),j=m(j,Y,Z,V,E[S+10],23,-1094730640),V=m(V,j,Y,Z,E[S+13],4,681279174),Z=m(Z,V,j,Y,E[S+0],11,-358537222),Y=m(Y,Z,V,j,E[S+3],16,-722521979),j=m(j,Y,Z,V,E[S+6],23,76029189),V=m(V,j,Y,Z,E[S+9],4,-640364487),Z=m(Z,V,j,Y,E[S+12],11,-421815835),Y=m(Y,Z,V,j,E[S+15],16,530742520),j=m(j,Y,Z,V,E[S+2],23,-995338651),V=_(V,j,Y,Z,E[S+0],6,-198630844),Z=_(Z,V,j,Y,E[S+7],10,1126891415),Y=_(Y,Z,V,j,E[S+14],15,-1416354905),j=_(j,Y,Z,V,E[S+5],21,-57434055),V=_(V,j,Y,Z,E[S+12],6,1700485571),Z=_(Z,V,j,Y,E[S+3],10,-1894986606),Y=_(Y,Z,V,j,E[S+10],15,-1051523),j=_(j,Y,Z,V,E[S+1],21,-2054922799),V=_(V,j,Y,Z,E[S+8],6,1873313359),Z=_(Z,V,j,Y,E[S+15],10,-30611744),Y=_(Y,Z,V,j,E[S+6],15,-1560198380),j=_(j,Y,Z,V,E[S+13],21,1309151649),V=_(V,j,Y,Z,E[S+4],6,-145523070),Z=_(Z,V,j,Y,E[S+11],10,-1120210379),Y=_(Y,Z,V,j,E[S+2],15,718787259),j=_(j,Y,Z,V,E[S+9],21,-343485551),V=o(V,C),j=o(j,P),Y=o(Y,N),Z=o(Z,G);return i(V)+i(j)+i(Y)+i(Z)}let sfe=1,lW=console,Vs=class{static setLogger(e){lW=e}constructor(e,r){qt(this,"id",void 0),qt(this,"lockingPromise",dt.resolve()),qt(this,"locks",0),qt(this,"name",""),qt(this,"lockId",void 0),this.lockId=sfe++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");lW.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const i=new dt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function kv(e,r){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,E=new Array(_),S=0;S<_;S++)E[S]=arguments[S];return await u.apply(this,E)}finally{m()}},c}}const Ci={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function zL(e,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,i)}function fd(e,r,i,o){const c=Object.assign({},Ci,o);let u=c.timeout;const h=async()=>{await function(E){return new dt(S=>{window.setTimeout(S,E)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new dt(async(E,S)=>{r=r||(()=>!1),i=i||(()=>!0);for(let C=0;C<c.maxRetryCount;C+=1){if(m)return S(new xe(te.OPERATION_ABORTED));try{const P=await e();if(!r(P,C)||C+1===c.maxRetryCount)return E(P);await h()}catch(P){if(!i(P,C)||C+1===c.maxRetryCount)return S(P);await h()}}});return _.cancel=()=>m=!0,_}let LA,uW=class{constructor(e){qt(this,"input",[]),qt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:sc(e=this.input).call(e,(r,i)=>r+i)/this.input.length}},xA=0,GL=0;function HL(e,r,i,o){return new dt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),xA+=fh(r.data)):i&&(r.data.size?xA+=r.data.size:r.data instanceof FormData?xA+=rW(r.data):xA+=fh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,ia.request(r).then(h=>{typeof h.data=="string"?GL+=fh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?GL+=h.data.byteLength:GL+=fh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{ia.isCancel(h)?u(new xe(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new xe(te.NETWORK_TIMEOUT,h.message)):h.response?u(new xe(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new xe(te.NETWORK_ERROR,h.message))})})}async function ofe(e,r){const i=new Blob([r.data],{type:"buffer"});return await HL(e,mt(mt({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const dW=()=>window.isSecureContext!==void 0;function hu(e){if(Array.isArray(e))return e.map(i=>i);if(!hW(e))return e;const r={};for(const i in e){const o=e[i];hW(o)||Array.isArray(o)?r[i]=hu(o):r[i]=o}return r}function hW(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let $L=class{constructor(e){qt(this,"input",[]),qt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const mh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},yT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:mh,remoteCandidate:mh},updateInterval:0},pW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},fW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},mW={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},gW={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let KL=class{constructor(e,r){qt(this,"onFirstVideoReceived",void 0),qt(this,"onFirstVideoDecoded",void 0),qt(this,"onFirstAudioReceived",void 0),qt(this,"onFirstVideoDecodedTimeout",void 0),qt(this,"onFirstAudioDecoded",void 0),qt(this,"onSelectedLocalCandidateChanged",void 0),qt(this,"onSelectedRemoteCandidateChanged",void 0),qt(this,"videoIsReady",!1),qt(this,"videoIsReady2",{}),qt(this,"pc",void 0),qt(this,"options",void 0),qt(this,"intervalTimer",void 0),qt(this,"stats",hu(yT)),qt(this,"isFirstVideoReceived",{}),qt(this,"isFirstVideoDecoded",{}),qt(this,"isFirstAudioReceived",{}),qt(this,"isFirstAudioDecoded",{}),qt(this,"isFirstVideoDecodedTimeout",{}),qt(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new dt(e=>{e({local:mt({},mh),remote:mt({},mh)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of i)e[m].forEach((_,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const S=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,C=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=C):(c+=S,h+=C),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||C<=0?0:C/(S+C)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},afe=class extends KL{constructor(){super(...arguments),qt(this,"_stats",yT),qt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=hu(yT);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var i;const o=st(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=hu(fW);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=hu(pW),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:mt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=hu(gW);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=hu(mW);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new dt((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),r.push(o)}),r}},ET=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),MA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),qL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),zc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Nv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Nv||{});function vT(e,r,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Nv.kNone;if(!r)return;const u=Number(r[i]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[i]);if(typeof m!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const E=h-_;return E?(u-m)/E*c:void 0}let _W=class extends KL{constructor(){super(...arguments),qt(this,"_stats",yT),qt(this,"report",void 0),qt(this,"lastDecodeVideoReceiverStats",new Map),qt(this,"lastVideoFramesRecv",new Map),qt(this,"lastVideoFramesSent",new Map),qt(this,"lastVideoFramesDecode",new Map),qt(this,"lastVideoFramesOutput",new Map),qt(this,"lastVideoJBDelay",new Map),qt(this,"lastAudioJBDelay",new Map),qt(this,"mediaBytesSent",new Map),qt(this,"mediaBytesRetransmit",new Map),qt(this,"mediaBytesTargetEncode",new Map),qt(this,"lastDecodeAudioReceiverStats",new Map),qt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=hu(yT),this.report.forEach(e=>{switch(e.type){case zc.OUTBOUND:case zc.INBOUND:{const r=e.mediaType||e.kind,i=!r&&"frameWidth"in e,o=!r&&!("frameWidth"in e);e.type===zc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(e):(r==="video"||i)&&this.processVideoOutboundStats(e):e.type===zc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(e):(r==="video"||i)&&this.processVideoInboundStats(e));break}case zc.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case zc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:mt({},mh),remote:mt({},mh)};return e.forEach(i=>{let o;if(i.type===zc.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===zc.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===zc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===zc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===zc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.localCandidate)),e.type===zc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);r||(r=hu(gW),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=vT(i,r,"totalProcessingDelay","jitterBufferEmittedCount",Nv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,mt({},r))}processVideoInboundStats(e){let r=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);r||(r=hu(pW),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=vT(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=vT(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",Nv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=vT(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Nv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=vT(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",Nv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:mt({},r),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);r||(r=hu(fW),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new $L(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new $L(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new $L(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const o=this.findRemoteStatsId(e.ssrc,zc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(r||(r=hu(mW),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const i=this.findRemoteStatsId(e.ssrc,zc.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}findRemoteStatsId(e,r){var i;const o=Array.from(jc(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,r){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,r){const i=this.report.get(e);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,C=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof E=="number"&&typeof S=="number"||(E=0,S=0),C==null){const P=Date.now(),N=this.lastVideoFramesSent.get(i.ssrc);N&&P-N.lts>=800?(C=Math.round((_-N.count)/((P-N.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:C})):N?C=N.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:0})}i.sentFrame={width:E,height:S,frameRate:Math.max(0,C)}}processVideoTrackReceiverStats(e,r,i){var o,c,u,h,m;const _=r?this.report.get(r):void 0,E=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,C=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,P=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,N=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof E=="number"){const G=this.lastVideoFramesRecv.get(i.ssrc),V=Date.now();i.framesReceivedCount=E;let j=0;G&&V-G.lts>=800?(j=Math.round((E-G.count)/((V-G.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:E,lts:V,rate:j})):G?j=G.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:E,lts:V,rate:0}),i.receivedFrame={width:S||0,height:C||0,frameRate:j||0},i.decodedFrame={width:S||0,height:C||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:C||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(P&&N){const G=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let V=G.jitterBufferMs;const j=N-G.jitterBufferEmittedCount;j>0&&(V=1e3*(P-G.jitterBufferDelay)/j),i.jitterBufferMs=V,i.currentDelayMs=Math.round(V),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:N,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,E=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(e,r,i){var o,c,u,h,m,_,E;const S=r?this.report.get(r):void 0,C=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,N=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,G=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,V=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,j=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,Y=(E=S==null?void 0:S.concealedSamples)!==null&&E!==void 0?E:e.concealedSamples;if(typeof P=="number"&&(i.totalSamplesReceived=P),C&&P&&(i.accelerateRate=C/P),N&&G){const de=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Se=de.jitterBufferMs;const Te=G-de.jitterBufferEmittedCount;Te>0&&(Se=1e3*(N-de.jitterBufferDelay)/Te),i.jitterBufferMs=Math.round(Se),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:G,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=V;let Z=1920;j&&P&&(Z=P/j/50,i.receivedFrames=Math.round(P/Z)),Y&&(i.droppedFrames=Math.round(Y/Z))}processRemoteInboundStats(e,r){const i=this.report.get(e);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},cfe=class extends KL{updateStats(){return dt.resolve()}};function YL(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new afe(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new _W(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof dt||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new _W(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new cfe(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const yW="websdk_ng_install_id";function XL(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let e=window.localStorage.getItem(yW);return e||(e=N_(),window.localStorage.setItem(yW,e)),tr("INSTALL_ID",e),e}catch{return}}const bl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],o=r[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),JL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let D_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Os=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Os;const UA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},QL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},ZL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",ex={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Er=mt(mt(mt({},ex),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:QL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},UA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function tr(e,r,i){var o,c,u;st(o=Object.keys(Er)).call(o,e)&&(!i&&st(c=Object.keys(md)).call(c,e)||(Er[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(Er.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(Er.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,Er.USE_NEW_NETWORK_CONFIG=u,u&&(Er.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Er.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Er.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Er.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Er.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Er.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Er.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(Er.ENABLE_INSTANT_VIDEO=!0,Er.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(Er.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(Er.NEW_TURN_MODE||(Er.NEW_TURN_MODE=4))))}function oe(e){return Er[e]}JL||(Er.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Er.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Er.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Er.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Er.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Er.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Er.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Er.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Er.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Er.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Er.AREAS=["NORTH_AMERICA","OVERSEA"]);let EW=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const md={};var yn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(yn||{});let VA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const vW=128,lfe=96,SW=1e3,Dv=10;let ufe=0;var bW=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>ht,Printer:()=>ai,parse:()=>it,print:()=>Tt});const h=`
`,m="".concat("\r").concat(h),_=" ";let E;function S(He){return He>="0"&&He<="9"}function C(He){return He>="!"&&He<="~"}function P(He){return C(He)||He>=""&&He<=""}function N(He){return He==="!"||He>="#"&&He<="'"||He>="*"&&He<="+"||He>="-"&&He<="."||He>="0"&&He<="9"||He>="A"&&He<="Z"||He>="^"&&He<="~"}function G(He){return He>="1"&&He<="9"}function V(He){return He>="A"&&He<="Z"||He>="a"&&He<="z"}function j(He){return He==="d"||He==="h"||He==="m"||He==="s"}function Y(He){return He>""&&He<"	"||He>"\v"&&He<"\f"||He>""&&He<""}function Z(He){return V(He)||S(He)||He==="+"||He==="/"}function de(He){return S(He)||V(He)||He==="+"||He==="/"||He==="-"||He==="_"}function Se(He){return V(He)||S(He)||He==="+"||He==="/"}function Te(He,M){var ae=Object.keys(He);if(Object.getOwnPropertySymbols){var he=Object.getOwnPropertySymbols(He);M&&(he=he.filter(function(Qe){return Object.getOwnPropertyDescriptor(He,Qe).enumerable})),ae.push.apply(ae,he)}return ae}function ye(He){for(var M=1;M<arguments.length;M++){var ae=arguments[M]!=null?arguments[M]:{};M%2?Te(Object(ae),!0).forEach(function(he){Ne(He,he,ae[he])}):Object.getOwnPropertyDescriptors?Object.defineProperties(He,Object.getOwnPropertyDescriptors(ae)):Te(Object(ae)).forEach(function(he){Object.defineProperty(He,he,Object.getOwnPropertyDescriptor(ae,he))})}return He}function Ne(He,M,ae){return M in He?Object.defineProperty(He,M,{value:ae,enumerable:!0,configurable:!0,writable:!0}):He[M]=ae,He}(function(He){He.VERSION="v",He.ORIGIN="o",He.SESSION_NAME="s",He.INFORMATION="i",He.URI="u",He.EMAIL="e",He.PHONE="p",He.CONNECTION="c",He.BANDWIDTH="b",He.TIME="t",He.REPEAT="r",He.ZONE_ADJUSTMENTS="z",He.KEY="k",He.ATTRIBUTE="a",He.MEDIA="m"})(E||(E={}));class Ye{consumeText(M,ae){let he=ae;for(;he<M.length;){const Qe=M[he];if(Qe==="\0"||Qe==="\r"||Qe===h)break;he+=1}if(he-ae==0)throw new Error("Invalid text, at ".concat(M));return he}consumeUnicastAddress(M,ae,he){return this.consumeTill(M,ae,_)}consumeOneOrMore(M,ae,he){let Qe=ae;for(;he(M[Qe]);)Qe++;if(Qe-ae==0)throw new Error("Invalid rule at ".concat(ae,"."));return Qe}consumeSpace(M,ae){if(M[ae]===_)return ae+1;throw new Error("Invalid space at ".concat(ae,"."))}consumeIP4Address(M,ae){let he=ae;for(let Qe=0;Qe<4;Qe++)if(he=this.consumeDecimalUChar(M,he),Qe!==3){if(M[he]!==".")throw new Error("Invalid IP4 address.");he++}return he}consumeDecimalUChar(M,ae){let he=ae;for(let Xt=0;Xt<3&&S(M[he]);Xt++,he++);if(he-ae==0)throw new Error("Invalid decimal uchar.");const Qe=parseInt(M.slice(ae,he));if(Qe>=0&&Qe<=255)return he;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,ae){let he=this.consumeHexpart(M,ae);return M[he]===":"&&(he+=1,he=this.consumeIP4Address(M,he)),he}consumeHexpart(M,ae){let he=ae;if(M[he]===":"&&M[he+1]===":"){he+=2;try{he=this.consumeHexseq(M,he)}catch{}return he}if(he=this.consumeHexseq(M,he),M[he]===":"&&M[he+1]===":"){he+=2;try{he=this.consumeHexseq(M,he)}catch{}return he}return he}consumeHexseq(M,ae){let he=ae;for(;he=this.consumeHex4(M,he),M[he]===":"&&M[he+1]!==":";)he+=1;return he}consumeHex4(M,ae){let he=0;for(;he<4;he++)if(!((Qe=M[ae+he])>="0"&&Qe<="9"||Qe>="a"&&Qe<="f"||Qe>="A"&&Qe<="F")){if(he===0)throw new Error("Invalid hex 4");break}var Qe;return ae+he}consumeFQDN(M,ae){let he=ae;for(;S(M[he])||V(M[he])||M[he]==="-"||M[he]===".";)he+=1;if(he-ae<4)throw new Error("Invalid FQDN");return he}consumeExtnAddr(M,ae){return this.consumeOneOrMore(M,ae,P)}consumeMulticastAddress(M,ae,he){switch(he){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,ae);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,ae);default:try{return this.consumeFQDN(M,ae)}catch{return this.consumeExtnAddr(M,ae)}}}consumeIP6MulticastAddress(M,ae){const he=this.consumeHexpart(M,ae);return M[he]==="/"?this.consumeInteger(M,he+1):he}consumeIP4MulticastAddress(M,ae){let he=ae+3;const Qe=M.slice(ae,he),Xt=parseInt(Qe);if(Xt<224||Xt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let sr=0;sr<3;sr++){if(M[he]!==".")throw new Error("Invalid IP4 multicast address.");he+=1,he=this.consumeDecimalUChar(M,he)}return M[he]==="/"&&(he+=1),he=this.consumeTTL(M,he),M[he]==="/"&&(he=this.consumeInteger(M,he)),he}consumeInteger(M,ae){if(!G(M[ae]))throw new Error("Invalid integer.");for(ae+=1;S(M[ae]);)ae+=1;return ae}consumeTTL(M,ae){if(M[ae]==="0")return ae+1;if(!G(M[ae]))throw new Error("Invalid TTL.");ae+=1;for(let he=0;he<2&&S(M[ae]);he++)ae+=1;return ae}consumeToken(M,ae){return this.consumeOneOrMore(M,ae,N)}consumeTime(M,ae){let he=ae;if(M[he]==="0")return he+1;for(G(M[he])&&(he+=1);S(M[he]);)he++;if(he-ae<10)throw new Error("Invalid time");return he}consumeAddress(M,ae){return this.consumeTill(M,ae,_)}consumeTypedTime(M,ae){let he=ae;return he=this.consumeOneOrMore(M,he,S),j(M[he])?he+1:he}consumeRepeatInterval(M,ae){if(!G(M[ae]))throw new Error("Invalid repeat interval");for(ae+=1;S(M[ae]);)ae+=1;return j(M[ae])&&(ae+=1),ae}consumePort(M,ae){return this.consumeOneOrMore(M,ae,S)}consume(M,ae,he){for(let Qe=0;Qe<he.length;Qe++){if(ae+Qe>=M.length)throw new Error("consume exceeding value length");if(M[ae+Qe]!==he[Qe])throw new Error("consume ".concat(he," failed at ").concat(Qe))}return ae+he.length}consumeTill(M,ae,he){let Qe=ae;for(;Qe<M.length&&(typeof he!="string"||M[Qe]!==he)&&(typeof he!="function"||!he(M[Qe]));)Qe++;return Qe}}class ht extends Ye{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(M){const ae=this.probeEOL(M);this.records=M.split(ae).filter(ry=>!!co(ry).call(ry)).map(this.parseLine),this.currentLine=0;const he=this.parseVersion(),Qe=this.parseOrigin(),Xt=this.parseSessionName(),sr=this.parseInformation(),Ki=this.parseUri(),za=this.parseEmail(),cf=this.parsePhone(),ny=this.parseConnection(),rw=this.parseBandWidth(),YP=this.parseTimeFields(),XP=this.parseKey(),Ol=this.parseSessionAttribute(),Xm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:he,origin:Qe,sessionName:Xt,information:sr,uri:Ki,emails:za,phones:cf,connection:ny,bandwidths:rw,timeFields:YP,key:XP,attributes:Ol,mediaDescriptions:Xm}}getCurrentRecord(){const M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let ae=0;ae<M.length;ae++)if(M[ae]===h)return M[ae-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(M,ae){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const he=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:he,value:M.slice(2),line:ae,cur:0}}parseSessionAttribute(){const M=new Sn;for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==E.ATTRIBUTE)break;const he={attField:this.extractOneOrMore(ae,Qe=>N(Qe)&&Qe!==":"),_cur:0};ae.value[ae.cur]===":"&&(ae.cur+=1,he.attValue=this.extractOneOrMore(ae,Y)),M.parse(he),this.currentLine++}return M.digest()}parseMediaAttributes(M){const ae=new bn(M);for(;this.currentLine<this.records.length;){const he=this.getCurrentRecord();if(he.type!==E.ATTRIBUTE)break;const Qe={attField:this.extractOneOrMore(he,Xt=>N(Xt)&&Xt!==":"),_cur:0};he.value[he.cur]===":"&&(he.cur+=1,Qe.attValue=this.extractOneOrMore(he,Y)),ae.parse(Qe),this.currentLine++}return ae.digest()}parseKey(){const M=this.getCurrentRecord();if(M.type===E.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const M=this.getCurrentRecord();if(M.type===E.ZONE_ADJUSTMENTS){const ae=[];for(;;)try{const he=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let Qe=!1;M.value[M.cur]==="-"&&(Qe=!0,M.cur+=1);const Xt=this.extract(M,this.consumeTypedTime);ae.push({time:he,typedTime:Xt,back:Qe})}catch{break}if(ae.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ae}return[]}parseRepeat(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==E.REPEAT)break;{const he=this.extract(ae,this.consumeRepeatInterval),Qe=this.parseTypedTime(ae);M.push({repeatInterval:he,typedTimes:Qe}),this.currentLine++}}return M}parseTypedTime(M){const ae=[];for(;;)try{this.consumeSpaceForRecord(M),ae.push(this.extract(M,this.consumeTypedTime))}catch{break}if(ae.length===0)throw new Error("Invalid typed time.");return ae}parseTime(){const M=this.getCurrentRecord(),ae=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);const he=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:ae,stopTime:he}}parseBandWidth(){const M=[];for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==E.BANDWIDTH)break;{const he=this.extractOneOrMore(ae,N);if(ae.value[ae.cur]!==":")throw new Error("Invalid bandwidth field.");ae.cur++;const Qe=this.extractOneOrMore(ae,S);M.push({bwtype:he,bandwidth:Qe}),this.currentLine++}}return M}parseVersion(){const M=this.getCurrentRecord();if(M.type!==E.VERSION)throw new Error("first sdp record must be version");const ae=M.value.slice(0,this.consumeOneOrMore(M.value,0,S));if(ae.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,ae}parseOrigin(){const M=this.getCurrentRecord();if(M.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const ae=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);const he=this.extractOneOrMore(M,S);this.consumeSpaceForRecord(M);const Qe=this.extractOneOrMore(M,S);this.consumeSpaceForRecord(M);const Xt=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const sr=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Ki=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:ae,sessId:he,sessVersion:Qe,nettype:Xt,addrtype:sr,unicastAddress:Ki}}parseSessionName(){const M=this.getCurrentRecord();if(M.type===E.SESSION_NAME){const ae=this.extract(M,this.consumeText);return this.currentLine++,ae}}parseInformation(){const M=this.getCurrentRecord();if(M.type!==E.INFORMATION)return;const ae=this.extract(M,this.consumeText);return this.currentLine++,ae}parseUri(){const M=this.getCurrentRecord();if(M.type===E.URI)return this.currentLine++,M.value}parseEmail(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==E.EMAIL)break;M.push(ae.value),this.currentLine++}return M}parsePhone(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==E.PHONE)break;M.push(ae.value),this.currentLine++}return M}parseConnection(){const M=this.getCurrentRecord();if(M.type===E.CONNECTION){const ae=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const he=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Qe=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:ae,addrtype:he,address:Qe}}}parseMedia(){const M=this.getCurrentRecord(),ae=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let he=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,he+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);const Qe=[];for(Qe.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,Qe.push(this.extract(M,this.consumeToken));if(Qe.length===0)throw new Error("Invalid proto");const Xt=this.parseFmt(M);return this.currentLine++,{mediaType:ae,port:he,protos:Qe,fmts:Xt}}parseTimeFields(){const M=[];for(;this.getCurrentRecord().type===E.TIME;){const ae=this.parseTime(),he=this.parseRepeat(),Qe=this.parseZone();M.push({time:ae,repeats:he,zones:Qe})}return M}parseMediaDescription(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const ae=this.parseMedia(),he=this.parseInformation(),Qe=this.parseConnections(),Xt=this.parseBandWidth(),sr=this.parseKey(),Ki=this.parseMediaAttributes(ae);M.push({media:ae,information:he,connections:Qe,bandwidths:Xt,key:sr,attributes:Ki})}return M}parseConnections(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){const ae=[];for(;;)try{this.consumeSpaceForRecord(M),ae.push(this.extract(M,this.consumeToken))}catch{break}if(ae.length===0)throw new Error("Invalid fmts");return ae}extract(M,ae){for(var he=arguments.length,Qe=new Array(he>2?he-2:0),Xt=2;Xt<he;Xt++)Qe[Xt-2]=arguments[Xt];const sr=ae.call(this,M.value,M.cur,...Qe),Ki=M.value.slice(M.cur,sr);return M.cur=sr,Ki}extractOneOrMore(M,ae){const he=this.consumeOneOrMore(M.value,M.cur,ae),Qe=M.value.slice(M.cur,he);return M.cur=he,Qe}consumeSpaceForRecord(M){if(M.value[M.cur]!==_)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class ft extends Ye{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(M,ae,he){const Qe=this.consumeOneOrMore(M.attValue,M._cur,ae),Xt=M.attValue.slice(M._cur,Qe),[sr,Ki]=he||[];if(typeof sr=="number"&&Xt.length<sr)throw new Error("error in length, should be more or equal than ".concat(sr," characters."));if(typeof Ki=="number"&&Xt.length>Ki)throw new Error("error in length, should be less or equal than ".concat(Ki," characters."));return M._cur=Qe,Xt}consumeAttributeSpace(M){if(M.attValue[M._cur]!==_)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,ae){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var he=arguments.length,Qe=new Array(he>2?he-2:0),Xt=2;Xt<he;Xt++)Qe[Xt-2]=arguments[Xt];const sr=ae.call(this,M.attValue,M._cur,...Qe),Ki=M.attValue.slice(M._cur,sr);return M._cur=sr,Ki}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,ae){if(!M.attValue)throw new Error;for(let he=0;he<ae.length;he++)if(ae[he]!==M.attValue[M._cur+he])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,Z,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,Z,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ae=[];for(;!this.atEnd(M);){ae.push(this.extractOneOrMore(M,Z));try{this.consumeAttributeSpace(M)}catch(he){if(this.atEnd(M))break;throw he}}this.attributes.iceOptions=ae}parseFingerprint(M){const ae=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const he=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ae,fingerprint:he})}parseExtmap(M){const ae=this.extractOneOrMore(M,S);let he;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),he=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeTill,_),Xt=ye(ye({entry:parseInt(ae,10)},he&&{direction:he}),{},{extensionName:Qe});this.peekChar(M)===_&&(this.consumeAttributeSpace(M),Xt.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(Xt)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ae=this.extract(M,this.consumeTill);if(ae!=="active"&&ae!=="passive"&&ae!=="actpass"&&ae!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ae}}class Sn extends ft{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(ae){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),ae}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){const ae=this.extract(M,this.consumeToken),he=[];for(;!this.atEnd(M)&&this.peekChar(M)===_;)this.consumeAttributeSpace(M),he.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:ae,identificationTag:he})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,de)}parseIdentity(M){const ae=this.extractOneOrMore(M,Se),he=[];for(;!this.atEnd(M)&&this.peekChar(M)===_;){this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");const Xt=this.extractOneOrMore(M,sr=>sr!==_&&Y(sr));he.push({name:Qe,value:Xt})}this.attributes.identities.push({assertionValue:ae,extensions:he})}parseMsidSemantic(M){this.peekChar(M)===_&&this.consumeAttributeSpace(M);const ae={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),ae.applyForAll=!0;break}{const he=this.extract(M,this.consumeTill,_);ae.identifierList.push(he)}}this.attributes.msidSemantic=ae}}class bn extends ft{constructor(M){super(),Ne(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(ae){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),ae}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){const ae=this.extractOneOrMore(M,Z,[1,32]);this.consumeAttributeSpace(M);const he=this.extractOneOrMore(M,S,[1,5]);this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const Xt=this.extractOneOrMore(M,S,[1,10]);this.consumeAttributeSpace(M);const sr=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Ki=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);const za={foundation:ae,componentId:he,transport:Qe,priority:Xt,connectionAddress:sr,port:Ki,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),za.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),za.relPort=this.extract(M,this.consumePort));this.peekChar(M)===_;){this.consumeAttributeSpace(M);const cf=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),za.extension[cf]=this.extractOneOrMore(M,C)}this.attributes.candidates.push(za)}parseRemoteCandidate(M){const ae=[];for(;;){const he=this.extractOneOrMore(M,S,[1,5]);this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Xt=this.extract(M,this.consumePort);ae.push({componentId:he,connectionAddress:Qe,port:Xt});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(ae)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){const ae=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const he=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");const Qe={encodingName:he,clockRate:this.extractOneOrMore(M,S)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),Qe.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));const Xt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(ae,10));Xt?Xt.rtpMap=Qe:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtpMap:Qe,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){const ae=this.extractOneOrMore(M,S);this.consumeAttributeSpace(M);const he=this.extract(M,this.consumeTill,":");let Qe;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),Qe=this.extract(M,this.consumeTill));const Xt=this.attributes.ssrcs.find(sr=>sr.ssrcId===parseInt(ae,10));Xt?Xt.attributes[he]=Qe:this.attributes.ssrcs.push({ssrcId:parseInt(ae,10),attributes:{[he]:Qe}})}parseFmtp(M){const ae=this.extract(M,this.consumeTill,_);this.consumeAttributeSpace(M);const he=this.extract(M,this.consumeTill),Qe={};he.split(";").forEach(sr=>{let[Ki,za]=sr.split("=");Ki=co(Ki).call(Ki);const cf=typeof za=="string"?co(za).call(za):null;typeof Ki=="string"&&Ki.length>0&&(Qe[Ki]=cf)});const Xt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(ae,10));Xt?Xt.fmtp={parameters:Qe}:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[],fmtp:{parameters:Qe}})}parseFmtParameters(M){const ae={},he=this.extract(M,this.consumeTill,"=");M._cur++;const Qe=this.extract(M,this.consumeTill,";");for(ae[he]=Qe;M.attValue[M._cur]===";";){const Xt=this.extract(M,this.consumeTill,"=");M._cur++;const sr=this.extract(M,this.consumeTill,";");ae[Xt]=sr}return ae}parseRtcpFb(M){let ae="";ae=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,_),this.consumeAttributeSpace(M);const he=this.extract(M,this.consumeTill,_);let Qe;if(he==="trr-int")Qe={type:he,interval:this.extract(M,this.consumeTill)};else{const Xt={type:he};this.peekChar(M)===_&&(this.consumeAttributeSpace(M),Xt.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===_&&(Xt.additional=this.extract(M,this.consumeTill))),Qe=Xt}if(ae==="*")this.attributes.rtcpFeedbackWildcards.push(Qe);else{const Xt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(ae,10));Xt?Xt.rtcpFeedbacks.push(Qe):this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[Qe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ae={port:this.extract(M,this.consumePort)};this.peekChar(M)===_&&(this.consumeAttributeSpace(M),ae.netType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),ae.addressType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),ae.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=ae}parseMsid(M){const ae={id:this.extractOneOrMore(M,N,[1,64])};this.peekChar(M)===_&&(this.consumeAttributeSpace(M),ae.appdata=this.extractOneOrMore(M,N,[1,64])),this.attributes.msids.push(ae)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){const ae=this.extractOneOrMore(M,Qe=>V(Qe)||S(Qe)||Qe==="_"||Qe==="-");this.consumeAttributeSpace(M);const he={id:ae,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===_){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");const Qe=[];for(;;){const Xt=this.extract(M,this.consumeToken);Qe.push(Xt);try{this.extract(M,this.consume,",")}catch{break}}he.payloads=Qe,this.peekChar(M)===_&&this.extract(M,this.consume,_)}for(;;){const Qe=this.extract(M,this.consumeToken);switch(Qe){case"depend":{const Xt={type:Qe,rids:this.extract(M,this.consume,"=").split(",")};he.params.push(Xt);break}default:{const Xt={type:Qe};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),Xt.val=this.extract(M,this.consumeTill,";")),he.params.push(Xt)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(he)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,S,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){const ae=this.extract(M,this.consumeToken),he=[];for(;;)try{this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeInteger);he.push(parseInt(Qe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ae,ssrcIds:he})}}function pr(He,M,ae){return M in He?Object.defineProperty(He,M,{value:ae,enumerable:!0,configurable:!0,writable:!0}):He[M]=ae,He}class ai{constructor(){pr(this,"eol",m)}print(M,ae){let he="";return ae&&(this.eol=ae),he+=this.printVersion(M.version),he+=this.printOrigin(M.origin),he+=this.printSessionName(M.sessionName),he+=this.printInformation(M.information),he+=this.printUri(M.uri),he+=this.printEmail(M.emails),he+=this.printPhone(M.phones),he+=this.printConnection(M.connection),he+=this.printBandwidth(M.bandwidths),he+=this.printTimeFields(M.timeFields),he+=this.printKey(M.key),he+=this.printSessionAttributes(M.attributes),he+=this.printMediaDescription(M.mediaDescriptions),he}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let ae="";for(const he of M)ae+="e=".concat(he).concat(this.eol);return ae}printPhone(M){let ae="";for(const he of M)ae+="e=".concat(he).concat(this.eol);return ae}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let ae="";for(const he of M)ae+="b=".concat(he.bwtype,":").concat(he.bandwidth).concat(this.eol);return ae}printTimeFields(M){let ae="";for(const he of M){ae+="t=".concat(he.time.startTime," ").concat(he.time.startTime).concat(this.eol);for(const Qe of he.repeats)ae+="r=".concat(Qe.repeatInterval," ").concat(Qe.typedTimes.join(" ")).concat(this.eol);he.zoneAdjustments&&(ae+="z=",ae+="z=".concat(he.zoneAdjustments.map(Qe=>"".concat(Qe.time," ").concat(Qe.back?"-":""," ").concat(Qe.typedTime)).join(" ")).concat(this.eol),ae+=this.eol)}return ae}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let ae="";for(const he of M)ae+="a=".concat(he.attField).concat(he.attValue?":".concat(he.attValue):"").concat(this.eol);return ae}printMediaDescription(M){let ae="";for(const he of M)ae+=this.printMedia(he.media),ae+=this.printInformation(he.information),ae+=this.printConnections(he.connections),ae+=this.printBandwidth(he.bandwidths),ae+=this.printKey(he.key),ae+=this.printMediaAttributes(he);return ae}printConnections(M){let ae="";for(const he of M)ae+=this.printConnection(he);return ae}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new ua(this.eol).print(M)}printMediaAttributes(M){return new je(this.eol).print(M)}}class $r{constructor(M){pr(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(_)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map(ae=>"a=fingerprint:".concat(ae.hashFunction).concat(_).concat(ae.fingerprint)).join(this.eol)+this.eol:""}printExtmap(M){return M.map(ae=>"a=extmap:".concat(ae.entry).concat(ae.direction?"/".concat(ae.direction):"").concat(_).concat(ae.extensionName).concat(ae.extensionAttributes?"".concat(_).concat(ae.extensionAttributes):"").concat(this.eol)).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map(ae=>"a=".concat(ae.attField).concat(ae.attValue?":".concat(ae.attValue):"").concat(this.eol)).join("")}}class ua extends $r{print(M){let ae="";return ae+=this.printGroups(M.groups),ae+=this.printMsidSemantic(M.msidSemantic),ae+=this.printIceLite(M.iceLite),ae+=this.printIceUfrag(M.iceUfrag),ae+=this.printIcePwd(M.icePwd),ae+=this.printIceOptions(M.iceOptions),ae+=this.printFingerprints(M.fingerprints),ae+=this.printSetup(M.setup),ae+=this.printTlsId(M.tlsId),ae+=this.printIdentity(M.identities),ae+=this.printExtmap(M.extmaps),ae+=this.printUnrecognized(M.unrecognized),ae}printGroups(M){let ae="";return M.length>0&&(ae+=M.map(he=>"a=group:".concat(he.semantic).concat(he.identificationTag.map(Qe=>"".concat(_).concat(Qe)).join("")).concat(this.eol)).join("")),ae}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map(ae=>"a=identity:".concat(ae.assertionValue).concat(ae.extensions.map(he=>"".concat(_).concat(he.name).concat(he.value?"=".concat(he.value):"")))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let ae="a=msid-semantic:".concat(M.semantic);return M.applyForAll?ae+="".concat(_,"*"):M.identifierList.length>0&&(ae+=M.identifierList.map(he=>"".concat(_).concat(he))),ae+this.eol}}class je extends $r{print(M){const ae=M.attributes;let he="";return he+=this.printRTCP(ae.rtcp),he+=this.printIceUfrag(ae.iceUfrag),he+=this.printIcePwd(ae.icePwd),he+=this.printIceOptions(ae.iceOptions),he+=this.printCandidates(ae.candidates),he+=this.printRemoteCandidatesList(ae.remoteCandidatesList),he+=this.printEndOfCandidates(ae.endOfCandidates),he+=this.printFingerprints(ae.fingerprints),he+=this.printSetup(ae.setup),he+=this.printMid(ae.mid),he+=this.printExtmap(ae.extmaps),he+=this.printRTPRelated(ae),he+=this.printPtime(ae.ptime),he+=this.printMaxPtime(ae.maxPtime),he+=this.printDirection(ae.direction),he+=this.printSSRCGroups(ae.ssrcGroups),he+=this.printSSRC(ae.ssrcs),he+=this.printRTCPMux(ae.rtcpMux),he+=this.printRTCPMuxOnly(ae.rtcpMuxOnly),he+=this.printRTCPRsize(ae.rtcpRsize),he+=this.printMSId(ae.msids),he+=this.printImageattr(ae.imageattr),he+=this.printRid(ae.rids),he+=this.printSimulcast(ae.simulcast),he+=this.printSCTPPort(ae.sctpPort),he+=this.printMaxMessageSize(ae.maxMessageSize),he+=this.printUnrecognized(ae.unrecognized),he}printCandidates(M){return M.map(ae=>"a=candidate:".concat(ae.foundation).concat(_).concat(ae.componentId).concat(_).concat(ae.transport).concat(_).concat(ae.priority).concat(_).concat(ae.connectionAddress).concat(_).concat(ae.port).concat(_,"typ").concat(_).concat(ae.type).concat(ae.relAddr?"".concat(_,"raddr").concat(_).concat(ae.relAddr):"").concat(ae.relPort?"".concat(_,"rport").concat(_).concat(ae.relPort):"").concat(Object.keys(ae.extension).map(he=>"".concat(_).concat(he).concat(_).concat(ae.extension[he])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(M){return M.map(ae=>"a=remote-candidates:".concat(ae.join(_)).concat(this.eol)).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";const ae=M.payloads;let he="";he+=M.rtcpFeedbackWildcards.map(Qe=>this.printRTCPFeedback("*",Qe)).join("");for(const Qe of ae)he+=this.printRtpMap(Qe.payloadType,Qe.rtpMap),he+=this.printFmtp(Qe.payloadType,Qe.fmtp),he+=Qe.rtcpFeedbacks.map(Xt=>this.printRTCPFeedback(Qe.payloadType,Xt)).join("");return he}printFmtp(M,ae){if(!ae)return"";const he=Object.keys(ae.parameters);return he.length===1&&ae.parameters[he[0]]===null?"a=fmtp:".concat(M).concat(_).concat(he[0]).concat(this.eol):"a=fmtp:".concat(M).concat(_).concat(Object.keys(ae.parameters).map(Qe=>"".concat(Qe,"=").concat(ae.parameters[Qe])).join(";")).concat(this.eol)}printRtpMap(M,ae){return ae?"a=rtpmap:".concat(M).concat(_).concat(ae.encodingName,"/").concat(ae.clockRate).concat(ae.encodingParameters?"/".concat(ae.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,ae){let he="a=rtcp-fb:".concat(M).concat(_),Qe=ae;return Qe.type==="trr-int"?he+="ttr-int".concat(_).concat(Qe.interval):(he+="".concat(Qe.type),Qe.parameter&&(he+="".concat(_).concat(Qe.parameter),Qe.additional&&(he+="".concat(_).concat(Qe.additional)))),he+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map(ae=>Object.keys(ae.attributes).map(he=>"a=ssrc:".concat(ae.ssrcId.toString(10)).concat(_).concat(he).concat(ae.attributes[he]?":".concat(ae.attributes[he]):"").concat(this.eol)).join("")).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let ae="a=rtcp:".concat(M.port);return M.netType&&(ae+="".concat(_).concat(M.netType)),M.addressType&&(ae+="".concat(_).concat(M.addressType)),M.address&&(ae+="".concat(_).concat(M.address)),ae+this.eol}printMSId(M){return M.map(ae=>"a=msid:".concat(ae.id).concat(ae.appdata?"".concat(_).concat(ae.appdata):"").concat(this.eol)).join("")}printImageattr(M){return M.map(ae=>"a=imageattr:".concat(ae).concat(this.eol)).join("")}printRid(M){return M.map(ae=>{let he="a=rid:".concat(ae.id).concat(_).concat(ae.direction);return ae.payloads&&(he+="".concat(_,"pt=").concat(ae.payloads.join(","))),ae.params.length>0&&(he+="".concat(_).concat(ae.params.map(Qe=>Qe.type==="depend"?"depend=".concat(Qe.rids.join(",")):"".concat(Qe.type,"=").concat(Qe.val)).join(";"))),he+this.eol}).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map(ae=>"a=ssrc-group:".concat(ae.semantic).concat(ae.ssrcIds.map(he=>"".concat(_).concat(he.toString(10))).join("")).concat(this.eol)).join("")}}function it(He){return new ht().parse(He)}function Tt(He,M){return new ai().print(He,M)}}},r={};function i(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function Fa(e){return bW.parse(e)}function Dm(e,r){return bW.print(e,r)}var dfe=ic("Array").keys,hfe=Pc,pfe=Si,ffe=k,mfe=dfe,tx=Array.prototype,gfe={DOMTokenList:!0,NodeList:!0},_fe=function(e){var r=e.keys;return e===tx||ffe(tx,e)&&r===tx.keys||pfe(gfe,hfe(e))?mfe:r},Gc=l(_fe);function TW(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function cn(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?TW(Object(i),!0).forEach(function(o){Wr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Wr(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}const wW=new class extends Lr{constructor(){super(...arguments),Wr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class yfe{constructor(r){Wr(this,"logger",void 0),Wr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function nx(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function CW(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Tl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},FA=Date.now(),ST=e=>{for(const r in Tl)if(Object.prototype.hasOwnProperty.call(Tl,r)&&Tl[r]===e)return r;return"DEFAULT"},L=new class{constructor(){Wr(this,"proxyServerURL",void 0),Wr(this,"logLevel",Tl.DEBUG),Wr(this,"uploadState","collecting"),Wr(this,"uploadLogWaitingList",[]),Wr(this,"uploadLogUploadingList",[]),Wr(this,"uploadErrorCount",0),Wr(this,"currentLogID",0),Wr(this,"url",void 0),Wr(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Tl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Tl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Tl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Tl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Tl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){tr("UPLOAD_LOG",!0)}disableLogUpload(){tr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new yfe(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-FA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-FA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=nx()+" Agora-SDK [".concat(ST(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=nx()+" %cAgora-SDK [".concat(ST(o),"]:");let u=[];if(!oe("USE_NEW_LOG"))switch(o){case Tl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case Tl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case Tl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case Tl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-FA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-FA);const o=Math.max(0,Math.min(4,r[0]));r[0]=nx()+" Agora-SDK [".concat(ST(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=CW()+" Agora-SDK [".concat(ST(e),"]:"):i[0]=CW()+" Agora-SDK [".concat(ST(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:bl,process_id:oe("PROCESS_ID"),payload:JSON.stringify(e)};return fd(async()=>{const i=await ia.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),wW.reportLogUploadError(o),!0},{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var RW;function Efe(e){return ds(e.reportId,"params.reportId",0,100,!1),ds(e.category,"params.category",0,100,!1),ds(e.event,"params.event",0,100,!1),ds(e.label,"params.label",0,100,!1),ir(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(RW={}).FREE="free",RW.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const vfe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Hi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Or=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Sfe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(P){L.warning(P),S=[]}try{JSON.stringify(S)}catch{L.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const C=(e.report||It).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:jr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const P=c.apply(this,_);return P instanceof dt?P.then(N=>(C.onSuccess(e.reportResult&&N),N)).catch(N=>{throw C.onError(N),N}):(C.onSuccess(e.reportResult&&P),P)}catch(P){throw C.onError(P),P}}}return o}}const It=new class{constructor(){Wr(this,"baseInfoMap",new Map),Wr(this,"proxyServer",void 0),Wr(this,"eventUploadTimer",void 0),Wr(this,"setSessionIdTimer",void 0),Wr(this,"url",void 0),Wr(this,"sids",new Set),Wr(this,"backupUrl",void 0),Wr(this,"_appId",void 0),Wr(this,"_aid",0),Wr(this,"keyEventUploadPendingItems",[]),Wr(this,"normalEventUploadPendingItems",[]),Wr(this,"apiInvokeUploadPendingItems",[]),Wr(this,"apiInvokeCount",0),Wr(this,"apiInvokeLoggedCount",0),Wr(this,"ltsList",[]),Wr(this,"lastSendNormalEventTime",Date.now()),Wr(this,"customReportCounterTimer",void 0),Wr(this,"customReportCount",0),Wr(this,"extApiInvoke",async e=>{for(const r of e){const i=cn(cn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:jr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,o]=r;return i+o}),16)||0}reportApiInvoke(e,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function E(N,G){if(m){let V="[apiInvoke-".concat(_,"]");r.id&&(V+="[".concat(r.id,"]")),r.name&&(V+="[".concat(r.name,"]")),L.info("".concat(V," ").concat(N),N==="start"?r.options:G||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:e,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});E("start");let C=!1;hs(r.timeout).then(()=>{C||(this.sendApiInvoke(cn(cn({},S()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const P=new xe(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:N=>{const G=()=>{if(C)throw P;return C=!0,this.sendApiInvoke(cn(cn({},S()),{},{success:!0},r.reportResult&&{result:N})),E("onSuccess"),N};return i?sW(G,r.name+"Success",i,()=>C=!0):G()},onError:N=>{const G=()=>{if(C)throw N;C=!0,this.sendApiInvoke(cn(cn({},S()),{},{success:!1,error:N})),E("onFailure",N.toString())};return i?sW(G,r.name+"Error",i,()=>C=!0):G()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:JL?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:E,clientRole:S}=r,C=Date.now(),P=cn(cn({},o),{},{eventType:Hi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:ZL,lts:C,elapse:C-i,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:bl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:E,clientType:st(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:S,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var N;this.send({type:Or.SESSION,data:P},!0)}joinChooseServer(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{role:r.role,eventType:Hi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Or.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:Hi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Or.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=r,E=c-(u&&h?h:i.startTime),S=cn(cn({},o),{},{eventType:Hi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:E,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:XL(),isABTestSuccess:r.isABTestSuccess?1:0}),C=S.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:Or.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(_){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),V=m.match(/p=[0-9]{1,6}/g);P={isSuccess:C,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split("=")[1]:"",isProxy:_?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),V=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:C,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else P={isSuccess:C,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const N=Object.assign({},S,P,{eventType:Hi.REJOIN_GATEWAY});this.send({type:Or.RE_JOIN_GATEWAY,data:N},!0)}}joinChannelTimeout(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=cn(cn({},i.info),{},{lts:o,timeout:r,elapse:o-i.startTime});this.send({type:Or.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:Hi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Or.PUBLISH,data:u},!0)}subscribe(e,r,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=cn(cn({},c),{},{eventType:Hi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Or.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var r;const i=[...Gc(r=this.baseInfoMap).call(r)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=cn(cn({},u),{},{eventType:Hi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:Or.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=cn(cn(cn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=cn(cn(cn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:i,data:m},!0)}abTest(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Hi.AB_TEST,lts:c});this.send({type:Or.AB_TEST,data:u},!0)}pcStats(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Hi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Or.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,r){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Hi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Or.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=cn(cn(cn({},u),o),{},{eventType:r,lts:h});this.send({type:i,data:m},!0)}streamSwitch(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:Hi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:Or.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:Hi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Or.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:Hi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Or.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?L.debug("reportProxyServerurl: ".concat(e)):L.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Or.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const E=fh(JSON.stringify(u));let S=0;const C=[];let P=0;for(let N=0;N<_.length;N++)P+=_.charCodeAt(N)<=127?1:3,P<=m-E||(C[C.length]=mt(mt({},u),{},{[h]:_.substring(S,N)}),S=N,P=_.charCodeAt(N)<=127?1:3);return S!==_.length-1&&(C[C.length]=mt(mt({},u),{},{[h]:_.substring(S)})),C})(cn(cn(cn({},o),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Or.WORKER_EVENT,data:u},!0))}apworkerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:Or.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:Or.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:Or.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new xe(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=r.map(c=>({type:Or.USER_ANALYTICS,data:cn(cn({sid:e},c),{},{lts:i})}));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw L.error("send custom report message failed",c.toString()),new xe(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const r=oe("NOT_REPORT_EVENT");if(e.tag&&st(r)&&st(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof xe){const{code:_,message:E}=e.error;h=_||E||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Or.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&e.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),eT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&i.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),L.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){fi.networkState===hc.OFFLINE&&await dt.race([fi.onlineWaiter,hs(2*Ci.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=VL(JSON.stringify(h.data)),_=new ArrayBuffer(5),E=(C=>{let P=0;return Object.entries(Or).forEach(N=>{let[G,V]=N;V===C.type&&(P=Sfe[G])}),P})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&E),S.setUint8(3,E>>>8&255),S.setUint8(4,E>>>16&255),u=X8(u,new Uint8Array(_)),u=X8(u,m)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await HL(o,{timeout:1e4,data:r(e),headers:cn(cn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:i,aid:o};fi.networkState===hc.OFFLINE&&await dt.race([fi.onlineWaiter,hs(2*Ci.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u)));try{r?await ofe(h,{timeout:1e4,data:c}):await HL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,r){const i=Object.assign({},vfe);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:r}),i}reportResourceTiming(e,r){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:jr.TRACER}).onSuccess()}};wW.on("REPORT_LOG_UPLOAD",e=>{e.networkState=fi.networkState,It.reportApiInvoke(null,{name:"logUploadError",options:e,tag:jr.TRACER}).onSuccess("logUploadError")});class Oe extends xe{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Wr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,L)}throw(){super.throw(L)}}const ps={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Vn(){return ps}function IW(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||($p()||V8())&&!xL())}function AW(){return!ps.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&Kp()}let fs=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Lv(e,r,i){return{sampleRate:e,stereo:r,bitrate:i}}function Dn(e,r,i,o,c){return{width:e,height:r,frameRate:i,bitrateMin:o,bitrateMax:c}}function pu(e,r,i,o,c){return{width:{max:e},height:{max:r},frameRate:i,bitrateMin:o,bitrateMax:c}}function rx(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const bfe={"90p":Dn(160,90),"90p_1":Dn(160,90),"120p":Dn(160,120,15,30,65),"120p_1":Dn(160,120,15,30,65),"120p_3":Dn(120,120,15,30,50),"120p_4":Dn(212,120),"180p":Dn(320,180,15,30,140),"180p_1":Dn(320,180,15,30,140),"180p_3":Dn(180,180,15,30,100),"180p_4":Dn(240,180,15,30,120),"240p":Dn(320,240,15,40,200),"240p_1":Dn(320,240,15,40,200),"240p_3":Dn(240,240,15,40,140),"240p_4":Dn(424,240,15,40,220),"360p":Dn(640,360,15,80,400),"360p_1":Dn(640,360,15,80,400),"360p_3":Dn(360,360,15,80,260),"360p_4":Dn(640,360,30,80,600),"360p_6":Dn(360,360,30,80,400),"360p_7":Dn(480,360,15,80,320),"360p_8":Dn(480,360,30,80,490),"360p_9":Dn(640,360,15,80,800),"360p_10":Dn(640,360,24,80,800),"360p_11":Dn(640,360,24,80,1e3),"480p":Dn(640,480,15,100,500),"480p_1":Dn(640,480,15,100,500),"480p_2":Dn(640,480,30,100,1e3),"480p_3":Dn(480,480,15,100,400),"480p_4":Dn(640,480,30,100,750),"480p_6":Dn(480,480,30,100,600),"480p_8":Dn(848,480,15,100,610),"480p_9":Dn(848,480,30,100,930),"480p_10":Dn(640,480,10,100,400),"720p":Dn(1280,720,15,120,1130),"720p_auto":Dn(1280,720,30,900,3e3),"720p_1":Dn(1280,720,15,120,1130),"720p_2":Dn(1280,720,30,120,2e3),"720p_3":Dn(1280,720,30,120,1710),"720p_5":Dn(960,720,15,120,910),"720p_6":Dn(960,720,30,120,1380),"1080p":Dn(1920,1080,15,120,2080),"1080p_1":Dn(1920,1080,15,120,2080),"1080p_2":Dn(1920,1080,30,120,3e3),"1080p_3":Dn(1920,1080,30,120,3150),"1080p_5":Dn(1920,1080,60,120,4780),"1440p":Dn(2560,1440,30,120,4850),"1440p_1":Dn(2560,1440,30,120,4850),"1440p_2":Dn(2560,1440,60,120,7350),"4k":Dn(3840,2160,30,120,8910),"4k_1":Dn(3840,2160,30,120,8910),"4k_3":Dn(3840,2160,60,120,13500)},Tfe={"480p":pu(640,480,5),"480p_1":pu(640,480,5),"480p_2":pu(640,480,30),"480p_3":pu(640,480,15),"720p":pu(1280,720,5),"720p_auto":Dn(1280,720,30,900,3e3),"720p_1":pu(1280,720,5),"720p_2":pu(1280,720,30),"720p_3":pu(1280,720,15),"1080p":pu(1920,1080,5),"1080p_1":pu(1920,1080,5),"1080p_2":pu(1920,1080,30),"1080p_3":pu(1920,1080,15)},wfe={"1SL1TL":rx(1,1),"3SL3TL":rx(3,3),"2SL3TL":rx(2,3)};function gh(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},bfe[e]):e}function ix(e){return typeof e=="string"?Object.assign({},Tfe[e]):e}function jA(e){return typeof e=="string"?Object.assign({},wfe[e]):e}const Cfe={speech_low_quality:Lv(16e3,!1),speech_standard:Lv(32e3,!1,18),music_standard:Lv(48e3,!1),standard_stereo:Lv(48e3,!0,56),high_quality:Lv(48e3,!1,128),high_quality_stereo:Lv(48e3,!0,192)};function BA(e){return typeof e=="string"?Object.assign({},Cfe[e]):e}const xv=[];function PW(e){return Ui(e,"mediaSource",["screen","window","application"]),!0}let Et=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),hr=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Mv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Rfe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Ife=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),L_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Uv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Vv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Fv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Hc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const sx={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},ox={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},OW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Afe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},kW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Po=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),$c=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),bT=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),x_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),lo=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),_h=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const ax={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let WA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function NW(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function kr(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?NW(Object(i),!0).forEach(function(o){Pe(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):NW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Pe(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function Ln(e,r,i,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=sc(u=im(h=i.slice()).call(h)).call(u,function(_,E){return E(e,r,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,r,m),m=null),m}class DW extends Lr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(L_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=i||dr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){st(xv).call(xv,o)||xv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||km(()=>{var i;It.reportApiInvoke(null,{name:wi.GET_MEDIA_STREAM_TRACK,options:[],tag:jr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Mv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=xv.indexOf(r);i!==-1&&xv.splice(i,1)}(this),this.emit(Uv.CLOSED),this.removeAllListeners(L_.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Mv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(L_.TRANSCEIVER_UPDATED,r,i)}}class jv extends DW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Vs("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,L.debug("[".concat(this.getTrackId(),"] close")),this.emit(Et.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,Et.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Uv.TRACK_ENDED)}stateCheck(r,i){if(L.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),qp(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new xe(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",L);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new xe(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",L)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():dt.resolve([])}}const LW=window.AudioContext||window.webkitAudioContext;let Kc=null;const nr=new class extends Lr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{L.info("ios15-interruption-start"),this.emit(fs.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{L.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?L.info("ios15-interruption-end-canceled"):(Kc&&await Kc.suspend(),this.emit(fs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){L.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){L.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Bv(){if(!Kc){if(function(){if(!LW)return void L.error("your browser is not support web audio");L.info("create audio context");const e=kr({},oe("WEBAUDIO_INIT_OPTIONS"));L.debug("audio context init option:",JSON.stringify(e)),Kc=new LW(e),nr.curState=Kc.state,Kc.onstatechange=()=>{nr.prevState=nr.curState,nr.curState=Kc?Kc.state:void 0;const{prevState:r,curState:i}=nr,o=i==="running",c=i==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",_=Nn().osVersion;(Ao()||du())&&u&&c&&(L.info("ios".concat(_,"-interruption-start")),nr.emit(fs.IOS_INTERRUPTION_START)),(Ao()||du())&&(h||m)&&o&&(L.info("ios".concat(_,"-interruption-end")),nr.emit(fs.IOS_INTERRUPTION_END)),r!==i&&nr.emit(fs.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Kc)===null||r===void 0?void 0:r.currentTime;nr.currentTime!==i?(nr.currentTimeStuckAt&&(L.debug("AudioContext current time resume at ".concat(i)),nr.currentTimeStuckAt=void 0),nr.currentTime=i):(i!==nr.currentTimeStuckAt&&(It.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:jr.TRACER}).onSuccess(),L.warning("AudioContext current time stuck at ".concat(i))),nr.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(V){r.state==="running"?_(!1):Ao()||du()?r.state==="suspended"&&(_(!0),V&&r.resume().then(E,E)):r.state!=="closed"&&(_(!0),V&&r.resume().then(E,E))}function _(V){if(c!==V){c=V;for(let j=0,Y=i;j<Y.length;j+=1){const Z=Y[j];V?window.addEventListener(Z,S,{capture:!0,passive:!0}):window.removeEventListener(Z,S,{capture:!0,passive:!0})}}}function E(){m(!1)}function S(){m(!0)}function C(V){if(!h)if(o.paused)if(V){let j;P(!1),h=!0;try{j=o.play(),j?j.then(N,N):(o.addEventListener("playing",N),o.addEventListener("abort",N),o.addEventListener("error",N))}catch{N()}}else P(!0);else P(!1)}function P(V){if(u!==V){u=V;for(let j=0,Y=i;j<Y.length;j++){const Z=Y[j];V?window.addEventListener(Z,G,{capture:!0,passive:!0}):window.removeEventListener(Z,G,{capture:!0,passive:!0})}}}function N(){o.removeEventListener("playing",N),o.removeEventListener("abort",N),o.removeEventListener("error",N),h=!1,C(!1)}function G(){C(!0)}if(Ao()){const V=r.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=j.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=V.stream,C(!0)}nr.on(fs.STATE_CHANGE,function(){m(!0)}),m(!1)}(Kc)}(),!Kc)throw new xe(te.NOT_SUPPORTED,"can not create audio context");return Kc}return Kc}function M_(e){if(function(){if(cx!==null)return cx;const o=Bv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),cx=m,m}())return;const r=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),st(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,c,u)):r.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?kA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)r.call(e,h)}}let cx=null;function lx(e,r){let i=!1;const o=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Bv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class xW{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Bv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ao()||du()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const i=sc(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{L.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class MW extends Lr{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Bv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),M_(this.outputNode),this.volumeLevelAnalyser=new xW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Hc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Vn().webAudioMediaStreamDest)throw new xe(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&NA(()=>{nr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ao()||du()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await hs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class UW extends MW{get isFreeze(){return!1}constructor(r,i,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(L.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void L.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>L.info("resume success")),L.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),M_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),M_(this.outputNode),this.emit(Hc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new xe(te.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),M_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,L.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));M_(_),this.originVolumeLevelAnalyser=new xW,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Nn();i&&h.os===Gi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(nr.on(fs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),M_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Hc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),nr.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),L.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));M_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function VW(e,r,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Pfe(e,r){const i=await FW(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new dt((m,_)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const C=document.createElement("div");C.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",C.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Y);const Z=new Error("NotAllowedError");Z.name="NotAllowedError",_(Z)};let V=h;const j=document.createElement("div");if(h){const Z=document.createElement("input");Z.setAttribute("type","checkbox");const de=document.createElement("span");Z.setAttribute("style","margin-right: 6px;"),de.innerText="Share audio",Z.checked=V,Z.onchange=()=>{V=Z.checked},j.appendChild(Z),j.appendChild(de)}N.appendChild(j),N.appendChild(G),S.appendChild(C),S.appendChild(P),S.appendChild(N);const Y=document.createElement("div");Y.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Y.appendChild(E),Y.appendChild(S),document.body.appendChild(Y),u.map(Z=>{if(Z.id){const de=document.createElement("div");de.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Se=Z.thumbnail;try{const{width:Te}=Se.getSize();Te>1920&&(Se=Se.resize({width:1920}))}catch(Te){throw Te&&Te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Te}de.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Se.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Z.name.replace(/[\u00A0-\u9999<>\&]/g,function(Te){return"&#"+Te.charCodeAt(0)+";"})+"</span>",de.onclick=()=>{document.body.removeChild(Y),m({sourceId:Z.id,audio:V})},P.appendChild(de)}})})}(i,r);return await VW(o,e,c)}async function FW(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const i=J8();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new xe(te.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new dt((u,h)=>{i.desktopCapturer.getSources({types:r},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new xe(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const ux=new Vs("safari");let jW=!1,BW=!1;async function qc(e,r){let i=0,o=null;for(;i<2;)try{o=await Ofe(e,r,i>0);break}catch(c){if(c instanceof xe)throw L.error("[".concat(r,"] ").concat(c.toString())),c;const u=zA(c.name||c.code||c,c.message);if(u.code===te.MEDIA_OPTION_INVALID){L.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await hs(500);continue}throw L.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new xe(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Ofe(e,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new xe(te.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=Vn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return L.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(J8())e.screen.sourceId?Wv(c,await VW(e.screen.sourceId,e.screen,!!e.screenAudio)):Wv(c,await Pfe(e.screen,!!e.screenAudio));else if($p()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new xe(te.NOT_SUPPORTED,"This browser does not support screen sharing");L.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=e.screen.extensionId,m=r,new dt((N,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},V=>{if(!V||!V.streamId)return L.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),V),void G(new xe(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(V.streamId)})}catch(V){L.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),V.toString()),G(new xe(te.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=P,Wv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&PW(e.screen.mediaSource);const P={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:G,systemAudio:V,preferCurrentTab:j}=e.screen,Y={selfBrowserSurface:N,surfaceSwitching:G,systemAudio:V,preferCurrentTab:j};!N&&delete Y.selfBrowserSurface,!G&&delete Y.surfaceSwitching,!V&&delete Y.systemAudio,!j&&delete Y.preferCurrentTab,L.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:e.screenAudio,controls:Y})),Wv(c,await navigator.mediaDevices.getDisplayMedia(kr({video:P,audio:e.screenAudio},Y)))}else{if(!Vr())throw L.error("[".concat(r,"] This browser does not support screenSharing")),new xe(te.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&PW(e.screen.mediaSource);const P={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};L.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),Wv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},E=oe("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),_=BL(_,E)}catch{}L.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(_)),Nn();let S,C=null;(Is()||Ao()||PA())&&(C=await ux.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(P){throw C&&C(),P}return _.audio&&(jW=!0),_.video&&(BW=!0),Wv(c,S),C&&C(),c}function zA(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new xe(te.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new xe(te.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new xe(te.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new xe(te.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new xe(te.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new xe(te.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return L.error("getUserMedia unexpected error",e),new xe(te.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function Wv(e,r){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const Yc=new class extends Lr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(x_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Pe(this,"_state",bT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(OA()||AA()===Gi.HARMONY_OS)&&Kp())&&this.updateDevicesInfo()},oe("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>L.error(e.toString()))}async enumerateDevices(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new xe(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,E=null;if(!i&&(u||h)){if(ux.isLocked&&(L.debug("[device manager] wait GUM lock"),(await ux.lock())(),L.debug("[device manager] GUM unlock")),jW&&(u=!1,this.isAccessMicrophonePermission=!0),BW&&(h=!1,this.isAccessCameraPermission=!0),L.debug("[device manager] check media device permissions",e,r,u,h),u&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const C=zA(S.name||S.code||S,S.message);if(C.code===te.PERMISSION_DENIED)throw C;L.warning("getUserMedia failed in getDevices",C)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const C=zA(S.name||S.code||S,S.message);if(C.code===te.PERMISSION_DENIED)throw C;L.warning("getUserMedia failed in getDevices",C)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const C=zA(S.name||S.code||S,S.message);if(C.code===te.PERMISSION_DENIED)throw C;L.warning("getUserMedia failed in getDevices",C)}this.isAccessCameraPermission=!0}L.debug("[device manager] mic permission",e,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(C=>C.stop()),_&&_.getTracks().forEach(C=>C.stop()),E&&E.getTracks().forEach(C=>C.stop()),m=null,_=null,E=null,S}catch(S){return m&&m.getTracks().forEach(C=>C.stop()),_&&_.getTracks().forEach(C=>C.stop()),E&&E.getTracks().forEach(C=>C.stop()),m=null,_=null,E=null,new xe(te.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!r)throw new xe(te.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=bT.INITING;try{await this.updateDevicesInfo(),this.state=bT.INITEND}catch(e){throw L.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=bT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new xe(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?L.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):L.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):L.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==bT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(x_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(x_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(x_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let dx=!1;const Xc=new class extends Lr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function WW(){if(Nn(),!dx){const e=r=>{r.preventDefault(),dx=!1,pT()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};dx=!0,pT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),L.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Xc.onAutoplayFailed?Xc.onAutoplayFailed():Xc.onAudioAutoplayFailed?L.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):L.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Xc.emit("autoplay-failed")}}function zW(e,r,i,o){if(!e)return;const c=It.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=kr(kr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Xc.onAutoplayFailed||Xc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:o,extend:void 0});It.send({type:Or.AUTOPLAY_FAILED,data:m},!0)}const kfe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],sa=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,o]=r;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(L.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(nr.curState==="running")return Av()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(L.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),nr.on(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.on(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),nr.on(fs.STATE_CHANGE,()=>{Ao()&&nr.prevState==="suspended"&&nr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),i)try{await i.setSinkId(r)}catch(o){throw new xe(te.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,i,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,lo.INIT),this.setVolume(r,i);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{L.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){L.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&zW(o,"audio",m.message,r),L.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(L.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),NA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),WW()}))})}updateTrack(e,r){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const i=this.elementMap.get(e);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){kfe.forEach(i=>{r.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(L.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&L.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{L.debug("Auto resume audio element success")}).catch(i=>{L.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new dt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{pT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function si(){return function(e,r,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new xe(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",L);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof dt?new dt((_,E)=>{m.then(_).catch(E)}):m}),i}}class GW extends Lr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new xe(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new xe(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Po.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Po.ON_TRACK,void 0)}}class HW extends Lr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await Ps(this,$c.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var o;return L.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),ur(this,$c.REQUEST_UPDATE_CONSTRAINTS,Array.from(jc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return L.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),ur(this,$c.REQUEST_UPDATE_CONSTRAINTS,Array.from(jc(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){L.error(new xe(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof dt&&(o=await o),r.push(kr(kr({},o),{},{direction:this.direction}))}catch(o){L.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class $W extends Lr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new xe(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new xe(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Po.ON_TRACK,void 0),this.emit(Po.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Po.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Po.ON_NODE,this.inputNode))}}class KW extends Lr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=o}async getConstraints(){return Ps(this,$c.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var o;return L.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),ur(this,$c.REQUEST_UPDATE_CONSTRAINTS,Array.from(jc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),ur(this,$c.REQUEST_UPDATE_CONSTRAINTS,Array.from(jc(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){L.error(new xe(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof dt&&(o=await o),r.push(kr(kr({},o),{},{direction:this.direction}))}catch(o){L.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class hx extends Lr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new Nfe}setVolume(){}createOutputTrack(){throw new xe(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Nfe{disconnect(){}connect(){}}function qW(e){return new dt((r,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=Ao()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Vr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(DA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function GA(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const i=gh(e.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!$8()&&i.frameRate&&(r.frameRate=i.frameRate),V8()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Vr()&&(r.frameRate={ideal:30,max:30}),r}function YW(e){const r={};return $8()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,$p()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function XW(e){const r=YW(e);if(e.encoderConfig){const i=BA(e.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),OA()&&(r.sampleRate=void 0),r}const Dfe=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=WL(h),m=WL(m),u=WL(u);const{max:_,min:E}=function(N,G,V){const j=200*Math.pow(V/15,.6)*Math.pow(N*G/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(h,m,u),{bitrateMax:S,bitrateMin:C}=r||{};S||L.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(C,"]"));const{maxFramerate:P}=oe("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||_,bitrateMin:C||E,scaleResolutionDownBy:1,scale:0}},JW=async(e,r,i)=>await(async(o,c,u)=>{const h=function(E){const S=[];for(let C=0;C<E.length;C+=2)S.push(parseInt(E.slice(C,C+2),16));return Uint8Array.from(S)}(cW(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(e.buffer,r,i),px=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new dt((i,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await QW(c);i({buffer:u,width:r.width,height:r.height})}else o(new xe(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},QW=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var ZW,ez,tz,nz,rz,iz,sz,oz,az,cz,lz,uz,dz,hz,pz,fz,mz,gz,xr,_z,yz,Ez,vz,Sz,bz,yh,Tz,wz,Cz,Rz,Iz,Az,Pz,Oz,kz,Nz,Dz,Lz,xz,ks;let Hr=(ZW=Ft({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),ez=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),tz=si(),nz=kv("LocalAudioTrack","_enabledMutex"),rz=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),iz=si(),sz=kv("LocalAudioTrack","_enabledMutex"),oz=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),az=si(),cz=si(),lz=si(),uz=Ft({argsMap:e=>[e.getTrackId()]}),dz=si(),hz=Ft({argsMap:e=>[e.getTrackId()]}),pz=si(),fz=Ft({argsMap:e=>[e.getTrackId()]}),mz=Ft({argsMap:(e,r)=>[e.getTrackId(),r.name]}),gz=Ft({argsMap:e=>[e.getTrackId()]}),Ln((xr=class extends jv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?sa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,i,o){super(e,i),Pe(this,"trackMediaType",Fv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new hx,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Is()&&!Kc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){ir(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&sa.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void L.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,ur(this,Et.NEED_REPLACE_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{L.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!IW())throw new xe(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await sa.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,i){return this._setEnabled(e,r,i)}async _setEnabled(e,r,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await ur(this,Et.NEED_ENABLE_TRACK,this),L.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await ur(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await ur(this,Et.NEED_MUTE_TRACK,this):await ur(this,Et.NEED_UNMUTE_TRACK,this))}getStats(){return km(()=>{L.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Wc(this,Et.GET_STATS)||kr({},sx)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Hc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Hc.ON_AUDIO_BUFFER),this._source.on(Hc.ON_AUDIO_BUFFER,i=>e(i))}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] start audio playback in element")),sa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?sa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&sa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,Et.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return dt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new xe(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new xe(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(Po.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await ur(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,Et.NEED_REPLACE_TRACK,this))}),e.on(Po.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Po.ON_TRACK),e.removeAllListeners(Po.ON_NODE)}bindProcessorContextEvents(e){e.on($c.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners($c.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof hx&&(this._trackSource=new UW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new KW(this._source.context,this.getTrackId(),"local"),r=new $W(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(Hc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(sa.stop(this.getTrackId()),this._source.play()),ur(this,Et.NEED_REPLACE_MIXING_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{L.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[ZW],Object.getOwnPropertyDescriptor(xr.prototype,"setVolume"),xr.prototype),Ln(xr.prototype,"setPlaybackDevice",[ez,tz],Object.getOwnPropertyDescriptor(xr.prototype,"setPlaybackDevice"),xr.prototype),Ln(xr.prototype,"setEnabled",[nz,rz,iz],Object.getOwnPropertyDescriptor(xr.prototype,"setEnabled"),xr.prototype),Ln(xr.prototype,"setMuted",[sz,oz,az],Object.getOwnPropertyDescriptor(xr.prototype,"setMuted"),xr.prototype),Ln(xr.prototype,"getStats",[cz],Object.getOwnPropertyDescriptor(xr.prototype,"getStats"),xr.prototype),Ln(xr.prototype,"setAudioFrameCallback",[lz],Object.getOwnPropertyDescriptor(xr.prototype,"setAudioFrameCallback"),xr.prototype),Ln(xr.prototype,"play",[uz,dz],Object.getOwnPropertyDescriptor(xr.prototype,"play"),xr.prototype),Ln(xr.prototype,"stop",[hz,pz],Object.getOwnPropertyDescriptor(xr.prototype,"stop"),xr.prototype),Ln(xr.prototype,"close",[fz],Object.getOwnPropertyDescriptor(xr.prototype,"close"),xr.prototype),Ln(xr.prototype,"pipe",[mz],Object.getOwnPropertyDescriptor(xr.prototype,"pipe"),xr.prototype),Ln(xr.prototype,"unpipe",[gz],Object.getOwnPropertyDescriptor(xr.prototype,"unpipe"),xr.prototype),xr),HA=(_z=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),yz=si(),Ez=kv("MicrophoneAudioTrack","_enabledMutex"),vz=Ft({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),Sz=si(),bz=Ft({argsMap:e=>[e.getTrackId()]}),Ln((yh=class extends Hr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,i,o){super(e,r.encoderConfig?BA(r.encoderConfig):{},o,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Av()||LL())&&nr.bindInterruptDetectorTrack(this)}async setDevice(e){if(L.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await Yc.getDeviceById(e),i={};i.audio=kr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await qc(i,this.getTrackId())}catch(c){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await qc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Yc.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}L.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,i){if(r)return L.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),e),oe("AUTO_RESET_AUDIO_ROUTE")&&(Ao()||du())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await ur(this,Et.NEED_DISABLE_TRACK,this)}catch(h){throw L.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=kr({},this._constraints),u=Yc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await qc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await ur(this,Et.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}L.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Av()||LL())&&nr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ao()||du())&&this._enabled&&!this._isClosed&&nr.duringInterruption){const e=async()=>{nr.off(fs.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};nr.on(fs.IOS_INTERRUPTION_END,e)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Uv.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,i=Yc.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await qc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on($c.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners($c.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[_z,yz],Object.getOwnPropertyDescriptor(yh.prototype,"setDevice"),yh.prototype),Ln(yh.prototype,"setEnabled",[Ez,vz,Sz],Object.getOwnPropertyDescriptor(yh.prototype,"setEnabled"),yh.prototype),Ln(yh.prototype,"close",[bz],Object.getOwnPropertyDescriptor(yh.prototype,"close"),yh.prototype),yh),Lfe=(Tz=Ft({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),wz=si(),Cz=Ft({argsMap:e=>[e.getTrackId()]}),Rz=si(),Iz=Ft({argsMap:e=>[e.getTrackId()]}),Az=si(),Pz=Ft({argsMap:e=>[e.getTrackId()]}),Oz=si(),kz=Ft({argsMap:e=>[e.getTrackId()]}),Nz=si(),Dz=Ft({argsMap:e=>[e.getTrackId()]}),Lz=Ft({argsMap:e=>[e.getTrackId()]}),xz=si(),Ln((ks=class extends Hr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,i,o){super(r.createOutputTrack(),i,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(Hc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Uv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){ir(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Tz,wz],Object.getOwnPropertyDescriptor(ks.prototype,"startProcessAudioBuffer"),ks.prototype),Ln(ks.prototype,"pauseProcessAudioBuffer",[Cz,Rz],Object.getOwnPropertyDescriptor(ks.prototype,"pauseProcessAudioBuffer"),ks.prototype),Ln(ks.prototype,"seekAudioBuffer",[Iz,Az],Object.getOwnPropertyDescriptor(ks.prototype,"seekAudioBuffer"),ks.prototype),Ln(ks.prototype,"resumeProcessAudioBuffer",[Pz,Oz],Object.getOwnPropertyDescriptor(ks.prototype,"resumeProcessAudioBuffer"),ks.prototype),Ln(ks.prototype,"stopProcessAudioBuffer",[kz,Nz],Object.getOwnPropertyDescriptor(ks.prototype,"stopProcessAudioBuffer"),ks.prototype),Ln(ks.prototype,"close",[Dz],Object.getOwnPropertyDescriptor(ks.prototype,"close"),ks.prototype),Ln(ks.prototype,"setAudioBufferPlaybackSpeed",[Lz,xz],Object.getOwnPropertyDescriptor(ks.prototype,"setAudioBufferPlaybackSpeed"),ks.prototype),ks);class ki extends Hr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Bv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,dr(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(L.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):L.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){L.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}kA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof ki?i.emit(L_.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class xfe extends MW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Hc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):L.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Mz=new Map;class fx{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(L.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",_h.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",lo.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return L.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&nr.curState==="running"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(U8())),G8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=lo.PLAYING;break;case"loadeddata":if(this.videoState=_h.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=lo.CANPLAY;break;case"stalled":this.videoElementStatus=lo.STALLED;break;case"suspend":this.videoElementStatus=lo.SUSPEND;break;case"pause":this.videoElementStatus=lo.PAUSED,Ao()||du()||Is()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=lo.WAITING;break;case"abort":this.videoElementStatus=lo.ABORT;break;case"ended":this.videoElementStatus=lo.ENDED;break;case"emptied":this.videoElementStatus=lo.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=lo.ERROR,L.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Xp.lastVisibleTime<Xp.lastHiddenTime||u<Xp.lastHiddenTime||u<Xp.lastVisibleTime)return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(U8())),G8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),nr.on(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.on(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&zW(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(L.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):L.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Nn();if((o.name==="Safari"&&Number(o.version)===15||Av())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return L.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const o=i.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new dt((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await QW(m);u({buffer:_,width:o.width,height:o.height})}else h(new xe(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await px(r)}destroy(){this.renderStats=void 0,nr.off(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.off(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=_h.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=lo.INIT,!this.videoElementCheckInterval&&(Uz.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=lo.DESTROYED)},1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===_h.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=_h.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(E,S)=>{if(this.videoElementStatus===lo.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const N=S.presentationTime-u.presentationTime;this.videoState===_h.VideoStateStarting&&(this.videoState=_h.VideoStateDecoding),this.videoState===_h.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),N<oe("VIDEO_FREEZE_DURATION")&&this.videoState===_h.VideoStateFrozen&&(this.videoState=_h.VideoStateDecoding),N>oe("VIDEO_FREEZE_DURATION")&&Xp.lastVisibleTime>=Xp.lastHiddenTime&&u.timestamp>Xp.lastVisibleTime&&u.timestamp>Xp.lastHiddenTime&&(this.renderFreezeAccTime+=N)}u=kr(kr({},S),{},{timestamp:E})}var C,P;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((C=(P=this.videoElement).requestVideoFrameCallback)===null||C===void 0||C.call(P,_))};(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),OA()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Nn();o.name==="Safari"&&Number(o.version)===15||Av()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{L.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){Uz.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=lo.NONE}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{L.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{L.error(o)}),this.autoplayFailed=!1,pT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};pT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),WW()}}const Uz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Vz extends fx{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await px(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Fz,jz,Bz,Wz,zz,Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,eG,tG,nG,rG,iG,sG,oG,aG,cG,Cn,lG,uG,dG,hG,pG,fG,mG,gG,Jc;let vr=(Fz=Ft({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),jz=si(),Bz=Ft({argsMap:e=>[e.getTrackId()]}),Wz=kv("LocalVideoTrack","_enabledMutex"),zz=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),Gz=si(),Hz=kv("LocalVideoTrack","_enabledMutex"),$z=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),Kz=si(),qz=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),Yz=si(),Xz=si(),Jz=Ft({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),Qz=si(),Zz=si(),eG=si(),tG=si(),nG=si(),rG=si(),iG=si(),sG=Ft({argsMap:(e,r)=>[e.getTrackId(),r.name]}),oG=Ft({argsMap:e=>[e.getTrackId()]}),aG=Ft({argsMap:e=>[e.getTrackId()]}),cG=Ft({argsMap:(e,r,i)=>[e.getTrackId(),r.label,i]}),Cn=class voe extends jv{get videoHeight(){if(Is()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Is()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==lo.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,o,c,u,h){if(super(r,u),Pe(this,"trackMediaType",Fv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Is()){const{width:m,height:_}=r.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(hr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(kL(zn.CHROME,115)&&AA().indexOf("Windows")!==-1){const m=function(_,E){if("VideoFrame"in window&&"TransformStream"in window&&Vn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),C=new MediaStreamTrackGenerator({kind:"video"});let P,N,G=Date.now();const V=()=>{j&&(clearInterval(j),j=void 0),P&&(P.close(),P=void 0),_.stop(),N=void 0,C.removeEventListener("ended",V)};let j=window.setInterval(()=>{if(N&&P&&Date.now()-G>1e3)try{C.readyState==="live"?N.enqueue(P.clone()):V()}catch{V()}},1e3);const Y=new TransformStream({transform:(Z,de)=>{C.readyState==="live"?(N=de,G=Date.now(),P===void 0?(P=Z,de.enqueue(Z.clone())):(de.enqueue(P),P=Z)):Z.close()}});return C.addEventListener("ended",V),S.readable.pipeThrough(Y).pipeTo(C.writable),C}}(r);m&&(L.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(hr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new HW(this.getTrackId(),"local"),this._processorDestination=new GW(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=kr(kr(kr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new fx(o):this._player=new Vz(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Uv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await ur(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ur(this,Et.NEED_ENABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await ur(this,Et.NEED_MUTE_TRACK,this):await ur(this,Et.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,i){if(!this._enabled)throw new xe(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=gh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=GA({encoderConfig:r});(Is()||Ao()||du())&&(o.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new xe(te.UNEXPECTED_ERROR,c.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(L)}}getStats(){return km(()=>{L.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Wc(this,Et.GET_STATS)||kr({},ox)}async setBeautyEffect(r){L.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await px(r)}async setBitrateLimit(r){L.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void L.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await ur(this,Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,L.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return L.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,L.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){qW(this._originMediaStreamTrack).then(r=>{let[i,o]=r;this._videoHeight=o,this._videoWidth=i}).catch(DA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new xe(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");L.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=gh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(L)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,E,S,C,P){const N=oe("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:C,max:P};if(P===void 0){var G;const j=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*E/640/360,.75));P=N==="STANDARD_BITRATE"?4*j:2*j,C=(G=C)!==null&&G!==void 0?G:j}else{var V;C=(V=C)!==null&&V!==void 0?V:Math.floor(P/10)}return{min:C,max:P}}(r,i,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,L.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,i;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=Y8.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const E=It.reportApiInvoke(null,{tag:jr.TRACER,name:wi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new xe(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new xe(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=kr(kr({},o),gh(r))),o=O_(o);const c=dr(8,"track-video-cloned-"),u=new voe(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,O_(this._scalabilityMode),this._optimizationMode,c,O_(this._hints));return r&&o&&u.setEncoderConfiguration(o),L.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new xe(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new xe(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(km(()=>{It.reportApiInvoke(null,{name:wi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:jr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void L.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new xe(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void L.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):L.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Po.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await ur(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,Et.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Po.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners($c.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners($c.REQUEST_CONSTRAINTS)}},Ln(Cn.prototype,"play",[Fz,jz],Object.getOwnPropertyDescriptor(Cn.prototype,"play"),Cn.prototype),Ln(Cn.prototype,"stop",[Bz],Object.getOwnPropertyDescriptor(Cn.prototype,"stop"),Cn.prototype),Ln(Cn.prototype,"setEnabled",[Wz,zz,Gz],Object.getOwnPropertyDescriptor(Cn.prototype,"setEnabled"),Cn.prototype),Ln(Cn.prototype,"setMuted",[Hz,$z,Kz],Object.getOwnPropertyDescriptor(Cn.prototype,"setMuted"),Cn.prototype),Ln(Cn.prototype,"setEncoderConfiguration",[qz,Yz],Object.getOwnPropertyDescriptor(Cn.prototype,"setEncoderConfiguration"),Cn.prototype),Ln(Cn.prototype,"getStats",[Xz],Object.getOwnPropertyDescriptor(Cn.prototype,"getStats"),Cn.prototype),Ln(Cn.prototype,"setBeautyEffect",[Jz,Qz],Object.getOwnPropertyDescriptor(Cn.prototype,"setBeautyEffect"),Cn.prototype),Ln(Cn.prototype,"getCurrentFrameData",[Zz],Object.getOwnPropertyDescriptor(Cn.prototype,"getCurrentFrameData"),Cn.prototype),Ln(Cn.prototype,"getCurrentFrameImage",[eG],Object.getOwnPropertyDescriptor(Cn.prototype,"getCurrentFrameImage"),Cn.prototype),Ln(Cn.prototype,"setBitrateLimit",[tG],Object.getOwnPropertyDescriptor(Cn.prototype,"setBitrateLimit"),Cn.prototype),Ln(Cn.prototype,"setOptimizationMode",[nG],Object.getOwnPropertyDescriptor(Cn.prototype,"setOptimizationMode"),Cn.prototype),Ln(Cn.prototype,"setScalabiltyMode",[rG],Object.getOwnPropertyDescriptor(Cn.prototype,"setScalabiltyMode"),Cn.prototype),Ln(Cn.prototype,"updateMediaStreamTrackResolution",[iG],Object.getOwnPropertyDescriptor(Cn.prototype,"updateMediaStreamTrackResolution"),Cn.prototype),Ln(Cn.prototype,"pipe",[sG],Object.getOwnPropertyDescriptor(Cn.prototype,"pipe"),Cn.prototype),Ln(Cn.prototype,"unpipe",[oG],Object.getOwnPropertyDescriptor(Cn.prototype,"unpipe"),Cn.prototype),Ln(Cn.prototype,"close",[aG],Object.getOwnPropertyDescriptor(Cn.prototype,"close"),Cn.prototype),Ln(Cn.prototype,"replaceTrack",[cG],Object.getOwnPropertyDescriptor(Cn.prototype,"replaceTrack"),Cn.prototype),Cn),mx=(lG=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),uG=si(),dG=kv("CameraVideoTrack","_enabledMutex"),hG=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),pG=si(),fG=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),mG=si(),gG=Ft({argsMap:e=>[e.getTrackId()]}),Jc=class Soe extends vr{get __className__(){return"CameraVideoTrack"}constructor(r,i,o,c,u,h){super(r,gh(i.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Av()||LL())&&!function(){const m=Nn();if(m.os!==Gi.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&H8()&&this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=gh(this._config.encoderConfig),nr.on(fs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),nr.on(fs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(L.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await Yc.getDeviceById(r),o={};o.video=kr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await qc(o,this.getTrackId())}catch(u){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await qc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Yc.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}L.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){L.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:kr(kr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await qc(i,this.getTrackId())}catch(c){throw L.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await qc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=kr({},i.video),L.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await qc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await ur(this,Et.NEED_ENABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await ur(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new xe(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=gh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=Br(this._config);o.encoderConfig=r;const c=GA(o);(Is()||Ao()||du())&&(c.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new xe(te.UNEXPECTED_ERROR,u.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(L)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ao()||du())&&this._enabled&&!this._isClosed&&nr.duringInterruption){const r=async()=>{nr.off(fs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};nr.on(fs.IOS_INTERRUPTION_END,r)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Uv.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,o=Yc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await qc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),nr.off(fs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),nr.off(fs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=kr(kr({},o),gh(r))),o=O_(o);const c=dr(8,"track-cam-cloned-"),u=new Soe(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,O_(kr(kr({},this._config),{},{encoderConfig:o})),O_(this._constraints),O_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),L.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on($c.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on($c.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Ln(Jc.prototype,"setDevice",[lG,uG],Object.getOwnPropertyDescriptor(Jc.prototype,"setDevice"),Jc.prototype),Ln(Jc.prototype,"setEnabled",[dG,hG,pG],Object.getOwnPropertyDescriptor(Jc.prototype,"setEnabled"),Jc.prototype),Ln(Jc.prototype,"setEncoderConfiguration",[fG,mG],Object.getOwnPropertyDescriptor(Jc.prototype,"setEncoderConfiguration"),Jc.prototype),Ln(Jc.prototype,"close",[gG],Object.getOwnPropertyDescriptor(Jc.prototype,"close"),Jc.prototype),Jc);function gx(e,r,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=kr(kr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?L.debug("[".concat(e,"] set content hint to"),i.optimizationMode):L.debug("[".concat(e,"] set content hint failed")))):L.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var _G,yG,EG,vG,wl,SG,bG,TG,wG,CG,RG,uo;class IG extends DW{getUserId(){return this._userId}constructor(r,i,o,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(dr(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,L.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let zv=(_G=Ft({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),yG=Ft({argsMap:e=>[e.getTrackId()]}),EG=Ft({argsMap:(e,r)=>[e.getTrackId(),r.name]}),vG=Ft({argsMap:e=>[e.getTrackId()]}),Ln((wl=class extends IG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==lo.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,i,o){super(e,r,i,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",Fv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new HW(this.getTrackId(),"remote"),this.processorDestination=new GW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return km(()=>{L.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Wc(this,Et.GET_STATS)||kr({},kW)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=kr(kr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new fx(i):this._player=new Vz(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Vv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Vv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Vv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){qW(this._originMediaStreamTrack).then(e=>{let[r,i]=e;this._videoHeight=i,this._videoWidth=r}).catch(DA)}_updatePlayerSource(){L.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=Y8.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=It.reportApiInvoke(null,{tag:jr.TRACER,name:wi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new xe(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new xe(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Po.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Po.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(L_.SEI_RECEIVED,e)}}).prototype,"play",[_G],Object.getOwnPropertyDescriptor(wl.prototype,"play"),wl.prototype),Ln(wl.prototype,"stop",[yG],Object.getOwnPropertyDescriptor(wl.prototype,"stop"),wl.prototype),Ln(wl.prototype,"pipe",[EG],Object.getOwnPropertyDescriptor(wl.prototype,"pipe"),wl.prototype),Ln(wl.prototype,"unpipe",[vG],Object.getOwnPropertyDescriptor(wl.prototype,"unpipe"),wl.prototype),wl),Gv=(SG=Ft({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),bG=Ft({argsMap:(e,r)=>[e.getTrackId(),r]}),TG=Ft({argsMap:e=>[e.getTrackId()]}),wG=Ft({argsMap:e=>[e.getTrackId()]}),CG=Ft({argsMap:(e,r)=>[e.getTrackId(),r.name]}),RG=Ft({argsMap:e=>[e.getTrackId()]}),Ln((uo=class extends IG{get isPlaying(){return this._useAudioElement?sa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,i,o){super(e,r,i,o),Pe(this,"trackMediaType",Fv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new hx,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new UW(e,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Hc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Vv.FIRST_FRAME_DECODED)}),this.processorContext=new KW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new $W(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Hc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Hc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Hc.ON_AUDIO_BUFFER),this._source.on(Hc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?sa.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!IW())throw new xe(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await sa.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return km(()=>{L.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Wc(this,Et.GET_STATS)||kr({},OW)}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] use audio element to play")),sa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?sa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&sa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new xe(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new xe(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new xe(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Po.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Po.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Po.ON_TRACK),this.processorDestination.removeAllListeners(Po.ON_NODE)}}).prototype,"setVolume",[SG],Object.getOwnPropertyDescriptor(uo.prototype,"setVolume"),uo.prototype),Ln(uo.prototype,"setPlaybackDevice",[bG],Object.getOwnPropertyDescriptor(uo.prototype,"setPlaybackDevice"),uo.prototype),Ln(uo.prototype,"play",[TG],Object.getOwnPropertyDescriptor(uo.prototype,"play"),uo.prototype),Ln(uo.prototype,"stop",[wG],Object.getOwnPropertyDescriptor(uo.prototype,"stop"),uo.prototype),Ln(uo.prototype,"pipe",[CG],Object.getOwnPropertyDescriptor(uo.prototype,"pipe"),uo.prototype),Ln(uo.prototype,"unpipe",[RG],Object.getOwnPropertyDescriptor(uo.prototype,"unpipe"),uo.prototype),uo);const Xp=new class extends Lr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),L.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class AG extends Lr{constructor(r,i){super(),Pe(this,"trackMediaType",Fv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new dt((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;i(new xe(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new xe(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new xe(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[WA.OPEN,WA.CLOSE,WA.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),r.addEventListener(i,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Mfe extends AG{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&L.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(WA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Ufe extends AG{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function $A(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>$I.revokeObjectURL(e),0),new Worker($I.createObjectURL(e))}const PG=71,_x=1,yx=2,Ex=1,OG=2;var Jp=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Jp||{});function kG(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==PG)return;const o=e.getUint16(1),c=_x+yx+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let m=_x+yx;for(;m<c;){const _=e.getUint8(m),E=e.getUint16(m+Ex),S=Ex+OG;if(_===Jp.AUDIO_LEVEL){let C=e.getUint8(m+S);for(let P=1;P<E;P++)C=C<<8|e.getUint8(m+S+P);h.tlv.push({tag:_,length:E,value:r?127^C>>1:127&C})}else if(_===Jp.METADATA||_===Jp.AUDIO_64_BIT_PTS){const C=new Uint8Array(E);for(let P=0;P<E;P++)C[P]=e.getUint8(m+S+P);h.tlv.push({tag:_,length:E,value:C})}m+=S+E}return h}const KA=new Map,qA=127,U_=1e-10,vx=139/13,YA=new Map;function Sx(e,r,i){const o="".concat(e,"-").concat(r,"-").concat(i);let c=0;return YA.has(o)?c=YA.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let E=1;for(let S=h,C=1;S>m;S--,C++)E=E*S/C;return E}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(i)+i*e,YA.set(o,c)),c<U_&&(c=U_),c}function NG(e,r,i){const o=r.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let E=m+c;m<E;m++)e[m]>i&&_++;r[h]!==_&&(r[h]=_,u=!0)}return u}window.cache=YA;let Vfe=0;class DG{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",U_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",U_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",U_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(Vfe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,o=this.minLevel+vx;let c=!1;for(let u=0;u<r.length;++u){let h=i[u];h<o&&(h=0);const m=Math.floor(h/vx);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return NG(this.mediums,this.longs,4)}computeMediums(){return NG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Sx(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=Sx(this.longs[0],10,47),this.longSpeechActivityScore>U_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Sx(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(im(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=r;return r<0&&(o=0),r>qA&&(o=qA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+vx?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>qA&&(i=qA),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Ffe{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class bx{constructor(r,i,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=o}}class jfe extends Lr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new DG(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,o){const c=r.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==r;)++_;return new bx(c,_,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new bx(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new bx(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Ffe(this),this.decisionMaker.execute())}makeDecision(r){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=jc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const _=this.relativeSpeechActivities;let E=2;for(const S of this.speakers.entries()){const[C,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let j=0;j<_.length;++j){const Y=m==null?U_:m.getSpeechActivityScore(j);_[j]=Math.log(P.getSpeechActivityScore(j)/Y)}const N=_[0],G=_[1],V=_[2];N>3&&G>2&&V>0&&G>E&&(E=G,u=C)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const i=[];for(const c of jc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Hv=new Map;let gd=null,XA=null;const LG=3;let V_=[];const _d=new Map,JA=new Map;class Bfe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=i,this.setActive(_d.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(jc(_d).call(_d)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let o;return Array.from(jc(_d).call(_d)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let o;return Array.from(jc(_d).call(_d)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let QA;function xG(e){const r=_d.get(e);r&&(_d.delete(e),r.clearTimer())}const ZA=new Map,Wfe=new Map;function zfe(e,r,i){let o=new Uint8Array(e,r,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const eP=new Map,TT=new Map;(function(){const e=Nn();ps.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ps.getStreamFromExtension=e.name===zn.CHROME&&Number(e.version)>34,ps.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),ps.supportMinBitrate=e.name===zn.CHROME||e.name===zn.EDGE,ps.supportSetRtpSenderParameters=function(){const r=Nn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Kp()||!(!Is()&&!PA())||r.name===zn.FIREFOX&&Number(r.version)>=64)}(),e.name===zn.SAFARI&&(Number(e.version)>=14?ps.supportDualStream=!0:ps.supportDualStream=!1),ps.webAudioMediaStreamDest=function(){const r=Nn();return!(r.name===zn.SAFARI&&Number(r.version)<12)}(),ps.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ps.supportWebGL=typeof WebGLRenderingContext<"u",ps.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Kp()||(ps.webAudioWithAEC=!0),ps.supportShareAudio=function(){const r=Nn();return(r.os===Gi.WIN_10||r.os===Gi.WIN_81||r.os===Gi.WIN_7||r.os===Gi.LINUX||r.os===Gi.MAC_OS||r.os===Gi.CHROMIUM_OS)&&r.name===zn.CHROME&&Number(r.version)>=74}(),ps.supportDataChannel=!!(hT(76)||function(r){const i=Nn();return!(i.name!==zn.FIREFOX||!i.osVersion)&&Number(i.version)>=r}(68)||j8(14)),ps.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Vr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),ps.supportWebRTCEncodedTransform=function(){const r=Nn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),ps.supportWebRTCInsertableStream=function(){const r=Nn();return(r.name===zn.CHROME||r.name===zn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ps.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ps.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,NA(()=>{ps.supportDualStreamEncoding=function(){const r=Nn();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))}(),L.debug("browser ua: ",navigator.userAgent),L.info("browser info: ",e),L.info("browser compatibility: ",ps)})})();const Gfe=["CHINA","GLOBAL"],MG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],F_=[],$v=[];function j_(e,r){return!!r&&F_.some(i=>i.uid===e&&i.channelName===r)}function Tx(){return $v.length>0}var Hfe=i6.forEach,UG=Sp("forEach")?[].forEach:function(e){return Hfe(this,e,arguments.length>1?arguments[1]:void 0)};Wn({target:"Array",proto:!0,forced:[].forEach!=UG},{forEach:UG});var $fe=ic("Array").forEach,Kfe=Pc,qfe=Si,Yfe=k,Xfe=$fe,wx=Array.prototype,Jfe={DOMTokenList:!0,NodeList:!0},Qfe=function(e){var r=e.forEach;return e===wx||Yfe(wx,e)&&r===wx.forEach||qfe(Jfe,Kfe(e))?Xfe:r},Zfe=l(Qfe),eme=Bo,VG=Nc;Wn({target:"Object",stat:!0,forced:d(function(){VG(1)})},{keys:function(e){return VG(eme(e))}});var FG=l(_t.Object.keys),tme=l(nE),nme=l(iE),rme=Wn,jG=Gg,ime=p_,sme=ot,BG=ge,ome=hi,ame=Re,cme=LI,lme=gr,ume=Ts,dme=qB("slice"),hme=lme("species"),Cx=Array,pme=Math.max;rme({target:"Array",proto:!0,forced:!dme},{slice:function(e,r){var i,o,c,u=ame(this),h=ome(u),m=BG(e,h),_=BG(r===void 0?h:r,h);if(jG(u)&&(i=u.constructor,(ime(i)&&(i===Cx||jG(i.prototype))||sme(i)&&(i=i[hme])===null)&&(i=void 0),i===Cx||i===void 0))return ume(u,m,_);for(o=new(i===void 0?Cx:i)(pme(_-m,0)),c=0;m<_;m++,c++)m in u&&cme(o,c,u[m]);return o.length=c,o}});var fme=ic("Array").slice,mme=k,gme=fme,Rx=Array.prototype,_me=function(e){var r=e.slice;return e===Rx||mme(Rx,e)&&r===Rx.slice?gme:r},yme=l(_me);function St(e,r,i,o,c){var u,h,m,_={};return Zfe(u=FG(o)).call(u,function(E){_[E]=o[E]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=tme(h=nme(m=yme(i).call(i)).call(m)).call(h,function(E,S){return S(e,r,E)||E},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(GB(e,r,_),_=null),_}let tP=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Ix=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),fu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Oo=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ut=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),fr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),$t=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),zt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),wT=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),En=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),ko=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Zt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function nP(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw L.error("Invalid Channel Name ".concat(e)),new Oe(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function rP(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||q8(e,1,255)))throw new Oe(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&L.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Qp=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Eme={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Ax={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Px(e,r){ds(e.url,"".concat(r,".url"),1,1e3,!1),Fr(e.x)||ir(e.x,"".concat(r,".x"),0,1e4),Fr(e.y)||ir(e.y,"".concat(r,".y"),0,1e4),Fr(e.width)||ir(e.width,"".concat(r,".width"),0,1e4),Fr(e.height)||ir(e.height,"".concat(r,".height"),0,1e4),Fr(e.zOrder)||ir(e.zOrder,"".concat(r,".zOrder"),0,255),Fr(e.alpha)||ir(e.alpha,"".concat(r,".alpha"),0,1,!1)}const vme={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Lm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Ox=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Ni=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function WG(e){if(!e.channelName)throw new Oe(te.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Oe(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ds(e.token,"info.token",1,2047),rP(e.uid),nP(e.channelName),!0}let No=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Zp=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),ja=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Kv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Yn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),rs=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),iP=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),$i=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Gn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const zG=[Gn.AFRICA,Gn.ASIA,Gn.CHINA,Gn.EUROPE,Gn.GLOBAL,Gn.INDIA,Gn.JAPAN,Gn.NORTH_AMERICA,Gn.OCEANIA,Gn.OVERSEA,Gn.SOUTH_AMERICA];let Fs=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const sP={CHINA:{},ASIA:{CODE:Fs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Fs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Fs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Fs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Fs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Fs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Fs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Fs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Fs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Fs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Fs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Fs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Fs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};JL&&(sP.CHINA={CODE:Fs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let CT=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function GG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class HG extends Lr{constructor(r,i){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class $G extends HG{constructor(r,i){super(r,i),K(this,"establishPromise",void 0)}}let gt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),js=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),ef=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const KG=["disconnected","failed"];let Ke=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),qn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Lt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),mu=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),gu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),is=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),qG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Eh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Cl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),yd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),qv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),oi=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Yv=function(e){return e.ABORT="abort",e}({}),xm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Sme=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const bme={[tP.ACCESS_POINT]:{[Oo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Oo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Oo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Oo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Oo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Oo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Oo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[tP.UNILBS]:{[fu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[fu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[fu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[fu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[fu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[fu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[fu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[fu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[fu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[fu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[fu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[fu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[tP.STRING_UID_ALLOCATOR]:{[Ix.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Ix.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Ix.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Xv(e){const r=bme[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[e%1e4];if(!i){if(Math.floor(e/1e4)===tP.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Tme={[Ut.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ut.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ut.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ut.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ut.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ut.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ut.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ut.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ut.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ut.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ut.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ut.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ut.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ut.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ut.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ut.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ut.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ut.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ut.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ut.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ut.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ut.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ut.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ut.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ut.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ut.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ut.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ut.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ut.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ut.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ut.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ut.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ut.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ut.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ut.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ut.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ut.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ut.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ut.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ut.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ut.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ut.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ut.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ut.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ut.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ut.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ut.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ut.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ut.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ut.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ut.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ut.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ut.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ut.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ut.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ut.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ut.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ut.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ut.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ut.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function RT(e){return Tme[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function YG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function kx(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?YG(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):YG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function XG(e,r){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(r){const u=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const wme=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Cme=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Rme=/wss:\/\/(.+):([0-9]+)\/?/,Ime=/wss:\/\/(.[^\/]+)\/?/;let Ame=0;class Pme{constructor(r,i){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++Ame,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];L.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,o){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:o});const c=oe("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var N;return st(N=r.host).call(N,P)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(P=>{_.push(XG(kx(kx({},r),{},{host:r.host.replace(m,P)}),i))});else{const P=kx({},r);if(i&&m){const N=c.find(G=>G!==m);N&&(P.host=P.host.replace(m,N))}_.push(XG(P,i))}try{_.forEach(P=>{const N=new WebSocket(P);N.binaryType="arraybuffer",h.push(N),this.logger("ws is connecting:",N.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(N=>N.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,o);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Oe(te.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const E=dT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(N=>{N!==P&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))}),this.websockets.length=0,E.resolve(P)},P.onclose=N=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const G=h.every(V=>V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),E.reject({code:N.code,reason:iP.A_ROUND_WS_FAILED})):!i&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),C()),i?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=N=>this.logger("".concat(P.url," onmessage: ").concat(N.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},C=()=>{if(E.isResolved)return S();Nn().os===Gi.MAC_OS&&Vr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{E.resolve(P)}).catch(P=>{this.isNormalPortFailed&&E.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,C()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,i,o,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(u){let h,m,_;return[,h,m,_]=u.match(wme)||[],h||([,m,_]=u.match(Cme)||[]),m&&_||([,m,_]=u.match(Rme)||[]),m&&_||([,m]=u.match(Ime)||[]),m||L.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(L.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function JG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class QG extends Lr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;st(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Zt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Zt.CONNECTED):this._state==="closed"?this.emit(Zt.CLOSED):this._state==="failed"&&this.emit(Zt.FAILED))}resetReconnectCount(r){L.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(C){for(var P=1;P<arguments.length;P++){var N=arguments[P]!=null?arguments[P]:{};P%2?JG(Object(N),!0).forEach(function(G){K(C,G,N[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(N)):JG(Object(N)).forEach(function(G){Object.defineProperty(C,G,Object.getOwnPropertyDescriptor(N,G))})}return C}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Vs("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=i,E=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);hc.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S),fi.on(Pv.NETWORK_STATE_CHANGE,(C,P)=>{C!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(C)),C===hc.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{const c=dT(),u=this.urls[this.currentURLIndex];oe("ENABLE_PREALLOC_PC")&&this.emit(qG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Zt.CLOSED,()=>{c.reject(new xe(te.WS_DISCONNECT))}),this.once(Zt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void L.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),L.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new xe(te.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new xe(te.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const o=dT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var C;(C=this.store)===null||C===void 0||C.signalChannelOpen(),L.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var C;if(L.debug("[".concat(this.name,"] websocket close ").concat((C=this.websocket)===null||C===void 0?void 0:C.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new xe(te.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Wc(this,Zt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,N=await this.reconnectWithAction(P);if(this.state==="closed")return void L.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return o.reject(new xe(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(Zt.ON_MESSAGE,S)},m=S=>{L.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),L.debug("[".concat(this.name,"] start connect, url:"),r);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const C=this.state==="closed",P=S instanceof xe,N=P&&S.code===te.WS_ABORT,G=P&&S.code===te.WS_ERR,V=P?S.message:S&&(S.reason||S.toString());L.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(V)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[S]},_),C||G?(o.reject(C?new xe(te.WS_DISCONNECT,"websocket is closed: ".concat(V)):new xe(te.WS_ERR,"init websocket failed: ".concat(V))),G&&L.error("[".concat(this.name,"] init websocket failed: ").concat(V))):u&&u(S)}return o.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;L.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||fi.isOnline||!fi.onlineWaiter||(this.onlineReconnectListener=fi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=zL(this.reconnectCount,this.retryConfig);L.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await dt.race([hs(h),this.onlineReconnectListener||new dt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Zt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);L.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(L.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Ps(this,Zt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;L.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&st(m).call(m,"dynamic key expired")?(this.emit(Zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,i)}return!0}}class Nx extends QG{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const o=dT(),c=function(h,m){return new Pme(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new xe(te.WS_ABORT,"choose best websocket aborted"))};const u=oe("GATEWAY_DOMAINS");return L.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class IT extends QG{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new dt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new xe(te.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let _;const E=r.indexOf("?h="),S=m.find(G=>E!==-1?st(r).call(r,G,E):st(r).call(r,G));L.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let C=!this.tryDoubleDomain||!S;if(!C&&S){var P;const G=Date.now();try{m.forEach(V=>{const j=E===-1?r.replace(S,V):r.substr(0,E)+r.substr(E).replace(S,V),Y=new WebSocket(j);Y.binaryType="arraybuffer",h.push(Y),L.debug("[choose-best-ws] ws is connecting:",Y.url)})}catch{for(L.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(j=>j.close());h.length;)h.pop();C=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(V=>V.url),service:"gateway"},i),h.forEach(V=>{V.onopen=()=>{if(u)return;const j=Date.now()-G;L.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),h.filter(Y=>Y!==V).forEach(Y=>{L.debug("[choose-best-ws]close backup websocket: ".concat(Y.url)),Y.close()}),u=!0,o(V)},V.onclose=j=>{_=j,!u&&(h.find(Y=>!(Y.readyState===WebSocket.CLOSED||Y.readyState===WebSocket.CLOSING))||(L.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},V.onmessage=j=>{L.debug("[choose-best-ws]".concat(V.url," onmessage: ").concat(j.data))}}),hs(this.forceCloseTimeout).then(()=>{h.forEach(V=>{V.readyState!==WebSocket.OPEN&&V.close()})})}if(C){var N;let G;L.debug("[choose-best-ws] use single url: ",r),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[r],service:"gateway"},i);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(V){const j=new xe(te.WS_ERR,"init websocket failed! Error: ".concat(V.toString()));return L.error("[".concat(this.name,"]").concat(j)),void c(j)}G.onopen=()=>{o(G)},G.onclose=V=>{c(V)},G.onmessage=V=>{L.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(V.data))},hs(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Ome extends Lr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===fr.CONNECTED?this.emit($t.WS_CONNECTED):r===fr.RECONNECTING?this.emit($t.WS_RECONNECTING,this._websocketReconnectReason):r===fr.CLOSED&&this.emit($t.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",fr.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new uW(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit($t.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===En.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===En.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Kn.UID_BANNED);break;case 15:this.close(Kn.IP_BANNED);break;case 16:this.close(Kn.CHANNEL_BANNED)}if(c._type===En.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ut.ERR_LICENSE_MISSING:this.close(Kn.LICENSE_MISSING);break;case Ut.ERR_LICENSE_EXPIRED:this.close(Kn.LICENSE_EXPIRED);break;case Ut.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Kn.LICENSE_MINUTES_EXCEEDED);break;case Ut.ERR_LICENSE_PERIOD_INVALID:this.close(Kn.LICENSE_PERIOD_INVALID);break;case Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Kn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ut.ERR_LICENSE_ILLEGAL:this.close(Kn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new Nx("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fr.CONNECTED&&this.reconnect("retry",As.OFFLINE)})}async request(r,i,o,c){const u=dr(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new dt((G,V)=>{if(this.connectionState===fr.CONNECTED)return G();const j=()=>{this.off($t.WS_CLOSED,Y),G()},Y=()=>{this.off($t.WS_CONNECTED,j),V(new Oe(te.WS_ABORT))};this.once($t.WS_CONNECTED,j),this.once($t.WS_CLOSED,Y),r!==zt.PUBLISH&&r!==zt.PUBLISH_DATASTREAM&&r!==zt.SUBSCRIBE&&r!==zt.SUBSCRIBE_DATASTREAM&&r!==zt.UNSUBSCRIBE&&r!==zt.UNSUBSCRIBE_DATASTREAM&&r!==zt.UNPUBLISH&&r!==zt.UNPUBLISH_DATASTREAM&&r!==zt.CONTROL&&r!==zt.RESTART_ICE||this.once($t.DISCONNECT_P2P,()=>{V(new Oe(te.DISCONNECT_P2P))}),r!==zt.PUBLISH&&r!==zt.RESTART_ICE||this.once($t.ABORT_P2P_EXECUTION,()=>{V(new Oe(te.DISCONNECT_P2P))})});if(this.connectionState!==fr.CONNECTING&&this.connectionState!==fr.RECONNECTING||r===zt.JOIN||r===zt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new dt((G,V)=>{let j=!1;const Y=(de,Se)=>{j=!0,G({isSuccess:de==="success",message:Se||{}}),this.off($t.WS_CLOSED,Z),this.off($t.WS_RECONNECTING,Z),this.emit($t.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),Y);const Z=()=>{V(new Oe(te.WS_ABORT,"type: ".concat(r))),this.off($t.WS_CLOSED,Z),this.off($t.WS_RECONNECTING,Z),this.off("res-@".concat(u),Y)};this.once($t.WS_CLOSED,Z),this.once($t.WS_RECONNECTING,Z),hs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit($t.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await E}catch(G){if(this.connectionState===fr.CLOSED||r===zt.LEAVE)throw new Oe(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===zt.JOIN||r===zt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const C=Number(S.message.error_code||S.message.code),P=RT(C),N=new Oe(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:C,data:S.message,desc:P.desc});return P.action==="success"?S.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(C,", message: ").concat(P.desc,", action: ").concat(P.action)),C===Ut.ERR_TOO_MANY_BROADCASTERS?((r===zt.JOIN||r===zt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(C===Ut.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",As.MULTI_IP)):this.reconnect(P.action,As.SERVER_ERROR),r===zt.JOIN||r===zt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new dt(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(wT.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dt((i,o)=>{this.once($t.WS_CONNECTED,()=>i(this.joinResponse)),this.once($t.WS_CLOSED,c=>o(this.initError||new Oe(te.WS_ABORT,c))),this.connectionState=fr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Kn.LEAVE,this.connectionState=fr.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit($t.ABORT_P2P_EXECUTION);const r=await Ps(this,$t.REQUEST_JOIN_INFO),i=await this.request(zt.JOIN,r);if(!i)return this.emit($t.REPORT_JOIN_GATEWAY,iP.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit($t.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=_T(this,$t.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(zt.REJOIN,r);return!!i&&(this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(En.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(En.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(En.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(En.MUTE_AUDIO,{uid:o.uid}):this.emit(En.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(En.MUTE_VIDEO,{uid:o.uid}):this.emit(En.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(En.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(En.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(En.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(En.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(En.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleNotification(r){L.debug("[".concat(this.clientId,"] receive notification: "),r);const i=RT(r.code);if(r.code===28&&"detail"in r&&(L.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit($t.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Kn.UID_BANNED),void this.close()):void this.reconnect(i.action,As.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(L.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",As.TIMEOUT):this.request(zt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),oe("REPORT_STATS")&&this.send(zt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(wT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Zt.RECONNECT_CREATE_CONNECTION,r=>{this.emit($t.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Zt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Zt.CLOSED,()=>{this.connectionState=fr.CLOSED}),this.websocket.on(Zt.FAILED,()=>{this._disconnectedReason=Kn.NETWORK_ERROR,this.connectionState=fr.CLOSED}),this.websocket.on(Zt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===fr.CONNECTED?this.connectionState=fr.RECONNECTING:this.connectionState=fr.CONNECTING}),this.websocket.on(Zt.WILL_RECONNECT,(r,i,o)=>{const c=_T(this,$t.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(L.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=iP.P2P_DISCONNECTED),u&&(L.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit($t.REPORT_JOIN_GATEWAY,i||iP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit($t.DISCONNECT_P2P)),o(r)}),this.websocket.on(Zt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{L.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",As.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit($t.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Ut.ERR_NO_AUTHORIZED)return this.initError=new Oe(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Kn.TOKEN_EXPIRE);L.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",As.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Zt.REQUEST_NEW_URLS,(r,i)=>{Ps(this,$t.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(qG.PRE_CONNECT_PC,()=>{this.emit($t.PRE_CONNECT_PC)})}}let kme=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),mi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function ZG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function oP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?ZG(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ZG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Mm(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(L.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function Dx(e,r){e.addresses||(e.addresses=[]);const i=function(m,_){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(C=>{let{ip:P,port:N}=C;return{address:"".concat(P,":").concat(N)}});const E=oe("GATEWAY_DOMAINS");let S=E[1]&&st(_).call(_,E[1])?1:0;return m.map(C=>{let{domain_prefix:P,port:N,ip:G}=C;if(P)return{address:"".concat(P,".").concat(E[S++%E.length],":").concat(N)};const V=/^[\.\:\d]+$/.test(G),j=V?"".concat(G.replace(/[^\d]/g,"-"),".").concat(E[S++%E.length],":").concat(N):"".concat(G,":").concat(N);return V||L.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:N,address:j}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const E=co(c=m[_]).call(c);i[_]&&E&&(i[_].ip6=E)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function pc(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function e9(e){const r=e._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(pc(r.width),"x").concat(pc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function t9(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function AT(e,r){let i,o,c;switch(r){case mi.CHOOSE_SERVER:o=4096,c="choose server";break;case mi.CLOUD_PROXY:o=1048576,c="proxy";break;case mi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case mi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>oP(oP({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:oP(oP({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new Oe(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function n9(e,r){return await dt.all(e.addresses.map(async i=>({address:oe("USE_TURN_IP")?i.ip:Mm(i.ip),tcpport:i.port,udpport:i.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Os.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await FL(r.toString()):Os.password})))}function Lx(e,r){const i=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||i.height,c=r.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(pc(e.height),pc(e.width)),1):(L.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Um(e){let{candidateType:r,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:r,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function aP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return function(r){return r in MA}(e)?e:MA.L1T3}const r9={[gt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[gt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function cP(e,r,i){r.forEach(o=>{var c;const u=r9[e].find(m=>{var _;let{key:E}=m;return st(_=o.extensionName).call(_,E)});if(!u)return;const h=i.find(m=>{let{extensionName:_}=m;return st(_).call(_,u.key)});h&&st(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function Jv(e,r){r.forEach(i=>{var o;const c=r9[e].find(u=>{var h;let{key:m}=u;return st(h=i.extensionName).call(h,m)});st(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function i9(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||st(e).call(e,"abs-send-time")}function lP(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||st(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function s9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function o9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?s9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function PT(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=r,{useXR:E}=i;let S=[],C=[],P=[],N=[],G=!1,V=!1;if(Fa(e).mediaDescriptions.forEach(Y=>{o&&o!==Y.attributes.direction||(Y.media.mediaType!=="video"||G||(C=Y.attributes.payloads,N=Y.attributes.extmaps,G=!0),Y.media.mediaType!=="audio"||V||(S=Y.attributes.payloads,P=Y.attributes.extmaps,V=!0))}),!N||C.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(C.forEach(Y=>{var Z;(Z=Y.rtpMap)!==null&&Z!==void 0&&Z.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),E&&Y.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(Y=>{var Z;(Z=Y.rtpMap)!==null&&Z!==void 0&&Z.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),E&&Y.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(Y=>{var Z;return((Z=Y.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())!=="rtx"}),C=C.filter(Y=>{var Z;return((Z=Y.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())!=="rtx"})),u&&(C=C.filter(Y=>{var Z;return!/(red)|(ulpfec)|(flexfec)/i.test(((Z=Y.rtpMap)===null||Z===void 0?void 0:Z.encodingName)||"")})),h&&(S=S.filter(Y=>{var Z;return!/(red)|(ulpfec)|(flexfec)/i.test(((Z=Y.rtpMap)===null||Z===void 0?void 0:Z.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(Y=>{var Z;return st(m).call(m,((Z=Y.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const Y=C.filter(Z=>{var de;return st(_).call(_,((de=Z.rtpMap)===null||de===void 0?void 0:de.encodingName.toLowerCase())||"")});C=Y.concat(c?[]:Ux(Y,C))}const j=oe("UNSUPPORTED_VIDEO_CODEC");return j&&j.length>0&&(C=C.filter(Y=>!(Y.rtpMap&&st(j).call(j,Y.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:C,audioExtensions:P,videoExtensions:N}}function Vm(e){const r=Fa(e);let i,o;for(const c of r.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function a9(e,r){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(E=>E.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:r?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function c9(e,r,i){const{cname:o}=e;let c=[];r&&(c=l9(r)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),L.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=dP(e.rtpCapabilities),E=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{E.push({kind:gt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:gt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:E}}function l9(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],L.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),L.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function B_(e,r,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=dr(8,"track-"),E={ssrcId:h,attributes:o9({label:_,mslabel:i=i||dr(10,""),msid:"".concat(i," ").concat(_)},r&&{cname:r})};if(o.push(E),m!==void 0){const S={ssrcId:m,attributes:o9({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function Qv(e,r){r instanceof Hr&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Vr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function xx(e){const r=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function Mx(e,r){var i;if(!(r instanceof vr&&r._encoderConfig&&r._hints.indexOf(hr.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;Vn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Vn().supportMinBitrate&&!st(i=r._hints).call(i,hr.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function u9(e){if(e.media.mediaType!=="video")return;const r=Nn();if(r.name!==zn.SAFARI&&r.os!==Gi.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function uP(e,r,i){if(!r)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const u=o.find(h=>lP(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>lP(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(C=>C.payloadType===S.payloadType&&!!C.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>lP(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>i9(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(C=>C.payloadType===S.payloadType&&!!C.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=e.attributes.extmaps.findIndex(h=>i9(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function d9(e,r,i){if(Vr()||e.media.mediaType!=="video"||!(r instanceof vr)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!oe("SIMULCAST")||i==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Br(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Br(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function h9(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const S=PT(E,m,_,"sendonly"),C=PT(E,m,_,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(_u(S,C,"videoExtensions",P,N,G),_u(S,C,"videoCodecs",P,N,G),_u(S,C,"audioExtensions",P,N,G),_u(S,C,"audioCodecs",P,N,G),oe("RAISE_H264_BASELINE_PRIORITY")){const V=[],j=[];G.videoCodecs.forEach((Y,Z)=>{var de;if(((de=Y.rtpMap)===null||de===void 0?void 0:de.encodingName.toLocaleLowerCase())==="h264"){var Se,Te;const ye=G.videoCodecs[Z+1],Ne=ye&&_9(Y,ye),Ye=(Se=Y.fmtp)===null||Se===void 0?void 0:Se.parameters["profile-level-id"],ht=(Te=Y.fmtp)===null||Te===void 0?void 0:Te.parameters["packetization-mode"];!Ye||Ye!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&ht!==oe("FIRST_PACKETIZATION_MODE")?Ne?j.push([Y,ye]):j.push([Y]):Ne?V.push([Y,ye]):V.push([Y])}}),V.length>0&&j.length>0&&(L.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Y,Z)=>{var de;if(((de=Y.rtpMap)===null||de===void 0?void 0:de.encodingName.toLocaleLowerCase())==="h264"){const Se=_9(Y,G.videoCodecs[Z+1]),Te=V.shift()||j.shift()||[];Te.length>0&&(Se?G.videoCodecs.splice(Z,2,...Te):G.videoCodecs.splice(Z,1,...Te))}}),N.videoCodecs=N.videoCodecs.filter(Y=>{var Z,de;return!(((Z=Y.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLocaleLowerCase())==="h264"&&((de=Y.fmtp)===null||de===void 0?void 0:de.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))}),oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>{var Z,de;return!(((Z=Y.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLocaleLowerCase())==="h264"&&((de=Y.fmtp)===null||de===void 0?void 0:de.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:N,sendrecv:G}}(e,r,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function p9(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=PT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(_u(e,r,"videoExtensions",i,o,c),_u(e,r,"videoCodecs",i,o,c),_u(e,r,"audioExtensions",i,o,c),_u(e,r,"audioCodecs",i,o,c),oe("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){L.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function _u(e,r,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(m=>{r[i].some((_,E)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(E),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(m=>{r[i].some((_,E)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(E),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}}function dP(e){const{send:r,recv:i,sendrecv:o}=e;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function Zv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function OT(e,r,i,o){let c=[];if(e===gt.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(i.videoCodecs.forEach(E=>{const S=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";st(S).call(S,o)?u.push(E):st(S).call(S,"vp9")?h.push(E):st(S).call(S,"vp8")?m.push(E):st(S).call(S,"h264")&&_.push(E)}),u.length===0){let E="";h.length!==0?(u=h,E="vp9"):m.length!==0?(u=m,E="vp8"):_.length!==0&&(u=_,E="h264"),L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}u.length!==0&&(c=r.videoCodecs.filter(E=>u.some(S=>S.payloadType===E.payloadType)))}if(c.length===0&&(L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const u=Ux(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function Ux(e,r){const i=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&st(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function kT(e,r,i){const o=r.toString(),c=m9(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=f9(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function f9(e,r,i){const o=Fa(e),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!st(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&Zv(u),c&&st(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Dm(o)}function m9(e,r,i,o){if(oe("SDP_LOGGING"))return L.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?c=>{m9(c,"answer",i==="local"?"remote":"local",o)}:void 0}function g9(e){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>st(e).call(e,i))}function _9(e,r){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function y9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Rl(e,r){return typeof oe(e)===r?oe(e):void 0}function Nme(){try{const e=oe("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?y9(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):y9(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e)}catch(e){return L.debug("handle gateway attributes failed: ",e),{}}}const E9={};function Fm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&L.debug("install service ".concat(e.name)),E9[e.name]=e}function tf(e){const r=E9[e];if(!r)throw new xe(te.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function v9(e,r){return tf("DataStream").create(e,r)}function hP(){return tf("InterceptFrame").create()}function S9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function nf(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?S9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Vx=new Map;class Dme extends Lr{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(rs.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(rs.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){L.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var o,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(o={spec:nf(nf({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(u=tf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Ome(nf(nf({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(r,i,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=Vx.get(r.cname);if(u||(u=new Map,Vx.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const E=new Oe(te.UID_CONFLICT);throw It.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}u.set(r.uid,!0),this.joinInfo=r,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{L.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map(S=>{let{address:C}=S;const[P,N]=C.split(":"),G={host:P,port:N};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(E)).uid,L.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var _;throw L.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),It.joinGateway(r.sid,{lts:c,succ:!1,ec:((_=E.data)===null||_===void 0?void 0:_.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),L.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{L.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(rs.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(rs.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(rs.NETWORK_QUALITY,{uplinkNetworkQuality:t9(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:t9(this._statsCollector.trafficStats.B_dnq)}):this.emit(rs.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Kn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==fr.CONNECTED||await function(o,c){return c===1/0?o:dt.race([o,ife(c)])}(this.signal.request(zt.LEAVE,void 0,!0),3e3)}catch(o){L.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Kn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(zt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ut.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw u}}async publishDataChannel(r,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(zt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Ut.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw h}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(zt.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(o){L.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dt.all(r.map(i=>this.signal.request(zt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){L.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(zt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,i,!1);throw u}}async subscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(zt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw u}}async subscribeDataChannel(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(zt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw u}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(zt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(i)return this.signal.request(zt.SET_VIDEO_PROFILE,i);L.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(zt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(o){L.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dt.all(r.map(o=>this.signal.request(zt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){L.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(zt.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){L.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(zt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(zt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(zt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),oe("CLIENT_ROLE_OPTIONS")&&(L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(zt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,i){await this.signal.request(zt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(zt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(zt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(zt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(zt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),nf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(zt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=Vx.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Os.username,password:Os.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(nf(nf({},Os),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(zt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&NA(()=>{this.emit(rs.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=oe("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(rs.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,st($v).call($v,c)||$v.push(c);const u=!(Vr()||F8(87)||AW())&&typeof oe("ENABLE_PRE_SUB")=="boolean"&&oe("ENABLE_PRE_SUB"),h=!AW()&&Rl("ENABLE_PREALLOC_PC","boolean"),m=Nme(),_=hT(87)||function(){const S=Nn();if(S.name!==zn.SAFARI||!S.browserVersion)return!1;const C=S.browserVersion.split(".");return Number(C[0])>15||Number(C[0])===15&&Number(C[1])>=4}(),E=nf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:bl,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:nf({enableEncodedTransform:!!oe("ENABLE_AUDIO_METADATA")&&_||!!oe("ENABLE_AUDIO_TOPN")&&kL(zn.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!oe("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Rl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Rl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Rl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!oe("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Rl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Rl("USE_XR","boolean"),enableLossbasedBwe:Rl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("ENABLE_AUT_CC")||void 0,enableCCFallback:Rl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Rl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Rl("PUBLISH_TWCC","boolean"),enableSubTWCC:Rl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Rl("USE_PUB_RTX","boolean"),enableSubRTX:Rl("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(E.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(E.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(E.aes_secret=this.joinInfo.aespassword,E.aes_encrypt=!0):E.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(E.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(E.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(E.default_video_stream=this.joinInfo.defaultVideoStream),E}getRejoinMessage(){if(!this.joinInfo)throw new Oe(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on($t.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on($t.WS_RECONNECTING,r=>{this.joinInfo&&It.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||As.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",It.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on($t.WS_CLOSED,r=>{let i;switch(r){case Kn.LEAVE:i=As.LEAVE;break;case Kn.UID_BANNED:case Kn.IP_BANNED:case Kn.CHANNEL_BANNED:case Kn.SERVER_ERROR:i=As.SERVER_ERROR;break;case Kn.FALLBACK:i=As.FALLBACK;break;case Kn.LICENSE_MISSING:case Kn.LICENSE_EXPIRED:case Kn.LICENSE_MINUTES_EXCEEDED:case Kn.LICENSE_PERIOD_INVALID:case Kn.LICENSE_MULTIPLE_SDK_SERVICE:case Kn.LICENSE_ILLEGAL:case Kn.TOKEN_EXPIRE:i=r;break;default:i=As.NETWORK_ERROR}L.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+As.NETWORK_ERROR)),this.joinInfo&&It.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Kn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==Kn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on($t.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(L.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(It.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void L.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));tr("EVENT_REPORT_DOMAIN",r[1]),tr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),tr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(En.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on($t.REQUEST_RECOVER,(r,i,o)=>{if(!this.joinInfo)return o(new Oe(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ps(this,rs.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on($t.REQUEST_JOIN_INFO,async(r,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=Br((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&u){let E=u.servers,S=u.serversFromGateway;const C=this.signal.currentURLIndex;E.length>0&&(E=[E[C%E.length]],u.servers=E),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),L.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(C))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await Ps(this,rs.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(E){i(E)}}),this.signal.on($t.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on($t.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Oe?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,It.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on($t.IS_P2P_DISCONNECTED,r=>{r(_T(this,rs.IS_P2P_DISCONNECTED))}),this.signal.on($t.DISCONNECT_P2P,()=>{this.emit(rs.DISCONNECT_P2P)}),this.signal.on($t.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on($t.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on($t.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit(rs.JOIN_RESPONSE,r,i)}),this.signal.on($t.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),i=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&i){const o=l9(r);this.emit(rs.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on($t.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(zt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(zt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw L.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(zt.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(zt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw L.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const i={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(zt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,i){const o={action:r.find(c=>c.stream_type===Yn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(zt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const o={action:r.find(c=>c.stream_type===Yn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(zt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const o={action:r===gt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(zt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const o={action:r===gt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(zt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(zt.RESTART_ICE,i,!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||As.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(L.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(zt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let pP=0,Fx=0;function Ed(e,r,i,o){return new dt((c,u)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),pP+=fh(r.data)):i&&(r.data.size?pP+=r.data.size:r.data instanceof FormData?pP+=rW(r.data):pP+=fh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,ia.request(r).then(h=>{typeof h.data=="string"?Fx+=fh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Fx+=h.data.byteLength:Fx+=fh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{ia.isCancel(h)?u(new Oe(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(je){var it=0;return function(){return it<je.length?{done:!1,value:je[it++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,it,Tt){return je==Array.prototype||je==Object.prototype||(je[it]=Tt.value),je},o,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var it=0;it<je.length;++it){var Tt=je[it];if(Tt&&Tt.Math==Math)return Tt}throw Error("Cannot find global object")}(this);function u(je,it){if(it)e:{var Tt=c;je=je.split(".");for(var He=0;He<je.length-1;He++){var M=je[He];if(!(M in Tt))break e;Tt=Tt[M]}(it=it(He=Tt[je=je[je.length-1]]))!=He&&it!=null&&i(Tt,je,{configurable:!0,writable:!0,value:it})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var it=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return it?it.call(je):{next:r(je)}}if(u("Symbol",function(je){function it(M,ae){this.A=M,i(this,"description",{configurable:!0,writable:!0,value:ae})}if(je)return je;it.prototype.toString=function(){return this.A};var Tt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function M(ae){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new it(Tt+(ae||"")+"_"+He++,ae)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var it="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Tt=0;Tt<it.length;Tt++){var He=c[it[Tt]];typeof He=="function"&&typeof He.prototype[je]!="function"&&i(He.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var E={};try{E.__proto__={a:!0},_=E.a;break e}catch{}_=!1}o=_?function(je,it){if(je.__proto__=it,je.__proto__!==it)throw new TypeError(je+" is not extensible");return je}:null}var S=o;function C(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function N(je,it){return je.h=3,{value:it}}function G(je){this.g=new C,this.G=je}function V(je,it,Tt,He){try{var M=it.call(je.g.j,Tt);if(!(M instanceof Object))throw new TypeError("Iterator result "+M+" is not an object");if(!M.done)return je.g.m=!1,M;var ae=M.value}catch(he){return je.g.j=null,je.g.s(he),j(je)}return je.g.j=null,He.call(je.g,ae),j(je)}function j(je){for(;je.g.h;)try{var it=je.G(je.g);if(it)return je.g.m=!1,{value:it.value,done:!1}}catch(Tt){je.g.v=void 0,je.g.s(Tt)}if(je.g.m=!1,je.g.l){if(it=je.g.l,je.g.l=null,it.F)throw it.D;return{value:it.return,done:!0}}return{value:void 0,done:!0}}function Y(je){this.next=function(it){return je.o(it)},this.throw=function(it){return je.s(it)},this.return=function(it){return function(Tt,He){P(Tt.g);var M=Tt.g.j;return M?V(Tt,"return"in M?M.return:function(ae){return{value:ae,done:!0}},He,Tt.g.return):(Tt.g.return(He),j(Tt))}(je,it)},this[Symbol.iterator]=function(){return this}}function Z(je,it){return it=new Y(new G(it)),S&&je.prototype&&S(it,je.prototype),it}if(C.prototype.o=function(je){this.v=je},C.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},C.prototype.return=function(je){this.l={return:je},this.h=this.u},G.prototype.o=function(je){return P(this.g),this.g.j?V(this,this.g.j.next,je,this.g.o):(this.g.o(je),j(this))},G.prototype.s=function(je){return P(this.g),this.g.j?V(this,this.g.j.throw,je,this.g.o):(this.g.s(je),j(this))},u("Array.prototype.entries",function(je){return je||function(){return function(it,Tt){it instanceof String&&(it+="");var He=0,M=!1,ae={next:function(){if(!M&&He<it.length){var he=He++;return{value:Tt(he,it[he]),done:!1}}return M=!0,{done:!0,value:void 0}}};return ae[Symbol.iterator]=function(){return ae},ae}(this,function(it,Tt){return[it,Tt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var de=function(je,it){for(var Tt=0;Tt<je.length;Tt++)it(je[Tt])},Se=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},Te=function(je,it,Tt){return it instanceof Blob?(Tt=Tt!==void 0?Tt+"":typeof it.name=="string"?it.name:"blob",it.name===Tt&&Object.prototype.toString.call(it)!=="[object Blob]"||(it=new File([it],Tt)),[String(je),it]):[String(je),String(it)]},ye=function(je,it){if(je.length<it)throw new TypeError(it+" argument required, but only "+je.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ye=Ne.FormData,ht=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,ft=Ne.Request&&Ne.fetch,Sn=Ne.navigator&&Ne.navigator.sendBeacon,bn=Ne.Element&&Ne.Element.prototype,pr=Ne.Symbol&&Symbol.toStringTag;pr&&(Blob.prototype[pr]||(Blob.prototype[pr]="Blob"),"File"in Ne&&!File.prototype[pr]&&(File.prototype[pr]="File"));try{new File([],"")}catch{Ne.File=function(it,Tt,He){return it=new Blob(it,He||{}),Object.defineProperties(it,{name:{value:Tt},lastModified:{value:+(He&&He.lastModified!==void 0?new Date(He.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),pr&&Object.defineProperty(it,pr,{value:"File"}),it}}var ai=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},$r=function(je){this.i=[];var it=this;je&&de(je.elements,function(Tt){if(Tt.name&&!Tt.disabled&&Tt.type!=="submit"&&Tt.type!=="button"&&!Tt.matches("form fieldset[disabled] *"))if(Tt.type==="file"){var He=Tt.files&&Tt.files.length?Tt.files:[new File([],"",{type:"application/octet-stream"})];de(He,function(M){it.append(Tt.name,M)})}else Tt.type==="select-multiple"||Tt.type==="select-one"?de(Tt.options,function(M){!M.disabled&&M.selected&&it.append(Tt.name,M.value)}):Tt.type==="checkbox"||Tt.type==="radio"?Tt.checked&&it.append(Tt.name,Tt.value):(He=Tt.type==="textarea"?Se(Tt.value):Tt.value,it.append(Tt.name,He))})};if((e=$r.prototype).append=function(je,it,Tt){ye(arguments,2),this.i.push(Te(je,it,Tt))},e.delete=function(je){ye(arguments,1);var it=[];je=String(je),de(this.i,function(Tt){Tt[0]!==je&&it.push(Tt)}),this.i=it},e.entries=function je(){var it,Tt=this;return Z(je,function(He){if(He.h==1&&(it=0),He.h!=3)return it<Tt.i.length?He=N(He,Tt.i[it]):(He.h=0,He=void 0),He;it++,He.h=2})},e.forEach=function(je,it){ye(arguments,1);for(var Tt=m(this),He=Tt.next();!He.done;He=Tt.next()){var M=m(He.value);He=M.next().value,M=M.next().value,je.call(it,M,He,this)}},e.get=function(je){ye(arguments,1);var it=this.i;je=String(je);for(var Tt=0;Tt<it.length;Tt++)if(it[Tt][0]===je)return it[Tt][1];return null},e.getAll=function(je){ye(arguments,1);var it=[];return je=String(je),de(this.i,function(Tt){Tt[0]===je&&it.push(Tt[1])}),it},e.has=function(je){ye(arguments,1),je=String(je);for(var it=0;it<this.i.length;it++)if(this.i[it][0]===je)return!0;return!1},e.keys=function je(){var it,Tt,He,M,ae=this;return Z(je,function(he){if(he.h==1&&(it=m(ae),Tt=it.next()),he.h!=3)return Tt.done?void(he.h=0):(He=Tt.value,M=m(He),N(he,M.next().value));Tt=it.next(),he.h=2})},e.set=function(je,it,Tt){ye(arguments,2),je=String(je);var He=[],M=Te(je,it,Tt),ae=!0;de(this.i,function(he){he[0]===je?ae&&(ae=!He.push(M)):He.push(he)}),ae&&He.push(M),this.i=He},e.values=function je(){var it,Tt,He,M,ae=this;return Z(je,function(he){if(he.h==1&&(it=m(ae),Tt=it.next()),he.h!=3)return Tt.done?void(he.h=0):(He=Tt.value,(M=m(He)).next(),N(he,M.next().value));Tt=it.next(),he.h=2})},$r.prototype._asNative=function(){for(var je=new Ye,it=m(this),Tt=it.next();!Tt.done;Tt=it.next()){var He=m(Tt.value);Tt=He.next().value,He=He.next().value,je.append(Tt,He)}return je},$r.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),it=[],Tt="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(He,M){return typeof He=="string"?it.push(Tt+ai(Se(M))+`"\r
\r
`+Se(He)+`\r
`):it.push(Tt+ai(Se(M))+'"; filename="'+ai(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)}),it.push("--"+je+"--"),new Blob(it,{type:"multipart/form-data; boundary="+je})},$r.prototype[Symbol.iterator]=function(){return this.entries()},$r.prototype.toString=function(){return"[object FormData]"},bn&&!bn.matches&&(bn.matches=bn.matchesSelector||bn.mozMatchesSelector||bn.msMatchesSelector||bn.oMatchesSelector||bn.webkitMatchesSelector||function(je){for(var it=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--it&&je.item(it)!==this;);return-1<it}),pr&&($r.prototype[pr]="FormData"),ht){var ua=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(je,it){ua.call(this,je,it),je.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(je){je instanceof $r?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),ht.call(this,je)):ht.call(this,je)}}ft&&(Ne.fetch=function(je,it){return it&&it.body&&it.body instanceof $r&&(it.body=it.body._blob()),ft.call(this,je,it)}),Sn&&(Ne.navigator.sendBeacon=function(je,it){return it instanceof $r&&(it=it._asNative()),Sn.call(this,je,it)}),Ne.FormData=$r}})();const NT=()=>{const e=oe("AREAS");return e.length===0&&e.push(Gn.GLOBAL),sc(e).call(e,(r,i,o)=>{const c=b9(i);return c?o===0?c:"".concat(r,",").concat(c):r},"")},b9=e=>e===Gn.OVERSEA?"".concat(Fs.ASIA,",").concat(Fs.EUROPE,",").concat(Fs.AFRICA,",").concat(Fs.NORTH_AMERICA,",").concat(Fs.SOUTH_AMERICA,",").concat(Fs.OCEANIA):Fs[e],Lme=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=sP[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},fP={GLOBAL:{ASIA:[Gn.CHINA,Gn.JAPAN,Gn.INDIA,Gn.KOREA,Gn.HKMC],EUROPE:[],NORTH_AMERICA:[Gn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},mP=Object.keys(fP[Gn.GLOBAL]),jx=[Gn.CHINA,Gn.NORTH_AMERICA,Gn.EUROPE,Gn.ASIA,Gn.JAPAN,Gn.INDIA,Gn.OCEANIA,Gn.SOUTH_AMERICA,Gn.AFRICA,Gn.KOREA,Gn.HKMC,Gn.US],xme=function(e,r){let i=[];if(st(e).call(e,Gn.GLOBAL)){const u=[Gn.GLOBAL,Gn.OVERSEA],h=Object.keys(sP);if(r===Gn.GLOBAL)throw new Oe(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Gn.CHINA)i=[Gn.OVERSEA];else if(c=r,st(mP).call(mP,c)){const m=(o=r,fP[Gn.GLOBAL][o]||[]),_=[...u,r,...m];i=h.filter(E=>!st(_).call(_,E))}else if(function(m){let _=!1;return mP.forEach(E=>{var S;st(S=fP[Gn.GLOBAL][E]).call(S,m)&&(_=!0)}),_}(r)){const m=function(E){let S;return mP.forEach(C=>{var P;st(P=fP[Gn.GLOBAL][C]).call(P,E)&&(S=C)}),S}(r),_=[...u,m,r];i=h.filter(E=>!st(_).call(_,E))}else i=e;i=function(m){const _=[];return jx.forEach(E=>{st(m).call(m,E)&&_.push(E)}),_.concat(m.filter(E=>!st(jx).call(jx,E)))}(i)}else i=e;var o,c;return i};function T9(e){var r,i;if(!e&&st(r=oe("AREAS")).call(r,Gn.EXTENSIONS))return L.debug("update area from ap : reset"),void Bx(Gfe,!0);if(!st(i=oe("AREAS")).call(i,Gn.GLOBAL)||!e)return;let o=sP.EXTENSIONS;o&&(o={CODE:b9(Gn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},L.debug("update area from ap success: ".concat(e,",config is "),o),tr("AREAS",[Gn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?tr(c,o[c][0]):tr(c,o[c])}))}function Bx(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=It.reportApiInvoke(null,{name:wi.SET_AREA,options:e,tag:jr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!st(zG).call(zG,u))throw new Oe(te.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Oe(te.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?xme(m,h):m}if(!r){if(md.AREAS){const u=new Oe(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void L.warning("setArea is prohibited because of config-distribute")}if(st(o).call(o,Gn.GLOBAL)&&oe("AREAS")===Gn.EXTENSIONS){const u=new Oe(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void L.warning("setArea is prohibited because of ap extensions")}}tr("AREAS",o,r);const c=Lme(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?tr(u,c[u][0]):tr(u,c[u])}),L.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function w9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function vh(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?w9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Wx=1;function Mme(e,r,i,o,c){Wx+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:Wx,requestId:Wx,version:bl,cname:i.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,_,E=e[0];return fd(async()=>{m=Date.now();const S=await Ed(E,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw L.error(N.toString()),N}const C=JSON.parse(S.json_body);if(C.code!==200){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(C.code,", reason: ").concat(C.reason),{code:C.code,responseTime:_});throw L.error(N.toString()),N}if(!C.servers||C.servers.length===0){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:C.code,responseTime:_});throw L.error(N.toString()),N}const P=function(N,G){return{addressList:N.servers.map(V=>"wss://".concat(V.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(V.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:N.workerToken,vid:N.vid}}(C,r);return oe("LIVE_STREAMING_ADDRESS")&&(P.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),vh(vh({},P),{},{responseTime:_})},(S,C)=>(It.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:C===0,responseTime:_,serverIp:e[C%e.length]}),!1),(S,C)=>(It.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:_,serverIp:e[C%e.length]}),!!(S.code!==te.OPERATION_ABORTED&&S.code!==te.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(E=e[(C+1)%e.length],!0)),c)}let zx=1;function C9(e,r,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=r,_=Date.now();let E;const S=r.role,[C,P]=Hx(r,u,[mi.CHOOSE_SERVER]);let N=fi.networkState;return fd(async()=>{N&&fi.networkState===hc.OFFLINE&&fi.onlineWaiter&&await dt.race([fi.onlineWaiter,hs(o&&o.maxRetryTimeout||Ci.maxRetryTimeout)]),N=fi.networkState;const{data:G,headers:V}=await Ed(c,{data:C,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=V.http3==="1"?1:-1,It.reportResourceTiming(c,m),I9(G,c,r,_,[mi.CHOOSE_SERVER],E);const j=AT(G,mi.CHOOSE_SERVER);return Gx(j),Dx(j,c)},G=>(G&&It.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(V=>V.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(It.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),L.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),o)}function R9(e,r,i,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),E=r.role,[S,C]=Hx(r,h,m);let P;return fd(async()=>{P&&fi.networkState===hc.OFFLINE&&fi.onlineWaiter&&await dt.race([fi.onlineWaiter,hs(o&&o.maxRetryTimeout||Ci.maxRetryTimeout)]),P=fi.networkState;const{data:N,headers:G}=await Ed(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,It.reportResourceTiming(u,r.sid),I9(N,u,r,_,m,c);const V=AT(N,mi.CHOOSE_SERVER),j=AT(N,r.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK);return Gx(V),{gatewayInfo:Dx(V,u),proxyInfo:j,url:u}},N=>(N.gatewayInfo&&It.joinChooseServer(r.sid,{role:E,lts:_,succ:!0,csAddr:u,serverList:N.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:C,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38]}),N.proxyInfo&&It.joinWebProxyAP(r.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:N.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),N=>N.code!==te.OPERATION_ABORTED&&(N.code===te.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(It.joinWebProxyAP(r.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:N.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),L.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),N),!0)),o)}const I9=(e,r,i,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=i,E=[],S=C=>{C.flag===4096?It.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:C.error.message,csIp:C.error.data&&C.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):C.flag!==1048576&&C.flag!==4194304&&C.flag!==4194310||It.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:C.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(C=>{const P=C.buffer.code;if(C.uri===23&&P===0&&!C.buffer.edges_services)if(C.buffer.flag===4194310)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),C.buffer.edges_services=[];else{const N={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:C.buffer.flag};E.push(N),S(N)}if(P!==0){const N=Xv(P),G={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:e.detail[502]}),flag:C.buffer.flag};C.buffer.flag===4194310?L.warning(G.error.toString()):E.push(G),S(G)}}),E.length)throw L.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map(C=>"flag: ".concat(C.flag,", message: ").concat(C.error.message,", retry: ").concat(C.error.data.retry)).join(" | "))),new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,E.map(C=>"flag: ".concat(C.flag,", message: ").concat(C.error.message)).join(" | "),{retry:!!E.find(C=>C.error.data.retry),csIp:e.detail[502],desc:[...new Set(E.map(C=>{var P;return C==null||(P=C.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(C=>!!C))]})},Gx=e=>{var r,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(oe("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?T9(e.detail[23].toLowerCase()):T9()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const E=co(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=E)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){L.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map(m=>{var _,E;const S=(_=(E=e.addresses.find(C=>C.ip===m.ip&&C.port===m.port))===null||E===void 0?void 0:E.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},Ume=(e,r)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=Xv(i.buffer.code);throw new Oe(te.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw L.debug("update ticket request received ap response without response body:",r),new Oe(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Hx=(e,r,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:vh(vh(vh({6:e.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Vme=(e,r)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let eS=0;function tS(e){return dt.all(e.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const DT=async e=>{let{fragementLength:r,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=r;let _,E=0;const S=async()=>{const C=(()=>{const P=h*m,N=P+m;return i.slice(P,N).map(o)})();u&&u.push(...C);try{_=await tS(C)}catch(P){if(E+=m,h++,!(E>=i.length))return void await S();c(P)}C.forEach(P=>P.cancel())};return await S(),_},A9=async e=>{let{referenceList:r,asyncMapHandler:i,closeFn:o}=e;const c=r.length;let u=0;const h=async()=>{const m=i(r.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function $x(e,r,i,o){return{gatewayInfo:await async function(u,h,m,_){let E=null;const S=[],C=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:NT()})),G=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),V=await DT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(L.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),C9(j,u,h,m)),allFailedhandler:j=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},G),V},P=async()=>{if(await hs(1e3),E!==null)return E;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:NT()})),G=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),V=await DT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(L.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),C9(j,u,h,m)),allFailedhandler:j=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},G),V};try{return E=await tS([C(),P()]),S.length&&S.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),E}catch(N){throw N[0]}}(e,r,i,o)}}async function P9(e,r,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await $x(e,r,i,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:N}=await N9(e,r,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:P};const G=N.map(V=>({turnServerURL:V.address,tcpport:V.tcpport||Os.tcpport,udpport:V.udpport||Os.udpport,username:V.username||Os.username,password:V.password||Os.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const V=(h=e.uid)!==null&&h!==void 0?h:P.uid,j="glb:".concat(V.toString()),Y=await FL(j),Z=N.map(de=>({turnServerURL:de.address,tcpport:de.tcpport||Os.tcpport,udpport:de.udpport||Os.udpport,username:j,password:Y,forceturn:!1,security:!0}));G.push(...Z)}return e.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await $x(e,r,i,c)}const{proxyInfo:m,gatewayInfo:_}=await N9(e,r,i,c),E={gatewayInfo:_},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:Os.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:Os.udpport,username:P.username||Os.username,password:P.password||Os.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var C;const P=(C=e.uid)!==null&&C!==void 0?C:_.uid,N="glb:".concat(P.toString()),G=await FL(N),V=m.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||Os.tcpport,udpport:u==="proxy4"?void 0:j.udpport||Os.udpport,username:N,password:G,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...V)}return e.turnServer={mode:"manual",servers:S},L.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),E}async function O9(e,r,i,o,c){const u=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(_=>"https://".concat(r.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(E,S,C,P,N){const G=Date.now(),V={sid:C.sid,opid:10,appid:C.appId,string_uid:S};let j=E[0];const Y=await fd(()=>Ed(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:V,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Z,de)=>{if(Z.code===0){if(Z.uid<=0||Z.uid>=Math.pow(2,32))throw L.error("Invalid Uint Uid ".concat(S," => ").concat(Z.uid),Z),It.reqUserAccount(V.sid,{lts:G,success:!1,serverAddr:j,stringUid:V.string_uid,uid:Z.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:V}),new Oe(te.INVALID_UINT_UID_FROM_STRING_UID);return It.reqUserAccount(V.sid,{lts:G,success:!0,serverAddr:j,stringUid:V.string_uid,uid:Z.uid,errorCode:null,extend:V}),!1}const Se=Xv(Z.code);return Se.retry&&(j=E[(de+1)%E.length]),It.reqUserAccount(V.sid,{lts:G,success:!1,serverAddr:j,stringUid:V.string_uid,uid:Z.uid,errorCode:Se.desc,extend:V}),Se.retry},(Z,de)=>Z.code!==te.OPERATION_ABORTED&&(It.reqUserAccount(V.sid,{lts:G,success:!1,serverAddr:j,stringUid:V.string_uid,uid:null,errorCode:Z.code,extend:V}),j=E[(de+1)%E.length],!0),N);if(Y.code!==0){const Z=Xv(Y.code);throw new Oe(te.UNEXPECTED_RESPONSE,Z.desc)}return Y}(h,e,r,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function Fme(e,r,i){const o=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await A9({referenceList:c,asyncMapHandler:h=>async function(m,_,E,S){const C=Date.now(),P={sid:E.sid,opid:10,appid:E.appId,string_uid:_};try{const N=await Ed(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const G=Xv(N.code);throw new Oe(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new Oe(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:C,url:m,req:P,uid:N.uid,elapse:Date.now()-C}}catch(N){throw N}}(h,e,r,i),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function jme(e,r,i){const o=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(E,S,C,P){const N=Nn(),G={flag:64,cipher_method:0,features:vh(vh(vh(vh(vh({install_id:XL(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:S.appId,version:bl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:kme.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return fd(()=>Ed(E,{data:G,timeout:1e3,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,V=>V.code!==te.OPERATION_ABORTED,P)}(_,e,r,i));let u=null,h=null,m={};try{u=await tS(c)}catch(_){if(_.code===te.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),It.reportApiInvoke(e.sid,{name:wi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const E=_.test_tags,S=Object.keys(E),C={};return S.forEach(P=>{var N;const G=co(N=P.slice(4)).call(N),V=JSON.parse(E[P]),j=V[1];C[G]={tag:V[0]||"",value:j}}),C}(u)}catch{}return m}async function k9(e,r){const i=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:NT(),serviceIds:[mi.CHOOSE_SERVER,mi.CLOUD_PROXY_FALLBACK]}));try{return await A9({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let _,{url:E,areaCode:S,serviceIds:C}=u;const P=Date.now(),[N,G]=Hx(h,S,C);let V=fi.networkState;try{V&&fi.networkState===hc.OFFLINE&&fi.onlineWaiter&&await dt.race([fi.onlineWaiter,hs(Ci.maxRetryTimeout)]),V=fi.networkState;const{data:j,headers:Y}=await Ed(E,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=Y.http3==="1"?1:-1,(Te=>{const ye=[];if(Te.response_body.forEach(Ne=>{const Ye=Ne.buffer.code;if(Ne.uri===23&&Ye===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const ht={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Te.detail[502]}),flag:Ne.buffer.flag};ye.push(ht)}if(Ye!==0){const ht=Xv(Ye),ft={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,ht.desc,{desc:ht.desc,retry:ht.retry,csIp:Te.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?L.warning(ft.error.toString()):ye.push(ft)}}),ye.length)throw new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,ye.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!ye.find(Ne=>Ne.error.data.retry),csIp:Te.detail[502],desc:[...new Set(ye.map(Ne=>{var Ye;return Ne==null||(Ye=Ne.error)===null||Ye===void 0||(Ye=Ye.data)===null||Ye===void 0?void 0:Ye.desc}).filter(Ne=>!!Ne))]})})(j);const de=AT(j,mi.CHOOSE_SERVER),Se=AT(j,mi.CLOUD_PROXY_FALLBACK);return Gx(de),{gatewayInfo:Dx(de,E),proxyInfo:Se,opid:G,requestTime:P,url:E,isHttp3:_,elapse:Date.now()-P}}catch(j){throw j}}(c,e,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function N9(e,r,i,o){const c=oe("PROXY_SERVER_TYPE3"),u=(N,G,V)=>{let j=V||c;return Array.isArray(j)&&(j=G%2==0?c[1]:c[0]),"https://".concat(j,"/ap/?url=").concat(N)};let h=null;const m=[],_=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((j,Y)=>{let Z;return Z=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y),{url:Z,areaCode:NT(),serviceIds:[mi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),V=await DT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(L.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),R9(j,e,r,i)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),V},E=async()=>{if(await hs(1e3),h!==null)return h;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map((j,Y)=>{let Z;return Z=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y),{url:Z,areaCode:NT(),serviceIds:[mi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),V=await DT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(L.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),R9(j,e,r,i)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),V};let S,C,P;try{({gatewayInfo:S,proxyInfo:C,url:P}=await tS([_(),E()]))}catch(N){throw N[0]}if(m.length&&m.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),!S||!C)throw new Oe(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=P,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];st(c).call(c,N)&&(e.proxyServer=N,L.setProxyServer(N),It.setProxyServer(N))}return h={gatewayInfo:S,proxyInfo:await n9(C,S.uid)},h}async function Bme(e,r,i){const o=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,E){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:bl,cname:m.cname,uid:m.uid.toString(),requestId:zx,seq:zx};zx+=1;const C={service_name:"tele_channel",json_body:JSON.stringify(S)};return fd(async()=>{const P=await Ed(h,{data:C,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw L.error(G.toString()),G}const N=JSON.parse(P.json_body);if(N.code!==200){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw L.error(G.toString()),G}if(!N.servers||N.servers.length===0){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw L.error(G.toString()),G}return{vid:N.vid,workerToken:N.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==te.OPERATION_ABORTED&&P.code!==te.UNEXPECTED_RESPONSE||P.data&&P.data.retry),E)}(u,e,r,i));try{const u=await tS(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Wme(e,r,i){let o=null;const c=[],u=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await hs(1e3),o!==null)?o:await DT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(L.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(E,S,C,P){const[N]=Vme(S,[mi.CHOOSE_SERVER]);let G=fi.networkState;return fd(async()=>{G&&fi.networkState===hc.OFFLINE&&fi.onlineWaiter&&await dt.race([fi.onlineWaiter,hs(P&&P.maxRetryTimeout||Ci.maxRetryTimeout)]),G=fi.networkState;const V=await Ed(E,{data:N,cancelToken:C,headers:{"Content-Type":"multipart/form-data;"}},!0);return Ume(V,E)},()=>!1,V=>V.code!==te.OPERATION_ABORTED&&(V.code===te.UPDATE_TICKET_FAILED?V.data.retry:(L.warning("[".concat(S.clientId,"] update ticket network error, retry"),V),!0)),P)}(_,e,r,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await tS([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function D9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Kx(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?D9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class zme extends Lr{get isSuccess(){return!!this.configs}constructor(r,i){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new Vs("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,It.reportApiInvoke(null,{options:void 0,name:wi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:jr.TRACER}).onSuccess(JSON.stringify(md))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void L.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await jme(this.joinInfo,this.cancelToken,this.retryConfig),L.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=eT(u=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(u);for(let E=0;E<h.length;E++)for(let S=h.length-1;S>E;S--){const C=h[S],P=c[C].value;if(typeof P.__priority=="number"){const N=P.__priority,G=h[S-1],V=c[G].value;if(typeof V.__priority=="number"){if(!(N>V.__priority))continue;{const j=C;h[S]=h[S-1],h[S-1]=j}}else{const j=C;h[S]=h[S-1],h[S-1]=j}}}const m=Date.now();let _={};return h.forEach(E=>{const S=c[E].value.__expires;S&&S<=m||(_[E]=c[E])}),_}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(te.NETWORK_RESPONSE_ERROR,o);L.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){GG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(CT.UPDATE_BITRATE_LIMIT,r):this.emit(CT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Kx({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,E=r[u].value,S=r[u].tag;let C=0;_?_===EW.REALTIME&&(C=1):Object.keys(E).some(P=>Object.prototype.hasOwnProperty.call(ex,P)||!Tx()&&Object.prototype.hasOwnProperty.call(UA,P)?(C=1,!0):void 0),c.push({tag:S,isApplied:C,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:E}=u;this.store.sessionId&&It.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){L.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,E=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=Kx(Kx({value:m[S]},_&&{expires:_}),E&&{type:E}))})}),u}(r);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&GG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(m){try{const _=Date.now();Object.keys(m).forEach(E=>{const{value:S,type:C,expires:P}=m[E];P&&P<=_||((C===EW.REALTIME||Object.prototype.hasOwnProperty.call(ex,E))&&(md[E]=S,Er[E]=S,L.debug("Update realtime parameters from config distribute",E,S)),C||Tx()||!Object.prototype.hasOwnProperty.call(UA,E)||(md[E]=S,Er[E]=S,L.debug("Update gateway parameters from config distribute",E,S)))})}catch(_){L.error("Error update config immediately: ".concat(m),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),L.debug("Caching global parameters ".concat(u))}catch(c){L.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Er,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(Er[o],c)||(md[o]=c,Er[o]=c,this.emit(CT.UPDATE_CLIENT_ROLE_OPTIONS,c),L.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){L.error("Error handling global parameter config:",i.message)}}}class Gme extends Lr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(r,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(r,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,i){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(r,i,o){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=st(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",L9[r],r,i),!c.isPrevNormal&&h&&this.emit("exception",L9[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof ki&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=pc(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof ki&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const L9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Bs=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function x9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function W_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?x9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class LT{constructor(r){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",MA.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Gme,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ke.LocalAudioTrack)||W_({},sx)}getLocalVideoTrackStats(){return this.localStats.get(Ke.LocalVideoTrack)||W_({},ox)}getRemoteAudioTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRemoteNetworkQualityStats(r){const i={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRTCStats(){let r=0,i=0,o=0,c=0;const u=this.localStats.get(Ke.LocalAudioTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(Ke.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get(Ke.LocalVideoLowTrack);m&&(r+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:S,videoStats:C}=E;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),C&&(o+=C.receiveBytes,c+=C.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Bs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Bs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&L.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,o){if(!r)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case Ke.LocalVideoTrack:case Ke.LocalVideoLowTrack:{const h=c,m=W_({},ox),_=r.getStats(),E=r.getLocalMedia(o);if(_){const S=_.videoSend.find(C=>C.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){const C=r.getLocalVideoSize(),P=r.getEncoderConfig(Ke.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):C&&(m.captureResolutionWidth=C.width,m.captureResolutionHeight=C.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):C&&(m.sendResolutionWidth=C.width,m.sendResolutionHeight=C.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(L.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,m);break}case Ke.LocalAudioTrack:{const h=c,m=W_({},sx),_=r.getStats(),E=r.getLocalMedia(o);if(_){const S=_.audioSend.find(C=>C.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const C=r.getLocalAudioVolume();C&&(m.sendVolumeLevel=Math.round(32767*C))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ke.LocalAudioTrack,m),m&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=i;const E=m,S=h,C=_,P=W_({},OW),N=W_({},kW),G=W_({},Afe),{audioTrack:V,videoTrack:j,audioSSRC:Y,videoSSRC:Z}=r.getRemoteMedia(u);let de;de=this.store.useP2P?r.getStats(!0):r.getStats();const Se=(o=de)===null||o===void 0?void 0:o.audioRecv.find(Ye=>Ye.ssrc===Y),Te=(c=de)===null||c===void 0?void 0:c.videoRecv.find(Ye=>Ye.ssrc===Z),ye=this.trafficStats&&this.trafficStats.peer_delay.find(Ye=>Ye.peer_uid===u);if(Se&&(Se.codec!=="opus"&&Se.codec!=="aac"&&Se.codec!=="PCMU"&&Se.codec!=="PCMA"&&Se.codec!=="G722"||(P.codecType=Se.codec),Se.outputLevel?P.receiveLevel=Math.round(32767*Se.outputLevel):V&&(P.receiveLevel=Math.round(32767*V.getVolumeLevel())),P.receiveBytes=Se.bytes,P.receivePackets=Se.packets,P.receivePacketsLost=Se.packetsLost,P.receivePacketsDiscarded=Se.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=E?8*Math.max(0,P.receiveBytes-E.receiveBytes):0,P.totalDuration=E?E.totalDuration+1:1,P.totalFreezeTime=E?E.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=Se.jitterBufferMs,P.totalDuration>10&&LT.isRemoteAudioFreeze(V)&&(P.totalFreezeTime+=1)),Te){var Ne;Te.codec!=="H264"&&Te.codec!=="H265"&&Te.codec!=="VP8"&&Te.codec!=="VP9"&&Te.codec!=="AV1X"&&Te.codec!=="AV1"||(N.codecType=Te.codec),N.receiveBytes=Te.bytes,N.receiveBitrate=S?8*Math.max(0,N.receiveBytes-S.receiveBytes):0,N.decodeFrameRate=Te.decodeFrameRate<0?0:Te.decodeFrameRate,N.renderFrameRate=Te.decodeFrameRate<0?0:Te.decodeFrameRate,Te.outputFrame&&(N.renderFrameRate=Te.outputFrame.frameRate),Te.receivedFrame?(N.receiveFrameRate=Te.receivedFrame.frameRate,N.receiveResolutionHeight=Te.receivedFrame.height,N.receiveResolutionWidth=Te.receivedFrame.width):j&&(N.receiveResolutionHeight=j._videoHeight||0,N.receiveResolutionWidth=j._videoWidth||0),Te.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(Te.framesRateFirefox)),N.receivePackets=Te.packets,N.receivePacketsLost=Te.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const Ye=S?S.totalFreezeTime:0,ht=S?S.totalDuration:0;N.totalDuration=S?S.totalDuration+1:1,N.totalFreezeTime=(Ne=Te.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Ye||0,N.receiveDelay=Te.jitterBufferMs||0;const ft=!!Z&&r.getRemoteVideoIsReady(Z);Te.totalFreezesDuration===void 0&&j&&ft&&LT.isRemoteVideoFreeze(j,Te,C)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-Ye)/(N.totalDuration-ht),1))}ye&&(P.end2EndDelay=ye.B_ad,N.end2EndDelay=ye.B_vd,P.transportDelay=ye.B_ed,N.transportDelay=ye.B_ed,P.currentPacketLossRate=ye.B_ealr4/100,N.currentPacketLossRate=ye.B_evlr4/100,G.uplinkNetworkQuality=ye.B_punq?ye.B_punq:0,G.downlinkNetworkQuality=ye.B_pdnq?ye.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:N,videoPcStats:Te,networkStats:G}),V&&this.exceptionMonitor.setRemoteAudioStats(V,P),j&&this.exceptionMonitor.setRemoteVideoStats(j,N)})}}class M9{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){WG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){WG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){nP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function U9(e){if(!(e instanceof M9))return new Oe(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!r)return new Oe(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new Oe(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class jm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function V9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function F9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?V9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):V9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const xT="9",j9=4e4;function B9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function rf(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?B9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):B9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var nS=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(nS||{});const gP=new Map;function W9(e,r,i,o){let{scale:c}=e;if(c===0&&o===nS.UP||c>=r.length-1&&o===nS.DOWN)return e;let u=rf(rf({},e),{},{scale:o===nS.DOWN?++c:--c});switch(i){case"maintain-framerate":u=rf(rf({},u),r[c].motion);break;case"maintain-resolution":u=rf(rf({},u),r[c].detail);break;case"balanced":u=rf(rf({},u),r[c].balanced)}return u}function z9(e,r){if(r){const i={overUse:0,underUse:0,adaptationList:G9(r)};gP.set(e,i)}else gP.delete(e)}function G9(e){const r=rf({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:C,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:V,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:Y,MOTION_RESOLUTION_FACTOR:Z,MOTION_BITRATE_FACTOR:de,DETAIL_FRAMERATE_FACTOR:Se,DETAIL_BITRATE_FACTOR:Te}=QL,ye=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(N,1)*ye),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let Ye=1;Ye<=_;Ye++){const ht={bwe_up:Math.round(Math.pow(C,Ye)*i),bwe_down:Math.round(Math.pow(P,Ye+1)*i),fps_up:Math.round(Math.pow(G,Ye)*ye),fps_down:Math.round(Math.pow(N,Ye+1)*ye)},ft={scaleResolutionDownBy:c/Math.pow(Y,Ye),frameRate:Math.max(Math.round(Math.pow(j,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(V,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(V,Ye)*u),E)},Sn={scaleResolutionDownBy:c/Math.pow(Z,Ye),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(de,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(de,Ye)*u),E)},bn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Se,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(Te,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(Te,Ye)*u),E)};Ne.push({scale:Ye,threshold:ht,balanced:ft,motion:Sn,detail:bn})}return Ne}function Hme(e,r,i,o,c,u){const h=gP.get(e)||{overUse:0,underUse:0,adaptationList:G9(c)},{adaptationList:m}=h;gP.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:E}=QL,{scale:S}=o;let C,P;return typeof r=="number"&&r>0&&function(N,G,V,j){if(G>=V.length)return!1;let{threshold:{fps_down:Y}}=V[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(Y=V[0].threshold.fps_down),N<Y}(r,S,m,u)&&(h.overUse++,P=ET.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(N,G,V){if(G>=V.length)return!1;const{threshold:{bwe_down:j}}=V[G];return N<j}(i,S,m)&&(h.overUse++,P=ET.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,C=W9(o,m,u,nS.DOWN),[C,P]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(N,G,V,j){if(G===0)return;let{threshold:{fps_up:Y}}=V[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(Y=V[1].threshold.fps_up),N>Y}(r,S,m,u)&&function(N,G,V){if(G===0)return;const{threshold:{bwe_up:j}}=V[G];return N>j}(i,S,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,C=W9(o,m,u,nS.UP),C.scale===0&&(P=ET.NONE))),[C,P])}function H9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function qx(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?H9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):H9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function $me(e){var r;return!!oe("ENABLE_AG_ADAPTATION")&&!!(e instanceof mx||st(r=e._hints).call(r,hr.CUSTOM_TRACK))&&(!!oe("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=Nn();if(o.os!==Gi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&B8(17,4)||j8(14)&&W8(17,4,!0)))}const _P=new Map;function yP(e,r){const i=_P.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),_P.delete(e)}r.qualityLimitationReason=ET.NONE,z9(e)}function Kme(e,r){var i;let o;switch(r){case Ke.LocalAudioTrack:o=Yn.Audio;break;case Ke.LocalVideoTrack:o=st(i=e._hints).call(i,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:o=Yn.Low}return o}function Yx(e){const r=Vn();if(e.some(i=>i._bypassWebAudio))throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function Xx(e,r){Yx(e);const i=new ki;return e.forEach(o=>i.addAudioTrack(o)),i}const qme=!Vn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&Kp();function EP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return qme?(i={spec:r,store:e},tf("PlanBConnection").create(i)):new Sh(r,e)}function Jx(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function $9(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(gT(e.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Rn;function K9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function vd(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?K9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):K9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Sh=(Rn=class ly extends $G{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return st(i=Object.keys(VA)).call(i,r)}))]}constructor(r,i){super(r,i),K(this,"id",dr(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:oe("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",ET.NONE),K(this,"isFirstConnected",!1),this.store=i,this.forceTurn=$9(r),this.mutex=new Vs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(ly.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=YL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Vr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const i=this.preSSRCMap.get(r);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void L.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else L.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Vm(o.sdp),u=await h9({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=dP(u),this.initialOffer=o,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:MA.L1T3}]});const E=await _.createOffer();if(!E.sdp)return void _.close();const S=Fa(E.sdp).mediaDescriptions[0];if(!S)return;const C=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),C}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&g9(o.sdp)&&(h=Br(u),(i=h).send&&(Jv(gt.VIDEO,i.send.videoExtensions),Jv(gt.AUDIO,i.send.audioExtensions)),i.recv&&(Jv(gt.VIDEO,i.recv.videoExtensions),Jv(gt.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(Jv(gt.VIDEO,i.sendrecv.videoExtensions),Jv(gt.AUDIO,i.sendrecv.audioExtensions))),vd(vd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new xe(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&g9(this.initialOffer.sdp)&&(i=r.rtpCapabilities,o=this.localCapabilities,i.send&&(cP(gt.VIDEO,i.send.videoExtensions,o.send.videoExtensions),cP(gt.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(cP(gt.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),cP(gt.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Br(this._localCapabilities)}get rtpCapabilities(){return Br(this._rtpCapabilities)}get candidates(){return Br(this._candidates)}get iceParameters(){return Br(this._iceParameters)}get dtlsParameters(){return Br(this._dtlsParameters)}constructor(E){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,E=Br(E);const{iceParameters:C,dtlsParameters:P,candidates:N,rtpCapabilities:G,setup:V,localCapabilities:j,cname:Y}=E;this._rtpCapabilities=G,this._candidates=N,this._originCandidates=Br(N),this._iceParameters=C,this._dtlsParameters=P,this._localCapabilities=j,this.setup=V,this.cname=Y,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(E){const S=this.candidates,C=this.dtlsParameters,P=this.iceParameters,N=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let V=1;V<E;V++){const j=2*V+2e4,Y=2*V+j9,{ssrcs:Z,ssrcGroups:de}=B_([{ssrcId:j}],this.cname),{ssrcs:Se,ssrcGroups:Te}=B_([{ssrcId:Y,rtx:oe("USE_SUB_RTX")?Y+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:xT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.videoCodecs.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:N.videoExtensions,fingerprints:C.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Se,ssrcGroups:Te,rtcpFeedbackWildcards:[],payloads:N.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:xT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.audioCodecs.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:N.audioExtensions,fingerprints:C.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Z,ssrcGroups:de,rtcpFeedbackWildcards:[],payloads:N.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Dm(this.sessionDesc)}send(E,S,C,P){const{ssrcs:N,ssrcGroups:G}=B_(S,this.cname,oe("SYNC_GROUP")?C:void 0),V=this.findPreloadMediaDesc(N);if(V){if(Vr()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,V.attributes.mid),P&&(P.twcc||P.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(V);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(V,P),{mid:V.attributes.mid,needExchangeSDP:!0}}return{mid:V.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(E,N);let Y;return j===-1||j===1&&(Is()||function(){const Z=Nn();return!(Z.name!==zn.CHROME||!Z.osVersion)&&Number(Z.version)<=90}()||oe("ENABLE_ENCODED_TRANSFORM")&&$p())||j===0&&oe("USE_SUB_RTX")||z8()?(Y=this.createOrRecycleSendMedia(E,N,G,"sendonly",P),this.updateBundleMids()):(Y=Br(this.sessionDesc.mediaDescriptions[j]),Y.attributes.direction="sendonly",Y.attributes.ssrcs=N,Y.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(Y,P)),Vr()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,Y.attributes.mid),{mid:Y.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:E,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:S}}batchSend(E){const S=E.map(N=>{let{kind:G,ssrcMsg:V,mslabel:j}=N;return this.send(G,V,j)}),C=[];let P=!1;return S.forEach(N=>{let{mid:G,needExchangeSDP:V}=N;V&&(P=!0),C.push(G)}),{mids:C,needExchangeSDP:P}}stopSending(E){const S=this.sessionDesc.mediaDescriptions.filter(C=>C.attributes.mid&&E.indexOf(C.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(C=>{C.attributes.mid==="0"||Vr()||z8()?C.attributes.ssrcs=[]:(C.attributes.ssrcs=[],C.attributes.direction="inactive",C.media.port="0")}),this.updateBundleMids()}mute(E){const S=this.sessionDesc.mediaDescriptions.find(C=>C.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(E){const S=this.sessionDesc.mediaDescriptions.find(C=>C.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(C=>st(E).call(E,C.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(C=>{C.attributes.direction="inactive"})}unmuteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(C=>st(E).call(E,C.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(C=>{C.attributes.direction="recvonly"})}receive(E,S,C,P){E.forEach((N,G)=>{this.createOrRecycleRecvMedia(N,[],"recvonly",S,C,P[G])}),this.updateBundleMids()}stopReceiving(E){const S=this.sessionDesc.mediaDescriptions.filter(C=>E.indexOf(C.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(C=>{C.media.port="0",C.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(E){const S=this.sessionDesc||Fa((C=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(C?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var C;this._rtpCapabilities=E;const P=this.rtpCapabilities.send,N=this.localCapabilities.send;for(const G of S.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const V=N.videoCodecs.filter(j=>{var Y,Z;return(Y=j.rtpMap)===null||Y===void 0?void 0:st(Z=Y.encodingName.toLowerCase()).call(Z,"vp8")})||[N.videoCodecs[0]];G.media.fmts=V.map(j=>j.payloadType.toString(10)),G.attributes.payloads=V,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(V=>V.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:V,ssrcGroups:j}=B_([{ssrcId:j9,rtx:oe("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=V,G.attributes.ssrcGroups=j}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const V=N.audioCodecs.filter(j=>{var Y,Z;return(Y=j.rtpMap)===null||Y===void 0?void 0:st(Z=Y.encodingName.toLowerCase()).call(Z,"opus")})||[N.audioCodecs[0]];G.media.fmts=V.map(j=>j.payloadType.toString(10)),G.attributes.payloads=V,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(V=>V.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,Zv(G),oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:V,ssrcGroups:j}=B_([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=V,G.attributes.ssrcGroups=j}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(E){const S=this._originCandidates.filter(P=>P.transport==="udp"),C=[];if(S.forEach(P=>{C.push(F9(F9({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(E){case js.TCP_RELAY:this._candidates=C;break;case js.UDP_TCP_RELAY:case js.RELAY:this._candidates=[...S,...C];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(E){E=Br(E),this._iceParameters=E,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=E.iceUfrag,S.attributes.icePwd=E.icePwd})}predictReceivingMids(E){const S=[];for(let C=0;C<E;C++)S.push((this.currentMidIndex+C+1).toString(10));return S}findAvailableMediaIndex(E,S){return this.sessionDesc.mediaDescriptions.findIndex(C=>{const P=C.media.mediaType===E&&C.media.port!=="0"&&(C.attributes.direction==="sendonly"||C.attributes.direction==="sendrecv")&&C.attributes.ssrcs.length===0;if(Vr()){if(P){const N=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(N||C.attributes.mid!=="0"&&C.attributes.mid!=="1")||!(!N||N!==C.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const C of this.sessionDesc.mediaDescriptions)if(C.media.mediaType==="application")return{mediaDesc:C,needExchangeSDP:!1};this.currentMidIndex+=1;const E="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:xT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(E),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(E,S,C,P,N,G){const V=E._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,Y=OT(V,j,this.localCapabilities.send,V===gt.VIDEO?P:N),Z=V===gt.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const de="".concat(this.currentMidIndex);let Se={media:{mediaType:V,port:xT,protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:C,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(de)}};Se=this.mungRecvMediaDsec(Se,E,G);const Te=this.findFirstClosedMedia(V);if(Te){const ye=this.sessionDesc.mediaDescriptions.indexOf(Te);this.sessionDesc.mediaDescriptions[ye]=Se}else this.sessionDesc.mediaDescriptions.push(Se);return Se}updateRemoteCodec(E,S,C){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Se=>Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||"").filter(Se=>{var Te;return st(Te=Object.keys(VA)).call(Te,Se)}))],N=new Set(S);if(P.every(Se=>N.has(Se)))return L.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(Se=>S.some(Te=>{var ye;return st(ye=Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||"").call(ye,Te)}));if(G.length===0)return L.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const V=[...new Set(G.map(Se=>Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||""))];let j;if(L.debug("updateRemoteCodec, from ".concat(P," to ").concat(V)),E.length===0)j=this.sessionDesc.mediaDescriptions.filter(Se=>Se.media.mediaType==="video"&&Se.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(Se=>Se.attributes.mid&&st(E).call(E,Se.attributes.mid)&&Se.attributes.direction==="recvonly"),j.length!==E.length)return L.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(E,", codecs: ").concat(S)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const Se=Ux(G,this.rtpCapabilities.recv.videoCodecs);G.push(...Se)}this._rtpCapabilities.recv.videoCodecs=G;const Y=this.localCapabilities.send,Z=this.rtpCapabilities.recv,de=OT(gt.VIDEO,Z,Y,C);return j.forEach(Se=>{const Te=de.map(ye=>ye.payloadType.toString(10));L.debug("updateRemoteCodec mid: ".concat(Se.attributes.mid,", from"),Se.attributes.payloads,"to",de),Se.attributes.payloads=de,Se.media.fmts=Te}),!0}createOrRecycleSendMedia(E,S,C,P,N){const G=this.rtpCapabilities.send,V=E===gt.VIDEO?G.videoCodecs:G.audioCodecs,j=E===gt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let Z={media:{mediaType:E,port:xT,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map(Se=>Se.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};Z=this.mungSendMediaDesc(Z,N);const de=this.findFirstClosedMedia(E);if(de){const Se=this.sessionDesc.mediaDescriptions.indexOf(de);this.sessionDesc.mediaDescriptions[Se]=Z}else this.sessionDesc.mediaDescriptions.push(Z);return Z}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(E=>E.media.port!=="0").map(E=>E.attributes.mid)}mungRecvMediaDsec(E,S,C){const P=Br(E);return xx(P),Qv(P,S),Mx(P,S),u9(P),uP(P,C,this.localCapabilities.send),P}mungSendMediaDesc(E,S){const C=Br(E);return uP(C,S,this.localCapabilities.recv),Zv(C),C}updateRecvMedia(E,S){const C=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===E);if(C!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[C],S);this.sessionDesc.mediaDescriptions[C]=P}}bumpMid(E){this.currentMidIndex+=E}findFirstClosedMedia(E){return this.sessionDesc.mediaDescriptions.find(S=>Vr()?S.media.port==="0"&&S.media.mediaType===E:S.media.port==="0")}findPreloadMediaDesc(E){return this.sessionDesc.mediaDescriptions.find(S=>{var C;return((C=S.attributes)===null||C===void 0||(C=C.ssrcs[0])===null||C===void 0?void 0:C.ssrcId)===E[0].ssrcId})}getSSRC(E){var S;return(S=this.sessionDesc.mediaDescriptions.find(C=>C.attributes.mid===E))===null||S===void 0?void 0:S.attributes.ssrcs}}(vd(vd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=f9(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),oe("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(oe("PRELOAD_MEDIA_COUNT"));const E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=r;if(Array.isArray(_)&&_.length>0){const{mids:E}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));E.forEach((S,C)=>{this.preSSRCMap.set(_[C].ssrcId,S)}),await kT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=r;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await kT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return Sl(function*(){const u=yield kn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=aP();r.forEach(j=>{const Y=c.peerConnection.addTransceiver(j._mediaStreamTrack,vd({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Y),j._updateRtpTransceiver(Y)}),Vr()&&oe("SIMULCAST")===!0&&(yield kn(c.applySimulcastForFirefox(h,r)));const _=yield kn(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(_.sdp,r,E),C=Fa(S),P=E.map(j=>{const Y=C.mediaDescriptions.find(Z=>Z.attributes.mid===j);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return a9(Y,oe("USE_PUB_RTX"))});let N;try{N=yield P}catch(j){N=[],c.remoteSDP.receive(r,i,o,N);const Y=c.remoteSDP.toString();throw yield kn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield kn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield kn(c.stopSending(E,!0)),j}c.remoteSDP.receive(r,i,o,N);const G=c.remoteSDP.toString(),V=c.logSDPExchange(S,"offer","local","send");return yield kn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield kn(c.applySimulcastEncodings(h,r)),yield kn(c.applySendEncodings(h,r)),V==null||V(G),yield kn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((j,Y)=>{const Z=E[Y];return{localSSRC:P[Y],id:Z,transceiver:j}})}catch(h){throw h instanceof xe?h:new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")L.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),L.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else L.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof xe?o:new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof xe?i:new xe(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var E;yP(this.id+_.mid,this),_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);h&&(await kT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await kT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Sl(function*(){const o=yield kn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Vn().supportPCSetConfiguration,u=oe("FORCE_TURN_TCP")||i.forceTurn;if(r===js.RELAY&&!c)return;if(c&&!u){const C=r===js.RELAY?"relay":"all",P=i.peerConnection.getConfiguration();P.iceTransportPolicy!==C&&(L.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(C,"]")),P.iceTransportPolicy=C,i.peerConnection.setConfiguration(P))}i.remoteSDP.updateCandidates(r);const h=yield kn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Vm(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;i.remoteSDP.restartICE(_);const E=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield kn(i.peerConnection.setLocalDescription(h)),S==null||S(E),yield kn(i.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){L.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(js.TCP_RELAY),await kT(this.peerConnection,this.remoteSDP,this.extension)}catch(i){L.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{yP(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return vd(vd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?Vr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:vd(vd({},mh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:vd(vd({},mh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(gT(r.turnServer.servers)?i.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&i.iceServers?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...ly.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...ly.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...ly.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...ly.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Vn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Mm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!oe("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{const c=oe("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Mm(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Mm(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!i)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(V,j){return V.getTransceivers().find(Y=>Y.sender.track===j||Y.receiver.track===j)}(this.peerConnection,r._mediaStreamTrack),_=Dfe(r);if($me(r)&&m&&i&&_&&this.getLocalVideoStats&&st(o=["vp8","vp9"]).call(o,this.store.codec)){var E;const V=u.degradationPreference||(st(E=r._hints).call(E,hr.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(j,Y,Z,de,Se,Te){if(yP(j,Z),Se(Y),de!=="balanced"&&de!=="maintain-framerate"&&de!=="maintain-resolution")return;let ye=-1;z9(j,Y);const Ne=window.setInterval(()=>{const ht=_P.get(j);if(!oe("ENABLE_AG_ADAPTATION")||!ht)return yP(j,Z),void Se(Y);const ft=Te();if(ft.sendPackets>0&&ft.OutgoingAvailableBandwidth>0){if(ye===-1)return void(ye=Date.now());if(Date.now()-ye<1e3)return;const Sn=ft.sendFrameRate,bn=ft.OutgoingAvailableBandwidth,[pr,ai]=Hme(j,Sn,bn,ht.adaptationConfig,Y,de);ai&&(Z.qualityLimitationReason=ai),pr&&ht.adaptationConfig.scale!==pr.scale&&(L.debug("[".concat(j,"] applyAdaptation: ").concat(Z.qualityLimitationReason,`
           sendFps `).concat(Sn,", bwe ").concat(bn,", switch from ").concat(ht.adaptationConfig.scale," to ").concat(pr.scale," ")),ht.adaptationConfig=qx(qx({},ht.adaptationConfig),pr),Se(pr))}},oe("CHECK_LOCAL_STATS_INTERVAL")),Ye=qx({},Y);_P.set(j,{timer:Ne,adaptationConfig:Ye,originConfig:Y,adaptationFunc:Se}),L.debug("[".concat(j,"] start adaptation, originConfig: ").concat(JSON.stringify(Y),", degradationPreference: ").concat(de))})(this.id+m.mid,_,this,V,j=>{i&&this.updateAdaptation(i,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:V,frameRate:j,scaleResolutionDownBy:Y}=r._encoderConfig;V&&(h.maxBitrate=1e3*V),(st(S=r._hints).call(S,hr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=pc(j)),Y&&Y>=1&&(h.scaleResolutionDownBy=Y))}const{maxFramerate:C}=oe("ENCODER_CONFIG_LIMIT");if(C&&typeof C=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,C):C),oe("DSCP_TYPE")&&Kp()){var P;const V=oe("DSCP_TYPE");st(P=["very-low","low","medium","high"]).call(P,V)&&(h.networkPriority=V)}const N=i.getParameters(),G=(c=N.encodings)===null||c===void 0?void 0:c[0];Vr()&&!G&&(u.encodings=[h]),G&&Object.assign(G,h),Object.assign(N,u),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await i.setParameters(N),await async function(V,j,Y){try{var Z;if(!Vn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(V)||!oe("ENABLE_SVC"))return;const de={},Se={},Te=j.getParameters(),ye=(Z=Te.encodings)===null||Z===void 0?void 0:Z[0];Se.scalabilityMode=aP(Y),ye&&Object.assign(ye,Se),Object.assign(Te,de),await j.setParameters(Te),L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Te.encodings)))}catch(de){L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",de)}}(this.store.codec,i,oe("SVC_MODE"))}async updateAdaptation(r,i){var o,c;if(!r)return L.debug("[updateAdaptation] no rtpSender found");if(!Vn().supportSetRtpSenderParameters)return L.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=pc(m)),_&&_>=1&&st(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const E=r.getParameters(),S=(c=E.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(E,{});try{await r.setParameters(E),L.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(C){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?L.debug("[updateAdaptation] peerConnection not connected}"):L.debug("[updateAdaptation] updateRtpSenderEncodings failed",C):L.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!Vn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof vr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=Fa(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===m);_&&(Qv(_,u),d9(_,u,this.store.codec))}),Dm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const E=r[_],S=i[_];if(S instanceof vr&&!st(o=S._hints).call(o,hr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const C={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=E.sender.getParameters();await E.sender.setParameters(Object.assign(N,C))}}}async applySimulcastEncodings(r,i){if(!Vr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof vr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof vr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=r._hints).call(i,hr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(oe("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(Vn().supportPCSetConfiguration){const i=ly.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},St(Rn.prototype,"updateRemoteRTPCapabilities",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"updateRemoteRTPCapabilities"),Rn.prototype),St(Rn.prototype,"connect",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"connect"),Rn.prototype),St(Rn.prototype,"updateRemoteConnect",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"updateRemoteConnect"),Rn.prototype),St(Rn.prototype,"createDataChannels",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"createDataChannels"),Rn.prototype),St(Rn.prototype,"receive",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"receive"),Rn.prototype),St(Rn.prototype,"batchReceive",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"batchReceive"),Rn.prototype),St(Rn.prototype,"stopReceiving",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"stopReceiving"),Rn.prototype),St(Rn.prototype,"muteRemote",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"muteRemote"),Rn.prototype),St(Rn.prototype,"unmuteRemote",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"unmuteRemote"),Rn.prototype),St(Rn.prototype,"muteLocal",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"muteLocal"),Rn.prototype),St(Rn.prototype,"unmuteLocal",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"unmuteLocal"),Rn.prototype),St(Rn.prototype,"close",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"close"),Rn.prototype),St(Rn.prototype,"updateEncoderConfig",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"updateEncoderConfig"),Rn.prototype),St(Rn.prototype,"updateSendParameters",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"updateSendParameters"),Rn.prototype),St(Rn.prototype,"replaceTrack",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"replaceTrack"),Rn.prototype),St(Rn.prototype,"updateAdaptation",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"updateAdaptation"),Rn.prototype),St(Rn.prototype,"getRemoteSSRC",[oa],Object.getOwnPropertyDescriptor(Rn.prototype,"getRemoteSSRC"),Rn.prototype),Rn);function oa(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function Qx(e,r){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=pc(r.width),o.height=pc(r.height);const c=pc(r.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new Oe(te.UNEXPECTED_ERROR,"can not get canvas context");const m=Vn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,C=i.videoHeight/S,P=o.width*C;Math.abs(P-o.height)>=2&&(L.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=lx(()=>o.startCapture&&o.startCapture(),c);const E=_.stop;return _.stop=()=>{E.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),L.debug("clean low stream renderer")},_}var vP=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(vP||{}),gi=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(gi||{}),z_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(z_||{}),_i=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(_i||{}),G_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(G_||{}),q9=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(q9||{}),bh=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(bh||{}),aa=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(aa||{}),Y9=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(Y9||{}),ca=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ca||{}),SP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(SP||{});const H_=1e3,$_=6,bP=3,Yme=Math.max($_,bP);function Bt(e,r,i){i!=null&&Number.isFinite(i)&&(e[r]=Math.round(Math.max(0,i)))}function X9(e){const r={[ca.CONN_TYPE]:0,[ca.RTT]:e.rtt,[ca.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[ca.CONN_TYPE]=1),i==="tcp"&&(r[ca.CONN_TYPE]=3),i==="tls"&&(r[ca.CONN_TYPE]=4);break}case"srflx":r[ca.CONN_TYPE]=2;break;case"unknown":r[ca.CONN_TYPE]=5;break;default:r[ca.CONN_TYPE]=0}return r}function J9(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class Q9 extends Lr{constructor(r){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%bP==0,o=r%$_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const E=this.getTransportStats(c,u,i);E&&(m.misc=[E])}if(this.uploadOutboundStarted&&c){const E=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);E&&(m.outbound=[E])}if(this.uploadInboundStarted&&u){const E=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);E&&(m.inbound=E)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[SP.RTC_PEER_CONNECTION_STATE]=qL[_]):m.misc=[{addition:{[SP.RTC_PEER_CONNECTION_STATE]:qL[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[SP.RTC_PEER_CONNECTION_STATE]:qL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Yme+1&&(r=1)},H_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,i,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[ca.RTT]:r.rtt,[ca.CONN_TYPE]:void 0,[ca.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=X9(r);if(this.store.useP2P){if(i){const u=X9(i);c[ca.CONN_TYPE]+=u[ca.CONN_TYPE]<<3}c[ca.CONN_TYPE]+=110}else c[ca.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(E=>{let[S,{track:C,ssrcs:P}]=E;switch(S){case Ke.LocalVideoLowTrack:case Ke.LocalVideoTrack:if(S===Ke.LocalVideoTrack){const N=function(j,Y,Z,de,Se,Te){const ye=Y.videoSend.find(ft=>ft.ssrc===j);if(!ye)return;const Ne={},{sentFrame:Ye,inputFrame:ht}=ye;if(Te&&(Bt(Ne,gi.QP_SUM,ye.qpSumPerFrame),ht&&Ye)){const ft=ht.frameRate,Sn=Ye.frameRate;Ne[gi.FREEZE]=function(bn,pr){let ai=!0;return ai=!(bn<=5)&&(bn<=10?pr<3:bn<=20?pr<4:pr<5),ai}(ft,Sn)?1:0}if(Se){switch(Ye&&(Bt(Ne,gi.HEIGHT,Ye.height),Bt(Ne,gi.WIDTH,Ye.width),Bt(Ne,gi.FRAME_RATE,Ye.frameRate)),Ne[gi.DISABLED]=de._originMediaStreamTrack&&!de._originMediaStreamTrack.enabled||de._mediaStreamTrack&&!de._mediaStreamTrack.enabled?1:0,ye.adaptionChangeReason){case"none":Ne[gi.ADAPTATION]=0;break;case"cpu":Ne[gi.ADAPTATION]=1;break;case"bandwidth":Ne[gi.ADAPTATION]=2;break;case"other":Ne[gi.ADAPTATION]=3}let ft=0;ye.adaptionChangeReason&&(ft+=J9(ye.adaptionChangeReason)),Y.qualityLimitationReason&&(ft+=J9(Y.qualityLimitationReason)<<3),Ne[gi.ADAPTATION]=ft,Ne[gi.PLAYER_STATUS]=ax[de._player?de._player.videoElementStatus:"uninit"],Bt(Ne,gi.NACKS,ye.nacksCount),Bt(Ne,gi.PLIS,ye.plisCount),Bt(Ne,gi.FIRS,ye.firsCount),Bt(Ne,gi.AVG_ENCODE,ye.avgEncodeMs),Bt(Ne,gi.HUGE_FRAME_SENT,ye.hugeFramesSent),Bt(Ne,gi.BYTES_RETRANSMIT,ye.retransmittedBytesSent),Bt(Ne,gi.PACKAGES_RETRANSMIT,ye.retransmittedPacketsSent),Bt(Ne,gi.KEY_FRAMES_ENCODED,ye.keyFramesEncoded);const Sn=Z&&Z.videoSend.find(bn=>bn.ssrc===j);if(Sn){let bn=Se?H_:H_*$_;Sn.timestamp&&ye.timestamp&&(bn=ye.timestamp-Sn.timestamp),Sn.packets!=null&&ye.packets!=null&&Bt(Ne,gi.PACKAGE_RATE,1e3*(ye.packets-Sn.packets)/bn),ye.packetsLost!=null&&Sn.packetsLost!=null&&Bt(Ne,gi.PACKAGE_LOST,ye.packetsLost-Sn.packetsLost),Sn.bytes!=null&&ye.bytes!=null&&Bt(Ne,gi.BITRATE,8*(ye.bytes-Sn.bytes)/bn)}}return Ne}(P[0].ssrcId,r,i,C,o,c),G=C&&function(j,Y,Z,de){const Se=Y.videoSend.find(ye=>ye.ssrc===j);if(!Se)return null;const Te={};if(de){const ye=Se.inputFrame,Ne=ye&&ye.height||Z.videoHeight||0,Ye=ye&&ye.width||Z.videoWidth||0,ht=ye&&ye.frameRate||0;Bt(Te,vP.HEIGHT,Ne),Bt(Te,vP.WIDTH,Ye),Bt(Te,vP.FRAME_RATE,ht)}return Te}(P[0].ssrcId,r,C,o),V=function(j,Y){const Z={};return Y&&(Bt(Z,gi.RETRANSMIT,j.bitrate.retransmit),Bt(Z,gi.TARGET_ENCODED,j.bitrate.targetEncoded),Bt(Z,gi.ACTUAL_ENCODED,j.bitrate.actualEncoded),Bt(Z,gi.TRANSMIT,j.bitrate.transmit),Bt(Z,gi.BANDWIDTH,j.sendBandwidth)),Z}(r,o);m=Object.assign({},N,G,V)}else _=function(N,G,V,j){const Y=G.videoSend.find(de=>de.ssrc===N);if(!Y)return;const Z={};if(j){const de=Y.sentFrame;if(de&&(Bt(Z,z_.HEIGHT,de.height),Bt(Z,z_.WIDTH,de.width),Bt(Z,z_.FRAME_RATE,de.frameRate)),V){const Se=V.videoSend.find(Te=>Te.ssrc===N);if(Se){let Te=H_*$_;Se.timestamp&&Y.timestamp&&(Te=Y.timestamp-Se.timestamp),Se.packets!=null&&Y.packets!=null&&Bt(Z,z_.PACKAGE_RATE,1e3*(Y.packets-Se.packets)/Te),Y.packetsLost!=null&&Se.packetsLost!=null&&Bt(Z,z_.PACKAGE_LOST,Y.packetsLost-Se.packetsLost),Se.bytes!=null&&Y.bytes!=null&&Bt(Z,z_.BITRATE,8*(Y.bytes-Se.bytes)/Te)}}}return Z}(P[0].ssrcId,r,i,o);break;case Ke.LocalAudioTrack:h=C&&function(N,G,V,j,Y){const Z=G.audioSend.find(Se=>Se.ssrc===N);if(!Z)return;const de={};if(Y){de[bh.DISABLED]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const Se=100*j._source.getAccurateVolumeLevel(),Te=Z.inputLevel;if(Te!=null){const Ne=Math.ceil(50*Math.log10(100*Te+1));Bt(de,bh.LEVEL,Ne)}Bt(de,q9.PCM_LEVEL,Se),Bt(de,bh.AEC_RETURN_LOSS,Z.aecReturnLoss),Bt(de,bh.AEC_RETURN_LOSS_ENH,Z.aecReturnLossEnhancement),Bt(de,bh.BYTES_RETRANSMIT,Z.retransmittedBytesSent),Bt(de,bh.PACKAGES_RETRANSMIT,Z.retransmittedPacketsSent),de[bh.FREEZE]=0;const ye=V&&V.audioSend.find(Ne=>Ne.ssrc===N);if(ye){let Ne=H_*$_;ye.timestamp&&Z.timestamp&&(Ne=Z.timestamp-ye.timestamp),ye.bytes!=null&&Z.bytes!=null&&Bt(de,bh.BITRATE,8*(Z.bytes-ye.bytes)/Ne),ye.packets!=null&&Z.packets!=null&&Bt(de,bh.PACKAGE_RATE,1e3*(Z.packets-ye.packets)/Ne)}}return de}(P[0].ssrcId,r,i,C,o)}}),{high:m,low:_,audio:h}}getInboundStats(r,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,E]=m;const S={peer:_.uid};if(E.has(gt.VIDEO)&&_.videoTrack){const C=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,P=_.videoTrack?function(N,G,V,j,Y,Z,de,Se){const Te=G.videoRecv.find(bn=>bn.ssrc===N);if(!Te)return;const ye={},{receivedFrame:Ne,outputFrame:Ye,decodeFrameRate:ht}=Te,ft=V&&V.videoRecv.find(bn=>bn.ssrc===N);if(Bt(ye,G_.FRAME_RATE_DECODE,ht),Te.framesRateFirefox&&Bt(ye,_i.FRAME_RATE,Te.framesRateFirefox),Ne&&Bt(ye,_i.FRAME_RATE,Ne.frameRate),Bt(ye,_i.FRAMES_DROPPED,Te.framesDroppedCount),Bt(ye,_i.BYTES_RETRANSMIT,Te.retransmittedBytesReceived),Bt(ye,_i.PACKAGES_RETRANSMIT,Te.retransmittedPacketsReceived),Bt(ye,_i.PACKAGES_DISCARDED,Te.packetsDiscarded),Bt(ye,_i.AVG_DECODE,Te.avgDecodeMs),Bt(ye,_i.AVG_PROCESSING_DELAY,Te.avgProcessingDelayMs),Bt(ye,_i.AVG_ASSEMBLY_TIME,Te.avgFramesAssembledFromMultiplePacketsMs),Bt(ye,_i.AVG_INTER_FRAME_DELAY,Te.avgInterFrameDelayMs),Bt(ye,_i.KEY_FRAMES_DECODED,Te.keyFramesDecoded),ft){const bn=G.timestamp-V.timestamp||H_*(Se?$_:de?bP:1);Te.packetsLost!=null&&ft.packetsLost!=null&&Bt(ye,_i.PACKAGE_LOST,Te.packetsLost-ft.packetsLost),ft.bytes!=null&&Te.bytes!=null&&Bt(ye,_i.BITRATE,8*(Te.bytes-ft.bytes)/bn),ft.packets!=null&&Te.packets!=null&&Bt(ye,_i.PACKAGE_RATE,1e3*(Te.packets-ft.packets)/bn)}if(Se&&(Bt(ye,_i.QP_SUM,Te.qpSumPerFrame),ye[_i.FREEZE]=Y&&LT.isRemoteVideoFreeze(j,Te,ft)?1:0),de){var Sn;Ne?(Bt(ye,_i.HEIGHT,Ne.height),Bt(ye,_i.WIDTH,Ne.width)):j&&(Bt(ye,_i.HEIGHT,j._videoHeight||0),Bt(ye,_i.WIDTH,j._videoWidth||0)),Ye&&Bt(ye,G_.FRAME_RATE_OUTPUT,Ye.frameRate);const bn=(Sn=j._player)===null||Sn===void 0?void 0:Sn.rendFrameRate.toFixed(0);if(bn&&Bt(ye,G_.FRAME_RATE_RENDER,+bn),Bt(ye,_i.JITTER_BUFFER,Te.jitterBufferMs),Bt(ye,_i.CURRENT_DELAY,Te.currentDelayMs),Bt(ye,_i.FIRS,Te.firsCount),Bt(ye,_i.NACKS,Te.nacksCount),Bt(ye,_i.PLIS,Te.plisCount),j){ye[_i.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const pr=j._player;if(pr){const{freezeTimeCounterList:ai,renderFreezeAccTime:$r,videoElementStatus:ua}=pr;if(ai&&ai.length>0&&Bt(ye,G_.FREEZE_TIME,ai.splice(0,1)[0]),Z&&Xp.visibility==="visible"&&ua===lo.PLAYING&&Vn().supportRequestVideoFrameCallback){const je=Math.min(6e3,$r);pr.renderFreezeAccTime=Math.max(0,$r-je),Bt(ye,G_.FREEZE_TIME_RENDER,je)}if(typeof Te.totalFreezesDuration=="number"){const je=ft&&ft.totalFreezesDuration?Te.totalFreezesDuration-ft.totalFreezesDuration:Te.totalFreezesDuration;Bt(ye,G_.FREEZE_DURATION,1e3*je)}}}if(ye[_i.PLAYER_STATUS]=ax[j._player?j._player.videoElementStatus:"uninit"],ft&&Te.totalInterFrameDelay!==void 0&&Te.totalSquaredInterFrameDelay!==void 0&&ft.totalInterFrameDelay!==void 0&&ft.totalSquaredInterFrameDelay!==void 0){const pr=Te.totalInterFrameDelay-ft.totalInterFrameDelay,ai=Te.totalSquaredInterFrameDelay-ft.totalSquaredInterFrameDelay,$r=Te.framesDecodeCount-ft.framesDecodeCount,ua=pr/$r*1e3,je=Math.round(1e3*Math.sqrt((ai-Math.pow(pr,2)/$r)/$r));!isNaN(je)&&ua+je>Math.max(3*ua,ua+150)&&(ye[_i.I_FRAME_DELAY]=je)}}return ye}(_._videoSSRC,r,i,_.videoTrack,C===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(E.has(gt.AUDIO)&&_.audioTrack){const C=_.audioTrack?function(P,N,G,V,j,Y){const Z=N.audioRecv.find(ye=>ye.ssrc===P);if(!Z)return;const de={},Se=G&&G.audioRecv.find(ye=>ye.ssrc===P);if(Bt(de,aa.JITTER,Z.jitterMs),Bt(de,aa.BYTES_RETRANSMIT,Z.retransmittedBytesReceived),Bt(de,aa.PACKAGES_RETRANSMIT,Z.retransmittedPacketsReceived),Bt(de,aa.PACKAGES_DISCARDED,Z.packetsDiscarded),Bt(de,aa.AVG_PROCESSING_DELAY,Z.avgProcessingDelayMs),Se){const ye=N.timestamp-G.timestamp||H_*(Y?$_:j?bP:1);Z.packets!=null&&Se.packets!=null&&Bt(de,aa.PACKAGE_RATE,1e3*(Z.packets-Se.packets)/ye),j&&Se.bytes!=null&&Z.bytes!=null&&Bt(de,aa.BITRATE,8*(Z.bytes-Se.bytes)/ye),Z.packetsLost!=null&&Se.packetsLost!=null&&Bt(de,aa.PACKAGE_LOST,Z.packetsLost-Se.packetsLost)}if(Y){const{receivedFrames:ye,droppedFrames:Ne}=Z;ye!=null&&Ne!=null&&(de[aa.FREEZE]=(Te=ye)===0||100*Ne/Te>20?1:0)}var Te;if(j){const ye=100*V._source.getAccurateVolumeLevel(),Ne=Z.outputLevel;if(Ne!=null){const Ye=Math.ceil(50*Math.log10(100*Ne+1));Bt(de,Y9.LEVEL,Ye)}if(Bt(de,aa.PCM_LEVEL,ye),V&&(de[aa.DISABLED]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1),Bt(de,aa.JITTER_BUFFER,Z.jitterBufferMs),Bt(de,aa.CURRENT_DELAY,Z.jitterBufferMs),de[aa.PLAYER_STATUS]=ax[sa.getPlayerState(V.getTrackId())],Se){const Ye=Z.concealedSamples-Se.concealedSamples;Ye>0&&Bt(de,aa.CONCEALED_SAMPLES,Ye);const ht=Z.totalSamplesReceived-Se.totalSamplesReceived;ht>0&&Bt(de,aa.TOTAL_SAMPLES_RECEIVED,ht)}}return de}(_._audioSSRC,r,i,_.audioTrack,o,c):void 0;C&&(S.audio=C)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof HA);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(wT.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,o]=r;o.has(gt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(gt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of u)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,S]of h)S.has(gt.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),S.has(gt.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(E,S){const C={};for(const{id:V,value:j,level:Y,direction:Z}of E){var P;const de=(P=S.get(V))!==null&&P!==void 0?P:0,Se=j===2?de+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:de;var N,G;S.set(V,Se),C[V]?(j===2&&(C[V].value=j),Y>C[V].level&&(C[V].level=Y),Z==="remote"&&(C[V].remoteUidCount+=1),C[V].totalTs=(N=S.get(V))!==null&&N!==void 0?N:0):C[V]={value:j,level:Y,remoteUidCount:Z==="local"?0:1,totalTs:(G=S.get(V))!==null&&G!==void 0?G:0}}return Object.keys(C).map(V=>{const{level:j,value:Y,totalTs:Z}=C[V];return{id:V,level:j,value:Y,totalTs:Z}})}(c,r);const m=Date.now(),_=m>i?m:i+1;this.requestUpload&&this.requestUpload(wT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Xme=oe("ICE_RESTART_INTERVAL");let TP=new Map,rS=new Map,Bm=[js.UDP_TCP_RELAY,js.TCP_RELAY,js.RELAY],Zx=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vn().supportPCSetConfiguration;function Z9(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=TP.get(e.id);i&&(window.clearTimeout(i),TP.delete(e.id));const o=rS.get(e.id);r&&o&&o.index===Bm.length-1&&(L.debug("[".concat(e.id,"] reset ICE restart policy")),rS.delete(e.id))}function eH(e,r,i){if(TP.size===0&&rS.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let E=0;E<m.length;E+=1){const S=m[E];if(m.filter(C=>C===S).length!==_.filter(C=>C===S).length)return!1}return!0}(Bm,oe("RESTART_SEQUENCE"))&&(Bm=oe("RESTART_SEQUENCE").filter(m=>{var _;if(st(_=Object.values(js)).call(_,m))return!0}),L.debug("use reconnection policy from config distribution, queues: ".concat(Bm.join(" => ")))),Zx=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vn().supportPCSetConfiguration),Bm.length===0)return void i();let o,{index:c=0,type:u}=rS.get(e.id)||{};if(Zx&&u===js.RELAY)return void i();let h=u&&c>=Bm.length-1;if(Zx)u=js.RELAY;else{if(h)return void i();u?(c++,u=Bm[c]):(u=Bm[0],c=0)}L.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),rS.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>eH(e,r,i),Xme),TP.set(e.id,o)}var fn;function tH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Th(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?tH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function nH(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=TL,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new wP(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function wP(e){function r(i){if(Object(i)!==i)return dt.reject(new TypeError(i+" is not an object."));var o=i.done;return dt.resolve(i.value).then(function(c){return{value:c,done:o}})}return wP=function(i){this.s=i,this.n=i.next},wP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?dt.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?dt.reject(i):r(o.apply(this.s,arguments))}},new wP(e)}let MT=(fn=class extends Lr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(Lt.StateChange,r,this._state)}constructor(e,r){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",qn.Disconnected),K(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?ef.FIRST_CONNECTION:ef.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==qn.Connected)return void c(new xe(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createMuteMessage(h);await ur(this,Lt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==qn.Connected)return void c(new xe(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];if(E.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}else{const S=Qx(i,_T(this,Lt.RequestLowStreamParameter));E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}await new dt((S,C)=>{this.handleReplaceTrack(E.track,S,C,!0)})}await this.connection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createUnmuteMessage(h);await ur(this,Lt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==qn.Connected)return void o();const{id:E,track:S}=_;await this.connection.updateSendParameters(E,S),await this.connection.updateEncoderConfig(E,S),this.emit(Lt.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==qn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==qn.Connected)return void o();const h=Xx([i]);let m;L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(E){c(E)}finally{var _;(_=m)===null||_===void 0||_()}}),K(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;L.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:C}]=S;return i===C});if(!this.connection||!E||this.state!==qn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,E[1].id)),this.isPlanB){const S=E[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(E[0],S)}if(E[0]===Ke.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(S){const C=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=C,S.track._originMediaStreamTrack=C,await new dt((P,N)=>{this.handleReplaceTrack(S.track,P,N,!0)})}}o()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new Q9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Vs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Vn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&Kp(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&Vn().supportPCSetConfiguration&&xL(),this.shouldForwardP2PCreation&&(this.connection=EP(this.store),this.emit(Lt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=qn.New,this._forceTurn=$9(e),L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=EP(this.store,e),this.emit(Lt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new xe(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?ef.FIRST_CONNECTION:ef.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new xe(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");oe("ENABLE_PREALLOC_PC")&&this.state===qn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=qn.Connected)}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return st(u=[Ke.LocalVideoLowTrack,Ke.LocalVideoTrack]).call(u,h)}),i=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Sh){if(It.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!st(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>st(e).call(e,u));c&&(this.store.codec=c,L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof Sh&&this.connection.peerConnectionState!=="closed"&&st(e=[qn.New,qn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==qn.Connected){if(this.state===qn.Disconnected)throw new xe(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;st(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,r,i){var o=this;return Sl(function*(){const c=yield kn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&st(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==qn.Connected||h){if(o.state===qn.Disconnected)throw new xe(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(E=>o.pendingLocalTracks.indexOf(E)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Bs.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,r,i);if(m.length===0)return void(yield kn(o.tryToUnmuteAudio(e)));yield*yA(nH(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,r){var i=this;return Sl(function*(){r.forEach(P=>{let{track:N,type:G}=P;const V=Date.now();i.store.publish(N.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",V)}),i.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:N}=P;return N}),c=yield kn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield kn(c.next())).value,h=i.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===te.WS_ABORT&&r.forEach(N=>{let{track:G}=N;i.pendingLocalTracks.indexOf(G)===-1&&i.pendingLocalTracks.push(G)}),i.unbindLocalTrackEvents(r),P}const _=i.mapPubResToRemoteConfig(h,m,o),E=(yield kn(c.next(_))).value;if(i.state===qn.Disconnected)throw new xe(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const S=oe("ENABLE_ENCODED_TRANSFORM"),C=oe("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const N=P.getRTCRtpTransceiver();if(!N||!S)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:V}=hP();P.trackMediaType===gt.VIDEO?await G(N.sender,P):P.trackMediaType===gt.AUDIO&&await V(N.sender,{metadata:C?()=>{const j=P.metadata.shift();return j&&j.value}:void 0})}),r.forEach(P=>{let{type:N}=P;i.statsCollector.addLocalStats(N)}),i.assignLocalTracks(r,E),i.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:N,type:G}=P;const V=Date.now();i.store.publish(N.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",void 0,V)})})()}async updateVideoStreamParameter(e,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof vr))return L.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=Lx(u,h)),m.maxFramerate=u.framerate?pc(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==Ke.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return L.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=pc(m.width)),m.height&&(_.height=pc(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=lx(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},pc(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),L.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return Sl(function*(){if(!r.connection||r.state!==qn.Connected)return;const i=yield kn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ke.LocalVideoTrack);if(!c)throw new xe(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ke.LocalVideoLowTrack))throw new xe(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,e),type:Ke.LocalVideoLowTrack}];if(yield*yA(nH(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get(Ke.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield kn(r.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ps(this,Lt.RequestRePublish,this.pendingLocalTracks),this.emit(Lt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(L.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ps(this,Lt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:o}=this.pendingRemoteTracks[r];(o!==gt.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==gt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await Ps(this,Lt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===gt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(Lt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==qn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==qn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==qn.Connected)return;const e=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[Ke.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const i=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,r){if(!this.connection||this.state!==qn.Connected)throw new xe(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,r,i,o,c){var u;if(!this.connection||this.state!==qn.Connected)throw new xe(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(r))return;let h,m,_;const E=this.connection.getPreMedia(i);if(E)L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=E.transceiver,h=E.track,m=E.id;else if(c){const P=c.find(G=>{let{stream_type:V}=G;return V===r});if(!P)throw new xe(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const N=await this.connection.receive(r,P.ssrcs,String(e._uintid),P.attributes);this.connection instanceof Sh&&(_=N.transceiver),h=N.track,m=N.id}else{const P=await this.connection.receive(r,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof Sh&&(_=P.transceiver),h=P.track,m=P.id}if(r===gt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Gv(h,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new zv(h,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:N}=hP();r==gt.VIDEO?await P(_.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(G=>{var V;return(V=e._videoTrack)===null||V===void 0?void 0:V._onSei(G)})}):r==gt.AUDIO&&await N(_.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(Lt.AudioMetadata,G)}})}const S=this.remoteUserMap.get(e);S?S.set(r,m):this.remoteUserMap.set(e,new Map([[r,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const C=this.pendingRemoteTracks.findIndex(P=>{let{user:N,kind:G}=P;return N.uid===e.uid&&r===G});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(Lt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==qn.Connected)throw new xe(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=i.get(h);if(!m)return void L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:E,transceiver:S}=m;if(S&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=hP();u==gt.VIDEO?await N(S.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(V=>{var j;return(j=c._videoTrack)===null||j===void 0?void 0:j._onSei(V)})}):u==gt.AUDIO&&await G(S.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:V=>{this.safeEmit(Lt.AudioMetadata,V)}})}if(u===gt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new Gv(_,c.uid,c._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new zv(_,c.uid,c._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=hP();u==gt.VIDEO?await N(S.receiver,{onSei:V=>{var j;(j=c._videoTrack)===null||j===void 0||j._onSei(V)}}):u==gt.AUDIO&&await G(S.receiver)}const C=this.remoteUserMap.get(c);C?C.set(u,E):this.remoteUserMap.set(c,new Map([[u,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(N=>{let{user:G,kind:V}=N;return G.uid===c.uid&&u===V});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(Lt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return r!==void 0?m.uid===e.uid&&r===_:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===qn.Connected||i||o.forEach(h=>{let{kind:m}=h;var _;if(m===gt.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===gt.VIDEO){var E;(E=e._videoTrack)===null||E===void 0||E._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==qn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var E,S;if(_===gt.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===gt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===gt.AUDIO){var C;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((C=m._audioTrack)===null||C===void 0||C._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,r);if(i.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:E}=m;return u!==void 0?_.uid===c.uid&&u===E:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),r=r.concat(h)}if(!this.connection||this.state!==qn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===gt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===gt.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=sc(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===gt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===gt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===gt.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),(E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==qn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get(Ke.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof ki){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ke.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ke.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ke.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=o?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);It.publish(this.store.sessionId,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Hr),m=o?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof vr);It.publish(this.store.sessionId,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===gt.VIDEO?i._videoSSRC:i._audioSSRC;c&&It.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Bs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Vs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=EP(this.store),this.emit(Lt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ke.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ki){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=qn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ke.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ke.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof vr||r&&r.track instanceof Hr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(Gc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=eT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=qn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=EP(this.store),this.emit(Lt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case Ke.LocalVideoTrack:st(r=o._hints).call(r,hr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ke.LocalAudioTrack:o instanceof ki?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ke.LocalVideoLowTrack:}}),this.emit(Lt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Gc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Lt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Gc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof jm?e.uid:e)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof jm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return Sl(function*(){if(!r.connection||r.state!==qn.Connected)return;const i=yield kn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield kn(r.connection.restartICE(e));const u=yield kn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(Jx(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case js.UDP_TCP_RELAY:r._pcStatsUploadType=ef.UDP_TCP_RESTART;break;case js.TCP_RELAY:r._pcStatsUploadType=ef.TCP_RESTART;break;case js.RELAY:r._pcStatsUploadType=ef.RELAY_RESTART;break;default:r._pcStatsUploadType=ef.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),i=this.localTrackMap.get(Ke.LocalAudioTrack),o=e.videoSend.find(N=>N.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=e.audioSend.find(N=>N.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Wc(this,Lt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,E=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,C=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(hr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=e.bitrate.actualEncoded;if(N&&G){const V=(1e3*N-G)/(1e3*N);return MG[V<.15?0:V<.3?1:V<.45?2:V<.6?3:4][C]}}return C}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(G=>G.ssrc===c),m=e.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const _=Wc(this,Lt.NeedSignalRTT),E=e.rtt,S=(E&&_?(E+_)/2:E||_)||0,C=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let N=.7*P*100/50+.3*S/1500;C&&(N=.6*P*100/50+.2*S/1500+.2*C/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new dt((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}async replaceTrack(e,r){var i;if(L.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==qn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ke.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new dt((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,r,i){const o=[],c=this.getAllTracks();e=Ov(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get(Ke.LocalAudioTrack);for(const _ of e){if(_ instanceof vr&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new xe(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ke.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(_,i);o.push({track:E,type:Ke.LocalVideoLowTrack})}if(_ instanceof Hr)if(m){const E=m.track;if(E instanceof ki)Yx([_]),E.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=Xx([E,_]);L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(E,S)}}else u instanceof ki?(Yx([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&Vn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=Xx(u?[_,u]:[_]):u=_}return u&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Ke.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=Ov(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Hr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof ki?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(o instanceof vr){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(e){return e=(e=Ov(e)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ov(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ke.LocalVideoTrack:i.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Et.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof ki?e.trackList.forEach(i=>{i.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ke.LocalVideoTrack:i.off(Et.GET_STATS,this.handleGetLocalVideoStats),i.off(Et.GET_RTC_STATS,this.handleGetRTCStats),i.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ki?e.trackList.forEach(r=>{r.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Et.GET_STATS,this.handleGetLocalAudioStats),r.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Et.GET_STATS,this.handleGetLocalAudioStats),e.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof zv&&r.addListener(Et.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof Gv&&r.addListener(Et.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,h,{track:m,type:_}=i;switch(_){case Ke.LocalAudioTrack:u=Yn.Audio,h={dtx:m instanceof HA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ke.LocalVideoTrack:u=st(c=m._hints).call(c,hr.SCREEN_TRACK)?Yn.Screen:Yn.High,h=Th(Th({},e9(m)),{},{codec:this.store.codec,svc_mode:aP()});break;case Ke.LocalVideoLowTrack:u=Yn.Low,h=Th(Th({},e9(m)),{},{codec:this.store.codec,svc_mode:aP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalAudioTrack:o=Yn.Audio;break;case Ke.LocalVideoLowTrack:o=Yn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Lt.PeerConnectionStateChange,r),r==="connecting"&&e instanceof Sh&&!Vr()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Sh&&Z9(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=ef.DISCONNECTED_OR_FAILED,Wc(this,Lt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));It.reportApiInvoke(this.store.sessionId,{name:wi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:jr.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&e instanceof Sh&&!Vr()&&!this._forceTurn){if(st(KG).call(KG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{Jx(e)&&(L.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Wc(this,Lt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Lt.RequestRestartICE,c))},o=()=>{Jx(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),L.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Lt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{eH(e,i,o)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&Wc(this,Lt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Lt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Lt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Lt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),It.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:jr.TRACER}).onSuccess(),this.emit(Lt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(Gc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Vv.FIRST_FRAME_DECODED),It.firstRemoteFrame(this.store.sessionId,Hi.FIRST_AUDIO_DECODE,Or.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(Gc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&It.firstRemoteFrame(this.store.sessionId,Hi.FIRST_AUDIO_RECEIVED,Or.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(Gc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&It.firstRemoteFrame(this.store.sessionId,Hi.FIRST_VIDEO_RECEIVED,Or.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(Lt.ConnectionTypeChange,o),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Um(i))," -> ").concat(JSON.stringify(Um(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Um(i))," -> ").concat(JSON.stringify(Um(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Th(Th({},r),i)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof Sh&&function(r){rS.delete(r.id),Z9(r)}(e),e.close(),this.emit(Lt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get(Ke.LocalAudioTrack);if(e instanceof Hr&&(i==null?void 0:i.track)instanceof ki)return i.track.isActive||r.push([Ke.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get(Ke.LocalAudioTrack);if(e instanceof Hr&&(i==null?void 0:i.track)instanceof ki)return i.track.isActive&&r.push([Ke.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ke.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=Yn.Audio;break;case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:o=Yn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=Yn.Audio;break;case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:o=Yn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,r){const i=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(r.has(o)){let u=r.get(o);c===gt.VIDEO?u|=$i.Video:u|=$i.Audio,r.set(o,u)}else c===gt.VIDEO?r.set(o,$i.Video):r.set(o,$i.Audio)}),{users:Array.from(r.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Ke.LocalVideoTrack),i=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new dt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new dt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(_=>{let{stream_type:E}=_;return h===E}))===null||u===void 0?void 0:u.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(st(_).call(_,hr.SCREEN_TRACK)||st(_).call(_,hr.SCREEN_LOW_TRACK))&&(m.remb=!1,L.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Hr){var r;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await ur(this,Lt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(Lt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(Lt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await hs(zL(this.dtlsFailedCount,Ci)),this.emit(Lt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await Ps(this,Lt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Lt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof vr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof vr).length>1)throw new xe(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Hr).length>1&&(e.some(r=>r instanceof Hr&&r._bypassWebAudio)||!Vn().webAudioMediaStreamDest))throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof vr&&this.pendingLocalTracks.some(i=>i instanceof vr))throw new xe(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Hr&&this.pendingLocalTracks.some(i=>i instanceof Hr)&&(!Vn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Hr&&i._bypassWebAudio)))throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var i;const o=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding,c=Th(Th({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?e._mediaStreamTrack.clone():Qx(e,c);const h=dr(8,"track-low-"),m=new vr(u,Th(Th({},o&&{scaleResolutionDownBy:Lx(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(L_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,Mv.LOW_STREAM)}),m._hints.push(hr.LOW_STREAM),st(i=e._hints).call(i,hr.SCREEN_TRACK)&&m._hints.push(hr.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(Et.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Sh){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:S,peerConnectionState:C}=this.connection,{local:P,remote:N}=await this.connection.getSelectedCandidatePair();It.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:E,dtlsstate:S,connectionstate:C,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=N.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=N.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(Gc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");It.firstRemoteVideoDecode(this.store.sessionId,Hi.FIRST_VIDEO_DECODE,Or.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===Ke.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Mv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},St(fn.prototype,"startP2PConnection",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"startP2PConnection"),fn.prototype),St(fn.prototype,"connect",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"connect"),fn.prototype),St(fn.prototype,"updateRemoteRTPCapabilities",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"updateRemoteRTPCapabilities"),fn.prototype),St(fn.prototype,"publishDataChannel",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"publishDataChannel"),fn.prototype),St(fn.prototype,"unpublish",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"unpublish"),fn.prototype),St(fn.prototype,"unpublishDataChannel",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"unpublishDataChannel"),fn.prototype),St(fn.prototype,"unpublishLowStream",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"unpublishLowStream"),fn.prototype),St(fn.prototype,"subscribeDataChannel",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"subscribeDataChannel"),fn.prototype),St(fn.prototype,"subscribe",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"subscribe"),fn.prototype),St(fn.prototype,"massSubscribe",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"massSubscribe"),fn.prototype),St(fn.prototype,"unsubscribe",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"unsubscribe"),fn.prototype),St(fn.prototype,"unsubscribeDataChannel",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"unsubscribeDataChannel"),fn.prototype),St(fn.prototype,"massUnsubscribe",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"massUnsubscribe"),fn.prototype),St(fn.prototype,"muteRemote",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"muteRemote"),fn.prototype),St(fn.prototype,"unmuteRemote",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"unmuteRemote"),fn.prototype),St(fn.prototype,"hasRemoteMediaWithLock",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"hasRemoteMediaWithLock"),fn.prototype),St(fn.prototype,"disconnectForReconnect",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"disconnectForReconnect"),fn.prototype),St(fn.prototype,"updateBitrateLimit",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"updateBitrateLimit"),fn.prototype),St(fn.prototype,"remoteMediaSsrcChanged",[ho],Object.getOwnPropertyDescriptor(fn.prototype,"remoteMediaSsrcChanged"),fn.prototype),fn);function ho(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function rH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function iH(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?rH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Jme=Date.now(),Qme=20,e2=new Map,CP=new Map;async function sH(e){const r=e2.get(e),i=Array.isArray(r)&&r[r.length-1],o=CP.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(r.pop(),oH(i.context,c),m=0):m=Math.min(m,Qme),setTimeout(()=>r.length&&sH(e),m)}function oH(e,r){e.safeEmit(_n.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function Zme(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return oH(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=e2.get(o)||[],u=c.findIndex(E=>e.sendTs>=E.sendTs),h=iH(iH({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),e2.set(o,c);let m=!1;var _;CP.has(o)?m=!((_=CP.get(o))===null||_===void 0||!_.isSyncing):CP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||sH(o)}const ege=Nn().name;function aH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function cH(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?aH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):aH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const iS="websdk_ng_cache_parameter",tge=oe("MAX_PRELOAD_ASYNC_LENGTH"),nge=1e4,K_=new Map,q_=[];let t2=null,n2=0,r2=0;const RP=new Map,rge=function(e,r){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new dt(async(_,E)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){E(S)}}),o<r&&(o++,c())})}}(lH,tge),i2=ia.CancelToken.source();async function lH(e,r,i,o,c,u){try{if(!oe("ENABLE_PRELOAD"))return;if(!Vn().supportWebCrypto)return void km(()=>{L.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new xe(te.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&ds(i,"token",1,2047),ds(e,"appid",1,2047),nP(r),o&&rP(o);const h=N_();L.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:e,cname:r,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,E;typeof o=="string"?(m.stringUid=o,[E,_]=await dt.all([Fme(o,{sid:h,appId:e},i2.token),k9(cH(cH({},m),{},{token:i||e,uid:0}),i2.token)]),m.uid=E.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await k9(m,i2.token));const S={sid:h,appId:e,cname:r,token:i||e,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:_};await async function(C){let P;try{C.uid&&dH({appId:C.appId,cname:C.cname,token:C.token,uid:C.uid,stringUid:C.stringUid});const N=mH(C),G=await async function(j,Y){try{const Z=await window.crypto.subtle.importKey("raw",tW(Y),"AES-GCM",!1,["encrypt"]),de=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Z,k_(window.btoa(JSON.stringify(j))));return Nm(new Uint8Array(de))}catch{return}}(C,C.token||C.appId);if(!G)return;P=fH(iS);const V=P?JSON.parse(P):[];V.push({[N]:G}),V.length>oe("AP_CACHE_NUM")&&V.shift(),IP(iS,JSON.stringify(V))}catch(N){L.warn("Error caching server parameters:",N.message),IP(iS,"")}}(S),n2++}catch(h){throw r2++,function(m){t2||(t2=window.setTimeout(()=>{let E="";RP.forEach((S,C)=>{E+="".concat(C,": ").concat(S," ;")}),It.reportApiInvoke(null,{name:wi.PRELOAD,options:{success:n2,failed:r2,err:E}}).onError(m),n2=0,r2=0,RP.clear(),t2=null},nge));const _=RP.get(m.code)||0;RP.set(m.code,_+1)}(h),h}}async function uH(e){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=dH(e);if(!r||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",tW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,k_(o));return JSON.parse(window.atob(Nm(new Uint8Array(h))))}catch{return}}(r,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<oe("AP_CACHE_LIFETIME"))return i}catch(r){L.warn("Error get preloadInfo",r.message)}}function dH(e){let r;try{if(r=fH(iS),!r)return;const i=JSON.parse(r),o=mH(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return IP(iS,JSON.stringify(i)),u[o]}catch(i){L.warn("Error delete preload info: ".concat(r),i.message),IP(iS,"")}}function s2(e){if(e){let r=K_.get(e);r&&(window.clearTimeout(r),r=null,K_.delete(e)),st(q_).call(q_,e)||e.cloudProxyServer!=="disabled"||q_.push(e)}if(K_.size<oe("AP_CACHE_NUM")&&q_.length>0){const r=q_.shift();K_.set(r,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await rge(i,o,c,h,m,u),K_.has(r)&&s2(r)}catch(_){L.warn("update preload failed",_.message),hH(r)}},oe("AP_UPDATE_INTERVAL")))}}function hH(e){const r=q_.indexOf(e);r!==-1&&q_.splice(r,1);let i=K_.get(e);i&&(window.clearTimeout(i),i=null,K_.delete(e),s2())}function pH(e,r){const i=e.sua,o=e.ap;r&&i&&It.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:e.intUid,errorCode:null,extend:i.req}),It.reportResourceTiming(e.ap.url,e.sid),It.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[mi.CHOOSE_SERVER,mi.CLOUD_PROXY_FALLBACK].toString()}),It.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function fH(e){return window.atob(window.localStorage.getItem(e)||"")}function IP(e,r){window.localStorage.setItem(e,window.btoa(r))}function mH(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),cW(r)}function ige(e){let r=function(){const i=age.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(yi(o,10),Wm(o,c));let u=i.cid;u!==void 0&&(yi(o,16),yi(o,u));let h=i.cname;h!==void 0&&(yi(o,26),Wm(o,h));let m=i.deviceId;m!==void 0&&(yi(o,34),Wm(o,m));let _=i.elapse;_!==void 0&&(yi(o,40),zm(o,_));let E=i.fileSize;E!==void 0&&(yi(o,48),zm(o,sS(E)));let S=i.height;S!==void 0&&(yi(o,56),zm(o,sS(S)));let C=i.jpg;C!==void 0&&(yi(o,66),yi(o,C.length),_H(o,C));let P=i.networkType;P!==void 0&&(yi(o,72),zm(o,sS(P)));let N=i.osType;N!==void 0&&(yi(o,80),zm(o,sS(N)));let G=i.requestId;G!==void 0&&(yi(o,90),Wm(o,G));let V=i.sdkVersion;V!==void 0&&(yi(o,98),Wm(o,V));let j=i.sequence;j!==void 0&&(yi(o,104),zm(o,sS(j)));let Y=i.sid;Y!==void 0&&(yi(o,114),Wm(o,Y));let Z=i.timestamp;Z!==void 0&&(yi(o,120),zm(o,Z));let de=i.uid;de!==void 0&&(yi(o,128),yi(o,de));let Se=i.vid;Se!==void 0&&(yi(o,136),yi(o,Se));let Te=i.width;Te!==void 0&&(yi(o,144),zm(o,sS(Te)));let ye=i.service;ye!==void 0&&(yi(o,152),yi(o,ye));let Ne=i.callbackData;Ne!==void 0&&(yi(o,162),yi(o,Ne.length),_H(o,Ne));let Ye=i.ticket;Ye!==void 0&&(yi(o,170),Wm(o,Ye));let ht=i.vendorConfigs;ht!==void 0&&(yi(o,178),Wm(o,ht))}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function sge(e){return function(i){let o={};e:for(;!cge(i);){let c=UT(i);switch(c>>>3){case 0:break e;case 1:o.code=UT(i);break;case 2:o.msg=yH(i,UT(i));break;case 3:o.requestId=yH(i,UT(i));break;case 4:o.timestamp=lge(i,!1);break;default:oge(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function oge(e,r){switch(r){case 0:for(;128&yu(e););break;case 2:o2(e,UT(e));break;case 5:o2(e,4);break;case 1:o2(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function sS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let age=[];function o2(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function cge(e){return e.offset>=e.limit}function AP(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function gH(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function _H(e,r){let i=AP(e,r.length);e.bytes.set(r,i)}function yH(e,r){let i=gH(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,E,S,C,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(C=(31&P)<<6|63&_,C<128?h+=u:(h+=o(C),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],E=c[m+i+2],(49344&(_|E<<8))!=32896?h+=u:(C=(15&P)<<12|(63&_)<<6|63&E,C<2048||C>=55296&&C<=57343?h+=u:(h+=o(C),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],E=c[m+i+2],S=c[m+i+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(C=(7&P)<<18|(63&_)<<12|(63&E)<<6|63&S,C<65536||C>1114111?h+=u:(C-=65536,h+=o(55296+(C>>10),56320+(1023&C)),m+=3))):h+=u}return h}function Wm(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}yi(e,o);let c=AP(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function yu(e){return e.bytes[gH(e,1)]}function EH(e,r){let i=AP(e,1);e.bytes[i]=r}function UT(e){let r,i=0,o=0;do r=yu(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function yi(e,r){for(r>>>=0;r>=128;)EH(e,127&r|128),r>>>=7;EH(e,r)}function lge(e,r){let i,o=0,c=0,u=0;return i=yu(e),o=127&i,128&i&&(i=yu(e),o|=(127&i)<<7,128&i&&(i=yu(e),o|=(127&i)<<14,128&i&&(i=yu(e),o|=(127&i)<<21,128&i&&(i=yu(e),c=127&i,128&i&&(i=yu(e),c|=(127&i)<<7,128&i&&(i=yu(e),c|=(127&i)<<14,128&i&&(i=yu(e),c|=(127&i)<<21,128&i&&(i=yu(e),u=127&i,128&i&&(i=yu(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function zm(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=AP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const vH={},SH={},PP=4294967296,uge=PP*PP,dge=uge/2;TH(0,!0);const bH=TH(0),hge=VT(0,-2147483648,!1),pge=VT(-1,2147483647,!1);function TH(e,r){let i,o,c;return r?(c=0<=(e>>>=0)&&e<256)&&(o=SH[e],o)?o:(i=VT(e,0,!0),c&&(SH[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=vH[e],o)?o:(i=VT(e,e<0?-1:0,!1),c&&(vH[e]=i),i)}function VT(e,r,i){return{low:0|e,high:0|r,unsigned:!!i}}function wH(e,r){if(isNaN(e))return bH;{if(e<=-9223372036854776e3)return hge;if(e+1>=dge)return pge}return e<0?bH:VT(e%PP|0,e/PP|0,r)}function CH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class a2 extends Lr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(yd.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",Cl.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",ia.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==Cl.CONNECTED)throw new Oe(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Cl.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=dr(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new IT("worker-"+this._moderationId,Ci),this.on(yd.STATE_CHANGE,(o,c)=>{L.debug("[".concat(this._moderationId,"] Moderation operation :").concat(qv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(yd.STATE_CHANGE,qv.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new dt((c,u)=>{this.on(yd.CONNECTION_STATE_CHANGE,(h,m)=>{h===Cl.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),L.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Cl.CONNECTED&&this.inspectImage()}async requestAP(r,i,o){const c=oe("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,E,S,C){let{appId:P,areaCode:N,cname:G,sid:V,token:j,uid:Y}=E;eS++;const Z="moderation_plugin",de={service_name:Z,json_body:JSON.stringify({appId:P,areaCode:N,cname:G,command:"allocateEdge",requestId:eS,seq:eS,sid:V,appToken:j,ts:Date.now(),uid:Y+""})};let Se,Te,ye=_[0];return fd(async()=>{Se=Date.now();const Ne=await Ed(ye,{data:de,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Te=Date.now()-Se,Ne.code!==0){const ft=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:Te});throw L.error(ft.toString()),ft}const Ye=JSON.parse(Ne.json_body);if(Ye.code!==200){const ft=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ye.code,", reason: ").concat(Ye.reason),{code:Ye.code,responseTime:Te});throw L.error(ft.toString()),ft}if(!Ye.servers||!Array.isArray(Ye.servers)||Ye.servers.length===0){const ft=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ye.code,responseTime:Te});throw L.error(ft.toString()),ft}if(!Ye.servers.some(ft=>!!ft.wss)){const ft=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ye.code,responseTime:Te});throw L.error(ft.toString()),ft}const ht=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ye.servers.map(ft=>{let{address:Sn,wss:bn}=ft;if(Sn&&bn)return"wss://".concat(Sn.replace(/\./g,"-"),".").concat(ht,":").concat(bn,"/moderation")}).filter(ft=>!!ft),workerToken:Ye.workerToken,vid:Ye.vid,ticket:Ye.appTicket,responseTime:Te}},(Ne,Ye)=>(It.apworkerEvent(V,{success:!0,sc:200,serviceName:Z,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Ye===0,responseTime:Te,serverIp:_[Ye%_.length]}),!1),(Ne,Ye)=>(It.apworkerEvent(V,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:Z,responseTime:Te,serverIp:_[Ye%_.length]}),!!(Ne.code!==te.OPERATION_ABORTED&&Ne.code!==te.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(ye=_[(Ye+1)%_.length],!0)),C)}(c,r,i,o);this.emit(yd.STATE_CHANGE,qv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(yd.STATE_CHANGE,qv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Zt.CONNECTED,async()=>{this.emit(yd.STATE_CHANGE,qv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Cl.CONNECTED}),this._workerConnection.on(Zt.CLOSED,()=>{this.connectionState=Cl.CLOSED}),this._workerConnection.on(Zt.FAILED,()=>{this.connectionState=Cl.CLOSED}),this._workerConnection.on(Zt.RECONNECTING,()=>{this.connectionState=this.connectionState===Cl.CONNECTED?Cl.RECONNECTING:Cl.CONNECTING}),this._workerConnection.on(Zt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=sge(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,L.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{It.reportApiInvoke(this._connectInfo.sid||null,{name:wi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:jr.TRACER}).onError(new Oe(te.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else L.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Zt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(Zt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Wc(this,yd.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,i);this._workerConnection.sendMessage(o,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),C=await JW(S,o,c),P=this._sequence+"-"+u+"-"+_+"-"+E+"-"+dr(12,""),N={appId:o,cid:u,cname:c,deviceId:"",elapse:a2.intToLong(Number(E-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:C,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:wH(E),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const G=ige(N);if(G.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const V=function(j){for(var Y=1;Y<arguments.length;Y++){var Z=arguments[Y]!=null?arguments[Y]:{};Y%2?CH(Object(Z),!0).forEach(function(de){K(j,de,Z[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(Z)):CH(Object(Z)).forEach(function(de){Object.defineProperty(j,de,Object.getOwnPropertyDescriptor(Z,de))})}return j}({},N);delete V.jpg,L.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(V))}return G}{const V=this.quality*this._qualityRatio;return this.quality=V,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ia.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Cl.CLOSED,this.emit(yd.STATE_CHANGE,qv.CLOSED)}}function RH(e){if(ir(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Oe(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Oe(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fge={name:"ImageModeration",create:function(e){let{config:r}=e;return RH(r),new a2(r)}};var IH,AH,PH,OH,kH,NH,DH,LH,xH,MH,UH,VH,FH,jH,BH,WH,zH,GH,HH,$H,KH,qH,YH,XH,JH,QH,ZH,e7,t7,n7,r7,i7,s7,o7,a7,c7,l7,u7,d7,h7,p7,pt;function f7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Eu(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?f7(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}Vs.setLogger(L);let mge=(IH=Ft(),AH=Ft({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof jv))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),PH=Ft({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Fv.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),OH=Ft({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),kH=Ft({argsMap:(e,r,i)=>[r,i]}),NH=Ft({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),DH=Ft({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),LH=Ft({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),xH=Ft(),MH=Ft(),UH=Ft(),VH=Ft(),FH=Ft(),jH=Ft(),BH=Ft(),WH=Ft(),zH=Ft(),GH=Ft(),HH=Ft(),$H=Ft(),KH=Ft(),qH=Ft(),YH=Ft(),XH=Ft({argsMap:(e,r)=>[r]}),JH=Ft(),QH=Ft(),ZH=Ft(),e7=Ft(),t7=Ft(),n7=Ft(),r7=Ft(),i7=Ft(),s7=Ft({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),o7=Ft(),a7=Ft(),c7=Ft(),l7=Ft(),u7=Ft(),d7=Ft(),h7=Ft({reportResult:!0}),p7=Ft(),pt=class extends Lr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let i;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",ia.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&j_(c.uid,this.channelName))return void L.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&L.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(_n.USER_JOINED,u));else{const h=new jm(c.uid,c.uint_id||c.uid);this._users.push(h),L.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(_n.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&j_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:kA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),L.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(_n.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,E,S)=>{if(oe("BLOCK_LOCAL_CLIENT")&&j_(u,this.channelName))return;const C=this._users.find(N=>N.uid===u);if(!C)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(C.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?C.hasAudio:C.hasVideo;C._uintid||(C._uintid=_||u),c==="audio"?C._trust_audio_stream_added_state_=!0:C._trust_video_stream_added_state_=!0,c==="audio"?(C._audio_added_=!0,h!==void 0&&(C._audioSSRC=h),m!==void 0&&(C._cname=m),E&&(C._audioOrtc=E)):(C._video_added_=!0,h!==void 0&&(C._videoSSRC=h),m!==void 0&&(C._cname=m),S!==void 0&&(C._rtxSsrcId=S),E&&(C._videoOrtc=E)),(c==="audio"?C.hasAudio:C.hasVideo)&&!P&&(L.info("[".concat(this._clientId,"] remote user ").concat(C.uid," published ").concat(c)),this.safeEmit(_n.USER_PUBLISHED,C,c)),c==="video"?It.onGatewayStream(this._sessionId,Hi.ON_ADD_VIDEO_STREAM,Or.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:C._videoSSRC}):It.onGatewayStream(this._sessionId,Hi.ON_ADD_AUDIO_STREAM,Or.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:C._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(C,c,h).then(N=>{if(N&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(C.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof MT))return this._p2pChannel.unsubscribe(C,c,!0).then(()=>this._subscribe(C,c,!0).catch(G=>{L.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(C,c)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(C.uid," after reconnect.")),this._subscribe(C,c,!0).catch(N=>{L.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),K(this,"_handleRemoveStream",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&j_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));L.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(_n.USER_UNPUBLISHED,u,"audio"),L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(_n.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(_n.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(_n.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof MT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),It.onGatewayStream(this._sessionId,Hi.ON_REMOVE_STREAM,Or.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&j_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void L.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));L.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const C=m._audio_enabled_?"enable-local-audio":"disable-local-audio";L.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(C)),this.safeEmit(_n.USER_INFO_UPDATED,u,C)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const C=m._video_enabled_?"enable-local-video":"disable-local-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(C)),this.safeEmit(_n.USER_INFO_UPDATED,u,C)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return _!==E?!_&&E?(L.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(_n.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),L.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(_n.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&j_(c,this.channelName))return;L.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const C=m._audio_muted_?"mute-audio":"unmute-audio";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(C)),this.safeEmit(_n.USER_INFO_UPDATED,c,C)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const C=m._video_muted_?"mute-video":"unmute-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(C)),this.safeEmit(_n.USER_INFO_UPDATED,c,C)}}const E=u==="audio"?m.hasAudio:m.hasVideo;if(_!==E){if(!_&&E)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(L.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(_n.USER_PUBLISHED,m,u)):void L.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),L.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(_n.USER_UNPUBLISHED,m,u)}}),K(this,"_handleP2PLost",async c=>{L.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():L.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{L.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),L.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(_n.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(_n.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!E&&(L.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(_n.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{L.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=r||dr(5,"client-"),this.store=new class{constructor(c,u,h,m){qt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:D_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case yn.SET_SESSION_ID:return mt(mt({},u),{},{sessionId:h.sessionId});case yn.SET_P2P_ID:return mt(mt({},u),{},{p2pId:h.p2pId});case yn.SET_UID:return mt(mt({},u),{},{uid:h.uid});case yn.SET_INT_UID:return mt(mt({},u),{},{intUid:h.intUid});case yn.SET_PUB_ID:return mt(mt({},u),{},{pubId:h.pubId});case yn.KEY_METRIC_CLIENT_CREATED:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{clientCreated:h.metric})});case yn.KEY_METRIC_JOIN_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinStart:h.metric})});case yn.AVOID_JOIN_START:return mt(mt({},u),{},{avoidJoinStart:h.avoidJoinStart});case yn.KEY_METRIC_JOIN_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinEnd:h.metric})});case yn.KEY_METRIC_REQUEST_AP_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPStart:h.metric})});case yn.KEY_METRIC_REQUEST_AP_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case yn.KEY_METRIC_JOIN_GATEWAY_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case yn.KEY_METRIC_JOIN_GATEWAY_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case yn.KEY_METRIC_PEER_CONNECTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case yn.KEY_METRIC_PEER_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case yn.KEY_METRIC_DESCRIPTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{descriptionStart:h.metric})});case yn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case yn.KEY_METRIC_ICE_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case yn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(E=>E.trackId===h.metric.trackId);return _!==-1?(m[_]=mt(mt({},m[_]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case yn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return _!==-1?(m[_]=mt(mt({},m[_]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case yn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case yn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=mt(mt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case yn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case yn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case yn.SET_USE_P2P:return mt(mt({},u),{},{useP2P:h.val});case yn.SET_TRANSPORT_TYPE:return mt(mt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:yn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:yn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:yn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:yn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:yn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:yn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:yn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:yn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:yn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:yn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:yn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:yn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:yn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:yn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:yn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:yn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:yn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:yn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:yn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:yn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:yn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:yn.KEY_METRIC_PUBLISH,metric:mt(mt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,E,S){this.dispatch({type:yn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt(mt(mt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),E&&{streamAdded:E}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:yn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:yn.RECORD_JOIN_CHANNEL_SERVICE,record:mt(mt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:yn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:yn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:yn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:yn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Vs("client-leave",this._clientId),this._publishMutex=new Vs("client-publish",this._clientId),this._renewTokenMutex=new Vs("client-renewtoken",this._clientId),this._subscribeMutex=new Vs("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),L.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(bl," build: ").concat(ZL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{jL(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){L.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new LT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{L.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(_n.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(E=>E.uid===c);_&&It.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Dme(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Ci,httpRetryConfig:e.httpRetryConfig||Ci,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new zme(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},tf("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new MT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];tr("JOIN_GATEWAY_USE_443PORT_ONLY",u),tr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof Nx&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,E,S){RA.get(_)||RA.set(_,[]),IA.get(_)||IA.set(_,E),ph.get(_)||ph.set(_,0);const C=RA.get(_),P=IA.get(_);if(!C||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ph.get(_)===P){const Y=dT();C.push(Y),await Y.promise}ph.set(_,ph.get(_)+1);for(var N=arguments.length,G=new Array(N>3?N-3:0),V=3;V<N;V++)G[V-3]=arguments[V];const j=await S(...G);return ph.set(_,ph.get(_)-1),ph.get(_)===P-1&&C.length>0&&(C[0].resolve(),C.shift()),ph.get(_)===0&&(RA.set(_,[]),IA.set(_,0),ph.set(_,0)),j}("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,i,o,c)}async join(e,r,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(LA||LA||(LA=(window.location.protocol.split(":")[0]||"").toUpperCase(),LA))==="HTTPS",m=dW()?window.isSecureContext:"Browser Not Support";(!dW()&&!h||!window.isSecureContext)&&L.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),L.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),It.setAppId(e);try{if(!i&&i!==null)throw new Oe(te.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&ds(i,"token",1,2047),ds(e,"appid",1,2047),nP(r),o&&rP(o),c&&ds(c,"optionalInfo",1,2047)}catch(V){throw It.reportApiInvoke(N_(),{name:wi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:jr.TRACER}).onError(V),V}if(this._leaveMutex.isLocked&&(L.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),L.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const V=new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw It.reportApiInvoke(N_(),{name:wi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:jr.TRACER}).onError(V),V}this._gateway.state="CONNECTING";const _=await uH({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(_==null?void 0:_.sid)||N_();L.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const S=It.reportApiInvoke(E,{id:this._clientId,name:wi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:jr.TRACER}),C=Eu(Eu(Eu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(C.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(C.stringUid=o,this._uintUid?(C.uid=this._uintUid,this._uintUid=void 0):C.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(C.aesmode=this._encryptionMode,C.aespassword=await(async V=>{const j=function(Se){const Te=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ye=new Uint8Array(new ArrayBuffer(Te.length));for(let Ne=0;Ne<Te.length;Ne+=1)ye[Ne]=Te.charCodeAt(Ne);return ye}(),Y=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Z=VL(V),de=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,Z);return function(Se){let Te="";for(let ye=0;ye<Se.length;ye+=1)Te+=String.fromCharCode(Se[ye]);return window.btoa(Te)}(new Uint8Array(de))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(C.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const V=new TextEncoder,j=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?V.encode(C.appId+this._encryptionSecret+this._encryptionSecret):V.encode(C.appId+C.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,Z,de){const Se=await window.crypto.subtle.importKey("raw",Z,"PBKDF2",!1,["deriveBits","deriveKey"]),Te=Y==="aes-128-gcm2"?128:256,ye=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:SW,hash:"SHA-256",salt:de},Se,Te+lfe);return new Uint8Array(ye).subarray(Te/8)}(this._encryptionMode,j,k_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,Z,de){const Se=await window.crypto.subtle.importKey("raw",Z,"PBKDF2",!1,["deriveBits","deriveKey"]),Te=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:SW,hash:"SHA-256",salt:de},Se,{name:"AES-GCM",length:Te},!0,["encrypt","decrypt"])}(this._encryptionMode,j,k_(this._encryptionSalt))}else m?L.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):L.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,L.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:C.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&It.joinChannelTimeout(this._sessionId,5)},5e3);try{var N;let V;const j=C.cloudProxyServer;if(st(N=["proxy3","proxy4","proxy5"]).call(N,j)){const Te=oe("PROXY_SERVER_TYPE3");Array.isArray(Te)?C.proxyServer=Te[0]:C.proxyServer=Te}if(It.setProxyServer(C.proxyServer),L.setProxyServer(C.proxyServer),this.store.requestAPStart(),_){if(L.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(C.stringUid?", ".concat(C.stringUid," => ").concat(_.intUid):""," ")),C.stringUid&&!C.uid&&(C.uid=_.intUid),V={gatewayInfo:_.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&C.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Te=(await n9(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(ye=>({turnServerURL:ye.address,tcpport:ye.tcpport||Os.tcpport,udpport:ye.udpport||Os.udpport,username:ye.username||Os.username,password:ye.password||Os.password,forceturn:!1,security:!0}));C.turnServer={mode:"manual",servers:Te}}pH(_,C.stringUid)}else{if(C.stringUid&&!C.uid){let Te;[Te,V]=await dt.all([O9(C.stringUid,C,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci,this.store),P9(C,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci,!0,this.store)]),L.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(C.stringUid," => ").concat(Te)),C.uid=Te,V.gatewayInfo.uid=Te,V.gatewayInfo.res.uid=Te}else V=await P9(C,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(C,this._axiosCancelSource.token),this._configDistribute.on(CT.UPDATE_BITRATE_LIMIT,Te=>{this._p2pChannel.updateBitrateLimit(Te)}),this._configDistribute.on(CT.UPDATE_CLIENT_ROLE_OPTIONS,Te=>{this._setClientRoleOptions(Te)})},0),this._key=i||e;const Y=V.gatewayInfo,Z=C.uid?C.uid:Y.uid;this._joinInfo=Eu(Eu({},C),{},{cid:Y.cid,uid:Z,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=Z,this.store.cid=Y.cid;const de=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(de),this._appId=e,this._channelName=C.cname,this._uid=de,this.store.uid=de,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Is()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Se=C.stringUid?"string uid: ".concat(C.stringUid,",uid: ").concat(C.uid):"uid: ".concat(this._uid);return L.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(Se)),setTimeout(()=>{L.startUpload()},5e3),this.store.joinEnd(),G=this,st(F_).call(F_,G)||F_.push(G),this._cloudProxyServerMode==="disabled"&&Vn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&s2(this._joinInfo),de}catch(V){const j=Array.isArray(V)?V[0]:V;throw j&&j.code===te.OPERATION_ABORTED?L.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j):L.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j),j.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(j),j}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){L.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Is()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const i=F_.indexOf(r);i!==-1&&F_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return L.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Kn.LEAVE),L.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof jv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Oe(te.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new Oe(te.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof jv))throw new Oe(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}L.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof vr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),L.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw L.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){ir(e.id,"id",0,65535,!0),qp(e.ordered,"ordered"),ds(e.metadata,"metadata",0,512),L.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Oe(te.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return v9(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(te.CREATE_DATACHANNEL_ERROR);try{await dt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return L.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw L.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof jv))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);L.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(oi.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),L.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw L.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),L.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),L.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw L.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(e,r,i){if(!(e instanceof jm)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,r)}async presubscribe(e,r){if(Ui(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===gt.AUDIO,o=r===gt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:E}=await this._gateway.presubscribe(e,r,!0);if(u==null)throw new Oe(te.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===e);S||(S=new jm(e,E||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=E||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),L.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const C=i?S._audioTrack:S._videoTrack;if(!C)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),C}catch(u){throw L.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,r){var i;if(ir(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Oe(te.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===r);if(!c)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&st(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(te.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,r,i){if(Ui(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Oe(te.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const u=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const h=r==="audio"?e._audioSSRC:e._videoSSRC,m=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,h,m)}catch(h){throw h}L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,r,i){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(Ui(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===e)){const E=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),E}if(!e.hasAudio&&!e.hasVideo){const E=new Oe(te.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),E}if(!(i||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const E=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?e._audioSSRC:e._videoSSRC,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const S=r==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c}),Bs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(C){if((C==null?void 0:C.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),C;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,r),S}L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const E=r==="audio"?e._audioTrack:e._videoTrack;if(!E)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),E),E}finally{_()}}async massSubscribe(e){if(Yp(e,"subscribeList"),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,o=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:E}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(E)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:E}=m;return{user:_,mediaType:E}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const E=e[_],{user:S,mediaType:C}=E;if(Ui(C,"mediaType",["audio","video"]),!S){const V=new Oe(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),V}if(!this._users.find(V=>V===S)){const V=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");L.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=V,e.splice(_,1);continue}if(C==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||C==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const V=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);L.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(C,", remote user is not published")),c[_].error=V,e.splice(_,1);continue}const N=$i.Video|$i.LwoVideo,G=i.get(S);if(G){if(C==="video"?G&N:G&$i.Audio){e.splice(_,1),L.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(C," twice"));continue}i.set(S,G|(C==="video"?N:$i.Audio))}else i.set(S,C==="video"?N:$i.Audio)}for(let _=e.length-1;_>=0;_--){const E=e[_],{user:S,mediaType:C}=E,P=$i.Video|$i.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,C)){await this._p2pChannel.unmuteRemoteNoLock(S,C);const N=i.get(S);i.set(S,C==="video"?N^P:N^$i.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),r);let m=sc(h=Array.from(i.entries())).call(h,(_,E)=>{let[S,C]=E;if(C===0)return _;const P={stream_id:S.uid,stream_type:C};return C&$i.Audio&&(P.audio_ssrc=S._audioSSRC),C&$i.Video&&(P.video_ssrc=S._videoSSRC),_.push(P),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(E=>{let{user:S,mediaType:C}=E;return{user:S,mediaType:C,ssrcId:C===gt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:C===gt.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach(S=>{let{stream_id:C,video_error_code:P,audio_error_code:N,error_code:G}=S;(P||N||G)&&_.set(C,{video_error_code:P,audio_error_code:N,error_code:G})})}if(Array.from(_.entries()).length>0){const E=[];Array.from(_.entries()).forEach(S=>{let[C,P]=S;const N=this.remoteUsers.find(G=>G.uid===C);if(N){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=gt.VIDEO:P.audio_error_code&&(G=gt.AUDIO),E.push({user:N,mediaType:G})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const S=_.get(E.user.uid);if(S){const C=S.error_code||E.mediaType==="audio"&&S.audio_error_code||E.mediaType==="video"&&S.video_error_code;if(C){const P=RT(C);L.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(P.desc)),E.error=new Oe(te.SUBSCRIBE_FAILED,"code ".concat(C,": ").concat(P.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var S;It.subscribe(this.store.sessionId,{succ:!!E.error,ec:((S=E.error)===null||S===void 0?void 0:S.code)||null,video:E.mediaType===gt.VIDEO,audio:E.mediaType===gt.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===gt.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),L.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(E=>{let{user:S,mediaType:C}=E;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(C)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,r,i){if(!(e instanceof jm)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(r&&Ui(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const u=await this._p2pChannel.unsubscribe(e,r);u&&await this._gateway.unsubscribe(u,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&kA(this._users,e),L.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===te.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,r){if(r&&ir(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=e._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),c}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),L.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Yp(e,"unsubscribeList"),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");L.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const r=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const m=new Oe(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Ui(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){L.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=$i.Video|$i.LwoVideo;if(r.has(o)){const m=r.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&$i.Audio;break;default:_=m&($i.Audio|h)}if(_){L.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?r.set(o,m|$i.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|$i.Audio|h)}else c?c==="audio"?r.set(o,$i.Audio):c==="video"&&r.set(o,h):r.set(o,$i.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),L.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===te.DISCONNECT_P2P)return void L.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw L.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new xe(te.INVALID_PARAMS);Fr(i.width)||ML(i.width,"streamParameter.width"),Fr(i.height)||ML(i.height,"streamParameter.height"),Fr(i.framerate)||ML(i.framerate,"streamParameter.framerate"),Fr(i.bitrate)||ir(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&L.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),L.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ke.LocalVideoLowTrack)}async enableDualStream(){if(!Vn().supportDualStream)throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),L.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ke.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),L.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(o){Ui(o,"role",["audience","host"])}(e),r&&jL(r),this.mode==="rtc"||this.mode==="p2p")throw L.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new Oe(te.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",As.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),L.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&jL(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{L.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(ds(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,It.setProxyServer(this._proxyServer),L.setProxyServer(this._proxyServer),L.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy")}if(gT(e))return this._turnServer={servers:e,mode:"original-manual"},void L.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>Z8(i)),this._turnServer={servers:e,mode:"manual"},L.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"you should set license before join channel");if(ds(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Oe(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,L.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Oe(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new Oe(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Stop proxy server after leave channel");It.setProxyServer(),L.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Oe(te.INVALID_PARAMS,"accessPoints is required.");Yp(e.accessPoints.serverList,"accessPoints.serverList"),ds(e.accessPoints.domain,"accessPoints.domain");const r=(P,N)=>{ir(P,N,0,65535,!0)};let i=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(tr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),tr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,tr("WEBCS_DOMAIN",h),tr("WEBCS_DOMAIN_BACKUP_LIST",h),tr("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Yp(e.report.hostname,"report.hostname"),tr("EVENT_REPORT_DOMAIN",e.report.hostname[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(tr("EVENT_REPORT_DOMAIN",u[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),m=e.report.port),tr("STATS_COLLECTOR_PORT",m),e.report?tr("ENABLE_EVENT_REPORT",!0):tr("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Yp(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let E=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),E=e.log.port),tr("LOG_UPLOAD_SERVER","".concat(_,":").concat(E));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Yp(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let C=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),C=e.cds.port),tr("CDS_AP",S.map(P=>"".concat(P,":").concat(C))),e.cds?tr("ENABLE_CONFIG_DISTRIBUTE",!0):tr("ENABLE_CONFIG_DISTRIBUTE",!1),L.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(Yp(e,"serverList"),ds(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,tr("WEBCS_DOMAIN",e),tr("WEBCS_DOMAIN_BACKUP_LIST",e),tr("GATEWAY_DOMAINS",[r]),tr("EVENT_REPORT_DOMAIN",e[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),tr("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),L.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ui(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw L.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else L.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){Ui(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw L.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}L.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){Ui(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(i){throw L.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}L.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,i,o){(function(u){Ui(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ds(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(st(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new Oe(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new Oe(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(qp(o,"encryptDataStream"),!st(c).call(c,e))throw new Oe(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||L.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,i&&(this._encryptionSalt=Nm(i))}async renewToken(e){if(ds(e,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){L.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Wme(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci);L.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else L.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});L.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,L.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?L.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(_n.VOLUME_INDICATOR,e)},oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new Oe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Oe(te.LIVE_STREAMING_TASK_CONFLICT);const i=r?Qp.TRANSCODE:Qp.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Qp.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!r.length)throw new Oe(te.INVALID_PARAMS,"can not find live streaming url to stop");await dt.all(r.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){U9(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){U9(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof MT&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const _=sc(m=Array.from(h)).call(m,(V,j)=>V+j,0),E={serverTs:0,seq:ufe++,length:h.length,checkSum:_},S=new Uint8Array(aW(_,2)),C=new ArrayBuffer(Dv),P=new DataView(C);P.setUint32(0,E.serverTs),P.setUint16(4,E.seq),P.setUint16(6,E.length),P.setUint16(8,E.checkSum);const N=16-h.length%16;h=nW(h,new Uint8Array(N));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:vW,additionalData:S},u,h);return nW(new Uint8Array(C),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Oe(te.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(zt.DATA_STREAM,{payload:Nm(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Jme},!i)}sendMetadata(e){if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Oe(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(zt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Nm(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Efe),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send custom report, not joined");await It.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){Ui(r.spatialLayer,"spatialLayer",[0,1,2,3]),Ui(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(i){throw L.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:i}=e;if(qp(r,"apRTM"),ir(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,L.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(L.debug("[".concat(this._clientId,"] reset client")),function(e){const r=$v.indexOf(e);r!==-1&&$v.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=ia.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&hH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&It.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Vs("client-publish",this._clientId),this._subscribeMutex=new Vs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var i;const o=e||N_();e?L.debug("[".concat(this._clientId,"] new Session ").concat(o)):L.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,It.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};It.sessionInit(this._sessionId,Eu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");L.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(oi.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof vr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{L.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===te.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));L.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw i.throw(u),u}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===te.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},tf("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{It.reportApiInvoke(this._sessionId,{name:wi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:jr.TRACER}).onSuccess(),this.safeEmit(_n.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{It.reportApiInvoke(this._sessionId,{name:wi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:jr.TRACER}).onSuccess(),this.safeEmit(_n.LIVE_STREAMING_WARNING,c,u)},i.on(Ox.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,E,S){const C=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(P=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Mme(C,m,_,E,S)})(c,this._joinInfo,this._axiosCancelSource.token,Ci).then(u).catch(h)}),i};return e===Qp.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},tf("ChannelMediaRelay").create(e));o.on("state",c=>{c===ja.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(_n.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(_n.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:i,deleted:o}=e,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:E,metadata:S}=u,C=this._users.find(P=>P._uintid===h);if(!C)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(L.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),st(c).call(c,C)||c.push(C),C._uintid||(C._uintid=h),C._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!_,maxRetransmits:E,metadata:S},N=function(G){return v9(G,!0)}(P);C._dataChannels.push(N),L.info("[".concat(this._clientId,"] remote user ").concat(C.uid," published datachannel")),r||this.safeEmit(_n.USER_PUBLISHED,C,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(C,u.stream_id)&&(L.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(C.uid," after reconnect.")),this._subscribeDataChannel(C,u.stream_id).catch(P=>{L.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(_n.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void L.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=_._dataChannels.find(S=>S.id===u.stream_id);E&&(L.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[E]).then(S=>{if(_._dataChannels=_._dataChannels.filter(C=>C!==E),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),L.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(_n.USER_UNPUBLISHED,_,"datachannel",E._config))})}_handleRemoveDataChannels(e){const r=this._users.find(i=>i.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){L.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(_n.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),i()}}else L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(rs.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void L.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=i||u||Tx()||!Object.prototype.hasOwnProperty.call(UA,o)||(md[o]=c,Er[o]=c,L.debug("Update gateway parameters from config distribute",o,c))})}catch(r){L.error("Error update config from local cache",r.message)}})()}),this._gateway.on(rs.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(rs.CONNECTION_STATE_CHANGE,(e,r,i)=>{var o;if(i===Kn.FALLBACK)return;const c=()=>{this.safeEmit(_n.CONNECTION_STATE_CHANGE,e,r,i)};if(It.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:wi.CONNECTION_STATE_CHANGE,options:[e,r,i],tag:jr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:i})),L.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{L.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{L.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{L.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{L.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{L.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.AUDIO,!1)),h._trust_video_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.VIDEO,!1)),h._trust_audio_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(L.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(rs.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new Oe(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await uH(Eu(Eu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,pH(o),this._joinInfo.preload=!0):(i=await $x(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(i){r(i)}}),this._gateway.on(rs.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(_n.NETWORK_QUALITY,e)}),this._gateway.on(rs.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(_n.STREAM_TYPE_CHANGED,e,r),It.reportApiInvoke(this._sessionId,{name:wi.STREAM_TYPE_CHANGE,options:[e,r],tag:jr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(rs.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(rs.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,i)=>{try{let o=await this._p2pChannel.getEstablishParams();oe("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){i(o)}}),this._gateway.on(rs.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:L.debug("no attributes in joinResponse");const o=c9(e.ortc,r,i);this._p2pChannel.connect(o)}),this._gateway.on(rs.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:i}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=oe("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(En.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(En.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(En.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(En.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(En.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(En.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(En.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(En.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(En.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,gt.AUDIO,!0)),this._gateway.signal.on(En.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,gt.AUDIO,!1)),this._gateway.signal.on(En.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,gt.VIDEO,!0)),this._gateway.signal.on(En.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,gt.VIDEO,!1)),this._gateway.signal.on(En.RECEIVE_METADATA,e=>{const r=k_(e.metadata);this.safeEmit(_n.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(En.ON_DATA_STREAM,async e=>{var r;if(!e)return;let i=k_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<Dv)throw new Oe(te.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Dv));i=await async function(u,h,m){const _=m.subarray(0,Dv),E=_.slice(8,Dv),S=(E[0]<<8)+E[1],C=(_[6]<<8)+_[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:vW,additionalData:new Uint8Array(aW(S,2))},h,m.subarray(Dv));return new Uint8Array(P).subarray(0,C)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Zme(Eu(Eu({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(En.ON_CRYPT_ERROR,()=>{km(()=>{L.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(_n.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(En.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{L.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Kn.TOKEN_EXPIRE),this.safeEmit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(En.ON_STREAM_FALLBACK_UPDATE,e=>{L.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(_n.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(En.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),L.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(En.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(En.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on($t.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case zt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:E}=_;return E===Yn.Audio}),h=c.some(_=>{let{stream_type:E}=_;return E!==Yn.Audio}),m=c.some(_=>{let{stream_type:E}=_;return E===Yn.Screen||E===Yn.ScreenLow});r.state==="offer"&&It.publish(this._joinInfo.sid,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(_=>{let{stream_type:E}=_;return E===Yn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:E}=_;return E!==Yn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case zt.SUBSCRIBE:r&&It.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===gt.AUDIO,video:r.stream_type===gt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Bs.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(En.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(En.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;oe("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!j_(o.string_id||o.stream_id,this.channelName)));const r=[],i=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new jm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(L.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(_n.USER_JOINED,c)));const u=$i.Audio&o.stream_type,h=($i.Video|$i.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(_n.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(_n.USER_PUBLISHED,c,"video")),(u&&!_||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(L.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{L.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(_n.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(L.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(_n.PUBLISHED_USER_LIST,r)):L.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(En.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof MT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var o;return st(o=Object.keys(VA)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(En.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(oi.PUBLISH,(e,r,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const E=this._users.find(S=>S.uid===o);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,u,h[0].ssrcId,m).then(()=>{r()}).catch(i):r(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(oi.CALL,async(e,r,i)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on($t.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(oi.UNPUBLISH,async(e,r,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===Yn.Audio?gt.AUDIO:gt.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),r()}catch(h){i(h)}}}),this._gateway.signal.on(oi.CONTROL,async(e,r)=>{const{action:i}=e;switch(i){case xm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,gt.VIDEO,!0);break;case xm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,gt.AUDIO,!0);break;case xm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,gt.VIDEO,!1);break;case xm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,gt.AUDIO,!1)}}),this._gateway.signal.on(oi.RESTART_ICE,async(e,r,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==ko.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){i(o)}}),this._gateway.signal.on(oi.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:i}=e;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(Lt.RequestP2PRestartICE,async(e,r,i)=>{try{const{direction:o}=e;r(await this._gateway.sendExtensionMessage(oi.RESTART_ICE,e,o===ko.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(Lt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(oi.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Lt.RequestP2PMuteLocal,async(e,r,i)=>{try{await this._gateway.sendExtensionMessage(oi.CONTROL,e,!0),r()}catch(o){i(o)}}),this._p2pChannel.on(Lt.RequestP2PUnmuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(Lt.RequestP2PMuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(Lt.StateChange,(e,r)=>{r===qn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Lt.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(_n.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(Lt.RequestMuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(Lt.RequestUnmuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(Lt.RequestRePublish,(e,r,i)=>{this.publish(e,!1).then(r).catch(i)}),this._p2pChannel.on(Lt.RequestRePublishDataChannel,(e,r,i)=>{dt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==te.DISCONNECT_P2P)throw u}})).then(r).catch(i)}),this._p2pChannel.on(Lt.RequestReSubscribe,async(e,r,i)=>{try{for(const{user:o,kind:c}of e)c===gt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){i(o)}}),this._p2pChannel.on(Lt.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(Lt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Lt.MediaReconnectStart,e=>{this.safeEmit(_n.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Lt.MediaReconnectEnd,e=>{this.safeEmit(_n.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Lt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Lt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(Lt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Lt.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:o}),h=c9(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Lt.RequestUnpublishForReconnectPC,async(e,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):i()}),this._p2pChannel.on(Lt.P2PLost,()=>{this.safeEmit(_n.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Lt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Lt.ConnectionTypeChange,e=>{this.safeEmit(_n.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Lt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Lt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Lt.AudioMetadata,e=>{this.safeEmit(_n.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:e},tf("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:E}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:E?Number(E):0},Ci)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(e){e.on(is.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(_n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===mu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(_n.CONTENT_INSPECT_ERROR,new Oe(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(is.INSPECT_RESULT,(r,i)=>{var o;if((i==null?void 0:i.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return L.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(_n.CONTENT_INSPECT_RESULT,r,i)}),e.on(is.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(qp(e,"enabled"),e){if(!r)throw new Oe(te.INVALID_PARAMS,"config is required");if(RH(r),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(i={config:r},tf("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:E,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:E,vid:S?Number(S):0},Ci)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(yd.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(_n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===Cl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(yd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){Ui(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Oe(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,L.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return L.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){qp(e,"enabled"),tr("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},St(pt.prototype,"leave",[IH],Object.getOwnPropertyDescriptor(pt.prototype,"leave"),pt.prototype),St(pt.prototype,"publish",[AH],Object.getOwnPropertyDescriptor(pt.prototype,"publish"),pt.prototype),St(pt.prototype,"unpublish",[PH],Object.getOwnPropertyDescriptor(pt.prototype,"unpublish"),pt.prototype),St(pt.prototype,"subscribe",[OH],Object.getOwnPropertyDescriptor(pt.prototype,"subscribe"),pt.prototype),St(pt.prototype,"presubscribe",[kH],Object.getOwnPropertyDescriptor(pt.prototype,"presubscribe"),pt.prototype),St(pt.prototype,"massSubscribe",[NH],Object.getOwnPropertyDescriptor(pt.prototype,"massSubscribe"),pt.prototype),St(pt.prototype,"unsubscribe",[DH],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribe"),pt.prototype),St(pt.prototype,"massUnsubscribe",[LH],Object.getOwnPropertyDescriptor(pt.prototype,"massUnsubscribe"),pt.prototype),St(pt.prototype,"setLowStreamParameter",[xH],Object.getOwnPropertyDescriptor(pt.prototype,"setLowStreamParameter"),pt.prototype),St(pt.prototype,"enableDualStream",[MH],Object.getOwnPropertyDescriptor(pt.prototype,"enableDualStream"),pt.prototype),St(pt.prototype,"disableDualStream",[UH],Object.getOwnPropertyDescriptor(pt.prototype,"disableDualStream"),pt.prototype),St(pt.prototype,"setClientRole",[VH],Object.getOwnPropertyDescriptor(pt.prototype,"setClientRole"),pt.prototype),St(pt.prototype,"_setClientRoleOptions",[FH],Object.getOwnPropertyDescriptor(pt.prototype,"_setClientRoleOptions"),pt.prototype),St(pt.prototype,"setProxyServer",[jH],Object.getOwnPropertyDescriptor(pt.prototype,"setProxyServer"),pt.prototype),St(pt.prototype,"setTurnServer",[BH],Object.getOwnPropertyDescriptor(pt.prototype,"setTurnServer"),pt.prototype),St(pt.prototype,"setLicense",[WH],Object.getOwnPropertyDescriptor(pt.prototype,"setLicense"),pt.prototype),St(pt.prototype,"startProxyServer",[zH],Object.getOwnPropertyDescriptor(pt.prototype,"startProxyServer"),pt.prototype),St(pt.prototype,"stopProxyServer",[GH],Object.getOwnPropertyDescriptor(pt.prototype,"stopProxyServer"),pt.prototype),St(pt.prototype,"setLocalAccessPointsV2",[HH],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPointsV2"),pt.prototype),St(pt.prototype,"setLocalAccessPoints",[$H],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPoints"),pt.prototype),St(pt.prototype,"setRemoteDefaultVideoStreamType",[KH],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteDefaultVideoStreamType"),pt.prototype),St(pt.prototype,"setRemoteVideoStreamType",[qH],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteVideoStreamType"),pt.prototype),St(pt.prototype,"setStreamFallbackOption",[YH],Object.getOwnPropertyDescriptor(pt.prototype,"setStreamFallbackOption"),pt.prototype),St(pt.prototype,"setEncryptionConfig",[XH],Object.getOwnPropertyDescriptor(pt.prototype,"setEncryptionConfig"),pt.prototype),St(pt.prototype,"renewToken",[JH],Object.getOwnPropertyDescriptor(pt.prototype,"renewToken"),pt.prototype),St(pt.prototype,"enableAudioVolumeIndicator",[QH],Object.getOwnPropertyDescriptor(pt.prototype,"enableAudioVolumeIndicator"),pt.prototype),St(pt.prototype,"startLiveStreaming",[ZH],Object.getOwnPropertyDescriptor(pt.prototype,"startLiveStreaming"),pt.prototype),St(pt.prototype,"setLiveTranscoding",[e7],Object.getOwnPropertyDescriptor(pt.prototype,"setLiveTranscoding"),pt.prototype),St(pt.prototype,"stopLiveStreaming",[t7],Object.getOwnPropertyDescriptor(pt.prototype,"stopLiveStreaming"),pt.prototype),St(pt.prototype,"startChannelMediaRelay",[n7],Object.getOwnPropertyDescriptor(pt.prototype,"startChannelMediaRelay"),pt.prototype),St(pt.prototype,"updateChannelMediaRelay",[r7],Object.getOwnPropertyDescriptor(pt.prototype,"updateChannelMediaRelay"),pt.prototype),St(pt.prototype,"stopChannelMediaRelay",[i7],Object.getOwnPropertyDescriptor(pt.prototype,"stopChannelMediaRelay"),pt.prototype),St(pt.prototype,"sendCustomReportMessage",[s7],Object.getOwnPropertyDescriptor(pt.prototype,"sendCustomReportMessage"),pt.prototype),St(pt.prototype,"pickSVCLayer",[o7],Object.getOwnPropertyDescriptor(pt.prototype,"pickSVCLayer"),pt.prototype),St(pt.prototype,"setRTMConfig",[a7],Object.getOwnPropertyDescriptor(pt.prototype,"setRTMConfig"),pt.prototype),St(pt.prototype,"enableContentInspect",[c7],Object.getOwnPropertyDescriptor(pt.prototype,"enableContentInspect"),pt.prototype),St(pt.prototype,"disableContentInspect",[l7],Object.getOwnPropertyDescriptor(pt.prototype,"disableContentInspect"),pt.prototype),St(pt.prototype,"setImageModeration",[u7],Object.getOwnPropertyDescriptor(pt.prototype,"setImageModeration"),pt.prototype),St(pt.prototype,"setP2PTransport",[d7],Object.getOwnPropertyDescriptor(pt.prototype,"setP2PTransport"),pt.prototype),St(pt.prototype,"getJoinChannelServiceRecords",[h7],Object.getOwnPropertyDescriptor(pt.prototype,"getJoinChannelServiceRecords"),pt.prototype),St(pt.prototype,"setPublishAudioFilterEnabled",[p7],Object.getOwnPropertyDescriptor(pt.prototype,"setPublishAudioFilterEnabled"),pt.prototype),pt);class FT{constructor(r,i){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),FT.count+=1,this.id=FT.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new dt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new Oe(te.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new Oe(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new Oe(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){L.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var m7,OP;K(FT,"count",0);const gge=window.AudioContext||window.webkitAudioContext,_ge=new(m7=Ft({report:It}),St((OP=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return L.debug("the system does not need to process local aec"),-1;this.context||(this.context=new gge);let r=this.units.find(i=>i&&i.getElement()===e);return r||(r=new FT(e,this.context),this.units.push(r)),r.startEchoCancellation(),L.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Nn().name!==zn.SAFARI}}).prototype,"processExternalMediaAEC",[m7],Object.getOwnPropertyDescriptor(OP.prototype,"processExternalMediaAEC"),OP.prototype),OP);function g7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _7(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?g7(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const c2=window||document;function y7(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!c2)return;const i=Ri._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const o=c=>{if(!(c&&c.blockedURI&&(Ri.onSecurityPolicyViolation||Ri.getListeners(Eh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some(h=>st(u).call(u,h))&&(Ri.onSecurityPolicyViolation&&typeof Ri.onSecurityPolicyViolation=="function"&&Ri.onSecurityPolicyViolation(c),Ri.getListeners(Eh.SECURITY_POLICY_VIOLATION).length>0&&Ri.safeEmit(Eh.SECURITY_POLICY_VIOLATION,c))};i&&c2.removeEventListener("securitypolicyviolation",i),(r||e&&typeof e=="function"||Ri.getListeners(Eh.SECURITY_POLICY_VIOLATION).length>0)&&c2.addEventListener("securitypolicyviolation",o),Ri._cspEventHandlerPointer=o}var yge=k,Ege=t8,E7=RegExp.prototype,vge=function(e){return e===E7||yge(E7,e)?Ege(e):e.flags},po=l(vge);function oS(e){let r=e.length;for(;--r>=0;)e[r]=0}const l2=256,v7=286,jT=30,BT=15,u2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),kP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Sge=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sf=new Array(576);oS(sf);const WT=new Array(60);oS(WT);const zT=new Array(512);oS(zT);const GT=new Array(256);oS(GT);const d2=new Array(29);oS(d2);const NP=new Array(jT);function h2(e,r,i,o,c){this.static_tree=e,this.extra_bits=r,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let b7,T7,w7;function p2(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}oS(NP);const C7=e=>e<256?zT[e]:zT[256+(e>>>7)],HT=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},Qc=(e,r,i)=>{e.bi_valid>16-i?(e.bi_buf|=r<<e.bi_valid&65535,HT(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=i)},wh=(e,r,i)=>{Qc(e,i[2*r],i[2*r+1])},R7=(e,r)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--r>0);return i>>>1},I7=(e,r,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=BT;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=e[2*u+1];m!==0&&(e[2*u]=R7(o[m]++,m))}},A7=e=>{let r;for(r=0;r<v7;r++)e.dyn_ltree[2*r]=0;for(r=0;r<jT;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},P7=e=>{e.bi_valid>8?HT(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},O7=(e,r,i,o)=>{const c=2*r,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[r]<=o[i]},f2=(e,r,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&O7(r,e.heap[c+1],e.heap[c],e.depth)&&c++,!O7(r,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},k7=(e,r,i)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?wh(e,c,r):(u=GT[c],wh(e,u+l2+1,r),h=u2[u],h!==0&&(c-=d2[u],Qc(e,c,h)),o--,u=C7(o),wh(e,u,i),h=kP[u],h!==0&&(o-=NP[u],Qc(e,o,h)));while(m<e.sym_next);wh(e,256,r)},m2=(e,r)=>{const i=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,_,E=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=E=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=E<2?++E:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(r.max_code=E,h=e.heap_len>>1;h>=1;h--)f2(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],f2(e,i,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,i[2*_]=i[2*h]+i[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,i[2*h+1]=i[2*m+1]=_,e.heap[1]=_++,f2(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,C)=>{const P=C.dyn_tree,N=C.max_code,G=C.stat_desc.static_tree,V=C.stat_desc.has_stree,j=C.stat_desc.extra_bits,Y=C.stat_desc.extra_base,Z=C.stat_desc.max_length;let de,Se,Te,ye,Ne,Ye,ht=0;for(ye=0;ye<=BT;ye++)S.bl_count[ye]=0;for(P[2*S.heap[S.heap_max]+1]=0,de=S.heap_max+1;de<573;de++)Se=S.heap[de],ye=P[2*P[2*Se+1]+1]+1,ye>Z&&(ye=Z,ht++),P[2*Se+1]=ye,Se>N||(S.bl_count[ye]++,Ne=0,Se>=Y&&(Ne=j[Se-Y]),Ye=P[2*Se],S.opt_len+=Ye*(ye+Ne),V&&(S.static_len+=Ye*(G[2*Se+1]+Ne)));if(ht!==0){do{for(ye=Z-1;S.bl_count[ye]===0;)ye--;S.bl_count[ye]--,S.bl_count[ye+1]+=2,S.bl_count[Z]--,ht-=2}while(ht>0);for(ye=Z;ye!==0;ye--)for(Se=S.bl_count[ye];Se!==0;)Te=S.heap[--de],Te>N||(P[2*Te+1]!==ye&&(S.opt_len+=(ye-P[2*Te+1])*P[2*Te],P[2*Te+1]=ye),Se--)}})(e,r),I7(i,E,e.bl_count)},N7=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,E=4;for(h===0&&(_=138,E=3),r[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=r[2*(o+1)+1],++m<_&&c===h||(m<E?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4))},D7=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,E=4;for(h===0&&(_=138,E=3),o=0;o<=i;o++)if(c=h,h=r[2*(o+1)+1],!(++m<_&&c===h)){if(m<E)do wh(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(wh(e,c,e.bl_tree),m--),wh(e,16,e.bl_tree),Qc(e,m-3,2)):m<=10?(wh(e,17,e.bl_tree),Qc(e,m-3,3)):(wh(e,18,e.bl_tree),Qc(e,m-11,7));m=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4)}};let L7=!1;const x7=(e,r,i,o)=>{Qc(e,0+(o?1:0),3),P7(e),HT(e,i),HT(e,~i),i&&e.pending_buf.set(e.window.subarray(r,r+i),e.pending),e.pending+=i};var bge=e=>{L7||((()=>{let r,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(d2[c]=o,r=0;r<1<<u2[c];r++)GT[o++]=c;for(GT[o-1]=c,u=0,c=0;c<16;c++)for(NP[c]=u,r=0;r<1<<kP[c];r++)zT[u++]=c;for(u>>=7;c<jT;c++)for(NP[c]=u<<7,r=0;r<1<<kP[c]-7;r++)zT[256+u++]=c;for(i=0;i<=BT;i++)h[i]=0;for(r=0;r<=143;)sf[2*r+1]=8,r++,h[8]++;for(;r<=255;)sf[2*r+1]=9,r++,h[9]++;for(;r<=279;)sf[2*r+1]=7,r++,h[7]++;for(;r<=287;)sf[2*r+1]=8,r++,h[8]++;for(I7(sf,287,h),r=0;r<jT;r++)WT[2*r+1]=5,WT[2*r]=R7(r,5);b7=new h2(sf,u2,257,v7,BT),T7=new h2(WT,kP,0,jT,BT),w7=new h2(new Array(0),Sge,0,19,7)})(),L7=!0),e.l_desc=new p2(e.dyn_ltree,b7),e.d_desc=new p2(e.dyn_dtree,T7),e.bl_desc=new p2(e.bl_tree,w7),e.bi_buf=0,e.bi_valid=0,A7(e)},Tge=(e,r,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,E=4093624447;for(_=0;_<=31;_++,E>>>=1)if(1&E&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<l2;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),m2(e,e.l_desc),m2(e,e.d_desc),h=(m=>{let _;for(N7(m,m.dyn_ltree,m.l_desc.max_code),N7(m,m.dyn_dtree,m.d_desc.max_code),m2(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*S7[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&r!==-1?x7(e,r,i,o):e.strategy===4||u===c?(Qc(e,2+(o?1:0),3),k7(e,sf,WT)):(Qc(e,4+(o?1:0),3),((m,_,E,S)=>{let C;for(Qc(m,_-257,5),Qc(m,E-1,5),Qc(m,S-4,4),C=0;C<S;C++)Qc(m,m.bl_tree[2*S7[C]+1],3);D7(m,m.dyn_ltree,_-1),D7(m,m.dyn_dtree,E-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),k7(e,e.dyn_ltree,e.dyn_dtree)),A7(e),o&&P7(e)},wge=(e,r,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,r===0?e.dyn_ltree[2*i]++:(e.matches++,r--,e.dyn_ltree[2*(GT[i]+l2+1)]++,e.dyn_dtree[2*C7(r)]++),e.sym_next===e.sym_end),Cge=e=>{Qc(e,2,3),wh(e,256,sf),(r=>{r.bi_valid===16?(HT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},Rge={_tr_init:bge,_tr_stored_block:x7,_tr_flush_block:Tge,_tr_tally:wge,_tr_align:Cge},$T=(e,r,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Ige=new Uint32Array((()=>{let e,r=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[i]=e}return r})());var Do=(e,r,i,o)=>{const c=Ige,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^r[h])];return-1^e},Y_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},DP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Age,_tr_stored_block:g2,_tr_flush_block:Pge,_tr_tally:Gm,_tr_align:Oge}=Rge,{Z_NO_FLUSH:Hm,Z_PARTIAL_FLUSH:kge,Z_FULL_FLUSH:Nge,Z_FINISH:vu,Z_BLOCK:M7,Z_OK:la,Z_STREAM_END:U7,Z_STREAM_ERROR:Ch,Z_DATA_ERROR:Dge,Z_BUF_ERROR:_2,Z_DEFAULT_COMPRESSION:Lge,Z_FILTERED:xge,Z_HUFFMAN_ONLY:LP,Z_RLE:Mge,Z_FIXED:Uge,Z_DEFAULT_STRATEGY:Vge,Z_UNKNOWN:Fge,Z_DEFLATED:xP}=DP,y2=286,jge=30,Bge=19,Wge=2*y2+1,zge=15,X_=258,Rh=262,aS=42,J_=113,KT=666,Q_=(e,r)=>(e.msg=Y_[r],r),V7=e=>2*e-(e>4?9:0),$m=e=>{let r=e.length;for(;--r>=0;)e[r]=0},Gge=e=>{let r,i,o,c=e.w_size;r=e.hash_size,o=r;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--r);r=c,o=r;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--r)};let Km=(e,r,i)=>(r<<e.hash_shift^i)&e.hash_mask;const Il=e=>{const r=e.state;let i=r.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),e.next_out),e.next_out+=i,r.pending_out+=i,e.total_out+=i,e.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},Al=(e,r)=>{Pge(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,Il(e.strm)},Jr=(e,r)=>{e.pending_buf[e.pending++]=r},qT=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},E2=(e,r,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,r.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=$T(e.adler,r,c,i):e.state.wrap===2&&(e.adler=Do(e.adler,r,c,i)),e.next_in+=c,e.total_in+=c,c)},F7=(e,r)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-Rh?e.strstart-(e.w_size-Rh):0,E=e.window,S=e.w_mask,C=e.prev,P=e.strstart+X_;let N=E[u+h-1],G=E[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(i=r,E[i+h]===G&&E[i+h-1]===N&&E[i]===E[u]&&E[++i]===E[u+1]){u+=2,i++;do;while(E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&u<P);if(o=X_-(P-u),u=P-X_,o>h){if(e.match_start=r,h=o,o>=m)break;N=E[u+h-1],G=E[u+h]}}while((r=C[r&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},cS=e=>{const r=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-Rh)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),Gge(e),o+=r),e.strm.avail_in===0)break;if(i=E2(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Km(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Km(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Rh&&e.strm.avail_in!==0)},j7=(e,r)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&r!==vu||r===Hm||i!==o+e.strm.avail_in)))break;h=r===vu&&i===o+e.strm.avail_in?1:0,g2(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,Il(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(E2(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:r!==Hm&&r!==vu&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(E2(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||r===vu)&&r!==Hm&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=r===vu&&e.strm.avail_in===0&&i===o?1:0,g2(e,e.block_start,i,h),e.block_start+=i,Il(e.strm)),h?3:1)},v2=(e,r)=>{let i,o;for(;;){if(e.lookahead<Rh){if(cS(e),e.lookahead<Rh&&r===Hm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Km(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Rh&&(e.match_length=F7(e,i)),e.match_length>=3)if(o=Gm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Km(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Km(e,e.ins_h,e.window[e.strstart+1]);else o=Gm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Al(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===vu?(Al(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Al(e,!1),e.strm.avail_out===0)?1:2},lS=(e,r)=>{let i,o,c;for(;;){if(e.lookahead<Rh){if(cS(e),e.lookahead<Rh&&r===Hm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Km(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Rh&&(e.match_length=F7(e,i),e.match_length<=5&&(e.strategy===xge||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Gm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Km(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Al(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Gm(e,0,e.window[e.strstart-1]),o&&Al(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Gm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===vu?(Al(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Al(e,!1),e.strm.avail_out===0)?1:2};function Ih(e,r,i,o,c){this.good_length=e,this.max_lazy=r,this.nice_length=i,this.max_chain=o,this.func=c}const YT=[new Ih(0,0,0,0,j7),new Ih(4,4,8,4,v2),new Ih(4,5,16,8,v2),new Ih(4,6,32,32,v2),new Ih(4,4,16,16,lS),new Ih(8,16,32,32,lS),new Ih(8,16,128,128,lS),new Ih(8,32,128,256,lS),new Ih(32,128,258,1024,lS),new Ih(32,258,258,4096,lS)];function Hge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=xP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Wge),this.dyn_dtree=new Uint16Array(2*(2*jge+1)),this.bl_tree=new Uint16Array(2*(2*Bge+1)),$m(this.dyn_ltree),$m(this.dyn_dtree),$m(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(zge+1),this.heap=new Uint16Array(2*y2+1),$m(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*y2+1),$m(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const XT=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==aS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==J_&&r.status!==KT?1:0},B7=e=>{if(XT(e))return Q_(e,Ch);e.total_in=e.total_out=0,e.data_type=Fge;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?aS:J_,e.adler=r.wrap===2?0:1,r.last_flush=-2,Age(r),la},W7=e=>{const r=B7(e);return r===la&&(i=>{i.window_size=2*i.w_size,$m(i.head),i.max_lazy_match=YT[i.level].max_lazy,i.good_match=YT[i.level].good_length,i.nice_match=YT[i.level].nice_length,i.max_chain_length=YT[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),r},z7=(e,r,i,o,c,u)=>{if(!e)return Ch;let h=1;if(r===Lge&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==xP||o<8||o>15||r<0||r>9||u<0||u>Uge||o===8&&h!==1)return Q_(e,Ch);o===8&&(o=9);const m=new Hge;return e.state=m,m.strm=e,m.status=aS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=i,W7(e)};var $ge=(e,r)=>{if(XT(e)||r>M7||r<0)return e?Q_(e,Ch):Ch;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===KT&&r!==vu)return Q_(e,e.avail_out===0?_2:Ch);const o=i.last_flush;if(i.last_flush=r,i.pending!==0){if(Il(e),e.avail_out===0)return i.last_flush=-1,la}else if(e.avail_in===0&&V7(r)<=V7(o)&&r!==vu)return Q_(e,_2);if(i.status===KT&&e.avail_in!==0)return Q_(e,_2);if(i.status===aS&&i.wrap===0&&(i.status=J_),i.status===aS){let c=xP+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=LP||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,qT(i,c),i.strstart!==0&&(qT(i,e.adler>>>16),qT(i,65535&e.adler)),e.adler=1,i.status=J_,Il(e),i.pending!==0)return i.last_flush=-1,la}if(i.status===57){if(e.adler=0,Jr(i,31),Jr(i,139),Jr(i,8),i.gzhead)Jr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Jr(i,255&i.gzhead.time),Jr(i,i.gzhead.time>>8&255),Jr(i,i.gzhead.time>>16&255),Jr(i,i.gzhead.time>>24&255),Jr(i,i.level===9?2:i.strategy>=LP||i.level<2?4:0),Jr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Jr(i,255&i.gzhead.extra.length),Jr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Do(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Jr(i,0),Jr(i,0),Jr(i,0),Jr(i,0),Jr(i,0),Jr(i,i.level===9?2:i.strategy>=LP||i.level<2?4:0),Jr(i,3),i.status=J_,Il(e),i.pending!==0)return i.last_flush=-1,la}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=Do(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,Il(e),i.pending!==0)return i.last_flush=-1,la;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=Do(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=Do(e.adler,i.pending_buf,i.pending-u,u)),Il(e),i.pending!==0)return i.last_flush=-1,la;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Jr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=Do(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=Do(e.adler,i.pending_buf,i.pending-u,u)),Il(e),i.pending!==0)return i.last_flush=-1,la;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Jr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=Do(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(Il(e),i.pending!==0))return i.last_flush=-1,la;Jr(i,255&e.adler),Jr(i,e.adler>>8&255),e.adler=0}if(i.status=J_,Il(e),i.pending!==0)return i.last_flush=-1,la}if(e.avail_in!==0||i.lookahead!==0||r!==Hm&&i.status!==KT){let c=i.level===0?j7(i,r):i.strategy===LP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(cS(u),u.lookahead===0)){if(h===Hm)return 1;break}if(u.match_length=0,m=Gm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(Al(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===vu?(Al(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Al(u,!1),u.strm.avail_out===0)?1:2})(i,r):i.strategy===Mge?((u,h)=>{let m,_,E,S;const C=u.window;for(;;){if(u.lookahead<=X_){if(cS(u),u.lookahead<=X_&&h===Hm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(E=u.strstart-1,_=C[E],_===C[++E]&&_===C[++E]&&_===C[++E])){S=u.strstart+X_;do;while(_===C[++E]&&_===C[++E]&&_===C[++E]&&_===C[++E]&&_===C[++E]&&_===C[++E]&&_===C[++E]&&_===C[++E]&&E<S);u.match_length=X_-(S-E),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Gm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Gm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(Al(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===vu?(Al(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Al(u,!1),u.strm.avail_out===0)?1:2})(i,r):YT[i.level].func(i,r);if(c!==3&&c!==4||(i.status=KT),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),la;if(c===2&&(r===kge?Oge(i):r!==M7&&(g2(i,0,0,!1),r===Nge&&($m(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Il(e),e.avail_out===0))return i.last_flush=-1,la}return r!==vu?la:i.wrap<=0?U7:(i.wrap===2?(Jr(i,255&e.adler),Jr(i,e.adler>>8&255),Jr(i,e.adler>>16&255),Jr(i,e.adler>>24&255),Jr(i,255&e.total_in),Jr(i,e.total_in>>8&255),Jr(i,e.total_in>>16&255),Jr(i,e.total_in>>24&255)):(qT(i,e.adler>>>16),qT(i,65535&e.adler)),Il(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?la:U7)},Kge=(e,r)=>{let i=r.length;if(XT(e))return Ch;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==aS||o.lookahead)return Ch;if(c===1&&(e.adler=$T(e.adler,r,i,0)),o.wrap=0,i>=o.w_size){c===0&&($m(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(r.subarray(i-o.w_size,i),0),r=_,i=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=i,e.next_in=0,e.input=r,cS(o);o.lookahead>=3;){let _=o.strstart,E=o.lookahead-2;do o.ins_h=Km(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--E);o.strstart=_,o.lookahead=2,cS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,la},JT={deflateInit:(e,r)=>z7(e,r,xP,15,8,Vge),deflateInit2:z7,deflateReset:W7,deflateResetKeep:B7,deflateSetHeader:(e,r)=>XT(e)||e.state.wrap!==2?Ch:(e.state.gzhead=r,la),deflate:$ge,deflateEnd:e=>{if(XT(e))return Ch;const r=e.state.status;return e.state=null,r===J_?Q_(e,Dge):la},deflateSetDictionary:Kge,deflateInfo:"pako deflate (from Nodeca project)"};const qge=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var MP={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)qge(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,c=e.length;o<c;o++)r+=e[o].length;const i=new Uint8Array(r);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let G7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{G7=!1}const QT=new Uint8Array(256);for(let e=0;e<256;e++)QT[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;QT[254]=QT[254]=1;var ZT={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,i,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?r[u++]=i:i<2048?(r[u++]=192|i>>>6,r[u++]=128|63&i):i<65536?(r[u++]=224|i>>>12,r[u++]=128|i>>>6&63,r[u++]=128|63&i):(r[u++]=240|i>>>18,r[u++]=128|i>>>12&63,r[u++]=128|i>>>6&63,r[u++]=128|63&i);return r},buf2string:(e,r)=>{const i=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=QT[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<i;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&G7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let E=0;E<m;E++)_+=String.fromCharCode(h[E]);return _})(u,c)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let i=r-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?r:i+QT[e[i]]>r?i:r}},H7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const $7=Object.prototype.toString,{Z_NO_FLUSH:Yge,Z_SYNC_FLUSH:Xge,Z_FULL_FLUSH:Jge,Z_FINISH:Qge,Z_OK:UP,Z_STREAM_END:Zge,Z_DEFAULT_COMPRESSION:e_e,Z_DEFAULT_STRATEGY:t_e,Z_DEFLATED:n_e}=DP;function VP(e){this.options=MP.assign({level:e_e,method:n_e,chunkSize:16384,windowBits:15,memLevel:8,strategy:t_e},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H7,this.strm.avail_out=0;let i=JT.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==UP)throw new Error(Y_[i]);if(r.header&&JT.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?ZT.string2buf(r.dictionary):$7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=JT.deflateSetDictionary(this.strm,o),i!==UP)throw new Error(Y_[i]);this._dict_set=!0}}function r_e(e,r){const i=new VP(r);if(i.push(e,!0),i.err)throw i.msg||Y_[i.err];return i.result}VP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?Qge:Yge,typeof e=="string"?i.input=ZT.string2buf(e):$7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===Xge||u===Jge)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=JT.deflate(i,u),c===Zge)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=JT.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===UP;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},VP.prototype.onData=function(e){this.chunks.push(e)},VP.prototype.onEnd=function(e){e===UP&&(this.result=MP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var i_e={deflate:r_e};const FP=16209;var s_e=function(e,r){let i,o,c,u,h,m,_,E,S,C,P,N,G,V,j,Y,Z,de,Se,Te,ye,Ne,Ye,ht;const ft=e.state;i=e.next_in,Ye=e.input,o=i+(e.avail_in-5),c=e.next_out,ht=e.output,u=c-(r-e.avail_out),h=c+(e.avail_out-257),m=ft.dmax,_=ft.wsize,E=ft.whave,S=ft.wnext,C=ft.window,P=ft.hold,N=ft.bits,G=ft.lencode,V=ft.distcode,j=(1<<ft.lenbits)-1,Y=(1<<ft.distbits)-1;e:do{N<15&&(P+=Ye[i++]<<N,N+=8,P+=Ye[i++]<<N,N+=8),Z=G[P&j];t:for(;;){if(de=Z>>>24,P>>>=de,N-=de,de=Z>>>16&255,de===0)ht[c++]=65535&Z;else{if(!(16&de)){if((64&de)==0){Z=G[(65535&Z)+(P&(1<<de)-1)];continue t}if(32&de){ft.mode=16191;break e}e.msg="invalid literal/length code",ft.mode=FP;break e}Se=65535&Z,de&=15,de&&(N<de&&(P+=Ye[i++]<<N,N+=8),Se+=P&(1<<de)-1,P>>>=de,N-=de),N<15&&(P+=Ye[i++]<<N,N+=8,P+=Ye[i++]<<N,N+=8),Z=V[P&Y];n:for(;;){if(de=Z>>>24,P>>>=de,N-=de,de=Z>>>16&255,!(16&de)){if((64&de)==0){Z=V[(65535&Z)+(P&(1<<de)-1)];continue n}e.msg="invalid distance code",ft.mode=FP;break e}if(Te=65535&Z,de&=15,N<de&&(P+=Ye[i++]<<N,N+=8,N<de&&(P+=Ye[i++]<<N,N+=8)),Te+=P&(1<<de)-1,Te>m){e.msg="invalid distance too far back",ft.mode=FP;break e}if(P>>>=de,N-=de,de=c-u,Te>de){if(de=Te-de,de>E&&ft.sane){e.msg="invalid distance too far back",ft.mode=FP;break e}if(ye=0,Ne=C,S===0){if(ye+=_-de,de<Se){Se-=de;do ht[c++]=C[ye++];while(--de);ye=c-Te,Ne=ht}}else if(S<de){if(ye+=_+S-de,de-=S,de<Se){Se-=de;do ht[c++]=C[ye++];while(--de);if(ye=0,S<Se){de=S,Se-=de;do ht[c++]=C[ye++];while(--de);ye=c-Te,Ne=ht}}}else if(ye+=S-de,de<Se){Se-=de;do ht[c++]=C[ye++];while(--de);ye=c-Te,Ne=ht}for(;Se>2;)ht[c++]=Ne[ye++],ht[c++]=Ne[ye++],ht[c++]=Ne[ye++],Se-=3;Se&&(ht[c++]=Ne[ye++],Se>1&&(ht[c++]=Ne[ye++]))}else{ye=c-Te;do ht[c++]=ht[ye++],ht[c++]=ht[ye++],ht[c++]=ht[ye++],Se-=3;while(Se>2);Se&&(ht[c++]=ht[ye++],Se>1&&(ht[c++]=ht[ye++]))}break}}break}}while(i<o&&c<h);Se=N>>3,i-=Se,N-=Se<<3,P&=(1<<N)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),ft.hold=P,ft.bits=N};const jP=15,o_e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),a_e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),c_e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),l_e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ew=(e,r,i,o,c,u,h,m)=>{const _=m.bits;let E,S,C,P,N,G,V=0,j=0,Y=0,Z=0,de=0,Se=0,Te=0,ye=0,Ne=0,Ye=0,ht=null;const ft=new Uint16Array(16),Sn=new Uint16Array(16);let bn,pr,ai,$r=null;for(V=0;V<=jP;V++)ft[V]=0;for(j=0;j<o;j++)ft[r[i+j]]++;for(de=_,Z=jP;Z>=1&&ft[Z]===0;Z--);if(de>Z&&(de=Z),Z===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(Y=1;Y<Z&&ft[Y]===0;Y++);for(de<Y&&(de=Y),ye=1,V=1;V<=jP;V++)if(ye<<=1,ye-=ft[V],ye<0)return-1;if(ye>0&&(e===0||Z!==1))return-1;for(Sn[1]=0,V=1;V<jP;V++)Sn[V+1]=Sn[V]+ft[V];for(j=0;j<o;j++)r[i+j]!==0&&(h[Sn[r[i+j]]++]=j);if(e===0?(ht=$r=h,G=20):e===1?(ht=o_e,$r=a_e,G=257):(ht=c_e,$r=l_e,G=0),Ye=0,j=0,V=Y,N=u,Se=de,Te=0,C=-1,Ne=1<<de,P=Ne-1,e===1&&Ne>852||e===2&&Ne>592)return 1;for(;;){bn=V-Te,h[j]+1<G?(pr=0,ai=h[j]):h[j]>=G?(pr=$r[h[j]-G],ai=ht[h[j]-G]):(pr=96,ai=0),E=1<<V-Te,S=1<<Se,Y=S;do S-=E,c[N+(Ye>>Te)+S]=bn<<24|pr<<16|ai|0;while(S!==0);for(E=1<<V-1;Ye&E;)E>>=1;if(E!==0?(Ye&=E-1,Ye+=E):Ye=0,j++,--ft[V]==0){if(V===Z)break;V=r[i+h[j]]}if(V>de&&(Ye&P)!==C){for(Te===0&&(Te=de),N+=Y,Se=V-Te,ye=1<<Se;Se+Te<Z&&(ye-=ft[Se+Te],!(ye<=0));)Se++,ye<<=1;if(Ne+=1<<Se,e===1&&Ne>852||e===2&&Ne>592)return 1;C=Ye&P,c[C]=de<<24|Se<<16|N-u|0}}return Ye!==0&&(c[N+Ye]=V-Te<<24|64<<16|0),m.bits=de,0};const{Z_FINISH:K7,Z_BLOCK:u_e,Z_TREES:BP,Z_OK:Z_,Z_STREAM_END:d_e,Z_NEED_DICT:h_e,Z_STREAM_ERROR:Su,Z_DATA_ERROR:q7,Z_MEM_ERROR:Y7,Z_BUF_ERROR:p_e,Z_DEFLATED:X7}=DP,WP=16180,zP=16190,of=16191,S2=16192,b2=16194,GP=16199,HP=16200,T2=16206,ss=16209,J7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function f_e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ey=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<WP||r.mode>16211?1:0},Q7=e=>{if(ey(e))return Su;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=WP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Z_},Z7=e=>{if(ey(e))return Su;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,Q7(e)},e$=(e,r)=>{let i;if(ey(e))return Su;const o=e.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Su:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=i,o.wbits=r,Z7(e))},t$=(e,r)=>{if(!e)return Su;const i=new f_e;e.state=i,i.strm=e,i.window=null,i.mode=WP;const o=e$(e,r);return o!==Z_&&(e.state=null),o};let w2,C2,n$=!0;const m_e=e=>{if(n$){w2=new Int32Array(512),C2=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(ew(1,e.lens,0,288,w2,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;ew(2,e.lens,0,32,C2,0,e.work,{bits:5}),n$=!1}e.lencode=w2,e.lenbits=9,e.distcode=C2,e.distbits=5},r$=(e,r,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var g_e=(e,r)=>{let i,o,c,u,h,m,_,E,S,C,P,N,G,V,j,Y,Z,de,Se,Te,ye,Ne,Ye=0;const ht=new Uint8Array(4);let ft,Sn;const bn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ey(e)||!e.output||!e.input&&e.avail_in!==0)return Su;i=e.state,i.mode===of&&(i.mode=S2),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,E=i.hold,S=i.bits,C=m,P=_,Ne=Z_;e:for(;;)switch(i.mode){case WP:if(i.wrap===0){i.mode=S2;break}for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(2&i.wrap&&E===35615){i.wbits===0&&(i.wbits=15),i.check=0,ht[0]=255&E,ht[1]=E>>>8&255,i.check=Do(i.check,ht,2,0),E=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",i.mode=ss;break}if((15&E)!==X7){e.msg="unknown compression method",i.mode=ss;break}if(E>>>=4,S-=4,ye=8+(15&E),i.wbits===0&&(i.wbits=ye),ye>15||ye>i.wbits){e.msg="invalid window size",i.mode=ss;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&E?16189:of,E=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(i.flags=E,(255&po(i))!==X7){e.msg="unknown compression method",i.mode=ss;break}if(57344&po(i)){e.msg="unknown header flags set",i.mode=ss;break}i.head&&(i.head.text=E>>8&1),512&po(i)&&4&i.wrap&&(ht[0]=255&E,ht[1]=E>>>8&255,i.check=Do(i.check,ht,2,0)),E=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.head&&(i.head.time=E),512&po(i)&&4&i.wrap&&(ht[0]=255&E,ht[1]=E>>>8&255,ht[2]=E>>>16&255,ht[3]=E>>>24&255,i.check=Do(i.check,ht,4,0)),E=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.head&&(i.head.xflags=255&E,i.head.os=E>>8),512&po(i)&&4&i.wrap&&(ht[0]=255&E,ht[1]=E>>>8&255,i.check=Do(i.check,ht,2,0)),E=0,S=0,i.mode=16184;case 16184:if(1024&po(i)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.length=E,i.head&&(i.head.extra_len=E),512&po(i)&&4&i.wrap&&(ht[0]=255&E,ht[1]=E>>>8&255,i.check=Do(i.check,ht,2,0)),E=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&po(i)&&(N=i.length,N>m&&(N=m),N&&(i.head&&(ye=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+N),ye)),512&po(i)&&4&i.wrap&&(i.check=Do(i.check,o,N,u)),m-=N,u+=N,i.length-=N),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&po(i)){if(m===0)break e;N=0;do ye=o[u+N++],i.head&&ye&&i.length<65536&&(i.head.name+=String.fromCharCode(ye));while(ye&&N<m);if(512&po(i)&&4&i.wrap&&(i.check=Do(i.check,o,N,u)),m-=N,u+=N,ye)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&po(i)){if(m===0)break e;N=0;do ye=o[u+N++],i.head&&ye&&i.length<65536&&(i.head.comment+=String.fromCharCode(ye));while(ye&&N<m);if(512&po(i)&&4&i.wrap&&(i.check=Do(i.check,o,N,u)),m-=N,u+=N,ye)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&po(i)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&i.wrap&&E!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ss;break}E=0,S=0}i.head&&(i.head.hcrc=po(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=of;break;case 16189:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}e.adler=i.check=J7(E),E=0,S=0,i.mode=zP;case zP:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=E,i.bits=S,h_e;e.adler=i.check=1,i.mode=of;case of:if(r===u_e||r===BP)break e;case S2:if(i.last){E>>>=7&S,S-=7&S,i.mode=T2;break}for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}switch(i.last=1&E,E>>>=1,S-=1,3&E){case 0:i.mode=16193;break;case 1:if(m_e(i),i.mode=GP,r===BP){E>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=ss}E>>>=2,S-=2;break;case 16193:for(E>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ss;break}if(i.length=65535&E,E=0,S=0,i.mode=b2,r===BP)break e;case b2:i.mode=16195;case 16195:if(N=i.length,N){if(N>m&&(N=m),N>_&&(N=_),N===0)break e;c.set(o.subarray(u,u+N),h),m-=N,u+=N,_-=N,h+=N,i.length-=N;break}i.mode=of;break;case 16196:for(;S<14;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(i.nlen=257+(31&E),E>>>=5,S-=5,i.ndist=1+(31&E),E>>>=5,S-=5,i.ncode=4+(15&E),E>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ss;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.lens[bn[i.have++]]=7&E,E>>>=3,S-=3}for(;i.have<19;)i.lens[bn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ft={bits:i.lenbits},Ne=ew(0,i.lens,0,19,i.lencode,0,i.work,ft),i.lenbits=ft.bits,Ne){e.msg="invalid code lengths set",i.mode=ss;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Ye=i.lencode[E&(1<<i.lenbits)-1],j=Ye>>>24,Y=Ye>>>16&255,Z=65535&Ye,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(Z<16)E>>>=j,S-=j,i.lens[i.have++]=Z;else{if(Z===16){for(Sn=j+2;S<Sn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(E>>>=j,S-=j,i.have===0){e.msg="invalid bit length repeat",i.mode=ss;break}ye=i.lens[i.have-1],N=3+(3&E),E>>>=2,S-=2}else if(Z===17){for(Sn=j+3;S<Sn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=j,S-=j,ye=0,N=3+(7&E),E>>>=3,S-=3}else{for(Sn=j+7;S<Sn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=j,S-=j,ye=0,N=11+(127&E),E>>>=7,S-=7}if(i.have+N>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ss;break}for(;N--;)i.lens[i.have++]=ye}}if(i.mode===ss)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=ss;break}if(i.lenbits=9,ft={bits:i.lenbits},Ne=ew(1,i.lens,0,i.nlen,i.lencode,0,i.work,ft),i.lenbits=ft.bits,Ne){e.msg="invalid literal/lengths set",i.mode=ss;break}if(i.distbits=6,i.distcode=i.distdyn,ft={bits:i.distbits},Ne=ew(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ft),i.distbits=ft.bits,Ne){e.msg="invalid distances set",i.mode=ss;break}if(i.mode=GP,r===BP)break e;case GP:i.mode=HP;case HP:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=E,i.bits=S,s_e(e,P),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,E=i.hold,S=i.bits,i.mode===of&&(i.back=-1);break}for(i.back=0;Ye=i.lencode[E&(1<<i.lenbits)-1],j=Ye>>>24,Y=Ye>>>16&255,Z=65535&Ye,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(Y&&(240&Y)==0){for(de=j,Se=Y,Te=Z;Ye=i.lencode[Te+((E&(1<<de+Se)-1)>>de)],j=Ye>>>24,Y=Ye>>>16&255,Z=65535&Ye,!(de+j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=de,S-=de,i.back+=de}if(E>>>=j,S-=j,i.back+=j,i.length=Z,Y===0){i.mode=16205;break}if(32&Y){i.back=-1,i.mode=of;break}if(64&Y){e.msg="invalid literal/length code",i.mode=ss;break}i.extra=15&Y,i.mode=16201;case 16201:if(i.extra){for(Sn=i.extra;S<Sn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.length+=E&(1<<i.extra)-1,E>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Ye=i.distcode[E&(1<<i.distbits)-1],j=Ye>>>24,Y=Ye>>>16&255,Z=65535&Ye,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((240&Y)==0){for(de=j,Se=Y,Te=Z;Ye=i.distcode[Te+((E&(1<<de+Se)-1)>>de)],j=Ye>>>24,Y=Ye>>>16&255,Z=65535&Ye,!(de+j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=de,S-=de,i.back+=de}if(E>>>=j,S-=j,i.back+=j,64&Y){e.msg="invalid distance code",i.mode=ss;break}i.offset=Z,i.extra=15&Y,i.mode=16203;case 16203:if(i.extra){for(Sn=i.extra;S<Sn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.offset+=E&(1<<i.extra)-1,E>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ss;break}i.mode=16204;case 16204:if(_===0)break e;if(N=P-_,i.offset>N){if(N=i.offset-N,N>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ss;break}N>i.wnext?(N-=i.wnext,G=i.wsize-N):G=i.wnext-N,N>i.length&&(N=i.length),V=i.window}else V=c,G=h-i.offset,N=i.length;N>_&&(N=_),_-=N,i.length-=N;do c[h++]=V[G++];while(--N);i.length===0&&(i.mode=HP);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=HP;break;case T2:if(i.wrap){for(;S<32;){if(m===0)break e;m--,E|=o[u++]<<S,S+=8}if(P-=_,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=po(i)?Do(i.check,c,P,h-P):$T(i.check,c,P,h-P)),P=_,4&i.wrap&&(po(i)?E:J7(E))!==i.check){e.msg="incorrect data check",i.mode=ss;break}E=0,S=0}i.mode=16207;case 16207:if(i.wrap&&po(i)){for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&i.wrap&&E!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ss;break}E=0,S=0}i.mode=16208;case 16208:Ne=d_e;break e;case ss:Ne=q7;break e;case 16210:return Y7;default:return Su}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=E,i.bits=S,(i.wsize||P!==e.avail_out&&i.mode<ss&&(i.mode<T2||r!==K7))&&r$(e,e.output,e.next_out,P-e.avail_out),C-=e.avail_in,P-=e.avail_out,e.total_in+=C,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=po(i)?Do(i.check,c,P,e.next_out-P):$T(i.check,c,P,e.next_out-P)),e.data_type=i.bits+(i.last?64:0)+(i.mode===of?128:0)+(i.mode===GP||i.mode===b2?256:0),(C===0&&P===0||r===K7)&&Ne===Z_&&(Ne=p_e),Ne},af={inflateReset:Z7,inflateReset2:e$,inflateResetKeep:Q7,inflateInit:e=>t$(e,15),inflateInit2:t$,inflate:g_e,inflateEnd:e=>{if(ey(e))return Su;let r=e.state;return r.window&&(r.window=null),e.state=null,Z_},inflateGetHeader:(e,r)=>{if(ey(e))return Su;const i=e.state;return(2&i.wrap)==0?Su:(i.head=r,r.done=!1,Z_)},inflateSetDictionary:(e,r)=>{const i=r.length;let o,c,u;return ey(e)?Su:(o=e.state,o.wrap!==0&&o.mode!==zP?Su:o.mode===zP&&(c=1,c=$T(c,r,i,0),c!==o.check)?q7:(u=r$(e,r,i,i),u?(o.mode=16210,Y7):(o.havedict=1,Z_)))},inflateInfo:"pako inflate (from Nodeca project)"},__e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const i$=Object.prototype.toString,{Z_NO_FLUSH:y_e,Z_FINISH:E_e,Z_OK:tw,Z_STREAM_END:R2,Z_NEED_DICT:I2,Z_STREAM_ERROR:v_e,Z_DATA_ERROR:s$,Z_MEM_ERROR:S_e}=DP;function $P(e){this.options=MP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H7,this.strm.avail_out=0;let i=af.inflateInit2(this.strm,r.windowBits);if(i!==tw)throw new Error(Y_[i]);if(this.header=new __e,af.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=ZT.string2buf(r.dictionary):i$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=af.inflateSetDictionary(this.strm,r.dictionary),i!==tw)))throw new Error(Y_[i])}function b_e(e,r){const i=new $P(r);if(i.push(e),i.err)throw i.msg||Y_[i.err];return i.result}$P.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?E_e:y_e,i$.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=af.inflate(i,h),u===I2&&c&&(u=af.inflateSetDictionary(i,c),u===tw?u=af.inflate(i,h):u===s$&&(u=I2));i.avail_in>0&&u===R2&&i.state.wrap>0&&e[i.next_in]!==0;)af.inflateReset(i),u=af.inflate(i,h);switch(u){case v_e:case s$:case I2:case S_e:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===R2))if(this.options.to==="string"){let _=ZT.utf8border(i.output,i.next_out),E=i.next_out-_,S=ZT.buf2string(i.output,_);i.next_out=E,i.avail_out=o-E,E&&i.output.set(i.output.subarray(_,_+E),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==tw||m!==0){if(u===R2)return u=af.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},$P.prototype.onData=function(e){this.chunks.push(e)},$P.prototype.onEnd=function(e){e===tw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=MP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var T_e={inflate:b_e};const{deflate:w_e}=i_e,{inflate:C_e}=T_e;var R_e=w_e,I_e=C_e,o$=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(o$||{});class A_e{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=E,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&L.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,m;if(o+=4,oe("SHOW_DATASTREAM2_LOG")&&L.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let _=!1;if(m.datas.length>0){const E=m.datas.find(S=>S.id===0);E&&(_=(1&new DataView(E.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:i,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,i),m.setUint8(_++,o),c.forEach(E=>{i?(m.setUint8(_++,E.id),m.setUint8(_++,E.length),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength):(m.setUint8(_++,E.id|E.length<<4),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(r){const i=new DataView(r);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===o$.TWO_BYTE,m=[],_=new DataView(r,2);let E=0;for(;E<u;){let S=0,C=0,P=new ArrayBuffer(0);h?(S=_.getUint8(E),E++,C=_.getUint8(E),E++):(S=15&_.getUint8(E),C=_.getUint8(E)>>4,E++),C>0&&(P=_.buffer.slice(E+2,E+2+C),E+=P.byteLength),m.push({id:S,length:C,data:P})}if(E!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return I_e(new Uint8Array(r))}compress(r){return R_e(new Uint8Array(r))}}const P_e={name:"DataStream",create:(e,r)=>{const i=r?new Mfe(e):new Ufe(e);return i.useDataStream(new A_e),i}};class O_e extends Lr{constructor(r,i,o){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=i,this.ws=new IT("cross-channel-".concat(this.clientId),o),this.ws.on(Zt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Zt.CONNECTED,this.onOpen),this.ws.on(Zt.ON_MESSAGE,this.onMessage),this.ws.on(Zt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new dt((i,o)=>{const c=window.setTimeout(()=>{o(new Oe(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Oe(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(te.WS_DISCONNECT);const i=()=>new dt((h,m)=>{this.ws.once(Zt.CLOSED,()=>m(new Oe(te.WS_ABORT))),this.ws.once(Zt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(r),c=new dt((h,m)=>{const _=()=>{m(new Oe(te.WS_ABORT))};this.ws.once(Zt.RECONNECTING,_),this.ws.once(Zt.CLOSED,_),this.once("req_".concat(o),h),hs(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Zt.RECONNECTING,_),this.ws.off(Zt.CLOSED,_),m(new Oe(te.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Zt.REQUEST_NEW_URLS),this.ws.on(Zt.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class k_e extends Lr{set state(r){r!==this._state&&(r!==ja.RELAY_STATE_FAILURE&&(this.errorCode=Kv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,o,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",ia.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",ja.RELAY_STATE_IDLE),K(this,"errorCode",Kv.RELAY_OK),K(this,"onStatus",h=>{L.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Zp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Zp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Kv.SRC_TOKEN_EXPIRED,this.state=ja.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Kv.DEST_TOKEN_EXPIRED,this.state=ja.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{L.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Zp.NETWORK_DISCONNECTED),this.state=ja.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==ja.RELAY_STATE_IDLE&&(L.error("auto restart channel media relay failed",h.toString()),this.errorCode=Kv.SERVER_CONNECTION_LOST,this.state=ja.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=N_(),this.signal=new O_e(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==ja.RELAY_STATE_IDLE)throw new Oe(te.INVALID_OPERATION);this.state=ja.RELAY_STATE_CONNECTING,await this.connect(),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new Oe(te.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new Oe(te.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new Oe(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==ja.RELAY_STATE_RUNNING)throw new Oe(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==ja.RELAY_STATE_RUNNING)throw new Oe(te.INVALID_OPERATION);const i=this.genMessage(No.SetVideoProfile);await this.signal.request(i),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),L.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ja.RELAY_STATE_IDLE,this.dispose()}dispose(){L.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ia.CancelToken.source(),this.state=ja.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Bme(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",Zp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(No.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(No.SetSdkProfile,r);await this.signal.request(o),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(No.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Zp.PACKET_JOINED_SRC_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(No.SetSourceUserId,r);await this.signal.request(u),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(No.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Zp.PACKET_JOINED_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(No.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",Zp.PACKET_SENT_TO_DEST_CHANNEL),this.state=ja.RELAY_STATE_RUNNING,L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(No.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",Zp.PACKET_UPDATE_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(No.StopPacketTransfer);await this.signal.request(r),L.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:bl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(r){case No.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case No.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case No.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case No.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case No.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case No.Reconnect:return h.clientRequest={command:"Reconnect"},h;case No.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case No.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case No.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const N_e={name:"ChannelMediaRelay",create:function(e){return new k_e(e.joinInfo,e.clientId,e.websocketRetryConfig||Ci,e.httpRetryConfig||Ci,e.resolution)}};function a$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function nw(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?a$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class D_e extends Lr{constructor(r,i,o,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(It.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Qp.TRANSCODE?1:2}),this.emit(Lm.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new IT("live-streaming",o),this.websocket.on(Zt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Zt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Zt.REQUEST_NEW_URLS,(u,h)=>{Ps(this,Lm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Zt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(te.UNEXPECTED_ERROR);const m=nw({command:r,sdkVersion:bl==="4.23.2"?"0.0.1":bl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new Oe(te.WS_DISCONNECT);const _=()=>new dt((P,N)=>{this.websocket.once(Zt.CLOSED,()=>N(new Oe(te.WS_ABORT))),this.websocket.once(Zt.CONNECTED,P)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new dt((P,N)=>{const G=()=>{N(new Oe(te.WS_ABORT))};this.websocket.once(Zt.RECONNECTING,G),this.websocket.once(Zt.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),V=>{P(V)})});c&&It.workerEvent(this.spec.sid,nw(nw({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let C=null;try{C=await E}catch(P){if(this.websocket.state==="closed")throw P;return await _(),await this.request(r,i,o)}return c&&It.workerEvent(this.spec.sid,nw(nw({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(C.serverResponse),serverCode:C.code,success:C.code===200,responseTime:Date.now()-S})),C.code!==200&&this.handleResponseError(C),C}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=bl==="4.23.2"?"0.0.1":bl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Ni.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void L.warning("live stream response already exists stream");case Ni.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ni.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ni.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Ni.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ni.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Ni.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new Oe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Lm.WARNING,i,r.serverResponse.url)}case Ni.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new Oe(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Lm.WARNING,i,r.serverResponse.url)}case Ni.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ni.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Ni.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new Oe(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Lm.WARNING,i,r.serverResponse.url)}case Ni.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Ni.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ni.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ni.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ni.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ni.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ni.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ni.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ni.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(DA)},6e3)}}function c$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ba(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?c$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class L_e extends Lr{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ci,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ci;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new Vs("live-streaming")),K(this,"cancelToken",ia.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=Ba(Ba({},vme),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(L.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>Ba(Ba(Ba({},Eme),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Fr(h.width)||ir(h.width,"config.width",0,1e4),Fr(h.height)||ir(h.height,"config.height",0,1e4),Fr(h.videoBitrate)||ir(h.videoBitrate,"config.videoBitrate",1,1e6),Fr(h.videoFrameRate)||ir(h.videoFrameRate,"config.videoFrameRate"),Fr(h.lowLatency)||qp(h.lowLatency,"config.lowLatency"),Fr(h.audioSampleRate)||Ui(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Fr(h.audioBitrate)||ir(h.audioBitrate,"config.audioBitrate",1,128),Fr(h.audioChannels)||Ui(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Fr(h.videoGop)||ir(h.videoGop,"config.videoGop"),Fr(h.videoCodecProfile)||Ui(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Fr(h.userCount)||ir(h.userCount,"config.userCount",0,17),Fr(h.backgroundColor)||ir(h.backgroundColor,"config.backgroundColor",0,16777215),Fr(h.userConfigExtraInfo)||ds(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Fr(h.transcodingUsers)&&(Yp(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{rP(m.uid),Fr(m.x)||ir(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Fr(m.y)||ir(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Fr(m.width)||ir(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Fr(m.height)||ir(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Fr(m.zOrder)||ir(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Fr(m.alpha)||ir(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Fr(h.watermark)||Px(h.watermark,"watermark"),Fr(h.backgroundImage)||Px(h.backgroundImage,"backgroundImage"),h.images&&!Fr(h.images)&&(Yp(h.images,"config.images"),h.images.forEach((m,_)=>{Px(m,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>Ba(Ba(Ba({},Ax),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(Ba(Ba(Ba({},Ax),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(Ba(Ba(Ba({},Ax),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>Ba({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?dt.resolve(h.uid):O9(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await dt.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(jc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});L.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{L.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{L.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{L.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(r,i,o){if(!this.transcodingConfig&&i===Qp.TRANSCODE)throw new Oe(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};L.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Oe(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case Qp.TRANSCODE:c.transcodingConfig=Ba({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new dt((E,S)=>{hs(this.retryTimeout).then(()=>{if(o)return S(o);const C=this.statusError.get(r);return C?(this.statusError.delete(r),S(C)):void 0})}),_=await dt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===Qp.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,L.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,m)):await this.startLiveStreamingTask(r,i,m)}}stopLiveStreamingTask(r){return new dt((i,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===Qp.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var r;const i=Array.from(jc(r=this.streamingTasks).call(r));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ia.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await Ps(this,Ox.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new D_e(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Lm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Lm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Lm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ps(this,Ox.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=r.reason;switch(r.code){case Ni.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ni.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ni.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ni.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return L.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case Ni.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case Ni.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ni.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(jc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(L.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{L.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{L.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const x_e={name:"LiveStreaming",create:function(e){return new L_e(e.joinInfo,e.websocketRetryConfig||Ci,e.httpRetryConfig||Ci)}};function M_e(e){let r=d$();return function(i,o){let c=i.appId;c!==void 0&&(Qn(o,10),Ah(o,c));let u=i.cid;u!==void 0&&(Qn(o,16),Qn(o,u));let h=i.cname;h!==void 0&&(Qn(o,26),Ah(o,h));let m=i.deviceId;m!==void 0&&(Qn(o,34),Ah(o,m));let _=i.elapse;_!==void 0&&(Qn(o,40),qm(o,_));let E=i.fileSize;E!==void 0&&(Qn(o,48),qm(o,uS(E)));let S=i.height;S!==void 0&&(Qn(o,56),qm(o,uS(S)));let C=i.jpg;C!==void 0&&(Qn(o,66),Qn(o,C.length),function(ua,je){let it=dS(ua,je.length);ua.bytes.set(je,it)}(o,C));let P=i.networkType;P!==void 0&&(Qn(o,72),qm(o,uS(P)));let N=i.osType;N!==void 0&&(Qn(o,80),qm(o,uS(N)));let G=i.requestId;G!==void 0&&(Qn(o,90),Ah(o,G));let V=i.sdkVersion;V!==void 0&&(Qn(o,98),Ah(o,V));let j=i.sequence;j!==void 0&&(Qn(o,104),qm(o,uS(j)));let Y=i.sid;Y!==void 0&&(Qn(o,114),Ah(o,Y));let Z=i.timestamp;Z!==void 0&&(Qn(o,120),qm(o,Z));let de=i.uid;de!==void 0&&(Qn(o,128),Qn(o,de));let Se=i.vid;Se!==void 0&&(Qn(o,136),Qn(o,Se));let Te=i.width;Te!==void 0&&(Qn(o,144),qm(o,uS(Te)));let ye=i.service;ye!==void 0&&(Qn(o,152),Qn(o,ye));let Ne=i.callbackData;Ne!==void 0&&(Qn(o,162),Ah(o,Ne));let Ye=i.jpgEncryption;Ye!==void 0&&(Qn(o,168),Qn(o,Ye));let ht=i.requestType;ht!==void 0&&(Qn(o,176),Qn(o,ht));let ft=i.scorePorn;ft!==void 0&&(Qn(o,185),N2(o,ft));let Sn=i.scoreSexy;Sn!==void 0&&(Qn(o,193),N2(o,Sn));let bn=i.scoreNeutral;bn!==void 0&&(Qn(o,201),N2(o,bn));let pr=i.scene;pr!==void 0&&(Qn(o,208),Qn(o,pr));let ai=i.ossFilePrefix;ai!==void 0&&(Qn(o,218),Ah(o,ai));let $r=i.serviceVendor;if($r!==void 0)for(let ua of $r){Qn(o,226);let je=d$();F_e(ua,je),Qn(o,je.limit),z_e(o,je),W_e(je)}}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function U_e(e){return function(i){let o={};e:for(;!h$(i);){let c=Ph(i);switch(c>>>3){case 0:break e;case 1:o.code=Ph(i);break;case 2:o.msg=p$(i,Ph(i));break;case 3:{let u=j_e(i);o.data=V_e(i),i.limit=u;break}default:l$(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function V_e(e){let r={};e:for(;!h$(e);){let i=Ph(e);switch(i>>>3){case 0:break e;case 1:r.requestId=p$(e,Ph(e));break;case 2:r.requestType=Ph(e)>>>0;break;case 3:r.scorePorn=k2(e);break;case 4:r.scoreSexy=k2(e);break;case 5:r.scoreNeutral=k2(e);break;case 6:r.requestScene=Ph(e)>>>0;break;case 7:r.scene=Ph(e)>>>0;break;default:l$(e,7&i)}}return r}function F_e(e,r){let i=e.service;i!==void 0&&(Qn(r,8),Qn(r,i));let o=e.vendor;o!==void 0&&(Qn(r,16),Qn(r,o));let c=e.token;c!==void 0&&(Qn(r,26),Ah(r,c));let u=e.callbackUrl;u!==void 0&&(Qn(r,34),Ah(r,u))}function j_e(e){let r=Ph(e),i=e.limit;return e.limit=e.offset+r,i}function l$(e,r){switch(r){case 0:for(;128&f$(e););break;case 2:P2(e,Ph(e));break;case 5:P2(e,4);break;case 1:P2(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let B_e=new Float32Array(1);new Uint8Array(B_e.buffer);let A2=new Float64Array(1),Wa=new Uint8Array(A2.buffer);function uS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let u$=[];function d$(){const e=u$.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function W_e(e){u$.push(e)}function P2(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function h$(e){return e.offset>=e.limit}function dS(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function O2(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function p$(e,r){let i=O2(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,E,S,C,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(C=(31&P)<<6|63&_,C<128?h+=u:(h+=o(C),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],E=c[m+i+2],(49344&(_|E<<8))!=32896?h+=u:(C=(15&P)<<12|(63&_)<<6|63&E,C<2048||C>=55296&&C<=57343?h+=u:(h+=o(C),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],E=c[m+i+2],S=c[m+i+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(C=(7&P)<<18|(63&_)<<12|(63&E)<<6|63&S,C<65536||C>1114111?h+=u:(C-=65536,h+=o(55296+(C>>10),56320+(1023&C)),m+=3))):h+=u}return h}function Ah(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Qn(e,o);let c=dS(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function z_e(e,r){let i=dS(e,r.limit),o=e.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+i]=c[u]}function f$(e){return e.bytes[O2(e,1)]}function m$(e,r){let i=dS(e,1);e.bytes[i]=r}function k2(e){let r=O2(e,8),i=e.bytes;return Wa[0]=i[r++],Wa[1]=i[r++],Wa[2]=i[r++],Wa[3]=i[r++],Wa[4]=i[r++],Wa[5]=i[r++],Wa[6]=i[r++],Wa[7]=i[r++],A2[0]}function N2(e,r){let i=dS(e,8),o=e.bytes;A2[0]=r,o[i++]=Wa[0],o[i++]=Wa[1],o[i++]=Wa[2],o[i++]=Wa[3],o[i++]=Wa[4],o[i++]=Wa[5],o[i++]=Wa[6],o[i++]=Wa[7]}function Ph(e){let r,i=0,o=0;do r=f$(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function Qn(e,r){for(r>>>=0;r>=128;)m$(e,127&r|128),r>>>=7;m$(e,r)}function qm(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=dS(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function g$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const G_e=new Map([["moderation",1],["supervise",2]]);class H_e extends Lr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(is.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=sc(i=r.map(o=>G_e.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",mu.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",ia.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==mu.CONNECTED)throw new Oe(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===mu.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=dr(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new IT("worker-manager-"+this._inspectId,Ci),this.on(is.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,L.debug("[".concat(this._inspectId,"] Inspect operation :").concat(gu[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new IT("worker-"+this._inspectId,Ci),this.handleWorkerEvents()}async init(r,i){this.emit(is.STATE_CHANGE,gu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new dt((c,u)=>{this.on(is.CONNECTION_STATE_CHANGE,(h,m)=>{m===mu.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,i,o){const c=oe("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,E,S){let{appId:C,areaCode:P,cname:N,sid:G,token:V,uid:j}=_;eS++;const Y="image_moderation_api",Z={service_name:Y,json_body:JSON.stringify({appId:C,areaCode:P,cname:N,command:"allocateEdge",requestId:eS,seq:eS,sid:G,token:V,ts:Date.now(),uid:j+""})};let de,Se,Te=m[0];return fd(async()=>{de=Date.now();const ye=await Ed(Te,{data:Z,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Se=Date.now()-de,ye.code!==0){const ft=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ye.code,{retry:!0,responseTime:Se});throw L.error(ft.toString()),ft}const Ne=JSON.parse(ye.json_body);if(Ne.code!==200){const ft=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:Se});throw L.error(ft.toString()),ft}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const ft=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:Se});throw L.error(ft.toString()),ft}const Ye=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ht=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(ft=>{let{address:Sn,wss:bn}=ft;if(Sn&&bn)return"wss://".concat(Sn.replace(/\./g,"-"),".").concat(Ye,":").concat(ht||bn)}).filter(ft=>!!ft),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:Se}},(ye,Ne)=>(It.apworkerEvent(G,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ye.addressList),firstSuccess:Ne===0,responseTime:Se,serverIp:m[Ne%m.length]}),!1),(ye,Ne)=>(It.apworkerEvent(G,{success:!1,sc:ye.data&&ye.data.code||200,serviceName:Y,responseTime:Se,serverIp:m[Ne%m.length]}),!!(ye.code!==te.OPERATION_ABORTED&&ye.code!==te.UNEXPECTED_RESPONSE||ye.data&&ye.data.retry)&&(Te=m[(Ne+1)%m.length],!0)),S)}(c,r,i,o);this.emit(is.STATE_CHANGE,gu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(is.STATE_CHANGE,gu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Zt.CONNECTED,async()=>{this.emit(is.STATE_CHANGE,gu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Zt.CLOSED,()=>{this._innerConnectionState<gu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Zt.FAILED,()=>{this._innerConnectionState<gu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Zt.RECONNECTING,()=>{this._innerConnectionState<gu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Zt.ON_MESSAGE,async r=>{this.emit(is.STATE_CHANGE,gu.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw L.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw L.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(is.STATE_CHANGE,gu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(is.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Zt.WILL_RECONNECT,(r,i,o)=>{o(r)}),this.workerManagerConnection.on(Zt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Zt.CONNECTED,async()=>{this.emit(is.STATE_CHANGE,gu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=mu.CONNECTED}),this.workerConnection.on(Zt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=U_e(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&L.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(is.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=sc(i=Object.keys(c)).call(i,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(is.INSPECT_RESULT,h)}else this.emit(is.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(is.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else L.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(is.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Zt.CLOSED,()=>{this.connectionState=mu.CLOSED}),this.workerConnection.on(Zt.FAILED,()=>{this.connectionState=mu.CLOSED}),this.workerConnection.on(Zt.RECONNECTING,()=>{this.connectionState=this.connectionState===mu.CONNECTED?mu.RECONNECTING:mu.CONNECTING}),this.workerConnection.on(Zt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(Zt.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(is.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const r=Wc(this,is.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(is.INSPECT_RESULT,void 0,new Oe(te.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(is.INSPECT_RESULT,void 0,new Oe(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),C=await JW(S,o,c),P=this.sequence+"-"+u+"-"+_+"-"+E+"-"+dr(12,""),N={appId:o,cid:u,cname:c,deviceId:"",elapse:(G=Number(E-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:C.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:C,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:wH(E),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const V=M_e(N);if(V.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(Y){for(var Z=1;Z<arguments.length;Z++){var de=arguments[Z]!=null?arguments[Z]:{};Z%2?g$(Object(de),!0).forEach(function(Se){K(Y,Se,de[Se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(de)):g$(Object(de)).forEach(function(Se){Object.defineProperty(Y,Se,Object.getOwnPropertyDescriptor(de,Se))})}return Y}({},N);delete j.jpg,L.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return V}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ia.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=mu.CLOSED,this.emit(is.STATE_CHANGE,gu.CLOSED)}}const $_e={name:"ContentInspect",create:function(e){let{config:r}=e;return function(i){if(!i)throw new Oe(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new Oe(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!st(u=["supervise","moderation"]).call(u,c))throw new Oe(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new Oe(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new H_e(r)}};var _$=l(_t.Object.getOwnPropertySymbols),K_e=Wn,q_e=Qo.indexOf,Y_e=Sp,D2=se([].indexOf),y$=!!D2&&1/D2([1],1,-0)<0;K_e({target:"Array",proto:!0,forced:y$||!Y_e("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return y$?D2(this,e,r)||0:q_e(this,e,r)}});var X_e=ic("Array").indexOf,J_e=k,Q_e=X_e,L2=Array.prototype,Z_e=function(e){var r=e.indexOf;return e===L2||J_e(L2,e)&&r===L2.indexOf?Q_e:r},E$=l(Z_e);function eye(e,r){if(e==null)return{};var i,o,c=function(h,m){if(h==null)return{};var _,E,S={},C=FG(h);for(E=0;E<C.length;E++)_=C[E],E$(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,r);if(_$){var u=_$(e);for(o=0;o<u.length;o++)i=u[o],E$(r).call(r,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let v$=class{get localCapabilities(){return Br(this._localCapabilities)}get rtpCapabilities(){return Br(this._rtpCapabilities)}get candidates(){return Br(this._candidates)}get iceParameters(){return Br(this._iceParameters)}get dtlsParameters(){return Br(this._dtlsParameters)}constructor(e){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),e=Br(e);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:E}=e;let S;this.setup=m,S=h===ko.RECEIVE_ONLY?Fa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Fa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u;const C=h===ko.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===ko.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=h===ko.RECEIVE_ONLY?c.send.videoCodecs:OT(gt.VIDEO,C,P,_),G=h===ko.RECEIVE_ONLY?c.send.audioCodecs:OT(gt.AUDIO,C,P,E);for(const V of S.mediaDescriptions)V.attributes.iceUfrag=r.iceUfrag,V.attributes.icePwd=r.icePwd,V.attributes.fingerprints=i.fingerprints,V.attributes.candidates=o,V.attributes.setup=this.setup,V.media.mediaType==="application"&&(V.attributes.sctpPort="5000"),V.media.mediaType==="video"&&(V.media.fmts=N.map(j=>j.payloadType.toString(10)),V.attributes.payloads=N,V.attributes.extmaps=C.videoExtensions),V.media.mediaType==="audio"&&(V.media.fmts=G.map(j=>j.payloadType.toString(10)),V.attributes.payloads=G,V.attributes.extmaps=C.audioExtensions,Zv(V));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Dm(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=B_(r,this.cname,oe("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Vr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let E;return _===-1?(E=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(E=Br(this.sessionDesc.mediaDescriptions[_]),E.attributes.direction="sendonly",E.attributes.ssrcs=u,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(E,c)),Vr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(m=Br(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),E={foundation:r??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===E.priority&&S.connectionAddress===E.connectionAddress&&S.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=OT(u,h,this.localCapabilities.send,u===gt.AUDIO?c:o),_=u===gt.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};S=this.mungRecvMediaDsec(S,e);const C=this.findFirstClosedMedia(u);if(C){const P=this.sessionDesc.mediaDescriptions.indexOf(C);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Vr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(e){const r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(e){e=Br(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,i,o,c,u){const h=this.rtpCapabilities.send,m=e===gt.VIDEO?h.videoCodecs:h.audioCodecs,_=e===gt.VIDEO?h.videoExtensions:h.audioExtensions;Vr()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,u);const S=this.findFirstClosedMedia(e);if(S){const C=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[C]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(e,r,i){const o=Br(e);return xx(o),Qv(o,r),Mx(o,r),u9(o),uP(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,r){const i=Br(e);return uP(i,r,this.localCapabilities.recv),Zv(i),i}updateRecvMedia(e,r){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>Vr()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const tye=["sdp"];var _r;function S$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ym(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?S$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let b$=(_r=class wS extends HG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,o){super(r,i),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new Vs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(wS.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??ko.SEND_ONLY,this.name=this.direction===ko.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=YL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Vr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await h9();if(this.localCapabilities=dP(i),r){const{sdp:o}=r,c=eye(r,tye),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},C=PT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(_u(C,S,"videoExtensions",P,N,G),_u(C,S,"videoCodecs",P,N,G),_u(C,S,"audioExtensions",P,N,G),_u(C,S,"audioCodecs",P,N,G),oe("RAISE_H264_BASELINE_PRIORITY")){const V=G.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(V!==-1){const j=G.videoCodecs.findIndex(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<V){L.debug("raising H264 baseline profile priority");const Y=G.videoCodecs[V];G.videoCodecs.splice(V,1),G.videoCodecs.splice(j,0,Y)}j!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>!(Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Y.fmtp&&Y.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:N,sendrecv:G}}({},{},o);this.remoteSDP=new v$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Vm(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await p9({},{},h.sdp);this.localCapabilities=dP(_);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),Ym(Ym({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Vm(o.sdp);return this.initialOffer=o,Ym(Ym({},c),{},{sdp:o.sdp})}}catch(i){throw new xe(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=r,u=await p9({},{},i);this.remoteSDP=new v$({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new xe(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return Sl(function*(){const u=yield kn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,i,o);r.forEach((j,Y)=>{if(m[Y].needCreateTransceiver){const Z=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});h.push(Z),j._updateRtpTransceiver(Z)}else{const Z=c.peerConnection.getTransceivers().find(de=>de.mid===m[Y].mid);if(!Z)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Y].mid));h.push(Z),j._updateRtpTransceiver(Z)}}),Vr()&&oe("SIMULCAST")===!0&&(yield kn(c.applySimulcastForFirefox(h,r)));const _=m.map(j=>j.mid),E=yield kn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(E.sdp,r,_),C=Fa(S),P=_.map(j=>{const Y=C.mediaDescriptions.find(Z=>Z.attributes.mid===j);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return a9(Y,oe("USE_PUB_RTX"))}),N=h.map((j,Y)=>{const Z=_[Y];return{localSSRC:P[Y],id:Z}});yield kn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield N}catch(j){const Y=c.remoteSDP.toString();throw yield kn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield kn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield kn(c.stopSending(_,!0)),j}yield kn(c.applySimulcastEncodings(h,r)),yield kn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),V=c.logSDPExchange(S,"offer","local","send");return V==null||V(G),yield kn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((j,Y)=>{const Z=_[Y];return{localSSRC:P[Y],id:Z}})}catch(h){throw h instanceof xe?h:new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var E;_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const _=this.remoteSDP.toString(),E=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),C=this.mungReceiveAnswerSDP(S.sdp,u,r);E==null||E(C||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:C}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(E.sdp,u,r);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===D_.Auto&&(this.store.p2pTransport=D_.SdRtn,Vn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(wS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Vn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(wS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Vm(i.sdp);return this.store.descriptionStart(),this.direction===ko.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===ko.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Vm(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?Vr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Ym(Ym({},mh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Ym(Ym({},mh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;st(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(gT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...wS.turnServerConfigToIceServers(r.turnServer.servers,i,o)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...wS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,o)),st(u=[D_.Relay,D_.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Vn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),L.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);L.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case D_.SdRtn:const m=r.filter(E=>{var S;return st(S=E.username).call(S,"glb:")&&E.turnServerURL==E.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Mm(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Mm(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case D_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Mm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Mm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!i)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:C,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),st(h=r._hints).call(h,hr.LOW_STREAM)&&(C&&(u.maxFramerate=pc(C)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(oe("DSCP_TYPE")&&Kp()){var m;const S=oe("DSCP_TYPE");st(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=i.getParameters(),E=(o=_.encodings)===null||o===void 0?void 0:o[0];Vr()&&!E&&(c.encodings=[u]),E&&Object.assign(E,u),Object.assign(_,c),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(r,i){try{if(!Vn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof vr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=Fa(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===m);_&&(Qv(_,u),d9(_,u,this.store.codec))}),Dm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const E=r[_],S=i[_];if(S instanceof vr&&!st(o=S._hints).call(o,hr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const C={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=E.sender.getParameters();await E.sender.setParameters(Object.assign(N,C))}}}async applySimulcastEncodings(r,i){if(!Vr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof vr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof vr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=r._hints).call(i,hr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(oe("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=Fa(i).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),st(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,o){const c=Fa(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===gt.AUDIO&&u.media.mediaType==="audio"&&Zv(u),Dm(c)}},St(_r.prototype,"establish",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"establish"),_r.prototype),St(_r.prototype,"connect",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"connect"),_r.prototype),St(_r.prototype,"receive",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"receive"),_r.prototype),St(_r.prototype,"mockReceive",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"mockReceive"),_r.prototype),St(_r.prototype,"stopReceiving",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"stopReceiving"),_r.prototype),St(_r.prototype,"restartICE",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"restartICE"),_r.prototype),St(_r.prototype,"close",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"close"),_r.prototype),St(_r.prototype,"updateEncoderConfig",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"updateEncoderConfig"),_r.prototype),St(_r.prototype,"updateSendParameters",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"updateSendParameters"),_r.prototype),St(_r.prototype,"replaceTrack",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"replaceTrack"),_r.prototype),St(_r.prototype,"muteLocal",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"muteLocal"),_r.prototype),St(_r.prototype,"unmuteLocal",[bu],Object.getOwnPropertyDescriptor(_r.prototype,"unmuteLocal"),_r.prototype),_r);function bu(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}let Sd=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var T$,w$,C$,R$,I$,A$,P$,O$,k$,N$,D$,Nr;function L$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function KP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?L$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):L$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let nye=(T$=bd(Sd.SEND_ONLY),w$=bd(Sd.SEND_ONLY),C$=bd(),R$=bd(Sd.RECEIVE_ONLY),I$=bd(Sd.RECEIVE_ONLY),A$=bd(Sd.RECEIVE_ONLY),P$=bd(Sd.RECEIVE_ONLY),O$=bd(Sd.RECEIVE_ONLY),k$=bd(Sd.RECEIVE_ONLY),N$=bd(),D$=bd(Sd.RECEIVE_ONLY),Nr=class extends Lr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(Lt.StateChange,r,this._state)}constructor(e,r){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",qn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==qn.Connected)return void c(new xe(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const E=_.find(N=>N[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(N=>{let[,{id:G}]=N;return G}));let S=!1;var h,m;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Ke.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Ke.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const C=this.createMuteMessage(_);await ur(this,Lt.RequestMuteLocal,C);const P=i.trackMediaType==="video"?xm.MUTE_LOCAL_VIDEO:xm.MUTE_LOCAL_AUDIO;await ur(this,Lt.RequestP2PMuteLocal,{action:P,message:C,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==qn.Connected)return void c(new xe(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const m=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?xm.UNMUTE_LOCAL_VIDEO:xm.UNMUTE_LOCAL_AUDIO;await ur(this,Lt.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==qn.Connected)return void o();const{id:E,track:S}=_;E&&(await this.sendConnection.updateSendParameters(E,S),await this.sendConnection.updateEncoderConfig(E,S),this.emit(Lt.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==qn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;L.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:C}]=S;return i===C});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==qn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,E[1].id)),E[0]===Ke.LocalVideoTrack&&Vn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(S){const C=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=C,S.track._originMediaStreamTrack=C,await new dt((P,N)=>{this.handleReplaceTrack(S.track,P,N,!0)})}}o()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new Q9(e),this.bindStatsUploaderEvents(),this.sendMutex=new Vs("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Vs("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new xe(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new xe(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let i;try{if(r){this.recvConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new b$(e,this.store,ko.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=qn.New,this.sendConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new b$(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new xe(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=qn.Connected}async addRemoteCandidate(e,r){if(r===ko.RECEIVE_ONLY){if(!this.sendConnection)throw new xe(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new xe(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,i){var o=this;return Sl(function*(){const c=yield kn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==qn.Connected){o.throwIfTrackTypeNotMatch(e);const E=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(E))}o.store.pubId=o.store.pubId+1,Bs.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,r,i);if(u.length===0)return void(yield kn(o.tryToUnmuteAudio(e)));u.forEach(E=>{let{track:S,type:C}=E;const P=Date.now();o.store.publish(S.getTrackId(),C===Ke.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield kn(o.sendConnection.send(u.map(E=>{let{track:S}=E;return S}),o.store.codec,o.store.audioCodec)),m=(yield kn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(E){throw h.throw(E),(E==null?void 0:E.code)===te.WS_ABORT&&u.forEach(S=>{let{track:C}=S;o.pendingLocalTracks.indexOf(C)===-1&&o.pendingLocalTracks.push(C)}),o.unbindLocalTrackEvents(u),E}yield kn(h.next()),u.forEach(E=>{let{type:S}=E;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(E=>{let{track:S,type:C}=E;const P=Date.now();o.store.publish(S.getTrackId(),C===Ke.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==qn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!st(e).call(e,c)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===qn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:Kme(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):i.push(m)}),r.length>0&&r.forEach(o=>{ur(this,Lt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{ur(this,Lt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Sl(function*(){throw new xe(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ps(this,Lt.RequestRePublish,this.pendingLocalTracks),this.emit(Lt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new xe(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,i,o){var c;if(!this.recvConnection)throw new xe(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:i}],String(e.uid),o);r===gt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Gv(u,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new zv(u,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(S=>{let{user:C,kind:P}=S;return C.uid===e.uid&&r===P});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Lt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,i,o){if(!this.recvConnection)throw new xe(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===e.uid&&r===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var m;if(h===gt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===gt.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,E;if(m===gt.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===gt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===gt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;ur(this,Lt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[gt.VIDEO,gt.AUDIO].forEach(o=>{i.has(o)?ur(this,Lt.RequestP2PUnmuteRemote,o):ur(this,Lt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new xe(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new xe(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new xe(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new xe(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof ki){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ke.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ke.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ke.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=o?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);It.publish(this.store.sessionId,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Hr),m=o?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof vr);It.publish(this.store.sessionId,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===gt.VIDEO?i._videoSSRC:i._audioSSRC;c&&It.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:i.uid,subscribeRequestid:o===gt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Bs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Vs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Vs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ke.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ki){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=qn.Disconnected}getStats(e){var r,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ke.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ke.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof vr||r&&r.track instanceof Hr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(Gc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=eT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=qn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case Ke.LocalVideoTrack:st(r=o._hints).call(r,hr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ke.LocalAudioTrack:o instanceof ki?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ke.LocalVideoLowTrack:}}),this.emit(Lt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Gc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Lt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof jm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let i,o;if(e===ko.SEND_ONLY){if(!this.sendConnection)throw new xe(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new xe(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Ps(this,Lt.RequestP2PRestartICE,{direction:ko.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),i=this.localTrackMap.get(Ke.LocalAudioTrack),o=e.videoSend.find(N=>{var G;return N.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=e.audioSend.find(N=>{var G;return N.ssrc===(i==null||(G=i.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!o||!c)return 1;const u=Wc(this,Lt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,E=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,C=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(hr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=e.bitrate.actualEncoded;if(N&&G){const V=(1e3*N-G)/(1e3*N);return MG[V<.15?0:V<.3?1:V<.45?2:V<.6?3:4][C]}}return C}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(G=>G.ssrc===c),m=e.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const _=Wc(this,Lt.NeedSignalRTT),E=e.rtt,S=(E&&_?(E+_)/2:E||_)||0,C=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let N=.7*P*100/50+.3*S/1500;C&&(N=.6*P*100/50+.2*S/1500+.2*C/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new dt((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}filterTobePublishedTracks(e,r,i){const o=[],c=Vn(),u=this.getAllTracks();e=Ov(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof vr&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new xe(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ke.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(_,i);o.push({track:E,type:Ke.LocalVideoLowTrack})}if(_ instanceof Hr){const E=this.localTrackMap.get(Ke.LocalAudioTrack);if(E){if(!(E.track instanceof ki))throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(C=>{let{type:P}=C;return P===Ke.LocalAudioTrack});if(!(S.track instanceof ki))throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof ki||_._bypassWebAudio)o.push({track:_,type:Ke.LocalAudioTrack});else{const S=new ki;S.addAudioTrack(_),o.push({track:S,type:Ke.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=Ov(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Hr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof ki?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(o instanceof vr){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ke.LocalVideoTrack:i.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof ki?e.trackList.forEach(i=>{i.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ke.LocalVideoTrack:i.off(Et.GET_STATS,this.handleGetLocalVideoStats),i.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ki?e.trackList.forEach(r=>{r.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Et.GET_STATS,this.handleGetLocalAudioStats),r.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Et.GET_STATS,this.handleGetLocalAudioStats),e.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof zv&&r.addListener(Et.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof Gv&&r.addListener(Et.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,{track:h,type:m}=i;switch(m){case Ke.LocalAudioTrack:u=Yn.Audio;break;case Ke.LocalVideoTrack:u=st(c=h._hints).call(c,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:u=Yn.Low}return{kind:m===Ke.LocalAudioTrack?gt.AUDIO:gt.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalAudioTrack:o=Yn.Audio;break;case Ke.LocalVideoLowTrack:o=Yn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var i;L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(Lt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),st(i=this._restartStates).call(i,r)&&!e.isInRestartIce&&(r==="disconnected"&&await hs(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),It.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:jr.TRACER}).onSuccess(),this.emit(Lt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(Gc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Vv.FIRST_FRAME_DECODED),It.firstRemoteFrame(this.store.sessionId,Hi.FIRST_AUDIO_DECODE,Or.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(Gc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&It.firstRemoteFrame(this.store.sessionId,Hi.FIRST_AUDIO_RECEIVED,Or.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(Gc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&It.firstRemoteFrame(this.store.sessionId,Hi.FIRST_VIDEO_RECEIVED,Or.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(Lt.ConnectionTypeChange,o),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Um(i))," -> ").concat(JSON.stringify(Um(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Um(i))," -> ").concat(JSON.stringify(Um(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(Lt.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===ko.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,L.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===ko.SEND_ONLY?this.restartICE(e):Ps(this,Lt.RequestP2PRestartICE,{direction:ko.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get(Ke.LocalAudioTrack);if(e instanceof Hr&&(i==null?void 0:i.track)instanceof ki)return i.track.isActive||r.push([Ke.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get(Ke.LocalAudioTrack);if(e instanceof Hr&&(i==null?void 0:i.track)instanceof ki)return i.track.isActive&&r.push([Ke.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ke.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=Yn.Audio;break;case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:o=Yn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=Yn.Audio;break;case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:o=Yn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Ke.LocalVideoTrack),i=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new dt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new dt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Hr){const i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await ur(this,Lt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(Lt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(Lt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await hs(zL(this.dtlsFailedCount,Ci)),this.emit(Lt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof vr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof vr).length>1)throw new xe(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Hr).length>1&&(e.some(r=>r instanceof Hr&&r._bypassWebAudio)||!Vn().webAudioMediaStreamDest))throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof vr&&this.pendingLocalTracks.some(i=>i instanceof vr))throw new xe(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Hr&&this.pendingLocalTracks.some(i=>i instanceof Hr)&&(!Vn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Hr&&i._bypassWebAudio)))throw new xe(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const i=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding,o=KP(KP({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?e._mediaStreamTrack.clone():Qx(e,o);const u=dr(8,"track-low-"),h=new vr(c,KP(KP({},i&&{scaleResolutionDownBy:Lx(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(L_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Mv.LOW_STREAM)}),h._hints.push(hr.LOW_STREAM),e.addListener(Et.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(Gc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");It.firstRemoteVideoDecode(this.store.sessionId,Hi.FIRST_VIDEO_DECODE,Or.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new xe(te.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new xe(te.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new xe(te.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new xe(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new xe(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new xe(te.NOT_SUPPORTED)}async preConnect(e){throw new xe(te.NOT_SUPPORTED)}getEstablishParams(){throw new xe(te.NOT_SUPPORTED)}async reSubscribe(e){throw new xe(te.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new xe(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===Ke.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Mv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},St(Nr.prototype,"p2pConnect",[T$],Object.getOwnPropertyDescriptor(Nr.prototype,"p2pConnect"),Nr.prototype),St(Nr.prototype,"unpublish",[w$],Object.getOwnPropertyDescriptor(Nr.prototype,"unpublish"),Nr.prototype),St(Nr.prototype,"unpublishLowStream",[C$],Object.getOwnPropertyDescriptor(Nr.prototype,"unpublishLowStream"),Nr.prototype),St(Nr.prototype,"subscribe",[R$],Object.getOwnPropertyDescriptor(Nr.prototype,"subscribe"),Nr.prototype),St(Nr.prototype,"mockSubscribe",[I$],Object.getOwnPropertyDescriptor(Nr.prototype,"mockSubscribe"),Nr.prototype),St(Nr.prototype,"unsubscribe",[A$],Object.getOwnPropertyDescriptor(Nr.prototype,"unsubscribe"),Nr.prototype),St(Nr.prototype,"muteRemote",[P$],Object.getOwnPropertyDescriptor(Nr.prototype,"muteRemote"),Nr.prototype),St(Nr.prototype,"unmuteRemote",[O$],Object.getOwnPropertyDescriptor(Nr.prototype,"unmuteRemote"),Nr.prototype),St(Nr.prototype,"hasRemoteMediaWithLock",[k$],Object.getOwnPropertyDescriptor(Nr.prototype,"hasRemoteMediaWithLock"),Nr.prototype),St(Nr.prototype,"disconnectForReconnect",[N$],Object.getOwnPropertyDescriptor(Nr.prototype,"disconnectForReconnect"),Nr.prototype),St(Nr.prototype,"remoteMediaSsrcChanged",[D$],Object.getOwnPropertyDescriptor(Nr.prototype,"remoteMediaSsrcChanged"),Nr.prototype),Nr);function bd(e){return function(r,i,o){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case Sd.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case Sd.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),E=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),E()}}}},o}}class ty extends Lr{constructor(r,i){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const o=()=>{this.signal.connectionState===fr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*oe("P2P_TOKEN_INTERVAL"))};o()}async send(r,i,o,c,u){var h,m,_;if(this.userMap.size===0)return;const E=Array.from(jc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(m=c)!==null&&m!==void 0?m:dr(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:i,token:"".concat(this.token,"_").concat(E)};oe("SHOW_P2P_LOG")&&L.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(zt.DATA_STREAM,{payload:Nm(this.encoder.encode(P))})});const C=new dt((P,N)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),V),this.off("res-@".concat(c),Y),this.off(Yv.ABORT,j),L.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?N(new xe(te.INVALID_REMOTE_USER)):N(new xe(te.TIMEOUT))},oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),V=()=>{G&&window.clearTimeout(G),this.off(Yv.ABORT,j),o&&P()},j=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),V),this.off("res-@".concat(c),Y),N(new xe(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Yv.ABORT,j),this.once("res-@".concat(c,"_ack"),V);const Y=(de,Se)=>{Z=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),V),this.off(Yv.ABORT,j),de==="success"?P(Se):N(new xe(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let Z=!1;o||(this.once("res-@".concat(c),Y),hs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Z||L.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await C}catch(P){if(P.code===te.TIMEOUT)return await this.send(r,i,o,c,u);throw P}}onMessage(r){var i;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==oi.CHECK)return;const{token:E}=r;c=new Map,u={uid:o,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(En.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:S}=r,C=(h=c.get(E))!==null&&h!==void 0?h:[];if(C.push(r),c.has(E)||c.set(E,C),C.length!==S)return;{const P=eT(C).call(C,(N,G)=>N.index-G.index).map(N=>N.payload).join("");c.delete(E),(r=JSON.parse(P))._uid=o}}const{_type:m,token:_}=r;if(st(i=[oi.ACK,oi.CHECK]).call(i,m))return m===oi.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(r);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):L.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:dr(6,""),token:this.token,_type:oi.CHECK};oe("SHOW_P2P_LOG")&&L.debug("send message",r),this.signal.request(zt.DATA_STREAM,{payload:Nm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:oi.ACK,token:this.token};oe("SHOW_P2P_LOG")&&L.debug("send message",i),this.signal.request(zt.DATA_STREAM,{payload:Nm(this.encoder.encode(JSON.stringify(i)))})}response(r,i,o){this.send(oi.RESPONSE,JSON.stringify({success:!o,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:C}=E;for(;S.has(C);){const P=S.get(C);S.delete(C),this.receiveMessage(P),E.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(r._id),void L.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===_&&(this.receiveMessage(r),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:o,_message:c,_uid:u}=r;if(oe("SHOW_P2P_LOG")&&L.debug("receive message",r),i){let h;switch(r._type!==oi.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case oi.CANDIDATE:case oi.CONTROL:this.signal.emit(o,h,u);break;case oi.PUBLISH:case oi.UNPUBLISH:case oi.RESTART_ICE:case oi.CALL:h.uid=u,Ps(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case oi.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case oi.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(i),m?"success":"failed",_);break}}}}splitMessage(r){if(r.length<ty.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:o}=JSON.parse(r),c=dr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const _={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>ty.MAX_MESSAGE_SIZE?h-=50:(i.push(_),r=r.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(r,i){return r.token!==i?(L.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{L.debug("token timeout, ".concat(i)),this.reset(r.uid)},oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Ps(this.signal,oi.CALL,void 0),i=await this.send(oi.CALL,r);this.signal.emit($t.P2P_CONNECTION,i,!0)}async reset(r,i){const o=this.userMap.get(r);o&&(this.emit(Yv.ABORT),this.signal.emit(En.ON_USER_OFFLINE,{uid:o.uid,reason:Sme.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(L.debug("change local token from ".concat(i," to ").concat(i)),this.token=dr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Yv.ABORT)}}K(ty,"MAX_SIZE",1),K(ty,"MAX_MESSAGE_SIZE",1024);class rye extends Lr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===fr.CONNECTED?this.emit($t.WS_CONNECTED):r===fr.RECONNECTING?this.emit($t.WS_RECONNECTING,this._websocketReconnectReason):r===fr.CLOSED&&this.emit($t.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",fr.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new uW(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit($t.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case En.ON_DATA_STREAM:return void this.handleDataStream(c._message);case En.MUTE_AUDIO:case En.MUTE_VIDEO:case En.ON_P2P_LOST:case En.ON_USER_ONLINE:return;case En.ON_USER_OFFLINE:const{uid:u}=c._message;return L.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===En.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===En.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Kn.UID_BANNED);break;case 15:this.close(Kn.IP_BANNED);break;case 16:this.close(Kn.CHANNEL_BANNED)}if(c._type===En.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ut.ERR_LICENSE_MISSING:this.close(Kn.LICENSE_MISSING);break;case Ut.ERR_LICENSE_EXPIRED:this.close(Kn.LICENSE_EXPIRED);break;case Ut.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Kn.LICENSE_MINUTES_EXCEEDED);break;case Ut.ERR_LICENSE_PERIOD_INVALID:this.close(Kn.LICENSE_PERIOD_INVALID);break;case Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Kn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ut.ERR_LICENSE_ILLEGAL:this.close(Kn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new Nx("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fr.CONNECTED&&this.reconnect("retry",As.OFFLINE)}),this.p2pToken=dr(6,""),this._external_signal=new ty(this,this.p2pToken)}async request(r,i,o,c){const u=dr(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new dt((G,V)=>{if(this.connectionState===fr.CONNECTED)return G();const j=()=>{this.off($t.WS_CLOSED,Y),G()},Y=()=>{this.off($t.WS_CONNECTED,j),V(new xe(te.WS_ABORT))};this.once($t.WS_CONNECTED,j),this.once($t.WS_CLOSED,Y)});if(this.connectionState!==fr.CONNECTING&&this.connectionState!==fr.RECONNECTING||r===zt.JOIN||r===zt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new dt((G,V)=>{let j=!1;const Y=(de,Se)=>{j=!0,G({isSuccess:de==="success",message:Se||{}}),this.off($t.WS_CLOSED,Z),this.off($t.WS_RECONNECTING,Z),this.emit($t.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),Y);const Z=()=>{V(new xe(te.WS_ABORT,"type: ".concat(r))),this.off($t.WS_CLOSED,Z),this.off($t.WS_RECONNECTING,Z),this.off("res-@".concat(u),Y)};this.once($t.WS_CLOSED,Z),this.once($t.WS_RECONNECTING,Z),hs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit($t.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await E}catch(G){if(this.connectionState===fr.CLOSED||r===zt.LEAVE)throw new xe(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===zt.JOIN||r===zt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const C=Number(S.message.error_code||S.message.code),P=RT(C),N=new xe(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:C,data:S.message,desc:P.desc});return P.action==="success"?S.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(C,", message: ").concat(P.desc,", action: ").concat(P.action)),C===Ut.ERR_TOO_MANY_BROADCASTERS?((r===zt.JOIN||r===zt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(C===Ut.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",As.MULTI_IP)):this.reconnect(P.action,As.SERVER_ERROR),r===zt.JOIN||r===zt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new dt(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(wT.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(r,i,o){return await this._external_signal.send(r,i,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dt((i,o)=>{this.once($t.WS_CONNECTED,()=>i(this.joinResponse)),this.once($t.WS_CLOSED,()=>o(this.initError||new xe(te.WS_ABORT))),this.connectionState=fr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Kn.LEAVE,this.connectionState=fr.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=dr(6,""),this._external_signal.clear(),this._external_signal=new ty(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit($t.ABORT_P2P_EXECUTION);const r=await Ps(this,$t.REQUEST_JOIN_INFO),i=await this.request(zt.JOIN,r);if(!i)return this.emit($t.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit($t.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleDataStream(r){try{var i;const o=k_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||st(i=Object.values(oi)).call(i,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(En.ON_DATA_STREAM,r)}catch{this.emit(En.ON_DATA_STREAM,r)}}handleNotification(r){L.debug("[".concat(this.clientId,"] receive notification: "),r);const i=RT(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Kn.UID_BANNED),void this.close()):void this.reconnect(i.action,As.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(L.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",As.TIMEOUT):this.request(zt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),oe("REPORT_STATS")&&this.send(zt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Zt.RECONNECT_CREATE_CONNECTION,r=>{this.emit($t.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Zt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Zt.CLOSED,()=>{this.connectionState=fr.CLOSED}),this.websocket.on(Zt.FAILED,()=>{this._disconnectedReason=Kn.NETWORK_ERROR,this.connectionState=fr.CLOSED}),this.websocket.on(Zt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===fr.CONNECTED?this.connectionState=fr.RECONNECTING:this.connectionState=fr.CONNECTING}),this.websocket.on(Zt.WILL_RECONNECT,(r,i,o)=>{r!=="retry"?(L.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):L.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(Zt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit($t.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof xe&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Ut.ERR_NO_AUTHORIZED)return L.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",As.SERVER_ERROR);L.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",As.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Zt.REQUEST_NEW_URLS,(r,i)=>{Ps(this,$t.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const iye={name:"P2PChannel",create:function(e){let{store:r,statsCollector:i}=e;return new nye(r,i)},createSubmodule:function(e){let{store:r,spec:i}=e;return new rye(i,r)}};function x$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function M$(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?x$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class sye{constructor(r){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),r=Br(r);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:E}=r,S=Fa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Br(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=E;for(let C=0;C<S.mediaDescriptions.length;C++){const P=S.mediaDescriptions[C];if(P.attributes.iceUfrag=i.iceUfrag,P.attributes.icePwd=i.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(G=>G.payloadType.toString(10));let N=u.videoCodecs.filter(G=>{var V,j;return(V=G.rtpMap)===null||V===void 0?void 0:st(j=V.encodingName.toLowerCase()).call(j,_)});N.length===0&&(N=u.videoCodecs),P.attributes.payloads=N,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(N=>N.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[C]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Dm(this.sessionDesc)}send(r,i,o){const{ssrcs:c,ssrcGroups:u}=B_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>r===gt.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(r){return r.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{st(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;st(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(M$(M$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case js.TCP_RELAY:this.candidates=o;break;case js.UDP_TCP_RELAY:case js.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Br(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let o=0;o<r;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(r,i){const o=Br(r);return Qv(o,i),Mx(o,i),o}updateRecvMedia(r,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===gt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(r){const i=Br(r);return xx(i),function(o){const c=o.attributes.extmaps.find(u=>lP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var cr;function U$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function qP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?U$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):U$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let oye=(cr=class Bw extends $G{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return st(i=Object.keys(VA)).call(i,r)}))]}constructor(r,i){super(r,i),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=i,this.mutex=new Vs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Bw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=YL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Vr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Vm(r.sdp),o=PT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,qP(qP({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new xe(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new sye(qP(qP({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new xe(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var o=this;return Sl(function*(){const c=yield kn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield kn(o.peerConnection.createOffer()),m=Fa(h.sdp),_=r.map(P=>{const N=P._mediaStreamTrack,G=m.mediaDescriptions.find(V=>V.attributes.mid===N.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(V,j,Y){const Z=V.attributes.ssrcs.filter(Se=>Se.attributes.label===j),de=V.attributes.ssrcGroups;if(Z.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(de&&Z.length>1){const Se=de.find(Te=>Te.ssrcIds.indexOf(Z[0].ssrcId)!==-1);return Se?[{ssrcId:Se.ssrcIds[0],rtx:Y?Se.ssrcIds[1]:void 0}]:[{ssrcId:Z[0].ssrcId}]}return[{ssrcId:Z[0].ssrcId}]}(G,N.id,o.useRTX)});let E;try{E=yield _}catch(P){throw u.forEach(N=>{Is()&&N.replaceTrack(null),o.peerConnection.removeTrack(N)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,i,E);const C=o.remoteSDP.toString();return yield kn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield kn(o.applySendEncodings(u,r)),yield kn(o.peerConnection.setRemoteDescription({type:"answer",sdp:C})),r.map((P,N)=>{const G=P._mediaStreamTrack.id;return{localSSRC:_[N],id:G}})}catch(u){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{Is()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,i,c),m=new dt((S,C)=>{const P=setTimeout(()=>{C(new Error("Cannot receive track, id: ".concat(u)))},1e4),N=G=>{const V=Nn();if((V.name==="Safari"&&Number(V.version)===11||Ao())&&G.track.id!==u&&G.streams[0].id===h){var j;const Y=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(r,u,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S(Y)}if(G.track.id===u)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S(G.track)};this.peerConnection.addEventListener("track",N)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:u}}catch(u){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(Is()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(Is()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Sl(function*(){const o=yield kn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Vn().supportPCSetConfiguration;if(r===js.RELAY&&!c)return;if(c){const E=i.peerConnection.getConfiguration(),S=r===js.RELAY?"relay":"all";E.iceTransportPolicy!==S&&(L.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(S,"]")),E.iceTransportPolicy=S,i.peerConnection.setConfiguration(E))}r!==js.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield kn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Vm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const _=i.remoteSDP.toString();yield kn(i.peerConnection.setLocalDescription(u)),yield kn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){L.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new xe(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new xe(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(gT(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...Bw.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...Bw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(E=>{var S;return((S=E.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!i)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Vn().supportSetRtpSenderParameters)return L.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof vr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&Kp()){var h;const E=oe("DSCP_TYPE");st(h=["very-low","low","medium","high"]).call(h,E)&&(u.networkPriority=E)}const m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(r,i){try{if(!Vn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const o=Fa(r);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&Qv(m,c)}),Dm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:E}=r[h];return new dt((S,C)=>{const P=setTimeout(()=>{C(new Error("Cannot receive track, id: ".concat(m)))},1e4),N=G=>{const V=Nn();if(V.name==="Safari"&&Number(V.version)===11&&G.track.id!==m&&G.streams[0].id===_){var j;const Y=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(E,m,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S({track:Y,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S({track:G.track,id:m})};this.peerConnection.addEventListener("track",N)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await dt.all(i)}catch(i){throw new xe(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(Vn().supportPCSetConfiguration){const i=Bw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},St(cr.prototype,"connect",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"connect"),cr.prototype),St(cr.prototype,"stopSending",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"stopSending"),cr.prototype),St(cr.prototype,"receive",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"receive"),cr.prototype),St(cr.prototype,"stopReceiving",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"stopReceiving"),cr.prototype),St(cr.prototype,"muteRemote",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"muteRemote"),cr.prototype),St(cr.prototype,"unmuteRemote",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"unmuteRemote"),cr.prototype),St(cr.prototype,"muteLocal",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"muteLocal"),cr.prototype),St(cr.prototype,"unmuteLocal",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"unmuteLocal"),cr.prototype),St(cr.prototype,"close",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"close"),cr.prototype),St(cr.prototype,"updateEncoderConfig",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"updateEncoderConfig"),cr.prototype),St(cr.prototype,"updateSendParameters",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"updateSendParameters"),cr.prototype),St(cr.prototype,"replaceTrack",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"replaceTrack"),cr.prototype),St(cr.prototype,"getRemoteSSRC",[Pl],Object.getOwnPropertyDescriptor(cr.prototype,"getRemoteSSRC"),cr.prototype),cr);function Pl(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}const aye={name:"PlanBConnection",create:function(e){let{store:r,spec:i}=e;return new oye(i,r)}},cye={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(KA.has(e)||!e.track)return;const i={track:e.track};if($p()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void L.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(L.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=r.metadata&&r.metadata();_?function(E,S){const{chunk:C,controller:P}=S,N=oe("ENABLE_AUDIO_PTS_METADATA")?Jp.AUDIO_64_BIT_PTS:Jp.METADATA;C.data=function(G,V,j){const Y=j.byteLength,Z=Y+Ex+OG,de=_x+yx+Z,Se=new ArrayBuffer(G.byteLength+de),Te=new DataView(Se);Te.setUint8(0,PG),Te.setUint16(1,Z),Te.setUint8(3,V),Te.setUint16(4,Y);for(let Ne=0;Ne<Y;Ne++)Te.setUint8(6+Ne,j[Ne]);const ye=new Uint8Array(Te.buffer);return ye.set(new Uint8Array(G),de),ye.buffer}(C.data,N,E),P.enqueue(C)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=$A(),u=new MessageChannel;await new dt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new dt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)L.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&u.port1.postMessage({metadata:E})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=KA.get(e);if(c){KA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){L.warning(m&&m.message)}}}KA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(ZA.has(e))return;const i={track:e.track,onMetadata:r.onMetadata};if($p()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");kL(zn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void L.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(L.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),r.enableTopn?function(_,E,S){var C;const P=kG(new DataView(E.data));if(!P)return S.enqueue(E);const N=_.track.id;Wfe.set(N,_.track);const G=(C=P.tlv.find(Se=>Se.tag===Jp.AUDIO_LEVEL))===null||C===void 0?void 0:C.value;let V=0;typeof G=="number"&&(V=127-G);const j=Math.round(Math.pow(10,V/60)-1),{selected:Y,speaker:Z}=function(Se,Te){let ye=Hv.get(Se);if(ye||(ye=function(Ne){const Ye=new DG;return Hv.set(Ne,Ye),gd||(gd=new jfe(oe("TOPN_SILENCE_THRESHOLD")||500),gd.on("ActiveSpeakerChanged",ht=>{ht!=null&&(XA=ht)})),gd.addSpeakers([Ye]),Ye}(Se)),Hv.size<=LG)return{selected:!0,speaker:ye};if(!gd)throw new Error("no active speaker detector");return gd.levelChanged(ye.id,Te),V_=gd.loudest.map(Ne=>Ne.id),XA&&!st(V_).call(V_,XA)&&V_.length>=LG&&V_.pop(),{selected:st(V_).call(V_,ye.id)||ye.id===XA,speaker:ye}}(_,j),de=function(Se,Te,ye){const Ne=_d.get(Se)||new Bfe(Se,Te);return Ne.score=ye,_d.set(Se,Ne),function(Ye){if(JA.set(Ye,!0),!QA)return void(QA=Date.now());const ht=Date.now();ht-QA>1e3&&(JA.get(Ye)?JA.set(Ye,!1):(xG(Ye),JA.delete(Ye)),QA=ht)}(Se),Ne}(N,_.track,Z.energyScore);de.addSample(Y),de.active&&(E.data=P.frame.buffer,S.enqueue(E))}(e,h,m):r.enableMetadata?function(_,E,S){const C=kG(new DataView(_.data));if(!C)return E.enqueue(_);const P=C.tlv.find(N=>N.tag===Jp.METADATA||N.tag===Jp.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),_.data=C.frame.buffer,E.enqueue(_)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=$A(),u=new MessageChannel;await new dt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new dt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(L.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.metadata&&i.onMetadata&&i.onMetadata(m.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=ZA.get(c);if(u){(function(_){const E=Hv.get(_);E&&(Hv.delete(_),gd&&(gd.removeSpeakers([E]),Hv.size===0&&(gd.destroy(),gd=null)))})(c),xG(c.track.id),ZA.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){L.warning(_&&_.message)}}}(e)}ZA.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,r){if(!Vn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(eP.has(e)||!e.track)return;const i={track:e.track};if($p()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void L.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(L.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const E=u.shift();E&&(m.data=function(S,C){const P=function(Z){const de=Z.length;let Se=[],Te=0;for(;Te<de;)Te+2<de&&Z[Te]===0&&Z[Te+1]===0&&(Z[Te+2]===0||Z[Te+2]===1||Z[Te+2]===2||Z[Te+2]===3)?(Se.push(Z[Te],Z[Te+1],3,Z[Te+2]),Te+=3):(Se.push(Z[Te]),Te++);return new Uint8Array(Se)}(C),N=P.length,G=Math.floor(N/255),V=N%255,j=new Uint8Array(6+G+1+N+S.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let Y=0;for(;Y<G;)j[6+Y]=255,Y++;return j[6+Y]=V,Y++,j.set(P,6+Y),j.set(new Uint8Array(S),6+Y+N),j.buffer}(m.data,E)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Is())return;{if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=$A(),u=new MessageChannel;await new dt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new dt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(L.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=eP.get(e);if(c){eP.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){L.warning(m&&m.message)}}}eP.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(!e.track)return;if(TT.has(e)){const c=TT.get(e);return void(c&&(c.onSei=r.onSei))}const i={track:e.track,onSei:r.onSei};if($p()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void L.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(L.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(E){const S=new DataView(E.data);let C=0;for(;C+4<E.data.byteLength;){if(S.getUint8(C+0)===0&&S.getUint8(C+1)===0&&S.getUint8(C+2)===0&&S.getUint8(C+3)===1&&S.getUint8(C+4)===6){let P=C+6,N=0,G=0;for(;(G=S.getUint8(P++))===255;)N+=255;N+=G;const V=zfe(E.data,P,N);return new Uint8Array(V)}C++}return null}(h);_&&i.onSei&&i.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=$A(),u=new MessageChannel;await new dt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new dt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(L.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.sei&&i.onSei&&i.onSei(m.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=TT.get(c);if(u){TT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){L.warning(_&&_.message)}}})(e)}TT.set(e,i),e.track.addEventListener("ended",o)}},lye={name:"InterceptFrame",create:()=>cye};XL(),tr("PROCESS_ID","process-".concat(dr(8,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void L.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();L.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(Er,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;md[o]=c,Er[o]=c}})}catch(r){L.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(md.AREAS)&&md.AREAS.length>0&&Bx(md.AREAS,!0);const V$=(e,r,i)=>{L.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),tr(e,r,i)};Fm(N_e,!1),Fm(x_e,!1),Fm(fge,!1),Fm($_e,!1),Fm(P_e,!1),Fm(iye,!1),Fm(aye,!1),Fm(lye,!1);const Ri=function(e){const r=new Lr,i=e,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===Eh.SECURITY_POLICY_VIOLATION&&y7(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return _7(_7({},i),o)}({__TRACK_LIST__:xv,VERSION:bl,BUILD:ZL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:V$,getParameter:oe,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(o){let c;return Vn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return e;r.close(),r=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new Oe(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=It.reportApiInvoke(null,{name:wi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:jr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&xL()&&F8(75)&&new u().close()}catch(u){return L.error("check system requirement failed: ",u),!1}let i=!1;const o=Nn();o.name===zn.CHROME&&Number(o.version)>=58&&(pd.engine.name!=="WebKit"||function(){const u=Nn();if(PA()){if(u.os===Gi.MAC_OS)return!0;if(u.os===Gi.IOS){const h=pd.os.version&&pd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===zn.FIREFOX&&Number(o.version)>=56||o.name===zn.OPERA&&Number(o.version)>=45||o.name===zn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Ao()||du())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||H8()||Nn().name===zn.QQ)&&(i=!0),L.debug("checkSystemRequirements, api:",r,"browser",i);const c=r&&i;return e.onSuccess(c),c},getDevices:function(e){return Yc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Yc.getRecordingDevices(e)},getCameras:function(e){return Yc.getCamerasDevices(e)},getElectronScreenSources:FW,getPlaybackDevices:function(e){return Yc.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=dr(5,"client-"),o=It.reportApiInvoke(null,{id:i,name:wi.CREATE_CLIENT,options:[r],tag:jr.TRACER});try{(function(c){Ui(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ui(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Ui(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ds(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&Z8(c.turnServer),c.httpRetryConfig!==void 0&&Q8(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&Q8(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(B8(16,0)||W8(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",L.debug("browser not support vp9, force use vp8")),tr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new mge(Eu(Eu({forceWaitGatewayResponse:!0},r),{},{role:st(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),i=dr(8,"track-cam-"),o=It.reportApiInvoke(null,{id:i,tag:jr.TRACER,name:wi.CREATE_CAM_VIDEO_TRACK,options:[kr({},e),r]});r&&(e.encoderConfig=r);const c=GA(e);let u=null;L.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await qc({video:c},i)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new xe(te.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(L)}e.optimizationMode&&gx(i,u,e,gh(e.encoderConfig));const h=new mx(u,e,c,e.scalabiltyMode?jA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),L.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const r=dr(8,"track-cus-"),i=It.reportApiInvoke(null,{id:r,tag:jr.TRACER,name:wi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new vr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?jA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[hr.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),L.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(P){return YW(P)}(r):void 0;i&&(r="auto");const o=dr(8,"track-scr-v-"),c=It.reportApiInvoke(null,{id:o,tag:jr.TRACER,name:wi.CREATE_SCREEN_VIDEO_TRACK,options:[kr({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(P){const N={};P.screenSourceType&&(N.mediaSource=P.screenSourceType),P.extensionId&&$p()&&(N.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:V,surfaceSwitching:j,systemAudio:Y,preferCurrentTab:Z}=P;(hT(107)||NL(107)||DL(93))&&(G&&(Ui(G,"displaySurface",["browser","window","monitor"]),N.displaySurface=G),V?(Ui(V,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=V):N.selfBrowserSurface="include",j&&(Ui(j,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=j)),(hT(105)||NL(105)||DL(91))&&Y&&(Ui(Y,"systemAudio",["exclude","include"]),N.systemAudio=Y),(hT(94)||NL(94)||DL(80))&&Z&&(N.preferCurrentTab=!0),P.electronScreenSourceId&&(N.sourceId=P.electronScreenSourceId);const de=P.encoderConfig?ix(P.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:de?de.width:void 0,maxHeight:de?de.height:void 0},de&&(de.frameRate&&(typeof de.frameRate=="number"?(N.mandatory.maxFrameRate=de.frameRate,N.mandatory.minFrameRate=de.frameRate):(N.mandatory.maxFrameRate=de.frameRate.max||de.frameRate.ideal||de.frameRate.exact||void 0,N.mandatory.minFrameRate=de.frameRate.min||de.frameRate.ideal||de.frameRate.exact||void 0),N.frameRate=de.frameRate),de.width&&(N.width=de.width),de.height&&(N.height=de.height)),N}(e);let h=null,m=null;const _=Vn();if(!_.supportShareAudio&&r==="enable"){const P=new xe(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(L)}L.info("start create screen video track with config",e,"withAudio",r,"trackId",o);const E=_.supportShareAudio&&r!=="disable";try{const P=await qc({screen:u,screenAudio:E?i||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new xe(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(L)}if(!m&&r==="enable"){h&&h.stop();const P=new xe(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(L)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(gx(o,h,e,e.encoderConfig&&ix(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new vr(h,e.encoderConfig?ix(e.encoderConfig):{},e.scalabiltyMode?jA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[hr.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),L.info("create screen video track success","video:",S.getTrackId()),S;const C=new Hr(m,void 0,dr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),C.getTrackId()]),L.info("create screen video track success","video:",S.getTrackId(),"audio:",C.getTrackId()),[S,C]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=oe("CAMERA_CAPTURE_CONFIG"),o=dr(8,"track-mic-"),c=dr(8,"track-cam-"),u=It.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:jr.TRACER,name:wi.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,i]});i&&(r.encoderConfig=i);const h=GA(r),m=XW(e);let _=null,E=null;L.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const P=await qc({audio:m,video:h},"".concat(o,"-").concat(c));_=P.getAudioTracks()[0],E=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!_||!E){const P=new xe(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(L)}r.optimizationMode&&gx(c,E,r,gh(r.encoderConfig));const S=new HA(_,e,m,o),C=new mx(E,r,h,r.scalabiltyMode?jA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),C.getTrackId()]),L.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,C]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=dr(8,"track-mic-"),i=It.reportApiInvoke(null,{id:r,tag:jr.TRACER,name:wi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=XW(e);let c=null;L.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{c=(await qc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new xe(te.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(L)}const u=new HA(c,e,o,r);return i.onSuccess(u.getTrackId()),L.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(e){const r=dr(8,"track-cus-"),i=It.reportApiInvoke(null,{id:r,tag:jr.TRACER,name:wi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Hr(e.mediaStreamTrack,e.encoderConfig?BA(e.encoderConfig):{},r,!1);return L.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:o},h=dr(8,"track-buf-"),m=It.reportApiInvoke(null,{id:h,tag:jr.TRACER,name:wi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(oe("DISABLE_WEBAUDIO"))throw new xe(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");L.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(C,P){let N=null;if(typeof C=="string"){const V=Mz.get(C);if(V)return L.debug("use cached audio resource: ",C),V;try{N=(await fd(()=>ia.get(C,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new xe(te.FETCH_AUDIO_FILE_FAILED,j.toString())}}else N=await new dt((j,Y)=>{const Z=new FileReader;Z.onload=de=>{de.target?j(de.target.result):Y(new xe(te.READ_LOCAL_AUDIO_FILE_ERROR))},Z.onerror=()=>{Y(new xe(te.READ_LOCAL_AUDIO_FILE_ERROR))},Z.readAsArrayBuffer(C)});const G=await function(V){const j=Bv();return new dt((Y,Z)=>{j.decodeAudioData(V,de=>{Y(de)},de=>{Z(new xe(te.DECODE_AUDIO_FILE_FAILED,de.toString()))})})}(N);return typeof C=="string"&&P&&Mz.set(C,G),G}(c,i)}catch(C){return m.onError(C),C.throw(L)}const E=new xfe(c),S=new Lfe(_,E,o?BA(o):{},h);return L.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(L.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw L.debug("Invalid appType"),new Oe(te.INVALID_PARAMS,"invalid app type",e);tr("APP_TYPE",Math.floor(e))},setLogLevel:function(e){L.setLogLevel(e)},enableLogUpload:function(){oe("USE_NEW_LOG")?tr("UPLOAD_LOG",!0):L.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?tr("UPLOAD_LOG",!1):L.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new M9},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=It.reportApiInvoke(null,{tag:jr.TRACER,name:wi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Hr||e instanceof Gv)){const _=new Oe(te.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof Hr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new dt(_=>{const E=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const C=u-h>1e-4,P=Date.now()-m;if(C||P>r){clearInterval(E);const N=C,G={duration:P,deviceLabel:o,maxVolumeLevel:u,result:N};L.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),i.onSuccess(G),_(N)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=It.reportApiInvoke(null,{tag:jr.TRACER,name:wi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof vr||e instanceof zv)){const C=new Oe(te.INVALID_TRACK,"the parameter is not a video track");return i.onError(C),C.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof vr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Is()||PA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const C=Date.now();m=await function(P,N,G,V){let j,Y=0,Z=null;return new dt((de,Se)=>{function Te(){Y>V&&j&&(j(),de(Y));const ye=G.getContext("2d");if(!ye){const ht=new Oe(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return L.error(ht.toString()),void Se(ht)}ye.drawImage(P,0,0,160,120);const Ne=ye.getImageData(0,0,G.width,G.height),Ye=Math.floor(Ne.data.length/3);if(Z){for(let ht=0;ht<Ye;ht+=3)if(Ne.data[ht]!==Z[ht])return Y+=1,void(Z=Ne.data);Z=Ne.data}else Z=Ne.data}setTimeout(()=>{j&&(j(),de(Y))},N),j=lx(()=>{Te()},30)})}(u,r,h,4),_=Date.now()-C}catch(C){throw i.onError(C),C}ege===zn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const E=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:E};return L.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),E},setArea:Bx,audioElementPlayCenter:sa,resumeAudioContext:function(){sa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){_ge.processExternalMediaAEC(e)},registerExtensions:function(e){const r=oe("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!st(r).call(r,i.name)&&r.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=L.extLog,o.reporter.hookApiInvoke=It.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=oe(c)})}),V$("PLUGIN_INFO",r)},ChannelMediaRelayError:Kv,ChannelMediaRelayEvent:Zp,ChannelMediaRelayState:ja,RemoteStreamFallbackType:Ife,RemoteStreamType:Rfe,ConnectionDisconnectedReason:Kn,AudienceLatencyLevelType:rfe,AREAS:Gn,preload:async function(e,r,i,o){return lH(e,r,i,o)}});return Object.defineProperties(Ri,{onAudioAutoplayFailed:{get:()=>Xc.onAudioAutoplayFailed,set:e=>{Xc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Xc.onAutoplayFailed,set:e=>{Xc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ri._onSecurityPolicyViolation,set(e){Ri._onSecurityPolicyViolation=e,y7(e)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?F_:[]}}),Yc.on(x_.CAMERA_DEVICE_CHANGED,e=>{L.info("camera device changed",JSON.stringify(e)),Ri.onCameraChanged&&Ri.onCameraChanged(e),Ri.safeEmit(Eh.CAMERA_CHANGED,e)}),Yc.on(x_.RECORDING_DEVICE_CHANGED,e=>{L.info("microphone device changed",JSON.stringify(e)),Ri.onMicrophoneChanged&&Ri.onMicrophoneChanged(e),Ri.safeEmit(Eh.MICROPHONE_CHANGED,e)}),Yc.on(x_.PLAYOUT_DEVICE_CHANGED,e=>{L.debug("playout device changed",JSON.stringify(e)),Ri.onPlaybackDeviceChanged&&Ri.onPlaybackDeviceChanged(e),Ri.safeEmit(Eh.PLAYBACK_DEVICE_CHANGED,e)}),sa.onAutoplayFailed=()=>{L.info("detect audio element autoplay failed"),Xc.onAudioAutoplayFailed&&Xc.onAudioAutoplayFailed()},nr.on("autoplay-failed",()=>{L.info("detect webaudio autoplay failed"),Xc.onAudioAutoplayFailed&&Xc.onAudioAutoplayFailed(),Ri.safeEmit(Eh.AUTOPLAY_FAILED)}),nr.on(fs.STATE_CHANGE,(e,r)=>{L.info("audio context state changed: ".concat(r," => ").concat(e)),Ri.onAudioContextStateChanged&&Ri.onAudioContextStateChanged(e,r),Ri.safeEmit(Eh.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),fi.on(Pv.NETWORK_STATE_CHANGE,(e,r)=>{L.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=Ri),Ri})}(pk)),pk.exports}var uWe=lWe();const MC=Pg(uWe),dWe="9442a472625f44e7b2c5065b9f9b3988",hWe=MC.createClient({mode:"rtc",codec:"vp8"});let Tw=null;const boe=D.createContext(null),Toe=({children:n,appId:t=dWe,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:y=()=>{}})=>{const[v,b]=D.useState(!1),[w,I]=D.useState(!1),[k,x]=D.useState([]),[F,B]=D.useState(null),[z,J]=D.useState(null),[$,ie]=D.useState(null),[ue,re]=D.useState(!1),[fe,q]=D.useState(!1),[X,Q]=D.useState(!1),[se,me]=D.useState(null),[pe,le]=D.useState(!1),Le=ll(),We=D.useRef(hWe),$e=D.useRef({appId:t,channel:s,uid:l,enabled:d}),ve=D.useRef(!1),_e=D.useRef(null);D.useRef(null),D.useEffect(()=>{$e.current={appId:t,channel:s,uid:l,enabled:d}},[t,s,l,d]),D.useEffect(()=>{J(s)},[s]),D.useEffect(()=>{if(!We.current)return;const tt=ut=>{ee.log(`Connection state changed to: ${ut}`),ut==="DISCONNECTED"?(b(!1),ee.log("Disconnected from Agora")):ut==="CONNECTED"&&(b(!0),B(null))};return We.current.on("connection-state-change",tt),()=>{We.current.off("connection-state-change",tt)}},[]),D.useEffect(()=>{if(!s||!d)return;const tt=async(Mt,Qt)=>{ee.log(`User published: ${Mt.uid}, mediaType: ${Qt}`);try{await We.current.subscribe(Mt,Qt),Qt==="audio"&&Mt.audioTrack.play(),x(on=>on.some(Ht=>Ht.uid===Mt.uid)?on:[...on,Mt])}catch(on){ee.error("Error subscribing to user:",on)}},ut=(Mt,Qt)=>{ee.log(`User unpublished: ${Mt.uid}, mediaType: ${Qt}`),Qt==="audio"&&Mt.audioTrack&&Mt.audioTrack.stop()},Ze=Mt=>{ee.log(`User joined: ${Mt.uid}`),x(Qt=>Qt.some(on=>on.uid===Mt.uid)?Qt:[...Qt,Mt])},vt=Mt=>{ee.log(`User left: ${Mt.uid}`),x(Qt=>Qt.filter(on=>on.uid!==Mt.uid))};return We.current.on("user-published",tt),We.current.on("user-unpublished",ut),We.current.on("user-joined",Ze),We.current.on("user-left",vt),(async()=>{if(ve.current){ee.log("Already initializing, skipping duplicate initialization");return}ve.current=!0;try{if(v&&_e.current===s){ee.log(`Already joined to channel ${s}`),re(!0),y(We.current);return}if(We.current.connectionState==="CONNECTING"||We.current.connectionState==="CONNECTED")if(_e.current&&_e.current!==s){ee.log("Connected to different channel, leaving first");try{await we()}catch(Mt){ee.error("Error leaving channel:",Mt)}}else{b(!0),re(!0),_e.current=s,Tw=s,y(We.current);return}ee.log(`Joining channel ${s}`),await ke(),ee.log("Join channel completed")}catch(Mt){ee.error("Error during initialization:",Mt)}finally{ve.current=!1}})(),()=>{ee.log("Cleaning up event listeners"),We.current.off("user-published",tt),We.current.off("user-unpublished",ut),We.current.off("user-joined",Ze),We.current.off("user-left",vt)}},[s,d,l,y,v]);const Ee=async()=>{if(!d||$)return $;ee.log("Initializing microphone");try{const tt=await MC.createMicrophoneAudioTrack();return await tt.setMuted(f),ie(tt),ee.log("Microphone initialized successfully"),tt}catch(tt){return ee.error("Error initializing microphone:",tt),B("Failed to initialize microphone. Please check your permissions."),null}};D.useEffect(()=>{(async()=>{if(s)try{const vt=await _g(s);vt&&vt.voiceDisabled?(ee.log("Voice is disabled for this space"),le(!0),v&&await we()):le(!1)}catch(Ze){ee.error("Error checking if voice is disabled:",Ze)}})();const ut=Ze=>{Ze.detail&&typeof Ze.detail.voiceDisabled=="boolean"&&(ee.log("Voice setting changed:",Ze.detail.voiceDisabled),le(Ze.detail.voiceDisabled),Ze.detail.voiceDisabled&&v?we():!Ze.detail.voiceDisabled&&!v&&d&&s&&ke())};return window.addEventListener("SpaceVoiceSettingChanged",ut),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ut)}},[s,v,d]);const ke=async()=>{if(!d)return ee.log("Agora is disabled, not joining channel"),!1;if(pe)return ee.log("Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!s)return ee.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(ee.log(`joinChannel called for channel ${s} with UID ${l}`),ee.log("Current state:",{isJoined:v,isJoining:fe,connectionState:We.current.connectionState,joinedChannel:_e.current}),v&&_e.current===s)return ee.log(`Already joined to channel: ${s}`),!0;if(fe)return ee.log("AgoraProvider: Already in the process of joining"),!1;if(We.current.connectionState==="CONNECTED")if(_e.current&&_e.current!==s){ee.log("Connected to different channel, leaving first");try{await we()}catch(tt){ee.error("Error leaving channel:",tt)}}else return ee.log("Client already connected, setting joined state to true"),b(!0),re(!0),_e.current=s,Tw=s,y(We.current),!0;if(We.current.connectionState==="CONNECTING")return ee.log("Client already connecting, waiting for connection"),q(!0),new Promise(tt=>{const ut=setInterval(()=>{We.current.connectionState==="CONNECTED"&&(clearInterval(ut),b(!0),q(!1),re(!0),_e.current=s,Tw=s,y(We.current),tt(!0))},500);setTimeout(()=>{clearInterval(ut),ee.log("AgoraProvider: Connection timeout, considering join failed"),q(!1),tt(!1)},1e4)});try{if(ee.log(`Joining channel: ${s} with UID: ${l||"random"}`),ee.log(`Using appId: ${t}, Type: ${typeof t}, Length: ${t.length}`),!t||t.trim()===""){const ut="AgoraProvider: App ID is empty or invalid";return ee.error(ut),B(ut),q(!1),!1}q(!0);const tt=l||Math.floor(Math.random()*1e6);return await We.current.join(t,s,a,tt),ee.log(`Joined channel successfully with UID: ${We.current.uid}`),b(!0),q(!1),re(!0),_e.current=s,Tw=s,y(We.current),!0}catch(tt){return ee.error("Error joining channel:",tt),B(`Error joining channel: ${tt.toString()}`),q(!1),!1}},we=async()=>{if(v)try{$&&await We.current.unpublish($),await We.current.leave(),Tw=null,_e.current=null,ee.log("Left channel successfully"),b(!1),x([])}catch(tt){ee.error("Error leaving channel:",tt),B(tt.message||"Failed to leave channel")}};D.useEffect(()=>()=>{$&&$.close()},[]),D.useEffect(()=>{d&&s&&(!v||_e.current!==s)&&ke()},[d,s,v]);const be=()=>{if(!$)return!1;try{return $.isActive&&!$.muted}catch(tt){return ee.error("Error checking microphone status:",tt),!1}};D.useEffect(()=>{const tt=()=>{const Ze=be();Ze!==w&&(ee.log("Syncing microphone state:",{actualStatus:Ze,currentState:w}),I(Ze),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Ze}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ze,window.agoraClient.microphoneTrack=$))};$&&tt();const ut=setInterval(tt,1e3);return()=>{clearInterval(ut)}},[$,w]);const Ie=async()=>{var tt;if(pe)return ee.log("Voice is disabled for this space, cannot toggle"),Le({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const ut=w!==void 0?w:$?!$.muted:!1;if(ee.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:ut,hasMicTrack:!!$,trackMuted:$==null?void 0:$.muted}),!$&&(ee.log("AgoraProvider: No microphone track, initializing..."),!await Ee()))return ee.error("AgoraProvider: Failed to initialize microphone"),ut;const Ze=!ut;if(ee.log("AgoraProvider: New voice state will be:",Ze),ut){if($)try{ee.log("AgoraProvider: Muting microphone track"),await $.setMuted(!0),$.muted||(ee.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await $.setEnabled(!1)),ee.log("AgoraProvider: Microphone track muted successfully, muted state:",$.muted)}catch(vt){return ee.error("Error muting track:",vt),ut}}else if($)try{We.current&&v&&!((tt=We.current.localTracks)!=null&&tt.includes($))&&(ee.log("AgoraProvider: Publishing microphone track"),await We.current.publish($),ee.log("AgoraProvider: Microphone track published successfully")),ee.log("AgoraProvider: Unmuting microphone track"),await $.setMuted(!1),$.muted&&(ee.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await $.setEnabled(!0)),ee.log("AgoraProvider: Microphone track unmuted successfully, muted state:",$.muted)}catch(vt){return ee.error("Error unmuting track:",vt),ut}return I(Ze),Ze}catch(ut){return ee.error("Error toggling voice:",ut),w}},Me=async tt=>{try{ie(tt),ee.log("Microphone track updated successfully")}catch(ut){throw ee.error("Error updating microphone track:",ut),ut}},ze=async()=>{if(!We.current||!s)return ee.error("AgoraProvider: Voice chat not connected"),!1;try{if(X)return ee.log("AgoraProvider: Stopping screen share"),se&&(Array.isArray(se)?(await We.current.unpublish(se),se.forEach(tt=>tt.close())):(await We.current.unpublish(se),se.close()),me(null)),Q(!1),ee.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;ee.log("AgoraProvider: Starting screen share");try{const tt=await MC.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return ee.log("AgoraProvider: Screen track created:",tt),tt.on("track-ended",()=>{ee.log("AgoraProvider: Screen sharing ended by browser UI"),We.current.unpublish(tt),tt.close(),me(null),Q(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await We.current.publish(tt),me(tt),Q(!0),ee.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=tt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(tt){return ee.error("AgoraProvider: Error creating screen track:",tt),Q(!1),me(null),!1}}catch(tt){return ee.error("AgoraProvider: Error toggling screen share:",tt),Q(!1),me(null),!1}};D.useEffect(()=>{if(ee.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:We.current,isScreenSharing:!1,screenTrack:null};const tt=Ze=>{ee.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(vt=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!0,vt)}).catch(vt=>{ee.error("AgoraProvider: Error handling ToggleScreenShare event:",vt),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1,X)})},ut=Ze=>{ee.log("AgoraProvider: Received JoinVoiceChat event"),ke().then(vt=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(vt)}).catch(vt=>{ee.error("AgoraProvider: Error handling JoinVoiceChat event:",vt),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",tt),window.addEventListener("JoinVoiceChat",ut),()=>{window.removeEventListener("ToggleScreenShare",tt),window.removeEventListener("JoinVoiceChat",ut),typeof window<"u"&&window.agoraClient&&(ee.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(ee.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),D.useEffect(()=>{ee.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=$,window.agoraClient.client=We.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),ee.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,$]);const Je={client:We.current,isJoined:v,isVoiceEnabled:w,users:k,error:F,channel:z,appId:t,toggleVoice:Ie,leaveChannel:we,joinChannel:ke,microphoneTrack:$,isReady:ue,createMicrophoneTrack:Me,isScreenSharing:X,screenTrack:se,toggleScreenShare:ze,voiceDisabled:pe};return R.jsx(boe.Provider,{value:Je,children:n})},woe=()=>{const n=D.useContext(boe);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Toe.propTypes={children:Tn.node.isRequired,appId:Tn.string.isRequired,channel:Tn.string.isRequired,token:Tn.string,uid:Tn.oneOfType([Tn.string,Tn.number])};const pWe=()=>{var ve,_e;const{client:n,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:f,channel:y,appId:v,toggleVoice:b,joinChannel:w,leaveChannel:I,createMicrophoneTrack:k,isScreenSharing:x,screenTrack:F,toggleScreenShare:B,voiceDisabled:z}=woe(),[J,$]=D.useState(t!==void 0?t:((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)||!1),[ie,ue]=D.useState(x!==void 0?x:((_e=window.agoraClient)==null?void 0:_e.isScreenSharing)||!1),[re,fe]=D.useState(z!==void 0?z:!1),[q,X]=D.useState(!0);D.useEffect(()=>{var Ee;t!==void 0?$(t):((Ee=window.agoraClient)==null?void 0:Ee.isVoiceEnabled)!==void 0?$(window.agoraClient.isVoiceEnabled):d&&$(!d.muted)},[t,d]),D.useEffect(()=>{var Ee;x!==void 0?ue(x):((Ee=window.agoraClient)==null?void 0:Ee.isScreenSharing)!==void 0&&ue(window.agoraClient.isScreenSharing)},[x]),D.useEffect(()=>{z!==void 0&&fe(z)},[z]);const Q=D.useRef({isVoiceEnabled:J,isScreenSharing:ie,isJoined:s,users:a,error:l,isReady:f,channel:y,appId:v,voiceDisabled:re});D.useEffect(()=>{Q.current={isVoiceEnabled:J,isScreenSharing:ie,isJoined:s,users:a,error:l,isReady:f,channel:y,appId:v,voiceDisabled:re}},[J,ie,s,a,l,f,y,v,re]),D.useEffect(()=>{const Ee=setTimeout(()=>{X(!1)},5e3);return()=>clearTimeout(Ee)},[]),D.useEffect(()=>{f&&X(!1)},[f]),D.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:J,contextIsScreenSharing:x,localScreenSharing:ie,isJoined:s,users:a.length,error:l,isReady:f,channel:y,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!F})},[t,J,x,ie,s,a,l,f,y,v,d,F]);const se=async()=>{try{console.log("useVoiceChat: Toggling voice from:",J);const Ee=await b();if(console.log("useVoiceChat: Toggle result:",Ee),Ee!==void 0)$(Ee);else{const ke=!J;$(ke),window.agoraClient&&(window.agoraClient.isVoiceEnabled=ke)}return Ee!==void 0?Ee:!J}catch(Ee){return console.error("useVoiceChat: Error toggling voice:",Ee),J}},me=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ie);const Ee=await B();if(console.log("useVoiceChat: Screen share toggle result:",Ee),Ee!==void 0)ue(Ee);else{const ke=!ie;ue(ke),window.agoraClient&&(window.agoraClient.isScreenSharing=ke)}return Ee!==void 0?Ee:!ie}catch(Ee){return console.error("useVoiceChat: Error toggling screen share:",Ee),ie}},pe=async()=>{J&&d&&await se()},le=async()=>{!J&&d&&await se()},Le=Ee=>a.some(ke=>{var we;return ke.uid===Ee&&((we=ke.audioTrack)==null?void 0:we.isPlaying)}),We=D.useCallback(()=>{if(!d||!J)return 0;try{return d.getVolumeLevel()}catch(Ee){return console.error("Error getting volume level:",Ee),0}},[d,J]);return{isVoiceEnabled:J,isScreenSharing:ie,isJoined:s,users:a,error:l,toggleVoice:se,toggleScreenShare:me,mute:pe,unmute:le,isUserSpeaking:Le,getVolumeLevel:We,microphoneTrack:d,screenTrack:F,isLoading:q,channel:y,appId:v,joinChannel:w,leaveChannel:I,client:n,setMicrophoneDevice:async Ee=>{try{if(!Ee){console.error("No device ID provided");return}if(!n||!s){console.error("Client not initialized or not joined to a channel");return}d&&(J&&await n.unpublish(d),await d.close());const ke=await MC.createMicrophoneAudioTrack({microphoneId:Ee,encoderConfig:"music_standard"});k&&await k(ke),J&&await n.publish(ke),console.log("Microphone device changed successfully")}catch(ke){throw console.error("Error changing microphone device:",ke),ke}},voiceDisabled:re}},fWe=({size:n="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:y,joinChannel:v,channel:b,client:w,voiceDisabled:I}=pWe(),[k,x]=D.useState(!1),[F,B]=D.useState(!1);D.useEffect(()=>{const $=()=>{ee.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(ee.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]),D.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:y,channel:b,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:F,voiceDisabled:I})},[d,y,b,w,F,I]);const z=async()=>{if(!(k||I)){x(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:y});try{if(!y&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(ie){ie.message&&ie.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ie)}console.log("VoiceButton: Toggling voice state from:",d);const $=await f();console.log("VoiceButton: Voice toggled, new state:",$)}catch($){console.error("VoiceButton: Error toggling voice:",$)}finally{x(!1)}}},J=()=>I?"Voice chat is disabled for this space":F?k?"Processing...":y?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!F||I?null:R.jsx(Af,{label:J(),placement:t,hasArrow:!0,children:R.jsxs(wt,{position:"relative",cursor:"pointer",onClick:z,children:[R.jsx(ip,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?R.jsx(KV,{color:"white"}):R.jsx($V,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),k&&R.jsx(wt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:R.jsx(ap,{size:"sm",color:"white"})})]})})},mWe=ui.createContext({user:null}),gWe=({userNickname:n})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=woe(),[f,y]=D.useState([]),[v,b]=D.useState(!1),[w,I]=D.useState(!0);D.useRef({});const k=D.useRef(null);D.useRef(null);const{user:x}=D.useContext(mWe)||{user:null},[F,B]=D.useState({}),z=D.useRef(a),[J,$]=D.useState(null),{isOpen:ie,onOpen:ue,onClose:re}=kf(),[fe,q]=D.useState(!1),X=D.useRef(null),Q=D.useRef(null);D.useEffect(()=>{z.current=a},[a]),D.useEffect(()=>{if(!t||!s){b(!1);return}const Le=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const We=t.connectionState;if(console.log("Current connection state:",We),We==="CONNECTED")b(!0),I(!1);else{b(!1);const $e=ve=>{console.log("Connection state changed:",ve),ve==="CONNECTED"?(b(!0),I(!1)):b(!1)};return t.on("connection-state-change",$e),()=>{t.off("connection-state-change",$e),clearTimeout(Le)}}return()=>{clearTimeout(Le)}},[t,s]),D.useEffect(()=>{const Le=async()=>{const We={...F};let $e=!1;for(const ve of f){if(F[ve.uid])continue;let _e=null,Ee=ve.uid;if(typeof Ee=="string"&&(Ee.includes("-")?(_e=Ee.split("-")[0],Ee=Ee.split("-")[1]):Ee.includes("_")&&(_e=Ee.split("_")[0],Ee=Ee.split("_")[1])),Ee)try{console.log("Trying to fetch nickname for user ID:",Ee);const ke=await Lu(Ee);ke&&ke.Nickname?(console.log("Found nickname in Firebase for user ID:",Ee,"Nickname:",ke.Nickname),We[ve.uid]=ke.Nickname,$e=!0):_e?(console.log("Using extracted name for user ID:",Ee,"Name:",_e),We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}catch(ke){console.error("Error fetching user profile:",ke),_e?(We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}else _e?(We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}$e&&B(We)};f.length>0&&Le()},[f,F]),D.useEffect(()=>{if(!t||!s||!v)return;console.log("Setting up screen share event handlers");const Le=async(ve,_e)=>{if(console.log("User published:",ve.uid,_e,ve),_e==="video"){console.log("Remote video track detected:",ve.uid);try{await t.subscribe(ve,_e),console.log("Subscribed to remote video track:",ve.uid),y(Ee=>Ee.some(ke=>ke.uid===ve.uid)?Ee:[...Ee,ve])}catch(Ee){console.error("Error subscribing to remote video track:",Ee)}}},We=(ve,_e)=>{if(console.log("User unpublished:",ve.uid,_e),_e==="video"){if(console.log("Remote video track unpublished:",ve.uid),ve.videoTrack)try{ve.videoTrack.stop()}catch(Ee){console.error("Error stopping video track:",Ee)}if(y(Ee=>Ee.filter(ke=>ke.uid!==ve.uid)),l&&z.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),z.current.play(k.current)}catch(Ee){console.error("Error replaying local screen track:",Ee)}}},$e=ve=>{console.log("User left:",ve.uid);const _e=f.find(Ee=>Ee.uid===ve.uid);if(_e&&_e.videoTrack)try{_e.videoTrack.stop()}catch(Ee){console.error("Error stopping video track:",Ee)}if(y(Ee=>Ee.filter(ke=>ke.uid!==ve.uid)),l&&z.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user left"),z.current.play(k.current)}catch(Ee){console.error("Error replaying local screen track:",Ee)}};return t.on("user-published",Le),t.on("user-unpublished",We),t.on("user-left",$e),()=>{t.off("user-published",Le),t.off("user-unpublished",We),t.off("user-left",$e)}},[t,s,v,f,l]),D.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Le=>{if(Le.videoTrack)try{console.log("Playing video track for:",Le.uid),Le.videoTrack.play(`video-container-${Le.uid}`)}catch(We){console.error("Error playing video track:",We)}}),l&&z.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),z.current.play(k.current)}catch(Le){console.error("Error replaying local screen track:",Le)}},[f,l]),D.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&k.current)try{console.log("Playing local screen track"),a.play(k.current)}catch(Le){console.error("Error playing local screen track:",Le)}},[l,a]),D.useEffect(()=>()=>{if(f.forEach(Le=>{if(Le.videoTrack)try{Le.videoTrack.stop()}catch(We){console.error("Error stopping video track on unmount:",We)}}),a)try{a.stop()}catch(Le){console.error("Error stopping local screen track on unmount:",Le)}},[f,a]);const se=()=>{console.log("Stopping local screen share"),d()},me=Le=>(console.log("Getting display name for UID:",Le,"type:",typeof Le),l&&x&&(Le===x.uid||Le===(t==null?void 0:t.uid))?n||"You":F[Le]?F[Le]:typeof Le=="string"?Le.includes("-")?Le.split("-")[0]:Le.includes("_")?Le.split("_")[0]:Le:"User"),pe=Le=>{console.log("Opening modal for remote screen",Le),$(Le),ue()},le=()=>{console.log("Opening modal for local screen"),$({isLocal:!0}),ue()};return D.useEffect(()=>{ie&&J?(console.log("Modal opened, activeScreen:",J),setTimeout(()=>{if(J.isLocal&&z.current)try{console.log("Playing local screen in modal"),z.current.play("modal-screen-container"),q(!0)}catch(Le){console.error("Error playing local screen in modal:",Le)}else if(J.videoTrack)try{console.log("Playing remote screen in modal"),J.videoTrack.play("modal-screen-container"),q(!0)}catch(Le){console.error("Error playing remote screen in modal:",Le)}},500)):ie||(q(!1),$(null),setTimeout(()=>{if(l&&z.current)try{z.current.play("local-screen-container")}catch(Le){console.error("Error playing local screen in small container:",Le)}f.forEach(Le=>{if(Le.videoTrack)try{Le.videoTrack.play(`video-container-${Le.uid}`)}catch(We){console.error(`Error playing remote screen ${Le.uid} in small container:`,We)}})},500))},[ie,J,l,f]),!v||w&&f.length===0&&!l||f.length===0&&!l?null:R.jsxs(R.Fragment,{children:[!ie&&R.jsxs(wt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:X,children:[l&&a&&R.jsxs(wt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[R.jsx(wt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),R.jsx(wt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Le=>{const We=F[Le.uid]||me(Le.uid);return R.jsxs(wt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>pe(Le),children:[R.jsx(wt,{id:`video-container-${Le.uid}`,width:"100%",height:"100%",position:"relative"}),R.jsx(wt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${We}'s Screen`})]},Le.uid)})]}),ie&&R.jsx(wt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:re,children:R.jsxs(wt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Le=>Le.stopPropagation(),children:[!fe&&R.jsxs(wt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[R.jsx(ap,{size:"xl"}),R.jsx(ct,{mt:4,children:"Loading screen share..."})]}),R.jsx(wt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Q}),R.jsx(wt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:re,children:""}),R.jsx(wt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:J!=null&&J.isLocal?n?`${n}'s Screen`:"Your Screen":`${F[J==null?void 0:J.uid]||me(J==null?void 0:J.uid)}'s Screen`}),(J==null?void 0:J.isLocal)&&R.jsx(wt,{position:"absolute",bottom:4,right:4,children:R.jsx(Kr,{colorScheme:"red",size:"sm",onClick:se,children:"Stop Sharing"})})]})})]})},_We=({onClose:n})=>{const t=ll(),[s,a]=D.useState(!1),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",w)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)y();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}y()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,w)=>{a(!1),b?(d(w),t(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return R.jsx(ct,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function yWe({open:n,onClose:t}){const[s,a]=D.useState(0);return R.jsxs(Mo,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[R.jsx(Fo,{backdropFilter:"blur(4px)"}),R.jsxs(Uo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[R.jsx(Sc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),R.jsx(_a,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),R.jsx(Vo,{p:0,display:"flex",children:R.jsxs(JC,{orientation:"vertical",variant:"unstyled",index:s,onChange:a,display:"flex",flexGrow:1,children:[R.jsxs(QC,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:H8e,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Movement"})]}),R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:$8e,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Camera"})]}),R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:z8e,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Actions"})]}),R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:G8e,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Tips"})]})]}),R.jsxs(kN,{flexGrow:1,display:"flex",flexDirection:"column",children:[R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),R.jsxs(Qi,{wrap:"wrap",gap:3,children:[R.jsx(kl,{keyLabel:"W",description:"Move Forward"}),R.jsx(kl,{keyLabel:"A",description:"Move Left"}),R.jsx(kl,{keyLabel:"S",description:"Move Backward"}),R.jsx(kl,{keyLabel:"D",description:"Move Right"}),R.jsx(kl,{keyLabel:"Shift",description:"Run"}),R.jsx(kl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),R.jsxs(Qi,{wrap:"wrap",gap:3,children:[R.jsx(kl,{keyLabel:"Mouse",description:"Look Around"}),R.jsx(kl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),R.jsx(kl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),R.jsxs(Qi,{wrap:"wrap",gap:3,children:[R.jsx(kl,{keyLabel:"E",description:"Interact"}),R.jsx(kl,{keyLabel:"F",description:"Emote Menu"}),R.jsx(kl,{keyLabel:"T",description:"Chat"}),R.jsx(kl,{keyLabel:"M",description:"Mute Mic"})]})]}),R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),R.jsxs(Di,{align:"stretch",spacing:2,children:[R.jsx(ct,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),R.jsx(ct,{fontSize:"xs",children:" Press ESC to access settings"}),R.jsx(ct,{fontSize:"xs",children:" Click on players to view their profile"}),R.jsx(ct,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const kl=({keyLabel:n,description:t})=>R.jsx(wt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:R.jsxs(Ei,{spacing:2,children:[R.jsx(wt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),R.jsx(ct,{fontSize:"xs",children:t})]})}),EWe=()=>{const[n,t]=D.useState([]),[s,a]=D.useState(""),[l,d]=D.useState(0),[f,y]=D.useState(100),[v,b]=D.useState(100),[w,I]=D.useState(!0),[k,x]=D.useState(!0),[F,B]=D.useState(!1);D.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const re=await MC.getMicrophones();t(re),re.length>0&&a(re[0].deviceId)}catch(re){console.error("Error getting audio devices:",re)}})()},[]),D.useEffect(()=>{const ue=setInterval(()=>{d(F?Math.random()*50:0)},100);return()=>clearInterval(ue)},[F]);const z=ue=>{const re=ue.target.value;a(re),console.log("Microphone changed to:",re)},J=ue=>{y(ue),console.log("Microphone volume set to:",ue)},$=ue=>{b(ue),console.log("Speaker volume set to:",ue)},ie=()=>{B(!F)};return R.jsxs(Di,{spacing:6,align:"stretch",children:[R.jsxs(vi,{children:[R.jsxs(go,{children:["Microphone",R.jsx(Ef,{ml:2,colorScheme:F?"green":"red",children:F?"Enabled":"Muted"})]}),R.jsxs(Une,{value:s,onChange:z,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ue=>R.jsx("option",{value:ue.deviceId,children:ue.label||`Microphone ${ue.deviceId.slice(0,5)}...`},ue.deviceId)),n.length===0&&R.jsx("option",{value:"",children:"No microphones found"})]})]}),R.jsxs(wt,{children:[R.jsx(ct,{mb:2,children:"Microphone Level"}),R.jsx(g0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),R.jsxs(vi,{children:[R.jsxs(go,{children:["Microphone Volume: ",f,"%"]}),R.jsxs(rV,{value:f,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[R.jsx(sV,{bg:"gray.700",children:R.jsx(oV,{})}),R.jsx(iV,{boxSize:6})]})]}),R.jsxs(vi,{children:[R.jsxs(go,{children:["Speaker Volume: ",v,"%"]}),R.jsxs(rV,{value:v,onChange:$,min:0,max:100,step:1,colorScheme:"blue",children:[R.jsx(sV,{bg:"gray.700",children:R.jsx(oV,{})}),R.jsx(iV,{boxSize:6})]})]}),R.jsxs(vi,{display:"flex",alignItems:"center",children:[R.jsx(go,{mb:"0",children:"Microphone Enabled"}),R.jsx(Qh,{isChecked:F,onChange:ie,colorScheme:"green",size:"lg"})]}),R.jsxs(vi,{display:"flex",alignItems:"center",children:[R.jsx(go,{mb:"0",children:"Echo Cancellation"}),R.jsx(Qh,{isChecked:w,onChange:()=>I(!w),colorScheme:"green",size:"lg"})]}),R.jsxs(vi,{display:"flex",alignItems:"center",children:[R.jsx(go,{mb:"0",children:"Noise Suppression"}),R.jsx(Qh,{isChecked:k,onChange:()=>x(!k),colorScheme:"green",size:"lg"})]}),R.jsxs(_f,{status:"info",borderRadius:"md",children:[R.jsx(yf,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function vWe({open:n,onClose:t,containerRef:s}){return R.jsx(Mu,{containerRef:s,children:R.jsxs(Mo,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[R.jsx(Fo,{}),R.jsxs(Uo,{bg:"gray.900",color:"white",borderRadius:"lg",children:[R.jsx(Sc,{children:"Settings"}),R.jsx(_a,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),R.jsx(Vo,{children:R.jsxs(JC,{variant:"enclosed",children:[R.jsxs(QC,{mb:4,children:[R.jsx(_c,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),R.jsx(_c,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),R.jsxs(kN,{children:[R.jsx(Nl,{children:R.jsx(wt,{p:4,bg:"gray.800",borderRadius:"md",children:R.jsx(EWe,{})})}),R.jsx(Nl,{children:R.jsx(wt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function SWe(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function bWe(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function r0(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function Coe(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function TWe(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function wWe(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function CWe(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function cC(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function YV(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function oQ(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function jS(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function RWe(n){return Ar({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const IWe=async()=>{try{ee.log("tagsFirestore: Fetching all tags");const n=Ag(Ir,"tags"),t=await Vy(n),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),s}catch(n){throw ee.error("tagsFirestore: Error fetching tags:",n),n}},AWe=async n=>{try{ee.log(`tagsFirestore: Fetching tag with ID: ${n}`);const t=ri(Ir,"tags",n),s=await ga(t);return s.exists()?{id:s.id,...s.data()}:(ee.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(t){throw ee.error(`tagsFirestore: Error fetching tag with ID ${n}:`,t),t}},PWe=async({id:n,name:t,color:s,description:a})=>{try{ee.log(`tagsFirestore: Creating new tag: ${t}`);const l={name:t,color:s||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const f=ri(Ir,"tags",n);await R0(f,l),d=n}else{const f=Ag(Ir,"tags");d=(await U5e(f,l)).id}return{id:d,...l}}catch(l){throw ee.error("tagsFirestore: Error creating tag:",l),l}},OWe=async(n,t)=>{try{ee.log(`tagsFirestore: Adding tag ${t} to space ${n}`);const s=ri(Ir,"tags",t);if(!(await ga(s)).exists())throw new Error(`Tag with ID ${t} does not exist`);const l=ri(Ir,"spaces",n);return await Ea(l,{tags:F5e(t)}),!0}catch(s){throw ee.error(`tagsFirestore: Error adding tag ${t} to space ${n}:`,s),s}},kWe=async(n,t)=>{try{ee.log(`tagsFirestore: Removing tag ${t} from space ${n}`);const s=ri(Ir,"spaces",n);return await Ea(s,{tags:j5e(t)}),!0}catch(s){throw ee.error(`tagsFirestore: Error removing tag ${t} from space ${n}:`,s),s}},NWe=async n=>{try{ee.log(`tagsFirestore: Getting tags for space ${n}`);const t=ri(Ir,"spaces",n),s=await ga(t);if(!s.exists())throw new Error(`Space with ID ${n} not found`);const l=s.data().tags||[];if(l.length===0)return[];const d=[];for(const f of l){const y=await AWe(f);y&&d.push(y)}return d}catch(t){throw ee.error(`tagsFirestore: Error getting tags for space ${n}:`,t),t}},DWe=async()=>{ee.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let t=0,s=0;for(const a of n){ee.log(`tagsFirestore: Processing tag: ${a.name}`);const l=ri(Ir,"tags",a.id);(await ga(l)).exists()?(ee.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),s++):(await PWe(a),t++,ee.log(`tagsFirestore: Created tag: ${a.name}`))}return ee.log(`tagsFirestore: Tags initialization complete. Created: ${t}, Skipped: ${s}`),{created:t,skipped:s}}catch(t){throw ee.error("tagsFirestore: Error initializing default tags:",t),t}},Roe=({spaceID:n})=>{const[t,s]=D.useState([]),[a,l]=D.useState([]),[d,f]=D.useState(!0),[y,v]=D.useState(!1),[b,w]=D.useState(!1),[I,k]=D.useState(null),{isOpen:x,onOpen:F,onClose:B}=kf(),z=ll(),{user:J}=D.useContext(ul),$=(J==null?void 0:J.groups)&&(J.groups.includes("disruptiveAdmin")||J.groups.includes("admin"));D.useEffect(()=>{ie()},[n]);const ie=async()=>{f(!0);try{let Q=[];try{Q=await IWe(),s(Q)}catch(se){ee.error("SpaceTagsManager: Error loading available tags:",se),s([]),z({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const se=await NWe(n);l(se)}catch(se){ee.error("SpaceTagsManager: Error loading space tags:",se),l([]),z({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Q){ee.error("SpaceTagsManager: Error in loadTags:",Q),z({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},ue=async()=>{w(!0),k(null);try{const Q=await DWe();console.log("Tag initialization result:",Q),k(Q),z({title:"Tags initialized",description:`Successfully created ${Q.created} tags. Skipped ${Q.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ie()}catch(Q){ee.error("SpaceTagsManager: Error initializing tags:",Q),k(!1),z({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{w(!1)}},re=async Q=>{if(!(!n||!Q)){v(!0);try{await OWe(n,Q);const se=t.find(me=>me.id===Q);se&&l(me=>[...me,se]),z({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(se){ee.error(`SpaceTagsManager: Error adding tag ${Q} to space:`,se),z({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},fe=async Q=>{if(!(!n||!Q)){v(!0);try{await kWe(n,Q),l(se=>se.filter(me=>me.id!==Q)),z({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(se){ee.error(`SpaceTagsManager: Error removing tag ${Q} from space:`,se),z({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},q=()=>{const Q=a.map(se=>se.id);return t.filter(se=>!Q.includes(se.id))},X=q().length===0;return R.jsxs(wt,{children:[R.jsx(Qi,{mb:3,justifyContent:"space-between",alignItems:"center",children:R.jsxs(Ei,{spacing:2,ml:"auto",children:[$&&R.jsx(Kr,{size:"xs",leftIcon:R.jsx(A8e,{}),onClick:F,variant:"outline",colorScheme:"purple",children:"Admin"}),R.jsxs(SN,{children:[R.jsx(bN,{as:Kr,size:"xs",leftIcon:R.jsx(I8e,{}),rightIcon:R.jsx(O8e,{}),isDisabled:d||y||X,children:X?"No Available Tags":"Add Tag"}),R.jsx(TN,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:q().length>0?q().map(Q=>R.jsx(JS,{onClick:()=>re(Q.id),icon:R.jsx(wt,{width:"12px",height:"12px",borderRadius:"full",bg:Q.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Q.name},Q.id)):R.jsx(JS,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?R.jsx(Qi,{justify:"center",py:4,children:R.jsx(ap,{size:"sm",color:"blue.300"})}):t.length===0?R.jsx(wt,{children:R.jsxs(ct,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",$?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?R.jsx(ct,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):R.jsx(qne,{spacing:2,children:a.map(Q=>R.jsx(Dj,{children:R.jsxs(zne,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Q.color||"#888"}`,children:[R.jsx(wt,{width:"8px",height:"8px",borderRadius:"full",bg:Q.color||"#888",mr:1}),R.jsx(Gne,{children:Q.name}),R.jsx($ne,{onClick:()=>fe(Q.id),isDisabled:y})]})},Q.id))}),R.jsxs(Mo,{isOpen:x,onClose:B,size:"md",children:[R.jsx(Fo,{backdropFilter:"blur(4px)"}),R.jsxs(Uo,{bg:"gray.800",color:"white",children:[R.jsx(Sc,{fontSize:"md",children:"Tag System Administration"}),R.jsx(_a,{}),R.jsxs(Vo,{children:[R.jsx(ct,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&R.jsxs(_f,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[R.jsx(yf,{}),R.jsxs(ct,{fontSize:"sm",children:["Tags initialized. Created: ",R.jsx("b",{children:I.created}),", Skipped: ",R.jsx("b",{children:I.skipped})]})]}),R.jsx(Kr,{colorScheme:"blue",onClick:ue,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),R.jsx(Mf,{children:R.jsx(Kr,{variant:"ghost",size:"sm",onClick:B,children:"Close"})})]})]})]})};Roe.propTypes={spaceID:Tn.string.isRequired};const LWe=({isOpen:n,onClose:t})=>{const{spaceID:s}=va(),[a,l]=D.useState(0),[d,f]=D.useState(""),[y,v]=D.useState(""),[b,w]=D.useState(!1),[I,k]=D.useState(null),[x,F]=D.useState(null),[B,z]=D.useState(!1),[J,$]=D.useState(0),[ie,ue]=D.useState(null),re=D.useRef(null),[fe,q]=D.useState(null),[X,Q]=D.useState(null),[se,me]=D.useState(!1),[pe,le]=D.useState(0),[Le,We]=D.useState(null),$e=D.useRef(null),[ve,_e]=D.useState([]),[Ee,ke]=D.useState([]),[we,be]=D.useState(!1),[Ie,Me]=D.useState(!1),[ze,Je]=D.useState(!0),[tt,ut]=D.useState(!1),[Ze,vt]=D.useState(!1),[sn,Mt]=D.useState(""),[Qt,on]=D.useState(""),[Ht,jn]=D.useState(""),[Wt,Re]=D.useState(!1),{setHLSStreamUrl:Fe,savedStreamData:Ge}=Zse(),ot=ll();D.useEffect(()=>{n&&s&&_t()},[n,s]);const _t=async()=>{try{const Ot=await _g(s);Ot.logoUrl&&ue(Ot.logoUrl),Ot.backgroundUrl&&We(Ot.backgroundUrl),Ot.voiceDisabled!==void 0&&Me(Ot.voiceDisabled),Ot.accessibleToAllUsers!==void 0&&Je(Ot.accessibleToAllUsers),f(Ot.name||""),v(Ot.description||"");try{const On=await qse(s);if(On){Mt(On.streamUrl||""),on(On.rtmpUrl||""),jn(On.streamKey||"");const or=On.enabled===!0;vt(or),ee.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:or,rawValue:On.enabled})}else vt(!1),ee.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(On){if(ee.error("Error fetching stream data directly:",On),Ge){Mt(Ge.streamUrl||""),on(Ge.rtmpUrl||""),jn(Ge.streamKey||"");const or=Ge.enabled===!0;vt(or),ee.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:or,rawValue:Ge.enabled})}else vt(!1),ee.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}yt(Ot)}catch(Ot){ee.error("Error fetching space data:",Ot),ot({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};D.useEffect(()=>{if(Ge){if(!Wt){Mt(Ge.streamUrl||""),on(Ge.rtmpUrl||""),jn(Ge.streamKey||"");const Ot=Ge.enabled===!0;vt(Ot),ee.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:Ot,rawValue:Ge.enabled})}}else n&&!Wt&&ee.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Ge,Wt,n]);const yt=async Ot=>{if(s&&n){be(!0);try{const On=NV(),or=`space_${s}_owners`,xi=LV(Ag(On,"users"),vJ("groups","array-contains",or)),bc=await Vy(xi),cs=[];for(const ro of bc.docs){const _s=ro.data(),ls=await Lu(ro.id);cs.push({uid:ro.id,email:_s.email,displayName:_s.displayName||ls.Nickname||"Unknown User",photoURL:_s.photoURL||ls.photoURL,firstName:ls.firstName,lastName:ls.lastName})}_e(cs);const Sa=`space_${s}_hosts`,vo=LV(Ag(On,"users"),vJ("groups","array-contains",Sa)),ba=await Vy(vo),Ta=[];for(const ro of ba.docs){const _s=ro.data(),ls=await Lu(ro.id);Ta.push({uid:ro.id,email:_s.email,displayName:_s.displayName||ls.Nickname||"Unknown User",photoURL:_s.photoURL||ls.photoURL,firstName:ls.firstName,lastName:ls.lastName})}ke(Ta)}catch(On){ee.error("Error fetching space users:",On),ot({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{be(!1)}}};D.useEffect(()=>{s&&n&&a===4&&yt()},[s,n,a]);const Gt=Ot=>{const On=Ot.target.files[0];if(On){if(!On.type.startsWith("image/")){ot({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}k(On);const or=new FileReader;or.onloadend=()=>{F(or.result)},or.readAsDataURL(On)}},mn=Ot=>{const On=Ot.target.files[0];if(On){if(!On.type.startsWith("image/")){ot({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}q(On);const or=new FileReader;or.onloadend=()=>{Q(or.result)},or.readAsDataURL(On)}},Pn=async()=>{if(!I){ot({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{z(!0);const Ot=setInterval(()=>{$(or=>{const xi=or+10;return xi>=90?90:xi})},300),On=await f6e(s,I);clearInterval(Ot),$(100),ue(On),ot({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{k(null),F(null),$(0),z(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:On}}))}catch(Ot){console.error("Error uploading logo:",Ot),ot({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),z(!1),$(0)}},un=async()=>{if(!fe){ot({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{me(!0);const Ot=setInterval(()=>{le(or=>{const xi=or+10;return xi>=90?90:xi})},300),On=await g6e(s,fe);clearInterval(Ot),le(100),We(On),ot({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{q(null),Q(null),le(0),me(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:On}}))}catch(Ot){console.error("Error uploading background:",Ot),ot({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),me(!1),le(0)}},bt=async()=>{if(ie)try{z(!0),await m6e(s),ue(null),ot({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),z(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ot){console.error("Error deleting logo:",Ot),ot({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),z(!1)}},lr=async()=>{if(Le)try{me(!0),await _6e(s),We(null),ot({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),me(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ot){console.error("Error deleting background:",Ot),ot({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),me(!1)}},Nt=()=>{re.current&&re.current.click()},Kt=()=>{$e.current&&$e.current.click()},qr=async()=>{ut(!0);try{await y6e(s,{voiceDisabled:!Ie}),Me(!Ie),ot({title:"Settings Updated",description:`Voice chat has been ${Ie?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){ee.error("Error updating voice settings:",Ot),ot({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{ut(!1)}},ji=async()=>{ut(!0);try{await E6e(s,!ze),Je(!ze),ot({title:"Settings Updated",description:`Space is now ${ze?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){ee.error("Error updating accessibility settings:",Ot),ot({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{ut(!1)}},Ms=async()=>{if(s){w(!0);try{const Ot=NV(),On=ri(Ot,"spaces",s);await Ea(On,{name:d,description:y}),ot({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:y}}))}catch(Ot){ee.error("Error updating space details:",Ot),ot({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}}},ii=async()=>{if(s){Re(!0);try{const Ot={enabled:Ze,streamUrl:sn,rtmpUrl:Qt,streamKey:Ht,playerIndex:"0",updatedAt:new Date().toISOString()};ee.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Ze,url:sn,hasRtmp:!!Qt,hasKey:!!Ht});try{await UV(s,Ot),ee.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(On){throw ee.error("SpaceManageModal: Error updating stream settings directly in Firebase:",On),On}await Fe(sn,0,{enabled:Ze,rtmpUrl:Qt,streamKey:Ht}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ze,spaceId:s}})),ot({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Ze?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{_t()},500)}catch(Ot){ee.error("Error updating stream settings:",Ot),ot({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Re(!1)}}};return R.jsxs(Mo,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[R.jsx(Fo,{backdropFilter:"blur(4px)"}),R.jsxs(Uo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[R.jsx(Sc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),R.jsx(_a,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),R.jsx(Vo,{p:0,display:"flex",overflow:"hidden",children:R.jsxs(JC,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",width:"100%",height:"100%",children:[R.jsxs(QC,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:Coe,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Details"})]}),R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:r0,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Logo"})]}),R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:bWe,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Background"})]}),R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:wWe,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Settings"})]}),R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:oQ,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Users"})]}),R.jsxs(_c,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[R.jsx(In,{as:jS,mb:1}),R.jsx(ct,{fontSize:"xs",children:"Stream"})]})]}),R.jsxs(kN,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),R.jsxs(Di,{spacing:4,align:"stretch",children:[R.jsxs(vi,{children:[R.jsx(go,{fontSize:"xs",children:"Space Name"}),R.jsx(os,{value:d,onChange:Ot=>f(Ot.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),R.jsxs(vi,{children:[R.jsx(go,{fontSize:"xs",children:"Description"}),R.jsx(Kne,{value:y,onChange:Ot=>v(Ot.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),R.jsxs(vi,{children:[R.jsx(go,{fontSize:"xs",children:"Space Tags"}),R.jsx(wt,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:s?R.jsx(Roe,{spaceID:s}):R.jsxs(_f,{status:"warning",variant:"subtle",borderRadius:"md",children:[R.jsx(yf,{}),R.jsx(US,{fontSize:"sm",children:"Space ID missing"}),R.jsx(VS,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),R.jsx(Kr,{colorScheme:"blue",size:"sm",onClick:Ms,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),R.jsx(ct,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ie||x)&&R.jsxs(Qi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ie&&R.jsxs(wt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[R.jsx(ct,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),R.jsx(zh,{src:ie,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),R.jsx(Kr,{mt:3,colorScheme:"red",leftIcon:R.jsx(In,{as:cC}),onClick:bt,isLoading:B,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),x&&R.jsxs(wt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[R.jsx(ct,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),R.jsx(zh,{src:x,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),R.jsxs(vi,{children:[R.jsx(go,{fontSize:"xs",children:"Upload New Logo"}),R.jsx(os,{type:"file",accept:"image/*",onChange:Gt,ref:re,display:"none"}),B&&R.jsxs(wt,{mt:3,mb:3,children:[R.jsxs(ct,{fontSize:"xs",mb:1,children:["Uploading... ",J,"%"]}),R.jsx(g0,{value:J,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),R.jsxs(Ei,{mt:3,spacing:3,children:[R.jsx(Kr,{colorScheme:"blue",leftIcon:R.jsx(In,{as:r0}),onClick:Nt,isDisabled:B,size:"sm",variant:"outline",children:"Browse"}),R.jsx(Kr,{colorScheme:"green",leftIcon:R.jsx(In,{as:YV}),onClick:Pn,isLoading:B,loadingText:"Uploading...",isDisabled:!I||B,size:"sm",children:"Upload"})]}),R.jsx(SC,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),R.jsx(ct,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Le||X)&&R.jsxs(Qi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Le&&R.jsxs(wt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[R.jsx(ct,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),R.jsx(zh,{src:Le,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),R.jsx(Kr,{mt:3,colorScheme:"red",leftIcon:R.jsx(In,{as:cC}),onClick:lr,isLoading:se,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),X&&R.jsxs(wt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[R.jsx(ct,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),R.jsx(zh,{src:X,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),R.jsxs(vi,{children:[R.jsx(go,{fontSize:"xs",children:"Upload New Background"}),R.jsx(os,{type:"file",accept:"image/*",onChange:mn,ref:$e,display:"none"}),se&&R.jsxs(wt,{mt:3,mb:3,children:[R.jsxs(ct,{fontSize:"xs",mb:1,children:["Uploading... ",pe,"%"]}),R.jsx(g0,{value:pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),R.jsxs(Ei,{mt:3,spacing:3,children:[R.jsx(Kr,{colorScheme:"blue",leftIcon:R.jsx(In,{as:r0}),onClick:Kt,isDisabled:se,size:"sm",variant:"outline",children:"Browse"}),R.jsx(Kr,{colorScheme:"green",leftIcon:R.jsx(In,{as:YV}),onClick:un,isLoading:se,loadingText:"Uploading...",isDisabled:!fe||se,size:"sm",children:"Upload"})]}),R.jsx(SC,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),R.jsx(ct,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),R.jsxs(Di,{spacing:4,align:"stretch",children:[R.jsx(wt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:R.jsxs(Ei,{justify:"space-between",align:"center",children:[R.jsxs(wt,{children:[R.jsxs(Ei,{mb:1,spacing:2,children:[R.jsxs(wt,{position:"relative",w:"16px",h:"16px",children:[R.jsx(In,{as:RWe,color:Ie?"red.400":"green.400"}),Ie&&R.jsx(wt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),R.jsx(ct,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),R.jsx(ct,{fontSize:"xs",color:"whiteAlpha.800",children:Ie?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),R.jsx(Qh,{isChecked:!Ie,onChange:qr,colorScheme:"green",size:"md",isDisabled:tt})]})}),R.jsx(wt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:R.jsxs(Ei,{justify:"space-between",align:"center",children:[R.jsxs(wt,{children:[R.jsxs(Ei,{mb:1,spacing:2,children:[R.jsx(wt,{position:"relative",w:"16px",h:"16px",children:R.jsx(In,{as:oQ,color:ze?"green.400":"red.400"})}),R.jsx(ct,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),R.jsx(ct,{fontSize:"xs",color:"whiteAlpha.800",children:ze?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),R.jsx(ct,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),R.jsx(Qh,{isChecked:ze,onChange:ji,colorScheme:"green",size:"md",isDisabled:tt})]})}),R.jsxs(_f,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[R.jsx(yf,{color:"blue.300"}),R.jsxs(wt,{children:[R.jsx(US,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),R.jsx(VS,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),R.jsx(ct,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),we?R.jsx(Qi,{justify:"center",align:"center",h:"200px",children:R.jsx(ap,{color:"blue.300"})}):R.jsxs(Di,{spacing:4,align:"stretch",children:[R.jsxs(wt,{children:[R.jsxs(Ei,{mb:2,children:[R.jsx(In,{as:SWe,color:"green.400"}),R.jsx(ct,{fontSize:"sm",fontWeight:"600",children:"Owners"}),R.jsx(Ef,{colorScheme:"green",ml:2,children:ve.length})]}),R.jsx(wt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ve.length===0?R.jsx(ct,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):R.jsx(Di,{spacing:1,align:"stretch",children:ve.map(Ot=>R.jsxs(Ei,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[R.jsx(ip,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),R.jsxs(wt,{children:[R.jsx(ct,{fontSize:"xs",children:Ot.displayName}),R.jsx(ct,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),R.jsx(Pk,{}),R.jsx(Ef,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ot.uid))})})]}),R.jsxs(wt,{children:[R.jsxs(Ei,{mb:2,children:[R.jsx(In,{as:CWe,color:"purple.400"}),R.jsx(ct,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),R.jsx(Ef,{colorScheme:"purple",ml:2,children:Ee.length})]}),R.jsx(wt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:Ee.length===0?R.jsx(ct,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):R.jsx(Di,{spacing:1,align:"stretch",children:Ee.map(Ot=>R.jsxs(Ei,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[R.jsx(ip,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),R.jsxs(wt,{children:[R.jsx(ct,{fontSize:"xs",children:Ot.displayName}),R.jsx(ct,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),R.jsx(Pk,{}),R.jsx(Ef,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ot.uid))})})]}),R.jsx(hg,{borderColor:"whiteAlpha.200"}),R.jsxs(_f,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[R.jsx(yf,{color:"blue.300",boxSize:4}),R.jsxs(wt,{children:[R.jsx(US,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),R.jsx(VS,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]}),R.jsxs(Nl,{p:4,display:"flex",flexDirection:"column",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),R.jsxs(Di,{spacing:4,align:"stretch",children:[R.jsx(wt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:R.jsxs(Ei,{justify:"space-between",align:"center",children:[R.jsx(wt,{children:R.jsxs(Ei,{mb:1,spacing:2,children:[R.jsx(wt,{position:"relative",w:"16px",h:"16px",children:R.jsx(In,{as:jS,color:Ze?"green.400":"red.400"})}),R.jsx(ct,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),R.jsx(Qh,{isChecked:Ze,onChange:async()=>{const Ot=!Ze;vt(Ot),Re(!0);try{ee.log("SpaceManageModal: Auto-saving streaming enabled state:",Ot);const On={enabled:Ot,streamUrl:sn||"",rtmpUrl:Qt||"",streamKey:Ht||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await UV(s,On),ee.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(or){throw ee.error("SpaceManageModal: Error updating streaming state directly in Firebase:",or),or}await Fe(sn,0,{enabled:Ot,rtmpUrl:Qt,streamKey:Ht}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ot,spaceId:s}})),ot({title:"Streaming "+(Ot?"Enabled":"Disabled"),description:`Streaming is now ${Ot?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(On){ee.error("Error auto-saving streaming state:",On),vt(!Ot),ot({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Re(!1),setTimeout(()=>{_t()},500)}},colorScheme:"green",size:"md",isDisabled:Wt})]})}),R.jsxs(wt,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),R.jsxs(vi,{mb:4,children:[R.jsx(go,{fontSize:"xs",children:"Stream URL"}),R.jsx(os,{value:sn,onChange:Ot=>Mt(Ot.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wt})]}),R.jsx(hg,{my:3,borderColor:"whiteAlpha.200"}),R.jsx(ct,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),R.jsxs(vi,{mb:3,children:[R.jsx(go,{fontSize:"xs",children:"RTMP URL"}),R.jsx(os,{value:Qt,onChange:Ot=>on(Ot.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wt})]}),R.jsxs(vi,{mb:3,children:[R.jsx(go,{fontSize:"xs",children:"Stream Key"}),R.jsx(os,{value:Ht,onChange:Ot=>jn(Ot.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wt,type:"password"})]})]}),R.jsx(Kr,{colorScheme:"blue",size:"sm",onClick:ii,isLoading:Wt,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Ze?"inline-flex":"none",children:"Save Stream Settings"}),R.jsxs(_f,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[R.jsx(yf,{color:"blue.300"}),R.jsxs(wt,{children:[R.jsx(US,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),R.jsx(VS,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},xWe=({onTogglePlayerList:n,spaceID:t})=>{const{fullscreenRef:s}=Md(),[a,l]=D.useState(!0),[d,f]=D.useState(!1),[y,v]=D.useState(!1),[b,w]=D.useState(!1),[I,k]=D.useState(!1),[x,F]=D.useState(!1),[B,z]=D.useState(null),[J,$]=D.useState(!1),[ie,ue]=D.useState(!1),[re,fe]=D.useState(!1),[q,X]=D.useState(!1),Q=ll(),{user:se}=D.useContext(ul),me=(se==null?void 0:se.Nickname)||"Unknown",[pe,le]=D.useState(!1),Le=async()=>{if(se!=null&&se.uid&&t)try{const be=await Lu(se.uid);let Ie=!1,Me=!1;if(be.groups){const Je=`space_${t}_owners`,tt=`space_${t}_hosts`;Ie=be.groups.includes(Je),Me=be.groups.includes(tt)}const ze=await Ose(se.uid,"disruptiveAdmin");if(X(ze),z({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),ue(Ie||ze),fe(Me),!Ie&&!ze&&J){$(!1);const Je=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Je),Q({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),ue(!1),fe(!1),X(!1)}else ue(!1),fe(!1),X(!1)};D.useEffect(()=>{Le()},[se==null?void 0:se.uid,t,J]),D.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),D.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&le(window.agoraClient.voiceDisabled)}catch(Me){console.error("Error checking if voice is disabled:",Me)}})();const Ie=Me=>{Me.detail&&typeof Me.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Me.detail.voiceDisabled),le(Me.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ie),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ie)}},[]);const We=()=>v(!y),$e=()=>w(!b),ve=()=>{F(!x),ke()},_e=()=>{k(!1),Le()},Ee=be=>{be.stopPropagation(),typeof n=="function"&&(ee.log("CanvasMainMenu: Toggling player list"),n())},ke=()=>{f(!1)},we=be=>{if(be.stopPropagation(),!ie){Q({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ie=!J;$(Ie);const Me=new CustomEvent("editModeChanged",{detail:{enabled:Ie}});window.dispatchEvent(Me),Q({title:Ie?"Edit Mode Enabled":"Edit Mode Disabled",description:Ie?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ie?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return R.jsxs(R.Fragment,{children:[R.jsxs(SN,{isOpen:d,onClose:()=>f(!1),children:[R.jsx(bN,{as:xo,icon:R.jsx(D8e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!d)}),R.jsx(Mu,{containerRef:s,children:R.jsx(TN,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:R.jsxs(Di,{align:"stretch",spacing:4,children:[R.jsxs(Ei,{children:[R.jsx(ip,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),R.jsxs(Di,{align:"start",spacing:0,children:[R.jsxs(Ei,{children:[R.jsx(ct,{fontWeight:"bold",children:me}),ie&&!q&&R.jsx(Af,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:R.jsx(wt,{display:"inline-block",children:R.jsx(In,{as:HV,color:"green.400",boxSize:3})})}),!ie&&re&&!q&&R.jsx(Af,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:R.jsx(wt,{display:"inline-block",children:R.jsx(In,{as:qV,color:"purple.400",boxSize:3})})}),q&&R.jsx(Af,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:R.jsx(wt,{display:"inline-block",children:R.jsx(In,{as:q8e,color:"blue.400",boxSize:3})})})]}),R.jsx(ct,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),R.jsxs(Ei,{spacing:4,justify:"center",children:[R.jsx(xo,{icon:R.jsx(X8e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:Ee}),ie&&R.jsx(xo,{icon:R.jsx(B8e,{}),variant:"ghost",colorScheme:J?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:we}),R.jsx(xo,{icon:R.jsx(wt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),R.jsx(xo,{icon:R.jsx(wt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),R.jsx(hg,{borderColor:"whiteAlpha.300"}),R.jsxs(Di,{align:"stretch",spacing:2,children:[ie&&R.jsxs(Ei,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[R.jsx(ct,{fontSize:"md",children:"Edit Mode"}),R.jsx(Qh,{id:"edit-mode-toggle",isChecked:J,onChange:we,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:J?"green.500":"black"}}})]}),ie&&R.jsx(ct,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ve,children:"Manage Space"}),se&&t&&!pe&&R.jsx(_We,{onClose:ke}),R.jsx(ct,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:We,children:"Settings"}),R.jsx(ct,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:$e,children:"Controls"}),R.jsx(ct,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),R.jsx(ct,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&R.jsx(yWe,{open:b,onClose:$e}),y&&R.jsx(vWe,{open:y,onClose:We}),I&&R.jsx(Eoe,{open:I,onClose:_e}),R.jsx(LWe,{isOpen:x,onClose:ve})]})},MWe=({isOpen:n,onClose:t,mediaScreenId:s,onImageChange:a})=>{const{spaceID:l}=va(),d=up(),f=ll(),y=D.useRef(null),v=D.useRef(null),b=D.useRef(),[w,I]=D.useState(null),[k,x]=D.useState(""),[F,B]=D.useState(!1),[z,J]=D.useState(0),[$,ie]=D.useState(null),[ue,re]=D.useState(!0),[fe,q]=D.useState(!1),[X,Q]=D.useState(!1),[se,me]=D.useState(0),[pe,le]=D.useState("image"),[Le,We]=D.useState(""),[$e,ve]=D.useState(!1);D.useEffect(()=>{(async()=>{if(n&&s&&l){re(!0);try{const vt=await Tf(l,s);if(vt&&(vt.imageUrl||vt.videoUrl)){ie(vt);const sn=vt.mediaType==="video";le(sn?"video":"image"),ve(vt.displayAsVideo||!1),sn&&vt.videoUrl&&(We(vt.videoUrl),me(1))}else ie(null)}catch(vt){ee.error("Error fetching existing image:",vt),ie(null)}finally{re(!1)}}})()},[n,s,l]),D.useEffect(()=>{n||(I(null),x(""),J(0),We(""))},[n]);const _e=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),Q(!0)},[]),Ee=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),Q(!1)},[]),ke=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation()},[]),we=D.useCallback(Ze=>{if(Ze.preventDefault(),Ze.stopPropagation(),Q(!1),Ze.dataTransfer.files&&Ze.dataTransfer.files.length>0){const vt=Ze.dataTransfer.files[0];be(vt)}},[]);D.useEffect(()=>{const Ze=v.current;if(Ze)return Ze.addEventListener("dragenter",_e),Ze.addEventListener("dragleave",Ee),Ze.addEventListener("dragover",ke),Ze.addEventListener("drop",we),()=>{Ze.removeEventListener("dragenter",_e),Ze.removeEventListener("dragleave",Ee),Ze.removeEventListener("dragover",ke),Ze.removeEventListener("drop",we)}},[_e,Ee,ke,we]);const be=Ze=>{if(!Ze)return;if(!Ze.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(Ze);const vt=new FileReader;vt.onloadend=()=>{x(vt.result)},vt.readAsDataURL(Ze)},Ie=Ze=>{const vt=Ze.target.files[0];be(vt)},Me=async Ze=>{const vt=Ze.target.checked;if(ve(vt),$)try{await U6e(l,s,vt),vt?d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:$.imageUrl||null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!1}),ie({...$,displayAsVideo:vt}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${vt?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),ee.log(`Updated display mode for media screen ${s} to ${vt?"video":"image"}`),a&&a({type:"update",mediaScreenId:s,displayAsVideo:vt})}catch(sn){ee.error("Error updating display mode:",sn),f({title:"Update failed",description:sn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),ve(!vt)}},ze=async()=>{if(pe==="image"&&!w){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(pe==="video"&&!Le){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const Ze=setInterval(()=>{J(Qt=>{const on=Qt+10;return on>=90?90:on})},300);let vt;pe==="image"?vt=await BJ(l,s,w,{mediaType:pe,displayAsVideo:$e}):(vt=Le,await BJ(l,s,null,{mediaType:"video",directUrl:Le,displayAsVideo:$e})),clearInterval(Ze),J(100);let sn=null,Mt=null;pe==="image"?(sn=$e?null:vt,Mt=($==null?void 0:$.videoUrl)||null):(sn=!$e&&($!=null&&$.imageUrl)?$.imageUrl:null,Mt=vt),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:sn,videoUrl:Mt,mediaType:pe,displayAsVideo:$e}),ee.log(`Uploaded and sent ${pe} for media screen ${s} (display as video: ${$e})`),a&&a({type:"upload",mediaScreenId:s,imageUrl:pe==="image"?vt:$==null?void 0:$.imageUrl,videoUrl:pe==="video"?vt:$==null?void 0:$.videoUrl,mediaType:pe,displayAsVideo:$e}),f({title:"Upload successful",description:`The ${pe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),x(""),B(!1),J(0),t()},1e3)}catch(Ze){ee.error(`Error uploading ${pe}:`,Ze),f({title:"Upload failed",description:Ze.message||`An error occurred while uploading the ${pe}`,status:"error",duration:5e3,isClosable:!0}),B(!1),J(0)}},Je=async()=>{q(!1);try{B(!0),await M6e(l,s),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:pe==="image"?null:($==null?void 0:$.imageUrl)||null,videoUrl:pe==="video"?null:($==null?void 0:$.videoUrl)||null,mediaType:null,displayAsVideo:!1}),ee.log(`Deleted ${pe} for media screen ${s}`),a&&a({type:"delete",mediaScreenId:s}),f({title:`${pe==="image"?"Image":"Video"} deleted`,description:`The ${pe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ie(null),B(!1),We(""),ve(!1),setTimeout(()=>{t()},500)}catch(Ze){ee.error(`Error deleting ${pe}:`,Ze),f({title:"Deletion failed",description:Ze.message||`An error occurred while deleting the ${pe}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},tt=()=>{F||(I(null),x(""),J(0),t())},ut=Ze=>{me(Ze),le(Ze===0?"image":"video")};return R.jsxs(R.Fragment,{children:[R.jsxs(Mo,{isOpen:n,onClose:tt,size:"xl",children:[R.jsx(Fo,{backdropFilter:"blur(10px)"}),R.jsxs(Uo,{bg:"gray.800",color:"white",maxW:"900px",children:[R.jsx(Sc,{children:"Media Screen Content"}),R.jsx(_a,{isDisabled:F}),R.jsxs(wt,{px:6,pb:2,children:[R.jsxs(Qi,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[R.jsxs(Ei,{spacing:4,children:[R.jsx(ct,{fontWeight:"medium",children:"Display as:"}),R.jsxs(Ei,{spacing:2,children:[R.jsx(In,{as:r0,color:$e?"gray.400":"green.300"}),R.jsx(Qh,{colorScheme:"purple",size:"md",isChecked:$e,onChange:Me}),R.jsx(In,{as:jS,color:$e?"purple.300":"gray.400"})]})]}),R.jsx(Ef,{colorScheme:$e?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:$e?"Video Output":"Image Output"})]}),R.jsxs(ct,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",R.jsx("strong",{children:s})]}),R.jsx(ct,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),R.jsx(hg,{mb:4})]}),R.jsx(Vo,{children:R.jsxs(Qi,{children:[R.jsx(JC,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:se,onChange:ut,h:"100%",minW:"120px",mr:4,children:R.jsxs(QC,{children:[R.jsxs(_c,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[R.jsx(In,{as:r0,mr:2})," Image"]}),R.jsxs(_c,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[R.jsx(In,{as:jS,mr:2})," Video"]})]})}),R.jsx(wt,{flex:"1",children:ue?R.jsx(Qi,{justify:"center",align:"center",h:"150px",children:R.jsx(ap,{size:"xl",color:"blue.400"})}):R.jsxs(R.Fragment,{children:[R.jsx(wt,{children:se===0?R.jsxs(Di,{spacing:4,align:"stretch",children:[$&&$.imageUrl&&pe==="image"&&R.jsxs(wt,{children:[R.jsx(ct,{fontWeight:"semibold",mb:2,children:"Current Image:"}),R.jsxs(Qi,{children:[R.jsx(wt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:R.jsx(zh,{src:$.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),R.jsxs(Di,{align:"flex-start",spacing:2,children:[R.jsxs(ct,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date($.uploadedAt).toLocaleString()]}),R.jsxs(ct,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),R.jsx(Kr,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:R.jsx(In,{as:cC}),onClick:()=>q(!0),isDisabled:F,children:"Delete"})]})]}),R.jsx(hg,{my:4})]}),R.jsx(ct,{fontWeight:"semibold",mb:2,children:$&&$.imageUrl&&pe==="image"?"Replace with new image:":"Upload new image:"}),R.jsxs(wt,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:X?"blue.400":"gray.500",bg:X?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>y.current.click(),children:[k?R.jsx(wt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:R.jsx(zh,{src:k,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):R.jsxs(Di,{spacing:2,children:[R.jsx(In,{as:YV,boxSize:"24px",color:"gray.400"}),R.jsx(ct,{children:"Drag and drop an image here, or click to browse"}),R.jsx(ct,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),R.jsx(os,{type:"file",accept:"image/*",onChange:Ie,ref:y,display:"none"})]}),w&&R.jsxs(ct,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):R.jsxs(Di,{spacing:4,align:"stretch",children:[$&&$.videoUrl&&pe==="video"&&R.jsxs(wt,{children:[R.jsx(ct,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),R.jsxs(Qi,{children:[R.jsx(wt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:R.jsx(ct,{fontSize:"sm",wordBreak:"break-all",children:$.videoUrl})}),R.jsxs(Di,{align:"flex-start",spacing:2,children:[R.jsxs(ct,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date($.uploadedAt).toLocaleString()]}),R.jsxs(ct,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),R.jsx(Kr,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:R.jsx(In,{as:cC}),onClick:()=>q(!0),isDisabled:F,children:"Delete"})]})]}),R.jsx(hg,{my:4})]}),R.jsx(ct,{fontWeight:"semibold",mb:2,children:$&&$.videoUrl&&pe==="video"?"Replace with new video:":"Add video URL:"}),R.jsx(wt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:R.jsxs(Ei,{children:[R.jsx(In,{as:Coe,color:"blue.300"}),R.jsx(ct,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),R.jsxs(vi,{children:[R.jsx(go,{fontSize:"sm",children:"Video URL"}),R.jsx(os,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Le,onChange:Ze=>We(Ze.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),R.jsx(ct,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),R.jsxs(wt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[R.jsxs(Ei,{children:[R.jsx(In,{as:jS,color:"blue.300"}),R.jsx(ct,{fontWeight:"medium",children:"Video Support"})]}),R.jsx(ct,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),R.jsx(ct,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Le&&R.jsxs(wt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[R.jsxs(Ei,{mb:2,children:[R.jsx(In,{as:TWe,color:"blue.300"}),R.jsx(ct,{fontWeight:"medium",children:"URL Preview"})]}),R.jsx(ct,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Le}),R.jsx(ct,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),F&&R.jsxs(wt,{mt:4,children:[R.jsxs(ct,{mb:2,children:["Uploading: ",z,"%"]}),R.jsx(g0,{value:z,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),R.jsxs(Mf,{children:[R.jsx(Kr,{variant:"ghost",mr:3,onClick:tt,isDisabled:F,children:"Cancel"}),R.jsx(Kr,{colorScheme:"blue",onClick:ze,isLoading:F,loadingText:"Uploading",isDisabled:pe==="image"&&!w||pe==="video"&&!Le||F||ue,leftIcon:R.jsx(In,{as:pe==="image"?r0:jS}),size:"lg",px:6,children:pe==="image"?"Upload Image":"Save Video URL"})]})]})]}),R.jsx(C2e,{isOpen:fe,leastDestructiveRef:b,onClose:()=>q(!1),children:R.jsx(Fo,{children:R.jsxs(R2e,{bg:"gray.800",color:"white",children:[R.jsxs(Sc,{fontSize:"lg",fontWeight:"bold",children:["Delete ",pe==="video"?"Video":"Image"]}),R.jsxs(Vo,{children:["Are you sure you want to delete this ",pe,"? This will revert the media screen to its blank state."]}),R.jsxs(Mf,{children:[R.jsx(Kr,{ref:b,onClick:()=>q(!1),children:"Cancel"}),R.jsx(Kr,{colorScheme:"red",onClick:Je,ml:3,leftIcon:R.jsx(In,{as:cC}),children:"Delete"})]})]})})})]})},UWe=n=>{const[t,s]=D.useState(null),[a,l]=D.useState(""),[d,f]=D.useState(null),[y,v]=D.useState(!1),b=dp(),{spaceID:w}=va(),I=D.useCallback(F=>{var B,z;try{if(!F)return null;if(F.includes("youtube.com")||F.includes("youtu.be")){let J="";return F.includes("youtube.com/watch")?J=new URLSearchParams(new URL(F).search).get("v"):F.includes("youtu.be/")&&(J=F.split("youtu.be/")[1].split("?")[0]),J?`https://www.youtube.com/embed/${J}?autoplay=1`:F}if(F.includes("vimeo.com")){if(F.includes("player.vimeo.com/video"))return F;const J=(z=(B=F.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:z.split("/")[0];return J?`https://player.vimeo.com/video/${J}?autoplay=1`:F}return F}catch(J){return ee.error("Error converting to embed URL:",J),F}},[]),k=D.useCallback(()=>{setTimeout(()=>{v(!1),ee.log("Video processing state reset")},100)},[]);D.useEffect(()=>{let F=!0,B=null;const J=b("PlayMediaScreenVideo",async $=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",$,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",$);const{mediaScreenId:ie,videoUrl:ue}=$||{};if(!ie){ee.error("Media screen ID is missing in Unity event data."),k();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ie}, setting ID but not playing video`),ee.log("Edit mode is active, setting media screen ID but not playing video"),f(ie);return}if(v(!0),B=setTimeout(()=>{F&&(ee.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ue){if(console.log(`Using direct video URL from event: ${ue}`),F)try{const re=I(ue);console.log(`Setting video URL to: ${re} (original: ${ue})`),s(re),l(`Media Screen ${ie}`),f(ie),ee.log("Media screen video URL set directly from event:",re)}catch(re){ee.error("Error setting video URL from direct URL:",re)}finally{k(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${ie}`);try{const re=await Tf(w,ie);if(console.log("Media screen data from Firestore:",re),!re||!re.videoUrl){ee.error("No video URL found for media screen:",ie),k(),clearTimeout(B);return}if(!re.displayAsVideo){ee.log("Media screen is not set to display as video:",ie),console.log("displayAsVideo flag is false for this media screen"),k(),clearTimeout(B);return}if(F)try{const fe=I(re.videoUrl);console.log(`Setting video URL to: ${fe} (original: ${re.videoUrl})`),s(fe),l(re.title||`Media Screen ${ie}`),f(ie),ee.log("Media screen video URL set to:",fe)}catch(fe){ee.error("Error setting video URL from Firestore:",fe)}finally{k(),clearTimeout(B)}}catch(re){ee.error(`Error fetching media screen data for ${ie}:`,re),k(),clearTimeout(B)}}catch(ie){ee.error("Error handling media screen video play:",ie),console.error("Error handling media screen video play:",ie),k(),clearTimeout(B)}});return()=>{F=!1,B&&clearTimeout(B),J()}},[b,w,n,I,k]);const x=D.useCallback(()=>{s(null),l(""),f(null),v(!1),ee.log("Video player state reset")},[]);return[t,a,d,x,y]},VWe=()=>{const{spaceID:n}=va(),t=up(),s=dp(),[a,l]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){ee.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{ee.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=D.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await y(b):"https://via.placeholder.com/640x360?text=Video"}catch(w){return ee.error(`Error fetching thumbnail for ${b}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const k=await I.json(),x=k.thumbnail_url.replace(/_\d+x\d+/,""),F=["640x360","295x166"];let B=null;for(let z of F){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${x}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch($){ee.warn(`Failed to validate thumbnail URL: ${J}`,$)}}return B||k.thumbnail_url}catch(w){return ee.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async b=>{let w="";if(b.includes("youtube.com/watch")?w=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(w=b.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(k){ee.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,k)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=D.useCallback(async b=>{try{if(!n||!b)return;ee.log(`Refreshing thumbnail for media screen ${b}`);const w=await Tf(n,b);if(!w){ee.log(`No media screen found with ID ${b}`);return}if(ee.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){ee.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await d(w.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),ee.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(w){ee.error(`Error refreshing thumbnail for media screen ${b}:`,w)}},[n,d,t]);D.useEffect(()=>{if(!a){ee.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}ee.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=s("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:k,thumbnailUrl:x}=I;x==="refresh"&&k&&(console.log(`Received request to refresh thumbnail for media screen ${k}`),await v(k))}catch(k){console.error("Error handling SetMediaScreenThumbnail event:",k)}});return()=>{w()}},[s,v,a]),D.useEffect(()=>{if(!a){ee.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}ee.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");ee.log("Fetching media screens for thumbnails...");const I=await V4(n);ee.log("All media screens:",I);const k=I.filter(B=>B.displayAsVideo&&B.videoUrl);if(ee.log("Media screens set to display as videos:",k),k.length===0){ee.log("No media screens set to display as videos found.");return}ee.log(`Found ${k.length} media screens set to display as videos.`);const x=k.map(async B=>{try{const z=await d(B.videoUrl);return ee.log(`Fetched thumbnail for ${B.id}: ${z}`),{mediaScreenId:B.id,thumbnailUrl:z}}catch(z){return ee.error(`Error processing thumbnail for media screen ${B.id}:`,z),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),F=await Promise.all(x);ee.log("Fetched Media Screen Thumbnails",F),F.forEach(({mediaScreenId:B,thumbnailUrl:z})=>{t("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:z}),ee.log(`Sent thumbnail to Unity for media screen ${B}: ${z}`)})}catch(I){ee.error("Error fetching media screen thumbnails:",I)}};b();const w=setInterval(b,5*60*1e3);return()=>{clearInterval(w)}},[t,n,d,a])},aQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},FWe=()=>R.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),jWe=({videoUrl:n,videoTitle:t,mediaScreenId:s,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Md();return l1(a,`video-modal-${s}`),D.useEffect(()=>{if(a){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const y=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),y&&(y.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),R.jsxs(R.Fragment,{children:[R.jsx(FWe,{}),R.jsxs(Mo,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${s}`,children:[R.jsx(Fo,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),R.jsxs(Uo,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[R.jsx(_a,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),R.jsx(Vo,{p:0,width:"100%",children:n?R.jsx(wt,{className:"iframe-container",style:aQ.iframeContainer,children:R.jsx("iframe",{className:"video-iframe",src:n,style:aQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):R.jsxs(Qi,{direction:"column",align:"center",justify:"center",h:"400px",children:[R.jsx(ap,{size:"xl",mb:4}),R.jsx(ct,{children:"Unable to load video"}),R.jsx(ct,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Ws=(...n)=>{},BWe=()=>{const{isOpen:n,onOpen:t,onClose:s}=kf(),[a,l]=D.useState(null),[d,f]=D.useState("image"),y=D.useRef(null);l1(n,"image-viewer-modal");const v=D.useCallback(I=>{I.stopPropagation()},[]);return D.useEffect(()=>{if(n&&y.current){const I=y.current;I.addEventListener("mousemove",v),I.addEventListener("mousedown",v),I.addEventListener("mouseup",v),I.addEventListener("wheel",v);const k=document.getElementById("unity-canvas");return k&&(k.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",v),I.removeEventListener("mousedown",v),I.removeEventListener("mouseup",v),I.removeEventListener("wheel",v),k&&(k.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(I,k="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${k}`);const x=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),F=x?"image":k;console.log(`[DEBUG] Detected URL as ${x?"image":"non-image"}, using media type: ${F}`),l(I),f(F),t()},closeImageViewer:()=>{s(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:y,preventPropagation:v}},WWe=()=>R.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),aU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),Ws(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},zWe=()=>{const{spaceID:n}=va(),[t,s]=D.useState(!1),[a,l]=D.useState([]),[d,f]=D.useState(null),{isOpen:y,onOpen:v,onClose:b}=kf(),[w,I]=D.useState({}),[k,x]=D.useState(0);D.useRef(null);const F=up(),{fullscreenRef:B}=Md(),z=dp(),[J,$]=D.useState(!1),{isOpen:ie,currentImageUrl:ue,currentMediaType:re,openImageViewer:fe,closeImageViewer:q,modalContentRef:X,preventPropagation:Q}=BWe(),[se,me,pe,le,Le]=UWe(t),{isOpen:We,onOpen:$e,onClose:ve}=kf();VWe(),eoe(),D.useEffect(()=>{if(window.isPlayerInstantiated){$(!0);return}const be=()=>{$(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]);const _e=D.useCallback(be=>{if(Array.isArray(a)&&a.length>0){const Ie=a.find(Me=>Me.mediaScreenId===be);if(Ie){const Me=Ie.imageUrl,ze=Ie.videoUrl;return{screen:Ie,imageUrl:Me,videoUrl:ze,mediaType:Ie.mediaType||"image",displayAsVideo:Ie.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(ue){let Ie=null;return Array.isArray(a)&&(Ie=a.find(Me=>Me.mediaScreenId===be)),{screen:Ie||{mediaScreenId:be},imageUrl:ue,videoUrl:null,mediaType:(Ie==null?void 0:Ie.mediaType)||"image",displayAsVideo:(Ie==null?void 0:Ie.displayAsVideo)||!1}}return n&&be&&Tf(n,be).then(Ie=>{Ie&&l(Me=>Array.isArray(Me)&&Me.some(Je=>Je.mediaScreenId===be)?Me.map(Je=>Je.mediaScreenId===be?{...Je,imageUrl:Ie.imageUrl,videoUrl:Ie.videoUrl,mediaType:Ie.mediaType||"image",displayAsVideo:Ie.displayAsVideo||!1,hasImage:!!Ie.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Je):[...Array.isArray(Me)?Me:[],{mediaScreenId:be,imageUrl:Ie.imageUrl,videoUrl:Ie.videoUrl,mediaType:Ie.mediaType||"image",displayAsVideo:Ie.displayAsVideo||!1,hasImage:!!Ie.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ie=>{console.error(`Error fetching media screen data for ${be}:`,Ie)}),console.warn("No screen data found for:",be),null},[a,ue,n,l]),Ee=D.useCallback(be=>{if(console.log(`[DEBUG] Processing click on screen: ${be}, isEditMode: ${t}`),f(be),t)console.log(`[DEBUG] Opening upload modal for screen: ${be} in edit mode`),v();else{const Ie=_e(be);if(Ie){if(console.log(`[DEBUG] Screen data for ${be}:`,Ie),Ws("Screen data details:",{mediaScreenId:be,imageUrl:Ie.imageUrl,videoUrl:Ie.videoUrl,mediaType:Ie.mediaType,displayAsVideo:Ie.displayAsVideo}),We&&pe===be)return;if(Ie.displayAsVideo&&Ie.videoUrl)Ws(`Opening video player for: ${Ie.videoUrl}`),F("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ie.videoUrl});else if(Ie.imageUrl){Ws(`Opening viewer modal with ${Ie.mediaType}: ${Ie.imageUrl}`);const ze=aU(Ie.imageUrl);fe(ze,Ie.mediaType||"image")}else n&&Tf(n,be).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)Ws(`Opening video player for: ${ze.videoUrl}`),F("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:ze.videoUrl});else if(ze.imageUrl){Ws(`Opening viewer modal with image: ${ze.imageUrl}`);const Je=aU(ze.imageUrl);fe(Je,ze.mediaType||"image")}l(Je=>Array.isArray(Je)&&Je.some(ut=>ut.mediaScreenId===be)?Je.map(ut=>ut.mediaScreenId===be?{...ut,...ze,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:ut):[...Array.isArray(Je)?Je:[],{...ze,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${be}:`,ze)})}else n&&Tf(n,be).then(Me=>{if(Me){if(Me.displayAsVideo&&Me.videoUrl)Ws(`Opening video player for: ${Me.videoUrl}`),F("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Me.videoUrl});else if(Me.imageUrl){Ws(`Opening viewer modal with image: ${Me.imageUrl}`);const ze=aU(Me.imageUrl);fe(ze,Me.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(tt=>tt.mediaScreenId===be)?ze.map(tt=>tt.mediaScreenId===be?{...tt,...Me,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:tt):[...Array.isArray(ze)?ze:[],{...Me,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Me=>{console.error(`Error fetching media screen data for ${be}:`,Me)})}},[t,v,_e,We,pe,F,fe,n]);D.useEffect(()=>{if(!J)return;const be=async()=>{if(n)try{const Me=await V4(n),ze={};Me.forEach(Je=>{Je.id&&Je.imageUrl&&(ze[Je.id]=Je.imageUrl)}),l(Je=>Je.map(tt=>{const ut=!!ze[tt.mediaScreenId],Ze=ze[tt.mediaScreenId],vt=tt.mediaType||"image";return{...tt,hasImage:ut,imageUrl:Ze,mediaType:vt}}))}catch(Me){console.error("Error fetching media screen images:",Me)}};be();let Ie=null;return t&&(Ie=setInterval(be,5e3)),()=>{Ie&&clearInterval(Ie)}},[n,t,k,J]);const ke=be=>{l(Ie=>Ie.map(Me=>{if(Me.mediaScreenId===be.mediaScreenId){if(be.type==="upload")return{...Me,hasImage:!0,imageUrl:be.imageUrl,mediaType:be.mediaType||"image"};if(be.type==="delete")return{...Me,hasImage:!1,imageUrl:null,mediaType:null}}return Me})),be.type==="delete"?(setTimeout(()=>{l(Ie=>Ie.filter(Me=>Me.mediaScreenId!==be.mediaScreenId))},100),setTimeout(()=>{l(Ie=>Ie.filter(Me=>Me.mediaScreenId!==be.mediaScreenId))},1500)):setTimeout(()=>{l(Ie=>Ie.some(ze=>ze.mediaScreenId===be.mediaScreenId)?Ie.map(ze=>ze.mediaScreenId===be.mediaScreenId?{...ze,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image"}:ze):[...Ie,{mediaScreenId:be.mediaScreenId,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};D.useEffect(()=>{const be=Ie=>{const Me=Ie.detail.enabled;s(Me),Me?F("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):F("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",be),()=>{window.removeEventListener("editModeChanged",be)}},[F]),D.useEffect(()=>(window.JsSendMediaScreenClick=function(be){console.log("Unity: MediaScreenClick received with data:",be);try{const Ie=JSON.parse(be),Me=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ie)});window.dispatchEvent(Me)}catch(Ie){console.error("Error processing MediaScreenClick data:",Ie)}},window.handleMediaScreenClick=function(be){console.log("Direct call to handleMediaScreenClick with ID:",be),Ee(be)},window.TestJavaScriptFromUnity=function(be){console.log("Unity called TestJavaScriptFromUnity with:",be),alert("Unity called JavaScript: "+be)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Ee]),D.useEffect(()=>{const be=ze=>{try{const Je=JSON.parse(ze.detail);ee.log(`MediaScreen registered: ${Je.mediaScreenId}`),Ws("MediaScreen registered from Unity:",Je),l(ut=>ut.some(vt=>vt.mediaScreenId===Je.mediaScreenId)?ut.map(vt=>vt.mediaScreenId===Je.mediaScreenId?{...vt,...Je,source:"event",lastUpdated:new Date().toISOString()}:vt):[...ut,{...Je,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&F("SetMediaScreenEditMode",{mediaScreenId:Je.mediaScreenId,enabled:!0,showUploadIcon:!0});const tt=Je.mediaScreenId;tt&&Tf(n,tt).then(ut=>{ut&&(Ws(`Media screen data for ${tt}:`,ut),ut.displayAsVideo&&ut.videoUrl&&(Ws(`Media screen ${tt} should display as video, sending null imageUrl`),F("SetMediaScreenImage",{mediaScreenId:tt,imageUrl:null,displayAsVideo:!0})))}).catch(ut=>{console.error(`Error fetching media screen data for ${tt}:`,ut)})}catch(Je){console.error("Error handling MediaScreen registration:",Je)}},Ie=ze=>{try{Ws("MediaScreenClick event received:",ze);let Je;if(typeof ze=="string")Je=ze,Ws("MediaScreenClick: Direct call with ID:",Je);else{Ws("MediaScreenClick: Event from Unity:",ze),Ws("MediaScreenClick: Event detail:",ze.detail);try{Je=JSON.parse(ze.detail).mediaScreenId,Ws("MediaScreenClick: Parsed mediaScreenId:",Je)}catch(tt){if(console.error("MediaScreenClick: Error parsing event detail:",tt),ze.detail&&ze.detail.mediaScreenId)Je=ze.detail.mediaScreenId,Ws("MediaScreenClick: Using direct mediaScreenId from detail:",Je);else throw new Error("Could not extract mediaScreenId from event")}}ee.log(`MediaScreen clicked: ${Je}`),Ws("MediaScreen clicked:",Je),Ee(Je)}catch(Je){console.error("Error handling MediaScreen click:",Je)}},Me=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")be({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Ie({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const Je=JSON.parse(ze.detail.eventData);Je.mediaScreenId&&(Ws("SetMediaScreenImage event received:",Je),l(tt=>Array.isArray(tt)&&tt.some(Ze=>Ze.mediaScreenId===Je.mediaScreenId)?tt.map(Ze=>Ze.mediaScreenId===Je.mediaScreenId?{...Ze,imageUrl:Je.imageUrl,hasImage:!!Je.imageUrl,displayAsVideo:Je.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Ze):[...Array.isArray(tt)?tt:[],{mediaScreenId:Je.mediaScreenId,imageUrl:Je.imageUrl,hasImage:!!Je.imageUrl,displayAsVideo:Je.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Je){console.error("Error handling SetMediaScreenImage event:",Je)}};return window.addEventListener("RegisterMediaScreen",be),window.addEventListener("MediaScreenClick",Ie),window.addEventListener("reactUnityEvent",Me),()=>{window.removeEventListener("RegisterMediaScreen",be),window.removeEventListener("MediaScreenClick",Ie),window.removeEventListener("reactUnityEvent",Me)}},[t,v,F,a,ie,We,fe,Ee,n]),D.useEffect(()=>{const be=Ie=>{try{Ws("Direct MediaScreenClick event received:",Ie);let Me;if(Ie.detail)try{Me=JSON.parse(Ie.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!Me){console.error("No mediaScreenId found in MediaScreenClick event");return}Ws(`Direct handler: Processing click for media screen ${Me}`),Ee(Me)}catch(Me){console.error("Error in direct MediaScreenClick handler:",Me)}};return window.addEventListener("MediaScreenClick",be),()=>{window.removeEventListener("MediaScreenClick",be)}},[Ee]),D.useEffect(()=>{se&&$e()},[se,$e]);const we=()=>{le(),ve()};return D.useEffect(()=>{const Ie=z("RegisterMediaScreen",Me=>{try{if(ee.log("Direct RegisterMediaScreen event received with data:",Me),!Me||!Me.mediaScreenId){ee.warn("RegisterMediaScreen event received with invalid data");return}const ze=Me.mediaScreenId;ee.log(`Media screen registered directly: ${ze}`),l(Je=>Je.some(ut=>ut.mediaScreenId===ze)?Je.map(ut=>ut.mediaScreenId===ze?{...ut,...Me,source:"direct-event",lastUpdated:new Date().toISOString()}:ut):[...Je,{...Me,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&F("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Ie()}},[z,t,F]),D.useEffect(()=>{const Ie=z("MediaScreenClick",Me=>{try{if(ee.log("Direct MediaScreenClick event received with data:",Me),!Me||!Me.mediaScreenId){ee.warn("MediaScreenClick event received with invalid data");return}const ze=Me.mediaScreenId;ee.log(`Media screen clicked directly: ${ze}`),Ee(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Ie()}},[z,Ee]),D.useEffect(()=>{t&&pe&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${pe}`),f(pe),v(),le())},[t,pe,v,le]),R.jsxs(R.Fragment,{children:[R.jsx(MWe,{isOpen:y,onClose:b,mediaScreenId:d,onImageChange:ke}),R.jsx(WWe,{}),R.jsx(Mu,{containerRef:B,children:R.jsxs(Mo,{isOpen:ie,onClose:q,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[R.jsx(Fo,{bg:"rgba(0, 0, 0, 0.8)",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q}),R.jsxs(Uo,{ref:X,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[R.jsx(_a,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),R.jsx(Vo,{p:0,width:"100%",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:ue?R.jsx(wt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:re==="image"?R.jsx(zh,{src:ue,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ue),onError:be=>console.error("Error loading image:",be,ue),onClick:Q}):R.jsxs(wt,{width:"100%",textAlign:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[R.jsx(ct,{mb:4,fontSize:"lg",children:"Video URL:"}),R.jsx(ct,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ue}),R.jsx(ct,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):R.jsx(Qi,{direction:"column",align:"center",justify:"center",h:"400px",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:R.jsx(ct,{children:"No image available"})})})]})]})}),R.jsx(jWe,{videoUrl:se,videoTitle:me,mediaScreenId:pe,isOpen:We,onClose:we})]})},Ioe=({backgroundUrl:n=null,containerRef:t})=>{const[s,a]=D.useState(!1),[l,d]=D.useState(n),f=D.useRef(null),y=D.useRef(null);return D.useEffect(()=>{const v=b=>{const{backgroundUrl:w}=b.detail;d(w),f.current&&(w?(f.current.style.backgroundImage=`url('${w}')`,f.current.style.display="block",y.current&&(y.current.style.display="block")):(f.current.style.display="none",y.current&&(y.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),D.useEffect(()=>{d(n),f.current&&n!==l&&(f.current.style.backgroundImage=`url('${n}')`)},[n]),D.useEffect(()=>{if(!t||!t.current)return;const v=document.createElement("div");f.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const b=document.createElement("div");y.current=b,Object.assign(b.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),t.current.appendChild(v),t.current.appendChild(b);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",b.style.opacity="0",setTimeout(()=>{t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(b)&&t.current.removeChild(b)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Nd.subscribe(kd.playerInstantiated,w);const I=()=>w();window.addEventListener("PlayerInstantiated",I);const k=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Nd.unsubscribe(kd.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",I),clearTimeout(k),t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(b)&&t.current.removeChild(b)}}},[l,t]),null};Ioe.propTypes={backgroundUrl:Tn.string,containerRef:Tn.shape({current:Tn.instanceOf(Element)})};const cQ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",Aoe=({containerRef:n})=>{const{spaceID:t}=va(),[s,a]=D.useState(!1),[l,d]=D.useState(!1),[f,y]=D.useState(0),[v,b]=D.useState("Initialising World"),[w,I]=D.useState(null),k=D.useRef(null),x=D.useRef(null),F=D.useRef(null),B=D.useRef(null),z=D.useRef(null),J=D.useRef(null);D.useEffect(()=>(ee.log("PersistentLoader: Component mounted with spaceID:",t),ee.log("PersistentLoader: Container ref:",n),()=>{ee.log("PersistentLoader: Component unmounting")}),[]);const{error:$}=va(),[ie,ue]=D.useState(!1);return D.useEffect(()=>{$&&(ee.error("PersistentLoader: Unity error detected:",$),ue(!0),setTimeout(()=>{if(k.current){const re=k.current.querySelector("div:first-child");re&&(re.textContent="Reconnecting...")}},3e3))},[$]),D.useEffect(()=>{(async()=>{if(t){ee.log(`PersistentLoader: Fetching logo for space ${t}`);try{const fe=await _g(t);fe&&fe.logoUrl?(ee.log(`PersistentLoader: Found logo URL: ${fe.logoUrl}`),I(fe.logoUrl)):ee.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(fe){ee.error("PersistentLoader: Error fetching space logo:",fe)}}else ee.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),D.useEffect(()=>{const re=fe=>{const{logoUrl:q}=fe.detail;ee.log(`PersistentLoader: Logo update event received with URL: ${q}`),I(q),x.current?q?(ee.log("PersistentLoader: Updating logo element with new URL"),x.current.src=q,F.current.style.display="flex"):(ee.log("PersistentLoader: Hiding logo element (no URL)"),F.current.style.display="none"):ee.warn("PersistentLoader: Logo ref is null during update")};return ee.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",re),()=>{ee.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",re)}},[]),D.useEffect(()=>{if(!n||!n.current){ee.error("PersistentLoader: Container ref is null or has no current property");return}ee.log("PersistentLoader: Creating loader elements");const re=document.createElement("div");if(k.current=re,Object.assign(re.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),w){ee.log(`PersistentLoader: Creating logo element with URL: ${w}`);const ve=document.createElement("div");F.current=ve,Object.assign(ve.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const _e=document.createElement("img");x.current=_e,_e.src=w,_e.alt="Space Logo",_e.style.maxHeight="100px",_e.style.maxWidth="100%",_e.style.objectFit="contain",_e.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",ve.appendChild(_e),n.current.appendChild(ve),ee.log("PersistentLoader: Logo container added to main container")}else ee.log("PersistentLoader: No logo URL available, skipping logo creation");const fe=document.createElement("style");fe.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(fe),ee.log("PersistentLoader: Animation styles added to document head");const q=document.createElement("div");q.style.fontSize="16px",q.style.fontWeight="bold",q.style.textAlign="center",q.style.marginBottom="16px",q.style.color="#ffffff",q.textContent="Initialising World";const X=document.createElement("div");X.style.width="240px",X.style.height="100px",X.style.position="relative",X.style.marginBottom="15px",X.style.padding="0px",X.style.overflow="hidden",X.style.boxSizing="border-box",X.style.transition="opacity 0.8s ease-in-out",X.style.opacity="0";const Q=document.createElement("div");Q.style.width="100%",Q.style.height="100%",Q.style.position="absolute",Q.style.top="0",Q.style.left="0",Q.style.maskImage=`url(${cQ})`,Q.style.maskSize="contain",Q.style.maskPosition="center",Q.style.maskRepeat="no-repeat",Q.style.webkitMaskImage=`url(${cQ})`,Q.style.webkitMaskSize="contain",Q.style.webkitMaskPosition="center",Q.style.webkitMaskRepeat="no-repeat",Q.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",Q.style.backgroundSize="100% 100%",Q.style.transition="background 0.5s ease-out",B.current=Q,z.current=null,X.appendChild(Q);const se=document.createElement("div");se.style.marginTop="8px",se.style.fontSize="14px",se.style.fontWeight="bold",se.style.color="#ffffff",se.textContent="0%",re.appendChild(q),re.appendChild(X),re.appendChild(se),n.current.appendChild(re),ee.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{F.current&&(F.current.style.opacity="1"),re.style.opacity="1",X.style.opacity="1"},500);const me=ve=>{y(ve);const _e=Math.round(ve*100),Ee=`linear-gradient(to right, #4facfe 0%, #00f2fe ${_e}%, white ${_e}%, white 100%)`;Q.style.background=Ee,se.textContent=`${_e}%`,ee.log(`PersistentLoader: Progress updated to ${_e}%`)},pe=ve=>{b(ve),q.textContent=ve,ee.log(`PersistentLoader: Loading stage updated to "${ve}"`)},le=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];ie&&(le[0].stage="Connecting to Space",le[1].stage="Reconnecting...",le[2].stage="Please Wait"),pe(le[0].stage),me(.25);const Le=ve=>{const _e=ve.detail.progress;ee.log(`PersistentLoader: Progress event received with value: ${_e}`),me(_e),_e<.33?pe(le[0].stage):_e<.66?pe(le[1].stage):pe(le[2].stage)},We=()=>{ee.log("PersistentLoader: First scene loaded event received"),a(!0),pe(le[1].stage),me(.66)},$e=()=>{if(ee.log("PersistentLoader: Player instantiated event received"),J.current&&(clearInterval(J.current),ee.log("PersistentLoader: Progress interval cleared")),d(!0),pe(le[2].stage),me(1),ie){ee.log("PersistentLoader: Keeping loader visible due to Unity error");return}re.style.transition="all 0.5s ease-in-out",X.style.transition="opacity 1.2s ease-in-out",q.style.transition="opacity 0.4s ease-in-out",se.style.transition="opacity 0.4s ease-in-out",F.current&&(F.current.style.transition="opacity 0.5s ease-in-out"),re.style.backgroundColor="rgba(0, 0, 0, 0)",re.style.backdropFilter="blur(0px)",re.style.WebkitBackdropFilter="blur(0px)",re.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",re.style.border="1px solid rgba(255, 255, 255, 0)",q.style.opacity="0",se.style.opacity="0",F.current&&(F.current.style.opacity="0"),setTimeout(()=>{X.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(re)?(n.current.removeChild(re),ee.log("PersistentLoader: Loader element removed after fade")):ee.warn("PersistentLoader: Could not remove loader element (not found in container)"),F.current&&n.current&&n.current.contains(F.current)?(n.current.removeChild(F.current),ee.log("PersistentLoader: Logo container removed after fade")):F.current&&ee.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)ee.log("PersistentLoader: Player was already instantiated"),$e();else{ee.log("PersistentLoader: Subscribing to playerInstantiated event"),Nd.subscribe(kd.playerInstantiated,$e);const ve=()=>$e();ee.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",ve),ee.log("PersistentLoader: Adding firstSceneLoaded event listener"),Nd.subscribe(kd.firstSceneLoaded,We),ee.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",Le),J.current=setInterval(()=>{l||y(Ee=>{const ke=Math.min(Ee+.02,.95);return me(ke),ke<.33&&v!==le[0].stage?pe(le[0].stage):ke>=.33&&ke<.66&&v!==le[1].stage?pe(le[1].stage):ke>=.66&&v!==le[2].stage&&pe(le[2].stage),ke})},300);const _e=setTimeout(()=>{ee.log("PersistentLoader: Forcing loader removal after timeout"),$e()},6e4);return()=>{ee.log("PersistentLoader: Cleaning up event listeners"),Nd.unsubscribe(kd.playerInstantiated,$e),window.removeEventListener("PlayerInstantiated",ve),Nd.unsubscribe(kd.firstSceneLoaded,We),window.removeEventListener("UnityProgress",Le),clearInterval(J.current),clearTimeout(_e),n.current&&n.current.contains(re)&&(n.current.removeChild(re),ee.log("PersistentLoader: Loader element removed during cleanup")),F.current&&n.current&&n.current.contains(F.current)&&(n.current.removeChild(F.current),ee.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};Aoe.propTypes={containerRef:Tn.shape({current:Tn.instanceOf(Element)})};const I0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,H4=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],t=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),y=document.activeElement===d;!l&&(f||y)&&a.preventDefault()}},s=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",t),document.addEventListener("click",s),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",t),document.removeEventListener("click",s)}},Poe=()=>{document.body.classList.remove("unity-focused")};function tN(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?H4():Poe(),new Promise(t=>{try{const s=I0();if(s){try{n?s.SendMessage("WebGLInput","EnableKeyboardCapture"):s.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),t(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{s.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),t(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(s.Module){!n&&s.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=s.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(s.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(s.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),t(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),XV(n)),t(!1)}catch(s){console.error("Error setting Unity keyboard capture:",s),t(!1)}})}function XV(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const t=20;let s=0;const a=()=>{s++;const l=I0();if(l){console.log(`Unity instance found after ${s} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(s<t){const d=Math.min(500*Math.pow(1.2,s),5e3);console.log(`Unity instance not found (attempt ${s}/${t}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${t} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function GWe(){const n=I0();if(!n)return!1;const t=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(t&&document.activeElement===t||n.Module&&n.Module.WebGLInputHandler)}function CS(n=!0){return console.log("Focusing Unity canvas"),n?H4():Poe(),new Promise(t=>{try{const s=document.querySelector("canvas")||document.getElementById("unity-canvas");if(s){try{s.focus({preventScroll:!0})}catch{s.focus()}if(s.style.pointerEvents="auto",n){tN(!0).then(t);return}t(!0)}else console.warn("Unity canvas not found"),t(!1)}catch(s){console.error("Error focusing Unity canvas:",s),t(!1)}})}function BS(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),H4(),new Promise(t=>{try{if(n)tN(!1).then(s=>{var d;s&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=I0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),t(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const s=I0();s!=null&&s.Module&&window._savedWebGLInputHandler&&(s.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),tN(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),t(!0)})}}catch(s){console.error("Error in blockUnityKeyboardInput:",s),t(!1)}})}function HWe(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const t=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${t}`);try{t?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${t} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(s){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",s);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",t),console.log(`Applied pending keyboard state: ${t} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(t){console.error("Error applying pending keyboard state:",t)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function $We(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=tN,window.focusUnity=CS,window.blockUnityKeyboardInput=BS,window.hasUnityKeyboardFocus=GWe,window.getUnityInstance=I0,window.registerUnityInstance=HWe,document.getElementById("webgl-root")){const n=new MutationObserver(t=>{for(const s of t)if(s.addedNodes.length)for(let a=0;a<s.addedNodes.length;a++){const l=s.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),XV(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),XV(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[s,a]=n.useState(!1);return n.useEffect(()=>(s?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),BS(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),BS(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{s&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),BS(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[s]),[s,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout($We,0);const KWe=({size:n="md",tooltipPlacement:t="top",className:s="livestream-button"})=>{const[a,l]=D.useState(!1),[d,f]=D.useState(!1),{savedStreamData:y,reloadStreamData:v}=Zse(),{spaceID:b}=va(),{user:w}=D.useContext(ul),I=ll(),[k,x]=D.useState(!1),F=sK((y==null?void 0:y.rtmpUrl)||""),B=sK((y==null?void 0:y.streamKey)||"");D.useEffect(()=>{if(b){ee.log("LiveStreamButton: Forcing reload of stream data"),v();const $=()=>{ee.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",$),()=>{window.removeEventListener("StreamSettingsChanged",$)}}},[b,v]),D.useEffect(()=>{(async()=>{if(!(w!=null&&w.uid)||!b){x(!1);return}try{const ie=await q5e(w.uid,"disruptiveAdmin"),ue=await Q5e(w,b);x(ie||ue)}catch(ie){ee.error("Error checking user permissions:",ie),x(!1)}})()},[w==null?void 0:w.uid,b]),D.useEffect(()=>{ee.log("LiveStreamButton: Current streaming data:",{enabled:y==null?void 0:y.enabled,hasRtmpUrl:!!(y!=null&&y.rtmpUrl),hasStreamKey:!!(y!=null&&y.streamKey),hasPermission:k,isPlayerReady:d})},[y,k,d]),D.useEffect(()=>{const $=()=>{ee.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(ee.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const z=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},J=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!d||!k||(y==null?void 0:y.enabled)!==!0?(ee.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!d,noPermission:!k,streamingDisabled:(y==null?void 0:y.enabled)!==!0,enabledValue:y==null?void 0:y.enabled}),null):R.jsxs(R.Fragment,{children:[R.jsx(Af,{label:"Live Stream Info",placement:t,hasArrow:!0,children:R.jsx(ip,{size:n,borderRadius:"full",bg:"black",icon:R.jsx(Z8e,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:s,"data-testid":"livestream-button",cursor:"pointer",onClick:z})}),R.jsxs(Mo,{isOpen:a,onClose:J,isCentered:!0,size:"md",children:[R.jsx(Fo,{backdropFilter:"blur(4px)"}),R.jsxs(Uo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[R.jsx(Sc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),R.jsx(_a,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),R.jsx(Vo,{p:4,children:y!=null&&y.rtmpUrl&&(y!=null&&y.streamKey)?R.jsxs(wt,{children:[R.jsx(ct,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),R.jsxs(wt,{mb:4,children:[R.jsx(ct,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),R.jsx(Qi,{children:R.jsxs(wy,{size:"sm",children:[R.jsx(os,{value:y.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),R.jsx(Ik,{children:R.jsx(xo,{"aria-label":"Copy RTMP URL",icon:F.hasCopied?R.jsx(nQ,{}):R.jsx(rQ,{}),size:"xs",colorScheme:F.hasCopied?"green":"blue",onClick:()=>{F.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),R.jsxs(wt,{mb:4,children:[R.jsx(ct,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),R.jsx(Qi,{children:R.jsxs(wy,{size:"sm",children:[R.jsx(os,{value:y.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),R.jsx(Ik,{children:R.jsx(xo,{"aria-label":"Copy Stream Key",icon:B.hasCopied?R.jsx(nQ,{}):R.jsx(rQ,{}),size:"xs",colorScheme:B.hasCopied?"green":"blue",onClick:()=>{B.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),R.jsx(ct,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):R.jsxs(wt,{textAlign:"center",p:4,children:[R.jsx(ct,{color:"white",children:"No stream configuration found for this space."}),R.jsx(ct,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},Ooe=({settings:n})=>{const{placePrefab:t,directPlacePrefab:s,isUnityLoaded:a}=noe(),l=ll(),[d,f]=D.useState({x:0,y:1,z:0}),[y,v]=D.useState({x:0,y:0,z:0}),[b,w]=D.useState({x:1,y:1,z:1}),[I,k]=D.useState("TestPrefab"),[x,F]=D.useState(!1),[B,z]=D.useState(!1),J=n==null?void 0:n.spaceID,{saveObject:$,isLoading:ie}=Y6e(J);D.useEffect(()=>{const q=X=>{z(X.detail.enabled)};return window.addEventListener("editModeChanged",q),()=>{window.removeEventListener("editModeChanged",q)}},[]);const ue=(q,X)=>{f(Q=>({...Q,[q]:parseFloat(X)}))},re=async()=>{ee.log("Placing prefab with values:",{prefabName:I,position:d,rotation:y,scale:b,useDirect:x,spaceId:J});let q;if(x?(q=s(I,d,y,b),ee.log("Used direct method to place prefab")):(q=t(I,d,y,b),ee.log("Used hook method to place prefab")),q)if(J&&B){const X=await $(I,d,y,b);l(X?{title:"Success",description:"Prefab placed and saved to space",status:"success",duration:3e3,isClosable:!0}:{title:"Warning",description:"Prefab placed but failed to save to space",status:"warning",duration:3e3,isClosable:!0})}else l({title:"Success",description:"Prefab placed",status:"success",duration:3e3,isClosable:!0});else l({title:"Error",description:"Failed to place prefab",status:"error",duration:3e3,isClosable:!0})},fe=()=>{const q={x:(Math.random()*10-5).toFixed(2),y:(Math.random()*2).toFixed(2),z:(Math.random()*10-5).toFixed(2)};f({x:parseFloat(q.x),y:parseFloat(q.y),z:parseFloat(q.z)}),ee.log("Set random position:",q)};return B?R.jsxs(wt,{className:"prefab-placer",bg:"rgba(0, 0, 0, 0.7)",color:"white",p:4,borderRadius:"md",maxW:"300px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",children:[R.jsx(ct,{fontWeight:"bold",mb:2,children:"Place Prefab in Unity"}),R.jsxs(wt,{mb:3,children:[R.jsx(ct,{fontSize:"sm",children:"Prefab Name:"}),R.jsx("input",{type:"text",value:I,onChange:q=>k(q.target.value),style:{width:"100%",padding:"8px",marginTop:"4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"4px",color:"white"}})]}),R.jsxs(Qi,{direction:"column",gap:2,mb:3,children:[R.jsx(ct,{fontSize:"sm",children:"Position:"}),R.jsxs(Qi,{gap:2,children:[R.jsxs(wt,{children:[R.jsx(ct,{fontSize:"xs",children:"X"}),R.jsxs(qO,{value:d.x,onChange:q=>ue("x",q),step:.5,precision:2,size:"sm",children:[R.jsx(XO,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),R.jsxs(YO,{children:[R.jsx(QO,{}),R.jsx(JO,{})]})]})]}),R.jsxs(wt,{children:[R.jsx(ct,{fontSize:"xs",children:"Y"}),R.jsxs(qO,{value:d.y,onChange:q=>ue("y",q),step:.5,precision:2,size:"sm",children:[R.jsx(XO,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),R.jsxs(YO,{children:[R.jsx(QO,{}),R.jsx(JO,{})]})]})]}),R.jsxs(wt,{children:[R.jsx(ct,{fontSize:"xs",children:"Z"}),R.jsxs(qO,{value:d.z,onChange:q=>ue("z",q),step:.5,precision:2,size:"sm",children:[R.jsx(XO,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),R.jsxs(YO,{children:[R.jsx(QO,{}),R.jsx(JO,{})]})]})]})]}),R.jsx(Kr,{onClick:fe,size:"xs",colorScheme:"blue",variant:"outline",mt:1,children:"Random Position"})]}),R.jsxs(vi,{display:"flex",alignItems:"center",mb:3,children:[R.jsx(go,{htmlFor:"use-direct",mb:"0",fontSize:"sm",children:"Use Direct Method"}),R.jsx(Qh,{id:"use-direct",colorScheme:"green",isChecked:x,onChange:q=>F(q.target.checked)})]}),R.jsx(Kr,{onClick:re,colorScheme:"green",width:"100%",isDisabled:!a||ie,children:ie?"Loading...":"Place Prefab"}),!a&&R.jsx(ct,{fontSize:"xs",color:"red.300",mt:1,children:"Waiting for Unity to load..."}),!J&&R.jsx(ct,{fontSize:"xs",color:"yellow.300",mt:1,children:"No space ID available - prefabs won't be saved"})]}):null};Ooe.propTypes={settings:Tn.shape({spaceID:Tn.string})};const qWe="9442a472625f44e7b2c5065b9f9b3988",cU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),$4=D.forwardRef(({settings:n},t)=>{const{unityProvider:s,isLoaded:a,error:l}=va(),d=D6e();x6e();const f=up(),y=X6e(d),{user:v}=D.useContext(ul),[b,w]=D.useState(!1),[I,k]=D.useState(window.devicePixelRatio),[x,F]=L6e();toe().find(ke=>ke.isLocalPlayer);const[z,J]=D.useState(!0),[$,ie]=D.useState(!0),[ue,re]=D.useState(!1),[fe,q]=D.useState(!1),[X,Q]=D.useState(!1);D.useEffect(()=>{X?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),BS(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!fe&&BS(!1).then(()=>{setTimeout(()=>{CS(!0)},100)}))},[X,a,fe]);const se=n.spaceID||"default",me=D.useMemo(()=>{const be=new URLSearchParams(window.location.search).get("sessionId")||se;return console.log("WebGLRenderer: Using session ID:",be),be},[se]),[pe,le]=D.useState(null);D.useEffect(()=>{v!=null&&v.uid&&Lu(v.uid).then(ke=>{le(ke),console.log("WebGLRenderer: User profile loaded:",(ke==null?void 0:ke.Nickname)||"Unknown")}).catch(ke=>{console.error("Error fetching user profile:",ke)})},[v==null?void 0:v.uid]),D.useEffect(()=>{if(l||!v){ee.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const ke=setTimeout(()=>{q(!0),Q(!0)},1e3);return()=>clearTimeout(ke)}else q(!1)},[l,v]),D.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const ke=()=>{console.log("WebGLRenderer: Player instantiated event received"),ie(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ie(!0)),Nd.subscribe(kd.playerInstantiated,ke);const we=setTimeout(()=>{$||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ie(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Nd.unsubscribe(kd.playerInstantiated,ke),clearTimeout(we)}},[$]),D.useEffect(()=>{const ke=()=>{console.log("WebGLRenderer: Modal opened"),Q(!0)},we=()=>{console.log("WebGLRenderer: Modal closed"),Q(!1)};return window.addEventListener("modal-opened",ke),window.addEventListener("modal-closed",we),()=>{window.removeEventListener("modal-opened",ke),window.removeEventListener("modal-closed",we)}},[]),D.useEffect(()=>{Q(x!==null)},[x]),D.useEffect(()=>{a||d?setTimeout(()=>{w(!0),ee.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):ee.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),D.useEffect(()=>{a&&s&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(ke){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",ke)}},1e3)},[a,s]),D.useEffect(()=>{const ke=document.getElementById("webgl-root");return ke?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),ke.style.display="block",ke.getAttribute("data-space-id")!==se&&(ke.setAttribute("data-space-id",se),console.log(`WebGLRenderer: Set data-space-id attribute to ${se}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[se]),D.useEffect(()=>{const ke=()=>{const Ie=cU();Ie?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ie.tabIndex=1,Ie.style.outline="none",Ie.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),X||CS(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};ke();const we=setTimeout(ke,1e3),be=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),ke()};return window.addEventListener("unityReady",be),()=>{clearTimeout(we),window.removeEventListener("unityReady",be)}},[a,X]);const Le=D.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),X||CS(!0)},[X]);D.useEffect(()=>{if(a&&s){const ke=cU();if(ke)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),ke.addEventListener("click",Le),()=>{ke.removeEventListener("click",Le)}}},[a,s,Le]),D.useEffect(()=>{if(a&&s){console.log("WebGLRenderer: Setting up global click handler for focus management");const ke=we=>{if(X){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(we.target.tagName==="INPUT"||we.target.tagName==="TEXTAREA"||we.target.tagName==="SELECT"||we.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(we.target.closest(".chakra-modal__content")||we.target.closest('[role="dialog"]')||we.target.closest('[role="menu"]')||we.target.closest(".chakra-popover__content")||we.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const be=cU();if(be&&(we.target===be||be.contains(we.target)))return;if(we.target.closest(".webgl-overlay")||we.target.closest(".game-ui")||we.target.closest(".player-list")||we.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{X||CS(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{be&&!X&&((be.tabIndex===void 0||be.tabIndex<0)&&(be.tabIndex=1),be.focus(),CS(!0))},50)};return document.addEventListener("click",ke,!0),()=>{document.removeEventListener("click",ke,!0)}}},[a,s,X]),D.useEffect(()=>{const ke=we=>{ee.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",we)};return Nd.subscribe(kd.sendUserToUnity,ke),()=>Nd.unsubscribe(kd.sendUserToUnity,ke)},[f]);const{setFullscreenRef:We,fullscreenRef:$e}=Md();D.useEffect(()=>{We(t.current)},[t,We]);const ve=()=>{J(!z)},_e=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:$,showVoiceChat:_e,sessionId:me}),D.useEffect(()=>{const ke=we=>{re(we.detail.enabled)};return window.addEventListener("editModeChanged",ke),()=>{window.removeEventListener("editModeChanged",ke)}},[]),eoe(),F6e();const Ee=D.useRef(null);return R.jsxs(wt,{className:"webgl-renderer",children:[n.urlLoadingBackground&&R.jsx(Ioe,{backgroundUrl:n.urlLoadingBackground,containerRef:Ee}),!fe&&R.jsx(Aoe,{containerRef:Ee}),fe&&R.jsx(wt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:R.jsx(G4,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),R.jsx(yF,{containerRef:$e.current?$e:document.body,children:R.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[R.jsxs(wt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&R.jsx(M8e,{}),v&&R.jsx(KWe,{size:"md"}),_e&&R.jsxs(Toe,{appId:qWe,channel:me,uid:v==null?void 0:v.uid,enabled:!0,children:[R.jsx(fWe,{size:"md",defaultMuted:!0,joinOnClick:!0}),R.jsx(gWe,{userNickname:pe==null?void 0:pe.Nickname})]}),R.jsx(tWe,{}),R.jsx(wt,{position:"relative",zIndex:"9999",children:R.jsx(xWe,{onTogglePlayerList:ve,spaceID:se})})]}),R.jsxs(wt,{ref:Ee,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[R.jsx(wt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),R.jsx(wt,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:s?R.jsx(Qse.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):R.jsx(wt,{width:"100%",height:"100%"})}),R.jsx(wt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:R.jsx(x8e,{})})]}),R.jsx(wt,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&R.jsx(zh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),R.jsx(wt,{...y,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3,children:v&&R.jsx(Ooe,{settings:n})}),R.jsxs(wt,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&R.jsx(U8e,{}),R.jsx(iWe,{})]}),R.jsx(sWe,{}),R.jsx(oWe,{isOpen:x!==null,onClose:()=>{console.log(" Closing nameplate modal"),F()},playerName:(x==null?void 0:x.playerName)||"Unknown Player",playerId:(x==null?void 0:x.playerId)||"Unknown ID"}),R.jsx(aWe,{isVisible:z,onToggleVisibility:J,spaceID:se}),R.jsx(zWe,{})]})})]})});$4.displayName="WebGLRenderer";$4.propTypes={settings:Tn.shape({urlLoadingBackground:Tn.string,showAuthButton:Tn.bool,showDisruptiveLogo:Tn.bool,urlDisruptiveLogo:Tn.string,showHelpButton:Tn.bool,enableVoiceChat:Tn.bool,spaceID:Tn.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:t=>(console.log("HISPlayer: mute called with state:",t),!0),isMuted:!1,seek:t=>(console.log("HISPlayer: seek called with time:",t),!0),setVolume:t=>(console.log("HISPlayer: setVolume called with volume:",t),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:t=>(console.log("HISPlayer: setUnityContext called with:",t),window.hisPlayerContextId=t,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:t=>(console.log("HISPlayer: setProperties called with:",t),!0),setMultiPaths:t=>(console.log("HISPlayer: setMultiPaths called with:",t),window._hisplayer_paths=t,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(ee.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),ee.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const t=new window.MultipleView;if(t&&t.multiView&&typeof t.multiView.setUnityContext=="function")return t.multiView.setUnityContext(n),window._hisplayer_instance=t,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const t=new window.MultipleView;return t.multiView.setUnityContext(n),window._hisplayer_instance=t,!0}}catch(t){console.error("HISPlayer: Error in setUpContext:",t);const s=document.getElementById("hisplayer-error");s&&(s.innerHTML="Error: "+t.message)}return!1}}const koe=({spaceID:n,overrideSettings:t})=>{const s=D.useRef(null),[a,l]=D.useState(!0),[d,f]=D.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[y,v]=D.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return D.useEffect(()=>{(async()=>{try{const w=await _g(n);if(w){f(x=>({...x,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const I=await uk(y.urlDisruptiveLogo);let k="";if(w.backgroundUrl)k=w.backgroundUrl;else if(w.backgroundGsUrl)try{k=await uk(w.backgroundGsUrl)}catch(x){ee.warn("WebGLLoader: Error fetching background from GS URL:",x)}else if(w.gsUrlLoadingBackground)try{k=await uk(w.gsUrlLoadingBackground)}catch(x){ee.warn("WebGLLoader: Error fetching background from legacy GS URL:",x)}v(x=>({...x,urlLoadingBackground:k,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:n,...t||{}})),l(!1)}else ee.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){ee.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,y.urlDisruptiveLogo,t]),D.useEffect(()=>{a||(ee.log("WebGLLoader: Unity config from Firebase",d),ee.log("WebGLLoader: Space settings from Firebase",y))},[a]),R.jsx(R.Fragment,{children:a?R.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):R.jsx(N6e,{...d,children:R.jsx($4,{ref:s,settings:y})})})};koe.propTypes={spaceID:Tn.string.isRequired,overrideSettings:Tn.object};function lQ(){const n=document.getElementById("webgl-root");if(n){const t=n.getAttribute("data-space-id"),s=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=D.useState(null);return D.useEffect(()=>{NMe(s).then(d)},[]),l?R.jsx(DNe,{theme:l,children:R.jsx(S6e,{children:R.jsx(b6e,{children:R.jsx(koe,{spaceID:t})})})}):R.jsx("div",{children:"Loading theme..."})};try{Eye.createRoot(n).render(R.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",lQ):lQ());export{Lye as a,oSe as b,Vi as c,rSe as d,XWe as e,YWe as f,Yve as g,Au as i,Wh as m,iRe as t};
