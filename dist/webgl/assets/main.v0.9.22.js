function Yye(n,t){for(var i=0;i<t.length;i++){const a=t[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Sy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hM={exports:{}},CT={},pM={exports:{}},Dr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mK;function Xye(){if(mK)return Dr;mK=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),I=Symbol.iterator;function k(Ee){return Ee===null||typeof Ee!="object"?null:(Ee=I&&Ee[I]||Ee["@@iterator"],typeof Ee=="function"?Ee:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L=Object.assign,j={};function z(Ee,Ne,je){this.props=Ee,this.context=Ne,this.refs=j,this.updater=je||M}z.prototype.isReactComponent={},z.prototype.setState=function(Ee,Ne){if(typeof Ee!="object"&&typeof Ee!="function"&&Ee!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ee,Ne,"setState")},z.prototype.forceUpdate=function(Ee){this.updater.enqueueForceUpdate(this,Ee,"forceUpdate")};function Y(){}Y.prototype=z.prototype;function K(Ee,Ne,je){this.props=Ee,this.context=Ne,this.refs=j,this.updater=je||M}var ne=K.prototype=new Y;ne.constructor=K,L(ne,z.prototype),ne.isPureReactComponent=!0;var ce=Array.isArray,oe=Object.prototype.hasOwnProperty,ge={current:null},X={key:!0,ref:!0,__self:!0,__source:!0};function J(Ee,Ne,je){var Ke,ot={},_t=null,lt=null;if(Ne!=null)for(Ke in Ne.ref!==void 0&&(lt=Ne.ref),Ne.key!==void 0&&(_t=""+Ne.key),Ne)oe.call(Ne,Ke)&&!X.hasOwnProperty(Ke)&&(ot[Ke]=Ne[Ke]);var vt=arguments.length-2;if(vt===1)ot.children=je;else if(1<vt){for(var rt=Array(vt),bt=0;bt<vt;bt++)rt[bt]=arguments[bt+2];ot.children=rt}if(Ee&&Ee.defaultProps)for(Ke in vt=Ee.defaultProps,vt)ot[Ke]===void 0&&(ot[Ke]=vt[Ke]);return{$$typeof:n,type:Ee,key:_t,ref:lt,props:ot,_owner:ge.current}}function te(Ee,Ne){return{$$typeof:n,type:Ee.type,key:Ne,ref:Ee.ref,props:Ee.props,_owner:Ee._owner}}function ie(Ee){return typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===n}function he(Ee){var Ne={"=":"=0",":":"=2"};return"$"+Ee.replace(/[=:]/g,function(je){return Ne[je]})}var fe=/\/+/g;function de(Ee,Ne){return typeof Ee=="object"&&Ee!==null&&Ee.key!=null?he(""+Ee.key):Ne.toString(36)}function ve(Ee,Ne,je,Ke,ot){var _t=typeof Ee;(_t==="undefined"||_t==="boolean")&&(Ee=null);var lt=!1;if(Ee===null)lt=!0;else switch(_t){case"string":case"number":lt=!0;break;case"object":switch(Ee.$$typeof){case n:case t:lt=!0}}if(lt)return lt=Ee,ot=ot(lt),Ee=Ke===""?"."+de(lt,0):Ke,ce(ot)?(je="",Ee!=null&&(je=Ee.replace(fe,"$&/")+"/"),ve(ot,Ne,je,"",function(bt){return bt})):ot!=null&&(ie(ot)&&(ot=te(ot,je+(!ot.key||lt&&lt.key===ot.key?"":(""+ot.key).replace(fe,"$&/")+"/")+Ee)),Ne.push(ot)),1;if(lt=0,Ke=Ke===""?".":Ke+":",ce(Ee))for(var vt=0;vt<Ee.length;vt++){_t=Ee[vt];var rt=Ke+de(_t,vt);lt+=ve(_t,Ne,je,rt,ot)}else if(rt=k(Ee),typeof rt=="function")for(Ee=rt.call(Ee),vt=0;!(_t=Ee.next()).done;)_t=_t.value,rt=Ke+de(_t,vt++),lt+=ve(_t,Ne,je,rt,ot);else if(_t==="object")throw Ne=String(Ee),Error("Objects are not valid as a React child (found: "+(Ne==="[object Object]"?"object with keys {"+Object.keys(Ee).join(", ")+"}":Ne)+"). If you meant to render a collection of children, use an array instead.");return lt}function Te(Ee,Ne,je){if(Ee==null)return Ee;var Ke=[],ot=0;return ve(Ee,Ke,"","",function(_t){return Ne.call(je,_t,ot++)}),Ke}function Fe(Ee){if(Ee._status===-1){var Ne=Ee._result;Ne=Ne(),Ne.then(function(je){(Ee._status===0||Ee._status===-1)&&(Ee._status=1,Ee._result=je)},function(je){(Ee._status===0||Ee._status===-1)&&(Ee._status=2,Ee._result=je)}),Ee._status===-1&&(Ee._status=0,Ee._result=Ne)}if(Ee._status===1)return Ee._result.default;throw Ee._result}var be={current:null},Ce={transition:null},Ae={ReactCurrentDispatcher:be,ReactCurrentBatchConfig:Ce,ReactCurrentOwner:ge};function De(){throw Error("act(...) is not supported in production builds of React.")}return Dr.Children={map:Te,forEach:function(Ee,Ne,je){Te(Ee,function(){Ne.apply(this,arguments)},je)},count:function(Ee){var Ne=0;return Te(Ee,function(){Ne++}),Ne},toArray:function(Ee){return Te(Ee,function(Ne){return Ne})||[]},only:function(Ee){if(!ie(Ee))throw Error("React.Children.only expected to receive a single React element child.");return Ee}},Dr.Component=z,Dr.Fragment=i,Dr.Profiler=l,Dr.PureComponent=K,Dr.StrictMode=a,Dr.Suspense=v,Dr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ae,Dr.act=De,Dr.cloneElement=function(Ee,Ne,je){if(Ee==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ee+".");var Ke=L({},Ee.props),ot=Ee.key,_t=Ee.ref,lt=Ee._owner;if(Ne!=null){if(Ne.ref!==void 0&&(_t=Ne.ref,lt=ge.current),Ne.key!==void 0&&(ot=""+Ne.key),Ee.type&&Ee.type.defaultProps)var vt=Ee.type.defaultProps;for(rt in Ne)oe.call(Ne,rt)&&!X.hasOwnProperty(rt)&&(Ke[rt]=Ne[rt]===void 0&&vt!==void 0?vt[rt]:Ne[rt])}var rt=arguments.length-2;if(rt===1)Ke.children=je;else if(1<rt){vt=Array(rt);for(var bt=0;bt<rt;bt++)vt[bt]=arguments[bt+2];Ke.children=vt}return{$$typeof:n,type:Ee.type,key:ot,ref:_t,props:Ke,_owner:lt}},Dr.createContext=function(Ee){return Ee={$$typeof:f,_currentValue:Ee,_currentValue2:Ee,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ee.Provider={$$typeof:d,_context:Ee},Ee.Consumer=Ee},Dr.createElement=J,Dr.createFactory=function(Ee){var Ne=J.bind(null,Ee);return Ne.type=Ee,Ne},Dr.createRef=function(){return{current:null}},Dr.forwardRef=function(Ee){return{$$typeof:y,render:Ee}},Dr.isValidElement=ie,Dr.lazy=function(Ee){return{$$typeof:R,_payload:{_status:-1,_result:Ee},_init:Fe}},Dr.memo=function(Ee,Ne){return{$$typeof:b,type:Ee,compare:Ne===void 0?null:Ne}},Dr.startTransition=function(Ee){var Ne=Ce.transition;Ce.transition={};try{Ee()}finally{Ce.transition=Ne}},Dr.unstable_act=De,Dr.useCallback=function(Ee,Ne){return be.current.useCallback(Ee,Ne)},Dr.useContext=function(Ee){return be.current.useContext(Ee)},Dr.useDebugValue=function(){},Dr.useDeferredValue=function(Ee){return be.current.useDeferredValue(Ee)},Dr.useEffect=function(Ee,Ne){return be.current.useEffect(Ee,Ne)},Dr.useId=function(){return be.current.useId()},Dr.useImperativeHandle=function(Ee,Ne,je){return be.current.useImperativeHandle(Ee,Ne,je)},Dr.useInsertionEffect=function(Ee,Ne){return be.current.useInsertionEffect(Ee,Ne)},Dr.useLayoutEffect=function(Ee,Ne){return be.current.useLayoutEffect(Ee,Ne)},Dr.useMemo=function(Ee,Ne){return be.current.useMemo(Ee,Ne)},Dr.useReducer=function(Ee,Ne,je){return be.current.useReducer(Ee,Ne,je)},Dr.useRef=function(Ee){return be.current.useRef(Ee)},Dr.useState=function(Ee){return be.current.useState(Ee)},Dr.useSyncExternalStore=function(Ee,Ne,je){return be.current.useSyncExternalStore(Ee,Ne,je)},Dr.useTransition=function(){return be.current.useTransition()},Dr.version="18.3.1",Dr}var gK;function Hf(){return gK||(gK=1,pM.exports=Xye()),pM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _K;function Jye(){if(_K)return CT;_K=1;var n=Hf(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(y,v,b){var R,I={},k=null,M=null;b!==void 0&&(k=""+b),v.key!==void 0&&(k=""+v.key),v.ref!==void 0&&(M=v.ref);for(R in v)a.call(v,R)&&!d.hasOwnProperty(R)&&(I[R]=v[R]);if(y&&y.defaultProps)for(R in v=y.defaultProps,v)I[R]===void 0&&(I[R]=v[R]);return{$$typeof:t,type:y,key:k,ref:M,props:I,_owner:l.current}}return CT.Fragment=i,CT.jsx=f,CT.jsxs=f,CT}var yK;function Qye(){return yK||(yK=1,hM.exports=Jye()),hM.exports}var w=Qye(),N=Hf();const Ei=Mg(N),EK=Yye({__proto__:null,default:Ei},[N]);var v1={},fM={exports:{}},al={},mM={exports:{}},gM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vK;function Zye(){return vK||(vK=1,function(n){function t(Ce,Ae){var De=Ce.length;Ce.push(Ae);e:for(;0<De;){var Ee=De-1>>>1,Ne=Ce[Ee];if(0<l(Ne,Ae))Ce[Ee]=Ae,Ce[De]=Ne,De=Ee;else break e}}function i(Ce){return Ce.length===0?null:Ce[0]}function a(Ce){if(Ce.length===0)return null;var Ae=Ce[0],De=Ce.pop();if(De!==Ae){Ce[0]=De;e:for(var Ee=0,Ne=Ce.length,je=Ne>>>1;Ee<je;){var Ke=2*(Ee+1)-1,ot=Ce[Ke],_t=Ke+1,lt=Ce[_t];if(0>l(ot,De))_t<Ne&&0>l(lt,ot)?(Ce[Ee]=lt,Ce[_t]=De,Ee=_t):(Ce[Ee]=ot,Ce[Ke]=De,Ee=Ke);else if(_t<Ne&&0>l(lt,De))Ce[Ee]=lt,Ce[_t]=De,Ee=_t;else break e}}return Ae}function l(Ce,Ae){var De=Ce.sortIndex-Ae.sortIndex;return De!==0?De:Ce.id-Ae.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var f=Date,y=f.now();n.unstable_now=function(){return f.now()-y}}var v=[],b=[],R=1,I=null,k=3,M=!1,L=!1,j=!1,z=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(Ce){for(var Ae=i(b);Ae!==null;){if(Ae.callback===null)a(b);else if(Ae.startTime<=Ce)a(b),Ae.sortIndex=Ae.expirationTime,t(v,Ae);else break;Ae=i(b)}}function ce(Ce){if(j=!1,ne(Ce),!L)if(i(v)!==null)L=!0,Fe(oe);else{var Ae=i(b);Ae!==null&&be(ce,Ae.startTime-Ce)}}function oe(Ce,Ae){L=!1,j&&(j=!1,Y(J),J=-1),M=!0;var De=k;try{for(ne(Ae),I=i(v);I!==null&&(!(I.expirationTime>Ae)||Ce&&!he());){var Ee=I.callback;if(typeof Ee=="function"){I.callback=null,k=I.priorityLevel;var Ne=Ee(I.expirationTime<=Ae);Ae=n.unstable_now(),typeof Ne=="function"?I.callback=Ne:I===i(v)&&a(v),ne(Ae)}else a(v);I=i(v)}if(I!==null)var je=!0;else{var Ke=i(b);Ke!==null&&be(ce,Ke.startTime-Ae),je=!1}return je}finally{I=null,k=De,M=!1}}var ge=!1,X=null,J=-1,te=5,ie=-1;function he(){return!(n.unstable_now()-ie<te)}function fe(){if(X!==null){var Ce=n.unstable_now();ie=Ce;var Ae=!0;try{Ae=X(!0,Ce)}finally{Ae?de():(ge=!1,X=null)}}else ge=!1}var de;if(typeof K=="function")de=function(){K(fe)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,Te=ve.port2;ve.port1.onmessage=fe,de=function(){Te.postMessage(null)}}else de=function(){z(fe,0)};function Fe(Ce){X=Ce,ge||(ge=!0,de())}function be(Ce,Ae){J=z(function(){Ce(n.unstable_now())},Ae)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ce){Ce.callback=null},n.unstable_continueExecution=function(){L||M||(L=!0,Fe(oe))},n.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<Ce?Math.floor(1e3/Ce):5},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return i(v)},n.unstable_next=function(Ce){switch(k){case 1:case 2:case 3:var Ae=3;break;default:Ae=k}var De=k;k=Ae;try{return Ce()}finally{k=De}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ce,Ae){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var De=k;k=Ce;try{return Ae()}finally{k=De}},n.unstable_scheduleCallback=function(Ce,Ae,De){var Ee=n.unstable_now();switch(typeof De=="object"&&De!==null?(De=De.delay,De=typeof De=="number"&&0<De?Ee+De:Ee):De=Ee,Ce){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=De+Ne,Ce={id:R++,callback:Ae,priorityLevel:Ce,startTime:De,expirationTime:Ne,sortIndex:-1},De>Ee?(Ce.sortIndex=De,t(b,Ce),i(v)===null&&Ce===i(b)&&(j?(Y(J),J=-1):j=!0,be(ce,De-Ee))):(Ce.sortIndex=Ne,t(v,Ce),L||M||(L=!0,Fe(oe))),Ce},n.unstable_shouldYield=he,n.unstable_wrapCallback=function(Ce){var Ae=k;return function(){var De=k;k=Ae;try{return Ce.apply(this,arguments)}finally{k=De}}}}(gM)),gM}var SK;function eEe(){return SK||(SK=1,mM.exports=Zye()),mM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bK;function tEe(){if(bK)return al;bK=1;var n=Hf(),t=eEe();function i(p){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+p,T=1;T<arguments.length;T++)_+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+p+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,_){f(p,_),f(p+"Capture",_)}function f(p,_){for(l[p]=_,p=0;p<_.length;p++)a.add(_[p])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,R={},I={};function k(p){return v.call(I,p)?!0:v.call(R,p)?!1:b.test(p)?I[p]=!0:(R[p]=!0,!1)}function M(p,_,T,D){if(T!==null&&T.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return D?!1:T!==null?!T.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function L(p,_,T,D){if(_===null||typeof _>"u"||M(p,_,T,D))return!0;if(D)return!1;if(T!==null)switch(T.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function j(p,_,T,D,V,$,pe){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=D,this.attributeNamespace=V,this.mustUseProperty=T,this.propertyName=p,this.type=_,this.sanitizeURL=$,this.removeEmptyString=pe}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){z[p]=new j(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var _=p[0];z[_]=new j(_,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){z[p]=new j(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){z[p]=new j(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){z[p]=new j(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){z[p]=new j(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){z[p]=new j(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){z[p]=new j(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){z[p]=new j(p,5,!1,p.toLowerCase(),null,!1,!1)});var Y=/[\-:]([a-z])/g;function K(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var _=p.replace(Y,K);z[_]=new j(_,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var _=p.replace(Y,K);z[_]=new j(_,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var _=p.replace(Y,K);z[_]=new j(_,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){z[p]=new j(p,1,!1,p.toLowerCase(),null,!1,!1)}),z.xlinkHref=new j("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){z[p]=new j(p,1,!1,p.toLowerCase(),null,!0,!0)});function ne(p,_,T,D){var V=z.hasOwnProperty(_)?z[_]:null;(V!==null?V.type!==0:D||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(L(_,T,V,D)&&(T=null),D||V===null?k(_)&&(T===null?p.removeAttribute(_):p.setAttribute(_,""+T)):V.mustUseProperty?p[V.propertyName]=T===null?V.type===3?!1:"":T:(_=V.attributeName,D=V.attributeNamespace,T===null?p.removeAttribute(_):(V=V.type,T=V===3||V===4&&T===!0?"":""+T,D?p.setAttributeNS(D,_,T):p.setAttribute(_,T))))}var ce=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oe=Symbol.for("react.element"),ge=Symbol.for("react.portal"),X=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),te=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),he=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),de=Symbol.for("react.suspense"),ve=Symbol.for("react.suspense_list"),Te=Symbol.for("react.memo"),Fe=Symbol.for("react.lazy"),be=Symbol.for("react.offscreen"),Ce=Symbol.iterator;function Ae(p){return p===null||typeof p!="object"?null:(p=Ce&&p[Ce]||p["@@iterator"],typeof p=="function"?p:null)}var De=Object.assign,Ee;function Ne(p){if(Ee===void 0)try{throw Error()}catch(T){var _=T.stack.trim().match(/\n( *(at )?)/);Ee=_&&_[1]||""}return`
`+Ee+p}var je=!1;function Ke(p,_){if(!p||je)return"";je=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(ct){var D=ct}Reflect.construct(p,[],_)}else{try{_.call()}catch(ct){D=ct}p.call(_.prototype)}else{try{throw Error()}catch(ct){D=ct}p()}}catch(ct){if(ct&&D&&typeof ct.stack=="string"){for(var V=ct.stack.split(`
`),$=D.stack.split(`
`),pe=V.length-1,Oe=$.length-1;1<=pe&&0<=Oe&&V[pe]!==$[Oe];)Oe--;for(;1<=pe&&0<=Oe;pe--,Oe--)if(V[pe]!==$[Oe]){if(pe!==1||Oe!==1)do if(pe--,Oe--,0>Oe||V[pe]!==$[Oe]){var Ve=`
`+V[pe].replace(" at new "," at ");return p.displayName&&Ve.includes("<anonymous>")&&(Ve=Ve.replace("<anonymous>",p.displayName)),Ve}while(1<=pe&&0<=Oe);break}}}finally{je=!1,Error.prepareStackTrace=T}return(p=p?p.displayName||p.name:"")?Ne(p):""}function ot(p){switch(p.tag){case 5:return Ne(p.type);case 16:return Ne("Lazy");case 13:return Ne("Suspense");case 19:return Ne("SuspenseList");case 0:case 2:case 15:return p=Ke(p.type,!1),p;case 11:return p=Ke(p.type.render,!1),p;case 1:return p=Ke(p.type,!0),p;default:return""}}function _t(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case X:return"Fragment";case ge:return"Portal";case te:return"Profiler";case J:return"StrictMode";case de:return"Suspense";case ve:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case he:return(p.displayName||"Context")+".Consumer";case ie:return(p._context.displayName||"Context")+".Provider";case fe:var _=p.render;return p=p.displayName,p||(p=_.displayName||_.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Te:return _=p.displayName||null,_!==null?_:_t(p.type)||"Memo";case Fe:_=p._payload,p=p._init;try{return _t(p(_))}catch{}}return null}function lt(p){var _=p.type;switch(p.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=_.render,p=p.displayName||p.name||"",_.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _t(_);case 8:return _===J?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function vt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function rt(p){var _=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function bt(p){var _=rt(p)?"checked":"value",T=Object.getOwnPropertyDescriptor(p.constructor.prototype,_),D=""+p[_];if(!p.hasOwnProperty(_)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var V=T.get,$=T.set;return Object.defineProperty(p,_,{configurable:!0,get:function(){return V.call(this)},set:function(pe){D=""+pe,$.call(this,pe)}}),Object.defineProperty(p,_,{enumerable:T.enumerable}),{getValue:function(){return D},setValue:function(pe){D=""+pe},stopTracking:function(){p._valueTracker=null,delete p[_]}}}}function $t(p){p._valueTracker||(p._valueTracker=bt(p))}function ut(p){if(!p)return!1;var _=p._valueTracker;if(!_)return!0;var T=_.getValue(),D="";return p&&(D=rt(p)?p.checked?"true":"false":p.value),p=D,p!==T?(_.setValue(p),!0):!1}function mt(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function at(p,_){var T=_.checked;return De({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??p._wrapperState.initialChecked})}function Vt(p,_){var T=_.defaultValue==null?"":_.defaultValue,D=_.checked!=null?_.checked:_.defaultChecked;T=vt(_.value!=null?_.value:T),p._wrapperState={initialChecked:D,initialValue:T,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function rn(p,_){_=_.checked,_!=null&&ne(p,"checked",_,!1)}function Ht(p,_){rn(p,_);var T=vt(_.value),D=_.type;if(T!=null)D==="number"?(T===0&&p.value===""||p.value!=T)&&(p.value=""+T):p.value!==""+T&&(p.value=""+T);else if(D==="submit"||D==="reset"){p.removeAttribute("value");return}_.hasOwnProperty("value")?xe(p,_.type,T):_.hasOwnProperty("defaultValue")&&xe(p,_.type,vt(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(p.defaultChecked=!!_.defaultChecked)}function we(p,_,T){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var D=_.type;if(!(D!=="submit"&&D!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+p._wrapperState.initialValue,T||_===p.value||(p.value=_),p.defaultValue=_}T=p.name,T!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,T!==""&&(p.name=T)}function xe(p,_,T){(_!=="number"||mt(p.ownerDocument)!==p)&&(T==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+T&&(p.defaultValue=""+T))}var $e=Array.isArray;function Pt(p,_,T,D){if(p=p.options,_){_={};for(var V=0;V<T.length;V++)_["$"+T[V]]=!0;for(T=0;T<p.length;T++)V=_.hasOwnProperty("$"+p[T].value),p[T].selected!==V&&(p[T].selected=V),V&&D&&(p[T].defaultSelected=!0)}else{for(T=""+vt(T),_=null,V=0;V<p.length;V++){if(p[V].value===T){p[V].selected=!0,D&&(p[V].defaultSelected=!0);return}_!==null||p[V].disabled||(_=p[V])}_!==null&&(_.selected=!0)}}function It(p,_){if(_.dangerouslySetInnerHTML!=null)throw Error(i(91));return De({},_,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function wt(p,_){var T=_.value;if(T==null){if(T=_.children,_=_.defaultValue,T!=null){if(_!=null)throw Error(i(92));if($e(T)){if(1<T.length)throw Error(i(93));T=T[0]}_=T}_==null&&(_=""),T=_}p._wrapperState={initialValue:vt(T)}}function Mt(p,_){var T=vt(_.value),D=vt(_.defaultValue);T!=null&&(T=""+T,T!==p.value&&(p.value=T),_.defaultValue==null&&p.defaultValue!==T&&(p.defaultValue=T)),D!=null&&(p.defaultValue=""+D)}function vn(p){var _=p.textContent;_===p._wrapperState.initialValue&&_!==""&&_!==null&&(p.value=_)}function Cn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dn(p,_){return p==null||p==="http://www.w3.org/1999/xhtml"?Cn(_):p==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Rt,Qn=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,T,D,V){MSApp.execUnsafeLocalFunction(function(){return p(_,T,D,V)})}:p}(function(p,_){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=_;else{for(Rt=Rt||document.createElement("div"),Rt.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=Rt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;_.firstChild;)p.appendChild(_.firstChild)}});function xt(p,_){if(_){var T=p.firstChild;if(T&&T===p.lastChild&&T.nodeType===3){T.nodeValue=_;return}}p.textContent=_}var Xt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lr=["Webkit","ms","Moz","O"];Object.keys(Xt).forEach(function(p){Lr.forEach(function(_){_=_+p.charAt(0).toUpperCase()+p.substring(1),Xt[_]=Xt[p]})});function Ci(p,_,T){return _==null||typeof _=="boolean"||_===""?"":T||typeof _!="number"||_===0||Xt.hasOwnProperty(p)&&Xt[p]?(""+_).trim():_+"px"}function ai(p,_){p=p.style;for(var T in _)if(_.hasOwnProperty(T)){var D=T.indexOf("--")===0,V=Ci(T,_[T],D);T==="float"&&(T="cssFloat"),D?p.setProperty(T,V):p[T]=V}}var Ii=De({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ps(p,_){if(_){if(Ii[p]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(i(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(i(61))}if(_.style!=null&&typeof _.style!="object")throw Error(i(62))}}function qo(p,_){if(p.indexOf("-")===-1)return typeof _.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hi=null;function Ai(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Kn=null,cs=null,da=null;function Yo(p){if(p=i_(p)){if(typeof Kn!="function")throw Error(i(280));var _=p.stateNode;_&&(_=vE(_),Kn(p.stateNode,p.type,_))}}function po(p){cs?da?da.push(p):da=[p]:cs=p}function rd(){if(cs){var p=cs,_=da;if(da=cs=null,Yo(p),_)for(p=0;p<_.length;p++)Yo(_[p])}}function Xo(p,_){return p(_)}function id(){}var hc=!1;function Co(p,_,T){if(hc)return p(_,T);hc=!0;try{return Xo(p,_,T)}finally{hc=!1,(cs!==null||da!==null)&&(id(),rd())}}function Sr(p,_){var T=p.stateNode;if(T===null)return null;var D=vE(T);if(D===null)return null;T=D[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(p=p.type,D=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!D;break e;default:p=!1}if(p)return null;if(T&&typeof T!="function")throw Error(i(231,_,typeof T));return T}var ou=!1;if(y)try{var ha={};Object.defineProperty(ha,"passive",{get:function(){ou=!0}}),window.addEventListener("test",ha,ha),window.removeEventListener("test",ha,ha)}catch{ou=!1}function Fa(p,_,T,D,V,$,pe,Oe,Ve){var ct=Array.prototype.slice.call(arguments,3);try{_.apply(T,ct)}catch(Dt){this.onError(Dt)}}var Mc=!1,Jo=null,Qo=!1,sd=null,ph={onError:function(p){Mc=!0,Jo=p}};function vl(p,_,T,D,V,$,pe,Oe,Ve){Mc=!1,Jo=null,Fa.apply(ph,arguments)}function fh(p,_,T,D,V,$,pe,Oe,Ve){if(vl.apply(this,arguments),Mc){if(Mc){var ct=Jo;Mc=!1,Jo=null}else throw Error(i(198));Qo||(Qo=!0,sd=ct)}}function Os(p){var _=p,T=p;if(p.alternate)for(;_.return;)_=_.return;else{p=_;do _=p,(_.flags&4098)!==0&&(T=_.return),p=_.return;while(p)}return _.tag===3?T:null}function pt(p){if(p.tag===13){var _=p.memoizedState;if(_===null&&(p=p.alternate,p!==null&&(_=p.memoizedState)),_!==null)return _.dehydrated}return null}function nn(p){if(Os(p)!==p)throw Error(i(188))}function Ar(p){var _=p.alternate;if(!_){if(_=Os(p),_===null)throw Error(i(188));return _!==p?null:p}for(var T=p,D=_;;){var V=T.return;if(V===null)break;var $=V.alternate;if($===null){if(D=V.return,D!==null){T=D;continue}break}if(V.child===$.child){for($=V.child;$;){if($===T)return nn(V),p;if($===D)return nn(V),_;$=$.sibling}throw Error(i(188))}if(T.return!==D.return)T=V,D=$;else{for(var pe=!1,Oe=V.child;Oe;){if(Oe===T){pe=!0,T=V,D=$;break}if(Oe===D){pe=!0,D=V,T=$;break}Oe=Oe.sibling}if(!pe){for(Oe=$.child;Oe;){if(Oe===T){pe=!0,T=$,D=V;break}if(Oe===D){pe=!0,D=$,T=V;break}Oe=Oe.sibling}if(!pe)throw Error(i(189))}}if(T.alternate!==D)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?p:_}function Pi(p){return p=Ar(p),p!==null?pc(p):null}function pc(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var _=pc(p);if(_!==null)return _;p=p.sibling}return null}var fo=t.unstable_scheduleCallback,Sl=t.unstable_cancelCallback,mh=t.unstable_shouldYield,$s=t.unstable_requestPaint,Br=t.unstable_now,gh=t.unstable_getCurrentPriorityLevel,zr=t.unstable_ImmediatePriority,pa=t.unstable_UserBlockingPriority,$i=t.unstable_NormalPriority,fs=t.unstable_LowPriority,ni=t.unstable_IdlePriority,Uc=null,fa=null;function xp(p){if(fa&&typeof fa.onCommitFiberRoot=="function")try{fa.onCommitFiberRoot(Uc,p,void 0,(p.current.flags&128)===128)}catch{}}var Io=Math.clz32?Math.clz32:bl,Lp=Math.log,Yf=Math.LN2;function bl(p){return p>>>=0,p===0?32:31-(Lp(p)/Yf|0)|0}var au=64,_h=4194304;function Pr(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function od(p,_){var T=p.pendingLanes;if(T===0)return 0;var D=0,V=p.suspendedLanes,$=p.pingedLanes,pe=T&268435455;if(pe!==0){var Oe=pe&~V;Oe!==0?D=Pr(Oe):($&=pe,$!==0&&(D=Pr($)))}else pe=T&~V,pe!==0?D=Pr(pe):$!==0&&(D=Pr($));if(D===0)return 0;if(_!==0&&_!==D&&(_&V)===0&&(V=D&-D,$=_&-_,V>=$||V===16&&($&4194240)!==0))return _;if((D&4)!==0&&(D|=T&16),_=p.entangledLanes,_!==0)for(p=p.entanglements,_&=D;0<_;)T=31-Io(_),V=1<<T,D|=p[T],_&=~V;return D}function ad(p,_){switch(p){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ja(p,_){for(var T=p.suspendedLanes,D=p.pingedLanes,V=p.expirationTimes,$=p.pendingLanes;0<$;){var pe=31-Io($),Oe=1<<pe,Ve=V[pe];Ve===-1?((Oe&T)===0||(Oe&D)!==0)&&(V[pe]=ad(Oe,_)):Ve<=_&&(p.expiredLanes|=Oe),$&=~Oe}}function ma(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function cd(){var p=au;return au<<=1,(au&4194240)===0&&(au=64),p}function wl(p){for(var _=[],T=0;31>T;T++)_.push(p);return _}function cu(p,_,T){p.pendingLanes|=_,_!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,_=31-Io(_),p[_]=T}function ci(p,_){var T=p.pendingLanes&~_;p.pendingLanes=_,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=_,p.mutableReadLanes&=_,p.entangledLanes&=_,_=p.entanglements;var D=p.eventTimes;for(p=p.expirationTimes;0<T;){var V=31-Io(T),$=1<<V;_[V]=0,D[V]=-1,p[V]=-1,T&=~$}}function lu(p,_){var T=p.entangledLanes|=_;for(p=p.entanglements;T;){var D=31-Io(T),V=1<<D;V&_|p[D]&_&&(p[D]|=_),T&=~V}}var fr=0;function Tl(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var yh,Eh,uu,Xf,Mp,Up=!1,ga=[],ms=null,_a=null,ya=null,du=new Map,Ea=new Map,Ba=[],Vp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vc(p,_){switch(p){case"focusin":case"focusout":ms=null;break;case"dragenter":case"dragleave":_a=null;break;case"mouseover":case"mouseout":ya=null;break;case"pointerover":case"pointerout":du.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ea.delete(_.pointerId)}}function ks(p,_,T,D,V,$){return p===null||p.nativeEvent!==$?(p={blockedOn:_,domEventName:T,eventSystemFlags:D,nativeEvent:$,targetContainers:[V]},_!==null&&(_=i_(_),_!==null&&Eh(_)),p):(p.eventSystemFlags|=D,_=p.targetContainers,V!==null&&_.indexOf(V)===-1&&_.push(V),p)}function Wg(p,_,T,D,V){switch(_){case"focusin":return ms=ks(ms,p,_,T,D,V),!0;case"dragenter":return _a=ks(_a,p,_,T,D,V),!0;case"mouseover":return ya=ks(ya,p,_,T,D,V),!0;case"pointerover":var $=V.pointerId;return du.set($,ks(du.get($)||null,p,_,T,D,V)),!0;case"gotpointercapture":return $=V.pointerId,Ea.set($,ks(Ea.get($)||null,p,_,T,D,V)),!0}return!1}function Rl(p){var _=Fp(p.target);if(_!==null){var T=Os(_);if(T!==null){if(_=T.tag,_===13){if(_=pt(T),_!==null){p.blockedOn=_,Mp(p.priority,function(){uu(T)});return}}else if(_===3&&T.stateNode.current.memoizedState.isDehydrated){p.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Cl(p){if(p.blockedOn!==null)return!1;for(var _=p.targetContainers;0<_.length;){var T=Mr(p.domEventName,p.eventSystemFlags,_[0],p.nativeEvent);if(T===null){T=p.nativeEvent;var D=new T.constructor(T.type,T);Hi=D,T.target.dispatchEvent(D),Hi=null}else return _=i_(T),_!==null&&Eh(_),p.blockedOn=T,!1;_.shift()}return!0}function hu(p,_,T){Cl(p)&&T.delete(_)}function Jf(){Up=!1,ms!==null&&Cl(ms)&&(ms=null),_a!==null&&Cl(_a)&&(_a=null),ya!==null&&Cl(ya)&&(ya=null),du.forEach(hu),Ea.forEach(hu)}function fc(p,_){p.blockedOn===_&&(p.blockedOn=null,Up||(Up=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Jf)))}function va(p){function _(V){return fc(V,p)}if(0<ga.length){fc(ga[0],p);for(var T=1;T<ga.length;T++){var D=ga[T];D.blockedOn===p&&(D.blockedOn=null)}}for(ms!==null&&fc(ms,p),_a!==null&&fc(_a,p),ya!==null&&fc(ya,p),du.forEach(_),Ea.forEach(_),T=0;T<Ba.length;T++)D=Ba[T],D.blockedOn===p&&(D.blockedOn=null);for(;0<Ba.length&&(T=Ba[0],T.blockedOn===null);)Rl(T),T.blockedOn===null&&Ba.shift()}var Il=ce.ReactCurrentBatchConfig,Re=!0;function Me(p,_,T,D){var V=fr,$=Il.transition;Il.transition=null;try{fr=1,qt(p,_,T,D)}finally{fr=V,Il.transition=$}}function st(p,_,T,D){var V=fr,$=Il.transition;Il.transition=null;try{fr=4,qt(p,_,T,D)}finally{fr=V,Il.transition=$}}function qt(p,_,T,D){if(Re){var V=Mr(p,_,T,D);if(V===null)eb(p,_,D,sr,T),Vc(p,D);else if(Wg(V,p,_,T,D))D.stopPropagation();else if(Vc(p,D),_&4&&-1<Vp.indexOf(p)){for(;V!==null;){var $=i_(V);if($!==null&&yh($),$=Mr(p,_,T,D),$===null&&eb(p,_,D,sr,T),$===V)break;V=$}V!==null&&D.stopPropagation()}else eb(p,_,D,null,T)}}var sr=null;function Mr(p,_,T,D){if(sr=null,p=Ai(D),p=Fp(p),p!==null)if(_=Os(p),_===null)p=null;else if(T=_.tag,T===13){if(p=pt(_),p!==null)return p;p=null}else if(T===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;p=null}else _!==p&&(p=null);return sr=p,null}function ri(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gh()){case zr:return 1;case pa:return 4;case $i:case fs:return 16;case ni:return 536870912;default:return 16}default:return 16}}var Zn=null,er=null,Oi=null;function Ks(){if(Oi)return Oi;var p,_=er,T=_.length,D,V="value"in Zn?Zn.value:Zn.textContent,$=V.length;for(p=0;p<T&&_[p]===V[p];p++);var pe=T-p;for(D=1;D<=pe&&_[T-D]===V[$-D];D++);return Oi=V.slice(p,1<D?1-D:void 0)}function Fc(p){var _=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&_===13&&(p=13)):p=_,p===10&&(p=13),32<=p||p===13?p:0}function Ao(){return!0}function pu(){return!1}function Ns(p){function _(T,D,V,$,pe){this._reactName=T,this._targetInst=V,this.type=D,this.nativeEvent=$,this.target=pe,this.currentTarget=null;for(var Oe in p)p.hasOwnProperty(Oe)&&(T=p[Oe],this[Oe]=T?T($):$[Oe]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?Ao:pu,this.isPropagationStopped=pu,this}return De(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Ao)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Ao)},persist:function(){},isPersistent:Ao}),_}var mc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qf=Ns(mc),jc=De({},mc,{view:0,detail:0}),Gg=Ns(jc),vh,ld,Sh,gc=De({},jc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mu,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Sh&&(Sh&&p.type==="mousemove"?(vh=p.screenX-Sh.screenX,ld=p.screenY-Sh.screenY):ld=vh=0,Sh=p),vh)},movementY:function(p){return"movementY"in p?p.movementY:ld}}),fu=Ns(gc),Hg=De({},gc,{dataTransfer:0}),aE=Ns(Hg),Zf=De({},jc,{relatedTarget:0}),em=Ns(Zf),cE=De({},mc,{animationName:0,elapsedTime:0,pseudoElement:0}),za=Ns(cE),lE=De({},mc,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),ud=Ns(lE),$g=De({},mc,{data:0}),Kg=Ns($g),Wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},uE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dE(p){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(p):(p=uE[p])?!!_[p]:!1}function mu(){return dE}var P=De({},jc,{key:function(p){if(p.key){var _=Wn[p.key]||p.key;if(_!=="Unidentified")return _}return p.type==="keypress"?(p=Fc(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Sa[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mu,charCode:function(p){return p.type==="keypress"?Fc(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Fc(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),H=Ns(P),re=De({},gc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Se=Ns(re),qe=De({},jc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mu}),dt=Ns(qe),Kt=De({},mc,{propertyName:0,elapsedTime:0,pseudoElement:0}),ii=Ns(Kt),qs=De({},gc,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),dr=Ns(qs),mo=[9,13,27,32],Ds=y&&"CompositionEvent"in window,Bc=null;y&&"documentMode"in document&&(Bc=document.documentMode);var Wa=y&&"TextEvent"in window&&!Bc,dd=y&&(!Ds||Bc&&8<Bc&&11>=Bc),tm=" ",FC=!1;function jC(p,_){switch(p){case"keyup":return mo.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _c(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var nm=!1;function NN(p,_){switch(p){case"compositionend":return _c(_);case"keypress":return _.which!==32?null:(FC=!0,tm);case"textInput":return p=_.data,p===tm&&FC?null:p;default:return null}}function DN(p,_){if(nm)return p==="compositionend"||!Ds&&jC(p,_)?(p=Ks(),Oi=er=Zn=null,nm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return dd&&_.locale!=="ko"?null:_.data;default:return null}}var xN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function G0(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _==="input"?!!xN[p.type]:_==="textarea"}function BC(p,_,T,D){po(D),_=e_(_,"onChange"),0<_.length&&(T=new Qf("onChange","change",null,T,D),p.push({event:T,listeners:_}))}var qg=null,rm=null;function H0(p){QC(p,0)}function hE(p){var _=um(p);if(ut(_))return p}function LN(p,_){if(p==="change")return _}var Yg=!1;if(y){var $0;if(y){var K0="oninput"in document;if(!K0){var zC=document.createElement("div");zC.setAttribute("oninput","return;"),K0=typeof zC.oninput=="function"}$0=K0}else $0=!1;Yg=$0&&(!document.documentMode||9<document.documentMode)}function hd(){qg&&(qg.detachEvent("onpropertychange",WC),rm=qg=null)}function WC(p){if(p.propertyName==="value"&&hE(rm)){var _=[];BC(_,rm,p,Ai(p)),Co(H0,_)}}function MN(p,_,T){p==="focusin"?(hd(),qg=_,rm=T,qg.attachEvent("onpropertychange",WC)):p==="focusout"&&hd()}function Ga(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return hE(rm)}function UN(p,_){if(p==="click")return hE(_)}function VN(p,_){if(p==="input"||p==="change")return hE(_)}function FN(p,_){return p===_&&(p!==0||1/p===1/_)||p!==p&&_!==_}var Al=typeof Object.is=="function"?Object.is:FN;function im(p,_){if(Al(p,_))return!0;if(typeof p!="object"||p===null||typeof _!="object"||_===null)return!1;var T=Object.keys(p),D=Object.keys(_);if(T.length!==D.length)return!1;for(D=0;D<T.length;D++){var V=T[D];if(!v.call(_,V)||!Al(p[V],_[V]))return!1}return!0}function GC(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function HC(p,_){var T=GC(p);p=0;for(var D;T;){if(T.nodeType===3){if(D=p+T.textContent.length,p<=_&&D>=_)return{node:T,offset:_-p};p=D}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=GC(T)}}function $C(p,_){return p&&_?p===_?!0:p&&p.nodeType===3?!1:_&&_.nodeType===3?$C(p,_.parentNode):"contains"in p?p.contains(_):p.compareDocumentPosition?!!(p.compareDocumentPosition(_)&16):!1:!1}function q0(){for(var p=window,_=mt();_ instanceof p.HTMLIFrameElement;){try{var T=typeof _.contentWindow.location.href=="string"}catch{T=!1}if(T)p=_.contentWindow;else break;_=mt(p.document)}return _}function Y0(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _&&(_==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||_==="textarea"||p.contentEditable==="true")}function jN(p){var _=q0(),T=p.focusedElem,D=p.selectionRange;if(_!==T&&T&&T.ownerDocument&&$C(T.ownerDocument.documentElement,T)){if(D!==null&&Y0(T)){if(_=D.start,p=D.end,p===void 0&&(p=_),"selectionStart"in T)T.selectionStart=_,T.selectionEnd=Math.min(p,T.value.length);else if(p=(_=T.ownerDocument||document)&&_.defaultView||window,p.getSelection){p=p.getSelection();var V=T.textContent.length,$=Math.min(D.start,V);D=D.end===void 0?$:Math.min(D.end,V),!p.extend&&$>D&&(V=D,D=$,$=V),V=HC(T,$);var pe=HC(T,D);V&&pe&&(p.rangeCount!==1||p.anchorNode!==V.node||p.anchorOffset!==V.offset||p.focusNode!==pe.node||p.focusOffset!==pe.offset)&&(_=_.createRange(),_.setStart(V.node,V.offset),p.removeAllRanges(),$>D?(p.addRange(_),p.extend(pe.node,pe.offset)):(_.setEnd(pe.node,pe.offset),p.addRange(_)))}}for(_=[],p=T;p=p.parentNode;)p.nodeType===1&&_.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<_.length;T++)p=_[T],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var X0=y&&"documentMode"in document&&11>=document.documentMode,bh=null,J0=null,et=null,Q0=!1;function KC(p,_,T){var D=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;Q0||bh==null||bh!==mt(D)||(D=bh,"selectionStart"in D&&Y0(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),et&&im(et,D)||(et=D,D=e_(J0,"onSelect"),0<D.length&&(_=new Qf("onSelect","select",null,_,T),p.push({event:_,listeners:D}),_.target=bh)))}function pE(p,_){var T={};return T[p.toLowerCase()]=_.toLowerCase(),T["Webkit"+p]="webkit"+_,T["Moz"+p]="moz"+_,T}var sm={animationend:pE("Animation","AnimationEnd"),animationiteration:pE("Animation","AnimationIteration"),animationstart:pE("Animation","AnimationStart"),transitionend:pE("Transition","TransitionEnd")},fE={},Z0={};y&&(Z0=document.createElement("div").style,"AnimationEvent"in window||(delete sm.animationend.animation,delete sm.animationiteration.animation,delete sm.animationstart.animation),"TransitionEvent"in window||delete sm.transitionend.transition);function mE(p){if(fE[p])return fE[p];if(!sm[p])return p;var _=sm[p],T;for(T in _)if(_.hasOwnProperty(T)&&T in Z0)return fE[p]=_[T];return p}var qC=mE("animationend"),YC=mE("animationiteration"),Xg=mE("animationstart"),om=mE("transitionend"),XC=new Map,JC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pl(p,_){XC.set(p,_),d(_,[p])}for(var Jg=0;Jg<JC.length;Jg++){var am=JC[Jg],BN=am.toLowerCase(),zN=am[0].toUpperCase()+am.slice(1);Pl(BN,"on"+zN)}Pl(qC,"onAnimationEnd"),Pl(YC,"onAnimationIteration"),Pl(Xg,"onAnimationStart"),Pl("dblclick","onDoubleClick"),Pl("focusin","onFocus"),Pl("focusout","onBlur"),Pl(om,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qg));function gE(p,_,T){var D=p.type||"unknown-event";p.currentTarget=T,fh(D,_,void 0,p),p.currentTarget=null}function QC(p,_){_=(_&4)!==0;for(var T=0;T<p.length;T++){var D=p[T],V=D.event;D=D.listeners;e:{var $=void 0;if(_)for(var pe=D.length-1;0<=pe;pe--){var Oe=D[pe],Ve=Oe.instance,ct=Oe.currentTarget;if(Oe=Oe.listener,Ve!==$&&V.isPropagationStopped())break e;gE(V,Oe,ct),$=Ve}else for(pe=0;pe<D.length;pe++){if(Oe=D[pe],Ve=Oe.instance,ct=Oe.currentTarget,Oe=Oe.listener,Ve!==$&&V.isPropagationStopped())break e;gE(V,Oe,ct),$=Ve}}}if(Qo)throw p=sd,Qo=!1,sd=null,p}function ki(p,_){var T=_[ib];T===void 0&&(T=_[ib]=new Set);var D=p+"__bubble";T.has(D)||(ZC(_,p,2,!1),T.add(D))}function Ha(p,_,T){var D=0;_&&(D|=4),ZC(T,p,D,_)}var _E="_reactListening"+Math.random().toString(36).slice(2);function pd(p){if(!p[_E]){p[_E]=!0,a.forEach(function(T){T!=="selectionchange"&&(WN.has(T)||Ha(T,!1,p),Ha(T,!0,p))});var _=p.nodeType===9?p:p.ownerDocument;_===null||_[_E]||(_[_E]=!0,Ha("selectionchange",!1,_))}}function ZC(p,_,T,D){switch(ri(_)){case 1:var V=Me;break;case 4:V=st;break;default:V=qt}T=V.bind(null,_,T,p),V=void 0,!ou||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(V=!0),D?V!==void 0?p.addEventListener(_,T,{capture:!0,passive:V}):p.addEventListener(_,T,!0):V!==void 0?p.addEventListener(_,T,{passive:V}):p.addEventListener(_,T,!1)}function eb(p,_,T,D,V){var $=D;if((_&1)===0&&(_&2)===0&&D!==null)e:for(;;){if(D===null)return;var pe=D.tag;if(pe===3||pe===4){var Oe=D.stateNode.containerInfo;if(Oe===V||Oe.nodeType===8&&Oe.parentNode===V)break;if(pe===4)for(pe=D.return;pe!==null;){var Ve=pe.tag;if((Ve===3||Ve===4)&&(Ve=pe.stateNode.containerInfo,Ve===V||Ve.nodeType===8&&Ve.parentNode===V))return;pe=pe.return}for(;Oe!==null;){if(pe=Fp(Oe),pe===null)return;if(Ve=pe.tag,Ve===5||Ve===6){D=$=pe;continue e}Oe=Oe.parentNode}}D=D.return}Co(function(){var ct=$,Dt=Ai(T),Lt=[];e:{var Nt=XC.get(p);if(Nt!==void 0){var sn=Qf,hn=p;switch(p){case"keypress":if(Fc(T)===0)break e;case"keydown":case"keyup":sn=H;break;case"focusin":hn="focus",sn=em;break;case"focusout":hn="blur",sn=em;break;case"beforeblur":case"afterblur":sn=em;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":sn=fu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":sn=aE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":sn=dt;break;case qC:case YC:case Xg:sn=za;break;case om:sn=ii;break;case"scroll":sn=Gg;break;case"wheel":sn=dr;break;case"copy":case"cut":case"paste":sn=ud;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":sn=Se}var mn=(_&4)!==0,es=!mn&&p==="scroll",Xe=mn?Nt!==null?Nt+"Capture":null:Nt;mn=[];for(var Be=ct,tt;Be!==null;){tt=Be;var jt=tt.stateNode;if(tt.tag===5&&jt!==null&&(tt=jt,Xe!==null&&(jt=Sr(Be,Xe),jt!=null&&mn.push(Zg(Be,jt,tt)))),es)break;Be=Be.return}0<mn.length&&(Nt=new sn(Nt,hn,null,T,Dt),Lt.push({event:Nt,listeners:mn}))}}if((_&7)===0){e:{if(Nt=p==="mouseover"||p==="pointerover",sn=p==="mouseout"||p==="pointerout",Nt&&T!==Hi&&(hn=T.relatedTarget||T.fromElement)&&(Fp(hn)||hn[fd]))break e;if((sn||Nt)&&(Nt=Dt.window===Dt?Dt:(Nt=Dt.ownerDocument)?Nt.defaultView||Nt.parentWindow:window,sn?(hn=T.relatedTarget||T.toElement,sn=ct,hn=hn?Fp(hn):null,hn!==null&&(es=Os(hn),hn!==es||hn.tag!==5&&hn.tag!==6)&&(hn=null)):(sn=null,hn=ct),sn!==hn)){if(mn=fu,jt="onMouseLeave",Xe="onMouseEnter",Be="mouse",(p==="pointerout"||p==="pointerover")&&(mn=Se,jt="onPointerLeave",Xe="onPointerEnter",Be="pointer"),es=sn==null?Nt:um(sn),tt=hn==null?Nt:um(hn),Nt=new mn(jt,Be+"leave",sn,T,Dt),Nt.target=es,Nt.relatedTarget=tt,jt=null,Fp(Dt)===ct&&(mn=new mn(Xe,Be+"enter",hn,T,Dt),mn.target=tt,mn.relatedTarget=es,jt=mn),es=jt,sn&&hn)t:{for(mn=sn,Xe=hn,Be=0,tt=mn;tt;tt=cm(tt))Be++;for(tt=0,jt=Xe;jt;jt=cm(jt))tt++;for(;0<Be-tt;)mn=cm(mn),Be--;for(;0<tt-Be;)Xe=cm(Xe),tt--;for(;Be--;){if(mn===Xe||Xe!==null&&mn===Xe.alternate)break t;mn=cm(mn),Xe=cm(Xe)}mn=null}else mn=null;sn!==null&&eI(Lt,Nt,sn,mn,!1),hn!==null&&es!==null&&eI(Lt,es,hn,mn,!0)}}e:{if(Nt=ct?um(ct):window,sn=Nt.nodeName&&Nt.nodeName.toLowerCase(),sn==="select"||sn==="input"&&Nt.type==="file")var gn=LN;else if(G0(Nt))if(Yg)gn=VN;else{gn=Ga;var In=MN}else(sn=Nt.nodeName)&&sn.toLowerCase()==="input"&&(Nt.type==="checkbox"||Nt.type==="radio")&&(gn=UN);if(gn&&(gn=gn(p,ct))){BC(Lt,gn,T,Dt);break e}In&&In(p,Nt,ct),p==="focusout"&&(In=Nt._wrapperState)&&In.controlled&&Nt.type==="number"&&xe(Nt,"number",Nt.value)}switch(In=ct?um(ct):window,p){case"focusin":(G0(In)||In.contentEditable==="true")&&(bh=In,J0=ct,et=null);break;case"focusout":et=J0=bh=null;break;case"mousedown":Q0=!0;break;case"contextmenu":case"mouseup":case"dragend":Q0=!1,KC(Lt,T,Dt);break;case"selectionchange":if(X0)break;case"keydown":case"keyup":KC(Lt,T,Dt)}var An;if(Ds)e:{switch(p){case"compositionstart":var Mn="onCompositionStart";break e;case"compositionend":Mn="onCompositionEnd";break e;case"compositionupdate":Mn="onCompositionUpdate";break e}Mn=void 0}else nm?jC(p,T)&&(Mn="onCompositionEnd"):p==="keydown"&&T.keyCode===229&&(Mn="onCompositionStart");Mn&&(dd&&T.locale!=="ko"&&(nm||Mn!=="onCompositionStart"?Mn==="onCompositionEnd"&&nm&&(An=Ks()):(Zn=Dt,er="value"in Zn?Zn.value:Zn.textContent,nm=!0)),In=e_(ct,Mn),0<In.length&&(Mn=new Kg(Mn,p,null,T,Dt),Lt.push({event:Mn,listeners:In}),An?Mn.data=An:(An=_c(T),An!==null&&(Mn.data=An)))),(An=Wa?NN(p,T):DN(p,T))&&(ct=e_(ct,"onBeforeInput"),0<ct.length&&(Dt=new Kg("onBeforeInput","beforeinput",null,T,Dt),Lt.push({event:Dt,listeners:ct}),Dt.data=An))}QC(Lt,_)})}function Zg(p,_,T){return{instance:p,listener:_,currentTarget:T}}function e_(p,_){for(var T=_+"Capture",D=[];p!==null;){var V=p,$=V.stateNode;V.tag===5&&$!==null&&(V=$,$=Sr(p,T),$!=null&&D.unshift(Zg(p,$,V)),$=Sr(p,_),$!=null&&D.push(Zg(p,$,V))),p=p.return}return D}function cm(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function eI(p,_,T,D,V){for(var $=_._reactName,pe=[];T!==null&&T!==D;){var Oe=T,Ve=Oe.alternate,ct=Oe.stateNode;if(Ve!==null&&Ve===D)break;Oe.tag===5&&ct!==null&&(Oe=ct,V?(Ve=Sr(T,$),Ve!=null&&pe.unshift(Zg(T,Ve,Oe))):V||(Ve=Sr(T,$),Ve!=null&&pe.push(Zg(T,Ve,Oe)))),T=T.return}pe.length!==0&&p.push({event:_,listeners:pe})}var GN=/\r\n?/g,tb=/\u0000|\uFFFD/g;function tI(p){return(typeof p=="string"?p:""+p).replace(GN,`
`).replace(tb,"")}function t_(p,_,T){if(_=tI(_),tI(p)!==_&&T)throw Error(i(425))}function n_(){}var nb=null,yE=null;function lm(p,_){return p==="textarea"||p==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var rb=typeof setTimeout=="function"?setTimeout:void 0,HN=typeof clearTimeout=="function"?clearTimeout:void 0,nI=typeof Promise=="function"?Promise:void 0,$N=typeof queueMicrotask=="function"?queueMicrotask:typeof nI<"u"?function(p){return nI.resolve(null).then(p).catch(KN)}:rb;function KN(p){setTimeout(function(){throw p})}function EE(p,_){var T=_,D=0;do{var V=T.nextSibling;if(p.removeChild(T),V&&V.nodeType===8)if(T=V.data,T==="/$"){if(D===0){p.removeChild(V),va(_);return}D--}else T!=="$"&&T!=="$?"&&T!=="$!"||D++;T=V}while(T);va(_)}function gu(p){for(;p!=null;p=p.nextSibling){var _=p.nodeType;if(_===1||_===3)break;if(_===8){if(_=p.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return p}function rI(p){p=p.previousSibling;for(var _=0;p;){if(p.nodeType===8){var T=p.data;if(T==="$"||T==="$!"||T==="$?"){if(_===0)return p;_--}else T==="/$"&&_++}p=p.previousSibling}return null}var wh=Math.random().toString(36).slice(2),_u="__reactFiber$"+wh,r_="__reactProps$"+wh,fd="__reactContainer$"+wh,ib="__reactEvents$"+wh,qN="__reactListeners$"+wh,YN="__reactHandles$"+wh;function Fp(p){var _=p[_u];if(_)return _;for(var T=p.parentNode;T;){if(_=T[fd]||T[_u]){if(T=_.alternate,_.child!==null||T!==null&&T.child!==null)for(p=rI(p);p!==null;){if(T=p[_u])return T;p=rI(p)}return _}p=T,T=p.parentNode}return null}function i_(p){return p=p[_u]||p[fd],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function um(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function vE(p){return p[r_]||null}var sb=[],md=-1;function Ol(p){return{current:p}}function Si(p){0>md||(p.current=sb[md],sb[md]=null,md--)}function Ni(p,_){md++,sb[md]=p.current,p.current=_}var Th={},Zo=Ol(Th),ba=Ol(!1),Rh=Th;function Ch(p,_){var T=p.type.contextTypes;if(!T)return Th;var D=p.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===_)return D.__reactInternalMemoizedMaskedChildContext;var V={},$;for($ in T)V[$]=_[$];return D&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=_,p.__reactInternalMemoizedMaskedChildContext=V),V}function $a(p){return p=p.childContextTypes,p!=null}function SE(){Si(ba),Si(Zo)}function dm(p,_,T){if(Zo.current!==Th)throw Error(i(168));Ni(Zo,_),Ni(ba,T)}function iI(p,_,T){var D=p.stateNode;if(_=_.childContextTypes,typeof D.getChildContext!="function")return T;D=D.getChildContext();for(var V in D)if(!(V in _))throw Error(i(108,lt(p)||"Unknown",V));return De({},T,D)}function bE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Th,Rh=Zo.current,Ni(Zo,p),Ni(ba,ba.current),!0}function sI(p,_,T){var D=p.stateNode;if(!D)throw Error(i(169));T?(p=iI(p,_,Rh),D.__reactInternalMemoizedMergedChildContext=p,Si(ba),Si(Zo),Ni(Zo,p)):Si(ba),Ni(ba,T)}var gd=null,wE=!1,ob=!1;function ab(p){gd===null?gd=[p]:gd.push(p)}function XN(p){wE=!0,ab(p)}function Ih(){if(!ob&&gd!==null){ob=!0;var p=0,_=fr;try{var T=gd;for(fr=1;p<T.length;p++){var D=T[p];do D=D(!0);while(D!==null)}gd=null,wE=!1}catch(V){throw gd!==null&&(gd=gd.slice(p+1)),fo(zr,Ih),V}finally{fr=_,ob=!1}}return null}var hm=[],Ah=0,TE=null,RE=0,wa=[],zc=0,jp=null,_d=1,yd="";function Bp(p,_){hm[Ah++]=RE,hm[Ah++]=TE,TE=p,RE=_}function oI(p,_,T){wa[zc++]=_d,wa[zc++]=yd,wa[zc++]=jp,jp=p;var D=_d;p=yd;var V=32-Io(D)-1;D&=~(1<<V),T+=1;var $=32-Io(_)+V;if(30<$){var pe=V-V%5;$=(D&(1<<pe)-1).toString(32),D>>=pe,V-=pe,_d=1<<32-Io(_)+V|T<<V|D,yd=$+p}else _d=1<<$|T<<V|D,yd=p}function pm(p){p.return!==null&&(Bp(p,1),oI(p,1,0))}function CE(p){for(;p===TE;)TE=hm[--Ah],hm[Ah]=null,RE=hm[--Ah],hm[Ah]=null;for(;p===jp;)jp=wa[--zc],wa[zc]=null,yd=wa[--zc],wa[zc]=null,_d=wa[--zc],wa[zc]=null}var yc=null,Ec=null,Mi=!1,kl=null;function aI(p,_){var T=Kc(5,null,null,0);T.elementType="DELETED",T.stateNode=_,T.return=p,_=p.deletions,_===null?(p.deletions=[T],p.flags|=16):_.push(T)}function cI(p,_){switch(p.tag){case 5:var T=p.type;return _=_.nodeType!==1||T.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(p.stateNode=_,yc=p,Ec=gu(_.firstChild),!0):!1;case 6:return _=p.pendingProps===""||_.nodeType!==3?null:_,_!==null?(p.stateNode=_,yc=p,Ec=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(T=jp!==null?{id:_d,overflow:yd}:null,p.memoizedState={dehydrated:_,treeContext:T,retryLane:1073741824},T=Kc(18,null,null,0),T.stateNode=_,T.return=p,p.child=T,yc=p,Ec=null,!0):!1;default:return!1}}function s_(p){return(p.mode&1)!==0&&(p.flags&128)===0}function o_(p){if(Mi){var _=Ec;if(_){var T=_;if(!cI(p,_)){if(s_(p))throw Error(i(418));_=gu(T.nextSibling);var D=yc;_&&cI(p,_)?aI(D,T):(p.flags=p.flags&-4097|2,Mi=!1,yc=p)}}else{if(s_(p))throw Error(i(418));p.flags=p.flags&-4097|2,Mi=!1,yc=p}}}function cb(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;yc=p}function fm(p){if(p!==yc)return!1;if(!Mi)return cb(p),Mi=!0,!1;var _;if((_=p.tag!==3)&&!(_=p.tag!==5)&&(_=p.type,_=_!=="head"&&_!=="body"&&!lm(p.type,p.memoizedProps)),_&&(_=Ec)){if(s_(p))throw lb(),Error(i(418));for(;_;)aI(p,_),_=gu(_.nextSibling)}if(cb(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,_=0;p;){if(p.nodeType===8){var T=p.data;if(T==="/$"){if(_===0){Ec=gu(p.nextSibling);break e}_--}else T!=="$"&&T!=="$!"&&T!=="$?"||_++}p=p.nextSibling}Ec=null}}else Ec=yc?gu(p.stateNode.nextSibling):null;return!0}function lb(){for(var p=Ec;p;)p=gu(p.nextSibling)}function zp(){Ec=yc=null,Mi=!1}function mm(p){kl===null?kl=[p]:kl.push(p)}var a_=ce.ReactCurrentBatchConfig;function c_(p,_,T){if(p=T.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var D=T.stateNode}if(!D)throw Error(i(147,p));var V=D,$=""+p;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===$?_.ref:(_=function(pe){var Oe=V.refs;pe===null?delete Oe[$]:Oe[$]=pe},_._stringRef=$,_)}if(typeof p!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,p))}return p}function IE(p,_){throw p=Object.prototype.toString.call(_),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":p))}function ub(p){var _=p._init;return _(p._payload)}function lI(p){function _(Xe,Be){if(p){var tt=Xe.deletions;tt===null?(Xe.deletions=[Be],Xe.flags|=16):tt.push(Be)}}function T(Xe,Be){if(!p)return null;for(;Be!==null;)_(Xe,Be),Be=Be.sibling;return null}function D(Xe,Be){for(Xe=new Map;Be!==null;)Be.key!==null?Xe.set(Be.key,Be):Xe.set(Be.index,Be),Be=Be.sibling;return Xe}function V(Xe,Be){return Xe=jh(Xe,Be),Xe.index=0,Xe.sibling=null,Xe}function $(Xe,Be,tt){return Xe.index=tt,p?(tt=Xe.alternate,tt!==null?(tt=tt.index,tt<Be?(Xe.flags|=2,Be):tt):(Xe.flags|=2,Be)):(Xe.flags|=1048576,Be)}function pe(Xe){return p&&Xe.alternate===null&&(Xe.flags|=2),Xe}function Oe(Xe,Be,tt,jt){return Be===null||Be.tag!==6?(Be=rv(tt,Xe.mode,jt),Be.return=Xe,Be):(Be=V(Be,tt),Be.return=Xe,Be)}function Ve(Xe,Be,tt,jt){var gn=tt.type;return gn===X?Dt(Xe,Be,tt.props.children,jt,tt.key):Be!==null&&(Be.elementType===gn||typeof gn=="object"&&gn!==null&&gn.$$typeof===Fe&&ub(gn)===Be.type)?(jt=V(Be,tt.props),jt.ref=c_(Xe,Be,tt),jt.return=Xe,jt):(jt=Im(tt.type,tt.key,tt.props,null,Xe.mode,jt),jt.ref=c_(Xe,Be,tt),jt.return=Xe,jt)}function ct(Xe,Be,tt,jt){return Be===null||Be.tag!==4||Be.stateNode.containerInfo!==tt.containerInfo||Be.stateNode.implementation!==tt.implementation?(Be=Am(tt,Xe.mode,jt),Be.return=Xe,Be):(Be=V(Be,tt.children||[]),Be.return=Xe,Be)}function Dt(Xe,Be,tt,jt,gn){return Be===null||Be.tag!==7?(Be=Bh(tt,Xe.mode,jt,gn),Be.return=Xe,Be):(Be=V(Be,tt),Be.return=Xe,Be)}function Lt(Xe,Be,tt){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return Be=rv(""+Be,Xe.mode,tt),Be.return=Xe,Be;if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case oe:return tt=Im(Be.type,Be.key,Be.props,null,Xe.mode,tt),tt.ref=c_(Xe,null,Be),tt.return=Xe,tt;case ge:return Be=Am(Be,Xe.mode,tt),Be.return=Xe,Be;case Fe:var jt=Be._init;return Lt(Xe,jt(Be._payload),tt)}if($e(Be)||Ae(Be))return Be=Bh(Be,Xe.mode,tt,null),Be.return=Xe,Be;IE(Xe,Be)}return null}function Nt(Xe,Be,tt,jt){var gn=Be!==null?Be.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number")return gn!==null?null:Oe(Xe,Be,""+tt,jt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case oe:return tt.key===gn?Ve(Xe,Be,tt,jt):null;case ge:return tt.key===gn?ct(Xe,Be,tt,jt):null;case Fe:return gn=tt._init,Nt(Xe,Be,gn(tt._payload),jt)}if($e(tt)||Ae(tt))return gn!==null?null:Dt(Xe,Be,tt,jt,null);IE(Xe,tt)}return null}function sn(Xe,Be,tt,jt,gn){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return Xe=Xe.get(tt)||null,Oe(Be,Xe,""+jt,gn);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case oe:return Xe=Xe.get(jt.key===null?tt:jt.key)||null,Ve(Be,Xe,jt,gn);case ge:return Xe=Xe.get(jt.key===null?tt:jt.key)||null,ct(Be,Xe,jt,gn);case Fe:var In=jt._init;return sn(Xe,Be,tt,In(jt._payload),gn)}if($e(jt)||Ae(jt))return Xe=Xe.get(tt)||null,Dt(Be,Xe,jt,gn,null);IE(Be,jt)}return null}function hn(Xe,Be,tt,jt){for(var gn=null,In=null,An=Be,Mn=Be=0,Qs=null;An!==null&&Mn<tt.length;Mn++){An.index>Mn?(Qs=An,An=null):Qs=An.sibling;var Yr=Nt(Xe,An,tt[Mn],jt);if(Yr===null){An===null&&(An=Qs);break}p&&An&&Yr.alternate===null&&_(Xe,An),Be=$(Yr,Be,Mn),In===null?gn=Yr:In.sibling=Yr,In=Yr,An=Qs}if(Mn===tt.length)return T(Xe,An),Mi&&Bp(Xe,Mn),gn;if(An===null){for(;Mn<tt.length;Mn++)An=Lt(Xe,tt[Mn],jt),An!==null&&(Be=$(An,Be,Mn),In===null?gn=An:In.sibling=An,In=An);return Mi&&Bp(Xe,Mn),gn}for(An=D(Xe,An);Mn<tt.length;Mn++)Qs=sn(An,Xe,Mn,tt[Mn],jt),Qs!==null&&(p&&Qs.alternate!==null&&An.delete(Qs.key===null?Mn:Qs.key),Be=$(Qs,Be,Mn),In===null?gn=Qs:In.sibling=Qs,In=Qs);return p&&An.forEach(function(wu){return _(Xe,wu)}),Mi&&Bp(Xe,Mn),gn}function mn(Xe,Be,tt,jt){var gn=Ae(tt);if(typeof gn!="function")throw Error(i(150));if(tt=gn.call(tt),tt==null)throw Error(i(151));for(var In=gn=null,An=Be,Mn=Be=0,Qs=null,Yr=tt.next();An!==null&&!Yr.done;Mn++,Yr=tt.next()){An.index>Mn?(Qs=An,An=null):Qs=An.sibling;var wu=Nt(Xe,An,Yr.value,jt);if(wu===null){An===null&&(An=Qs);break}p&&An&&wu.alternate===null&&_(Xe,An),Be=$(wu,Be,Mn),In===null?gn=wu:In.sibling=wu,In=wu,An=Qs}if(Yr.done)return T(Xe,An),Mi&&Bp(Xe,Mn),gn;if(An===null){for(;!Yr.done;Mn++,Yr=tt.next())Yr=Lt(Xe,Yr.value,jt),Yr!==null&&(Be=$(Yr,Be,Mn),In===null?gn=Yr:In.sibling=Yr,In=Yr);return Mi&&Bp(Xe,Mn),gn}for(An=D(Xe,An);!Yr.done;Mn++,Yr=tt.next())Yr=sn(An,Xe,Mn,Yr.value,jt),Yr!==null&&(p&&Yr.alternate!==null&&An.delete(Yr.key===null?Mn:Yr.key),Be=$(Yr,Be,Mn),In===null?gn=Yr:In.sibling=Yr,In=Yr);return p&&An.forEach(function(pD){return _(Xe,pD)}),Mi&&Bp(Xe,Mn),gn}function es(Xe,Be,tt,jt){if(typeof tt=="object"&&tt!==null&&tt.type===X&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case oe:e:{for(var gn=tt.key,In=Be;In!==null;){if(In.key===gn){if(gn=tt.type,gn===X){if(In.tag===7){T(Xe,In.sibling),Be=V(In,tt.props.children),Be.return=Xe,Xe=Be;break e}}else if(In.elementType===gn||typeof gn=="object"&&gn!==null&&gn.$$typeof===Fe&&ub(gn)===In.type){T(Xe,In.sibling),Be=V(In,tt.props),Be.ref=c_(Xe,In,tt),Be.return=Xe,Xe=Be;break e}T(Xe,In);break}else _(Xe,In);In=In.sibling}tt.type===X?(Be=Bh(tt.props.children,Xe.mode,jt,tt.key),Be.return=Xe,Xe=Be):(jt=Im(tt.type,tt.key,tt.props,null,Xe.mode,jt),jt.ref=c_(Xe,Be,tt),jt.return=Xe,Xe=jt)}return pe(Xe);case ge:e:{for(In=tt.key;Be!==null;){if(Be.key===In)if(Be.tag===4&&Be.stateNode.containerInfo===tt.containerInfo&&Be.stateNode.implementation===tt.implementation){T(Xe,Be.sibling),Be=V(Be,tt.children||[]),Be.return=Xe,Xe=Be;break e}else{T(Xe,Be);break}else _(Xe,Be);Be=Be.sibling}Be=Am(tt,Xe.mode,jt),Be.return=Xe,Xe=Be}return pe(Xe);case Fe:return In=tt._init,es(Xe,Be,In(tt._payload),jt)}if($e(tt))return hn(Xe,Be,tt,jt);if(Ae(tt))return mn(Xe,Be,tt,jt);IE(Xe,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"?(tt=""+tt,Be!==null&&Be.tag===6?(T(Xe,Be.sibling),Be=V(Be,tt),Be.return=Xe,Xe=Be):(T(Xe,Be),Be=rv(tt,Xe.mode,jt),Be.return=Xe,Xe=Be),pe(Xe)):T(Xe,Be)}return es}var gm=lI(!0),db=lI(!1),AE=Ol(null),PE=null,_m=null,hb=null;function pb(){hb=_m=PE=null}function fb(p){var _=AE.current;Si(AE),p._currentValue=_}function OE(p,_,T){for(;p!==null;){var D=p.alternate;if((p.childLanes&_)!==_?(p.childLanes|=_,D!==null&&(D.childLanes|=_)):D!==null&&(D.childLanes&_)!==_&&(D.childLanes|=_),p===T)break;p=p.return}}function Nl(p,_){PE=p,hb=_m=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&_)!==0&&(qa=!0),p.firstContext=null)}function Wc(p){var _=p._currentValue;if(hb!==p)if(p={context:p,memoizedValue:_,next:null},_m===null){if(PE===null)throw Error(i(308));_m=p,PE.dependencies={lanes:0,firstContext:p}}else _m=_m.next=p;return _}var Wp=null;function mb(p){Wp===null?Wp=[p]:Wp.push(p)}function gb(p,_,T,D){var V=_.interleaved;return V===null?(T.next=T,mb(_)):(T.next=V.next,V.next=T),_.interleaved=T,Ed(p,D)}function Ed(p,_){p.lanes|=_;var T=p.alternate;for(T!==null&&(T.lanes|=_),T=p,p=p.return;p!==null;)p.childLanes|=_,T=p.alternate,T!==null&&(T.childLanes|=_),T=p,p=p.return;return T.tag===3?T.stateNode:null}var vd=!1;function _b(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uI(p,_){p=p.updateQueue,_.updateQueue===p&&(_.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Sd(p,_){return{eventTime:p,lane:_,tag:0,payload:null,callback:null,next:null}}function Dl(p,_,T){var D=p.updateQueue;if(D===null)return null;if(D=D.shared,(br&2)!==0){var V=D.pending;return V===null?_.next=_:(_.next=V.next,V.next=_),D.pending=_,Ed(p,T)}return V=D.interleaved,V===null?(_.next=_,mb(D)):(_.next=V.next,V.next=_),D.interleaved=_,Ed(p,T)}function kE(p,_,T){if(_=_.updateQueue,_!==null&&(_=_.shared,(T&4194240)!==0)){var D=_.lanes;D&=p.pendingLanes,T|=D,_.lanes=T,lu(p,T)}}function dI(p,_){var T=p.updateQueue,D=p.alternate;if(D!==null&&(D=D.updateQueue,T===D)){var V=null,$=null;if(T=T.firstBaseUpdate,T!==null){do{var pe={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};$===null?V=$=pe:$=$.next=pe,T=T.next}while(T!==null);$===null?V=$=_:$=$.next=_}else V=$=_;T={baseState:D.baseState,firstBaseUpdate:V,lastBaseUpdate:$,shared:D.shared,effects:D.effects},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=_:p.next=_,T.lastBaseUpdate=_}function NE(p,_,T,D){var V=p.updateQueue;vd=!1;var $=V.firstBaseUpdate,pe=V.lastBaseUpdate,Oe=V.shared.pending;if(Oe!==null){V.shared.pending=null;var Ve=Oe,ct=Ve.next;Ve.next=null,pe===null?$=ct:pe.next=ct,pe=Ve;var Dt=p.alternate;Dt!==null&&(Dt=Dt.updateQueue,Oe=Dt.lastBaseUpdate,Oe!==pe&&(Oe===null?Dt.firstBaseUpdate=ct:Oe.next=ct,Dt.lastBaseUpdate=Ve))}if($!==null){var Lt=V.baseState;pe=0,Dt=ct=Ve=null,Oe=$;do{var Nt=Oe.lane,sn=Oe.eventTime;if((D&Nt)===Nt){Dt!==null&&(Dt=Dt.next={eventTime:sn,lane:0,tag:Oe.tag,payload:Oe.payload,callback:Oe.callback,next:null});e:{var hn=p,mn=Oe;switch(Nt=_,sn=T,mn.tag){case 1:if(hn=mn.payload,typeof hn=="function"){Lt=hn.call(sn,Lt,Nt);break e}Lt=hn;break e;case 3:hn.flags=hn.flags&-65537|128;case 0:if(hn=mn.payload,Nt=typeof hn=="function"?hn.call(sn,Lt,Nt):hn,Nt==null)break e;Lt=De({},Lt,Nt);break e;case 2:vd=!0}}Oe.callback!==null&&Oe.lane!==0&&(p.flags|=64,Nt=V.effects,Nt===null?V.effects=[Oe]:Nt.push(Oe))}else sn={eventTime:sn,lane:Nt,tag:Oe.tag,payload:Oe.payload,callback:Oe.callback,next:null},Dt===null?(ct=Dt=sn,Ve=Lt):Dt=Dt.next=sn,pe|=Nt;if(Oe=Oe.next,Oe===null){if(Oe=V.shared.pending,Oe===null)break;Nt=Oe,Oe=Nt.next,Nt.next=null,V.lastBaseUpdate=Nt,V.shared.pending=null}}while(!0);if(Dt===null&&(Ve=Lt),V.baseState=Ve,V.firstBaseUpdate=ct,V.lastBaseUpdate=Dt,_=V.shared.interleaved,_!==null){V=_;do pe|=V.lane,V=V.next;while(V!==_)}else $===null&&(V.shared.lanes=0);Jp|=pe,p.lanes=pe,p.memoizedState=Lt}}function hI(p,_,T){if(p=_.effects,_.effects=null,p!==null)for(_=0;_<p.length;_++){var D=p[_],V=D.callback;if(V!==null){if(D.callback=null,D=T,typeof V!="function")throw Error(i(191,V));V.call(D)}}}var l_={},yu=Ol(l_),Gp=Ol(l_),u_=Ol(l_);function Ph(p){if(p===l_)throw Error(i(174));return p}function yb(p,_){switch(Ni(u_,_),Ni(Gp,p),Ni(yu,l_),p=_.nodeType,p){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:dn(null,"");break;default:p=p===8?_.parentNode:_,_=p.namespaceURI||null,p=p.tagName,_=dn(_,p)}Si(yu),Ni(yu,_)}function Hp(){Si(yu),Si(Gp),Si(u_)}function pI(p){Ph(u_.current);var _=Ph(yu.current),T=dn(_,p.type);_!==T&&(Ni(Gp,p),Ni(yu,T))}function Eb(p){Gp.current===p&&(Si(yu),Si(Gp))}var Qi=Ol(0);function DE(p){for(var _=p;_!==null;){if(_.tag===13){var T=_.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var vb=[];function Sb(){for(var p=0;p<vb.length;p++)vb[p]._workInProgressVersionPrimary=null;vb.length=0}var d_=ce.ReactCurrentDispatcher,bb=ce.ReactCurrentBatchConfig,$p=0,Ki=null,Ys=null,gs=null,h_=!1,bd=!1,p_=0,JN=0;function ea(){throw Error(i(321))}function wb(p,_){if(_===null)return!1;for(var T=0;T<_.length&&T<p.length;T++)if(!Al(p[T],_[T]))return!1;return!0}function ym(p,_,T,D,V,$){if($p=$,Ki=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,d_.current=p===null||p.memoizedState===null?ZN:bI,p=T(D,V),bd){$=0;do{if(bd=!1,p_=0,25<=$)throw Error(i(301));$+=1,gs=Ys=null,_.updateQueue=null,d_.current=eD,p=T(D,V)}while(bd)}if(d_.current=vm,_=Ys!==null&&Ys.next!==null,$p=0,gs=Ys=Ki=null,h_=!1,_)throw Error(i(300));return p}function Tb(){var p=p_!==0;return p_=0,p}function xl(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gs===null?Ki.memoizedState=gs=p:gs=gs.next=p,gs}function Ka(){if(Ys===null){var p=Ki.alternate;p=p!==null?p.memoizedState:null}else p=Ys.next;var _=gs===null?Ki.memoizedState:gs.next;if(_!==null)gs=_,Ys=p;else{if(p===null)throw Error(i(310));Ys=p,p={memoizedState:Ys.memoizedState,baseState:Ys.baseState,baseQueue:Ys.baseQueue,queue:Ys.queue,next:null},gs===null?Ki.memoizedState=gs=p:gs=gs.next=p}return gs}function Kp(p,_){return typeof _=="function"?_(p):_}function Rb(p){var _=Ka(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=p;var D=Ys,V=D.baseQueue,$=T.pending;if($!==null){if(V!==null){var pe=V.next;V.next=$.next,$.next=pe}D.baseQueue=V=$,T.pending=null}if(V!==null){$=V.next,D=D.baseState;var Oe=pe=null,Ve=null,ct=$;do{var Dt=ct.lane;if(($p&Dt)===Dt)Ve!==null&&(Ve=Ve.next={lane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),D=ct.hasEagerState?ct.eagerState:p(D,ct.action);else{var Lt={lane:Dt,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null};Ve===null?(Oe=Ve=Lt,pe=D):Ve=Ve.next=Lt,Ki.lanes|=Dt,Jp|=Dt}ct=ct.next}while(ct!==null&&ct!==$);Ve===null?pe=D:Ve.next=Oe,Al(D,_.memoizedState)||(qa=!0),_.memoizedState=D,_.baseState=pe,_.baseQueue=Ve,T.lastRenderedState=D}if(p=T.interleaved,p!==null){V=p;do $=V.lane,Ki.lanes|=$,Jp|=$,V=V.next;while(V!==p)}else V===null&&(T.lanes=0);return[_.memoizedState,T.dispatch]}function Cb(p){var _=Ka(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=p;var D=T.dispatch,V=T.pending,$=_.memoizedState;if(V!==null){T.pending=null;var pe=V=V.next;do $=p($,pe.action),pe=pe.next;while(pe!==V);Al($,_.memoizedState)||(qa=!0),_.memoizedState=$,_.baseQueue===null&&(_.baseState=$),T.lastRenderedState=$}return[$,D]}function fI(){}function mI(p,_){var T=Ki,D=Ka(),V=_(),$=!Al(D.memoizedState,V);if($&&(D.memoizedState=V,qa=!0),D=D.queue,ME(_I.bind(null,T,D,p),[p]),D.getSnapshot!==_||$||gs!==null&&gs.memoizedState.tag&1){if(T.flags|=2048,wd(9,f_.bind(null,T,D,V,_),void 0,null),Xs===null)throw Error(i(349));($p&30)!==0||gI(T,_,V)}return V}function gI(p,_,T){p.flags|=16384,p={getSnapshot:_,value:T},_=Ki.updateQueue,_===null?(_={lastEffect:null,stores:null},Ki.updateQueue=_,_.stores=[p]):(T=_.stores,T===null?_.stores=[p]:T.push(p))}function f_(p,_,T,D){_.value=T,_.getSnapshot=D,qp(_)&&xE(p)}function _I(p,_,T){return T(function(){qp(_)&&xE(p)})}function qp(p){var _=p.getSnapshot;p=p.value;try{var T=_();return!Al(p,T)}catch{return!0}}function xE(p){var _=Ed(p,1);_!==null&&bc(_,p,1,-1)}function m_(p){var _=xl();return typeof p=="function"&&(p=p()),_.memoizedState=_.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Kp,lastRenderedState:p},_.queue=p,p=p.dispatch=Yp.bind(null,Ki,p),[_.memoizedState,p]}function wd(p,_,T,D){return p={tag:p,create:_,destroy:T,deps:D,next:null},_=Ki.updateQueue,_===null?(_={lastEffect:null,stores:null},Ki.updateQueue=_,_.lastEffect=p.next=p):(T=_.lastEffect,T===null?_.lastEffect=p.next=p:(D=T.next,T.next=p,p.next=D,_.lastEffect=p)),p}function g_(){return Ka().memoizedState}function LE(p,_,T,D){var V=xl();Ki.flags|=p,V.memoizedState=wd(1|_,T,void 0,D===void 0?null:D)}function __(p,_,T,D){var V=Ka();D=D===void 0?null:D;var $=void 0;if(Ys!==null){var pe=Ys.memoizedState;if($=pe.destroy,D!==null&&wb(D,pe.deps)){V.memoizedState=wd(_,T,$,D);return}}Ki.flags|=p,V.memoizedState=wd(1|_,T,$,D)}function yI(p,_){return LE(8390656,8,p,_)}function ME(p,_){return __(2048,8,p,_)}function EI(p,_){return __(4,2,p,_)}function vI(p,_){return __(4,4,p,_)}function UE(p,_){if(typeof _=="function")return p=p(),_(p),function(){_(null)};if(_!=null)return p=p(),_.current=p,function(){_.current=null}}function VE(p,_,T){return T=T!=null?T.concat([p]):null,__(4,4,UE.bind(null,_,p),T)}function Ib(){}function SI(p,_){var T=Ka();_=_===void 0?null:_;var D=T.memoizedState;return D!==null&&_!==null&&wb(_,D[1])?D[0]:(T.memoizedState=[p,_],p)}function Ab(p,_){var T=Ka();_=_===void 0?null:_;var D=T.memoizedState;return D!==null&&_!==null&&wb(_,D[1])?D[0]:(p=p(),T.memoizedState=[p,_],p)}function FE(p,_,T){return($p&21)===0?(p.baseState&&(p.baseState=!1,qa=!0),p.memoizedState=T):(Al(T,_)||(T=cd(),Ki.lanes|=T,Jp|=T,p.baseState=!0),_)}function QN(p,_){var T=fr;fr=T!==0&&4>T?T:4,p(!0);var D=bb.transition;bb.transition={};try{p(!1),_()}finally{fr=T,bb.transition=D}}function Ll(){return Ka().memoizedState}function Em(p,_,T){var D=Mh(p);if(T={lane:D,action:T,hasEagerState:!1,eagerState:null,next:null},Pb(p))Ob(_,T);else if(T=gb(p,_,T,D),T!==null){var V=Ra();bc(T,p,D,V),Oh(T,_,D)}}function Yp(p,_,T){var D=Mh(p),V={lane:D,action:T,hasEagerState:!1,eagerState:null,next:null};if(Pb(p))Ob(_,V);else{var $=p.alternate;if(p.lanes===0&&($===null||$.lanes===0)&&($=_.lastRenderedReducer,$!==null))try{var pe=_.lastRenderedState,Oe=$(pe,T);if(V.hasEagerState=!0,V.eagerState=Oe,Al(Oe,pe)){var Ve=_.interleaved;Ve===null?(V.next=V,mb(_)):(V.next=Ve.next,Ve.next=V),_.interleaved=V;return}}catch{}finally{}T=gb(p,_,V,D),T!==null&&(V=Ra(),bc(T,p,D,V),Oh(T,_,D))}}function Pb(p){var _=p.alternate;return p===Ki||_!==null&&_===Ki}function Ob(p,_){bd=h_=!0;var T=p.pending;T===null?_.next=_:(_.next=T.next,T.next=_),p.pending=_}function Oh(p,_,T){if((T&4194240)!==0){var D=_.lanes;D&=p.pendingLanes,T|=D,_.lanes=T,lu(p,T)}}var vm={readContext:Wc,useCallback:ea,useContext:ea,useEffect:ea,useImperativeHandle:ea,useInsertionEffect:ea,useLayoutEffect:ea,useMemo:ea,useReducer:ea,useRef:ea,useState:ea,useDebugValue:ea,useDeferredValue:ea,useTransition:ea,useMutableSource:ea,useSyncExternalStore:ea,useId:ea,unstable_isNewReconciler:!1},ZN={readContext:Wc,useCallback:function(p,_){return xl().memoizedState=[p,_===void 0?null:_],p},useContext:Wc,useEffect:yI,useImperativeHandle:function(p,_,T){return T=T!=null?T.concat([p]):null,LE(4194308,4,UE.bind(null,_,p),T)},useLayoutEffect:function(p,_){return LE(4194308,4,p,_)},useInsertionEffect:function(p,_){return LE(4,2,p,_)},useMemo:function(p,_){var T=xl();return _=_===void 0?null:_,p=p(),T.memoizedState=[p,_],p},useReducer:function(p,_,T){var D=xl();return _=T!==void 0?T(_):_,D.memoizedState=D.baseState=_,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:_},D.queue=p,p=p.dispatch=Em.bind(null,Ki,p),[D.memoizedState,p]},useRef:function(p){var _=xl();return p={current:p},_.memoizedState=p},useState:m_,useDebugValue:Ib,useDeferredValue:function(p){return xl().memoizedState=p},useTransition:function(){var p=m_(!1),_=p[0];return p=QN.bind(null,p[1]),xl().memoizedState=p,[_,p]},useMutableSource:function(){},useSyncExternalStore:function(p,_,T){var D=Ki,V=xl();if(Mi){if(T===void 0)throw Error(i(407));T=T()}else{if(T=_(),Xs===null)throw Error(i(349));($p&30)!==0||gI(D,_,T)}V.memoizedState=T;var $={value:T,getSnapshot:_};return V.queue=$,yI(_I.bind(null,D,$,p),[p]),D.flags|=2048,wd(9,f_.bind(null,D,$,T,_),void 0,null),T},useId:function(){var p=xl(),_=Xs.identifierPrefix;if(Mi){var T=yd,D=_d;T=(D&~(1<<32-Io(D)-1)).toString(32)+T,_=":"+_+"R"+T,T=p_++,0<T&&(_+="H"+T.toString(32)),_+=":"}else T=JN++,_=":"+_+"r"+T.toString(32)+":";return p.memoizedState=_},unstable_isNewReconciler:!1},bI={readContext:Wc,useCallback:SI,useContext:Wc,useEffect:ME,useImperativeHandle:VE,useInsertionEffect:EI,useLayoutEffect:vI,useMemo:Ab,useReducer:Rb,useRef:g_,useState:function(){return Rb(Kp)},useDebugValue:Ib,useDeferredValue:function(p){var _=Ka();return FE(_,Ys.memoizedState,p)},useTransition:function(){var p=Rb(Kp)[0],_=Ka().memoizedState;return[p,_]},useMutableSource:fI,useSyncExternalStore:mI,useId:Ll,unstable_isNewReconciler:!1},eD={readContext:Wc,useCallback:SI,useContext:Wc,useEffect:ME,useImperativeHandle:VE,useInsertionEffect:EI,useLayoutEffect:vI,useMemo:Ab,useReducer:Cb,useRef:g_,useState:function(){return Cb(Kp)},useDebugValue:Ib,useDeferredValue:function(p){var _=Ka();return Ys===null?_.memoizedState=p:FE(_,Ys.memoizedState,p)},useTransition:function(){var p=Cb(Kp)[0],_=Ka().memoizedState;return[p,_]},useMutableSource:fI,useSyncExternalStore:mI,useId:Ll,unstable_isNewReconciler:!1};function Gc(p,_){if(p&&p.defaultProps){_=De({},_),p=p.defaultProps;for(var T in p)_[T]===void 0&&(_[T]=p[T]);return _}return _}function jE(p,_,T,D){_=p.memoizedState,T=T(D,_),T=T==null?_:De({},_,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}var BE={isMounted:function(p){return(p=p._reactInternals)?Os(p)===p:!1},enqueueSetState:function(p,_,T){p=p._reactInternals;var D=Ra(),V=Mh(p),$=Sd(D,V);$.payload=_,T!=null&&($.callback=T),_=Dl(p,$,V),_!==null&&(bc(_,p,V,D),kE(_,p,V))},enqueueReplaceState:function(p,_,T){p=p._reactInternals;var D=Ra(),V=Mh(p),$=Sd(D,V);$.tag=1,$.payload=_,T!=null&&($.callback=T),_=Dl(p,$,V),_!==null&&(bc(_,p,V,D),kE(_,p,V))},enqueueForceUpdate:function(p,_){p=p._reactInternals;var T=Ra(),D=Mh(p),V=Sd(T,D);V.tag=2,_!=null&&(V.callback=_),_=Dl(p,V,D),_!==null&&(bc(_,p,D,T),kE(_,p,D))}};function Td(p,_,T,D,V,$,pe){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(D,$,pe):_.prototype&&_.prototype.isPureReactComponent?!im(T,D)||!im(V,$):!0}function wI(p,_,T){var D=!1,V=Th,$=_.contextType;return typeof $=="object"&&$!==null?$=Wc($):(V=$a(_)?Rh:Zo.current,D=_.contextTypes,$=(D=D!=null)?Ch(p,V):Th),_=new _(T,$),p.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=BE,p.stateNode=_,_._reactInternals=p,D&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=V,p.__reactInternalMemoizedMaskedChildContext=$),_}function TI(p,_,T,D){p=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(T,D),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(T,D),_.state!==p&&BE.enqueueReplaceState(_,_.state,null)}function kb(p,_,T,D){var V=p.stateNode;V.props=T,V.state=p.memoizedState,V.refs={},_b(p);var $=_.contextType;typeof $=="object"&&$!==null?V.context=Wc($):($=$a(_)?Rh:Zo.current,V.context=Ch(p,$)),V.state=p.memoizedState,$=_.getDerivedStateFromProps,typeof $=="function"&&(jE(p,_,$,T),V.state=p.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(_=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),_!==V.state&&BE.enqueueReplaceState(V,V.state,null),NE(p,T,V,D),V.state=p.memoizedState),typeof V.componentDidMount=="function"&&(p.flags|=4194308)}function Sm(p,_){try{var T="",D=_;do T+=ot(D),D=D.return;while(D);var V=T}catch($){V=`
Error generating stack: `+$.message+`
`+$.stack}return{value:p,source:_,stack:V,digest:null}}function zE(p,_,T){return{value:p,source:null,stack:T??null,digest:_??null}}function Nb(p,_){try{console.error(_.value)}catch(T){setTimeout(function(){throw T})}}var Db=typeof WeakMap=="function"?WeakMap:Map;function xb(p,_,T){T=Sd(-1,T),T.tag=3,T.payload={element:null};var D=_.value;return T.callback=function(){na||(na=!0,Zb=D),Nb(p,_)},T}function RI(p,_,T){T=Sd(-1,T),T.tag=3;var D=p.type.getDerivedStateFromError;if(typeof D=="function"){var V=_.value;T.payload=function(){return D(V)},T.callback=function(){Nb(p,_)}}var $=p.stateNode;return $!==null&&typeof $.componentDidCatch=="function"&&(T.callback=function(){Nb(p,_),typeof D!="function"&&(xh===null?xh=new Set([this]):xh.add(this));var pe=_.stack;this.componentDidCatch(_.value,{componentStack:pe!==null?pe:""})}),T}function Lb(p,_,T){var D=p.pingCache;if(D===null){D=p.pingCache=new Db;var V=new Set;D.set(_,V)}else V=D.get(_),V===void 0&&(V=new Set,D.set(_,V));V.has(T)||(V.add(T),p=WI.bind(null,p,_,T),_.then(p,p))}function CI(p){do{var _;if((_=p.tag===13)&&(_=p.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return p;p=p.return}while(p!==null);return null}function II(p,_,T,D,V){return(p.mode&1)===0?(p===_?p.flags|=65536:(p.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(_=Sd(-1,1),_.tag=2,Dl(T,_,1))),T.lanes|=1),p):(p.flags|=65536,p.lanes=V,p)}var tD=ce.ReactCurrentOwner,qa=!1;function Ta(p,_,T,D){_.child=p===null?db(_,null,T,D):gm(_,p.child,T,D)}function AI(p,_,T,D,V){T=T.render;var $=_.ref;return Nl(_,V),D=ym(p,_,T,D,$,V),T=Tb(),p!==null&&!qa?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~V,Rd(p,_,V)):(Mi&&T&&pm(_),_.flags|=1,Ta(p,_,D,V),_.child)}function PI(p,_,T,D,V){if(p===null){var $=T.type;return typeof $=="function"&&!lw($)&&$.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(_.tag=15,_.type=$,Mb(p,_,$,D,V)):(p=Im(T.type,null,D,_,_.mode,V),p.ref=_.ref,p.return=_,_.child=p)}if($=p.child,(p.lanes&V)===0){var pe=$.memoizedProps;if(T=T.compare,T=T!==null?T:im,T(pe,D)&&p.ref===_.ref)return Rd(p,_,V)}return _.flags|=1,p=jh($,D),p.ref=_.ref,p.return=_,_.child=p}function Mb(p,_,T,D,V){if(p!==null){var $=p.memoizedProps;if(im($,D)&&p.ref===_.ref)if(qa=!1,_.pendingProps=D=$,(p.lanes&V)!==0)(p.flags&131072)!==0&&(qa=!0);else return _.lanes=p.lanes,Rd(p,_,V)}return Ub(p,_,T,D,V)}function Eu(p,_,T){var D=_.pendingProps,V=D.children,$=p!==null?p.memoizedState:null;if(D.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ni(bm,Sc),Sc|=T;else{if((T&1073741824)===0)return p=$!==null?$.baseLanes|T:T,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:p,cachePool:null,transitions:null},_.updateQueue=null,Ni(bm,Sc),Sc|=p,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=$!==null?$.baseLanes:T,Ni(bm,Sc),Sc|=D}else $!==null?(D=$.baseLanes|T,_.memoizedState=null):D=T,Ni(bm,Sc),Sc|=D;return Ta(p,_,V,T),_.child}function OI(p,_){var T=_.ref;(p===null&&T!==null||p!==null&&p.ref!==T)&&(_.flags|=512,_.flags|=2097152)}function Ub(p,_,T,D,V){var $=$a(T)?Rh:Zo.current;return $=Ch(_,$),Nl(_,V),T=ym(p,_,T,D,$,V),D=Tb(),p!==null&&!qa?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~V,Rd(p,_,V)):(Mi&&D&&pm(_),_.flags|=1,Ta(p,_,T,V),_.child)}function kI(p,_,T,D,V){if($a(T)){var $=!0;bE(_)}else $=!1;if(Nl(_,V),_.stateNode===null)HE(p,_),wI(_,T,D),kb(_,T,D,V),D=!0;else if(p===null){var pe=_.stateNode,Oe=_.memoizedProps;pe.props=Oe;var Ve=pe.context,ct=T.contextType;typeof ct=="object"&&ct!==null?ct=Wc(ct):(ct=$a(T)?Rh:Zo.current,ct=Ch(_,ct));var Dt=T.getDerivedStateFromProps,Lt=typeof Dt=="function"||typeof pe.getSnapshotBeforeUpdate=="function";Lt||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(Oe!==D||Ve!==ct)&&TI(_,pe,D,ct),vd=!1;var Nt=_.memoizedState;pe.state=Nt,NE(_,D,pe,V),Ve=_.memoizedState,Oe!==D||Nt!==Ve||ba.current||vd?(typeof Dt=="function"&&(jE(_,T,Dt,D),Ve=_.memoizedState),(Oe=vd||Td(_,T,Oe,D,Nt,Ve,ct))?(Lt||typeof pe.UNSAFE_componentWillMount!="function"&&typeof pe.componentWillMount!="function"||(typeof pe.componentWillMount=="function"&&pe.componentWillMount(),typeof pe.UNSAFE_componentWillMount=="function"&&pe.UNSAFE_componentWillMount()),typeof pe.componentDidMount=="function"&&(_.flags|=4194308)):(typeof pe.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=D,_.memoizedState=Ve),pe.props=D,pe.state=Ve,pe.context=ct,D=Oe):(typeof pe.componentDidMount=="function"&&(_.flags|=4194308),D=!1)}else{pe=_.stateNode,uI(p,_),Oe=_.memoizedProps,ct=_.type===_.elementType?Oe:Gc(_.type,Oe),pe.props=ct,Lt=_.pendingProps,Nt=pe.context,Ve=T.contextType,typeof Ve=="object"&&Ve!==null?Ve=Wc(Ve):(Ve=$a(T)?Rh:Zo.current,Ve=Ch(_,Ve));var sn=T.getDerivedStateFromProps;(Dt=typeof sn=="function"||typeof pe.getSnapshotBeforeUpdate=="function")||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(Oe!==Lt||Nt!==Ve)&&TI(_,pe,D,Ve),vd=!1,Nt=_.memoizedState,pe.state=Nt,NE(_,D,pe,V);var hn=_.memoizedState;Oe!==Lt||Nt!==hn||ba.current||vd?(typeof sn=="function"&&(jE(_,T,sn,D),hn=_.memoizedState),(ct=vd||Td(_,T,ct,D,Nt,hn,Ve)||!1)?(Dt||typeof pe.UNSAFE_componentWillUpdate!="function"&&typeof pe.componentWillUpdate!="function"||(typeof pe.componentWillUpdate=="function"&&pe.componentWillUpdate(D,hn,Ve),typeof pe.UNSAFE_componentWillUpdate=="function"&&pe.UNSAFE_componentWillUpdate(D,hn,Ve)),typeof pe.componentDidUpdate=="function"&&(_.flags|=4),typeof pe.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof pe.componentDidUpdate!="function"||Oe===p.memoizedProps&&Nt===p.memoizedState||(_.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||Oe===p.memoizedProps&&Nt===p.memoizedState||(_.flags|=1024),_.memoizedProps=D,_.memoizedState=hn),pe.props=D,pe.state=hn,pe.context=Ve,D=ct):(typeof pe.componentDidUpdate!="function"||Oe===p.memoizedProps&&Nt===p.memoizedState||(_.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||Oe===p.memoizedProps&&Nt===p.memoizedState||(_.flags|=1024),D=!1)}return Vb(p,_,T,D,$,V)}function Vb(p,_,T,D,V,$){OI(p,_);var pe=(_.flags&128)!==0;if(!D&&!pe)return V&&sI(_,T,!1),Rd(p,_,$);D=_.stateNode,tD.current=_;var Oe=pe&&typeof T.getDerivedStateFromError!="function"?null:D.render();return _.flags|=1,p!==null&&pe?(_.child=gm(_,p.child,null,$),_.child=gm(_,null,Oe,$)):Ta(p,_,Oe,$),_.memoizedState=D.state,V&&sI(_,T,!0),_.child}function NI(p){var _=p.stateNode;_.pendingContext?dm(p,_.pendingContext,_.pendingContext!==_.context):_.context&&dm(p,_.context,!1),yb(p,_.containerInfo)}function DI(p,_,T,D,V){return zp(),mm(V),_.flags|=256,Ta(p,_,T,D),_.child}var y_={dehydrated:null,treeContext:null,retryLane:0};function Fb(p){return{baseLanes:p,cachePool:null,transitions:null}}function xI(p,_,T){var D=_.pendingProps,V=Qi.current,$=!1,pe=(_.flags&128)!==0,Oe;if((Oe=pe)||(Oe=p!==null&&p.memoizedState===null?!1:(V&2)!==0),Oe?($=!0,_.flags&=-129):(p===null||p.memoizedState!==null)&&(V|=1),Ni(Qi,V&1),p===null)return o_(_),p=_.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((_.mode&1)===0?_.lanes=1:p.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(pe=D.children,p=D.fallback,$?(D=_.mode,$=_.child,pe={mode:"hidden",children:pe},(D&1)===0&&$!==null?($.childLanes=0,$.pendingProps=pe):$=P_(pe,D,0,null),p=Bh(p,D,T,null),$.return=_,p.return=_,$.sibling=p,_.child=$,_.child.memoizedState=Fb(T),_.memoizedState=y_,p):jb(_,pe));if(V=p.memoizedState,V!==null&&(Oe=V.dehydrated,Oe!==null))return nD(p,_,pe,D,Oe,V,T);if($){$=D.fallback,pe=_.mode,V=p.child,Oe=V.sibling;var Ve={mode:"hidden",children:D.children};return(pe&1)===0&&_.child!==V?(D=_.child,D.childLanes=0,D.pendingProps=Ve,_.deletions=null):(D=jh(V,Ve),D.subtreeFlags=V.subtreeFlags&14680064),Oe!==null?$=jh(Oe,$):($=Bh($,pe,T,null),$.flags|=2),$.return=_,D.return=_,D.sibling=$,_.child=D,D=$,$=_.child,pe=p.child.memoizedState,pe=pe===null?Fb(T):{baseLanes:pe.baseLanes|T,cachePool:null,transitions:pe.transitions},$.memoizedState=pe,$.childLanes=p.childLanes&~T,_.memoizedState=y_,D}return $=p.child,p=$.sibling,D=jh($,{mode:"visible",children:D.children}),(_.mode&1)===0&&(D.lanes=T),D.return=_,D.sibling=null,p!==null&&(T=_.deletions,T===null?(_.deletions=[p],_.flags|=16):T.push(p)),_.child=D,_.memoizedState=null,D}function jb(p,_){return _=P_({mode:"visible",children:_},p.mode,0,null),_.return=p,p.child=_}function WE(p,_,T,D){return D!==null&&mm(D),gm(_,p.child,null,T),p=jb(_,_.pendingProps.children),p.flags|=2,_.memoizedState=null,p}function nD(p,_,T,D,V,$,pe){if(T)return _.flags&256?(_.flags&=-257,D=zE(Error(i(422))),WE(p,_,pe,D)):_.memoizedState!==null?(_.child=p.child,_.flags|=128,null):($=D.fallback,V=_.mode,D=P_({mode:"visible",children:D.children},V,0,null),$=Bh($,V,pe,null),$.flags|=2,D.return=_,$.return=_,D.sibling=$,_.child=D,(_.mode&1)!==0&&gm(_,p.child,null,pe),_.child.memoizedState=Fb(pe),_.memoizedState=y_,$);if((_.mode&1)===0)return WE(p,_,pe,null);if(V.data==="$!"){if(D=V.nextSibling&&V.nextSibling.dataset,D)var Oe=D.dgst;return D=Oe,$=Error(i(419)),D=zE($,D,void 0),WE(p,_,pe,D)}if(Oe=(pe&p.childLanes)!==0,qa||Oe){if(D=Xs,D!==null){switch(pe&-pe){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(D.suspendedLanes|pe))!==0?0:V,V!==0&&V!==$.retryLane&&($.retryLane=V,Ed(p,V),bc(D,p,V,-1))}return Rm(),D=zE(Error(i(421))),WE(p,_,pe,D)}return V.data==="$?"?(_.flags|=128,_.child=p.child,_=uD.bind(null,p),V._reactRetry=_,null):(p=$.treeContext,Ec=gu(V.nextSibling),yc=_,Mi=!0,kl=null,p!==null&&(wa[zc++]=_d,wa[zc++]=yd,wa[zc++]=jp,_d=p.id,yd=p.overflow,jp=_),_=jb(_,D.children),_.flags|=4096,_)}function LI(p,_,T){p.lanes|=_;var D=p.alternate;D!==null&&(D.lanes|=_),OE(p.return,_,T)}function GE(p,_,T,D,V){var $=p.memoizedState;$===null?p.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:D,tail:T,tailMode:V}:($.isBackwards=_,$.rendering=null,$.renderingStartTime=0,$.last=D,$.tail=T,$.tailMode=V)}function Bb(p,_,T){var D=_.pendingProps,V=D.revealOrder,$=D.tail;if(Ta(p,_,D.children,T),D=Qi.current,(D&2)!==0)D=D&1|2,_.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=_.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&LI(p,T,_);else if(p.tag===19)LI(p,T,_);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===_)break e;for(;p.sibling===null;){if(p.return===null||p.return===_)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}D&=1}if(Ni(Qi,D),(_.mode&1)===0)_.memoizedState=null;else switch(V){case"forwards":for(T=_.child,V=null;T!==null;)p=T.alternate,p!==null&&DE(p)===null&&(V=T),T=T.sibling;T=V,T===null?(V=_.child,_.child=null):(V=T.sibling,T.sibling=null),GE(_,!1,V,T,$);break;case"backwards":for(T=null,V=_.child,_.child=null;V!==null;){if(p=V.alternate,p!==null&&DE(p)===null){_.child=V;break}p=V.sibling,V.sibling=T,T=V,V=p}GE(_,!0,T,null,$);break;case"together":GE(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function HE(p,_){(_.mode&1)===0&&p!==null&&(p.alternate=null,_.alternate=null,_.flags|=2)}function Rd(p,_,T){if(p!==null&&(_.dependencies=p.dependencies),Jp|=_.lanes,(T&_.childLanes)===0)return null;if(p!==null&&_.child!==p.child)throw Error(i(153));if(_.child!==null){for(p=_.child,T=jh(p,p.pendingProps),_.child=T,T.return=_;p.sibling!==null;)p=p.sibling,T=T.sibling=jh(p,p.pendingProps),T.return=_;T.sibling=null}return _.child}function $E(p,_,T){switch(_.tag){case 3:NI(_),zp();break;case 5:pI(_);break;case 1:$a(_.type)&&bE(_);break;case 4:yb(_,_.stateNode.containerInfo);break;case 10:var D=_.type._context,V=_.memoizedProps.value;Ni(AE,D._currentValue),D._currentValue=V;break;case 13:if(D=_.memoizedState,D!==null)return D.dehydrated!==null?(Ni(Qi,Qi.current&1),_.flags|=128,null):(T&_.child.childLanes)!==0?xI(p,_,T):(Ni(Qi,Qi.current&1),p=Rd(p,_,T),p!==null?p.sibling:null);Ni(Qi,Qi.current&1);break;case 19:if(D=(T&_.childLanes)!==0,(p.flags&128)!==0){if(D)return Bb(p,_,T);_.flags|=128}if(V=_.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),Ni(Qi,Qi.current),D)break;return null;case 22:case 23:return _.lanes=0,Eu(p,_,T)}return Rd(p,_,T)}var KE,qE,E_,zb;KE=function(p,_){for(var T=_.child;T!==null;){if(T.tag===5||T.tag===6)p.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===_)break;for(;T.sibling===null;){if(T.return===null||T.return===_)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},qE=function(){},E_=function(p,_,T,D){var V=p.memoizedProps;if(V!==D){p=_.stateNode,Ph(yu.current);var $=null;switch(T){case"input":V=at(p,V),D=at(p,D),$=[];break;case"select":V=De({},V,{value:void 0}),D=De({},D,{value:void 0}),$=[];break;case"textarea":V=It(p,V),D=It(p,D),$=[];break;default:typeof V.onClick!="function"&&typeof D.onClick=="function"&&(p.onclick=n_)}ps(T,D);var pe;T=null;for(ct in V)if(!D.hasOwnProperty(ct)&&V.hasOwnProperty(ct)&&V[ct]!=null)if(ct==="style"){var Oe=V[ct];for(pe in Oe)Oe.hasOwnProperty(pe)&&(T||(T={}),T[pe]="")}else ct!=="dangerouslySetInnerHTML"&&ct!=="children"&&ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&ct!=="autoFocus"&&(l.hasOwnProperty(ct)?$||($=[]):($=$||[]).push(ct,null));for(ct in D){var Ve=D[ct];if(Oe=V!=null?V[ct]:void 0,D.hasOwnProperty(ct)&&Ve!==Oe&&(Ve!=null||Oe!=null))if(ct==="style")if(Oe){for(pe in Oe)!Oe.hasOwnProperty(pe)||Ve&&Ve.hasOwnProperty(pe)||(T||(T={}),T[pe]="");for(pe in Ve)Ve.hasOwnProperty(pe)&&Oe[pe]!==Ve[pe]&&(T||(T={}),T[pe]=Ve[pe])}else T||($||($=[]),$.push(ct,T)),T=Ve;else ct==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Oe=Oe?Oe.__html:void 0,Ve!=null&&Oe!==Ve&&($=$||[]).push(ct,Ve)):ct==="children"?typeof Ve!="string"&&typeof Ve!="number"||($=$||[]).push(ct,""+Ve):ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&(l.hasOwnProperty(ct)?(Ve!=null&&ct==="onScroll"&&ki("scroll",p),$||Oe===Ve||($=[])):($=$||[]).push(ct,Ve))}T&&($=$||[]).push("style",T);var ct=$;(_.updateQueue=ct)&&(_.flags|=4)}},zb=function(p,_,T,D){T!==D&&(_.flags|=4)};function v_(p,_){if(!Mi)switch(p.tailMode){case"hidden":_=p.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var D=null;T!==null;)T.alternate!==null&&(D=T),T=T.sibling;D===null?_||p.tail===null?p.tail=null:p.tail.sibling=null:D.sibling=null}}function Po(p){var _=p.alternate!==null&&p.alternate.child===p.child,T=0,D=0;if(_)for(var V=p.child;V!==null;)T|=V.lanes|V.childLanes,D|=V.subtreeFlags&14680064,D|=V.flags&14680064,V.return=p,V=V.sibling;else for(V=p.child;V!==null;)T|=V.lanes|V.childLanes,D|=V.subtreeFlags,D|=V.flags,V.return=p,V=V.sibling;return p.subtreeFlags|=D,p.childLanes=T,_}function YE(p,_,T){var D=_.pendingProps;switch(CE(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Po(_),null;case 1:return $a(_.type)&&SE(),Po(_),null;case 3:return D=_.stateNode,Hp(),Si(ba),Si(Zo),Sb(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(p===null||p.child===null)&&(fm(_)?_.flags|=4:p===null||p.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,kl!==null&&(tw(kl),kl=null))),qE(p,_),Po(_),null;case 5:Eb(_);var V=Ph(u_.current);if(T=_.type,p!==null&&_.stateNode!=null)E_(p,_,T,D,V),p.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!D){if(_.stateNode===null)throw Error(i(166));return Po(_),null}if(p=Ph(yu.current),fm(_)){D=_.stateNode,T=_.type;var $=_.memoizedProps;switch(D[_u]=_,D[r_]=$,p=(_.mode&1)!==0,T){case"dialog":ki("cancel",D),ki("close",D);break;case"iframe":case"object":case"embed":ki("load",D);break;case"video":case"audio":for(V=0;V<Qg.length;V++)ki(Qg[V],D);break;case"source":ki("error",D);break;case"img":case"image":case"link":ki("error",D),ki("load",D);break;case"details":ki("toggle",D);break;case"input":Vt(D,$),ki("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!$.multiple},ki("invalid",D);break;case"textarea":wt(D,$),ki("invalid",D)}ps(T,$),V=null;for(var pe in $)if($.hasOwnProperty(pe)){var Oe=$[pe];pe==="children"?typeof Oe=="string"?D.textContent!==Oe&&($.suppressHydrationWarning!==!0&&t_(D.textContent,Oe,p),V=["children",Oe]):typeof Oe=="number"&&D.textContent!==""+Oe&&($.suppressHydrationWarning!==!0&&t_(D.textContent,Oe,p),V=["children",""+Oe]):l.hasOwnProperty(pe)&&Oe!=null&&pe==="onScroll"&&ki("scroll",D)}switch(T){case"input":$t(D),we(D,$,!0);break;case"textarea":$t(D),vn(D);break;case"select":case"option":break;default:typeof $.onClick=="function"&&(D.onclick=n_)}D=V,_.updateQueue=D,D!==null&&(_.flags|=4)}else{pe=V.nodeType===9?V:V.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Cn(T)),p==="http://www.w3.org/1999/xhtml"?T==="script"?(p=pe.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof D.is=="string"?p=pe.createElement(T,{is:D.is}):(p=pe.createElement(T),T==="select"&&(pe=p,D.multiple?pe.multiple=!0:D.size&&(pe.size=D.size))):p=pe.createElementNS(p,T),p[_u]=_,p[r_]=D,KE(p,_,!1,!1),_.stateNode=p;e:{switch(pe=qo(T,D),T){case"dialog":ki("cancel",p),ki("close",p),V=D;break;case"iframe":case"object":case"embed":ki("load",p),V=D;break;case"video":case"audio":for(V=0;V<Qg.length;V++)ki(Qg[V],p);V=D;break;case"source":ki("error",p),V=D;break;case"img":case"image":case"link":ki("error",p),ki("load",p),V=D;break;case"details":ki("toggle",p),V=D;break;case"input":Vt(p,D),V=at(p,D),ki("invalid",p);break;case"option":V=D;break;case"select":p._wrapperState={wasMultiple:!!D.multiple},V=De({},D,{value:void 0}),ki("invalid",p);break;case"textarea":wt(p,D),V=It(p,D),ki("invalid",p);break;default:V=D}ps(T,V),Oe=V;for($ in Oe)if(Oe.hasOwnProperty($)){var Ve=Oe[$];$==="style"?ai(p,Ve):$==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Ve!=null&&Qn(p,Ve)):$==="children"?typeof Ve=="string"?(T!=="textarea"||Ve!=="")&&xt(p,Ve):typeof Ve=="number"&&xt(p,""+Ve):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(l.hasOwnProperty($)?Ve!=null&&$==="onScroll"&&ki("scroll",p):Ve!=null&&ne(p,$,Ve,pe))}switch(T){case"input":$t(p),we(p,D,!1);break;case"textarea":$t(p),vn(p);break;case"option":D.value!=null&&p.setAttribute("value",""+vt(D.value));break;case"select":p.multiple=!!D.multiple,$=D.value,$!=null?Pt(p,!!D.multiple,$,!1):D.defaultValue!=null&&Pt(p,!!D.multiple,D.defaultValue,!0);break;default:typeof V.onClick=="function"&&(p.onclick=n_)}switch(T){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return Po(_),null;case 6:if(p&&_.stateNode!=null)zb(p,_,p.memoizedProps,D);else{if(typeof D!="string"&&_.stateNode===null)throw Error(i(166));if(T=Ph(u_.current),Ph(yu.current),fm(_)){if(D=_.stateNode,T=_.memoizedProps,D[_u]=_,($=D.nodeValue!==T)&&(p=yc,p!==null))switch(p.tag){case 3:t_(D.nodeValue,T,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&t_(D.nodeValue,T,(p.mode&1)!==0)}$&&(_.flags|=4)}else D=(T.nodeType===9?T:T.ownerDocument).createTextNode(D),D[_u]=_,_.stateNode=D}return Po(_),null;case 13:if(Si(Qi),D=_.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(Mi&&Ec!==null&&(_.mode&1)!==0&&(_.flags&128)===0)lb(),zp(),_.flags|=98560,$=!1;else if($=fm(_),D!==null&&D.dehydrated!==null){if(p===null){if(!$)throw Error(i(318));if($=_.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(i(317));$[_u]=_}else zp(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;Po(_),$=!1}else kl!==null&&(tw(kl),kl=null),$=!0;if(!$)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=T,_):(D=D!==null,D!==(p!==null&&p.memoizedState!==null)&&D&&(_.child.flags|=8192,(_.mode&1)!==0&&(p===null||(Qi.current&1)!==0?Js===0&&(Js=3):Rm())),_.updateQueue!==null&&(_.flags|=4),Po(_),null);case 4:return Hp(),qE(p,_),p===null&&pd(_.stateNode.containerInfo),Po(_),null;case 10:return fb(_.type._context),Po(_),null;case 17:return $a(_.type)&&SE(),Po(_),null;case 19:if(Si(Qi),$=_.memoizedState,$===null)return Po(_),null;if(D=(_.flags&128)!==0,pe=$.rendering,pe===null)if(D)v_($,!1);else{if(Js!==0||p!==null&&(p.flags&128)!==0)for(p=_.child;p!==null;){if(pe=DE(p),pe!==null){for(_.flags|=128,v_($,!1),D=pe.updateQueue,D!==null&&(_.updateQueue=D,_.flags|=4),_.subtreeFlags=0,D=T,T=_.child;T!==null;)$=T,p=D,$.flags&=14680066,pe=$.alternate,pe===null?($.childLanes=0,$.lanes=p,$.child=null,$.subtreeFlags=0,$.memoizedProps=null,$.memoizedState=null,$.updateQueue=null,$.dependencies=null,$.stateNode=null):($.childLanes=pe.childLanes,$.lanes=pe.lanes,$.child=pe.child,$.subtreeFlags=0,$.deletions=null,$.memoizedProps=pe.memoizedProps,$.memoizedState=pe.memoizedState,$.updateQueue=pe.updateQueue,$.type=pe.type,p=pe.dependencies,$.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),T=T.sibling;return Ni(Qi,Qi.current&1|2),_.child}p=p.sibling}$.tail!==null&&Br()>Hc&&(_.flags|=128,D=!0,v_($,!1),_.lanes=4194304)}else{if(!D)if(p=DE(pe),p!==null){if(_.flags|=128,D=!0,T=p.updateQueue,T!==null&&(_.updateQueue=T,_.flags|=4),v_($,!0),$.tail===null&&$.tailMode==="hidden"&&!pe.alternate&&!Mi)return Po(_),null}else 2*Br()-$.renderingStartTime>Hc&&T!==1073741824&&(_.flags|=128,D=!0,v_($,!1),_.lanes=4194304);$.isBackwards?(pe.sibling=_.child,_.child=pe):(T=$.last,T!==null?T.sibling=pe:_.child=pe,$.last=pe)}return $.tail!==null?(_=$.tail,$.rendering=_,$.tail=_.sibling,$.renderingStartTime=Br(),_.sibling=null,T=Qi.current,Ni(Qi,D?T&1|2:T&1),_):(Po(_),null);case 22:case 23:return I_(),D=_.memoizedState!==null,p!==null&&p.memoizedState!==null!==D&&(_.flags|=8192),D&&(_.mode&1)!==0?(Sc&1073741824)!==0&&(Po(_),_.subtreeFlags&6&&(_.flags|=8192)):Po(_),null;case 24:return null;case 25:return null}throw Error(i(156,_.tag))}function rD(p,_){switch(CE(_),_.tag){case 1:return $a(_.type)&&SE(),p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 3:return Hp(),Si(ba),Si(Zo),Sb(),p=_.flags,(p&65536)!==0&&(p&128)===0?(_.flags=p&-65537|128,_):null;case 5:return Eb(_),null;case 13:if(Si(Qi),p=_.memoizedState,p!==null&&p.dehydrated!==null){if(_.alternate===null)throw Error(i(340));zp()}return p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 19:return Si(Qi),null;case 4:return Hp(),null;case 10:return fb(_.type._context),null;case 22:case 23:return I_(),null;case 24:return null;default:return null}}var S_=!1,Oo=!1,iD=typeof WeakSet=="function"?WeakSet:Set,an=null;function Xp(p,_){var T=p.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(D){Zi(p,_,D)}else T.current=null}function Wb(p,_,T){try{T()}catch(D){Zi(p,_,D)}}var MI=!1;function sD(p,_){if(nb=Re,p=q0(),Y0(p)){if("selectionStart"in p)var T={start:p.selectionStart,end:p.selectionEnd};else e:{T=(T=p.ownerDocument)&&T.defaultView||window;var D=T.getSelection&&T.getSelection();if(D&&D.rangeCount!==0){T=D.anchorNode;var V=D.anchorOffset,$=D.focusNode;D=D.focusOffset;try{T.nodeType,$.nodeType}catch{T=null;break e}var pe=0,Oe=-1,Ve=-1,ct=0,Dt=0,Lt=p,Nt=null;t:for(;;){for(var sn;Lt!==T||V!==0&&Lt.nodeType!==3||(Oe=pe+V),Lt!==$||D!==0&&Lt.nodeType!==3||(Ve=pe+D),Lt.nodeType===3&&(pe+=Lt.nodeValue.length),(sn=Lt.firstChild)!==null;)Nt=Lt,Lt=sn;for(;;){if(Lt===p)break t;if(Nt===T&&++ct===V&&(Oe=pe),Nt===$&&++Dt===D&&(Ve=pe),(sn=Lt.nextSibling)!==null)break;Lt=Nt,Nt=Lt.parentNode}Lt=sn}T=Oe===-1||Ve===-1?null:{start:Oe,end:Ve}}else T=null}T=T||{start:0,end:0}}else T=null;for(yE={focusedElem:p,selectionRange:T},Re=!1,an=_;an!==null;)if(_=an,p=_.child,(_.subtreeFlags&1028)!==0&&p!==null)p.return=_,an=p;else for(;an!==null;){_=an;try{var hn=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(hn!==null){var mn=hn.memoizedProps,es=hn.memoizedState,Xe=_.stateNode,Be=Xe.getSnapshotBeforeUpdate(_.elementType===_.type?mn:Gc(_.type,mn),es);Xe.__reactInternalSnapshotBeforeUpdate=Be}break;case 3:var tt=_.stateNode.containerInfo;tt.nodeType===1?tt.textContent="":tt.nodeType===9&&tt.documentElement&&tt.removeChild(tt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(jt){Zi(_,_.return,jt)}if(p=_.sibling,p!==null){p.return=_.return,an=p;break}an=_.return}return hn=MI,MI=!1,hn}function kh(p,_,T){var D=_.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var V=D=D.next;do{if((V.tag&p)===p){var $=V.destroy;V.destroy=void 0,$!==void 0&&Wb(_,T,$)}V=V.next}while(V!==D)}}function XE(p,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var T=_=_.next;do{if((T.tag&p)===p){var D=T.create;T.destroy=D()}T=T.next}while(T!==_)}}function Gb(p){var _=p.ref;if(_!==null){var T=p.stateNode;switch(p.tag){case 5:p=T;break;default:p=T}typeof _=="function"?_(p):_.current=p}}function UI(p){var _=p.alternate;_!==null&&(p.alternate=null,UI(_)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(_=p.stateNode,_!==null&&(delete _[_u],delete _[r_],delete _[ib],delete _[qN],delete _[YN])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Hb(p){return p.tag===5||p.tag===3||p.tag===4}function VI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Hb(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function $b(p,_,T){var D=p.tag;if(D===5||D===6)p=p.stateNode,_?T.nodeType===8?T.parentNode.insertBefore(p,_):T.insertBefore(p,_):(T.nodeType===8?(_=T.parentNode,_.insertBefore(p,T)):(_=T,_.appendChild(p)),T=T._reactRootContainer,T!=null||_.onclick!==null||(_.onclick=n_));else if(D!==4&&(p=p.child,p!==null))for($b(p,_,T),p=p.sibling;p!==null;)$b(p,_,T),p=p.sibling}function b_(p,_,T){var D=p.tag;if(D===5||D===6)p=p.stateNode,_?T.insertBefore(p,_):T.appendChild(p);else if(D!==4&&(p=p.child,p!==null))for(b_(p,_,T),p=p.sibling;p!==null;)b_(p,_,T),p=p.sibling}var ko=null,vc=!1;function Nh(p,_,T){for(T=T.child;T!==null;)Kb(p,_,T),T=T.sibling}function Kb(p,_,T){if(fa&&typeof fa.onCommitFiberUnmount=="function")try{fa.onCommitFiberUnmount(Uc,T)}catch{}switch(T.tag){case 5:Oo||Xp(T,_);case 6:var D=ko,V=vc;ko=null,Nh(p,_,T),ko=D,vc=V,ko!==null&&(vc?(p=ko,T=T.stateNode,p.nodeType===8?p.parentNode.removeChild(T):p.removeChild(T)):ko.removeChild(T.stateNode));break;case 18:ko!==null&&(vc?(p=ko,T=T.stateNode,p.nodeType===8?EE(p.parentNode,T):p.nodeType===1&&EE(p,T),va(p)):EE(ko,T.stateNode));break;case 4:D=ko,V=vc,ko=T.stateNode.containerInfo,vc=!0,Nh(p,_,T),ko=D,vc=V;break;case 0:case 11:case 14:case 15:if(!Oo&&(D=T.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){V=D=D.next;do{var $=V,pe=$.destroy;$=$.tag,pe!==void 0&&(($&2)!==0||($&4)!==0)&&Wb(T,_,pe),V=V.next}while(V!==D)}Nh(p,_,T);break;case 1:if(!Oo&&(Xp(T,_),D=T.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=T.memoizedProps,D.state=T.memoizedState,D.componentWillUnmount()}catch(Oe){Zi(T,_,Oe)}Nh(p,_,T);break;case 21:Nh(p,_,T);break;case 22:T.mode&1?(Oo=(D=Oo)||T.memoizedState!==null,Nh(p,_,T),Oo=D):Nh(p,_,T);break;default:Nh(p,_,T)}}function FI(p){var _=p.updateQueue;if(_!==null){p.updateQueue=null;var T=p.stateNode;T===null&&(T=p.stateNode=new iD),_.forEach(function(D){var V=Cm.bind(null,p,D);T.has(D)||(T.add(D),D.then(V,V))})}}function Ml(p,_){var T=_.deletions;if(T!==null)for(var D=0;D<T.length;D++){var V=T[D];try{var $=p,pe=_,Oe=pe;e:for(;Oe!==null;){switch(Oe.tag){case 5:ko=Oe.stateNode,vc=!1;break e;case 3:ko=Oe.stateNode.containerInfo,vc=!0;break e;case 4:ko=Oe.stateNode.containerInfo,vc=!0;break e}Oe=Oe.return}if(ko===null)throw Error(i(160));Kb($,pe,V),ko=null,vc=!1;var Ve=V.alternate;Ve!==null&&(Ve.return=null),V.return=null}catch(ct){Zi(V,_,ct)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)qb(_,p),_=_.sibling}function qb(p,_){var T=p.alternate,D=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Ml(_,p),vu(p),D&4){try{kh(3,p,p.return),XE(3,p)}catch(mn){Zi(p,p.return,mn)}try{kh(5,p,p.return)}catch(mn){Zi(p,p.return,mn)}}break;case 1:Ml(_,p),vu(p),D&512&&T!==null&&Xp(T,T.return);break;case 5:if(Ml(_,p),vu(p),D&512&&T!==null&&Xp(T,T.return),p.flags&32){var V=p.stateNode;try{xt(V,"")}catch(mn){Zi(p,p.return,mn)}}if(D&4&&(V=p.stateNode,V!=null)){var $=p.memoizedProps,pe=T!==null?T.memoizedProps:$,Oe=p.type,Ve=p.updateQueue;if(p.updateQueue=null,Ve!==null)try{Oe==="input"&&$.type==="radio"&&$.name!=null&&rn(V,$),qo(Oe,pe);var ct=qo(Oe,$);for(pe=0;pe<Ve.length;pe+=2){var Dt=Ve[pe],Lt=Ve[pe+1];Dt==="style"?ai(V,Lt):Dt==="dangerouslySetInnerHTML"?Qn(V,Lt):Dt==="children"?xt(V,Lt):ne(V,Dt,Lt,ct)}switch(Oe){case"input":Ht(V,$);break;case"textarea":Mt(V,$);break;case"select":var Nt=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!$.multiple;var sn=$.value;sn!=null?Pt(V,!!$.multiple,sn,!1):Nt!==!!$.multiple&&($.defaultValue!=null?Pt(V,!!$.multiple,$.defaultValue,!0):Pt(V,!!$.multiple,$.multiple?[]:"",!1))}V[r_]=$}catch(mn){Zi(p,p.return,mn)}}break;case 6:if(Ml(_,p),vu(p),D&4){if(p.stateNode===null)throw Error(i(162));V=p.stateNode,$=p.memoizedProps;try{V.nodeValue=$}catch(mn){Zi(p,p.return,mn)}}break;case 3:if(Ml(_,p),vu(p),D&4&&T!==null&&T.memoizedState.isDehydrated)try{va(_.containerInfo)}catch(mn){Zi(p,p.return,mn)}break;case 4:Ml(_,p),vu(p);break;case 13:Ml(_,p),vu(p),V=p.child,V.flags&8192&&($=V.memoizedState!==null,V.stateNode.isHidden=$,!$||V.alternate!==null&&V.alternate.memoizedState!==null||(Qb=Br())),D&4&&FI(p);break;case 22:if(Dt=T!==null&&T.memoizedState!==null,p.mode&1?(Oo=(ct=Oo)||Dt,Ml(_,p),Oo=ct):Ml(_,p),vu(p),D&8192){if(ct=p.memoizedState!==null,(p.stateNode.isHidden=ct)&&!Dt&&(p.mode&1)!==0)for(an=p,Dt=p.child;Dt!==null;){for(Lt=an=Dt;an!==null;){switch(Nt=an,sn=Nt.child,Nt.tag){case 0:case 11:case 14:case 15:kh(4,Nt,Nt.return);break;case 1:Xp(Nt,Nt.return);var hn=Nt.stateNode;if(typeof hn.componentWillUnmount=="function"){D=Nt,T=Nt.return;try{_=D,hn.props=_.memoizedProps,hn.state=_.memoizedState,hn.componentWillUnmount()}catch(mn){Zi(D,T,mn)}}break;case 5:Xp(Nt,Nt.return);break;case 22:if(Nt.memoizedState!==null){JE(Lt);continue}}sn!==null?(sn.return=Nt,an=sn):JE(Lt)}Dt=Dt.sibling}e:for(Dt=null,Lt=p;;){if(Lt.tag===5){if(Dt===null){Dt=Lt;try{V=Lt.stateNode,ct?($=V.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none"):(Oe=Lt.stateNode,Ve=Lt.memoizedProps.style,pe=Ve!=null&&Ve.hasOwnProperty("display")?Ve.display:null,Oe.style.display=Ci("display",pe))}catch(mn){Zi(p,p.return,mn)}}}else if(Lt.tag===6){if(Dt===null)try{Lt.stateNode.nodeValue=ct?"":Lt.memoizedProps}catch(mn){Zi(p,p.return,mn)}}else if((Lt.tag!==22&&Lt.tag!==23||Lt.memoizedState===null||Lt===p)&&Lt.child!==null){Lt.child.return=Lt,Lt=Lt.child;continue}if(Lt===p)break e;for(;Lt.sibling===null;){if(Lt.return===null||Lt.return===p)break e;Dt===Lt&&(Dt=null),Lt=Lt.return}Dt===Lt&&(Dt=null),Lt.sibling.return=Lt.return,Lt=Lt.sibling}}break;case 19:Ml(_,p),vu(p),D&4&&FI(p);break;case 21:break;default:Ml(_,p),vu(p)}}function vu(p){var _=p.flags;if(_&2){try{e:{for(var T=p.return;T!==null;){if(Hb(T)){var D=T;break e}T=T.return}throw Error(i(160))}switch(D.tag){case 5:var V=D.stateNode;D.flags&32&&(xt(V,""),D.flags&=-33);var $=VI(p);b_(p,$,V);break;case 3:case 4:var pe=D.stateNode.containerInfo,Oe=VI(p);$b(p,Oe,pe);break;default:throw Error(i(161))}}catch(Ve){Zi(p,p.return,Ve)}p.flags&=-3}_&4096&&(p.flags&=-4097)}function oD(p,_,T){an=p,Yb(p)}function Yb(p,_,T){for(var D=(p.mode&1)!==0;an!==null;){var V=an,$=V.child;if(V.tag===22&&D){var pe=V.memoizedState!==null||S_;if(!pe){var Oe=V.alternate,Ve=Oe!==null&&Oe.memoizedState!==null||Oo;Oe=S_;var ct=Oo;if(S_=pe,(Oo=Ve)&&!ct)for(an=V;an!==null;)pe=an,Ve=pe.child,pe.tag===22&&pe.memoizedState!==null?jI(V):Ve!==null?(Ve.return=pe,an=Ve):jI(V);for(;$!==null;)an=$,Yb($),$=$.sibling;an=V,S_=Oe,Oo=ct}Xb(p)}else(V.subtreeFlags&8772)!==0&&$!==null?($.return=V,an=$):Xb(p)}}function Xb(p){for(;an!==null;){var _=an;if((_.flags&8772)!==0){var T=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:Oo||XE(5,_);break;case 1:var D=_.stateNode;if(_.flags&4&&!Oo)if(T===null)D.componentDidMount();else{var V=_.elementType===_.type?T.memoizedProps:Gc(_.type,T.memoizedProps);D.componentDidUpdate(V,T.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var $=_.updateQueue;$!==null&&hI(_,$,D);break;case 3:var pe=_.updateQueue;if(pe!==null){if(T=null,_.child!==null)switch(_.child.tag){case 5:T=_.child.stateNode;break;case 1:T=_.child.stateNode}hI(_,pe,T)}break;case 5:var Oe=_.stateNode;if(T===null&&_.flags&4){T=Oe;var Ve=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":Ve.autoFocus&&T.focus();break;case"img":Ve.src&&(T.src=Ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var ct=_.alternate;if(ct!==null){var Dt=ct.memoizedState;if(Dt!==null){var Lt=Dt.dehydrated;Lt!==null&&va(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Oo||_.flags&512&&Gb(_)}catch(Nt){Zi(_,_.return,Nt)}}if(_===p){an=null;break}if(T=_.sibling,T!==null){T.return=_.return,an=T;break}an=_.return}}function JE(p){for(;an!==null;){var _=an;if(_===p){an=null;break}var T=_.sibling;if(T!==null){T.return=_.return,an=T;break}an=_.return}}function jI(p){for(;an!==null;){var _=an;try{switch(_.tag){case 0:case 11:case 15:var T=_.return;try{XE(4,_)}catch(Ve){Zi(_,T,Ve)}break;case 1:var D=_.stateNode;if(typeof D.componentDidMount=="function"){var V=_.return;try{D.componentDidMount()}catch(Ve){Zi(_,V,Ve)}}var $=_.return;try{Gb(_)}catch(Ve){Zi(_,$,Ve)}break;case 5:var pe=_.return;try{Gb(_)}catch(Ve){Zi(_,pe,Ve)}}}catch(Ve){Zi(_,_.return,Ve)}if(_===p){an=null;break}var Oe=_.sibling;if(Oe!==null){Oe.return=_.return,an=Oe;break}an=_.return}}var aD=Math.ceil,Dh=ce.ReactCurrentDispatcher,QE=ce.ReactCurrentOwner,ta=ce.ReactCurrentBatchConfig,br=0,Xs=null,ls=null,xs=0,Sc=0,bm=Ol(0),Js=0,wm=null,Jp=0,ZE=0,Jb=0,Qp=null,_s=null,Qb=0,Hc=1/0,Su=null,na=!1,Zb=null,xh=null,w_=!1,Lh=null,T_=0,Tm=0,ew=null,R_=-1,ev=0;function Ra(){return(br&6)!==0?Br():R_!==-1?R_:R_=Br()}function Mh(p){return(p.mode&1)===0?1:(br&2)!==0&&xs!==0?xs&-xs:a_.transition!==null?(ev===0&&(ev=cd()),ev):(p=fr,p!==0||(p=window.event,p=p===void 0?16:ri(p.type)),p)}function bc(p,_,T,D){if(50<Tm)throw Tm=0,ew=null,Error(i(185));cu(p,T,D),((br&2)===0||p!==Xs)&&(p===Xs&&((br&2)===0&&(ZE|=T),Js===4&&Uh(p,xs)),ra(p,D),T===1&&br===0&&(_.mode&1)===0&&(Hc=Br()+500,wE&&Ih()))}function ra(p,_){var T=p.callbackNode;ja(p,_);var D=od(p,p===Xs?xs:0);if(D===0)T!==null&&Sl(T),p.callbackNode=null,p.callbackPriority=0;else if(_=D&-D,p.callbackPriority!==_){if(T!=null&&Sl(T),_===1)p.tag===0?XN(tv.bind(null,p)):ab(tv.bind(null,p)),$N(function(){(br&6)===0&&Ih()}),T=null;else{switch(Tl(D)){case 1:T=zr;break;case 4:T=pa;break;case 16:T=$i;break;case 536870912:T=ni;break;default:T=$i}T=aw(T,BI.bind(null,p))}p.callbackPriority=_,p.callbackNode=T}}function BI(p,_){if(R_=-1,ev=0,(br&6)!==0)throw Error(i(327));var T=p.callbackNode;if(Fh()&&p.callbackNode!==T)return null;var D=od(p,p===Xs?xs:0);if(D===0)return null;if((D&30)!==0||(D&p.expiredLanes)!==0||_)_=A_(p,D);else{_=D;var V=br;br|=2;var $=rw();(Xs!==p||xs!==_)&&(Su=null,Hc=Br()+500,Cd(p,_));do try{lD();break}catch(Oe){nw(p,Oe)}while(!0);pb(),Dh.current=$,br=V,ls!==null?_=0:(Xs=null,xs=0,_=Js)}if(_!==0){if(_===2&&(V=ma(p),V!==0&&(D=V,_=C_(p,V))),_===1)throw T=wm,Cd(p,0),Uh(p,D),ra(p,Br()),T;if(_===6)Uh(p,D);else{if(V=p.current.alternate,(D&30)===0&&!zI(V)&&(_=A_(p,D),_===2&&($=ma(p),$!==0&&(D=$,_=C_(p,$))),_===1))throw T=wm,Cd(p,0),Uh(p,D),ra(p,Br()),T;switch(p.finishedWork=V,p.finishedLanes=D,_){case 0:case 1:throw Error(i(345));case 2:$c(p,_s,Su);break;case 3:if(Uh(p,D),(D&130023424)===D&&(_=Qb+500-Br(),10<_)){if(od(p,0)!==0)break;if(V=p.suspendedLanes,(V&D)!==D){Ra(),p.pingedLanes|=p.suspendedLanes&V;break}p.timeoutHandle=rb($c.bind(null,p,_s,Su),_);break}$c(p,_s,Su);break;case 4:if(Uh(p,D),(D&4194240)===D)break;for(_=p.eventTimes,V=-1;0<D;){var pe=31-Io(D);$=1<<pe,pe=_[pe],pe>V&&(V=pe),D&=~$}if(D=V,D=Br()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*aD(D/1960))-D,10<D){p.timeoutHandle=rb($c.bind(null,p,_s,Su),D);break}$c(p,_s,Su);break;case 5:$c(p,_s,Su);break;default:throw Error(i(329))}}}return ra(p,Br()),p.callbackNode===T?BI.bind(null,p):null}function C_(p,_){var T=Qp;return p.current.memoizedState.isDehydrated&&(Cd(p,_).flags|=256),p=A_(p,_),p!==2&&(_=_s,_s=T,_!==null&&tw(_)),p}function tw(p){_s===null?_s=p:_s.push.apply(_s,p)}function zI(p){for(var _=p;;){if(_.flags&16384){var T=_.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var D=0;D<T.length;D++){var V=T[D],$=V.getSnapshot;V=V.value;try{if(!Al($(),V))return!1}catch{return!1}}}if(T=_.child,_.subtreeFlags&16384&&T!==null)T.return=_,_=T;else{if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Uh(p,_){for(_&=~Jb,_&=~ZE,p.suspendedLanes|=_,p.pingedLanes&=~_,p=p.expirationTimes;0<_;){var T=31-Io(_),D=1<<T;p[T]=-1,_&=~D}}function tv(p){if((br&6)!==0)throw Error(i(327));Fh();var _=od(p,0);if((_&1)===0)return ra(p,Br()),null;var T=A_(p,_);if(p.tag!==0&&T===2){var D=ma(p);D!==0&&(_=D,T=C_(p,D))}if(T===1)throw T=wm,Cd(p,0),Uh(p,_),ra(p,Br()),T;if(T===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=_,$c(p,_s,Su),ra(p,Br()),null}function Zp(p,_){var T=br;br|=1;try{return p(_)}finally{br=T,br===0&&(Hc=Br()+500,wE&&Ih())}}function Vh(p){Lh!==null&&Lh.tag===0&&(br&6)===0&&Fh();var _=br;br|=1;var T=ta.transition,D=fr;try{if(ta.transition=null,fr=1,p)return p()}finally{fr=D,ta.transition=T,br=_,(br&6)===0&&Ih()}}function I_(){Sc=bm.current,Si(bm)}function Cd(p,_){p.finishedWork=null,p.finishedLanes=0;var T=p.timeoutHandle;if(T!==-1&&(p.timeoutHandle=-1,HN(T)),ls!==null)for(T=ls.return;T!==null;){var D=T;switch(CE(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&SE();break;case 3:Hp(),Si(ba),Si(Zo),Sb();break;case 5:Eb(D);break;case 4:Hp();break;case 13:Si(Qi);break;case 19:Si(Qi);break;case 10:fb(D.type._context);break;case 22:case 23:I_()}T=T.return}if(Xs=p,ls=p=jh(p.current,null),xs=Sc=_,Js=0,wm=null,Jb=ZE=Jp=0,_s=Qp=null,Wp!==null){for(_=0;_<Wp.length;_++)if(T=Wp[_],D=T.interleaved,D!==null){T.interleaved=null;var V=D.next,$=T.pending;if($!==null){var pe=$.next;$.next=V,D.next=pe}T.pending=D}Wp=null}return p}function nw(p,_){do{var T=ls;try{if(pb(),d_.current=vm,h_){for(var D=Ki.memoizedState;D!==null;){var V=D.queue;V!==null&&(V.pending=null),D=D.next}h_=!1}if($p=0,gs=Ys=Ki=null,bd=!1,p_=0,QE.current=null,T===null||T.return===null){Js=1,wm=_,ls=null;break}e:{var $=p,pe=T.return,Oe=T,Ve=_;if(_=xs,Oe.flags|=32768,Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var ct=Ve,Dt=Oe,Lt=Dt.tag;if((Dt.mode&1)===0&&(Lt===0||Lt===11||Lt===15)){var Nt=Dt.alternate;Nt?(Dt.updateQueue=Nt.updateQueue,Dt.memoizedState=Nt.memoizedState,Dt.lanes=Nt.lanes):(Dt.updateQueue=null,Dt.memoizedState=null)}var sn=CI(pe);if(sn!==null){sn.flags&=-257,II(sn,pe,Oe,$,_),sn.mode&1&&Lb($,ct,_),_=sn,Ve=ct;var hn=_.updateQueue;if(hn===null){var mn=new Set;mn.add(Ve),_.updateQueue=mn}else hn.add(Ve);break e}else{if((_&1)===0){Lb($,ct,_),Rm();break e}Ve=Error(i(426))}}else if(Mi&&Oe.mode&1){var es=CI(pe);if(es!==null){(es.flags&65536)===0&&(es.flags|=256),II(es,pe,Oe,$,_),mm(Sm(Ve,Oe));break e}}$=Ve=Sm(Ve,Oe),Js!==4&&(Js=2),Qp===null?Qp=[$]:Qp.push($),$=pe;do{switch($.tag){case 3:$.flags|=65536,_&=-_,$.lanes|=_;var Xe=xb($,Ve,_);dI($,Xe);break e;case 1:Oe=Ve;var Be=$.type,tt=$.stateNode;if(($.flags&128)===0&&(typeof Be.getDerivedStateFromError=="function"||tt!==null&&typeof tt.componentDidCatch=="function"&&(xh===null||!xh.has(tt)))){$.flags|=65536,_&=-_,$.lanes|=_;var jt=RI($,Oe,_);dI($,jt);break e}}$=$.return}while($!==null)}sw(T)}catch(gn){_=gn,ls===T&&T!==null&&(ls=T=T.return);continue}break}while(!0)}function rw(){var p=Dh.current;return Dh.current=vm,p===null?vm:p}function Rm(){(Js===0||Js===3||Js===2)&&(Js=4),Xs===null||(Jp&268435455)===0&&(ZE&268435455)===0||Uh(Xs,xs)}function A_(p,_){var T=br;br|=2;var D=rw();(Xs!==p||xs!==_)&&(Su=null,Cd(p,_));do try{cD();break}catch(V){nw(p,V)}while(!0);if(pb(),br=T,Dh.current=D,ls!==null)throw Error(i(261));return Xs=null,xs=0,Js}function cD(){for(;ls!==null;)iw(ls)}function lD(){for(;ls!==null&&!mh();)iw(ls)}function iw(p){var _=HI(p.alternate,p,Sc);p.memoizedProps=p.pendingProps,_===null?sw(p):ls=_,QE.current=null}function sw(p){var _=p;do{var T=_.alternate;if(p=_.return,(_.flags&32768)===0){if(T=YE(T,_,Sc),T!==null){ls=T;return}}else{if(T=rD(T,_),T!==null){T.flags&=32767,ls=T;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Js=6,ls=null;return}}if(_=_.sibling,_!==null){ls=_;return}ls=_=p}while(_!==null);Js===0&&(Js=5)}function $c(p,_,T){var D=fr,V=ta.transition;try{ta.transition=null,fr=1,ow(p,_,T,D)}finally{ta.transition=V,fr=D}return null}function ow(p,_,T,D){do Fh();while(Lh!==null);if((br&6)!==0)throw Error(i(327));T=p.finishedWork;var V=p.finishedLanes;if(T===null)return null;if(p.finishedWork=null,p.finishedLanes=0,T===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var $=T.lanes|T.childLanes;if(ci(p,$),p===Xs&&(ls=Xs=null,xs=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||w_||(w_=!0,aw($i,function(){return Fh(),null})),$=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||$){$=ta.transition,ta.transition=null;var pe=fr;fr=1;var Oe=br;br|=4,QE.current=null,sD(p,T),qb(T,p),jN(yE),Re=!!nb,yE=nb=null,p.current=T,oD(T),$s(),br=Oe,fr=pe,ta.transition=$}else p.current=T;if(w_&&(w_=!1,Lh=p,T_=V),$=p.pendingLanes,$===0&&(xh=null),xp(T.stateNode),ra(p,Br()),_!==null)for(D=p.onRecoverableError,T=0;T<_.length;T++)V=_[T],D(V.value,{componentStack:V.stack,digest:V.digest});if(na)throw na=!1,p=Zb,Zb=null,p;return(T_&1)!==0&&p.tag!==0&&Fh(),$=p.pendingLanes,($&1)!==0?p===ew?Tm++:(Tm=0,ew=p):Tm=0,Ih(),null}function Fh(){if(Lh!==null){var p=Tl(T_),_=ta.transition,T=fr;try{if(ta.transition=null,fr=16>p?16:p,Lh===null)var D=!1;else{if(p=Lh,Lh=null,T_=0,(br&6)!==0)throw Error(i(331));var V=br;for(br|=4,an=p.current;an!==null;){var $=an,pe=$.child;if((an.flags&16)!==0){var Oe=$.deletions;if(Oe!==null){for(var Ve=0;Ve<Oe.length;Ve++){var ct=Oe[Ve];for(an=ct;an!==null;){var Dt=an;switch(Dt.tag){case 0:case 11:case 15:kh(8,Dt,$)}var Lt=Dt.child;if(Lt!==null)Lt.return=Dt,an=Lt;else for(;an!==null;){Dt=an;var Nt=Dt.sibling,sn=Dt.return;if(UI(Dt),Dt===ct){an=null;break}if(Nt!==null){Nt.return=sn,an=Nt;break}an=sn}}}var hn=$.alternate;if(hn!==null){var mn=hn.child;if(mn!==null){hn.child=null;do{var es=mn.sibling;mn.sibling=null,mn=es}while(mn!==null)}}an=$}}if(($.subtreeFlags&2064)!==0&&pe!==null)pe.return=$,an=pe;else e:for(;an!==null;){if($=an,($.flags&2048)!==0)switch($.tag){case 0:case 11:case 15:kh(9,$,$.return)}var Xe=$.sibling;if(Xe!==null){Xe.return=$.return,an=Xe;break e}an=$.return}}var Be=p.current;for(an=Be;an!==null;){pe=an;var tt=pe.child;if((pe.subtreeFlags&2064)!==0&&tt!==null)tt.return=pe,an=tt;else e:for(pe=Be;an!==null;){if(Oe=an,(Oe.flags&2048)!==0)try{switch(Oe.tag){case 0:case 11:case 15:XE(9,Oe)}}catch(gn){Zi(Oe,Oe.return,gn)}if(Oe===pe){an=null;break e}var jt=Oe.sibling;if(jt!==null){jt.return=Oe.return,an=jt;break e}an=Oe.return}}if(br=V,Ih(),fa&&typeof fa.onPostCommitFiberRoot=="function")try{fa.onPostCommitFiberRoot(Uc,p)}catch{}D=!0}return D}finally{fr=T,ta.transition=_}}return!1}function nv(p,_,T){_=Sm(T,_),_=xb(p,_,1),p=Dl(p,_,1),_=Ra(),p!==null&&(cu(p,1,_),ra(p,_))}function Zi(p,_,T){if(p.tag===3)nv(p,p,T);else for(;_!==null;){if(_.tag===3){nv(_,p,T);break}else if(_.tag===1){var D=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(xh===null||!xh.has(D))){p=Sm(T,p),p=RI(_,p,1),_=Dl(_,p,1),p=Ra(),_!==null&&(cu(_,1,p),ra(_,p));break}}_=_.return}}function WI(p,_,T){var D=p.pingCache;D!==null&&D.delete(_),_=Ra(),p.pingedLanes|=p.suspendedLanes&T,Xs===p&&(xs&T)===T&&(Js===4||Js===3&&(xs&130023424)===xs&&500>Br()-Qb?Cd(p,0):Jb|=T),ra(p,_)}function GI(p,_){_===0&&((p.mode&1)===0?_=1:(_=_h,_h<<=1,(_h&130023424)===0&&(_h=4194304)));var T=Ra();p=Ed(p,_),p!==null&&(cu(p,_,T),ra(p,T))}function uD(p){var _=p.memoizedState,T=0;_!==null&&(T=_.retryLane),GI(p,T)}function Cm(p,_){var T=0;switch(p.tag){case 13:var D=p.stateNode,V=p.memoizedState;V!==null&&(T=V.retryLane);break;case 19:D=p.stateNode;break;default:throw Error(i(314))}D!==null&&D.delete(_),GI(p,T)}var HI;HI=function(p,_,T){if(p!==null)if(p.memoizedProps!==_.pendingProps||ba.current)qa=!0;else{if((p.lanes&T)===0&&(_.flags&128)===0)return qa=!1,$E(p,_,T);qa=(p.flags&131072)!==0}else qa=!1,Mi&&(_.flags&1048576)!==0&&oI(_,RE,_.index);switch(_.lanes=0,_.tag){case 2:var D=_.type;HE(p,_),p=_.pendingProps;var V=Ch(_,Zo.current);Nl(_,T),V=ym(null,_,D,p,V,T);var $=Tb();return _.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,$a(D)?($=!0,bE(_)):$=!1,_.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,_b(_),V.updater=BE,_.stateNode=V,V._reactInternals=_,kb(_,D,p,T),_=Vb(null,_,D,!0,$,T)):(_.tag=0,Mi&&$&&pm(_),Ta(null,_,V,T),_=_.child),_;case 16:D=_.elementType;e:{switch(HE(p,_),p=_.pendingProps,V=D._init,D=V(D._payload),_.type=D,V=_.tag=dD(D),p=Gc(D,p),V){case 0:_=Ub(null,_,D,p,T);break e;case 1:_=kI(null,_,D,p,T);break e;case 11:_=AI(null,_,D,p,T);break e;case 14:_=PI(null,_,D,Gc(D.type,p),T);break e}throw Error(i(306,D,""))}return _;case 0:return D=_.type,V=_.pendingProps,V=_.elementType===D?V:Gc(D,V),Ub(p,_,D,V,T);case 1:return D=_.type,V=_.pendingProps,V=_.elementType===D?V:Gc(D,V),kI(p,_,D,V,T);case 3:e:{if(NI(_),p===null)throw Error(i(387));D=_.pendingProps,$=_.memoizedState,V=$.element,uI(p,_),NE(_,D,null,T);var pe=_.memoizedState;if(D=pe.element,$.isDehydrated)if($={element:D,isDehydrated:!1,cache:pe.cache,pendingSuspenseBoundaries:pe.pendingSuspenseBoundaries,transitions:pe.transitions},_.updateQueue.baseState=$,_.memoizedState=$,_.flags&256){V=Sm(Error(i(423)),_),_=DI(p,_,D,T,V);break e}else if(D!==V){V=Sm(Error(i(424)),_),_=DI(p,_,D,T,V);break e}else for(Ec=gu(_.stateNode.containerInfo.firstChild),yc=_,Mi=!0,kl=null,T=db(_,null,D,T),_.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(zp(),D===V){_=Rd(p,_,T);break e}Ta(p,_,D,T)}_=_.child}return _;case 5:return pI(_),p===null&&o_(_),D=_.type,V=_.pendingProps,$=p!==null?p.memoizedProps:null,pe=V.children,lm(D,V)?pe=null:$!==null&&lm(D,$)&&(_.flags|=32),OI(p,_),Ta(p,_,pe,T),_.child;case 6:return p===null&&o_(_),null;case 13:return xI(p,_,T);case 4:return yb(_,_.stateNode.containerInfo),D=_.pendingProps,p===null?_.child=gm(_,null,D,T):Ta(p,_,D,T),_.child;case 11:return D=_.type,V=_.pendingProps,V=_.elementType===D?V:Gc(D,V),AI(p,_,D,V,T);case 7:return Ta(p,_,_.pendingProps,T),_.child;case 8:return Ta(p,_,_.pendingProps.children,T),_.child;case 12:return Ta(p,_,_.pendingProps.children,T),_.child;case 10:e:{if(D=_.type._context,V=_.pendingProps,$=_.memoizedProps,pe=V.value,Ni(AE,D._currentValue),D._currentValue=pe,$!==null)if(Al($.value,pe)){if($.children===V.children&&!ba.current){_=Rd(p,_,T);break e}}else for($=_.child,$!==null&&($.return=_);$!==null;){var Oe=$.dependencies;if(Oe!==null){pe=$.child;for(var Ve=Oe.firstContext;Ve!==null;){if(Ve.context===D){if($.tag===1){Ve=Sd(-1,T&-T),Ve.tag=2;var ct=$.updateQueue;if(ct!==null){ct=ct.shared;var Dt=ct.pending;Dt===null?Ve.next=Ve:(Ve.next=Dt.next,Dt.next=Ve),ct.pending=Ve}}$.lanes|=T,Ve=$.alternate,Ve!==null&&(Ve.lanes|=T),OE($.return,T,_),Oe.lanes|=T;break}Ve=Ve.next}}else if($.tag===10)pe=$.type===_.type?null:$.child;else if($.tag===18){if(pe=$.return,pe===null)throw Error(i(341));pe.lanes|=T,Oe=pe.alternate,Oe!==null&&(Oe.lanes|=T),OE(pe,T,_),pe=$.sibling}else pe=$.child;if(pe!==null)pe.return=$;else for(pe=$;pe!==null;){if(pe===_){pe=null;break}if($=pe.sibling,$!==null){$.return=pe.return,pe=$;break}pe=pe.return}$=pe}Ta(p,_,V.children,T),_=_.child}return _;case 9:return V=_.type,D=_.pendingProps.children,Nl(_,T),V=Wc(V),D=D(V),_.flags|=1,Ta(p,_,D,T),_.child;case 14:return D=_.type,V=Gc(D,_.pendingProps),V=Gc(D.type,V),PI(p,_,D,V,T);case 15:return Mb(p,_,_.type,_.pendingProps,T);case 17:return D=_.type,V=_.pendingProps,V=_.elementType===D?V:Gc(D,V),HE(p,_),_.tag=1,$a(D)?(p=!0,bE(_)):p=!1,Nl(_,T),wI(_,D,V),kb(_,D,V,T),Vb(null,_,D,!0,p,T);case 19:return Bb(p,_,T);case 22:return Eu(p,_,T)}throw Error(i(156,_.tag))};function aw(p,_){return fo(p,_)}function cw(p,_,T,D){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kc(p,_,T,D){return new cw(p,_,T,D)}function lw(p){return p=p.prototype,!(!p||!p.isReactComponent)}function dD(p){if(typeof p=="function")return lw(p)?1:0;if(p!=null){if(p=p.$$typeof,p===fe)return 11;if(p===Te)return 14}return 2}function jh(p,_){var T=p.alternate;return T===null?(T=Kc(p.tag,_,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=_,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&14680064,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,_=p.dependencies,T.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T}function Im(p,_,T,D,V,$){var pe=2;if(D=p,typeof p=="function")lw(p)&&(pe=1);else if(typeof p=="string")pe=5;else e:switch(p){case X:return Bh(T.children,V,$,_);case J:pe=8,V|=8;break;case te:return p=Kc(12,T,_,V|2),p.elementType=te,p.lanes=$,p;case de:return p=Kc(13,T,_,V),p.elementType=de,p.lanes=$,p;case ve:return p=Kc(19,T,_,V),p.elementType=ve,p.lanes=$,p;case be:return P_(T,V,$,_);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ie:pe=10;break e;case he:pe=9;break e;case fe:pe=11;break e;case Te:pe=14;break e;case Fe:pe=16,D=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return _=Kc(pe,T,_,V),_.elementType=p,_.type=D,_.lanes=$,_}function Bh(p,_,T,D){return p=Kc(7,p,D,_),p.lanes=T,p}function P_(p,_,T,D){return p=Kc(22,p,D,_),p.elementType=be,p.lanes=T,p.stateNode={isHidden:!1},p}function rv(p,_,T){return p=Kc(6,p,null,_),p.lanes=T,p}function Am(p,_,T){return _=Kc(4,p.children!==null?p.children:[],p.key,_),_.lanes=T,_.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},_}function uw(p,_,T,D,V){this.tag=_,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wl(0),this.expirationTimes=wl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wl(0),this.identifierPrefix=D,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function Pm(p,_,T,D,V,$,pe,Oe,Ve){return p=new uw(p,_,T,Oe,Ve),_===1?(_=1,$===!0&&(_|=8)):_=0,$=Kc(3,null,null,_),p.current=$,$.stateNode=p,$.memoizedState={element:D,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},_b($),p}function iv(p,_,T){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ge,key:D==null?null:""+D,children:p,containerInfo:_,implementation:T}}function dw(p){if(!p)return Th;p=p._reactInternals;e:{if(Os(p)!==p||p.tag!==1)throw Error(i(170));var _=p;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if($a(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(i(171))}if(p.tag===1){var T=p.type;if($a(T))return iI(p,T,_)}return _}function ef(p,_,T,D,V,$,pe,Oe,Ve){return p=Pm(T,D,!0,p,V,$,pe,Oe,Ve),p.context=dw(null),T=p.current,D=Ra(),V=Mh(T),$=Sd(D,V),$.callback=_??null,Dl(T,$,V),p.current.lanes=V,cu(p,V,D),ra(p,D),p}function bu(p,_,T,D){var V=_.current,$=Ra(),pe=Mh(V);return T=dw(T),_.context===null?_.context=T:_.pendingContext=T,_=Sd($,pe),_.payload={element:p},D=D===void 0?null:D,D!==null&&(_.callback=D),p=Dl(V,_,pe),p!==null&&(bc(p,V,pe,$),kE(p,V,pe)),pe}function sv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function Om(p,_){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<_?T:_}}function hw(p,_){Om(p,_),(p=p.alternate)&&Om(p,_)}function hD(){return null}var $I=typeof reportError=="function"?reportError:function(p){console.error(p)};function pw(p){this._internalRoot=p}O_.prototype.render=pw.prototype.render=function(p){var _=this._internalRoot;if(_===null)throw Error(i(409));bu(p,_,null,null)},O_.prototype.unmount=pw.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var _=p.containerInfo;Vh(function(){bu(null,p,null,null)}),_[fd]=null}};function O_(p){this._internalRoot=p}O_.prototype.unstable_scheduleHydration=function(p){if(p){var _=Xf();p={blockedOn:null,target:p,priority:_};for(var T=0;T<Ba.length&&_!==0&&_<Ba[T].priority;T++);Ba.splice(T,0,p),T===0&&Rl(p)}};function k_(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function N_(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function KI(){}function qI(p,_,T,D,V){if(V){if(typeof D=="function"){var $=D;D=function(){var ct=sv(pe);$.call(ct)}}var pe=ef(_,D,p,0,null,!1,!1,"",KI);return p._reactRootContainer=pe,p[fd]=pe.current,pd(p.nodeType===8?p.parentNode:p),Vh(),pe}for(;V=p.lastChild;)p.removeChild(V);if(typeof D=="function"){var Oe=D;D=function(){var ct=sv(Ve);Oe.call(ct)}}var Ve=Pm(p,0,!1,null,null,!1,!1,"",KI);return p._reactRootContainer=Ve,p[fd]=Ve.current,pd(p.nodeType===8?p.parentNode:p),Vh(function(){bu(_,Ve,T,D)}),Ve}function ov(p,_,T,D,V){var $=T._reactRootContainer;if($){var pe=$;if(typeof V=="function"){var Oe=V;V=function(){var Ve=sv(pe);Oe.call(Ve)}}bu(_,pe,p,V)}else pe=qI(T,_,p,V,D);return sv(pe)}yh=function(p){switch(p.tag){case 3:var _=p.stateNode;if(_.current.memoizedState.isDehydrated){var T=Pr(_.pendingLanes);T!==0&&(lu(_,T|1),ra(_,Br()),(br&6)===0&&(Hc=Br()+500,Ih()))}break;case 13:Vh(function(){var D=Ed(p,1);if(D!==null){var V=Ra();bc(D,p,1,V)}}),hw(p,1)}},Eh=function(p){if(p.tag===13){var _=Ed(p,134217728);if(_!==null){var T=Ra();bc(_,p,134217728,T)}hw(p,134217728)}},uu=function(p){if(p.tag===13){var _=Mh(p),T=Ed(p,_);if(T!==null){var D=Ra();bc(T,p,_,D)}hw(p,_)}},Xf=function(){return fr},Mp=function(p,_){var T=fr;try{return fr=p,_()}finally{fr=T}},Kn=function(p,_,T){switch(_){case"input":if(Ht(p,T),_=T.name,T.type==="radio"&&_!=null){for(T=p;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<T.length;_++){var D=T[_];if(D!==p&&D.form===p.form){var V=vE(D);if(!V)throw Error(i(90));ut(D),Ht(D,V)}}}break;case"textarea":Mt(p,T);break;case"select":_=T.value,_!=null&&Pt(p,!!T.multiple,_,!1)}},Xo=Zp,id=Vh;var D_={usingClientEntryPoint:!1,Events:[i_,um,vE,po,rd,Zp]},Ya={findFiberByHostInstance:Fp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},YI={bundleType:Ya.bundleType,version:Ya.version,rendererPackageName:Ya.rendererPackageName,rendererConfig:Ya.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ce.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Pi(p),p===null?null:p.stateNode},findFiberByHostInstance:Ya.findFiberByHostInstance||hD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var av=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!av.isDisabled&&av.supportsFiber)try{Uc=av.inject(YI),fa=av}catch{}}return al.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D_,al.createPortal=function(p,_){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!k_(_))throw Error(i(200));return iv(p,_,null,T)},al.createRoot=function(p,_){if(!k_(p))throw Error(i(299));var T=!1,D="",V=$I;return _!=null&&(_.unstable_strictMode===!0&&(T=!0),_.identifierPrefix!==void 0&&(D=_.identifierPrefix),_.onRecoverableError!==void 0&&(V=_.onRecoverableError)),_=Pm(p,1,!1,null,null,T,!1,D,V),p[fd]=_.current,pd(p.nodeType===8?p.parentNode:p),new pw(_)},al.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var _=p._reactInternals;if(_===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=Pi(_),p=p===null?null:p.stateNode,p},al.flushSync=function(p){return Vh(p)},al.hydrate=function(p,_,T){if(!N_(_))throw Error(i(200));return ov(null,p,_,!0,T)},al.hydrateRoot=function(p,_,T){if(!k_(p))throw Error(i(405));var D=T!=null&&T.hydratedSources||null,V=!1,$="",pe=$I;if(T!=null&&(T.unstable_strictMode===!0&&(V=!0),T.identifierPrefix!==void 0&&($=T.identifierPrefix),T.onRecoverableError!==void 0&&(pe=T.onRecoverableError)),_=ef(_,null,p,1,T??null,V,!1,$,pe),p[fd]=_.current,pd(p),D)for(p=0;p<D.length;p++)T=D[p],V=T._getVersion,V=V(T._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[T,V]:_.mutableSourceEagerHydrationData.push(T,V);return new O_(_)},al.render=function(p,_,T){if(!N_(_))throw Error(i(200));return ov(null,p,_,!1,T)},al.unmountComponentAtNode=function(p){if(!N_(p))throw Error(i(40));return p._reactRootContainer?(Vh(function(){ov(null,null,p,!1,function(){p._reactRootContainer=null,p[fd]=null})}),!0):!1},al.unstable_batchedUpdates=Zp,al.unstable_renderSubtreeIntoContainer=function(p,_,T,D){if(!N_(T))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return ov(p,_,T,!1,D)},al.version="18.3.1-next-f1338f8080-20240426",al}var wK;function oZ(){if(wK)return fM.exports;wK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),fM.exports=tEe(),fM.exports}var TK;function nEe(){if(TK)return v1;TK=1;var n=oZ();return v1.createRoot=n.createRoot,v1.hydrateRoot=n.hydrateRoot,v1}var rEe=nEe();const iEe=Mg(rEe);function sEe(n,t,i,a){return n.addEventListener(t,i,a),()=>{n.removeEventListener(t,i,a)}}function Tk(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function oEe(){return!!(globalThis!=null&&globalThis.document)}function aZ(n){return n.parentElement&&aZ(n.parentElement)?!0:n.hidden}function aEe(n){const t=n.getAttribute("contenteditable");return t!=="false"&&t!=null}function cEe(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function lEe(n){var t;return((t=cZ(n))==null?void 0:t.defaultView)??window}function cZ(n){return Tk(n)?n.ownerDocument:document}function uEe(n){return n.view??window}function dEe(n){return cZ(n).activeElement}function hEe(n){const t=uEe(n);return typeof t.PointerEvent<"u"&&n instanceof t.PointerEvent?n.pointerType==="mouse":n instanceof t.MouseEvent}function lZ(n){return!!n.touches}function pEe(n){return lZ(n)&&n.touches.length>1}function fEe(n,t="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${t}X`],y:i[`${t}Y`]}}function mEe(n,t="page"){return{x:n[`${t}X`],y:n[`${t}Y`]}}function uZ(n,t="page"){return lZ(n)?fEe(n,t):mEe(n,t)}function gEe(n){return t=>{const i=hEe(t);(!i||i&&t.button===0)&&n(t)}}function _Ee(n,t=!1){function i(l){n(l,{point:uZ(l)})}return t?gEe(i):i}function Q1(n,t,i,a){return sEe(n,t,_Ee(i,t==="pointerdown"),a)}function yEe(n,...t){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in i&&delete i[l],i[l]=a[l]);return i}const lr=n=>n?"":void 0,Af=n=>n?!0:void 0;function EEe(n){return Array.isArray(n)}function Yu(n){const t=typeof n;return n!=null&&(t==="object"||t==="function")&&!EEe(n)}function vEe(n){const t=n==null?0:n.length;return t?n[t-1]:void 0}function SEe(n){const t=parseFloat(n.toString()),i=n.toString().replace(String(t),"");return{unitless:!i,value:t,unit:i}}function VU(n){if(n==null)return n;const{unitless:t}=SEe(n);return t||typeof n=="number"?`${n}px`:n}const dZ=(n,t)=>parseInt(n[1],10)>parseInt(t[1],10)?1:-1,vF=n=>Object.fromEntries(Object.entries(n).sort(dZ));function RK(n){const t=vF(n);return Object.assign(Object.values(t),t)}function bEe(n){const t=Object.keys(vF(n));return new Set(t)}function CK(n){if(!n)return n;n=VU(n)??n;const t=-.02;return typeof n=="number"?`${n+t}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+t}`)}function WT(n,t){const i=["@media screen"];return n&&i.push("and",`(min-width: ${VU(n)})`),t&&i.push("and",`(max-width: ${VU(t)})`),i.join(" ")}function wEe(n){if(!n)return null;n.base=n.base??"0px";const t=RK(n),i=Object.entries(n).sort(dZ).map(([d,f],y,v)=>{let[,b]=v[y+1]??[];return b=parseFloat(b)>0?CK(b):void 0,{_minW:CK(f),breakpoint:d,minW:f,maxW:b,maxWQuery:WT(null,b),minWQuery:WT(f),minMaxQuery:WT(f,b)}}),a=bEe(n),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(y=>a.has(y))},asObject:vF(n),asArray:RK(n),details:i,get(d){return i.find(f=>f.breakpoint===d)},media:[null,...t.map(d=>WT(d)).slice(1)],toArrayValue(d){if(!Yu(d))throw new Error("toArrayValue: value must be an object");const f=l.map(y=>d[y]??null);for(;vEe(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,y,v)=>{const b=l[v];return b!=null&&y!=null&&(f[b]=y),f},{})}}}function hZ(...n){return function(...i){n.forEach(a=>a==null?void 0:a(...i))}}function Ln(...n){return function(i){n.some(a=>(a==null||a(i),i==null?void 0:i.defaultPrevented))}}function Rk(n){return N.Children.toArray(n).filter(t=>N.isValidElement(t))}function Ck(n){const t=Object.assign({},n);for(let i in t)t[i]===void 0&&delete t[i];return t}function TEe(n,t){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Ri(n={}){const{name:t,strict:i=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=n,y=N.createContext(f);y.displayName=t;function v(){var R;const b=N.useContext(y);if(!b&&i){const I=new Error(d??TEe(a,l));throw I.name="ContextError",(R=Error.captureStackTrace)==null||R.call(Error,I,v),I}return b}return[y.Provider,v,y]}const Sn=(...n)=>n.filter(Boolean).join(" "),pZ=n=>n.hasAttribute("tabindex"),REe=n=>pZ(n)&&n.tabIndex===-1;function LO(n){if(!Tk(n)||aZ(n)||cEe(n))return!1;const{localName:t}=n;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return t in a?a[t]():aEe(n)?!0:pZ(n)}function CEe(n){return n?Tk(n)&&LO(n)&&!REe(n):!1}const IEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],AEe=IEe.join(),PEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function fZ(n){const t=Array.from(n.querySelectorAll(AEe));return t.unshift(n),t.filter(i=>LO(i)&&PEe(i))}function OEe(n,t,i,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const kEe=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const y=t.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,f);return y.set(l,v),v}},mZ=kEe(OEe),NEe=n=>n.default||n;function SF(n){const{wasSelected:t,enabled:i,isSelected:a,mode:l="unmount"}=n;return!!(!i||a||l==="keepMounted"&&t)}function DEe(n){const t=parseFloat(n);return typeof t!="number"||Number.isNaN(t)?0:t}function bF(n,t){let i=DEe(n);const a=10**(t??10);return i=Math.round(i*a)/a,t?i.toFixed(t):i.toString()}function FU(n){if(!Number.isFinite(n))return 0;let t=1,i=0;for(;Math.round(n*t)/t!==n;)t*=10,i+=1;return i}function IK(n,t,i){return(n-t)*100/(i-t)}function xEe(n,t,i){return(i-t)*n+t}function AK(n,t,i){const a=Math.round((n-t)/i)*i+t,l=FU(i);return bF(a,l)}function Z1(n,t,i){return n==null?n:(i<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,t),i))}function k0(n,t=[]){const i=Object.assign({},n);for(const a of t)a in i&&delete i[a];return i}function gZ(n,t){const i={};for(const a of t)a in n&&(i[a]=n[a]);return i}function wF(n,t){return Array.isArray(n)?n.map(i=>i===null?null:t(i)):Yu(n)?Object.keys(n).reduce((i,a)=>(i[a]=t(n[a]),i),{}):n!=null?t(n):null}const LEe=n=>typeof n=="function";function fl(n,...t){return LEe(n)?n(...t):n}function MEe(n){const t=n.ownerDocument.defaultView||window,{overflow:i,overflowX:a,overflowY:l}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+a)}function UEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function _Z(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:Tk(n)&&MEe(n)?n:_Z(UEe(n))}function VEe(n,t){const i={},a={};for(const[l,d]of Object.entries(n))t.includes(l)?i[l]=d:a[l]=d;return[i,a]}function FEe(n,...t){const i=Object.getOwnPropertyDescriptors(n),a=Object.keys(i),l=f=>{const y={};for(let v=0;v<f.length;v++){const b=f[v];i[b]&&(Object.defineProperty(y,b,i[b]),delete i[b])}return y},d=f=>l(Array.isArray(f)?f:a.filter(f));return t.map(d).concat(l(a))}function PK(n,t,i={}){const{stop:a,getKey:l}=i;function d(f,y=[]){if(Yu(f)||Array.isArray(f)){const v={};for(const[b,R]of Object.entries(f)){const I=(l==null?void 0:l(b))??b,k=[...y,I];if(a!=null&&a(f,k))return t(f,y);v[I]=d(R,k)}return v}return t(f,y)}return d(n)}var GT={exports:{}};GT.exports;var OK;function jEe(){return OK||(OK=1,function(n,t){var i=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,y="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",R="[object Boolean]",I="[object Date]",k="[object Error]",M="[object Function]",L="[object GeneratorFunction]",j="[object Map]",z="[object Number]",Y="[object Null]",K="[object Object]",ne="[object Proxy]",ce="[object RegExp]",oe="[object Set]",ge="[object String]",X="[object Undefined]",J="[object WeakMap]",te="[object ArrayBuffer]",ie="[object DataView]",he="[object Float32Array]",fe="[object Float64Array]",de="[object Int8Array]",ve="[object Int16Array]",Te="[object Int32Array]",Fe="[object Uint8Array]",be="[object Uint8ClampedArray]",Ce="[object Uint16Array]",Ae="[object Uint32Array]",De=/[\\^$.*+?()[\]{}|]/g,Ee=/^\[object .+?Constructor\]$/,Ne=/^(?:0|[1-9]\d*)$/,je={};je[he]=je[fe]=je[de]=je[ve]=je[Te]=je[Fe]=je[be]=je[Ce]=je[Ae]=!0,je[y]=je[v]=je[te]=je[R]=je[ie]=je[I]=je[k]=je[M]=je[j]=je[z]=je[K]=je[ce]=je[oe]=je[ge]=je[J]=!1;var Ke=typeof Sy=="object"&&Sy&&Sy.Object===Object&&Sy,ot=typeof self=="object"&&self&&self.Object===Object&&self,_t=Ke||ot||Function("return this")(),lt=t&&!t.nodeType&&t,vt=lt&&!0&&n&&!n.nodeType&&n,rt=vt&&vt.exports===lt,bt=rt&&Ke.process,$t=function(){try{var Re=vt&&vt.require&&vt.require("util").types;return Re||bt&&bt.binding&&bt.binding("util")}catch{}}(),ut=$t&&$t.isTypedArray;function mt(Re,Me,st){switch(st.length){case 0:return Re.call(Me);case 1:return Re.call(Me,st[0]);case 2:return Re.call(Me,st[0],st[1]);case 3:return Re.call(Me,st[0],st[1],st[2])}return Re.apply(Me,st)}function at(Re,Me){for(var st=-1,qt=Array(Re);++st<Re;)qt[st]=Me(st);return qt}function Vt(Re){return function(Me){return Re(Me)}}function rn(Re,Me){return Re==null?void 0:Re[Me]}function Ht(Re,Me){return function(st){return Re(Me(st))}}var we=Array.prototype,xe=Function.prototype,$e=Object.prototype,Pt=_t["__core-js_shared__"],It=xe.toString,wt=$e.hasOwnProperty,Mt=function(){var Re=/[^.]+$/.exec(Pt&&Pt.keys&&Pt.keys.IE_PROTO||"");return Re?"Symbol(src)_1."+Re:""}(),vn=$e.toString,Cn=It.call(Object),dn=RegExp("^"+It.call(wt).replace(De,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rt=rt?_t.Buffer:void 0,Qn=_t.Symbol,xt=_t.Uint8Array;Rt&&Rt.allocUnsafe;var Xt=Ht(Object.getPrototypeOf,Object),Lr=Object.create,Ci=$e.propertyIsEnumerable,ai=we.splice,Ii=Qn?Qn.toStringTag:void 0,ps=function(){try{var Re=ja(Object,"defineProperty");return Re({},"",{}),Re}catch{}}(),qo=Rt?Rt.isBuffer:void 0,Hi=Math.max,Ai=Date.now,Kn=ja(_t,"Map"),cs=ja(Object,"create"),da=function(){function Re(){}return function(Me){if(!Vc(Me))return{};if(Lr)return Lr(Me);Re.prototype=Me;var st=new Re;return Re.prototype=void 0,st}}();function Yo(Re){var Me=-1,st=Re==null?0:Re.length;for(this.clear();++Me<st;){var qt=Re[Me];this.set(qt[0],qt[1])}}function po(){this.__data__=cs?cs(null):{},this.size=0}function rd(Re){var Me=this.has(Re)&&delete this.__data__[Re];return this.size-=Me?1:0,Me}function Xo(Re){var Me=this.__data__;if(cs){var st=Me[Re];return st===a?void 0:st}return wt.call(Me,Re)?Me[Re]:void 0}function id(Re){var Me=this.__data__;return cs?Me[Re]!==void 0:wt.call(Me,Re)}function hc(Re,Me){var st=this.__data__;return this.size+=this.has(Re)?0:1,st[Re]=cs&&Me===void 0?a:Me,this}Yo.prototype.clear=po,Yo.prototype.delete=rd,Yo.prototype.get=Xo,Yo.prototype.has=id,Yo.prototype.set=hc;function Co(Re){var Me=-1,st=Re==null?0:Re.length;for(this.clear();++Me<st;){var qt=Re[Me];this.set(qt[0],qt[1])}}function Sr(){this.__data__=[],this.size=0}function ou(Re){var Me=this.__data__,st=$s(Me,Re);if(st<0)return!1;var qt=Me.length-1;return st==qt?Me.pop():ai.call(Me,st,1),--this.size,!0}function ha(Re){var Me=this.__data__,st=$s(Me,Re);return st<0?void 0:Me[st][1]}function Fa(Re){return $s(this.__data__,Re)>-1}function Mc(Re,Me){var st=this.__data__,qt=$s(st,Re);return qt<0?(++this.size,st.push([Re,Me])):st[qt][1]=Me,this}Co.prototype.clear=Sr,Co.prototype.delete=ou,Co.prototype.get=ha,Co.prototype.has=Fa,Co.prototype.set=Mc;function Jo(Re){var Me=-1,st=Re==null?0:Re.length;for(this.clear();++Me<st;){var qt=Re[Me];this.set(qt[0],qt[1])}}function Qo(){this.size=0,this.__data__={hash:new Yo,map:new(Kn||Co),string:new Yo}}function sd(Re){var Me=ad(this,Re).delete(Re);return this.size-=Me?1:0,Me}function ph(Re){return ad(this,Re).get(Re)}function vl(Re){return ad(this,Re).has(Re)}function fh(Re,Me){var st=ad(this,Re),qt=st.size;return st.set(Re,Me),this.size+=st.size==qt?0:1,this}Jo.prototype.clear=Qo,Jo.prototype.delete=sd,Jo.prototype.get=ph,Jo.prototype.has=vl,Jo.prototype.set=fh;function Os(Re){var Me=this.__data__=new Co(Re);this.size=Me.size}function pt(){this.__data__=new Co,this.size=0}function nn(Re){var Me=this.__data__,st=Me.delete(Re);return this.size=Me.size,st}function Ar(Re){return this.__data__.get(Re)}function Pi(Re){return this.__data__.has(Re)}function pc(Re,Me){var st=this.__data__;if(st instanceof Co){var qt=st.__data__;if(!Kn||qt.length<i-1)return qt.push([Re,Me]),this.size=++st.size,this;st=this.__data__=new Jo(qt)}return st.set(Re,Me),this.size=st.size,this}Os.prototype.clear=pt,Os.prototype.delete=nn,Os.prototype.get=Ar,Os.prototype.has=Pi,Os.prototype.set=pc;function fo(Re,Me){var st=_a(Re),qt=!st&&ms(Re),sr=!st&&!qt&&Ea(Re),Mr=!st&&!qt&&!sr&&Rl(Re),ri=st||qt||sr||Mr,Zn=ri?at(Re.length,String):[],er=Zn.length;for(var Oi in Re)ri&&(Oi=="length"||sr&&(Oi=="offset"||Oi=="parent")||Mr&&(Oi=="buffer"||Oi=="byteLength"||Oi=="byteOffset")||wl(Oi,er))||Zn.push(Oi);return Zn}function Sl(Re,Me,st){(st!==void 0&&!ga(Re[Me],st)||st===void 0&&!(Me in Re))&&Br(Re,Me,st)}function mh(Re,Me,st){var qt=Re[Me];(!(wt.call(Re,Me)&&ga(qt,st))||st===void 0&&!(Me in Re))&&Br(Re,Me,st)}function $s(Re,Me){for(var st=Re.length;st--;)if(ga(Re[st][0],Me))return st;return-1}function Br(Re,Me,st){Me=="__proto__"&&ps?ps(Re,Me,{configurable:!0,enumerable:!0,value:st,writable:!0}):Re[Me]=st}var gh=od();function zr(Re){return Re==null?Re===void 0?X:Y:Ii&&Ii in Object(Re)?ma(Re):yh(Re)}function pa(Re){return ks(Re)&&zr(Re)==y}function $i(Re){if(!Vc(Re)||lu(Re))return!1;var Me=Ba(Re)?dn:Ee;return Me.test(Up(Re))}function fs(Re){return ks(Re)&&Vp(Re.length)&&!!je[zr(Re)]}function ni(Re){if(!Vc(Re))return Tl(Re);var Me=fr(Re),st=[];for(var qt in Re)qt=="constructor"&&(Me||!wt.call(Re,qt))||st.push(qt);return st}function Uc(Re,Me,st,qt,sr){Re!==Me&&gh(Me,function(Mr,ri){if(sr||(sr=new Os),Vc(Mr))fa(Re,Me,ri,st,Uc,qt,sr);else{var Zn=qt?qt(uu(Re,ri),Mr,ri+"",Re,Me,sr):void 0;Zn===void 0&&(Zn=Mr),Sl(Re,ri,Zn)}},hu)}function fa(Re,Me,st,qt,sr,Mr,ri){var Zn=uu(Re,st),er=uu(Me,st),Oi=ri.get(er);if(Oi){Sl(Re,st,Oi);return}var Ks=Mr?Mr(Zn,er,st+"",Re,Me,ri):void 0,Fc=Ks===void 0;if(Fc){var Ao=_a(er),pu=!Ao&&Ea(er),Ns=!Ao&&!pu&&Rl(er);Ks=er,Ao||pu||Ns?_a(Zn)?Ks=Zn:du(Zn)?Ks=au(Zn):pu?(Fc=!1,Ks=Lp(er)):Ns?(Fc=!1,Ks=bl(er)):Ks=[]:Wg(er)||ms(er)?(Ks=Zn,ms(Zn)?Ks=Cl(Zn):(!Vc(Zn)||Ba(Zn))&&(Ks=cd(er))):Fc=!1}Fc&&(ri.set(er,Ks),sr(Ks,er,qt,Mr,ri),ri.delete(er)),Sl(Re,st,Ks)}function xp(Re,Me){return Xf(Eh(Re,Me,va),Re+"")}var Io=ps?function(Re,Me){return ps(Re,"toString",{configurable:!0,enumerable:!1,value:fc(Me),writable:!0})}:va;function Lp(Re,Me){return Re.slice()}function Yf(Re){var Me=new Re.constructor(Re.byteLength);return new xt(Me).set(new xt(Re)),Me}function bl(Re,Me){var st=Yf(Re.buffer);return new Re.constructor(st,Re.byteOffset,Re.length)}function au(Re,Me){var st=-1,qt=Re.length;for(Me||(Me=Array(qt));++st<qt;)Me[st]=Re[st];return Me}function _h(Re,Me,st,qt){var sr=!st;st||(st={});for(var Mr=-1,ri=Me.length;++Mr<ri;){var Zn=Me[Mr],er=void 0;er===void 0&&(er=Re[Zn]),sr?Br(st,Zn,er):mh(st,Zn,er)}return st}function Pr(Re){return xp(function(Me,st){var qt=-1,sr=st.length,Mr=sr>1?st[sr-1]:void 0,ri=sr>2?st[2]:void 0;for(Mr=Re.length>3&&typeof Mr=="function"?(sr--,Mr):void 0,ri&&cu(st[0],st[1],ri)&&(Mr=sr<3?void 0:Mr,sr=1),Me=Object(Me);++qt<sr;){var Zn=st[qt];Zn&&Re(Me,Zn,qt,Mr)}return Me})}function od(Re){return function(Me,st,qt){for(var sr=-1,Mr=Object(Me),ri=qt(Me),Zn=ri.length;Zn--;){var er=ri[++sr];if(st(Mr[er],er,Mr)===!1)break}return Me}}function ad(Re,Me){var st=Re.__data__;return ci(Me)?st[typeof Me=="string"?"string":"hash"]:st.map}function ja(Re,Me){var st=rn(Re,Me);return $i(st)?st:void 0}function ma(Re){var Me=wt.call(Re,Ii),st=Re[Ii];try{Re[Ii]=void 0;var qt=!0}catch{}var sr=vn.call(Re);return qt&&(Me?Re[Ii]=st:delete Re[Ii]),sr}function cd(Re){return typeof Re.constructor=="function"&&!fr(Re)?da(Xt(Re)):{}}function wl(Re,Me){var st=typeof Re;return Me=Me??f,!!Me&&(st=="number"||st!="symbol"&&Ne.test(Re))&&Re>-1&&Re%1==0&&Re<Me}function cu(Re,Me,st){if(!Vc(st))return!1;var qt=typeof Me;return(qt=="number"?ya(st)&&wl(Me,st.length):qt=="string"&&Me in st)?ga(st[Me],Re):!1}function ci(Re){var Me=typeof Re;return Me=="string"||Me=="number"||Me=="symbol"||Me=="boolean"?Re!=="__proto__":Re===null}function lu(Re){return!!Mt&&Mt in Re}function fr(Re){var Me=Re&&Re.constructor,st=typeof Me=="function"&&Me.prototype||$e;return Re===st}function Tl(Re){var Me=[];if(Re!=null)for(var st in Object(Re))Me.push(st);return Me}function yh(Re){return vn.call(Re)}function Eh(Re,Me,st){return Me=Hi(Me===void 0?Re.length-1:Me,0),function(){for(var qt=arguments,sr=-1,Mr=Hi(qt.length-Me,0),ri=Array(Mr);++sr<Mr;)ri[sr]=qt[Me+sr];sr=-1;for(var Zn=Array(Me+1);++sr<Me;)Zn[sr]=qt[sr];return Zn[Me]=st(ri),mt(Re,this,Zn)}}function uu(Re,Me){if(!(Me==="constructor"&&typeof Re[Me]=="function")&&Me!="__proto__")return Re[Me]}var Xf=Mp(Io);function Mp(Re){var Me=0,st=0;return function(){var qt=Ai(),sr=d-(qt-st);if(st=qt,sr>0){if(++Me>=l)return arguments[0]}else Me=0;return Re.apply(void 0,arguments)}}function Up(Re){if(Re!=null){try{return It.call(Re)}catch{}try{return Re+""}catch{}}return""}function ga(Re,Me){return Re===Me||Re!==Re&&Me!==Me}var ms=pa(function(){return arguments}())?pa:function(Re){return ks(Re)&&wt.call(Re,"callee")&&!Ci.call(Re,"callee")},_a=Array.isArray;function ya(Re){return Re!=null&&Vp(Re.length)&&!Ba(Re)}function du(Re){return ks(Re)&&ya(Re)}var Ea=qo||Il;function Ba(Re){if(!Vc(Re))return!1;var Me=zr(Re);return Me==M||Me==L||Me==b||Me==ne}function Vp(Re){return typeof Re=="number"&&Re>-1&&Re%1==0&&Re<=f}function Vc(Re){var Me=typeof Re;return Re!=null&&(Me=="object"||Me=="function")}function ks(Re){return Re!=null&&typeof Re=="object"}function Wg(Re){if(!ks(Re)||zr(Re)!=K)return!1;var Me=Xt(Re);if(Me===null)return!0;var st=wt.call(Me,"constructor")&&Me.constructor;return typeof st=="function"&&st instanceof st&&It.call(st)==Cn}var Rl=ut?Vt(ut):fs;function Cl(Re){return _h(Re,hu(Re))}function hu(Re){return ya(Re)?fo(Re):ni(Re)}var Jf=Pr(function(Re,Me,st,qt){Uc(Re,Me,st,qt)});function fc(Re){return function(){return Re}}function va(Re){return Re}function Il(){return!1}n.exports=Jf}(GT,GT.exports)),GT.exports}var BEe=jEe();const _p=Mg(BEe);function lo(n,t=[]){const i=N.useRef(n);return N.useEffect(()=>{i.current=n}),N.useCallback((...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},t)}function Iy(n,t,i,a){const l=lo(i);return N.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!i||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,n,a,l,i]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(t,l,a)}}function yZ(n){const{isOpen:t,ref:i}=n,[a,l]=N.useState(t),[d,f]=N.useState(!1);return N.useEffect(()=>{d||(l(t),f(!0))},[t,d,a]),Iy(()=>i.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var R;const v=lEe(i.current),b=new v.CustomEvent("animationend",{bubbles:!0});(R=i.current)==null||R.dispatchEvent(b)}}}var _M,kK;function zEe(){return kK||(kK=1,_M=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var t=document.activeElement,i=[],a=0;a<n.rangeCount;a++)i.push(n.getRangeAt(a));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),t&&t.focus()}}),_M}var yM,NK;function WEe(){if(NK)return yM;NK=1;var n=zEe(),t={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function a(d){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,f)}function l(d,f){var y,v,b,R,I,k,M=!1;f||(f={}),y=f.debug||!1;try{b=n(),R=document.createRange(),I=document.getSelection(),k=document.createElement("span"),k.textContent=d,k.ariaHidden="true",k.style.all="unset",k.style.position="fixed",k.style.top=0,k.style.clip="rect(0, 0, 0, 0)",k.style.whiteSpace="pre",k.style.webkitUserSelect="text",k.style.MozUserSelect="text",k.style.msUserSelect="text",k.style.userSelect="text",k.addEventListener("copy",function(j){if(j.stopPropagation(),f.format)if(j.preventDefault(),typeof j.clipboardData>"u"){y&&console.warn("unable to use e.clipboardData"),y&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var z=t[f.format]||t.default;window.clipboardData.setData(z,d)}else j.clipboardData.clearData(),j.clipboardData.setData(f.format,d);f.onCopy&&(j.preventDefault(),f.onCopy(j.clipboardData))}),document.body.appendChild(k),R.selectNodeContents(k),I.addRange(R);var L=document.execCommand("copy");if(!L)throw new Error("copy command was unsuccessful");M=!0}catch(j){y&&console.error("unable to copy using execCommand: ",j),y&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",d),f.onCopy&&f.onCopy(window.clipboardData),M=!0}catch(z){y&&console.error("unable to copy using clipboardData: ",z),y&&console.error("falling back to prompt"),v=a("message"in f?f.message:i),window.prompt(v,d)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(R):I.removeAllRanges()),k&&document.body.removeChild(k),b()}return M}return yM=l,yM}var GEe=WEe();const DK=Mg(GEe);function xK(n,t={}){const[i,a]=N.useState(!1),[l,d]=N.useState(n);N.useEffect(()=>d(n),[n]);const{timeout:f=1500,...y}=typeof t=="number"?{timeout:t}:t,v=N.useCallback(b=>{const R=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(R).then(()=>a(!0)).catch(()=>a(DK(R,y))):a(DK(R,y))},[l,y]);return N.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{a(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,i]),{value:l,setValue:d,onCopy:v,hasCopied:i}}function EZ(n){const{value:t,defaultValue:i,onChange:a,shouldUpdate:l=(k,M)=>k!==M}=n,d=lo(a),f=lo(l),[y,v]=N.useState(i),b=t!==void 0,R=b?t:y,I=lo(k=>{const L=typeof k=="function"?k(R):k;f(R,L)&&(b||v(L),d(L))},[b,d,R,f]);return[R,I]}function HEe(n={}){const{onChange:t,precision:i,defaultValue:a,value:l,step:d=1,min:f=Number.MIN_SAFE_INTEGER,max:y=Number.MAX_SAFE_INTEGER,keepWithinRange:v=!0}=n,b=lo(t),[R,I]=N.useState(()=>a==null?"":EM(a,d,i)??""),k=typeof l<"u",M=k?l:R,L=vZ(ag(M),d),j=i??L,z=N.useCallback(ie=>{ie!==M&&(k||I(ie.toString()),b==null||b(ie.toString(),ag(ie)))},[b,k,M]),Y=N.useCallback(ie=>{let he=ie;return v&&(he=Z1(he,f,y)),bF(he,j)},[j,v,y,f]),K=N.useCallback((ie=d)=>{let he;M===""?he=ag(ie):he=ag(M)+ie,he=Y(he),z(he)},[Y,d,z,M]),ne=N.useCallback((ie=d)=>{let he;M===""?he=ag(-ie):he=ag(M)-ie,he=Y(he),z(he)},[Y,d,z,M]),ce=N.useCallback(()=>{let ie;a==null?ie="":ie=EM(a,d,i)??f,z(ie)},[a,i,d,z,f]),oe=N.useCallback(ie=>{const he=EM(ie,d,j)??f;z(he)},[j,d,z,f]),ge=ag(M);return{isOutOfRange:ge>y||ge<f,isAtMax:ge===y,isAtMin:ge===f,precision:j,value:M,valueAsNumber:ge,update:z,reset:ce,increment:K,decrement:ne,clamp:Y,cast:oe,setValue:I}}function ag(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function vZ(n,t){return Math.max(FU(t),FU(n))}function EM(n,t,i){const a=ag(n);if(Number.isNaN(a))return;const l=vZ(a,t);return bF(a,i??l)}function sh(n={}){const{onClose:t,onOpen:i,isOpen:a,id:l}=n,d=lo(i),f=lo(t),[y,v]=N.useState(n.defaultIsOpen||!1),b=a!==void 0?a:y,R=a!==void 0,I=N.useId(),k=l??`disclosure-${I}`,M=N.useCallback(()=>{R||v(!1),f==null||f()},[R,f]),L=N.useCallback(()=>{R||v(!0),d==null||d()},[R,d]),j=N.useCallback(()=>{b?M():L()},[b,L,M]);function z(K={}){return{...K,"aria-expanded":b,"aria-controls":k,onClick(ne){var ce;(ce=K.onClick)==null||ce.call(K,ne),j()}}}function Y(K={}){return{...K,hidden:!b,id:k}}return{isOpen:b,onOpen:L,onClose:M,onToggle:j,isControlled:R,getButtonProps:z,getDisclosureProps:Y}}const Sp=globalThis!=null&&globalThis.document?N.useLayoutEffect:N.useEffect,Lf=(n,t)=>{const i=N.useRef(!1),a=N.useRef(!1);N.useEffect(()=>{if(i.current&&a.current)return n();a.current=!0},t),N.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function $Ee(n){const t=n.current;if(!t)return!1;const i=dEe(t);return!i||t.contains(i)?!1:!!CEe(i)}function SZ(n,t){const{shouldFocus:i,visible:a,focusRef:l}=t,d=i&&!a;Lf(()=>{if(!d||$Ee(n))return;const f=(l==null?void 0:l.current)||n.current;let y;if(f)return y=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[d,n,l])}const KEe={preventScroll:!0,shouldFocus:!1};function qEe(n,t=KEe){const{focusRef:i,preventScroll:a,shouldFocus:l,visible:d}=t,f=YEe(n)?n.current:n,y=l&&d,v=N.useRef(y),b=N.useRef(d);Sp(()=>{!b.current&&d&&(v.current=y),b.current=d},[d,y]);const R=N.useCallback(()=>{if(!(!d||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:a})});else{const I=fZ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[d,a,f,i]);Lf(()=>{R()},[R]),Iy(f,"transitionend",R)}function YEe(n){return"current"in n}function XEe(n){return"current"in n}const bZ=()=>typeof window<"u";function JEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const QEe=n=>bZ()&&n.test(navigator.vendor),ZEe=n=>bZ()&&n.test(JEe()),eve=()=>ZEe(/mac|iphone|ipad|ipod/i),tve=()=>eve()&&QEe(/apple/i);function nve(n){const{ref:t,elements:i,enabled:a}=n,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};Iy(l,"pointerdown",d=>{var b,R;if(!tve()||!a)return;const f=((R=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:R[0])??d.target,v=(i??[t]).some(I=>{const k=XEe(I)?I.current:I;return(k==null?void 0:k.contains(f))||k===f});l().activeElement!==f&&v&&(d.preventDefault(),f.focus())})}function rve(n,t){const i=N.useId();return N.useMemo(()=>n||[t,i].filter(Boolean).join("-"),[n,t,i])}function ive(n,...t){const i=rve(n);return N.useMemo(()=>t.map(a=>`${a}-${i}`),[i,t])}function sve(n,t){const i=lo(n);N.useEffect(()=>{let a=null;const l=()=>i();return t!==null&&(a=window.setInterval(l,t)),()=>{a&&window.clearInterval(a)}},[t,i])}function wZ(n){const t=N.useRef(null);return t.current=n,t}function ove(n,t){if(n!=null){if(typeof n=="function"){n(t);return}try{n.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${n}'`)}}}function zi(...n){return t=>{n.forEach(i=>{ove(i,t)})}}function ave(...n){return N.useMemo(()=>zi(...n),n)}function TZ(n){const{ref:t,handler:i,enabled:a=!0}=n,l=lo(i),f=N.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;N.useEffect(()=>{if(!a)return;const y=I=>{vM(I,t)&&(f.isPointerDown=!0)},v=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&i&&vM(I,t)&&(f.isPointerDown=!1,l(I))},b=I=>{f.ignoreEmulatedMouseEvents=!0,i&&f.isPointerDown&&vM(I,t)&&(f.isPointerDown=!1,l(I))},R=RZ(t.current);return R.addEventListener("mousedown",y,!0),R.addEventListener("mouseup",v,!0),R.addEventListener("touchstart",y,!0),R.addEventListener("touchend",b,!0),()=>{R.removeEventListener("mousedown",y,!0),R.removeEventListener("mouseup",v,!0),R.removeEventListener("touchstart",y,!0),R.removeEventListener("touchend",b,!0)}},[i,t,l,f,a])}function vM(n,t){var a,l;const i=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return i&&!RZ(i).contains(i)?!1:!((l=t.current)!=null&&l.contains(i))}function RZ(n){return(n==null?void 0:n.ownerDocument)??document}function cve(n,t){const i=lo(n);N.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{i()},t),()=>{a&&window.clearTimeout(a)}},[t,i])}const CZ=1/60*1e3,lve=typeof performance<"u"?()=>performance.now():()=>Date.now(),IZ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(lve()),CZ);function uve(n){let t=[],i=[],a=0,l=!1,d=!1;const f=new WeakSet,y={schedule:(v,b=!1,R=!1)=>{const I=R&&l,k=I?t:i;return b&&f.add(v),k.indexOf(v)===-1&&(k.push(v),I&&l&&(a=t.length)),v},cancel:v=>{const b=i.indexOf(v);b!==-1&&i.splice(b,1),f.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,i]=[i,t],i.length=0,a=t.length,a)for(let b=0;b<a;b++){const R=t[b];R(v),f.has(R)&&(y.schedule(R),n())}l=!1,d&&(d=!1,y.process(v))}};return y}const dve=40;let jU=!0,xR=!1,BU=!1;const VS={delta:0,timestamp:0},uC=["read","update","preRender","render","postRender"],Ik=uC.reduce((n,t)=>(n[t]=uve(()=>xR=!0),n),{}),hve=uC.reduce((n,t)=>{const i=Ik[t];return n[t]=(a,l=!1,d=!1)=>(xR||mve(),i.schedule(a,l,d)),n},{}),pve=uC.reduce((n,t)=>(n[t]=Ik[t].cancel,n),{});uC.reduce((n,t)=>(n[t]=()=>Ik[t].process(VS),n),{});const fve=n=>Ik[n].process(VS),AZ=n=>{xR=!1,VS.delta=jU?CZ:Math.max(Math.min(n-VS.timestamp,dve),1),VS.timestamp=n,BU=!0,uC.forEach(fve),BU=!1,xR&&(jU=!1,IZ(AZ))},mve=()=>{xR=!0,jU=!0,BU||IZ(AZ)},LK=()=>VS;var gve=Object.defineProperty,_ve=(n,t,i)=>t in n?gve(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,Kd=(n,t,i)=>(_ve(n,typeof t!="symbol"?t+"":t,i),i);class yve{constructor(t,i,a){if(Kd(this,"history",[]),Kd(this,"startEvent",null),Kd(this,"lastEvent",null),Kd(this,"lastEventInfo",null),Kd(this,"handlers",{}),Kd(this,"removeListeners",()=>{}),Kd(this,"threshold",3),Kd(this,"win"),Kd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=SM(this.lastEventInfo,this.history),v=this.startEvent!==null,b=bve(y.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:R}=LK();this.history.push({...y.point,timestamp:R});const{onStart:I,onMove:k}=this.handlers;v||(I==null||I(this.lastEvent,y),this.startEvent=this.lastEvent),k==null||k(this.lastEvent,y)}),Kd(this,"onPointerMove",(y,v)=>{this.lastEvent=y,this.lastEventInfo=v,hve.update(this.updatePoint,!0)}),Kd(this,"onPointerUp",(y,v)=>{const b=SM(v,this.history),{onEnd:R,onSessionEnd:I}=this.handlers;I==null||I(y,b),this.end(),!(!R||!this.startEvent)&&(R==null||R(y,b))}),this.win=t.view??window,pEe(t))return;this.handlers=i,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:uZ(t)},{timestamp:d}=LK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=i;f==null||f(t,SM(l,this.history)),this.removeListeners=Sve(Q1(this.win,"pointermove",this.onPointerMove),Q1(this.win,"pointerup",this.onPointerUp),Q1(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),pve.update(this.updatePoint)}}function MK(n,t){return{x:n.x-t.x,y:n.y-t.y}}function SM(n,t){return{point:n.point,delta:MK(n.point,t[t.length-1]),offset:MK(n.point,t[0]),velocity:vve(t,.1)}}const Eve=n=>n*1e3;function vve(n,t){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=n[n.length-1];for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>Eve(t)));)i--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function Sve(...n){return t=>n.reduce((i,a)=>a(i),t)}function bM(n,t){return Math.abs(n-t)}function UK(n){return"x"in n&&"y"in n}function bve(n,t){if(typeof n=="number"&&typeof t=="number")return bM(n,t);if(UK(n)&&UK(t)){const i=bM(n.x,t.x),a=bM(n.y,t.y);return Math.sqrt(i**2+a**2)}return 0}function wve(n,t){const{onPan:i,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:y}=t,v=!!(i||a||l||d||f),b=N.useRef(null),R=wZ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:i,onEnd(I,k){b.current=null,l==null||l(I,k)}});N.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(R.current)}),N.useEffect(()=>{const I=n.current;if(!I||!v)return;function k(M){b.current=new yve(M,R.current,y)}return Q1(I,"pointerdown",k)},[n,v,R,y]),N.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const Mo={open:(n,t)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${t}`,closed:(n,t)=>`${n}[data-closed], ${n}[data-state=closed] ${t}`,hover:(n,t)=>`${n}:hover ${t}, ${n}[data-hover] ${t}`,focus:(n,t)=>`${n}:focus ${t}, ${n}[data-focus] ${t}`,focusVisible:(n,t)=>`${n}:focus-visible ${t}`,focusWithin:(n,t)=>`${n}:focus-within ${t}`,active:(n,t)=>`${n}:active ${t}, ${n}[data-active] ${t}`,disabled:(n,t)=>`${n}:disabled ${t}, ${n}[data-disabled] ${t}`,invalid:(n,t)=>`${n}:invalid ${t}, ${n}[data-invalid] ${t}`,checked:(n,t)=>`${n}:checked ${t}, ${n}[data-checked] ${t}`,placeholderShown:(n,t)=>`${n}:placeholder-shown ${t}`},op=n=>PZ(t=>n(t,"&"),"[role=group]","[data-group]",".group"),yf=n=>PZ(t=>n(t,"~ &"),"[data-peer]",".peer"),PZ=(n,...t)=>t.map(n).join(", "),FS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:op(Mo.open),_groupClosed:op(Mo.closed),_groupHover:op(Mo.hover),_peerHover:yf(Mo.hover),_groupFocus:op(Mo.focus),_peerFocus:yf(Mo.focus),_groupFocusVisible:op(Mo.focusVisible),_peerFocusVisible:yf(Mo.focusVisible),_groupActive:op(Mo.active),_peerActive:yf(Mo.active),_groupDisabled:op(Mo.disabled),_peerDisabled:yf(Mo.disabled),_groupInvalid:op(Mo.invalid),_peerInvalid:yf(Mo.invalid),_groupChecked:op(Mo.checked),_peerChecked:yf(Mo.checked),_groupFocusWithin:op(Mo.focusWithin),_peerFocusWithin:yf(Mo.focusWithin),_peerPlaceholderShown:yf(Mo.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},OZ=Object.keys(FS),Tve=n=>/!(important)?$/.test(n),VK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,Rve=(n,t)=>i=>{const a=String(t),l=Tve(a),d=VK(a),f=n?`${n}.${d}`:d;let y=Yu(i.__cssMap)&&f in i.__cssMap?i.__cssMap[f].varRef:t;return y=VK(y),l?`${y} !important`:y};function TF(n){const{scale:t,transform:i,compose:a}=n;return(d,f)=>{const y=Rve(t,d)(f);let v=(i==null?void 0:i(y,f))??y;return a&&(v=a(v,f)),v}}const S1=(...n)=>t=>n.reduce((i,a)=>a(i),t);function Gu(n,t){return i=>{const a={property:i,scale:n};return a.transform=TF({scale:n,transform:t}),a}}const Cve=({rtl:n,ltr:t})=>i=>i.direction==="rtl"?n:t;function Ive(n){const{property:t,scale:i,transform:a}=n;return{scale:i,property:Cve(t),transform:i?TF({scale:i,compose:a}):a}}const kZ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function Ave(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...kZ].join(" ")}function Pve(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...kZ].join(" ")}const Ove={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},kve={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function Nve(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const Dve={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},zU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},xve=new Set(Object.values(zU)),WU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),Lve=n=>n.trim();function Mve(n,t){if(n==null||WU.has(n))return n;if(!(GU(n)||WU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return n;const y=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=f.split(",").map(Lve).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const R=v in zU?zU[v]:v;b.unshift(R);const I=b.map(k=>{if(xve.has(k))return k;const M=k.indexOf(" "),[L,j]=M!==-1?[k.substr(0,M),k.substr(M+1)]:[k],z=GU(j)?j:j&&j.split(" "),Y=`colors.${L}`,K=Y in t.__cssMap?t.__cssMap[Y].varRef:L;return z?[K,...Array.isArray(z)?z:[z]].join(" "):K});return`${y}(${I.join(", ")})`}const GU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),Uve=(n,t)=>Mve(n,t??{});function Vve(n){return/^var\(--.+\)$/.test(n)}const Fve=n=>{const t=parseFloat(n.toString()),i=n.toString().replace(String(t),"");return{unitless:!i,value:t,unit:i}},ap=n=>t=>`${n}(${t})`,$r={filter(n){return n!=="auto"?n:Ove},backdropFilter(n){return n!=="auto"?n:kve},ring(n){return Nve($r.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?Ave():n==="auto-gpu"?Pve():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:t}=Fve(n);return t||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,t){const i={left:"right",right:"left"};return t.direction==="rtl"?i[n]:n},degree(n){if(Vve(n)||n==null)return n;const t=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||t?`${n}deg`:n},gradient:Uve,blur:ap("blur"),opacity:ap("opacity"),brightness:ap("brightness"),contrast:ap("contrast"),dropShadow:ap("drop-shadow"),grayscale:ap("grayscale"),hueRotate:n=>ap("hue-rotate")($r.degree(n)),invert:ap("invert"),saturate:ap("saturate"),sepia:ap("sepia"),bgImage(n){return n==null||GU(n)||WU.has(n)?n:`url(${n})`},outline(n){const t=String(n)==="0"||String(n)==="none";return n!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:t,divide:i}=Dve[n]??{},a={flexDirection:n};return t&&(a[t]=1),i&&(a[i]=1),a}},Ge={borderWidths:Gu("borderWidths"),borderStyles:Gu("borderStyles"),colors:Gu("colors"),borders:Gu("borders"),gradients:Gu("gradients",$r.gradient),radii:Gu("radii",$r.px),space:Gu("space",S1($r.vh,$r.px)),spaceT:Gu("space",S1($r.vh,$r.px)),degreeT(n){return{property:n,transform:$r.degree}},prop(n,t,i){return{property:n,scale:t,...t&&{transform:TF({scale:t,transform:i})}}},propT(n,t){return{property:n,transform:t}},sizes:Gu("sizes",S1($r.vh,$r.px)),sizesT:Gu("sizes",S1($r.vh,$r.fraction)),shadows:Gu("shadows"),logical:Ive,blur:Gu("blur",$r.blur)},eO={background:Ge.colors("background"),backgroundColor:Ge.colors("backgroundColor"),backgroundImage:Ge.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:$r.bgClip},bgSize:Ge.prop("backgroundSize"),bgPosition:Ge.prop("backgroundPosition"),bg:Ge.colors("background"),bgColor:Ge.colors("backgroundColor"),bgPos:Ge.prop("backgroundPosition"),bgRepeat:Ge.prop("backgroundRepeat"),bgAttachment:Ge.prop("backgroundAttachment"),bgGradient:Ge.gradients("backgroundImage"),bgClip:{transform:$r.bgClip}};Object.assign(eO,{bgImage:eO.backgroundImage,bgImg:eO.backgroundImage});const di={border:Ge.borders("border"),borderWidth:Ge.borderWidths("borderWidth"),borderStyle:Ge.borderStyles("borderStyle"),borderColor:Ge.colors("borderColor"),borderRadius:Ge.radii("borderRadius"),borderTop:Ge.borders("borderTop"),borderBlockStart:Ge.borders("borderBlockStart"),borderTopLeftRadius:Ge.radii("borderTopLeftRadius"),borderStartStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ge.radii("borderTopRightRadius"),borderStartEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ge.borders("borderRight"),borderInlineEnd:Ge.borders("borderInlineEnd"),borderBottom:Ge.borders("borderBottom"),borderBlockEnd:Ge.borders("borderBlockEnd"),borderBottomLeftRadius:Ge.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ge.radii("borderBottomRightRadius"),borderLeft:Ge.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ge.borders(["borderLeft","borderRight"]),borderInline:Ge.borders("borderInline"),borderY:Ge.borders(["borderTop","borderBottom"]),borderBlock:Ge.borders("borderBlock"),borderTopWidth:Ge.borderWidths("borderTopWidth"),borderBlockStartWidth:Ge.borderWidths("borderBlockStartWidth"),borderTopColor:Ge.colors("borderTopColor"),borderBlockStartColor:Ge.colors("borderBlockStartColor"),borderTopStyle:Ge.borderStyles("borderTopStyle"),borderBlockStartStyle:Ge.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ge.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ge.borderWidths("borderBlockEndWidth"),borderBottomColor:Ge.colors("borderBottomColor"),borderBlockEndColor:Ge.colors("borderBlockEndColor"),borderBottomStyle:Ge.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ge.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ge.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ge.borderWidths("borderInlineStartWidth"),borderLeftColor:Ge.colors("borderLeftColor"),borderInlineStartColor:Ge.colors("borderInlineStartColor"),borderLeftStyle:Ge.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ge.borderStyles("borderInlineStartStyle"),borderRightWidth:Ge.borderWidths("borderRightWidth"),borderInlineEndWidth:Ge.borderWidths("borderInlineEndWidth"),borderRightColor:Ge.colors("borderRightColor"),borderInlineEndColor:Ge.colors("borderInlineEndColor"),borderRightStyle:Ge.borderStyles("borderRightStyle"),borderInlineEndStyle:Ge.borderStyles("borderInlineEndStyle"),borderTopRadius:Ge.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ge.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ge.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ge.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(di,{rounded:di.borderRadius,roundedTop:di.borderTopRadius,roundedTopLeft:di.borderTopLeftRadius,roundedTopRight:di.borderTopRightRadius,roundedTopStart:di.borderStartStartRadius,roundedTopEnd:di.borderStartEndRadius,roundedBottom:di.borderBottomRadius,roundedBottomLeft:di.borderBottomLeftRadius,roundedBottomRight:di.borderBottomRightRadius,roundedBottomStart:di.borderEndStartRadius,roundedBottomEnd:di.borderEndEndRadius,roundedLeft:di.borderLeftRadius,roundedRight:di.borderRightRadius,roundedStart:di.borderInlineStartRadius,roundedEnd:di.borderInlineEndRadius,borderStart:di.borderInlineStart,borderEnd:di.borderInlineEnd,borderTopStartRadius:di.borderStartStartRadius,borderTopEndRadius:di.borderStartEndRadius,borderBottomStartRadius:di.borderEndStartRadius,borderBottomEndRadius:di.borderEndEndRadius,borderStartRadius:di.borderInlineStartRadius,borderEndRadius:di.borderInlineEndRadius,borderStartWidth:di.borderInlineStartWidth,borderEndWidth:di.borderInlineEndWidth,borderStartColor:di.borderInlineStartColor,borderEndColor:di.borderInlineEndColor,borderStartStyle:di.borderInlineStartStyle,borderEndStyle:di.borderInlineEndStyle});const jve={color:Ge.colors("color"),textColor:Ge.colors("color"),fill:Ge.colors("fill"),stroke:Ge.colors("stroke"),accentColor:Ge.colors("accentColor"),textFillColor:Ge.colors("textFillColor")},MO={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:$r.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ge.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ge.space("gap"),rowGap:Ge.space("rowGap"),columnGap:Ge.space("columnGap")};Object.assign(MO,{flexDir:MO.flexDirection});const Ku={width:Ge.sizesT("width"),inlineSize:Ge.sizesT("inlineSize"),height:Ge.sizes("height"),blockSize:Ge.sizes("blockSize"),boxSize:Ge.sizes(["width","height"]),minWidth:Ge.sizes("minWidth"),minInlineSize:Ge.sizes("minInlineSize"),minHeight:Ge.sizes("minHeight"),minBlockSize:Ge.sizes("minBlockSize"),maxWidth:Ge.sizes("maxWidth"),maxInlineSize:Ge.sizes("maxInlineSize"),maxHeight:Ge.sizes("maxHeight"),maxBlockSize:Ge.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ge.propT("float",$r.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Ku,{w:Ku.width,h:Ku.height,minW:Ku.minWidth,maxW:Ku.maxWidth,minH:Ku.minHeight,maxH:Ku.maxHeight,overscroll:Ku.overscrollBehavior,overscrollX:Ku.overscrollBehaviorX,overscrollY:Ku.overscrollBehaviorY});const Bve={filter:{transform:$r.filter},blur:Ge.blur("--chakra-blur"),brightness:Ge.propT("--chakra-brightness",$r.brightness),contrast:Ge.propT("--chakra-contrast",$r.contrast),hueRotate:Ge.propT("--chakra-hue-rotate",$r.hueRotate),invert:Ge.propT("--chakra-invert",$r.invert),saturate:Ge.propT("--chakra-saturate",$r.saturate),dropShadow:Ge.propT("--chakra-drop-shadow",$r.dropShadow),backdropFilter:{transform:$r.backdropFilter},backdropBlur:Ge.blur("--chakra-backdrop-blur"),backdropBrightness:Ge.propT("--chakra-backdrop-brightness",$r.brightness),backdropContrast:Ge.propT("--chakra-backdrop-contrast",$r.contrast),backdropHueRotate:Ge.propT("--chakra-backdrop-hue-rotate",$r.hueRotate),backdropInvert:Ge.propT("--chakra-backdrop-invert",$r.invert),backdropSaturate:Ge.propT("--chakra-backdrop-saturate",$r.saturate)},zve={ring:{transform:$r.ring},ringColor:Ge.colors("--chakra-ring-color"),ringOffset:Ge.prop("--chakra-ring-offset-width"),ringOffsetColor:Ge.colors("--chakra-ring-offset-color"),ringInset:Ge.prop("--chakra-ring-inset")},Wve={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:$r.outline},outlineOffset:!0,outlineColor:Ge.colors("outlineColor")},NZ={gridGap:Ge.space("gridGap"),gridColumnGap:Ge.space("gridColumnGap"),gridRowGap:Ge.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function Gve(n,t,i,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const Hve=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const y=t.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,f);return y.set(l,v),v}},$ve=Hve(Gve),Kve={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},qve={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},wM=(n,t,i)=>{const a={},l=$ve(n,t,{});for(const d in l)d in i&&i[d]!=null||(a[d]=l[d]);return a},Yve={srOnly:{transform(n){return n===!0?Kve:n==="focusable"?qve:{}}},layerStyle:{processResult:!0,transform:(n,t,i)=>wM(t,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,t,i)=>wM(t,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,t,i)=>wM(t,n,i)}},uR={position:!0,pos:Ge.prop("position"),zIndex:Ge.prop("zIndex","zIndices"),inset:Ge.spaceT("inset"),insetX:Ge.spaceT(["left","right"]),insetInline:Ge.spaceT("insetInline"),insetY:Ge.spaceT(["top","bottom"]),insetBlock:Ge.spaceT("insetBlock"),top:Ge.spaceT("top"),insetBlockStart:Ge.spaceT("insetBlockStart"),bottom:Ge.spaceT("bottom"),insetBlockEnd:Ge.spaceT("insetBlockEnd"),left:Ge.spaceT("left"),insetInlineStart:Ge.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ge.spaceT("right"),insetInlineEnd:Ge.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(uR,{insetStart:uR.insetInlineStart,insetEnd:uR.insetInlineEnd});const HU={boxShadow:Ge.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ge.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ge.prop("backgroundBlendMode"),opacity:!0};Object.assign(HU,{shadow:HU.boxShadow});const rs={margin:Ge.spaceT("margin"),marginTop:Ge.spaceT("marginTop"),marginBlockStart:Ge.spaceT("marginBlockStart"),marginRight:Ge.spaceT("marginRight"),marginInlineEnd:Ge.spaceT("marginInlineEnd"),marginBottom:Ge.spaceT("marginBottom"),marginBlockEnd:Ge.spaceT("marginBlockEnd"),marginLeft:Ge.spaceT("marginLeft"),marginInlineStart:Ge.spaceT("marginInlineStart"),marginX:Ge.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ge.spaceT("marginInline"),marginY:Ge.spaceT(["marginTop","marginBottom"]),marginBlock:Ge.spaceT("marginBlock"),padding:Ge.space("padding"),paddingTop:Ge.space("paddingTop"),paddingBlockStart:Ge.space("paddingBlockStart"),paddingRight:Ge.space("paddingRight"),paddingBottom:Ge.space("paddingBottom"),paddingBlockEnd:Ge.space("paddingBlockEnd"),paddingLeft:Ge.space("paddingLeft"),paddingInlineStart:Ge.space("paddingInlineStart"),paddingInlineEnd:Ge.space("paddingInlineEnd"),paddingX:Ge.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ge.space("paddingInline"),paddingY:Ge.space(["paddingTop","paddingBottom"]),paddingBlock:Ge.space("paddingBlock")};Object.assign(rs,{m:rs.margin,mt:rs.marginTop,mr:rs.marginRight,me:rs.marginInlineEnd,marginEnd:rs.marginInlineEnd,mb:rs.marginBottom,ml:rs.marginLeft,ms:rs.marginInlineStart,marginStart:rs.marginInlineStart,mx:rs.marginX,my:rs.marginY,p:rs.padding,pt:rs.paddingTop,py:rs.paddingY,px:rs.paddingX,pb:rs.paddingBottom,pl:rs.paddingLeft,ps:rs.paddingInlineStart,paddingStart:rs.paddingInlineStart,pr:rs.paddingRight,pe:rs.paddingInlineEnd,paddingEnd:rs.paddingInlineEnd});const Xve={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ge.spaceT("scrollMargin"),scrollMarginTop:Ge.spaceT("scrollMarginTop"),scrollMarginBottom:Ge.spaceT("scrollMarginBottom"),scrollMarginLeft:Ge.spaceT("scrollMarginLeft"),scrollMarginRight:Ge.spaceT("scrollMarginRight"),scrollMarginX:Ge.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ge.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ge.spaceT("scrollPadding"),scrollPaddingTop:Ge.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ge.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ge.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ge.spaceT("scrollPaddingRight"),scrollPaddingX:Ge.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ge.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},Jve={fontFamily:Ge.prop("fontFamily","fonts"),fontSize:Ge.prop("fontSize","fontSizes",$r.px),fontWeight:Ge.prop("fontWeight","fontWeights"),lineHeight:Ge.prop("lineHeight","lineHeights"),letterSpacing:Ge.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},Qve={textDecorationColor:Ge.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ge.shadows("textShadow")},Zve={clipPath:!0,transform:Ge.propT("transform",$r.transform),transformOrigin:!0,translateX:Ge.spaceT("--chakra-translate-x"),translateY:Ge.spaceT("--chakra-translate-y"),skewX:Ge.degreeT("--chakra-skew-x"),skewY:Ge.degreeT("--chakra-skew-y"),scaleX:Ge.prop("--chakra-scale-x"),scaleY:Ge.prop("--chakra-scale-y"),scale:Ge.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ge.degreeT("--chakra-rotate")},eSe={listStyleType:!0,listStylePosition:!0,listStylePos:Ge.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ge.prop("listStyleImage")},tSe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ge.prop("transitionDuration","transition.duration"),transitionProperty:Ge.prop("transitionProperty","transition.property"),transitionTimingFunction:Ge.prop("transitionTimingFunction","transition.easing")},RF=_p({},eO,di,jve,MO,Ku,Bve,zve,Wve,NZ,Yve,uR,HU,rs,Xve,Jve,Qve,Zve,eSe,tSe),nSe=Object.assign({},rs,Ku,MO,NZ,uR),rSe=Object.keys(nSe),iSe=[...Object.keys(RF),...OZ],sSe={...RF,...FS},oSe=n=>n in sSe,aSe=n=>t=>{if(!t.__breakpoints)return n;const{isResponsive:i,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const f in n){let y=fl(n[f],t);if(y==null)continue;if(y=Yu(y)&&i(y)?a(y):y,!Array.isArray(y)){d[f]=y;continue}const v=y.slice(0,l.length).length;for(let b=0;b<v;b+=1){const R=l==null?void 0:l[b];if(!R){d[f]=y[b];continue}d[R]=d[R]||{},y[b]!=null&&(d[R][f]=y[b])}}return d};function cSe(n){const t=[];let i="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,i+=d):d===")"?(a=!1,i+=d):d===","&&!a?(t.push(i),i=""):i+=d}return i=i.trim(),i&&t.push(i),t}function lSe(n){return/^var\(--.+\)$/.test(n)}const uSe=(n,t)=>n.startsWith("--")&&typeof t=="string"&&!lSe(t),dSe=(n,t)=>{if(t==null)return t;const i=f=>{var y,v;return(v=(y=n.__cssMap)==null?void 0:y[f])==null?void 0:v.varRef},a=f=>i(f)??f,[l,d]=cSe(t);return t=i(l)??a(d)??a(t),t};function hSe(n){const{configs:t={},pseudos:i={},theme:a}=n,l=(d,f=!1)=>{var R;const y=fl(d,a),v=aSe(y)(a);let b={};for(let I in v){const k=v[I];let M=fl(k,a);I in i&&(I=i[I]),uSe(I,M)&&(M=dSe(a,M));let L=t[I];if(L===!0&&(L={property:I}),Yu(M)){b[I]=b[I]??{},b[I]=_p({},b[I],l(M,!0));continue}let j=((R=L==null?void 0:L.transform)==null?void 0:R.call(L,M,a,y))??M;j=L!=null&&L.processResult?l(j,!0):j;const z=fl(L==null?void 0:L.property,a);if(!f&&(L!=null&&L.static)){const Y=fl(L.static,a);b=_p({},b,Y)}if(z&&Array.isArray(z)){for(const Y of z)b[Y]=j;continue}if(z){z==="&"&&Yu(j)?b=_p({},b,j):b[z]=j;continue}if(Yu(j)){b=_p({},b,j);continue}b[I]=j}return b};return l}const DZ=n=>t=>hSe({theme:t,pseudos:FS,configs:RF})(n);function PGe(n){return n}function OGe(n){return n}function Ji(n){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:n,...t}}}}function pSe(n,t,i){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${t}.${i}`])==null?void 0:l.varRef)??i}function fSe(n,t){if(Array.isArray(n))return n;if(Yu(n))return t(n);if(n!=null)return[n]}function mSe(n,t){for(let i=t+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function gSe(n){const t=n.__breakpoints;return function(a,l,d,f){var k,M;if(!t)return;const y={},v=fSe(d,t.toArrayValue);if(!v)return y;const b=v.length,R=b===1,I=!!a.parts;for(let L=0;L<b;L++){const j=t.details[L],z=t.details[mSe(v,L)],Y=WT(j.minW,z==null?void 0:z._minW),K=fl((k=a[l])==null?void 0:k[v[L]],f);if(K){if(I){(M=a.parts)==null||M.forEach(ne=>{_p(y,{[ne]:R?K[ne]:{[Y]:K[ne]}})});continue}if(!I){R?_p(y,K):y[Y]=K;continue}y[Y]=K}}return y}}function _Se(n){return t=>{const{variant:i,size:a,theme:l}=t,d=gSe(l);return _p({},fl(n.baseStyle??{},t),d(n,"sizes",a,t),d(n,"variants",i,t))}}function Gi(n){return k0(n,["styleConfig","size","variant","colorScheme"])}function xZ(n){return Yu(n)&&n.reference?n.reference:String(n)}const Ak=(n,...t)=>t.map(xZ).join(` ${n} `).replace(/calc/g,""),FK=(...n)=>`calc(${Ak("+",...n)})`,jK=(...n)=>`calc(${Ak("-",...n)})`,$U=(...n)=>`calc(${Ak("*",...n)})`,BK=(...n)=>`calc(${Ak("/",...n)})`,zK=n=>{const t=xZ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:$U(t,-1)},Sf=Object.assign(n=>({add:(...t)=>Sf(FK(n,...t)),subtract:(...t)=>Sf(jK(n,...t)),multiply:(...t)=>Sf($U(n,...t)),divide:(...t)=>Sf(BK(n,...t)),negate:()=>Sf(zK(n)),toString:()=>n.toString()}),{add:FK,subtract:jK,multiply:$U,divide:BK,negate:zK});function ySe(n,t="-"){return n.replace(/\s+/g,t)}function ESe(n){const t=ySe(n.toString());return SSe(vSe(t))}function vSe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function SSe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function bSe(n,t=""){return[t,n].filter(Boolean).join("-")}function wSe(n,t){return`var(${n}${t?`, ${t}`:""})`}function TSe(n,t=""){return ESe(`--${bSe(n,t)}`)}function zn(n,t,i){const a=TSe(n,i);return{variable:a,reference:wSe(a,t)}}function RSe(n,t){const i={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;i[l]=zn(`${n}-${l}`,d);continue}i[a]=zn(`${n}-${a}`)}return i}const CSe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function ISe(n){return gZ(n,CSe)}function ASe(n){return n.semanticTokens}function PSe(n){const{__cssMap:t,__cssVars:i,__breakpoints:a,...l}=n;return l}function OSe(n){const t=ISe(n),i=ASe(n),a=d=>OZ.includes(d)||d==="default",l={};return PK(t,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),PK(i,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function WK(n,t){return zn(String(n).replace(/\./g,"-"),void 0,t)}function kSe(n){var f;const t=OSe(n),i=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(y,v){const R=[String(y).split(".")[0],v].join(".");if(!t[R])return v;const{reference:k}=WK(R,i);return k}for(const[y,v]of Object.entries(t)){const{isSemantic:b,value:R}=v,{variable:I,reference:k}=WK(y,i);if(!b){if(y.startsWith("space")){const L=y.split("."),[j,...z]=L,Y=`${j}.-${z.join(".")}`,K=Sf.negate(R),ne=Sf.negate(k);l[Y]={value:K,var:I,varRef:ne}}a[I]=R,l[y]={value:R,var:I,varRef:k};continue}const M=Yu(R)?R:{default:R};a=_p(a,Object.entries(M).reduce((L,[j,z])=>{if(!z)return L;const Y=d(y,`${z}`);if(j==="default")return L[I]=Y,L;const K=(FS==null?void 0:FS[j])??j;return L[K]={[I]:Y},L},{})),l[y]={value:k,var:I,varRef:k}}return{cssVars:a,cssMap:l}}function NSe(n){const t=PSe(n),{cssMap:i,cssVars:a}=kSe(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:i,__breakpoints:wEe(t.breakpoints)}),t}function mi(n,t={}){let i=!1;function a(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...R){a();for(const I of R)t[I]=v(I);return mi(n,t)}function d(...R){for(const I of R)I in t||(t[I]=v(I));return mi(n,t)}function f(){return Object.fromEntries(Object.entries(t).map(([I,k])=>[I,k.selector]))}function y(){return Object.fromEntries(Object.entries(t).map(([I,k])=>[I,k.className]))}function v(R){const M=`chakra-${(["container","root"].includes(R??"")?[n]:[n,R]).filter(Boolean).join("__")}`;return{className:M,selector:`.${M}`,toString:()=>R}}return{parts:l,toPart:v,extend:d,selectors:f,classnames:y,get keys(){return Object.keys(t)},__type:{}}}const DSe=mi("accordion").parts("root","container","button","panel","icon"),xSe=mi("alert").parts("title","description","container","icon","spinner"),LSe=mi("avatar").parts("label","badge","container","excessLabel","group"),MSe=mi("breadcrumb").parts("link","item","container","separator");mi("button").parts();const USe=mi("checkbox").parts("control","icon","container","label");mi("progress").parts("track","filledTrack","label");const VSe=mi("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),FSe=mi("editable").parts("preview","input","textarea"),jSe=mi("form").parts("container","requiredIndicator","helperText"),BSe=mi("formError").parts("text","icon"),zSe=mi("input").parts("addon","field","element","group"),WSe=mi("list").parts("container","item","icon"),GSe=mi("menu").parts("button","list","item","groupTitle","icon","command","divider"),HSe=mi("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),$Se=mi("numberinput").parts("root","field","stepperGroup","stepper");mi("pininput").parts("field");const KSe=mi("popover").parts("content","header","body","footer","popper","arrow","closeButton"),qSe=mi("progress").parts("label","filledTrack","track"),YSe=mi("radio").parts("container","control","label"),XSe=mi("select").parts("field","icon"),JSe=mi("slider").parts("container","track","thumb","filledTrack","mark"),QSe=mi("stat").parts("container","label","helpText","number","icon"),ZSe=mi("switch").parts("container","track","thumb","label"),e0e=mi("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),t0e=mi("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),n0e=mi("tag").parts("container","label","closeButton"),r0e=mi("card").parts("container","header","body","footer");mi("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:i0e,defineMultiStyleConfig:s0e}=Ji(DSe.keys),o0e={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},a0e={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},c0e={pt:"2",px:"4",pb:"5"},l0e={fontSize:"1.25em"},u0e=i0e({container:o0e,button:a0e,panel:c0e,icon:l0e}),d0e=s0e({baseStyle:u0e});function by(n,t,i){return Math.min(Math.max(n,i),t)}class h0e extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var HT=h0e;function CF(n){if(typeof n!="string")throw new HT(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=v0e.test(n)?m0e(n):n;const i=g0e.exec(t);if(i){const f=Array.from(i).slice(1);return[...f.slice(0,3).map(y=>parseInt(LR(y,2),16)),parseInt(LR(f[3]||"f",2),16)/255]}const a=_0e.exec(t);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(y=>parseInt(y,16)),parseInt(f[3]||"ff",16)/255]}const l=y0e.exec(t);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(y=>parseInt(y,10)),parseFloat(f[3]||"1")]}const d=E0e.exec(t);if(d){const[f,y,v,b]=Array.from(d).slice(1).map(parseFloat);if(by(0,100,y)!==y)throw new HT(n);if(by(0,100,v)!==v)throw new HT(n);return[...S0e(f,y,v),Number.isNaN(b)?1:b]}throw new HT(n)}function p0e(n){let t=5381,i=n.length;for(;i;)t=t*33^n.charCodeAt(--i);return(t>>>0)%2341}const GK=n=>parseInt(n.replace(/_/g,""),36),f0e="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const i=GK(t.substring(0,3)),a=GK(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[i]=`${l}${a}`,n},{});function m0e(n){const t=n.toLowerCase().trim(),i=f0e[p0e(t)];if(!i)throw new HT(n);return`#${i}`}const LR=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),g0e=new RegExp(`^#${LR("([a-f0-9])",3)}([a-f0-9])?$`,"i"),_0e=new RegExp(`^#${LR("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),y0e=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${LR(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),E0e=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,v0e=/^[a-z]+$/i,HK=n=>Math.round(n*255),S0e=(n,t,i)=>{let a=i/100;if(t===0)return[a,a,a].map(HK);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),f=d*(1-Math.abs(l%2-1));let y=0,v=0,b=0;l>=0&&l<1?(y=d,v=f):l>=1&&l<2?(y=f,v=d):l>=2&&l<3?(v=d,b=f):l>=3&&l<4?(v=f,b=d):l>=4&&l<5?(y=f,b=d):l>=5&&l<6&&(y=d,b=f);const R=a-d/2,I=y+R,k=v+R,M=b+R;return[I,k,M].map(HK)};function b0e(n,t,i,a){return`rgba(${by(0,255,n).toFixed()}, ${by(0,255,t).toFixed()}, ${by(0,255,i).toFixed()}, ${parseFloat(by(0,1,a).toFixed(3))})`}function w0e(n,t){const[i,a,l,d]=CF(n);return b0e(i,a,l,d-t)}function T0e(n){const[t,i,a,l]=CF(n);let d=f=>{const y=by(0,255,f).toString(16);return y.length===1?`0${y}`:y};return`#${d(t)}${d(i)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const R0e=n=>Object.keys(n).length===0;function C0e(n,t,i,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)n=n?n[t[a]]:l;return n===l?i:n}const Nc=(n,t,i)=>{const a=C0e(n,`colors.${t}`,t);try{return T0e(a),a}catch{return i??"#000000"}},I0e=n=>{const[t,i,a]=CF(n);return(t*299+i*587+a*114)/1e3},A0e=n=>t=>{const i=Nc(t,n);return I0e(i)<128?"dark":"light"},P0e=n=>t=>A0e(n)(t)==="dark",s0=(n,t)=>i=>{const a=Nc(i,n);return w0e(a,1-t)};function $K(n="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const O0e=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function k0e(n){const t=O0e();return!n||R0e(n)?t:n.string&&n.colors?D0e(n.string,n.colors):n.string&&!n.colors?N0e(n.string):n.colors&&!n.string?x0e(n.colors):t}function N0e(n){let t=0;if(n.length===0)return t.toString();for(let a=0;a<n.length;a+=1)t=n.charCodeAt(a)+((t<<5)-t),t=t&t;let i="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function D0e(n,t){let i=0;if(n.length===0)return t[0];for(let a=0;a<n.length;a+=1)i=n.charCodeAt(a)+((i<<5)-i),i=i&i;return i=(i%t.length+t.length)%t.length,t[i]}function x0e(n){return n[Math.floor(Math.random()*n.length)]}function Bn(n,t){return i=>i.colorMode==="dark"?t:n}function IF(n){const{orientation:t,vertical:i,horizontal:a}=n;return t?t==="vertical"?i:a:{}}function LZ(n){return Yu(n)&&n.reference?n.reference:String(n)}const Pk=(n,...t)=>t.map(LZ).join(` ${n} `).replace(/calc/g,""),KK=(...n)=>`calc(${Pk("+",...n)})`,qK=(...n)=>`calc(${Pk("-",...n)})`,KU=(...n)=>`calc(${Pk("*",...n)})`,YK=(...n)=>`calc(${Pk("/",...n)})`,XK=n=>{const t=LZ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:KU(t,-1)},bf=Object.assign(n=>({add:(...t)=>bf(KK(n,...t)),subtract:(...t)=>bf(qK(n,...t)),multiply:(...t)=>bf(KU(n,...t)),divide:(...t)=>bf(YK(n,...t)),negate:()=>bf(XK(n)),toString:()=>n.toString()}),{add:KK,subtract:qK,multiply:KU,divide:YK,negate:XK});function L0e(n){return!Number.isInteger(parseFloat(n.toString()))}function M0e(n,t="-"){return n.replace(/\s+/g,t)}function MZ(n){const t=M0e(n.toString());return t.includes("\\.")?n:L0e(n)?t.replace(".","\\."):n}function U0e(n,t=""){return[t,MZ(n)].filter(Boolean).join("-")}function V0e(n,t){return`var(${MZ(n)}${t?`, ${t}`:""})`}function F0e(n,t=""){return`--${U0e(n,t)}`}function Ko(n,t){const i=F0e(n,t==null?void 0:t.prefix);return{variable:i,reference:V0e(i,j0e(t==null?void 0:t.fallback))}}function j0e(n){return n==null?void 0:n.reference}const{definePartsStyle:dC,defineMultiStyleConfig:B0e}=Ji(xSe.keys),Zl=zn("alert-fg"),Mf=zn("alert-bg"),z0e=dC({container:{bg:Mf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Zl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Zl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function AF(n){const{theme:t,colorScheme:i}=n,a=s0(`${i}.200`,.16)(t);return{light:`colors.${i}.100`,dark:a}}const W0e=dC(n=>{const{colorScheme:t}=n,i=AF(n);return{container:{[Zl.variable]:`colors.${t}.600`,[Mf.variable]:i.light,_dark:{[Zl.variable]:`colors.${t}.200`,[Mf.variable]:i.dark}}}}),G0e=dC(n=>{const{colorScheme:t}=n,i=AF(n);return{container:{[Zl.variable]:`colors.${t}.600`,[Mf.variable]:i.light,_dark:{[Zl.variable]:`colors.${t}.200`,[Mf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Zl.reference}}}),H0e=dC(n=>{const{colorScheme:t}=n,i=AF(n);return{container:{[Zl.variable]:`colors.${t}.600`,[Mf.variable]:i.light,_dark:{[Zl.variable]:`colors.${t}.200`,[Mf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Zl.reference}}}),$0e=dC(n=>{const{colorScheme:t}=n;return{container:{[Zl.variable]:"colors.white",[Mf.variable]:`colors.${t}.600`,_dark:{[Zl.variable]:"colors.gray.900",[Mf.variable]:`colors.${t}.200`},color:Zl.reference}}}),K0e={subtle:W0e,"left-accent":G0e,"top-accent":H0e,solid:$0e},q0e=B0e({baseStyle:z0e,variants:K0e,defaultProps:{variant:"subtle",colorScheme:"blue"}}),UZ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},Y0e={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},X0e={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},VZ={...UZ,...Y0e,container:X0e},J0e=n=>typeof n=="function";function Dc(n,...t){return J0e(n)?n(...t):n}const{definePartsStyle:FZ,defineMultiStyleConfig:Q0e}=Ji(LSe.keys),jS=zn("avatar-border-color"),dR=zn("avatar-bg"),MR=zn("avatar-font-size"),o0=zn("avatar-size"),Z0e={borderRadius:"full",border:"0.2em solid",borderColor:jS.reference,[jS.variable]:"white",_dark:{[jS.variable]:"colors.gray.800"}},ebe={bg:dR.reference,fontSize:MR.reference,width:o0.reference,height:o0.reference,lineHeight:"1",[dR.variable]:"colors.gray.200",_dark:{[dR.variable]:"colors.whiteAlpha.400"}},tbe=n=>{const{name:t,theme:i}=n,a=t?k0e({string:t}):"colors.gray.400",l=P0e(a)(i);let d="white";return l||(d="gray.800"),{bg:dR.reference,fontSize:MR.reference,color:d,borderColor:jS.reference,verticalAlign:"top",width:o0.reference,height:o0.reference,"&:not([data-loaded])":{[dR.variable]:a},[jS.variable]:"colors.white",_dark:{[jS.variable]:"colors.gray.800"}}},nbe={fontSize:MR.reference,lineHeight:"1"},rbe=FZ(n=>({badge:Dc(Z0e,n),excessLabel:Dc(ebe,n),container:Dc(tbe,n),label:nbe}));function ig(n){const t=n!=="100%"?VZ[n]:void 0;return FZ({container:{[o0.variable]:t??n,[MR.variable]:`calc(${t??n} / 2.5)`},excessLabel:{[o0.variable]:t??n,[MR.variable]:`calc(${t??n} / 2.5)`}})}const ibe={"2xs":ig(4),xs:ig(6),sm:ig(8),md:ig(12),lg:ig(16),xl:ig(24),"2xl":ig(32),full:ig("100%")},sbe=Q0e({baseStyle:rbe,sizes:ibe,defaultProps:{size:"md"}}),uo=RSe("badge",["bg","color","shadow"]),obe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:uo.bg.reference,color:uo.color.reference,boxShadow:uo.shadow.reference},abe=n=>{const{colorScheme:t,theme:i}=n,a=s0(`${t}.500`,.6)(i);return{[uo.bg.variable]:`colors.${t}.500`,[uo.color.variable]:"colors.white",_dark:{[uo.bg.variable]:a,[uo.color.variable]:"colors.whiteAlpha.800"}}},cbe=n=>{const{colorScheme:t,theme:i}=n,a=s0(`${t}.200`,.16)(i);return{[uo.bg.variable]:`colors.${t}.100`,[uo.color.variable]:`colors.${t}.800`,_dark:{[uo.bg.variable]:a,[uo.color.variable]:`colors.${t}.200`}}},lbe=n=>{const{colorScheme:t,theme:i}=n,a=s0(`${t}.200`,.8)(i);return{[uo.color.variable]:`colors.${t}.500`,_dark:{[uo.color.variable]:a},[uo.shadow.variable]:`inset 0 0 0px 1px ${uo.color.reference}`}},ube={solid:abe,subtle:cbe,outline:lbe},hR={baseStyle:obe,variants:ube,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:dbe,definePartsStyle:hbe}=Ji(MSe.keys),TM=zn("breadcrumb-link-decor"),pbe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:TM.reference,[TM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[TM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},fbe=hbe({link:pbe}),mbe=dbe({baseStyle:fbe}),gbe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},jZ=n=>{const{colorScheme:t,theme:i}=n;if(t==="gray")return{color:Bn("gray.800","whiteAlpha.900")(n),_hover:{bg:Bn("gray.100","whiteAlpha.200")(n)},_active:{bg:Bn("gray.200","whiteAlpha.300")(n)}};const a=s0(`${t}.200`,.12)(i),l=s0(`${t}.200`,.24)(i);return{color:Bn(`${t}.600`,`${t}.200`)(n),bg:"transparent",_hover:{bg:Bn(`${t}.50`,a)(n)},_active:{bg:Bn(`${t}.100`,l)(n)}}},_be=n=>{const{colorScheme:t}=n,i=Bn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:t==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Dc(jZ,n)}},ybe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},Ebe=n=>{const{colorScheme:t}=n;if(t==="gray"){const y=Bn("gray.100","whiteAlpha.200")(n);return{bg:y,color:Bn("gray.800","whiteAlpha.900")(n),_hover:{bg:Bn("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:Bn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=ybe[t]??{},f=Bn(i,`${t}.200`)(n);return{bg:f,color:Bn(a,"gray.800")(n),_hover:{bg:Bn(l,`${t}.300`)(n),_disabled:{bg:f}},_active:{bg:Bn(d,`${t}.400`)(n)}}},vbe=n=>{const{colorScheme:t}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Bn(`${t}.500`,`${t}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Bn(`${t}.700`,`${t}.500`)(n)}}},Sbe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},bbe={ghost:jZ,outline:_be,solid:Ebe,link:vbe,unstyled:Sbe},wbe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},Tbe={baseStyle:gbe,variants:bbe,sizes:wbe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Ay,defineMultiStyleConfig:Rbe}=Ji(r0e.keys),UO=zn("card-bg"),Pf=zn("card-padding"),BZ=zn("card-shadow"),tO=zn("card-radius"),zZ=zn("card-border-width","0"),WZ=zn("card-border-color"),Cbe=Ay({container:{[UO.variable]:"colors.chakra-body-bg",backgroundColor:UO.reference,boxShadow:BZ.reference,borderRadius:tO.reference,color:"chakra-body-text",borderWidth:zZ.reference,borderColor:WZ.reference},body:{padding:Pf.reference,flex:"1 1 0%"},header:{padding:Pf.reference},footer:{padding:Pf.reference}}),Ibe={sm:Ay({container:{[tO.variable]:"radii.base",[Pf.variable]:"space.3"}}),md:Ay({container:{[tO.variable]:"radii.md",[Pf.variable]:"space.5"}}),lg:Ay({container:{[tO.variable]:"radii.xl",[Pf.variable]:"space.7"}})},Abe={elevated:Ay({container:{[BZ.variable]:"shadows.base",_dark:{[UO.variable]:"colors.gray.700"}}}),outline:Ay({container:{[zZ.variable]:"1px",[WZ.variable]:"colors.chakra-border-color"}}),filled:Ay({container:{[UO.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Pf.variable]:0},header:{[Pf.variable]:0},footer:{[Pf.variable]:0}}},Pbe=Rbe({baseStyle:Cbe,variants:Abe,sizes:Ibe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:nO,defineMultiStyleConfig:Obe}=Ji(USe.keys),pR=zn("checkbox-size"),kbe=n=>{const{colorScheme:t}=n;return{w:pR.reference,h:pR.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Bn(`${t}.500`,`${t}.200`)(n),borderColor:Bn(`${t}.500`,`${t}.200`)(n),color:Bn("white","gray.900")(n),_hover:{bg:Bn(`${t}.600`,`${t}.300`)(n),borderColor:Bn(`${t}.600`,`${t}.300`)(n)},_disabled:{borderColor:Bn("gray.200","transparent")(n),bg:Bn("gray.200","whiteAlpha.300")(n),color:Bn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Bn(`${t}.500`,`${t}.200`)(n),borderColor:Bn(`${t}.500`,`${t}.200`)(n),color:Bn("white","gray.900")(n)},_disabled:{bg:Bn("gray.100","whiteAlpha.100")(n),borderColor:Bn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Bn("red.500","red.300")(n)}}},Nbe={_disabled:{cursor:"not-allowed"}},Dbe={userSelect:"none",_disabled:{opacity:.4}},xbe={transitionProperty:"transform",transitionDuration:"normal"},Lbe=nO(n=>({icon:xbe,container:Nbe,control:Dc(kbe,n),label:Dbe})),Mbe={sm:nO({control:{[pR.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:nO({control:{[pR.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:nO({control:{[pR.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},lg=Obe({baseStyle:Lbe,sizes:Mbe,defaultProps:{size:"md",colorScheme:"blue"}}),fR=Ko("close-button-size"),IT=Ko("close-button-bg"),Ube={w:[fR.reference],h:[fR.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[IT.variable]:"colors.blackAlpha.100",_dark:{[IT.variable]:"colors.whiteAlpha.100"}},_active:{[IT.variable]:"colors.blackAlpha.200",_dark:{[IT.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:IT.reference},Vbe={lg:{[fR.variable]:"sizes.10",fontSize:"md"},md:{[fR.variable]:"sizes.8",fontSize:"xs"},sm:{[fR.variable]:"sizes.6",fontSize:"2xs"}},Fbe={baseStyle:Ube,sizes:Vbe,defaultProps:{size:"md"}},{variants:jbe,defaultProps:Bbe}=hR,zbe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:uo.bg.reference,color:uo.color.reference,boxShadow:uo.shadow.reference},Wbe={baseStyle:zbe,variants:jbe,defaultProps:Bbe},Gbe={w:"100%",mx:"auto",maxW:"prose",px:"4"},Hbe={baseStyle:Gbe},$be={opacity:.6,borderColor:"inherit"},Kbe={borderStyle:"solid"},qbe={borderStyle:"dashed"},Ybe={solid:Kbe,dashed:qbe},Xbe={baseStyle:$be,variants:Ybe,defaultProps:{variant:"solid"}},{definePartsStyle:qU,defineMultiStyleConfig:Jbe}=Ji(VSe.keys),RM=zn("drawer-bg"),CM=zn("drawer-box-shadow");function pS(n){return qU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const Qbe={bg:"blackAlpha.600",zIndex:"modal"},Zbe={display:"flex",zIndex:"modal",justifyContent:"center"},ewe=n=>{const{isFullHeight:t}=n;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[RM.variable]:"colors.white",[CM.variable]:"shadows.lg",_dark:{[RM.variable]:"colors.gray.700",[CM.variable]:"shadows.dark-lg"},bg:RM.reference,boxShadow:CM.reference}},twe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},nwe={position:"absolute",top:"2",insetEnd:"3"},rwe={px:"6",py:"2",flex:"1",overflow:"auto"},iwe={px:"6",py:"4"},swe=qU(n=>({overlay:Qbe,dialogContainer:Zbe,dialog:Dc(ewe,n),header:twe,closeButton:nwe,body:rwe,footer:iwe})),owe={xs:pS("xs"),sm:pS("md"),md:pS("lg"),lg:pS("2xl"),xl:pS("4xl"),full:pS("full")},awe=Jbe({baseStyle:swe,sizes:owe,defaultProps:{size:"xs"}}),{definePartsStyle:cwe,defineMultiStyleConfig:lwe}=Ji(FSe.keys),uwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},dwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},hwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},pwe=cwe({preview:uwe,input:dwe,textarea:hwe}),fwe=lwe({baseStyle:pwe}),{definePartsStyle:mwe,defineMultiStyleConfig:gwe}=Ji(jSe.keys),BS=zn("form-control-color"),_we={marginStart:"1",[BS.variable]:"colors.red.500",_dark:{[BS.variable]:"colors.red.300"},color:BS.reference},ywe={mt:"2",[BS.variable]:"colors.gray.600",_dark:{[BS.variable]:"colors.whiteAlpha.600"},color:BS.reference,lineHeight:"normal",fontSize:"sm"},Ewe=mwe({container:{width:"100%",position:"relative"},requiredIndicator:_we,helperText:ywe}),vwe=gwe({baseStyle:Ewe}),{definePartsStyle:Swe,defineMultiStyleConfig:bwe}=Ji(BSe.keys),zS=zn("form-error-color"),wwe={[zS.variable]:"colors.red.500",_dark:{[zS.variable]:"colors.red.300"},color:zS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Twe={marginEnd:"0.5em",[zS.variable]:"colors.red.500",_dark:{[zS.variable]:"colors.red.300"},color:zS.reference},Rwe=Swe({text:wwe,icon:Twe}),Cwe=bwe({baseStyle:Rwe}),Iwe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},Awe={baseStyle:Iwe},Pwe={fontFamily:"heading",fontWeight:"bold"},Owe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},kwe={baseStyle:Pwe,sizes:Owe,defaultProps:{size:"xl"}},{definePartsStyle:Tf,defineMultiStyleConfig:Nwe}=Ji(zSe.keys),CS=zn("input-height"),IS=zn("input-font-size"),AS=zn("input-padding"),PS=zn("input-border-radius"),Dwe=Tf({addon:{height:CS.reference,fontSize:IS.reference,px:AS.reference,borderRadius:PS.reference},field:{width:"100%",height:CS.reference,fontSize:IS.reference,px:AS.reference,borderRadius:PS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),sg={lg:{[IS.variable]:"fontSizes.lg",[AS.variable]:"space.4",[PS.variable]:"radii.md",[CS.variable]:"sizes.12"},md:{[IS.variable]:"fontSizes.md",[AS.variable]:"space.4",[PS.variable]:"radii.md",[CS.variable]:"sizes.10"},sm:{[IS.variable]:"fontSizes.sm",[AS.variable]:"space.3",[PS.variable]:"radii.sm",[CS.variable]:"sizes.8"},xs:{[IS.variable]:"fontSizes.xs",[AS.variable]:"space.2",[PS.variable]:"radii.sm",[CS.variable]:"sizes.6"}},xwe={lg:Tf({field:sg.lg,group:sg.lg}),md:Tf({field:sg.md,group:sg.md}),sm:Tf({field:sg.sm,group:sg.sm}),xs:Tf({field:sg.xs,group:sg.xs})};function PF(n){const{focusBorderColor:t,errorBorderColor:i}=n;return{focusBorderColor:t||Bn("blue.500","blue.300")(n),errorBorderColor:i||Bn("red.500","red.300")(n)}}const Lwe=Tf(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=PF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Bn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Nc(t,a),boxShadow:`0 0 0 1px ${Nc(t,a)}`},_focusVisible:{zIndex:1,borderColor:Nc(t,i),boxShadow:`0 0 0 1px ${Nc(t,i)}`}},addon:{border:"1px solid",borderColor:Bn("inherit","whiteAlpha.50")(n),bg:Bn("gray.100","whiteAlpha.300")(n)}}}),Mwe=Tf(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=PF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Bn("gray.100","whiteAlpha.50")(n),_hover:{bg:Bn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Nc(t,a)},_focusVisible:{bg:"transparent",borderColor:Nc(t,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Bn("gray.100","whiteAlpha.50")(n)}}}),Uwe=Tf(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=PF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Nc(t,a),boxShadow:`0px 1px 0px 0px ${Nc(t,a)}`},_focusVisible:{borderColor:Nc(t,i),boxShadow:`0px 1px 0px 0px ${Nc(t,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),Vwe=Tf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),Fwe={outline:Lwe,filled:Mwe,flushed:Uwe,unstyled:Vwe},fi=Nwe({baseStyle:Dwe,sizes:xwe,variants:Fwe,defaultProps:{size:"md",variant:"outline"}}),IM=zn("kbd-bg"),jwe={[IM.variable]:"colors.gray.100",_dark:{[IM.variable]:"colors.whiteAlpha.100"},bg:IM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},Bwe={baseStyle:jwe},zwe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},Wwe={baseStyle:zwe},{defineMultiStyleConfig:Gwe,definePartsStyle:Hwe}=Ji(WSe.keys),$we={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},Kwe=Hwe({icon:$we}),qwe=Gwe({baseStyle:Kwe}),{defineMultiStyleConfig:Ywe,definePartsStyle:Xwe}=Ji(GSe.keys),cp=zn("menu-bg"),AM=zn("menu-shadow"),Jwe={[cp.variable]:"#fff",[AM.variable]:"shadows.sm",_dark:{[cp.variable]:"colors.gray.700",[AM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:cp.reference,boxShadow:AM.reference},Qwe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[cp.variable]:"colors.gray.100",_dark:{[cp.variable]:"colors.whiteAlpha.100"}},_active:{[cp.variable]:"colors.gray.200",_dark:{[cp.variable]:"colors.whiteAlpha.200"}},_expanded:{[cp.variable]:"colors.gray.100",_dark:{[cp.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:cp.reference},Zwe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},eTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},tTe={opacity:.6},nTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},rTe={transitionProperty:"common",transitionDuration:"normal"},iTe=Xwe({button:rTe,list:Jwe,item:Qwe,groupTitle:Zwe,icon:eTe,command:tTe,divider:nTe}),sTe=Ywe({baseStyle:iTe}),{defineMultiStyleConfig:oTe,definePartsStyle:YU}=Ji(HSe.keys),PM=zn("modal-bg"),OM=zn("modal-shadow"),aTe={bg:"blackAlpha.600",zIndex:"modal"},cTe=n=>{const{isCentered:t,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},lTe=n=>{const{isCentered:t,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[PM.variable]:"colors.white",[OM.variable]:"shadows.lg",_dark:{[PM.variable]:"colors.gray.700",[OM.variable]:"shadows.dark-lg"},bg:PM.reference,boxShadow:OM.reference}},uTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},dTe={position:"absolute",top:"2",insetEnd:"3"},hTe=n=>{const{scrollBehavior:t}=n;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},pTe={px:"6",py:"4"},fTe=YU(n=>({overlay:aTe,dialogContainer:Dc(cTe,n),dialog:Dc(lTe,n),header:uTe,closeButton:dTe,body:Dc(hTe,n),footer:pTe}));function qd(n){return YU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const mTe={xs:qd("xs"),sm:qd("sm"),md:qd("md"),lg:qd("lg"),xl:qd("xl"),"2xl":qd("2xl"),"3xl":qd("3xl"),"4xl":qd("4xl"),"5xl":qd("5xl"),"6xl":qd("6xl"),full:qd("full")},gTe=oTe({baseStyle:fTe,sizes:mTe,defaultProps:{size:"md"}}),GZ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:_Te,definePartsStyle:HZ}=Ji($Se.keys),OF=Ko("number-input-stepper-width"),$Z=Ko("number-input-input-padding"),yTe=bf(OF).add("0.5rem").toString(),kM=Ko("number-input-bg"),NM=Ko("number-input-color"),DM=Ko("number-input-border-color"),ETe={[OF.variable]:"sizes.6",[$Z.variable]:yTe},vTe=n=>{var t;return((t=Dc(fi.baseStyle,n))==null?void 0:t.field)??{}},STe={width:OF.reference},bTe={borderStart:"1px solid",borderStartColor:DM.reference,color:NM.reference,bg:kM.reference,[NM.variable]:"colors.chakra-body-text",[DM.variable]:"colors.chakra-border-color",_dark:{[NM.variable]:"colors.whiteAlpha.800",[DM.variable]:"colors.whiteAlpha.300"},_active:{[kM.variable]:"colors.gray.200",_dark:{[kM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},wTe=HZ(n=>({root:ETe,field:Dc(vTe,n)??{},stepperGroup:STe,stepper:bTe}));function b1(n){var d,f;const t=(d=fi.sizes)==null?void 0:d[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=t.field)==null?void 0:f.fontSize)??"md",l=GZ.fontSizes[a];return HZ({field:{...t.field,paddingInlineEnd:$Z.reference,verticalAlign:"top"},stepper:{fontSize:bf(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const TTe={xs:b1("xs"),sm:b1("sm"),md:b1("md"),lg:b1("lg")},RTe=_Te({baseStyle:wTe,sizes:TTe,variants:fi.variants,defaultProps:fi.defaultProps});var WQ;const CTe={...(WQ=fi.baseStyle)==null?void 0:WQ.field,textAlign:"center"},ITe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var GQ;const ATe={outline:n=>{var t,i;return((i=Dc((t=fi.variants)==null?void 0:t.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var t,i;return((i=Dc((t=fi.variants)==null?void 0:t.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var t,i;return((i=Dc((t=fi.variants)==null?void 0:t.filled,n))==null?void 0:i.field)??{}},unstyled:((GQ=fi.variants)==null?void 0:GQ.unstyled.field)??{}},PTe={baseStyle:CTe,sizes:ITe,variants:ATe,defaultProps:fi.defaultProps},{defineMultiStyleConfig:OTe,definePartsStyle:kTe}=Ji(KSe.keys),w1=Ko("popper-bg"),NTe=Ko("popper-arrow-bg"),JK=Ko("popper-arrow-shadow-color"),DTe={zIndex:"popover"},xTe={[w1.variable]:"colors.white",bg:w1.reference,[NTe.variable]:w1.reference,[JK.variable]:"colors.gray.200",_dark:{[w1.variable]:"colors.gray.700",[JK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},LTe={px:3,py:2,borderBottomWidth:"1px"},MTe={px:3,py:2},UTe={px:3,py:2,borderTopWidth:"1px"},VTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},FTe=kTe({popper:DTe,content:xTe,header:LTe,body:MTe,footer:UTe,closeButton:VTe}),jTe=OTe({baseStyle:FTe}),{defineMultiStyleConfig:BTe,definePartsStyle:$T}=Ji(qSe.keys),zTe=n=>{const{colorScheme:t,theme:i,isIndeterminate:a,hasStripe:l}=n,d=Bn($K(),$K("1rem","rgba(0,0,0,0.1)"))(n),f=Bn(`${t}.500`,`${t}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${Nc(i,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:y}:{bgColor:f}}},WTe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},GTe=n=>({bg:Bn("gray.100","whiteAlpha.300")(n)}),HTe=n=>({transitionProperty:"common",transitionDuration:"slow",...zTe(n)}),$Te=$T(n=>({label:WTe,filledTrack:HTe(n),track:GTe(n)})),KTe={xs:$T({track:{h:"1"}}),sm:$T({track:{h:"2"}}),md:$T({track:{h:"3"}}),lg:$T({track:{h:"4"}})},qTe=BTe({sizes:KTe,baseStyle:$Te,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:YTe,definePartsStyle:rO}=Ji(YSe.keys),XTe=n=>{var i;const t=(i=Dc(lg.baseStyle,n))==null?void 0:i.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},JTe=rO(n=>{var t,i;return{label:(t=lg.baseStyle)==null?void 0:t.call(lg,n).label,container:(i=lg.baseStyle)==null?void 0:i.call(lg,n).container,control:XTe(n)}}),QTe={md:rO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:rO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:rO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},ZTe=YTe({baseStyle:JTe,sizes:QTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:eRe,definePartsStyle:tRe}=Ji(XSe.keys),T1=zn("select-bg");var HQ;const nRe={...(HQ=fi.baseStyle)==null?void 0:HQ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:T1.reference,[T1.variable]:"colors.white",_dark:{[T1.variable]:"colors.gray.700"},"> option, > optgroup":{bg:T1.reference}},rRe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},iRe=tRe({field:nRe,icon:rRe}),R1={paddingInlineEnd:"8"};var $Q,KQ,qQ,YQ,XQ,JQ,QQ,ZQ;const sRe={lg:{...($Q=fi.sizes)==null?void 0:$Q.lg,field:{...(KQ=fi.sizes)==null?void 0:KQ.lg.field,...R1}},md:{...(qQ=fi.sizes)==null?void 0:qQ.md,field:{...(YQ=fi.sizes)==null?void 0:YQ.md.field,...R1}},sm:{...(XQ=fi.sizes)==null?void 0:XQ.sm,field:{...(JQ=fi.sizes)==null?void 0:JQ.sm.field,...R1}},xs:{...(QQ=fi.sizes)==null?void 0:QQ.xs,field:{...(ZQ=fi.sizes)==null?void 0:ZQ.xs.field,...R1},icon:{insetEnd:"1"}}},oRe=eRe({baseStyle:iRe,sizes:sRe,variants:fi.variants,defaultProps:fi.defaultProps}),xM=zn("skeleton-start-color"),LM=zn("skeleton-end-color"),aRe={[xM.variable]:"colors.gray.100",[LM.variable]:"colors.gray.400",_dark:{[xM.variable]:"colors.gray.800",[LM.variable]:"colors.gray.600"},background:xM.reference,borderColor:LM.reference,opacity:.7,borderRadius:"sm"},cRe={baseStyle:aRe},MM=zn("skip-link-bg"),lRe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[MM.variable]:"colors.white",_dark:{[MM.variable]:"colors.gray.700"},bg:MM.reference}},uRe={baseStyle:lRe},{defineMultiStyleConfig:dRe,definePartsStyle:Ok}=Ji(JSe.keys),Fy=zn("slider-thumb-size"),UR=zn("slider-track-size"),ug=zn("slider-bg"),hRe=n=>{const{orientation:t}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...IF({orientation:t,vertical:{h:"100%",px:Sf(Fy.reference).divide(2).toString()},horizontal:{w:"100%",py:Sf(Fy.reference).divide(2).toString()}})}},pRe=n=>({...IF({orientation:n.orientation,horizontal:{h:UR.reference},vertical:{w:UR.reference}}),overflow:"hidden",borderRadius:"sm",[ug.variable]:"colors.gray.200",_dark:{[ug.variable]:"colors.whiteAlpha.200"},_disabled:{[ug.variable]:"colors.gray.300",_dark:{[ug.variable]:"colors.whiteAlpha.300"}},bg:ug.reference}),fRe=n=>{const{orientation:t}=n;return{...IF({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Fy.reference,h:Fy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},mRe=n=>{const{colorScheme:t}=n;return{width:"inherit",height:"inherit",[ug.variable]:`colors.${t}.500`,_dark:{[ug.variable]:`colors.${t}.200`},bg:ug.reference}},gRe=Ok(n=>({container:hRe(n),track:pRe(n),thumb:fRe(n),filledTrack:mRe(n)})),_Re=Ok({container:{[Fy.variable]:"sizes.4",[UR.variable]:"sizes.1"}}),yRe=Ok({container:{[Fy.variable]:"sizes.3.5",[UR.variable]:"sizes.1"}}),ERe=Ok({container:{[Fy.variable]:"sizes.2.5",[UR.variable]:"sizes.0.5"}}),vRe={lg:_Re,md:yRe,sm:ERe},SRe=dRe({baseStyle:gRe,sizes:vRe,defaultProps:{size:"md",colorScheme:"blue"}}),vy=Ko("spinner-size"),bRe={width:[vy.reference],height:[vy.reference]},wRe={xs:{[vy.variable]:"sizes.3"},sm:{[vy.variable]:"sizes.4"},md:{[vy.variable]:"sizes.6"},lg:{[vy.variable]:"sizes.8"},xl:{[vy.variable]:"sizes.12"}},TRe={baseStyle:bRe,sizes:wRe,defaultProps:{size:"md"}},{defineMultiStyleConfig:RRe,definePartsStyle:KZ}=Ji(QSe.keys),CRe={fontWeight:"medium"},IRe={opacity:.8,marginBottom:"2"},ARe={verticalAlign:"baseline",fontWeight:"semibold"},PRe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},ORe=KZ({container:{},label:CRe,helpText:IRe,number:ARe,icon:PRe}),kRe={md:KZ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},NRe=RRe({baseStyle:ORe,sizes:kRe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:DRe,definePartsStyle:KT}=Ji(["stepper","step","title","description","indicator","separator","icon","number"]),wf=zn("stepper-indicator-size"),OS=zn("stepper-icon-size"),kS=zn("stepper-title-font-size"),qT=zn("stepper-description-font-size"),AT=zn("stepper-accent-color"),xRe=KT(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[AT.variable]:`colors.${n}.500`,_dark:{[AT.variable]:`colors.${n}.200`}},title:{fontSize:kS.reference,fontWeight:"medium"},description:{fontSize:qT.reference,color:"chakra-subtle-text"},number:{fontSize:kS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:OS.reference,height:OS.reference},indicator:{flexShrink:0,borderRadius:"full",width:wf.reference,height:wf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:AT.reference},"&[data-status=complete]":{bg:AT.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:AT.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${wf.reference} - 8px)`,top:`calc(${wf.reference} + 4px)`,insetStart:`calc(${wf.reference} / 2 - 1px)`}}})),LRe=DRe({baseStyle:xRe,sizes:{xs:KT({stepper:{[wf.variable]:"sizes.4",[OS.variable]:"sizes.3",[kS.variable]:"fontSizes.xs",[qT.variable]:"fontSizes.xs"}}),sm:KT({stepper:{[wf.variable]:"sizes.6",[OS.variable]:"sizes.4",[kS.variable]:"fontSizes.sm",[qT.variable]:"fontSizes.xs"}}),md:KT({stepper:{[wf.variable]:"sizes.8",[OS.variable]:"sizes.5",[kS.variable]:"fontSizes.md",[qT.variable]:"fontSizes.sm"}}),lg:KT({stepper:{[wf.variable]:"sizes.10",[OS.variable]:"sizes.6",[kS.variable]:"fontSizes.lg",[qT.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:MRe,definePartsStyle:iO}=Ji(ZSe.keys),mR=Ko("switch-track-width"),Py=Ko("switch-track-height"),UM=Ko("switch-track-diff"),URe=bf.subtract(mR,Py),XU=Ko("switch-thumb-x"),PT=Ko("switch-bg"),VRe=n=>{const{colorScheme:t}=n;return{borderRadius:"full",p:"0.5",width:[mR.reference],height:[Py.reference],transitionProperty:"common",transitionDuration:"fast",[PT.variable]:"colors.gray.300",_dark:{[PT.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[PT.variable]:`colors.${t}.500`,_dark:{[PT.variable]:`colors.${t}.200`}},bg:PT.reference}},FRe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Py.reference],height:[Py.reference],_checked:{transform:`translateX(${XU.reference})`}},jRe=iO(n=>({container:{[UM.variable]:URe,[XU.variable]:UM.reference,_rtl:{[XU.variable]:bf(UM).negate().toString()}},track:VRe(n),thumb:FRe})),BRe={sm:iO({container:{[mR.variable]:"1.375rem",[Py.variable]:"sizes.3"}}),md:iO({container:{[mR.variable]:"1.875rem",[Py.variable]:"sizes.4"}}),lg:iO({container:{[mR.variable]:"2.875rem",[Py.variable]:"sizes.6"}})},zRe=MRe({baseStyle:jRe,sizes:BRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:WRe,definePartsStyle:WS}=Ji(e0e.keys),GRe=WS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),VO={"&[data-is-numeric=true]":{textAlign:"end"}},HRe=WS(n=>{const{colorScheme:t}=n;return{th:{color:Bn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Bn(`${t}.100`,`${t}.700`)(n),...VO},td:{borderBottom:"1px",borderColor:Bn(`${t}.100`,`${t}.700`)(n),...VO},caption:{color:Bn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),$Re=WS(n=>{const{colorScheme:t}=n;return{th:{color:Bn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Bn(`${t}.100`,`${t}.700`)(n),...VO},td:{borderBottom:"1px",borderColor:Bn(`${t}.100`,`${t}.700`)(n),...VO},caption:{color:Bn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Bn(`${t}.100`,`${t}.700`)(n)},td:{background:Bn(`${t}.100`,`${t}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),KRe={simple:HRe,striped:$Re,unstyled:{}},qRe={sm:WS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:WS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:WS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},YRe=WRe({baseStyle:GRe,variants:KRe,sizes:qRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),dl=zn("tabs-color"),Zd=zn("tabs-bg"),C1=zn("tabs-border-color"),{defineMultiStyleConfig:XRe,definePartsStyle:bp}=Ji(t0e.keys),JRe=n=>{const{orientation:t}=n;return{display:t==="vertical"?"flex":"block"}},QRe=n=>{const{isFitted:t}=n;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},ZRe=n=>{const{align:t="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:i==="vertical"?"column":"row"}},eCe={p:4},tCe=bp(n=>({root:JRe(n),tab:QRe(n),tablist:ZRe(n),tabpanel:eCe})),nCe={sm:bp({tab:{py:1,px:4,fontSize:"sm"}}),md:bp({tab:{fontSize:"md",py:2,px:4}}),lg:bp({tab:{fontSize:"lg",py:3,px:4}})},rCe=bp(n=>{const{colorScheme:t,orientation:i}=n,a=i==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[dl.variable]:`colors.${t}.600`,_dark:{[dl.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[Zd.variable]:"colors.gray.200",_dark:{[Zd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:dl.reference,bg:Zd.reference}}}),iCe=bp(n=>{const{colorScheme:t}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[C1.variable]:"transparent",_selected:{[dl.variable]:`colors.${t}.600`,[C1.variable]:"colors.white",_dark:{[dl.variable]:`colors.${t}.300`,[C1.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:C1.reference},color:dl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),sCe=bp(n=>{const{colorScheme:t}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Zd.variable]:"colors.gray.50",_dark:{[Zd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Zd.variable]:"colors.white",[dl.variable]:`colors.${t}.600`,_dark:{[Zd.variable]:"colors.gray.800",[dl.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:dl.reference,bg:Zd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),oCe=bp(n=>{const{colorScheme:t,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Nc(i,`${t}.700`),bg:Nc(i,`${t}.100`)}}}}),aCe=bp(n=>{const{colorScheme:t}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[dl.variable]:"colors.gray.600",_dark:{[dl.variable]:"inherit"},_selected:{[dl.variable]:"colors.white",[Zd.variable]:`colors.${t}.600`,_dark:{[dl.variable]:"colors.gray.800",[Zd.variable]:`colors.${t}.300`}},color:dl.reference,bg:Zd.reference}}}),cCe=bp({}),lCe={line:rCe,enclosed:iCe,"enclosed-colored":sCe,"soft-rounded":oCe,"solid-rounded":aCe,unstyled:cCe},uCe=XRe({baseStyle:tCe,sizes:nCe,variants:lCe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:dCe,definePartsStyle:Oy}=Ji(n0e.keys),QK=zn("tag-bg"),ZK=zn("tag-color"),VM=zn("tag-shadow"),sO=zn("tag-min-height"),oO=zn("tag-min-width"),aO=zn("tag-font-size"),cO=zn("tag-padding-inline"),hCe={fontWeight:"medium",lineHeight:1.2,outline:0,[ZK.variable]:uo.color.reference,[QK.variable]:uo.bg.reference,[VM.variable]:uo.shadow.reference,color:ZK.reference,bg:QK.reference,boxShadow:VM.reference,borderRadius:"md",minH:sO.reference,minW:oO.reference,fontSize:aO.reference,px:cO.reference,_focusVisible:{[VM.variable]:"shadows.outline"}},pCe={lineHeight:1.2,overflow:"visible"},fCe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},mCe=Oy({container:hCe,label:pCe,closeButton:fCe}),gCe={sm:Oy({container:{[sO.variable]:"sizes.5",[oO.variable]:"sizes.5",[aO.variable]:"fontSizes.xs",[cO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Oy({container:{[sO.variable]:"sizes.6",[oO.variable]:"sizes.6",[aO.variable]:"fontSizes.sm",[cO.variable]:"space.2"}}),lg:Oy({container:{[sO.variable]:"sizes.8",[oO.variable]:"sizes.8",[aO.variable]:"fontSizes.md",[cO.variable]:"space.3"}})},_Ce={subtle:Oy(n=>{var t;return{container:(t=hR.variants)==null?void 0:t.subtle(n)}}),solid:Oy(n=>{var t;return{container:(t=hR.variants)==null?void 0:t.solid(n)}}),outline:Oy(n=>{var t;return{container:(t=hR.variants)==null?void 0:t.outline(n)}})},yCe=dCe({variants:_Ce,baseStyle:mCe,sizes:gCe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var eZ;const ECe={...(eZ=fi.baseStyle)==null?void 0:eZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var tZ;const vCe={outline:n=>{var t;return((t=fi.variants)==null?void 0:t.outline(n).field)??{}},flushed:n=>{var t;return((t=fi.variants)==null?void 0:t.flushed(n).field)??{}},filled:n=>{var t;return((t=fi.variants)==null?void 0:t.filled(n).field)??{}},unstyled:((tZ=fi.variants)==null?void 0:tZ.unstyled.field)??{}};var nZ,rZ,iZ,sZ;const SCe={xs:((nZ=fi.sizes)==null?void 0:nZ.xs.field)??{},sm:((rZ=fi.sizes)==null?void 0:rZ.sm.field)??{},md:((iZ=fi.sizes)==null?void 0:iZ.md.field)??{},lg:((sZ=fi.sizes)==null?void 0:sZ.lg.field)??{}},bCe={baseStyle:ECe,sizes:SCe,variants:vCe,defaultProps:{size:"md",variant:"outline"}},I1=Ko("tooltip-bg"),FM=Ko("tooltip-fg"),wCe=Ko("popper-arrow-bg"),TCe={bg:I1.reference,color:FM.reference,[I1.variable]:"colors.gray.700",[FM.variable]:"colors.whiteAlpha.900",_dark:{[I1.variable]:"colors.gray.300",[FM.variable]:"colors.gray.900"},[wCe.variable]:I1.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},RCe={baseStyle:TCe},CCe={Accordion:d0e,Alert:q0e,Avatar:sbe,Badge:hR,Breadcrumb:mbe,Button:Tbe,Checkbox:lg,CloseButton:Fbe,Code:Wbe,Container:Hbe,Divider:Xbe,Drawer:awe,Editable:fwe,Form:vwe,FormError:Cwe,FormLabel:Awe,Heading:kwe,Input:fi,Kbd:Bwe,Link:Wwe,List:qwe,Menu:sTe,Modal:gTe,NumberInput:RTe,PinInput:PTe,Popover:jTe,Progress:qTe,Radio:ZTe,Select:oRe,Skeleton:cRe,SkipLink:uRe,Slider:SRe,Spinner:TRe,Stat:NRe,Switch:zRe,Table:YRe,Tabs:uCe,Tag:yCe,Textarea:bCe,Tooltip:RCe,Card:Pbe,Stepper:LRe},ICe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},ACe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},PCe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},OCe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},kCe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},NCe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},DCe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},xCe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},LCe={property:NCe,easing:DCe,duration:xCe},MCe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},UCe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},VCe={breakpoints:ACe,zIndices:MCe,radii:OCe,blur:UCe,colors:PCe,...GZ,sizes:VZ,shadows:kCe,space:UZ,borders:ICe,transition:LCe},FCe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},jCe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},BCe="ltr",zCe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},WCe={semanticTokens:FCe,direction:BCe,...VCe,components:CCe,styles:jCe,config:zCe};function GCe(n){if(n.sheet)return n.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===n)return document.styleSheets[t]}function HCe(n){var t=document.createElement("style");return t.setAttribute("data-emotion",n.key),n.nonce!==void 0&&t.setAttribute("nonce",n.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var $Ce=function(){function n(i){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var t=n.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(HCe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=GCe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),ic="-ms-",FO="-moz-",hi="-webkit-",qZ="comm",kF="rule",NF="decl",KCe="@import",YZ="@keyframes",qCe="@layer",YCe=Math.abs,kk=String.fromCharCode,XCe=Object.assign;function JCe(n,t){return xa(n,0)^45?(((t<<2^xa(n,0))<<2^xa(n,1))<<2^xa(n,2))<<2^xa(n,3):0}function XZ(n){return n.trim()}function QCe(n,t){return(n=t.exec(n))?n[0]:n}function pi(n,t,i){return n.replace(t,i)}function JU(n,t){return n.indexOf(t)}function xa(n,t){return n.charCodeAt(t)|0}function VR(n,t,i){return n.slice(t,i)}function dp(n){return n.length}function DF(n){return n.length}function A1(n,t){return t.push(n),n}function ZCe(n,t){return n.map(t).join("")}var Nk=1,a0=1,JZ=0,yl=0,So=0,N0="";function Dk(n,t,i,a,l,d,f){return{value:n,root:t,parent:i,type:a,props:l,children:d,line:Nk,column:a0,length:f,return:""}}function OT(n,t){return XCe(Dk("",null,null,"",null,null,0),n,{length:-n.length},t)}function eIe(){return So}function tIe(){return So=yl>0?xa(N0,--yl):0,a0--,So===10&&(a0=1,Nk--),So}function eu(){return So=yl<JZ?xa(N0,yl++):0,a0++,So===10&&(a0=1,Nk++),So}function wp(){return xa(N0,yl)}function lO(){return yl}function hC(n,t){return VR(N0,n,t)}function FR(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function QZ(n){return Nk=a0=1,JZ=dp(N0=n),yl=0,[]}function ZZ(n){return N0="",n}function uO(n){return XZ(hC(yl-1,QU(n===91?n+2:n===40?n+1:n)))}function nIe(n){for(;(So=wp())&&So<33;)eu();return FR(n)>2||FR(So)>3?"":" "}function rIe(n,t){for(;--t&&eu()&&!(So<48||So>102||So>57&&So<65||So>70&&So<97););return hC(n,lO()+(t<6&&wp()==32&&eu()==32))}function QU(n){for(;eu();)switch(So){case n:return yl;case 34:case 39:n!==34&&n!==39&&QU(So);break;case 40:n===41&&QU(n);break;case 92:eu();break}return yl}function iIe(n,t){for(;eu()&&n+So!==57;)if(n+So===84&&wp()===47)break;return"/*"+hC(t,yl-1)+"*"+kk(n===47?n:eu())}function sIe(n){for(;!FR(wp());)eu();return hC(n,yl)}function oIe(n){return ZZ(dO("",null,null,null,[""],n=QZ(n),0,[0],n))}function dO(n,t,i,a,l,d,f,y,v){for(var b=0,R=0,I=f,k=0,M=0,L=0,j=1,z=1,Y=1,K=0,ne="",ce=l,oe=d,ge=a,X=ne;z;)switch(L=K,K=eu()){case 40:if(L!=108&&xa(X,I-1)==58){JU(X+=pi(uO(K),"&","&\f"),"&\f")!=-1&&(Y=-1);break}case 34:case 39:case 91:X+=uO(K);break;case 9:case 10:case 13:case 32:X+=nIe(L);break;case 92:X+=rIe(lO()-1,7);continue;case 47:switch(wp()){case 42:case 47:A1(aIe(iIe(eu(),lO()),t,i),v);break;default:X+="/"}break;case 123*j:y[b++]=dp(X)*Y;case 125*j:case 59:case 0:switch(K){case 0:case 125:z=0;case 59+R:Y==-1&&(X=pi(X,/\f/g,"")),M>0&&dp(X)-I&&A1(M>32?tq(X+";",a,i,I-1):tq(pi(X," ","")+";",a,i,I-2),v);break;case 59:X+=";";default:if(A1(ge=eq(X,t,i,b,R,l,y,ne,ce=[],oe=[],I),d),K===123)if(R===0)dO(X,t,ge,ge,ce,d,I,y,oe);else switch(k===99&&xa(X,3)===110?100:k){case 100:case 108:case 109:case 115:dO(n,ge,ge,a&&A1(eq(n,ge,ge,0,0,l,y,ne,l,ce=[],I),oe),l,oe,I,y,a?ce:oe);break;default:dO(X,ge,ge,ge,[""],oe,0,y,oe)}}b=R=M=0,j=Y=1,ne=X="",I=f;break;case 58:I=1+dp(X),M=L;default:if(j<1){if(K==123)--j;else if(K==125&&j++==0&&tIe()==125)continue}switch(X+=kk(K),K*j){case 38:Y=R>0?1:(X+="\f",-1);break;case 44:y[b++]=(dp(X)-1)*Y,Y=1;break;case 64:wp()===45&&(X+=uO(eu())),k=wp(),R=I=dp(ne=X+=sIe(lO())),K++;break;case 45:L===45&&dp(X)==2&&(j=0)}}return d}function eq(n,t,i,a,l,d,f,y,v,b,R){for(var I=l-1,k=l===0?d:[""],M=DF(k),L=0,j=0,z=0;L<a;++L)for(var Y=0,K=VR(n,I+1,I=YCe(j=f[L])),ne=n;Y<M;++Y)(ne=XZ(j>0?k[Y]+" "+K:pi(K,/&\f/g,k[Y])))&&(v[z++]=ne);return Dk(n,t,i,l===0?kF:y,v,b,R)}function aIe(n,t,i){return Dk(n,t,i,qZ,kk(eIe()),VR(n,2,-2),0)}function tq(n,t,i,a){return Dk(n,t,i,NF,VR(n,0,a),VR(n,a+1,-1),a)}function GS(n,t){for(var i="",a=DF(n),l=0;l<a;l++)i+=t(n[l],l,n,t)||"";return i}function cIe(n,t,i,a){switch(n.type){case qCe:if(n.children.length)break;case KCe:case NF:return n.return=n.return||n.value;case qZ:return"";case YZ:return n.return=n.value+"{"+GS(n.children,a)+"}";case kF:n.value=n.props.join(",")}return dp(i=GS(n.children,a))?n.return=n.value+"{"+i+"}":""}function lIe(n){var t=DF(n);return function(i,a,l,d){for(var f="",y=0;y<t;y++)f+=n[y](i,a,l,d)||"";return f}}function uIe(n){return function(t){t.root||(t=t.return)&&n(t)}}var nq=function(t){var i=new WeakMap;return function(a){if(i.has(a))return i.get(a);var l=t(a);return i.set(a,l),l}};function eee(n){var t=Object.create(null);return function(i){return t[i]===void 0&&(t[i]=n(i)),t[i]}}var dIe=function(t,i,a){for(var l=0,d=0;l=d,d=wp(),l===38&&d===12&&(i[a]=1),!FR(d);)eu();return hC(t,yl)},hIe=function(t,i){var a=-1,l=44;do switch(FR(l)){case 0:l===38&&wp()===12&&(i[a]=1),t[a]+=dIe(yl-1,i,a);break;case 2:t[a]+=uO(l);break;case 4:if(l===44){t[++a]=wp()===58?"&\f":"",i[a]=t[a].length;break}default:t[a]+=kk(l)}while(l=eu());return t},pIe=function(t,i){return ZZ(hIe(QZ(t),i))},rq=new WeakMap,fIe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var i=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&i.charCodeAt(0)!==58&&!rq.get(a))&&!l){rq.set(t,!0);for(var d=[],f=pIe(i,d),y=a.props,v=0,b=0;v<f.length;v++)for(var R=0;R<y.length;R++,b++)t.props[b]=d[v]?f[v].replace(/&\f/g,y[R]):y[R]+" "+f[v]}}},mIe=function(t){if(t.type==="decl"){var i=t.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(t.return="",t.value="")}};function tee(n,t){switch(JCe(n,t)){case 5103:return hi+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return hi+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return hi+n+FO+n+ic+n+n;case 6828:case 4268:return hi+n+ic+n+n;case 6165:return hi+n+ic+"flex-"+n+n;case 5187:return hi+n+pi(n,/(\w+).+(:[^]+)/,hi+"box-$1$2"+ic+"flex-$1$2")+n;case 5443:return hi+n+ic+"flex-item-"+pi(n,/flex-|-self/,"")+n;case 4675:return hi+n+ic+"flex-line-pack"+pi(n,/align-content|flex-|-self/,"")+n;case 5548:return hi+n+ic+pi(n,"shrink","negative")+n;case 5292:return hi+n+ic+pi(n,"basis","preferred-size")+n;case 6060:return hi+"box-"+pi(n,"-grow","")+hi+n+ic+pi(n,"grow","positive")+n;case 4554:return hi+pi(n,/([^-])(transform)/g,"$1"+hi+"$2")+n;case 6187:return pi(pi(pi(n,/(zoom-|grab)/,hi+"$1"),/(image-set)/,hi+"$1"),n,"")+n;case 5495:case 3959:return pi(n,/(image-set\([^]*)/,hi+"$1$`$1");case 4968:return pi(pi(n,/(.+:)(flex-)?(.*)/,hi+"box-pack:$3"+ic+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+hi+n+n;case 4095:case 3583:case 4068:case 2532:return pi(n,/(.+)-inline(.+)/,hi+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(dp(n)-1-t>6)switch(xa(n,t+1)){case 109:if(xa(n,t+4)!==45)break;case 102:return pi(n,/(.+:)(.+)-([^]+)/,"$1"+hi+"$2-$3$1"+FO+(xa(n,t+3)==108?"$3":"$2-$3"))+n;case 115:return~JU(n,"stretch")?tee(pi(n,"stretch","fill-available"),t)+n:n}break;case 4949:if(xa(n,t+1)!==115)break;case 6444:switch(xa(n,dp(n)-3-(~JU(n,"!important")&&10))){case 107:return pi(n,":",":"+hi)+n;case 101:return pi(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+hi+(xa(n,14)===45?"inline-":"")+"box$3$1"+hi+"$2$3$1"+ic+"$2box$3")+n}break;case 5936:switch(xa(n,t+11)){case 114:return hi+n+ic+pi(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return hi+n+ic+pi(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return hi+n+ic+pi(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return hi+n+ic+n+n}return n}var gIe=function(t,i,a,l){if(t.length>-1&&!t.return)switch(t.type){case NF:t.return=tee(t.value,t.length);break;case YZ:return GS([OT(t,{value:pi(t.value,"@","@"+hi)})],l);case kF:if(t.length)return ZCe(t.props,function(d){switch(QCe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return GS([OT(t,{props:[pi(d,/:(read-\w+)/,":"+FO+"$1")]})],l);case"::placeholder":return GS([OT(t,{props:[pi(d,/:(plac\w+)/,":"+hi+"input-$1")]}),OT(t,{props:[pi(d,/:(plac\w+)/,":"+FO+"$1")]}),OT(t,{props:[pi(d,/:(plac\w+)/,ic+"input-$1")]})],l)}return""})}},_Ie=[gIe],yIe=function(t){var i=t.key;if(i==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(j){var z=j.getAttribute("data-emotion");z.indexOf(" ")!==-1&&(document.head.appendChild(j),j.setAttribute("data-s",""))})}var l=t.stylisPlugins||_Ie,d={},f,y=[];f=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(j){for(var z=j.getAttribute("data-emotion").split(" "),Y=1;Y<z.length;Y++)d[z[Y]]=!0;y.push(j)});var v,b=[fIe,mIe];{var R,I=[cIe,uIe(function(j){R.insert(j)})],k=lIe(b.concat(l,I)),M=function(z){return GS(oIe(z),k)};v=function(z,Y,K,ne){R=K,M(z?z+"{"+Y.styles+"}":Y.styles),ne&&(L.inserted[Y.name]=!0)}}var L={key:i,sheet:new $Ce({key:i,container:f,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return L.sheet.hydrate(y),L};function jy(){return jy=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},jy.apply(null,arguments)}var jM={exports:{}},yi={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iq;function EIe(){if(iq)return yi;iq=1;var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,R=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,k=n?Symbol.for("react.suspense_list"):60120,M=n?Symbol.for("react.memo"):60115,L=n?Symbol.for("react.lazy"):60116,j=n?Symbol.for("react.block"):60121,z=n?Symbol.for("react.fundamental"):60117,Y=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function ne(oe){if(typeof oe=="object"&&oe!==null){var ge=oe.$$typeof;switch(ge){case t:switch(oe=oe.type,oe){case v:case b:case a:case d:case l:case I:return oe;default:switch(oe=oe&&oe.$$typeof,oe){case y:case R:case L:case M:case f:return oe;default:return ge}}case i:return ge}}}function ce(oe){return ne(oe)===b}return yi.AsyncMode=v,yi.ConcurrentMode=b,yi.ContextConsumer=y,yi.ContextProvider=f,yi.Element=t,yi.ForwardRef=R,yi.Fragment=a,yi.Lazy=L,yi.Memo=M,yi.Portal=i,yi.Profiler=d,yi.StrictMode=l,yi.Suspense=I,yi.isAsyncMode=function(oe){return ce(oe)||ne(oe)===v},yi.isConcurrentMode=ce,yi.isContextConsumer=function(oe){return ne(oe)===y},yi.isContextProvider=function(oe){return ne(oe)===f},yi.isElement=function(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===t},yi.isForwardRef=function(oe){return ne(oe)===R},yi.isFragment=function(oe){return ne(oe)===a},yi.isLazy=function(oe){return ne(oe)===L},yi.isMemo=function(oe){return ne(oe)===M},yi.isPortal=function(oe){return ne(oe)===i},yi.isProfiler=function(oe){return ne(oe)===d},yi.isStrictMode=function(oe){return ne(oe)===l},yi.isSuspense=function(oe){return ne(oe)===I},yi.isValidElementType=function(oe){return typeof oe=="string"||typeof oe=="function"||oe===a||oe===b||oe===d||oe===l||oe===I||oe===k||typeof oe=="object"&&oe!==null&&(oe.$$typeof===L||oe.$$typeof===M||oe.$$typeof===f||oe.$$typeof===y||oe.$$typeof===R||oe.$$typeof===z||oe.$$typeof===Y||oe.$$typeof===K||oe.$$typeof===j)},yi.typeOf=ne,yi}var sq;function vIe(){return sq||(sq=1,jM.exports=EIe()),jM.exports}var BM,oq;function SIe(){if(oq)return BM;oq=1;var n=vIe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function f(L){return n.isMemo(L)?l:d[L.$$typeof]||t}var y=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,R=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,k=Object.prototype;function M(L,j,z){if(typeof j!="string"){if(k){var Y=I(j);Y&&Y!==k&&M(L,Y,z)}var K=v(j);b&&(K=K.concat(b(j)));for(var ne=f(L),ce=f(j),oe=0;oe<K.length;++oe){var ge=K[oe];if(!i[ge]&&!(z&&z[ge])&&!(ce&&ce[ge])&&!(ne&&ne[ge])){var X=R(j,ge);try{y(L,ge,X)}catch{}}}}return L}return BM=M,BM}var bIe=SIe();const wIe=Mg(bIe);var TIe=!0;function nee(n,t,i){var a="";return i.split(" ").forEach(function(l){n[l]!==void 0?t.push(n[l]+";"):l&&(a+=l+" ")}),a}var xF=function(t,i,a){var l=t.key+"-"+i.name;(a===!1||TIe===!1)&&t.registered[l]===void 0&&(t.registered[l]=i.styles)},LF=function(t,i,a){xF(t,i,a);var l=t.key+"-"+i.name;if(t.inserted[i.name]===void 0){var d=i;do t.insert(i===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function RIe(n){for(var t=0,i,a=0,l=n.length;l>=4;++a,l-=4)i=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,t=(i&65535)*1540483477+((i>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(n.charCodeAt(a+2)&255)<<16;case 2:t^=(n.charCodeAt(a+1)&255)<<8;case 1:t^=n.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var CIe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},IIe=/[A-Z]|^ms/g,AIe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,ree=function(t){return t.charCodeAt(1)===45},aq=function(t){return t!=null&&typeof t!="boolean"},zM=eee(function(n){return ree(n)?n:n.replace(IIe,"-$&").toLowerCase()}),cq=function(t,i){switch(t){case"animation":case"animationName":if(typeof i=="string")return i.replace(AIe,function(a,l,d){return hp={name:l,styles:d,next:hp},l})}return CIe[t]!==1&&!ree(t)&&typeof i=="number"&&i!==0?i+"px":i};function jR(n,t,i){if(i==null)return"";var a=i;if(a.__emotion_styles!==void 0)return a;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return hp={name:l.name,styles:l.styles,next:hp},l.name;var d=i;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)hp={name:f.name,styles:f.styles,next:hp},f=f.next;var y=d.styles+";";return y}return PIe(n,t,i)}case"function":{if(n!==void 0){var v=hp,b=i(n);return hp=v,jR(n,t,b)}break}}var R=i;if(t==null)return R;var I=t[R];return I!==void 0?I:R}function PIe(n,t,i){var a="";if(Array.isArray(i))for(var l=0;l<i.length;l++)a+=jR(n,t,i[l])+";";else for(var d in i){var f=i[d];if(typeof f!="object"){var y=f;t!=null&&t[y]!==void 0?a+=d+"{"+t[y]+"}":aq(y)&&(a+=zM(d)+":"+cq(d,y)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(t==null||t[f[0]]===void 0))for(var v=0;v<f.length;v++)aq(f[v])&&(a+=zM(d)+":"+cq(d,f[v])+";");else{var b=jR(n,t,f);switch(d){case"animation":case"animationName":{a+=zM(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var lq=/label:\s*([^\s;{]+)\s*(;|$)/g,hp;function xk(n,t,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";hp=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=jR(i,t,d);else{var f=d;l+=f[0]}for(var y=1;y<n.length;y++)if(l+=jR(i,t,n[y]),a){var v=d;l+=v[y]}lq.lastIndex=0;for(var b="",R;(R=lq.exec(l))!==null;)b+="-"+R[1];var I=RIe(l)+b;return{name:I,styles:l,next:hp}}var OIe=function(t){return t()},iee=EK.useInsertionEffect?EK.useInsertionEffect:!1,see=iee||OIe,uq=iee||N.useLayoutEffect,MF=N.createContext(typeof HTMLElement<"u"?yIe({key:"css"}):null);MF.Provider;var kIe=function(){return N.useContext(MF)},UF=function(t){return N.forwardRef(function(i,a){var l=N.useContext(MF);return t(i,l,a)})},c0=N.createContext({}),NIe=function(t,i){if(typeof i=="function"){var a=i(t);return a}return jy({},t,i)},DIe=nq(function(n){return nq(function(t){return NIe(n,t)})}),xIe=function(t){var i=N.useContext(c0);return t.theme!==i&&(i=DIe(i)(t.theme)),N.createElement(c0.Provider,{value:i},t.children)},VF={}.hasOwnProperty,ZU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",LIe=function(t,i){var a={};for(var l in i)VF.call(i,l)&&(a[l]=i[l]);return a[ZU]=t,a},MIe=function(t){var i=t.cache,a=t.serialized,l=t.isStringTag;return xF(i,a,l),see(function(){return LF(i,a,l)}),null},UIe=UF(function(n,t,i){var a=n.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=n[ZU],d=[a],f="";typeof n.className=="string"?f=nee(t.registered,d,n.className):n.className!=null&&(f=n.className+" ");var y=xk(d,void 0,N.useContext(c0));f+=t.key+"-"+y.name;var v={};for(var b in n)VF.call(n,b)&&b!=="css"&&b!==ZU&&(v[b]=n[b]);return v.className=f,i&&(v.ref=i),N.createElement(N.Fragment,null,N.createElement(MIe,{cache:t,serialized:y,isStringTag:typeof l=="string"}),N.createElement(l,v))}),VIe=UIe,dq=function(t,i){var a=arguments;if(i==null||!VF.call(i,"css"))return N.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=VIe,d[1]=LIe(t,i);for(var f=2;f<l;f++)d[f]=a[f];return N.createElement.apply(null,d)};(function(n){var t;t||(t=n.JSX||(n.JSX={}))})(dq||(dq={}));var Lk=UF(function(n,t){var i=n.styles,a=xk([i],void 0,N.useContext(c0)),l=N.useRef();return uq(function(){var d=t.key+"-global",f=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),y=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(f.before=t.sheet.tags[0]),v!==null&&(y=!0,v.setAttribute("data-emotion",d),f.hydrate([v])),l.current=[f,y],function(){f.flush()}},[t]),uq(function(){var d=l.current,f=d[0],y=d[1];if(y){d[1]=!1;return}if(a.next!==void 0&&LF(t,a.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}t.insert("",a,f,!1)},[t,a.name]),null});function FIe(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return xk(t)}function pC(){var n=FIe.apply(void 0,arguments),t="animation-"+n.name;return{name:t,styles:"@keyframes "+t+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const FF=N.createContext({});FF.displayName="ColorModeContext";function Mk(){const n=N.useContext(FF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function _g(n,t){const{colorMode:i}=Mk();return i==="dark"?t:n}const P1={light:"chakra-ui-light",dark:"chakra-ui-dark"};function jIe(n={}){const{preventTransition:t=!0,nonce:i}=n,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?P1.dark:P1.light),document.body.classList.remove(l?P1.light:P1.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=y=>{l(y.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const BIe="chakra-ui-color-mode";function zIe(n){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let i;try{i=localStorage.getItem(n)||t}catch{}return i||t},set(t){try{localStorage.setItem(n,t)}catch{}}}}const WIe=zIe(BIe),hq=()=>{},GIe=oEe()?N.useLayoutEffect:N.useEffect;function pq(n,t){return n.type==="cookie"&&n.ssr?n.get(t):t}const oee=function(t){const{value:i,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:y=WIe}=t,v=kIe(),b=d==="dark"?"dark":"light",[R,I]=N.useState(()=>pq(y,b)),[k,M]=N.useState(()=>pq(y)),{getSystemTheme:L,setClassName:j,setDataset:z,addListener:Y}=N.useMemo(()=>jIe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),K=d==="system"&&!R?k:R,ne=N.useCallback(ge=>{const X=ge==="system"?L():ge;I(X),j(X==="dark"),z(X),y.set(X)},[y,L,j,z]);GIe(()=>{d==="system"&&M(L())},[]),N.useEffect(()=>{const ge=y.get();if(ge){ne(ge);return}if(d==="system"){ne("system");return}ne(b)},[y,b,d,ne]);const ce=N.useCallback(()=>{ne(K==="dark"?"light":"dark")},[K,ne]);N.useEffect(()=>{if(l)return Y(ne)},[l,Y,ne]);const oe=N.useMemo(()=>({colorMode:i??K,toggleColorMode:i?hq:ce,setColorMode:i?hq:ne,forced:i!==void 0}),[K,ce,ne,i]);return w.jsx(FF.Provider,{value:oe,children:a})};oee.displayName="ColorModeProvider";const aee=String.raw,cee=aee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,HIe=()=>w.jsx(Lk,{styles:cee}),$Ie=({scope:n=""})=>w.jsx(Lk,{styles:aee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${cee}
    `});function KIe(n){const{cssVarsRoot:t,theme:i,children:a}=n,l=N.useMemo(()=>NSe(i),[i]);return w.jsxs(xIe,{theme:l,children:[w.jsx(qIe,{root:t}),a]})}function qIe({root:n=":host, :root"}){const t=[n,"[data-theme]"].join(",");return w.jsx(Lk,{styles:i=>({[t]:i.__cssVars})})}Ri({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function YIe(){const{colorMode:n}=Mk();return w.jsx(Lk,{styles:t=>{const i=mZ(t,"styles.global"),a=fl(i,{theme:t,colorMode:n});return a?DZ(a)(t):void 0}})}const[XIe,JIe]=Ri({strict:!1,name:"PortalManagerContext"});function jF(n){const{children:t,zIndex:i}=n;return w.jsx(XIe,{value:{zIndex:i},children:t})}jF.displayName="PortalManager";const BF=N.createContext({getDocument(){return document},getWindow(){return window}});BF.displayName="EnvironmentContext";function QIe({defer:n}={}){const[,t]=N.useReducer(i=>i+1,0);return Sp(()=>{n&&t()},[n]),N.useContext(BF)}function lee(n){const{children:t,environment:i,disabled:a}=n,l=N.useRef(null),d=N.useMemo(()=>i||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[i]),f=!a||!i;return w.jsxs(BF.Provider,{value:d,children:[t,f&&w.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}lee.displayName="EnvironmentProvider";const ZIe=n=>{const{children:t,colorModeManager:i,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:y,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:R}=n,I=w.jsx(lee,{environment:y,disabled:b,children:t});return w.jsx(KIe,{theme:f,cssVarsRoot:v,children:w.jsxs(oee,{colorModeManager:i,options:f.config,children:[d?w.jsx($Ie,{scope:l}):w.jsx(HIe,{}),!R&&w.jsx(YIe,{}),a?w.jsx(jF,{zIndex:a,children:I}):I]})})},zF=N.createContext({});function WF(n){const t=N.useRef(null);return t.current===null&&(t.current=n()),t.current}const fC=N.createContext(null),GF=N.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class eAe extends N.Component{getSnapshotBeforeUpdate(t){const i=this.props.childRef.current;if(i&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=i.offsetHeight||0,a.width=i.offsetWidth||0,a.top=i.offsetTop,a.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function tAe({children:n,isPresent:t}){const i=N.useId(),a=N.useRef(null),l=N.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=N.useContext(GF);return N.useInsertionEffect(()=>{const{width:f,height:y,top:v,left:b}=l.current;if(t||!a.current||!f||!y)return;a.current.dataset.motionPopId=i;const R=document.createElement("style");return d&&(R.nonce=d),document.head.appendChild(R),R.sheet&&R.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${y}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(R)}},[t]),w.jsx(eAe,{isPresent:t,childRef:a,sizeRef:l,children:N.cloneElement(n,{ref:a})})}const nAe=({children:n,initial:t,isPresent:i,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const y=WF(rAe),v=N.useId(),b=N.useCallback(I=>{y.set(I,!0);for(const k of y.values())if(!k)return;a&&a()},[y,a]),R=N.useMemo(()=>({id:v,initial:t,isPresent:i,custom:l,onExitComplete:b,register:I=>(y.set(I,!1),()=>y.delete(I))}),d?[Math.random(),b]:[i,b]);return N.useMemo(()=>{y.forEach((I,k)=>y.set(k,!1))},[i]),N.useEffect(()=>{!i&&!y.size&&a&&a()},[i]),f==="popLayout"&&(n=w.jsx(tAe,{isPresent:i,children:n})),w.jsx(fC.Provider,{value:R,children:n})};function rAe(){return new Map}function HF(n=!0){const t=N.useContext(fC);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:l}=t,d=N.useId();N.useEffect(()=>{n&&l(d)},[n]);const f=N.useCallback(()=>n&&a&&a(d),[d,a,n]);return!i&&a?[!1,f]:[!0]}function iAe(){return sAe(N.useContext(fC))}function sAe(n){return n===null?!0:n.isPresent}const O1=n=>n.key||"";function fq(n){const t=[];return N.Children.forEach(n,i=>{N.isValidElement(i)&&t.push(i)}),t}const $F=typeof window<"u",uee=$F?N.useLayoutEffect:N.useEffect,D0=({children:n,custom:t,initial:i=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[y,v]=HF(f),b=N.useMemo(()=>fq(n),[n]),R=f&&!y?[]:b.map(O1),I=N.useRef(!0),k=N.useRef(b),M=WF(()=>new Map),[L,j]=N.useState(b),[z,Y]=N.useState(b);uee(()=>{I.current=!1,k.current=b;for(let ce=0;ce<z.length;ce++){const oe=O1(z[ce]);R.includes(oe)?M.delete(oe):M.get(oe)!==!0&&M.set(oe,!1)}},[z,R.length,R.join("-")]);const K=[];if(b!==L){let ce=[...b];for(let oe=0;oe<z.length;oe++){const ge=z[oe],X=O1(ge);R.includes(X)||(ce.splice(oe,0,ge),K.push(ge))}d==="wait"&&K.length&&(ce=K),Y(fq(ce)),j(b);return}const{forceRender:ne}=N.useContext(zF);return w.jsx(w.Fragment,{children:z.map(ce=>{const oe=O1(ce),ge=f&&!y?!1:b===z||R.includes(oe),X=()=>{if(M.has(oe))M.set(oe,!0);else return;let J=!0;M.forEach(te=>{te||(J=!1)}),J&&(ne==null||ne(),Y(k.current),f&&(v==null||v()),a&&a())};return w.jsx(nAe,{isPresent:ge,initial:!I.current||i?void 0:!1,custom:ge?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:ge?void 0:X,children:ce},oe)})})},tu=n=>n;let dee=tu;function KF(n){let t;return()=>(t===void 0&&(t=n()),t)}const l0=(n,t,i)=>{const a=t-n;return a===0?1:(i-n)/a},Of=n=>n*1e3,kf=n=>n/1e3,oAe={useManualTiming:!1};function aAe(n){let t=new Set,i=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function y(b){d.has(b)&&(v.schedule(b),n()),b(f)}const v={schedule:(b,R=!1,I=!1)=>{const M=I&&a?t:i;return R&&d.add(b),M.has(b)||M.add(b),b},cancel:b=>{i.delete(b),d.delete(b)},process:b=>{if(f=b,a){l=!0;return}a=!0,[t,i]=[i,t],t.forEach(y),t.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const k1=["read","resolveKeyframes","update","preRender","render","postRender"],cAe=40;function hee(n,t){let i=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>i=!0,f=k1.reduce((Y,K)=>(Y[K]=aAe(d),Y),{}),{read:y,resolveKeyframes:v,update:b,preRender:R,render:I,postRender:k}=f,M=()=>{const Y=performance.now();i=!1,l.delta=a?1e3/60:Math.max(Math.min(Y-l.timestamp,cAe),1),l.timestamp=Y,l.isProcessing=!0,y.process(l),v.process(l),b.process(l),R.process(l),I.process(l),k.process(l),l.isProcessing=!1,i&&t&&(a=!1,n(M))},L=()=>{i=!0,a=!0,l.isProcessing||n(M)};return{schedule:k1.reduce((Y,K)=>{const ne=f[K];return Y[K]=(ce,oe=!1,ge=!1)=>(i||L(),ne.schedule(ce,oe,ge)),Y},{}),cancel:Y=>{for(let K=0;K<k1.length;K++)f[k1[K]].cancel(Y)},state:l,steps:f}}const{schedule:as,cancel:Cg,state:ka,steps:WM}=hee(typeof requestAnimationFrame<"u"?requestAnimationFrame:tu,!0),pee=N.createContext({strict:!1}),mq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},u0={};for(const n in mq)u0[n]={isEnabled:t=>mq[n].some(i=>!!t[i])};function lAe(n){for(const t in n)u0[t]={...u0[t],...n[t]}}const uAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function jO(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||uAe.has(n)}let fee=n=>!jO(n);function dAe(n){n&&(fee=t=>t.startsWith("on")?!jO(t):n(t))}try{dAe(require("@emotion/is-prop-valid").default)}catch{}function hAe(n,t,i){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(fee(l)||i===!0&&jO(l)||!t&&!jO(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function pAe(n){if(typeof Proxy>"u")return n;const t=new Map,i=(...a)=>n(...a);return new Proxy(i,{get:(a,l)=>l==="create"?n:(t.has(l)||t.set(l,n(l)),t.get(l))})}const Uk=N.createContext({});function BR(n){return typeof n=="string"||Array.isArray(n)}function Vk(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const qF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],YF=["initial",...qF];function Fk(n){return Vk(n.animate)||YF.some(t=>BR(n[t]))}function mee(n){return!!(Fk(n)||n.variants)}function fAe(n,t){if(Fk(n)){const{initial:i,animate:a}=n;return{initial:i===!1||BR(i)?i:void 0,animate:BR(a)?a:void 0}}return n.inherit!==!1?t:{}}function mAe(n){const{initial:t,animate:i}=fAe(n,N.useContext(Uk));return N.useMemo(()=>({initial:t,animate:i}),[gq(t),gq(i)])}function gq(n){return Array.isArray(n)?n.join(" "):n}const gAe=Symbol.for("motionComponentSymbol");function NS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function _Ae(n,t,i){return N.useCallback(a=>{a&&n.onMount&&n.onMount(a),t&&(a?t.mount(a):t.unmount()),i&&(typeof i=="function"?i(a):NS(i)&&(i.current=a))},[t])}const XF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),yAe="framerAppearId",gee="data-"+XF(yAe),{schedule:JF}=hee(queueMicrotask,!1),_ee=N.createContext({});function EAe(n,t,i,a,l){var d,f;const{visualElement:y}=N.useContext(Uk),v=N.useContext(pee),b=N.useContext(fC),R=N.useContext(GF).reducedMotion,I=N.useRef(null);a=a||v.renderer,!I.current&&a&&(I.current=a(n,{visualState:t,parent:y,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:R}));const k=I.current,M=N.useContext(_ee);k&&!k.projection&&l&&(k.type==="html"||k.type==="svg")&&vAe(I.current,i,l,M);const L=N.useRef(!1);N.useInsertionEffect(()=>{k&&L.current&&k.update(i,b)});const j=i[gee],z=N.useRef(!!j&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,j))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,j)));return uee(()=>{k&&(L.current=!0,window.MotionIsMounted=!0,k.updateFeatures(),JF.render(k.render),z.current&&k.animationState&&k.animationState.animateChanges())}),N.useEffect(()=>{k&&(!z.current&&k.animationState&&k.animationState.animateChanges(),z.current&&(queueMicrotask(()=>{var Y;(Y=window.MotionHandoffMarkAsComplete)===null||Y===void 0||Y.call(window,j)}),z.current=!1))}),k}function vAe(n,t,i,a){const{layoutId:l,layout:d,drag:f,dragConstraints:y,layoutScroll:v,layoutRoot:b}=t;n.projection=new i(n.latestValues,t["data-framer-portal-id"]?void 0:yee(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||y&&NS(y),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function yee(n){if(n)return n.options.allowProjection!==!1?n.projection:yee(n.parent)}function SAe({preloadedFeatures:n,createVisualElement:t,useRender:i,useVisualState:a,Component:l}){var d,f;n&&lAe(n);function y(b,R){let I;const k={...N.useContext(GF),...b,layoutId:bAe(b)},{isStatic:M}=k,L=mAe(b),j=a(b,M);if(!M&&$F){wAe();const z=TAe(k);I=z.MeasureLayout,L.visualElement=EAe(l,j,k,t,z.ProjectionNode)}return w.jsxs(Uk.Provider,{value:L,children:[I&&L.visualElement?w.jsx(I,{visualElement:L.visualElement,...k}):null,i(l,b,_Ae(j,L.visualElement,R),j,M,L.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const v=N.forwardRef(y);return v[gAe]=l,v}function bAe({layoutId:n}){const t=N.useContext(zF).id;return t&&n!==void 0?t+"-"+n:n}function wAe(n,t){N.useContext(pee).strict}function TAe(n){const{drag:t,layout:i}=u0;if(!t&&!i)return{};const a={...t,...i};return{MeasureLayout:t!=null&&t.isEnabled(n)||i!=null&&i.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const RAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function QF(n){return typeof n!="string"||n.includes("-")?!1:!!(RAe.indexOf(n)>-1||/[A-Z]/u.test(n))}function _q(n){const t=[{},{}];return n==null||n.values.forEach((i,a)=>{t[0][a]=i.get(),t[1][a]=i.getVelocity()}),t}function ZF(n,t,i,a){if(typeof t=="function"){const[l,d]=_q(a);t=t(i!==void 0?i:n.custom,l,d)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[l,d]=_q(a);t=t(i!==void 0?i:n.custom,l,d)}return t}const eV=n=>Array.isArray(n),CAe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),IAe=n=>eV(n)?n[n.length-1]||0:n,cc=n=>!!(n&&n.getVelocity);function hO(n){const t=cc(n)?n.get():n;return CAe(t)?t.toValue():t}function AAe({scrapeMotionValuesFromProps:n,createRenderState:t,onUpdate:i},a,l,d){const f={latestValues:PAe(a,l,d,n),renderState:t()};return i&&(f.onMount=y=>i({props:a,current:y,...f}),f.onUpdate=y=>i(y)),f}const Eee=n=>(t,i)=>{const a=N.useContext(Uk),l=N.useContext(fC),d=()=>AAe(n,t,a,l);return i?d():WF(d)};function PAe(n,t,i,a){const l={},d=a(n,{});for(const k in d)l[k]=hO(d[k]);let{initial:f,animate:y}=n;const v=Fk(n),b=mee(n);t&&b&&!v&&n.inherit!==!1&&(f===void 0&&(f=t.initial),y===void 0&&(y=t.animate));let R=i?i.initial===!1:!1;R=R||f===!1;const I=R?y:f;if(I&&typeof I!="boolean"&&!Vk(I)){const k=Array.isArray(I)?I:[I];for(let M=0;M<k.length;M++){const L=ZF(n,k[M]);if(L){const{transitionEnd:j,transition:z,...Y}=L;for(const K in Y){let ne=Y[K];if(Array.isArray(ne)){const ce=R?ne.length-1:0;ne=ne[ce]}ne!==null&&(l[K]=ne)}for(const K in j)l[K]=j[K]}}}return l}const x0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Jy=new Set(x0),vee=n=>t=>typeof t=="string"&&t.startsWith(n),See=vee("--"),OAe=vee("var(--"),ej=n=>OAe(n)?kAe.test(n.split("/*")[0].trim()):!1,kAe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,bee=(n,t)=>t&&typeof n=="number"?t.transform(n):n,Uf=(n,t,i)=>i>t?t:i<n?n:i,L0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},zR={...L0,transform:n=>Uf(0,1,n)},N1={...L0,default:1},mC=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),cg=mC("deg"),Tp=mC("%"),Hn=mC("px"),NAe=mC("vh"),DAe=mC("vw"),yq={...Tp,parse:n=>Tp.parse(n)/100,transform:n=>Tp.transform(n*100)},xAe={borderWidth:Hn,borderTopWidth:Hn,borderRightWidth:Hn,borderBottomWidth:Hn,borderLeftWidth:Hn,borderRadius:Hn,radius:Hn,borderTopLeftRadius:Hn,borderTopRightRadius:Hn,borderBottomRightRadius:Hn,borderBottomLeftRadius:Hn,width:Hn,maxWidth:Hn,height:Hn,maxHeight:Hn,top:Hn,right:Hn,bottom:Hn,left:Hn,padding:Hn,paddingTop:Hn,paddingRight:Hn,paddingBottom:Hn,paddingLeft:Hn,margin:Hn,marginTop:Hn,marginRight:Hn,marginBottom:Hn,marginLeft:Hn,backgroundPositionX:Hn,backgroundPositionY:Hn},LAe={rotate:cg,rotateX:cg,rotateY:cg,rotateZ:cg,scale:N1,scaleX:N1,scaleY:N1,scaleZ:N1,skew:cg,skewX:cg,skewY:cg,distance:Hn,translateX:Hn,translateY:Hn,translateZ:Hn,x:Hn,y:Hn,z:Hn,perspective:Hn,transformPerspective:Hn,opacity:zR,originX:yq,originY:yq,originZ:Hn},Eq={...L0,transform:Math.round},tj={...xAe,...LAe,zIndex:Eq,size:Hn,fillOpacity:zR,strokeOpacity:zR,numOctaves:Eq},MAe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},UAe=x0.length;function VAe(n,t,i){let a="",l=!0;for(let d=0;d<UAe;d++){const f=x0[d],y=n[f];if(y===void 0)continue;let v=!0;if(typeof y=="number"?v=y===(f.startsWith("scale")?1:0):v=parseFloat(y)===0,!v||i){const b=bee(y,tj[f]);if(!v){l=!1;const R=MAe[f]||f;a+=`${R}(${b}) `}i&&(t[f]=b)}}return a=a.trim(),i?a=i(t,l?"":a):l&&(a="none"),a}function nj(n,t,i){const{style:a,vars:l,transformOrigin:d}=n;let f=!1,y=!1;for(const v in t){const b=t[v];if(Jy.has(v)){f=!0;continue}else if(See(v)){l[v]=b;continue}else{const R=bee(b,tj[v]);v.startsWith("origin")?(y=!0,d[v]=R):a[v]=R}}if(t.transform||(f||i?a.transform=VAe(t,n.transform,i):a.transform&&(a.transform="none")),y){const{originX:v="50%",originY:b="50%",originZ:R=0}=d;a.transformOrigin=`${v} ${b} ${R}`}}const FAe={offset:"stroke-dashoffset",array:"stroke-dasharray"},jAe={offset:"strokeDashoffset",array:"strokeDasharray"};function BAe(n,t,i=1,a=0,l=!0){n.pathLength=1;const d=l?FAe:jAe;n[d.offset]=Hn.transform(-a);const f=Hn.transform(t),y=Hn.transform(i);n[d.array]=`${f} ${y}`}function vq(n,t,i){return typeof n=="string"?n:Hn.transform(t+i*n)}function zAe(n,t,i){const a=vq(t,n.x,n.width),l=vq(i,n.y,n.height);return`${a} ${l}`}function rj(n,{attrX:t,attrY:i,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:y=1,pathOffset:v=0,...b},R,I){if(nj(n,b,I),R){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:k,style:M,dimensions:L}=n;k.transform&&(L&&(M.transform=k.transform),delete k.transform),L&&(l!==void 0||d!==void 0||M.transform)&&(M.transformOrigin=zAe(L,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(k.x=t),i!==void 0&&(k.y=i),a!==void 0&&(k.scale=a),f!==void 0&&BAe(k,f,y,v,!1)}const ij=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),wee=()=>({...ij(),attrs:{}}),sj=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Tee(n,{style:t,vars:i},a,l){Object.assign(n.style,t,l&&l.getProjectionStyles(a));for(const d in i)n.style.setProperty(d,i[d])}const Ree=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Cee(n,t,i,a){Tee(n,t,void 0,a);for(const l in t.attrs)n.setAttribute(Ree.has(l)?l:XF(l),t.attrs[l])}const BO={};function WAe(n){Object.assign(BO,n)}function Iee(n,{layout:t,layoutId:i}){return Jy.has(n)||n.startsWith("origin")||(t||i!==void 0)&&(!!BO[n]||n==="opacity")}function oj(n,t,i){var a;const{style:l}=n,d={};for(const f in l)(cc(l[f])||t.style&&cc(t.style[f])||Iee(f,n)||((a=i==null?void 0:i.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function Aee(n,t,i){const a=oj(n,t,i);for(const l in n)if(cc(n[l])||cc(t[l])){const d=x0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function GAe(n,t){try{t.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const Sq=["x","y","width","height","cx","cy","r"],HAe={useVisualState:Eee({scrapeMotionValuesFromProps:Aee,createRenderState:wee,onUpdate:({props:n,prevProps:t,current:i,renderState:a,latestValues:l})=>{if(!i)return;let d=!!n.drag;if(!d){for(const y in l)if(Jy.has(y)){d=!0;break}}if(!d)return;let f=!t;if(t)for(let y=0;y<Sq.length;y++){const v=Sq[y];n[v]!==t[v]&&(f=!0)}f&&as.read(()=>{GAe(i,a),as.render(()=>{rj(a,l,sj(i.tagName),n.transformTemplate),Cee(i,a)})})}})},$Ae={useVisualState:Eee({scrapeMotionValuesFromProps:oj,createRenderState:ij})};function Pee(n,t,i){for(const a in t)!cc(t[a])&&!Iee(a,i)&&(n[a]=t[a])}function KAe({transformTemplate:n},t){return N.useMemo(()=>{const i=ij();return nj(i,t,n),Object.assign({},i.vars,i.style)},[t])}function qAe(n,t){const i=n.style||{},a={};return Pee(a,i,n),Object.assign(a,KAe(n,t)),a}function YAe(n,t){const i={},a=qAe(n,t);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}function XAe(n,t,i,a){const l=N.useMemo(()=>{const d=wee();return rj(d,t,sj(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(n.style){const d={};Pee(d,n.style,n),l.style={...d,...l.style}}return l}function JAe(n=!1){return(i,a,l,{latestValues:d},f)=>{const v=(QF(i)?XAe:YAe)(a,d,f,i),b=hAe(a,typeof i=="string",n),R=i!==N.Fragment?{...b,...v,ref:l}:{},{children:I}=a,k=N.useMemo(()=>cc(I)?I.get():I,[I]);return N.createElement(i,{...R,children:k})}}function QAe(n,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...QF(a)?HAe:$Ae,preloadedFeatures:n,useRender:JAe(l),createVisualElement:t,Component:a};return SAe(f)}}function Oee(n,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(t[a]!==n[a])return!1;return!0}function jk(n,t,i){const a=n.getProps();return ZF(a,t,i!==void 0?i:a.custom,n)}const ZAe=KF(()=>window.ScrollTimeline!==void 0);class ePe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,i){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=i}attachTimeline(t,i){const a=this.animations.map(l=>{if(ZAe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof i=="function")return i(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let i=0;i<this.animations.length;i++)t=Math.max(t,this.animations[i].duration);return t}runAll(t){this.animations.forEach(i=>i[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class tPe extends ePe{then(t,i){return Promise.all(this.animations).then(t).catch(i)}}function aj(n,t){return n?n[t]||n.default||n:void 0}const tV=2e4;function kee(n){let t=0;const i=50;let a=n.next(t);for(;!a.done&&t<tV;)t+=i,a=n.next(t);return t>=tV?1/0:t}function cj(n){return typeof n=="function"}function bq(n,t){n.timeline=t,n.onfinish=null}const lj=n=>Array.isArray(n)&&typeof n[0]=="number",nPe={linearEasing:void 0};function rPe(n,t){const i=KF(n);return()=>{var a;return(a=nPe[t])!==null&&a!==void 0?a:i()}}const zO=rPe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Nee=(n,t,i=10)=>{let a="";const l=Math.max(Math.round(t/i),2);for(let d=0;d<l;d++)a+=n(l0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function Dee(n){return!!(typeof n=="function"&&zO()||!n||typeof n=="string"&&(n in nV||zO())||lj(n)||Array.isArray(n)&&n.every(Dee))}const YT=([n,t,i,a])=>`cubic-bezier(${n}, ${t}, ${i}, ${a})`,nV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:YT([0,.65,.55,1]),circOut:YT([.55,0,1,.45]),backIn:YT([.31,.01,.66,-.59]),backOut:YT([.33,1.53,.69,.99])};function xee(n,t){if(n)return typeof n=="function"&&zO()?Nee(n,t):lj(n)?YT(n):Array.isArray(n)?n.map(i=>xee(i,t)||nV.easeOut):nV[n]}const Jd={x:!1,y:!1};function Lee(){return Jd.x||Jd.y}function iPe(n,t,i){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function Mee(n,t){const i=iPe(n),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[i,l,()=>a.abort()]}function wq(n){return t=>{t.pointerType==="touch"||Lee()||n(t)}}function sPe(n,t,i={}){const[a,l,d]=Mee(n,i),f=wq(y=>{const{target:v}=y,b=t(y);if(typeof b!="function"||!v)return;const R=wq(I=>{b(I),v.removeEventListener("pointerleave",R)});v.addEventListener("pointerleave",R,l)});return a.forEach(y=>{y.addEventListener("pointerenter",f,l)}),d}const Uee=(n,t)=>t?n===t?!0:Uee(n,t.parentElement):!1,uj=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,oPe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function aPe(n){return oPe.has(n.tagName)||n.tabIndex!==-1}const XT=new WeakSet;function Tq(n){return t=>{t.key==="Enter"&&n(t)}}function GM(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const cPe=(n,t)=>{const i=n.currentTarget;if(!i)return;const a=Tq(()=>{if(XT.has(i))return;GM(i,"down");const l=Tq(()=>{GM(i,"up")}),d=()=>GM(i,"cancel");i.addEventListener("keyup",l,t),i.addEventListener("blur",d,t)});i.addEventListener("keydown",a,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),t)};function Rq(n){return uj(n)&&!Lee()}function lPe(n,t,i={}){const[a,l,d]=Mee(n,i),f=y=>{const v=y.currentTarget;if(!Rq(y)||XT.has(v))return;XT.add(v);const b=t(y),R=(M,L)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",k),!(!Rq(M)||!XT.has(v))&&(XT.delete(v),typeof b=="function"&&b(M,{success:L}))},I=M=>{R(M,i.useGlobalTarget||Uee(v,M.target))},k=M=>{R(M,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",k,l)};return a.forEach(y=>{!aPe(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(i.useGlobalTarget?window:y).addEventListener("pointerdown",f,l),y.addEventListener("focus",b=>cPe(b,l),l)}),d}function uPe(n){return n==="x"||n==="y"?Jd[n]?null:(Jd[n]=!0,()=>{Jd[n]=!1}):Jd.x||Jd.y?null:(Jd.x=Jd.y=!0,()=>{Jd.x=Jd.y=!1})}const Vee=new Set(["width","height","top","left","right","bottom",...x0]);let pO;function dPe(){pO=void 0}const Rp={now:()=>(pO===void 0&&Rp.set(ka.isProcessing||oAe.useManualTiming?ka.timestamp:performance.now()),pO),set:n=>{pO=n,queueMicrotask(dPe)}};function dj(n,t){n.indexOf(t)===-1&&n.push(t)}function hj(n,t){const i=n.indexOf(t);i>-1&&n.splice(i,1)}class pj{constructor(){this.subscriptions=[]}add(t){return dj(this.subscriptions,t),()=>hj(this.subscriptions,t)}notify(t,i,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,i,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(t,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Fee(n,t){return t?n*(1e3/t):0}const Cq=30,hPe=n=>!isNaN(parseFloat(n));class pPe{constructor(t,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Rp.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=Rp.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=hPe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new pj);const a=this.events[t].add(i);return t==="change"?()=>{a(),as.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Rp.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>Cq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,Cq);return Fee(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function WR(n,t){return new pPe(n,t)}function fPe(n,t,i){n.hasValue(t)?n.getValue(t).set(i):n.addValue(t,WR(i))}function mPe(n,t){const i=jk(n,t);let{transitionEnd:a={},transition:l={},...d}=i||{};d={...d,...a};for(const f in d){const y=IAe(d[f]);fPe(n,f,y)}}function gPe(n){return!!(cc(n)&&n.add)}function rV(n,t){const i=n.getValue("willChange");if(gPe(i))return i.add(t)}function jee(n){return n.props[gee]}const Bee=(n,t,i)=>(((1-3*i+3*t)*n+(3*i-6*t))*n+3*t)*n,_Pe=1e-7,yPe=12;function EPe(n,t,i,a,l){let d,f,y=0;do f=t+(i-t)/2,d=Bee(f,a,l)-n,d>0?i=f:t=f;while(Math.abs(d)>_Pe&&++y<yPe);return f}function gC(n,t,i,a){if(n===t&&i===a)return tu;const l=d=>EPe(d,0,1,n,i);return d=>d===0||d===1?d:Bee(l(d),t,a)}const zee=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,Wee=n=>t=>1-n(1-t),Gee=gC(.33,1.53,.69,.99),fj=Wee(Gee),Hee=zee(fj),$ee=n=>(n*=2)<1?.5*fj(n):.5*(2-Math.pow(2,-10*(n-1))),mj=n=>1-Math.sin(Math.acos(n)),Kee=Wee(mj),qee=zee(mj),Yee=n=>/^0[^.\s]+$/u.test(n);function vPe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Yee(n):!0}const gR=n=>Math.round(n*1e5)/1e5,gj=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function SPe(n){return n==null}const bPe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,_j=(n,t)=>i=>!!(typeof i=="string"&&bPe.test(i)&&i.startsWith(n)||t&&!SPe(i)&&Object.prototype.hasOwnProperty.call(i,t)),Xee=(n,t,i)=>a=>{if(typeof a!="string")return a;const[l,d,f,y]=a.match(gj);return{[n]:parseFloat(l),[t]:parseFloat(d),[i]:parseFloat(f),alpha:y!==void 0?parseFloat(y):1}},wPe=n=>Uf(0,255,n),HM={...L0,transform:n=>Math.round(wPe(n))},wy={test:_j("rgb","red"),parse:Xee("red","green","blue"),transform:({red:n,green:t,blue:i,alpha:a=1})=>"rgba("+HM.transform(n)+", "+HM.transform(t)+", "+HM.transform(i)+", "+gR(zR.transform(a))+")"};function TPe(n){let t="",i="",a="",l="";return n.length>5?(t=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(t=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),t+=t,i+=i,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const iV={test:_j("#"),parse:TPe,transform:wy.transform},DS={test:_j("hsl","hue"),parse:Xee("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+Tp.transform(gR(t))+", "+Tp.transform(gR(i))+", "+gR(zR.transform(a))+")"},sc={test:n=>wy.test(n)||iV.test(n)||DS.test(n),parse:n=>wy.test(n)?wy.parse(n):DS.test(n)?DS.parse(n):iV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?wy.transform(n):DS.transform(n)},RPe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function CPe(n){var t,i;return isNaN(n)&&typeof n=="string"&&(((t=n.match(gj))===null||t===void 0?void 0:t.length)||0)+(((i=n.match(RPe))===null||i===void 0?void 0:i.length)||0)>0}const Jee="number",Qee="color",IPe="var",APe="var(",Iq="${}",PPe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function GR(n){const t=n.toString(),i=[],a={color:[],number:[],var:[]},l=[];let d=0;const y=t.replace(PPe,v=>(sc.test(v)?(a.color.push(d),l.push(Qee),i.push(sc.parse(v))):v.startsWith(APe)?(a.var.push(d),l.push(IPe),i.push(v)):(a.number.push(d),l.push(Jee),i.push(parseFloat(v))),++d,Iq)).split(Iq);return{values:i,split:y,indexes:a,types:l}}function Zee(n){return GR(n).values}function ete(n){const{split:t,types:i}=GR(n),a=t.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=t[f],l[f]!==void 0){const y=i[f];y===Jee?d+=gR(l[f]):y===Qee?d+=sc.transform(l[f]):d+=l[f]}return d}}const OPe=n=>typeof n=="number"?0:n;function kPe(n){const t=Zee(n);return ete(n)(t.map(OPe))}const Ig={test:CPe,parse:Zee,createTransformer:ete,getAnimatableNone:kPe},NPe=new Set(["brightness","contrast","saturate","opacity"]);function DPe(n){const[t,i]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[a]=i.match(gj)||[];if(!a)return n;const l=i.replace(a,"");let d=NPe.has(t)?1:0;return a!==i&&(d*=100),t+"("+d+l+")"}const xPe=/\b([a-z-]*)\(.*?\)/gu,sV={...Ig,getAnimatableNone:n=>{const t=n.match(xPe);return t?t.map(DPe).join(" "):n}},LPe={...tj,color:sc,backgroundColor:sc,outlineColor:sc,fill:sc,stroke:sc,borderColor:sc,borderTopColor:sc,borderRightColor:sc,borderBottomColor:sc,borderLeftColor:sc,filter:sV,WebkitFilter:sV},yj=n=>LPe[n];function tte(n,t){let i=yj(n);return i!==sV&&(i=Ig),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const MPe=new Set(["auto","none","0"]);function UPe(n,t,i){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!MPe.has(d)&&GR(d).values.length&&(l=n[a]),a++}if(l&&i)for(const d of t)n[d]=tte(i,l)}const Aq=n=>n===L0||n===Hn,Pq=(n,t)=>parseFloat(n.split(", ")[t]),Oq=(n,t)=>(i,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return Pq(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?Pq(d[1],n):0}},VPe=new Set(["x","y","z"]),FPe=x0.filter(n=>!VPe.has(n));function jPe(n){const t=[];return FPe.forEach(i=>{const a=n.getValue(i);a!==void 0&&(t.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),t}const d0={width:({x:n},{paddingLeft:t="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(t)-parseFloat(i),height:({y:n},{paddingTop:t="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(t)-parseFloat(i),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:Oq(4,13),y:Oq(5,14)};d0.translateX=d0.x;d0.translateY=d0.y;const ky=new Set;let oV=!1,aV=!1;function nte(){if(aV){const n=Array.from(ky).filter(a=>a.needsMeasurement),t=new Set(n.map(a=>a.element)),i=new Map;t.forEach(a=>{const l=jPe(a);l.length&&(i.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=i.get(a);l&&l.forEach(([d,f])=>{var y;(y=a.getValue(d))===null||y===void 0||y.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}aV=!1,oV=!1,ky.forEach(n=>n.complete()),ky.clear()}function rte(){ky.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(aV=!0)})}function BPe(){rte(),nte()}class Ej{constructor(t,i,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ky.add(this),oV||(oV=!0,as.read(rte),as.resolveKeyframes(nte))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const f=l==null?void 0:l.get(),y=t[t.length-1];if(f!==void 0)t[0]=f;else if(a&&i){const v=a.readValue(i,y);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=y),l&&f===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ky.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ky.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const ite=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),zPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function WPe(n){const t=zPe.exec(n);if(!t)return[,];const[,i,a,l]=t;return[`--${i??a}`,l]}function ste(n,t,i=1){const[a,l]=WPe(n);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const f=d.trim();return ite(f)?parseFloat(f):f}return ej(l)?ste(l,t,i+1):l}const ote=n=>t=>t.test(n),GPe={test:n=>n==="auto",parse:n=>n},ate=[L0,Hn,Tp,cg,DAe,NAe,GPe],kq=n=>ate.find(ote(n));class cte extends Ej{constructor(t,i,a,l,d){super(t,i,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let b=t[v];if(typeof b=="string"&&(b=b.trim(),ej(b))){const R=ste(b,i.current);R!==void 0&&(t[v]=R),v===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!Vee.has(a)||t.length!==2)return;const[l,d]=t,f=kq(l),y=kq(d);if(f!==y)if(Aq(f)&&Aq(y))for(let v=0;v<t.length;v++){const b=t[v];typeof b=="string"&&(t[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,a=[];for(let l=0;l<t.length;l++)vPe(t[l])&&a.push(l);a.length&&UPe(t,a,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=d0[a](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:i,name:a,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const d=i.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,y=l[f];l[f]=d0[a](i.measureViewportBox(),window.getComputedStyle(i.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,b])=>{i.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const Nq=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Ig.test(n)||n==="0")&&!n.startsWith("url("));function HPe(n){const t=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==t)return!0}function $Pe(n,t,i,a){const l=n[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=n[n.length-1],f=Nq(l,t),y=Nq(d,t);return!f||!y?!1:HPe(n)||(i==="spring"||cj(i))&&a}const KPe=n=>n!==null;function Bk(n,{repeat:t,repeatType:i="loop"},a){const l=n.filter(KPe),d=t&&i!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const qPe=40;class lte{constructor({autoplay:t=!0,delay:i=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Rp.now(),this.options={autoplay:t,delay:i,type:a,repeat:l,repeatDelay:d,repeatType:f,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>qPe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&BPe(),this._resolved}onKeyframesResolved(t,i){this.resolvedAt=Rp.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:y,onUpdate:v,isGenerator:b}=this.options;if(!b&&!$Pe(t,a,l,d))if(f)this.options.duration=0;else{v&&v(Bk(t,this.options,i)),y&&y(),this.resolveFinishedPromise();return}const R=this.initPlayback(t,i);R!==!1&&(this._resolved={keyframes:t,finalKeyframe:i,...R},this.onPostResolved())}onPostResolved(){}then(t,i){return this.currentFinishedPromise.then(t,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const Ts=(n,t,i)=>n+(t-n)*i;function $M(n,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}function YPe({hue:n,saturation:t,lightness:i,alpha:a}){n/=360,t/=100,i/=100;let l=0,d=0,f=0;if(!t)l=d=f=i;else{const y=i<.5?i*(1+t):i+t-i*t,v=2*i-y;l=$M(v,y,n+1/3),d=$M(v,y,n),f=$M(v,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function WO(n,t){return i=>i>0?t:n}const KM=(n,t,i)=>{const a=n*n,l=i*(t*t-a)+a;return l<0?0:Math.sqrt(l)},XPe=[iV,wy,DS],JPe=n=>XPe.find(t=>t.test(n));function Dq(n){const t=JPe(n);if(!t)return!1;let i=t.parse(n);return t===DS&&(i=YPe(i)),i}const xq=(n,t)=>{const i=Dq(n),a=Dq(t);if(!i||!a)return WO(n,t);const l={...i};return d=>(l.red=KM(i.red,a.red,d),l.green=KM(i.green,a.green,d),l.blue=KM(i.blue,a.blue,d),l.alpha=Ts(i.alpha,a.alpha,d),wy.transform(l))},QPe=(n,t)=>i=>t(n(i)),_C=(...n)=>n.reduce(QPe),cV=new Set(["none","hidden"]);function ZPe(n,t){return cV.has(n)?i=>i<=0?n:t:i=>i>=1?t:n}function e1e(n,t){return i=>Ts(n,t,i)}function vj(n){return typeof n=="number"?e1e:typeof n=="string"?ej(n)?WO:sc.test(n)?xq:r1e:Array.isArray(n)?ute:typeof n=="object"?sc.test(n)?xq:t1e:WO}function ute(n,t){const i=[...n],a=i.length,l=n.map((d,f)=>vj(d)(d,t[f]));return d=>{for(let f=0;f<a;f++)i[f]=l[f](d);return i}}function t1e(n,t){const i={...n,...t},a={};for(const l in i)n[l]!==void 0&&t[l]!==void 0&&(a[l]=vj(n[l])(n[l],t[l]));return l=>{for(const d in a)i[d]=a[d](l);return i}}function n1e(n,t){var i;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],y=n.indexes[f][l[f]],v=(i=n.values[y])!==null&&i!==void 0?i:0;a[d]=v,l[f]++}return a}const r1e=(n,t)=>{const i=Ig.createTransformer(t),a=GR(n),l=GR(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?cV.has(n)&&!l.values.length||cV.has(t)&&!a.values.length?ZPe(n,t):_C(ute(n1e(a,l),l.values),i):WO(n,t)};function dte(n,t,i){return typeof n=="number"&&typeof t=="number"&&typeof i=="number"?Ts(n,t,i):vj(n)(n,t)}const i1e=5;function hte(n,t,i){const a=Math.max(t-i1e,0);return Fee(i-n(a),t-a)}const Bs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Lq=.001;function s1e({duration:n=Bs.duration,bounce:t=Bs.bounce,velocity:i=Bs.velocity,mass:a=Bs.mass}){let l,d,f=1-t;f=Uf(Bs.minDamping,Bs.maxDamping,f),n=Uf(Bs.minDuration,Bs.maxDuration,kf(n)),f<1?(l=b=>{const R=b*f,I=R*n,k=R-i,M=lV(b,f),L=Math.exp(-I);return Lq-k/M*L},d=b=>{const I=b*f*n,k=I*i+i,M=Math.pow(f,2)*Math.pow(b,2)*n,L=Math.exp(-I),j=lV(Math.pow(b,2),f);return(-l(b)+Lq>0?-1:1)*((k-M)*L)/j}):(l=b=>{const R=Math.exp(-b*n),I=(b-i)*n+1;return-.001+R*I},d=b=>{const R=Math.exp(-b*n),I=(i-b)*(n*n);return R*I});const y=5/n,v=a1e(l,d,y);if(n=Of(n),isNaN(v))return{stiffness:Bs.stiffness,damping:Bs.damping,duration:n};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:f*2*Math.sqrt(a*b),duration:n}}}const o1e=12;function a1e(n,t,i){let a=i;for(let l=1;l<o1e;l++)a=a-n(a)/t(a);return a}function lV(n,t){return n*Math.sqrt(1-t*t)}const c1e=["duration","bounce"],l1e=["stiffness","damping","mass"];function Mq(n,t){return t.some(i=>n[i]!==void 0)}function u1e(n){let t={velocity:Bs.velocity,stiffness:Bs.stiffness,damping:Bs.damping,mass:Bs.mass,isResolvedFromDuration:!1,...n};if(!Mq(n,l1e)&&Mq(n,c1e))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),l=a*a,d=2*Uf(.05,1,1-(n.bounce||0))*Math.sqrt(l);t={...t,mass:Bs.mass,stiffness:l,damping:d}}else{const i=s1e(n);t={...t,...i,mass:Bs.mass},t.isResolvedFromDuration=!0}return t}function pte(n=Bs.visualDuration,t=Bs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:a,restDelta:l}=i;const d=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],y={done:!1,value:d},{stiffness:v,damping:b,mass:R,duration:I,velocity:k,isResolvedFromDuration:M}=u1e({...i,velocity:-kf(i.velocity||0)}),L=k||0,j=b/(2*Math.sqrt(v*R)),z=f-d,Y=kf(Math.sqrt(v/R)),K=Math.abs(z)<5;a||(a=K?Bs.restSpeed.granular:Bs.restSpeed.default),l||(l=K?Bs.restDelta.granular:Bs.restDelta.default);let ne;if(j<1){const oe=lV(Y,j);ne=ge=>{const X=Math.exp(-j*Y*ge);return f-X*((L+j*Y*z)/oe*Math.sin(oe*ge)+z*Math.cos(oe*ge))}}else if(j===1)ne=oe=>f-Math.exp(-Y*oe)*(z+(L+Y*z)*oe);else{const oe=Y*Math.sqrt(j*j-1);ne=ge=>{const X=Math.exp(-j*Y*ge),J=Math.min(oe*ge,300);return f-X*((L+j*Y*z)*Math.sinh(J)+oe*z*Math.cosh(J))/oe}}const ce={calculatedDuration:M&&I||null,next:oe=>{const ge=ne(oe);if(M)y.done=oe>=I;else{let X=0;j<1&&(X=oe===0?Of(L):hte(ne,oe,ge));const J=Math.abs(X)<=a,te=Math.abs(f-ge)<=l;y.done=J&&te}return y.value=y.done?f:ge,y},toString:()=>{const oe=Math.min(kee(ce),tV),ge=Nee(X=>ce.next(oe*X).value,oe,30);return oe+"ms "+ge}};return ce}function Uq({keyframes:n,velocity:t=0,power:i=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:y,max:v,restDelta:b=.5,restSpeed:R}){const I=n[0],k={done:!1,value:I},M=J=>y!==void 0&&J<y||v!==void 0&&J>v,L=J=>y===void 0?v:v===void 0||Math.abs(y-J)<Math.abs(v-J)?y:v;let j=i*t;const z=I+j,Y=f===void 0?z:f(z);Y!==z&&(j=Y-I);const K=J=>-j*Math.exp(-J/a),ne=J=>Y+K(J),ce=J=>{const te=K(J),ie=ne(J);k.done=Math.abs(te)<=b,k.value=k.done?Y:ie};let oe,ge;const X=J=>{M(k.value)&&(oe=J,ge=pte({keyframes:[k.value,L(k.value)],velocity:hte(ne,J,k.value),damping:l,stiffness:d,restDelta:b,restSpeed:R}))};return X(0),{calculatedDuration:null,next:J=>{let te=!1;return!ge&&oe===void 0&&(te=!0,ce(J),X(J)),oe!==void 0&&J>=oe?ge.next(J-oe):(!te&&ce(J),k)}}}const d1e=gC(.42,0,1,1),h1e=gC(0,0,.58,1),fte=gC(.42,0,.58,1),p1e=n=>Array.isArray(n)&&typeof n[0]!="number",f1e={linear:tu,easeIn:d1e,easeInOut:fte,easeOut:h1e,circIn:mj,circInOut:qee,circOut:Kee,backIn:fj,backInOut:Hee,backOut:Gee,anticipate:$ee},Vq=n=>{if(lj(n)){dee(n.length===4);const[t,i,a,l]=n;return gC(t,i,a,l)}else if(typeof n=="string")return f1e[n];return n};function m1e(n,t,i){const a=[],l=i||dte,d=n.length-1;for(let f=0;f<d;f++){let y=l(n[f],n[f+1]);if(t){const v=Array.isArray(t)?t[f]||tu:t;y=_C(v,y)}a.push(y)}return a}function g1e(n,t,{clamp:i=!0,ease:a,mixer:l}={}){const d=n.length;if(dee(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const f=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),t=[...t].reverse());const y=m1e(t,a,l),v=y.length,b=R=>{if(f&&R<n[0])return t[0];let I=0;if(v>1)for(;I<n.length-2&&!(R<n[I+1]);I++);const k=l0(n[I],n[I+1],R);return y[I](k)};return i?R=>b(Uf(n[0],n[d-1],R)):b}function _1e(n,t){const i=n[n.length-1];for(let a=1;a<=t;a++){const l=l0(0,t,a);n.push(Ts(i,1,l))}}function y1e(n){const t=[0];return _1e(t,n.length-1),t}function E1e(n,t){return n.map(i=>i*t)}function v1e(n,t){return n.map(()=>t||fte).splice(0,n.length-1)}function GO({duration:n=300,keyframes:t,times:i,ease:a="easeInOut"}){const l=p1e(a)?a.map(Vq):Vq(a),d={done:!1,value:t[0]},f=E1e(i&&i.length===t.length?i:y1e(t),n),y=g1e(f,t,{ease:Array.isArray(l)?l:v1e(t,l)});return{calculatedDuration:n,next:v=>(d.value=y(v),d.done=v>=n,d)}}const S1e=n=>{const t=({timestamp:i})=>n(i);return{start:()=>as.update(t,!0),stop:()=>Cg(t),now:()=>ka.isProcessing?ka.timestamp:Rp.now()}},b1e={decay:Uq,inertia:Uq,tween:GO,keyframes:GO,spring:pte},w1e=n=>n/100;class Sj extends lte{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:i,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||Ej,y=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new f(d,y,i,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:i="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,y=cj(i)?i:b1e[i]||GO;let v,b;y!==GO&&typeof t[0]!="number"&&(v=_C(w1e,dte(t[0],t[1])),t=[0,100]);const R=y({...this.options,keyframes:t});d==="mirror"&&(b=y({...this.options,keyframes:[...t].reverse(),velocity:-f})),R.calculatedDuration===null&&(R.calculatedDuration=kee(R));const{calculatedDuration:I}=R,k=I+l,M=k*(a+1)-l;return{generator:R,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:I,resolvedDuration:k,totalDuration:M}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,i=!1){const{resolved:a}=this;if(!a){const{keyframes:J}=this.options;return{done:!0,value:J[J.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:y,keyframes:v,calculatedDuration:b,totalDuration:R,resolvedDuration:I}=a;if(this.startTime===null)return d.next(0);const{delay:k,repeat:M,repeatType:L,repeatDelay:j,onUpdate:z}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-R/this.speed,this.startTime)),i?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const Y=this.currentTime-k*(this.speed>=0?1:-1),K=this.speed>=0?Y<0:Y>R;this.currentTime=Math.max(Y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=R);let ne=this.currentTime,ce=d;if(M){const J=Math.min(this.currentTime,R)/I;let te=Math.floor(J),ie=J%1;!ie&&J>=1&&(ie=1),ie===1&&te--,te=Math.min(te,M+1),!!(te%2)&&(L==="reverse"?(ie=1-ie,j&&(ie-=j/I)):L==="mirror"&&(ce=f)),ne=Uf(0,1,ie)*I}const oe=K?{done:!1,value:v[0]}:ce.next(ne);y&&(oe.value=y(oe.value));let{done:ge}=oe;!K&&b!==null&&(ge=this.speed>=0?this.currentTime>=R:this.currentTime<=0);const X=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ge);return X&&l!==void 0&&(oe.value=Bk(v,this.options,l)),z&&z(oe.value),X&&this.finish(),oe}get duration(){const{resolved:t}=this;return t?kf(t.calculatedDuration):0}get time(){return kf(this.currentTime)}set time(t){t=Of(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=kf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=S1e,onPlay:i,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const T1e=new Set(["opacity","clipPath","filter","transform"]);function R1e(n,t,i,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:y="easeInOut",times:v}={}){const b={[t]:i};v&&(b.offset=v);const R=xee(y,l);return Array.isArray(R)&&(b.easing=R),n.animate(b,{delay:a,duration:l,easing:Array.isArray(R)?"linear":R,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const C1e=KF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),HO=10,I1e=2e4;function A1e(n){return cj(n.type)||n.type==="spring"||!Dee(n.ease)}function P1e(n,t){const i=new Sj({...t,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<I1e;)a=i.sample(d),l.push(a.value),d+=HO;return{times:void 0,keyframes:l,duration:d-HO,ease:"linear"}}const mte={anticipate:$ee,backInOut:Hee,circInOut:qee};function O1e(n){return n in mte}class Fq extends lte{constructor(t){super(t);const{name:i,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new cte(d,(f,y)=>this.onKeyframesResolved(f,y),i,a,l),this.resolver.scheduleResolve()}initPlayback(t,i){let{duration:a=300,times:l,ease:d,type:f,motionValue:y,name:v,startTime:b}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof d=="string"&&zO()&&O1e(d)&&(d=mte[d]),A1e(this.options)){const{onComplete:I,onUpdate:k,motionValue:M,element:L,...j}=this.options,z=P1e(t,j);t=z.keyframes,t.length===1&&(t[1]=t[0]),a=z.duration,l=z.times,d=z.ease,f="keyframes"}const R=R1e(y.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return R.startTime=b??this.calcStartTime(),this.pendingTimeline?(bq(R,this.pendingTimeline),this.pendingTimeline=void 0):R.onfinish=()=>{const{onComplete:I}=this.options;y.set(Bk(t,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:R,duration:a,times:l,type:f,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:i}=t;return kf(i)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:i}=t;return kf(i.currentTime||0)}set time(t){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.currentTime=Of(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:i}=t;return i.playbackRate}set speed(t){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:i}=t;return i.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:i}=t;return i.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:i}=this;if(!i)return tu;const{animation:a}=i;bq(a,t)}return tu}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:i,keyframes:a,duration:l,type:d,ease:f,times:y}=t;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:R,onComplete:I,element:k,...M}=this.options,L=new Sj({...M,keyframes:a,duration:l,type:d,ease:f,times:y,isGenerator:!0}),j=Of(this.time);b.setWithVelocity(L.sample(j-HO).value,L.sample(j).value,HO)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:i,name:a,repeatDelay:l,repeatType:d,damping:f,type:y}=t;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=i.owner.getProps();return C1e()&&a&&T1e.has(a)&&!v&&!b&&!l&&d!=="mirror"&&f!==0&&y!=="inertia"}}const k1e={type:"spring",stiffness:500,damping:25,restSpeed:10},N1e=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),D1e={type:"keyframes",duration:.8},x1e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},L1e=(n,{keyframes:t})=>t.length>2?D1e:Jy.has(n)?n.startsWith("scale")?N1e(t[1]):k1e:x1e;function M1e({when:n,delay:t,delayChildren:i,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:y,from:v,elapsed:b,...R}){return!!Object.keys(R).length}const bj=(n,t,i,a={},l,d)=>f=>{const y=aj(a,n)||{},v=y.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Of(v);let R={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),...y,delay:-b,onUpdate:k=>{t.set(k),y.onUpdate&&y.onUpdate(k)},onComplete:()=>{f(),y.onComplete&&y.onComplete()},name:n,motionValue:t,element:d?void 0:l};M1e(y)||(R={...R,...L1e(n,R)}),R.duration&&(R.duration=Of(R.duration)),R.repeatDelay&&(R.repeatDelay=Of(R.repeatDelay)),R.from!==void 0&&(R.keyframes[0]=R.from);let I=!1;if((R.type===!1||R.duration===0&&!R.repeatDelay)&&(R.duration=0,R.delay===0&&(I=!0)),I&&!d&&t.get()!==void 0){const k=Bk(R.keyframes,y);if(k!==void 0)return as.update(()=>{R.onUpdate(k),R.onComplete()}),new tPe([])}return!d&&Fq.supports(R)?new Fq(R):new Sj(R)};function U1e({protectedKeys:n,needsAnimating:t},i){const a=n.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,a}function gte(n,t,{delay:i=0,transitionOverride:a,type:l}={}){var d;let{transition:f=n.getDefaultTransition(),transitionEnd:y,...v}=t;a&&(f=a);const b=[],R=l&&n.animationState&&n.animationState.getState()[l];for(const I in v){const k=n.getValue(I,(d=n.latestValues[I])!==null&&d!==void 0?d:null),M=v[I];if(M===void 0||R&&U1e(R,I))continue;const L={delay:i,...aj(f||{},I)};let j=!1;if(window.MotionHandoffAnimation){const Y=jee(n);if(Y){const K=window.MotionHandoffAnimation(Y,I,as);K!==null&&(L.startTime=K,j=!0)}}rV(n,I),k.start(bj(I,k,M,n.shouldReduceMotion&&Vee.has(I)?{type:!1}:L,n,j));const z=k.animation;z&&b.push(z)}return y&&Promise.all(b).then(()=>{as.update(()=>{y&&mPe(n,y)})}),b}function uV(n,t,i={}){var a;const l=jk(n,t,i.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const f=l?()=>Promise.all(gte(n,l,i)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:R=0,staggerChildren:I,staggerDirection:k}=d;return V1e(n,t,R+b,I,k,i)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,R]=v==="beforeChildren"?[f,y]:[y,f];return b().then(()=>R())}else return Promise.all([f(),y(i.delay)])}function V1e(n,t,i=0,a=0,l=1,d){const f=[],y=(n.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>y-b*a;return Array.from(n.variantChildren).sort(F1e).forEach((b,R)=>{b.notify("AnimationStart",t),f.push(uV(b,t,{...d,delay:i+v(R)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(f)}function F1e(n,t){return n.sortNodePosition(t)}function j1e(n,t,i={}){n.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>uV(n,d,i));a=Promise.all(l)}else if(typeof t=="string")a=uV(n,t,i);else{const l=typeof t=="function"?jk(n,t,i.custom):t;a=Promise.all(gte(n,l,i))}return a.then(()=>{n.notify("AnimationComplete",t)})}const B1e=YF.length;function _te(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?_te(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const t={};for(let i=0;i<B1e;i++){const a=YF[i],l=n.props[a];(BR(l)||l===!1)&&(t[a]=l)}return t}const z1e=[...qF].reverse(),W1e=qF.length;function G1e(n){return t=>Promise.all(t.map(({animation:i,options:a})=>j1e(n,i,a)))}function H1e(n){let t=G1e(n),i=jq(),a=!0;const l=v=>(b,R)=>{var I;const k=jk(n,R,v==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(k){const{transition:M,transitionEnd:L,...j}=k;b={...b,...j,...L}}return b};function d(v){t=v(n)}function f(v){const{props:b}=n,R=_te(n.parent)||{},I=[],k=new Set;let M={},L=1/0;for(let z=0;z<W1e;z++){const Y=z1e[z],K=i[Y],ne=b[Y]!==void 0?b[Y]:R[Y],ce=BR(ne),oe=Y===v?K.isActive:null;oe===!1&&(L=z);let ge=ne===R[Y]&&ne!==b[Y]&&ce;if(ge&&a&&n.manuallyAnimateOnMount&&(ge=!1),K.protectedKeys={...M},!K.isActive&&oe===null||!ne&&!K.prevProp||Vk(ne)||typeof ne=="boolean")continue;const X=$1e(K.prevProp,ne);let J=X||Y===v&&K.isActive&&!ge&&ce||z>L&&ce,te=!1;const ie=Array.isArray(ne)?ne:[ne];let he=ie.reduce(l(Y),{});oe===!1&&(he={});const{prevResolvedValues:fe={}}=K,de={...fe,...he},ve=be=>{J=!0,k.has(be)&&(te=!0,k.delete(be)),K.needsAnimating[be]=!0;const Ce=n.getValue(be);Ce&&(Ce.liveStyle=!1)};for(const be in de){const Ce=he[be],Ae=fe[be];if(M.hasOwnProperty(be))continue;let De=!1;eV(Ce)&&eV(Ae)?De=!Oee(Ce,Ae):De=Ce!==Ae,De?Ce!=null?ve(be):k.add(be):Ce!==void 0&&k.has(be)?ve(be):K.protectedKeys[be]=!0}K.prevProp=ne,K.prevResolvedValues=he,K.isActive&&(M={...M,...he}),a&&n.blockInitialAnimation&&(J=!1),J&&(!(ge&&X)||te)&&I.push(...ie.map(be=>({animation:be,options:{type:Y}})))}if(k.size){const z={};k.forEach(Y=>{const K=n.getBaseTarget(Y),ne=n.getValue(Y);ne&&(ne.liveStyle=!0),z[Y]=K??null}),I.push({animation:z})}let j=!!I.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(j=!1),a=!1,j?t(I):Promise.resolve()}function y(v,b){var R;if(i[v].isActive===b)return Promise.resolve();(R=n.variantChildren)===null||R===void 0||R.forEach(k=>{var M;return(M=k.animationState)===null||M===void 0?void 0:M.setActive(v,b)}),i[v].isActive=b;const I=f(v);for(const k in i)i[k].protectedKeys={};return I}return{animateChanges:f,setActive:y,setAnimateFunction:d,getState:()=>i,reset:()=>{i=jq(),a=!0}}}function $1e(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!Oee(t,n):!1}function fy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function jq(){return{animate:fy(!0),whileInView:fy(),whileHover:fy(),whileTap:fy(),whileDrag:fy(),whileFocus:fy(),exit:fy()}}class Ug{constructor(t){this.isMounted=!1,this.node=t}update(){}}class K1e extends Ug{constructor(t){super(t),t.animationState||(t.animationState=H1e(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Vk(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let q1e=0;class Y1e extends Ug{constructor(){super(...arguments),this.id=q1e++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);i&&!t&&l.then(()=>i(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const X1e={animation:{Feature:K1e},exit:{Feature:Y1e}};function HR(n,t,i,a={passive:!0}){return n.addEventListener(t,i,a),()=>n.removeEventListener(t,i)}function yC(n){return{point:{x:n.pageX,y:n.pageY}}}const J1e=n=>t=>uj(t)&&n(t,yC(t));function _R(n,t,i,a){return HR(n,t,J1e(i),a)}const Bq=(n,t)=>Math.abs(n-t);function Q1e(n,t){const i=Bq(n.x,t.x),a=Bq(n.y,t.y);return Math.sqrt(i**2+a**2)}class yte{constructor(t,i,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=YM(this.lastMoveEventInfo,this.history),k=this.startEvent!==null,M=Q1e(I.offset,{x:0,y:0})>=3;if(!k&&!M)return;const{point:L}=I,{timestamp:j}=ka;this.history.push({...L,timestamp:j});const{onStart:z,onMove:Y}=this.handlers;k||(z&&z(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),Y&&Y(this.lastMoveEvent,I)},this.handlePointerMove=(I,k)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=qM(k,this.transformPagePoint),as.update(this.updatePoint,!0)},this.handlePointerUp=(I,k)=>{this.end();const{onEnd:M,onSessionEnd:L,resumeAnimation:j}=this.handlers;if(this.dragSnapToOrigin&&j&&j(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=YM(I.type==="pointercancel"?this.lastMoveEventInfo:qM(k,this.transformPagePoint),this.history);this.startEvent&&M&&M(I,z),L&&L(I,z)},!uj(t))return;this.dragSnapToOrigin=d,this.handlers=i,this.transformPagePoint=a,this.contextWindow=l||window;const f=yC(t),y=qM(f,this.transformPagePoint),{point:v}=y,{timestamp:b}=ka;this.history=[{...v,timestamp:b}];const{onSessionStart:R}=i;R&&R(t,YM(y,this.history)),this.removeListeners=_C(_R(this.contextWindow,"pointermove",this.handlePointerMove),_R(this.contextWindow,"pointerup",this.handlePointerUp),_R(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Cg(this.updatePoint)}}function qM(n,t){return t?{point:t(n.point)}:n}function zq(n,t){return{x:n.x-t.x,y:n.y-t.y}}function YM({point:n},t){return{point:n,delta:zq(n,Ete(t)),offset:zq(n,Z1e(t)),velocity:eOe(t,.1)}}function Z1e(n){return n[0]}function Ete(n){return n[n.length-1]}function eOe(n,t){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=Ete(n);for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>Of(t)));)i--;if(!a)return{x:0,y:0};const d=kf(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const vte=1e-4,tOe=1-vte,nOe=1+vte,Ste=.01,rOe=0-Ste,iOe=0+Ste;function iu(n){return n.max-n.min}function sOe(n,t,i){return Math.abs(n-t)<=i}function Wq(n,t,i,a=.5){n.origin=a,n.originPoint=Ts(t.min,t.max,n.origin),n.scale=iu(i)/iu(t),n.translate=Ts(i.min,i.max,n.origin)-n.originPoint,(n.scale>=tOe&&n.scale<=nOe||isNaN(n.scale))&&(n.scale=1),(n.translate>=rOe&&n.translate<=iOe||isNaN(n.translate))&&(n.translate=0)}function yR(n,t,i,a){Wq(n.x,t.x,i.x,a?a.originX:void 0),Wq(n.y,t.y,i.y,a?a.originY:void 0)}function Gq(n,t,i){n.min=i.min+t.min,n.max=n.min+iu(t)}function oOe(n,t,i){Gq(n.x,t.x,i.x),Gq(n.y,t.y,i.y)}function Hq(n,t,i){n.min=t.min-i.min,n.max=n.min+iu(t)}function ER(n,t,i){Hq(n.x,t.x,i.x),Hq(n.y,t.y,i.y)}function aOe(n,{min:t,max:i},a){return t!==void 0&&n<t?n=a?Ts(t,n,a.min):Math.max(n,t):i!==void 0&&n>i&&(n=a?Ts(i,n,a.max):Math.min(n,i)),n}function $q(n,t,i){return{min:t!==void 0?n.min+t:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function cOe(n,{top:t,left:i,bottom:a,right:l}){return{x:$q(n.x,i,l),y:$q(n.y,t,a)}}function Kq(n,t){let i=t.min-n.min,a=t.max-n.max;return t.max-t.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function lOe(n,t){return{x:Kq(n.x,t.x),y:Kq(n.y,t.y)}}function uOe(n,t){let i=.5;const a=iu(n),l=iu(t);return l>a?i=l0(t.min,t.max-a,n.min):a>l&&(i=l0(n.min,n.max-l,t.min)),Uf(0,1,i)}function dOe(n,t){const i={};return t.min!==void 0&&(i.min=t.min-n.min),t.max!==void 0&&(i.max=t.max-n.min),i}const dV=.35;function hOe(n=dV){return n===!1?n=0:n===!0&&(n=dV),{x:qq(n,"left","right"),y:qq(n,"top","bottom")}}function qq(n,t,i){return{min:Yq(n,t),max:Yq(n,i)}}function Yq(n,t){return typeof n=="number"?n:n[t]||0}const Xq=()=>({translate:0,scale:1,origin:0,originPoint:0}),xS=()=>({x:Xq(),y:Xq()}),Jq=()=>({min:0,max:0}),so=()=>({x:Jq(),y:Jq()});function qu(n){return[n("x"),n("y")]}function bte({top:n,left:t,right:i,bottom:a}){return{x:{min:t,max:i},y:{min:n,max:a}}}function pOe({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function fOe(n,t){if(!t)return n;const i=t({x:n.left,y:n.top}),a=t({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function XM(n){return n===void 0||n===1}function hV({scale:n,scaleX:t,scaleY:i}){return!XM(n)||!XM(t)||!XM(i)}function gy(n){return hV(n)||wte(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function wte(n){return Qq(n.x)||Qq(n.y)}function Qq(n){return n&&n!=="0%"}function $O(n,t,i){const a=n-i,l=t*a;return i+l}function Zq(n,t,i,a,l){return l!==void 0&&(n=$O(n,l,a)),$O(n,i,a)+t}function pV(n,t=0,i=1,a,l){n.min=Zq(n.min,t,i,a,l),n.max=Zq(n.max,t,i,a,l)}function Tte(n,{x:t,y:i}){pV(n.x,t.translate,t.scale,t.originPoint),pV(n.y,i.translate,i.scale,i.originPoint)}const eY=.999999999999,tY=1.0000000000001;function mOe(n,t,i,a=!1){const l=i.length;if(!l)return;t.x=t.y=1;let d,f;for(let y=0;y<l;y++){d=i[y],f=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&MS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,Tte(n,f)),a&&gy(d.latestValues)&&MS(n,d.latestValues))}t.x<tY&&t.x>eY&&(t.x=1),t.y<tY&&t.y>eY&&(t.y=1)}function LS(n,t){n.min=n.min+t,n.max=n.max+t}function nY(n,t,i,a,l=.5){const d=Ts(n.min,n.max,l);pV(n,t,i,d,a)}function MS(n,t){nY(n.x,t.x,t.scaleX,t.scale,t.originX),nY(n.y,t.y,t.scaleY,t.scale,t.originY)}function Rte(n,t){return bte(fOe(n.getBoundingClientRect(),t))}function gOe(n,t,i){const a=Rte(n,i),{scroll:l}=t;return l&&(LS(a.x,l.offset.x),LS(a.y,l.offset.y)),a}const Cte=({current:n})=>n?n.ownerDocument.defaultView:null,_Oe=new WeakMap;class yOe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=so(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=R=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(yC(R).point)},d=(R,I)=>{const{drag:k,dragPropagation:M,onDragStart:L}=this.getProps();if(k&&!M&&(this.openDragLock&&this.openDragLock(),this.openDragLock=uPe(k),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),qu(z=>{let Y=this.getAxisMotionValue(z).get()||0;if(Tp.test(Y)){const{projection:K}=this.visualElement;if(K&&K.layout){const ne=K.layout.layoutBox[z];ne&&(Y=iu(ne)*(parseFloat(Y)/100))}}this.originPoint[z]=Y}),L&&as.postRender(()=>L(R,I)),rV(this.visualElement,"transform");const{animationState:j}=this.visualElement;j&&j.setActive("whileDrag",!0)},f=(R,I)=>{const{dragPropagation:k,dragDirectionLock:M,onDirectionLock:L,onDrag:j}=this.getProps();if(!k&&!this.openDragLock)return;const{offset:z}=I;if(M&&this.currentDirection===null){this.currentDirection=EOe(z),this.currentDirection!==null&&L&&L(this.currentDirection);return}this.updateAxis("x",I.point,z),this.updateAxis("y",I.point,z),this.visualElement.render(),j&&j(R,I)},y=(R,I)=>this.stop(R,I),v=()=>qu(R=>{var I;return this.getAnimationState(R)==="paused"&&((I=this.getAxisMotionValue(R).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new yte(t,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:y,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Cte(this.visualElement)})}stop(t,i){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&as.postRender(()=>d(t,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,a){const{drag:l}=this.getProps();if(!a||!D1(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let f=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(f=aOe(f,this.constraints[t],this.elastic[t])),d.set(f)}resolveConstraints(){var t;const{dragConstraints:i,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;i&&NS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=cOe(l.layoutBox,i):this.constraints=!1,this.elastic=hOe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&qu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=dOe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!NS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=gOe(a,l.root,this.visualElement.getTransformPagePoint());let f=lOe(l.layout.layoutBox,d);if(i){const y=i(pOe(f));this.hasMutatedConstraints=!!y,y&&(f=bte(y))}return f}startAnimation(t){const{drag:i,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:y}=this.getProps(),v=this.constraints||{},b=qu(R=>{if(!D1(R,i,this.currentDirection))return;let I=v&&v[R]||{};f&&(I={min:0,max:0});const k=l?200:1e6,M=l?40:1e7,L={type:"inertia",velocity:a?t[R]:0,bounceStiffness:k,bounceDamping:M,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(R,L)});return Promise.all(b).then(y)}startAxisValueAnimation(t,i){const a=this.getAxisMotionValue(t);return rV(this.visualElement,t),a.start(bj(t,a,0,i,this.visualElement,!1))}stopAnimation(){qu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){qu(t=>{var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[i];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){qu(i=>{const{drag:a}=this.getProps();if(!D1(i,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(i);if(l&&l.layout){const{min:f,max:y}=l.layout.layoutBox[i];d.set(t[i]-Ts(f,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!NS(i)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};qu(f=>{const y=this.getAxisMotionValue(f);if(y&&this.constraints!==!1){const v=y.get();l[f]=uOe({min:v,max:v},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),qu(f=>{if(!D1(f,t,null))return;const y=this.getAxisMotionValue(f),{min:v,max:b}=this.constraints[f];y.set(Ts(v,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;_Oe.set(this.visualElement,this);const t=this.visualElement.current,i=_R(t,"pointerdown",v=>{const{drag:b,dragListener:R=!0}=this.getProps();b&&R&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();NS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),as.read(a);const f=HR(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(qu(R=>{const I=this.getAxisMotionValue(R);I&&(this.originPoint[R]+=v[R].translate,I.set(I.get()+v[R].translate))}),this.visualElement.render())});return()=>{f(),i(),d(),y&&y()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=dV,dragMomentum:y=!0}=t;return{...t,drag:i,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:y}}}function D1(n,t,i){return(t===!0||t===n)&&(i===null||i===n)}function EOe(n,t=10){let i=null;return Math.abs(n.y)>t?i="y":Math.abs(n.x)>t&&(i="x"),i}class vOe extends Ug{constructor(t){super(t),this.removeGroupControls=tu,this.removeListeners=tu,this.controls=new yOe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||tu}unmount(){this.removeGroupControls(),this.removeListeners()}}const rY=n=>(t,i)=>{n&&as.postRender(()=>n(t,i))};class SOe extends Ug{constructor(){super(...arguments),this.removePointerDownListener=tu}onPointerDown(t){this.session=new yte(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Cte(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:rY(t),onStart:rY(i),onMove:a,onEnd:(d,f)=>{delete this.session,l&&as.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=_R(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const fO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function iY(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const kT={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(Hn.test(n))n=parseFloat(n);else return n;const i=iY(n,t.target.x),a=iY(n,t.target.y);return`${i}% ${a}%`}},bOe={correct:(n,{treeScale:t,projectionDelta:i})=>{const a=n,l=Ig.parse(n);if(l.length>5)return a;const d=Ig.createTransformer(n),f=typeof l[0]!="number"?1:0,y=i.x.scale*t.x,v=i.y.scale*t.y;l[0+f]/=y,l[1+f]/=v;const b=Ts(y,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),d(l)}};class wOe extends N.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;WAe(TOe),d&&(i.group&&i.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),fO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||t.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?f.promote():f.relegate()||as.postRender(()=>{const y=f.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),JF.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Ite(n){const[t,i]=HF(),a=N.useContext(zF);return w.jsx(wOe,{...n,layoutGroup:a,switchLayoutGroup:N.useContext(_ee),isPresent:t,safeToRemove:i})}const TOe={borderRadius:{...kT,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:kT,borderTopRightRadius:kT,borderBottomLeftRadius:kT,borderBottomRightRadius:kT,boxShadow:bOe};function ROe(n,t,i){const a=cc(n)?n:WR(n);return a.start(bj("",a,t,i)),a.animation}function COe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const IOe=(n,t)=>n.depth-t.depth;class AOe{constructor(){this.children=[],this.isDirty=!1}add(t){dj(this.children,t),this.isDirty=!0}remove(t){hj(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(IOe),this.isDirty=!1,this.children.forEach(t)}}function POe(n,t){const i=Rp.now(),a=({timestamp:l})=>{const d=l-i;d>=t&&(Cg(a),n(d-t))};return as.read(a,!0),()=>Cg(a)}const Ate=["TopLeft","TopRight","BottomLeft","BottomRight"],OOe=Ate.length,sY=n=>typeof n=="string"?parseFloat(n):n,oY=n=>typeof n=="number"||Hn.test(n);function kOe(n,t,i,a,l,d){l?(n.opacity=Ts(0,i.opacity!==void 0?i.opacity:1,NOe(a)),n.opacityExit=Ts(t.opacity!==void 0?t.opacity:1,0,DOe(a))):d&&(n.opacity=Ts(t.opacity!==void 0?t.opacity:1,i.opacity!==void 0?i.opacity:1,a));for(let f=0;f<OOe;f++){const y=`border${Ate[f]}Radius`;let v=aY(t,y),b=aY(i,y);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||oY(v)===oY(b)?(n[y]=Math.max(Ts(sY(v),sY(b),a),0),(Tp.test(b)||Tp.test(v))&&(n[y]+="%")):n[y]=b}(t.rotate||i.rotate)&&(n.rotate=Ts(t.rotate||0,i.rotate||0,a))}function aY(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const NOe=Pte(0,.5,Kee),DOe=Pte(.5,.95,tu);function Pte(n,t,i){return a=>a<n?0:a>t?1:i(l0(n,t,a))}function cY(n,t){n.min=t.min,n.max=t.max}function Hu(n,t){cY(n.x,t.x),cY(n.y,t.y)}function lY(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function uY(n,t,i,a,l){return n-=t,n=$O(n,1/i,a),l!==void 0&&(n=$O(n,1/l,a)),n}function xOe(n,t=0,i=1,a=.5,l,d=n,f=n){if(Tp.test(t)&&(t=parseFloat(t),t=Ts(f.min,f.max,t/100)-f.min),typeof t!="number")return;let y=Ts(d.min,d.max,a);n===d&&(y-=t),n.min=uY(n.min,t,i,y,l),n.max=uY(n.max,t,i,y,l)}function dY(n,t,[i,a,l],d,f){xOe(n,t[i],t[a],t[l],t.scale,d,f)}const LOe=["x","scaleX","originX"],MOe=["y","scaleY","originY"];function hY(n,t,i,a){dY(n.x,t,LOe,i?i.x:void 0,a?a.x:void 0),dY(n.y,t,MOe,i?i.y:void 0,a?a.y:void 0)}function pY(n){return n.translate===0&&n.scale===1}function Ote(n){return pY(n.x)&&pY(n.y)}function fY(n,t){return n.min===t.min&&n.max===t.max}function UOe(n,t){return fY(n.x,t.x)&&fY(n.y,t.y)}function mY(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function kte(n,t){return mY(n.x,t.x)&&mY(n.y,t.y)}function gY(n){return iu(n.x)/iu(n.y)}function _Y(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class VOe{constructor(){this.members=[]}add(t){dj(this.members,t),t.scheduleRender()}remove(t){if(hj(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(l=>t===l);if(i===0)return!1;let a;for(let l=i;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,i){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,i&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:a}=t;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function FOe(n,t,i){let a="";const l=n.x.translate/t.x,d=n.y.translate/t.y,f=(i==null?void 0:i.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:b,rotate:R,rotateX:I,rotateY:k,skewX:M,skewY:L}=i;b&&(a=`perspective(${b}px) ${a}`),R&&(a+=`rotate(${R}deg) `),I&&(a+=`rotateX(${I}deg) `),k&&(a+=`rotateY(${k}deg) `),M&&(a+=`skewX(${M}deg) `),L&&(a+=`skewY(${L}deg) `)}const y=n.x.scale*t.x,v=n.y.scale*t.y;return(y!==1||v!==1)&&(a+=`scale(${y}, ${v})`),a||"none"}const _y={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},JT=typeof window<"u"&&window.MotionDebug!==void 0,JM=["","X","Y","Z"],jOe={visibility:"hidden"},yY=1e3;let BOe=0;function QM(n,t,i,a){const{latestValues:l}=t;l[n]&&(i[n]=l[n],t.setStaticValue(n,0),a&&(a[n]=0))}function Nte(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const i=jee(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",as,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&Nte(a)}function Dte({attachResizeListener:n,defaultParent:t,measureScroll:i,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},y=t==null?void 0:t()){this.id=BOe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,JT&&(_y.totalNodes=_y.resolvedTargetDeltas=_y.recalculatedProjection=0),this.nodes.forEach(GOe),this.nodes.forEach(YOe),this.nodes.forEach(XOe),this.nodes.forEach(HOe),JT&&window.MotionDebug.record(_y)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new AOe)}addEventListener(f,y){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new pj),this.eventHandlers.get(f).add(y)}notifyListeners(f,...y){const v=this.eventHandlers.get(f);v&&v.notify(...y)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=COe(f),this.instance=f;const{layoutId:v,layout:b,visualElement:R}=this.options;if(R&&!R.current&&R.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(b||v)&&(this.isLayoutDirty=!0),n){let I;const k=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=POe(k,250),fO.hasAnimatedSinceResize&&(fO.hasAnimatedSinceResize=!1,this.nodes.forEach(vY))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&R&&(v||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:k,hasRelativeTargetChanged:M,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const j=this.options.transition||R.getDefaultTransition()||tke,{onLayoutAnimationStart:z,onLayoutAnimationComplete:Y}=R.getProps(),K=!this.targetLayout||!kte(this.targetLayout,L)||M,ne=!k&&M;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ne||k&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,ne);const ce={...aj(j,"layout"),onPlay:z,onComplete:Y};(R.shouldReduceMotion||this.options.layoutRoot)&&(ce.delay=0,ce.type=!1),this.startAnimation(ce)}else k||vY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Cg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(JOe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Nte(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let R=0;R<this.path.length;R++){const I=this.path[R];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:y,layout:v}=this.options;if(y===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(EY);return}this.isUpdating||this.nodes.forEach(KOe),this.isUpdating=!1,this.nodes.forEach(qOe),this.nodes.forEach(zOe),this.nodes.forEach(WOe),this.clearAllSnapshots();const y=Rp.now();ka.delta=Uf(0,1e3/60,y-ka.timestamp),ka.timestamp=y,ka.isProcessing=!0,WM.update.process(ka),WM.preRender.process(ka),WM.render.process(ka),ka.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,JF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach($Oe),this.sharedNodes.forEach(QOe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,as.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){as.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=so(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(y=!1),y){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!Ote(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,R=b!==this.prevTransformTemplateValue;f&&(y||gy(this.latestValues)||R)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const y=this.measurePageBox();let v=this.removeElementScroll(y);return f&&(v=this.removeTransform(v)),nke(v),{animationId:this.root.animationId,measuredBox:y,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:y}=this.options;if(!y)return so();const v=y.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(rke))){const{scroll:R}=this.root;R&&(LS(v.x,R.offset.x),LS(v.y,R.offset.y))}return v}removeElementScroll(f){var y;const v=so();if(Hu(v,f),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return v;for(let b=0;b<this.path.length;b++){const R=this.path[b],{scroll:I,options:k}=R;R!==this.root&&I&&k.layoutScroll&&(I.wasRoot&&Hu(v,f),LS(v.x,I.offset.x),LS(v.y,I.offset.y))}return v}applyTransform(f,y=!1){const v=so();Hu(v,f);for(let b=0;b<this.path.length;b++){const R=this.path[b];!y&&R.options.layoutScroll&&R.scroll&&R!==R.root&&MS(v,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),gy(R.latestValues)&&MS(v,R.latestValues)}return gy(this.latestValues)&&MS(v,this.latestValues),v}removeTransform(f){const y=so();Hu(y,f);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!gy(b.latestValues))continue;hV(b.latestValues)&&b.updateSnapshot();const R=so(),I=b.measurePageBox();Hu(R,I),hY(y,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,R)}return gy(this.latestValues)&&hY(y,this.latestValues),y}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ka.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var y;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:k}=this.options;if(!(!this.layout||!(I||k))){if(this.resolvedRelativeTargetAt=ka.timestamp,!this.targetDelta&&!this.relativeTarget){const M=this.getClosestProjectingParent();M&&M.layout&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=so(),this.relativeTargetOrigin=so(),ER(this.relativeTargetOrigin,this.layout.layoutBox,M.layout.layoutBox),Hu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=so(),this.targetWithTransforms=so()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),oOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Hu(this.target,this.layout.layoutBox),Tte(this.target,this.targetDelta)):Hu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const M=this.getClosestProjectingParent();M&&!!M.resumingFrom==!!this.resumingFrom&&!M.options.layoutScroll&&M.target&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=so(),this.relativeTargetOrigin=so(),ER(this.relativeTargetOrigin,this.target,M.target),Hu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}JT&&_y.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||hV(this.parent.latestValues)||wte(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const y=this.getLead(),v=!!this.resumingFrom||this!==y;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===ka.timestamp&&(b=!1),b)return;const{layout:R,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(R||I))return;Hu(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,M=this.treeScale.y;mOe(this.layoutCorrected,this.treeScale,this.path,v),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=so());const{target:L}=y;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(lY(this.prevProjectionDelta.x,this.projectionDelta.x),lY(this.prevProjectionDelta.y,this.projectionDelta.y)),yR(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==M||!_Y(this.projectionDelta.x,this.prevProjectionDelta.x)||!_Y(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L)),JT&&_y.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=xS(),this.projectionDelta=xS(),this.projectionDeltaWithTransform=xS()}setAnimationOrigin(f,y=!1){const v=this.snapshot,b=v?v.latestValues:{},R={...this.latestValues},I=xS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const k=so(),M=v?v.source:void 0,L=this.layout?this.layout.source:void 0,j=M!==L,z=this.getStack(),Y=!z||z.members.length<=1,K=!!(j&&!Y&&this.options.crossfade===!0&&!this.path.some(eke));this.animationProgress=0;let ne;this.mixTargetDelta=ce=>{const oe=ce/1e3;SY(I.x,f.x,oe),SY(I.y,f.y,oe),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ER(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),ZOe(this.relativeTarget,this.relativeTargetOrigin,k,oe),ne&&UOe(this.relativeTarget,ne)&&(this.isProjectionDirty=!1),ne||(ne=so()),Hu(ne,this.relativeTarget)),j&&(this.animationValues=R,kOe(R,b,this.latestValues,oe,K,Y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=oe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Cg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=as.update(()=>{fO.hasAnimatedSinceResize=!0,this.currentAnimation=ROe(0,yY,{...f,onUpdate:y=>{this.mixTargetDelta(y),f.onUpdate&&f.onUpdate(y)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(yY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:y,target:v,layout:b,latestValues:R}=f;if(!(!y||!v||!b)){if(this!==f&&this.layout&&b&&xte(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||so();const I=iu(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+I;const k=iu(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+k}Hu(y,v),MS(y,R),yR(this.projectionDeltaWithTransform,this.layoutCorrected,y,R)}}registerSharedNode(f,y){this.sharedNodes.has(f)||this.sharedNodes.set(f,new VOe),this.sharedNodes.get(f).add(y);const b=y.options.initialPromotionConfig;y.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(y):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:y}=this.options;return y?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:y}=this.options;return y?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:y,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let y=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(y=!0),!y)return;const b={};v.z&&QM("z",f,b,this.animationValues);for(let R=0;R<JM.length;R++)QM(`rotate${JM[R]}`,f,b,this.animationValues),QM(`skew${JM[R]}`,f,b,this.animationValues);f.render();for(const R in b)f.setStaticValue(R,b[R]),this.animationValues&&(this.animationValues[R]=b[R]);f.scheduleRender()}getProjectionStyles(f){var y,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return jOe;const b={visibility:""},R=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=hO(f==null?void 0:f.pointerEvents)||"",b.transform=R?R(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const j={};return this.options.layoutId&&(j.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,j.pointerEvents=hO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!gy(this.latestValues)&&(j.transform=R?R({},""):"none",this.hasProjected=!1),j}const k=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=FOe(this.projectionDeltaWithTransform,this.treeScale,k),R&&(b.transform=R(k,b.transform));const{x:M,y:L}=this.projectionDelta;b.transformOrigin=`${M.origin*100}% ${L.origin*100}% 0`,I.animationValues?b.opacity=I===this?(v=(y=k.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:k.opacityExit:b.opacity=I===this?k.opacity!==void 0?k.opacity:"":k.opacityExit!==void 0?k.opacityExit:0;for(const j in BO){if(k[j]===void 0)continue;const{correct:z,applyTo:Y}=BO[j],K=b.transform==="none"?k[j]:z(k[j],I);if(Y){const ne=Y.length;for(let ce=0;ce<ne;ce++)b[Y[ce]]=K}else b[j]=K}return this.options.layoutId&&(b.pointerEvents=I===this?hO(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var y;return(y=f.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach(EY),this.root.sharedNodes.clear()}}}function zOe(n){n.updateLayout()}function WOe(n){var t;const i=((t=n.resumeFrom)===null||t===void 0?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,f=i.source!==n.layout.source;d==="size"?qu(I=>{const k=f?i.measuredBox[I]:i.layoutBox[I],M=iu(k);k.min=a[I].min,k.max=k.min+M}):xte(d,i.layoutBox,a)&&qu(I=>{const k=f?i.measuredBox[I]:i.layoutBox[I],M=iu(a[I]);k.max=k.min+M,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+M)});const y=xS();yR(y,a,i.layoutBox);const v=xS();f?yR(v,n.applyTransform(l,!0),i.measuredBox):yR(v,a,i.layoutBox);const b=!Ote(y);let R=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:k,layout:M}=I;if(k&&M){const L=so();ER(L,i.layoutBox,k.layoutBox);const j=so();ER(j,a,M.layoutBox),kte(L,j)||(R=!0),I.options.layoutRoot&&(n.relativeTarget=j,n.relativeTargetOrigin=L,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:v,layoutDelta:y,hasLayoutChanged:b,hasRelativeTargetChanged:R})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function GOe(n){JT&&_y.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function HOe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function $Oe(n){n.clearSnapshot()}function EY(n){n.clearMeasurements()}function KOe(n){n.isLayoutDirty=!1}function qOe(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function vY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function YOe(n){n.resolveTargetDelta()}function XOe(n){n.calcProjection()}function JOe(n){n.resetSkewAndRotation()}function QOe(n){n.removeLeadSnapshot()}function SY(n,t,i){n.translate=Ts(t.translate,0,i),n.scale=Ts(t.scale,1,i),n.origin=t.origin,n.originPoint=t.originPoint}function bY(n,t,i,a){n.min=Ts(t.min,i.min,a),n.max=Ts(t.max,i.max,a)}function ZOe(n,t,i,a){bY(n.x,t.x,i.x,a),bY(n.y,t.y,i.y,a)}function eke(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const tke={duration:.45,ease:[.4,0,.1,1]},wY=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),TY=wY("applewebkit/")&&!wY("chrome/")?Math.round:tu;function RY(n){n.min=TY(n.min),n.max=TY(n.max)}function nke(n){RY(n.x),RY(n.y)}function xte(n,t,i){return n==="position"||n==="preserve-aspect"&&!sOe(gY(t),gY(i),.2)}function rke(n){var t;return n!==n.root&&((t=n.scroll)===null||t===void 0?void 0:t.wasRoot)}const ike=Dte({attachResizeListener:(n,t)=>HR(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ZM={current:void 0},Lte=Dte({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!ZM.current){const n=new ike({});n.mount(window),n.setOptions({layoutScroll:!0}),ZM.current=n}return ZM.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),ske={pan:{Feature:SOe},drag:{Feature:vOe,ProjectionNode:Lte,MeasureLayout:Ite}};function CY(n,t,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,d=a[l];d&&as.postRender(()=>d(t,yC(t)))}class oke extends Ug{mount(){const{current:t}=this.node;t&&(this.unmount=sPe(t,i=>(CY(this.node,i,"Start"),a=>CY(this.node,a,"End"))))}unmount(){}}class ake extends Ug{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=_C(HR(this.node.current,"focus",()=>this.onFocus()),HR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function IY(n,t,i){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),d=a[l];d&&as.postRender(()=>d(t,yC(t)))}class cke extends Ug{mount(){const{current:t}=this.node;t&&(this.unmount=lPe(t,i=>(IY(this.node,i,"Start"),(a,{success:l})=>IY(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const fV=new WeakMap,eU=new WeakMap,lke=n=>{const t=fV.get(n.target);t&&t(n)},uke=n=>{n.forEach(lke)};function dke({root:n,...t}){const i=n||document;eU.has(i)||eU.set(i,{});const a=eU.get(i),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(uke,{root:n,...t})),a[l]}function hke(n,t,i){const a=dke(t);return fV.set(n,i),a.observe(n),()=>{fV.delete(n),a.unobserve(n)}}const pke={some:0,all:1};class fke extends Ug{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:a,amount:l="some",once:d}=t,f={root:i?i.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:pke[l]},y=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:R,onViewportLeave:I}=this.node.getProps(),k=b?R:I;k&&k(v)};return hke(this.node.current,f,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(mke(t,i))&&this.startObserver()}unmount(){}}function mke({viewport:n={}},{viewport:t={}}={}){return i=>n[i]!==t[i]}const gke={inView:{Feature:fke},tap:{Feature:cke},focus:{Feature:ake},hover:{Feature:oke}},_ke={layout:{ProjectionNode:Lte,MeasureLayout:Ite}},mV={current:null},Mte={current:!1};function yke(){if(Mte.current=!0,!!$F)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>mV.current=n.matches;n.addListener(t),t()}else mV.current=!1}const Eke=[...ate,sc,Ig],vke=n=>Eke.find(ote(n)),AY=new WeakMap;function Ske(n,t,i){for(const a in t){const l=t[a],d=i[a];if(cc(l))n.addValue(a,l);else if(cc(d))n.addValue(a,WR(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,WR(f!==void 0?f:l,{owner:n}))}}for(const a in i)t[a]===void 0&&n.removeValue(a);return t}const PY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class bke{scrapeMotionValuesFromProps(t,i,a){return{}}constructor({parent:t,props:i,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Ej,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const M=Rp.now();this.renderScheduledAt<M&&(this.renderScheduledAt=M,as.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:R}=f;this.onUpdate=R,this.latestValues=v,this.baseTarget={...v},this.initialValues=i.initial?{...v}:{},this.renderState=b,this.parent=t,this.props=i,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!d,this.isControllingVariants=Fk(i),this.isVariantNode=mee(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:I,...k}=this.scrapeMotionValuesFromProps(i,{},this);for(const M in k){const L=k[M];v[M]!==void 0&&cc(L)&&L.set(v[M],!1)}}mount(t){this.current=t,AY.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),Mte.current||yke(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:mV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){AY.delete(this.current),this.projection&&this.projection.unmount(),Cg(this.notifyUpdate),Cg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const i=this.features[t];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=Jy.has(t),l=i.on("change",y=>{this.latestValues[t]=y,this.props.onUpdate&&as.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{l(),d(),f&&f(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in u0){const i=u0[t];if(!i)continue;const{isEnabled:a,Feature:l}=i;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):so()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<PY.length;a++){const l=PY[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=t[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=Ske(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const a=this.values.get(t);i!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&i!==void 0&&(a=WR(i===null?void 0:i,{owner:this}),this.addValue(t,a)),a}readValue(t,i){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(ite(l)||Yee(l))?l=parseFloat(l):!vke(l)&&Ig.test(i)&&(l=tte(t,i)),this.setBaseTarget(t,cc(l)?l.get():l)),cc(l)?l.get():l}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var i;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=ZF(this.props,a,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(l=f[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!cc(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new pj),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class Ute extends bke{constructor(){super(...arguments),this.KeyframeResolver=cte}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:a}){delete i[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;cc(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function wke(n){return window.getComputedStyle(n)}class Tke extends Ute{constructor(){super(...arguments),this.type="html",this.renderInstance=Tee}readValueFromInstance(t,i){if(Jy.has(i)){const a=yj(i);return a&&a.default||0}else{const a=wke(t),l=(See(i)?a.getPropertyValue(i):a[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:i}){return Rte(t,i)}build(t,i,a){nj(t,i,a.transformTemplate)}scrapeMotionValuesFromProps(t,i,a){return oj(t,i,a)}}class Rke extends Ute{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=so}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(Jy.has(i)){const a=yj(i);return a&&a.default||0}return i=Ree.has(i)?i:XF(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,a){return Aee(t,i,a)}build(t,i,a){rj(t,i,this.isSVGTag,a.transformTemplate)}renderInstance(t,i,a,l){Cee(t,i,a,l)}mount(t){this.isSVGTag=sj(t.tagName),super.mount(t)}}const Cke=(n,t)=>QF(n)?new Rke(t):new Tke(t,{allowProjection:n!==N.Fragment}),Ike=QAe({...X1e,...gke,...ske,..._ke},Cke),$f=pAe(Ike),Ake=(n,t)=>n.find(i=>i.id===t);function OY(n,t){const i=Vte(n,t),a=i?n[i].findIndex(l=>l.id===t):-1;return{position:i,index:a}}function Vte(n,t){for(const[i,a]of Object.entries(n))if(Ake(a,t))return i}function Pke(n){const t=n.includes("right"),i=n.includes("left");let a="center";return t&&(a="flex-end"),i&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function Oke(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:a,bottom:l,right:d,left:f}}var kke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,Nke=eee(function(n){return kke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),Dke=Nke,xke=function(t){return t!=="theme"},kY=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?Dke:xke},NY=function(t,i,a){var l;if(i){var d=i.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(f){return t.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},Lke=function(t){var i=t.cache,a=t.serialized,l=t.isStringTag;return xF(i,a,l),see(function(){return LF(i,a,l)}),null},Mke=function n(t,i){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,f;i!==void 0&&(d=i.label,f=i.target);var y=NY(t,i,a),v=y||kY(l),b=!v("as");return function(){var R=arguments,I=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),R[0]==null||R[0].raw===void 0)I.push.apply(I,R);else{var k=R[0];I.push(k[0]);for(var M=R.length,L=1;L<M;L++)I.push(R[L],k[L])}var j=UF(function(z,Y,K){var ne=b&&z.as||l,ce="",oe=[],ge=z;if(z.theme==null){ge={};for(var X in z)ge[X]=z[X];ge.theme=N.useContext(c0)}typeof z.className=="string"?ce=nee(Y.registered,oe,z.className):z.className!=null&&(ce=z.className+" ");var J=xk(I.concat(oe),Y.registered,ge);ce+=Y.key+"-"+J.name,f!==void 0&&(ce+=" "+f);var te=b&&y===void 0?kY(ne):v,ie={};for(var he in z)b&&he==="as"||te(he)&&(ie[he]=z[he]);return ie.className=ce,K&&(ie.ref=K),N.createElement(N.Fragment,null,N.createElement(Lke,{cache:Y,serialized:J,isStringTag:typeof ne=="string"}),N.createElement(ne,ie))});return j.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",j.defaultProps=t.defaultProps,j.__emotion_real=j,j.__emotion_base=l,j.__emotion_styles=I,j.__emotion_forwardProp=y,Object.defineProperty(j,"toString",{value:function(){return"."+f}}),j.withComponent=function(z,Y){var K=n(z,jy({},i,Y,{shouldForwardProp:NY(j,Y,!0)}));return K.apply(void 0,I)},j}},Uke=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],gV=Mke.bind(null);Uke.forEach(function(n){gV[n]=gV(n)});const Vke=new Set([...iSe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),Fke=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function jke(n){return(Fke.has(n)||!Vke.has(n))&&n[0]!=="_"}const Bke=NEe(gV),zke=({baseStyle:n})=>t=>{const{theme:i,css:a,__css:l,sx:d,...f}=t,[y]=FEe(f,oSe),v=fl(n,t),b=yEe({},l,v,Ck(y),d),R=DZ(b)(t.theme);return a?[R,a]:R};function tU(n,t){const{baseStyle:i,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=jke);const l=zke({baseStyle:i}),d=Bke(n,a)(l);return N.forwardRef(function(v,b){const{children:R,...I}=v,{colorMode:k,forced:M}=Mk(),L=M?k:void 0;return N.createElement(d,{ref:b,"data-theme":L,...I},R)})}function Wke(){const n=new Map;return new Proxy(tU,{apply(t,i,a){return tU(...a)},get(t,i){return n.has(i)||n.set(i,tU(i)),n.get(i)}})}const Ft=Wke(),Gke={initial:n=>{const{position:t}=n,i=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[i]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Fte=N.memo(n=>{const{id:t,message:i,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:y=5e3,containerStyle:v,motionVariants:b=Gke,toastSpacing:R="0.5rem"}=n,[I,k]=N.useState(y),M=iAe();Lf(()=>{M||a==null||a()},[M]),Lf(()=>{k(y)},[y]);const L=()=>k(null),j=()=>k(y),z=()=>{M&&l()};N.useEffect(()=>{M&&d&&l()},[M,d,l]),cve(z,I);const Y=N.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:R,...v}),[v,R]),K=N.useMemo(()=>Pke(f),[f]);return w.jsx($f.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:L,onHoverEnd:j,custom:{position:f},style:K,children:w.jsx(Ft.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:Y,children:fl(i,{id:t,onClose:z})})})});Fte.displayName="ToastComponent";function Wt(n){return N.forwardRef(n)}var nU,DY;function Hke(){if(DY)return nU;DY=1;var n=typeof Element<"u",t=typeof Map=="function",i=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var y,v,b;if(Array.isArray(d)){if(y=d.length,y!=f.length)return!1;for(v=y;v--!==0;)if(!l(d[v],f[v]))return!1;return!0}var R;if(t&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(R=d.entries();!(v=R.next()).done;)if(!f.has(v.value[0]))return!1;for(R=d.entries();!(v=R.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(i&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(R=d.entries();!(v=R.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(y=d.length,y!=f.length)return!1;for(v=y;v--!==0;)if(d[v]!==f[v])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(b=Object.keys(d),y=b.length,y!==Object.keys(f).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[v]))return!1;if(n&&d instanceof Element)return!1;for(v=y;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],f[b[v]]))return!1;return!0}return d!==d&&f!==f}return nU=function(f,y){try{return l(f,y)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},nU}var $ke=Hke();const Kke=Mg($ke);function M0(){const n=N.useContext(c0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function jte(){const n=Mk(),t=M0();return{...n,theme:t}}function qke(n,t,i){if(t==null)return t;const a=l=>{var d,f;return(f=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(t)??a(i)??i}function Yke(n,t,i){const a=Array.isArray(t)?t:[t],l=Array.isArray(i)?i:[i];return d=>{const f=l.filter(Boolean),y=a.map((v,b)=>{const R=`${n}.${v}`;return qke(d,R,f[b]??v)});return Array.isArray(t)?y:y[0]}}function Bte(n,t={}){const{styleConfig:i,...a}=t,{theme:l,colorMode:d}=jte(),f=n?mZ(l,`components.${n}`):void 0,y=i||f,v=_p({theme:l,colorMode:d},(y==null?void 0:y.defaultProps)??{},Ck(k0(a,["children"])),(R,I)=>R?void 0:I),b=N.useRef({});if(y){const I=_Se(y)(v);Kke(b.current,I)||(b.current=I)}return b.current}function nd(n,t={}){return Bte(n,t)}function Va(n,t={}){return Bte(n,t)}const xY={path:w.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[w.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),w.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),w.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},yn=Wt((n,t)=>{const{as:i,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:y,__css:v,...b}=n,R=Sn("chakra-icon",y),I=nd("Icon",n),k={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...I},M={ref:t,focusable:d,className:R,__css:k},L=a??xY.viewBox;if(i&&typeof i!="string")return w.jsx(Ft.svg,{as:i,...M,...b});const j=f??xY.path;return w.jsx(Ft.svg,{verticalAlign:"middle",viewBox:L,...M,...b,children:j})});yn.displayName="Icon";function Xke(n){return w.jsx(yn,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function Jke(n){return w.jsx(yn,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function LY(n){return w.jsx(yn,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const Qke=pC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),uh=Wt((n,t)=>{const i=nd("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:y,...v}=Gi(n),b=Sn("chakra-spinner",y),R={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${Qke} ${d} linear infinite`,...i};return w.jsx(Ft.div,{ref:t,__css:R,className:b,...v,children:a&&w.jsx(Ft.span,{srOnly:!0,children:a})})});uh.displayName="Spinner";const[Zke,wj]=Ri({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[eNe,Tj]=Ri({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),zte={info:{icon:Jke,colorScheme:"blue"},warning:{icon:LY,colorScheme:"orange"},success:{icon:Xke,colorScheme:"green"},error:{icon:LY,colorScheme:"red"},loading:{icon:uh,colorScheme:"blue"}};function tNe(n){return zte[n].colorScheme}function nNe(n){return zte[n].icon}const Eg=Wt(function(t,i){const{status:a="info",addRole:l=!0,...d}=Gi(t),f=t.colorScheme??tNe(a),y=Va("Alert",{...t,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return w.jsx(Zke,{value:{status:a},children:w.jsx(eNe,{value:y,children:w.jsx(Ft.div,{"data-status":a,role:l?"alert":void 0,ref:i,...d,className:Sn("chakra-alert",t.className),__css:v})})})});Eg.displayName="Alert";function vg(n){const{status:t}=wj(),i=nNe(t),a=Tj(),l=t==="loading"?a.spinner:a.icon;return w.jsx(Ft.span,{display:"inherit","data-status":t,...n,className:Sn("chakra-alert__icon",n.className),__css:l,children:n.children||w.jsx(i,{h:"100%",w:"100%"})})}vg.displayName="AlertIcon";const vR=Wt(function(t,i){const a=Tj(),{status:l}=wj();return w.jsx(Ft.div,{ref:i,"data-status":l,...t,className:Sn("chakra-alert__title",t.className),__css:a.title})});vR.displayName="AlertTitle";const SR=Wt(function(t,i){const{status:a}=wj(),l=Tj(),d={display:"inline",...l.description};return w.jsx(Ft.div,{ref:i,"data-status":a,...t,className:Sn("chakra-alert__desc",t.className),__css:d})});SR.displayName="AlertDescription";function rNe(n){return w.jsx(yn,{focusable:"false","aria-hidden":!0,...n,children:w.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const Rj=Wt(function(t,i){const a=nd("CloseButton",t),{children:l,isDisabled:d,__css:f,...y}=Gi(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return w.jsx(Ft.button,{type:"button","aria-label":"Close",ref:i,disabled:d,__css:{...v,...a,...f},...y,children:l||w.jsx(rNe,{width:"1em",height:"1em"})})});Rj.displayName="CloseButton";const iNe=n=>{const{status:t,variant:i="solid",id:a,title:l,isClosable:d,onClose:f,description:y,colorScheme:v,icon:b}=n,R=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return w.jsxs(Eg,{addRole:!1,status:t,variant:i,id:R==null?void 0:R.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[w.jsx(vg,{children:b}),w.jsxs(Ft.div,{flex:"1",maxWidth:"100%",children:[l&&w.jsx(vR,{id:R==null?void 0:R.title,children:l}),y&&w.jsx(SR,{id:R==null?void 0:R.description,display:"block",children:y})]}),d&&w.jsx(Rj,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function Wte(n={}){const{render:t,toastComponent:i=iNe}=n;return l=>typeof t=="function"?t({...l,...n}):w.jsx(i,{...l,...n})}const sNe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},fp=oNe(sNe);function oNe(n){let t=n;const i=new Set,a=l=>{t=l(t),i.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(i.add(l),()=>{a(()=>n),i.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(y=>y.id!=l)}))},notify:(l,d)=>{const f=aNe(l,d),{position:y,id:v}=f;return a(b=>{const I=y.includes("top")?[f,...b[y]??[]]:[...b[y]??[],f];return{...b,[y]:I}}),v},update:(l,d)=>{l&&a(f=>{const y={...f},{position:v,index:b}=OY(y,l);return v&&b!==-1&&(y[v][b]={...y[v][b],...d,message:Wte(d)}),y})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(R=>({...R,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const f=Vte(d,l);return f?{...d,[f]:d[f].map(y=>y.id==l?{...y,requestClose:!0}:y)}:d})},isActive:l=>!!OY(fp.getState(),l).position}}let MY=0;function aNe(n,t={}){MY+=1;const i=t.id??MY,a=t.position??"bottom";return{id:i,message:n,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>fp.removeToast(String(i),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var Gte=oZ();const[Hte,cNe]=Ri({strict:!1,name:"PortalContext"}),Cj="chakra-portal",lNe=".chakra-portal",uNe=n=>w.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),dNe=n=>{const{appendToParentPortal:t,children:i}=n,[a,l]=N.useState(null),d=N.useRef(null),[,f]=N.useState({});N.useEffect(()=>f({}),[]);const y=cNe(),v=JIe();Sp(()=>{if(!a)return;const R=a.ownerDocument,I=t?y??R.body:R.body;if(!I)return;d.current=R.createElement("div"),d.current.className=Cj,I.appendChild(d.current),f({});const k=d.current;return()=>{I.contains(k)&&I.removeChild(k)}},[a]);const b=v!=null&&v.zIndex?w.jsx(uNe,{zIndex:v==null?void 0:v.zIndex,children:i}):i;return d.current?Gte.createPortal(w.jsx(Hte,{value:d.current,children:b}),d.current):w.jsx("span",{ref:R=>{R&&l(R)}})},hNe=n=>{const{children:t,containerRef:i,appendToParentPortal:a}=n,l=i.current,d=l??(typeof window<"u"?document.body:void 0),f=N.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=Cj),v},[l]),[,y]=N.useState({});return Sp(()=>y({}),[]),Sp(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?Gte.createPortal(w.jsx(Hte,{value:a?f:null,children:t}),f):null};function El(n){const t={appendToParentPortal:!0,...n},{containerRef:i,...a}=t;return i?w.jsx(hNe,{containerRef:i,...a}):w.jsx(dNe,{...a})}El.className=Cj;El.selector=lNe;El.displayName="Portal";const[pNe,fNe]=Ri({name:"ToastOptionsContext",strict:!1}),mNe=n=>{const t=N.useSyncExternalStore(fp.subscribe,fp.getState,fp.getState),{motionVariants:i,component:a=Fte,portalProps:l,animatePresenceProps:d}=n,y=Object.keys(t).map(v=>{const b=t[v];return w.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:Oke(v),children:w.jsx(D0,{...d,initial:!1,children:b.map(R=>w.jsx(a,{motionVariants:i,...R},R.id))})},v)});return w.jsx(El,{...l,children:y})},gNe=n=>function({children:i,theme:a=n,toastOptions:l,...d}){return w.jsxs(ZIe,{theme:a,...d,children:[w.jsx(pNe,{value:l==null?void 0:l.defaultOptions,children:i}),w.jsx(mNe,{...l})]})},_Ne=gNe(WCe);function UY(n){return n.sort((t,i)=>{const a=t.compareDocumentPosition(i);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const yNe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function VY(n,t,i){let a=n+1;return i&&a>=t&&(a=0),a}function FY(n,t,i){let a=n-1;return i&&a<0&&(a=t),a}const rU=typeof window<"u"?N.useLayoutEffect:N.useEffect,jY=n=>n;var ENe=Object.defineProperty,vNe=(n,t,i)=>t in n?ENe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,js=(n,t,i)=>(vNe(n,typeof t!="symbol"?t+"":t,i),i);class SNe{constructor(){js(this,"descendants",new Map),js(this,"register",t=>{if(t!=null)return yNe(t)?this.registerNode(t):i=>{this.registerNode(i,t)}}),js(this,"unregister",t=>{this.descendants.delete(t);const i=UY(Array.from(this.descendants.keys()));this.assignIndex(i)}),js(this,"destroy",()=>{this.descendants.clear()}),js(this,"assignIndex",t=>{this.descendants.forEach(i=>{const a=t.indexOf(i.node);i.index=a,i.node.dataset.index=i.index.toString()})}),js(this,"count",()=>this.descendants.size),js(this,"enabledCount",()=>this.enabledValues().length),js(this,"values",()=>Array.from(this.descendants.values()).sort((i,a)=>i.index-a.index)),js(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),js(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),js(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),js(this,"first",()=>this.item(0)),js(this,"firstEnabled",()=>this.enabledItem(0)),js(this,"last",()=>this.item(this.descendants.size-1)),js(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),js(this,"indexOf",t=>{var i;return t?((i=this.descendants.get(t))==null?void 0:i.index)??-1:-1}),js(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(t))),js(this,"next",(t,i=!0)=>{const a=VY(t,this.count(),i);return this.item(a)}),js(this,"nextEnabled",(t,i=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=VY(l,this.enabledCount(),i);return this.enabledItem(d)}),js(this,"prev",(t,i=!0)=>{const a=FY(t,this.count()-1,i);return this.item(a)}),js(this,"prevEnabled",(t,i=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=FY(l,this.enabledCount()-1,i);return this.enabledItem(d)}),js(this,"registerNode",(t,i)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=UY(a);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const d={node:t,index:-1,...i};this.descendants.set(t,d),this.assignIndex(l)})}}function $te(){const[n,t]=Ri({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,t,()=>{const l=N.useRef(new SNe);return rU(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[f,y]=N.useState(-1),v=N.useRef(null);rU(()=>()=>{v.current&&d.unregister(v.current)},[]),rU(()=>{if(!v.current)return;const R=Number(v.current.dataset.index);f!=R&&!Number.isNaN(R)&&y(R)});const b=jY(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(v.current),register:zi(b,v)}}]}const BY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Ny={enter:{duration:.2,ease:BY.easeOut},exit:{duration:.1,ease:BY.easeIn}},Dy={enter:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[bNe,wNe]=Ri({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function TNe(n){const t=n.trim().split(" "),i=t[0]??"",a=t.length>1?t[t.length-1]:"";return i&&a?`${i.charAt(0)}${a.charAt(0)}`:i.charAt(0)}function Kte(n){const{name:t,getInitials:i,...a}=n,l=wNe();return w.jsx(Ft.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?i==null?void 0:i(t):null})}Kte.displayName="AvatarName";const qte=n=>w.jsxs(Ft.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[w.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),w.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Yte(n){const{loading:t,src:i,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:y,ignoreFallback:v}=n,[b,R]=N.useState("pending");N.useEffect(()=>{R(i?"loading":"pending")},[i]);const I=N.useRef(null),k=N.useCallback(()=>{if(!i)return;M();const L=new Image;L.src=i,f&&(L.crossOrigin=f),a&&(L.srcset=a),y&&(L.sizes=y),t&&(L.loading=t),L.onload=j=>{M(),R("loaded"),l==null||l(j)},L.onerror=j=>{M(),R("failed"),d==null||d(j)},I.current=L},[i,f,a,y,l,d,t]),M=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return Sp(()=>{if(!v)return b==="loading"&&k(),()=>{M()}},[b,k,v]),v?"loaded":b}const RNe=(n,t)=>n!=="loaded"&&t==="beforeLoadOrError"||n==="failed"&&t==="onError";function Xte(n){const{src:t,srcSet:i,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:y,loading:v,iconLabel:b,icon:R=w.jsx(qte,{}),ignoreFallback:I,referrerPolicy:k,crossOrigin:M}=n,j=Yte({src:t,onError:a,crossOrigin:M,ignoreFallback:I})==="loaded";return!t||!j?f?w.jsx(Kte,{className:"chakra-avatar__initials",getInitials:d,name:f}):N.cloneElement(R,{role:"img","aria-label":b}):w.jsx(Ft.img,{src:t,srcSet:i,alt:f??b,onLoad:l,referrerPolicy:k,crossOrigin:M??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}Xte.displayName="AvatarImage";const CNe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},ih=Wt((n,t)=>{const i=Va("Avatar",n),[a,l]=N.useState(!1),{src:d,srcSet:f,name:y,showBorder:v,borderRadius:b="full",onError:R,onLoad:I,getInitials:k=TNe,icon:M=w.jsx(qte,{}),iconLabel:L=" avatar",loading:j,children:z,borderColor:Y,ignoreFallback:K,crossOrigin:ne,referrerPolicy:ce,...oe}=Gi(n),ge={borderRadius:b,borderWidth:v?"2px":void 0,...CNe,...i.container};return Y&&(ge.borderColor=Y),w.jsx(Ft.span,{ref:t,...oe,className:Sn("chakra-avatar",n.className),"data-loaded":lr(a),__css:ge,children:w.jsxs(bNe,{value:i,children:[w.jsx(Xte,{src:d,srcSet:f,loading:j,onLoad:Ln(I,()=>{l(!0)}),onError:R,getInitials:k,name:y,borderRadius:b,icon:M,iconLabel:L,ignoreFallback:K,crossOrigin:ne,referrerPolicy:ce}),z]})})});ih.displayName="Avatar";const Qd=Wt(function(t,i){const a=nd("Badge",t),{className:l,...d}=Gi(t);return w.jsx(Ft.span,{ref:i,className:Sn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});Qd.displayName="Badge";const ht=Ft("div");ht.displayName="Box";const[NGe,INe]=Ri({strict:!1,name:"ButtonGroupContext"});function QT(n){const{children:t,className:i,...a}=n,l=N.isValidElement(t)?N.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=Sn("chakra-button__icon",i);return w.jsx(Ft.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}QT.displayName="ButtonIcon";function _V(n){const{label:t,placement:i,spacing:a="0.5rem",children:l=w.jsx(uh,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,...y}=n,v=Sn("chakra-button__spinner",d),b=i==="start"?"marginEnd":"marginStart",R=N.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,t,b,a]);return w.jsx(Ft.div,{className:v,...y,__css:R,children:l})}_V.displayName="ButtonSpinner";function ANe(n){const[t,i]=N.useState(!n);return{ref:N.useCallback(d=>{d&&i(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const $n=Wt((n,t)=>{const i=INe(),a=nd("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:d,isActive:f,children:y,leftIcon:v,rightIcon:b,loadingText:R,iconSpacing:I="0.5rem",type:k,spinner:M,spinnerPlacement:L="start",className:j,as:z,shouldWrapChildren:Y,...K}=Gi(n),ne=N.useMemo(()=>{const X={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!i&&{_focus:X}}},[a,i]),{ref:ce,type:oe}=ANe(z),ge={rightIcon:b,leftIcon:v,iconSpacing:I,children:y,shouldWrapChildren:Y};return w.jsxs(Ft.button,{disabled:l||d,ref:ave(t,ce),as:z,type:k??oe,"data-active":lr(f),"data-loading":lr(d),__css:ne,className:Sn("chakra-button",j),...K,children:[d&&L==="start"&&w.jsx(_V,{className:"chakra-button__spinner--start",label:R,placement:"start",spacing:I,children:M}),d?R||w.jsx(Ft.span,{opacity:0,children:w.jsx(zY,{...ge})}):w.jsx(zY,{...ge}),d&&L==="end"&&w.jsx(_V,{className:"chakra-button__spinner--end",label:R,placement:"end",spacing:I,children:M})]})});$n.displayName="Button";function zY(n){const{leftIcon:t,rightIcon:i,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?w.jsxs("span",{style:{display:"contents"},children:[t&&w.jsx(QT,{marginEnd:l,children:t}),a,i&&w.jsx(QT,{marginStart:l,children:i})]}):w.jsxs(w.Fragment,{children:[t&&w.jsx(QT,{marginEnd:l,children:t}),a,i&&w.jsx(QT,{marginStart:l,children:i})]})}const kc=Wt((n,t)=>{const{icon:i,children:a,isRound:l,"aria-label":d,...f}=n,y=i||a,v=N.isValidElement(y)?N.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return w.jsx($n,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...f,children:v})});kc.displayName="IconButton";const Jte=Ft("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Jte.displayName="Center";const PNe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Wt(function(t,i){const{axis:a="both",...l}=t;return w.jsx(Ft.div,{ref:i,__css:PNe[a],...l,position:"absolute"})});var ONe=()=>typeof document<"u",WY=!1,EC=null,By=!1,yV=!1,EV=new Set;function Ij(n,t){EV.forEach(i=>i(n,t))}var kNe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function NNe(n){return!(n.metaKey||!kNe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function GY(n){By=!0,NNe(n)&&(EC="keyboard",Ij("keyboard",n))}function fS(n){if(EC="pointer",n.type==="mousedown"||n.type==="pointerdown"){By=!0;const t=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=t.matches(":focus-visible")}catch{}if(i)return;Ij("pointer",n)}}function DNe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function xNe(n){DNe(n)&&(By=!0,EC="virtual")}function LNe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!By&&!yV&&(EC="virtual",Ij("virtual",n)),By=!1,yV=!1)}function MNe(){By=!1,yV=!0}function HY(){return EC!=="pointer"}function UNe(){if(!ONe()||WY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){By=!0,n.apply(this,i)},document.addEventListener("keydown",GY,!0),document.addEventListener("keyup",GY,!0),document.addEventListener("click",xNe,!0),window.addEventListener("focus",LNe,!0),window.addEventListener("blur",MNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",fS,!0),document.addEventListener("pointermove",fS,!0),document.addEventListener("pointerup",fS,!0)):(document.addEventListener("mousedown",fS,!0),document.addEventListener("mousemove",fS,!0),document.addEventListener("mouseup",fS,!0)),WY=!0}function VNe(n){UNe(),n(HY());const t=()=>n(HY());return EV.add(t),()=>{EV.delete(t)}}const[FNe,Qte]=Ri({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[jNe,U0]=Ri({strict:!1,name:"FormControlContext"});function BNe(n){const{id:t,isRequired:i,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=n,y=N.useId(),v=t||`field-${y}`,b=`${v}-label`,R=`${v}-feedback`,I=`${v}-helptext`,[k,M]=N.useState(!1),[L,j]=N.useState(!1),[z,Y]=N.useState(!1),K=N.useCallback((X={},J=null)=>({id:I,...X,ref:zi(J,te=>{te&&j(!0)})}),[I]),ne=N.useCallback((X={},J=null)=>({...X,ref:J,"data-focus":lr(z),"data-disabled":lr(l),"data-invalid":lr(a),"data-readonly":lr(d),id:X.id!==void 0?X.id:b,htmlFor:X.htmlFor!==void 0?X.htmlFor:v}),[v,l,z,a,d,b]),ce=N.useCallback((X={},J=null)=>({id:R,...X,ref:zi(J,te=>{te&&M(!0)}),"aria-live":"polite"}),[R]),oe=N.useCallback((X={},J=null)=>({...X,...f,ref:J,role:"group","data-focus":lr(z),"data-disabled":lr(l),"data-invalid":lr(a),"data-readonly":lr(d)}),[f,l,z,a,d]),ge=N.useCallback((X={},J=null)=>({...X,ref:J,role:"presentation","aria-hidden":!0,children:X.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!z,onFocus:()=>Y(!0),onBlur:()=>Y(!1),hasFeedbackText:k,setHasFeedbackText:M,hasHelpText:L,setHasHelpText:j,id:v,labelId:b,feedbackId:R,helpTextId:I,htmlProps:f,getHelpTextProps:K,getErrorMessageProps:ce,getRootProps:oe,getLabelProps:ne,getRequiredIndicatorProps:ge}}const Kr=Wt(function(t,i){const a=Va("Form",t),l=Gi(t),{getRootProps:d,htmlProps:f,...y}=BNe(l),v=Sn("chakra-form-control",t.className);return w.jsx(jNe,{value:y,children:w.jsx(FNe,{value:a,children:w.jsx(Ft.div,{...d({},i),className:v,__css:a.container})})})});Kr.displayName="FormControl";const HS=Wt(function(t,i){const a=U0(),l=Qte(),d=Sn("chakra-form__helper-text",t.className);return w.jsx(Ft.div,{...a==null?void 0:a.getHelpTextProps(t,i),__css:l.helperText,className:d})});HS.displayName="FormHelperText";function Aj(n){const{isDisabled:t,isInvalid:i,isReadOnly:a,isRequired:l,...d}=Pj(n);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":Af(i),"aria-required":Af(l),"aria-readonly":Af(a)}}function Pj(n){const t=U0(),{id:i,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:y,isReadOnly:v,isDisabled:b,onFocus:R,onBlur:I,...k}=n,M=n["aria-describedby"]?[n["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&M.push(t.feedbackId),t!=null&&t.hasHelpText&&M.push(t.helpTextId),{...k,"aria-describedby":M.join(" ")||void 0,id:i??(t==null?void 0:t.id),isDisabled:a??b??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??f??(t==null?void 0:t.isRequired),isInvalid:y??(t==null?void 0:t.isInvalid),onFocus:Ln(t==null?void 0:t.onFocus,R),onBlur:Ln(t==null?void 0:t.onBlur,I)}}const zNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function WNe(n={}){const t=Pj(n),{isDisabled:i,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:y,onFocus:v,"aria-describedby":b}=t,{defaultChecked:R,isChecked:I,isFocusable:k,onChange:M,isIndeterminate:L,name:j,value:z,tabIndex:Y=void 0,"aria-label":K,"aria-labelledby":ne,"aria-invalid":ce,...oe}=n,ge=k0(oe,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),X=lo(M),J=lo(y),te=lo(v),[ie,he]=N.useState(!1),[fe,de]=N.useState(!1),[ve,Te]=N.useState(!1),[Fe,be]=N.useState(!1);N.useEffect(()=>VNe(he),[]);const Ce=N.useRef(null),[Ae,De]=N.useState(!0),[Ee,Ne]=N.useState(!!R),je=I!==void 0,Ke=je?I:Ee,ot=N.useCallback(Vt=>{if(a||i){Vt.preventDefault();return}je||Ne(Ke?Vt.currentTarget.checked:L?!0:Vt.currentTarget.checked),X==null||X(Vt)},[a,i,Ke,je,L,X]);Sp(()=>{Ce.current&&(Ce.current.indeterminate=!!L)},[L]),Lf(()=>{i&&de(!1)},[i,de]),Sp(()=>{const Vt=Ce.current;if(!(Vt!=null&&Vt.form))return;const rn=()=>{Ne(!!R)};return Vt.form.addEventListener("reset",rn),()=>{var Ht;return(Ht=Vt.form)==null?void 0:Ht.removeEventListener("reset",rn)}},[]);const _t=i&&!k,lt=N.useCallback(Vt=>{Vt.key===" "&&be(!0)},[be]),vt=N.useCallback(Vt=>{Vt.key===" "&&be(!1)},[be]);Sp(()=>{if(!Ce.current)return;Ce.current.checked!==Ke&&Ne(Ce.current.checked)},[Ce.current]);const rt=N.useCallback((Vt={},rn=null)=>{const Ht=we=>{fe&&we.preventDefault(),be(!0)};return{...Vt,ref:rn,"data-active":lr(Fe),"data-hover":lr(ve),"data-checked":lr(Ke),"data-focus":lr(fe),"data-focus-visible":lr(fe&&ie),"data-indeterminate":lr(L),"data-disabled":lr(i),"data-invalid":lr(d),"data-readonly":lr(a),"aria-hidden":!0,onMouseDown:Ln(Vt.onMouseDown,Ht),onMouseUp:Ln(Vt.onMouseUp,()=>be(!1)),onMouseEnter:Ln(Vt.onMouseEnter,()=>Te(!0)),onMouseLeave:Ln(Vt.onMouseLeave,()=>Te(!1))}},[Fe,Ke,i,fe,ie,ve,L,d,a]),bt=N.useCallback((Vt={},rn=null)=>({...Vt,ref:rn,"data-active":lr(Fe),"data-hover":lr(ve),"data-checked":lr(Ke),"data-focus":lr(fe),"data-focus-visible":lr(fe&&ie),"data-indeterminate":lr(L),"data-disabled":lr(i),"data-invalid":lr(d),"data-readonly":lr(a)}),[Fe,Ke,i,fe,ie,ve,L,d,a]),$t=N.useCallback((Vt={},rn=null)=>({...ge,htmlFor:Ae?f:void 0,...Vt,ref:zi(rn,Ht=>{Ht&&De(Ht.tagName==="LABEL")}),onClick:Ln(Vt.onClick,()=>{var Ht;Ae||((Ht=Ce.current)==null||Ht.click(),requestAnimationFrame(()=>{var we;(we=Ce.current)==null||we.focus({preventScroll:!0})}))}),"data-disabled":lr(i),"data-checked":lr(Ke),"data-invalid":lr(d)}),[ge,i,Ke,d,Ae,f]),ut=N.useCallback((Vt={},rn=null)=>({...Vt,ref:zi(Ce,rn),type:"checkbox",name:j,value:z,id:f,tabIndex:Y,onChange:Ln(Vt.onChange,ot),onBlur:Ln(Vt.onBlur,J,()=>de(!1)),onFocus:Ln(Vt.onFocus,te,()=>de(!0)),onKeyDown:Ln(Vt.onKeyDown,lt),onKeyUp:Ln(Vt.onKeyUp,vt),required:l,checked:Ke,disabled:_t,readOnly:a,"aria-label":K,"aria-labelledby":ne,"aria-invalid":ce?!!ce:d,"aria-describedby":b,"aria-disabled":i,"aria-checked":L?"mixed":Ke,style:zNe}),[j,z,f,Y,ot,J,te,lt,vt,l,Ke,_t,a,K,ne,ce,d,b,i,L]),mt=N.useCallback((Vt={},rn=null)=>({...Vt,ref:rn,onMouseDown:Ln(Vt.onMouseDown,GNe),"data-disabled":lr(i),"data-checked":lr(Ke),"data-invalid":lr(d)}),[Ke,i,d]);return{state:{isInvalid:d,isFocused:fe,isChecked:Ke,isActive:Fe,isHovered:ve,isIndeterminate:L,isDisabled:i,isReadOnly:a,isRequired:l},getRootProps:$t,getCheckboxProps:rt,getIndicatorProps:bt,getInputProps:ut,getLabelProps:mt,htmlProps:ge}}function GNe(n){n.preventDefault(),n.stopPropagation()}const h0=Wt(function(t,i){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:y,borderStyle:v,borderColor:b,...R}=nd("Divider",t),{className:I,orientation:k="horizontal",__css:M,...L}=Gi(t),j={vertical:{borderLeftWidth:a||f||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||y||"1px",width:"100%"}};return w.jsx(Ft.hr,{ref:i,"aria-orientation":k,...L,__css:{...R,border:"0",borderColor:b,borderStyle:v,...j[k],...M},className:Sn("chakra-divider",I)})});h0.displayName="Divider";const Bi=Wt(function(t,i){const{direction:a,align:l,justify:d,wrap:f,basis:y,grow:v,shrink:b,...R}=t,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:y,flexGrow:v,flexShrink:b};return w.jsx(Ft.div,{ref:i,__css:I,...R})});Bi.displayName="Flex";function HNe(n,t){if(n==null)return{};var i={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(t.indexOf(a)!==-1)continue;i[a]=n[a]}return i}var iU={exports:{}},sU,$Y;function $Ne(){if($Y)return sU;$Y=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return sU=n,sU}var oU,KY;function KNe(){if(KY)return oU;KY=1;var n=$Ne();function t(){}function i(){}return i.resetWarningCache=t,oU=function(){function a(f,y,v,b,R,I){if(I!==n){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:t};return d.PropTypes=d,d},oU}var qY;function qNe(){return qY||(qY=1,iU.exports=KNe()()),iU.exports}var YNe=qNe();const Pn=Mg(YNe);var vV="data-focus-lock",Zte="data-focus-lock-disabled",XNe="data-no-focus-lock",JNe="data-autofocus-inside",QNe="data-no-autofocus";function aU(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function ZNe(n,t){var i=N.useState(function(){return{value:n,callback:t,facade:{get current(){return i.value},set current(a){var l=i.value;l!==a&&(i.value=a,i.callback(a,l))}}}})[0];return i.callback=t,i.facade}var eDe=typeof window<"u"?N.useLayoutEffect:N.useEffect,YY=new WeakMap;function ene(n,t){var i=ZNe(null,function(a){return n.forEach(function(l){return aU(l,a)})});return eDe(function(){var a=YY.get(i);if(a){var l=new Set(a),d=new Set(n),f=i.current;l.forEach(function(y){d.has(y)||aU(y,null)}),d.forEach(function(y){l.has(y)||aU(y,f)})}YY.set(i,n)},[n]),i}var cU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},mp=function(){return mp=Object.assign||function(t){for(var i,a=1,l=arguments.length;a<l;a++){i=arguments[a];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(t[d]=i[d])}return t},mp.apply(this,arguments)};function vC(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i}function tDe(n,t,i){if(i||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return n.concat(d||Array.prototype.slice.call(t))}function tne(n){return n}function nne(n,t){t===void 0&&(t=tne);var i=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(d){var f=t(d,a);return i.push(f),function(){i=i.filter(function(y){return y!==f})}},assignSyncMedium:function(d){for(a=!0;i.length;){var f=i;i=[],f.forEach(d)}i={push:function(y){return d(y)},filter:function(){return i}}},assignMedium:function(d){a=!0;var f=[];if(i.length){var y=i;i=[],y.forEach(d),f=i}var v=function(){var R=f;f=[],R.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),i={push:function(R){f.push(R),b()},filter:function(R){return f=f.filter(R),i}}}};return l}function Oj(n,t){return t===void 0&&(t=tne),nne(n,t)}function rne(n){n===void 0&&(n={});var t=nne(null);return t.options=mp({async:!0,ssr:!1},n),t}var ine=function(n){var t=n.sideCar,i=vC(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return N.createElement(a,mp({},i))};ine.isSideCarExport=!0;function nDe(n,t){return n.useMedium(t),ine}var sne=Oj({},function(n){var t=n.target,i=n.currentTarget;return{target:t,currentTarget:i}}),one=Oj(),rDe=Oj(),iDe=rne({async:!0,ssr:typeof document<"u"}),sDe=N.createContext(void 0),oDe=[],kj=N.forwardRef(function(t,i){var a,l=N.useState(),d=l[0],f=l[1],y=N.useRef(),v=N.useRef(!1),b=N.useRef(null),R=N.useState({}),I=R[1],k=t.children,M=t.disabled,L=M===void 0?!1:M,j=t.noFocusGuards,z=j===void 0?!1:j,Y=t.persistentFocus,K=Y===void 0?!1:Y,ne=t.crossFrame,ce=ne===void 0?!0:ne,oe=t.autoFocus,ge=oe===void 0?!0:oe;t.allowTextSelection;var X=t.group,J=t.className,te=t.whiteList,ie=t.hasPositiveIndices,he=t.shards,fe=he===void 0?oDe:he,de=t.as,ve=de===void 0?"div":de,Te=t.lockProps,Fe=Te===void 0?{}:Te,be=t.sideCar,Ce=t.returnFocus,Ae=Ce===void 0?!1:Ce,De=t.focusOptions,Ee=t.onActivation,Ne=t.onDeactivation,je=N.useState({}),Ke=je[0],ot=N.useCallback(function(rn){var Ht=rn.captureFocusRestore;if(!b.current){var we,xe=(we=document)==null?void 0:we.activeElement;b.current=xe,xe!==document.body&&(b.current=Ht(xe))}y.current&&Ee&&Ee(y.current),v.current=!0,I()},[Ee]),_t=N.useCallback(function(){v.current=!1,Ne&&Ne(y.current),I()},[Ne]),lt=N.useCallback(function(rn){var Ht=b.current;if(Ht){var we=(typeof Ht=="function"?Ht():Ht)||document.body,xe=typeof Ae=="function"?Ae(we):Ae;if(xe){var $e=typeof xe=="object"?xe:void 0;b.current=null,rn?Promise.resolve().then(function(){return we.focus($e)}):we.focus($e)}}},[Ae]),vt=N.useCallback(function(rn){v.current&&sne.useMedium(rn)},[]),rt=one.useMedium,bt=N.useCallback(function(rn){y.current!==rn&&(y.current=rn,f(rn))},[]),$t=jy((a={},a[Zte]=L&&"disabled",a[vV]=X,a),Fe),ut=z!==!0,mt=ut&&z!=="tail",at=ene([i,bt]),Vt=N.useMemo(function(){return{observed:y,shards:fe,enabled:!L,active:v.current}},[L,v.current,fe,d]);return Ei.createElement(N.Fragment,null,ut&&[Ei.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:L?-1:0,style:cU}),ie?Ei.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:L?-1:1,style:cU}):null],!L&&Ei.createElement(be,{id:Ke,sideCar:iDe,observed:d,disabled:L,persistentFocus:K,crossFrame:ce,autoFocus:ge,whiteList:te,shards:fe,onActivation:ot,onDeactivation:_t,returnFocus:lt,focusOptions:De,noFocusGuards:z}),Ei.createElement(ve,jy({ref:at},$t,{className:J,onBlur:rt,onFocus:vt}),Ei.createElement(sDe.Provider,{value:Vt},k)),mt&&Ei.createElement("div",{"data-focus-guard":!0,tabIndex:L?-1:0,style:cU}))});kj.propTypes={};function SV(n,t){return SV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},SV(n,t)}function aDe(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,SV(n,t)}function $R(n){"@babel/helpers - typeof";return $R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$R(n)}function cDe(n,t){if($R(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if($R(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function lDe(n){var t=cDe(n,"string");return $R(t)=="symbol"?t:t+""}function uDe(n,t,i){return(t=lDe(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function dDe(n,t){function i(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function y(){f=n(d.map(function(b){return b.props})),t(f)}var v=function(b){aDe(R,b);function R(){return b.apply(this,arguments)||this}R.peek=function(){return f};var I=R.prototype;return I.componentDidMount=function(){d.push(this),y()},I.componentDidUpdate=function(){y()},I.componentWillUnmount=function(){var M=d.indexOf(this);d.splice(M,1),y()},I.render=function(){return Ei.createElement(l,this.props)},R}(N.PureComponent);return uDe(v,"displayName","SideEffect("+i(l)+")"),v}}var Dp=function(n){for(var t=Array(n.length),i=0;i<n.length;++i)t[i]=n[i];return t},zy=function(n){return Array.isArray(n)?n:[n]},ane=function(n){return Array.isArray(n)?n[0]:n},hDe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(n,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},cne=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},lne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},pDe=function(n){return n.hasAttribute("inert")},fDe=function(n,t){return!n||lne(n)||!hDe(n)&&!pDe(n)&&t(cne(n))},une=function(n,t){var i=n.get(t);if(i!==void 0)return i;var a=fDe(t,une.bind(void 0,n));return n.set(t,a),a},mDe=function(n,t){return n&&!lne(n)?yDe(n)?t(cne(n)):!1:!0},dne=function(n,t){var i=n.get(t);if(i!==void 0)return i;var a=mDe(t,dne.bind(void 0,n));return n.set(t,a),a},hne=function(n){return n.dataset},gDe=function(n){return n.tagName==="BUTTON"},pne=function(n){return n.tagName==="INPUT"},fne=function(n){return pne(n)&&n.type==="radio"},_De=function(n){return!((pne(n)||gDe(n))&&(n.type==="hidden"||n.disabled))},yDe=function(n){var t=n.getAttribute(QNe);return![!0,"true",""].includes(t)},Nj=function(n){var t;return!!(n&&(!((t=hne(n))===null||t===void 0)&&t.focusGuard))},bV=function(n){return!Nj(n)},EDe=function(n){return!!n},vDe=function(n,t){var i=Math.max(0,n.tabIndex),a=Math.max(0,t.tabIndex),l=i-a,d=n.index-t.index;if(l){if(!i)return 1;if(!a)return-1}return l||d},SDe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},Dj=function(n,t,i){return Dp(n).map(function(a,l){var d=SDe(a);return{node:a,index:l,tabIndex:i&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(vDe)},bDe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],xj=bDe.join(","),wDe="".concat(xj,", [data-focus-guard]"),mne=function(n,t){return Dp((n.shadowRoot||n).children).reduce(function(i,a){return i.concat(a.matches(t?wDe:xj)?[a]:[],mne(a))},[])},TDe=function(n,t){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?p0([n.contentDocument.body],t):[n]},p0=function(n,t){return n.reduce(function(i,a){var l,d=mne(a,t),f=(l=[]).concat.apply(l,d.map(function(y){return TDe(y,t)}));return i.concat(f,a.parentNode?Dp(a.parentNode.querySelectorAll(xj)).filter(function(y){return y===a}):[])},[])},RDe=function(n){var t=n.querySelectorAll("[".concat(JNe,"]"));return Dp(t).map(function(i){return p0([i])}).reduce(function(i,a){return i.concat(a)},[])},Lj=function(n,t){return Dp(n).filter(function(i){return une(t,i)}).filter(function(i){return _De(i)})},XY=function(n,t){return t===void 0&&(t=new Map),Dp(n).filter(function(i){return dne(t,i)})},Mj=function(n,t,i){return Dj(Lj(p0(n,i),t),!0,i)},KR=function(n,t){return Dj(Lj(p0(n),t),!1)},CDe=function(n,t){return Lj(RDe(n),t)},xy=function(n,t){return n.shadowRoot?xy(n.shadowRoot,t):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,t)?!0:Dp(n.children).some(function(i){var a;if(i instanceof HTMLIFrameElement){var l=(a=i.contentDocument)===null||a===void 0?void 0:a.body;return l?xy(l,t):!1}return xy(i,t)})},IDe=function(n){for(var t=new Set,i=n.length,a=0;a<i;a+=1)for(var l=a+1;l<i;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return n.filter(function(f,y){return!t.has(y)})},gne=function(n){return n.parentNode?gne(n.parentNode):n},Uj=function(n){var t=zy(n);return t.filter(Boolean).reduce(function(i,a){var l=a.getAttribute(vV);return i.push.apply(i,l?IDe(Dp(gne(a).querySelectorAll("[".concat(vV,'="').concat(l,'"]:not([').concat(Zte,'="disabled"])')))):[a]),i},[])},ADe=function(n){try{return n()}catch{return}},qR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var t=n.activeElement;return t.shadowRoot?qR(t.shadowRoot):t instanceof HTMLIFrameElement&&ADe(function(){return t.contentWindow.document})?qR(t.contentWindow.document):t}},PDe=function(n,t){return n===t},ODe=function(n,t){return!!Dp(n.querySelectorAll("iframe")).some(function(i){return PDe(i,t)})},_ne=function(n,t){return t===void 0&&(t=qR(ane(n).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:Uj(n).some(function(i){return xy(i,t)||ODe(i,t)})},kDe=function(n){n===void 0&&(n=document);var t=qR(n);return t?Dp(n.querySelectorAll("[".concat(XNe,"]"))).some(function(i){return xy(i,t)}):!1},NDe=function(n,t){return t.filter(fne).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},Vj=function(n,t){return fne(n)&&n.name?NDe(n,t):n},DDe=function(n){var t=new Set;return n.forEach(function(i){return t.add(Vj(i,n))}),n.filter(function(i){return t.has(i)})},JY=function(n){return n[0]&&n.length>1?Vj(n[0],n):n[0]},QY=function(n,t){return n.indexOf(Vj(t,n))},wV="NEW_FOCUS",xDe=function(n,t,i,a,l){var d=n.length,f=n[0],y=n[d-1],v=Nj(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?i.indexOf(a):-1,R=l?i.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:wV;if(I===-1)return wV;var k=b-R,M=i.indexOf(f),L=i.indexOf(y),j=DDe(i),z=a!==void 0?j.indexOf(a):-1,Y=l?j.indexOf(l):z,K=j.filter(function(J){return J.tabIndex>=0}),ne=a!==void 0?K.indexOf(a):-1,ce=l?K.indexOf(l):ne,oe=ne>=0&&ce>=0?ce-ne:Y-z;if(!k&&I>=0||t.length===0)return I;var ge=QY(n,t[0]),X=QY(n,t[t.length-1]);if(b<=M&&v&&Math.abs(k)>1)return X;if(b>=L&&v&&Math.abs(k)>1)return ge;if(k&&Math.abs(oe)>1)return I;if(b<=M)return X;if(b>L)return ge;if(k)return Math.abs(k)>1?I:(d+I+k)%d}},LDe=function(n){return function(t){var i,a=(i=hne(t))===null||i===void 0?void 0:i.autofocus;return t.autofocus||a!==void 0&&a!=="false"||n.indexOf(t)>=0}},ZY=function(n,t,i){var a=n.map(function(d){var f=d.node;return f}),l=XY(a.filter(LDe(i)));return l&&l.length?JY(l):JY(XY(t))},TV=function(n,t){return t===void 0&&(t=[]),t.push(n),n.parentNode&&TV(n.parentNode.host||n.parentNode,t),t},lU=function(n,t){for(var i=TV(n),a=TV(t),l=0;l<i.length;l+=1){var d=i[l];if(a.indexOf(d)>=0)return d}return!1},yne=function(n,t,i){var a=zy(n),l=zy(t),d=a[0],f=!1;return l.filter(Boolean).forEach(function(y){f=lU(f||y,y)||f,i.filter(Boolean).forEach(function(v){var b=lU(d,v);b&&(!f||xy(b,f)?f=b:f=lU(b,f))})}),f},eX=function(n,t){return n.reduce(function(i,a){return i.concat(CDe(a,t))},[])},MDe=function(n,t){var i=new Map;return t.forEach(function(a){return i.set(a.node,a)}),n.map(function(a){return i.get(a)}).filter(EDe)},UDe=function(n,t){var i=qR(zy(n).length>0?document:ane(n).ownerDocument),a=Uj(n).filter(bV),l=yne(i||n,n,a),d=new Map,f=KR(a,d),y=f.filter(function(L){var j=L.node;return bV(j)});if(y[0]){var v=KR([l],d).map(function(L){var j=L.node;return j}),b=MDe(v,y),R=b.map(function(L){var j=L.node;return j}),I=b.filter(function(L){var j=L.tabIndex;return j>=0}).map(function(L){var j=L.node;return j}),k=xDe(R,I,v,i,t);if(k===wV){var M=ZY(f,I,eX(a,d))||ZY(f,R,eX(a,d));if(M)return{node:M};console.warn("focus-lock: cannot find any node to move focus into");return}return k===void 0?k:b[k]}},VDe=function(n){var t=Uj(n).filter(bV),i=yne(n,n,t),a=Dj(p0([i],!0),!0,!0),l=p0(t,!1);return a.map(function(d){var f=d.node,y=d.index;return{node:f,index:y,lockItem:l.indexOf(f)>=0,guard:Nj(f)}})},Fj=function(n,t){n&&("focus"in n&&n.focus(t),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},uU=0,dU=!1,Ene=function(n,t,i){i===void 0&&(i={});var a=UDe(n,t);if(!dU&&a){if(uU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),dU=!0,setTimeout(function(){dU=!1},1);return}uU++,Fj(a.node,i.focusOptions),uU--}};function NT(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var t=n?new WeakRef(n):null;return function(){return(t==null?void 0:t.deref())||null}}var FDe=function(n){if(!n)return null;for(var t=[],i=n;i&&i!==document.body;)t.push({current:NT(i),parent:NT(i.parentElement),left:NT(i.previousElementSibling),right:NT(i.nextElementSibling)}),i=i.parentElement;return{element:NT(n),stack:t,ownerDocument:n.ownerDocument}},jDe=function(n){var t,i,a,l,d;if(n)for(var f=n.stack,y=n.ownerDocument,v=new Map,b=0,R=f;b<R.length;b++){var I=R[b],k=(t=I.parent)===null||t===void 0?void 0:t.call(I);if(k&&y.contains(k)){for(var M=(i=I.left)===null||i===void 0?void 0:i.call(I),L=I.current(),j=k.contains(L)?L:void 0,z=(a=I.right)===null||a===void 0?void 0:a.call(I),Y=Mj([k],v),K=(d=(l=j??(M==null?void 0:M.nextElementSibling))!==null&&l!==void 0?l:z)!==null&&d!==void 0?d:M;K;){for(var ne=0,ce=Y;ne<ce.length;ne++){var oe=ce[ne];if(K!=null&&K.contains(oe.node))return oe.node}K=K.nextElementSibling}if(Y.length)return Y[0].node}}},vne=function(n){var t=FDe(n);return function(){return jDe(t)}},BDe=function(n,t,i){if(!n||!t)return console.error("no element or scope given"),{};var a=zy(t);if(a.every(function(f){return!xy(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?Mj(a,new Map):KR(a,new Map),d=l.findIndex(function(f){var y=f.node;return y===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},zDe=function(n,t){var i=t?Mj(zy(n),new Map):KR(zy(n),new Map);return{first:i[0],last:i[i.length-1]}},WDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Sne=function(n,t,i){t===void 0&&(t={});var a=WDe(t),l=BDe(n,a.scope,a.onlyTabbable);if(l){var d=i(l,a.cycle);d&&Fj(d.node,a.focusOptions)}},GDe=function(n,t){t===void 0&&(t={}),Sne(n,t,function(i,a){var l=i.next,d=i.first;return l||a&&d})},HDe=function(n,t){t===void 0&&(t={}),Sne(n,t,function(i,a){var l=i.prev,d=i.last;return l||a&&d})},bne=function(n,t,i){var a,l=zDe(n,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[i];d&&Fj(d.node,t.focusOptions)},$De=function(n,t){t===void 0&&(t={}),bne(n,t,"first")},KDe=function(n,t){t===void 0&&(t={}),bne(n,t,"last")};function jj(n){setTimeout(n,1)}var qDe=function(t){return t&&"current"in t?t.current:t},wne=function(){return document&&document.activeElement===document.body},YDe=function(){return wne()||kDe()},$S=null,cl=null,tX=function(){return null},KS=null,YR=!1,Bj=!1,XDe=function(){return!0},JDe=function(t){return($S.whiteList||XDe)(t)},QDe=function(t,i){KS={observerNode:t,portaledElement:i}},ZDe=function(t){return KS&&KS.portaledElement===t};function nX(n,t,i,a){var l=null,d=n;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==n)return;l=null}else break}while((d+=i)!==t);l&&(l.node.tabIndex=0)}var exe=function(t){return t?!!YR:YR==="meanwhile"},txe=function n(t,i,a){return i&&(i.host===t&&(!i.activeElement||a.contains(i.activeElement))||i.parentNode&&n(t,i.parentNode,a))},nxe=function(t,i){return i.some(function(a){return txe(t,a,a)})},Tne=function(t){return KR(t,new Map)},rxe=function(t){return!Tne([t.parentNode]).some(function(i){return i.node===t})},KO=function(){var t=!1;if($S){var i=$S,a=i.observed,l=i.persistentFocus,d=i.autoFocus,f=i.shards,y=i.crossFrame,v=i.focusOptions,b=i.noFocusGuards,R=a||KS&&KS.portaledElement;if(wne()&&cl&&cl!==document.body&&(!document.body.contains(cl)||rxe(cl))){var I=tX();I&&I.focus()}var k=document&&document.activeElement;if(R){var M=[R].concat(f.map(qDe).filter(Boolean)),L=function(){if(!exe(y)||!b||!cl||Bj)return!1;var ne=Tne(M),ce=ne.findIndex(function(oe){var ge=oe.node;return ge===cl});return ce===0||ce===ne.length-1};if((!k||JDe(k))&&(l||L()||!YDe()||!cl&&d)&&(R&&!(_ne(M)||k&&nxe(k,M)||ZDe(k))&&(document&&!cl&&k&&!d?(k.blur&&k.blur(),document.body.focus()):(t=Ene(M,cl,{focusOptions:v}),KS={})),cl=document&&document.activeElement,cl!==document.body&&(tX=vne(cl)),YR=!1),document&&k!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var j=document&&document.activeElement,z=VDe(M),Y=z.map(function(K){var ne=K.node;return ne}).indexOf(j);Y>-1&&(z.filter(function(K){var ne=K.guard,ce=K.node;return ne&&ce.dataset.focusAutoGuard}).forEach(function(K){var ne=K.node;return ne.removeAttribute("tabIndex")}),nX(Y,z.length,1,z),nX(Y,-1,-1,z))}}}return t},Rne=function(t){KO()&&t&&(t.stopPropagation(),t.preventDefault())},zj=function(){return jj(KO)},ixe=function(t){var i=t.target,a=t.currentTarget;a.contains(i)||QDe(a,i)},sxe=function(){return null},Cne=function(){Bj=!0},Ine=function(){Bj=!1,YR="just",jj(function(){YR="meanwhile"})},oxe=function(){document.addEventListener("focusin",Rne),document.addEventListener("focusout",zj),window.addEventListener("focus",Cne),window.addEventListener("blur",Ine)},axe=function(){document.removeEventListener("focusin",Rne),document.removeEventListener("focusout",zj),window.removeEventListener("focus",Cne),window.removeEventListener("blur",Ine)};function cxe(n){return n.filter(function(t){var i=t.disabled;return!i})}var Ane={moveFocusInside:Ene,focusInside:_ne,focusNextElement:GDe,focusPrevElement:HDe,focusFirstElement:$De,focusLastElement:KDe,captureFocusRestore:vne};function lxe(n){var t=n.slice(-1)[0];t&&!$S&&oxe();var i=$S,a=i&&t&&t.id===i.id;$S=t,i&&!a&&(i.onDeactivation(),n.filter(function(l){var d=l.id;return d===i.id}).length||i.returnFocus(!t)),t?(cl=null,(!a||i.observed!==t.observed)&&t.onActivation(Ane),KO(),jj(KO)):(axe(),cl=null)}sne.assignSyncMedium(ixe);one.assignMedium(zj);rDe.assignMedium(function(n){return n(Ane)});const uxe=dDe(cxe,lxe)(sxe);var RV=N.forwardRef(function(t,i){return Ei.createElement(kj,jy({sideCar:uxe,ref:i},t))}),Pne=kj.propTypes||{};Pne.sideCar;HNe(Pne,["sideCar"]);RV.propTypes={};const dxe=RV.default??RV,One=n=>{const{initialFocusRef:t,finalFocusRef:i,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:y,persistentFocus:v,lockFocusAcrossFrames:b}=n,R=N.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&fZ(a.current).length===0&&requestAnimationFrame(()=>{var L;(L=a.current)==null||L.focus()})},[t,a]),I=N.useCallback(()=>{var M;(M=i==null?void 0:i.current)==null||M.focus()},[i]),k=l&&!i;return w.jsx(dxe,{crossFrame:b,persistentFocus:v,autoFocus:y,disabled:f,onActivation:R,onDeactivation:I,returnFocus:k,children:d})};One.displayName="FocusLock";const[hxe,pxe]=Ri({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),pp=Wt((n,t)=>{const i=Va("FormError",n),a=Gi(n),l=U0();return l!=null&&l.isInvalid?w.jsx(hxe,{value:i,children:w.jsx(Ft.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:Sn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});pp.displayName="FormErrorMessage";const fxe=Wt((n,t)=>{const i=pxe(),a=U0();if(!(a!=null&&a.isInvalid))return null;const l=Sn("chakra-form__error-icon",n.className);return w.jsx(yn,{ref:t,"aria-hidden":!0,...n,__css:i.icon,className:l,children:w.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});fxe.displayName="FormErrorIcon";const ss=Wt(function(t,i){const a=nd("FormLabel",t),l=Gi(t),{className:d,children:f,requiredIndicator:y=w.jsx(kne,{}),optionalIndicator:v=null,...b}=l,R=U0(),I=(R==null?void 0:R.getLabelProps(b,i))??{ref:i,...b};return w.jsxs(Ft.label,{...I,className:Sn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,R!=null&&R.isRequired?y:v]})});ss.displayName="FormLabel";const kne=Wt(function(t,i){const a=U0(),l=Qte();if(!(a!=null&&a.isRequired))return null;const d=Sn("chakra-form__required-indicator",t.className);return w.jsx(Ft.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,i),__css:l.requiredIndicator,className:d})});kne.displayName="RequiredIndicator";const Wj=Wt(function(t,i){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:y,row:v,autoFlow:b,autoRows:R,templateRows:I,autoColumns:k,templateColumns:M,...L}=t,j={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:k,gridColumn:y,gridRow:v,gridAutoFlow:b,gridAutoRows:R,gridTemplateRows:I,gridTemplateColumns:M};return w.jsx(Ft.div,{ref:i,__css:j,...L})});Wj.displayName="Grid";const Nne=Wt(function(t,i){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:y,...v}=t,b=M0(),R=y?gxe(y,b):_xe(a);return w.jsx(Wj,{ref:i,gap:f,columnGap:l,rowGap:d,templateColumns:R,...v})});Nne.displayName="SimpleGrid";function mxe(n){return typeof n=="number"?`${n}px`:n}function gxe(n,t){return wF(n,i=>{const a=Yke("sizes",i,mxe(i))(t);return i===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function _xe(n){return wF(n,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function Vg(n){const{viewBox:t="0 0 24 24",d:i,displayName:a,defaultProps:l={}}=n,d=N.Children.toArray(n.path),f=Wt((y,v)=>w.jsx(yn,{ref:v,viewBox:t,...l,...y,children:d.length?d:w.jsx("path",{fill:"currentColor",d:i})}));return f.displayName=a,f}const CV=Wt(function(t,i){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=t;return w.jsx("img",{width:a,height:l,ref:i,alt:d,...f})});CV.displayName="NativeImage";const yp=Wt(function(t,i){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:y,fit:v,loading:b,ignoreFallback:R,crossOrigin:I,fallbackStrategy:k="beforeLoadOrError",referrerPolicy:M,...L}=t,j=a!==void 0||l!==void 0,z=b!=null||R||!j,Y=Yte({...t,crossOrigin:I,ignoreFallback:z}),K=RNe(Y,k),ne={ref:i,objectFit:v,objectPosition:y,...z?L:k0(L,["onError","onLoad"])};return K?l||w.jsx(Ft.img,{as:CV,className:"chakra-image__placeholder",src:a,...ne}):w.jsx(Ft.img,{as:CV,src:d,srcSet:f,crossOrigin:I,loading:b,referrerPolicy:M,className:"chakra-image",...ne})});yp.displayName="Image";const Xi=Wt(function(t,i){const{htmlSize:a,...l}=t,d=Va("Input",l),f=Gi(l),y=Aj(f),v=Sn("chakra-input",t.className);return w.jsx(Ft.input,{size:a,...y,__css:d.field,ref:i,className:v})});Xi.displayName="Input";Xi.id="Input";const[yxe,Dne]=Ri({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Ly=Wt(function(t,i){const a=Va("Input",t),{children:l,className:d,...f}=Gi(t),y=Sn("chakra-input__group",d),v={},b=Rk(l),R=a.field;b.forEach(k=>{a&&(R&&k.type.id==="InputLeftElement"&&(v.paddingStart=R.height??R.h),R&&k.type.id==="InputRightElement"&&(v.paddingEnd=R.height??R.h),k.type.id==="InputRightAddon"&&(v.borderEndRadius=0),k.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const I=b.map(k=>{var L,j;const M=Ck({size:((L=k.props)==null?void 0:L.size)||t.size,variant:((j=k.props)==null?void 0:j.variant)||t.variant});return k.type.id!=="Input"?N.cloneElement(k,M):N.cloneElement(k,Object.assign(M,v,k.props))});return w.jsx(Ft.div,{className:y,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:w.jsx(yxe,{value:a,children:I})})});Ly.displayName="InputGroup";const Exe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},vxe=Ft("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),Gj=Wt(function(t,i){const{placement:a="left",...l}=t,d=Exe[a]??{},f=Dne();return w.jsx(vxe,{ref:i,...l,__css:{...f.addon,...d}})});Gj.displayName="InputAddon";const Hj=Wt(function(t,i){return w.jsx(Gj,{ref:i,placement:"left",...t,className:Sn("chakra-input__left-addon",t.className)})});Hj.displayName="InputLeftAddon";Hj.id="InputLeftAddon";const xne=Wt(function(t,i){return w.jsx(Gj,{ref:i,placement:"right",...t,className:Sn("chakra-input__right-addon",t.className)})});xne.displayName="InputRightAddon";xne.id="InputRightAddon";const Sxe=Ft("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),zk=Wt(function(t,i){const{placement:a="left",...l}=t,d=Dne(),f=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return w.jsx(Sxe,{ref:i,__css:v,...l})});zk.id="InputElement";zk.displayName="InputElement";const bR=Wt(function(t,i){const{className:a,...l}=t,d=Sn("chakra-input__left-element",a);return w.jsx(zk,{ref:i,placement:"left",className:d,...l})});bR.id="InputLeftElement";bR.displayName="InputLeftElement";const qO=Wt(function(t,i){const{className:a,...l}=t,d=Sn("chakra-input__right-element",a);return w.jsx(zk,{ref:i,placement:"right",className:d,...l})});qO.id="InputRightElement";qO.displayName="InputRightElement";const Xl=Wt(function(t,i){const a=nd("Link",t),{className:l,isExternal:d,...f}=Gi(t);return w.jsx(Ft.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:i,className:Sn("chakra-link",l),...f,__css:a})});Xl.displayName="Link";const[bxe,Lne]=Ri({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),Wk=Wt(function(t,i){const a=Va("List",t),{children:l,styleType:d="none",stylePosition:f,spacing:y,...v}=Gi(t),b=Rk(l),I=y?{["& > *:not(style) ~ *:not(style)"]:{mt:y}}:{};return w.jsx(bxe,{value:a,children:w.jsx(Ft.ul,{ref:i,listStyleType:d,listStylePosition:f,role:"list",__css:{...a.container,...I},...v,children:b})})});Wk.displayName="List";const wxe=Wt((n,t)=>{const{as:i,...a}=n;return w.jsx(Wk,{ref:t,as:"ol",styleType:"decimal",marginStart:"1em",...a})});wxe.displayName="OrderedList";const Txe=Wt(function(t,i){const{as:a,...l}=t;return w.jsx(Wk,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});Txe.displayName="UnorderedList";const Mne=Wt(function(t,i){const a=Lne();return w.jsx(Ft.li,{ref:i,...t,__css:a.item})});Mne.displayName="ListItem";const Rxe=Wt(function(t,i){const a=Lne();return w.jsx(yn,{ref:i,role:"presentation",...t,__css:a.icon})});Rxe.displayName="ListIcon";function Cxe(n,t={}){const{ssr:i=!0,fallback:a}=t,{getWindow:l}=QIe(),d=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(b=>b!=null);const[y,v]=N.useState(()=>d.map((b,R)=>({media:b,matches:i?!!f[R]:l().matchMedia(b).matches})));return N.useEffect(()=>{const b=l();v(d.map(k=>({media:k,matches:b.matchMedia(k).matches})));const R=d.map(k=>b.matchMedia(k)),I=k=>{v(M=>M.slice().map(L=>L.media===k.media?{...L,matches:k.matches}:L))};return R.forEach(k=>{typeof k.addListener=="function"?k.addListener(I):k.addEventListener("change",I)}),()=>{R.forEach(k=>{typeof k.removeListener=="function"?k.removeListener(I):k.removeEventListener("change",I)})}},[l]),y.map(b=>b.matches)}function Ixe(n,t,i,a){if(t==null)return a;if(!a)return n.find(f=>i(f).toLowerCase().startsWith(t.toLowerCase()));const l=n.filter(d=>i(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function Axe(n){const{key:t}=n;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function Pxe(n={}){const{timeout:t=300,preventDefault:i=()=>!0}=n,[a,l]=N.useState([]),d=N.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},y=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},t)};N.useEffect(()=>f,[]);function v(b){return R=>{if(R.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(Axe(R)){const I=a.concat(R.key);i(R)&&(R.preventDefault(),R.stopPropagation()),l(I),b(I.join("")),y()}}}return v}var gl="top",ed="bottom",td="right",_l="left",$j="auto",SC=[gl,ed,td,_l],f0="start",XR="end",Oxe="clippingParents",Une="viewport",DT="popper",kxe="reference",rX=SC.reduce(function(n,t){return n.concat([t+"-"+f0,t+"-"+XR])},[]),Vne=[].concat(SC,[$j]).reduce(function(n,t){return n.concat([t,t+"-"+f0,t+"-"+XR])},[]),Nxe="beforeRead",Dxe="read",xxe="afterRead",Lxe="beforeMain",Mxe="main",Uxe="afterMain",Vxe="beforeWrite",Fxe="write",jxe="afterWrite",Bxe=[Nxe,Dxe,xxe,Lxe,Mxe,Uxe,Vxe,Fxe,jxe];function kp(n){return n?(n.nodeName||"").toLowerCase():null}function su(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function Wy(n){var t=su(n).Element;return n instanceof t||n instanceof Element}function Xu(n){var t=su(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function Kj(n){if(typeof ShadowRoot>"u")return!1;var t=su(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function zxe(n){var t=n.state;Object.keys(t.elements).forEach(function(i){var a=t.styles[i]||{},l=t.attributes[i]||{},d=t.elements[i];!Xu(d)||!kp(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var y=l[f];y===!1?d.removeAttribute(f):d.setAttribute(f,y===!0?"":y)}))})}function Wxe(n){var t=n.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},f=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:i[a]),y=f.reduce(function(v,b){return v[b]="",v},{});!Xu(l)||!kp(l)||(Object.assign(l.style,y),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const Gxe={name:"applyStyles",enabled:!0,phase:"write",fn:zxe,effect:Wxe,requires:["computeStyles"]};function Cp(n){return n.split("-")[0]}var My=Math.max,YO=Math.min,m0=Math.round;function IV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function Fne(){return!/^((?!chrome|android).)*safari/i.test(IV())}function g0(n,t,i){t===void 0&&(t=!1),i===void 0&&(i=!1);var a=n.getBoundingClientRect(),l=1,d=1;t&&Xu(n)&&(l=n.offsetWidth>0&&m0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&m0(a.height)/n.offsetHeight||1);var f=Wy(n)?su(n):window,y=f.visualViewport,v=!Fne()&&i,b=(a.left+(v&&y?y.offsetLeft:0))/l,R=(a.top+(v&&y?y.offsetTop:0))/d,I=a.width/l,k=a.height/d;return{width:I,height:k,top:R,right:b+I,bottom:R+k,left:b,x:b,y:R}}function qj(n){var t=g0(n),i=n.offsetWidth,a=n.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:a}}function jne(n,t){var i=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(i&&Kj(i)){var a=t;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Vf(n){return su(n).getComputedStyle(n)}function Hxe(n){return["table","td","th"].indexOf(kp(n))>=0}function Fg(n){return((Wy(n)?n.ownerDocument:n.document)||window.document).documentElement}function Gk(n){return kp(n)==="html"?n:n.assignedSlot||n.parentNode||(Kj(n)?n.host:null)||Fg(n)}function iX(n){return!Xu(n)||Vf(n).position==="fixed"?null:n.offsetParent}function $xe(n){var t=/firefox/i.test(IV()),i=/Trident/i.test(IV());if(i&&Xu(n)){var a=Vf(n);if(a.position==="fixed")return null}var l=Gk(n);for(Kj(l)&&(l=l.host);Xu(l)&&["html","body"].indexOf(kp(l))<0;){var d=Vf(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function bC(n){for(var t=su(n),i=iX(n);i&&Hxe(i)&&Vf(i).position==="static";)i=iX(i);return i&&(kp(i)==="html"||kp(i)==="body"&&Vf(i).position==="static")?t:i||$xe(n)||t}function Yj(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function wR(n,t,i){return My(n,YO(t,i))}function Kxe(n,t,i){var a=wR(n,t,i);return a>i?i:a}function Bne(){return{top:0,right:0,bottom:0,left:0}}function zne(n){return Object.assign({},Bne(),n)}function Wne(n,t){return t.reduce(function(i,a){return i[a]=n,i},{})}var qxe=function(t,i){return t=typeof t=="function"?t(Object.assign({},i.rects,{placement:i.placement})):t,zne(typeof t!="number"?t:Wne(t,SC))};function Yxe(n){var t,i=n.state,a=n.name,l=n.options,d=i.elements.arrow,f=i.modifiersData.popperOffsets,y=Cp(i.placement),v=Yj(y),b=[_l,td].indexOf(y)>=0,R=b?"height":"width";if(!(!d||!f)){var I=qxe(l.padding,i),k=qj(d),M=v==="y"?gl:_l,L=v==="y"?ed:td,j=i.rects.reference[R]+i.rects.reference[v]-f[v]-i.rects.popper[R],z=f[v]-i.rects.reference[v],Y=bC(d),K=Y?v==="y"?Y.clientHeight||0:Y.clientWidth||0:0,ne=j/2-z/2,ce=I[M],oe=K-k[R]-I[L],ge=K/2-k[R]/2+ne,X=wR(ce,ge,oe),J=v;i.modifiersData[a]=(t={},t[J]=X,t.centerOffset=X-ge,t)}}function Xxe(n){var t=n.state,i=n.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||jne(t.elements.popper,l)&&(t.elements.arrow=l))}const Jxe={name:"arrow",enabled:!0,phase:"main",fn:Yxe,effect:Xxe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function _0(n){return n.split("-")[1]}var Qxe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Zxe(n,t){var i=n.x,a=n.y,l=t.devicePixelRatio||1;return{x:m0(i*l)/l||0,y:m0(a*l)/l||0}}function sX(n){var t,i=n.popper,a=n.popperRect,l=n.placement,d=n.variation,f=n.offsets,y=n.position,v=n.gpuAcceleration,b=n.adaptive,R=n.roundOffsets,I=n.isFixed,k=f.x,M=k===void 0?0:k,L=f.y,j=L===void 0?0:L,z=typeof R=="function"?R({x:M,y:j}):{x:M,y:j};M=z.x,j=z.y;var Y=f.hasOwnProperty("x"),K=f.hasOwnProperty("y"),ne=_l,ce=gl,oe=window;if(b){var ge=bC(i),X="clientHeight",J="clientWidth";if(ge===su(i)&&(ge=Fg(i),Vf(ge).position!=="static"&&y==="absolute"&&(X="scrollHeight",J="scrollWidth")),ge=ge,l===gl||(l===_l||l===td)&&d===XR){ce=ed;var te=I&&ge===oe&&oe.visualViewport?oe.visualViewport.height:ge[X];j-=te-a.height,j*=v?1:-1}if(l===_l||(l===gl||l===ed)&&d===XR){ne=td;var ie=I&&ge===oe&&oe.visualViewport?oe.visualViewport.width:ge[J];M-=ie-a.width,M*=v?1:-1}}var he=Object.assign({position:y},b&&Qxe),fe=R===!0?Zxe({x:M,y:j},su(i)):{x:M,y:j};if(M=fe.x,j=fe.y,v){var de;return Object.assign({},he,(de={},de[ce]=K?"0":"",de[ne]=Y?"0":"",de.transform=(oe.devicePixelRatio||1)<=1?"translate("+M+"px, "+j+"px)":"translate3d("+M+"px, "+j+"px, 0)",de))}return Object.assign({},he,(t={},t[ce]=K?j+"px":"",t[ne]=Y?M+"px":"",t.transform="",t))}function eLe(n){var t=n.state,i=n.options,a=i.gpuAcceleration,l=a===void 0?!0:a,d=i.adaptive,f=d===void 0?!0:d,y=i.roundOffsets,v=y===void 0?!0:y,b={placement:Cp(t.placement),variation:_0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,sX(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,sX(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const tLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:eLe,data:{}};var x1={passive:!0};function nLe(n){var t=n.state,i=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,y=f===void 0?!0:f,v=su(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(R){R.addEventListener("scroll",i.update,x1)}),y&&v.addEventListener("resize",i.update,x1),function(){d&&b.forEach(function(R){R.removeEventListener("scroll",i.update,x1)}),y&&v.removeEventListener("resize",i.update,x1)}}const rLe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:nLe,data:{}};var iLe={left:"right",right:"left",bottom:"top",top:"bottom"};function mO(n){return n.replace(/left|right|bottom|top/g,function(t){return iLe[t]})}var sLe={start:"end",end:"start"};function oX(n){return n.replace(/start|end/g,function(t){return sLe[t]})}function Xj(n){var t=su(n),i=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:i,scrollTop:a}}function Jj(n){return g0(Fg(n)).left+Xj(n).scrollLeft}function oLe(n,t){var i=su(n),a=Fg(n),l=i.visualViewport,d=a.clientWidth,f=a.clientHeight,y=0,v=0;if(l){d=l.width,f=l.height;var b=Fne();(b||!b&&t==="fixed")&&(y=l.offsetLeft,v=l.offsetTop)}return{width:d,height:f,x:y+Jj(n),y:v}}function aLe(n){var t,i=Fg(n),a=Xj(n),l=(t=n.ownerDocument)==null?void 0:t.body,d=My(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=My(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-a.scrollLeft+Jj(n),v=-a.scrollTop;return Vf(l||i).direction==="rtl"&&(y+=My(i.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:y,y:v}}function Qj(n){var t=Vf(n),i=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function Gne(n){return["html","body","#document"].indexOf(kp(n))>=0?n.ownerDocument.body:Xu(n)&&Qj(n)?n:Gne(Gk(n))}function TR(n,t){var i;t===void 0&&(t=[]);var a=Gne(n),l=a===((i=n.ownerDocument)==null?void 0:i.body),d=su(a),f=l?[d].concat(d.visualViewport||[],Qj(a)?a:[]):a,y=t.concat(f);return l?y:y.concat(TR(Gk(f)))}function AV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function cLe(n,t){var i=g0(n,!1,t==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function aX(n,t,i){return t===Une?AV(oLe(n,i)):Wy(t)?cLe(t,i):AV(aLe(Fg(n)))}function lLe(n){var t=TR(Gk(n)),i=["absolute","fixed"].indexOf(Vf(n).position)>=0,a=i&&Xu(n)?bC(n):n;return Wy(a)?t.filter(function(l){return Wy(l)&&jne(l,a)&&kp(l)!=="body"}):[]}function uLe(n,t,i,a){var l=t==="clippingParents"?lLe(n):[].concat(t),d=[].concat(l,[i]),f=d[0],y=d.reduce(function(v,b){var R=aX(n,b,a);return v.top=My(R.top,v.top),v.right=YO(R.right,v.right),v.bottom=YO(R.bottom,v.bottom),v.left=My(R.left,v.left),v},aX(n,f,a));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function Hne(n){var t=n.reference,i=n.element,a=n.placement,l=a?Cp(a):null,d=a?_0(a):null,f=t.x+t.width/2-i.width/2,y=t.y+t.height/2-i.height/2,v;switch(l){case gl:v={x:f,y:t.y-i.height};break;case ed:v={x:f,y:t.y+t.height};break;case td:v={x:t.x+t.width,y};break;case _l:v={x:t.x-i.width,y};break;default:v={x:t.x,y:t.y}}var b=l?Yj(l):null;if(b!=null){var R=b==="y"?"height":"width";switch(d){case f0:v[b]=v[b]-(t[R]/2-i[R]/2);break;case XR:v[b]=v[b]+(t[R]/2-i[R]/2);break}}return v}function JR(n,t){t===void 0&&(t={});var i=t,a=i.placement,l=a===void 0?n.placement:a,d=i.strategy,f=d===void 0?n.strategy:d,y=i.boundary,v=y===void 0?Oxe:y,b=i.rootBoundary,R=b===void 0?Une:b,I=i.elementContext,k=I===void 0?DT:I,M=i.altBoundary,L=M===void 0?!1:M,j=i.padding,z=j===void 0?0:j,Y=zne(typeof z!="number"?z:Wne(z,SC)),K=k===DT?kxe:DT,ne=n.rects.popper,ce=n.elements[L?K:k],oe=uLe(Wy(ce)?ce:ce.contextElement||Fg(n.elements.popper),v,R,f),ge=g0(n.elements.reference),X=Hne({reference:ge,element:ne,placement:l}),J=AV(Object.assign({},ne,X)),te=k===DT?J:ge,ie={top:oe.top-te.top+Y.top,bottom:te.bottom-oe.bottom+Y.bottom,left:oe.left-te.left+Y.left,right:te.right-oe.right+Y.right},he=n.modifiersData.offset;if(k===DT&&he){var fe=he[l];Object.keys(ie).forEach(function(de){var ve=[td,ed].indexOf(de)>=0?1:-1,Te=[gl,ed].indexOf(de)>=0?"y":"x";ie[de]+=fe[Te]*ve})}return ie}function dLe(n,t){t===void 0&&(t={});var i=t,a=i.placement,l=i.boundary,d=i.rootBoundary,f=i.padding,y=i.flipVariations,v=i.allowedAutoPlacements,b=v===void 0?Vne:v,R=_0(a),I=R?y?rX:rX.filter(function(L){return _0(L)===R}):SC,k=I.filter(function(L){return b.indexOf(L)>=0});k.length===0&&(k=I);var M=k.reduce(function(L,j){return L[j]=JR(n,{placement:j,boundary:l,rootBoundary:d,padding:f})[Cp(j)],L},{});return Object.keys(M).sort(function(L,j){return M[L]-M[j]})}function hLe(n){if(Cp(n)===$j)return[];var t=mO(n);return[oX(n),t,oX(t)]}function pLe(n){var t=n.state,i=n.options,a=n.name;if(!t.modifiersData[a]._skip){for(var l=i.mainAxis,d=l===void 0?!0:l,f=i.altAxis,y=f===void 0?!0:f,v=i.fallbackPlacements,b=i.padding,R=i.boundary,I=i.rootBoundary,k=i.altBoundary,M=i.flipVariations,L=M===void 0?!0:M,j=i.allowedAutoPlacements,z=t.options.placement,Y=Cp(z),K=Y===z,ne=v||(K||!L?[mO(z)]:hLe(z)),ce=[z].concat(ne).reduce(function(Ke,ot){return Ke.concat(Cp(ot)===$j?dLe(t,{placement:ot,boundary:R,rootBoundary:I,padding:b,flipVariations:L,allowedAutoPlacements:j}):ot)},[]),oe=t.rects.reference,ge=t.rects.popper,X=new Map,J=!0,te=ce[0],ie=0;ie<ce.length;ie++){var he=ce[ie],fe=Cp(he),de=_0(he)===f0,ve=[gl,ed].indexOf(fe)>=0,Te=ve?"width":"height",Fe=JR(t,{placement:he,boundary:R,rootBoundary:I,altBoundary:k,padding:b}),be=ve?de?td:_l:de?ed:gl;oe[Te]>ge[Te]&&(be=mO(be));var Ce=mO(be),Ae=[];if(d&&Ae.push(Fe[fe]<=0),y&&Ae.push(Fe[be]<=0,Fe[Ce]<=0),Ae.every(function(Ke){return Ke})){te=he,J=!1;break}X.set(he,Ae)}if(J)for(var De=L?3:1,Ee=function(ot){var _t=ce.find(function(lt){var vt=X.get(lt);if(vt)return vt.slice(0,ot).every(function(rt){return rt})});if(_t)return te=_t,"break"},Ne=De;Ne>0;Ne--){var je=Ee(Ne);if(je==="break")break}t.placement!==te&&(t.modifiersData[a]._skip=!0,t.placement=te,t.reset=!0)}}const fLe={name:"flip",enabled:!0,phase:"main",fn:pLe,requiresIfExists:["offset"],data:{_skip:!1}};function cX(n,t,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-t.height-i.y,right:n.right-t.width+i.x,bottom:n.bottom-t.height+i.y,left:n.left-t.width-i.x}}function lX(n){return[gl,td,ed,_l].some(function(t){return n[t]>=0})}function mLe(n){var t=n.state,i=n.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,f=JR(t,{elementContext:"reference"}),y=JR(t,{altBoundary:!0}),v=cX(f,a),b=cX(y,l,d),R=lX(v),I=lX(b);t.modifiersData[i]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:R,hasPopperEscaped:I},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":R,"data-popper-escaped":I})}const gLe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:mLe};function _Le(n,t,i){var a=Cp(n),l=[_l,gl].indexOf(a)>=0?-1:1,d=typeof i=="function"?i(Object.assign({},t,{placement:n})):i,f=d[0],y=d[1];return f=f||0,y=(y||0)*l,[_l,td].indexOf(a)>=0?{x:y,y:f}:{x:f,y}}function yLe(n){var t=n.state,i=n.options,a=n.name,l=i.offset,d=l===void 0?[0,0]:l,f=Vne.reduce(function(R,I){return R[I]=_Le(I,t.rects,d),R},{}),y=f[t.placement],v=y.x,b=y.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=f}const ELe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:yLe};function vLe(n){var t=n.state,i=n.name;t.modifiersData[i]=Hne({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const SLe={name:"popperOffsets",enabled:!0,phase:"read",fn:vLe,data:{}};function bLe(n){return n==="x"?"y":"x"}function wLe(n){var t=n.state,i=n.options,a=n.name,l=i.mainAxis,d=l===void 0?!0:l,f=i.altAxis,y=f===void 0?!1:f,v=i.boundary,b=i.rootBoundary,R=i.altBoundary,I=i.padding,k=i.tether,M=k===void 0?!0:k,L=i.tetherOffset,j=L===void 0?0:L,z=JR(t,{boundary:v,rootBoundary:b,padding:I,altBoundary:R}),Y=Cp(t.placement),K=_0(t.placement),ne=!K,ce=Yj(Y),oe=bLe(ce),ge=t.modifiersData.popperOffsets,X=t.rects.reference,J=t.rects.popper,te=typeof j=="function"?j(Object.assign({},t.rects,{placement:t.placement})):j,ie=typeof te=="number"?{mainAxis:te,altAxis:te}:Object.assign({mainAxis:0,altAxis:0},te),he=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,fe={x:0,y:0};if(ge){if(d){var de,ve=ce==="y"?gl:_l,Te=ce==="y"?ed:td,Fe=ce==="y"?"height":"width",be=ge[ce],Ce=be+z[ve],Ae=be-z[Te],De=M?-J[Fe]/2:0,Ee=K===f0?X[Fe]:J[Fe],Ne=K===f0?-J[Fe]:-X[Fe],je=t.elements.arrow,Ke=M&&je?qj(je):{width:0,height:0},ot=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Bne(),_t=ot[ve],lt=ot[Te],vt=wR(0,X[Fe],Ke[Fe]),rt=ne?X[Fe]/2-De-vt-_t-ie.mainAxis:Ee-vt-_t-ie.mainAxis,bt=ne?-X[Fe]/2+De+vt+lt+ie.mainAxis:Ne+vt+lt+ie.mainAxis,$t=t.elements.arrow&&bC(t.elements.arrow),ut=$t?ce==="y"?$t.clientTop||0:$t.clientLeft||0:0,mt=(de=he==null?void 0:he[ce])!=null?de:0,at=be+rt-mt-ut,Vt=be+bt-mt,rn=wR(M?YO(Ce,at):Ce,be,M?My(Ae,Vt):Ae);ge[ce]=rn,fe[ce]=rn-be}if(y){var Ht,we=ce==="x"?gl:_l,xe=ce==="x"?ed:td,$e=ge[oe],Pt=oe==="y"?"height":"width",It=$e+z[we],wt=$e-z[xe],Mt=[gl,_l].indexOf(Y)!==-1,vn=(Ht=he==null?void 0:he[oe])!=null?Ht:0,Cn=Mt?It:$e-X[Pt]-J[Pt]-vn+ie.altAxis,dn=Mt?$e+X[Pt]+J[Pt]-vn-ie.altAxis:wt,Rt=M&&Mt?Kxe(Cn,$e,dn):wR(M?Cn:It,$e,M?dn:wt);ge[oe]=Rt,fe[oe]=Rt-$e}t.modifiersData[a]=fe}}const TLe={name:"preventOverflow",enabled:!0,phase:"main",fn:wLe,requiresIfExists:["offset"]};function RLe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function CLe(n){return n===su(n)||!Xu(n)?Xj(n):RLe(n)}function ILe(n){var t=n.getBoundingClientRect(),i=m0(t.width)/n.offsetWidth||1,a=m0(t.height)/n.offsetHeight||1;return i!==1||a!==1}function ALe(n,t,i){i===void 0&&(i=!1);var a=Xu(t),l=Xu(t)&&ILe(t),d=Fg(t),f=g0(n,l,i),y={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!i)&&((kp(t)!=="body"||Qj(d))&&(y=CLe(t)),Xu(t)?(v=g0(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=Jj(d))),{x:f.left+y.scrollLeft-v.x,y:f.top+y.scrollTop-v.y,width:f.width,height:f.height}}function PLe(n){var t=new Map,i=new Set,a=[];n.forEach(function(d){t.set(d.name,d)});function l(d){i.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(y){if(!i.has(y)){var v=t.get(y);v&&l(v)}}),a.push(d)}return n.forEach(function(d){i.has(d.name)||l(d)}),a}function OLe(n){var t=PLe(n);return Bxe.reduce(function(i,a){return i.concat(t.filter(function(l){return l.phase===a}))},[])}function kLe(n){var t;return function(){return t||(t=new Promise(function(i){Promise.resolve().then(function(){t=void 0,i(n())})})),t}}function NLe(n){var t=n.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(t).map(function(i){return t[i]})}var uX={placement:"bottom",modifiers:[],strategy:"absolute"};function dX(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function DLe(n){n===void 0&&(n={});var t=n,i=t.defaultModifiers,a=i===void 0?[]:i,l=t.defaultOptions,d=l===void 0?uX:l;return function(y,v,b){b===void 0&&(b=d);var R={placement:"bottom",orderedModifiers:[],options:Object.assign({},uX,d),modifiersData:{},elements:{reference:y,popper:v},attributes:{},styles:{}},I=[],k=!1,M={state:R,setOptions:function(Y){var K=typeof Y=="function"?Y(R.options):Y;j(),R.options=Object.assign({},d,R.options,K),R.scrollParents={reference:Wy(y)?TR(y):y.contextElement?TR(y.contextElement):[],popper:TR(v)};var ne=OLe(NLe([].concat(a,R.options.modifiers)));return R.orderedModifiers=ne.filter(function(ce){return ce.enabled}),L(),M.update()},forceUpdate:function(){if(!k){var Y=R.elements,K=Y.reference,ne=Y.popper;if(dX(K,ne)){R.rects={reference:ALe(K,bC(ne),R.options.strategy==="fixed"),popper:qj(ne)},R.reset=!1,R.placement=R.options.placement,R.orderedModifiers.forEach(function(ie){return R.modifiersData[ie.name]=Object.assign({},ie.data)});for(var ce=0;ce<R.orderedModifiers.length;ce++){if(R.reset===!0){R.reset=!1,ce=-1;continue}var oe=R.orderedModifiers[ce],ge=oe.fn,X=oe.options,J=X===void 0?{}:X,te=oe.name;typeof ge=="function"&&(R=ge({state:R,options:J,name:te,instance:M})||R)}}}},update:kLe(function(){return new Promise(function(z){M.forceUpdate(),z(R)})}),destroy:function(){j(),k=!0}};if(!dX(y,v))return M;M.setOptions(b).then(function(z){!k&&b.onFirstUpdate&&b.onFirstUpdate(z)});function L(){R.orderedModifiers.forEach(function(z){var Y=z.name,K=z.options,ne=K===void 0?{}:K,ce=z.effect;if(typeof ce=="function"){var oe=ce({state:R,name:Y,instance:M,options:ne}),ge=function(){};I.push(oe||ge)}})}function j(){I.forEach(function(z){return z()}),I=[]}return M}}var xLe=[rLe,SLe,tLe,Gxe,ELe,fLe,TLe,Jxe,gLe],LLe=DLe({defaultModifiers:xLe});const mS=(n,t)=>({var:n,varRef:t?`var(${n}, ${t})`:`var(${n})`}),bo={arrowShadowColor:mS("--popper-arrow-shadow-color"),arrowSize:mS("--popper-arrow-size","8px"),arrowSizeHalf:mS("--popper-arrow-size-half"),arrowBg:mS("--popper-arrow-bg"),transformOrigin:mS("--popper-transform-origin"),arrowOffset:mS("--popper-arrow-offset")};function MLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const ULe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},VLe=n=>ULe[n],hX={scroll:!0,resize:!0};function FLe(n){let t;return typeof n=="object"?t={enabled:!0,options:{...hX,...n}}:t={enabled:n,options:hX},t}const jLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const t=n.elements.reference;n.elements.popper.style.width=`${t.offsetWidth}px`}},BLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{pX(n)},effect:({state:n})=>()=>{pX(n)}},pX=n=>{n.elements.popper.style.setProperty(bo.transformOrigin.var,VLe(n.placement))},zLe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{WLe(n)}},WLe=n=>{var i;if(!n.placement)return;const t=GLe(n.placement);if((i=n.elements)!=null&&i.arrow&&t){Object.assign(n.elements.arrow.style,{[t.property]:t.value,width:bo.arrowSize.varRef,height:bo.arrowSize.varRef,zIndex:-1});const a={[bo.arrowSizeHalf.var]:`calc(${bo.arrowSize.varRef} / 2 - 1px)`,[bo.arrowOffset.var]:`calc(${bo.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},GLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:bo.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:bo.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:bo.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:bo.arrowOffset.varRef}},HLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{fX(n)},effect:({state:n})=>()=>{fX(n)}},fX=n=>{if(!n.elements.arrow)return;const t=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const i=MLe(n.placement);i&&t.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(t.style,{transform:"rotate(45deg)",background:bo.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},$Le={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},KLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function qLe(n,t="ltr"){var a;const i=((a=$Le[n])==null?void 0:a[t])||n;return t==="ltr"?i:KLe[n]??i}function Zj(n={}){const{enabled:t=!0,modifiers:i,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:y,gutter:v=8,flip:b=!0,boundary:R="clippingParents",preventOverflow:I=!0,matchWidth:k,direction:M="ltr"}=n,L=N.useRef(null),j=N.useRef(null),z=N.useRef(null),Y=qLe(a,M),K=N.useRef(()=>{}),ne=N.useCallback(()=>{var ie;!t||!L.current||!j.current||((ie=K.current)==null||ie.call(K),z.current=LLe(L.current,j.current,{placement:Y,modifiers:[HLe,zLe,BLe,{...jLe,enabled:!!k},{name:"eventListeners",...FLe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:y??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:R}},...i??[]],strategy:l}),z.current.forceUpdate(),K.current=z.current.destroy)},[Y,t,i,k,f,d,y,v,b,I,R,l]);N.useEffect(()=>()=>{var ie;!L.current&&!j.current&&((ie=z.current)==null||ie.destroy(),z.current=null)},[]);const ce=N.useCallback(ie=>{L.current=ie,ne()},[ne]),oe=N.useCallback((ie={},he=null)=>({...ie,ref:zi(ce,he)}),[ce]),ge=N.useCallback(ie=>{j.current=ie,ne()},[ne]),X=N.useCallback((ie={},he=null)=>({...ie,ref:zi(ge,he),style:{...ie.style,position:l,minWidth:k?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ge,k]),J=N.useCallback((ie={},he=null)=>{const{size:fe,shadowColor:de,bg:ve,style:Te,...Fe}=ie;return{...Fe,ref:he,"data-popper-arrow":"",style:YLe(ie)}},[]),te=N.useCallback((ie={},he=null)=>({...ie,ref:he,"data-popper-arrow-inner":""}),[]);return{update(){var ie;(ie=z.current)==null||ie.update()},forceUpdate(){var ie;(ie=z.current)==null||ie.forceUpdate()},transformOrigin:bo.transformOrigin.varRef,referenceRef:ce,popperRef:ge,getPopperProps:X,getArrowProps:J,getArrowInnerProps:te,getReferenceProps:oe}}function YLe(n){const{size:t,shadowColor:i,bg:a,style:l}=n,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),i&&(d["--popper-arrow-shadow-color"]=i),a&&(d["--popper-arrow-bg"]=a),d}function XLe(){const n=N.useRef(new Map),t=n.current,i=N.useCallback((l,d,f,y)=>{n.current.set(f,{type:d,el:l,options:y}),l.addEventListener(d,f,y)},[]),a=N.useCallback((l,d,f,y)=>{l.removeEventListener(d,f,y),n.current.delete(f)},[]);return N.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:i,remove:a}}function hU(n){var l,d;const t=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:i,isContentEditable:a}=t;return i!=="INPUT"&&i!=="TEXTAREA"&&a!==!0}function $ne(n={}){const{ref:t,isDisabled:i,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:y,onClick:v,onKeyDown:b,onKeyUp:R,tabIndex:I,onMouseOver:k,onMouseLeave:M,...L}=n,[j,z]=N.useState(!0),[Y,K]=N.useState(!1),ne=XLe(),ce=be=>{be&&be.tagName!=="BUTTON"&&z(!1)},oe=j?I:I||0,ge=i&&!a,X=N.useCallback(be=>{if(i){be.stopPropagation(),be.preventDefault();return}be.currentTarget.focus(),v==null||v(be)},[i,v]),J=N.useCallback(be=>{Y&&hU(be)&&(be.preventDefault(),be.stopPropagation(),K(!1),ne.remove(document,"keyup",J,!1))},[Y,ne]),te=N.useCallback(be=>{if(b==null||b(be),i||be.defaultPrevented||be.metaKey||!hU(be.nativeEvent)||j)return;const Ce=l&&be.key==="Enter";d&&be.key===" "&&(be.preventDefault(),K(!0)),Ce&&(be.preventDefault(),be.currentTarget.click()),ne.add(document,"keyup",J,!1)},[i,j,b,l,d,ne,J]),ie=N.useCallback(be=>{if(R==null||R(be),i||be.defaultPrevented||be.metaKey||!hU(be.nativeEvent)||j)return;d&&be.key===" "&&(be.preventDefault(),K(!1),be.currentTarget.click())},[d,j,i,R]),he=N.useCallback(be=>{be.button===0&&(K(!1),ne.remove(document,"mouseup",he,!1))},[ne]),fe=N.useCallback(be=>{if(be.button!==0)return;if(i){be.stopPropagation(),be.preventDefault();return}j||K(!0),be.currentTarget.focus({preventScroll:!0}),ne.add(document,"mouseup",he,!1),f==null||f(be)},[i,j,f,ne,he]),de=N.useCallback(be=>{be.button===0&&(j||K(!1),y==null||y(be))},[y,j]),ve=N.useCallback(be=>{if(i){be.preventDefault();return}k==null||k(be)},[i,k]),Te=N.useCallback(be=>{Y&&(be.preventDefault(),K(!1)),M==null||M(be)},[Y,M]),Fe=zi(t,ce);return j?{...L,ref:Fe,type:"button","aria-disabled":ge?void 0:i,disabled:ge,onClick:X,onMouseDown:f,onMouseUp:y,onKeyUp:R,onKeyDown:b,onMouseOver:k,onMouseLeave:M}:{...L,ref:Fe,role:"button","data-active":lr(Y),"aria-disabled":i?"true":void 0,tabIndex:ge?void 0:oe,onClick:X,onMouseDown:fe,onMouseUp:de,onKeyUp:ie,onKeyDown:te,onMouseOver:ve,onMouseLeave:Te}}const[JLe,QLe,ZLe,e2e]=$te(),[t2e,wC]=Ri({strict:!1,name:"MenuContext"});function Kne(n){return(n==null?void 0:n.ownerDocument)??document}function n2e(n){return Kne(n).activeElement===n}function r2e(n={}){const{id:t,closeOnSelect:i=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:y,defaultIsOpen:v,onClose:b,onOpen:R,placement:I="bottom-start",lazyBehavior:k="unmount",direction:M,computePositionOnMount:L=!1,...j}=n,z=N.useRef(null),Y=N.useRef(null),K=N.useRef(!0),ne=ZLe(),ce=N.useCallback(()=>{requestAnimationFrame(()=>{var je;(je=z.current)==null||je.focus({preventScroll:!1})})},[]),oe=N.useCallback(()=>{const je=setTimeout(()=>{var Ke,ot;if(l)(Ke=l.current)==null||Ke.focus();else if(!ne.count())(ot=z.current)==null||ot.focus({preventScroll:!1});else{const _t=ne.firstEnabled();_t&&ve(_t.index)}});Ae.current.add(je)},[ne,l]),ge=N.useCallback(()=>{const je=setTimeout(()=>{var Ke;if(!ne.count())(Ke=z.current)==null||Ke.focus({preventScroll:!1});else{const ot=ne.lastEnabled();ot&&ve(ot.index)}});Ae.current.add(je)},[ne]),X=N.useCallback(()=>{R==null||R(),d?oe():ce()},[d,oe,ce,R]),{isOpen:J,onOpen:te,onClose:ie,onToggle:he}=sh({isOpen:y,defaultIsOpen:v,onClose:b,onOpen:X});TZ({enabled:J&&a,ref:z,handler:je=>{var ot,_t,lt;const Ke=((_t=(ot=je.composedPath)==null?void 0:ot.call(je))==null?void 0:_t[0])??je.target;(lt=Y.current)!=null&&lt.contains(Ke)||ie()}});const fe=Zj({...j,enabled:J||L,placement:I,direction:M}),[de,ve]=N.useState(-1);SZ(z,{focusRef:Y,visible:J,shouldFocus:!0});const Te=yZ({isOpen:J,ref:z}),[Fe,be]=ive(t,"menu-button","menu-list"),Ce=N.useCallback(()=>{te(),ce()},[te,ce]),Ae=N.useRef(new Set([]));N.useEffect(()=>{const je=Ae.current;return()=>{je.forEach(Ke=>clearTimeout(Ke)),je.clear()}},[]),Lf(()=>{var je;J||(ve(-1),(je=z.current)==null||je.scrollTo(0,0))},[J]),Lf(()=>{J&&de===-1&&ce()},[de,J]),N.useEffect(()=>{var Ke;if(!J)return;const je=ne.item(de);(Ke=je==null?void 0:je.node)==null||Ke.focus({preventScroll:!K.current})},[ne,de,J]);const De=N.useCallback(()=>{te(),oe()},[oe,te]),Ee=N.useCallback(()=>{K.current=!0,te(),ge()},[te,ge]),Ne=N.useCallback(()=>{var lt,vt;const je=Kne(z.current),Ke=(lt=z.current)==null?void 0:lt.contains(je.activeElement);if(!(J&&!Ke))return;const _t=(vt=ne.item(de))==null?void 0:vt.node;_t==null||_t.focus({preventScroll:!K.current})},[J,de,ne]);return{openAndFocusMenu:Ce,openAndFocusFirstItem:De,openAndFocusLastItem:Ee,onTransitionEnd:Ne,unstable__animationState:Te,descendants:ne,popper:fe,buttonId:Fe,menuId:be,forceUpdate:fe.forceUpdate,orientation:"vertical",isOpen:J,onToggle:he,onOpen:te,onClose:ie,menuRef:z,buttonRef:Y,focusedIndex:de,closeOnSelect:i,closeOnBlur:a,autoSelect:d,setFocusedIndex:ve,isLazy:f,lazyBehavior:k,initialFocusRef:l,scrollIntoViewRef:K}}function i2e(n={},t=null){const i=wC(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:y}=i,v=N.useCallback(b=>{const R=b.key,k={Enter:d,ArrowDown:d,ArrowUp:f}[R];k&&(y.current=!0,b.preventDefault(),b.stopPropagation(),k(b))},[d,f,y]);return{...n,ref:zi(i.buttonRef,t,l.referenceRef),id:i.buttonId,"data-active":lr(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Ln(n.onClick,a),onKeyDown:Ln(n.onKeyDown,v)}}function PV(n){var t;return c2e(n)&&!!((t=n==null?void 0:n.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function s2e(n={},t=null){const i=wC();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:y,menuId:v,isLazy:b,lazyBehavior:R,scrollIntoViewRef:I,unstable__animationState:k}=i,M=QLe(),L=Pxe({preventDefault:K=>K.key!==" "&&PV(K.target)}),j=N.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const ne=K.key,oe={Tab:X=>X.preventDefault(),Escape:X=>{X.stopPropagation(),y()},ArrowDown:()=>{I.current=!0;const X=M.nextEnabled(a)??M.firstEnabled();X&&l(X.index)},ArrowUp:()=>{I.current=!0;const X=M.prevEnabled(a)??M.firstEnabled();X&&l(X.index)}}[ne];if(oe){K.preventDefault(),oe(K);return}const ge=L(X=>{const J=Ixe(M.values(),X,te=>{var ie;return((ie=te==null?void 0:te.node)==null?void 0:ie.textContent)??""},M.item(a));if(J){const te=M.indexOf(J.node);l(te)}});PV(K.target)&&ge(K)},[M,a,L,y,l,I]),z=N.useRef(!1);f&&(z.current=!0);const Y=SF({wasSelected:z.current,enabled:b,mode:R,isSelected:k.present});return{...n,ref:zi(d,t),children:Y?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Ln(n.onKeyDown,j)}}function o2e(n={}){const{popper:t,isOpen:i}=wC();return t.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function a2e(n={},t=null){const{onMouseEnter:i,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:y,isFocusable:v,closeOnSelect:b,type:R,...I}=n,k=wC(),{setFocusedIndex:M,focusedIndex:L,closeOnSelect:j,onClose:z,menuId:Y,scrollIntoViewRef:K}=k,ne=N.useRef(null),ce=`${Y}-menuitem-${N.useId()}`,{index:oe,register:ge}=e2e({disabled:y&&!v}),X=N.useCallback(ve=>{i==null||i(ve),!y&&(K.current=!1,M(oe))},[M,oe,y,i,K]),J=N.useCallback(ve=>{a==null||a(ve),ne.current&&!n2e(ne.current)&&X(ve)},[X,a]),te=N.useCallback(ve=>{l==null||l(ve),!y&&M(-1)},[M,y,l]),ie=N.useCallback(ve=>{d==null||d(ve),PV(ve.currentTarget)&&(b??j)&&z()},[z,d,j,b]),he=N.useCallback(ve=>{f==null||f(ve),M(oe)},[M,f,oe]),fe=oe===L,de=$ne({onClick:ie,onFocus:he,onMouseEnter:X,onMouseMove:J,onMouseLeave:te,ref:zi(ge,ne,t),isDisabled:y,isFocusable:v});return{...I,...de,type:R??de.type,id:ce,role:"menuitem",tabIndex:fe?0:-1}}function c2e(n){if(!l2e(n))return!1;const t=n.ownerDocument.defaultView??window;return n instanceof t.HTMLElement}function l2e(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[u2e,TC]=Ri({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),Hk=n=>{const{children:t}=n,i=Va("Menu",n),a=Gi(n),{direction:l}=M0(),{descendants:d,...f}=r2e({...a,direction:l}),y=N.useMemo(()=>f,[f]),{isOpen:v,onClose:b,forceUpdate:R}=y;return w.jsx(JLe,{value:d,children:w.jsx(t2e,{value:y,children:w.jsx(u2e,{value:i,children:fl(t,{isOpen:v,onClose:b,forceUpdate:R})})})})};Hk.displayName="Menu";const d2e=Wt((n,t)=>{const i=TC();return w.jsx(Ft.button,{ref:t,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),$k=Wt((n,t)=>{const{children:i,as:a,...l}=n,d=i2e(l,t),f=a||d2e;return w.jsx(f,{...d,className:Sn("chakra-menu__menu-button",n.className),children:w.jsx(Ft.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});$k.displayName="MenuButton";const qne=Wt((n,t)=>{const i=TC();return w.jsx(Ft.span,{ref:t,...n,__css:i.command,className:"chakra-menu__command"})});qne.displayName="MenuCommand";const Yne=n=>{const{className:t,children:i,...a}=n,l=TC(),d=N.Children.only(i),f=N.isValidElement(d)?N.cloneElement(d,{focusable:"false","aria-hidden":!0,className:Sn("chakra-menu__icon",d.props.className)}):null,y=Sn("chakra-menu__icon-wrapper",t);return w.jsx(Ft.span,{className:y,...a,__css:l.icon,children:f})};Yne.displayName="MenuIcon";const h2e=Wt((n,t)=>{const{type:i,...a}=n,l=TC(),d=a.as||i?i??void 0:"button",f=N.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return w.jsx(Ft.button,{ref:t,type:d,...a,__css:f})}),QR=Wt((n,t)=>{const{icon:i,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,...y}=n,v=a2e(y,t),R=i||l?w.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return w.jsxs(h2e,{...v,className:Sn("chakra-menu__menuitem",v.className),children:[i&&w.jsx(Yne,{fontSize:"0.8em",marginEnd:a,children:i}),R,l&&w.jsx(qne,{marginStart:d,children:l})]})});QR.displayName="MenuItem";const p2e={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},f2e=Ft($f.div),Kk=Wt(function(t,i){var k;const{rootProps:a,motionProps:l,...d}=t,{isOpen:f,onTransitionEnd:y,unstable__animationState:v}=wC(),b=s2e(d,i),R=o2e(a),I=TC();return w.jsx(Ft.div,{...R,__css:{zIndex:t.zIndex??((k=I.list)==null?void 0:k.zIndex)},children:w.jsx(f2e,{variants:p2e,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:Sn("chakra-menu__menu-list",b.className),onUpdate:y,onAnimationComplete:hZ(v.onComplete,b.onAnimationComplete)})})});Kk.displayName="MenuList";var m2e=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},gS=new WeakMap,L1=new WeakMap,M1={},pU=0,Xne=function(n){return n&&(n.host||Xne(n.parentNode))},g2e=function(n,t){return t.map(function(i){if(n.contains(i))return i;var a=Xne(i);return a&&n.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},_2e=function(n,t,i,a){var l=g2e(t,Array.isArray(n)?n:[n]);M1[i]||(M1[i]=new WeakMap);var d=M1[i],f=[],y=new Set,v=new Set(l),b=function(I){!I||y.has(I)||(y.add(I),b(I.parentNode))};l.forEach(b);var R=function(I){!I||v.has(I)||Array.prototype.forEach.call(I.children,function(k){if(y.has(k))R(k);else try{var M=k.getAttribute(a),L=M!==null&&M!=="false",j=(gS.get(k)||0)+1,z=(d.get(k)||0)+1;gS.set(k,j),d.set(k,z),f.push(k),j===1&&L&&L1.set(k,!0),z===1&&k.setAttribute(i,"true"),L||k.setAttribute(a,"true")}catch(Y){console.error("aria-hidden: cannot operate on ",k,Y)}})};return R(t),y.clear(),pU++,function(){f.forEach(function(I){var k=gS.get(I)-1,M=d.get(I)-1;gS.set(I,k),d.set(I,M),k||(L1.has(I)||I.removeAttribute(a),L1.delete(I)),M||I.removeAttribute(i)}),pU--,pU||(gS=new WeakMap,gS=new WeakMap,L1=new WeakMap,M1={})}},y2e=function(n,t,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=m2e(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),_2e(a,l,i,"aria-hidden")):function(){return null}},E2e=Object.defineProperty,v2e=(n,t,i)=>t in n?E2e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,S2e=(n,t,i)=>(v2e(n,t+"",i),i);class b2e{constructor(){S2e(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const i=Array.from(this.modals)[this.modals.size-1];return t===i}}const OV=new b2e;function Jne(n,t){const[i,a]=N.useState(0);return N.useEffect(()=>{const l=n.current;if(l){if(t){const d=OV.add(l);a(d)}return()=>{OV.remove(l),a(0)}}},[t,n]),i}function w2e(n){const{isOpen:t,onClose:i,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:y,onEsc:v}=n,b=N.useRef(null),R=N.useRef(null),[I,k,M]=R2e(a,"chakra-modal","chakra-modal--header","chakra-modal--body");T2e(b,t&&f);const L=Jne(b,t),j=N.useRef(null),z=N.useCallback(te=>{j.current=te.target},[]),Y=N.useCallback(te=>{te.key==="Escape"&&(te.stopPropagation(),d&&(i==null||i()),v==null||v())},[d,i,v]),[K,ne]=N.useState(!1),[ce,oe]=N.useState(!1),ge=N.useCallback((te={},ie=null)=>({role:"dialog",...te,ref:zi(ie,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?k:void 0,"aria-describedby":ce?M:void 0,onClick:Ln(te.onClick,he=>he.stopPropagation())}),[M,ce,I,k,K]),X=N.useCallback(te=>{te.stopPropagation(),j.current===te.target&&OV.isTopModal(b.current)&&(l&&(i==null||i()),y==null||y())},[i,l,y]),J=N.useCallback((te={},ie=null)=>({...te,ref:zi(ie,R),onClick:Ln(te.onClick,X),onKeyDown:Ln(te.onKeyDown,Y),onMouseDown:Ln(te.onMouseDown,z)}),[Y,z,X]);return{isOpen:t,onClose:i,headerId:k,bodyId:M,setBodyMounted:oe,setHeaderMounted:ne,dialogRef:b,overlayRef:R,getDialogProps:ge,getDialogContainerProps:J,index:L}}function T2e(n,t){const i=n.current;N.useEffect(()=>{if(!(!n.current||!t))return y2e(n.current)},[t,n,i])}function R2e(n,...t){const i=N.useId(),a=n||i;return N.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[C2e,V0]=Ri({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[I2e,Gy]=Ri({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Rs=n=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:R,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:M,animatePresenceProps:L,onCloseComplete:j}=t,z=Va("Modal",t),K={...w2e(t),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:R,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:M};return w.jsx(I2e,{value:K,children:w.jsx(C2e,{value:z,children:w.jsx(D0,{...L,onExitComplete:j,children:K.isOpen&&w.jsx(El,{...i,children:a})})})})};Rs.displayName="Modal";var gO="right-scroll-bar-position",_O="width-before-scroll-bar",A2e="with-scroll-bars-hidden",P2e="--removed-body-scroll-bar-size",Qne=rne(),fU=function(){},qk=N.forwardRef(function(n,t){var i=N.useRef(null),a=N.useState({onScrollCapture:fU,onWheelCapture:fU,onTouchMoveCapture:fU}),l=a[0],d=a[1],f=n.forwardProps,y=n.children,v=n.className,b=n.removeScrollBar,R=n.enabled,I=n.shards,k=n.sideCar,M=n.noIsolation,L=n.inert,j=n.allowPinchZoom,z=n.as,Y=z===void 0?"div":z,K=n.gapMode,ne=vC(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=k,oe=ene([i,t]),ge=mp(mp({},ne),l);return N.createElement(N.Fragment,null,R&&N.createElement(ce,{sideCar:Qne,removeScrollBar:b,shards:I,noIsolation:M,inert:L,setCallbacks:d,allowPinchZoom:!!j,lockRef:i,gapMode:K}),f?N.cloneElement(N.Children.only(y),mp(mp({},ge),{ref:oe})):N.createElement(Y,mp({},ge,{className:v,ref:oe}),y))});qk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};qk.classNames={fullWidth:_O,zeroRight:gO};var O2e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function k2e(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=O2e();return t&&n.setAttribute("nonce",t),n}function N2e(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function D2e(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var x2e=function(){var n=0,t=null;return{add:function(i){n==0&&(t=k2e())&&(N2e(t,i),D2e(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},L2e=function(){var n=x2e();return function(t,i){N.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&i])}},Zne=function(){var n=L2e(),t=function(i){var a=i.styles,l=i.dynamic;return n(a,l),null};return t},M2e={left:0,top:0,right:0,gap:0},mU=function(n){return parseInt(n||"",10)||0},U2e=function(n){var t=window.getComputedStyle(document.body),i=t[n==="padding"?"paddingLeft":"marginLeft"],a=t[n==="padding"?"paddingTop":"marginTop"],l=t[n==="padding"?"paddingRight":"marginRight"];return[mU(i),mU(a),mU(l)]},V2e=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return M2e;var t=U2e(n),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-i+t[2]-t[0])}},F2e=Zne(),qS="data-scroll-locked",j2e=function(n,t,i,a){var l=n.left,d=n.top,f=n.right,y=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(A2e,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(y,"px ").concat(a,`;
  }
  body[`).concat(qS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(y,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(gO,` {
    right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(_O,` {
    margin-right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(gO," .").concat(gO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(_O," .").concat(_O,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(qS,`] {
    `).concat(P2e,": ").concat(y,`px;
  }
`)},mX=function(){var n=parseInt(document.body.getAttribute(qS)||"0",10);return isFinite(n)?n:0},B2e=function(){N.useEffect(function(){return document.body.setAttribute(qS,(mX()+1).toString()),function(){var n=mX()-1;n<=0?document.body.removeAttribute(qS):document.body.setAttribute(qS,n.toString())}},[])},z2e=function(n){var t=n.noRelative,i=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;B2e();var d=N.useMemo(function(){return V2e(l)},[l]);return N.createElement(F2e,{styles:j2e(d,!t,l,i?"":"!important")})},kV=!1;if(typeof window<"u")try{var U1=Object.defineProperty({},"passive",{get:function(){return kV=!0,!0}});window.addEventListener("test",U1,U1),window.removeEventListener("test",U1,U1)}catch{kV=!1}var _S=kV?{passive:!1}:!1,W2e=function(n){return n.tagName==="TEXTAREA"},ere=function(n,t){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[t]!=="hidden"&&!(i.overflowY===i.overflowX&&!W2e(n)&&i[t]==="visible")},G2e=function(n){return ere(n,"overflowY")},H2e=function(n){return ere(n,"overflowX")},gX=function(n,t){var i=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=tre(n,a);if(l){var d=nre(n,a),f=d[1],y=d[2];if(f>y)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},$2e=function(n){var t=n.scrollTop,i=n.scrollHeight,a=n.clientHeight;return[t,i,a]},K2e=function(n){var t=n.scrollLeft,i=n.scrollWidth,a=n.clientWidth;return[t,i,a]},tre=function(n,t){return n==="v"?G2e(t):H2e(t)},nre=function(n,t){return n==="v"?$2e(t):K2e(t)},q2e=function(n,t){return n==="h"&&t==="rtl"?-1:1},Y2e=function(n,t,i,a,l){var d=q2e(n,window.getComputedStyle(t).direction),f=d*a,y=i.target,v=t.contains(y),b=!1,R=f>0,I=0,k=0;do{var M=nre(n,y),L=M[0],j=M[1],z=M[2],Y=j-z-d*L;(L||Y)&&tre(n,y)&&(I+=Y,k+=L),y instanceof ShadowRoot?y=y.host:y=y.parentNode}while(!v&&y!==document.body||v&&(t.contains(y)||t===y));return(R&&Math.abs(I)<1||!R&&Math.abs(k)<1)&&(b=!0),b},V1=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},_X=function(n){return[n.deltaX,n.deltaY]},yX=function(n){return n&&"current"in n?n.current:n},X2e=function(n,t){return n[0]===t[0]&&n[1]===t[1]},J2e=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},Q2e=0,yS=[];function Z2e(n){var t=N.useRef([]),i=N.useRef([0,0]),a=N.useRef(),l=N.useState(Q2e++)[0],d=N.useState(Zne)[0],f=N.useRef(n);N.useEffect(function(){f.current=n},[n]),N.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var j=tDe([n.lockRef.current],(n.shards||[]).map(yX),!0).filter(Boolean);return j.forEach(function(z){return z.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),j.forEach(function(z){return z.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=N.useCallback(function(j,z){if("touches"in j&&j.touches.length===2||j.type==="wheel"&&j.ctrlKey)return!f.current.allowPinchZoom;var Y=V1(j),K=i.current,ne="deltaX"in j?j.deltaX:K[0]-Y[0],ce="deltaY"in j?j.deltaY:K[1]-Y[1],oe,ge=j.target,X=Math.abs(ne)>Math.abs(ce)?"h":"v";if("touches"in j&&X==="h"&&ge.type==="range")return!1;var J=gX(X,ge);if(!J)return!0;if(J?oe=X:(oe=X==="v"?"h":"v",J=gX(X,ge)),!J)return!1;if(!a.current&&"changedTouches"in j&&(ne||ce)&&(a.current=oe),!oe)return!0;var te=a.current||oe;return Y2e(te,z,j,te==="h"?ne:ce)},[]),v=N.useCallback(function(j){var z=j;if(!(!yS.length||yS[yS.length-1]!==d)){var Y="deltaY"in z?_X(z):V1(z),K=t.current.filter(function(oe){return oe.name===z.type&&(oe.target===z.target||z.target===oe.shadowParent)&&X2e(oe.delta,Y)})[0];if(K&&K.should){z.cancelable&&z.preventDefault();return}if(!K){var ne=(f.current.shards||[]).map(yX).filter(Boolean).filter(function(oe){return oe.contains(z.target)}),ce=ne.length>0?y(z,ne[0]):!f.current.noIsolation;ce&&z.cancelable&&z.preventDefault()}}},[]),b=N.useCallback(function(j,z,Y,K){var ne={name:j,delta:z,target:Y,should:K,shadowParent:eMe(Y)};t.current.push(ne),setTimeout(function(){t.current=t.current.filter(function(ce){return ce!==ne})},1)},[]),R=N.useCallback(function(j){i.current=V1(j),a.current=void 0},[]),I=N.useCallback(function(j){b(j.type,_X(j),j.target,y(j,n.lockRef.current))},[]),k=N.useCallback(function(j){b(j.type,V1(j),j.target,y(j,n.lockRef.current))},[]);N.useEffect(function(){return yS.push(d),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:k}),document.addEventListener("wheel",v,_S),document.addEventListener("touchmove",v,_S),document.addEventListener("touchstart",R,_S),function(){yS=yS.filter(function(j){return j!==d}),document.removeEventListener("wheel",v,_S),document.removeEventListener("touchmove",v,_S),document.removeEventListener("touchstart",R,_S)}},[]);var M=n.removeScrollBar,L=n.inert;return N.createElement(N.Fragment,null,L?N.createElement(d,{styles:J2e(l)}):null,M?N.createElement(z2e,{gapMode:n.gapMode}):null)}function eMe(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const tMe=nDe(Qne,Z2e);var rre=N.forwardRef(function(n,t){return N.createElement(qk,mp({},n,{ref:t,sideCar:tMe}))});rre.classNames=qk.classNames;function nMe(n){const{autoFocus:t,trapFocus:i,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:y,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:R,isOpen:I}=Gy(),[k,M]=HF();N.useEffect(()=>{!k&&M&&setTimeout(M)},[k,M]);const L=Jne(a,I);return w.jsx(One,{autoFocus:t,isDisabled:!i,initialFocusRef:l,finalFocusRef:y,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:R,children:w.jsx(rre,{removeScrollBar:!b,allowPinchZoom:f,enabled:L===1&&d,forwardProps:!0,children:n.children})})}const rMe={initial:({offsetX:n,offsetY:t,transition:i,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:t,transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:t,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Dy.enter(Ny.enter,i),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:n,offsetX:t,transition:i,transitionEnd:a,reverse:l,delay:d})=>{const f={x:t,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},ZT={initial:"initial",animate:"enter",exit:"exit",variants:rMe},iMe=N.forwardRef(function(t,i){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:y=0,offsetY:v=8,transition:b,transitionEnd:R,delay:I,animatePresenceProps:k,...M}=t,L=a?l&&a:!0,j=l||a?"enter":"exit",z={offsetX:y,offsetY:v,reverse:d,transition:b,transitionEnd:R,delay:I};return w.jsx(D0,{...k,custom:z,children:L&&w.jsx($f.div,{ref:i,className:Sn("chakra-offset-slide",f),custom:z,...ZT,animate:j,...M})})});iMe.displayName="SlideFade";const sMe={exit:({reverse:n,initialScale:t,transition:i,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,l)}),enter:({transitionEnd:n,transition:t,delay:i})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??Dy.enter(Ny.enter,i),transitionEnd:n==null?void 0:n.enter})},ire={initial:"exit",animate:"enter",exit:"exit",variants:sMe},oMe=N.forwardRef(function(t,i){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:y,transition:v,transitionEnd:b,delay:R,animatePresenceProps:I,...k}=t,M=a?l&&a:!0,L=l||a?"enter":"exit",j={initialScale:f,reverse:d,transition:v,transitionEnd:b,delay:R};return w.jsx(D0,{...I,custom:j,children:M&&w.jsx($f.div,{ref:i,className:Sn("chakra-offset-slide",y),...ire,animate:L,custom:j,...k})})});oMe.displayName="ScaleFade";const aMe={slideInBottom:{...ZT,custom:{offsetY:16,reverse:!0}},slideInRight:{...ZT,custom:{offsetX:16,reverse:!0}},slideInTop:{...ZT,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...ZT,custom:{offsetX:-16,reverse:!0}},scale:{...ire,custom:{initialScale:.95,reverse:!0}},none:{}},cMe=Ft($f.section),lMe=n=>aMe[n||"none"],sre=N.forwardRef((n,t)=>{const{preset:i,motionProps:a=lMe(i),...l}=n;return w.jsx(cMe,{ref:t,...a,...l})});sre.displayName="ModalTransition";const Cs=Wt((n,t)=>{const{className:i,children:a,containerProps:l,motionProps:d,...f}=n,{getDialogProps:y,getDialogContainerProps:v}=Gy(),b=y(f,t),R=v(l),I=Sn("chakra-modal__content",i),k=V0(),M={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...k.dialog},L={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...k.dialogContainer},{motionPreset:j}=Gy();return w.jsx(nMe,{children:w.jsx(Ft.div,{...R,className:"chakra-modal__content-container",tabIndex:-1,__css:L,children:w.jsx(sre,{preset:j,motionProps:d,className:I,...b,__css:M,children:a})})})});Cs.displayName="ModalContent";const Is=Wt((n,t)=>{const{className:i,...a}=n,{bodyId:l,setBodyMounted:d}=Gy();N.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=Sn("chakra-modal__body",i),y=V0();return w.jsx(Ft.div,{ref:t,className:f,id:l,...a,__css:y.body})});Is.displayName="ModalBody";const zs=Wt((n,t)=>{const{onClick:i,className:a,...l}=n,{onClose:d}=Gy(),f=Sn("chakra-modal__close-btn",a),y=V0();return w.jsx(Rj,{ref:t,__css:y.closeButton,className:f,onClick:Ln(i,v=>{v.stopPropagation(),d()}),...l})});zs.displayName="ModalCloseButton";const oh=Wt((n,t)=>{const{className:i,...a}=n,l=Sn("chakra-modal__footer",i),d=V0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return w.jsx(Ft.footer,{ref:t,...a,__css:f,className:l})});oh.displayName="ModalFooter";const To=Wt((n,t)=>{const{className:i,...a}=n,{headerId:l,setHeaderMounted:d}=Gy();N.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=Sn("chakra-modal__header",i),y=V0(),v={flex:0,...y.header};return w.jsx(Ft.header,{ref:t,className:f,id:l,...a,__css:v})});To.displayName="ModalHeader";const uMe={enter:({transition:n,transitionEnd:t,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Dy.enter(Ny.enter,i),transitionEnd:t==null?void 0:t.enter}),exit:({transition:n,transitionEnd:t,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Dy.exit(Ny.exit,i),transitionEnd:t==null?void 0:t.exit})},ore={initial:"exit",animate:"enter",exit:"exit",variants:uMe},dMe=N.forwardRef(function(t,i){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:y,delay:v,animatePresenceProps:b,...R}=t,I=l||a?"enter":"exit",k=a?l&&a:!0,M={transition:f,transitionEnd:y,delay:v};return w.jsx(D0,{...b,custom:M,children:k&&w.jsx($f.div,{ref:i,className:Sn("chakra-fade",d),custom:M,...ore,animate:I,...R})})});dMe.displayName="Fade";const hMe=Ft($f.div),As=Wt((n,t)=>{const{className:i,transition:a,motionProps:l,...d}=n,f=Sn("chakra-modal__overlay",i),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...V0().overlay},{motionPreset:b}=Gy(),I=l||(b==="none"?{}:ore);return w.jsx(hMe,{...I,__css:v,ref:t,className:f,...d})});As.displayName="ModalOverlay";function pMe(n){const{leastDestructiveRef:t,...i}=n;return w.jsx(Rs,{...i,initialFocusRef:t})}const fMe=Wt((n,t)=>w.jsx(Cs,{ref:t,role:"alertdialog",...n})),mMe=n=>w.jsx(yn,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),gMe=n=>w.jsx(yn,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function EX(n,t,i,a){N.useEffect(()=>{if(!n.current||!a)return;const l=n.current.ownerDocument.defaultView??window,d=Array.isArray(t)?t:[t],f=new l.MutationObserver(y=>{for(const v of y)v.type==="attributes"&&v.attributeName&&d.includes(v.attributeName)&&i(v)});return f.observe(n.current,{attributes:!0,attributeFilter:d}),()=>f.disconnect()})}const _Me=50,vX=300;function yMe(n,t){const[i,a]=N.useState(!1),[l,d]=N.useState(null),[f,y]=N.useState(!0),v=N.useRef(null),b=()=>clearTimeout(v.current);sve(()=>{l==="increment"&&n(),l==="decrement"&&t()},i?_Me:null);const R=N.useCallback(()=>{f&&n(),v.current=setTimeout(()=>{y(!1),a(!0),d("increment")},vX)},[n,f]),I=N.useCallback(()=>{f&&t(),v.current=setTimeout(()=>{y(!1),a(!0),d("decrement")},vX)},[t,f]),k=N.useCallback(()=>{y(!0),a(!1),b()},[]);return N.useEffect(()=>()=>b(),[]),{up:R,down:I,stop:k,isSpinning:i}}const EMe=/^[Ee0-9+\-.]$/;function vMe(n){return EMe.test(n)}function SMe(n,t){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:t(n.key)}function bMe(n={}){const{focusInputOnChange:t=!0,clampValueOnBlur:i=!0,keepWithinRange:a=!0,min:l=Number.MIN_SAFE_INTEGER,max:d=Number.MAX_SAFE_INTEGER,step:f=1,isReadOnly:y,isDisabled:v,isRequired:b,isInvalid:R,pattern:I="[0-9]*(.[0-9]+)?",inputMode:k="decimal",allowMouseWheel:M,id:L,onChange:j,precision:z,name:Y,"aria-describedby":K,"aria-label":ne,"aria-labelledby":ce,onFocus:oe,onBlur:ge,onInvalid:X,getAriaValueText:J,isValidCharacter:te,format:ie,parse:he,...fe}=n,de=lo(oe),ve=lo(ge),Te=lo(X),Fe=lo(te??vMe),be=lo(J),Ce=HEe(n),{update:Ae,increment:De,decrement:Ee}=Ce,[Ne,je]=N.useState(!1),Ke=!(y||v),ot=N.useRef(null),_t=N.useRef(null),lt=N.useRef(null),vt=N.useRef(null),rt=N.useCallback(Rt=>Rt.split("").filter(Fe).join(""),[Fe]),bt=N.useCallback(Rt=>(he==null?void 0:he(Rt))??Rt,[he]),$t=N.useCallback(Rt=>((ie==null?void 0:ie(Rt))??Rt).toString(),[ie]);Lf(()=>{(Ce.valueAsNumber>d||Ce.valueAsNumber<l)&&(Te==null||Te("rangeOverflow",$t(Ce.value),Ce.valueAsNumber))},[Ce.valueAsNumber,Ce.value,$t,Te]),Sp(()=>{if(!ot.current)return;if(ot.current.value!=Ce.value){const Qn=bt(ot.current.value);Ce.setValue(rt(Qn))}},[bt,rt]);const ut=N.useCallback((Rt=f)=>{Ke&&De(Rt)},[De,Ke,f]),mt=N.useCallback((Rt=f)=>{Ke&&Ee(Rt)},[Ee,Ke,f]),at=yMe(ut,mt);EX(lt,"disabled",at.stop,at.isSpinning),EX(vt,"disabled",at.stop,at.isSpinning);const Vt=N.useCallback(Rt=>{if(Rt.nativeEvent.isComposing)return;const xt=bt(Rt.currentTarget.value);Ae(rt(xt)),_t.current={start:Rt.currentTarget.selectionStart,end:Rt.currentTarget.selectionEnd}},[Ae,rt,bt]),rn=N.useCallback(Rt=>{var Qn;de==null||de(Rt),_t.current&&(Rt.currentTarget.selectionStart=_t.current.start??((Qn=Rt.currentTarget.value)==null?void 0:Qn.length),Rt.currentTarget.selectionEnd=_t.current.end??Rt.currentTarget.selectionStart)},[de]),Ht=N.useCallback(Rt=>{if(Rt.nativeEvent.isComposing)return;SMe(Rt,Fe)||Rt.preventDefault();const Qn=we(Rt)*f,xt=Rt.key,Lr={ArrowUp:()=>ut(Qn),ArrowDown:()=>mt(Qn),Home:()=>Ae(l),End:()=>Ae(d)}[xt];Lr&&(Rt.preventDefault(),Lr(Rt))},[Fe,f,ut,mt,Ae,l,d]),we=Rt=>{let Qn=1;return(Rt.metaKey||Rt.ctrlKey)&&(Qn=.1),Rt.shiftKey&&(Qn=10),Qn},xe=N.useMemo(()=>{const Rt=be==null?void 0:be(Ce.value);if(Rt!=null)return Rt;const Qn=Ce.value.toString();return Qn||void 0},[Ce.value,be]),$e=N.useCallback(()=>{let Rt=Ce.value;if(Ce.value==="")return;/^[eE]/.test(Ce.value.toString())?Ce.setValue(""):(Ce.valueAsNumber<l&&(Rt=l),Ce.valueAsNumber>d&&(Rt=d),Ce.cast(Rt))},[Ce,d,l]),Pt=N.useCallback(()=>{je(!1),i&&$e()},[i,je,$e]),It=N.useCallback(()=>{t&&requestAnimationFrame(()=>{var Rt;(Rt=ot.current)==null||Rt.focus()})},[t]),wt=N.useCallback(Rt=>{Rt.preventDefault(),at.up(),It()},[It,at]),Mt=N.useCallback(Rt=>{Rt.preventDefault(),at.down(),It()},[It,at]);Iy(()=>ot.current,"wheel",Rt=>{var Ci;const xt=(((Ci=ot.current)==null?void 0:Ci.ownerDocument)??document).activeElement===ot.current;if(!M||!xt)return;Rt.preventDefault();const Xt=we(Rt)*f,Lr=Math.sign(Rt.deltaY);Lr===-1?ut(Xt):Lr===1&&mt(Xt)},{passive:!1});const vn=N.useCallback((Rt={},Qn=null)=>{const xt=v||a&&Ce.isAtMax;return{...Rt,ref:zi(Qn,lt),role:"button",tabIndex:-1,onPointerDown:Ln(Rt.onPointerDown,Xt=>{Xt.button!==0||xt||wt(Xt)}),onPointerLeave:Ln(Rt.onPointerLeave,at.stop),onPointerUp:Ln(Rt.onPointerUp,at.stop),disabled:xt,"aria-disabled":Af(xt)}},[Ce.isAtMax,a,wt,at.stop,v]),Cn=N.useCallback((Rt={},Qn=null)=>{const xt=v||a&&Ce.isAtMin;return{...Rt,ref:zi(Qn,vt),role:"button",tabIndex:-1,onPointerDown:Ln(Rt.onPointerDown,Xt=>{Xt.button!==0||xt||Mt(Xt)}),onPointerLeave:Ln(Rt.onPointerLeave,at.stop),onPointerUp:Ln(Rt.onPointerUp,at.stop),disabled:xt,"aria-disabled":Af(xt)}},[Ce.isAtMin,a,Mt,at.stop,v]),dn=N.useCallback((Rt={},Qn=null)=>({name:Y,inputMode:k,type:"text",pattern:I,"aria-labelledby":ce,"aria-label":ne,"aria-describedby":K,id:L,disabled:v,role:"spinbutton",...Rt,readOnly:Rt.readOnly??y,"aria-readonly":Rt.readOnly??y,"aria-required":Rt.required??b,required:Rt.required??b,ref:zi(ot,Qn),value:$t(Ce.value),"aria-valuemin":l,"aria-valuemax":d,"aria-valuenow":Number.isNaN(Ce.valueAsNumber)?void 0:Ce.valueAsNumber,"aria-invalid":Af(R??Ce.isOutOfRange),"aria-valuetext":xe,autoComplete:"off",autoCorrect:"off",onChange:Ln(Rt.onChange,Vt),onKeyDown:Ln(Rt.onKeyDown,Ht),onFocus:Ln(Rt.onFocus,rn,()=>je(!0)),onBlur:Ln(Rt.onBlur,ve,Pt)}),[Y,k,I,ce,ne,$t,K,L,v,b,y,R,Ce.value,Ce.valueAsNumber,Ce.isOutOfRange,l,d,xe,Vt,Ht,rn,ve,Pt]);return{value:$t(Ce.value),valueAsNumber:Ce.valueAsNumber,isFocused:Ne,isDisabled:v,isReadOnly:y,getIncrementButtonProps:vn,getDecrementButtonProps:Cn,getInputProps:dn,htmlProps:fe}}const[wMe,Yk]=Ri({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[TMe,e5]=Ri({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),Vo=Wt(function(t,i){const a=Va("NumberInput",t),l=Gi(t),d=Pj(l),{htmlProps:f,...y}=bMe(d),v=N.useMemo(()=>y,[y]);return w.jsx(TMe,{value:v,children:w.jsx(wMe,{value:a,children:w.jsx(Ft.div,{...f,ref:i,className:Sn("chakra-numberinput",t.className),__css:{position:"relative",zIndex:0,...a.root}})})})});Vo.displayName="NumberInput";const Fo=Wt(function(t,i){const a=Yk();return w.jsx(Ft.div,{"aria-hidden":!0,ref:i,...t,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...a.stepperGroup}})});Fo.displayName="NumberInputStepper";const jo=Wt(function(t,i){const{getInputProps:a}=e5(),l=a(t,i),d=Yk();return w.jsx(Ft.input,{...l,className:Sn("chakra-numberinput__field",t.className),__css:{width:"100%",...d.field}})});jo.displayName="NumberInputField";const are=Ft("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),Bo=Wt(function(t,i){const a=Yk(),{getDecrementButtonProps:l}=e5(),d=l(t,i);return w.jsx(are,{...d,__css:a.stepper,children:t.children??w.jsx(mMe,{})})});Bo.displayName="NumberDecrementStepper";const zo=Wt(function(t,i){const{getIncrementButtonProps:a}=e5(),l=a(t,i),d=Yk();return w.jsx(are,{...l,__css:d.stepper,children:t.children??w.jsx(gMe,{})})});zo.displayName="NumberIncrementStepper";const[RMe,Xk]=Ri({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[CMe,cre]=Ri({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),ES={click:"click",hover:"hover"};function IMe(n={}){const{closeOnBlur:t=!0,closeOnEsc:i=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:y,arrowShadowColor:v,trigger:b=ES.click,openDelay:R=200,closeDelay:I=200,isLazy:k,lazyBehavior:M="unmount",computePositionOnMount:L,...j}=n,{isOpen:z,onClose:Y,onOpen:K,onToggle:ne}=sh(n),[ce,oe]=N.useState(d);N.useEffect(()=>oe(d),[d]);const ge=N.useRef(null),X=N.useRef(null),J=N.useRef(null),te=N.useRef(!1),ie=N.useRef(!1);z&&(ie.current=!0);const[he,fe]=N.useState(!1),[de,ve]=N.useState(!1),Te=N.useId(),Fe=l??Te,[be,Ce,Ae,De]=["popover-trigger","popover-content","popover-header","popover-body"].map(Ht=>`${Ht}-${Fe}`),{referenceRef:Ee,getArrowProps:Ne,getPopperProps:je,getArrowInnerProps:Ke,forceUpdate:ot}=Zj({...j,enabled:z||!!L}),_t=yZ({isOpen:z,ref:J});nve({enabled:z,ref:X}),SZ(J,{focusRef:X,visible:z,shouldFocus:ce&&b===ES.click}),qEe(J,{focusRef:a,visible:z,shouldFocus:f&&b===ES.click}),TZ({enabled:z&&t,ref:J,handler(Ht){var xe;const we=((xe=Ht.composedPath)==null?void 0:xe.call(Ht)[0])??[Ht.target];F1(X.current,we)||(we&&oe(!LO(we)),Y())}});const lt=SF({wasSelected:ie.current,enabled:k,mode:M,isSelected:_t.present}),vt=N.useCallback((Ht={},we=null)=>{const xe={...Ht,style:{...Ht.style,transformOrigin:bo.transformOrigin.varRef,[bo.arrowSize.var]:y?`${y}px`:void 0,[bo.arrowShadowColor.var]:v},ref:zi(J,we),children:lt?Ht.children:null,id:Ce,tabIndex:-1,role:"dialog",onKeyDown:Ln(Ht.onKeyDown,$e=>{$e.nativeEvent.isComposing||i&&$e.key==="Escape"&&($e.preventDefault(),$e.stopPropagation(),Y())}),onBlur:Ln(Ht.onBlur,$e=>{const Pt=SX($e),It=F1(J.current,Pt),wt=F1(X.current,Pt),Mt=!It&&!wt;Pt&&oe(!LO(Pt)),z&&t&&Mt&&Y()}),"aria-labelledby":he?Ae:void 0,"aria-describedby":de?De:void 0};return b===ES.hover&&(xe.role="tooltip",xe.onMouseEnter=Ln(Ht.onMouseEnter,()=>{te.current=!0}),xe.onMouseLeave=Ln(Ht.onMouseLeave,$e=>{$e.nativeEvent.relatedTarget!==null&&(te.current=!1,setTimeout(()=>Y(),I))})),xe},[lt,Ce,he,Ae,de,De,b,i,Y,z,t,I,v,y]),rt=N.useCallback((Ht={},we=null)=>je({...Ht,style:{visibility:z?"visible":"hidden",...Ht.style}},we),[z,je]),bt=N.useCallback((Ht,we=null)=>({...Ht,ref:zi(we,ge,Ee)}),[ge,Ee]),$t=N.useRef(void 0),ut=N.useRef(void 0),mt=N.useCallback(Ht=>{ge.current==null&&Ee(Ht)},[Ee]),at=N.useCallback((Ht={},we=null)=>{const xe={...Ht,ref:zi(X,we,mt),id:be,"aria-haspopup":"dialog","aria-expanded":z,"aria-controls":Ce};return b===ES.click&&(xe.onClick=Ln(Ht.onClick,ne)),b===ES.hover&&(xe.onFocus=Ln(Ht.onFocus,()=>{$t.current===void 0&&K()}),xe.onBlur=Ln(Ht.onBlur,$e=>{const Pt=SX($e),It=!F1(J.current,Pt);z&&t&&It&&Y()}),xe.onKeyDown=Ln(Ht.onKeyDown,$e=>{$e.key==="Escape"&&Y()}),xe.onMouseEnter=Ln(Ht.onMouseEnter,()=>{te.current=!0,$t.current=window.setTimeout(()=>K(),R)}),xe.onMouseLeave=Ln(Ht.onMouseLeave,()=>{te.current=!1,$t.current&&(clearTimeout($t.current),$t.current=void 0),ut.current=window.setTimeout(()=>{te.current===!1&&Y()},I)})),xe},[be,z,Ce,b,mt,ne,K,t,Y,R,I]);N.useEffect(()=>()=>{$t.current&&clearTimeout($t.current),ut.current&&clearTimeout(ut.current)},[]);const Vt=N.useCallback((Ht={},we=null)=>({...Ht,id:Ae,ref:zi(we,xe=>{fe(!!xe)})}),[Ae]),rn=N.useCallback((Ht={},we=null)=>({...Ht,id:De,ref:zi(we,xe=>{ve(!!xe)})}),[De]);return{forceUpdate:ot,isOpen:z,onAnimationComplete:_t.onComplete,onClose:Y,getAnchorProps:bt,getArrowProps:Ne,getArrowInnerProps:Ke,getPopoverPositionerProps:rt,getPopoverProps:vt,getTriggerProps:at,getHeaderProps:Vt,getBodyProps:rn}}function F1(n,t){return n===t||(n==null?void 0:n.contains(t))}function SX(n){const t=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??t}function lre(n){const t=Va("Popover",n),{children:i,...a}=Gi(n),l=M0(),d=IMe({...a,direction:l.direction});return w.jsx(RMe,{value:d,children:w.jsx(CMe,{value:t,children:fl(i,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}lre.displayName="Popover";function ure(n){var i;const t=N.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const dre=Wt(function(t,i){const{getBodyProps:a}=Xk(),l=cre();return w.jsx(Ft.div,{...a(t,i),className:Sn("chakra-popover__body",t.className),__css:l.body})});dre.displayName="PopoverBody";function AMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const PMe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},OMe=Ft($f.section),hre=Wt(function(t,i){const{variants:a=PMe,...l}=t,{isOpen:d}=Xk();return w.jsx(OMe,{ref:i,variants:AMe(a),initial:!1,animate:d?"enter":"exit",...l})});hre.displayName="PopoverTransition";const pre=Wt(function(t,i){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:f,getPopoverPositionerProps:y,onAnimationComplete:v}=Xk(),b=cre(),R={position:"relative",display:"flex",flexDirection:"column",...b.content};return w.jsx(Ft.div,{...y(a),__css:b.popper,className:"chakra-popover__popper",children:w.jsx(hre,{...l,...f(d,i),onAnimationComplete:hZ(v,d.onAnimationComplete),className:Sn("chakra-popover__content",t.className),__css:R})})});pre.displayName="PopoverContent";function fre(n){const t=N.Children.only(n.children),{getTriggerProps:i}=Xk();return w.jsx(w.Fragment,{children:N.cloneElement(t,i(t.props,ure(t)))})}fre.displayName="PopoverTrigger";function kMe(n,t,i){return(n-t)*100/(i-t)}pC({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});pC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const NMe=pC({"0%":{left:"-40%"},"100%":{left:"100%"}}),DMe=pC({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function xMe(n){const{value:t=0,min:i,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:y="progressbar"}=n,v=kMe(t,i,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":i,"aria-valuenow":f?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:y},percent:v,value:t}}const[LMe,MMe]=Ri({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),UMe=Wt((n,t)=>{const{min:i,max:a,value:l,isIndeterminate:d,role:f,...y}=n,v=xMe({value:l,min:i,max:a,isIndeterminate:d,role:f}),R={height:"100%",...MMe().filledTrack};return w.jsx(Ft.div,{ref:t,style:{width:`${v.percent}%`,...y.style},...v.bind,...y,__css:R})}),Uy=Wt((n,t)=>{var X;const{value:i,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:y,borderRadius:v,isIndeterminate:b,"aria-label":R,"aria-labelledby":I,"aria-valuetext":k,title:M,role:L,...j}=Gi(n),z=Va("Progress",n),Y=v??((X=z.track)==null?void 0:X.borderRadius),K={animation:`${DMe} 1s linear infinite`},oe={...!b&&d&&f&&K,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${NMe} 1s ease infinite normal none running`}},ge={overflow:"hidden",position:"relative",...z.track};return w.jsx(Ft.div,{ref:t,borderRadius:Y,__css:ge,...j,children:w.jsxs(LMe,{value:z,children:[w.jsx(UMe,{"aria-label":R,"aria-labelledby":I,"aria-valuetext":k,min:a,max:l,value:i,isIndeterminate:b,css:oe,borderRadius:Y,title:M,role:L}),y]})})});Uy.displayName="Progress";const mre=Wt(function(t,i){const{children:a,placeholder:l,className:d,...f}=t;return w.jsxs(Ft.select,{...f,ref:i,className:Sn("chakra-select",d),children:[l&&w.jsx("option",{value:"",children:l}),a]})});mre.displayName="SelectField";const gre=Wt((n,t)=>{var ne;const i=Va("Select",n),{rootProps:a,placeholder:l,icon:d,color:f,height:y,h:v,minH:b,minHeight:R,iconColor:I,iconSize:k,...M}=Gi(n),[L,j]=VEe(M,rSe),z=Aj(j),Y={width:"100%",height:"fit-content",position:"relative",color:f},K={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(ne=i.field)==null?void 0:ne._focus}};return w.jsxs(Ft.div,{className:"chakra-select__wrapper",__css:Y,...L,...a,children:[w.jsx(mre,{ref:t,height:v??y,minH:b??R,placeholder:l,...z,__css:K,children:n.children}),w.jsx(_re,{"data-disabled":lr(z.disabled),...(I||f)&&{color:I||f},__css:i.icon,...k&&{fontSize:k},children:d})]})});gre.displayName="Select";const VMe=n=>w.jsx("svg",{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),FMe=Ft("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),_re=n=>{const{children:t=w.jsx(VMe,{}),...i}=n,a=N.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return w.jsx(FMe,{...i,className:"chakra-select__icon-wrapper",children:N.isValidElement(t)?a:null})};_re.displayName="SelectIcon";function gU(n){const{orientation:t,vertical:i,horizontal:a}=n;return t==="vertical"?i:a}function jMe(n){const{orientation:t,thumbPercents:i,isReversed:a}=n,l=M=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...gU({orientation:t,vertical:{bottom:`calc(${i[M]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[M]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...gU({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=i.length===1,v=[0,a?100-i[0]:i[0]],b=y?v:i;let R=b[0];!y&&a&&(R=100-R);const I=Math.abs(b[b.length-1]-b[0]),k={...f,...gU({orientation:t,vertical:a?{height:`${I}%`,top:`${R}%`}:{height:`${I}%`,bottom:`${R}%`},horizontal:a?{width:`${I}%`,right:`${R}%`}:{width:`${I}%`,left:`${R}%`}})};return{trackStyle:f,innerTrackStyle:k,rootStyle:d,getThumbStyle:l}}function BMe(n){const{isReversed:t,direction:i,orientation:a}=n;return i==="ltr"||a==="vertical"?t:!t}function zMe(n){const{min:t=0,max:i=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:y="ltr",orientation:v="horizontal",id:b,isDisabled:R,isReadOnly:I,onChangeStart:k,onChangeEnd:M,step:L=1,getAriaValueText:j,"aria-valuetext":z,"aria-label":Y,"aria-labelledby":K,name:ne,focusThumbOnChange:ce=!0,...oe}=n,ge=lo(k),X=lo(M),J=lo(j),te=BMe({isReversed:f,direction:y,orientation:v}),[ie,he]=EZ({value:l,defaultValue:d??GMe(t,i),onChange:a}),[fe,de]=N.useState(!1),[ve,Te]=N.useState(!1),Fe=!(R||I),be=(i-t)/10,Ce=L||(i-t)/100,Ae=Z1(ie,t,i),De=i-Ae+t,Ne=IK(te?De:Ae,t,i),je=v==="vertical",Ke=wZ({min:t,max:i,step:L,isDisabled:R,value:Ae,isInteractive:Fe,isReversed:te,isVertical:je,eventSource:null,focusThumbOnChange:ce,orientation:v}),ot=N.useRef(null),_t=N.useRef(null),lt=N.useRef(null),vt=N.useId(),rt=b??vt,[bt,$t]=[`slider-thumb-${rt}`,`slider-track-${rt}`],ut=N.useCallback(xt=>{var Ai;if(!ot.current)return;const Xt=Ke.current;Xt.eventSource="pointer";const Lr=ot.current.getBoundingClientRect(),{clientX:Ci,clientY:ai}=((Ai=xt.touches)==null?void 0:Ai[0])??xt,Ii=je?Lr.bottom-ai:Ci-Lr.left,ps=je?Lr.height:Lr.width;let qo=Ii/ps;te&&(qo=1-qo);let Hi=xEe(qo,Xt.min,Xt.max);return Xt.step&&(Hi=parseFloat(AK(Hi,Xt.min,Xt.step))),Hi=Z1(Hi,Xt.min,Xt.max),Hi},[je,te,Ke]),mt=N.useCallback(xt=>{const Xt=Ke.current;Xt.isInteractive&&(xt=parseFloat(AK(xt,Xt.min,Ce)),xt=Z1(xt,Xt.min,Xt.max),he(xt))},[Ce,he,Ke]),at=N.useMemo(()=>({stepUp(xt=Ce){const Xt=te?Ae-xt:Ae+xt;mt(Xt)},stepDown(xt=Ce){const Xt=te?Ae+xt:Ae-xt;mt(Xt)},reset(){mt(d||0)},stepTo(xt){mt(xt)}}),[mt,te,Ae,Ce,d]),Vt=N.useCallback(xt=>{const Xt=Ke.current,Ci={ArrowRight:()=>at.stepUp(),ArrowUp:()=>at.stepUp(),ArrowLeft:()=>at.stepDown(),ArrowDown:()=>at.stepDown(),PageUp:()=>at.stepUp(be),PageDown:()=>at.stepDown(be),Home:()=>mt(Xt.min),End:()=>mt(Xt.max)}[xt.key];Ci&&(xt.preventDefault(),xt.stopPropagation(),Ci(xt),Xt.eventSource="keyboard")},[at,mt,be,Ke]),rn=(J==null?void 0:J(Ae))??z,{getThumbStyle:Ht,rootStyle:we,trackStyle:xe,innerTrackStyle:$e}=N.useMemo(()=>{const xt=Ke.current;return jMe({isReversed:te,orientation:xt.orientation,thumbPercents:[Ne]})},[te,Ne,Ke]),Pt=N.useCallback(()=>{Ke.current.focusThumbOnChange&&setTimeout(()=>{var Xt;return(Xt=_t.current)==null?void 0:Xt.focus()})},[Ke]);Lf(()=>{const xt=Ke.current;Pt(),xt.eventSource==="keyboard"&&(X==null||X(xt.value))},[Ae,X]);function It(xt){const Xt=ut(xt);Xt!=null&&Xt!==Ke.current.value&&he(Xt)}wve(lt,{onPanSessionStart(xt){const Xt=Ke.current;Xt.isInteractive&&(de(!0),Pt(),It(xt),ge==null||ge(Xt.value))},onPanSessionEnd(){const xt=Ke.current;xt.isInteractive&&(de(!1),X==null||X(xt.value))},onPan(xt){Ke.current.isInteractive&&It(xt)}});const wt=N.useCallback((xt={},Xt=null)=>({...xt,...oe,ref:zi(Xt,lt),tabIndex:-1,"aria-disabled":Af(R),"data-focused":lr(ve),style:{...xt.style,...we}}),[oe,R,ve,we]),Mt=N.useCallback((xt={},Xt=null)=>({...xt,ref:zi(Xt,ot),id:$t,"data-disabled":lr(R),style:{...xt.style,...xe}}),[R,$t,xe]),vn=N.useCallback((xt={},Xt=null)=>({...xt,ref:Xt,style:{...xt.style,...$e}}),[$e]),Cn=N.useCallback((xt={},Xt=null)=>({...xt,ref:zi(Xt,_t),role:"slider",tabIndex:Fe?0:void 0,id:bt,"data-active":lr(fe),"aria-valuetext":rn,"aria-valuemin":t,"aria-valuemax":i,"aria-valuenow":Ae,"aria-orientation":v,"aria-disabled":Af(R),"aria-readonly":Af(I),"aria-label":Y,"aria-labelledby":Y?void 0:K,style:{...xt.style,...Ht(0)},onKeyDown:Ln(xt.onKeyDown,Vt),onFocus:Ln(xt.onFocus,()=>Te(!0)),onBlur:Ln(xt.onBlur,()=>Te(!1))}),[Fe,bt,fe,rn,t,i,Ae,v,R,I,Y,K,Ht,Vt]),dn=N.useCallback((xt,Xt=null)=>{const Lr=!(xt.value<t||xt.value>i),Ci=Ae>=xt.value,ai=IK(xt.value,t,i),Ii={position:"absolute",pointerEvents:"none",...WMe({orientation:v,vertical:{bottom:te?`${100-ai}%`:`${ai}%`},horizontal:{left:te?`${100-ai}%`:`${ai}%`}})};return{...xt,ref:Xt,role:"presentation","aria-hidden":!0,"data-disabled":lr(R),"data-invalid":lr(!Lr),"data-highlighted":lr(Ci),style:{...xt.style,...Ii}}},[R,te,i,t,v,Ae]),Rt=N.useCallback((xt={},Xt=null)=>({...xt,ref:Xt,type:"hidden",value:Ae,name:ne}),[ne,Ae]);return{state:{value:Ae,isFocused:ve,isDragging:fe},actions:at,getRootProps:wt,getTrackProps:Mt,getInnerTrackProps:vn,getThumbProps:Cn,getMarkerProps:dn,getInputProps:Rt}}function WMe(n){const{orientation:t,vertical:i,horizontal:a}=n;return t==="vertical"?i:a}function GMe(n,t){return t<n?n:n+(t-n)/2}const[HMe,Jk]=Ri({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[$Me,Qk]=Ri({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),YS=Wt((n,t)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=Va("Slider",i),l=Gi(i),{direction:d}=M0();l.direction=d;const{getInputProps:f,getRootProps:y,...v}=zMe(l),b=y(),R=f({},t);return w.jsx(HMe,{value:v,children:w.jsx($Me,{value:a,children:w.jsxs(Ft.div,{...b,className:Sn("chakra-slider",i.className),__css:a.container,children:[i.children,w.jsx("input",{...R})]})})})});YS.displayName="Slider";const XS=Wt((n,t)=>{const{getThumbProps:i}=Jk(),a=Qk(),l=i(n,t);return w.jsx(Ft.div,{...l,className:Sn("chakra-slider__thumb",n.className),__css:a.thumb})});XS.displayName="SliderThumb";const JS=Wt((n,t)=>{const{getTrackProps:i}=Jk(),a=Qk(),l=i(n,t);return w.jsx(Ft.div,{...l,className:Sn("chakra-slider__track",n.className),__css:a.track})});JS.displayName="SliderTrack";const QS=Wt((n,t)=>{const{getInnerTrackProps:i}=Jk(),a=Qk(),l=i(n,t);return w.jsx(Ft.div,{...l,className:Sn("chakra-slider__filled-track",n.className),__css:a.filledTrack})});QS.displayName="SliderFilledTrack";const KMe=Wt((n,t)=>{const{getMarkerProps:i}=Jk(),a=Qk(),l=i(n,t);return w.jsx(Ft.div,{...l,className:Sn("chakra-slider__marker",n.className),__css:a.mark})});KMe.displayName="SliderMark";const ZS=Ft("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});ZS.displayName="Spacer";const yre=n=>w.jsx(Ft.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});yre.displayName="StackItem";function qMe(n){const{spacing:t,direction:i}=n,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":wF(i,l=>a[l])}}const t5=Wt((n,t)=>{const{isInline:i,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:y,children:v,divider:b,className:R,shouldWrapChildren:I,...k}=n,M=i?"row":a??"column",L=N.useMemo(()=>qMe({spacing:f,direction:M}),[f,M]),j=!!b,z=!I&&!j,Y=N.useMemo(()=>{const ne=Rk(v);return z?ne:ne.map((ce,oe)=>{const ge=typeof ce.key<"u"?ce.key:oe,X=oe+1===ne.length,te=I?w.jsx(yre,{children:ce},ge):ce;if(!j)return te;const ie=N.cloneElement(b,{__css:L}),he=X?null:ie;return w.jsxs(N.Fragment,{children:[te,he]},ge)})},[b,L,j,z,I,v]),K=Sn("chakra-stack",R);return w.jsx(Ft.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:M,flexWrap:y,gap:j?void 0:f,className:K,...k,children:Y})});t5.displayName="Stack";const jn=Wt((n,t)=>w.jsx(t5,{align:"center",...n,direction:"row",ref:t}));jn.displayName="HStack";const qr=Wt((n,t)=>w.jsx(t5,{align:"center",...n,direction:"column",ref:t}));qr.displayName="VStack";const eh=Wt(function(t,i){const a=Va("Switch",t),{spacing:l="0.5rem",children:d,...f}=Gi(t),{getIndicatorProps:y,getInputProps:v,getCheckboxProps:b,getRootProps:R,getLabelProps:I}=WNe(f),k=N.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),M=N.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),L=N.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return w.jsxs(Ft.label,{...R(),className:Sn("chakra-switch",t.className),__css:k,children:[w.jsx("input",{className:"chakra-switch__input",...v({},i)}),w.jsx(Ft.span,{...b(),className:"chakra-switch__track",__css:M,children:w.jsx(Ft.span,{__css:a.thumb,className:"chakra-switch__thumb",...y()})}),d&&w.jsx(Ft.span,{className:"chakra-switch__label",...I(),__css:L,children:d})]})});eh.displayName="Switch";const[YMe,XMe,JMe,QMe]=$te();function ZMe(n){const{defaultIndex:t,onChange:i,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:y="horizontal",direction:v="ltr",...b}=n,[R,I]=N.useState(t??0),[k,M]=EZ({defaultValue:t??0,value:a,onChange:i});N.useEffect(()=>{a!=null&&I(a)},[a]);const L=JMe(),j=N.useId();return{id:`tabs-${n.id??j}`,selectedIndex:k,focusedIndex:R,setSelectedIndex:M,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:f,orientation:y,descendants:L,direction:v,htmlProps:b}}const[eUe,Zk]=Ri({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function tUe(n){const{focusedIndex:t,orientation:i,direction:a}=Zk(),l=XMe(),d=N.useCallback(f=>{const y=()=>{var ne;const K=l.nextEnabled(t);K&&((ne=K.node)==null||ne.focus())},v=()=>{var ne;const K=l.prevEnabled(t);K&&((ne=K.node)==null||ne.focus())},b=()=>{var ne;const K=l.firstEnabled();K&&((ne=K.node)==null||ne.focus())},R=()=>{var ne;const K=l.lastEnabled();K&&((ne=K.node)==null||ne.focus())},I=i==="horizontal",k=i==="vertical",M=f.key,L=a==="ltr"?"ArrowLeft":"ArrowRight",j=a==="ltr"?"ArrowRight":"ArrowLeft",Y={[L]:()=>I&&v(),[j]:()=>I&&y(),ArrowDown:()=>k&&y(),ArrowUp:()=>k&&v(),Home:b,End:R}[M];Y&&(f.preventDefault(),Y(f))},[l,t,i,a]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Ln(n.onKeyDown,d)}}function nUe(n){const{isDisabled:t=!1,isFocusable:i=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:y,selectedIndex:v}=Zk(),{index:b,register:R}=QMe({disabled:t&&!i}),I=b===v,k=()=>{l(b)},M=()=>{y(b),!d&&!(t&&i)&&l(b)};return{...$ne({...a,ref:zi(R,n.ref),isDisabled:t,isFocusable:i,onClick:Ln(n.onClick,k)}),id:Ere(f,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":vre(f,b),onFocus:t?void 0:Ln(n.onFocus,M)}}const[rUe,iUe]=Ri({});function sUe(n){const t=Zk(),{id:i,selectedIndex:a}=t,d=Rk(n.children).map((f,y)=>N.createElement(rUe,{key:f.key??y,value:{isSelected:y===a,id:vre(i,y),tabId:Ere(i,y),selectedIndex:a}},f));return{...n,children:d}}function oUe(n){const{children:t,...i}=n,{isLazy:a,lazyBehavior:l}=Zk(),{isSelected:d,id:f,tabId:y}=iUe(),v=N.useRef(!1);d&&(v.current=!0);const b=SF({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...i,children:b?t:null,role:"tabpanel","aria-labelledby":y,hidden:!d,id:f}}function Ere(n,t){return`${n}--tab-${t}`}function vre(n,t){return`${n}--tabpanel-${t}`}const[aUe,eN]=Ri({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),y0=Wt(function(t,i){const a=Va("Tabs",t),{children:l,className:d,...f}=Gi(t),{htmlProps:y,descendants:v,...b}=ZMe(f),R=N.useMemo(()=>b,[b]),{isFitted:I,...k}=y,M={position:"relative",...a.root};return w.jsx(YMe,{value:v,children:w.jsx(eUe,{value:R,children:w.jsx(aUe,{value:a,children:w.jsx(Ft.div,{className:Sn("chakra-tabs",d),ref:i,...k,__css:M,children:l})})})})});y0.displayName="Tabs";const Na=Wt(function(t,i){const a=eN(),l=nUe({...t,ref:i}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return w.jsx(Ft.button,{...l,className:Sn("chakra-tabs__tab",t.className),__css:d})});Na.displayName="Tab";const E0=Wt(function(t,i){const a=tUe({...t,ref:i}),l=eN(),d={display:"flex",...l.tablist};return w.jsx(Ft.div,{...a,className:Sn("chakra-tabs__tablist",t.className),__css:d})});E0.displayName="TabList";const Pc=Wt(function(t,i){const a=oUe({...t,ref:i}),l=eN();return w.jsx(Ft.div,{outline:"0",...a,className:Sn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});Pc.displayName="TabPanel";const ZR=Wt(function(t,i){const a=sUe(t),l=eN();return w.jsx(Ft.div,{...a,width:"100%",ref:i,className:Sn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});ZR.displayName="TabPanels";const[cUe,Sre]=Ri({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),bre=Wt((n,t)=>{const i=Va("Tag",n),a=Gi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return w.jsx(cUe,{value:i,children:w.jsx(Ft.span,{ref:t,...a,__css:l})})});bre.displayName="Tag";const wre=Wt((n,t)=>{const i=Sre();return w.jsx(Ft.span,{ref:t,noOfLines:1,...n,__css:i.label})});wre.displayName="TagLabel";const lUe=Wt((n,t)=>w.jsx(yn,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...n}));lUe.displayName="TagLeftIcon";const uUe=Wt((n,t)=>w.jsx(yn,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...n}));uUe.displayName="TagRightIcon";const Tre=n=>w.jsx(yn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:w.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Tre.displayName="TagCloseIcon";const Rre=Wt((n,t)=>{const{isDisabled:i,children:a,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Sre().closeButton};return w.jsx(Ft.button,{ref:t,"aria-label":"close",...l,type:"button",disabled:i,__css:f,children:a||w.jsx(Tre,{})})});Rre.displayName="TagCloseButton";const dUe=["h","minH","height","minHeight"],Cre=Wt((n,t)=>{const i=nd("Textarea",n),{className:a,rows:l,...d}=Gi(n),f=Aj(d),y=l?k0(i,dUe):i;return w.jsx(Ft.textarea,{ref:t,rows:l,...f,className:Sn("chakra-textarea",a),__css:y})});Cre.displayName="Textarea";function hUe(n,t){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[t])??i}function pUe(n,t){const i=l=>({...t,...l,position:hUe((l==null?void 0:l.position)??(t==null?void 0:t.position),n)}),a=l=>{const d=i(l),f=Wte(d);return fp.notify(f,d)};return a.update=(l,d)=>{fp.update(l,i(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(y=>a.update(f,{status:"success",duration:5e3,...fl(d.success,y)})).catch(y=>a.update(f,{status:"error",duration:5e3,...fl(d.error,y)}))},a.closeAll=fp.closeAll,a.close=fp.close,a.isActive=fp.isActive,a}function uc(n){const{theme:t}=jte(),i=fNe();return N.useMemo(()=>pUe(t.direction,{...i,...n}),[n,t.direction,i])}const fUe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},NV=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},yO=n=>{var t,i;return((i=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:i.defaultView)||window};function mUe(n={}){const{openDelay:t=0,closeDelay:i=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:y=!0,onOpen:v,onClose:b,placement:R,id:I,isOpen:k,defaultIsOpen:M,arrowSize:L=10,arrowShadowColor:j,arrowPadding:z,modifiers:Y,isDisabled:K,gutter:ne,offset:ce,direction:oe,...ge}=n,{isOpen:X,onOpen:J,onClose:te}=sh({isOpen:k,defaultIsOpen:M,onOpen:v,onClose:b}),{referenceRef:ie,getPopperProps:he,getArrowInnerProps:fe,getArrowProps:de}=Zj({enabled:X,placement:R,arrowPadding:z,modifiers:Y,gutter:ne,offset:ce,direction:oe}),ve=N.useId(),Fe=`tooltip-${I??ve}`,be=N.useRef(null),Ce=N.useRef(void 0),Ae=N.useCallback(()=>{Ce.current&&(clearTimeout(Ce.current),Ce.current=void 0)},[]),De=N.useRef(void 0),Ee=N.useCallback(()=>{De.current&&(clearTimeout(De.current),De.current=void 0)},[]),Ne=N.useCallback(()=>{Ee(),te()},[te,Ee]),je=gUe(be,Ne),Ke=N.useCallback(()=>{if(!K&&!Ce.current){X&&je();const ut=yO(be);Ce.current=ut.setTimeout(J,t)}},[je,K,X,J,t]),ot=N.useCallback(()=>{Ae();const ut=yO(be);De.current=ut.setTimeout(Ne,i)},[i,Ne,Ae]),_t=N.useCallback(()=>{X&&a&&ot()},[a,ot,X]),lt=N.useCallback(()=>{X&&f&&ot()},[f,ot,X]),vt=N.useCallback(ut=>{X&&ut.key==="Escape"&&ot()},[X,ot]);Iy(()=>NV(be),"keydown",y?vt:void 0),Iy(()=>{if(!d)return null;const ut=be.current;if(!ut)return null;const mt=_Z(ut);return mt.localName==="body"?yO(be):mt},"scroll",()=>{X&&d&&Ne()},{passive:!0,capture:!0}),N.useEffect(()=>{K&&(Ae(),X&&te())},[K,X,te,Ae]),N.useEffect(()=>()=>{Ae(),Ee()},[Ae,Ee]),Iy(()=>be.current,"pointerleave",ot);const rt=N.useCallback((ut={},mt=null)=>({...ut,ref:zi(be,mt,ie),onPointerEnter:Ln(ut.onPointerEnter,Vt=>{Vt.pointerType!=="touch"&&Ke()}),onClick:Ln(ut.onClick,_t),onPointerDown:Ln(ut.onPointerDown,lt),onFocus:Ln(ut.onFocus,Ke),onBlur:Ln(ut.onBlur,ot),"aria-describedby":X?Fe:void 0}),[Ke,ot,lt,X,Fe,_t,ie]),bt=N.useCallback((ut={},mt=null)=>he({...ut,style:{...ut.style,[bo.arrowSize.var]:L?`${L}px`:void 0,[bo.arrowShadowColor.var]:j}},mt),[he,L,j]),$t=N.useCallback((ut={},mt=null)=>{const at={...ut.style,position:"relative",transformOrigin:bo.transformOrigin.varRef};return{ref:mt,...ge,...ut,id:Fe,role:"tooltip",style:at}},[ge,Fe]);return{isOpen:X,show:Ke,hide:ot,getTriggerProps:rt,getTooltipProps:$t,getTooltipPositionerProps:bt,getArrowProps:de,getArrowInnerProps:fe}}const _U="chakra-ui:close-tooltip";function gUe(n,t){return N.useEffect(()=>{const i=NV(n);return i.addEventListener(_U,t),()=>i.removeEventListener(_U,t)},[t,n]),()=>{const i=NV(n),a=yO(n);i.dispatchEvent(new a.CustomEvent(_U))}}const _Ue=Ft($f.div),Nf=Wt((n,t)=>{const i=nd("Tooltip",n),a=Gi(n),l=M0(),{children:d,label:f,shouldWrapChildren:y,"aria-label":v,hasArrow:b,bg:R,portalProps:I,background:k,backgroundColor:M,bgColor:L,motionProps:j,animatePresenceProps:z,...Y}=a,K=k??M??R??L;if(K){i.bg=K;const ie=pSe(l,"colors",K);i[bo.arrowBg.var]=ie}const ne=mUe({...Y,direction:l.direction}),ce=!N.isValidElement(d)||y;let oe;if(ce)oe=w.jsx(Ft.span,{display:"inline-block",tabIndex:0,...ne.getTriggerProps(),children:d});else{const ie=N.Children.only(d);oe=N.cloneElement(ie,ne.getTriggerProps(ie.props,ure(ie)))}const ge=!!v,X=ne.getTooltipProps({},t),J=ge?k0(X,["role","id"]):X,te=gZ(X,["role","id"]);return f?w.jsxs(w.Fragment,{children:[oe,w.jsx(D0,{...z,children:ne.isOpen&&w.jsx(El,{...I,children:w.jsx(Ft.div,{...ne.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:w.jsxs(_Ue,{variants:fUe,initial:"exit",animate:"enter",exit:"exit",...j,...J,__css:i,children:[f,ge&&w.jsx(Ft.span,{srOnly:!0,...te,children:v}),b&&w.jsx(Ft.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:w.jsx(Ft.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):w.jsx(w.Fragment,{children:d})});Nf.displayName="Tooltip";const eC=Wt(function(t,i){const a=nd("Heading",t),{className:l,...d}=Gi(t);return w.jsx(Ft.h2,{ref:i,className:Sn("chakra-heading",t.className),...d,__css:a})});eC.displayName="Heading";const it=Wt(function(t,i){const a=nd("Text",t),{className:l,align:d,decoration:f,casing:y,...v}=Gi(t),b=Ck({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return w.jsx(Ft.p,{ref:i,className:Sn("chakra-text",t.className),...b,...v,__css:a})});it.displayName="Text";const Ire=Wt(function(t,i){const{spacing:a="0.5rem",spacingX:l,spacingY:d,children:f,justify:y,direction:v,align:b,className:R,shouldWrapChildren:I,...k}=t,M=N.useMemo(()=>I?N.Children.map(f,(L,j)=>w.jsx(n5,{children:L},j)):f,[f,I]);return w.jsx(Ft.div,{ref:i,className:Sn("chakra-wrap",R),...k,children:w.jsx(Ft.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:b,flexDirection:v,listStyleType:"none",gap:a,columnGap:l,rowGap:d,padding:"0"},children:M})})});Ire.displayName="Wrap";const n5=Wt(function(t,i){const{className:a,...l}=t;return w.jsx(Ft.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:Sn("chakra-wrap__listitem",a),...l})});n5.displayName="WrapItem";const yUe="modulepreload",EUe=function(n,t){return new URL(n,t).href},bX={},yU=function(t,i,a){let l=Promise.resolve();if(i&&i.length>0){let f=function(R){return Promise.all(R.map(I=>Promise.resolve(I).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};const y=document.getElementsByTagName("link"),v=document.querySelector("meta[property=csp-nonce]"),b=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));l=f(i.map(R=>{if(R=EUe(R,a),R in bX)return;bX[R]=!0;const I=R.endsWith(".css"),k=I?'[rel="stylesheet"]':"";if(!!a)for(let j=y.length-1;j>=0;j--){const z=y[j];if(z.href===R&&(!I||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${R}"]${k}`))return;const L=document.createElement("link");if(L.rel=I?"stylesheet":yUe,I||(L.as="script"),L.crossOrigin="",L.href=R,b&&L.setAttribute("nonce",b),document.head.appendChild(L),I)return new Promise((j,z)=>{L.addEventListener("load",j),L.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${R}`)))})}))}function d(f){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=f,window.dispatchEvent(y),!y.defaultPrevented)throw f}return l.then(f=>{for(const y of f||[])y.status==="rejected"&&d(y.reason);return t().catch(d)})},j1=()=>{const n=new Date,t=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${t}:${i}:${a}.${l}`},G={log:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${j1()}] `,...t)}},error:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${j1()}] `,...t)}},warn:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${j1()}]`,...t)}},trace:n=>{console.trace(`[TRACE] [${j1()}] ${n}`)}};async function vUe(n){let t;try{switch(n){case"default":t=await yU(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await yU(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(i){return G.error("Failed to load theme:",i),t=await yU(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const SUe=()=>{};var wX={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Are=function(n){const t=[];let i=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?t[i++]=l:l<2048?(t[i++]=l>>6|192,t[i++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),t[i++]=l>>18|240,t[i++]=l>>12&63|128,t[i++]=l>>6&63|128,t[i++]=l&63|128):(t[i++]=l>>12|224,t[i++]=l>>6&63|128,t[i++]=l&63|128)}return t},bUe=function(n){const t=[];let i=0,a=0;for(;i<n.length;){const l=n[i++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[i++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[i++],f=n[i++],y=n[i++],v=((l&7)<<18|(d&63)<<12|(f&63)<<6|y&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[i++],f=n[i++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return t.join("")},Pre={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],f=l+1<n.length,y=f?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,R=d>>2,I=(d&3)<<4|y>>4;let k=(y&15)<<2|b>>6,M=b&63;v||(M=64,f||(k=64)),a.push(i[R],i[I],i[k],i[M])}return a.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Are(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):bUe(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const i=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=i[n.charAt(l++)],y=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,d==null||y==null||b==null||I==null)throw new wUe;const k=d<<2|y>>4;if(a.push(k),b!==64){const M=y<<4&240|b>>2;if(a.push(M),I!==64){const L=b<<6&192|I;a.push(L)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class wUe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const TUe=function(n){const t=Are(n);return Pre.encodeByteArray(t,!0)},XO=function(n){return TUe(n).replace(/\./g,"")},Ore=function(n){try{return Pre.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RUe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CUe=()=>RUe().__FIREBASE_DEFAULTS__,IUe=()=>{if(typeof process>"u"||typeof wX>"u")return;const n=wX.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},AUe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&Ore(n[1]);return t&&JSON.parse(t)},tN=()=>{try{return SUe()||CUe()||IUe()||AUe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},kre=n=>{var t,i;return(i=(t=tN())===null||t===void 0?void 0:t.emulatorHosts)===null||i===void 0?void 0:i[n]},r5=n=>{const t=kre(n);if(!t)return;const i=t.lastIndexOf(":");if(i<=0||i+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(i+1),10);return t[0]==="["?[t.substring(1,i-1),a]:[t.substring(0,i),a]},Nre=()=>{var n;return(n=tN())===null||n===void 0?void 0:n.config},Dre=n=>{var t;return(t=tN())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PUe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}wrapCallback(t){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(i):t(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xre(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=t||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[XO(JSON.stringify(i)),XO(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function OUe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(lc())}function kUe(){var n;const t=(n=tN())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function NUe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function DUe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function xUe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function LUe(){const n=lc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function MUe(){return!kUe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function UUe(){try{return typeof indexedDB=="object"}catch{return!1}}function VUe(){return new Promise((n,t)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(i){t(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FUe="FirebaseError";class dh extends Error{constructor(t,i,a){super(i),this.code=t,this.customData=a,this.name=FUe,Object.setPrototypeOf(this,dh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,RC.prototype.create)}}class RC{constructor(t,i,a){this.service=t,this.serviceName=i,this.errors=a}create(t,...i){const a=i[0]||{},l=`${this.service}/${t}`,d=this.errors[t],f=d?jUe(d,a):"Error",y=`${this.serviceName}: ${f} (${l}).`;return new dh(l,y,a)}}function jUe(n,t){return n.replace(BUe,(i,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const BUe=/\{\$([^}]+)}/g;function zUe(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function Ff(n,t){if(n===t)return!0;const i=Object.keys(n),a=Object.keys(t);for(const l of i){if(!a.includes(l))return!1;const d=n[l],f=t[l];if(TX(d)&&TX(f)){if(!Ff(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function TX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CC(n){const t=[];for(const[i,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(i)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function eR(n){const t={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function tR(n){const t=n.indexOf("?");if(!t)return"";const i=n.indexOf("#",t);return n.substring(t,i>0?i:void 0)}function WUe(n,t){const i=new GUe(n,t);return i.subscribe.bind(i)}class GUe{constructor(t,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(i=>{i.next(t)})}error(t){this.forEachObserver(i=>{i.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,i,a){let l;if(t===void 0&&i===void 0&&a===void 0)throw new Error("Missing Observer.");HUe(t,["next","error","complete"])?l=t:l={next:t,error:i,complete:a},l.next===void 0&&(l.next=EU),l.error===void 0&&(l.error=EU),l.complete===void 0&&(l.complete=EU);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,t)}sendOne(t,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{i(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function HUe(n,t){if(typeof n!="object"||n===null)return!1;for(const i of t)if(i in n&&typeof n[i]=="function")return!0;return!1}function EU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wi(n){return n&&n._delegate?n._delegate:n}class jf{constructor(t,i,a){this.name=t,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Ue{constructor(t,i){this.name=t,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const i=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(i)){const a=new PUe;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(t){var i;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(i=t==null?void 0:t.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(qUe(t))try{this.getOrInitializeService({instanceIdentifier:yy})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=yy){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...t.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=yy){return this.instances.has(t)}getOptions(t=yy){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:i={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[d,f]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(d);a===y&&f.resolve(l)}return l}onInit(t,i){var a;const l=this.normalizeInstanceIdentifier(i),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&t(f,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(t,i)}catch{}}getOrInitializeService({instanceIdentifier:t,options:i={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:KUe(t),options:i}),this.instances.set(t,a),this.instancesOptions.set(t,i),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=yy){return this.component?this.component.multipleInstances?t:yy:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function KUe(n){return n===yy?void 0:n}function qUe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YUe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const i=this.getProvider(t.name);if(i.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);i.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const i=new $Ue(t,this);return this.providers.set(t,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Fr||(Fr={}));const XUe={debug:Fr.DEBUG,verbose:Fr.VERBOSE,info:Fr.INFO,warn:Fr.WARN,error:Fr.ERROR,silent:Fr.SILENT},JUe=Fr.INFO,QUe={[Fr.DEBUG]:"log",[Fr.VERBOSE]:"log",[Fr.INFO]:"info",[Fr.WARN]:"warn",[Fr.ERROR]:"error"},ZUe=(n,t,...i)=>{if(t<n.logLevel)return;const a=new Date().toISOString(),l=QUe[t];if(l)console[l](`[${a}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class i5{constructor(t){this.name=t,this._logLevel=JUe,this._logHandler=ZUe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Fr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?XUe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Fr.DEBUG,...t),this._logHandler(this,Fr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Fr.VERBOSE,...t),this._logHandler(this,Fr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Fr.INFO,...t),this._logHandler(this,Fr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Fr.WARN,...t),this._logHandler(this,Fr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Fr.ERROR,...t),this._logHandler(this,Fr.ERROR,...t)}}const eVe=(n,t)=>t.some(i=>n instanceof i);let RX,CX;function tVe(){return RX||(RX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nVe(){return CX||(CX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Lre=new WeakMap,DV=new WeakMap,Mre=new WeakMap,vU=new WeakMap,s5=new WeakMap;function rVe(n){const t=new Promise((i,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",f)},d=()=>{i(Sg(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",f)});return t.then(i=>{i instanceof IDBCursor&&Lre.set(i,n)}).catch(()=>{}),s5.set(t,n),t}function iVe(n){if(DV.has(n))return;const t=new Promise((i,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",f),n.removeEventListener("abort",f)},d=()=>{i(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",f),n.addEventListener("abort",f)});DV.set(n,t)}let xV={get(n,t,i){if(n instanceof IDBTransaction){if(t==="done")return DV.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Mre.get(n);if(t==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Sg(n[t])},set(n,t,i){return n[t]=i,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function sVe(n){xV=n(xV)}function oVe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...i){const a=n.call(SU(this),t,...i);return Mre.set(a,t.sort?t.sort():[t]),Sg(a)}:nVe().includes(n)?function(...t){return n.apply(SU(this),t),Sg(Lre.get(this))}:function(...t){return Sg(n.apply(SU(this),t))}}function aVe(n){return typeof n=="function"?oVe(n):(n instanceof IDBTransaction&&iVe(n),eVe(n,tVe())?new Proxy(n,xV):n)}function Sg(n){if(n instanceof IDBRequest)return rVe(n);if(vU.has(n))return vU.get(n);const t=aVe(n);return t!==n&&(vU.set(n,t),s5.set(t,n)),t}const SU=n=>s5.get(n);function cVe(n,t,{blocked:i,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(n,t),y=Sg(f);return a&&f.addEventListener("upgradeneeded",v=>{a(Sg(f.result),v.oldVersion,v.newVersion,Sg(f.transaction),v)}),i&&f.addEventListener("blocked",v=>i(v.oldVersion,v.newVersion,v)),y.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),y}const lVe=["get","getKey","getAll","getAllKeys","count"],uVe=["put","add","delete","clear"],bU=new Map;function IX(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(bU.get(t))return bU.get(t);const i=t.replace(/FromIndex$/,""),a=t!==i,l=uVe.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||lVe.includes(i)))return;const d=async function(f,...y){const v=this.transaction(f,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(y.shift())),(await Promise.all([b[i](...y),l&&v.done]))[0]};return bU.set(t,d),d}sVe(n=>({...n,get:(t,i,a)=>IX(t,i)||n.get(t,i,a),has:(t,i)=>!!IX(t,i)||n.has(t,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dVe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(hVe(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function hVe(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const LV="@firebase/app",AX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bf=new i5("@firebase/app"),pVe="@firebase/app-compat",fVe="@firebase/analytics-compat",mVe="@firebase/analytics",gVe="@firebase/app-check-compat",_Ve="@firebase/app-check",yVe="@firebase/auth",EVe="@firebase/auth-compat",vVe="@firebase/database",SVe="@firebase/data-connect",bVe="@firebase/database-compat",wVe="@firebase/functions",TVe="@firebase/functions-compat",RVe="@firebase/installations",CVe="@firebase/installations-compat",IVe="@firebase/messaging",AVe="@firebase/messaging-compat",PVe="@firebase/performance",OVe="@firebase/performance-compat",kVe="@firebase/remote-config",NVe="@firebase/remote-config-compat",DVe="@firebase/storage",xVe="@firebase/storage-compat",LVe="@firebase/firestore",MVe="@firebase/vertexai",UVe="@firebase/firestore-compat",VVe="firebase",FVe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MV="[DEFAULT]",jVe={[LV]:"fire-core",[pVe]:"fire-core-compat",[mVe]:"fire-analytics",[fVe]:"fire-analytics-compat",[_Ve]:"fire-app-check",[gVe]:"fire-app-check-compat",[yVe]:"fire-auth",[EVe]:"fire-auth-compat",[vVe]:"fire-rtdb",[SVe]:"fire-data-connect",[bVe]:"fire-rtdb-compat",[wVe]:"fire-fn",[TVe]:"fire-fn-compat",[RVe]:"fire-iid",[CVe]:"fire-iid-compat",[IVe]:"fire-fcm",[AVe]:"fire-fcm-compat",[PVe]:"fire-perf",[OVe]:"fire-perf-compat",[kVe]:"fire-rc",[NVe]:"fire-rc-compat",[DVe]:"fire-gcs",[xVe]:"fire-gcs-compat",[LVe]:"fire-fst",[UVe]:"fire-fst-compat",[MVe]:"fire-vertex","fire-js":"fire-js",[VVe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JO=new Map,BVe=new Map,UV=new Map;function PX(n,t){try{n.container.addComponent(t)}catch(i){Bf.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,i)}}function Ag(n){const t=n.name;if(UV.has(t))return Bf.debug(`There were multiple attempts to register component ${t}.`),!1;UV.set(t,n);for(const i of JO.values())PX(i,n);for(const i of BVe.values())PX(i,n);return!0}function IC(n,t){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(t)}function hl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zVe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},bg=new RC("app","Firebase",zVe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WVe{constructor(t,i,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new jf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw bg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy=FVe;function Ure(n,t={}){let i=n;typeof t!="object"&&(t={name:t});const a=Object.assign({name:MV,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw bg.create("bad-app-name",{appName:String(l)});if(i||(i=Nre()),!i)throw bg.create("no-options");const d=JO.get(l);if(d){if(Ff(i,d.options)&&Ff(a,d.config))return d;throw bg.create("duplicate-app",{appName:l})}const f=new YUe(l);for(const v of UV.values())f.addComponent(v);const y=new WVe(i,a,f);return JO.set(l,y),y}function nN(n=MV){const t=JO.get(n);if(!t&&n===MV&&Nre())return Ure();if(!t)throw bg.create("no-app",{appName:n});return t}function Ju(n,t,i){var a;let l=(a=jVe[n])!==null&&a!==void 0?a:n;i&&(l+=`-${i}`);const d=l.match(/\s|\//),f=t.match(/\s|\//);if(d||f){const y=[`Unable to register library "${l}" with version "${t}":`];d&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&y.push("and"),f&&y.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Bf.warn(y.join(" "));return}Ag(new jf(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GVe="firebase-heartbeat-database",HVe=1,tC="firebase-heartbeat-store";let wU=null;function Vre(){return wU||(wU=cVe(GVe,HVe,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(tC)}catch(i){console.warn(i)}}}}).catch(n=>{throw bg.create("idb-open",{originalErrorMessage:n.message})})),wU}async function $Ve(n){try{const i=(await Vre()).transaction(tC),a=await i.objectStore(tC).get(Fre(n));return await i.done,a}catch(t){if(t instanceof dh)Bf.warn(t.message);else{const i=bg.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Bf.warn(i.message)}}}async function OX(n,t){try{const a=(await Vre()).transaction(tC,"readwrite");await a.objectStore(tC).put(t,Fre(n)),await a.done}catch(i){if(i instanceof dh)Bf.warn(i.message);else{const a=bg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Bf.warn(a.message)}}}function Fre(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KVe=1024,qVe=30;class YVe{constructor(t){this.container=t,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new JVe(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=kX();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>qVe){const f=QVe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Bf.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=kX(),{heartbeatsToSend:a,unsentEntries:l}=XVe(this._heartbeatsCache.heartbeats),d=XO(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(i){return Bf.warn(i),""}}}function kX(){return new Date().toISOString().substring(0,10)}function XVe(n,t=KVe){const i=[];let a=n.slice();for(const l of n){const d=i.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),NX(i)>t){d.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),NX(i)>t){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class JVe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return UUe()?VUe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await $Ve(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return OX(this.app,{lastSentHeartbeatDate:(i=t.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return OX(this.app,{lastSentHeartbeatDate:(i=t.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function NX(n){return XO(JSON.stringify({version:2,heartbeats:n})).length}function QVe(n){if(n.length===0)return-1;let t=0,i=n[0].date;for(let a=1;a<n.length;a++)n[a].date<i&&(i=n[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZVe(n){Ag(new jf("platform-logger",t=>new dVe(t),"PRIVATE")),Ag(new jf("heartbeat",t=>new YVe(t),"PRIVATE")),Ju(LV,AX,n),Ju(LV,AX,"esm2017"),Ju("fire-js","")}ZVe("");function jre(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const eFe=jre,Bre=new RC("auth","Firebase",jre());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QO=new i5("@firebase/auth");function tFe(n,...t){QO.logLevel<=Fr.WARN&&QO.warn(`Auth (${Qy}): ${n}`,...t)}function EO(n,...t){QO.logLevel<=Fr.ERROR&&QO.error(`Auth (${Qy}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(n,...t){throw o5(n,...t)}function Ip(n,...t){return o5(n,...t)}function zre(n,t,i){const a=Object.assign(Object.assign({},eFe()),{[t]:i});return new RC("auth","Firebase",a).create(t,{appName:n.name})}function Df(n){return zre(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function o5(n,...t){if(typeof n!="string"){const i=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(i,...a)}return Bre.create(n,...t)}function Yn(n,t,...i){if(!n)throw o5(t,...i)}function Rf(n){const t="INTERNAL ASSERTION FAILED: "+n;throw EO(t),new Error(t)}function zf(n,t){n||Rf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function nFe(){return DX()==="http:"||DX()==="https:"}function DX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rFe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nFe()||DUe()||"connection"in navigator)?navigator.onLine:!0}function iFe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(t,i){this.shortDelay=t,this.longDelay=i,zf(i>t,"Short delay should be less than long delay!"),this.isMobile=OUe()||xUe()}get(){return rFe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a5(n,t){zf(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wre{static initialize(t,i,a){this.fetchImpl=t,i&&(this.headersImpl=i),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sFe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oFe=new AC(3e4,6e4);function Kf(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function qf(n,t,i,a,l={}){return Gre(n,l,async()=>{let d={},f={};a&&(t==="GET"?f=a:d={body:JSON.stringify(a)});const y=CC(Object.assign({key:n.config.apiKey},f)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:t,headers:v},d);return NUe()||(b.referrerPolicy="no-referrer"),Wre.fetch()(Hre(n,n.config.apiHost,i,y),b)})}async function Gre(n,t,i){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},sFe),t);try{const l=new cFe(n),d=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw B1(n,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const y=d.ok?f.errorMessage:f.error.message,[v,b]=y.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw B1(n,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw B1(n,"email-already-in-use",f);if(v==="USER_DISABLED")throw B1(n,"user-disabled",f);const R=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw zre(n,R,b);ah(n,R)}}catch(l){if(l instanceof dh)throw l;ah(n,"network-request-failed",{message:String(l)})}}async function PC(n,t,i,a,l={}){const d=await qf(n,t,i,a,l);return"mfaPendingCredential"in d&&ah(n,"multi-factor-auth-required",{_serverResponse:d}),d}function Hre(n,t,i,a){const l=`${t}${i}?${a}`;return n.config.emulator?a5(n.config,l):`${n.config.apiScheme}://${l}`}function aFe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class cFe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((i,a)=>{this.timer=setTimeout(()=>a(Ip(this.auth,"network-request-failed")),oFe.get())})}}function B1(n,t,i){const a={appName:n.name};i.email&&(a.email=i.email),i.phoneNumber&&(a.phoneNumber=i.phoneNumber);const l=Ip(n,t,a);return l.customData._tokenResponse=i,l}function xX(n){return n!==void 0&&n.enterprise!==void 0}class lFe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===t)return aFe(i.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function uFe(n,t){return qf(n,"GET","/v2/recaptchaConfig",Kf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dFe(n,t){return qf(n,"POST","/v1/accounts:delete",t)}async function $re(n,t){return qf(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RR(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function hFe(n,t=!1){const i=Wi(n),a=await i.getIdToken(t),l=c5(a);Yn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:RR(TU(l.auth_time)),issuedAtTime:RR(TU(l.iat)),expirationTime:RR(TU(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function TU(n){return Number(n)*1e3}function c5(n){const[t,i,a]=n.split(".");if(t===void 0||i===void 0||a===void 0)return EO("JWT malformed, contained fewer than 3 sections"),null;try{const l=Ore(i);return l?JSON.parse(l):(EO("Failed to decode base64 JWT payload"),null)}catch(l){return EO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function LX(n){const t=c5(n);return Yn(t,"internal-error"),Yn(typeof t.exp<"u","internal-error"),Yn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nC(n,t,i=!1){if(i)return t;try{return await t}catch(a){throw a instanceof dh&&pFe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function pFe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fFe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var i;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const i=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FV{constructor(t,i){this.createdAt=t,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=RR(this.lastLoginAt),this.creationTime=RR(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZO(n){var t;const i=n.auth,a=await n.getIdToken(),l=await nC(n,$re(i,{idToken:a}));Yn(l==null?void 0:l.users.length,i,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const f=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?Kre(d.providerUserInfo):[],y=gFe(n.providerData,f),v=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(y!=null&&y.length),R=v?b:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:y,metadata:new FV(d.createdAt,d.lastLoginAt),isAnonymous:R};Object.assign(n,I)}async function mFe(n){const t=Wi(n);await ZO(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function gFe(n,t){return[...n.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function Kre(n){return n.map(t=>{var{providerId:i}=t,a=vC(t,["providerId"]);return{providerId:i,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _Fe(n,t){const i=await Gre(n,{},async()=>{const a=CC({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,f=Hre(n,l,"/v1/token",`key=${d}`),y=await n._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",Wre.fetch()(f,{method:"POST",headers:y,body:a})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function yFe(n,t){return qf(n,"POST","/v2/accounts:revokeToken",Kf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Yn(t.idToken,"internal-error"),Yn(typeof t.idToken<"u","internal-error"),Yn(typeof t.refreshToken<"u","internal-error");const i="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):LX(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,i)}updateFromIdToken(t){Yn(t.length!==0,"internal-error");const i=LX(t);this.updateTokensAndExpiration(t,null,i)}async getToken(t,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Yn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,i){const{accessToken:a,refreshToken:l,expiresIn:d}=await _Fe(t,i);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,i,a){this.refreshToken=i||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,i){const{refreshToken:a,accessToken:l,expirationTime:d}=i,f=new e0;return a&&(Yn(typeof a=="string","internal-error",{appName:t}),f.refreshToken=a),l&&(Yn(typeof l=="string","internal-error",{appName:t}),f.accessToken=l),d&&(Yn(typeof d=="number","internal-error",{appName:t}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new e0,this.toJSON())}_performRefresh(){return Rf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(n,t){Yn(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class Cf{constructor(t){var{uid:i,auth:a,stsTokenManager:l}=t,d=vC(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fFe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new FV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const i=await nC(this,this.stsTokenManager.getToken(this.auth,t));return Yn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(t){return hFe(this,t)}reload(){return mFe(this)}_assign(t){this!==t&&(Yn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(i=>Object.assign({},i)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const i=new Cf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(t){Yn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,i=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),i&&await ZO(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hl(this.auth.app))return Promise.reject(Df(this.auth));const t=await this.getIdToken();return await nC(this,dFe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,i){var a,l,d,f,y,v,b,R;const I=(a=i.displayName)!==null&&a!==void 0?a:void 0,k=(l=i.email)!==null&&l!==void 0?l:void 0,M=(d=i.phoneNumber)!==null&&d!==void 0?d:void 0,L=(f=i.photoURL)!==null&&f!==void 0?f:void 0,j=(y=i.tenantId)!==null&&y!==void 0?y:void 0,z=(v=i._redirectEventId)!==null&&v!==void 0?v:void 0,Y=(b=i.createdAt)!==null&&b!==void 0?b:void 0,K=(R=i.lastLoginAt)!==null&&R!==void 0?R:void 0,{uid:ne,emailVerified:ce,isAnonymous:oe,providerData:ge,stsTokenManager:X}=i;Yn(ne&&X,t,"internal-error");const J=e0.fromJSON(this.name,X);Yn(typeof ne=="string",t,"internal-error"),og(I,t.name),og(k,t.name),Yn(typeof ce=="boolean",t,"internal-error"),Yn(typeof oe=="boolean",t,"internal-error"),og(M,t.name),og(L,t.name),og(j,t.name),og(z,t.name),og(Y,t.name),og(K,t.name);const te=new Cf({uid:ne,auth:t,email:k,emailVerified:ce,displayName:I,isAnonymous:oe,photoURL:L,phoneNumber:M,tenantId:j,stsTokenManager:J,createdAt:Y,lastLoginAt:K});return ge&&Array.isArray(ge)&&(te.providerData=ge.map(ie=>Object.assign({},ie))),z&&(te._redirectEventId=z),te}static async _fromIdTokenResponse(t,i,a=!1){const l=new e0;l.updateFromServerResponse(i);const d=new Cf({uid:i.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await ZO(d),d}static async _fromGetAccountInfoResponse(t,i,a){const l=i.users[0];Yn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Kre(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),y=new e0;y.updateFromIdToken(a);const v=new Cf({uid:l.localId,auth:t,stsTokenManager:y,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new FV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MX=new Map;function If(n){zf(n instanceof Function,"Expected a class definition");let t=MX.get(n);return t?(zf(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,MX.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qre{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,i){this.storage[t]=i}async _get(t){const i=this.storage[t];return i===void 0?null:i}async _remove(t){delete this.storage[t]}_addListener(t,i){}_removeListener(t,i){}}qre.type="NONE";const UX=qre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vO(n,t,i){return`firebase:${n}:${t}:${i}`}class t0{constructor(t,i,a){this.persistence=t,this.auth=i,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=vO(this.userKey,l.apiKey,d),this.fullPersistenceKey=vO("persistence",l.apiKey,d),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Cf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,i,a="authUser"){if(!i.length)return new t0(If(UX),t,a);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||If(UX);const f=vO(a,t.config.apiKey,t.name);let y=null;for(const b of i)try{const R=await b._get(f);if(R){const I=Cf._fromJSON(t,R);b!==d&&(y=I),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new t0(d,t,a):(d=v[0],y&&await d._set(f,y.toJSON()),await Promise.all(i.map(async b=>{if(b!==d)try{await b._remove(f)}catch{}})),new t0(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VX(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Qre(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Yre(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(eie(t))return"Blackberry";if(tie(t))return"Webos";if(Xre(t))return"Safari";if((t.includes("chrome/")||Jre(t))&&!t.includes("edge/"))return"Chrome";if(Zre(t))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(i);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Yre(n=lc()){return/firefox\//i.test(n)}function Xre(n=lc()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Jre(n=lc()){return/crios\//i.test(n)}function Qre(n=lc()){return/iemobile/i.test(n)}function Zre(n=lc()){return/android/i.test(n)}function eie(n=lc()){return/blackberry/i.test(n)}function tie(n=lc()){return/webos/i.test(n)}function l5(n=lc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function EFe(n=lc()){var t;return l5(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function vFe(){return LUe()&&document.documentMode===10}function nie(n=lc()){return l5(n)||Zre(n)||tie(n)||eie(n)||/windows phone/i.test(n)||Qre(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rie(n,t=[]){let i;switch(n){case"Browser":i=VX(lc());break;case"Worker":i=`${VX(lc())}-${n}`;break;default:i=n}const a=t.length?t.join(","):"FirebaseCore-web";return`${i}/JsCore/${Qy}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SFe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,i){const a=d=>new Promise((f,y)=>{try{const v=t(d);f(v)}catch(v){y(v)}});a.onAbort=i,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const i=[];try{for(const a of this.queue)await a(t),a.onAbort&&i.push(a.onAbort)}catch(a){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bFe(n,t={}){return qf(n,"GET","/v2/passwordPolicy",Kf(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wFe=6;class TFe{constructor(t){var i,a,l,d;const f=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=f.minPasswordLength)!==null&&i!==void 0?i:wFe,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var i,a,l,d,f,y;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(i=v.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(y=v.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),v}validatePasswordLengthOptions(t,i){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(i.meetsMinPasswordLength=t.length>=a),l&&(i.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,i,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RFe{constructor(t,i,a,l){this.app=t,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new FX(this),this.idTokenSubscription=new FX(this),this.beforeStateQueue=new SFe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Bre,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,i){return i&&(this._popupRedirectResolver=If(i)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await t0.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const i=await $re(this,{idToken:t}),a=await Cf._fromGetAccountInfoResponse(this,i,t);await this.directlySetCurrentUser(a)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var i;if(hl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(y,y))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,y=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!f||f===y)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Yn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(t){try{await ZO(t)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=iFe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(hl(this.app))return Promise.reject(Df(this));const i=t?Wi(t):null;return i&&Yn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(t,i=!1){if(!this._deleted)return t&&Yn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return hl(this.app)?Promise.reject(Df(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return hl(this.app)?Promise.reject(Df(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(If(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await bFe(this),i=new TFe(t);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new RC("auth","Firebase",t())}onAuthStateChanged(t,i,a){return this.registerStateListener(this.authStateSubscription,t,i,a)}beforeAuthStateChanged(t,i){return this.beforeStateQueue.pushCallback(t,i)}onIdTokenChanged(t,i,a){return this.registerStateListener(this.idTokenSubscription,t,i,a)}authStateReady(){return new Promise((t,i)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},i)}})}async revokeAccessToken(t){if(this.currentUser){const i=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:i};this.tenantId!=null&&(a.tenantId=this.tenantId),await yFe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,i){const a=await this.getOrInitRedirectPersistenceManager(i);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const i=t&&If(t)||this._popupRedirectResolver;Yn(i,this,"argument-error"),this.redirectPersistenceManager=await t0.create(this,[If(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var i,a;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(i=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,i,a,l){if(this._deleted)return()=>{};const d=typeof i=="function"?i:i.next.bind(i);let f=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Yn(y,this,"internal-error"),y.then(()=>{f||d(this.currentUser)}),typeof i=="function"){const v=t.addObserver(i,a,l);return()=>{f=!0,v()}}else{const v=t.addObserver(i);return()=>{f=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Yn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=rie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(i["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var t;if(hl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return i!=null&&i.error&&tFe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function jg(n){return Wi(n)}class FX{constructor(t){this.auth=t,this.observer=null,this.addObserver=WUe(i=>this.observer=i)}get next(){return Yn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function CFe(n){rN=n}function iie(n){return rN.loadJS(n)}function IFe(){return rN.recaptchaEnterpriseScript}function AFe(){return rN.gapiScript}function PFe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class OFe{constructor(){this.enterprise=new kFe}ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}class kFe{ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}const NFe="recaptcha-enterprise",sie="NO_RECAPTCHA";class DFe{constructor(t){this.type=NFe,this.auth=jg(t)}async verify(t="verify",i=!1){async function a(d){if(!i){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,y)=>{uFe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const b=new lFe(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,f(b.siteKey)}}).catch(v=>{y(v)})})}function l(d,f,y){const v=window.grecaptcha;xX(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(b=>{f(b)}).catch(()=>{f(sie)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new OFe().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(y=>{if(!i&&xX(window.grecaptcha))l(y,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=IFe();v.length!==0&&(v+=y),iie(v).then(()=>{l(y,d,f)}).catch(b=>{f(b)})}}).catch(y=>{f(y)})})}}async function jX(n,t,i,a=!1,l=!1){const d=new DFe(n);let f;if(l)f=sie;else try{f=await d.verify(i)}catch{f=await d.verify(i,!0)}const y=Object.assign({},t);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const v=y.phoneEnrollmentInfo.phoneNumber,b=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const v=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return a?Object.assign(y,{captchaResp:f}):Object.assign(y,{captchaResponse:f}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function ek(n,t,i,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await jX(n,t,i,i==="getOobCode");return a(n,f)}else return a(n,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await jX(n,t,i,i==="getOobCode");return a(n,y)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xFe(n,t){const i=IC(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),d=i.getOptions();if(Ff(d,t??{}))return l;ah(l,"already-initialized")}return i.initialize({options:t})}function LFe(n,t){const i=(t==null?void 0:t.persistence)||[],a=(Array.isArray(i)?i:[i]).map(If);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function MFe(n,t,i){const a=jg(n);Yn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=oie(t),{host:f,port:y}=UFe(t),v=y===null?"":`:${y}`,b={url:`${d}//${f}${v}/`},R=Object.freeze({host:f,port:y,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Yn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Yn(Ff(b,a.config.emulator)&&Ff(R,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=R,a.settings.appVerificationDisabledForTesting=!0,VFe()}function oie(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function UFe(n){const t=oie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!i)return{host:"",port:null};const a=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:BX(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:BX(f)}}}function BX(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function VFe(){function n(){const t=document.createElement("p"),i=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(t,i){this.providerId=t,this.signInMethod=i}toJSON(){return Rf("not implemented")}_getIdTokenResponse(t){return Rf("not implemented")}_linkToIdToken(t,i){return Rf("not implemented")}_getReauthenticationResolver(t){return Rf("not implemented")}}async function FFe(n,t){return qf(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jFe(n,t){return PC(n,"POST","/v1/accounts:signInWithPassword",Kf(n,t))}async function aie(n,t){return qf(n,"POST","/v1/accounts:sendOobCode",Kf(n,t))}async function BFe(n,t){return aie(n,t)}async function zFe(n,t){return aie(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WFe(n,t){return PC(n,"POST","/v1/accounts:signInWithEmailLink",Kf(n,t))}async function GFe(n,t){return PC(n,"POST","/v1/accounts:signInWithEmailLink",Kf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rC extends u5{constructor(t,i,a,l=null){super("password",a),this._email=t,this._password=i,this._tenantId=l}static _fromEmailAndPassword(t,i){return new rC(t,i,"password")}static _fromEmailAndCode(t,i,a=null){return new rC(t,i,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ek(t,i,"signInWithPassword",jFe);case"emailLink":return WFe(t,{email:this._email,oobCode:this._password});default:ah(t,"internal-error")}}async _linkToIdToken(t,i){switch(this.signInMethod){case"password":const a={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ek(t,a,"signUpPassword",FFe);case"emailLink":return GFe(t,{idToken:i,email:this._email,oobCode:this._password});default:ah(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n0(n,t){return PC(n,"POST","/v1/accounts:signInWithIdp",Kf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HFe="http://localhost";class Hy extends u5{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const i=new Hy(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(i.idToken=t.idToken),t.accessToken&&(i.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(i.nonce=t.nonce),t.pendingToken&&(i.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(i.accessToken=t.oauthToken,i.secret=t.oauthTokenSecret):ah("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=i,d=vC(i,["providerId","signInMethod"]);if(!a||!l)return null;const f=new Hy(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(t){const i=this.buildRequest();return n0(t,i)}_linkToIdToken(t,i){const a=this.buildRequest();return a.idToken=i,n0(t,a)}_getReauthenticationResolver(t){const i=this.buildRequest();return i.autoCreate=!1,n0(t,i)}buildRequest(){const t={requestUri:HFe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),t.postBody=CC(i)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $Fe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function KFe(n){const t=eR(tR(n)).link,i=t?eR(tR(t)).deep_link_id:null,a=eR(tR(n)).deep_link_id;return(a?eR(tR(a)).link:null)||a||i||t||n}class d5{constructor(t){var i,a,l,d,f,y;const v=eR(tR(t)),b=(i=v.apiKey)!==null&&i!==void 0?i:null,R=(a=v.oobCode)!==null&&a!==void 0?a:null,I=$Fe((l=v.mode)!==null&&l!==void 0?l:null);Yn(b&&R&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=R,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=v.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(y=v.tenantId)!==null&&y!==void 0?y:null}static parseLink(t){const i=KFe(t);try{return new d5(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(){this.providerId=F0.PROVIDER_ID}static credential(t,i){return rC._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){const a=d5.parseLink(i);return Yn(a,"argument-error"),rC._fromEmailAndCode(t,a.code,a.tenantId)}}F0.PROVIDER_ID="password";F0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";F0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cie{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC extends cie{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg extends OC{constructor(){super("facebook.com")}static credential(t){return Hy._fromParams({providerId:dg.PROVIDER_ID,signInMethod:dg.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return dg.credentialFromTaggedObject(t)}static credentialFromError(t){return dg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return dg.credential(t.oauthAccessToken)}catch{return null}}}dg.FACEBOOK_SIGN_IN_METHOD="facebook.com";dg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg extends OC{constructor(){super("google.com"),this.addScope("profile")}static credential(t,i){return Hy._fromParams({providerId:hg.PROVIDER_ID,signInMethod:hg.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:i})}static credentialFromResult(t){return hg.credentialFromTaggedObject(t)}static credentialFromError(t){return hg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:i,oauthAccessToken:a}=t;if(!i&&!a)return null;try{return hg.credential(i,a)}catch{return null}}}hg.GOOGLE_SIGN_IN_METHOD="google.com";hg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg extends OC{constructor(){super("github.com")}static credential(t){return Hy._fromParams({providerId:pg.PROVIDER_ID,signInMethod:pg.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return pg.credentialFromTaggedObject(t)}static credentialFromError(t){return pg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return pg.credential(t.oauthAccessToken)}catch{return null}}}pg.GITHUB_SIGN_IN_METHOD="github.com";pg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg extends OC{constructor(){super("twitter.com")}static credential(t,i){return Hy._fromParams({providerId:fg.PROVIDER_ID,signInMethod:fg.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:i})}static credentialFromResult(t){return fg.credentialFromTaggedObject(t)}static credentialFromError(t){return fg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:i,oauthTokenSecret:a}=t;if(!i||!a)return null;try{return fg.credential(i,a)}catch{return null}}}fg.TWITTER_SIGN_IN_METHOD="twitter.com";fg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qFe(n,t){return PC(n,"POST","/v1/accounts:signUp",Kf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,i,a,l=!1){const d=await Cf._fromIdTokenResponse(t,a,l),f=zX(a);return new $y({user:d,providerId:f,_tokenResponse:a,operationType:i})}static async _forOperation(t,i,a){await t._updateTokensIfNecessary(a,!0);const l=zX(a);return new $y({user:t,providerId:l,_tokenResponse:a,operationType:i})}}function zX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk extends dh{constructor(t,i,a,l){var d;super(i.code,i.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,tk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:i.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,i,a,l){return new tk(t,i,a,l)}}function lie(n,t,i,a){return(t==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?tk._fromErrorAndOperation(n,d,t,a):d})}async function YFe(n,t,i=!1){const a=await nC(n,t._linkToIdToken(n.auth,await n.getIdToken()),i);return $y._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XFe(n,t,i=!1){const{auth:a}=n;if(hl(a.app))return Promise.reject(Df(a));const l="reauthenticate";try{const d=await nC(n,lie(a,l,t,n),i);Yn(d.idToken,a,"internal-error");const f=c5(d.idToken);Yn(f,a,"internal-error");const{sub:y}=f;return Yn(n.uid===y,a,"user-mismatch"),$y._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&ah(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uie(n,t,i=!1){if(hl(n.app))return Promise.reject(Df(n));const a="signIn",l=await lie(n,a,t),d=await $y._fromIdTokenResponse(n,a,l);return i||await n._updateCurrentUser(d.user),d}async function JFe(n,t){return uie(jg(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function die(n){const t=jg(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function QFe(n,t,i){const a=jg(n);await ek(a,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",zFe)}async function ZFe(n,t,i){if(hl(n.app))return Promise.reject(Df(n));const a=jg(n),f=await ek(a,{returnSecureToken:!0,email:t,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",qFe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&die(n),v}),y=await $y._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(y.user),y}function eje(n,t,i){return hl(n.app)?Promise.reject(Df(n)):JFe(Wi(n),F0.credential(t,i)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&die(n),a})}async function hie(n,t){const i=Wi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await BFe(i.auth,l);d!==n.email&&await n.reload()}function tje(n,t,i,a){return Wi(n).onIdTokenChanged(t,i,a)}function nje(n,t,i){return Wi(n).beforeAuthStateChanged(t,i)}function rje(n,t,i,a){return Wi(n).onAuthStateChanged(t,i,a)}function ije(n){return Wi(n).signOut()}const nk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pie{constructor(t,i){this.storageRetriever=t,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(nk,"1"),this.storage.removeItem(nk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,i){return this.storage.setItem(t,JSON.stringify(i)),Promise.resolve()}_get(t){const i=this.storage.getItem(t);return Promise.resolve(i?JSON.parse(i):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sje=1e3,oje=10;class fie extends pie{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nie(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const i of Object.keys(this.listeners)){const a=this.storage.getItem(i),l=this.localCache[i];a!==l&&t(i,l,a)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((f,y,v)=>{this.notifyListeners(f,v)});return}const a=t.key;i?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!i&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);vFe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,oje):l()}notifyListeners(t,i){this.localCache[t]=i;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:a}),!0)})},sje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,i){await super._set(t,i),this.localCache[t]=JSON.stringify(i)}async _get(t){const i=await super._get(t);return this.localCache[t]=JSON.stringify(i),i}async _remove(t){await super._remove(t),delete this.localCache[t]}}fie.type="LOCAL";const aje=fie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mie extends pie{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}mie.type="SESSION";const gie=mie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cje(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const i=this.receivers.find(l=>l.isListeningto(t));if(i)return i;const a=new iN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const i=t,{eventId:a,eventType:l,data:d}=i.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;i.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const y=Array.from(f).map(async b=>b(i.origin,d)),v=await cje(y);i.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}iN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h5(n="",t=10){let i="";for(let a=0;a<t;a++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lje{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,i,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((y,v)=>{const b=h5("",20);l.port1.start();const R=setTimeout(()=>{v(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const k=I;if(k.data.eventId===b)switch(k.data.status){case"ack":clearTimeout(R),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),y(k.data.response);break;default:clearTimeout(R),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:t,eventId:b,data:i},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ap(){return window}function uje(n){Ap().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _ie(){return typeof Ap().WorkerGlobalScope<"u"&&typeof Ap().importScripts=="function"}async function dje(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hje(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function pje(){return _ie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yie="firebaseLocalStorageDb",fje=1,rk="firebaseLocalStorage",Eie="fbase_key";class kC{constructor(t){this.request=t}toPromise(){return new Promise((t,i)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function sN(n,t){return n.transaction([rk],t?"readwrite":"readonly").objectStore(rk)}function mje(){const n=indexedDB.deleteDatabase(yie);return new kC(n).toPromise()}function jV(){const n=indexedDB.open(yie,fje);return new Promise((t,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(rk,{keyPath:Eie})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(rk)?t(a):(a.close(),await mje(),t(await jV()))})})}async function WX(n,t,i){const a=sN(n,!0).put({[Eie]:t,value:i});return new kC(a).toPromise()}async function gje(n,t){const i=sN(n,!1).get(t),a=await new kC(i).toPromise();return a===void 0?null:a.value}function GX(n,t){const i=sN(n,!0).delete(t);return new kC(i).toPromise()}const _je=800,yje=3;class vie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await jV(),this.db)}async _withRetries(t){let i=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(i++>yje)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _ie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=iN._getInstance(pje()),this.receiver._subscribe("keyChanged",async(t,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(t,i)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await dje(),!this.activeServiceWorker)return;this.sender=new lje(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((i=a[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||hje()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await jV();return await WX(t,nk,"1"),await GX(t,nk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,i){return this._withPendingWrite(async()=>(await this._withRetries(a=>WX(a,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)))}async _get(t){const i=await this._withRetries(a=>gje(a,t));return this.localCache[t]=i,i}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(i=>GX(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=sN(l,!1).getAll();return new kC(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const i=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(t,i){this.localCache[t]=i;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_je)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}vie.type="LOCAL";const Eje=vie;new AC(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vje(n,t){return t?If(t):(Yn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5 extends u5{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return n0(t,this._buildIdpRequest())}_linkToIdToken(t,i){return n0(t,this._buildIdpRequest(i))}_getReauthenticationResolver(t){return n0(t,this._buildIdpRequest())}_buildIdpRequest(t){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(i.idToken=t),i}}function Sje(n){return uie(n.auth,new p5(n),n.bypassAuthState)}function bje(n){const{auth:t,user:i}=n;return Yn(i,t,"internal-error"),XFe(i,new p5(n),n.bypassAuthState)}async function wje(n){const{auth:t,user:i}=n;return Yn(i,t,"internal-error"),YFe(i,new p5(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sie{constructor(t,i,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(t,i)=>{this.pendingPromise={resolve:t,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:i,sessionId:a,postBody:l,tenantId:d,error:f,type:y}=t;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:i,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(v))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Sje;case"linkViaPopup":case"linkViaRedirect":return wje;case"reauthViaPopup":case"reauthViaRedirect":return bje;default:ah(this.auth,"internal-error")}}resolve(t){zf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){zf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tje=new AC(2e3,1e4);class US extends Sie{constructor(t,i,a,l,d){super(t,i,l,d),this.provider=a,this.authWindow=null,this.pollId=null,US.currentPopupAction&&US.currentPopupAction.cancel(),US.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Yn(t,this.auth,"internal-error"),t}async onExecution(){zf(this.filter.length===1,"Popup operations only handle one event");const t=h5();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Ip(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Ip(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,US.currentPopupAction=null}pollUserCancellation(){const t=()=>{var i,a;if(!((a=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ip(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Tje.get())};t()}}US.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rje="pendingRedirect",SO=new Map;class Cje extends Sie{constructor(t,i,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,a),this.eventId=null}async execute(){let t=SO.get(this.auth._key());if(!t){try{const a=await Ije(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(i){t=()=>Promise.reject(i)}SO.set(this.auth._key(),t)}return this.bypassAuthState||SO.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const i=await this.auth._redirectUserForId(t.eventId);if(i)return this.user=i,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Ije(n,t){const i=Oje(t),a=Pje(n);if(!await a._isAvailable())return!1;const l=await a._get(i)==="true";return await a._remove(i),l}function Aje(n,t){SO.set(n._key(),t)}function Pje(n){return If(n._redirectPersistence)}function Oje(n){return vO(Rje,n.config.apiKey,n.name)}async function kje(n,t,i=!1){if(hl(n.app))return Promise.reject(Df(n));const a=jg(n),l=vje(a,t),f=await new Cje(a,l,i).execute();return f&&!i&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,t)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nje=10*60*1e3;class Dje{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let i=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(i=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!xje(t)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=t,i=!0)),i}sendToConsumer(t,i){var a;if(t.error&&!bie(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";i.onError(Ip(this.auth,l))}else i.onAuthEvent(t)}isEventForConsumer(t,i){const a=i.eventId===null||!!t.eventId&&t.eventId===i.eventId;return i.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Nje&&this.cachedEventUids.clear(),this.cachedEventUids.has(HX(t))}saveEventToCache(t){this.cachedEventUids.add(HX(t)),this.lastProcessedEventTime=Date.now()}}function HX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function bie({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function xje(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return bie(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lje(n,t={}){return qf(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mje=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Uje=/^https?/;async function Vje(n){if(n.config.emulator)return;const{authorizedDomains:t}=await Lje(n);for(const i of t)try{if(Fje(i))return}catch{}ah(n,"unauthorized-domain")}function Fje(n){const t=VV(),{protocol:i,hostname:a}=new URL(t);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):i==="chrome-extension:"&&f.hostname===a}if(!Uje.test(i))return!1;if(Mje.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jje=new AC(3e4,6e4);function $X(){const n=Ap().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function Bje(n){return new Promise((t,i)=>{var a,l,d;function f(){$X(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{$X(),i(Ip(n,"network-request-failed"))},timeout:jje.get()})}if(!((l=(a=Ap().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=Ap().gapi)===null||d===void 0)&&d.load)f();else{const y=PFe("iframefcb");return Ap()[y]=()=>{gapi.load?f():i(Ip(n,"network-request-failed"))},iie(`${AFe()}?onload=${y}`).catch(v=>i(v))}}).catch(t=>{throw bO=null,t})}let bO=null;function zje(n){return bO=bO||Bje(n),bO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wje=new AC(5e3,15e3),Gje="__/auth/iframe",Hje="emulator/auth/iframe",$je={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Kje=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function qje(n){const t=n.config;Yn(t.authDomain,n,"auth-domain-config-required");const i=t.emulator?a5(t,Hje):`https://${n.config.authDomain}/${Gje}`,a={apiKey:t.apiKey,appName:n.name,v:Qy},l=Kje.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${i}?${CC(a).slice(1)}`}async function Yje(n){const t=await zje(n),i=Ap().gapi;return Yn(i,n,"internal-error"),t.open({where:document.body,url:qje(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:$je,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=Ip(n,"network-request-failed"),y=Ap().setTimeout(()=>{d(f)},Wje.get());function v(){Ap().clearTimeout(y),l(a)}a.ping(v).then(v,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xje={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Jje=500,Qje=600,Zje="_blank",e5e="http://localhost";class KX{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function t5e(n,t,i,a=Jje,l=Qje){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let y="";const v=Object.assign(Object.assign({},Xje),{width:a.toString(),height:l.toString(),top:d,left:f}),b=lc().toLowerCase();i&&(y=Jre(b)?Zje:i),Yre(b)&&(t=t||e5e,v.scrollbars="yes");const R=Object.entries(v).reduce((k,[M,L])=>`${k}${M}=${L},`,"");if(EFe(b)&&y!=="_self")return n5e(t||"",y),new KX(null);const I=window.open(t||"",y,R);Yn(I,n,"popup-blocked");try{I.focus()}catch{}return new KX(I)}function n5e(n,t){const i=document.createElement("a");i.href=n,i.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r5e="__/auth/handler",i5e="emulator/auth/handler",s5e=encodeURIComponent("fac");async function qX(n,t,i,a,l,d){Yn(n.config.authDomain,n,"auth-domain-config-required"),Yn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:a,v:Qy,eventId:l};if(t instanceof cie){t.setDefaultLanguage(n.languageCode),f.providerId=t.providerId||"",zUe(t.getCustomParameters())||(f.customParameters=JSON.stringify(t.getCustomParameters()));for(const[R,I]of Object.entries({}))f[R]=I}if(t instanceof OC){const R=t.getScopes().filter(I=>I!=="");R.length>0&&(f.scopes=R.join(","))}n.tenantId&&(f.tid=n.tenantId);const y=f;for(const R of Object.keys(y))y[R]===void 0&&delete y[R];const v=await n._getAppCheckToken(),b=v?`#${s5e}=${encodeURIComponent(v)}`:"";return`${o5e(n)}?${CC(y).slice(1)}${b}`}function o5e({config:n}){return n.emulator?a5(n,i5e):`https://${n.authDomain}/${r5e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RU="webStorageSupport";class a5e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=gie,this._completeRedirectFn=kje,this._overrideRedirectResult=Aje}async _openPopup(t,i,a,l){var d;zf((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await qX(t,i,a,VV(),l);return t5e(t,f,h5())}async _openRedirect(t,i,a,l){await this._originValidation(t);const d=await qX(t,i,a,VV(),l);return uje(d),new Promise(()=>{})}_initialize(t){const i=t._key();if(this.eventManagers[i]){const{manager:l,promise:d}=this.eventManagers[i];return l?Promise.resolve(l):(zf(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[i]={promise:a},a.catch(()=>{delete this.eventManagers[i]}),a}async initAndGetManager(t){const i=await Yje(t),a=new Dje(t);return i.register("authEvent",l=>(Yn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=i,a}_isIframeWebStorageSupported(t,i){this.iframes[t._key()].send(RU,{type:RU},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[RU];f!==void 0&&i(!!f),ah(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const i=t._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=Vje(t)),this.originValidationPromises[i]}get _shouldInitProactively(){return nie()||Xre()||l5()}}const c5e=a5e;var YX="@firebase/auth",XX="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5e{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const i=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,i),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const i=this.internalListeners.get(t);i&&(this.internalListeners.delete(t),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Yn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u5e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function d5e(n){Ag(new jf("auth",(t,{options:i})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:f,authDomain:y}=a.options;Yn(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:f,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rie(n)},b=new RFe(a,l,d,v);return LFe(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,i,a)=>{t.getProvider("auth-internal").initialize()})),Ag(new jf("auth-internal",t=>{const i=jg(t.getProvider("auth").getImmediate());return(a=>new l5e(a))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ju(YX,XX,u5e(n)),Ju(YX,XX,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h5e=5*60,p5e=Dre("authIdTokenMaxAge")||h5e;let JX=null;const f5e=n=>async t=>{const i=t&&await t.getIdTokenResult(),a=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(a&&a>p5e)return;const l=i==null?void 0:i.token;JX!==l&&(JX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function oN(n=nN()){const t=IC(n,"auth");if(t.isInitialized())return t.getImmediate();const i=xFe(n,{popupRedirectResolver:c5e,persistence:[Eje,aje,gie]}),a=Dre("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=f5e(d.toString());nje(i,f,()=>f(i.currentUser)),tje(i,y=>f(y))}}const l=kre("auth");return l&&MFe(i,`http://${l}`),i}function m5e(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}CFe({loadJS(n){return new Promise((t,i)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=t,a.onerror=l=>{const d=Ip("internal-error");d.customData=l,i(d)},a.type="text/javascript",a.charset="UTF-8",m5e().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});d5e("Browser");var QX=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var wg,wie;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(X,J){function te(){}te.prototype=J.prototype,X.D=J.prototype,X.prototype=new te,X.prototype.constructor=X,X.C=function(ie,he,fe){for(var de=Array(arguments.length-2),ve=2;ve<arguments.length;ve++)de[ve-2]=arguments[ve];return J.prototype[he].apply(ie,de)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(X,J,te){te||(te=0);var ie=Array(16);if(typeof J=="string")for(var he=0;16>he;++he)ie[he]=J.charCodeAt(te++)|J.charCodeAt(te++)<<8|J.charCodeAt(te++)<<16|J.charCodeAt(te++)<<24;else for(he=0;16>he;++he)ie[he]=J[te++]|J[te++]<<8|J[te++]<<16|J[te++]<<24;J=X.g[0],te=X.g[1],he=X.g[2];var fe=X.g[3],de=J+(fe^te&(he^fe))+ie[0]+3614090360&4294967295;J=te+(de<<7&4294967295|de>>>25),de=fe+(he^J&(te^he))+ie[1]+3905402710&4294967295,fe=J+(de<<12&4294967295|de>>>20),de=he+(te^fe&(J^te))+ie[2]+606105819&4294967295,he=fe+(de<<17&4294967295|de>>>15),de=te+(J^he&(fe^J))+ie[3]+3250441966&4294967295,te=he+(de<<22&4294967295|de>>>10),de=J+(fe^te&(he^fe))+ie[4]+4118548399&4294967295,J=te+(de<<7&4294967295|de>>>25),de=fe+(he^J&(te^he))+ie[5]+1200080426&4294967295,fe=J+(de<<12&4294967295|de>>>20),de=he+(te^fe&(J^te))+ie[6]+2821735955&4294967295,he=fe+(de<<17&4294967295|de>>>15),de=te+(J^he&(fe^J))+ie[7]+4249261313&4294967295,te=he+(de<<22&4294967295|de>>>10),de=J+(fe^te&(he^fe))+ie[8]+1770035416&4294967295,J=te+(de<<7&4294967295|de>>>25),de=fe+(he^J&(te^he))+ie[9]+2336552879&4294967295,fe=J+(de<<12&4294967295|de>>>20),de=he+(te^fe&(J^te))+ie[10]+4294925233&4294967295,he=fe+(de<<17&4294967295|de>>>15),de=te+(J^he&(fe^J))+ie[11]+2304563134&4294967295,te=he+(de<<22&4294967295|de>>>10),de=J+(fe^te&(he^fe))+ie[12]+1804603682&4294967295,J=te+(de<<7&4294967295|de>>>25),de=fe+(he^J&(te^he))+ie[13]+4254626195&4294967295,fe=J+(de<<12&4294967295|de>>>20),de=he+(te^fe&(J^te))+ie[14]+2792965006&4294967295,he=fe+(de<<17&4294967295|de>>>15),de=te+(J^he&(fe^J))+ie[15]+1236535329&4294967295,te=he+(de<<22&4294967295|de>>>10),de=J+(he^fe&(te^he))+ie[1]+4129170786&4294967295,J=te+(de<<5&4294967295|de>>>27),de=fe+(te^he&(J^te))+ie[6]+3225465664&4294967295,fe=J+(de<<9&4294967295|de>>>23),de=he+(J^te&(fe^J))+ie[11]+643717713&4294967295,he=fe+(de<<14&4294967295|de>>>18),de=te+(fe^J&(he^fe))+ie[0]+3921069994&4294967295,te=he+(de<<20&4294967295|de>>>12),de=J+(he^fe&(te^he))+ie[5]+3593408605&4294967295,J=te+(de<<5&4294967295|de>>>27),de=fe+(te^he&(J^te))+ie[10]+38016083&4294967295,fe=J+(de<<9&4294967295|de>>>23),de=he+(J^te&(fe^J))+ie[15]+3634488961&4294967295,he=fe+(de<<14&4294967295|de>>>18),de=te+(fe^J&(he^fe))+ie[4]+3889429448&4294967295,te=he+(de<<20&4294967295|de>>>12),de=J+(he^fe&(te^he))+ie[9]+568446438&4294967295,J=te+(de<<5&4294967295|de>>>27),de=fe+(te^he&(J^te))+ie[14]+3275163606&4294967295,fe=J+(de<<9&4294967295|de>>>23),de=he+(J^te&(fe^J))+ie[3]+4107603335&4294967295,he=fe+(de<<14&4294967295|de>>>18),de=te+(fe^J&(he^fe))+ie[8]+1163531501&4294967295,te=he+(de<<20&4294967295|de>>>12),de=J+(he^fe&(te^he))+ie[13]+2850285829&4294967295,J=te+(de<<5&4294967295|de>>>27),de=fe+(te^he&(J^te))+ie[2]+4243563512&4294967295,fe=J+(de<<9&4294967295|de>>>23),de=he+(J^te&(fe^J))+ie[7]+1735328473&4294967295,he=fe+(de<<14&4294967295|de>>>18),de=te+(fe^J&(he^fe))+ie[12]+2368359562&4294967295,te=he+(de<<20&4294967295|de>>>12),de=J+(te^he^fe)+ie[5]+4294588738&4294967295,J=te+(de<<4&4294967295|de>>>28),de=fe+(J^te^he)+ie[8]+2272392833&4294967295,fe=J+(de<<11&4294967295|de>>>21),de=he+(fe^J^te)+ie[11]+1839030562&4294967295,he=fe+(de<<16&4294967295|de>>>16),de=te+(he^fe^J)+ie[14]+4259657740&4294967295,te=he+(de<<23&4294967295|de>>>9),de=J+(te^he^fe)+ie[1]+2763975236&4294967295,J=te+(de<<4&4294967295|de>>>28),de=fe+(J^te^he)+ie[4]+1272893353&4294967295,fe=J+(de<<11&4294967295|de>>>21),de=he+(fe^J^te)+ie[7]+4139469664&4294967295,he=fe+(de<<16&4294967295|de>>>16),de=te+(he^fe^J)+ie[10]+3200236656&4294967295,te=he+(de<<23&4294967295|de>>>9),de=J+(te^he^fe)+ie[13]+681279174&4294967295,J=te+(de<<4&4294967295|de>>>28),de=fe+(J^te^he)+ie[0]+3936430074&4294967295,fe=J+(de<<11&4294967295|de>>>21),de=he+(fe^J^te)+ie[3]+3572445317&4294967295,he=fe+(de<<16&4294967295|de>>>16),de=te+(he^fe^J)+ie[6]+76029189&4294967295,te=he+(de<<23&4294967295|de>>>9),de=J+(te^he^fe)+ie[9]+3654602809&4294967295,J=te+(de<<4&4294967295|de>>>28),de=fe+(J^te^he)+ie[12]+3873151461&4294967295,fe=J+(de<<11&4294967295|de>>>21),de=he+(fe^J^te)+ie[15]+530742520&4294967295,he=fe+(de<<16&4294967295|de>>>16),de=te+(he^fe^J)+ie[2]+3299628645&4294967295,te=he+(de<<23&4294967295|de>>>9),de=J+(he^(te|~fe))+ie[0]+4096336452&4294967295,J=te+(de<<6&4294967295|de>>>26),de=fe+(te^(J|~he))+ie[7]+1126891415&4294967295,fe=J+(de<<10&4294967295|de>>>22),de=he+(J^(fe|~te))+ie[14]+2878612391&4294967295,he=fe+(de<<15&4294967295|de>>>17),de=te+(fe^(he|~J))+ie[5]+4237533241&4294967295,te=he+(de<<21&4294967295|de>>>11),de=J+(he^(te|~fe))+ie[12]+1700485571&4294967295,J=te+(de<<6&4294967295|de>>>26),de=fe+(te^(J|~he))+ie[3]+2399980690&4294967295,fe=J+(de<<10&4294967295|de>>>22),de=he+(J^(fe|~te))+ie[10]+4293915773&4294967295,he=fe+(de<<15&4294967295|de>>>17),de=te+(fe^(he|~J))+ie[1]+2240044497&4294967295,te=he+(de<<21&4294967295|de>>>11),de=J+(he^(te|~fe))+ie[8]+1873313359&4294967295,J=te+(de<<6&4294967295|de>>>26),de=fe+(te^(J|~he))+ie[15]+4264355552&4294967295,fe=J+(de<<10&4294967295|de>>>22),de=he+(J^(fe|~te))+ie[6]+2734768916&4294967295,he=fe+(de<<15&4294967295|de>>>17),de=te+(fe^(he|~J))+ie[13]+1309151649&4294967295,te=he+(de<<21&4294967295|de>>>11),de=J+(he^(te|~fe))+ie[4]+4149444226&4294967295,J=te+(de<<6&4294967295|de>>>26),de=fe+(te^(J|~he))+ie[11]+3174756917&4294967295,fe=J+(de<<10&4294967295|de>>>22),de=he+(J^(fe|~te))+ie[2]+718787259&4294967295,he=fe+(de<<15&4294967295|de>>>17),de=te+(fe^(he|~J))+ie[9]+3951481745&4294967295,X.g[0]=X.g[0]+J&4294967295,X.g[1]=X.g[1]+(he+(de<<21&4294967295|de>>>11))&4294967295,X.g[2]=X.g[2]+he&4294967295,X.g[3]=X.g[3]+fe&4294967295}a.prototype.u=function(X,J){J===void 0&&(J=X.length);for(var te=J-this.blockSize,ie=this.B,he=this.h,fe=0;fe<J;){if(he==0)for(;fe<=te;)l(this,X,fe),fe+=this.blockSize;if(typeof X=="string"){for(;fe<J;)if(ie[he++]=X.charCodeAt(fe++),he==this.blockSize){l(this,ie),he=0;break}}else for(;fe<J;)if(ie[he++]=X[fe++],he==this.blockSize){l(this,ie),he=0;break}}this.h=he,this.o+=J},a.prototype.v=function(){var X=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);X[0]=128;for(var J=1;J<X.length-8;++J)X[J]=0;var te=8*this.o;for(J=X.length-8;J<X.length;++J)X[J]=te&255,te/=256;for(this.u(X),X=Array(16),J=te=0;4>J;++J)for(var ie=0;32>ie;ie+=8)X[te++]=this.g[J]>>>ie&255;return X};function d(X,J){var te=y;return Object.prototype.hasOwnProperty.call(te,X)?te[X]:te[X]=J(X)}function f(X,J){this.h=J;for(var te=[],ie=!0,he=X.length-1;0<=he;he--){var fe=X[he]|0;ie&&fe==J||(te[he]=fe,ie=!1)}this.g=te}var y={};function v(X){return-128<=X&&128>X?d(X,function(J){return new f([J|0],0>J?-1:0)}):new f([X|0],0>X?-1:0)}function b(X){if(isNaN(X)||!isFinite(X))return I;if(0>X)return z(b(-X));for(var J=[],te=1,ie=0;X>=te;ie++)J[ie]=X/te|0,te*=4294967296;return new f(J,0)}function R(X,J){if(X.length==0)throw Error("number format error: empty string");if(J=J||10,2>J||36<J)throw Error("radix out of range: "+J);if(X.charAt(0)=="-")return z(R(X.substring(1),J));if(0<=X.indexOf("-"))throw Error('number format error: interior "-" character');for(var te=b(Math.pow(J,8)),ie=I,he=0;he<X.length;he+=8){var fe=Math.min(8,X.length-he),de=parseInt(X.substring(he,he+fe),J);8>fe?(fe=b(Math.pow(J,fe)),ie=ie.j(fe).add(b(de))):(ie=ie.j(te),ie=ie.add(b(de)))}return ie}var I=v(0),k=v(1),M=v(16777216);n=f.prototype,n.m=function(){if(j(this))return-z(this).m();for(var X=0,J=1,te=0;te<this.g.length;te++){var ie=this.i(te);X+=(0<=ie?ie:4294967296+ie)*J,J*=4294967296}return X},n.toString=function(X){if(X=X||10,2>X||36<X)throw Error("radix out of range: "+X);if(L(this))return"0";if(j(this))return"-"+z(this).toString(X);for(var J=b(Math.pow(X,6)),te=this,ie="";;){var he=ce(te,J).g;te=Y(te,he.j(J));var fe=((0<te.g.length?te.g[0]:te.h)>>>0).toString(X);if(te=he,L(te))return fe+ie;for(;6>fe.length;)fe="0"+fe;ie=fe+ie}},n.i=function(X){return 0>X?0:X<this.g.length?this.g[X]:this.h};function L(X){if(X.h!=0)return!1;for(var J=0;J<X.g.length;J++)if(X.g[J]!=0)return!1;return!0}function j(X){return X.h==-1}n.l=function(X){return X=Y(this,X),j(X)?-1:L(X)?0:1};function z(X){for(var J=X.g.length,te=[],ie=0;ie<J;ie++)te[ie]=~X.g[ie];return new f(te,~X.h).add(k)}n.abs=function(){return j(this)?z(this):this},n.add=function(X){for(var J=Math.max(this.g.length,X.g.length),te=[],ie=0,he=0;he<=J;he++){var fe=ie+(this.i(he)&65535)+(X.i(he)&65535),de=(fe>>>16)+(this.i(he)>>>16)+(X.i(he)>>>16);ie=de>>>16,fe&=65535,de&=65535,te[he]=de<<16|fe}return new f(te,te[te.length-1]&-2147483648?-1:0)};function Y(X,J){return X.add(z(J))}n.j=function(X){if(L(this)||L(X))return I;if(j(this))return j(X)?z(this).j(z(X)):z(z(this).j(X));if(j(X))return z(this.j(z(X)));if(0>this.l(M)&&0>X.l(M))return b(this.m()*X.m());for(var J=this.g.length+X.g.length,te=[],ie=0;ie<2*J;ie++)te[ie]=0;for(ie=0;ie<this.g.length;ie++)for(var he=0;he<X.g.length;he++){var fe=this.i(ie)>>>16,de=this.i(ie)&65535,ve=X.i(he)>>>16,Te=X.i(he)&65535;te[2*ie+2*he]+=de*Te,K(te,2*ie+2*he),te[2*ie+2*he+1]+=fe*Te,K(te,2*ie+2*he+1),te[2*ie+2*he+1]+=de*ve,K(te,2*ie+2*he+1),te[2*ie+2*he+2]+=fe*ve,K(te,2*ie+2*he+2)}for(ie=0;ie<J;ie++)te[ie]=te[2*ie+1]<<16|te[2*ie];for(ie=J;ie<2*J;ie++)te[ie]=0;return new f(te,0)};function K(X,J){for(;(X[J]&65535)!=X[J];)X[J+1]+=X[J]>>>16,X[J]&=65535,J++}function ne(X,J){this.g=X,this.h=J}function ce(X,J){if(L(J))throw Error("division by zero");if(L(X))return new ne(I,I);if(j(X))return J=ce(z(X),J),new ne(z(J.g),z(J.h));if(j(J))return J=ce(X,z(J)),new ne(z(J.g),J.h);if(30<X.g.length){if(j(X)||j(J))throw Error("slowDivide_ only works with positive integers.");for(var te=k,ie=J;0>=ie.l(X);)te=oe(te),ie=oe(ie);var he=ge(te,1),fe=ge(ie,1);for(ie=ge(ie,2),te=ge(te,2);!L(ie);){var de=fe.add(ie);0>=de.l(X)&&(he=he.add(te),fe=de),ie=ge(ie,1),te=ge(te,1)}return J=Y(X,he.j(J)),new ne(he,J)}for(he=I;0<=X.l(J);){for(te=Math.max(1,Math.floor(X.m()/J.m())),ie=Math.ceil(Math.log(te)/Math.LN2),ie=48>=ie?1:Math.pow(2,ie-48),fe=b(te),de=fe.j(J);j(de)||0<de.l(X);)te-=ie,fe=b(te),de=fe.j(J);L(fe)&&(fe=k),he=he.add(fe),X=Y(X,de)}return new ne(he,X)}n.A=function(X){return ce(this,X).h},n.and=function(X){for(var J=Math.max(this.g.length,X.g.length),te=[],ie=0;ie<J;ie++)te[ie]=this.i(ie)&X.i(ie);return new f(te,this.h&X.h)},n.or=function(X){for(var J=Math.max(this.g.length,X.g.length),te=[],ie=0;ie<J;ie++)te[ie]=this.i(ie)|X.i(ie);return new f(te,this.h|X.h)},n.xor=function(X){for(var J=Math.max(this.g.length,X.g.length),te=[],ie=0;ie<J;ie++)te[ie]=this.i(ie)^X.i(ie);return new f(te,this.h^X.h)};function oe(X){for(var J=X.g.length+1,te=[],ie=0;ie<J;ie++)te[ie]=X.i(ie)<<1|X.i(ie-1)>>>31;return new f(te,X.h)}function ge(X,J){var te=J>>5;J%=32;for(var ie=X.g.length-te,he=[],fe=0;fe<ie;fe++)he[fe]=0<J?X.i(fe+te)>>>J|X.i(fe+te+1)<<32-J:X.i(fe+te);return new f(he,X.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,wie=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=R,wg=f}).apply(typeof QX<"u"?QX:typeof self<"u"?self:typeof window<"u"?window:{});var z1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Tie,nR,Rie,wO,BV,Cie,Iie,Aie;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(P,H,re){return P==Array.prototype||P==Object.prototype||(P[H]=re.value),P};function i(P){P=[typeof globalThis=="object"&&globalThis,P,typeof window=="object"&&window,typeof self=="object"&&self,typeof z1=="object"&&z1];for(var H=0;H<P.length;++H){var re=P[H];if(re&&re.Math==Math)return re}throw Error("Cannot find global object")}var a=i(this);function l(P,H){if(H)e:{var re=a;P=P.split(".");for(var Se=0;Se<P.length-1;Se++){var qe=P[Se];if(!(qe in re))break e;re=re[qe]}P=P[P.length-1],Se=re[P],H=H(Se),H!=Se&&H!=null&&t(re,P,{configurable:!0,writable:!0,value:H})}}function d(P,H){P instanceof String&&(P+="");var re=0,Se=!1,qe={next:function(){if(!Se&&re<P.length){var dt=re++;return{value:H(dt,P[dt]),done:!1}}return Se=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(P){return P||function(){return d(this,function(H,re){return re})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},y=this||self;function v(P){var H=typeof P;return H=H!="object"?H:P?Array.isArray(P)?"array":H:"null",H=="array"||H=="object"&&typeof P.length=="number"}function b(P){var H=typeof P;return H=="object"&&P!=null||H=="function"}function R(P,H,re){return P.call.apply(P.bind,arguments)}function I(P,H,re){if(!P)throw Error();if(2<arguments.length){var Se=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,Se),P.apply(H,qe)}}return function(){return P.apply(H,arguments)}}function k(P,H,re){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?R:I,k.apply(null,arguments)}function M(P,H){var re=Array.prototype.slice.call(arguments,1);return function(){var Se=re.slice();return Se.push.apply(Se,arguments),P.apply(this,Se)}}function L(P,H){function re(){}re.prototype=H.prototype,P.aa=H.prototype,P.prototype=new re,P.prototype.constructor=P,P.Qb=function(Se,qe,dt){for(var Kt=Array(arguments.length-2),ii=2;ii<arguments.length;ii++)Kt[ii-2]=arguments[ii];return H.prototype[qe].apply(Se,Kt)}}function j(P){const H=P.length;if(0<H){const re=Array(H);for(let Se=0;Se<H;Se++)re[Se]=P[Se];return re}return[]}function z(P,H){for(let re=1;re<arguments.length;re++){const Se=arguments[re];if(v(Se)){const qe=P.length||0,dt=Se.length||0;P.length=qe+dt;for(let Kt=0;Kt<dt;Kt++)P[qe+Kt]=Se[Kt]}else P.push(Se)}}class Y{constructor(H,re){this.i=H,this.j=re,this.h=0,this.g=null}get(){let H;return 0<this.h?(this.h--,H=this.g,this.g=H.next,H.next=null):H=this.i(),H}}function K(P){return/^[\s\xa0]*$/.test(P)}function ne(){var P=y.navigator;return P&&(P=P.userAgent)?P:""}function ce(P){return ce[" "](P),P}ce[" "]=function(){};var oe=ne().indexOf("Gecko")!=-1&&!(ne().toLowerCase().indexOf("webkit")!=-1&&ne().indexOf("Edge")==-1)&&!(ne().indexOf("Trident")!=-1||ne().indexOf("MSIE")!=-1)&&ne().indexOf("Edge")==-1;function ge(P,H,re){for(const Se in P)H.call(re,P[Se],Se,P)}function X(P,H){for(const re in P)H.call(void 0,P[re],re,P)}function J(P){const H={};for(const re in P)H[re]=P[re];return H}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(P,H){let re,Se;for(let qe=1;qe<arguments.length;qe++){Se=arguments[qe];for(re in Se)P[re]=Se[re];for(let dt=0;dt<te.length;dt++)re=te[dt],Object.prototype.hasOwnProperty.call(Se,re)&&(P[re]=Se[re])}}function he(P){var H=1;P=P.split(":");const re=[];for(;0<H&&P.length;)re.push(P.shift()),H--;return P.length&&re.push(P.join(":")),re}function fe(P){y.setTimeout(()=>{throw P},0)}function de(){var P=Ae;let H=null;return P.g&&(H=P.g,P.g=P.g.next,P.g||(P.h=null),H.next=null),H}class ve{constructor(){this.h=this.g=null}add(H,re){const Se=Te.get();Se.set(H,re),this.h?this.h.next=Se:this.g=Se,this.h=Se}}var Te=new Y(()=>new Fe,P=>P.reset());class Fe{constructor(){this.next=this.g=this.h=null}set(H,re){this.h=H,this.g=re,this.next=null}reset(){this.next=this.g=this.h=null}}let be,Ce=!1,Ae=new ve,De=()=>{const P=y.Promise.resolve(void 0);be=()=>{P.then(Ee)}};var Ee=()=>{for(var P;P=de();){try{P.h.call(P.g)}catch(re){fe(re)}var H=Te;H.j(P),100>H.h&&(H.h++,P.next=H.g,H.g=P)}Ce=!1};function Ne(){this.s=this.s,this.C=this.C}Ne.prototype.s=!1,Ne.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ne.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function je(P,H){this.type=P,this.g=this.target=H,this.defaultPrevented=!1}je.prototype.h=function(){this.defaultPrevented=!0};var Ke=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var P=!1,H=Object.defineProperty({},"passive",{get:function(){P=!0}});try{const re=()=>{};y.addEventListener("test",re,H),y.removeEventListener("test",re,H)}catch{}return P}();function ot(P,H){if(je.call(this,P?P.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,P){var re=this.type=P.type,Se=P.changedTouches&&P.changedTouches.length?P.changedTouches[0]:null;if(this.target=P.target||P.srcElement,this.g=H,H=P.relatedTarget){if(oe){e:{try{ce(H.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(H=null)}}else re=="mouseover"?H=P.fromElement:re=="mouseout"&&(H=P.toElement);this.relatedTarget=H,Se?(this.clientX=Se.clientX!==void 0?Se.clientX:Se.pageX,this.clientY=Se.clientY!==void 0?Se.clientY:Se.pageY,this.screenX=Se.screenX||0,this.screenY=Se.screenY||0):(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0),this.button=P.button,this.key=P.key||"",this.ctrlKey=P.ctrlKey,this.altKey=P.altKey,this.shiftKey=P.shiftKey,this.metaKey=P.metaKey,this.pointerId=P.pointerId||0,this.pointerType=typeof P.pointerType=="string"?P.pointerType:_t[P.pointerType]||"",this.state=P.state,this.i=P,P.defaultPrevented&&ot.aa.h.call(this)}}L(ot,je);var _t={2:"touch",3:"pen",4:"mouse"};ot.prototype.h=function(){ot.aa.h.call(this);var P=this.i;P.preventDefault?P.preventDefault():P.returnValue=!1};var lt="closure_listenable_"+(1e6*Math.random()|0),vt=0;function rt(P,H,re,Se,qe){this.listener=P,this.proxy=null,this.src=H,this.type=re,this.capture=!!Se,this.ha=qe,this.key=++vt,this.da=this.fa=!1}function bt(P){P.da=!0,P.listener=null,P.proxy=null,P.src=null,P.ha=null}function $t(P){this.src=P,this.g={},this.h=0}$t.prototype.add=function(P,H,re,Se,qe){var dt=P.toString();P=this.g[dt],P||(P=this.g[dt]=[],this.h++);var Kt=mt(P,H,Se,qe);return-1<Kt?(H=P[Kt],re||(H.fa=!1)):(H=new rt(H,this.src,dt,!!Se,qe),H.fa=re,P.push(H)),H};function ut(P,H){var re=H.type;if(re in P.g){var Se=P.g[re],qe=Array.prototype.indexOf.call(Se,H,void 0),dt;(dt=0<=qe)&&Array.prototype.splice.call(Se,qe,1),dt&&(bt(H),P.g[re].length==0&&(delete P.g[re],P.h--))}}function mt(P,H,re,Se){for(var qe=0;qe<P.length;++qe){var dt=P[qe];if(!dt.da&&dt.listener==H&&dt.capture==!!re&&dt.ha==Se)return qe}return-1}var at="closure_lm_"+(1e6*Math.random()|0),Vt={};function rn(P,H,re,Se,qe){if(Array.isArray(H)){for(var dt=0;dt<H.length;dt++)rn(P,H[dt],re,Se,qe);return null}return re=vn(re),P&&P[lt]?P.K(H,re,b(Se)?!!Se.capture:!1,qe):Ht(P,H,re,!1,Se,qe)}function Ht(P,H,re,Se,qe,dt){if(!H)throw Error("Invalid event type");var Kt=b(qe)?!!qe.capture:!!qe,ii=wt(P);if(ii||(P[at]=ii=new $t(P)),re=ii.add(H,re,Se,Kt,dt),re.proxy)return re;if(Se=we(),re.proxy=Se,Se.src=P,Se.listener=re,P.addEventListener)Ke||(qe=Kt),qe===void 0&&(qe=!1),P.addEventListener(H.toString(),Se,qe);else if(P.attachEvent)P.attachEvent(Pt(H.toString()),Se);else if(P.addListener&&P.removeListener)P.addListener(Se);else throw Error("addEventListener and attachEvent are unavailable.");return re}function we(){function P(re){return H.call(P.src,P.listener,re)}const H=It;return P}function xe(P,H,re,Se,qe){if(Array.isArray(H))for(var dt=0;dt<H.length;dt++)xe(P,H[dt],re,Se,qe);else Se=b(Se)?!!Se.capture:!!Se,re=vn(re),P&&P[lt]?(P=P.i,H=String(H).toString(),H in P.g&&(dt=P.g[H],re=mt(dt,re,Se,qe),-1<re&&(bt(dt[re]),Array.prototype.splice.call(dt,re,1),dt.length==0&&(delete P.g[H],P.h--)))):P&&(P=wt(P))&&(H=P.g[H.toString()],P=-1,H&&(P=mt(H,re,Se,qe)),(re=-1<P?H[P]:null)&&$e(re))}function $e(P){if(typeof P!="number"&&P&&!P.da){var H=P.src;if(H&&H[lt])ut(H.i,P);else{var re=P.type,Se=P.proxy;H.removeEventListener?H.removeEventListener(re,Se,P.capture):H.detachEvent?H.detachEvent(Pt(re),Se):H.addListener&&H.removeListener&&H.removeListener(Se),(re=wt(H))?(ut(re,P),re.h==0&&(re.src=null,H[at]=null)):bt(P)}}}function Pt(P){return P in Vt?Vt[P]:Vt[P]="on"+P}function It(P,H){if(P.da)P=!0;else{H=new ot(H,this);var re=P.listener,Se=P.ha||P.src;P.fa&&$e(P),P=re.call(Se,H)}return P}function wt(P){return P=P[at],P instanceof $t?P:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function vn(P){return typeof P=="function"?P:(P[Mt]||(P[Mt]=function(H){return P.handleEvent(H)}),P[Mt])}function Cn(){Ne.call(this),this.i=new $t(this),this.M=this,this.F=null}L(Cn,Ne),Cn.prototype[lt]=!0,Cn.prototype.removeEventListener=function(P,H,re,Se){xe(this,P,H,re,Se)};function dn(P,H){var re,Se=P.F;if(Se)for(re=[];Se;Se=Se.F)re.push(Se);if(P=P.M,Se=H.type||H,typeof H=="string")H=new je(H,P);else if(H instanceof je)H.target=H.target||P;else{var qe=H;H=new je(Se,P),ie(H,qe)}if(qe=!0,re)for(var dt=re.length-1;0<=dt;dt--){var Kt=H.g=re[dt];qe=Rt(Kt,Se,!0,H)&&qe}if(Kt=H.g=P,qe=Rt(Kt,Se,!0,H)&&qe,qe=Rt(Kt,Se,!1,H)&&qe,re)for(dt=0;dt<re.length;dt++)Kt=H.g=re[dt],qe=Rt(Kt,Se,!1,H)&&qe}Cn.prototype.N=function(){if(Cn.aa.N.call(this),this.i){var P=this.i,H;for(H in P.g){for(var re=P.g[H],Se=0;Se<re.length;Se++)bt(re[Se]);delete P.g[H],P.h--}}this.F=null},Cn.prototype.K=function(P,H,re,Se){return this.i.add(String(P),H,!1,re,Se)},Cn.prototype.L=function(P,H,re,Se){return this.i.add(String(P),H,!0,re,Se)};function Rt(P,H,re,Se){if(H=P.i.g[String(H)],!H)return!0;H=H.concat();for(var qe=!0,dt=0;dt<H.length;++dt){var Kt=H[dt];if(Kt&&!Kt.da&&Kt.capture==re){var ii=Kt.listener,qs=Kt.ha||Kt.src;Kt.fa&&ut(P.i,Kt),qe=ii.call(qs,Se)!==!1&&qe}}return qe&&!Se.defaultPrevented}function Qn(P,H,re){if(typeof P=="function")re&&(P=k(P,re));else if(P&&typeof P.handleEvent=="function")P=k(P.handleEvent,P);else throw Error("Invalid listener argument");return 2147483647<Number(H)?-1:y.setTimeout(P,H||0)}function xt(P){P.g=Qn(()=>{P.g=null,P.i&&(P.i=!1,xt(P))},P.l);const H=P.h;P.h=null,P.m.apply(null,H)}class Xt extends Ne{constructor(H,re){super(),this.m=H,this.l=re,this.h=null,this.i=!1,this.g=null}j(H){this.h=arguments,this.g?this.i=!0:xt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lr(P){Ne.call(this),this.h=P,this.g={}}L(Lr,Ne);var Ci=[];function ai(P){ge(P.g,function(H,re){this.g.hasOwnProperty(re)&&$e(H)},P),P.g={}}Lr.prototype.N=function(){Lr.aa.N.call(this),ai(this)},Lr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ii=y.JSON.stringify,ps=y.JSON.parse,qo=class{stringify(P){return y.JSON.stringify(P,void 0)}parse(P){return y.JSON.parse(P,void 0)}};function Hi(){}Hi.prototype.h=null;function Ai(P){return P.h||(P.h=P.i())}function Kn(){}var cs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function da(){je.call(this,"d")}L(da,je);function Yo(){je.call(this,"c")}L(Yo,je);var po={},rd=null;function Xo(){return rd=rd||new Cn}po.La="serverreachability";function id(P){je.call(this,po.La,P)}L(id,je);function hc(P){const H=Xo();dn(H,new id(H))}po.STAT_EVENT="statevent";function Co(P,H){je.call(this,po.STAT_EVENT,P),this.stat=H}L(Co,je);function Sr(P){const H=Xo();dn(H,new Co(H,P))}po.Ma="timingevent";function ou(P,H){je.call(this,po.Ma,P),this.size=H}L(ou,je);function ha(P,H){if(typeof P!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){P()},H)}function Fa(){this.g=!0}Fa.prototype.xa=function(){this.g=!1};function Mc(P,H,re,Se,qe,dt){P.info(function(){if(P.g)if(dt)for(var Kt="",ii=dt.split("&"),qs=0;qs<ii.length;qs++){var dr=ii[qs].split("=");if(1<dr.length){var mo=dr[0];dr=dr[1];var Ds=mo.split("_");Kt=2<=Ds.length&&Ds[1]=="type"?Kt+(mo+"="+dr+"&"):Kt+(mo+"=redacted&")}}else Kt=null;else Kt=dt;return"XMLHTTP REQ ("+Se+") [attempt "+qe+"]: "+H+`
`+re+`
`+Kt})}function Jo(P,H,re,Se,qe,dt,Kt){P.info(function(){return"XMLHTTP RESP ("+Se+") [ attempt "+qe+"]: "+H+`
`+re+`
`+dt+" "+Kt})}function Qo(P,H,re,Se){P.info(function(){return"XMLHTTP TEXT ("+H+"): "+ph(P,re)+(Se?" "+Se:"")})}function sd(P,H){P.info(function(){return"TIMEOUT: "+H})}Fa.prototype.info=function(){};function ph(P,H){if(!P.g)return H;if(!H)return null;try{var re=JSON.parse(H);if(re){for(P=0;P<re.length;P++)if(Array.isArray(re[P])){var Se=re[P];if(!(2>Se.length)){var qe=Se[1];if(Array.isArray(qe)&&!(1>qe.length)){var dt=qe[0];if(dt!="noop"&&dt!="stop"&&dt!="close")for(var Kt=1;Kt<qe.length;Kt++)qe[Kt]=""}}}}return Ii(re)}catch{return H}}var vl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},fh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Os;function pt(){}L(pt,Hi),pt.prototype.g=function(){return new XMLHttpRequest},pt.prototype.i=function(){return{}},Os=new pt;function nn(P,H,re,Se){this.j=P,this.i=H,this.l=re,this.R=Se||1,this.U=new Lr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ar}function Ar(){this.i=null,this.g="",this.h=!1}var Pi={},pc={};function fo(P,H,re){P.L=1,P.v=lu(ma(H)),P.m=re,P.P=!0,Sl(P,null)}function Sl(P,H){P.F=Date.now(),Br(P),P.A=ma(P.v);var re=P.A,Se=P.R;Array.isArray(Se)||(Se=[String(Se)]),du(re.i,"t",Se),P.C=0,re=P.j.J,P.h=new Ar,P.g=$g(P.j,re?H:null,!P.m),0<P.O&&(P.M=new Xt(k(P.Y,P,P.g),P.O)),H=P.U,re=P.g,Se=P.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(Ci[0]=qe.toString()),qe=Ci);for(var dt=0;dt<qe.length;dt++){var Kt=rn(re,qe[dt],Se||H.handleEvent,!1,H.h||H);if(!Kt)break;H.g[Kt.key]=Kt}H=P.H?J(P.H):{},P.m?(P.u||(P.u="POST"),H["Content-Type"]="application/x-www-form-urlencoded",P.g.ea(P.A,P.u,P.m,H)):(P.u="GET",P.g.ea(P.A,P.u,null,H)),hc(),Mc(P.i,P.u,P.A,P.l,P.R,P.m)}nn.prototype.ca=function(P){P=P.target;const H=this.M;H&&Oi(P)==3?H.j():this.Y(P)},nn.prototype.Y=function(P){try{if(P==this.g)e:{const Ds=Oi(this.g);var H=this.g.Ba();const Bc=this.g.Z();if(!(3>Ds)&&(Ds!=3||this.g&&(this.h.h||this.g.oa()||Ks(this.g)))){this.J||Ds!=4||H==7||(H==8||0>=Bc?hc(3):hc(2)),zr(this);var re=this.g.Z();this.X=re;t:if(mh(this)){var Se=Ks(this.g);P="";var qe=Se.length,dt=Oi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$i(this),pa(this);var Kt="";break t}this.h.i=new y.TextDecoder}for(H=0;H<qe;H++)this.h.h=!0,P+=this.h.i.decode(Se[H],{stream:!(dt&&H==qe-1)});Se.length=0,this.h.g+=P,this.C=0,Kt=this.h.g}else Kt=this.g.oa();if(this.o=re==200,Jo(this.i,this.u,this.A,this.l,this.R,Ds,re),this.o){if(this.T&&!this.K){t:{if(this.g){var ii,qs=this.g;if((ii=qs.g?qs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(ii)){var dr=ii;break t}}dr=null}if(re=dr)Qo(this.i,this.l,re,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fs(this,re);else{this.o=!1,this.s=3,Sr(12),$i(this),pa(this);break e}}if(this.P){re=!0;let Wa;for(;!this.J&&this.C<Kt.length;)if(Wa=$s(this,Kt),Wa==pc){Ds==4&&(this.s=4,Sr(14),re=!1),Qo(this.i,this.l,null,"[Incomplete Response]");break}else if(Wa==Pi){this.s=4,Sr(15),Qo(this.i,this.l,Kt,"[Invalid Chunk]"),re=!1;break}else Qo(this.i,this.l,Wa,null),fs(this,Wa);if(mh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ds!=4||Kt.length!=0||this.h.h||(this.s=1,Sr(16),re=!1),this.o=this.o&&re,!re)Qo(this.i,this.l,Kt,"[Invalid Chunked Response]"),$i(this),pa(this);else if(0<Kt.length&&!this.W){this.W=!0;var mo=this.j;mo.g==this&&mo.ba&&!mo.M&&(mo.j.info("Great, no buffering proxy detected. Bytes received: "+Kt.length),Hg(mo),mo.M=!0,Sr(11))}}else Qo(this.i,this.l,Kt,null),fs(this,Kt);Ds==4&&$i(this),this.o&&!this.J&&(Ds==4?em(this.j,this):(this.o=!1,Br(this)))}else Fc(this.g),re==400&&0<Kt.indexOf("Unknown SID")?(this.s=3,Sr(12)):(this.s=0,Sr(13)),$i(this),pa(this)}}}catch{}finally{}};function mh(P){return P.g?P.u=="GET"&&P.L!=2&&P.j.Ca:!1}function $s(P,H){var re=P.C,Se=H.indexOf(`
`,re);return Se==-1?pc:(re=Number(H.substring(re,Se)),isNaN(re)?Pi:(Se+=1,Se+re>H.length?pc:(H=H.slice(Se,Se+re),P.C=Se+re,H)))}nn.prototype.cancel=function(){this.J=!0,$i(this)};function Br(P){P.S=Date.now()+P.I,gh(P,P.I)}function gh(P,H){if(P.B!=null)throw Error("WatchDog timer not null");P.B=ha(k(P.ba,P),H)}function zr(P){P.B&&(y.clearTimeout(P.B),P.B=null)}nn.prototype.ba=function(){this.B=null;const P=Date.now();0<=P-this.S?(sd(this.i,this.A),this.L!=2&&(hc(),Sr(17)),$i(this),this.s=2,pa(this)):gh(this,this.S-P)};function pa(P){P.j.G==0||P.J||em(P.j,P)}function $i(P){zr(P);var H=P.M;H&&typeof H.ma=="function"&&H.ma(),P.M=null,ai(P.U),P.g&&(H=P.g,P.g=null,H.abort(),H.ma())}function fs(P,H){try{var re=P.j;if(re.G!=0&&(re.g==P||Io(re.h,P))){if(!P.K&&Io(re.h,P)&&re.G==3){try{var Se=re.Da.g.parse(H)}catch{Se=null}if(Array.isArray(Se)&&Se.length==3){var qe=Se;if(qe[0]==0){e:if(!re.u){if(re.g)if(re.g.F+3e3<P.F)Zf(re),mc(re);else break e;fu(re),Sr(18)}}else re.za=qe[1],0<re.za-re.T&&37500>qe[2]&&re.F&&re.v==0&&!re.C&&(re.C=ha(k(re.Za,re),6e3));if(1>=xp(re.h)&&re.ca){try{re.ca()}catch{}re.ca=void 0}}else za(re,11)}else if((P.K||re.g==P)&&Zf(re),!K(H))for(qe=re.Da.g.parse(H),H=0;H<qe.length;H++){let dr=qe[H];if(re.T=dr[0],dr=dr[1],re.G==2)if(dr[0]=="c"){re.K=dr[1],re.ia=dr[2];const mo=dr[3];mo!=null&&(re.la=mo,re.j.info("VER="+re.la));const Ds=dr[4];Ds!=null&&(re.Aa=Ds,re.j.info("SVER="+re.Aa));const Bc=dr[5];Bc!=null&&typeof Bc=="number"&&0<Bc&&(Se=1.5*Bc,re.L=Se,re.j.info("backChannelRequestTimeoutMs_="+Se)),Se=re;const Wa=P.g;if(Wa){const dd=Wa.g?Wa.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(dd){var dt=Se.h;dt.g||dd.indexOf("spdy")==-1&&dd.indexOf("quic")==-1&&dd.indexOf("h2")==-1||(dt.j=dt.l,dt.g=new Set,dt.h&&(Lp(dt,dt.h),dt.h=null))}if(Se.D){const tm=Wa.g?Wa.g.getResponseHeader("X-HTTP-Session-Id"):null;tm&&(Se.ya=tm,ci(Se.I,Se.D,tm))}}re.G=3,re.l&&re.l.ua(),re.ba&&(re.R=Date.now()-P.F,re.j.info("Handshake RTT: "+re.R+"ms")),Se=re;var Kt=P;if(Se.qa=ud(Se,Se.J?Se.ia:null,Se.W),Kt.K){Yf(Se.h,Kt);var ii=Kt,qs=Se.L;qs&&(ii.I=qs),ii.B&&(zr(ii),Br(ii)),Se.g=Kt}else gc(Se);0<re.i.length&&jc(re)}else dr[0]!="stop"&&dr[0]!="close"||za(re,7);else re.G==3&&(dr[0]=="stop"||dr[0]=="close"?dr[0]=="stop"?za(re,7):Ns(re):dr[0]!="noop"&&re.l&&re.l.ta(dr),re.v=0)}}hc(4)}catch{}}var ni=class{constructor(P,H){this.g=P,this.map=H}};function Uc(P){this.l=P||10,y.PerformanceNavigationTiming?(P=y.performance.getEntriesByType("navigation"),P=0<P.length&&(P[0].nextHopProtocol=="hq"||P[0].nextHopProtocol=="h2")):P=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=P?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fa(P){return P.h?!0:P.g?P.g.size>=P.j:!1}function xp(P){return P.h?1:P.g?P.g.size:0}function Io(P,H){return P.h?P.h==H:P.g?P.g.has(H):!1}function Lp(P,H){P.g?P.g.add(H):P.h=H}function Yf(P,H){P.h&&P.h==H?P.h=null:P.g&&P.g.has(H)&&P.g.delete(H)}Uc.prototype.cancel=function(){if(this.i=bl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const P of this.g.values())P.cancel();this.g.clear()}};function bl(P){if(P.h!=null)return P.i.concat(P.h.D);if(P.g!=null&&P.g.size!==0){let H=P.i;for(const re of P.g.values())H=H.concat(re.D);return H}return j(P.i)}function au(P){if(P.V&&typeof P.V=="function")return P.V();if(typeof Map<"u"&&P instanceof Map||typeof Set<"u"&&P instanceof Set)return Array.from(P.values());if(typeof P=="string")return P.split("");if(v(P)){for(var H=[],re=P.length,Se=0;Se<re;Se++)H.push(P[Se]);return H}H=[],re=0;for(Se in P)H[re++]=P[Se];return H}function _h(P){if(P.na&&typeof P.na=="function")return P.na();if(!P.V||typeof P.V!="function"){if(typeof Map<"u"&&P instanceof Map)return Array.from(P.keys());if(!(typeof Set<"u"&&P instanceof Set)){if(v(P)||typeof P=="string"){var H=[];P=P.length;for(var re=0;re<P;re++)H.push(re);return H}H=[],re=0;for(const Se in P)H[re++]=Se;return H}}}function Pr(P,H){if(P.forEach&&typeof P.forEach=="function")P.forEach(H,void 0);else if(v(P)||typeof P=="string")Array.prototype.forEach.call(P,H,void 0);else for(var re=_h(P),Se=au(P),qe=Se.length,dt=0;dt<qe;dt++)H.call(void 0,Se[dt],re&&re[dt],P)}var od=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ad(P,H){if(P){P=P.split("&");for(var re=0;re<P.length;re++){var Se=P[re].indexOf("="),qe=null;if(0<=Se){var dt=P[re].substring(0,Se);qe=P[re].substring(Se+1)}else dt=P[re];H(dt,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function ja(P){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,P instanceof ja){this.h=P.h,cd(this,P.j),this.o=P.o,this.g=P.g,wl(this,P.s),this.l=P.l;var H=P.i,re=new ga;re.i=H.i,H.g&&(re.g=new Map(H.g),re.h=H.h),cu(this,re),this.m=P.m}else P&&(H=String(P).match(od))?(this.h=!1,cd(this,H[1]||"",!0),this.o=fr(H[2]||""),this.g=fr(H[3]||"",!0),wl(this,H[4]),this.l=fr(H[5]||"",!0),cu(this,H[6]||"",!0),this.m=fr(H[7]||"")):(this.h=!1,this.i=new ga(null,this.h))}ja.prototype.toString=function(){var P=[],H=this.j;H&&P.push(Tl(H,Eh,!0),":");var re=this.g;return(re||H=="file")&&(P.push("//"),(H=this.o)&&P.push(Tl(H,Eh,!0),"@"),P.push(encodeURIComponent(String(re)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),re=this.s,re!=null&&P.push(":",String(re))),(re=this.l)&&(this.g&&re.charAt(0)!="/"&&P.push("/"),P.push(Tl(re,re.charAt(0)=="/"?Xf:uu,!0))),(re=this.i.toString())&&P.push("?",re),(re=this.m)&&P.push("#",Tl(re,Up)),P.join("")};function ma(P){return new ja(P)}function cd(P,H,re){P.j=re?fr(H,!0):H,P.j&&(P.j=P.j.replace(/:$/,""))}function wl(P,H){if(H){if(H=Number(H),isNaN(H)||0>H)throw Error("Bad port number "+H);P.s=H}else P.s=null}function cu(P,H,re){H instanceof ga?(P.i=H,Ba(P.i,P.h)):(re||(H=Tl(H,Mp)),P.i=new ga(H,P.h))}function ci(P,H,re){P.i.set(H,re)}function lu(P){return ci(P,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),P}function fr(P,H){return P?H?decodeURI(P.replace(/%25/g,"%2525")):decodeURIComponent(P):""}function Tl(P,H,re){return typeof P=="string"?(P=encodeURI(P).replace(H,yh),re&&(P=P.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P):null}function yh(P){return P=P.charCodeAt(0),"%"+(P>>4&15).toString(16)+(P&15).toString(16)}var Eh=/[#\/\?@]/g,uu=/[#\?:]/g,Xf=/[#\?]/g,Mp=/[#\?@]/g,Up=/#/g;function ga(P,H){this.h=this.g=null,this.i=P||null,this.j=!!H}function ms(P){P.g||(P.g=new Map,P.h=0,P.i&&ad(P.i,function(H,re){P.add(decodeURIComponent(H.replace(/\+/g," ")),re)}))}n=ga.prototype,n.add=function(P,H){ms(this),this.i=null,P=Ea(this,P);var re=this.g.get(P);return re||this.g.set(P,re=[]),re.push(H),this.h+=1,this};function _a(P,H){ms(P),H=Ea(P,H),P.g.has(H)&&(P.i=null,P.h-=P.g.get(H).length,P.g.delete(H))}function ya(P,H){return ms(P),H=Ea(P,H),P.g.has(H)}n.forEach=function(P,H){ms(this),this.g.forEach(function(re,Se){re.forEach(function(qe){P.call(H,qe,Se,this)},this)},this)},n.na=function(){ms(this);const P=Array.from(this.g.values()),H=Array.from(this.g.keys()),re=[];for(let Se=0;Se<H.length;Se++){const qe=P[Se];for(let dt=0;dt<qe.length;dt++)re.push(H[Se])}return re},n.V=function(P){ms(this);let H=[];if(typeof P=="string")ya(this,P)&&(H=H.concat(this.g.get(Ea(this,P))));else{P=Array.from(this.g.values());for(let re=0;re<P.length;re++)H=H.concat(P[re])}return H},n.set=function(P,H){return ms(this),this.i=null,P=Ea(this,P),ya(this,P)&&(this.h-=this.g.get(P).length),this.g.set(P,[H]),this.h+=1,this},n.get=function(P,H){return P?(P=this.V(P),0<P.length?String(P[0]):H):H};function du(P,H,re){_a(P,H),0<re.length&&(P.i=null,P.g.set(Ea(P,H),j(re)),P.h+=re.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const P=[],H=Array.from(this.g.keys());for(var re=0;re<H.length;re++){var Se=H[re];const dt=encodeURIComponent(String(Se)),Kt=this.V(Se);for(Se=0;Se<Kt.length;Se++){var qe=dt;Kt[Se]!==""&&(qe+="="+encodeURIComponent(String(Kt[Se]))),P.push(qe)}}return this.i=P.join("&")};function Ea(P,H){return H=String(H),P.j&&(H=H.toLowerCase()),H}function Ba(P,H){H&&!P.j&&(ms(P),P.i=null,P.g.forEach(function(re,Se){var qe=Se.toLowerCase();Se!=qe&&(_a(this,Se),du(this,qe,re))},P)),P.j=H}function Vp(P,H){const re=new Fa;if(y.Image){const Se=new Image;Se.onload=M(ks,re,"TestLoadImage: loaded",!0,H,Se),Se.onerror=M(ks,re,"TestLoadImage: error",!1,H,Se),Se.onabort=M(ks,re,"TestLoadImage: abort",!1,H,Se),Se.ontimeout=M(ks,re,"TestLoadImage: timeout",!1,H,Se),y.setTimeout(function(){Se.ontimeout&&Se.ontimeout()},1e4),Se.src=P}else H(!1)}function Vc(P,H){const re=new Fa,Se=new AbortController,qe=setTimeout(()=>{Se.abort(),ks(re,"TestPingServer: timeout",!1,H)},1e4);fetch(P,{signal:Se.signal}).then(dt=>{clearTimeout(qe),dt.ok?ks(re,"TestPingServer: ok",!0,H):ks(re,"TestPingServer: server error",!1,H)}).catch(()=>{clearTimeout(qe),ks(re,"TestPingServer: error",!1,H)})}function ks(P,H,re,Se,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),Se(re)}catch{}}function Wg(){this.g=new qo}function Rl(P,H,re){const Se=re||"";try{Pr(P,function(qe,dt){let Kt=qe;b(qe)&&(Kt=Ii(qe)),H.push(Se+dt+"="+encodeURIComponent(Kt))})}catch(qe){throw H.push(Se+"type="+encodeURIComponent("_badmap")),qe}}function Cl(P){this.l=P.Ub||null,this.j=P.eb||!1}L(Cl,Hi),Cl.prototype.g=function(){return new hu(this.l,this.j)},Cl.prototype.i=function(P){return function(){return P}}({});function hu(P,H){Cn.call(this),this.D=P,this.o=H,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}L(hu,Cn),n=hu.prototype,n.open=function(P,H){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=P,this.A=H,this.readyState=1,va(this)},n.send=function(P){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const H={headers:this.u,method:this.B,credentials:this.m,cache:void 0};P&&(H.body=P),(this.D||y).fetch(new Request(this.A,H)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fc(this)),this.readyState=0},n.Sa=function(P){if(this.g&&(this.l=P,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=P.headers,this.readyState=2,va(this)),this.g&&(this.readyState=3,va(this),this.g)))if(this.responseType==="arraybuffer")P.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in P){if(this.j=P.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Jf(this)}else P.text().then(this.Ra.bind(this),this.ga.bind(this))};function Jf(P){P.j.read().then(P.Pa.bind(P)).catch(P.ga.bind(P))}n.Pa=function(P){if(this.g){if(this.o&&P.value)this.response.push(P.value);else if(!this.o){var H=P.value?P.value:new Uint8Array(0);(H=this.v.decode(H,{stream:!P.done}))&&(this.response=this.responseText+=H)}P.done?fc(this):va(this),this.readyState==3&&Jf(this)}},n.Ra=function(P){this.g&&(this.response=this.responseText=P,fc(this))},n.Qa=function(P){this.g&&(this.response=P,fc(this))},n.ga=function(){this.g&&fc(this)};function fc(P){P.readyState=4,P.l=null,P.j=null,P.v=null,va(P)}n.setRequestHeader=function(P,H){this.u.append(P,H)},n.getResponseHeader=function(P){return this.h&&this.h.get(P.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const P=[],H=this.h.entries();for(var re=H.next();!re.done;)re=re.value,P.push(re[0]+": "+re[1]),re=H.next();return P.join(`\r
`)};function va(P){P.onreadystatechange&&P.onreadystatechange.call(P)}Object.defineProperty(hu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(P){this.m=P?"include":"same-origin"}});function Il(P){let H="";return ge(P,function(re,Se){H+=Se,H+=":",H+=re,H+=`\r
`}),H}function Re(P,H,re){e:{for(Se in re){var Se=!1;break e}Se=!0}Se||(re=Il(re),typeof P=="string"?re!=null&&encodeURIComponent(String(re)):ci(P,H,re))}function Me(P){Cn.call(this),this.headers=new Map,this.o=P||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}L(Me,Cn);var st=/^https?$/i,qt=["POST","PUT"];n=Me.prototype,n.Ha=function(P){this.J=P},n.ea=function(P,H,re,Se){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+P);H=H?H.toUpperCase():"GET",this.D=P,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Os.g(),this.v=this.o?Ai(this.o):Ai(Os),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(H,String(P),!0),this.B=!1}catch(dt){sr(this,dt);return}if(P=re||"",re=new Map(this.headers),Se)if(Object.getPrototypeOf(Se)===Object.prototype)for(var qe in Se)re.set(qe,Se[qe]);else if(typeof Se.keys=="function"&&typeof Se.get=="function")for(const dt of Se.keys())re.set(dt,Se.get(dt));else throw Error("Unknown input type for opt_headers: "+String(Se));Se=Array.from(re.keys()).find(dt=>dt.toLowerCase()=="content-type"),qe=y.FormData&&P instanceof y.FormData,!(0<=Array.prototype.indexOf.call(qt,H,void 0))||Se||qe||re.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[dt,Kt]of re)this.g.setRequestHeader(dt,Kt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{er(this),this.u=!0,this.g.send(P),this.u=!1}catch(dt){sr(this,dt)}};function sr(P,H){P.h=!1,P.g&&(P.j=!0,P.g.abort(),P.j=!1),P.l=H,P.m=5,Mr(P),Zn(P)}function Mr(P){P.A||(P.A=!0,dn(P,"complete"),dn(P,"error"))}n.abort=function(P){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=P||7,dn(this,"complete"),dn(this,"abort"),Zn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zn(this,!0)),Me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ri(this):this.bb())},n.bb=function(){ri(this)};function ri(P){if(P.h&&typeof f<"u"&&(!P.v[1]||Oi(P)!=4||P.Z()!=2)){if(P.u&&Oi(P)==4)Qn(P.Ea,0,P);else if(dn(P,"readystatechange"),Oi(P)==4){P.h=!1;try{const Kt=P.Z();e:switch(Kt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var H=!0;break e;default:H=!1}var re;if(!(re=H)){var Se;if(Se=Kt===0){var qe=String(P.D).match(od)[1]||null;!qe&&y.self&&y.self.location&&(qe=y.self.location.protocol.slice(0,-1)),Se=!st.test(qe?qe.toLowerCase():"")}re=Se}if(re)dn(P,"complete"),dn(P,"success");else{P.m=6;try{var dt=2<Oi(P)?P.g.statusText:""}catch{dt=""}P.l=dt+" ["+P.Z()+"]",Mr(P)}}finally{Zn(P)}}}}function Zn(P,H){if(P.g){er(P);const re=P.g,Se=P.v[0]?()=>{}:null;P.g=null,P.v=null,H||dn(P,"ready");try{re.onreadystatechange=Se}catch{}}}function er(P){P.I&&(y.clearTimeout(P.I),P.I=null)}n.isActive=function(){return!!this.g};function Oi(P){return P.g?P.g.readyState:0}n.Z=function(){try{return 2<Oi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(P){if(this.g){var H=this.g.responseText;return P&&H.indexOf(P)==0&&(H=H.substring(P.length)),ps(H)}};function Ks(P){try{if(!P.g)return null;if("response"in P.g)return P.g.response;switch(P.H){case"":case"text":return P.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in P.g)return P.g.mozResponseArrayBuffer}return null}catch{return null}}function Fc(P){const H={};P=(P.g&&2<=Oi(P)&&P.g.getAllResponseHeaders()||"").split(`\r
`);for(let Se=0;Se<P.length;Se++){if(K(P[Se]))continue;var re=he(P[Se]);const qe=re[0];if(re=re[1],typeof re!="string")continue;re=re.trim();const dt=H[qe]||[];H[qe]=dt,dt.push(re)}X(H,function(Se){return Se.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ao(P,H,re){return re&&re.internalChannelParams&&re.internalChannelParams[P]||H}function pu(P){this.Aa=0,this.i=[],this.j=new Fa,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ao("failFast",!1,P),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ao("baseRetryDelayMs",5e3,P),this.cb=Ao("retryDelaySeedMs",1e4,P),this.Wa=Ao("forwardChannelMaxRetries",2,P),this.wa=Ao("forwardChannelRequestTimeoutMs",2e4,P),this.pa=P&&P.xmlHttpFactory||void 0,this.Xa=P&&P.Tb||void 0,this.Ca=P&&P.useFetchStreams||!1,this.L=void 0,this.J=P&&P.supportsCrossDomainXhr||!1,this.K="",this.h=new Uc(P&&P.concurrentRequestLimit),this.Da=new Wg,this.P=P&&P.fastHandshake||!1,this.O=P&&P.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=P&&P.Rb||!1,P&&P.xa&&this.j.xa(),P&&P.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&P&&P.detectBufferingProxy||!1,this.ja=void 0,P&&P.longPollingTimeout&&0<P.longPollingTimeout&&(this.ja=P.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=pu.prototype,n.la=8,n.G=1,n.connect=function(P,H,re,Se){Sr(0),this.W=P,this.H=H||{},re&&Se!==void 0&&(this.H.OSID=re,this.H.OAID=Se),this.F=this.X,this.I=ud(this,null,this.W),jc(this)};function Ns(P){if(Qf(P),P.G==3){var H=P.U++,re=ma(P.I);if(ci(re,"SID",P.K),ci(re,"RID",H),ci(re,"TYPE","terminate"),ld(P,re),H=new nn(P,P.j,H),H.L=2,H.v=lu(ma(re)),re=!1,y.navigator&&y.navigator.sendBeacon)try{re=y.navigator.sendBeacon(H.v.toString(),"")}catch{}!re&&y.Image&&(new Image().src=H.v,re=!0),re||(H.g=$g(H.j,null),H.g.ea(H.v)),H.F=Date.now(),Br(H)}lE(P)}function mc(P){P.g&&(Hg(P),P.g.cancel(),P.g=null)}function Qf(P){mc(P),P.u&&(y.clearTimeout(P.u),P.u=null),Zf(P),P.h.cancel(),P.s&&(typeof P.s=="number"&&y.clearTimeout(P.s),P.s=null)}function jc(P){if(!fa(P.h)&&!P.s){P.s=!0;var H=P.Ga;be||De(),Ce||(be(),Ce=!0),Ae.add(H,P),P.B=0}}function Gg(P,H){return xp(P.h)>=P.h.j-(P.s?1:0)?!1:P.s?(P.i=H.D.concat(P.i),!0):P.G==1||P.G==2||P.B>=(P.Va?0:P.Wa)?!1:(P.s=ha(k(P.Ga,P,H),cE(P,P.B)),P.B++,!0)}n.Ga=function(P){if(this.s)if(this.s=null,this.G==1){if(!P){this.U=Math.floor(1e5*Math.random()),P=this.U++;const qe=new nn(this,this.j,P);let dt=this.o;if(this.S&&(dt?(dt=J(dt),ie(dt,this.S)):dt=this.S),this.m!==null||this.O||(qe.H=dt,dt=null),this.P)e:{for(var H=0,re=0;re<this.i.length;re++){t:{var Se=this.i[re];if("__data__"in Se.map&&(Se=Se.map.__data__,typeof Se=="string")){Se=Se.length;break t}Se=void 0}if(Se===void 0)break;if(H+=Se,4096<H){H=re;break e}if(H===4096||re===this.i.length-1){H=re+1;break e}}H=1e3}else H=1e3;H=Sh(this,qe,H),re=ma(this.I),ci(re,"RID",P),ci(re,"CVER",22),this.D&&ci(re,"X-HTTP-Session-Id",this.D),ld(this,re),dt&&(this.O?H="headers="+encodeURIComponent(String(Il(dt)))+"&"+H:this.m&&Re(re,this.m,dt)),Lp(this.h,qe),this.Ua&&ci(re,"TYPE","init"),this.P?(ci(re,"$req",H),ci(re,"SID","null"),qe.T=!0,fo(qe,re,null)):fo(qe,re,H),this.G=2}}else this.G==3&&(P?vh(this,P):this.i.length==0||fa(this.h)||vh(this))};function vh(P,H){var re;H?re=H.l:re=P.U++;const Se=ma(P.I);ci(Se,"SID",P.K),ci(Se,"RID",re),ci(Se,"AID",P.T),ld(P,Se),P.m&&P.o&&Re(Se,P.m,P.o),re=new nn(P,P.j,re,P.B+1),P.m===null&&(re.H=P.o),H&&(P.i=H.D.concat(P.i)),H=Sh(P,re,1e3),re.I=Math.round(.5*P.wa)+Math.round(.5*P.wa*Math.random()),Lp(P.h,re),fo(re,Se,H)}function ld(P,H){P.H&&ge(P.H,function(re,Se){ci(H,Se,re)}),P.l&&Pr({},function(re,Se){ci(H,Se,re)})}function Sh(P,H,re){re=Math.min(P.i.length,re);var Se=P.l?k(P.l.Na,P.l,P):null;e:{var qe=P.i;let dt=-1;for(;;){const Kt=["count="+re];dt==-1?0<re?(dt=qe[0].g,Kt.push("ofs="+dt)):dt=0:Kt.push("ofs="+dt);let ii=!0;for(let qs=0;qs<re;qs++){let dr=qe[qs].g;const mo=qe[qs].map;if(dr-=dt,0>dr)dt=Math.max(0,qe[qs].g-100),ii=!1;else try{Rl(mo,Kt,"req"+dr+"_")}catch{Se&&Se(mo)}}if(ii){Se=Kt.join("&");break e}}}return P=P.i.splice(0,re),H.D=P,Se}function gc(P){if(!P.g&&!P.u){P.Y=1;var H=P.Fa;be||De(),Ce||(be(),Ce=!0),Ae.add(H,P),P.v=0}}function fu(P){return P.g||P.u||3<=P.v?!1:(P.Y++,P.u=ha(k(P.Fa,P),cE(P,P.v)),P.v++,!0)}n.Fa=function(){if(this.u=null,aE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var P=2*this.R;this.j.info("BP detection timer enabled: "+P),this.A=ha(k(this.ab,this),P)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Sr(10),mc(this),aE(this))};function Hg(P){P.A!=null&&(y.clearTimeout(P.A),P.A=null)}function aE(P){P.g=new nn(P,P.j,"rpc",P.Y),P.m===null&&(P.g.H=P.o),P.g.O=0;var H=ma(P.qa);ci(H,"RID","rpc"),ci(H,"SID",P.K),ci(H,"AID",P.T),ci(H,"CI",P.F?"0":"1"),!P.F&&P.ja&&ci(H,"TO",P.ja),ci(H,"TYPE","xmlhttp"),ld(P,H),P.m&&P.o&&Re(H,P.m,P.o),P.L&&(P.g.I=P.L);var re=P.g;P=P.ia,re.L=1,re.v=lu(ma(H)),re.m=null,re.P=!0,Sl(re,P)}n.Za=function(){this.C!=null&&(this.C=null,mc(this),fu(this),Sr(19))};function Zf(P){P.C!=null&&(y.clearTimeout(P.C),P.C=null)}function em(P,H){var re=null;if(P.g==H){Zf(P),Hg(P),P.g=null;var Se=2}else if(Io(P.h,H))re=H.D,Yf(P.h,H),Se=1;else return;if(P.G!=0){if(H.o)if(Se==1){re=H.m?H.m.length:0,H=Date.now()-H.F;var qe=P.B;Se=Xo(),dn(Se,new ou(Se,re)),jc(P)}else gc(P);else if(qe=H.s,qe==3||qe==0&&0<H.X||!(Se==1&&Gg(P,H)||Se==2&&fu(P)))switch(re&&0<re.length&&(H=P.h,H.i=H.i.concat(re)),qe){case 1:za(P,5);break;case 4:za(P,10);break;case 3:za(P,6);break;default:za(P,2)}}}function cE(P,H){let re=P.Ta+Math.floor(Math.random()*P.cb);return P.isActive()||(re*=2),re*H}function za(P,H){if(P.j.info("Error code "+H),H==2){var re=k(P.fb,P),Se=P.Xa;const qe=!Se;Se=new ja(Se||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||cd(Se,"https"),lu(Se),qe?Vp(Se.toString(),re):Vc(Se.toString(),re)}else Sr(2);P.G=0,P.l&&P.l.sa(H),lE(P),Qf(P)}n.fb=function(P){P?(this.j.info("Successfully pinged google.com"),Sr(2)):(this.j.info("Failed to ping google.com"),Sr(1))};function lE(P){if(P.G=0,P.ka=[],P.l){const H=bl(P.h);(H.length!=0||P.i.length!=0)&&(z(P.ka,H),z(P.ka,P.i),P.h.i.length=0,j(P.i),P.i.length=0),P.l.ra()}}function ud(P,H,re){var Se=re instanceof ja?ma(re):new ja(re);if(Se.g!="")H&&(Se.g=H+"."+Se.g),wl(Se,Se.s);else{var qe=y.location;Se=qe.protocol,H=H?H+"."+qe.hostname:qe.hostname,qe=+qe.port;var dt=new ja(null);Se&&cd(dt,Se),H&&(dt.g=H),qe&&wl(dt,qe),re&&(dt.l=re),Se=dt}return re=P.D,H=P.ya,re&&H&&ci(Se,re,H),ci(Se,"VER",P.la),ld(P,Se),Se}function $g(P,H,re){if(H&&!P.J)throw Error("Can't create secondary domain capable XhrIo object.");return H=P.Ca&&!P.pa?new Me(new Cl({eb:re})):new Me(P.pa),H.Ha(P.J),H}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Kg(){}n=Kg.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Wn(){}Wn.prototype.g=function(P,H){return new Sa(P,H)};function Sa(P,H){Cn.call(this),this.g=new pu(H),this.l=P,this.h=H&&H.messageUrlParams||null,P=H&&H.messageHeaders||null,H&&H.clientProtocolHeaderRequired&&(P?P["X-Client-Protocol"]="webchannel":P={"X-Client-Protocol":"webchannel"}),this.g.o=P,P=H&&H.initMessageHeaders||null,H&&H.messageContentType&&(P?P["X-WebChannel-Content-Type"]=H.messageContentType:P={"X-WebChannel-Content-Type":H.messageContentType}),H&&H.va&&(P?P["X-WebChannel-Client-Profile"]=H.va:P={"X-WebChannel-Client-Profile":H.va}),this.g.S=P,(P=H&&H.Sb)&&!K(P)&&(this.g.m=P),this.v=H&&H.supportsCrossDomainXhr||!1,this.u=H&&H.sendRawJson||!1,(H=H&&H.httpSessionIdParam)&&!K(H)&&(this.g.D=H,P=this.h,P!==null&&H in P&&(P=this.h,H in P&&delete P[H])),this.j=new mu(this)}L(Sa,Cn),Sa.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Sa.prototype.close=function(){Ns(this.g)},Sa.prototype.o=function(P){var H=this.g;if(typeof P=="string"){var re={};re.__data__=P,P=re}else this.u&&(re={},re.__data__=Ii(P),P=re);H.i.push(new ni(H.Ya++,P)),H.G==3&&jc(H)},Sa.prototype.N=function(){this.g.l=null,delete this.j,Ns(this.g),delete this.g,Sa.aa.N.call(this)};function uE(P){da.call(this),P.__headers__&&(this.headers=P.__headers__,this.statusCode=P.__status__,delete P.__headers__,delete P.__status__);var H=P.__sm__;if(H){e:{for(const re in H){P=re;break e}P=void 0}(this.i=P)&&(P=this.i,H=H!==null&&P in H?H[P]:void 0),this.data=H}else this.data=P}L(uE,da);function dE(){Yo.call(this),this.status=1}L(dE,Yo);function mu(P){this.g=P}L(mu,Kg),mu.prototype.ua=function(){dn(this.g,"a")},mu.prototype.ta=function(P){dn(this.g,new uE(P))},mu.prototype.sa=function(P){dn(this.g,new dE)},mu.prototype.ra=function(){dn(this.g,"b")},Wn.prototype.createWebChannel=Wn.prototype.g,Sa.prototype.send=Sa.prototype.o,Sa.prototype.open=Sa.prototype.m,Sa.prototype.close=Sa.prototype.close,Aie=function(){return new Wn},Iie=function(){return Xo()},Cie=po,BV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},vl.NO_ERROR=0,vl.TIMEOUT=8,vl.HTTP_ERROR=6,wO=vl,fh.COMPLETE="complete",Rie=fh,Kn.EventType=cs,cs.OPEN="a",cs.CLOSE="b",cs.ERROR="c",cs.MESSAGE="d",Cn.prototype.listen=Cn.prototype.K,nR=Kn,Me.prototype.listenOnce=Me.prototype.L,Me.prototype.getLastError=Me.prototype.Ka,Me.prototype.getLastErrorCode=Me.prototype.Ba,Me.prototype.getStatus=Me.prototype.Z,Me.prototype.getResponseJson=Me.prototype.Oa,Me.prototype.getResponseText=Me.prototype.oa,Me.prototype.send=Me.prototype.ea,Me.prototype.setWithCredentials=Me.prototype.Ha,Tie=Me}).apply(typeof z1<"u"?z1:typeof self<"u"?self:typeof window<"u"?window:{});const ZX="@firebase/firestore",eJ="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}oc.UNAUTHENTICATED=new oc(null),oc.GOOGLE_CREDENTIALS=new oc("google-credentials-uid"),oc.FIRST_PARTY=new oc("first-party-uid"),oc.MOCK_USER=new oc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let j0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ky=new i5("@firebase/firestore");function SS(){return Ky.logLevel}function un(n,...t){if(Ky.logLevel<=Fr.DEBUG){const i=t.map(f5);Ky.debug(`Firestore (${j0}): ${n}`,...i)}}function Wf(n,...t){if(Ky.logLevel<=Fr.ERROR){const i=t.map(f5);Ky.error(`Firestore (${j0}): ${n}`,...i)}}function v0(n,...t){if(Ky.logLevel<=Fr.WARN){const i=t.map(f5);Ky.warn(`Firestore (${j0}): ${n}`,...i)}}function f5(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jn(n="Unexpected state"){const t=`FIRESTORE (${j0}) INTERNAL ASSERTION FAILED: `+n;throw Wf(t),new Error(t)}function vi(n,t){n||Jn()}function ur(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fn extends dh{constructor(t,i){super(t,i),this.code=t,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pie{constructor(t,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class g5e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,i){t.enqueueRetryable(()=>i(oc.UNAUTHENTICATED))}shutdown(){}}class _5e{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,i){this.changeListener=i,t.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class y5e{constructor(t){this.t=t,this.currentUser=oc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,i){vi(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,i(v)):Promise.resolve();let d=new xf;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new xf,t.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},y=v=>{un("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(v=>y(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?y(v):(un("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new xf)}},0),f()}getToken(){const t=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==t?(un("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(vi(typeof a.accessToken=="string"),new Pie(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return vi(t===null||typeof t=="string"),new oc(t)}}class E5e{constructor(t,i,a){this.l=t,this.h=i,this.P=a,this.type="FirstParty",this.user=oc.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class v5e{constructor(t,i,a){this.l=t,this.h=i,this.P=a}getToken(){return Promise.resolve(new E5e(this.l,this.h,this.P))}start(t,i){t.enqueueRetryable(()=>i(oc.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tJ{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class S5e{constructor(t,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,hl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,i){vi(this.o===void 0);const a=d=>{d.error!=null&&un("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,un("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?i(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{un("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):un("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new tJ(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(i=>i?(vi(typeof i.token=="string"),this.R=i.token,new tJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b5e(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(i);else for(let a=0;a<n;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oie(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kie{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=b5e(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<i&&(a+=t.charAt(l[d]%62))}return a}}function Cr(n,t){return n<t?-1:n>t?1:0}function zV(n,t){let i=0;for(;i<n.length&&i<t.length;){const a=n.codePointAt(i),l=t.codePointAt(i);if(a!==l){if(a<128&&l<128)return Cr(a,l);{const d=Oie(),f=w5e(d.encode(nJ(n,i)),d.encode(nJ(t,i)));return f!==0?f:Cr(a,l)}}i+=a>65535?2:1}return Cr(n.length,t.length)}function nJ(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function w5e(n,t){for(let i=0;i<n.length&&i<t.length;++i)if(n[i]!==t[i])return Cr(n[i],t[i]);return Cr(n.length,t.length)}function S0(n,t,i){return n.length===t.length&&n.every((a,l)=>i(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rJ=-62135596800,iJ=1e6;class Wo{static now(){return Wo.fromMillis(Date.now())}static fromDate(t){return Wo.fromMillis(t.getTime())}static fromMillis(t){const i=Math.floor(t/1e3),a=Math.floor((t-1e3*i)*iJ);return new Wo(i,a)}constructor(t,i){if(this.seconds=t,this.nanoseconds=i,i<0)throw new fn(kt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new fn(kt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(t<rJ)throw new fn(kt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new fn(kt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/iJ}_compareTo(t){return this.seconds===t.seconds?Cr(this.nanoseconds,t.nanoseconds):Cr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-rJ;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{static fromTimestamp(t){return new ar(t)}static min(){return new ar(new Wo(0,0))}static max(){return new ar(new Wo(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sJ="__name__";class lp{constructor(t,i,a){i===void 0?i=0:i>t.length&&Jn(),a===void 0?a=t.length-i:a>t.length-i&&Jn(),this.segments=t,this.offset=i,this.len=a}get length(){return this.len}isEqual(t){return lp.comparator(this,t)===0}child(t){const i=this.segments.slice(this.offset,this.limit());return t instanceof lp?t.forEach(a=>{i.push(a)}):i.push(t),this.construct(i)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0}forEach(t){for(let i=this.offset,a=this.limit();i<a;i++)t(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,i){const a=Math.min(t.length,i.length);for(let l=0;l<a;l++){const d=lp.compareSegments(t.get(l),i.get(l));if(d!==0)return d}return Cr(t.length,i.length)}static compareSegments(t,i){const a=lp.isNumericId(t),l=lp.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?lp.extractNumericId(t).compare(lp.extractNumericId(i)):zV(t,i)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return wg.fromString(t.substring(4,t.length-2))}}class os extends lp{construct(t,i,a){return new os(t,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const i=[];for(const a of t){if(a.indexOf("//")>=0)throw new fn(kt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new os(i)}static emptyPath(){return new os([])}}const T5e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class La extends lp{construct(t,i,a){return new La(t,i,a)}static isValidIdentifier(t){return T5e.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),La.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===sJ}static keyField(){return new La([sJ])}static fromServerFormat(t){const i=[];let a="",l=0;const d=()=>{if(a.length===0)throw new fn(kt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let f=!1;for(;l<t.length;){const y=t[l];if(y==="\\"){if(l+1===t.length)throw new fn(kt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new fn(kt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else y==="`"?(f=!f,l++):y!=="."||f?(a+=y,l++):(d(),l++)}if(d(),f)throw new fn(kt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new La(i)}static emptyPath(){return new La([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(t){this.path=t}static fromPath(t){return new kn(os.fromString(t))}static fromName(t){return new kn(os.fromString(t).popFirst(5))}static empty(){return new kn(os.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&os.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,i){return os.comparator(t.path,i.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new kn(new os(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iC=-1;function R5e(n,t){const i=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=ar.fromTimestamp(a===1e9?new Wo(i+1,0):new Wo(i,a));return new Pg(l,kn.empty(),t)}function C5e(n){return new Pg(n.readTime,n.key,iC)}class Pg{constructor(t,i,a){this.readTime=t,this.documentKey=i,this.largestBatchId=a}static min(){return new Pg(ar.min(),kn.empty(),iC)}static max(){return new Pg(ar.max(),kn.empty(),iC)}}function I5e(n,t){let i=n.readTime.compareTo(t.readTime);return i!==0?i:(i=kn.comparator(n.documentKey,t.documentKey),i!==0?i:Cr(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A5e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class P5e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B0(n){if(n.code!==kt.FAILED_PRECONDITION||n.message!==A5e)throw n;un("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(t){return this.next(void 0,t)}next(t,i){return this.callbackAttached&&Jn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(t,this.result):new Ot((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(i,d).next(a,l)}})}toPromise(){return new Promise((t,i)=>{this.next(t,i)})}wrapUserFunction(t){try{const i=t();return i instanceof Ot?i:Ot.resolve(i)}catch(i){return Ot.reject(i)}}wrapSuccess(t,i){return t?this.wrapUserFunction(()=>t(i)):Ot.resolve(i)}wrapFailure(t,i){return t?this.wrapUserFunction(()=>t(i)):Ot.reject(i)}static resolve(t){return new Ot((i,a)=>{i(t)})}static reject(t){return new Ot((i,a)=>{a(t)})}static waitFor(t){return new Ot((i,a)=>{let l=0,d=0,f=!1;t.forEach(y=>{++l,y.next(()=>{++d,f&&d===l&&i()},v=>a(v))}),f=!0,d===l&&i()})}static or(t){let i=Ot.resolve(!1);for(const a of t)i=i.next(l=>l?Ot.resolve(l):a());return i}static forEach(t,i){const a=[];return t.forEach((l,d)=>{a.push(i.call(this,l,d))}),this.waitFor(a)}static mapArray(t,i){return new Ot((a,l)=>{const d=t.length,f=new Array(d);let y=0;for(let v=0;v<d;v++){const b=v;i(t[b]).next(R=>{f[b]=R,++y,y===d&&a(f)},R=>l(R))}})}static doWhile(t,i){return new Ot((a,l)=>{const d=()=>{t()===!0?i().next(()=>{d()},l):a()};d()})}}function O5e(n){const t=n.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function z0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=a=>this.oe(a),this._e=a=>i.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}aN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m5=-1;function cN(n){return n==null}function ik(n){return n===0&&1/n==-1/0}function k5e(n){return typeof n=="number"&&Number.isInteger(n)&&!ik(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nie="";function N5e(n){let t="";for(let i=0;i<n.length;i++)t.length>0&&(t=oJ(t)),t=D5e(n.get(i),t);return oJ(t)}function D5e(n,t){let i=t;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":i+="";break;case Nie:i+="";break;default:i+=d}}return i}function oJ(n){return n+Nie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aJ(n){let t=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&t++;return t}function Bg(n,t){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&t(i,n[i])}function Die(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(t,i){this.comparator=t,this.root=i||Da.EMPTY}insert(t,i){return new Ps(this.comparator,this.root.insert(t,i,this.comparator).copy(null,null,Da.BLACK,null,null))}remove(t){return new Ps(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Da.BLACK,null,null))}get(t){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(t,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(t){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((i,a)=>(t(i,a),!1))}toString(){const t=[];return this.inorderTraversal((i,a)=>(t.push(`${i}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new W1(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new W1(this.root,t,this.comparator,!1)}getReverseIterator(){return new W1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new W1(this.root,t,this.comparator,!0)}}class W1{constructor(t,i,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=i?a(t.key,i):1,i&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const i={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Da{constructor(t,i,a,l,d){this.key=t,this.value=i,this.color=a??Da.RED,this.left=l??Da.EMPTY,this.right=d??Da.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,i,a,l,d){return new Da(t??this.key,i??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,i,a),null):d===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(t,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Da.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,i){let a,l=this;if(i(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(t,l.key)===0){if(l.right.isEmpty())return Da.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Da.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Da.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Jn();const t=this.left.check();if(t!==this.right.check())throw Jn();return t+(this.isRed()?0:1)}}Da.EMPTY=null,Da.RED=!0,Da.BLACK=!1;Da.EMPTY=new class{constructor(){this.size=0}get key(){throw Jn()}get value(){throw Jn()}get color(){throw Jn()}get left(){throw Jn()}get right(){throw Jn()}copy(t,i,a,l,d){return this}insert(t,i,a){return new Da(t,i)}remove(t,i){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(t){this.comparator=t,this.data=new Ps(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((i,a)=>(t(i),!1))}forEachInRange(t,i){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;i(l.key)}}forEachWhile(t,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const i=this.data.getIteratorFrom(t);return i.hasNext()?i.getNext().key:null}getIterator(){return new cJ(this.data.getIterator())}getIteratorFrom(t){return new cJ(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let i=this;return i.size<t.size&&(i=t,t=this),t.forEach(a=>{i=i.add(a)}),i}isEqual(t){if(!(t instanceof Go)||this.size!==t.size)return!1;const i=this.data.getIterator(),a=t.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(i=>{t.push(i)}),t}toString(){const t=[];return this.forEach(i=>t.push(i)),"SortedSet("+t.toString()+")"}copy(t){const i=new Go(this.comparator);return i.data=t,i}}class cJ{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(t){this.fields=t,t.sort(La.comparator)}static empty(){return new Jl([])}unionWith(t){let i=new Go(La.comparator);for(const a of this.fields)i=i.add(a);for(const a of t)i=i.add(a);return new Jl(i.toArray())}covers(t){for(const i of this.fields)if(i.isPrefixOf(t))return!0;return!1}isEqual(t){return S0(this.fields,t.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xie extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(t){this.binaryString=t}static fromBase64String(t){const i=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new xie("Invalid base64 string: "+d):d}}(t);return new Ua(i)}static fromUint8Array(t){const i=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(t);return new Ua(i)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Cr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ua.EMPTY_BYTE_STRING=new Ua("");const x5e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Og(n){if(vi(!!n),typeof n=="string"){let t=0;const i=x5e.exec(n);if(vi(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:oo(n.seconds),nanos:oo(n.nanos)}}function oo(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function kg(n){return typeof n=="string"?Ua.fromBase64String(n):Ua.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lie="server_timestamp",Mie="__type__",Uie="__previous_value__",Vie="__local_write_time__";function g5(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[Mie])===null||i===void 0?void 0:i.stringValue)===Lie}function lN(n){const t=n.mapValue.fields[Uie];return g5(t)?lN(t):t}function sC(n){const t=Og(n.mapValue.fields[Vie].timestampValue);return new Wo(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5e{constructor(t,i,a,l,d,f,y,v,b){this.databaseId=t,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=y,this.longPollingOptions=v,this.useFetchStreams=b}}const sk="(default)";class oC{constructor(t,i){this.projectId=t,this.database=i||sk}static empty(){return new oC("","")}get isDefaultDatabase(){return this.database===sk}isEqual(t){return t instanceof oC&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fie="__type__",M5e="__max__",G1={mapValue:{}},jie="__vector__",ok="value";function Ng(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?g5(n)?4:V5e(n)?9007199254740991:U5e(n)?10:11:Jn()}function Np(n,t){if(n===t)return!0;const i=Ng(n);if(i!==Ng(t))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return sC(n).isEqual(sC(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=Og(l.timestampValue),y=Og(d.timestampValue);return f.seconds===y.seconds&&f.nanos===y.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(l,d){return kg(l.bytesValue).isEqual(kg(d.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(l,d){return oo(l.geoPointValue.latitude)===oo(d.geoPointValue.latitude)&&oo(l.geoPointValue.longitude)===oo(d.geoPointValue.longitude)}(n,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return oo(l.integerValue)===oo(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=oo(l.doubleValue),y=oo(d.doubleValue);return f===y?ik(f)===ik(y):isNaN(f)&&isNaN(y)}return!1}(n,t);case 9:return S0(n.arrayValue.values||[],t.arrayValue.values||[],Np);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},y=d.mapValue.fields||{};if(aJ(f)!==aJ(y))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(y[v]===void 0||!Np(f[v],y[v])))return!1;return!0}(n,t);default:return Jn()}}function aC(n,t){return(n.values||[]).find(i=>Np(i,t))!==void 0}function b0(n,t){if(n===t)return 0;const i=Ng(n),a=Ng(t);if(i!==a)return Cr(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return Cr(n.booleanValue,t.booleanValue);case 2:return function(d,f){const y=oo(d.integerValue||d.doubleValue),v=oo(f.integerValue||f.doubleValue);return y<v?-1:y>v?1:y===v?0:isNaN(y)?isNaN(v)?0:-1:1}(n,t);case 3:return lJ(n.timestampValue,t.timestampValue);case 4:return lJ(sC(n),sC(t));case 5:return zV(n.stringValue,t.stringValue);case 6:return function(d,f){const y=kg(d),v=kg(f);return y.compareTo(v)}(n.bytesValue,t.bytesValue);case 7:return function(d,f){const y=d.split("/"),v=f.split("/");for(let b=0;b<y.length&&b<v.length;b++){const R=Cr(y[b],v[b]);if(R!==0)return R}return Cr(y.length,v.length)}(n.referenceValue,t.referenceValue);case 8:return function(d,f){const y=Cr(oo(d.latitude),oo(f.latitude));return y!==0?y:Cr(oo(d.longitude),oo(f.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return uJ(n.arrayValue,t.arrayValue);case 10:return function(d,f){var y,v,b,R;const I=d.fields||{},k=f.fields||{},M=(y=I[ok])===null||y===void 0?void 0:y.arrayValue,L=(v=k[ok])===null||v===void 0?void 0:v.arrayValue,j=Cr(((b=M==null?void 0:M.values)===null||b===void 0?void 0:b.length)||0,((R=L==null?void 0:L.values)===null||R===void 0?void 0:R.length)||0);return j!==0?j:uJ(M,L)}(n.mapValue,t.mapValue);case 11:return function(d,f){if(d===G1.mapValue&&f===G1.mapValue)return 0;if(d===G1.mapValue)return 1;if(f===G1.mapValue)return-1;const y=d.fields||{},v=Object.keys(y),b=f.fields||{},R=Object.keys(b);v.sort(),R.sort();for(let I=0;I<v.length&&I<R.length;++I){const k=zV(v[I],R[I]);if(k!==0)return k;const M=b0(y[v[I]],b[R[I]]);if(M!==0)return M}return Cr(v.length,R.length)}(n.mapValue,t.mapValue);default:throw Jn()}}function lJ(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return Cr(n,t);const i=Og(n),a=Og(t),l=Cr(i.seconds,a.seconds);return l!==0?l:Cr(i.nanos,a.nanos)}function uJ(n,t){const i=n.values||[],a=t.values||[];for(let l=0;l<i.length&&l<a.length;++l){const d=b0(i[l],a[l]);if(d)return d}return Cr(i.length,a.length)}function w0(n){return WV(n)}function WV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const a=Og(i);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return kg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return kn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let a="[",l=!0;for(const d of i.values||[])l?l=!1:a+=",",a+=WV(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${WV(i.fields[f])}`;return l+"}"}(n.mapValue):Jn()}function TO(n){switch(Ng(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=lN(n);return t?16+TO(t):16;case 5:return 2*n.stringValue.length;case 6:return kg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+TO(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Bg(a.fields,(d,f)=>{l+=d.length+TO(f)}),l}(n.mapValue);default:throw Jn()}}function dJ(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function GV(n){return!!n&&"integerValue"in n}function _5(n){return!!n&&"arrayValue"in n}function hJ(n){return!!n&&"nullValue"in n}function pJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function RO(n){return!!n&&"mapValue"in n}function U5e(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[Fie])===null||i===void 0?void 0:i.stringValue)===jie}function CR(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Bg(n.mapValue.fields,(i,a)=>t.mapValue.fields[i]=CR(a)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)t.arrayValue.values[i]=CR(n.arrayValue.values[i]);return t}return Object.assign({},n)}function V5e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===M5e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(t){this.value=t}static empty(){return new pl({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let i=this.value;for(let a=0;a<t.length-1;++a)if(i=(i.mapValue.fields||{})[t.get(a)],!RO(i))return null;return i=(i.mapValue.fields||{})[t.lastSegment()],i||null}}set(t,i){this.getFieldsMap(t.popLast())[t.lastSegment()]=CR(i)}setAll(t){let i=La.emptyPath(),a={},l=[];t.forEach((f,y)=>{if(!i.isImmediateParentOf(y)){const v=this.getFieldsMap(i);this.applyChanges(v,a,l),a={},l=[],i=y.popLast()}f?a[y.lastSegment()]=CR(f):l.push(y.lastSegment())});const d=this.getFieldsMap(i);this.applyChanges(d,a,l)}delete(t){const i=this.field(t.popLast());RO(i)&&i.mapValue.fields&&delete i.mapValue.fields[t.lastSegment()]}isEqual(t){return Np(this.value,t.value)}getFieldsMap(t){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=i.mapValue.fields[t.get(a)];RO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[t.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(t,i,a){Bg(i,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new pl(CR(this.value))}}function Bie(n){const t=[];return Bg(n.fields,(i,a)=>{const l=new La([i]);if(RO(a)){const d=Bie(a.mapValue).fields;if(d.length===0)t.push(l);else for(const f of d)t.push(l.child(f))}else t.push(l)}),new Jl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(t,i,a,l,d,f,y){this.key=t,this.documentType=i,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=y}static newInvalidDocument(t){return new ac(t,0,ar.min(),ar.min(),ar.min(),pl.empty(),0)}static newFoundDocument(t,i,a,l){return new ac(t,1,i,ar.min(),a,l,0)}static newNoDocument(t,i){return new ac(t,2,i,ar.min(),ar.min(),pl.empty(),0)}static newUnknownDocument(t,i){return new ac(t,3,i,ar.min(),ar.min(),pl.empty(),2)}convertToFoundDocument(t,i){return!this.createTime.isEqual(ar.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=pl.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=pl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ar.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ac&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ac(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(t,i){this.position=t,this.inclusive=i}}function fJ(n,t,i){let a=0;for(let l=0;l<n.position.length;l++){const d=t[l],f=n.position[l];if(d.field.isKeyField()?a=kn.comparator(kn.fromName(f.referenceValue),i.key):a=b0(f,i.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function mJ(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!Np(n.position[i],t.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(t,i="asc"){this.field=t,this.dir=i}}function F5e(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zie{}class wo extends zie{constructor(t,i,a){super(),this.field=t,this.op=i,this.value=a}static create(t,i,a){return t.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(t,i,a):new B5e(t,i,a):i==="array-contains"?new G5e(t,a):i==="in"?new H5e(t,a):i==="not-in"?new $5e(t,a):i==="array-contains-any"?new K5e(t,a):new wo(t,i,a)}static createKeyFieldInFilter(t,i,a){return i==="in"?new z5e(t,a):new W5e(t,a)}matches(t){const i=t.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(b0(i,this.value)):i!==null&&Ng(this.value)===Ng(i)&&this.matchesComparison(b0(i,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Jn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ch extends zie{constructor(t,i){super(),this.filters=t,this.op=i,this.ce=null}static create(t,i){return new ch(t,i)}matches(t){return Wie(this)?this.filters.find(i=>!i.matches(t))===void 0:this.filters.find(i=>i.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,i)=>t.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Wie(n){return n.op==="and"}function Gie(n){return j5e(n)&&Wie(n)}function j5e(n){for(const t of n.filters)if(t instanceof ch)return!1;return!0}function HV(n){if(n instanceof wo)return n.field.canonicalString()+n.op.toString()+w0(n.value);if(Gie(n))return n.filters.map(t=>HV(t)).join(",");{const t=n.filters.map(i=>HV(i)).join(",");return`${n.op}(${t})`}}function Hie(n,t){return n instanceof wo?function(a,l){return l instanceof wo&&a.op===l.op&&a.field.isEqual(l.field)&&Np(a.value,l.value)}(n,t):n instanceof ch?function(a,l){return l instanceof ch&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,y)=>d&&Hie(f,l.filters[y]),!0):!1}(n,t):void Jn()}function $ie(n){return n instanceof wo?function(i){return`${i.field.canonicalString()} ${i.op} ${w0(i.value)}`}(n):n instanceof ch?function(i){return i.op.toString()+" {"+i.getFilters().map($ie).join(" ,")+"}"}(n):"Filter"}class B5e extends wo{constructor(t,i,a){super(t,i,a),this.key=kn.fromName(a.referenceValue)}matches(t){const i=kn.comparator(t.key,this.key);return this.matchesComparison(i)}}class z5e extends wo{constructor(t,i){super(t,"in",i),this.keys=Kie("in",i)}matches(t){return this.keys.some(i=>i.isEqual(t.key))}}class W5e extends wo{constructor(t,i){super(t,"not-in",i),this.keys=Kie("not-in",i)}matches(t){return!this.keys.some(i=>i.isEqual(t.key))}}function Kie(n,t){var i;return(((i=t.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>kn.fromName(a.referenceValue))}class G5e extends wo{constructor(t,i){super(t,"array-contains",i)}matches(t){const i=t.data.field(this.field);return _5(i)&&aC(i.arrayValue,this.value)}}class H5e extends wo{constructor(t,i){super(t,"in",i)}matches(t){const i=t.data.field(this.field);return i!==null&&aC(this.value.arrayValue,i)}}class $5e extends wo{constructor(t,i){super(t,"not-in",i)}matches(t){if(aC(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=t.data.field(this.field);return i!==null&&!aC(this.value.arrayValue,i)}}class K5e extends wo{constructor(t,i){super(t,"array-contains-any",i)}matches(t){const i=t.data.field(this.field);return!(!_5(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>aC(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q5e{constructor(t,i=null,a=[],l=[],d=null,f=null,y=null){this.path=t,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=y,this.le=null}}function gJ(n,t=null,i=[],a=[],l=null,d=null,f=null){return new q5e(n,t,i,a,l,d,f)}function y5(n){const t=ur(n);if(t.le===null){let i=t.path.canonicalString();t.collectionGroup!==null&&(i+="|cg:"+t.collectionGroup),i+="|f:",i+=t.filters.map(a=>HV(a)).join(","),i+="|ob:",i+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),cN(t.limit)||(i+="|l:",i+=t.limit),t.startAt&&(i+="|lb:",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(a=>w0(a)).join(",")),t.endAt&&(i+="|ub:",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(a=>w0(a)).join(",")),t.le=i}return t.le}function E5(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!F5e(n.orderBy[i],t.orderBy[i]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!Hie(n.filters[i],t.filters[i]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!mJ(n.startAt,t.startAt)&&mJ(n.endAt,t.endAt)}function $V(n){return kn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NC{constructor(t,i=null,a=[],l=[],d=null,f="F",y=null,v=null){this.path=t,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=y,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function Y5e(n,t,i,a,l,d,f,y){return new NC(n,t,i,a,l,d,f,y)}function v5(n){return new NC(n)}function _J(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function qie(n){return n.collectionGroup!==null}function IR(n){const t=ur(n);if(t.he===null){t.he=[];const i=new Set;for(const d of t.explicitOrderBy)t.he.push(d),i.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(f){let y=new Go(La.comparator);return f.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(y=y.add(b.field))})}),y})(t).forEach(d=>{i.has(d.canonicalString())||d.isKeyField()||t.he.push(new ck(d,a))}),i.has(La.keyField().canonicalString())||t.he.push(new ck(La.keyField(),a))}return t.he}function Pp(n){const t=ur(n);return t.Pe||(t.Pe=X5e(t,IR(n))),t.Pe}function X5e(n,t){if(n.limitType==="F")return gJ(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new ck(l.field,d)});const i=n.endAt?new ak(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new ak(n.startAt.position,n.startAt.inclusive):null;return gJ(n.path,n.collectionGroup,t,n.filters,n.limit,i,a)}}function KV(n,t){const i=n.filters.concat([t]);return new NC(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function lk(n,t,i){return new NC(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,i,n.startAt,n.endAt)}function uN(n,t){return E5(Pp(n),Pp(t))&&n.limitType===t.limitType}function Yie(n){return`${y5(Pp(n))}|lt:${n.limitType}`}function bS(n){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>$ie(l)).join(", ")}]`),cN(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>w0(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>w0(l)).join(",")),`Target(${a})`}(Pp(n))}; limitType=${n.limitType})`}function dN(n,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):kn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,t)&&function(a,l){for(const d of IR(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,t)&&function(a,l){return!(a.startAt&&!function(f,y,v){const b=fJ(f,y,v);return f.inclusive?b<=0:b<0}(a.startAt,IR(a),l)||a.endAt&&!function(f,y,v){const b=fJ(f,y,v);return f.inclusive?b>=0:b>0}(a.endAt,IR(a),l))}(n,t)}function J5e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Xie(n){return(t,i)=>{let a=!1;for(const l of IR(n)){const d=Q5e(l,t,i);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function Q5e(n,t,i){const a=n.field.isKeyField()?kn.comparator(t.key,i.key):function(d,f,y){const v=f.data.field(d),b=y.data.field(d);return v!==null&&b!==null?b0(v,b):Jn()}(n.field,t,i);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return Jn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(t,i){this.mapKeyFn=t,this.equalsFn=i,this.inner={},this.innerSize=0}get(t){const i=this.mapKeyFn(t),a=this.inner[i];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,i){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,i]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,i]);l.push([t,i]),this.innerSize++}delete(t){const i=this.mapKeyFn(t),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Bg(this.inner,(i,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return Die(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z5e=new Ps(kn.comparator);function Gf(){return Z5e}const Jie=new Ps(kn.comparator);function rR(...n){let t=Jie;for(const i of n)t=t.insert(i.key,i);return t}function Qie(n){let t=Jie;return n.forEach((i,a)=>t=t.insert(i,a.overlayedDocument)),t}function Ty(){return AR()}function Zie(){return AR()}function AR(){return new Zy(n=>n.toString(),(n,t)=>n.isEqual(t))}const e3e=new Ps(kn.comparator),t3e=new Go(kn.comparator);function jr(...n){let t=t3e;for(const i of n)t=t.add(i);return t}const n3e=new Go(Cr);function r3e(){return n3e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S5(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ik(t)?"-0":t}}function ese(n){return{integerValue:""+n}}function i3e(n,t){return k5e(t)?ese(t):S5(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(){this._=void 0}}function s3e(n,t,i){return n instanceof uk?function(l,d){const f={fields:{[Mie]:{stringValue:Lie},[Vie]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&g5(d)&&(d=lN(d)),d&&(f.fields[Uie]=d),{mapValue:f}}(i,t):n instanceof T0?nse(n,t):n instanceof R0?rse(n,t):function(l,d){const f=tse(l,d),y=yJ(f)+yJ(l.Ie);return GV(f)&&GV(l.Ie)?ese(y):S5(l.serializer,y)}(n,t)}function o3e(n,t,i){return n instanceof T0?nse(n,t):n instanceof R0?rse(n,t):i}function tse(n,t){return n instanceof dk?function(a){return GV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class uk extends hN{}class T0 extends hN{constructor(t){super(),this.elements=t}}function nse(n,t){const i=ise(t);for(const a of n.elements)i.some(l=>Np(l,a))||i.push(a);return{arrayValue:{values:i}}}class R0 extends hN{constructor(t){super(),this.elements=t}}function rse(n,t){let i=ise(t);for(const a of n.elements)i=i.filter(l=>!Np(l,a));return{arrayValue:{values:i}}}class dk extends hN{constructor(t,i){super(),this.serializer=t,this.Ie=i}}function yJ(n){return oo(n.integerValue||n.doubleValue)}function ise(n){return _5(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sse{constructor(t,i){this.field=t,this.transform=i}}function a3e(n,t){return n.field.isEqual(t.field)&&function(a,l){return a instanceof T0&&l instanceof T0||a instanceof R0&&l instanceof R0?S0(a.elements,l.elements,Np):a instanceof dk&&l instanceof dk?Np(a.Ie,l.Ie):a instanceof uk&&l instanceof uk}(n.transform,t.transform)}class c3e{constructor(t,i){this.version=t,this.transformResults=i}}class Qu{constructor(t,i){this.updateTime=t,this.exists=i}static none(){return new Qu}static exists(t){return new Qu(void 0,t)}static updateTime(t){return new Qu(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function CO(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class pN{}function ose(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new b5(n.key,Qu.none()):new DC(n.key,n.data,Qu.none());{const i=n.data,a=pl.empty();let l=new Go(La.comparator);for(let d of t.fields)if(!l.has(d)){let f=i.field(d);f===null&&d.length>1&&(d=d.popLast(),f=i.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new zg(n.key,a,new Jl(l.toArray()),Qu.none())}}function l3e(n,t,i){n instanceof DC?function(l,d,f){const y=l.value.clone(),v=vJ(l.fieldTransforms,d,f.transformResults);y.setAll(v),d.convertToFoundDocument(f.version,y).setHasCommittedMutations()}(n,t,i):n instanceof zg?function(l,d,f){if(!CO(l.precondition,d))return void d.convertToUnknownDocument(f.version);const y=vJ(l.fieldTransforms,d,f.transformResults),v=d.data;v.setAll(ase(l)),v.setAll(y),d.convertToFoundDocument(f.version,v).setHasCommittedMutations()}(n,t,i):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,t,i)}function PR(n,t,i,a){return n instanceof DC?function(d,f,y,v){if(!CO(d.precondition,f))return y;const b=d.value.clone(),R=SJ(d.fieldTransforms,v,f);return b.setAll(R),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null}(n,t,i,a):n instanceof zg?function(d,f,y,v){if(!CO(d.precondition,f))return y;const b=SJ(d.fieldTransforms,v,f),R=f.data;return R.setAll(ase(d)),R.setAll(b),f.convertToFoundDocument(f.version,R).setHasLocalMutations(),y===null?null:y.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(n,t,i,a):function(d,f,y){return CO(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):y}(n,t,i)}function u3e(n,t){let i=null;for(const a of n.fieldTransforms){const l=t.data.field(a.field),d=tse(a.transform,l||null);d!=null&&(i===null&&(i=pl.empty()),i.set(a.field,d))}return i||null}function EJ(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&S0(a,l,(d,f)=>a3e(d,f))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class DC extends pN{constructor(t,i,a,l=[]){super(),this.key=t,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class zg extends pN{constructor(t,i,a,l,d=[]){super(),this.key=t,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function ase(n){const t=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=n.data.field(i);t.set(i,a)}}),t}function vJ(n,t,i){const a=new Map;vi(n.length===i.length);for(let l=0;l<i.length;l++){const d=n[l],f=d.transform,y=t.data.field(d.field);a.set(d.field,o3e(f,y,i[l]))}return a}function SJ(n,t,i){const a=new Map;for(const l of n){const d=l.transform,f=i.data.field(l.field);a.set(l.field,s3e(d,f,t))}return a}class b5 extends pN{constructor(t,i){super(),this.key=t,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class d3e extends pN{constructor(t,i){super(),this.key=t,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h3e{constructor(t,i,a,l){this.batchId=t,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&l3e(d,t,a[l])}}applyToLocalView(t,i){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(i=PR(a,t,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(i=PR(a,t,i,this.localWriteTime));return i}applyToLocalDocumentSet(t,i){const a=Zie();return this.mutations.forEach(l=>{const d=t.get(l.key),f=d.overlayedDocument;let y=this.applyToLocalView(f,d.mutatedFields);y=i.has(l.key)?null:y;const v=ose(f,y);v!==null&&a.set(l.key,v),f.isValidDocument()||f.convertToNoDocument(ar.min())}),a}keys(){return this.mutations.reduce((t,i)=>t.add(i.key),jr())}isEqual(t){return this.batchId===t.batchId&&S0(this.mutations,t.mutations,(i,a)=>EJ(i,a))&&S0(this.baseMutations,t.baseMutations,(i,a)=>EJ(i,a))}}class w5{constructor(t,i,a,l){this.batch=t,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(t,i,a){vi(t.mutations.length===a.length);let l=function(){return e3e}();const d=t.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new w5(t,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p3e{constructor(t,i){this.largestBatchId=t,this.mutation=i}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f3e{constructor(t,i){this.count=t,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Eo,Qr;function m3e(n){switch(n){case kt.OK:return Jn();case kt.CANCELLED:case kt.UNKNOWN:case kt.DEADLINE_EXCEEDED:case kt.RESOURCE_EXHAUSTED:case kt.INTERNAL:case kt.UNAVAILABLE:case kt.UNAUTHENTICATED:return!1;case kt.INVALID_ARGUMENT:case kt.NOT_FOUND:case kt.ALREADY_EXISTS:case kt.PERMISSION_DENIED:case kt.FAILED_PRECONDITION:case kt.ABORTED:case kt.OUT_OF_RANGE:case kt.UNIMPLEMENTED:case kt.DATA_LOSS:return!0;default:return Jn()}}function cse(n){if(n===void 0)return Wf("GRPC error has no .code"),kt.UNKNOWN;switch(n){case Eo.OK:return kt.OK;case Eo.CANCELLED:return kt.CANCELLED;case Eo.UNKNOWN:return kt.UNKNOWN;case Eo.DEADLINE_EXCEEDED:return kt.DEADLINE_EXCEEDED;case Eo.RESOURCE_EXHAUSTED:return kt.RESOURCE_EXHAUSTED;case Eo.INTERNAL:return kt.INTERNAL;case Eo.UNAVAILABLE:return kt.UNAVAILABLE;case Eo.UNAUTHENTICATED:return kt.UNAUTHENTICATED;case Eo.INVALID_ARGUMENT:return kt.INVALID_ARGUMENT;case Eo.NOT_FOUND:return kt.NOT_FOUND;case Eo.ALREADY_EXISTS:return kt.ALREADY_EXISTS;case Eo.PERMISSION_DENIED:return kt.PERMISSION_DENIED;case Eo.FAILED_PRECONDITION:return kt.FAILED_PRECONDITION;case Eo.ABORTED:return kt.ABORTED;case Eo.OUT_OF_RANGE:return kt.OUT_OF_RANGE;case Eo.UNIMPLEMENTED:return kt.UNIMPLEMENTED;case Eo.DATA_LOSS:return kt.DATA_LOSS;default:return Jn()}}(Qr=Eo||(Eo={}))[Qr.OK=0]="OK",Qr[Qr.CANCELLED=1]="CANCELLED",Qr[Qr.UNKNOWN=2]="UNKNOWN",Qr[Qr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qr[Qr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qr[Qr.NOT_FOUND=5]="NOT_FOUND",Qr[Qr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qr[Qr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qr[Qr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qr[Qr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qr[Qr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qr[Qr.ABORTED=10]="ABORTED",Qr[Qr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qr[Qr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qr[Qr.INTERNAL=13]="INTERNAL",Qr[Qr.UNAVAILABLE=14]="UNAVAILABLE",Qr[Qr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g3e=new wg([4294967295,4294967295],0);function bJ(n){const t=Oie().encode(n),i=new wie;return i.update(t),new Uint8Array(i.digest())}function wJ(n){const t=new DataView(n.buffer),i=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new wg([i,a],0),new wg([l,d],0)]}class T5{constructor(t,i,a){if(this.bitmap=t,this.padding=i,this.hashCount=a,i<0||i>=8)throw new iR(`Invalid padding: ${i}`);if(a<0)throw new iR(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new iR(`Invalid hash count: ${a}`);if(t.length===0&&i!==0)throw new iR(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*t.length-i,this.de=wg.fromNumber(this.Ee)}Ae(t,i,a){let l=t.add(i.multiply(wg.fromNumber(a)));return l.compare(g3e)===1&&(l=new wg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const i=bJ(t),[a,l]=wJ(i);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(t,i,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),f=new T5(d,l,i);return a.forEach(y=>f.insert(y)),f}insert(t){if(this.Ee===0)return;const i=bJ(t),[a,l]=wJ(i);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(t){const i=Math.floor(t/8),a=t%8;this.bitmap[i]|=1<<a}}class iR extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fN{constructor(t,i,a,l,d){this.snapshotVersion=t,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,i,a){const l=new Map;return l.set(t,xC.createSynthesizedTargetChangeForCurrentChange(t,i,a)),new fN(ar.min(),l,new Ps(Cr),Gf(),jr())}}class xC{constructor(t,i,a,l,d){this.resumeToken=t,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,i,a){return new xC(a,i,jr(),jr(),jr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(t,i,a,l){this.me=t,this.removedTargetIds=i,this.key=a,this.fe=l}}class lse{constructor(t,i){this.targetId=t,this.ge=i}}class use{constructor(t,i,a=Ua.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=i,this.resumeToken=a,this.cause=l}}class TJ{constructor(){this.pe=0,this.ye=RJ(),this.we=Ua.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=jr(),i=jr(),a=jr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:Jn()}}),new xC(this.we,this.Se,t,i,a)}Me(){this.be=!1,this.ye=RJ()}xe(t,i){this.be=!0,this.ye=this.ye.insert(t,i)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,vi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class _3e{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Gf(),this.$e=H1(),this.Ue=H1(),this.Ke=new Ps(Cr)}We(t){for(const i of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(i,t.fe):this.ze(i,t.key,t.fe);for(const i of t.removedTargetIds)this.ze(i,t.key,t.fe)}je(t){this.forEachTarget(t,i=>{const a=this.He(i);switch(t.state){case 0:this.Je(i)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(i);break;case 3:this.Je(i)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),a.Ce(t.resumeToken));break;default:Jn()}})}forEachTarget(t,i){t.targetIds.length>0?t.targetIds.forEach(i):this.qe.forEach((a,l)=>{this.Je(l)&&i(l)})}Ze(t){const i=t.targetId,a=t.ge.count,l=this.Xe(i);if(l){const d=l.target;if($V(d))if(a===0){const f=new kn(d.path);this.ze(i,f,ac.newNoDocument(f,ar.min()))}else vi(a===1);else{const f=this.et(i);if(f!==a){const y=this.tt(t),v=y?this.nt(y,t,f):1;if(v!==0){this.Ye(i);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,b)}}}}}tt(t){const i=t.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=i;let f,y;try{f=kg(a).toUint8Array()}catch(v){if(v instanceof xie)return v0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{y=new T5(f,l,d)}catch(v){return v0(v instanceof iR?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return y.Ee===0?null:y}nt(t,i,a){return i.ge.count===a-this.st(t,i.targetId)?0:2}st(t,i){const a=this.ke.getRemoteKeysForTarget(i);let l=0;return a.forEach(d=>{const f=this.ke.it(),y=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;t.mightContain(y)||(this.ze(i,d,null),l++)}),l}ot(t){const i=new Map;this.qe.forEach((d,f)=>{const y=this.Xe(f);if(y){if(d.current&&$V(y.target)){const v=new kn(y.target.path);this._t(v).has(f)||this.ut(f,v)||this.ze(f,v,ac.newNoDocument(v,t))}d.ve&&(i.set(f,d.Fe()),d.Me())}});let a=jr();this.Ue.forEach((d,f)=>{let y=!0;f.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(t));const l=new fN(t,i,this.Ke,this.Qe,a);return this.Qe=Gf(),this.$e=H1(),this.Ue=H1(),this.Ke=new Ps(Cr),l}Ge(t,i){if(!this.Je(t))return;const a=this.ut(t,i.key)?2:0;this.He(t).xe(i.key,a),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(t)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(t))}ze(t,i,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(t)),this.Ue=this.Ue.insert(i,this.ct(i).add(t)),a&&(this.Qe=this.Qe.insert(i,a))}removeTarget(t){this.qe.delete(t)}et(t){const i=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+i.addedDocuments.size-i.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let i=this.qe.get(t);return i||(i=new TJ,this.qe.set(t,i)),i}ct(t){let i=this.Ue.get(t);return i||(i=new Go(Cr),this.Ue=this.Ue.insert(t,i)),i}_t(t){let i=this.$e.get(t);return i||(i=new Go(Cr),this.$e=this.$e.insert(t,i)),i}Je(t){const i=this.Xe(t)!==null;return i||un("WatchChangeAggregator","Detected inactive target",t),i}Xe(t){const i=this.qe.get(t);return i&&i.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new TJ),this.ke.getRemoteKeysForTarget(t).forEach(i=>{this.ze(t,i,null)})}ut(t,i){return this.ke.getRemoteKeysForTarget(t).has(i)}}function H1(){return new Ps(kn.comparator)}function RJ(){return new Ps(kn.comparator)}const y3e={asc:"ASCENDING",desc:"DESCENDING"},E3e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},v3e={and:"AND",or:"OR"};class S3e{constructor(t,i){this.databaseId=t,this.useProto3Json=i}}function qV(n,t){return n.useProto3Json||cN(t)?t:{value:t}}function hk(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function dse(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function b3e(n,t){return hk(n,t.toTimestamp())}function Op(n){return vi(!!n),ar.fromTimestamp(function(i){const a=Og(i);return new Wo(a.seconds,a.nanos)}(n))}function R5(n,t){return YV(n,t).canonicalString()}function YV(n,t){const i=function(l){return new os(["projects",l.projectId,"databases",l.database])}(n).child("documents");return t===void 0?i:i.child(t)}function hse(n){const t=os.fromString(n);return vi(_se(t)),t}function XV(n,t){return R5(n.databaseId,t.path)}function CU(n,t){const i=hse(t);if(i.get(1)!==n.databaseId.projectId)throw new fn(kt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new fn(kt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new kn(fse(i))}function pse(n,t){return R5(n.databaseId,t)}function w3e(n){const t=hse(n);return t.length===4?os.emptyPath():fse(t)}function JV(n){return new os(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fse(n){return vi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function CJ(n,t,i){return{name:XV(n,t),fields:i.value.mapValue.fields}}function T3e(n,t){let i;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Jn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,R){return b.useProto3Json?(vi(R===void 0||typeof R=="string"),Ua.fromBase64String(R||"")):(vi(R===void 0||R instanceof Buffer||R instanceof Uint8Array),Ua.fromUint8Array(R||new Uint8Array))}(n,t.targetChange.resumeToken),f=t.targetChange.cause,y=f&&function(b){const R=b.code===void 0?kt.UNKNOWN:cse(b.code);return new fn(R,b.message||"")}(f);i=new use(a,l,d,y||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=CU(n,a.document.name),d=Op(a.document.updateTime),f=a.document.createTime?Op(a.document.createTime):ar.min(),y=new pl({mapValue:{fields:a.document.fields}}),v=ac.newFoundDocument(l,d,f,y),b=a.targetIds||[],R=a.removedTargetIds||[];i=new IO(b,R,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=CU(n,a.document),d=a.readTime?Op(a.readTime):ar.min(),f=ac.newNoDocument(l,d),y=a.removedTargetIds||[];i=new IO([],y,f.key,f)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=CU(n,a.document),d=a.removedTargetIds||[];i=new IO([],d,l,null)}else{if(!("filter"in t))return Jn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new f3e(l,d),y=a.targetId;i=new lse(y,f)}}return i}function R3e(n,t){let i;if(t instanceof DC)i={update:CJ(n,t.key,t.value)};else if(t instanceof b5)i={delete:XV(n,t.key)};else if(t instanceof zg)i={update:CJ(n,t.key,t.data),updateMask:x3e(t.fieldMask)};else{if(!(t instanceof d3e))return Jn();i={verify:XV(n,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(a=>function(d,f){const y=f.transform;if(y instanceof uk)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof T0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof R0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof dk)return{fieldPath:f.field.canonicalString(),increment:y.Ie};throw Jn()}(0,a))),t.precondition.isNone||(i.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:b3e(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Jn()}(n,t.precondition)),i}function C3e(n,t){return n&&n.length>0?(vi(t!==void 0),n.map(i=>function(l,d){let f=l.updateTime?Op(l.updateTime):Op(d);return f.isEqual(ar.min())&&(f=Op(d)),new c3e(f,l.transformResults||[])}(i,t))):[]}function I3e(n,t){return{documents:[pse(n,t.path)]}}function A3e(n,t){const i={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=pse(n,l);const d=function(b){if(b.length!==0)return gse(ch.create(b,"and"))}(t.filters);d&&(i.structuredQuery.where=d);const f=function(b){if(b.length!==0)return b.map(R=>function(k){return{field:wS(k.field),direction:k3e(k.dir)}}(R))}(t.orderBy);f&&(i.structuredQuery.orderBy=f);const y=qV(n,t.limit);return y!==null&&(i.structuredQuery.limit=y),t.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{ht:i,parent:l}}function P3e(n){let t=w3e(n.parent);const i=n.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){vi(a===1);const R=i.from[0];R.allDescendants?l=R.collectionId:t=t.child(R.collectionId)}let d=[];i.where&&(d=function(I){const k=mse(I);return k instanceof ch&&Gie(k)?k.getFilters():[k]}(i.where));let f=[];i.orderBy&&(f=function(I){return I.map(k=>function(L){return new ck(TS(L.field),function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(k))}(i.orderBy));let y=null;i.limit&&(y=function(I){let k;return k=typeof I=="object"?I.value:I,cN(k)?null:k}(i.limit));let v=null;i.startAt&&(v=function(I){const k=!!I.before,M=I.values||[];return new ak(M,k)}(i.startAt));let b=null;return i.endAt&&(b=function(I){const k=!I.before,M=I.values||[];return new ak(M,k)}(i.endAt)),Y5e(t,l,f,d,y,"F",v,b)}function O3e(n,t){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Jn()}}(t.purpose);return i==null?null:{"goog-listen-tags":i}}function mse(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=TS(i.unaryFilter.field);return wo.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=TS(i.unaryFilter.field);return wo.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=TS(i.unaryFilter.field);return wo.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=TS(i.unaryFilter.field);return wo.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Jn()}}(n):n.fieldFilter!==void 0?function(i){return wo.create(TS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Jn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return ch.create(i.compositeFilter.filters.map(a=>mse(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Jn()}}(i.compositeFilter.op))}(n):Jn()}function k3e(n){return y3e[n]}function N3e(n){return E3e[n]}function D3e(n){return v3e[n]}function wS(n){return{fieldPath:n.canonicalString()}}function TS(n){return La.fromServerFormat(n.fieldPath)}function gse(n){return n instanceof wo?function(i){if(i.op==="=="){if(pJ(i.value))return{unaryFilter:{field:wS(i.field),op:"IS_NAN"}};if(hJ(i.value))return{unaryFilter:{field:wS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(pJ(i.value))return{unaryFilter:{field:wS(i.field),op:"IS_NOT_NAN"}};if(hJ(i.value))return{unaryFilter:{field:wS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wS(i.field),op:N3e(i.op),value:i.value}}}(n):n instanceof ch?function(i){const a=i.getFilters().map(l=>gse(l));return a.length===1?a[0]:{compositeFilter:{op:D3e(i.op),filters:a}}}(n):Jn()}function x3e(n){const t=[];return n.fields.forEach(i=>t.push(i.canonicalString())),{fieldPaths:t}}function _se(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg{constructor(t,i,a,l,d=ar.min(),f=ar.min(),y=Ua.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=y,this.expectedCount=v}withSequenceNumber(t){return new yg(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,i){return new yg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new yg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new yg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L3e{constructor(t){this.Tt=t}}function M3e(n){const t=P3e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?lk(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3e{constructor(){this.Tn=new V3e}addToCollectionParentIndex(t,i){return this.Tn.add(i),Ot.resolve()}getCollectionParents(t,i){return Ot.resolve(this.Tn.getEntries(i))}addFieldIndex(t,i){return Ot.resolve()}deleteFieldIndex(t,i){return Ot.resolve()}deleteAllFieldIndexes(t){return Ot.resolve()}createTargetIndexes(t,i){return Ot.resolve()}getDocumentsMatchingTarget(t,i){return Ot.resolve(null)}getIndexType(t,i){return Ot.resolve(0)}getFieldIndexes(t,i){return Ot.resolve([])}getNextCollectionGroupToUpdate(t){return Ot.resolve(null)}getMinOffset(t,i){return Ot.resolve(Pg.min())}getMinOffsetFromCollectionGroup(t,i){return Ot.resolve(Pg.min())}updateCollectionGroup(t,i,a){return Ot.resolve()}updateIndexEntries(t,i){return Ot.resolve()}}class V3e{constructor(){this.index={}}add(t){const i=t.lastSegment(),a=t.popLast(),l=this.index[i]||new Go(os.comparator),d=!l.has(a);return this.index[i]=l.add(a),d}has(t){const i=t.lastSegment(),a=t.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(t){return(this.index[t]||new Go(os.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},yse=41943040;class ul{static withCacheSize(t){return new ul(t,ul.DEFAULT_COLLECTION_PERCENTILE,ul.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,i,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ul.DEFAULT_COLLECTION_PERCENTILE=10,ul.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ul.DEFAULT=new ul(yse,ul.DEFAULT_COLLECTION_PERCENTILE,ul.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ul.DISABLED=new ul(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new C0(0)}static Kn(){return new C0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AJ="LruGarbageCollector",F3e=1048576;function PJ([n,t],[i,a]){const l=Cr(n,i);return l===0?Cr(t,a):l}class j3e{constructor(t){this.Hn=t,this.buffer=new Go(PJ),this.Jn=0}Yn(){return++this.Jn}Zn(t){const i=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();PJ(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class B3e{constructor(t,i,a){this.garbageCollector=t,this.asyncQueue=i,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){un(AJ,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){z0(i)?un(AJ,"Ignoring IndexedDB error during garbage collection: ",i):await B0(i)}await this.er(3e5)})}}class z3e{constructor(t,i){this.tr=t,this.params=i}calculateTargetCount(t,i){return this.tr.nr(t).next(a=>Math.floor(i/100*a))}nthSequenceNumber(t,i){if(i===0)return Ot.resolve(aN.ae);const a=new j3e(i);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,i,a){return this.tr.removeTargets(t,i,a)}removeOrphanedDocuments(t,i){return this.tr.removeOrphanedDocuments(t,i)}collect(t,i){return this.params.cacheSizeCollectionThreshold===-1?(un("LruGarbageCollector","Garbage collection skipped; disabled"),Ot.resolve(IJ)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(un("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),IJ):this.ir(t,i))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,i){let a,l,d,f,y,v,b;const R=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(un("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(t,l))).next(I=>(a=I,y=Date.now(),this.removeTargets(t,a,i))).next(I=>(d=I,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(I=>(b=Date.now(),SS()<=Fr.DEBUG&&un("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-R}ms
	Determined least recently used ${l} in `+(y-f)+`ms
	Removed ${d} targets in `+(v-y)+`ms
	Removed ${I} documents in `+(b-v)+`ms
Total Duration: ${b-R}ms`),Ot.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function W3e(n,t){return new z3e(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G3e{constructor(){this.changes=new Zy(t=>t.toString(),(t,i)=>t.isEqual(i)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,i){this.assertNotApplied(),this.changes.set(t,ac.newInvalidDocument(t).setReadTime(i))}getEntry(t,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?Ot.resolve(a):this.getFromCache(t,i)}getEntries(t,i){return this.getAllFromCache(t,i)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H3e{constructor(t,i){this.overlayedDocument=t,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $3e{constructor(t,i,a,l){this.remoteDocumentCache=t,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,i){let a=null;return this.documentOverlayCache.getOverlay(t,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,i))).next(l=>(a!==null&&PR(a.mutation,l,Jl.empty(),Wo.now()),l))}getDocuments(t,i){return this.remoteDocumentCache.getEntries(t,i).next(a=>this.getLocalViewOfDocuments(t,a,jr()).next(()=>a))}getLocalViewOfDocuments(t,i,a=jr()){const l=Ty();return this.populateOverlays(t,l,i).next(()=>this.computeViews(t,i,l,a).next(d=>{let f=rR();return d.forEach((y,v)=>{f=f.insert(y,v.overlayedDocument)}),f}))}getOverlayedDocuments(t,i){const a=Ty();return this.populateOverlays(t,a,i).next(()=>this.computeViews(t,i,a,jr()))}populateOverlays(t,i,a){const l=[];return a.forEach(d=>{i.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((f,y)=>{i.set(f,y)})})}computeViews(t,i,a,l){let d=Gf();const f=AR(),y=function(){return AR()}();return i.forEach((v,b)=>{const R=a.get(b.key);l.has(b.key)&&(R===void 0||R.mutation instanceof zg)?d=d.insert(b.key,b):R!==void 0?(f.set(b.key,R.mutation.getFieldMask()),PR(R.mutation,b,R.mutation.getFieldMask(),Wo.now())):f.set(b.key,Jl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((b,R)=>f.set(b,R)),i.forEach((b,R)=>{var I;return y.set(b,new H3e(R,(I=f.get(b))!==null&&I!==void 0?I:null))}),y))}recalculateAndSaveOverlays(t,i){const a=AR();let l=new Ps((f,y)=>f-y),d=jr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,i).next(f=>{for(const y of f)y.keys().forEach(v=>{const b=i.get(v);if(b===null)return;let R=a.get(v)||Jl.empty();R=y.applyToLocalView(b,R),a.set(v,R);const I=(l.get(y.batchId)||jr()).add(v);l=l.insert(y.batchId,I)})}).next(()=>{const f=[],y=l.getReverseIterator();for(;y.hasNext();){const v=y.getNext(),b=v.key,R=v.value,I=Zie();R.forEach(k=>{if(!d.has(k)){const M=ose(i.get(k),a.get(k));M!==null&&I.set(k,M),d=d.add(k)}}),f.push(this.documentOverlayCache.saveOverlays(t,b,I))}return Ot.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,i){return this.remoteDocumentCache.getEntries(t,i).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,i,a,l){return function(f){return kn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(t,i.path):qie(i)?this.getDocumentsMatchingCollectionGroupQuery(t,i,a,l):this.getDocumentsMatchingCollectionQuery(t,i,a,l)}getNextDocuments(t,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,i,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,i,a.largestBatchId,l-d.size):Ot.resolve(Ty());let y=iC,v=d;return f.next(b=>Ot.forEach(b,(R,I)=>(y<I.largestBatchId&&(y=I.largestBatchId),d.get(R)?Ot.resolve():this.remoteDocumentCache.getEntry(t,R).next(k=>{v=v.insert(R,k)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,v,b,jr())).next(R=>({batchId:y,changes:Qie(R)})))})}getDocumentsMatchingDocumentQuery(t,i){return this.getDocument(t,new kn(i)).next(a=>{let l=rR();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,i,a,l){const d=i.collectionGroup;let f=rR();return this.indexManager.getCollectionParents(t,d).next(y=>Ot.forEach(y,v=>{const b=function(I,k){return new NC(k,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(R=>{R.forEach((I,k)=>{f=f.insert(I,k)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(t,i,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,i.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(t,i,a,d,l))).next(f=>{d.forEach((v,b)=>{const R=b.getKey();f.get(R)===null&&(f=f.insert(R,ac.newInvalidDocument(R)))});let y=rR();return f.forEach((v,b)=>{const R=d.get(v);R!==void 0&&PR(R.mutation,b,Jl.empty(),Wo.now()),dN(i,b)&&(y=y.insert(v,b))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K3e{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,i){return Ot.resolve(this.dr.get(i))}saveBundleMetadata(t,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:Op(l.createTime)}}(i)),Ot.resolve()}getNamedQuery(t,i){return Ot.resolve(this.Ar.get(i))}saveNamedQuery(t,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:M3e(l.bundledQuery),readTime:Op(l.readTime)}}(i)),Ot.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q3e{constructor(){this.overlays=new Ps(kn.comparator),this.Rr=new Map}getOverlay(t,i){return Ot.resolve(this.overlays.get(i))}getOverlays(t,i){const a=Ty();return Ot.forEach(i,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,i,a){return a.forEach((l,d)=>{this.Et(t,i,d)}),Ot.resolve()}removeOverlaysForBatchId(t,i,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),Ot.resolve()}getOverlaysForCollection(t,i,a){const l=Ty(),d=i.length+1,f=new kn(i.child("")),y=this.overlays.getIteratorFrom(f);for(;y.hasNext();){const v=y.getNext().value,b=v.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return Ot.resolve(l)}getOverlaysForCollectionGroup(t,i,a,l){let d=new Ps((b,R)=>b-R);const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>a){let R=d.get(b.largestBatchId);R===null&&(R=Ty(),d=d.insert(b.largestBatchId,R)),R.set(b.getKey(),b)}}const y=Ty(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,R)=>y.set(b,R)),!(y.size()>=l)););return Ot.resolve(y)}Et(t,i,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new p3e(i,a));let d=this.Rr.get(i);d===void 0&&(d=jr(),this.Rr.set(i,d)),this.Rr.set(i,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y3e{constructor(){this.sessionToken=Ua.EMPTY_BYTE_STRING}getSessionToken(t){return Ot.resolve(this.sessionToken)}setSessionToken(t,i){return this.sessionToken=i,Ot.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(){this.Vr=new Go(ua.mr),this.gr=new Go(ua.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,i){const a=new ua(t,i);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,i){t.forEach(a=>this.addReference(a,i))}removeReference(t,i){this.wr(new ua(t,i))}Sr(t,i){t.forEach(a=>this.removeReference(a,i))}br(t){const i=new kn(new os([])),a=new ua(i,t),l=new ua(i,t+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const i=new kn(new os([])),a=new ua(i,t),l=new ua(i,t+1);let d=jr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(t){const i=new ua(t,0),a=this.Vr.firstAfterOrEqual(i);return a!==null&&t.isEqual(a.key)}}class ua{constructor(t,i){this.key=t,this.Cr=i}static mr(t,i){return kn.comparator(t.key,i.key)||Cr(t.Cr,i.Cr)}static pr(t,i){return Cr(t.Cr,i.Cr)||kn.comparator(t.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X3e{constructor(t,i){this.indexManager=t,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new Go(ua.mr)}checkEmpty(t){return Ot.resolve(this.mutationQueue.length===0)}addMutationBatch(t,i,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new h3e(d,i,a,l);this.mutationQueue.push(f);for(const y of l)this.Mr=this.Mr.add(new ua(y.key,d)),this.indexManager.addToCollectionParentIndex(t,y.key.path.popLast());return Ot.resolve(f)}lookupMutationBatch(t,i){return Ot.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(t,i){const a=i+1,l=this.Nr(a),d=l<0?0:l;return Ot.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Ot.resolve(this.mutationQueue.length===0?m5:this.Fr-1)}getAllMutationBatches(t){return Ot.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,i){const a=new ua(i,0),l=new ua(i,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const y=this.Or(f.Cr);d.push(y)}),Ot.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,i){let a=new Go(Cr);return i.forEach(l=>{const d=new ua(l,0),f=new ua(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],y=>{a=a.add(y.Cr)})}),Ot.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,i){const a=i.path,l=a.length+1;let d=a;kn.isDocumentKey(d)||(d=d.child(""));const f=new ua(new kn(d),0);let y=new Go(Cr);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(y=y.add(v.Cr)),!0)},f),Ot.resolve(this.Br(y))}Br(t){const i=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&i.push(l)}),i}removeMutationBatch(t,i){vi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Ot.forEach(i.mutations,l=>{const d=new ua(l.key,i.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,i){const a=new ua(i,0),l=this.Mr.firstAfterOrEqual(a);return Ot.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ot.resolve()}Lr(t,i){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const i=this.Nr(t);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3e{constructor(t){this.kr=t,this.docs=function(){return new Ps(kn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,i){const a=i.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const i=this.docs.get(t);i&&(this.docs=this.docs.remove(t),this.size-=i.size)}getEntry(t,i){const a=this.docs.get(i);return Ot.resolve(a?a.document.mutableCopy():ac.newInvalidDocument(i))}getEntries(t,i){let a=Gf();return i.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():ac.newInvalidDocument(l))}),Ot.resolve(a)}getDocumentsMatchingQuery(t,i,a,l){let d=Gf();const f=i.path,y=new kn(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(y);for(;v.hasNext();){const{key:b,value:{document:R}}=v.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||I5e(C5e(R),a)<=0||(l.has(R.key)||dN(i,R))&&(d=d.insert(R.key,R.mutableCopy()))}return Ot.resolve(d)}getAllFromCollectionGroup(t,i,a,l){Jn()}qr(t,i){return Ot.forEach(this.docs,a=>i(a))}newChangeBuffer(t){return new Q3e(this)}getSize(t){return Ot.resolve(this.size)}}class Q3e extends G3e{constructor(t){super(),this.Ir=t}applyChanges(t){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),Ot.waitFor(i)}getFromCache(t,i){return this.Ir.getEntry(t,i)}getAllFromCache(t,i){return this.Ir.getEntries(t,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3e{constructor(t){this.persistence=t,this.Qr=new Zy(i=>y5(i),E5),this.lastRemoteSnapshotVersion=ar.min(),this.highestTargetId=0,this.$r=0,this.Ur=new C5,this.targetCount=0,this.Kr=C0.Un()}forEachTarget(t,i){return this.Qr.forEach((a,l)=>i(l)),Ot.resolve()}getLastRemoteSnapshotVersion(t){return Ot.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ot.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),Ot.resolve(this.highestTargetId)}setTargetsMetadata(t,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.$r&&(this.$r=i),Ot.resolve()}zn(t){this.Qr.set(t.target,t);const i=t.targetId;i>this.highestTargetId&&(this.Kr=new C0(i),this.highestTargetId=i),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,i){return this.zn(i),this.targetCount+=1,Ot.resolve()}updateTargetData(t,i){return this.zn(i),Ot.resolve()}removeTargetData(t,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,Ot.resolve()}removeTargets(t,i,a){let l=0;const d=[];return this.Qr.forEach((f,y)=>{y.sequenceNumber<=i&&a.get(y.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(t,y.targetId)),l++)}),Ot.waitFor(d).next(()=>l)}getTargetCount(t){return Ot.resolve(this.targetCount)}getTargetData(t,i){const a=this.Qr.get(i)||null;return Ot.resolve(a)}addMatchingKeys(t,i,a){return this.Ur.yr(i,a),Ot.resolve()}removeMatchingKeys(t,i,a){this.Ur.Sr(i,a);const l=this.persistence.referenceDelegate,d=[];return l&&i.forEach(f=>{d.push(l.markPotentiallyOrphaned(t,f))}),Ot.waitFor(d)}removeMatchingKeysForTargetId(t,i){return this.Ur.br(i),Ot.resolve()}getMatchingKeysForTargetId(t,i){const a=this.Ur.vr(i);return Ot.resolve(a)}containsKey(t,i){return Ot.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ese{constructor(t,i){this.Wr={},this.overlays={},this.Gr=new aN(0),this.zr=!1,this.zr=!0,this.jr=new Y3e,this.referenceDelegate=t(this),this.Hr=new Z3e(this),this.indexManager=new U3e,this.remoteDocumentCache=function(l){return new J3e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new L3e(i),this.Yr=new K3e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let i=this.overlays[t.toKey()];return i||(i=new q3e,this.overlays[t.toKey()]=i),i}getMutationQueue(t,i){let a=this.Wr[t.toKey()];return a||(a=new X3e(i,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,i,a){un("MemoryPersistence","Starting transaction:",t);const l=new e4e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,i){return Ot.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,i)))}}class e4e extends P5e{constructor(t){super(),this.currentSequenceNumber=t}}class I5{constructor(t){this.persistence=t,this.ti=new C5,this.ni=null}static ri(t){return new I5(t)}get ii(){if(this.ni)return this.ni;throw Jn()}addReference(t,i,a){return this.ti.addReference(a,i),this.ii.delete(a.toString()),Ot.resolve()}removeReference(t,i,a){return this.ti.removeReference(a,i),this.ii.add(a.toString()),Ot.resolve()}markPotentiallyOrphaned(t,i){return this.ii.add(i.toString()),Ot.resolve()}removeTarget(t,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,i.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,i))}Zr(){this.ni=new Set}Xr(t){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ot.forEach(this.ii,a=>{const l=kn.fromPath(a);return this.si(t,l).next(d=>{d||i.removeEntry(l,ar.min())})}).next(()=>(this.ni=null,i.apply(t)))}updateLimboDocument(t,i){return this.si(t,i).next(a=>{a?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(t){return 0}si(t,i){return Ot.or([()=>Ot.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(t,i),()=>this.persistence.ei(t,i)])}}class pk{constructor(t,i){this.persistence=t,this.oi=new Zy(a=>N5e(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=W3e(this,i)}static ri(t,i){return new pk(t,i)}Zr(){}Xr(t){return Ot.resolve()}forEachTarget(t,i){return this.persistence.getTargetCache().forEachTarget(t,i)}nr(t){const i=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>i.next(l=>a+l))}sr(t){let i=0;return this.rr(t,a=>{i++}).next(()=>i)}rr(t,i){return Ot.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?Ot.resolve():i(l)))}removeTargets(t,i,a){return this.persistence.getTargetCache().removeTargets(t,i,a)}removeOrphanedDocuments(t,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,f=>this.ar(t,f,i).next(y=>{y||(a++,d.removeEntry(f,ar.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,i){return this.oi.set(i,t.currentSequenceNumber),Ot.resolve()}removeTarget(t,i){const a=i.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,i,a){return this.oi.set(a,t.currentSequenceNumber),Ot.resolve()}removeReference(t,i,a){return this.oi.set(a,t.currentSequenceNumber),Ot.resolve()}updateLimboDocument(t,i){return this.oi.set(i,t.currentSequenceNumber),Ot.resolve()}Jr(t){let i=t.key.toString().length;return t.isFoundDocument()&&(i+=TO(t.data.value)),i}ar(t,i,a){return Ot.or([()=>this.persistence.ei(t,i),()=>this.persistence.getTargetCache().containsKey(t,i),()=>{const l=this.oi.get(i);return Ot.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{constructor(t,i,a,l){this.targetId=t,this.fromCache=i,this.Hi=a,this.Ji=l}static Yi(t,i){let a=jr(),l=jr();for(const d of i.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new A5(t,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return MUe()?8:O5e(lc())>0?6:4}()}initialize(t,i){this.ns=t,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(t,i,a,l){const d={result:null};return this.rs(t,i).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(t,i,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new t4e;return this._s(t,i,f).next(y=>{if(d.result=y,this.Xi)return this.us(t,i,f,y.size)})}).next(()=>d.result)}us(t,i,a,l){return a.documentReadCount<this.es?(SS()<=Fr.DEBUG&&un("QueryEngine","SDK will not create cache indexes for query:",bS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Ot.resolve()):(SS()<=Fr.DEBUG&&un("QueryEngine","Query:",bS(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(SS()<=Fr.DEBUG&&un("QueryEngine","The SDK decides to create cache indexes for query:",bS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Pp(i))):Ot.resolve())}rs(t,i){if(_J(i))return Ot.resolve(null);let a=Pp(i);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=lk(i,null,"F"),a=Pp(i)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const f=jr(...d);return this.ns.getDocuments(t,f).next(y=>this.indexManager.getMinOffset(t,a).next(v=>{const b=this.cs(i,y);return this.ls(i,b,f,v.readTime)?this.rs(t,lk(i,null,"F")):this.hs(t,b,i,v)}))})))}ss(t,i,a,l){return _J(i)||l.isEqual(ar.min())?Ot.resolve(null):this.ns.getDocuments(t,a).next(d=>{const f=this.cs(i,d);return this.ls(i,f,a,l)?Ot.resolve(null):(SS()<=Fr.DEBUG&&un("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),bS(i)),this.hs(t,f,i,R5e(l,iC)).next(y=>y))})}cs(t,i){let a=new Go(Xie(t));return i.forEach((l,d)=>{dN(t,d)&&(a=a.add(d))}),a}ls(t,i,a,l){if(t.limit===null)return!1;if(a.size!==i.size)return!0;const d=t.limitType==="F"?i.last():i.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,i,a){return SS()<=Fr.DEBUG&&un("QueryEngine","Using full collection scan to execute query:",bS(i)),this.ns.getDocumentsMatchingQuery(t,i,Pg.min(),a)}hs(t,i,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(i.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P5="LocalStore",r4e=3e8;class i4e{constructor(t,i,a,l){this.persistence=t,this.Ps=i,this.serializer=l,this.Ts=new Ps(Cr),this.Is=new Zy(d=>y5(d),E5),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new $3e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>t.collect(i,this.Ts))}}function s4e(n,t,i,a){return new i4e(n,t,i,a)}async function vse(n,t){const i=ur(n);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,i.As(t),i.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],y=[];let v=jr();for(const b of l){f.push(b.batchId);for(const R of b.mutations)v=v.add(R.key)}for(const b of d){y.push(b.batchId);for(const R of b.mutations)v=v.add(R.key)}return i.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:f,addedBatchIds:y}))})})}function o4e(n,t){const i=ur(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=i.ds.newChangeBuffer({trackRemovals:!0});return function(y,v,b,R){const I=b.batch,k=I.keys();let M=Ot.resolve();return k.forEach(L=>{M=M.next(()=>R.getEntry(v,L)).next(j=>{const z=b.docVersions.get(L);vi(z!==null),j.version.compareTo(z)<0&&(I.applyToRemoteDocument(j,b),j.isValidDocument()&&(j.setReadTime(b.commitVersion),R.addEntry(j)))})}),M.next(()=>y.mutationQueue.removeMutationBatch(v,I))}(i,a,t,d).next(()=>d.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(y){let v=jr();for(let b=0;b<y.mutationResults.length;++b)y.mutationResults[b].transformResults.length>0&&(v=v.add(y.batch.mutations[b].key));return v}(t))).next(()=>i.localDocuments.getDocuments(a,l))})}function Sse(n){const t=ur(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",i=>t.Hr.getLastRemoteSnapshotVersion(i))}function a4e(n,t){const i=ur(n),a=t.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const y=[];t.targetChanges.forEach((R,I)=>{const k=l.get(I);if(!k)return;y.push(i.Hr.removeMatchingKeys(d,R.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(d,R.addedDocuments,I)));let M=k.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(I)!==null?M=M.withResumeToken(Ua.EMPTY_BYTE_STRING,ar.min()).withLastLimboFreeSnapshotVersion(ar.min()):R.resumeToken.approximateByteSize()>0&&(M=M.withResumeToken(R.resumeToken,a)),l=l.insert(I,M),function(j,z,Y){return j.resumeToken.approximateByteSize()===0||z.snapshotVersion.toMicroseconds()-j.snapshotVersion.toMicroseconds()>=r4e?!0:Y.addedDocuments.size+Y.modifiedDocuments.size+Y.removedDocuments.size>0}(k,M,R)&&y.push(i.Hr.updateTargetData(d,M))});let v=Gf(),b=jr();if(t.documentUpdates.forEach(R=>{t.resolvedLimboDocuments.has(R)&&y.push(i.persistence.referenceDelegate.updateLimboDocument(d,R))}),y.push(c4e(d,f,t.documentUpdates).next(R=>{v=R.Vs,b=R.fs})),!a.isEqual(ar.min())){const R=i.Hr.getLastRemoteSnapshotVersion(d).next(I=>i.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));y.push(R)}return Ot.waitFor(y).next(()=>f.apply(d)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(i.Ts=l,d))}function c4e(n,t,i){let a=jr(),l=jr();return i.forEach(d=>a=a.add(d)),t.getEntries(n,a).next(d=>{let f=Gf();return i.forEach((y,v)=>{const b=d.get(y);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(y)),v.isNoDocument()&&v.version.isEqual(ar.min())?(t.removeEntry(y,v.readTime),f=f.insert(y,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(v),f=f.insert(y,v)):un(P5,"Ignoring outdated watch update for ",y,". Current version:",b.version," Watch version:",v.version)}),{Vs:f,fs:l}})}function l4e(n,t){const i=ur(n);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=m5),i.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function u4e(n,t){const i=ur(n);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.Hr.getTargetData(a,t).next(d=>d?(l=d,Ot.resolve(l)):i.Hr.allocateTargetId(a).next(f=>(l=new yg(t,f,"TargetPurposeListen",a.currentSequenceNumber),i.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(a.targetId,a),i.Is.set(t,a.targetId)),a})}async function QV(n,t,i){const a=ur(n),l=a.Ts.get(t),d=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!z0(f))throw f;un(P5,`Failed to update sequence numbers for target ${t}: ${f}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function OJ(n,t,i){const a=ur(n);let l=ar.min(),d=jr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(v,b,R){const I=ur(v),k=I.Is.get(R);return k!==void 0?Ot.resolve(I.Ts.get(k)):I.Hr.getTargetData(b,R)}(a,f,Pp(t)).next(y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,y.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,t,i?l:ar.min(),i?d:jr())).next(y=>(d4e(a,J5e(t),y),{documents:y,gs:d})))}function d4e(n,t,i){let a=n.Es.get(t)||ar.min();i.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(t,a)}class kJ{constructor(){this.activeTargetIds=r3e()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class h4e{constructor(){this.ho=new kJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,i,a){}addLocalQueryTarget(t,i=!0){return i&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,i,a){this.Po[t]=i}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new kJ,Promise.resolve()}handleUserChange(t,i,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4e{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NJ="ConnectivityMonitor";class DJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){un(NJ,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){un(NJ,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $1=null;function ZV(){return $1===null?$1=function(){return 268435456+Math.round(2147483648*Math.random())}():$1++,"0x"+$1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IU="RestConnection",f4e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class m4e{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===sk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(t,i,a,l,d){const f=ZV(),y=this.bo(t,i.toUriEncodedString());un(IU,`Sending RPC '${t}' ${f}:`,y,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,y,v,a).then(b=>(un(IU,`Received RPC '${t}' ${f}: `,b),b),b=>{throw v0(IU,`RPC '${t}' ${f} failed with error: `,b,"url: ",y,"request:",a),b})}Co(t,i,a,l,d,f){return this.So(t,i,a,l,d)}Do(t,i,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+j0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}bo(t,i){const a=f4e[t];return`${this.po}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4e{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rc="WebChannelConnection";class _4e extends m4e{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,i,a,l){const d=ZV();return new Promise((f,y)=>{const v=new Tie;v.setWithCredentials(!0),v.listenOnce(Rie.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case wO.NO_ERROR:const R=v.getResponseJson();un(rc,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(R)),f(R);break;case wO.TIMEOUT:un(rc,`RPC '${t}' ${d} timed out`),y(new fn(kt.DEADLINE_EXCEEDED,"Request time out"));break;case wO.HTTP_ERROR:const I=v.getStatus();if(un(rc,`RPC '${t}' ${d} failed with status:`,I,"response text:",v.getResponseText()),I>0){let k=v.getResponseJson();Array.isArray(k)&&(k=k[0]);const M=k==null?void 0:k.error;if(M&&M.status&&M.message){const L=function(z){const Y=z.toLowerCase().replace(/_/g,"-");return Object.values(kt).indexOf(Y)>=0?Y:kt.UNKNOWN}(M.status);y(new fn(L,M.message))}else y(new fn(kt.UNKNOWN,"Server responded with status "+v.getStatus()))}else y(new fn(kt.UNAVAILABLE,"Connection failed."));break;default:Jn()}}finally{un(rc,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);un(rc,`RPC '${t}' ${d} sending request:`,l),v.send(i,"POST",b,a,15)})}Wo(t,i,a){const l=ZV(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],f=Aie(),y=Iie(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,i,a),v.encodeInitMessageHeaders=!0;const R=d.join("");un(rc,`Creating RPC '${t}' stream ${l}: ${R}`,v);const I=f.createWebChannel(R,v);let k=!1,M=!1;const L=new g4e({Fo:z=>{M?un(rc,`Not sending because RPC '${t}' stream ${l} is closed:`,z):(k||(un(rc,`Opening RPC '${t}' stream ${l} transport.`),I.open(),k=!0),un(rc,`RPC '${t}' stream ${l} sending:`,z),I.send(z))},Mo:()=>I.close()}),j=(z,Y,K)=>{z.listen(Y,ne=>{try{K(ne)}catch(ce){setTimeout(()=>{throw ce},0)}})};return j(I,nR.EventType.OPEN,()=>{M||(un(rc,`RPC '${t}' stream ${l} transport opened.`),L.Qo())}),j(I,nR.EventType.CLOSE,()=>{M||(M=!0,un(rc,`RPC '${t}' stream ${l} transport closed`),L.Uo())}),j(I,nR.EventType.ERROR,z=>{M||(M=!0,v0(rc,`RPC '${t}' stream ${l} transport errored:`,z),L.Uo(new fn(kt.UNAVAILABLE,"The operation could not be completed")))}),j(I,nR.EventType.MESSAGE,z=>{var Y;if(!M){const K=z.data[0];vi(!!K);const ne=K,ce=(ne==null?void 0:ne.error)||((Y=ne[0])===null||Y===void 0?void 0:Y.error);if(ce){un(rc,`RPC '${t}' stream ${l} received error:`,ce);const oe=ce.status;let ge=function(te){const ie=Eo[te];if(ie!==void 0)return cse(ie)}(oe),X=ce.message;ge===void 0&&(ge=kt.INTERNAL,X="Unknown error status: "+oe+" with message "+ce.message),M=!0,L.Uo(new fn(ge,X)),I.close()}else un(rc,`RPC '${t}' stream ${l} received:`,K),L.Ko(K)}}),j(y,Cie.STAT_EVENT,z=>{z.stat===BV.PROXY?un(rc,`RPC '${t}' stream ${l} detected buffering proxy`):z.stat===BV.NOPROXY&&un(rc,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{L.$o()},0),L}}function AU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mN(n){return new S3e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bse{constructor(t,i,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=i,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const i=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-a);l>0&&un("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xJ="PersistentStream";class wse{constructor(t,i,a,l,d,f,y,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=y,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new bse(t,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():i&&i.code===kt.RESOURCE_EXHAUSTED?(Wf(i.toString()),Wf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===kt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===i&&this.V_(a,l)},a=>{t(()=>{const l=new fn(kt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,i){const a=this.R_(this.i_);this.stream=this.f_(t,i),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return un(xJ,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return i=>{this.Ti.enqueueAndForget(()=>this.i_===t?i():(un(xJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class y4e extends wse{constructor(t,i,a,l,d,f){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,f),this.serializer=d}f_(t,i){return this.connection.Wo("Listen",t,i)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const i=T3e(this.serializer,t),a=function(d){if(!("targetChange"in d))return ar.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?ar.min():f.readTime?Op(f.readTime):ar.min()}(t);return this.listener.p_(i,a)}y_(t){const i={};i.database=JV(this.serializer),i.addTarget=function(d,f){let y;const v=f.target;if(y=$V(v)?{documents:I3e(d,v)}:{query:A3e(d,v).ht},y.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){y.resumeToken=dse(d,f.resumeToken);const b=qV(d,f.expectedCount);b!==null&&(y.expectedCount=b)}else if(f.snapshotVersion.compareTo(ar.min())>0){y.readTime=hk(d,f.snapshotVersion.toTimestamp());const b=qV(d,f.expectedCount);b!==null&&(y.expectedCount=b)}return y}(this.serializer,t);const a=O3e(this.serializer,t);a&&(i.labels=a),this.I_(i)}w_(t){const i={};i.database=JV(this.serializer),i.removeTarget=t,this.I_(i)}}class E4e extends wse{constructor(t,i,a,l,d,f){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,f),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,i){return this.connection.Wo("Write",t,i)}g_(t){return vi(!!t.streamToken),this.lastStreamToken=t.streamToken,vi(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){vi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const i=C3e(t.writeResults,t.commitTime),a=Op(t.commitTime);return this.listener.v_(a,i)}C_(){const t={};t.database=JV(this.serializer),this.I_(t)}b_(t){const i={streamToken:this.lastStreamToken,writes:t.map(a=>R3e(this.serializer,a))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4e{}class S4e extends v4e{constructor(t,i,a,l){super(),this.authCredentials=t,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new fn(kt.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,i,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.So(t,YV(i,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===kt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new fn(kt.UNKNOWN,d.toString())})}Co(t,i,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,y])=>this.connection.Co(t,YV(i,a),l,f,y,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===kt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new fn(kt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class b4e{constructor(t,i){this.asyncQueue=t,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const i=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Wf(i),this.N_=!1):un("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy="RemoteStore";class w4e{constructor(t,i,a,l,d){this.localStore=t,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{eE(this)&&(un(qy,"Restarting streams for network reachability change."),await async function(v){const b=ur(v);b.W_.add(4),await LC(b),b.j_.set("Unknown"),b.W_.delete(4),await gN(b)}(this))})}),this.j_=new b4e(a,l)}}async function gN(n){if(eE(n))for(const t of n.G_)await t(!0)}async function LC(n){for(const t of n.G_)await t(!1)}function Tse(n,t){const i=ur(n);i.K_.has(t.targetId)||(i.K_.set(t.targetId,t),D5(i)?N5(i):W0(i).c_()&&k5(i,t))}function O5(n,t){const i=ur(n),a=W0(i);i.K_.delete(t),a.c_()&&Rse(i,t),i.K_.size===0&&(a.c_()?a.P_():eE(i)&&i.j_.set("Unknown"))}function k5(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ar.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(i)}W0(n).y_(t)}function Rse(n,t){n.H_.Ne(t),W0(n).w_(t)}function N5(n){n.H_=new _3e({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.K_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),W0(n).start(),n.j_.B_()}function D5(n){return eE(n)&&!W0(n).u_()&&n.K_.size>0}function eE(n){return ur(n).W_.size===0}function Cse(n){n.H_=void 0}async function T4e(n){n.j_.set("Online")}async function R4e(n){n.K_.forEach((t,i)=>{k5(n,t)})}async function C4e(n,t){Cse(n),D5(n)?(n.j_.q_(t),N5(n)):n.j_.set("Unknown")}async function I4e(n,t,i){if(n.j_.set("Online"),t instanceof use&&t.state===2&&t.cause)try{await async function(l,d){const f=d.cause;for(const y of d.targetIds)l.K_.has(y)&&(await l.remoteSyncer.rejectListen(y,f),l.K_.delete(y),l.H_.removeTarget(y))}(n,t)}catch(a){un(qy,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await fk(n,a)}else if(t instanceof IO?n.H_.We(t):t instanceof lse?n.H_.Ze(t):n.H_.je(t),!i.isEqual(ar.min()))try{const a=await Sse(n.localStore);i.compareTo(a)>=0&&await function(d,f){const y=d.H_.ot(f);return y.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const R=d.K_.get(b);R&&d.K_.set(b,R.withResumeToken(v.resumeToken,f))}}),y.targetMismatches.forEach((v,b)=>{const R=d.K_.get(v);if(!R)return;d.K_.set(v,R.withResumeToken(Ua.EMPTY_BYTE_STRING,R.snapshotVersion)),Rse(d,v);const I=new yg(R.target,v,b,R.sequenceNumber);k5(d,I)}),d.remoteSyncer.applyRemoteEvent(y)}(n,i)}catch(a){un(qy,"Failed to raise snapshot:",a),await fk(n,a)}}async function fk(n,t,i){if(!z0(t))throw t;n.W_.add(1),await LC(n),n.j_.set("Offline"),i||(i=()=>Sse(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{un(qy,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await gN(n)})}function Ise(n,t){return t().catch(i=>fk(n,i,t))}async function _N(n){const t=ur(n),i=Dg(t);let a=t.U_.length>0?t.U_[t.U_.length-1].batchId:m5;for(;A4e(t);)try{const l=await l4e(t.localStore,a);if(l===null){t.U_.length===0&&i.P_();break}a=l.batchId,P4e(t,l)}catch(l){await fk(t,l)}Ase(t)&&Pse(t)}function A4e(n){return eE(n)&&n.U_.length<10}function P4e(n,t){n.U_.push(t);const i=Dg(n);i.c_()&&i.S_&&i.b_(t.mutations)}function Ase(n){return eE(n)&&!Dg(n).u_()&&n.U_.length>0}function Pse(n){Dg(n).start()}async function O4e(n){Dg(n).C_()}async function k4e(n){const t=Dg(n);for(const i of n.U_)t.b_(i.mutations)}async function N4e(n,t,i){const a=n.U_.shift(),l=w5.from(a,t,i);await Ise(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await _N(n)}async function D4e(n,t){t&&Dg(n).S_&&await async function(a,l){if(function(f){return m3e(f)&&f!==kt.ABORTED}(l.code)){const d=a.U_.shift();Dg(a).h_(),await Ise(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await _N(a)}}(n,t),Ase(n)&&Pse(n)}async function LJ(n,t){const i=ur(n);i.asyncQueue.verifyOperationInProgress(),un(qy,"RemoteStore received new credentials");const a=eE(i);i.W_.add(3),await LC(i),a&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(t),i.W_.delete(3),await gN(i)}async function x4e(n,t){const i=ur(n);t?(i.W_.delete(2),await gN(i)):t||(i.W_.add(2),await LC(i),i.j_.set("Unknown"))}function W0(n){return n.J_||(n.J_=function(i,a,l){const d=ur(i);return d.M_(),new y4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:T4e.bind(null,n),No:R4e.bind(null,n),Lo:C4e.bind(null,n),p_:I4e.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),D5(n)?N5(n):n.j_.set("Unknown")):(await n.J_.stop(),Cse(n))})),n.J_}function Dg(n){return n.Y_||(n.Y_=function(i,a,l){const d=ur(i);return d.M_(),new E4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:O4e.bind(null,n),Lo:D4e.bind(null,n),D_:k4e.bind(null,n),v_:N4e.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await _N(n)):(await n.Y_.stop(),n.U_.length>0&&(un(qy,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5{constructor(t,i,a,l,d){this.asyncQueue=t,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new xf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,i,a,l,d){const f=Date.now()+a,y=new x5(t,i,f,l,d);return y.start(a),y}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new fn(kt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function L5(n,t){if(Wf("AsyncQueue",`${t}: ${n}`),z0(n))return new fn(kt.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{static emptySet(t){return new r0(t.comparator)}constructor(t){this.comparator=t?(i,a)=>t(i,a)||kn.comparator(i.key,a.key):(i,a)=>kn.comparator(i.key,a.key),this.keyedMap=rR(),this.sortedSet=new Ps(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const i=this.keyedMap.get(t);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((i,a)=>(t(i),!1))}add(t){const i=this.delete(t.key);return i.copy(i.keyedMap.insert(t.key,t),i.sortedSet.insert(t,null))}delete(t){const i=this.get(t);return i?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(i)):this}isEqual(t){if(!(t instanceof r0)||this.size!==t.size)return!1;const i=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(i=>{t.push(i.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,i){const a=new r0;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MJ{constructor(){this.Z_=new Ps(kn.comparator)}track(t){const i=t.doc.key,a=this.Z_.get(i);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(i,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(i,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(i):t.type===1&&a.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:t.doc}):Jn():this.Z_=this.Z_.insert(i,t)}X_(){const t=[];return this.Z_.inorderTraversal((i,a)=>{t.push(a)}),t}}class I0{constructor(t,i,a,l,d,f,y,v,b){this.query=t,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=y,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(t,i,a,l,d){const f=[];return i.forEach(y=>{f.push({type:0,doc:y})}),new I0(t,i,r0.emptySet(i),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&uN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const i=this.docChanges,a=t.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L4e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class M4e{constructor(){this.queries=UJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,a){const l=ur(i),d=l.queries;l.queries=UJ(),d.forEach((f,y)=>{for(const v of y.ta)v.onError(a)})})(this,new fn(kt.ABORTED,"Firestore shutting down"))}}function UJ(){return new Zy(n=>Yie(n),uN)}async function Ose(n,t){const i=ur(n);let a=3;const l=t.query;let d=i.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new L4e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await i.onListen(l,!0);break;case 1:d.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(f){const y=L5(f,`Initialization of query '${bS(t.query)}' failed`);return void t.onError(y)}i.queries.set(l,d),d.ta.push(t),t.sa(i.onlineState),d.ea&&t.oa(d.ea)&&M5(i)}async function kse(n,t){const i=ur(n),a=t.query;let l=3;const d=i.queries.get(a);if(d){const f=d.ta.indexOf(t);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function U4e(n,t){const i=ur(n);let a=!1;for(const l of t){const d=l.query,f=i.queries.get(d);if(f){for(const y of f.ta)y.oa(l)&&(a=!0);f.ea=l}}a&&M5(i)}function V4e(n,t,i){const a=ur(n),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(i);a.queries.delete(t)}function M5(n){n.ia.forEach(t=>{t.next()})}var eF,VJ;(VJ=eF||(eF={}))._a="default",VJ.Cache="cache";class Nse{constructor(t,i,a){this.query=t,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new I0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let i=!1;return this.ua?this.la(t)&&(this.aa.next(t),i=!0):this.ha(t,this.onlineState)&&(this.Pa(t),i=!0),this.ca=t,i}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),i=!0),i}ha(t,i){if(!t.fromCache||!this.ra())return!0;const a=i!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||i==="Offline")}la(t){if(t.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(t){t=I0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==eF.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dse{constructor(t){this.key=t}}class xse{constructor(t){this.key=t}}class F4e{constructor(t,i){this.query=t,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=jr(),this.mutatedKeys=jr(),this.ya=Xie(t),this.wa=new r0(this.ya)}get Sa(){return this.fa}ba(t,i){const a=i?i.Da:new MJ,l=i?i.wa:this.wa;let d=i?i.mutatedKeys:this.mutatedKeys,f=l,y=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((R,I)=>{const k=l.get(R),M=dN(this.query,I)?I:null,L=!!k&&this.mutatedKeys.has(k.key),j=!!M&&(M.hasLocalMutations||this.mutatedKeys.has(M.key)&&M.hasCommittedMutations);let z=!1;k&&M?k.data.isEqual(M.data)?L!==j&&(a.track({type:3,doc:M}),z=!0):this.va(k,M)||(a.track({type:2,doc:M}),z=!0,(v&&this.ya(M,v)>0||b&&this.ya(M,b)<0)&&(y=!0)):!k&&M?(a.track({type:0,doc:M}),z=!0):k&&!M&&(a.track({type:1,doc:k}),z=!0,(v||b)&&(y=!0)),z&&(M?(f=f.add(M),d=j?d.add(R):d.delete(R)):(f=f.delete(R),d=d.delete(R)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const R=this.query.limitType==="F"?f.last():f.first();f=f.delete(R.key),d=d.delete(R.key),a.track({type:1,doc:R})}return{wa:f,Da:a,ls:y,mutatedKeys:d}}va(t,i){return t.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(t,i,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const f=t.Da.X_();f.sort((R,I)=>function(M,L){const j=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Jn()}};return j(M)-j(L)}(R.type,I.type)||this.ya(R.doc,I.doc)),this.Ca(a),l=l!=null&&l;const y=i&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,f.length!==0||b?{snapshot:new I0(this.query,t.wa,d,f,t.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:y}:{Ma:y}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new MJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),t.modifiedDocuments.forEach(i=>{}),t.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=jr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const i=[];return t.forEach(a=>{this.pa.has(a)||i.push(new xse(a))}),this.pa.forEach(a=>{t.has(a)||i.push(new Dse(a))}),i}Oa(t){this.fa=t.gs,this.pa=jr();const i=this.ba(t.documents);return this.applyChanges(i,!0)}Na(){return I0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const U5="SyncEngine";class j4e{constructor(t,i,a){this.query=t,this.targetId=i,this.view=a}}class B4e{constructor(t){this.key=t,this.Ba=!1}}class z4e{constructor(t,i,a,l,d,f){this.localStore=t,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new Zy(y=>Yie(y),uN),this.qa=new Map,this.Qa=new Set,this.$a=new Ps(kn.comparator),this.Ua=new Map,this.Ka=new C5,this.Wa={},this.Ga=new Map,this.za=C0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function W4e(n,t,i=!0){const a=jse(n);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await Lse(a,t,i,!0),l}async function G4e(n,t){const i=jse(n);await Lse(i,t,!0,!1)}async function Lse(n,t,i,a){const l=await u4e(n.localStore,Pp(t)),d=l.targetId,f=n.sharedClientState.addLocalQueryTarget(d,i);let y;return a&&(y=await H4e(n,t,d,f==="current",l.resumeToken)),n.isPrimaryClient&&i&&Tse(n.remoteStore,l),y}async function H4e(n,t,i,a,l){n.Ha=(I,k,M)=>async function(j,z,Y,K){let ne=z.view.ba(Y);ne.ls&&(ne=await OJ(j.localStore,z.query,!1).then(({documents:X})=>z.view.ba(X,ne)));const ce=K&&K.targetChanges.get(z.targetId),oe=K&&K.targetMismatches.get(z.targetId)!=null,ge=z.view.applyChanges(ne,j.isPrimaryClient,ce,oe);return jJ(j,z.targetId,ge.Ma),ge.snapshot}(n,I,k,M);const d=await OJ(n.localStore,t,!0),f=new F4e(t,d.gs),y=f.ba(d.documents),v=xC.createSynthesizedTargetChangeForCurrentChange(i,a&&n.onlineState!=="Offline",l),b=f.applyChanges(y,n.isPrimaryClient,v);jJ(n,i,b.Ma);const R=new j4e(t,i,f);return n.ka.set(t,R),n.qa.has(i)?n.qa.get(i).push(t):n.qa.set(i,[t]),b.snapshot}async function $4e(n,t,i){const a=ur(n),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!uN(f,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await QV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&O5(a.remoteStore,l.targetId),tF(a,l.targetId)}).catch(B0)):(tF(a,l.targetId),await QV(a.localStore,l.targetId,!0))}async function K4e(n,t){const i=ur(n),a=i.ka.get(t),l=i.qa.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),O5(i.remoteStore,a.targetId))}async function q4e(n,t,i){const a=tBe(n);try{const l=await function(f,y){const v=ur(f),b=Wo.now(),R=y.reduce((M,L)=>M.add(L.key),jr());let I,k;return v.persistence.runTransaction("Locally write mutations","readwrite",M=>{let L=Gf(),j=jr();return v.ds.getEntries(M,R).next(z=>{L=z,L.forEach((Y,K)=>{K.isValidDocument()||(j=j.add(Y))})}).next(()=>v.localDocuments.getOverlayedDocuments(M,L)).next(z=>{I=z;const Y=[];for(const K of y){const ne=u3e(K,I.get(K.key).overlayedDocument);ne!=null&&Y.push(new zg(K.key,ne,Bie(ne.value.mapValue),Qu.exists(!0)))}return v.mutationQueue.addMutationBatch(M,b,Y,y)}).next(z=>{k=z;const Y=z.applyToLocalDocumentSet(I,j);return v.documentOverlayCache.saveOverlays(M,z.batchId,Y)})}).then(()=>({batchId:k.batchId,changes:Qie(I)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(f,y,v){let b=f.Wa[f.currentUser.toKey()];b||(b=new Ps(Cr)),b=b.insert(y,v),f.Wa[f.currentUser.toKey()]=b}(a,l.batchId,i),await MC(a,l.changes),await _N(a.remoteStore)}catch(l){const d=L5(l,"Failed to persist write");i.reject(d)}}async function Mse(n,t){const i=ur(n);try{const a=await a4e(i.localStore,t);t.targetChanges.forEach((l,d)=>{const f=i.Ua.get(d);f&&(vi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?vi(f.Ba):l.removedDocuments.size>0&&(vi(f.Ba),f.Ba=!1))}),await MC(i,a,t)}catch(a){await B0(a)}}function FJ(n,t,i){const a=ur(n);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ka.forEach((d,f)=>{const y=f.view.sa(t);y.snapshot&&l.push(y.snapshot)}),function(f,y){const v=ur(f);v.onlineState=y;let b=!1;v.queries.forEach((R,I)=>{for(const k of I.ta)k.sa(y)&&(b=!0)}),b&&M5(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function Y4e(n,t,i){const a=ur(n);a.sharedClientState.updateQueryState(t,"rejected",i);const l=a.Ua.get(t),d=l&&l.key;if(d){let f=new Ps(kn.comparator);f=f.insert(d,ac.newNoDocument(d,ar.min()));const y=jr().add(d),v=new fN(ar.min(),new Map,new Ps(Cr),f,y);await Mse(a,v),a.$a=a.$a.remove(d),a.Ua.delete(t),V5(a)}else await QV(a.localStore,t,!1).then(()=>tF(a,t,i)).catch(B0)}async function X4e(n,t){const i=ur(n),a=t.batch.batchId;try{const l=await o4e(i.localStore,t);Vse(i,a,null),Use(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await MC(i,l)}catch(l){await B0(l)}}async function J4e(n,t,i){const a=ur(n);try{const l=await function(f,y){const v=ur(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let R;return v.mutationQueue.lookupMutationBatch(b,y).next(I=>(vi(I!==null),R=I.keys(),v.mutationQueue.removeMutationBatch(b,I))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,R,y)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,R)).next(()=>v.localDocuments.getDocuments(b,R))})}(a.localStore,t);Vse(a,t,i),Use(a,t),a.sharedClientState.updateMutationState(t,"rejected",i),await MC(a,l)}catch(l){await B0(l)}}function Use(n,t){(n.Ga.get(t)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(t)}function Vse(n,t,i){const a=ur(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(i?d.reject(i):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function tF(n,t,i=null){n.sharedClientState.removeLocalQueryTarget(t);for(const a of n.qa.get(t))n.ka.delete(a),i&&n.La.Ja(a,i);n.qa.delete(t),n.isPrimaryClient&&n.Ka.br(t).forEach(a=>{n.Ka.containsKey(a)||Fse(n,a)})}function Fse(n,t){n.Qa.delete(t.path.canonicalString());const i=n.$a.get(t);i!==null&&(O5(n.remoteStore,i),n.$a=n.$a.remove(t),n.Ua.delete(i),V5(n))}function jJ(n,t,i){for(const a of i)a instanceof Dse?(n.Ka.addReference(a.key,t),Q4e(n,a)):a instanceof xse?(un(U5,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,t),n.Ka.containsKey(a.key)||Fse(n,a.key)):Jn()}function Q4e(n,t){const i=t.key,a=i.path.canonicalString();n.$a.get(i)||n.Qa.has(a)||(un(U5,"New document in limbo: "+i),n.Qa.add(a),V5(n))}function V5(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const i=new kn(os.fromString(t)),a=n.za.next();n.Ua.set(a,new B4e(i)),n.$a=n.$a.insert(i,a),Tse(n.remoteStore,new yg(Pp(v5(i.path)),a,"TargetPurposeLimboResolution",aN.ae))}}async function MC(n,t,i){const a=ur(n),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((y,v)=>{f.push(a.Ha(v,t,i).then(b=>{var R;if((b||i)&&a.isPrimaryClient){const I=b?!b.fromCache:(R=i==null?void 0:i.targetChanges.get(v.targetId))===null||R===void 0?void 0:R.current;a.sharedClientState.updateQueryState(v.targetId,I?"current":"not-current")}if(b){l.push(b);const I=A5.Yi(v.targetId,b);d.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(v,b){const R=ur(v);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Ot.forEach(b,k=>Ot.forEach(k.Hi,M=>R.persistence.referenceDelegate.addReference(I,k.targetId,M)).next(()=>Ot.forEach(k.Ji,M=>R.persistence.referenceDelegate.removeReference(I,k.targetId,M)))))}catch(I){if(!z0(I))throw I;un(P5,"Failed to update sequence numbers: "+I)}for(const I of b){const k=I.targetId;if(!I.fromCache){const M=R.Ts.get(k),L=M.snapshotVersion,j=M.withLastLimboFreeSnapshotVersion(L);R.Ts=R.Ts.insert(k,j)}}}(a.localStore,d))}async function Z4e(n,t){const i=ur(n);if(!i.currentUser.isEqual(t)){un(U5,"User change. New user:",t.toKey());const a=await vse(i.localStore,t);i.currentUser=t,function(d,f){d.Ga.forEach(y=>{y.forEach(v=>{v.reject(new fn(kt.CANCELLED,f))})}),d.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await MC(i,a.Rs)}}function eBe(n,t){const i=ur(n),a=i.Ua.get(t);if(a&&a.Ba)return jr().add(a.key);{let l=jr();const d=i.qa.get(t);if(!d)return l;for(const f of d){const y=i.ka.get(f);l=l.unionWith(y.view.Sa)}return l}}function jse(n){const t=ur(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Mse.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=eBe.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Y4e.bind(null,t),t.La.p_=U4e.bind(null,t.eventManager),t.La.Ja=V4e.bind(null,t.eventManager),t}function tBe(n){const t=ur(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=X4e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=J4e.bind(null,t),t}class mk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=mN(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,i){return null}nu(t,i){return null}eu(t){return s4e(this.persistence,new n4e,t.initialUser,this.serializer)}Xa(t){return new Ese(I5.ri,this.serializer)}Za(t){return new h4e}async terminate(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}mk.provider={build:()=>new mk};class nBe extends mk{constructor(t){super(),this.cacheSizeBytes=t}tu(t,i){vi(this.persistence.referenceDelegate instanceof pk);const a=this.persistence.referenceDelegate.garbageCollector;return new B3e(a,t.asyncQueue,i)}Xa(t){const i=this.cacheSizeBytes!==void 0?ul.withCacheSize(this.cacheSizeBytes):ul.DEFAULT;return new Ese(a=>pk.ri(a,i),this.serializer)}}class nF{async initialize(t,i){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>FJ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=Z4e.bind(null,this.syncEngine),await x4e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new M4e}()}createDatastore(t){const i=mN(t.databaseInfo.databaseId),a=function(d){return new _4e(d)}(t.databaseInfo);return function(d,f,y,v){return new S4e(d,f,y,v)}(t.authCredentials,t.appCheckCredentials,a,i)}createRemoteStore(t){return function(a,l,d,f,y){return new w4e(a,l,d,f,y)}(this.localStore,this.datastore,t.asyncQueue,i=>FJ(this.syncEngine,i,0),function(){return DJ.D()?new DJ:new p4e}())}createSyncEngine(t,i){return function(l,d,f,y,v,b,R){const I=new z4e(l,d,f,y,v,b);return R&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}async terminate(){var t,i;await async function(l){const d=ur(l);un(qy,"RemoteStore shutting down."),d.W_.add(5),await LC(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}nF.provider={build:()=>new nF};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bse{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Wf("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,i){setTimeout(()=>{this.muted||t(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xg="FirestoreClient";class rBe{constructor(t,i,a,l,d){this.authCredentials=t,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=oc.UNAUTHENTICATED,this.clientId=kie.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{un(xg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(un(xg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new xf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(i){const a=L5(i,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function PU(n,t){n.asyncQueue.verifyOperationInProgress(),un(xg,"Initializing OfflineComponentProvider");const i=n.configuration;await t.initialize(i);let a=i.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await vse(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function BJ(n,t){n.asyncQueue.verifyOperationInProgress();const i=await iBe(n);un(xg,"Initializing OnlineComponentProvider"),await t.initialize(i,n.configuration),n.setCredentialChangeListener(a=>LJ(t.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>LJ(t.remoteStore,l)),n._onlineComponents=t}async function iBe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){un(xg,"Using user provided OfflineComponentProvider");try{await PU(n,n._uninitializedComponentsProvider._offline)}catch(t){const i=t;if(!function(l){return l.name==="FirebaseError"?l.code===kt.FAILED_PRECONDITION||l.code===kt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;v0("Error using user provided cache. Falling back to memory cache: "+i),await PU(n,new mk)}}else un(xg,"Using default OfflineComponentProvider"),await PU(n,new nBe(void 0));return n._offlineComponents}async function zse(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(un(xg,"Using user provided OnlineComponentProvider"),await BJ(n,n._uninitializedComponentsProvider._online)):(un(xg,"Using default OnlineComponentProvider"),await BJ(n,new nF))),n._onlineComponents}function sBe(n){return zse(n).then(t=>t.syncEngine)}async function Wse(n){const t=await zse(n),i=t.eventManager;return i.onListen=W4e.bind(null,t.syncEngine),i.onUnlisten=$4e.bind(null,t.syncEngine),i.onFirstRemoteStoreListen=G4e.bind(null,t.syncEngine),i.onLastRemoteStoreUnlisten=K4e.bind(null,t.syncEngine),i}function oBe(n,t,i={}){const a=new xf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,y,v,b){const R=new Bse({next:k=>{R.su(),f.enqueueAndForget(()=>kse(d,I));const M=k.docs.has(y);!M&&k.fromCache?b.reject(new fn(kt.UNAVAILABLE,"Failed to get document because the client is offline.")):M&&k.fromCache&&v&&v.source==="server"?b.reject(new fn(kt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(k)},error:k=>b.reject(k)}),I=new Nse(v5(y.path),R,{includeMetadataChanges:!0,Ta:!0});return Ose(d,I)}(await Wse(n),n.asyncQueue,t,i,a)),a.promise}function aBe(n,t,i={}){const a=new xf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,y,v,b){const R=new Bse({next:k=>{R.su(),f.enqueueAndForget(()=>kse(d,I)),k.fromCache&&v.source==="server"?b.reject(new fn(kt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(k)},error:k=>b.reject(k)}),I=new Nse(y,R,{includeMetadataChanges:!0,Ta:!0});return Ose(d,I)}(await Wse(n),n.asyncQueue,t,i,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gse(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hse(n,t,i){if(!i)throw new fn(kt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function cBe(n,t,i,a){if(t===!0&&a===!0)throw new fn(kt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function WJ(n){if(!kn.isDocumentKey(n))throw new fn(kt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function GJ(n){if(kn.isDocumentKey(n))throw new fn(kt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function yN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":Jn()}function lh(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new fn(kt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=yN(n);throw new fn(kt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $se="firestore.googleapis.com",HJ=!0;class $J{constructor(t){var i,a;if(t.host===void 0){if(t.ssl!==void 0)throw new fn(kt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=$se,this.ssl=HJ}else this.host=t.host,this.ssl=(i=t.ssl)!==null&&i!==void 0?i:HJ;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=yse;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<F3e)throw new fn(kt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}cBe("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gse((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new fn(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new fn(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new fn(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class EN{constructor(t,i,a,l){this._authCredentials=t,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $J({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new fn(kt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new fn(kt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $J(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new g5e;switch(a.type){case"firstParty":return new v5e(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new fn(kt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=zJ.get(i);a&&(un("ComponentProvider","Removing Datastore"),zJ.delete(i),a.terminate())}(this),Promise.resolve()}}function lBe(n,t,i,a={}){var l;const d=(n=lh(n,EN))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),y=`${t}:${i}`;d.host!==$se&&d.host!==y&&v0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:y,ssl:!1,emulatorOptions:a});if(!Ff(v,f)&&(n._setSettings(v),a.mockUserToken)){let b,R;if(typeof a.mockUserToken=="string")b=a.mockUserToken,R=oc.MOCK_USER;else{b=xre(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new fn(kt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new oc(I)}n._authCredentials=new _5e(new Pie(b,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tE{constructor(t,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new tE(this.firestore,t,this._query)}}class xc{constructor(t,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tg(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new xc(this.firestore,t,this._key)}}class Tg extends tE{constructor(t,i,a){super(t,i,v5(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new xc(this.firestore,null,new kn(t))}withConverter(t){return new Tg(this.firestore,t,this._path)}}function nu(n,t,...i){if(n=Wi(n),Hse("collection","path",t),n instanceof EN){const a=os.fromString(t,...i);return GJ(a),new Tg(n,null,a)}{if(!(n instanceof xc||n instanceof Tg))throw new fn(kt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(os.fromString(t,...i));return GJ(a),new Tg(n.firestore,null,a)}}function Ir(n,t,...i){if(n=Wi(n),arguments.length===1&&(t=kie.newId()),Hse("doc","path",t),n instanceof EN){const a=os.fromString(t,...i);return WJ(a),new xc(n,null,new kn(a))}{if(!(n instanceof xc||n instanceof Tg))throw new fn(kt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(os.fromString(t,...i));return WJ(a),new xc(n.firestore,n instanceof Tg?n.converter:null,new kn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KJ="AsyncQueue";class qJ{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new bse(this,"async_queue_retry"),this.Su=()=>{const a=AU();a&&un(KJ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=t;const i=AU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const i=AU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const i=new xf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!z0(t))throw t;un(KJ,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const i=this.bu.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let y=f.message||"";return f.stack&&(y=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),y}(a);throw Wf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=i,i}enqueueAfterDelay(t,i,a){this.Du(),this.wu.indexOf(t)>-1&&(i=0);const l=x5.createAndSchedule(this,t,i,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Jn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.bu,await t;while(t!==this.bu)}xu(t){for(const i of this.fu)if(i.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),t!=="all"&&i.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const i=this.fu.indexOf(t);this.fu.splice(i,1)}}class nE extends EN{constructor(t,i,a,l){super(t,i,a,l),this.type="firestore",this._queue=new qJ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new qJ(t),this._firestoreClient=void 0,await t}}}function AO(n,t){const i=typeof n=="object"?n:nN(),a=typeof n=="string"?n:sk,l=IC(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=r5("firestore");d&&lBe(l,...d)}return l}function F5(n){if(n._terminated)throw new fn(kt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||uBe(n),n._firestoreClient}function uBe(n){var t,i,a;const l=n._freezeSettings(),d=function(y,v,b,R){return new L5e(y,v,b,R.host,R.ssl,R.experimentalForceLongPolling,R.experimentalAutoDetectLongPolling,Gse(R.experimentalLongPollingOptions),R.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new rBe(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(y){const v=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new A0(Ua.fromBase64String(t))}catch(i){throw new fn(kt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(t){return new A0(Ua.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{constructor(...t){for(let i=0;i<t.length;++i)if(t[i].length===0)throw new fn(kt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new La(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j5{constructor(t,i){if(!isFinite(t)||t<-90||t>90)throw new fn(kt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(i)||i<-180||i>180)throw new fn(kt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=t,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Cr(this._lat,t._lat)||Cr(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{constructor(t){this._values=(t||[]).map(i=>i)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dBe=/^__.*__$/;class hBe{constructor(t,i,a){this.data=t,this.fieldMask=i,this.fieldTransforms=a}toMutation(t,i){return this.fieldMask!==null?new zg(t,this.data,this.fieldMask,i,this.fieldTransforms):new DC(t,this.data,i,this.fieldTransforms)}}class Kse{constructor(t,i,a){this.data=t,this.fieldMask=i,this.fieldTransforms=a}toMutation(t,i){return new zg(t,this.data,this.fieldMask,i,this.fieldTransforms)}}function qse(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Jn()}}class SN{constructor(t,i,a,l,d,f){this.settings=t,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new SN(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Uu(t){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return gk(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(i=>t.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>t.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(qse(this.Lu)&&dBe.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class pBe{constructor(t,i,a){this.databaseId=t,this.ignoreUndefinedProperties=i,this.serializer=a||mN(t)}ju(t,i,a,l=!1){return new SN({Lu:t,methodName:i,zu:a,path:La.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function bN(n){const t=n._freezeSettings(),i=mN(n._databaseId);return new pBe(n._databaseId,!!t.ignoreUndefinedProperties,i)}function Yse(n,t,i,a,l,d={}){const f=n.ju(d.merge||d.mergeFields?2:0,t,i,l);G5("Data must be an object, but it was:",f,a);const y=Jse(a,f);let v,b;if(d.merge)v=new Jl(f.fieldMask),b=f.fieldTransforms;else if(d.mergeFields){const R=[];for(const I of d.mergeFields){const k=rF(t,I,i);if(!f.contains(k))throw new fn(kt.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);Zse(R,k)||R.push(k)}v=new Jl(R),b=f.fieldTransforms.filter(I=>v.covers(I.field))}else v=null,b=f.fieldTransforms;return new hBe(new pl(y),v,b)}class wN extends UC{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof wN}}function Xse(n,t,i){return new SN({Lu:3,zu:t.settings.zu,methodName:n._methodName,Qu:i},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class z5 extends UC{constructor(t,i){super(t),this.Hu=i}_toFieldTransform(t){const i=Xse(this,t,!0),a=this.Hu.map(d=>rE(d,i)),l=new T0(a);return new sse(t.path,l)}isEqual(t){return t instanceof z5&&Ff(this.Hu,t.Hu)}}class W5 extends UC{constructor(t,i){super(t),this.Hu=i}_toFieldTransform(t){const i=Xse(this,t,!0),a=this.Hu.map(d=>rE(d,i)),l=new R0(a);return new sse(t.path,l)}isEqual(t){return t instanceof W5&&Ff(this.Hu,t.Hu)}}function fBe(n,t,i,a){const l=n.ju(1,t,i);G5("Data must be an object, but it was:",l,a);const d=[],f=pl.empty();Bg(a,(v,b)=>{const R=H5(t,v,i);b=Wi(b);const I=l.Uu(R);if(b instanceof wN)d.push(R);else{const k=rE(b,I);k!=null&&(d.push(R),f.set(R,k))}});const y=new Jl(d);return new Kse(f,y,l.fieldTransforms)}function mBe(n,t,i,a,l,d){const f=n.ju(1,t,i),y=[rF(t,a,i)],v=[l];if(d.length%2!=0)throw new fn(kt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let k=0;k<d.length;k+=2)y.push(rF(t,d[k])),v.push(d[k+1]);const b=[],R=pl.empty();for(let k=y.length-1;k>=0;--k)if(!Zse(b,y[k])){const M=y[k];let L=v[k];L=Wi(L);const j=f.Uu(M);if(L instanceof wN)b.push(M);else{const z=rE(L,j);z!=null&&(b.push(M),R.set(M,z))}}const I=new Jl(b);return new Kse(R,I,f.fieldTransforms)}function gBe(n,t,i,a=!1){return rE(i,n.ju(a?4:3,t))}function rE(n,t){if(Qse(n=Wi(n)))return G5("Unsupported field value:",t,n),Jse(n,t);if(n instanceof UC)return function(a,l){if(!qse(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const y of a){let v=rE(y,l.Ku(f));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),f++}return{arrayValue:{values:d}}}(n,t)}return function(a,l){if((a=Wi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return i3e(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=Wo.fromDate(a);return{timestampValue:hk(l.serializer,d)}}if(a instanceof Wo){const d=new Wo(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:hk(l.serializer,d)}}if(a instanceof j5)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof A0)return{bytesValue:dse(l.serializer,a._byteString)};if(a instanceof xc){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:R5(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof B5)return function(f,y){return{mapValue:{fields:{[Fie]:{stringValue:jie},[ok]:{arrayValue:{values:f.toArray().map(b=>{if(typeof b!="number")throw y.Wu("VectorValues must only contain numeric values.");return S5(y.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${yN(a)}`)}(n,t)}function Jse(n,t){const i={};return Die(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Bg(n,(a,l)=>{const d=rE(l,t.qu(a));d!=null&&(i[a]=d)}),{mapValue:{fields:i}}}function Qse(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Wo||n instanceof j5||n instanceof A0||n instanceof xc||n instanceof UC||n instanceof B5)}function G5(n,t,i){if(!Qse(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=yN(i);throw a==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+a)}}function rF(n,t,i){if((t=Wi(t))instanceof vN)return t._internalPath;if(typeof t=="string")return H5(n,t);throw gk("Field path arguments must be of type string or ",n,!1,void 0,i)}const _Be=new RegExp("[~\\*/\\[\\]]");function H5(n,t,i){if(t.search(_Be)>=0)throw gk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new vN(...t.split("."))._internalPath}catch{throw gk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function gk(n,t,i,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let y=`Function ${t}() called with invalid data`;i&&(y+=" (via `toFirestore()`)"),y+=". ";let v="";return(d||f)&&(v+=" (found",d&&(v+=` in field ${a}`),f&&(v+=` in document ${l}`),v+=")"),new fn(kt.INVALID_ARGUMENT,y+n+v)}function Zse(n,t){return n.some(i=>i.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eoe{constructor(t,i,a,l,d){this._firestore=t,this._userDataWriter=i,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new xc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new yBe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const i=this._document.data.field($5("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i)}}}class yBe extends eoe{data(){return super.data()}}function $5(n,t){return typeof t=="string"?H5(n,t):t instanceof vN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EBe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new fn(kt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class K5{}class toe extends K5{}function iF(n,t,...i){let a=[];t instanceof K5&&a.push(t),a=a.concat(i),function(d){const f=d.filter(v=>v instanceof q5).length,y=d.filter(v=>v instanceof TN).length;if(f>1||f>0&&y>0)throw new fn(kt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class TN extends toe{constructor(t,i,a){super(),this._field=t,this._op=i,this._value=a,this.type="where"}static _create(t,i,a){return new TN(t,i,a)}_apply(t){const i=this._parse(t);return noe(t._query,i),new tE(t.firestore,t.converter,KV(t._query,i))}_parse(t){const i=bN(t.firestore);return function(d,f,y,v,b,R,I){let k;if(b.isKeyField()){if(R==="array-contains"||R==="array-contains-any")throw new fn(kt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${R}' queries on documentId().`);if(R==="in"||R==="not-in"){JJ(I,R);const L=[];for(const j of I)L.push(XJ(v,d,j));k={arrayValue:{values:L}}}else k=XJ(v,d,I)}else R!=="in"&&R!=="not-in"&&R!=="array-contains-any"||JJ(I,R),k=gBe(y,f,I,R==="in"||R==="not-in");return wo.create(b,R,k)}(t._query,"where",i,t.firestore._databaseId,this._field,this._op,this._value)}}function YJ(n,t,i){const a=t,l=$5("where",n);return TN._create(l,a,i)}class q5 extends K5{constructor(t,i){super(),this.type=t,this._queryConstraints=i}static _create(t,i){return new q5(t,i)}_parse(t){const i=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:ch.create(i,this._getOperator())}_apply(t){const i=this._parse(t);return i.getFilters().length===0?t:(function(l,d){let f=l;const y=d.getFlattenedFilters();for(const v of y)noe(f,v),f=KV(f,v)}(t._query,i),new tE(t.firestore,t.converter,KV(t._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Y5 extends toe{constructor(t,i,a){super(),this.type=t,this._limit=i,this._limitType=a}static _create(t,i,a){return new Y5(t,i,a)}_apply(t){return new tE(t.firestore,t.converter,lk(t._query,this._limit,this._limitType))}}function vBe(n){return Y5._create("limit",n,"F")}function XJ(n,t,i){if(typeof(i=Wi(i))=="string"){if(i==="")throw new fn(kt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!qie(t)&&i.indexOf("/")!==-1)throw new fn(kt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=t.path.child(os.fromString(i));if(!kn.isDocumentKey(a))throw new fn(kt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return dJ(n,new kn(a))}if(i instanceof xc)return dJ(n,i._key);throw new fn(kt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${yN(i)}.`)}function JJ(n,t){if(!Array.isArray(n)||n.length===0)throw new fn(kt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function noe(n,t){const i=function(l,d){for(const f of l)for(const y of f.getFlattenedFilters())if(d.indexOf(y.op)>=0)return y.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(i!==null)throw i===t.op?new fn(kt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new fn(kt.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${i.toString()}' filters.`)}class SBe{convertValue(t,i="none"){switch(Ng(t)){case 0:return null;case 1:return t.booleanValue;case 2:return oo(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,i);case 5:return t.stringValue;case 6:return this.convertBytes(kg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,i);case 11:return this.convertObject(t.mapValue,i);case 10:return this.convertVectorValue(t.mapValue);default:throw Jn()}}convertObject(t,i){return this.convertObjectMap(t.fields,i)}convertObjectMap(t,i="none"){const a={};return Bg(t,(l,d)=>{a[l]=this.convertValue(d,i)}),a}convertVectorValue(t){var i,a,l;const d=(l=(a=(i=t.fields)===null||i===void 0?void 0:i[ok].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>oo(f.doubleValue));return new B5(d)}convertGeoPoint(t){return new j5(oo(t.latitude),oo(t.longitude))}convertArray(t,i){return(t.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(t,i){switch(i){case"previous":const a=lN(t);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(sC(t));default:return null}}convertTimestamp(t){const i=Og(t);return new Wo(i.seconds,i.nanos)}convertDocumentKey(t,i){const a=os.fromString(t);vi(_se(a));const l=new oC(a.get(1),a.get(3)),d=new kn(a.popFirst(5));return l.isEqual(i)||Wf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function roe(n,t,i){let a;return a=n?i&&(i.merge||i.mergeFields)?n.toFirestore(t,i):n.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(t,i){this.hasPendingWrites=t,this.fromCache=i}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ioe extends eoe{constructor(t,i,a,l,d,f){super(t,i,a,l,f),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const i=new PO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,i={}){if(this._document){const a=this._document.data.field($5("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class PO extends ioe{data(t={}){return super.data(t)}}class bBe{constructor(t,i,a,l){this._firestore=t,this._userDataWriter=i,this._snapshot=l,this.metadata=new sR(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(i=>t.push(i)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,i){this._snapshot.docs.forEach(a=>{t.call(i,new PO(this._firestore,this._userDataWriter,a.key,a,new sR(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const i=!!t.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new fn(kt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(y=>{const v=new PO(l._firestore,l._userDataWriter,y.doc.key,y.doc,new sR(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(y=>d||y.type!==3).map(y=>{const v=new PO(l._firestore,l._userDataWriter,y.doc.key,y.doc,new sR(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,R=-1;return y.type!==0&&(b=f.indexOf(y.doc.key),f=f.delete(y.doc.key)),y.type!==1&&(f=f.add(y.doc),R=f.indexOf(y.doc.key)),{type:wBe(y.type),doc:v,oldIndex:b,newIndex:R}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function wBe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Jn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ho(n){n=lh(n,xc);const t=lh(n.firestore,nE);return oBe(F5(t),n._key).then(i=>CBe(t,n,i))}class soe extends SBe{constructor(t){super(),this.firestore=t}convertBytes(t){return new A0(t)}convertReference(t){const i=this.convertDocumentKey(t,this.firestore._databaseId);return new xc(this.firestore,null,i)}}function Zu(n){n=lh(n,tE);const t=lh(n.firestore,nE),i=F5(t),a=new soe(t);return EBe(n._query),aBe(i,n._query).then(l=>new bBe(t,a,n,l))}function Lg(n,t,i){n=lh(n,xc);const a=lh(n.firestore,nE),l=roe(n.converter,t,i);return RN(a,[Yse(bN(a),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Qu.none())])}function $o(n,t,i,...a){n=lh(n,xc);const l=lh(n.firestore,nE),d=bN(l);let f;return f=typeof(t=Wi(t))=="string"||t instanceof vN?mBe(d,"updateDoc",n._key,t,i,a):fBe(d,"updateDoc",n._key,t),RN(l,[f.toMutation(n._key,Qu.exists(!0))])}function TBe(n){return RN(lh(n.firestore,nE),[new b5(n._key,Qu.none())])}function RBe(n,t){const i=lh(n.firestore,nE),a=Ir(n),l=roe(n.converter,t);return RN(i,[Yse(bN(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Qu.exists(!1))]).then(()=>a)}function RN(n,t){return function(a,l){const d=new xf;return a.asyncQueue.enqueueAndForget(async()=>q4e(await sBe(a),l,d)),d.promise}(F5(n),t)}function CBe(n,t,i){const a=i.docs.get(t._key),l=new soe(n);return new ioe(n,l,t._key,a,new sR(i.hasPendingWrites,i.fromCache),t.converter)}function IBe(...n){return new z5("arrayUnion",n)}function ooe(...n){return new W5("arrayRemove",n)}(function(t,i=!0){(function(l){j0=l})(Qy),Ag(new jf("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),y=new nE(new y5e(a.getProvider("auth-internal")),new S5e(f,a.getProvider("app-check-internal")),function(b,R){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new fn(kt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oC(b.options.projectId,R)}(f,l),f);return d=Object.assign({useFetchStreams:i},d),y._setSettings(d),y},"PUBLIC").setMultipleInstances(!0)),Ju(ZX,eJ,t),Ju(ZX,eJ,"esm2017")})();var ABe="firebase",PBe="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ju(ABe,PBe,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OBe="type.googleapis.com/google.protobuf.Int64Value",kBe="type.googleapis.com/google.protobuf.UInt64Value";function aoe(n,t){const i={};for(const a in n)n.hasOwnProperty(a)&&(i[a]=t(n[a]));return i}function _k(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(t=>_k(t));if(typeof n=="function"||typeof n=="object")return aoe(n,t=>_k(t));throw new Error("Data cannot be encoded in JSON: "+n)}function P0(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case OBe:case kBe:{const t=Number(n.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+n);return t}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(t=>P0(t)):typeof n=="function"||typeof n=="object"?aoe(n,t=>P0(t)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QJ={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ml extends dh{constructor(t,i,a){super(`${X5}/${t}`,i||""),this.details=a,Object.setPrototypeOf(this,ml.prototype)}}function NBe(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function yk(n,t){let i=NBe(n),a=i,l;try{const d=t&&t.error;if(d){const f=d.status;if(typeof f=="string"){if(!QJ[f])return new ml("internal","internal");i=QJ[f],a=f}const y=d.message;typeof y=="string"&&(a=y),l=d.details,l!==void 0&&(l=P0(l))}}catch{}return i==="ok"?null:new ml(i,a,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DBe{constructor(t,i,a,l){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,hl(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=i.getImmediate({optional:!0}),this.messaging=a.getImmediate({optional:!0}),this.auth||i.get().then(d=>this.auth=d,()=>{}),this.messaging||a.get().then(d=>this.messaging=d,()=>{}),this.appCheck||l==null||l.get().then(d=>this.appCheck=d,()=>{})}async getAuthToken(){if(this.auth)try{const t=await this.auth.getToken();return t==null?void 0:t.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const i=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return i.error?null:i.token}return null}async getContext(t){const i=await this.getAuthToken(),a=await this.getMessagingToken(),l=await this.getAppCheckToken(t);return{authToken:i,messagingToken:a,appCheckToken:l}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sF="us-central1",xBe=/^data: (.*?)(?:\n|$)/;function LBe(n){let t=null;return{promise:new Promise((i,a)=>{t=setTimeout(()=>{a(new ml("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{t&&clearTimeout(t)}}}class MBe{constructor(t,i,a,l,d=sF,f=(...y)=>fetch(...y)){this.app=t,this.fetchImpl=f,this.emulatorOrigin=null,this.contextProvider=new DBe(t,i,a,l),this.cancelAllRequests=new Promise(y=>{this.deleteService=()=>Promise.resolve(y())});try{const y=new URL(d);this.customDomain=y.origin+(y.pathname==="/"?"":y.pathname),this.region=sF}catch{this.customDomain=null,this.region=d}}_delete(){return this.deleteService()}_url(t){const i=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${i}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${i}.cloudfunctions.net/${t}`}}function UBe(n,t,i){n.emulatorOrigin=`http://${t}:${i}`}function VBe(n,t,i){const a=l=>jBe(n,t,l,{});return a.stream=(l,d)=>zBe(n,t,l,d),a}async function FBe(n,t,i,a){i["Content-Type"]="application/json";let l;try{l=await a(n,{method:"POST",body:JSON.stringify(t),headers:i})}catch{return{status:0,json:null}}let d=null;try{d=await l.json()}catch{}return{status:l.status,json:d}}async function coe(n,t){const i={},a=await n.contextProvider.getContext(t.limitedUseAppCheckTokens);return a.authToken&&(i.Authorization="Bearer "+a.authToken),a.messagingToken&&(i["Firebase-Instance-ID-Token"]=a.messagingToken),a.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=a.appCheckToken),i}function jBe(n,t,i,a){const l=n._url(t);return BBe(n,l,i,a)}async function BBe(n,t,i,a){i=_k(i);const l={data:i},d=await coe(n,a),f=a.timeout||7e4,y=LBe(f),v=await Promise.race([FBe(t,l,d,n.fetchImpl),y.promise,n.cancelAllRequests]);if(y.cancel(),!v)throw new ml("cancelled","Firebase Functions instance was deleted.");const b=yk(v.status,v.json);if(b)throw b;if(!v.json)throw new ml("internal","Response is not valid JSON object.");let R=v.json.data;if(typeof R>"u"&&(R=v.json.result),typeof R>"u")throw new ml("internal","Response is missing data field.");return{data:P0(R)}}function zBe(n,t,i,a){const l=n._url(t);return WBe(n,l,i,a||{})}async function WBe(n,t,i,a){var l;i=_k(i);const d={data:i},f=await coe(n,a);f["Content-Type"]="application/json",f.Accept="text/event-stream";let y;try{y=await n.fetchImpl(t,{method:"POST",body:JSON.stringify(d),headers:f,signal:a==null?void 0:a.signal})}catch(M){if(M instanceof Error&&M.name==="AbortError"){const j=new ml("cancelled","Request was cancelled.");return{data:Promise.reject(j),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(j)}}}}}}const L=yk(0,null);return{data:Promise.reject(L),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(L)}}}}}}let v,b;const R=new Promise((M,L)=>{v=M,b=L});(l=a==null?void 0:a.signal)===null||l===void 0||l.addEventListener("abort",()=>{const M=new ml("cancelled","Request was cancelled.");b(M)});const I=y.body.getReader(),k=GBe(I,v,b,a==null?void 0:a.signal);return{stream:{[Symbol.asyncIterator](){const M=k.getReader();return{async next(){const{value:L,done:j}=await M.read();return{value:L,done:j}},async return(){return await M.cancel(),{done:!0,value:void 0}}}}},data:R}}function GBe(n,t,i,a){const l=(f,y)=>{const v=f.match(xBe);if(!v)return;const b=v[1];try{const R=JSON.parse(b);if("result"in R){t(P0(R.result));return}if("message"in R){y.enqueue(P0(R.message));return}if("error"in R){const I=yk(0,R);y.error(I),i(I);return}}catch(R){if(R instanceof ml){y.error(R),i(R);return}}},d=new TextDecoder;return new ReadableStream({start(f){let y="";return v();async function v(){if(a!=null&&a.aborted){const b=new ml("cancelled","Request was cancelled");return f.error(b),i(b),Promise.resolve()}try{const{value:b,done:R}=await n.read();if(R){y.trim()&&l(y.trim(),f),f.close();return}if(a!=null&&a.aborted){const k=new ml("cancelled","Request was cancelled");f.error(k),i(k),await n.cancel();return}y+=d.decode(b,{stream:!0});const I=y.split(`
`);y=I.pop()||"";for(const k of I)k.trim()&&l(k.trim(),f);return v()}catch(b){const R=b instanceof ml?b:yk(0,null);f.error(R),i(R)}}},cancel(){return n.cancel()}})}const ZJ="@firebase/functions",eQ="0.12.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HBe="auth-internal",$Be="app-check-internal",KBe="messaging-internal";function qBe(n){const t=(i,{instanceIdentifier:a})=>{const l=i.getProvider("app").getImmediate(),d=i.getProvider(HBe),f=i.getProvider(KBe),y=i.getProvider($Be);return new MBe(l,d,f,y,a)};Ag(new jf(X5,t,"PUBLIC").setMultipleInstances(!0)),Ju(ZJ,eQ,n),Ju(ZJ,eQ,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YBe(n=nN(),t=sF){const a=IC(Wi(n),X5).getImmediate({identifier:t}),l=r5("functions");return l&&XBe(a,...l),a}function XBe(n,t,i){UBe(Wi(n),t,i)}function J5(n,t,i){return VBe(Wi(n),t)}qBe();const JBe=[{key:"VITE_FIREBASE_API_KEY",value:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU"},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:"disruptive-metaverse.firebaseapp.com"},{key:"VITE_FIREBASE_PROJECT_ID",value:"disruptive-metaverse"},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:"disruptive-metaverse.appspot.com"},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:"294433070603"},{key:"VITE_FIREBASE_APP_ID",value:"1:294433070603:web:136cddd196eea9614fb10e"}],oF=JBe.filter(n=>!n.value);if(oF.length>0){const t=`Missing environment variables: ${oF.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;G.warn(t),console.warn(t)}const QBe={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},ZBe=oF.length>0;G.log(`Firebase initializing with ${ZBe?"fallback":"environment"} configuration`);let K1,Q5,ir,CN;try{K1=Ure(QBe),Q5=oN(K1),ir=AO(K1),CN=YBe(K1),G.log("Firebase initialized successfully")}catch(n){G.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const oR=n=>!0,tQ=(n,t)=>{const a=(n+t.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return a+l},loe=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return G.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const t=n.toLowerCase().trim();G.log(`userFirestore: Checking if username "${t}" is taken`);const i=nu(ir,"users"),a=iF(i,vBe(100)),l=await Zu(a);let d=!1;return l.forEach(f=>{const y=f.data();y.username&&y.username.toLowerCase()===t&&(d=!0)}),G.log(`userFirestore: Username "${t}" is ${d?"taken":"available"}`),d}catch(t){return G.error("userFirestore: Error checking username availability:",t),!0}},e6e=async(n,t)=>{let i=tQ(n,t),a=0;const l=10;for(;a<l;){if(!await loe(i))return i;i=tQ(n,t),a++}return i+Math.floor(Math.random()*100)},ru=async n=>{try{G.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const t=Ir(ir,"users",n),i=await Ho(t);if(i.exists()){const a=i.data();return G.log("userFirestore: Found PUBLIC Profile for : "+a.Nickname),delete a.email,delete a.emailVerified,a}else return G.error("userFirestore: user profile document not found"),null}catch(t){throw G.error("userFirestore: Error fetching user public profile data:",t),t}},t6e=async(n,t,i)=>{try{if(G.log("userFirestore: Starting registerUser process"),G.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw G.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const a={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};G.log("userFirestore: Critical fields captured for registration"),G.log("userFirestore: Creating user auth record");const d=(await ZFe(Q5,n,t)).user;await hie(d),G.log("userFirestore: Verification email sent"),G.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(M=>setTimeout(M,5e3));const f=Ir(ir,"users",d.uid),y=await Ho(f);if(y.exists()){G.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const M=y.data(),L={};M.firstName||(L.firstName=a.firstName),M.lastName||(L.lastName=a.lastName),M.Nickname||(L.Nickname=a.Nickname),M.username||(L.username=a.username),M.companyName||(L.companyName=a.companyName),M.linkedInProfile||(L.linkedInProfile=a.linkedInProfile),M.rpmURL||(L.rpmURL=a.rpmURL),Object.keys(L).length>0&&(G.log("userFirestore: Updating document with fields:",Object.keys(L).join(", ")),await $o(f,{...L,lastUpdated:new Date}))}else{G.error("userFirestore: Cloud Function failed to create user document, creating manually"),await Lg(f,{...a,id:d.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const M=Ir(ir,"users",d.uid,"private","data");await Lg(M,{email:d.email,emailVerified:!1})}const v=await Ho(f);if(!v.exists())throw new Error("User document does not exist even after creation attempts");let b=v.data();b.firstName||(b.firstName=a.firstName),b.lastName||(b.lastName=a.lastName),b.Nickname||(b.Nickname=a.Nickname),b.username||(b.username=a.username),b.companyName||(b.companyName=a.companyName);let R=!1,I={};for(const M in a)(!b[M]||b[M]==="")&&(I[M]=a[M],R=!0);(!b.groups||!b.groups.includes("users"))&&(I.groups=b.groups?[...b.groups,"users"]:["users"],R=!0,G.log("userFirestore: Adding user to users group")),R&&(G.log("userFirestore: Updating user document with missing fields"),G.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await $o(f,I),b=(await Ho(f)).data());const k={...d,...b,firstName:a.firstName,lastName:a.lastName,Nickname:a.Nickname,username:a.username,companyName:a.companyName,linkedInProfile:a.linkedInProfile};return G.log("userFirestore: Registration complete, returning user data"),G.log("userFirestore: Fields included in return data:",Object.keys(k).join(", ")),k}catch(a){throw G.error("userFirestore: Error creating user:",a),a}},uoe=async(n,t)=>{try{G.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=Ir(ir,"users",n);await $o(i,{rpmURL:t,lastUpdated:new Date().toISOString()}),G.log("userFirestore: rpmURL updated successfully.")}catch(i){throw G.error("userFirestore: Error updating rpmURL:",i),i}},n6e=async(n,t)=>{try{const i=await ru(n);return i&&i.groups?i.groups.includes(t):!1}catch(i){return G.error("userFirestore: Error checking group membership:",i),!1}};var r6e={};const Ek=()=>{const n=typeof process<"u"&&r6e&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},i6e=(n,t)=>{if(!Ek())return G.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},s6e=(n,t)=>{if(!Ek())return G.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},Z5=typeof Ek=="function"?Ek():!1;Z5&&G.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const o6e=async(n,t)=>{if(Z5)return i6e();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${t}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const a=oN().currentUser;if(a&&a.uid===n.uid)try{const d=(await a.getIdTokenResult(!0)).claims.groups||[],f=`space_${t}_owners`;if(d.includes(f))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return G.error("Error checking space owner permissions:",i),!1}},doe=async(n,t)=>{if(Z5)return s6e();try{if(G.log(`userPermissions: Checking if user ${n} belongs to group ${t}`),t==="users")return G.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await ru(n);if(G.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if(G.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(t))return G.log(`userPermissions: User ${n} belongs to group ${t} (from user document)`),!0}else G.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(t==="disruptiveAdmin")try{const l=oN().currentUser;if(l&&l.uid===n){const d=await l.getIdTokenResult();if(G.log(`userPermissions: Token claims for ${n}:`,d.claims),d.claims&&d.claims.groups&&Array.isArray(d.claims.groups)&&d.claims.groups.includes(t))return G.log(`userPermissions: User ${n} belongs to group ${t} (from token claims)`),!0}}catch(a){G.error("userPermissions: Error checking token claims:",a)}}return G.log(`userPermissions: User ${n} does not belong to group ${t}`),!1}catch(i){return G.error("userPermissions: Error checking if user belongs to group:",i),!1}},a6e=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups","isGuest","guestSpaceId","guestSessionStart"],nh={sendUserToUnity:"sendUserToUnity",playerInstantiated:"playerInstantiated",firstSceneLoaded:"firstSceneLoaded"};class c6e{constructor(){this.events={}}subscribe(t,i){this.events[t]||(this.events[t]=[]),this.events[t].push(i)}publish(t,i){const a=this.events[t];a?(a.forEach(l=>{l(i)}),G.log(`EventBus: Published event '${t}'`)):G.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,i){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(i);a>-1&&this.events[t].splice(a,1)}}const rh=new c6e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hoe="firebasestorage.googleapis.com",poe="storageBucket",l6e=2*60*1e3,u6e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs extends dh{constructor(t,i,a=0){super(OU(t),`Firebase Storage: ${i} (${OU(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Gs.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return OU(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ws;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ws||(Ws={}));function OU(n){return"storage/"+n}function e3(){const n="An unknown error occurred, please check the error payload for server response.";return new Gs(Ws.UNKNOWN,n)}function d6e(n){return new Gs(Ws.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function h6e(n){return new Gs(Ws.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function p6e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Gs(Ws.UNAUTHENTICATED,n)}function f6e(){return new Gs(Ws.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function m6e(n){return new Gs(Ws.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function g6e(){return new Gs(Ws.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function _6e(){return new Gs(Ws.CANCELED,"User canceled the upload/download.")}function y6e(n){return new Gs(Ws.INVALID_URL,"Invalid URL '"+n+"'.")}function E6e(n){return new Gs(Ws.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function v6e(){return new Gs(Ws.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+poe+"' property when initializing the app?")}function S6e(){return new Gs(Ws.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function b6e(){return new Gs(Ws.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function w6e(n){return new Gs(Ws.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function aF(n){return new Gs(Ws.INVALID_ARGUMENT,n)}function foe(){return new Gs(Ws.APP_DELETED,"The Firebase app was deleted.")}function T6e(n){return new Gs(Ws.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function OR(n,t){return new Gs(Ws.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function xT(n){throw new Gs(Ws.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(t,i){this.bucket=t,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,i){let a;try{a=Ql.makeFromUrl(t,i)}catch{return new Ql(t,"")}if(a.path==="")return a;throw E6e(t)}static makeFromUrl(t,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(ce){ce.path.charAt(ce.path.length-1)==="/"&&(ce.path_=ce.path_.slice(0,-1))}const f="(/(.*))?$",y=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function b(ce){ce.path_=decodeURIComponent(ce.path)}const R="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),k="(/([^?#]*).*)?$",M=new RegExp(`^https?://${I}/${R}/b/${l}/o${k}`,"i"),L={bucket:1,path:3},j=i===hoe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,z="([^?#]*)",Y=new RegExp(`^https?://${j}/${l}/${z}`,"i"),ne=[{regex:y,indices:v,postModify:d},{regex:M,indices:L,postModify:b},{regex:Y,indices:{bucket:1,path:2},postModify:b}];for(let ce=0;ce<ne.length;ce++){const oe=ne[ce],ge=oe.regex.exec(t);if(ge){const X=ge[oe.indices.bucket];let J=ge[oe.indices.path];J||(J=""),a=new Ql(X,J),oe.postModify(a);break}}if(a==null)throw y6e(t);return a}}class R6e{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C6e(n,t,i){let a=1,l=null,d=null,f=!1,y=0;function v(){return y===2}let b=!1;function R(...z){b||(b=!0,t.apply(null,z))}function I(z){l=setTimeout(()=>{l=null,n(M,v())},z)}function k(){d&&clearTimeout(d)}function M(z,...Y){if(b){k();return}if(z){k(),R.call(null,z,...Y);return}if(v()||f){k(),R.call(null,z,...Y);return}a<64&&(a*=2);let ne;y===1?(y=2,ne=0):ne=(a+Math.random())*1e3,I(ne)}let L=!1;function j(z){L||(L=!0,k(),!b&&(l!==null?(z||(y=2),clearTimeout(l),I(0)):z||(y=1)))}return I(0),d=setTimeout(()=>{f=!0,j(!0)},i),j}function I6e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A6e(n){return n!==void 0}function P6e(n){return typeof n=="object"&&!Array.isArray(n)}function t3(n){return typeof n=="string"||n instanceof String}function nQ(n){return n3()&&n instanceof Blob}function n3(){return typeof Blob<"u"}function rQ(n,t,i,a){if(a<t)throw aF(`Invalid value for '${n}'. Expected ${t} or greater.`);if(a>i)throw aF(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IN(n,t,i){let a=t;return i==null&&(a=`https://${t}`),`${i}://${a}/v0${n}`}function moe(n){const t=encodeURIComponent;let i="?";for(const a in n)if(n.hasOwnProperty(a)){const l=t(a)+"="+t(n[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var Vy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Vy||(Vy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O6e(n,t){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=t.indexOf(n)!==-1;return i||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k6e{constructor(t,i,a,l,d,f,y,v,b,R,I,k=!0){this.url_=t,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=y,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=R,this.connectionFactory_=I,this.retry=k,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((M,L)=>{this.resolve_=M,this.reject_=L,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new q1(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=y=>{const v=y.loaded,b=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const y=d.getErrorCode()===Vy.NO_ERROR,v=d.getStatus();if(!y||O6e(v,this.additionalRetryCodes_)&&this.retry){const R=d.getErrorCode()===Vy.ABORT;a(!1,new q1(!1,null,R));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new q1(b,d))})},i=(a,l)=>{const d=this.resolve_,f=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(y,y.getResponse());A6e(v)?d(v):d()}catch(v){f(v)}else if(y!==null){const v=e3();v.serverResponse=y.getErrorText(),this.errorCallback_?f(this.errorCallback_(y,v)):f(v)}else if(l.canceled){const v=this.appDelete_?foe():_6e();f(v)}else{const v=g6e();f(v)}};this.canceled_?i(!1,new q1(!1,null,!0)):this.backoffId_=C6e(t,i,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&I6e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class q1{constructor(t,i,a){this.wasSuccessCode=t,this.connection=i,this.canceled=!!a}}function N6e(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function D6e(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function x6e(n,t){t&&(n["X-Firebase-GMPID"]=t)}function L6e(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function M6e(n,t,i,a,l,d,f=!0){const y=moe(n.urlParams),v=n.url+y,b=Object.assign({},n.headers);return x6e(b,t),N6e(b,i),D6e(b,d),L6e(b,a),new k6e(v,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U6e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function V6e(...n){const t=U6e();if(t!==void 0){const i=new t;for(let a=0;a<n.length;a++)i.append(n[a]);return i.getBlob()}else{if(n3())return new Blob(n);throw new Gs(Ws.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function F6e(n,t,i){return n.webkitSlice?n.webkitSlice(t,i):n.mozSlice?n.mozSlice(t,i):n.slice?n.slice(t,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j6e(n){if(typeof atob>"u")throw w6e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ep={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class kU{constructor(t,i){this.data=t,this.contentType=i||null}}function B6e(n,t){switch(n){case Ep.RAW:return new kU(goe(t));case Ep.BASE64:case Ep.BASE64URL:return new kU(_oe(n,t));case Ep.DATA_URL:return new kU(W6e(t),G6e(t))}throw e3()}function goe(n){const t=[];for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))t.push(239,191,189);else{const d=a,f=n.charCodeAt(++i);a=65536|(d&1023)<<10|f&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function z6e(n){let t;try{t=decodeURIComponent(n)}catch{throw OR(Ep.DATA_URL,"Malformed data URL.")}return goe(t)}function _oe(n,t){switch(n){case Ep.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw OR(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Ep.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw OR(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=j6e(t)}catch(l){throw l.message.includes("polyfill")?l:OR(n,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class yoe{constructor(t){this.base64=!1,this.contentType=null;const i=t.match(/^data:([^,]+)?,/);if(i===null)throw OR(Ep.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=H6e(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function W6e(n){const t=new yoe(n);return t.base64?_oe(Ep.BASE64,t.rest):z6e(t.rest)}function G6e(n){return new yoe(n).contentType}function H6e(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(t,i){let a=0,l="";nQ(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(i?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(i?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,i){if(nQ(this.data_)){const a=this.data_,l=F6e(a,t,i);return l===null?null:new mg(l)}else{const a=new Uint8Array(this.data_.buffer,t,i-t);return new mg(a,!0)}}static getBlob(...t){if(n3()){const i=t.map(a=>a instanceof mg?a.data_:a);return new mg(V6e.apply(null,i))}else{const i=t.map(f=>t3(f)?B6e(Ep.RAW,f).data:f.data_);let a=0;i.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return i.forEach(f=>{for(let y=0;y<f.length;y++)l[d++]=f[y]}),new mg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eoe(n){let t;try{t=JSON.parse(n)}catch{return null}return P6e(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $6e(n){if(n.length===0)return null;const t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function K6e(n,t){const i=t.split("/").filter(a=>a.length>0).join("/");return n.length===0?i:n+"/"+i}function voe(n){const t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q6e(n,t){return t}class Ac{constructor(t,i,a,l){this.server=t,this.local=i||t,this.writable=!!a,this.xform=l||q6e}}let Y1=null;function Y6e(n){return!t3(n)||n.length<2?n:voe(n)}function Soe(){if(Y1)return Y1;const n=[];n.push(new Ac("bucket")),n.push(new Ac("generation")),n.push(new Ac("metageneration")),n.push(new Ac("name","fullPath",!0));function t(d,f){return Y6e(f)}const i=new Ac("name");i.xform=t,n.push(i);function a(d,f){return f!==void 0?Number(f):f}const l=new Ac("size");return l.xform=a,n.push(l),n.push(new Ac("timeCreated")),n.push(new Ac("updated")),n.push(new Ac("md5Hash",null,!0)),n.push(new Ac("cacheControl",null,!0)),n.push(new Ac("contentDisposition",null,!0)),n.push(new Ac("contentEncoding",null,!0)),n.push(new Ac("contentLanguage",null,!0)),n.push(new Ac("contentType",null,!0)),n.push(new Ac("metadata","customMetadata",!0)),Y1=n,Y1}function X6e(n,t){function i(){const a=n.bucket,l=n.fullPath,d=new Ql(a,l);return t._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:i})}function J6e(n,t,i){const a={};a.type="file";const l=i.length;for(let d=0;d<l;d++){const f=i[d];a[f.local]=f.xform(a,t[f.server])}return X6e(a,n),a}function boe(n,t,i){const a=Eoe(t);return a===null?null:J6e(n,a,i)}function Q6e(n,t,i,a){const l=Eoe(t);if(l===null||!t3(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(b=>{const R=n.bucket,I=n.fullPath,k="/b/"+f(R)+"/o/"+f(I),M=IN(k,i,a),L=moe({alt:"media",token:b});return M+L})[0]}function Z6e(n,t){const i={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(i[d.server]=n[d.local])}return JSON.stringify(i)}class r3{constructor(t,i,a,l){this.url=t,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function woe(n){if(!n)throw e3()}function e8e(n,t){function i(a,l){const d=boe(n,l,t);return woe(d!==null),d}return i}function t8e(n,t){function i(a,l){const d=boe(n,l,t);return woe(d!==null),Q6e(d,l,n.host,n._protocol)}return i}function Toe(n){function t(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=f6e():l=p6e():i.getStatus()===402?l=h6e(n.bucket):i.getStatus()===403?l=m6e(n.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return t}function Roe(n){const t=Toe(n);function i(a,l){let d=t(a,l);return a.getStatus()===404&&(d=d6e(n.path)),d.serverResponse=l.serverResponse,d}return i}function n8e(n,t,i){const a=t.fullServerUrl(),l=IN(a,n.host,n._protocol),d="GET",f=n.maxOperationRetryTime,y=new r3(l,d,t8e(n,i),f);return y.errorHandler=Roe(t),y}function r8e(n,t){const i=t.fullServerUrl(),a=IN(i,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function f(v,b){}const y=new r3(a,l,f,d);return y.successCodes=[200,204],y.errorHandler=Roe(t),y}function i8e(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function s8e(n,t,i){const a=Object.assign({},i);return a.fullPath=n.path,a.size=t.size(),a.contentType||(a.contentType=i8e(null,t)),a}function o8e(n,t,i,a,l){const d=t.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function y(){let ne="";for(let ce=0;ce<2;ce++)ne=ne+Math.random().toString().slice(2);return ne}const v=y();f["Content-Type"]="multipart/related; boundary="+v;const b=s8e(t,a,l),R=Z6e(b,i),I="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+R+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,k=`\r
--`+v+"--",M=mg.getBlob(I,a,k);if(M===null)throw S6e();const L={name:b.fullPath},j=IN(d,n.host,n._protocol),z="POST",Y=n.maxUploadRetryTime,K=new r3(j,z,e8e(n,i),Y);return K.urlParams=L,K.headers=f,K.body=M.uploadData(),K.errorHandler=Toe(t),K}class a8e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Vy.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Vy.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Vy.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,i,a,l){if(this.sent_)throw xT("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw xT("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw xT("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw xT("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw xT("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class c8e extends a8e{initXhr(){this.xhr_.responseType="text"}}function i3(){return new c8e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(t,i){this._service=t,i instanceof Ql?this._location=i:this._location=Ql.makeFromUrl(i,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,i){return new Yy(t,i)}get root(){const t=new Ql(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return voe(this._location.path)}get storage(){return this._service}get parent(){const t=$6e(this._location.path);if(t===null)return null;const i=new Ql(this._location.bucket,t);return new Yy(this._service,i)}_throwIfRoot(t){if(this._location.path==="")throw T6e(t)}}function l8e(n,t,i){n._throwIfRoot("uploadBytes");const a=o8e(n.storage,n._location,Soe(),new mg(t,!0),i);return n.storage.makeRequestWithTokens(a,i3).then(l=>({metadata:l,ref:n}))}function u8e(n){n._throwIfRoot("getDownloadURL");const t=n8e(n.storage,n._location,Soe());return n.storage.makeRequestWithTokens(t,i3).then(i=>{if(i===null)throw b6e();return i})}function d8e(n){n._throwIfRoot("deleteObject");const t=r8e(n.storage,n._location);return n.storage.makeRequestWithTokens(t,i3)}function h8e(n,t){const i=K6e(n._location.path,t),a=new Ql(n._location.bucket,i);return new Yy(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p8e(n){return/^[A-Za-z]+:\/\//.test(n)}function f8e(n,t){return new Yy(n,t)}function Coe(n,t){if(n instanceof s3){const i=n;if(i._bucket==null)throw v6e();const a=new Yy(i,i._bucket);return t!=null?Coe(a,t):a}else return t!==void 0?h8e(n,t):n}function m8e(n,t){if(t&&p8e(t)){if(n instanceof s3)return f8e(n,t);throw aF("To use ref(service, url), the first argument must be a Storage instance.")}else return Coe(n,t)}function iQ(n,t){const i=t==null?void 0:t[poe];return i==null?null:Ql.makeFromBucketSpec(i,n)}function g8e(n,t,i,a={}){n.host=`${t}:${i}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:xre(l,n.app.options.projectId))}class s3{constructor(t,i,a,l,d){this.app=t,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=hoe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=l6e,this._maxUploadRetryTime=u6e,this._requests=new Set,l!=null?this._bucket=Ql.makeFromBucketSpec(l,this._host):this._bucket=iQ(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Ql.makeFromBucketSpec(this._url,t):this._bucket=iQ(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){rQ("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){rQ("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const i=await t.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(hl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Yy(this,t)}_makeRequest(t,i,a,l,d=!0){if(this._deleted)return new R6e(foe());{const f=M6e(t,this._appId,a,l,i,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(t,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,i,a,l).getPromise()}}const sQ="@firebase/storage",oQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ioe="storage";function o3(n,t,i){return n=Wi(n),l8e(n,t,i)}function AN(n){return n=Wi(n),u8e(n)}function a3(n){return n=Wi(n),d8e(n)}function iE(n,t){return n=Wi(n),m8e(n,t)}function sE(n=nN(),t){n=Wi(n);const a=IC(n,Ioe).getImmediate({identifier:t}),l=r5("storage");return l&&_8e(a,...l),a}function _8e(n,t,i,a={}){g8e(n,t,i,a)}function y8e(n,{instanceIdentifier:t}){const i=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new s3(i,a,l,t,Qy)}function E8e(){Ag(new jf(Ioe,y8e,"PUBLIC").setMultipleInstances(!0)),Ju(sQ,oQ,""),Ju(sQ,oQ,"esm2017")}E8e();const OO=async n=>{const t=sE(),i=iE(t,n);try{return await AN(i)}catch(a){throw G.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let cF={};const Ma=async n=>{try{const t=Ir(ir,"spaces",n),i=await Ho(t);if(i.exists()){let a=i.data();const l=a.name,d=a.description;if(a.webglBuildId){const f=Ir(ir,"webglBuilds",a.webglBuildId),y=await Ho(f);if(y.exists()){const v=y.data();a={...a,...v,name:l||v.name,description:d||v.description}}else G.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await v8e(a),a=S8e(a),console.log("Space data:",a),G.log(`spacesFirestore: Caching space data for: ${n}`),cF[n]=a,a}else return G.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(t){throw G.error("spacesFirestore: Error fetching item data:",t),t}},v8e=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await OO(l))});return await Promise.all(i),n},S8e=n=>{const{gsUrlCode:t,gsUrlData:i,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:t,dataUrl:i,frameworkUrl:a,loaderUrl:l}};let NU={};const Aoe=async n=>{G.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(NU[n])return G.log("spacesFirestore: Returning cached videos for space:",n),NU[n];const t=nu(ir,`spaces/${n}/videos`),i=await Zu(t),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),NU[n]=a,a}catch(t){throw G.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},b8e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const i=sE(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,f=iE(i,`spaces/${n}/logo/${d}`);G.log(`Uploading logo for space ${n}`);const y=await o3(f,t),v=await AN(y.ref),b=Ir(ir,"spaces",n);return await $o(b,{logoUrl:v,logoGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),G.log(`Successfully uploaded logo for space ${n}`),v}catch(i){throw G.error("Error uploading space logo:",i),i}},w8e=async n=>{try{const t=Ir(ir,"spaces",n),i=await Ho(t);if(!i.exists())return G.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.logoGsUrl){const l=sE(),d=iE(l,a.logoGsUrl);try{await a3(d),G.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){G.warn(`Could not delete logo file from storage: ${f.message}`)}}return await $o(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),G.log(`Successfully removed logo for space ${n}`),!0}catch(t){throw G.error("Error deleting space logo:",t),t}},T8e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const i=sE(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,f=iE(i,`spaces/${n}/background/${d}`);G.log(`Uploading background for space ${n}`);const y=await o3(f,t),v=await AN(y.ref),b=Ir(ir,"spaces",n);return await $o(b,{backgroundUrl:v,backgroundGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${y.ref.bucket}/${y.ref.fullPath}`,updatedAt:new Date().toISOString()}),G.log(`Successfully uploaded background for space ${n}`),v}catch(i){throw G.error("Error uploading space background:",i),i}},R8e=async n=>{try{const t=Ir(ir,"spaces",n),i=await Ho(t);if(!i.exists())return G.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.backgroundGsUrl){const l=sE(),d=iE(l,a.backgroundGsUrl);try{await a3(d),G.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){G.warn(`Could not delete background file from storage: ${f.message}`)}}return await $o(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),G.log(`Successfully removed background for space ${n}`),!0}catch(t){throw G.error("Error deleting space background:",t),t}},C8e=async(n,t)=>{try{if(!n||!t||!t.uid)throw new Error("Missing required parameters");const i=Ir(ir,`spaces/${n}/BannedUsers`,t.uid),a=Object.entries({...t,bannedAt:t.bannedAt||new Date().toISOString()}).reduce((l,[d,f])=>(f!==void 0&&(l[d]=f),l),{});await Lg(i,a);try{const l=Ir(ir,"users",t.uid),d=await Ho(l);if(d.exists()){const f=d.data(),y=Array.isArray(f.groups)?f.groups:[],v=`space_${n}_banned`;y.includes(v)||await $o(l,{groups:[...y,v]})}}catch(l){G.error("spacesFirestore: failed to add banned group to user",l)}return G.log(`spacesFirestore: Added banned user ${t.uid} to space ${n}`),!0}catch(i){throw G.error("spacesFirestore: Error adding banned user:",i),i}},kR=async(n,t)=>{try{G.log(`spacesFirestore: Updating settings for space: ${n}`,t);const i=Ir(ir,"spaces",n);return await $o(i,{...t,updatedAt:new Date().toISOString()}),cF[n]&&delete cF[n],!0}catch(i){throw G.error("spacesFirestore: Error updating space settings:",i),i}},I8e=async(n,t)=>kR(n,{accessibleToAllUsers:t}),lF=async(n,t)=>kR(n,{HLSStreamURL:t}),Poe=async n=>{try{const t=Ir(ir,"spaces",n),i=await Ho(t);return i.exists()&&i.data().HLSStreamURL||null}catch(t){throw G.error("spacesFirestore: Error getting HLS stream:",t),t}},A8e=async(n,t)=>(G.warn("uploadSpaceVideoBackground: Not implemented in simplified stub."),null),P8e=async n=>(G.warn("deleteSpaceVideoBackground: Not implemented in simplified stub."),null),O8e=["https://models.readyplayer.me/682b6c39994f7261dd46350d.glb","https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb","https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb","https://models.readyplayer.me/67c884144c4878c55e515ff5.glb","https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb","https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb","https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb","https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb","https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb","https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb"],k8e=()=>Math.floor(1e3+Math.random()*9e3).toString(),N8e=()=>`Visitor_${k8e()}`,D8e=()=>O8e[0],x8e=()=>{const n=Date.now(),t=Math.floor(Math.random()*1e4);return`guest_${n}_${t}`},aQ=n=>{const t=x8e(),i=N8e(),a=D8e(),l=new Date().toISOString(),d={uid:t,email:null,emailVerified:!1,name:i,username:i,Nickname:i,displayName:i,firstName:"Guest",lastName:"User",companyName:"",linkedInProfile:"",rpmURL:a,groups:["guests"],created_on:l,isGuest:!0,guestSpaceId:n,guestSessionStart:l,height_cm:null};return G.log("guestUserGenerator: Created guest user:",{uid:t,username:i,rpmURL:a,spaceId:n}),G.log("guestUserGenerator: FULL guest user object:",d),G.log("guestUserGenerator: Environment check - window.location:",window.location.href),G.log("guestUserGenerator: Nickname field:",d.Nickname),G.log("guestUserGenerator: rpmURL field:",d.rpmURL),d},L8e=n=>n&&(n.isGuest===!0||n.uid&&n.uid.startsWith("guest_")),Hs=N.createContext(null),M8e=N.createContext(null),U8e=({children:n})=>{const[t,i]=N.useState(null),a=N.useRef(null),[l,d]=N.useState(!0),[f,y]=N.useState(!1),[v,b]=N.useState(null),R=N.useRef(null),I=oN(),k=ve=>ve?ve.Nickname?ve.Nickname:`${ve.firstName} ${ve.lastName}`:"Anon",M=async()=>{try{const ve=L();if(!ve){G.log("UserProvider: No space ID found, skipping guest user creation");return}if(v&&v.guestSpaceId===ve){G.log("UserProvider: Guest user already exists for this space");return}try{const Fe=await Ma(ve);if(!Fe){G.log("UserProvider: Space data not found, denying guest access");return}if(!Fe.allowGuestUsers){G.log("UserProvider: Guest users explicitly not allowed for this space");return}G.log("UserProvider: Guest users confirmed allowed for space:",ve)}catch{G.log("UserProvider: Cannot verify space guest settings, denying guest access for security");return}const Te=aQ(ve);b(Te),R.current=Te,G.log("UserProvider: Created guest user:",Te.username),K(Te)}catch(ve){G.error("UserProvider: Error creating guest user:",ve)}},L=()=>{try{const ve=document.getElementById("webgl-root");if(ve){const Ee=ve.getAttribute("data-space-id");if(Ee)return G.log("UserProvider: Found space ID from webgl-root element:",Ee),Ee}const Te=window.location.href,Fe=window.location.pathname,be=window.location.search;G.log("UserProvider: No space ID in DOM element, trying URL extraction"),G.log("UserProvider: URL:",Te);const Ce=Fe.match(/\/(w|embed)\/([^\/]+)/);if(Ce)return G.log("UserProvider: Found space ID from path pattern:",Ce[2]),Ce[2];const Ae=new URLSearchParams(be),De=Ae.get("spaceId")||Ae.get("space");return De?(G.log("UserProvider: Found space ID from URL params:",De),De):Te.includes("localhost")||Te.includes("web.app")||Te.includes("firebaseapp.com")?(G.log("UserProvider: Using default space ID for development/hosting"),"SpacesMetaverse_SDK"):(G.log("UserProvider: No space ID found"),null)}catch(ve){return G.error("UserProvider: Error getting space ID:",ve),null}};N.useEffect(()=>{const ve=rje(I,async Te=>{if(G.log("UserProvider: Firebase onAuthStateChanged() fired"),Te)try{const Fe=await ru(Te.uid),be=k(Fe),Ce={uid:Te.uid,email:Te.email,emailVerified:Te.emailVerified,...Fe,displayName:be};G.log(`UserProvider: User authenticated: ${Te.uid}`),i(Ce),a.current=Ce,K(Ce)}catch(Fe){G.error("UserProvider: Error fetching user profile data:",Fe)}else i(null),a.current=null,await M();d(!1)});return()=>{ve&&ve()}},[]);const j=async(ve,Te,Fe)=>{try{y(!0),G.log("UserProvider: Starting registration process"),G.log("UserProvider: Registration includes fields:",Object.keys(Fe||{}).join(", "));const be={...Fe},Ce=["firstName","lastName","username","companyName","linkedInProfile"],Ae=Ce.filter(_t=>!be[_t]);Ae.length>0&&G.warn(`UserProvider: Registration missing fields: ${Ae.join(", ")}`);const De=be.firstName&&be.lastName?`${be.firstName}${be.lastName.charAt(0).toUpperCase()}`:"";G.log("UserProvider: Generated default nickname for registration");const Ee={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:be.Nickname||De,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...be};G.log("UserProvider: Prepared registration data with fields:",Object.keys(Ee).join(", "));const Ne=await t6e(ve,Te,Ee);G.log("UserProvider: Registration successful, received user data");const je=Ce.filter(_t=>!Ne[_t]);je.length>0&&G.warn(`UserProvider: Returned user data missing fields: ${je.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(_t=>{Ne[_t]||(G.warn(`UserProvider: ${_t} is missing in returned data, using original value`),Ne[_t]=Ee[_t])});const ot={uid:Ne.uid,email:Ne.email,...Ne,displayName:k(Ne)};return G.log("UserProvider: Created user object with fields:",Object.keys(ot).join(", ")),i(ot),a.current=ot,G.log("UserProvider: User registered successfully with groups:",Ee.groups),await new Promise(_t=>setTimeout(_t,2e3)),y(!1),ot}catch(be){throw y(!1),G.error("UserProvider: Error during registration:",be),be}},z=async(ve,Te,Fe)=>{try{if(G.log("UserProvider: Signing in user"),!Fe)throw new Error("CAPTCHA verification is required");const Ce=(await eje(I,ve,Te)).user;return G.log("UserProvider: User signed in successfully:",Ce.email),Ce}catch(be){throw G.error("UserProvider: Error signing in:",be),be}},Y=async()=>{try{await ije(I),i(null),G.log("UserProvider: User signed out.")}catch(ve){throw G.error("UserProvider: Error signing out:",ve),ve}},K=async(ve=null)=>{let Te=ve||a.current||R.current;if(!Te&&!ve&&(G.log("UserProvider: No user available, attempting to create guest user for Unity request"),await M(),Te=R.current),Te){const Fe=ne(Te);G.log("UserProvider: sendUserToUnity() - Raw user data:",{uid:Te.uid,username:Te.username,Nickname:Te.Nickname,displayName:Te.displayName,rpmURL:Te.rpmURL,isGuest:Te.isGuest||!1}),G.log("UserProvider: sendUserToUnity() - Filtered data being sent to Unity:",Fe),Te.isGuest&&(G.log("UserProvider: GUEST USER - Verifying required fields:"),G.log("UserProvider: GUEST - Nickname in filtered data:",Fe.Nickname),G.log("UserProvider: GUEST - rpmURL in filtered data:",Fe.rpmURL),G.log("UserProvider: GUEST - uid in filtered data:",Fe.uid),(!Fe.Nickname||!Fe.rpmURL)&&(G.error("UserProvider: GUEST USER MISSING REQUIRED FIELDS!"),G.error("UserProvider: Missing Nickname:",!Fe.Nickname),G.error("UserProvider: Missing rpmURL:",!Fe.rpmURL))),rh.publish(nh.sendUserToUnity,Fe)}else G.log("UserProvider: No current user or guest user to send to Unity.")},ne=ve=>{const Te={},Fe=[...a6e,"uid"];return G.log("UserProvider: Properties to send to Unity:",Fe),G.log("UserProvider: Available properties in user object:",Object.keys(ve)),Fe.forEach(be=>{ve.hasOwnProperty(be)?(Te[be]=ve[be],G.log(`UserProvider: Including field '${be}' with value:`,ve[be])):G.log(`UserProvider: Field '${be}' not found in user object`)}),G.log("UserProvider: Final filtered user object:",Te),Te},ce=async ve=>!t||!t.uid?!1:await doe(t.uid,ve),oe=async ve=>{try{return!t||!t.uid?!1:t.groups&&t.groups.includes(`space_${ve}_banned`)?!0:(await Ho(Ir(ir,`spaces/${ve}/BannedUsers`,t.uid))).exists()}catch(Te){return Te.code!=="permission-denied"&&G.error("UserProvider: isUserBannedFromSpace error:",Te),!1}},ge=async ve=>{if(!t||!t.uid)return!1;try{if(await oe(ve))return G.warn(`UserProvider: User ${t.uid} banned from ${ve}`),!1;const Te=await Ma(ve);if(Te.usersAllowed.includes(t.uid)||Te.userAdmin.includes(t.uid)||Te.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const be=`space_${ve}_owners`,Ce=`space_${ve}_hosts`;if(t.groups.includes(be)||t.groups.includes(Ce))return G.log(`UserProvider: User ${t.uid} has access to space ${ve} as owner/host`),!0}return Te.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(Te){return G.error("UserProvider: Error verifying user access to space:",Te),!1}},X=async ve=>{if(!t||!t.uid)return!1;try{return(await Ma(ve)).userAdmin.includes(t.uid)}catch(Te){return G.error("UserProvider: Error verifying user admin status for space:",Te),!1}},J=async ve=>{if(!t||!t.uid)return!1;try{return(await Ma(ve)).usersModerators.includes(t.uid)}catch(Te){return G.error("UserProvider: Error verifying user moderator status for space:",Te),!1}},te=async()=>{try{const ve=I.currentUser;return ve&&!ve.emailVerified?(await hie(ve),G.log("UserProvider: Verification email resent to:",ve.email),!0):!1}catch(ve){throw G.error("UserProvider: Error resending verification email:",ve),ve}},ie=async()=>{try{const ve=I.currentUser;if(!ve)return G.warn("UserProvider: updateUser called but no current user exists"),null;G.log("UserProvider: Updating user data from Firestore");const Te=await ru(ve.uid);if(!Te)return G.error("UserProvider: Failed to fetch updated user profile"),null;const Fe=k(Te),be={uid:ve.uid,email:ve.email,emailVerified:ve.emailVerified,...Te,displayName:Fe};return G.log("UserProvider: User data updated with fields:",Object.keys(be).join(", ")),i(be),a.current=be,K(be),be}catch(ve){throw G.error("UserProvider: Error updating user data:",ve),ve}},he=()=>t||v,fe=async ve=>{try{const Te=aQ(ve);return b(Te),R.current=Te,K(Te),Te}catch(Te){throw G.error("UserProvider: Error creating manual guest user:",Te),Te}},de=()=>{b(null),R.current=null,G.log("UserProvider: Guest user cleared")};return w.jsx(M8e.Provider,{value:{registrationInProgress:f},children:w.jsx(Hs.Provider,{value:{user:t,guestUser:v,currentUser:he(),loading:l,register:j,signIn:z,signOut:Y,sendUserToUnity:K,isUserInGroup:ce,userHasAccessToSpace:ge,userIsAdminOfSpace:X,userIsModeratorOfSpace:J,resendVerificationEmail:te,updateUser:ie,isUserBannedFromSpace:oe,createGuestUser:fe,clearGuestUser:de,isGuestUser:ve=>L8e(ve||he())},children:n})})},Ooe=N.createContext(),hh=()=>N.useContext(Ooe),V8e=({children:n})=>{const[t,i]=N.useState(!1),a=N.useRef(null),[l,d]=N.useState(!1);N.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=N.useCallback(v=>{a.current=v},[]),y=N.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const R=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(R.webkitEnterFullscreen)try{R.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(R.webkitRequestFullscreen){R.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(R=>console.error("Error exiting fullscreen:",R)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{i(!0)}).catch(R=>console.error("Error entering fullscreen:",R)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),i(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),i(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),i(!0))}catch(R){console.error("Fullscreen error:",R)}},[l]);return N.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),w.jsx(Ooe.Provider,{value:{isFullscreen:t,toggleFullscreen:y,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:w.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})};var VC=n=>n.type==="checkbox",Ry=n=>n instanceof Date,Oc=n=>n==null;const koe=n=>typeof n=="object";var ho=n=>!Oc(n)&&!Array.isArray(n)&&koe(n)&&!Ry(n),F8e=n=>ho(n)&&n.target?VC(n.target)?n.target.checked:n.target.value:n,j8e=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,B8e=(n,t)=>n.has(j8e(t)),z8e=n=>{const t=n.constructor&&n.constructor.prototype;return ho(t)&&t.hasOwnProperty("isPrototypeOf")},c3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function $u(n){let t;const i=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)t=new Date(n);else if(n instanceof Set)t=new Set(n);else if(!(c3&&(n instanceof Blob||a))&&(i||ho(n)))if(t=i?[]:{},!i&&!z8e(n))t=n;else for(const l in n)n.hasOwnProperty(l)&&(t[l]=$u(n[l]));else return n;return t}var PN=n=>Array.isArray(n)?n.filter(Boolean):[],vo=n=>n===void 0,_n=(n,t,i)=>{if(!t||!ho(n))return i;const a=PN(t.split(/[,[\].]+?/)).reduce((l,d)=>Oc(l)?l:l[d],n);return vo(a)||a===n?vo(n[t])?i:n[t]:a},up=n=>typeof n=="boolean",l3=n=>/^\w*$/.test(n),Noe=n=>PN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),is=(n,t,i)=>{let a=-1;const l=l3(t)?[t]:Noe(t),d=l.length,f=d-1;for(;++a<d;){const y=l[a];let v=i;if(a!==f){const b=n[y];v=ho(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=v,n=n[y]}return n};const cQ={BLUR:"blur",FOCUS_OUT:"focusout"},th={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Ef={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};Ei.createContext(null);var W8e=(n,t,i,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const f=d;return t._proxyFormState[f]!==th.all&&(t._proxyFormState[f]=!a||th.all),n[f]}});return l},ll=n=>ho(n)&&!Object.keys(n).length,G8e=(n,t,i,a)=>{i(n);const{name:l,...d}=n;return ll(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(f=>t[f]===th.all)},kO=n=>Array.isArray(n)?n:[n];function H8e(n){const t=Ei.useRef(n);t.current=n,Ei.useEffect(()=>{const i=!n.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var vp=n=>typeof n=="string",$8e=(n,t,i,a,l)=>vp(n)?(a&&t.watch.add(n),_n(i,n,l)):Array.isArray(n)?n.map(d=>(a&&t.watch.add(d),_n(i,d))):(a&&(t.watchAll=!0),i),K8e=(n,t,i,a,l)=>t?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[a]:l||!0}}:{},lQ=n=>({isOnSubmit:!n||n===th.onSubmit,isOnBlur:n===th.onBlur,isOnChange:n===th.onChange,isOnAll:n===th.all,isOnTouch:n===th.onTouched}),uQ=(n,t,i)=>!i&&(t.watchAll||t.watch.has(n)||[...t.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const NR=(n,t,i,a)=>{for(const l of i||Object.keys(n)){const d=_n(n,l);if(d){const{_f:f,...y}=d;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!a)return!0;if(f.ref&&t(f.ref,f.name)&&!a)return!0;if(NR(y,t))break}else if(ho(y)&&NR(y,t))break}}};var q8e=(n,t,i)=>{const a=kO(_n(n,i));return is(a,"root",t[i]),is(n,i,a),n},u3=n=>n.type==="file",gp=n=>typeof n=="function",vk=n=>{if(!c3)return!1;const t=n?n.ownerDocument:0;return n instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},NO=n=>vp(n),d3=n=>n.type==="radio",Sk=n=>n instanceof RegExp;const dQ={value:!1,isValid:!1},hQ={value:!0,isValid:!0};var Doe=n=>{if(Array.isArray(n)){if(n.length>1){const t=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:t,isValid:!!t.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!vo(n[0].attributes.value)?vo(n[0].value)||n[0].value===""?hQ:{value:n[0].value,isValid:!0}:hQ:dQ}return dQ};const pQ={isValid:!1,value:null};var xoe=n=>Array.isArray(n)?n.reduce((t,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:t,pQ):pQ;function fQ(n,t,i="validate"){if(NO(n)||Array.isArray(n)&&n.every(NO)||up(n)&&!n)return{type:i,message:NO(n)?n:"",ref:t}}var vS=n=>ho(n)&&!Sk(n)?n:{value:n,message:""},mQ=async(n,t,i,a,l,d)=>{const{ref:f,refs:y,required:v,maxLength:b,minLength:R,min:I,max:k,pattern:M,validate:L,name:j,valueAsNumber:z,mount:Y}=n._f,K=_n(i,j);if(!Y||t.has(j))return{};const ne=y?y[0]:f,ce=fe=>{l&&ne.reportValidity&&(ne.setCustomValidity(up(fe)?"":fe||""),ne.reportValidity())},oe={},ge=d3(f),X=VC(f),J=ge||X,te=(z||u3(f))&&vo(f.value)&&vo(K)||vk(f)&&f.value===""||K===""||Array.isArray(K)&&!K.length,ie=K8e.bind(null,j,a,oe),he=(fe,de,ve,Te=Ef.maxLength,Fe=Ef.minLength)=>{const be=fe?de:ve;oe[j]={type:fe?Te:Fe,message:be,ref:f,...ie(fe?Te:Fe,be)}};if(d?!Array.isArray(K)||!K.length:v&&(!J&&(te||Oc(K))||up(K)&&!K||X&&!Doe(y).isValid||ge&&!xoe(y).isValid)){const{value:fe,message:de}=NO(v)?{value:!!v,message:v}:vS(v);if(fe&&(oe[j]={type:Ef.required,message:de,ref:ne,...ie(Ef.required,de)},!a))return ce(de),oe}if(!te&&(!Oc(I)||!Oc(k))){let fe,de;const ve=vS(k),Te=vS(I);if(!Oc(K)&&!isNaN(K)){const Fe=f.valueAsNumber||K&&+K;Oc(ve.value)||(fe=Fe>ve.value),Oc(Te.value)||(de=Fe<Te.value)}else{const Fe=f.valueAsDate||new Date(K),be=De=>new Date(new Date().toDateString()+" "+De),Ce=f.type=="time",Ae=f.type=="week";vp(ve.value)&&K&&(fe=Ce?be(K)>be(ve.value):Ae?K>ve.value:Fe>new Date(ve.value)),vp(Te.value)&&K&&(de=Ce?be(K)<be(Te.value):Ae?K<Te.value:Fe<new Date(Te.value))}if((fe||de)&&(he(!!fe,ve.message,Te.message,Ef.max,Ef.min),!a))return ce(oe[j].message),oe}if((b||R)&&!te&&(vp(K)||d&&Array.isArray(K))){const fe=vS(b),de=vS(R),ve=!Oc(fe.value)&&K.length>+fe.value,Te=!Oc(de.value)&&K.length<+de.value;if((ve||Te)&&(he(ve,fe.message,de.message),!a))return ce(oe[j].message),oe}if(M&&!te&&vp(K)){const{value:fe,message:de}=vS(M);if(Sk(fe)&&!K.match(fe)&&(oe[j]={type:Ef.pattern,message:de,ref:f,...ie(Ef.pattern,de)},!a))return ce(de),oe}if(L){if(gp(L)){const fe=await L(K,i),de=fQ(fe,ne);if(de&&(oe[j]={...de,...ie(Ef.validate,de.message)},!a))return ce(de.message),oe}else if(ho(L)){let fe={};for(const de in L){if(!ll(fe)&&!a)break;const ve=fQ(await L[de](K,i),ne,de);ve&&(fe={...ve,...ie(de,ve.message)},ce(ve.message),a&&(oe[j]=fe))}if(!ll(fe)&&(oe[j]={ref:ne,...fe},!a))return oe}}return ce(!0),oe};function Y8e(n,t){const i=t.slice(0,-1).length;let a=0;for(;a<i;)n=vo(n)?a++:n[t[a++]];return n}function X8e(n){for(const t in n)if(n.hasOwnProperty(t)&&!vo(n[t]))return!1;return!0}function Uo(n,t){const i=Array.isArray(t)?t:l3(t)?[t]:Noe(t),a=i.length===1?n:Y8e(n,i),l=i.length-1,d=i[l];return a&&delete a[d],l!==0&&(ho(a)&&ll(a)||Array.isArray(a)&&X8e(a))&&Uo(n,i.slice(0,-1)),n}var DU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},uF=n=>Oc(n)||!koe(n);function gg(n,t){if(uF(n)||uF(t))return n===t;if(Ry(n)&&Ry(t))return n.getTime()===t.getTime();const i=Object.keys(n),a=Object.keys(t);if(i.length!==a.length)return!1;for(const l of i){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=t[l];if(Ry(d)&&Ry(f)||ho(d)&&ho(f)||Array.isArray(d)&&Array.isArray(f)?!gg(d,f):d!==f)return!1}}return!0}var Loe=n=>n.type==="select-multiple",J8e=n=>d3(n)||VC(n),xU=n=>vk(n)&&n.isConnected,Moe=n=>{for(const t in n)if(gp(n[t]))return!0;return!1};function bk(n,t={}){const i=Array.isArray(n);if(ho(n)||i)for(const a in n)Array.isArray(n[a])||ho(n[a])&&!Moe(n[a])?(t[a]=Array.isArray(n[a])?[]:{},bk(n[a],t[a])):Oc(n[a])||(t[a]=!0);return t}function Uoe(n,t,i){const a=Array.isArray(n);if(ho(n)||a)for(const l in n)Array.isArray(n[l])||ho(n[l])&&!Moe(n[l])?vo(t)||uF(i[l])?i[l]=Array.isArray(n[l])?bk(n[l],[]):{...bk(n[l])}:Uoe(n[l],Oc(t)?{}:t[l],i[l]):i[l]=!gg(n[l],t[l]);return i}var LT=(n,t)=>Uoe(n,t,bk(t)),Voe=(n,{valueAsNumber:t,valueAsDate:i,setValueAs:a})=>vo(n)?n:t?n===""?NaN:n&&+n:i&&vp(n)?new Date(n):a?a(n):n;function LU(n){const t=n.ref;return u3(t)?t.files:d3(t)?xoe(n.refs).value:Loe(t)?[...t.selectedOptions].map(({value:i})=>i):VC(t)?Doe(n.refs).value:Voe(vo(t.value)?n.ref.value:t.value,n)}var Q8e=(n,t,i,a)=>{const l={};for(const d of n){const f=_n(t,d);f&&is(l,d,f._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:a}},MT=n=>vo(n)?n:Sk(n)?n.source:ho(n)?Sk(n.value)?n.value.source:n.value:n;const gQ="AsyncFunction";var Z8e=n=>!!n&&!!n.validate&&!!(gp(n.validate)&&n.validate.constructor.name===gQ||ho(n.validate)&&Object.values(n.validate).find(t=>t.constructor.name===gQ)),eze=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function _Q(n,t,i){const a=_n(n,i);if(a||l3(i))return{error:a,name:i};const l=i.split(".");for(;l.length;){const d=l.join("."),f=_n(t,d),y=_n(n,d);if(f&&!Array.isArray(f)&&i!==d)return{name:i};if(y&&y.type)return{name:d,error:y};l.pop()}return{name:i}}var tze=(n,t,i,a,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(t||n):(i?a.isOnBlur:l.isOnBlur)?!n:(i?a.isOnChange:l.isOnChange)?n:!0,nze=(n,t)=>!PN(_n(n,t)).length&&Uo(n,t);const rze={mode:th.onSubmit,reValidateMode:th.onChange,shouldFocusError:!0};function ize(n={}){let t={...rze,...n},i={submitCount:0,isDirty:!1,isLoading:gp(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=ho(t.defaultValues)||ho(t.values)?$u(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:$u(l),f={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const R={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:DU(),array:DU(),state:DU()},k=lQ(t.mode),M=lQ(t.reValidateMode),L=t.criteriaMode===th.all,j=we=>xe=>{clearTimeout(b),b=setTimeout(we,xe)},z=async we=>{if(!t.disabled&&(R.isValid||we)){const xe=t.resolver?ll((await J()).errors):await ie(a,!0);xe!==i.isValid&&I.state.next({isValid:xe})}},Y=(we,xe)=>{!t.disabled&&(R.isValidating||R.validatingFields)&&((we||Array.from(y.mount)).forEach($e=>{$e&&(xe?is(i.validatingFields,$e,xe):Uo(i.validatingFields,$e))}),I.state.next({validatingFields:i.validatingFields,isValidating:!ll(i.validatingFields)}))},K=(we,xe=[],$e,Pt,It=!0,wt=!0)=>{if(Pt&&$e&&!t.disabled){if(f.action=!0,wt&&Array.isArray(_n(a,we))){const Mt=$e(_n(a,we),Pt.argA,Pt.argB);It&&is(a,we,Mt)}if(wt&&Array.isArray(_n(i.errors,we))){const Mt=$e(_n(i.errors,we),Pt.argA,Pt.argB);It&&is(i.errors,we,Mt),nze(i.errors,we)}if(R.touchedFields&&wt&&Array.isArray(_n(i.touchedFields,we))){const Mt=$e(_n(i.touchedFields,we),Pt.argA,Pt.argB);It&&is(i.touchedFields,we,Mt)}R.dirtyFields&&(i.dirtyFields=LT(l,d)),I.state.next({name:we,isDirty:fe(we,xe),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else is(d,we,xe)},ne=(we,xe)=>{is(i.errors,we,xe),I.state.next({errors:i.errors})},ce=we=>{i.errors=we,I.state.next({errors:i.errors,isValid:!1})},oe=(we,xe,$e,Pt)=>{const It=_n(a,we);if(It){const wt=_n(d,we,vo($e)?_n(l,we):$e);vo(wt)||Pt&&Pt.defaultChecked||xe?is(d,we,xe?wt:LU(It._f)):Te(we,wt),f.mount&&z()}},ge=(we,xe,$e,Pt,It)=>{let wt=!1,Mt=!1;const vn={name:we};if(!t.disabled){const Cn=!!(_n(a,we)&&_n(a,we)._f&&_n(a,we)._f.disabled);if(!$e||Pt){R.isDirty&&(Mt=i.isDirty,i.isDirty=vn.isDirty=fe(),wt=Mt!==vn.isDirty);const dn=Cn||gg(_n(l,we),xe);Mt=!!(!Cn&&_n(i.dirtyFields,we)),dn||Cn?Uo(i.dirtyFields,we):is(i.dirtyFields,we,!0),vn.dirtyFields=i.dirtyFields,wt=wt||R.dirtyFields&&Mt!==!dn}if($e){const dn=_n(i.touchedFields,we);dn||(is(i.touchedFields,we,$e),vn.touchedFields=i.touchedFields,wt=wt||R.touchedFields&&dn!==$e)}wt&&It&&I.state.next(vn)}return wt?vn:{}},X=(we,xe,$e,Pt)=>{const It=_n(i.errors,we),wt=R.isValid&&up(xe)&&i.isValid!==xe;if(t.delayError&&$e?(v=j(()=>ne(we,$e)),v(t.delayError)):(clearTimeout(b),v=null,$e?is(i.errors,we,$e):Uo(i.errors,we)),($e?!gg(It,$e):It)||!ll(Pt)||wt){const Mt={...Pt,...wt&&up(xe)?{isValid:xe}:{},errors:i.errors,name:we};i={...i,...Mt},I.state.next(Mt)}},J=async we=>{Y(we,!0);const xe=await t.resolver(d,t.context,Q8e(we||y.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return Y(we),xe},te=async we=>{const{errors:xe}=await J(we);if(we)for(const $e of we){const Pt=_n(xe,$e);Pt?is(i.errors,$e,Pt):Uo(i.errors,$e)}else i.errors=xe;return xe},ie=async(we,xe,$e={valid:!0})=>{for(const Pt in we){const It=we[Pt];if(It){const{_f:wt,...Mt}=It;if(wt){const vn=y.array.has(wt.name),Cn=It._f&&Z8e(It._f);Cn&&R.validatingFields&&Y([Pt],!0);const dn=await mQ(It,y.disabled,d,L,t.shouldUseNativeValidation&&!xe,vn);if(Cn&&R.validatingFields&&Y([Pt]),dn[wt.name]&&($e.valid=!1,xe))break;!xe&&(_n(dn,wt.name)?vn?q8e(i.errors,dn,wt.name):is(i.errors,wt.name,dn[wt.name]):Uo(i.errors,wt.name))}!ll(Mt)&&await ie(Mt,xe,$e)}}return $e.valid},he=()=>{for(const we of y.unMount){const xe=_n(a,we);xe&&(xe._f.refs?xe._f.refs.every($e=>!xU($e)):!xU(xe._f.ref))&&_t(we)}y.unMount=new Set},fe=(we,xe)=>!t.disabled&&(we&&xe&&is(d,we,xe),!gg(Ee(),l)),de=(we,xe,$e)=>$8e(we,y,{...f.mount?d:vo(xe)?l:vp(we)?{[we]:xe}:xe},$e,xe),ve=we=>PN(_n(f.mount?d:l,we,t.shouldUnregister?_n(l,we,[]):[])),Te=(we,xe,$e={})=>{const Pt=_n(a,we);let It=xe;if(Pt){const wt=Pt._f;wt&&(!wt.disabled&&is(d,we,Voe(xe,wt)),It=vk(wt.ref)&&Oc(xe)?"":xe,Loe(wt.ref)?[...wt.ref.options].forEach(Mt=>Mt.selected=It.includes(Mt.value)):wt.refs?VC(wt.ref)?wt.refs.length>1?wt.refs.forEach(Mt=>(!Mt.defaultChecked||!Mt.disabled)&&(Mt.checked=Array.isArray(It)?!!It.find(vn=>vn===Mt.value):It===Mt.value)):wt.refs[0]&&(wt.refs[0].checked=!!It):wt.refs.forEach(Mt=>Mt.checked=Mt.value===It):u3(wt.ref)?wt.ref.value="":(wt.ref.value=It,wt.ref.type||I.values.next({name:we,values:{...d}})))}($e.shouldDirty||$e.shouldTouch)&&ge(we,It,$e.shouldTouch,$e.shouldDirty,!0),$e.shouldValidate&&De(we)},Fe=(we,xe,$e)=>{for(const Pt in xe){const It=xe[Pt],wt=`${we}.${Pt}`,Mt=_n(a,wt);(y.array.has(we)||ho(It)||Mt&&!Mt._f)&&!Ry(It)?Fe(wt,It,$e):Te(wt,It,$e)}},be=(we,xe,$e={})=>{const Pt=_n(a,we),It=y.array.has(we),wt=$u(xe);is(d,we,wt),It?(I.array.next({name:we,values:{...d}}),(R.isDirty||R.dirtyFields)&&$e.shouldDirty&&I.state.next({name:we,dirtyFields:LT(l,d),isDirty:fe(we,wt)})):Pt&&!Pt._f&&!Oc(wt)?Fe(we,wt,$e):Te(we,wt,$e),uQ(we,y)&&I.state.next({...i}),I.values.next({name:f.mount?we:void 0,values:{...d}})},Ce=async we=>{f.mount=!0;const xe=we.target;let $e=xe.name,Pt=!0;const It=_n(a,$e),wt=()=>xe.type?LU(It._f):F8e(we),Mt=vn=>{Pt=Number.isNaN(vn)||Ry(vn)&&isNaN(vn.getTime())||gg(vn,_n(d,$e,vn))};if(It){let vn,Cn;const dn=wt(),Rt=we.type===cQ.BLUR||we.type===cQ.FOCUS_OUT,Qn=!eze(It._f)&&!t.resolver&&!_n(i.errors,$e)&&!It._f.deps||tze(Rt,_n(i.touchedFields,$e),i.isSubmitted,M,k),xt=uQ($e,y,Rt);is(d,$e,dn),Rt?(It._f.onBlur&&It._f.onBlur(we),v&&v(0)):It._f.onChange&&It._f.onChange(we);const Xt=ge($e,dn,Rt,!1),Lr=!ll(Xt)||xt;if(!Rt&&I.values.next({name:$e,type:we.type,values:{...d}}),Qn)return R.isValid&&(t.mode==="onBlur"&&Rt?z():Rt||z()),Lr&&I.state.next({name:$e,...xt?{}:Xt});if(!Rt&&xt&&I.state.next({...i}),t.resolver){const{errors:Ci}=await J([$e]);if(Mt(dn),Pt){const ai=_Q(i.errors,a,$e),Ii=_Q(Ci,a,ai.name||$e);vn=Ii.error,$e=Ii.name,Cn=ll(Ci)}}else Y([$e],!0),vn=(await mQ(It,y.disabled,d,L,t.shouldUseNativeValidation))[$e],Y([$e]),Mt(dn),Pt&&(vn?Cn=!1:R.isValid&&(Cn=await ie(a,!0)));Pt&&(It._f.deps&&De(It._f.deps),X($e,Cn,vn,Xt))}},Ae=(we,xe)=>{if(_n(i.errors,xe)&&we.focus)return we.focus(),1},De=async(we,xe={})=>{let $e,Pt;const It=kO(we);if(t.resolver){const wt=await te(vo(we)?we:It);$e=ll(wt),Pt=we?!It.some(Mt=>_n(wt,Mt)):$e}else we?(Pt=(await Promise.all(It.map(async wt=>{const Mt=_n(a,wt);return await ie(Mt&&Mt._f?{[wt]:Mt}:Mt)}))).every(Boolean),!(!Pt&&!i.isValid)&&z()):Pt=$e=await ie(a);return I.state.next({...!vp(we)||R.isValid&&$e!==i.isValid?{}:{name:we},...t.resolver||!we?{isValid:$e}:{},errors:i.errors}),xe.shouldFocus&&!Pt&&NR(a,Ae,we?It:y.mount),Pt},Ee=we=>{const xe={...f.mount?d:l};return vo(we)?xe:vp(we)?_n(xe,we):we.map($e=>_n(xe,$e))},Ne=(we,xe)=>({invalid:!!_n((xe||i).errors,we),isDirty:!!_n((xe||i).dirtyFields,we),error:_n((xe||i).errors,we),isValidating:!!_n(i.validatingFields,we),isTouched:!!_n((xe||i).touchedFields,we)}),je=we=>{we&&kO(we).forEach(xe=>Uo(i.errors,xe)),I.state.next({errors:we?i.errors:{}})},Ke=(we,xe,$e)=>{const Pt=(_n(a,we,{_f:{}})._f||{}).ref,It=_n(i.errors,we)||{},{ref:wt,message:Mt,type:vn,...Cn}=It;is(i.errors,we,{...Cn,...xe,ref:Pt}),I.state.next({name:we,errors:i.errors,isValid:!1}),$e&&$e.shouldFocus&&Pt&&Pt.focus&&Pt.focus()},ot=(we,xe)=>gp(we)?I.values.subscribe({next:$e=>we(de(void 0,xe),$e)}):de(we,xe,!0),_t=(we,xe={})=>{for(const $e of we?kO(we):y.mount)y.mount.delete($e),y.array.delete($e),xe.keepValue||(Uo(a,$e),Uo(d,$e)),!xe.keepError&&Uo(i.errors,$e),!xe.keepDirty&&Uo(i.dirtyFields,$e),!xe.keepTouched&&Uo(i.touchedFields,$e),!xe.keepIsValidating&&Uo(i.validatingFields,$e),!t.shouldUnregister&&!xe.keepDefaultValue&&Uo(l,$e);I.values.next({values:{...d}}),I.state.next({...i,...xe.keepDirty?{isDirty:fe()}:{}}),!xe.keepIsValid&&z()},lt=({disabled:we,name:xe,field:$e,fields:Pt})=>{(up(we)&&f.mount||we||y.disabled.has(xe))&&(we?y.disabled.add(xe):y.disabled.delete(xe),ge(xe,LU($e?$e._f:_n(Pt,xe)._f),!1,!1,!0))},vt=(we,xe={})=>{let $e=_n(a,we);const Pt=up(xe.disabled)||up(t.disabled);return is(a,we,{...$e||{},_f:{...$e&&$e._f?$e._f:{ref:{name:we}},name:we,mount:!0,...xe}}),y.mount.add(we),$e?lt({field:$e,disabled:up(xe.disabled)?xe.disabled:t.disabled,name:we}):oe(we,!0,xe.value),{...Pt?{disabled:xe.disabled||t.disabled}:{},...t.progressive?{required:!!xe.required,min:MT(xe.min),max:MT(xe.max),minLength:MT(xe.minLength),maxLength:MT(xe.maxLength),pattern:MT(xe.pattern)}:{},name:we,onChange:Ce,onBlur:Ce,ref:It=>{if(It){vt(we,xe),$e=_n(a,we);const wt=vo(It.value)&&It.querySelectorAll&&It.querySelectorAll("input,select,textarea")[0]||It,Mt=J8e(wt),vn=$e._f.refs||[];if(Mt?vn.find(Cn=>Cn===wt):wt===$e._f.ref)return;is(a,we,{_f:{...$e._f,...Mt?{refs:[...vn.filter(xU),wt,...Array.isArray(_n(l,we))?[{}]:[]],ref:{type:wt.type,name:we}}:{ref:wt}}}),oe(we,!1,void 0,wt)}else $e=_n(a,we,{}),$e._f&&($e._f.mount=!1),(t.shouldUnregister||xe.shouldUnregister)&&!(B8e(y.array,we)&&f.action)&&y.unMount.add(we)}}},rt=()=>t.shouldFocusError&&NR(a,Ae,y.mount),bt=we=>{up(we)&&(I.state.next({disabled:we}),NR(a,(xe,$e)=>{const Pt=_n(a,$e);Pt&&(xe.disabled=Pt._f.disabled||we,Array.isArray(Pt._f.refs)&&Pt._f.refs.forEach(It=>{It.disabled=Pt._f.disabled||we}))},0,!1))},$t=(we,xe)=>async $e=>{let Pt;$e&&($e.preventDefault&&$e.preventDefault(),$e.persist&&$e.persist());let It=$u(d);if(y.disabled.size)for(const wt of y.disabled)is(It,wt,void 0);if(I.state.next({isSubmitting:!0}),t.resolver){const{errors:wt,values:Mt}=await J();i.errors=wt,It=Mt}else await ie(a);if(Uo(i.errors,"root"),ll(i.errors)){I.state.next({errors:{}});try{await we(It,$e)}catch(wt){Pt=wt}}else xe&&await xe({...i.errors},$e),rt(),setTimeout(rt);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ll(i.errors)&&!Pt,submitCount:i.submitCount+1,errors:i.errors}),Pt)throw Pt},ut=(we,xe={})=>{_n(a,we)&&(vo(xe.defaultValue)?be(we,$u(_n(l,we))):(be(we,xe.defaultValue),is(l,we,$u(xe.defaultValue))),xe.keepTouched||Uo(i.touchedFields,we),xe.keepDirty||(Uo(i.dirtyFields,we),i.isDirty=xe.defaultValue?fe(we,$u(_n(l,we))):fe()),xe.keepError||(Uo(i.errors,we),R.isValid&&z()),I.state.next({...i}))},mt=(we,xe={})=>{const $e=we?$u(we):l,Pt=$u($e),It=ll(we),wt=It?l:Pt;if(xe.keepDefaultValues||(l=$e),!xe.keepValues){if(xe.keepDirtyValues){const Mt=new Set([...y.mount,...Object.keys(LT(l,d))]);for(const vn of Array.from(Mt))_n(i.dirtyFields,vn)?is(wt,vn,_n(d,vn)):be(vn,_n(wt,vn))}else{if(c3&&vo(we))for(const Mt of y.mount){const vn=_n(a,Mt);if(vn&&vn._f){const Cn=Array.isArray(vn._f.refs)?vn._f.refs[0]:vn._f.ref;if(vk(Cn)){const dn=Cn.closest("form");if(dn){dn.reset();break}}}}a={}}d=t.shouldUnregister?xe.keepDefaultValues?$u(l):{}:$u(wt),I.array.next({values:{...wt}}),I.values.next({values:{...wt}})}y={mount:xe.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!R.isValid||!!xe.keepIsValid||!!xe.keepDirtyValues,f.watch=!!t.shouldUnregister,I.state.next({submitCount:xe.keepSubmitCount?i.submitCount:0,isDirty:It?!1:xe.keepDirty?i.isDirty:!!(xe.keepDefaultValues&&!gg(we,l)),isSubmitted:xe.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:It?{}:xe.keepDirtyValues?xe.keepDefaultValues&&d?LT(l,d):i.dirtyFields:xe.keepDefaultValues&&we?LT(l,we):xe.keepDirty?i.dirtyFields:{},touchedFields:xe.keepTouched?i.touchedFields:{},errors:xe.keepErrors?i.errors:{},isSubmitSuccessful:xe.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},at=(we,xe)=>mt(gp(we)?we(d):we,xe);return{control:{register:vt,unregister:_t,getFieldState:Ne,handleSubmit:$t,setError:Ke,_executeSchema:J,_getWatch:de,_getDirty:fe,_updateValid:z,_removeUnmounted:he,_updateFieldArray:K,_updateDisabledField:lt,_getFieldArray:ve,_reset:mt,_resetDefaultValues:()=>gp(t.defaultValues)&&t.defaultValues().then(we=>{at(we,t.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:we=>{i={...i,...we}},_disableForm:bt,_subjects:I,_proxyFormState:R,_setErrors:ce,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(we){f=we},get _defaultValues(){return l},get _names(){return y},set _names(we){y=we},get _formState(){return i},set _formState(we){i=we},get _options(){return t},set _options(we){t={...t,...we}}},trigger:De,register:vt,handleSubmit:$t,watch:ot,setValue:be,getValues:Ee,reset:at,resetField:ut,clearErrors:je,unregister:_t,setError:Ke,setFocus:(we,xe={})=>{const $e=_n(a,we),Pt=$e&&$e._f;if(Pt){const It=Pt.refs?Pt.refs[0]:Pt.ref;It.focus&&(It.focus(),xe.shouldSelect&&gp(It.select)&&It.select())}},getFieldState:Ne}}function Foe(n={}){const t=Ei.useRef(void 0),i=Ei.useRef(void 0),[a,l]=Ei.useState({isDirty:!1,isValidating:!1,isLoading:gp(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:gp(n.defaultValues)?void 0:n.defaultValues});t.current||(t.current={...ize(n),formState:a});const d=t.current.control;return d._options=n,H8e({subject:d._subjects.state,next:f=>{G8e(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),Ei.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),Ei.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),Ei.useEffect(()=>{n.values&&!gg(n.values,i.current)?(d._reset(n.values,d._options.resetOptions),i.current=n.values,l(f=>({...f}))):d._resetDefaultValues()},[n.values,d]),Ei.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),Ei.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),Ei.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),t.current.formState=W8e(a,d),t.current}var sze=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function dF(){return dF=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},dF.apply(this,arguments)}function oze(n,t){if(n==null)return{};var i={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(i[l]=n[l]);return i}function X1(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function aze(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,hF(n,t)}function hF(n,t){return hF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,l){return a.__proto__=l,a},hF(n,t)}var ON=function(n){aze(t,n);function t(){var a;return a=n.call(this)||this,a.handleExpired=a.handleExpired.bind(X1(a)),a.handleErrored=a.handleErrored.bind(X1(a)),a.handleChange=a.handleChange.bind(X1(a)),a.handleRecaptchaRef=a.handleRecaptchaRef.bind(X1(a)),a}var i=t.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(d,f){l.executionResolve=d,l.executionReject=f,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var d=document.createElement("div");this._widgetId=l(d,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(d)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var d=oze(l,sze);return N.createElement("div",dF({},d,{ref:this.handleRecaptchaRef}))},t}(N.Component);ON.displayName="ReCAPTCHA";ON.propTypes={sitekey:Pn.string.isRequired,onChange:Pn.func,grecaptcha:Pn.object,theme:Pn.oneOf(["dark","light"]),type:Pn.oneOf(["image","audio"]),tabindex:Pn.number,onExpired:Pn.func,onErrored:Pn.func,size:Pn.oneOf(["compact","normal","invisible"]),stoken:Pn.string,hl:Pn.string,badge:Pn.oneOf(["bottomright","bottomleft","inline"]),isolated:Pn.bool};ON.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function pF(){return pF=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},pF.apply(this,arguments)}function cze(n,t){if(n==null)return{};var i={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(i[l]=n[l]);return i}function lze(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t}var Yd={},uze=0;function dze(n,t){return t=t||{},function(a){var l=a.displayName||a.name||"Component",d=function(y){lze(v,y);function v(R,I){var k;return k=y.call(this,R,I)||this,k.state={},k.__scriptURL="",k}var b=v.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+uze++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(I){var k=this;this.setState(I,function(){return k.props.asyncScriptOnLoad&&k.props.asyncScriptOnLoad(k.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=Yd[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var k in I.observers)I.observers[k](I);delete window[t.callbackName]},b.componentDidMount=function(){var I=this,k=this.setupScriptURL(),M=this.asyncScriptLoaderGetScriptLoaderID(),L=t,j=L.globalName,z=L.callbackName,Y=L.scriptId;if(j&&typeof window[j]<"u"&&(Yd[k]={loaded:!0,observers:{}}),Yd[k]){var K=Yd[k];if(K&&(K.loaded||K.errored)){this.asyncScriptLoaderHandleLoad(K);return}K.observers[M]=function(X){return I.asyncScriptLoaderHandleLoad(X)};return}var ne={};ne[M]=function(X){return I.asyncScriptLoaderHandleLoad(X)},Yd[k]={loaded:!1,observers:ne};var ce=document.createElement("script");ce.src=k,ce.async=!0;for(var oe in t.attributes)ce.setAttribute(oe,t.attributes[oe]);Y&&(ce.id=Y);var ge=function(J){if(Yd[k]){var te=Yd[k],ie=te.observers;for(var he in ie)J(ie[he])&&delete ie[he]}};z&&typeof window<"u"&&(window[z]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),ce.onload=function(){var X=Yd[k];X&&(X.loaded=!0,ge(function(J){return z?!1:(J(X),!0)}))},ce.onerror=function(){var X=Yd[k];X&&(X.errored=!0,ge(function(J){return J(X),!0}))},document.body.appendChild(ce)},b.componentWillUnmount=function(){var I=this.__scriptURL;if(t.removeOnUnmount===!0)for(var k=document.getElementsByTagName("script"),M=0;M<k.length;M+=1)k[M].src.indexOf(I)>-1&&k[M].parentNode&&k[M].parentNode.removeChild(k[M]);var L=Yd[I];L&&(delete L.observers[this.asyncScriptLoaderGetScriptLoaderID()],t.removeOnUnmount===!0&&delete Yd[I])},b.render=function(){var I=t.globalName,k=this.props;k.asyncScriptOnLoad;var M=k.forwardedRef,L=cze(k,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(L[I]=typeof window[I]<"u"?window[I]:void 0),L.ref=M,N.createElement(a,L)},v}(N.Component),f=N.forwardRef(function(y,v){return N.createElement(d,pF({},y,{forwardedRef:v}))});return f.displayName="AsyncScriptLoader("+l+")",f.propTypes={asyncScriptOnLoad:Pn.func},wIe(f,a)}}var fF="onloadcallback",hze="grecaptcha";function mF(){return typeof window<"u"&&window.recaptchaOptions||{}}function pze(){var n=mF(),t=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+t+"/recaptcha/enterprise.js?onload="+fF+"&render=explicit":"https://"+t+"/recaptcha/api.js?onload="+fF+"&render=explicit"}const joe=dze(pze,{callbackName:fF,globalName:hze,attributes:mF().nonce?{nonce:mF().nonce}:{}})(ON),kN=(n,t="generic-modal")=>{N.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),G.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){G.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),G.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):G.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){G.error(`Failed to enable Unity input for ${t}:`,l)}};return n?i():a(),()=>{n&&a()}},[n,t])},Boe=({isOpen:n,onClose:t,userData:i,onConfirm:a,fullscreenRef:l})=>{const[d,f]=N.useState((i==null?void 0:i.username)||""),[y,v]=N.useState((i==null?void 0:i.Nickname)||""),[b,R]=N.useState(!1),[I,k]=N.useState(null),[M,L]=N.useState(!1),j=uc(),z=ce=>!(!ce||ce.trim()===""||!/^[a-z0-9]{1,15}$/.test(ce)),Y=async ce=>{var oe,ge;if(!z(ce))return!ce||ce.trim()===""?k("Username cannot be empty"):k("Username must be 1-15 characters, lowercase letters and numbers only"),!1;R(!0),k(null);try{let X=!1,J=0;const te=3;for(;J<te;)try{X=await loe(ce);break}catch(ie){if(G.error(`Attempt ${J+1}: Error checking username:`,ie),J++,J>=te)throw ie;await new Promise(he=>setTimeout(he,1e3))}return X?(k("Username is already taken"),!1):!0}catch(X){return G.error("Error checking username after retries:",X),X.code==="permission-denied"||(oe=X.message)!=null&&oe.includes("permissions")?k("Username check unavailable. Please try again or pick a unique name."):k("Error checking username availability. Please try again."),X.code==="permission-denied"||((ge=X.message)==null?void 0:ge.includes("permissions"))}finally{R(!1)}};N.useEffect(()=>{if(!d){k("Username cannot be empty");return}if(d!==(i==null?void 0:i.username)){const ce=setTimeout(async()=>{await Y(d)},500);return()=>clearTimeout(ce)}},[d]),N.useEffect(()=>{if(i&&i.firstName&&i.lastName){const ce=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;v(ce)}},[i]);const K=async()=>{L(!0);try{if(!await Y(d)){L(!1);return}if(y.length>15){k("Display Name must be at most 15 characters"),L(!1);return}oR(y),G.log("UsernameConfirmation: Preparing to confirm user registration");const oe=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",ge={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:d,Nickname:y||oe,email:i.email,password:i.password};G.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(ge).join(", ")),await a(ge),t()}catch(ce){G.error("Error during username confirmation:",ce),j({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{L(!1)}},ne=()=>{M||t()};return w.jsxs(Rs,{isOpen:n,onClose:ne,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!M,closeOnEsc:!M,children:[w.jsx(As,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(Cs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[w.jsxs(To,{children:[w.jsx(eC,{size:"lg",mb:2,children:"Customize Your Profile"}),w.jsx(it,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),w.jsx(zs,{color:"gray.400",isDisabled:M}),w.jsx(Is,{children:w.jsxs(qr,{spacing:6,align:"stretch",children:[w.jsxs(Kr,{isInvalid:!!I,children:[w.jsx(ss,{children:"Username"}),w.jsxs(Ly,{children:[w.jsx(Hj,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),w.jsx(Xi,{placeholder:"username",value:d,onChange:ce=>f(ce.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?w.jsx(pp,{children:I}):w.jsx(HS,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),w.jsxs(Kr,{children:[w.jsx(ss,{children:"Nickname"}),w.jsx(Xi,{placeholder:"Nickname",value:y,onChange:ce=>v(ce.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),w.jsx(HS,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),w.jsx(oh,{children:w.jsxs(Bi,{gap:3,width:"100%",children:[w.jsx($n,{variant:"outline",onClick:ne,flex:"1",isDisabled:M,children:"Back"}),w.jsx($n,{colorScheme:"blue",onClick:K,isLoading:M||b,isDisabled:!!I||!d||M,flex:"2",children:"Finish"})]})})]})]})};Boe.propTypes={isOpen:Pn.bool.isRequired,onClose:Pn.func.isRequired,userData:Pn.object.isRequired,onConfirm:Pn.func.isRequired,fullscreenRef:Pn.object};const fze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function h3({mode:n,label:t,buttonProps:i={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:y}}=Foe(),{register:v}=N.useContext(Hs),b=uc(),{fullscreenRef:R}=hh(),[I,k]=N.useState(!1),[M,L]=N.useState(!1),[j,z]=N.useState(null),Y=N.useRef(null),[K,ne]=N.useState(!1),[ce,oe]=N.useState(null),[ge,X]=N.useState(!1),J=a!==void 0?a:I,te=l||(()=>k(!1));kN(J||K),N.useEffect(()=>{!J&&Y.current&&(Y.current.reset(),z(null))},[J]);const ie=Te=>{z(Te)},he=async Te=>{G.log("Register.jsx: Processing registration form submission");const{email:Fe,password:be,confirmPassword:Ce,...Ae}=Te;if(G.log("Register.jsx: Registration data fields:",Object.keys(Ae).join(", ")),!j){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(be!==Ce){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}oR(Ae.firstName),oR(Ae.lastName),oR(Ae.companyName),L(!0);try{const De=await e6e(Ae.firstName||"",Ae.lastName||""),Ee=Ae.firstName&&Ae.lastName?`${Ae.firstName}${Ae.lastName.charAt(0).toUpperCase()}`:"";Ee&&oR(Ee),G.log("Register.jsx: Generated username and nickname for new user");const Ne={...Ae,firstName:Ae.firstName||"",lastName:Ae.lastName||"",companyName:Ae.companyName||"",linkedInProfile:Ae.linkedInProfile||"",email:Fe,password:be,username:De,Nickname:Ee,captchaToken:j};G.log("Register.jsx: Prepared registration data with fields:",Object.keys(Ne).join(", ")),oe(Ne),ne(!0)}catch(De){G.error("User: Registration Error:",De);let Ee="An error occurred during registration. Please try again.",Ne=!1;De.code==="auth/email-already-in-use"?(Ee="This email address is already registered. Please sign in instead.",Ne=!0):De.code==="auth/invalid-email"?Ee="The email address is not valid. Please check and try again.":De.code==="auth/weak-password"?Ee="The password is too weak. Please choose a stronger password.":De.message&&(Ee=De.message),b({title:"Registration Failed",description:w.jsxs(w.Fragment,{children:[Ee,Ne&&w.jsx(it,{mt:2,children:w.jsx(Xl,{color:"blue.400",onClick:()=>{te(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{L(!1),Y.current&&Y.current.reset()}},fe=async Te=>{L(!0);try{G.log("Register.jsx: Completing registration with confirmed username");const{email:Fe,password:be,...Ce}=Te,Ae={...Ce,firstName:Ce.firstName||"",lastName:Ce.lastName||"",companyName:Ce.companyName||"",linkedInProfile:Ce.linkedInProfile||"",username:Ce.username||"",Nickname:Ce.Nickname||""};G.log("Register.jsx: Final registration data includes fields:",Object.keys(Ae).join(", "));const De=await v(Fe,be,Ae);te(),ne(!1),G.log("User: Registration process complete."),b({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),oe(null),X(!1)}catch(Fe){G.error("User: Registration Error during final step:",Fe);let be="An error occurred during registration. Please try again.";Fe.code==="auth/email-already-in-use"?be="This email address is already in use. Please try another one.":Fe.message&&(be=Fe.message),b({title:"Registration Failed",description:be,status:"error",duration:5e3,isClosable:!0,position:"top"}),ne(!1),oe(null),X(!1)}finally{L(!1)}},de=()=>{l?l():k(!I)},ve=n==="link"?w.jsx(Xl,{variant:"header",onClick:de,children:t}):w.jsx($n,{onClick:de,...i,children:t});return w.jsxs(w.Fragment,{children:[!a&&ve,w.jsxs(Rs,{isOpen:J&&!K,onClose:te,size:"md",portalProps:{containerRef:R},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(As,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(Cs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Te=>{Te.stopPropagation()},children:[w.jsxs(To,{p:8,textAlign:"center",children:[w.jsx(eC,{size:"lg",mb:2,color:"white",children:"Create Account"}),w.jsx(it,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),w.jsx(zs,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),w.jsx(Is,{px:8,children:w.jsx("form",{onSubmit:f(he),children:w.jsxs(qr,{spacing:4,children:[w.jsxs(Kr,{isInvalid:y.companyName,isRequired:!0,children:[w.jsx(Xi,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required",setValueAs:Te=>Te===""?"":Te})}),w.jsx(pp,{children:y.companyName&&y.companyName.message})]}),w.jsxs(Bi,{gap:4,w:"100%",children:[w.jsxs(Kr,{isInvalid:y.firstName,isRequired:!0,children:[w.jsx(Xi,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required",setValueAs:Te=>Te===""?"":Te})}),w.jsx(pp,{children:y.firstName&&y.firstName.message})]}),w.jsxs(Kr,{isInvalid:y.lastName,isRequired:!0,children:[w.jsx(Xi,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required",setValueAs:Te=>Te===""?"":Te})}),w.jsx(pp,{children:y.lastName&&y.lastName.message})]})]}),w.jsxs(Kr,{isInvalid:y.email,isRequired:!0,children:[w.jsx(Xi,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),w.jsx(pp,{children:y.email&&y.email.message})]}),w.jsxs(Bi,{gap:4,w:"100%",children:[w.jsxs(Kr,{isInvalid:y.password,isRequired:!0,children:[w.jsx(Xi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),w.jsx(pp,{children:y.password&&y.password.message})]}),w.jsxs(Kr,{isInvalid:y.confirmPassword,isRequired:!0,children:[w.jsx(Xi,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),w.jsx(pp,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),w.jsx(Kr,{children:w.jsx(Xi,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile",{setValueAs:Te=>Te===""?"":Te})})}),w.jsx(ht,{width:"100%",display:"flex",justifyContent:"center",my:4,children:w.jsx(joe,{ref:Y,sitekey:fze,onChange:ie,theme:"dark"})})]})})}),w.jsxs(oh,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx($n,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(he),isLoading:M,loadingText:"Processing",isDisabled:!j,children:"Next: Set Your Username"}),w.jsxs(it,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",w.jsx(Xl,{color:"blue.400",onClick:()=>{te(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),K&&w.jsx(Boe,{isOpen:K,onClose:()=>ne(!1),userData:ce,onConfirm:fe,fullscreenRef:R,isRegistering:ge})]})}h3.propTypes={mode:Pn.oneOf(["button","link"]),label:Pn.string,buttonProps:Pn.object,isOpen:Pn.bool,onClose:Pn.func};const mze=Vg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),gze=Vg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),_ze=Vg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),yze=Vg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),yQ=Vg({displayName:"EmailIcon",path:w.jsxs("g",{fill:"currentColor",children:[w.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),w.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),Eze=Vg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),vze=Vg({displayName:"QuestionOutlineIcon",path:w.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[w.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),w.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),w.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),Sze=Vg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),bze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function cC({mode:n="button",label:t="Sign In",buttonProps:i={},initialIsOpen:a=!1}){const{signIn:l,createGuestUser:d}=N.useContext(Hs),{fullscreenRef:f}=hh(),y=uc(),{register:v,handleSubmit:b,formState:{errors:R}}=Foe(),[I,k]=N.useState(!1),[M,L]=N.useState(a),[j,z]=N.useState(!1),[Y,K]=N.useState(!1),[ne,ce]=N.useState(""),[oe,ge]=N.useState(!1),[X,J]=N.useState(null),[te,ie]=N.useState(!1),[he,fe]=N.useState(!1),de=N.useRef(null);kN(M||Y),N.useEffect(()=>{M&&(async()=>{try{const Ke=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(Ke){const ot=Ke[2],_t=await Ma(ot);ie((_t==null?void 0:_t.allowGuestUsers)||!1)}}catch(je){G.error("SignIn: Error checking guest access:",je),ie(!1)}})()},[M]),N.useEffect(()=>{const Ne=()=>{L(!0)};return window.addEventListener("openSignInModal",Ne),()=>{window.removeEventListener("openSignInModal",Ne)}},[]);const ve=Ne=>{J(Ne)},Te=async Ne=>{if(!X){y({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}k(!0);try{await l(Ne.email,Ne.password,X),G.log("User: Sign-in process complete."),L(!1),window.location.reload()}catch(je){G.error("User: SignIn Error:",je);const Ke=je.message||"An error occurred while logging in. Please check your credentials.",ot=Ke.includes("verify your email");y({title:ot?"Email Verification Required":"Error",description:Ke,status:ot?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:f.current})}finally{k(!1),de.current&&de.current.reset()}},Fe=async()=>{if(!ne){y({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:f.current});return}try{ge(!0),await QFe(Q5,ne),y({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:f.current}),K(!1)}catch(Ne){G.error("User: Reset Password Error:",Ne),y({title:"Error",description:Ne.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:f.current})}finally{ge(!1)}},be=()=>L(Ne=>!Ne),Ce=()=>{L(!1),z(!0)},Ae=()=>{K(!0)},De=async()=>{try{fe(!0);const je=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(je){const Ke=je[2];await d(Ke),y({title:"Welcome, Guest!",description:"You're now entering as a guest user.",status:"success",duration:3e3,isClosable:!0,position:"top",container:f.current}),L(!1),window.location.reload()}}catch(Ne){G.error("SignIn: Error creating guest user:",Ne),y({title:"Error",description:"Failed to create guest user. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:f.current})}finally{fe(!1)}},Ee=n==="link"?w.jsx(Xl,{variant:"header",onClick:be,children:t}):w.jsx($n,{onClick:be,...i,children:t});return w.jsxs(w.Fragment,{children:[Ee,w.jsxs(Rs,{isOpen:M,onClose:be,size:"md",portalProps:{containerRef:f},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(As,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsx("form",{onSubmit:b(Te),children:w.jsxs(Cs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Ne=>{Ne.stopPropagation()},children:[w.jsxs(To,{p:8,textAlign:"center",children:[w.jsx(eC,{size:"lg",mb:2,color:"white",children:"Welcome Back"}),w.jsx(it,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),w.jsx(zs,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),w.jsx(Is,{px:8,pb:8,children:w.jsxs(qr,{spacing:4,children:[w.jsxs(Kr,{isInvalid:R.email,children:[w.jsxs(Ly,{children:[w.jsx(bR,{pointerEvents:"none",children:w.jsx(yQ,{color:"gray.500"})}),w.jsx(Xi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...v("email",{required:"Email is required."})})]}),w.jsx(pp,{children:R.email&&R.email.message})]}),w.jsxs(Kr,{isInvalid:R.password,children:[w.jsxs(Ly,{children:[w.jsx(bR,{pointerEvents:"none",children:w.jsx(_ze,{color:"gray.500"})}),w.jsx(Xi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...v("password",{required:"Password is required."})})]}),w.jsx(pp,{children:R.password&&R.password.message})]}),w.jsx(ht,{alignSelf:"flex-end",children:w.jsx(Xl,{color:"blue.400",fontSize:"sm",onClick:Ae,children:"Forgot Password?"})}),w.jsx(Bi,{width:"100%",justifyContent:"center",my:4,children:w.jsx(joe,{ref:de,sitekey:bze,onChange:ve,theme:"dark"})})]})}),w.jsxs(oh,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx($n,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:I,loadingText:"Signing In",isDisabled:!X,children:"Sign In"}),te&&w.jsx($n,{colorScheme:"gray",variant:"outline",size:"lg",width:"100%",onClick:De,isLoading:he,loadingText:"Creating Guest Account...",_hover:{bg:"gray.700"},children:"Continue as Guest"}),w.jsxs(it,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",w.jsx(Xl,{color:"blue.400",onClick:Ce,children:"Sign Up"})]})]})]})})]}),w.jsxs(Rs,{isOpen:Y,onClose:()=>K(!1),size:"md",portalProps:{containerRef:f},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(As,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(Cs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Ne=>{Ne.stopPropagation()},children:[w.jsxs(To,{p:8,textAlign:"center",children:[w.jsx(eC,{size:"lg",mb:2,color:"white",children:"Reset Password"}),w.jsx(it,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),w.jsx(zs,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),w.jsx(Is,{px:8,pb:4,children:w.jsx(Kr,{children:w.jsxs(Ly,{children:[w.jsx(bR,{pointerEvents:"none",children:w.jsx(yQ,{color:"gray.500"})}),w.jsx(Xi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:ne,onChange:Ne=>ce(Ne.target.value)})]})})}),w.jsxs(oh,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx($n,{colorScheme:"blue",size:"lg",width:"100%",onClick:Fe,isLoading:oe,loadingText:"Sending",children:"Send Reset Link"}),w.jsxs(it,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",w.jsx(Xl,{color:"blue.400",onClick:()=>K(!1),children:"Back to Sign In"})]})]})]})]}),w.jsx(h3,{mode:"link",isOpen:j,onClose:()=>z(!1)})]})}cC.propTypes={mode:Pn.oneOf(["button","link"]),label:Pn.string,buttonProps:Pn.object,initialIsOpen:Pn.bool};var MU={},vf={},UT={},EQ;function wze(){if(EQ)return UT;EQ=1,Object.defineProperty(UT,"__esModule",{value:!0}),UT.useCanvasIdentifier=void 0;var n=Hf(),t=0,i="react-unity-webgl-canvas",a=function(l){var d=(0,n.useState)(0),f=d[0],y=d[1],v=(0,n.useCallback)(function(){y(function(R){return R+1})},[]);if(l!==void 0)return[l,v];var b=(0,n.useMemo)(function(){return[i,t].join("-")},[f]);return[b,v]};return UT.useCanvasIdentifier=a,UT}var VT={},FT={},vQ;function zoe(){return vQ||(vQ=1,Object.defineProperty(FT,"__esModule",{value:!0}),FT.isBrowserEnvironment=void 0,FT.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),FT}var SQ;function Tze(){if(SQ)return VT;SQ=1,Object.defineProperty(VT,"__esModule",{value:!0}),VT.useUnityLoader=void 0;var n=Hf(),t=zoe(),i=function(a){var l=(0,n.useState)("Loading"),d=l[0],f=l[1];return(0,n.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(a===null){f("Idle");return}var y=window.document.querySelector('script[src="'.concat(a,'"]'));y===null?(y=window.document.createElement("script"),y.type="text/javascript",y.src=a,y.async=!0,y.setAttribute("data-status","loading"),window.document.body.appendChild(y),y.addEventListener("load",function(){return y==null?void 0:y.setAttribute("data-status","loaded")}),y.addEventListener("error",function(){return y==null?void 0:y.setAttribute("data-status","error")})):f(y.getAttribute("data-status")==="loaded"?"Loaded":"Error");var v=function(b){return f(b.type==="load"?"Loaded":"Error")};return y.addEventListener("load",v),y.addEventListener("error",v),function(){y!==null&&(y.removeEventListener("load",v),y.removeEventListener("error",v),y.remove())}}},[a]),d};return VT.useUnityLoader=i,VT}var bQ;function Rze(){if(bQ)return vf;bQ=1;var n=vf&&vf.__awaiter||function(f,y,v,b){function R(I){return I instanceof v?I:new v(function(k){k(I)})}return new(v||(v=Promise))(function(I,k){function M(z){try{j(b.next(z))}catch(Y){k(Y)}}function L(z){try{j(b.throw(z))}catch(Y){k(Y)}}function j(z){z.done?I(z.value):R(z.value).then(M,L)}j((b=b.apply(f,y||[])).next())})},t=vf&&vf.__generator||function(f,y){var v={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,R,I,k=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return k.next=M(0),k.throw=M(1),k.return=M(2),typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function M(j){return function(z){return L([j,z])}}function L(j){if(b)throw new TypeError("Generator is already executing.");for(;k&&(k=0,j[0]&&(v=0)),v;)try{if(b=1,R&&(I=j[0]&2?R.return:j[0]?R.throw||((I=R.return)&&I.call(R),0):R.next)&&!(I=I.call(R,j[1])).done)return I;switch(R=0,I&&(j=[j[0]&2,I.value]),j[0]){case 0:case 1:I=j;break;case 4:return v.label++,{value:j[1],done:!1};case 5:v.label++,R=j[1],j=[0];continue;case 7:j=v.ops.pop(),v.trys.pop();continue;default:if(I=v.trys,!(I=I.length>0&&I[I.length-1])&&(j[0]===6||j[0]===2)){v=0;continue}if(j[0]===3&&(!I||j[1]>I[0]&&j[1]<I[3])){v.label=j[1];break}if(j[0]===6&&v.label<I[1]){v.label=I[1],I=j;break}if(I&&v.label<I[2]){v.label=I[2],v.ops.push(j);break}I[2]&&v.ops.pop(),v.trys.pop();continue}j=y.call(f,v)}catch(z){j=[6,z],R=0}finally{b=I=0}if(j[0]&5)throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}};Object.defineProperty(vf,"__esModule",{value:!0}),vf.Unity=void 0;var i=Hf(),a=wze(),l=Tze(),d=(0,i.forwardRef)(function(f,y){var v=(0,i.useState)(null),b=v[0],R=v[1],I=(0,i.useState)(null),k=I[0],M=I[1],L=(0,a.useCanvasIdentifier)(f.id),j=L[0],z=L[1],Y=(0,l.useUnityLoader)(f.unityProvider.loaderUrl),K=(0,i.useCallback)(function(ne){f.unityProvider.setLoadingProgression(ne),ne===1&&f.unityProvider.setIsLoaded(!0)},[f.unityProvider]);return(0,i.useEffect)(function(){var ne=function(){return n(void 0,void 0,void 0,function(){var oe,ge,X,J,te;return t(this,function(ie){switch(ie.label){case 0:if(!b||k||Y!=="Loaded")return[2];console.log("React Unity WebGL: Initializing Unity instance..."),f.unityProvider.setUnityInstance(null),M(null),f.unityProvider.setLoadingProgression(0),(te=(J=f.unityProvider).setIsLoaded)===null||te===void 0||te.call(J,!1),f.unityProvider.setInitialisationError(void 0),z(),oe={companyName:f.unityProvider.companyName,productName:f.unityProvider.productName,productVersion:f.unityProvider.productVersion,dataUrl:f.unityProvider.dataUrl,frameworkUrl:f.unityProvider.frameworkUrl,codeUrl:f.unityProvider.codeUrl,workerUrl:f.unityProvider.workerUrl,memoryUrl:f.unityProvider.memoryUrl,symbolsUrl:f.unityProvider.symbolsUrl,streamingAssetsUrl:f.unityProvider.streamingAssetsUrl,devicePixelRatio:f.devicePixelRatio,webglContextAttributes:f.unityProvider.webglContextAttributes,cacheControl:f.unityProvider.cacheControl,autoSyncPersistentDataPath:f.unityProvider.autoSyncPersistentDataPath,matchWebGLToCanvasSize:f.matchWebGLToCanvasSize,disabledCanvasEvents:f.disabledCanvasEvents},Object.keys(oe).forEach(function(he){(oe[he]===null||oe[he]===void 0)&&delete oe[he]}),ie.label=1;case 1:return ie.trys.push([1,3,,4]),[4,window.createUnityInstance(b,oe,K)];case 2:return ge=ie.sent(),M(ge),f.unityProvider.setUnityInstance(ge),[3,4];case 3:return X=ie.sent(),console.error("React Unity WebGL: Error initializing Unity instance:",X),f.unityProvider.setInitialisationError(X),[3,4];case 4:return[2]}})})},ce=function(){return n(void 0,void 0,void 0,function(){var oe,ge,X;return t(this,function(J){switch(J.label){case 0:return!k||!b?[2]:(console.log("React Unity WebGL: Detaching Unity instance..."),f.unityProvider.setUnityInstance(null),M(null),f.unityProvider.setLoadingProgression(0),(X=(ge=f.unityProvider).setIsLoaded)===null||X===void 0||X.call(ge,!1),f.unityProvider.setInitialisationError(void 0),oe=document.createElement("canvas"),oe.id=b.id,oe.setAttribute("react-unity-webgl-role","cleanup"),oe.style.display="none",document.body.appendChild(oe),k.Module.canvas=oe,M(null),[4,k.Quit()]);case 1:return J.sent(),document.body.removeChild(oe),[2]}})})};return ne(),function(){ce()}},[b,k,Y,f.unityProvider]),(0,i.useImperativeHandle)(y,function(){return b}),(0,i.createElement)("canvas",{ref:R,id:j,style:f.style,className:f.className,tabIndex:f.tabIndex})});return vf.Unity=d,vf}var jT={},my={},wQ;function Cze(){if(wQ)return my;wQ=1;var n=my&&my.__spreadArray||function(f,y,v){if(v||arguments.length===2)for(var b=0,R=y.length,I;b<R;b++)(I||!(b in y))&&(I||(I=Array.prototype.slice.call(y,0,b)),I[b]=y[b]);return f.concat(I||Array.prototype.slice.call(y))};Object.defineProperty(my,"__esModule",{value:!0}),my.useEventSystem=void 0;var t=Hf(),i=zoe(),a=[],l=function(f){for(var y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];var b=void 0;return a.forEach(function(R){b=R.apply(void 0,n([f],y,!1))}),b};i.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=l);var d=function(){var f=(0,t.useRef)([]),y=(0,t.useCallback)(function(R,I){f.current=n(n([],f.current,!0),[{eventName:R,callback:I}],!1)},[f]),v=(0,t.useCallback)(function(R,I){f.current=f.current.filter(function(k){return k.eventName!==R&&k.callback!==I})},[f]),b=(0,t.useCallback)(function(R){for(var I=[],k=1;k<arguments.length;k++)I[k-1]=arguments[k];var M=f.current.find(function(L){return L.eventName===R});if(!(typeof M>"u"))return M.callback.apply(M,I)},[f]);return(0,t.useEffect)(function(){return a.push(b),function(){a.splice(a.indexOf(b),1)}},[b]),{addEventListener:y,removeEventListener:v}};return my.useEventSystem=d,my}var TQ;function Ize(){if(TQ)return jT;TQ=1,Object.defineProperty(jT,"__esModule",{value:!0}),jT.useUnityContext=void 0;var n=Hf(),t=Cze(),i=function(a){var l=(0,n.useState)(null),d=l[0],f=l[1],y=(0,n.useState)(0),v=y[0],b=y[1],R=(0,n.useState)(!1),I=R[0],k=R[1],M=(0,n.useState)(),L=M[0],j=M[1],z=(0,t.useEventSystem)(),Y=(0,n.useRef)({companyName:a.companyName,productName:a.productName,productVersion:a.productVersion,codeUrl:a.codeUrl,dataUrl:a.dataUrl,frameworkUrl:a.frameworkUrl,loaderUrl:a.loaderUrl,memoryUrl:a.memoryUrl,symbolsUrl:a.symbolsUrl,streamingAssetsUrl:a.streamingAssetsUrl,workerUrl:a.workerUrl,webglContextAttributes:a.webglContextAttributes,cacheControl:a.cacheControl,autoSyncPersistentDataPath:a.autoSyncPersistentDataPath,setUnityInstance:f,setLoadingProgression:b,setIsLoaded:k,setInitialisationError:j}),K=(0,n.useCallback)(function(J){return d==null?void 0:d.SetFullscreen(J?1:0)},[d]),ne=(0,n.useCallback)(function(){var J;return(J=d==null?void 0:d.Module.canvas)===null||J===void 0?void 0:J.requestPointerLock()},[d]),ce=(0,n.useCallback)(function(J,te,ie){return d==null?void 0:d.SendMessage(J,te,ie)},[d]),oe=(0,n.useCallback)(function(J,te){var ie;return(ie=d==null?void 0:d.Module.canvas)===null||ie===void 0?void 0:ie.toDataURL(J,te)},[d]),ge=(0,n.useCallback)(function(){var J;return(J=d==null?void 0:d.Quit())!==null&&J!==void 0?J:Promise.reject()},[d]),X=(0,n.useCallback)(function(){var J;return(J=d==null?void 0:d.GetMetricsInfo)===null||J===void 0?void 0:J.call(d)},[d]);return{unityProvider:Y.current,loadingProgression:v,isLoaded:I,initialisationError:L,requestFullscreen:K,requestPointerLock:ne,sendMessage:ce,takeScreenshot:oe,unload:ge,getMetricsInfo:X,addEventListener:z.addEventListener,removeEventListener:z.removeEventListener,UNSAFE__unityInstance:d}};return jT.useUnityContext=i,jT}var BT={},RQ;function Aze(){if(RQ)return BT;RQ=1,Object.defineProperty(BT,"__esModule",{value:!0}),BT.useUnityMetricsInfo=void 0;var n=Hf(),t=function(i,a){var l=(0,n.useState)({}),d=l[0],f=l[1];return(0,n.useEffect)(function(){var y=setInterval(function(){var v=i();typeof v>"u"||f(v)},a.interval||1e3);return function(){clearInterval(y)}},[i,a.interval]),d};return BT.useUnityMetricsInfo=t,BT}var CQ;function Pze(){return CQ||(CQ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityMetricsInfo=n.useUnityContext=n.Unity=void 0;var t=Rze();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return t.Unity}});var i=Ize();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}});var a=Aze();Object.defineProperty(n,"useUnityMetricsInfo",{enumerable:!0,get:function(){return a.useUnityMetricsInfo}})}(MU)),MU}var Woe=Pze();const Xd="[UnityProvider]",gF=N.createContext(),Oze=({spaceID:n,children:t,loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:y,showDisruptiveLogo:v})=>{G.log(`${Xd} Initializing with spaceID:`,n),G.log(`${Xd} Unity URLs:`,{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:R,isLoaded:I,sendMessage:k,addEventListener:M,removeEventListener:L,error:j}=Woe.useUnityContext({loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d}),z={unityProvider:b,loadingProgression:R,isLoaded:I,sendMessage:k,addEventListener:M,removeEventListener:L,error:j,spaceID:n},Y=N.useRef(null),K=N.useRef(Date.now());N.useEffect(()=>{const ge=()=>{document.hidden?(G.log(`${Xd} Page hidden, starting keep-alive`),ne()):(G.log(`${Xd} Page visible, stopping keep-alive`),ce())};return document.addEventListener("visibilitychange",ge),()=>{document.removeEventListener("visibilitychange",ge),ce()}},[]),N.useEffect(()=>{const ge=()=>{K.current=Date.now(),document.hidden&&k("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ge),window.addEventListener("keydown",ge),window.addEventListener("touchstart",ge),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("keydown",ge),window.removeEventListener("touchstart",ge)}},[k]);const ne=()=>{Y.current||(Y.current=setInterval(()=>{I&&document.hidden&&(k("WebGLInputManager","KeepAlive"),G.debug(`${Xd} Sent keep-alive message`))},1e4))},ce=()=>{Y.current&&(clearInterval(Y.current),Y.current=null)};N.useEffect(()=>(G.log(`${Xd} Component mounted`),()=>{G.log(`${Xd} Component unmounting`),ce()}),[]),N.useEffect(()=>{G.log(`${Xd} Loading progress:`,R)},[R]),N.useEffect(()=>{I&&(G.log(`${Xd} Unity instance loaded for:`,n),document.hidden&&ne())},[I,n]),N.useEffect(()=>{j&&G.error(`${Xd} Unity error:`,j)},[j]),G.log(`${Xd} Rendering provider with instance:`,z),N.useEffect(()=>{G.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d})},[i,a,l,d]);const oe=[];if(i||oe.push("loaderUrl"),a||oe.push("dataUrl"),l||oe.push("frameworkUrl"),d||oe.push("codeUrl"),oe.length>0)return G.error(`UnityProvider: Missing required Unity build URLs: ${oe.join(", ")}`),w.jsx(gF.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${oe.join(", ")}`),spaceID:n},children:t});try{return N.useEffect(()=>{G.log("UnityProvider: Unity context created:",b),b?G.log("UnityProvider: Unity provider is available"):G.error("UnityProvider: Unity provider is not available"),I?G.log("UnityProvider: Unity is loaded"):G.log("UnityProvider: Unity is not loaded yet")},[b,I]),w.jsx(gF.Provider,{value:z,children:t})}catch(ge){return G.error("UnityProvider: Error creating Unity context:",ge),w.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[w.jsx("h3",{children:"Unity Error"}),w.jsxs("p",{children:["Error creating Unity context: ",ge.message]}),w.jsx("p",{children:"Please check the console for more details."})]})}},Ro=()=>N.useContext(gF),dc=()=>{const{sendMessage:n,isLoaded:t}=Ro(),i=N.useRef([]),a=N.useCallback(()=>{if(t)for(;i.current.length>0;){const{eventName:d,data:f}=i.current.shift();G.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(y){G.error("useSendUnityEvent: Error sending event to Unity:",y),i.current.unshift({eventName:d,data:f});break}}},[n,t]);return N.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),N.useCallback((d,f)=>{G.log("useSendUnityEvent: Queuing event for Unity:",d),i.current.push({eventName:d,data:f}),a()},[a])},Lc=()=>{const{addEventListener:n,removeEventListener:t}=Ro();return N.useCallback((i,a)=>{const l=d=>{G.log(i+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(y){G.warn("Failed to parse JSON data from Unity message:",y)}a(f)};return n(i,l),()=>{t(i,l)}},[n,t])},Goe=()=>{const[n,t]=N.useState({}),[i,a]=N.useState(!1),[l,d]=N.useState(null),[f,y]=N.useState(0),v=dc(),b=Lc(),{spaceID:R,sendMessage:I,isLoaded:k}=Ro(),M=N.useCallback((Y,K)=>{if(!Y)return;G.log(`useHLSStream: Sending stream URL to Unity: ${Y} for player ${K}`);const ne={identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:Y};if(v("SetHLSStream",ne),k&&I)try{G.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(ne)})),G.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:Y})),G.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",Y),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:K.toString(),Url:Y}))}catch(ce){G.error("useHLSStream: Error with direct message:",ce)}else G.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,I,k]);N.useEffect(()=>{R&&L(R)},[R]);const L=async Y=>{try{if(!Y){G.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}a(!0),G.log(`useHLSStream: Loading stream from Firebase for space ${Y}`);const K=await Poe(Y);if(K&&K.streamUrl)if(G.log(`useHLSStream: Loaded stream data from Firebase for space ${Y}`,K),d(K),k)G.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{M(K.streamUrl,K.playerIndex||"0")},500),setTimeout(()=>{G.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),M(K.streamUrl,K.playerIndex||"0")},2e3);else{G.warn("useHLSStream: Unity is not loaded yet, will try again later");const ne=setInterval(()=>{k&&(G.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),M(K.streamUrl,K.playerIndex||"0"),clearInterval(ne))},1e3);setTimeout(()=>{clearInterval(ne)},3e4)}else G.log(`useHLSStream: No saved stream found for space ${Y}`),d(null)}catch(K){G.error(`useHLSStream: Error loading stream from Firebase for space ${Y}`,K)}finally{a(!1)}},j=N.useCallback(async()=>{R&&(G.log(`useHLSStream: Forcing reload of stream data for space ${R}`),y(Y=>Y+1),await L(R))},[R]),z=N.useCallback(async(Y,K=0,ne={})=>{try{if(!Y||!Y.trim()){G.error("useHLSStream: Invalid stream URL");return}a(!0),G.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${K}]`,Y);const{enabled:ce=!0,rtmpUrl:oe="",streamKey:ge="",skipSendToUnity:X=!1}=ne;if(X||M(Y,K),R)try{const J={streamUrl:Y,playerIndex:K.toString(),enabled:ce,rtmpUrl:oe,streamKey:ge,updatedAt:new Date().toISOString()};G.log(`useHLSStream: Saving stream URL to Firebase for space ${R}`,J),await lF(R,J),d(J)}catch(J){throw G.error(`useHLSStream: Error saving stream URL to Firebase for space ${R}`,J),J}else G.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{a(!1)}},[M,R]);return N.useEffect(()=>{const K=b("SetHLSStream",ne=>{if(ne)try{G.log("useHLSStream: Received player status update",ne);const{identifier:ce,playerIndex:oe,isReady:ge,isPlaying:X}=ne,J=`${ce}_${oe}`;t(te=>({...te,[J]:{identifier:ce,playerIndex:oe,isReady:ge,isPlaying:X}}))}catch(ce){G.error("useHLSStream: Error handling player status update",ce)}});return()=>{K()}},[b]),N.useEffect(()=>{if(l&&l.streamUrl){G.log("useHLSStream: Resending saved stream URL to Unity");const Y=setTimeout(()=>{M(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(Y)}},[l,n,M,f]),N.useEffect(()=>{const Y=K=>{if(K.detail){if(G.log("useHLSStream: Received stream update event",K.detail),R===K.detail.spaceId)G.log(`useHLSStream: Stream update is for our space ${R}, loading stream data`),L(R);else if(K.detail.streamUrl){G.log(`useHLSStream: Using stream URL directly from event: ${K.detail.streamUrl}`);const ne=K.detail.playerIndex||"0";M(K.detail.streamUrl,ne),d(K.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",Y),window.addEventListener("SpaceStreamUpdated",Y),()=>{window.removeEventListener("SpaceHLSStreamUpdated",Y),window.removeEventListener("SpaceStreamUpdated",Y)}},[R,M]),{setHLSStreamUrl:z,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:j}},kze=()=>{const[n,t]=N.useState(!1),i=Lc();return N.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{G.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[i]),n},Nze=()=>{const[n,t]=N.useState(null),i=Lc();return console.log(" Nameplate click hook initialized"),N.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=i("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const y=typeof f=="string"?JSON.parse(f):f;t({playerName:y.playerName,playerId:y.playerId,uid:y.uid,isLocalPlayer:y.isLocalPlayer}),console.log(" Processed nameplate data:",y)}catch(y){console.error(" Error processing nameplate data:",y)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),t(null)}]},Dze=()=>{const n=Lc(),{sendUserToUnity:t}=N.useContext(Hs);return N.useEffect(()=>{const a=n("RequestUserForUnity",async()=>{G.log("React: Request from Unity to send user data"),await t()});return()=>{a()}},[n,t]),!0},IQ=async(n,t,i,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!n||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const v=sE(),b=Date.now(),R=i.name.split(".").pop(),I=`${t}_${b}.${R}`,k=iE(v,`spaces/${n}/mediaScreens/${I}`);G.log(`Uploading image for media screen ${t} in space ${n}`);const M=await o3(k,i);y=await AN(M.ref);const L=Ir(ir,`spaces/${n}/mediaScreens`,t);await Lg(L,{imageUrl:y,gsUrl:`gs://${M.ref.bucket}/${M.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){y=f;const v=Ir(ir,`spaces/${n}/mediaScreens`,t);await Lg(v,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return G.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),y}catch(l){throw G.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},p3=async n=>{G.log(`Getting media screen images for space: ${n}`);try{const t=nu(ir,`spaces/${n}/mediaScreens`),i=await Zu(t),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw G.error("Error fetching media screen images from Firestore:",t),t}},Xy=async(n,t)=>{try{const i=Ir(ir,`spaces/${n}/mediaScreens`,t),a=await Ho(i);return a.exists()?{id:a.id,...a.data()}:(G.warn(`No media screen found with ID: ${t}`),null)}catch(i){throw G.error("Error fetching media screen image:",i),i}},xze=async(n,t)=>{try{const i=await Xy(n,t);if(!i)return G.warn(`No media screen found with ID: ${t} to delete`),!1;if(i.gsUrl){const l=sE(),d=iE(l,i.gsUrl);try{await a3(d),G.log(`Deleted file from storage: ${i.gsUrl}`)}catch(f){G.warn(`Could not delete file from storage: ${f.message}`)}}const a=Ir(ir,`spaces/${n}/mediaScreens`,t);return i.mediaType==="video"?(await $o(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),G.log(`Successfully removed video for media screen ${t}`)):(await $o(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),G.log(`Successfully removed image for media screen ${t}`)),!0}catch(i){throw G.error("Error deleting media screen image:",i),i}},Lze=async(n,t,i)=>{try{if(!n||!t||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const a=await Xy(n,t);if(!a||!a.imageUrl&&!a.videoUrl)return G.warn(`No media screen content found with ID: ${t} to update`),!1;const l=Ir(ir,`spaces/${n}/mediaScreens`,t);return await $o(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),G.log(`Successfully updated display mode for media screen ${t} to ${i?"video":"image"}`),!0}catch(a){throw G.error("Error updating media screen display mode:",a),a}},Mze=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),i=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",i&&t.searchParams.set("alt",i),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},Hoe=()=>{const{spaceID:n}=Ro(),t=dc(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){G.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{G.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){G.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}G.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await p3(n);G.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:y,imageUrl:v,displayAsVideo:b,videoUrl:R}=f;let I=null;(!b||!R)&&(I=v?Mze(v):null),t("SetMediaScreenImage",{mediaScreenId:y,imageUrl:I,videoUrl:R||null,displayAsVideo:b||!1,timestamp:Date.now()}),G.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${b})`),b&&R&&(t("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:R,timestamp:Date.now()}),G.log(`Set display mode to video for screen ${y}`))})}catch(d){G.error("Error fetching media screen images:",d)}})()},[t,n,i])},Uze=()=>{const{spaceID:n}=Ro(),t=dc(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){G.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{G.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){G.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}G.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await Aoe(n),f=async b=>{const R=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(R);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const k=await I.json(),M=k.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let j=null;for(let z of L){const Y=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${M}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Y,{method:"HEAD"})).ok){j=Y;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${Y}`,K)}}return j||k.thumbnail_url},y=d.map(async b=>{const R=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:R}}),v=await Promise.all(y);G.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:R})=>{t("SetThumbnail",{gameObjectName:b,thumbnailUrl:R})})}catch(d){G.error("Error fetching thumbnails:",d)}})()},[t,n,i])},$oe=()=>{const[n,t]=N.useState([]),i=Lc();return N.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(G.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=M=>{if(a){G.log("UpdatePlayerList unity message received.");try{let L=[];if(typeof M=="object"&&M!==null?L=M.players||[]:L=JSON.parse(M).players||[],Array.isArray(L)){const j=Array.from(new Map(L.map(z=>[z.playerId,z])).values());t(j),l&&(clearTimeout(l),l=null)}}catch(L){G.error("Error handling player list data:",L),l||(l=setTimeout(d,1e3))}}},y=()=>{G.log("Player disconnected, requesting fresh player list"),d()},v=()=>{G.log("Player left, requesting fresh player list"),d()};d();const b=i("UpdatePlayerList",f),R=i("PlayerDisconnected",y),I=i("PlayerLeft",v),k=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof R=="function"&&R(),typeof I=="function"&&I(),clearInterval(k)}},[i]),n},Koe=()=>{const n=dc(),t=N.useCallback((a,l,d,f,y,v)=>{const b=d||{x:0,y:1.5,z:0},R=f||{x:0,y:0,z:0},I=y||{x:1,y:1,z:1};try{const k={portalId:a,prefabName:l||"PortalObjectPrefab",position:b,rotation:R,scale:I,initialImageUrl:v};return G.log("Sending portal placement to Unity:",k),n("PlacePortalPrefab",k),!0}catch(k){return G.error("Error placing portal:",k),!1}},[n]),i=N.useCallback((a,l,d,f,y,v)=>{const b=d||{x:0,y:1.5,z:0},R=f||{x:0,y:0,z:0},I=y||{x:1,y:1,z:1};try{const k={portalId:a,prefabName:l||"PortalObjectPrefab",position:b,rotation:R,scale:I,initialImageUrl:v},M={eventName:"PlacePortalPrefab",data:JSON.stringify(k)};return G.log("Directly sending portal placement to Unity:",k),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(M)),!0}catch(k){return G.error("Error directly placing portal:",k),!1}},[]);return{placePortal:t,directPlacePortal:i,isUnityLoaded:!0}},qoe=()=>{const n=dc(),t=N.useCallback((a,l,d,f,y)=>{const v=d||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const I={hotspotId:a,glbUrl:l,position:v,rotation:b,scale:R};return G.log("Sending seating hotspot placement to Unity:",I),n("SeatingHotspot",I),!0}catch(I){return G.error("Error placing seating hotspot:",I),!1}},[n]),i=N.useCallback((a,l,d,f,y)=>{const v=d||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const I={hotspotId:a,glbUrl:l,position:v,rotation:b,scale:R},k={eventName:"SeatingHotspot",data:JSON.stringify(I)};return G.log("Directly sending seating hotspot placement to Unity:",I),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(k)),!0}catch(I){return G.error("Error directly placing seating hotspot:",I),!1}},[]);return{placeCatalogueItem:t,directPlaceCatalogueItem:i,isUnityLoaded:!0}},Vze=J5(CN,"trackAnalytics"),Fze=J5(CN,"createAnalyticsSession"),jze=J5(CN,"endAnalyticsSession"),Bze=async(n,t={})=>{try{G.log(`Creating secure analytics session for space ${n}`);const i=await Fze({spaceId:n,sessionData:{userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",deviceType:typeof navigator<"u"&&/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop",sessionType:"webgl",startUrl:typeof window<"u"?window.location.href:"unknown",referrer:typeof document<"u"?document.referrer:"unknown",...t}});return G.log(`Secure analytics session created: ${i.data.sessionId}`),i.data.sessionId}catch(i){throw G.error("Error creating secure analytics session:",i),i}},zze=async(n,t,i,a={})=>{try{G.log(`Tracking secure analytics event: ${i} in space ${n}`);const l=await Vze({spaceId:n,sessionId:t,eventType:i,eventData:{...a,timestamp:new Date().toISOString(),clientSide:!0}});return G.log(`Secure analytics event tracked: ${i} (${l.data.eventId})`),l.data.eventId}catch(l){throw G.error("Error tracking secure analytics event:",l),l}},Wze=async(n,t)=>{try{if(G.log(`Ending secure analytics session: ${t} in space ${n}`),!n||!t)throw G.error("endAnalyticsSessionSecure: Missing required parameters",{spaceId:n,sessionId:t,spaceIdType:typeof n,sessionIdType:typeof t}),new Error(`Missing required parameters: spaceId=${n}, sessionId=${t}`);await jze({spaceId:n,sessionId:t}),G.log(`Secure analytics session ended: ${t}`)}catch(i){throw G.error("Error ending secure analytics session:",i),i}},ao={UNITY:{VIDEO_PLAY:"unity_video_play",VIDEO_PAUSE:"unity_video_pause",VIDEO_COMPLETE:"unity_video_complete",PORTAL_CLICK:"unity_portal_click",PORTAL_NAVIGATE:"unity_portal_navigate",MEDIA_SCREEN_CLICK:"unity_media_screen_click",NAMEPLATE_CLICK:"unity_nameplate_click",OBJECT_INTERACT:"unity_object_interact",PLAYER_MOVE:"unity_player_move",PLAYER_SPAWN:"unity_player_spawn",SPACE_LOAD:"unity_space_load",SPACE_READY:"unity_space_ready"},REACT:{MODAL_OPEN:"react_modal_open",MODAL_CLOSE:"react_modal_close",UI_CLICK:"react_ui_click",USER_LOGIN:"react_user_login",USER_LOGOUT:"react_user_logout",SPACE_ENTER:"react_space_enter",SPACE_EXIT:"react_space_exit",CHAT_MESSAGE:"react_chat_message",UPLOAD_START:"react_upload_start",UPLOAD_COMPLETE:"react_upload_complete",SETTINGS_CHANGE:"react_settings_change",VIDEO_CLICK:"react_video_click",VIDEO_CLOSE:"react_video_close",BUTTON_CLICK:"react_button_click",FORM_SUBMIT:"react_form_submit",ERROR_OCCURRED:"react_error_occurred"}},co={NAVIGATION:"navigation",MEDIA_INTERACTION:"media_interaction",SOCIAL_INTERACTION:"social_interaction",UI_INTERACTION:"ui_interaction",SYSTEM_EVENT:"system_event",USER_BEHAVIOR:"user_behavior",CONTENT_INTERACTION:"content_interaction",PERFORMANCE:"performance"},Gze=async(n,t,i={})=>{try{return G.log(`Creating secure analytics session for user ${t} in space ${n}`),await Bze(n,i)}catch(a){throw G.error("Error creating analytics session:",a),a}},aR=async(n,t,i,a={})=>{try{return G.log(`Tracking secure analytics event: ${i} in space ${n}`),await zze(n,t,i,a)}catch(l){throw G.error("Error tracking analytics event:",l),l}},AQ=async(n,t)=>{try{G.log(`Ending secure analytics session: ${t} in space ${n}`),await Wze(n,t)}catch(i){throw G.error("Error ending analytics session:",i),i}},Hze=async(n,t,i,a)=>aR(n,t,ao.UNITY.VIDEO_PLAY,{userId:i,category:co.MEDIA_INTERACTION,source:"unity",videoId:a.gameObjectName,videoUrl:a.videoUrl,spaceId:n,...a}),oE=(n,t={})=>{const{user:i}=N.useContext(Hs),a=N.useRef(null),[l,d]=N.useState(!1),[f,y]=N.useState(!1),v=N.useRef(!1),b=N.useRef(!1),R=N.useRef(!1),I=N.useRef(!1),{autoStart:k=!0,sessionMetadata:M={},enableDebugLogs:L=!1}=t;N.useEffect(()=>(i&&n&&k&&!a.current&&!R.current&&j(),()=>{a.current&&!I.current&&(L&&G.log("Component unmounting, ending analytics session"),z())}),[i,n,k,L]),N.useEffect(()=>{const X=()=>{document.hidden&&a.current&&!I.current&&(L&&G.log("Page hidden, ending analytics session"),z())},J=()=>{a.current&&!I.current&&(L&&G.log("Page unloading, ending analytics session"),z())};return document.addEventListener("visibilitychange",X),window.addEventListener("beforeunload",J),()=>{document.removeEventListener("visibilitychange",X),window.removeEventListener("beforeunload",J)}},[L]);const j=N.useCallback(async()=>{if(!i||!n||a.current||R.current){L&&G.log("Analytics session already initializing or initialized, skipping");return}try{R.current=!0,y(!0);const X=await Gze(n,i.uid,{unityVersion:window.unityVersion||"unknown",reactVersion:"18.x",startUrl:window.location.href,referrer:document.referrer,...M});a.current=X,d(!0),v.current?L&&G.log(" Analytics: Space entry already tracked for this session, skipping duplicate"):(await aR(n,X,ao.REACT.SPACE_ENTER,{userId:i.uid,category:co.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),v.current=!0,L&&G.log(` Analytics: Space entry tracked for session ${X}`)),L&&G.log(`Analytics session initialized: ${X} for space ${n}`)}catch(X){G.error("Failed to initialize analytics session:",X),y(!1)}finally{R.current=!1}},[i,n,M,L]),z=N.useCallback(async()=>{if(L&&G.log("endSession called with:",{sessionId:a.current,spaceId:n,sessionIdType:typeof a.current,spaceIdType:typeof n}),!a.current||!n){L&&G.log("endSession: Missing required parameters, skipping",{sessionId:a.current,spaceId:n});return}if(I.current){L&&G.log("endSession: Already ending session, skipping duplicate call");return}try{I.current=!0,b.current?L&&G.log(" Analytics: Space exit already tracked for this session, skipping duplicate"):(await aR(n,a.current,ao.REACT.SPACE_EXIT,{userId:i==null?void 0:i.uid,category:co.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),b.current=!0,L&&G.log(` Analytics: Space exit tracked for session ${a.current}`));const X=a.current;X&&n&&(await AQ(n,X),L&&G.log(`Analytics session ended: ${X}`)),a.current=null,d(!1),y(!1),v.current=!1,b.current=!1}catch(X){G.error("Failed to end analytics session:",X)}finally{I.current=!1}},[n,i==null?void 0:i.uid,L,aR,AQ]),Y=N.useCallback(async(X,J={})=>{if(!a.current||!n||!f)return L&&G.warn("Cannot track event: No active analytics session"),null;try{const te=await aR(n,a.current,X,{userId:i==null?void 0:i.uid,spaceId:n,timestamp:new Date().toISOString(),...J});return L&&G.log(`Analytics event tracked: ${X}`,J),te}catch(te){return G.error("Failed to track analytics event:",te),null}},[n,i==null?void 0:i.uid,f,L]),K=N.useCallback(async X=>{if(!a.current||!n||!f)return L&&G.warn("Cannot track video play: No active analytics session"),null;try{const J=await Hze(n,a.current,i==null?void 0:i.uid,X);return L&&G.log("Video play event tracked:",X),J}catch(J){return G.error("Failed to track video play event:",J),null}},[n,i==null?void 0:i.uid,f,L]),ne=N.useCallback(async(X,J={})=>Y(X,{...J,source:"unity",category:J.category||co.USER_BEHAVIOR}),[Y]),ce=N.useCallback(async(X,J={})=>Y(X,{...J,source:"react",category:J.category||co.UI_INTERACTION}),[Y]),oe=N.useCallback(async(X,J,te={})=>{const ie=X==="open"?ao.REACT.MODAL_OPEN:ao.REACT.MODAL_CLOSE;return ce(ie,{modalName:J,action:X,category:co.UI_INTERACTION,...te})},[ce]),ge=N.useCallback(async()=>{a.current&&await z(),await j()},[z,j]);return{isInitialized:l,isTracking:f,sessionId:a.current,track:Y,trackVideoPlay:K,trackUnityEvent:ne,trackReactEvent:ce,trackModal:oe,initializeSession:j,endSession:z,restartSession:ge,isReady:l&&f&&a.current!==null}},$ze=n=>{const[t,i]=N.useState(null),{user:a}=N.useContext(Hs),l=Lc(),{spaceID:d}=Ro(),{trackUnityEvent:f,isReady:y}=oE(d,{enableDebugLogs:!0});return N.useEffect(()=>{let b=!0;const I=l("PlayVideo",async k=>{try{const{gameObjectName:M}=k;if(!M){G.error("Game object name is missing in Unity event data.");return}const L=await Aoe(d);G.log("SPACES VIDEOS",L);const j=L.find(z=>z.id===M);j&&b?(i(j.url),G.log("Video URL set to:",j.url),y&&a&&(f(ao.UNITY.VIDEO_PLAY,{category:co.MEDIA_INTERACTION,videoId:M,videoUrl:j.url,videoTitle:j.title||j.name||M,isEditMode:!1,spaceId:d,timestamp:new Date().toISOString(),videoData:{gameObjectName:M,videoMetadata:j}}),G.log(" Analytics: Video play event tracked for:",M))):console.error("Video not found for game object:",M)}catch(M){console.error("Error fetching space videos:",M)}});return()=>{b=!1,I()}},[l,d,n]),[t,()=>{i(null)}]},Kze=()=>{const[n,t]=N.useState(null),[i,a]=N.useState(!1),[l,d]=N.useState(null),f=Lc(),y=dc();N.useEffect(()=>f("KickPlayerResult",I=>{G.log("KickPlayerResult event received:",I),I?(t(I),a(!1),I.success?d(null):d(I.errorMessage||"Failed to kick player")):(G.error("Invalid KickPlayerResult data from Unity"),d("Invalid result from Unity"),a(!1))}),[f]);const v=N.useCallback((R,I)=>{var k;try{if(!R){d("Player UID is required");return}a(!0),d(null),t(null);const M={uid:R,requestedBy:I||((k=window.currentUser)==null?void 0:k.uid)};G.log("Sending KickPlayer event to Unity:",M),y("KickPlayer",M)}catch(M){G.error("Error kicking player:",M),d(M.message||"Failed to send kick request"),a(!1)}},[y]),b=N.useCallback(()=>{t(null),d(null),a(!1)},[]);return{kickPlayer:v,isKicking:i,kickResult:n,error:l,resetKickState:b}},qze=n=>{const{placePortal:t}=Koe();N.useEffect(()=>{const i=async()=>{try{const a=nu(ir,"spaces",n,"portals"),l=await Zu(a);if(l.empty){G.log("useSpacePortals: No portals found for space:",n);return}G.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(d=>{const f=d.data();G.log(`useSpacePortals: Placing portal ${f.portalId} in Unity:`,f),t(f.portalId,f.prefabName,f.position,f.rotation,f.scale)})}catch(a){G.error("useSpacePortals: Error loading portals:",a)}};if(window.unityInstance)G.log("useSpacePortals: Unity is ready, loading portals"),i();else{const a=()=>{G.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",a),()=>{window.removeEventListener("PlayerInstantiated",a)}}},[n,t])},Yoe=async(n,t)=>{console.log(" fetchPortalAnalyticsData called with:",{spaceId:n,portalId:t});let i=null,a=null;try{if(!n||!t)throw new Error(`Invalid parameters: spaceId=${n}, portalId=${t}`);const d=Ir(ir,"spaces",n,"portals",t);console.log(" Querying Firestore path:",`spaces/${n}/portals/${t}`);const f=await Ho(d);if(f.exists()){const y=f.data();i=y.targetSpaceId,a=y.targetSpaceName,console.log(" Portal data fetched from Firestore:",{targetSpaceId:i,targetSpaceName:a})}else{console.warn(" Portal document not found in Firestore for:",t);const y=t.split("_");y.length>=3&&(i=y[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}}catch(d){console.error(" Error fetching portal data from Firestore:",d);const f=t.split("_");f.length>=3&&(i=f[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}const l={targetSpaceId:i,targetSpaceName:a};return console.log(" fetchPortalAnalyticsData returning:",l),l},Yze=()=>{const[n,t]=N.useState(null),{user:i}=N.useContext(Hs),a=Lc(),{spaceID:l}=Ro(),{trackUnityEvent:d,isReady:f}=oE(l,{enableDebugLogs:!0});return N.useEffect(()=>{console.log("Setting up portal click listener...");const b=a("PortalClicked",async R=>{console.log("Portal click event received:",R);try{const I=typeof R=="string"?JSON.parse(R):R;if(console.log("Parsed portal data:",I),t(I),f&&i&&I&&I.portalId)try{const{targetSpaceId:k,targetSpaceName:M}=await Yoe(l,I.portalId);await d(ao.UNITY.PORTAL_CLICK,{category:co.NAVIGATION,portalId:I.portalId,targetSpaceId:k,targetSpaceName:M,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked for:",I.portalId,"targeting:",M||k)}catch(k){console.error(" Analytics: Error tracking portal click:",k);try{await d(ao.UNITY.PORTAL_CLICK,{category:co.NAVIGATION,portalId:I.portalId,targetSpaceId:null,targetSpaceName:null,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked (fallback) for:",I.portalId)}catch(M){console.error(" Analytics: Failed to track portal click even with fallback:",M)}}}catch(I){console.error("Error parsing portal click data:",I,"Data:",R)}});return()=>{console.log("Cleaning up portal click listener"),typeof b=="function"&&b()}},[a,f,i,l,d]),{clickedPortal:n,clearClickedPortal:()=>{console.log("Clearing clicked portal state"),t(null)},isAnalyticsReady:f,trackPortalClick:d}},Xze=()=>{const{user:n}=N.useContext(Hs),t=Lc(),{spaceID:i}=Ro(),{trackUnityEvent:a,isReady:l}=oE(i,{enableDebugLogs:!0});N.useEffect(()=>{console.log("Setting up portal navigation listener...");const f=t("PortalNavigate",async y=>{console.log(" PORTAL CLICKED BY PLAYER (non-edit mode)");try{const v=typeof y=="string"?JSON.parse(y):y;if(console.log("Portal data:",v),!v.portalId){console.error("Portal ID is missing from portal data");return}let b=null,R=null;try{const I=await Yoe(i,v.portalId);b=I.targetSpaceId,R=I.targetSpaceName}catch(I){console.error("Error fetching portal analytics data:",I);const k=v.portalId.split("_");k.length>=3&&(b=k[2])}if(b){if(console.log("Navigating to space:",b,`(${R||"Unknown space name"})`),l&&n&&v)try{await a(ao.UNITY.PORTAL_NAVIGATE,{category:co.NAVIGATION,portalId:v.portalId,targetSpaceId:b,targetSpaceName:R,sourceSpaceId:i,isEditMode:!1,navigationType:"direct",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",v.portalId,"",R||b)}catch(I){console.error(" Analytics: Error tracking portal navigation:",I)}window.location.href=`/?spaceId=${b}`}else console.error("Could not determine target space ID from portal:",v.portalId)}catch(v){console.error("Error handling portal navigation:",v)}});return()=>{console.log("Cleaning up portal navigation listener"),typeof f=="function"&&f()}},[t,l,n,i,a])},Jze=n=>{const{placeCatalogueItem:t}=qoe();N.useEffect(()=>{const i=async()=>{try{const a=nu(ir,"spaces",n,"catalogue"),l=await Zu(a);if(l.empty){G.log("useSpaceCatalogueItems: No catalogue items found for space:",n);return}G.log(`useSpaceCatalogueItems: Found ${l.size} items for space ${n}`),l.forEach(d=>{const f=d.data();G.log(`useSpaceCatalogueItems: Placing item ${f.itemId} in Unity:`,f),t(f.itemId,f.glbUrl,f.position,f.rotation,f.scale)})}catch(a){G.error("useSpaceCatalogueItems: Error loading catalogue items:",a)}};if(window.unityInstance)G.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),i();else{const a=()=>{G.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),i()};return window.addEventListener("PlayerInstantiated",a),()=>{window.removeEventListener("PlayerInstantiated",a)}}},[n,t])},Xoe=()=>{const[n,t]=N.useState(null),i=Lc();return N.useEffect(()=>{G.log("Setting up seating hotspot click listener...");const d=i("SeatingHotspotClicked",async f=>{G.log(" Seating hotspot click event received from Unity:",f);try{const y=typeof f=="string"?JSON.parse(f):f;G.log(" Parsed Unity click data:",y);const v=y.hotspotId.split("_");if(v.length>=3){const b=v.slice(1,-1).join("_");G.log(" Extracted spaceId:",b);const R=Ir(ir,"spaces",b,"catalogue",y.hotspotId);G.log(" Fetching from Firebase path:",`spaces/${b}/catalogue/${y.hotspotId}`);const I=await Ho(R);if(I.exists()){const k=I.data();G.log(" Fetched Firebase data:",k),G.log(" Firebase position:",k.position),G.log(" Unity position:",y.position);const M={...y,position:k.position||y.position,rotation:k.rotation||y.rotation,scale:k.scale||y.scale};G.log(" Combined data being set:",M),t(M)}else G.warn(" Item not found in Firebase:",y.hotspotId),t(y)}else G.error(" Invalid hotspot ID format:",y.hotspotId),t(y)}catch(y){G.error(" Error handling seating hotspot click:",y,"Data:",f)}});return()=>{G.log("Cleaning up seating hotspot click listener"),typeof d=="function"&&d()}},[i]),{clickedItem:n,clearClickedItem:()=>{G.log("Clearing clicked item state"),t(null)}}},Qze=n=>({opacity:1});function Zze(){const{loadingProgression:n,isLoaded:t,error:i,spaceID:a}=Ro(),{user:l}=N.useContext(Hs),[d,f]=N.useState(!1),[y,v]=N.useState(!1),[b,R]=N.useState(!1),[I,k]=N.useState(!1),M=N.useRef(!1),L=N.useRef(!1),j=N.useRef(null),z=N.useRef(null),Y=N.useRef(null),K=Lc(),ne=N.useRef(null),ce=N.useRef(null),oe=N.useRef(null);N.useRef(null),N.useEffect(()=>{(async()=>{if(!l&&n===0)try{const te=await Ma(a);te&&te.allowGuestUsers===!0?(console.log("LoaderProgress: Guest users confirmed allowed, not showing sign-in prompt"),f(!1)):(console.log("LoaderProgress: Guest users not allowed or space data invalid, showing sign-in prompt"),f(!0))}catch(te){console.error("LoaderProgress: Cannot verify space guest access, showing sign-in prompt for security:",te),f(!0)}else f(!1)})()},[l,n,a]),N.useEffect(()=>{const J=document.createElement("style");return J.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(J),ne.current=J,()=>{ne.current&&document.head.removeChild(ne.current)}},[]),N.useEffect(()=>{const J=()=>{const te=document.getElementById("unity-canvas"),ie=document.getElementById("unity-container");te&&(j.current=te,te.style.zIndex="1"),ie&&(z.current=ie,ie.style.zIndex="1"),te&&ie&&oe.current&&(clearInterval(oe.current),oe.current=null)};return J(),oe.current=setInterval(J,100),()=>{oe.current&&(clearInterval(oe.current),oe.current=null)}},[]),N.useEffect(()=>{window.isFirstSceneLoaded&&(L.current=!0,k(!0));const te=K("FirstSceneLoaded",()=>{L.current=!0,k(!0),window.isFirstSceneLoaded=!0}),ie=setTimeout(()=>{L.current||(L.current=!0,k(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{te(),clearTimeout(ie)}},[K]),N.useEffect(()=>{window.isPlayerInstantiated&&(M.current=!0,R(!0),L.current||(L.current=!0,k(!0),window.isFirstSceneLoaded=!0));const J=()=>{M.current=!0,R(!0),L.current||(L.current=!0,k(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",J);const te=K("PlayerInstantiated",J),ie=setTimeout(()=>{M.current||(M.current=!0,R(!0),L.current||(L.current=!0,k(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",J),te(),clearTimeout(ie)}},[K]),N.useEffect(()=>(I&&b&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{j.current&&(j.current.style.opacity="1",j.current.style.removeProperty("opacity")),z.current&&(z.current.style.opacity="1",z.current.style.removeProperty("opacity")),Y.current&&(Y.current.style.opacity="0",Y.current.style.pointerEvents="none",setTimeout(()=>{Y.current&&(Y.current.style.display="none")},1500))},2e3)),()=>{ce.current&&clearTimeout(ce.current)}),[I,b]);const ge=()=>t?t&&!I&&!b?"Scene initializing":I&&!b?"Player initializing":"Ready":"World loading",X=()=>t?t&&!I&&!b?85:I&&!b?95:100:n*80;return w.jsx(w.Fragment,{children:d?w.jsx(ht,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:w.jsxs(qr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[w.jsx(it,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),w.jsx(it,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),w.jsx($n,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>v(!0),children:"Sign In"})]})}):w.jsx(ht,{ref:Y,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:w.jsxs(Bi,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[w.jsx(it,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),w.jsx(it,{fontSize:"sm",children:ge()}),w.jsx(Uy,{value:X(),size:"lg",width:"100%",marginY:2})]})})})}function Joe({mode:n="button",label:t="Sign Out"}){const i=uc(),{signOut:a}=N.useContext(Hs),{fullscreenRef:l}=hh(),d=async()=>{try{await a(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?w.jsx(Xl,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return w.jsx(w.Fragment,{children:f})}Joe.propTypes={mode:Pn.oneOf(["button","link"]),label:Pn.string};function eWe(){const{user:n,currentUser:t,isGuestUser:i}=N.useContext(Hs),[a,l]=N.useState(!1),[d,f]=N.useState(!1),[y,v]=N.useState(!0),[b,R]=N.useState(null);return N.useEffect(()=>{const k=(()=>{try{const M=document.getElementById("webgl-root");if(M){const K=M.getAttribute("data-space-id");if(K)return console.log("AuthenticationButton: Found space ID from webgl-root element:",K),K}const j=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(j)return console.log("AuthenticationButton: Found space ID from URL path:",j[2]),j[2];const z=new URLSearchParams(window.location.search),Y=z.get("spaceId")||z.get("space");return Y?(console.log("AuthenticationButton: Found space ID from URL params:",Y),Y):(console.log("AuthenticationButton: No space ID found in DOM or URL"),null)}catch(M){return console.error("AuthenticationButton: Error getting space ID:",M),null}})();console.log("AuthenticationButton: Setting space ID to:",k),R(k)},[]),N.useEffect(()=>{const I=async()=>{if(!b){console.log("AuthenticationButton: No space ID available, skipping guest access check");return}console.log("AuthenticationButton: Fetching space data for space ID:",b);try{const M=await Ma(b);console.log("AuthenticationButton: Raw space data received:",M),console.log("AuthenticationButton: Space data loaded:",{spaceId:b,allowGuestUsers:M==null?void 0:M.allowGuestUsers,hideGuestSignInButton:M==null?void 0:M.hideGuestSignInButton,showAuthButton:M==null?void 0:M.showAuthButton}),l((M==null?void 0:M.allowGuestUsers)||!1),f((M==null?void 0:M.hideGuestSignInButton)||!1),v((M==null?void 0:M.showAuthButton)!==void 0?M.showAuthButton:!0)}catch(M){console.error("AuthenticationButton: Error fetching space data:",M),console.log("AuthenticationButton: Cannot check guest access, defaulting to false"),l(!1),f(!1)}};I();const k=()=>{console.log("AuthenticationButton: Space settings changed, refreshing..."),I()};return window.addEventListener("SpaceSettingsChanged",k),()=>{window.removeEventListener("SpaceSettingsChanged",k)}},[b]),n&&t&&!i(t)?y?w.jsx("div",{children:w.jsx(Joe,{})}):null:t&&i(t)?(console.log("AuthenticationButton: Guest user detected, hideGuestSignInButton:",d),d?(console.log("AuthenticationButton: Hiding sign-in button for guest user"),null):(console.log("AuthenticationButton: Showing sign-in button for guest user"),w.jsx("div",{children:w.jsx(cC,{mode:"button",label:"Sign In",buttonProps:{bg:"black",color:"white",borderRadius:"lg",_hover:{bg:"gray.800"},_active:{bg:"gray.900"}}})}))):a||!y?null:w.jsxs("div",{children:[w.jsx(h3,{}),w.jsx(cC,{})]})}function tWe(){const{fullscreenRef:n}=hh(),[t,i]=N.useState(!1),a=()=>{i(!t)};return w.jsxs(w.Fragment,{children:[w.jsx(Nf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:w.jsx(kc,{"aria-label":"Controller Help",icon:w.jsx(vze,{}),onClick:a,variant:"iconButton"})}),w.jsxs(Rs,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:n},children:[w.jsx(As,{}),w.jsxs(Cs,{children:[w.jsx(To,{children:"Notes"}),w.jsx(zs,{}),w.jsx(Is,{children:w.jsx(it,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),w.jsx(oh,{children:w.jsx($n,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Qoe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},PQ=Ei.createContext&&Ei.createContext(Qoe),Rg=function(){return Rg=Object.assign||function(n){for(var t,i=1,a=arguments.length;i<a;i++){t=arguments[i];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])}return n},Rg.apply(this,arguments)},nWe=function(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i};function Zoe(n){return n&&n.map(function(t,i){return Ei.createElement(t.tag,Rg({key:i},t.attr),Zoe(t.child))})}function xr(n){return function(t){return Ei.createElement(rWe,Rg({attr:Rg({},n.attr)},t),Zoe(n.child))}}function rWe(n){var t=function(i){var a=n.attr,l=n.size,d=n.title,f=nWe(n,["attr","size","title"]),y=l||i.size||"1em",v;return i.className&&(v=i.className),n.className&&(v=(v?v+" ":"")+n.className),Ei.createElement("svg",Rg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,f,{className:v,style:Rg(Rg({color:n.color||i.color},i.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),d&&Ei.createElement("title",null,d),n.children)};return PQ!==void 0?Ei.createElement(PQ.Consumer,null,function(i){return t(i)}):t(Qoe)}function eae(n){return xr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function iWe(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function OQ(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function kQ(n){return xr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function _F(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function sWe(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z"}}]})(n)}function oWe(n){return xr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function aWe(n){return xr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function cWe(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function tae(n){return xr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function lWe(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function uWe(n){return xr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function nae(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function rae(n){return xr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function dWe(n){return xr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function hWe(n){return xr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function pWe(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function yF(n){return xr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function fWe(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function mWe(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function gWe(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function iae({open:n,onClose:t}){const i=N.useRef(null),a=dc(),{user:l}=N.useContext(Hs),d=v=>{i.current&&!i.current.contains(v.target)&&t()},f=async v=>{const b=y(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const R=b.data.url;if(console.log(`Avatar URL: ${R}`),a("AvatarUrlFromReact",{url:R}),l&&l.uid)try{await uoe(l.uid,R),t()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},y=v=>{try{return JSON.parse(v.data)}catch{return null}};return N.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[n]),n&&w.jsx(El,{children:w.jsx(ht,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:w.jsx(ht,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:w.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function _We({isOpen:n,onClose:t}){const[i,a]=N.useState(!1),[l,d]=N.useState(null),{user:f}=N.useContext(Hs),y=dc(),v=L=>{L.stopPropagation(),a(!0)},b=()=>{a(!1),t()},R=async L=>{if(d(L),f&&f.uid)try{await uoe(f.uid,L.url),y("AvatarUrlFromReact",{url:L.url}),t()}catch(j){console.error("Error updating RPM URL:",j)}else console.error("No authenticated user found to update rpmURL.")},I=_g("gray.200","whiteAlpha.300"),k="rgba(0, 0, 0, 0.3)",M=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return w.jsxs(w.Fragment,{children:[w.jsx(El,{children:w.jsxs(Rs,{isOpen:n,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),w.jsxs(Cs,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"900px",children:[w.jsx(To,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Customise Your Avatar"}),w.jsx(zs,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),w.jsx(Is,{pb:4,children:w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsx(it,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),w.jsxs(Nne,{columns:5,spacing:2,children:[w.jsx(ht,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:k},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:w.jsxs(qr,{spacing:1,children:[w.jsx(yn,{as:hWe,boxSize:4}),w.jsx(it,{fontSize:"xs",children:"Create Custom Avatar"})]})}),M.map(L=>w.jsxs(ht,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===L.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>R(L),_hover:{bg:k},transition:"all 0.2s",aspectRatio:"1",children:[w.jsx(yp,{src:L.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:L.name,width:"100%",height:"100%",objectFit:"cover"}),w.jsx(ht,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:w.jsx(it,{fontSize:"xs",children:L.name})})]},L.id))]})]})})]})]})}),i&&w.jsx(iae,{open:i,onClose:b})]})}function yWe(){const{fullscreenRef:n}=hh(),[t,i]=N.useState(!1),[a,l]=N.useState(!1),[d,f]=N.useState(!1),[y,v]=N.useState(!1),{user:b,currentUser:R,isGuestUser:I}=N.useContext(Hs),[k,M]=N.useState(null),[L,j]=N.useState(!0),z=(oe,ge)=>!oe||!ge?"?":`${oe.charAt(0)}${ge.charAt(0)}`.toUpperCase(),Y=oe=>{if(!oe)return"G";if(oe.startsWith("Visitor_")){const ge=oe.split("_")[1];return`V${ge?ge.charAt(0):""}`}return oe.charAt(0).toUpperCase()},K=async()=>{if(j(!0),b!=null&&b.uid)try{const oe=await ru(b.uid);M({rpmURL:oe.rpmURL?oe.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:oe.firstName,lastName:oe.lastName,isGuest:!1})}catch(oe){console.error("Error fetching profile data:",oe)}else R&&I(R)&&M({rpmURL:R.rpmURL?R.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:"Guest",lastName:"User",username:R.username||R.Nickname,isGuest:!0});j(!1)};N.useEffect(()=>{K()},[b==null?void 0:b.uid,R==null?void 0:R.uid,R==null?void 0:R.rpmURL]),N.useEffect(()=>{const oe=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",oe),()=>{window.removeEventListener("PlayerInstantiated",oe)}},[]);const ne=()=>l(!a),ce=()=>{l(!1),K()};return t?w.jsxs(w.Fragment,{children:[w.jsx(Nf,{label:k!=null&&k.isGuest?"Guest Avatar":"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:w.jsxs(ht,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:k!=null&&k.isGuest?"default":"pointer",onClick:k!=null&&k.isGuest?void 0:ne,children:[w.jsx(ih,{src:L||k==null?void 0:k.rpmURL,size:"md",borderRadius:"full",bg:"white",name:!L&&k?k.isGuest?Y(k.username):z(k.firstName,k.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&!(k!=null&&k.isGuest)&&w.jsx(ht,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:w.jsx(it,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),w.jsx(_We,{isOpen:a,onClose:ce})]}):null}function EWe(n){return xr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function vWe(n){return xr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function SWe(){const{isFullscreen:n,toggleFullscreen:t,fullscreenRef:i,isMobile:a}=hh(),l=uc();N.useEffect(()=>{const f=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{i.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return w.jsx(Nf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:w.jsx(kc,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?w.jsx(EWe,{}):w.jsx(vWe,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const NQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function bWe(){const{isOpen:n,onOpen:t,onClose:i}=sh(),{fullscreenRef:a}=hh(),[l,d]=$ze(!1),{user:f}=N.useContext(Hs),{spaceID:y}=Ro(),{trackReactEvent:v,isReady:b}=oE(y,{enableDebugLogs:!0});N.useEffect(()=>{G.log("VideoPlayer: Current video URL:",l),l&&(G.log("VideoPlayer: Opening modal for video URL:",l),t(),b&&f&&(v(ao.REACT.VIDEO_CLICK,{category:co.MEDIA_INTERACTION,action:"video_player_open",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),G.log(" Analytics: Video click event tracked for modal open:",l)))},[l,t,v,b,f,y]);const R=()=>{G.log("VideoPlayer: Closing modal"),b&&f&&l&&(v(ao.REACT.VIDEO_CLOSE,{category:co.MEDIA_INTERACTION,action:"video_player_close",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),G.log(" Analytics: Video close event tracked for modal close:",l)),d(),i()};return w.jsx(El,{containerRef:a,children:w.jsxs(Rs,{isOpen:n,onClose:R,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)"}),w.jsxs(Cs,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[w.jsx(zs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),w.jsx(Is,{p:0,width:"100%",children:l&&w.jsx(ht,{style:NQ.iframeContainer,children:w.jsx("iframe",{src:l,style:NQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function wWe({isOpen:n,onClose:t,playerName:i,playerId:a,uid:l}){const[d,f]=N.useState(null),[y,v]=N.useState(!0),[b,R]=N.useState(null);return N.useEffect(()=>{n&&(async()=>{if(v(!0),R(null),!l){G.warn("NameplateModal: No UID provided for player:",i),R("No user ID available for this player"),v(!1);return}try{G.log("NameplateModal: Fetching profile for UID:",l);const k=await ru(l);k?f({firstName:k.firstName,lastName:k.lastName,linkedinUrl:k.linkedinUrl,websiteUrl:k.websiteUrl,rpmURL:k.rpmURL?k.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):R("Could not find profile data for this player")}catch(k){G.error("Error fetching profile data:",k),R("Error loading profile data")}finally{v(!1)}})()},[l,n,i]),w.jsxs(Rs,{isOpen:n,onClose:t,isCentered:!0,size:"md",children:[w.jsx(As,{backdropFilter:"blur(10px)"}),w.jsxs(Cs,{bg:"gray.900",color:"white",borderRadius:"xl",children:[w.jsx(To,{children:"Player Info"}),w.jsx(zs,{}),w.jsx(Is,{pb:6,children:y?w.jsx(Jte,{py:8,children:w.jsx(uh,{size:"xl",color:"blue.400"})}):b?w.jsxs(Eg,{status:"warning",variant:"solid",borderRadius:"md",children:[w.jsx(vg,{}),b]}):w.jsxs(qr,{spacing:4,align:"center",children:[w.jsx(ih,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),w.jsxs(qr,{spacing:1,children:[w.jsx(it,{fontSize:"2xl",fontWeight:"bold",children:i}),(d==null?void 0:d.firstName)&&w.jsxs(it,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),w.jsxs(it,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&w.jsxs(w.Fragment,{children:[w.jsx(h0,{borderColor:"whiteAlpha.300"}),w.jsxs(jn,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&w.jsx(Xl,{href:d.linkedinUrl,isExternal:!0,children:w.jsx(kc,{icon:w.jsx(eae,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&w.jsx(Xl,{href:d.websiteUrl,isExternal:!0,children:w.jsx(kc,{icon:w.jsx(tae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const TWe=({isVisible:n,onToggleVisibility:t,spaceID:i})=>{const[a]=Cxe("(max-width: 768px)"),[l,d]=N.useState(!1);N.useEffect(()=>{d(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent||""))},[]);const f=a||l,y=$oe(),[v,b]=N.useState(!1),[R,I]=N.useState([]),[k,M]=N.useState(!1),[L,j]=N.useState({}),[z,Y]=N.useState({}),[K,ne]=N.useState(!1),ce=uc(),[oe,ge]=N.useState(null),[X,J]=N.useState(null),{isOpen:te,onOpen:ie,onClose:he}=sh(),[fe,de]=N.useState(null),{isOpen:ve,onOpen:Te,onClose:Fe}=sh(),[be,Ce]=N.useState(null),Ae=window.currentUser||{},Ee=i||window.spaceID||window.location.pathname.split("/").pop()||"fallback-space-id";N.useEffect(()=>{Ma(Ee).then(at=>ne(!!(at!=null&&at.voiceDisabled)))},[Ee]),N.useEffect(()=>{const at=()=>b(!0);return window.addEventListener("PlayerInstantiated",at),window.isPlayerInstantiated&&b(!0),()=>window.removeEventListener("PlayerInstantiated",at)},[]),N.useEffect(()=>{const at={};y.forEach(Vt=>{var rn;Vt.uid&&((rn=window.agoraClient)!=null&&rn.client)&&(at[Vt.uid]=Vt.isLocalPlayer?window.agoraClient.client.uid:Vt.uid)}),Y(at)},[y]),N.useEffect(()=>{const at=setInterval(()=>{var Vt;if(window.agoraClient){M(!!window.agoraClient.isVoiceEnabled);const rn={};(Vt=window.agoraClient.client)==null||Vt.remoteUsers.forEach(Ht=>{rn[Ht.uid]=!!Ht.audioTrack&&!Ht.audioTrack.muted}),j(rn)}},500);return()=>clearInterval(at)},[]),N.useEffect(()=>{(async()=>{const Vt=await Promise.all(y.map(async rn=>{var Ht,we;if(!rn.uid)return rn;try{const xe=await ru(rn.uid),$e=`space_${Ee}_owners`,Pt=`space_${Ee}_hosts`,It=(Ht=xe.groups)!=null&&Ht.includes($e)?"owner":(we=xe.groups)!=null&&we.includes(Pt)?"host":null,wt=xe.rpmURL?xe.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):void 0;return{...rn,...xe,rpmURL:wt,role:It}}catch{return rn}}));I(Vt)})()},[y,Ee]);const{kickPlayer:Ne,isKicking:je,kickResult:Ke,error:ot,resetKickState:_t}=Kze();N.useEffect(()=>{Ke!=null&&Ke.success&&(oe||be)&&(oe&&(ce({title:"Remove Successful",description:`${oe} has been removed.`,status:"success",duration:3e3,isClosable:!0}),ge(null)),be&&(ce({title:"Ban Successful",description:`${be} has been banned.`,status:"success",duration:3e3,isClosable:!0}),Ce(null)),_t()),ot&&(ce({title:"Error",description:ot,status:"error",duration:3e3,isClosable:!0}),ge(null),Ce(null),_t())},[Ke,ot,oe,be,ce,_t]);const lt=at=>at.isLocalPlayer||at.uid===Ae.uid,vt=at=>lt(at)?k:L[z[at.uid]],rt=({role:at})=>at==="owner"?w.jsx(yn,{as:_F,color:"green.400",boxSize:3,ml:1}):at==="host"?w.jsx(yn,{as:yF,color:"purple.400",boxSize:3,ml:1}):null,bt=({role:at})=>at==="owner"?w.jsxs(jn,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[w.jsx(yn,{as:_F,color:"green.300"}),w.jsx(Qd,{colorScheme:"green",variant:"solid",children:"Owner"})]}):at==="host"?w.jsxs(jn,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[w.jsx(yn,{as:yF,color:"purple.300"}),w.jsx(Qd,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null,$t=()=>{X&&(ge(X.playerName),Ne(X.uid,Ae.uid),he())},ut=async()=>{fe&&(Ce(fe.playerName),await C8e(Ee,{uid:fe.uid,playerName:fe.playerName,bannedAt:new Date().toISOString(),...Ae.uid&&{bannedBy:Ae.uid}}),Ne(fe.uid,Ae.uid),Fe())},mt=(at,Vt)=>{var Ht;if(!(((Ht=R.find(we=>we.isLocalPlayer))==null?void 0:Ht.role)==="owner"))return ce({title:"Permission Denied",status:"error",duration:3e3,isClosable:!0});at==="remove"?(J(Vt),ie()):at==="ban"&&(de(Vt),Te())};return w.jsxs(w.Fragment,{children:[w.jsxs(ht,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!f?"visible":"hidden",role:"group",children:[w.jsx(ht,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:w.jsx(kc,{icon:w.jsx(Eze,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:t})}),w.jsxs(it,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),w.jsx(ht,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:w.jsx(qr,{align:"stretch",spacing:1,width:"100%",children:R.sort((at,Vt)=>at.isLocalPlayer?-1:Vt.isLocalPlayer?1:0).map((at,Vt)=>{var xe;const rn=lt(at),Ht=((xe=R.find($e=>$e.isLocalPlayer))==null?void 0:xe.role)==="owner"&&!rn&&at.role!=="owner",we=!K&&vt(at);return w.jsx(ht,{children:w.jsxs(lre,{placement:"left",trigger:"hover",children:[w.jsx(fre,{children:w.jsxs(jn,{p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},children:[w.jsx(ih,{size:"xs",bg:"whiteAlpha.400",src:at.rpmURL,name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),w.jsx(it,{fontSize:"xs",children:at.playerName}),w.jsx(rt,{role:at.role}),w.jsx(ZS,{}),!K&&(we?w.jsx(ht,{color:"green.400",children:w.jsx(rae,{})}):w.jsx(ht,{color:"red.400",children:w.jsx(nae,{})})),rn?w.jsx(it,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):Ht?w.jsxs(Hk,{children:[w.jsx($k,{as:kc,"aria-label":"Options",icon:w.jsx(aWe,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),w.jsxs(Kk,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[w.jsx(QR,{icon:w.jsx(fWe,{}),onClick:()=>mt("remove",at),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"}),w.jsx(QR,{icon:w.jsx(iWe,{}),onClick:()=>mt("ban",at),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Ban"})]})]}):null]})}),w.jsx(pre,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",p:4,minW:"220px",children:w.jsx(dre,{children:w.jsxs(qr,{align:"center",spacing:3,children:[w.jsx(ih,{size:"lg",src:at.rpmURL}),w.jsx(it,{fontWeight:"bold",children:at.playerName}),w.jsx(bt,{role:at.role}),at.firstName&&w.jsxs(it,{fontSize:"sm",color:"gray.300",children:[at.firstName," ",at.lastName]}),w.jsxs(jn,{spacing:4,pt:2,children:[at.linkedInProfile&&w.jsx(Xl,{href:at.linkedInProfile,isExternal:!0,children:w.jsx(yn,{as:eae})}),at.websiteUrl&&w.jsx(Xl,{href:at.websiteUrl,isExternal:!0,children:w.jsx(yn,{as:tae})})]})]})})})]})},Vt)})})})]}),w.jsxs(Rs,{isOpen:te,onClose:he,isCentered:!0,children:[w.jsx(As,{}),w.jsxs(Cs,{bg:"gray.800",color:"white",children:[w.jsx(To,{children:"Confirm Removal"}),w.jsx(zs,{}),w.jsx(Is,{children:w.jsxs(it,{children:["Remove ",X==null?void 0:X.playerName," from the room?"]})}),w.jsxs(oh,{children:[w.jsx($n,{colorScheme:"red",onClick:$t,isLoading:je,mr:3,children:"Remove"}),w.jsx($n,{bg:"white",color:"gray.800",onClick:he,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]}),w.jsxs(Rs,{isOpen:ve,onClose:Fe,isCentered:!0,children:[w.jsx(As,{}),w.jsxs(Cs,{bg:"gray.800",color:"white",children:[w.jsx(To,{children:"Confirm Ban"}),w.jsx(zs,{}),w.jsx(Is,{children:w.jsxs(it,{children:["Ban ",fe==null?void 0:fe.playerName," from the room? They will not be able to re-enter."]})}),w.jsxs(oh,{children:[w.jsx($n,{colorScheme:"red",onClick:ut,isLoading:je,mr:3,children:"Ban"}),w.jsx($n,{bg:"white",color:"gray.800",onClick:Fe,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var DO={exports:{}},RWe=DO.exports,DQ;function CWe(){return DQ||(DQ=1,function(n,t){(function(i,a){n.exports=a()})(RWe,function(){function i(e,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Sy<"u"?Sy:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=f,v=Function.prototype,b=v.call,R=y&&v.bind.bind(b,b),I=y?R:function(e){return function(){return b.apply(e,arguments)}},k=I({}.isPrototypeOf),M=function(e){return e&&e.Math===Math&&e},L=M(typeof globalThis=="object"&&globalThis)||M(typeof window=="object"&&window)||M(typeof self=="object"&&self)||M(typeof a=="object"&&a)||M(typeof a=="object"&&a)||function(){return this}()||Function("return this")(),j=f,z=Function.prototype,Y=z.apply,K=z.call,ne=typeof Reflect=="object"&&Reflect.apply||(j?K.bind(Y):function(){return K.apply(Y,arguments)}),ce=I,oe=ce({}.toString),ge=ce("".slice),X=function(e){return ge(oe(e),8,-1)},J=X,te=I,ie=function(e){if(J(e)==="Function")return te(e)},he=typeof document=="object"&&document.all,fe=he===void 0&&he!==void 0?function(e){return typeof e=="function"||e===he}:function(e){return typeof e=="function"},de={},ve=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Te=f,Fe=Function.prototype.call,be=Te?Fe.bind(Fe):function(){return Fe.apply(Fe,arguments)},Ce={},Ae={}.propertyIsEnumerable,De=Object.getOwnPropertyDescriptor,Ee=De&&!Ae.call({1:2},1);Ce.f=Ee?function(e){var r=De(this,e);return!!r&&r.enumerable}:Ae;var Ne,je,Ke=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},ot=d,_t=X,lt=Object,vt=I("".split),rt=ot(function(){return!lt("z").propertyIsEnumerable(0)})?function(e){return _t(e)==="String"?vt(e,""):lt(e)}:lt,bt=function(e){return e==null},$t=bt,ut=TypeError,mt=function(e){if($t(e))throw new ut("Can't call method on "+e);return e},at=rt,Vt=mt,rn=function(e){return at(Vt(e))},Ht=fe,we=function(e){return typeof e=="object"?e!==null:Ht(e)},xe={},$e=xe,Pt=L,It=fe,wt=function(e){return It(e)?e:void 0},Mt=function(e,r){return arguments.length<2?wt($e[e])||wt(Pt[e]):$e[e]&&$e[e][r]||Pt[e]&&Pt[e][r]},vn=L.navigator,Cn=vn&&vn.userAgent,dn=Cn?String(Cn):"",Rt=L,Qn=dn,xt=Rt.process,Xt=Rt.Deno,Lr=xt&&xt.versions||Xt&&Xt.version,Ci=Lr&&Lr.v8;Ci&&(je=(Ne=Ci.split("."))[0]>0&&Ne[0]<4?1:+(Ne[0]+Ne[1])),!je&&Qn&&(!(Ne=Qn.match(/Edge\/(\d+)/))||Ne[1]>=74)&&(Ne=Qn.match(/Chrome\/(\d+)/))&&(je=+Ne[1]);var ai=je,Ii=ai,ps=d,qo=L.String,Hi=!!Object.getOwnPropertySymbols&&!ps(function(){var e=Symbol("symbol detection");return!qo(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ii&&Ii<41}),Ai=Hi&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Kn=Mt,cs=fe,da=k,Yo=Object,po=Ai?function(e){return typeof e=="symbol"}:function(e){var r=Kn("Symbol");return cs(r)&&da(r.prototype,Yo(e))},rd=String,Xo=function(e){try{return rd(e)}catch{return"Object"}},id=fe,hc=Xo,Co=TypeError,Sr=function(e){if(id(e))return e;throw new Co(hc(e)+" is not a function")},ou=Sr,ha=bt,Fa=function(e,r){var s=e[r];return ha(s)?void 0:ou(s)},Mc=be,Jo=fe,Qo=we,sd=TypeError,ph={exports:{}},vl=L,fh=Object.defineProperty,Os=L,pt=function(e,r){try{fh(vl,e,{value:r,configurable:!0,writable:!0})}catch{vl[e]=r}return r},nn="__core-js_shared__",Ar=ph.exports=Os[nn]||pt(nn,{});(Ar.versions||(Ar.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Pi=ph.exports,pc=Pi,fo=function(e,r){return pc[e]||(pc[e]=r||{})},Sl=mt,mh=Object,$s=function(e){return mh(Sl(e))},Br=$s,gh=I({}.hasOwnProperty),zr=Object.hasOwn||function(e,r){return gh(Br(e),r)},pa=I,$i=0,fs=Math.random(),ni=pa(1 .toString),Uc=function(e){return"Symbol("+(e===void 0?"":e)+")_"+ni(++$i+fs,36)},fa=fo,xp=zr,Io=Uc,Lp=Hi,Yf=Ai,bl=L.Symbol,au=fa("wks"),_h=Yf?bl.for||bl:bl&&bl.withoutSetter||Io,Pr=function(e){return xp(au,e)||(au[e]=Lp&&xp(bl,e)?bl[e]:_h("Symbol."+e)),au[e]},od=be,ad=we,ja=po,ma=Fa,cd=function(e,r){var s,o;if(Jo(s=e.toString)&&!Qo(o=Mc(s,e))||Jo(s=e.valueOf)&&!Qo(o=Mc(s,e)))return o;throw new sd("Can't convert object to primitive value")},wl=TypeError,cu=Pr("toPrimitive"),ci=function(e,r){if(!ad(e)||ja(e))return e;var s,o=ma(e,cu);if(o){if(s=od(o,e,r),!ad(s)||ja(s))return s;throw new wl("Can't convert object to primitive value")}return cd(e)},lu=po,fr=function(e){var r=ci(e,"string");return lu(r)?r:r+""},Tl=we,yh=L.document,Eh=Tl(yh)&&Tl(yh.createElement),uu=function(e){return Eh?yh.createElement(e):{}},Xf=uu,Mp=!ve&&!d(function(){return Object.defineProperty(Xf("div"),"a",{get:function(){return 7}}).a!==7}),Up=ve,ga=be,ms=Ce,_a=Ke,ya=rn,du=fr,Ea=zr,Ba=Mp,Vp=Object.getOwnPropertyDescriptor;de.f=Up?Vp:function(e,r){if(e=ya(e),r=du(r),Ba)try{return Vp(e,r)}catch{}if(Ea(e,r))return _a(!ga(ms.f,e,r),e[r])};var Vc=d,ks=fe,Wg=/#|\.prototype\./,Rl=function(e,r){var s=hu[Cl(e)];return s===fc||s!==Jf&&(ks(r)?Vc(r):!!r)},Cl=Rl.normalize=function(e){return String(e).replace(Wg,".").toLowerCase()},hu=Rl.data={},Jf=Rl.NATIVE="N",fc=Rl.POLYFILL="P",va=Rl,Il=Sr,Re=f,Me=ie(ie.bind),st=function(e,r){return Il(e),r===void 0?e:Re?Me(e,r):function(){return e.apply(r,arguments)}},qt={},sr=ve&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Mr=we,ri=String,Zn=TypeError,er=function(e){if(Mr(e))return e;throw new Zn(ri(e)+" is not an object")},Oi=ve,Ks=Mp,Fc=sr,Ao=er,pu=fr,Ns=TypeError,mc=Object.defineProperty,Qf=Object.getOwnPropertyDescriptor,jc="enumerable",Gg="configurable",vh="writable";qt.f=Oi?Fc?function(e,r,s){if(Ao(e),r=pu(r),Ao(s),typeof e=="function"&&r==="prototype"&&"value"in s&&vh in s&&!s[vh]){var o=Qf(e,r);o&&o[vh]&&(e[r]=s.value,s={configurable:Gg in s?s[Gg]:o[Gg],enumerable:jc in s?s[jc]:o[jc],writable:!1})}return mc(e,r,s)}:mc:function(e,r,s){if(Ao(e),r=pu(r),Ao(s),Ks)try{return mc(e,r,s)}catch{}if("get"in s||"set"in s)throw new Ns("Accessors not supported");return"value"in s&&(e[r]=s.value),e};var ld=qt,Sh=Ke,gc=ve?function(e,r,s){return ld.f(e,r,Sh(1,s))}:function(e,r,s){return e[r]=s,e},fu=L,Hg=ne,aE=ie,Zf=fe,em=de.f,cE=va,za=xe,lE=st,ud=gc,$g=zr,Kg=function(e){var r=function(s,o,c){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(s);case 2:return new e(s,o)}return new e(s,o,c)}return Hg(e,this,arguments)};return r.prototype=e.prototype,r},Wn=function(e,r){var s,o,c,u,h,m,g,E,S,C=e.target,A=e.global,O=e.stat,W=e.proto,F=A?fu:O?fu[C]:fu[C]&&fu[C].prototype,B=A?za:za[C]||ud(za,C,{})[C],Z=B.prototype;for(u in r)o=!(s=cE(A?u:C+(O?".":"#")+u,e.forced))&&F&&$g(F,u),m=B[u],o&&(g=e.dontCallGetSet?(S=em(F,u))&&S.value:F[u]),h=o&&g?g:r[u],(s||W||typeof m!=typeof h)&&(E=e.bind&&o?lE(h,fu):e.wrap&&o?Kg(h):W&&Zf(h)?aE(h):h,(e.sham||h&&h.sham||m&&m.sham)&&ud(E,"sham",!0),ud(B,u,E),W&&($g(za,c=C+"Prototype")||ud(za,c,{}),ud(za[c],u,h),e.real&&Z&&(s||!Z[u])&&ud(Z,u,h)))},Sa=Math.ceil,uE=Math.floor,dE=Math.trunc||function(e){var r=+e;return(r>0?uE:Sa)(r)},mu=dE,P=function(e){var r=+e;return r!=r||r===0?0:mu(r)},H=P,re=Math.max,Se=Math.min,qe=function(e,r){var s=H(e);return s<0?re(s+r,0):Se(s,r)},dt=P,Kt=Math.min,ii=function(e){var r=dt(e);return r>0?Kt(r,9007199254740991):0},qs=ii,dr=function(e){return qs(e.length)},mo=rn,Ds=qe,Bc=dr,Wa=function(e){return function(r,s,o){var c=mo(r),u=Bc(c);if(u===0)return!e&&-1;var h,m=Ds(o,u);if(e&&s!=s){for(;u>m;)if((h=c[m++])!=h)return!0}else for(;u>m;m++)if((e||m in c)&&c[m]===s)return e||m||0;return!e&&-1}},dd={includes:Wa(!0),indexOf:Wa(!1)},tm=dd.includes;Wn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return tm(this,e,arguments.length>1?arguments[1]:void 0)}});var FC=L,jC=xe,_c=function(e,r){var s=jC[e+"Prototype"],o=s&&s[r];if(o)return o;var c=FC[e],u=c&&c.prototype;return u&&u[r]},nm=_c("Array","includes"),NN=we,DN=X,xN=Pr("match"),G0=function(e){var r;return NN(e)&&((r=e[xN])!==void 0?!!r:DN(e)==="RegExp")},BC=G0,qg=TypeError,rm={};rm[Pr("toStringTag")]="z";var H0=String(rm)==="[object z]",hE=H0,LN=fe,Yg=X,$0=Pr("toStringTag"),K0=Object,zC=Yg(function(){return arguments}())==="Arguments",hd=hE?Yg:function(e){var r,s,o;return e===void 0?"Undefined":e===null?"Null":typeof(s=function(c,u){try{return c[u]}catch{}}(r=K0(e),$0))=="string"?s:zC?Yg(r):(o=Yg(r))==="Object"&&LN(r.callee)?"Arguments":o},WC=hd,MN=String,Ga=function(e){if(WC(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return MN(e)},UN=Pr("match"),VN=Wn,FN=function(e){if(BC(e))throw new qg("The method doesn't accept regular expressions");return e},Al=mt,im=Ga,GC=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[UN]=!1,"/./"[e](r)}catch{}}return!1},HC=I("".indexOf);VN({target:"String",proto:!0,forced:!GC("includes")},{includes:function(e){return!!~HC(im(Al(this)),im(FN(e)),arguments.length>1?arguments[1]:void 0)}});var $C=_c("String","includes"),q0=k,Y0=nm,jN=$C,X0=Array.prototype,bh=String.prototype,J0=function(e){var r=e.includes;return e===X0||q0(X0,e)&&r===X0.includes?Y0:typeof e=="string"||e===bh||q0(bh,e)&&r===bh.includes?jN:r},et=l(J0),Q0=Sr,KC=$s,pE=rt,sm=dr,fE=TypeError,Z0="Reduce of empty array with no initial value",mE=function(e){return function(r,s,o,c){var u=KC(r),h=pE(u),m=sm(u);if(Q0(s),m===0&&o<2)throw new fE(Z0);var g=e?m-1:0,E=e?-1:1;if(o<2)for(;;){if(g in h){c=h[g],g+=E;break}if(g+=E,e?g<0:m<=g)throw new fE(Z0)}for(;e?g>=0:m>g;g+=E)g in h&&(c=s(c,h[g],g,u));return c}},qC={left:mE(!1)},YC=d,Xg=function(e,r){var s=[][e];return!!s&&YC(function(){s.call(null,r||function(){return 1},1)})},om=L,XC=dn,JC=X,Pl=function(e){return XC.slice(0,e.length)===e},Jg=Pl("Bun/")?"BUN":Pl("Cloudflare-Workers")?"CLOUDFLARE":Pl("Deno/")?"DENO":Pl("Node.js/")?"NODE":om.Bun&&typeof Bun.version=="string"?"BUN":om.Deno&&typeof Deno.version=="object"?"DENO":JC(om.process)==="process"?"NODE":om.window&&om.document?"BROWSER":"REST",am=Jg==="NODE",BN=qC.left;Wn({target:"Array",proto:!0,forced:!am&&ai>79&&ai<83||!Xg("reduce")},{reduce:function(e){var r=arguments.length;return BN(this,e,r,r>1?arguments[1]:void 0)}});var zN=_c("Array","reduce"),Qg=k,WN=zN,gE=Array.prototype,QC=function(e){var r=e.reduce;return e===gE||Qg(gE,e)&&r===gE.reduce?WN:r},ki=QC,Ha=l(ki),_E=X,pd=Array.isArray||function(e){return _E(e)==="Array"},ZC=Wn,eb=pd,Zg=I([].reverse),e_=[1,2];ZC({target:"Array",proto:!0,forced:String(e_)===String(e_.reverse())},{reverse:function(){return eb(this)&&(this.length=this.length),Zg(this)}});var cm=_c("Array","reverse"),eI=k,GN=cm,tb=Array.prototype,tI=function(e){var r=e.reverse;return e===tb||eI(tb,e)&&r===tb.reverse?GN:r},t_=tI,n_=l(t_),nb=Uc,yE=fo("keys"),lm=function(e){return yE[e]||(yE[e]=nb(e))},rb=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),HN=zr,nI=fe,$N=$s,KN=rb,EE=lm("IE_PROTO"),gu=Object,rI=gu.prototype,wh=KN?gu.getPrototypeOf:function(e){var r=$N(e);if(HN(r,EE))return r[EE];var s=r.constructor;return nI(s)&&r instanceof s?s.prototype:r instanceof gu?rI:null},_u=I,r_=Sr,fd=we,ib=function(e){return fd(e)||e===null},qN=String,YN=TypeError,Fp=function(e,r,s){try{return _u(r_(Object.getOwnPropertyDescriptor(e,r)[s]))}catch{}},i_=we,um=mt,vE=function(e){if(ib(e))return e;throw new YN("Can't set "+qN(e)+" as a prototype")},sb=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,s={};try{(e=Fp(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(o,c){return um(o),vE(c),i_(o)&&(r?e(o,c):o.__proto__=c),o}}():void 0),md={},Ol={},Si=zr,Ni=rn,Th=dd.indexOf,Zo=Ol,ba=I([].push),Rh=function(e,r){var s,o=Ni(e),c=0,u=[];for(s in o)!Si(Zo,s)&&Si(o,s)&&ba(u,s);for(;r.length>c;)Si(o,s=r[c++])&&(~Th(u,s)||ba(u,s));return u},Ch=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],$a=Rh,SE=Ch.concat("length","prototype");md.f=Object.getOwnPropertyNames||function(e){return $a(e,SE)};var dm={};dm.f=Object.getOwnPropertySymbols;var iI=Mt,bE=md,sI=dm,gd=er,wE=I([].concat),ob=iI("Reflect","ownKeys")||function(e){var r=bE.f(gd(e)),s=sI.f;return s?wE(r,s(e)):r},ab=zr,XN=ob,Ih=de,hm=qt,Ah={},TE=Rh,RE=Ch,wa=Object.keys||function(e){return TE(e,RE)},zc=ve,jp=sr,_d=qt,yd=er,Bp=rn,oI=wa;Ah.f=zc&&!jp?Object.defineProperties:function(e,r){yd(e);for(var s,o=Bp(r),c=oI(r),u=c.length,h=0;u>h;)_d.f(e,s=c[h++],o[s]);return e};var pm,CE=Mt("document","documentElement"),yc=er,Ec=Ah,Mi=Ch,kl=Ol,aI=CE,cI=uu,s_="prototype",o_="script",cb=lm("IE_PROTO"),fm=function(){},lb=function(e){return"<"+o_+">"+e+"</"+o_+">"},zp=function(e){e.write(lb("")),e.close();var r=e.parentWindow.Object;return e=null,r},mm=function(){try{pm=new ActiveXObject("htmlfile")}catch{}var e,r,s;mm=typeof document<"u"?document.domain&&pm?zp(pm):(r=cI("iframe"),s="java"+o_+":",r.style.display="none",aI.appendChild(r),r.src=String(s),(e=r.contentWindow.document).open(),e.write(lb("document.F=Object")),e.close(),e.F):zp(pm);for(var o=Mi.length;o--;)delete mm[s_][Mi[o]];return mm()};kl[cb]=!0;var a_=Object.create||function(e,r){var s;return e!==null?(fm[s_]=yc(e),s=new fm,fm[s_]=null,s[cb]=e):s=mm(),r===void 0?s:Ec.f(s,r)},c_=we,IE=gc,ub=Error,lI=I("".replace),gm=String(new ub("zxcasd").stack),db=/\n\s*at [^:]*:[^\n]*/,AE=db.test(gm),PE=Ke,_m=!d(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",PE(1,7)),e.stack!==7)}),hb=gc,pb=function(e,r){if(AE&&typeof e=="string"&&!ub.prepareStackTrace)for(;r--;)e=lI(e,db,"");return e},fb=_m,OE=Error.captureStackTrace,Nl={},Wc=Nl,Wp=Pr("iterator"),mb=Array.prototype,gb=function(e){return e!==void 0&&(Wc.Array===e||mb[Wp]===e)},Ed=hd,vd=Fa,_b=bt,uI=Nl,Sd=Pr("iterator"),Dl=function(e){if(!_b(e))return vd(e,Sd)||vd(e,"@@iterator")||uI[Ed(e)]},kE=be,dI=Sr,NE=er,hI=Xo,l_=Dl,yu=TypeError,Gp=function(e,r){var s=arguments.length<2?l_(e):r;if(dI(s))return NE(kE(s,e));throw new yu(hI(e)+" is not iterable")},u_=be,Ph=er,yb=Fa,Hp=function(e,r,s){var o,c;Ph(e);try{if(!(o=yb(e,"return"))){if(r==="throw")throw s;return s}o=u_(o,e)}catch(u){c=!0,o=u}if(r==="throw")throw s;if(c)throw o;return Ph(o),s},pI=st,Eb=be,Qi=er,DE=Xo,vb=gb,Sb=dr,d_=k,bb=Gp,$p=Dl,Ki=Hp,Ys=TypeError,gs=function(e,r){this.stopped=e,this.result=r},h_=gs.prototype,bd=function(e,r,s){var o,c,u,h,m,g,E,S=s&&s.that,C=!(!s||!s.AS_ENTRIES),A=!(!s||!s.IS_RECORD),O=!(!s||!s.IS_ITERATOR),W=!(!s||!s.INTERRUPTED),F=pI(r,S),B=function(Q){return o&&Ki(o,"normal",Q),new gs(!0,Q)},Z=function(Q){return C?(Qi(Q),W?F(Q[0],Q[1],B):F(Q[0],Q[1])):W?F(Q,B):F(Q)};if(A)o=e.iterator;else if(O)o=e;else{if(!(c=$p(e)))throw new Ys(DE(e)+" is not iterable");if(vb(c)){for(u=0,h=Sb(e);h>u;u++)if((m=Z(e[u]))&&d_(h_,m))return m;return new gs(!1)}o=bb(e,c)}for(g=A?e.next:o.next;!(E=Eb(g,o)).done;){try{m=Z(E.value)}catch(Q){Ki(o,"throw",Q)}if(typeof m=="object"&&m&&d_(h_,m))return m}return new gs(!1)},p_=Ga,JN=Wn,ea=k,wb=wh,ym=sb,Tb=function(e,r,s){for(var o=XN(r),c=hm.f,u=Ih.f,h=0;h<o.length;h++){var m=o[h];ab(e,m)||s&&ab(s,m)||c(e,m,u(r,m))}},xl=a_,Ka=gc,Kp=Ke,Rb=function(e,r){c_(r)&&"cause"in r&&IE(e,"cause",r.cause)},Cb=function(e,r,s,o){fb&&(OE?OE(e,r):hb(e,"stack",pb(s,o)))},fI=bd,mI=function(e,r){return e===void 0?arguments.length<2?"":r:p_(e)},gI=Pr("toStringTag"),f_=Error,_I=[].push,qp=function(e,r){var s,o=ea(xE,this);ym?s=ym(new f_,o?wb(this):xE):(s=o?this:xl(xE),Ka(s,gI,"Error")),r!==void 0&&Ka(s,"message",mI(r)),Cb(s,qp,s.stack,1),arguments.length>2&&Rb(s,arguments[2]);var c=[];return fI(e,_I,{that:c}),Ka(s,"errors",c),s};ym?ym(qp,f_):Tb(qp,f_,{name:!0});var xE=qp.prototype=xl(f_.prototype,{constructor:Kp(1,qp),message:Kp(1,""),name:Kp(1,"AggregateError")});JN({global:!0},{AggregateError:qp});var m_,wd,g_,LE=fe,__=L.WeakMap,yI=LE(__)&&/native code/.test(String(__)),ME=L,EI=we,vI=gc,UE=zr,VE=Pi,Ib=lm,SI=Ol,Ab="Object already initialized",FE=ME.TypeError,QN=ME.WeakMap;if(yI||VE.state){var Ll=VE.state||(VE.state=new QN);Ll.get=Ll.get,Ll.has=Ll.has,Ll.set=Ll.set,m_=function(e,r){if(Ll.has(e))throw new FE(Ab);return r.facade=e,Ll.set(e,r),r},wd=function(e){return Ll.get(e)||{}},g_=function(e){return Ll.has(e)}}else{var Em=Ib("state");SI[Em]=!0,m_=function(e,r){if(UE(e,Em))throw new FE(Ab);return r.facade=e,vI(e,Em,r),r},wd=function(e){return UE(e,Em)?e[Em]:{}},g_=function(e){return UE(e,Em)}}var Yp,Pb,Ob,Oh={set:m_,get:wd,has:g_,enforce:function(e){return g_(e)?wd(e):m_(e,{})},getterFor:function(e){return function(r){var s;if(!EI(r)||(s=wd(r)).type!==e)throw new FE("Incompatible receiver, "+e+" required");return s}}},vm=ve,ZN=zr,bI=Function.prototype,eD=vm&&Object.getOwnPropertyDescriptor,Gc=ZN(bI,"name"),jE={PROPER:Gc&&(function(){}).name==="something",CONFIGURABLE:Gc&&(!vm||vm&&eD(bI,"name").configurable)},BE=gc,Td=function(e,r,s,o){return o&&o.enumerable?e[r]=s:BE(e,r,s),e},wI=d,TI=fe,kb=we,Sm=a_,zE=wh,Nb=Td,Db=Pr("iterator"),xb=!1;[].keys&&("next"in(Ob=[].keys())?(Pb=zE(zE(Ob)))!==Object.prototype&&(Yp=Pb):xb=!0);var RI=!kb(Yp)||wI(function(){var e={};return Yp[Db].call(e)!==e});TI((Yp=RI?{}:Sm(Yp))[Db])||Nb(Yp,Db,function(){return this});var Lb={IteratorPrototype:Yp,BUGGY_SAFARI_ITERATORS:xb},CI=hd,II=H0?{}.toString:function(){return"[object "+CI(this)+"]"},tD=H0,qa=qt.f,Ta=gc,AI=zr,PI=II,Mb=Pr("toStringTag"),Eu=function(e,r,s,o){var c=s?e:e&&e.prototype;c&&(AI(c,Mb)||qa(c,Mb,{configurable:!0,value:r}),o&&!tD&&Ta(c,"toString",PI))},OI=Lb.IteratorPrototype,Ub=a_,kI=Ke,Vb=Eu,NI=Nl,DI=function(){return this},y_=function(e,r,s,o){var c=r+" Iterator";return e.prototype=Ub(OI,{next:kI(+!o,s)}),Vb(e,c,!1,!0),NI[c]=DI,e},Fb=Wn,xI=be,jb=jE,WE=y_,nD=wh,LI=Eu,GE=Td,Bb=Nl,HE=Lb,Rd=jb.PROPER,$E=HE.BUGGY_SAFARI_ITERATORS,KE=Pr("iterator"),qE="keys",E_="values",zb="entries",v_=function(){return this},Po=function(e,r,s,o,c,u,h){WE(s,r,o);var m,g,E,S=function(Z){if(Z===c&&F)return F;if(!$E&&Z&&Z in O)return O[Z];switch(Z){case qE:case E_:case zb:return function(){return new s(this,Z)}}return function(){return new s(this)}},C=r+" Iterator",A=!1,O=e.prototype,W=O[KE]||O["@@iterator"]||c&&O[c],F=!$E&&W||S(c),B=r==="Array"&&O.entries||W;if(B&&(m=nD(B.call(new e)))!==Object.prototype&&m.next&&(LI(m,C,!0,!0),Bb[C]=v_),Rd&&c===E_&&W&&W.name!==E_&&(A=!0,F=function(){return xI(W,this)}),c)if(g={values:S(E_),keys:u?F:S(qE),entries:S(zb)},h)for(E in g)($E||A||!(E in O))&&GE(O,E,g[E]);else Fb({target:r,proto:!0,forced:$E||A},g);return h&&O[KE]!==F&&GE(O,KE,F,{}),Bb[r]=F,g},YE=function(e,r){return{value:e,done:r}},rD=rn,S_=Nl,Oo=Oh;qt.f;var iD=Po,an=YE,Xp="Array Iterator",Wb=Oo.set,MI=Oo.getterFor(Xp);iD(Array,"Array",function(e,r){Wb(this,{type:Xp,target:rD(e),index:0,kind:r})},function(){var e=MI(this),r=e.target,s=e.index++;if(!r||s>=r.length)return e.target=null,an(void 0,!0);switch(e.kind){case"keys":return an(s,!1);case"values":return an(r[s],!1)}return an([s,r[s]],!1)},"values"),S_.Arguments=S_.Array;var sD=qt,kh=function(e,r,s){return sD.f(e,r,s)},XE=Mt,Gb=kh,UI=ve,Hb=Pr("species"),VI=k,$b=TypeError,b_=function(e,r){if(VI(r,e))return e;throw new $b("Incorrect invocation")},ko=fe,vc=Pi,Nh=I(Function.toString);ko(vc.inspectSource)||(vc.inspectSource=function(e){return Nh(e)});var Kb=vc.inspectSource,FI=I,Ml=d,qb=fe,vu=hd,oD=Kb,Yb=function(){},Xb=Mt("Reflect","construct"),JE=/^\s*(?:class|function)\b/,jI=FI(JE.exec),aD=!JE.test(Yb),Dh=function(e){if(!qb(e))return!1;try{return Xb(Yb,[],e),!0}catch{return!1}},QE=function(e){if(!qb(e))return!1;switch(vu(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return aD||!!jI(JE,oD(e))}catch{return!0}};QE.sham=!0;var ta,br,Xs,ls,xs=!Xb||Ml(function(){var e;return Dh(Dh.call)||!Dh(Object)||!Dh(function(){e=!0})||e})?QE:Dh,Sc=xs,bm=Xo,Js=TypeError,wm=er,Jp=function(e){if(Sc(e))return e;throw new Js(bm(e)+" is not a constructor")},ZE=bt,Jb=Pr("species"),Qp=function(e,r){var s,o=wm(e).constructor;return o===void 0||ZE(s=wm(o)[Jb])?r:Jp(s)},_s=I([].slice),Qb=TypeError,Hc=function(e,r){if(e<r)throw new Qb("Not enough arguments");return e},Su=/(?:ipad|iphone|ipod).*applewebkit/i.test(dn),na=L,Zb=ne,xh=st,w_=fe,Lh=zr,T_=d,Tm=CE,ew=_s,R_=uu,ev=Hc,Ra=Su,Mh=am,bc=na.setImmediate,ra=na.clearImmediate,BI=na.process,C_=na.Dispatch,tw=na.Function,zI=na.MessageChannel,Uh=na.String,tv=0,Zp={},Vh="onreadystatechange";T_(function(){ta=na.location});var I_=function(e){if(Lh(Zp,e)){var r=Zp[e];delete Zp[e],r()}},Cd=function(e){return function(){I_(e)}},nw=function(e){I_(e.data)},rw=function(e){na.postMessage(Uh(e),ta.protocol+"//"+ta.host)};bc&&ra||(bc=function(e){ev(arguments.length,1);var r=w_(e)?e:tw(e),s=ew(arguments,1);return Zp[++tv]=function(){Zb(r,void 0,s)},br(tv),tv},ra=function(e){delete Zp[e]},Mh?br=function(e){BI.nextTick(Cd(e))}:C_&&C_.now?br=function(e){C_.now(Cd(e))}:zI&&!Ra?(ls=(Xs=new zI).port2,Xs.port1.onmessage=nw,br=xh(ls.postMessage,ls)):na.addEventListener&&w_(na.postMessage)&&!na.importScripts&&ta&&ta.protocol!=="file:"&&!T_(rw)?(br=rw,na.addEventListener("message",nw,!1)):br=Vh in R_("script")?function(e){Tm.appendChild(R_("script"))[Vh]=function(){Tm.removeChild(this),I_(e)}}:function(e){setTimeout(Cd(e),0)});var Rm={set:bc,clear:ra},A_=L,cD=ve,lD=Object.getOwnPropertyDescriptor,iw=function(e){if(!cD)return A_[e];var r=lD(A_,e);return r&&r.value},sw=function(){this.head=null,this.tail=null};sw.prototype={add:function(e){var r={item:e,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var $c,ow,Fh,nv,Zi,WI=sw,GI=/ipad|iphone|ipod/i.test(dn)&&typeof Pebble<"u",uD=/web0s(?!.*chrome)/i.test(dn),Cm=L,HI=iw,aw=st,cw=Rm.set,Kc=WI,lw=Su,dD=GI,jh=uD,Im=am,Bh=Cm.MutationObserver||Cm.WebKitMutationObserver,P_=Cm.document,rv=Cm.process,Am=Cm.Promise,uw=HI("queueMicrotask");if(!uw){var Pm=new Kc,iv=function(){var e,r;for(Im&&(e=rv.domain)&&e.exit();r=Pm.get();)try{r()}catch(s){throw Pm.head&&$c(),s}e&&e.enter()};lw||Im||jh||!Bh||!P_?!dD&&Am&&Am.resolve?((nv=Am.resolve(void 0)).constructor=Am,Zi=aw(nv.then,nv),$c=function(){Zi(iv)}):Im?$c=function(){rv.nextTick(iv)}:(cw=aw(cw,Cm),$c=function(){cw(iv)}):(ow=!0,Fh=P_.createTextNode(""),new Bh(iv).observe(Fh,{characterData:!0}),$c=function(){Fh.data=ow=!ow}),uw=function(e){Pm.head||$c(),Pm.add(e)}}var dw=uw,ef=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},bu=L.Promise,sv=L,Om=bu,hw=fe,hD=va,$I=Kb,pw=Pr,O_=Jg,k_=ai,N_=Om&&Om.prototype,KI=pw("species"),qI=hw(sv.PromiseRejectionEvent),ov=hD("Promise",function(){var e=$I(Om),r=e!==String(Om);if(!r&&k_===66||!N_.catch||!N_.finally)return!0;if(!k_||k_<51||!/native code/.test(e)){var s=new Om(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((s.constructor={})[KI]=o,!(s.then(function(){})instanceof o))return!0}return!(r||O_!=="BROWSER"&&O_!=="DENO"||qI)}),D_={CONSTRUCTOR:ov,REJECTION_EVENT:qI},Ya={},YI=Sr,av=TypeError,p=function(e){var r,s;this.promise=new e(function(o,c){if(r!==void 0||s!==void 0)throw new av("Bad Promise constructor");r=o,s=c}),this.resolve=YI(r),this.reject=YI(s)};Ya.f=function(e){return new p(e)};var _,T,D=Wn,V=am,$=L,pe=be,Oe=Td,Ve=Eu,ct=function(e){var r=XE(e);UI&&r&&!r[Hb]&&Gb(r,Hb,{configurable:!0,get:function(){return this}})},Dt=Sr,Lt=fe,Nt=we,sn=b_,hn=Qp,mn=Rm.set,es=dw,Xe=function(e,r){try{arguments.length===1?console.error(e):console.error(e,r)}catch{}},Be=ef,tt=WI,jt=Oh,gn=bu,In=D_,An=Ya,Mn="Promise",Qs=In.CONSTRUCTOR,Yr=In.REJECTION_EVENT,wu=jt.getterFor(Mn),pD=jt.set,_ae=gn&&gn.prototype,fw=gn,fD=_ae,g3=$.TypeError,mD=$.document,gD=$.process,_D=An.f,yae=_D,Eae=!!(mD&&mD.createEvent&&$.dispatchEvent),_3="unhandledrejection",y3=function(e){var r;return!(!Nt(e)||!Lt(r=e.then))&&r},E3=function(e,r){var s,o,c,u=r.value,h=r.state===1,m=h?e.ok:e.fail,g=e.resolve,E=e.reject,S=e.domain;try{m?(h||(r.rejection===2&&Sae(r),r.rejection=1),m===!0?s=u:(S&&S.enter(),s=m(u),S&&(S.exit(),c=!0)),s===e.promise?E(new g3("Promise-chain cycle")):(o=y3(s))?pe(o,s,g,E):g(s)):E(u)}catch(C){S&&!c&&S.exit(),E(C)}},v3=function(e,r){e.notified||(e.notified=!0,es(function(){for(var s,o=e.reactions;s=o.get();)E3(s,e);e.notified=!1,r&&!e.rejection&&vae(e)}))},S3=function(e,r,s){var o,c;Eae?((o=mD.createEvent("Event")).promise=r,o.reason=s,o.initEvent(e,!1,!0),$.dispatchEvent(o)):o={promise:r,reason:s},!Yr&&(c=$["on"+e])?c(o):e===_3&&Xe("Unhandled promise rejection",s)},vae=function(e){pe(mn,$,function(){var r,s=e.facade,o=e.value;if(b3(e)&&(r=Be(function(){V?gD.emit("unhandledRejection",o,s):S3(_3,s,o)}),e.rejection=V||b3(e)?2:1,r.error))throw r.value})},b3=function(e){return e.rejection!==1&&!e.parent},Sae=function(e){pe(mn,$,function(){var r=e.facade;V?gD.emit("rejectionHandled",r):S3("rejectionhandled",r,e.value)})},cv=function(e,r,s){return function(o){e(r,o,s)}},lv=function(e,r,s){e.done||(e.done=!0,s&&(e=s),e.value=r,e.state=2,v3(e,!0))},yD=function(e,r,s){if(!e.done){e.done=!0,s&&(e=s);try{if(e.facade===r)throw new g3("Promise can't be resolved itself");var o=y3(r);o?es(function(){var c={done:!1};try{pe(o,r,cv(yD,c,e),cv(lv,c,e))}catch(u){lv(c,u,e)}}):(e.value=r,e.state=1,v3(e,!1))}catch(c){lv({done:!1},c,e)}}};Qs&&(fD=(fw=function(e){sn(this,fD),Dt(e),pe(_,this);var r=wu(this);try{e(cv(yD,r),cv(lv,r))}catch(s){lv(r,s)}}).prototype,(_=function(e){pD(this,{type:Mn,done:!1,notified:!1,parent:!1,reactions:new tt,rejection:!1,state:0,value:null})}).prototype=Oe(fD,"then",function(e,r){var s=wu(this),o=_D(hn(this,fw));return s.parent=!0,o.ok=!Lt(e)||e,o.fail=Lt(r)&&r,o.domain=V?gD.domain:void 0,s.state===0?s.reactions.add(o):es(function(){E3(o,s)}),o.promise}),T=function(){var e=new _,r=wu(e);this.promise=e,this.resolve=cv(yD,r),this.reject=cv(lv,r)},An.f=_D=function(e){return e===fw||e===void 0?new T(e):yae(e)}),D({global:!0,wrap:!0,forced:Qs},{Promise:fw}),Ve(fw,Mn,!1,!0),ct(Mn);var w3=Pr("iterator"),T3=!1;try{var bae=0,R3={next:function(){return{done:!!bae++}},return:function(){T3=!0}};R3[w3]=function(){return this},Array.from(R3,function(){throw 2})}catch{}var wae=bu,Tae=function(e,r){try{if(!r&&!T3)return!1}catch{return!1}var s=!1;try{var o={};o[w3]=function(){return{next:function(){return{done:s=!0}}}},e(o)}catch{}return s},XI=D_.CONSTRUCTOR||!Tae(function(e){wae.all(e).then(void 0,function(){})}),Rae=be,Cae=Sr,Iae=Ya,Aae=ef,Pae=bd;Wn({target:"Promise",stat:!0,forced:XI},{all:function(e){var r=this,s=Iae.f(r),o=s.resolve,c=s.reject,u=Aae(function(){var h=Cae(r.resolve),m=[],g=0,E=1;Pae(e,function(S){var C=g++,A=!1;E++,Rae(h,r,S).then(function(O){A||(A=!0,m[C]=O,--E||o(m))},c)}),--E||o(m)});return u.error&&c(u.value),s.promise}});var Oae=Wn,kae=D_.CONSTRUCTOR;bu&&bu.prototype,Oae({target:"Promise",proto:!0,forced:kae,real:!0},{catch:function(e){return this.then(void 0,e)}});var Nae=be,Dae=Sr,xae=Ya,Lae=ef,Mae=bd;Wn({target:"Promise",stat:!0,forced:XI},{race:function(e){var r=this,s=xae.f(r),o=s.reject,c=Lae(function(){var u=Dae(r.resolve);Mae(e,function(h){Nae(u,r,h).then(s.resolve,o)})});return c.error&&o(c.value),s.promise}});var Uae=Ya;Wn({target:"Promise",stat:!0,forced:D_.CONSTRUCTOR},{reject:function(e){var r=Uae.f(this);return(0,r.reject)(e),r.promise}});var Vae=er,Fae=we,jae=Ya,C3=function(e,r){if(Vae(e),Fae(r)&&r.constructor===e)return r;var s=jae.f(e);return(0,s.resolve)(r),s.promise},Bae=Wn,zae=bu,Wae=D_.CONSTRUCTOR,Gae=C3,Hae=Mt("Promise"),$ae=!Wae;Bae({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Gae($ae&&this===Hae?zae:this,e)}});var Kae=be,qae=Sr,Yae=Ya,Xae=ef,Jae=bd;Wn({target:"Promise",stat:!0,forced:XI},{allSettled:function(e){var r=this,s=Yae.f(r),o=s.resolve,c=s.reject,u=Xae(function(){var h=qae(r.resolve),m=[],g=0,E=1;Jae(e,function(S){var C=g++,A=!1;E++,Kae(h,r,S).then(function(O){A||(A=!0,m[C]={status:"fulfilled",value:O},--E||o(m))},function(O){A||(A=!0,m[C]={status:"rejected",reason:O},--E||o(m))})}),--E||o(m)});return u.error&&c(u.value),s.promise}});var Qae=be,Zae=Sr,ece=Mt,tce=Ya,nce=ef,rce=bd,I3="No one promise resolved";Wn({target:"Promise",stat:!0,forced:XI},{any:function(e){var r=this,s=ece("AggregateError"),o=tce.f(r),c=o.resolve,u=o.reject,h=nce(function(){var m=Zae(r.resolve),g=[],E=0,S=1,C=!1;rce(e,function(A){var O=E++,W=!1;S++,Qae(m,r,A).then(function(F){W||C||(C=!0,c(F))},function(F){W||C||(W=!0,g[O]=F,--S||u(new s(g,I3)))})}),--S||u(new s(g,I3))});return h.error&&u(h.value),o.promise}});var ice=Wn,sce=ne,oce=_s,ace=Ya,cce=Sr,A3=ef,ED=L.Promise,P3=!1;ice({target:"Promise",stat:!0,forced:!ED||!ED.try||A3(function(){ED.try(function(e){P3=e===8},8)}).error||!P3},{try:function(e){var r=arguments.length>1?oce(arguments,1):[],s=ace.f(this),o=A3(function(){return sce(cce(e),void 0,r)});return(o.error?s.reject:s.resolve)(o.value),s.promise}});var lce=Ya;Wn({target:"Promise",stat:!0},{withResolvers:function(){var e=lce.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var uce=Wn,vD=bu,dce=d,hce=Mt,pce=fe,fce=Qp,O3=C3,mce=vD&&vD.prototype;uce({target:"Promise",proto:!0,real:!0,forced:!!vD&&dce(function(){mce.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=fce(this,hce("Promise")),s=pce(e);return this.then(s?function(o){return O3(r,e()).then(function(){return o})}:e,s?function(o){return O3(r,e()).then(function(){throw o})}:e)}});var SD=I,gce=P,_ce=Ga,yce=mt,Ece=SD("".charAt),k3=SD("".charCodeAt),vce=SD("".slice),N3=function(e){return function(r,s){var o,c,u=_ce(yce(r)),h=gce(s),m=u.length;return h<0||h>=m?e?"":void 0:(o=k3(u,h))<55296||o>56319||h+1===m||(c=k3(u,h+1))<56320||c>57343?e?Ece(u,h):o:e?vce(u,h,h+2):c-56320+(o-55296<<10)+65536}},bD={codeAt:N3(!1),charAt:N3(!0)},Sce=bD.charAt,bce=Ga,D3=Oh,wce=Po,x3=YE,L3="String Iterator",Tce=D3.set,Rce=D3.getterFor(L3);wce(String,"String",function(e){Tce(this,{type:L3,string:bce(e),index:0})},function(){var e,r=Rce(this),s=r.string,o=r.index;return o>=s.length?x3(void 0,!0):(e=Sce(s,o),r.index+=e.length,x3(e,!1))});var Cce=xe.Promise,Ice={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ace=L,Pce=Eu,M3=Nl;for(var wD in Ice)Pce(Ace[wD],wD),M3[wD]=M3.Array;var U3=Cce,gt=l(U3),Oce=_c("Array","values"),kce=hd,Nce=zr,Dce=k,xce=Oce,TD=Array.prototype,Lce={DOMTokenList:!0,NodeList:!0},Mce=function(e){var r=e.values;return e===TD||Dce(TD,e)&&r===TD.values||Nce(Lce,kce(e))?xce:r},wc=l(Mce),V3=Xo,Uce=TypeError,F3=_s,Vce=Math.floor,RD=function(e,r){var s=e.length;if(s<8)for(var o,c,u=1;u<s;){for(c=u,o=e[u];c&&r(e[c-1],o)>0;)e[c]=e[--c];c!==u++&&(e[c]=o)}else for(var h=Vce(s/2),m=RD(F3(e,0,h),r),g=RD(F3(e,h),r),E=m.length,S=g.length,C=0,A=0;C<E||A<S;)e[C+A]=C<E&&A<S?r(m[C],g[A])<=0?m[C++]:g[A++]:C<E?m[C++]:g[A++];return e},j3=RD,B3=dn.match(/firefox\/(\d+)/i),Fce=!!B3&&+B3[1],jce=/MSIE|Trident/.test(dn),z3=dn.match(/AppleWebKit\/(\d+)\./),Bce=!!z3&&+z3[1],zce=Wn,W3=I,Wce=Sr,Gce=$s,G3=dr,Hce=function(e,r){if(!delete e[r])throw new Uce("Cannot delete property "+V3(r)+" of "+V3(e))},H3=Ga,CD=d,$ce=j3,Kce=Xg,$3=Fce,qce=jce,K3=ai,q3=Bce,km=[],Y3=W3(km.sort),Yce=W3(km.push),Xce=CD(function(){km.sort(void 0)}),Jce=CD(function(){km.sort(null)}),Qce=Kce("sort"),X3=!CD(function(){if(K3)return K3<70;if(!($3&&$3>3)){if(qce)return!0;if(q3)return q3<603;var e,r,s,o,c="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(o=0;o<47;o++)km.push({k:r+o,v:s})}for(km.sort(function(u,h){return h.v-u.v}),o=0;o<km.length;o++)r=km[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});zce({target:"Array",proto:!0,forced:Xce||!Jce||!Qce||!X3},{sort:function(e){e!==void 0&&Wce(e);var r=Gce(this);if(X3)return e===void 0?Y3(r):Y3(r,e);var s,o,c=[],u=G3(r);for(o=0;o<u;o++)o in r&&Yce(c,r[o]);for($ce(c,function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:H3(m)>H3(g)?1:-1}}(e)),s=G3(c),o=0;o<s;)r[o]=c[o++];for(;o<u;)Hce(r,o++);return r}});var Zce=_c("Array","sort"),ele=k,tle=Zce,ID=Array.prototype,nle=function(e){var r=e.sort;return e===ID||ele(ID,e)&&r===ID.sort?tle:r},x_=l(nle),rle=Wn,ile=I,sle=qe,ole=RangeError,J3=String.fromCharCode,Q3=String.fromCodePoint,ale=ile([].join);rle({target:"String",stat:!0,forced:!!Q3&&Q3.length!==1},{fromCodePoint:function(e){for(var r,s=[],o=arguments.length,c=0;o>c;){if(r=+arguments[c++],sle(r,1114111)!==r)throw new ole(r+" is not a valid code point");s[c]=r<65536?J3(r):J3(55296+((r-=65536)>>10),r%1024+56320)}return ale(s,"")}});var cle=d,lle=Pr("iterator"),JI=!cle(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),r=e.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),o="";return e.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),s.delete("a",2),s.delete("b",void 0),!e.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!r.size&&!0||!r.sort||e.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[lle]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("https://x",void 0).host!=="x"}),ule=Td,AD=Wn,Z3=L,PD=iw,dle=Mt,QI=be,Id=I,mw=ve,e4=JI,t4=Td,hle=kh,ple=function(e,r,s){for(var o in r)s&&s.unsafe&&e[o]?e[o]=r[o]:ule(e,o,r[o],s);return e},fle=Eu,mle=y_,OD=Oh,n4=b_,kD=fe,gle=zr,_le=st,yle=hd,Ele=er,r4=we,Tc=Ga,vle=a_,i4=Ke,s4=Gp,Sle=Dl,ZI=YE,uv=Hc,ble=j3,wle=Pr("iterator"),dv="URLSearchParams",o4=dv+"Iterator",a4=OD.set,Tu=OD.getterFor(dv),Tle=OD.getterFor(o4),c4=PD("fetch"),eA=PD("Request"),gw=PD("Headers"),ND=eA&&eA.prototype,l4=gw&&gw.prototype,Rle=Z3.TypeError,Cle=Z3.encodeURIComponent,Ile=String.fromCharCode,Ale=dle("String","fromCodePoint"),Ple=parseInt,tA=Id("".charAt),u4=Id([].join),Nm=Id([].push),d4=Id("".replace),Ole=Id([].shift),h4=Id([].splice),p4=Id("".split),f4=Id("".slice),kle=Id(/./.exec),Nle=/\+/g,Dle=/^[0-9a-f]+$/i,m4=function(e,r){var s=f4(e,r,r+2);return kle(Dle,s)?Ple(s,16):NaN},xle=function(e){for(var r=0,s=128;s>0&&(e&s)!=0;s>>=1)r++;return r},Lle=function(e){var r=null;switch(e.length){case 1:r=e[0];break;case 2:r=(31&e[0])<<6|63&e[1];break;case 3:r=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:r=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return r>1114111?null:r},g4=function(e){for(var r=(e=d4(e,Nle," ")).length,s="",o=0;o<r;){var c=tA(e,o);if(c==="%"){if(tA(e,o+1)==="%"||o+3>r){s+="%",o++;continue}var u=m4(e,o+1);if(u!=u){s+=c,o++;continue}o+=2;var h=xle(u);if(h===0)c=Ile(u);else{if(h===1||h>4){s+="",o++;continue}for(var m=[u],g=1;g<h&&!(++o+3>r||tA(e,o)!=="%");){var E=m4(e,o+1);if(E!=E){o+=3;break}if(E>191||E<128)break;Nm(m,E),o+=2,g++}if(m.length!==h){s+="";continue}var S=Lle(m);S===null?s+="":c=Ale(S)}}s+=c,o++}return s},Mle=/[!'()~]|%20/g,Ule={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Vle=function(e){return Ule[e]},_4=function(e){return d4(Cle(e),Mle,Vle)},DD=mle(function(e,r){a4(this,{type:o4,target:Tu(e).entries,index:0,kind:r})},dv,function(){var e=Tle(this),r=e.target,s=e.index++;if(!r||s>=r.length)return e.target=null,ZI(void 0,!0);var o=r[s];switch(e.kind){case"keys":return ZI(o.key,!1);case"values":return ZI(o.value,!1)}return ZI([o.key,o.value],!1)},!0),y4=function(e){this.entries=[],this.url=null,e!==void 0&&(r4(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?tA(e,0)==="?"?f4(e,1):e:Tc(e)))};y4.prototype={type:dv,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,s,o,c,u,h,m,g=this.entries,E=Sle(e);if(E)for(s=(r=s4(e,E)).next;!(o=QI(s,r)).done;){if(u=(c=s4(Ele(o.value))).next,(h=QI(u,c)).done||(m=QI(u,c)).done||!QI(u,c).done)throw new Rle("Expected sequence with length 2");Nm(g,{key:Tc(h.value),value:Tc(m.value)})}else for(var S in e)gle(e,S)&&Nm(g,{key:S,value:Tc(e[S])})},parseQuery:function(e){if(e)for(var r,s,o=this.entries,c=p4(e,"&"),u=0;u<c.length;)(r=c[u++]).length&&(s=p4(r,"="),Nm(o,{key:g4(Ole(s)),value:g4(u4(s,"="))}))},serialize:function(){for(var e,r=this.entries,s=[],o=0;o<r.length;)e=r[o++],Nm(s,_4(e.key)+"="+_4(e.value));return u4(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var nA=function(){n4(this,hv);var e=a4(this,new y4(arguments.length>0?arguments[0]:void 0));mw||(this.size=e.entries.length)},hv=nA.prototype;if(ple(hv,{append:function(e,r){var s=Tu(this);uv(arguments.length,2),Nm(s.entries,{key:Tc(e),value:Tc(r)}),mw||this.length++,s.updateURL()},delete:function(e){for(var r=Tu(this),s=uv(arguments.length,1),o=r.entries,c=Tc(e),u=s<2?void 0:arguments[1],h=u===void 0?u:Tc(u),m=0;m<o.length;){var g=o[m];if(g.key!==c||h!==void 0&&g.value!==h)m++;else if(h4(o,m,1),h!==void 0)break}mw||(this.size=o.length),r.updateURL()},get:function(e){var r=Tu(this).entries;uv(arguments.length,1);for(var s=Tc(e),o=0;o<r.length;o++)if(r[o].key===s)return r[o].value;return null},getAll:function(e){var r=Tu(this).entries;uv(arguments.length,1);for(var s=Tc(e),o=[],c=0;c<r.length;c++)r[c].key===s&&Nm(o,r[c].value);return o},has:function(e){for(var r=Tu(this).entries,s=uv(arguments.length,1),o=Tc(e),c=s<2?void 0:arguments[1],u=c===void 0?c:Tc(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,r){var s=Tu(this);uv(arguments.length,1);for(var o,c=s.entries,u=!1,h=Tc(e),m=Tc(r),g=0;g<c.length;g++)(o=c[g]).key===h&&(u?h4(c,g--,1):(u=!0,o.value=m));u||Nm(c,{key:h,value:m}),mw||(this.size=c.length),s.updateURL()},sort:function(){var e=Tu(this);ble(e.entries,function(r,s){return r.key>s.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,s=Tu(this).entries,o=_le(e,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)o((r=s[c++]).value,r.key,this)},keys:function(){return new DD(this,"keys")},values:function(){return new DD(this,"values")},entries:function(){return new DD(this,"entries")}},{enumerable:!0}),t4(hv,wle,hv.entries,{}),t4(hv,"toString",function(){return Tu(this).serialize()},{enumerable:!0}),mw&&hle(hv,"size",{get:function(){return Tu(this).entries.length},configurable:!0,enumerable:!0}),fle(nA,dv),AD({global:!0,forced:!e4},{URLSearchParams:nA}),!e4&&kD(gw)){var Fle=Id(l4.has),jle=Id(l4.set),E4=function(e){if(r4(e)){var r,s=e.body;if(yle(s)===dv)return r=e.headers?new gw(e.headers):new gw,Fle(r,"content-type")||jle(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),vle(e,{body:i4(0,Tc(s)),headers:i4(0,r)})}return e};if(kD(c4)&&AD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return c4(e,arguments.length>1?E4(arguments[1]):{})}}),kD(eA)){var xD=function(e){return n4(this,ND),new eA(e,arguments.length>1?E4(arguments[1]):{})};ND.constructor=xD,xD.prototype=ND,AD({global:!0,dontCallGetSet:!0,forced:!0},{Request:xD})}}var Ru,Ble={URLSearchParams:nA,getState:Tu},zle=xe.URLSearchParams,v4=ve,Wle=I,Gle=be,Hle=d,LD=wa,$le=dm,Kle=Ce,qle=$s,Yle=rt,pv=Object.assign,S4=Object.defineProperty,Xle=Wle([].concat),Jle=!pv||Hle(function(){if(v4&&pv({b:1},pv(S4({},"a",{enumerable:!0,get:function(){S4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},s=Symbol("assign detection"),o="abcdefghijklmnopqrst";return e[s]=7,o.split("").forEach(function(c){r[c]=c}),pv({},e)[s]!==7||LD(pv({},r)).join("")!==o})?function(e,r){for(var s=qle(e),o=arguments.length,c=1,u=$le.f,h=Kle.f;o>c;)for(var m,g=Yle(arguments[c++]),E=u?Xle(LD(g),u(g)):LD(g),S=E.length,C=0;S>C;)m=E[C++],v4&&!Gle(h,g,m)||(s[m]=g[m]);return s}:pv,Qle=er,Zle=Hp,eue=ve,tue=qt,nue=Ke,MD=function(e,r,s){eue?tue.f(e,r,nue(0,s)):e[r]=s},rue=st,iue=be,sue=$s,oue=function(e,r,s,o){try{return o?r(Qle(s)[0],s[1]):r(s)}catch(c){Zle(e,"throw",c)}},aue=gb,cue=xs,lue=dr,b4=MD,uue=Gp,due=Dl,w4=Array,L_=I,UD=2147483647,hue=/[^\0-\u007E]/,T4=/[.\u3002\uFF0E\uFF61]/g,R4="Overflow: input needs wider integers to process",C4=RangeError,pue=L_(T4.exec),fv=Math.floor,VD=String.fromCharCode,I4=L_("".charCodeAt),A4=L_([].join),Dm=L_([].push),fue=L_("".replace),mue=L_("".split),gue=L_("".toLowerCase),P4=function(e){return e+22+75*(e<26)},_ue=function(e,r,s){var o=0;for(e=s?fv(e/700):e>>1,e+=fv(e/r);e>455;)e=fv(e/35),o+=36;return fv(o+36*e/(e+38))},yue=function(e){var r=[];e=function(Z){for(var Q=[],ae=0,ye=Z.length;ae<ye;){var _e=I4(Z,ae++);if(_e>=55296&&_e<=56319&&ae<ye){var ue=I4(Z,ae++);(64512&ue)==56320?Dm(Q,((1023&_e)<<10)+(1023&ue)+65536):(Dm(Q,_e),ae--)}else Dm(Q,_e)}return Q}(e);var s,o,c=e.length,u=128,h=0,m=72;for(s=0;s<e.length;s++)(o=e[s])<128&&Dm(r,VD(o));var g=r.length,E=g;for(g&&Dm(r,"-");E<c;){var S=UD;for(s=0;s<e.length;s++)(o=e[s])>=u&&o<S&&(S=o);var C=E+1;if(S-u>fv((UD-h)/C))throw new C4(R4);for(h+=(S-u)*C,u=S,s=0;s<e.length;s++){if((o=e[s])<u&&++h>UD)throw new C4(R4);if(o===u){for(var A=h,O=36;;){var W=O<=m?1:O>=m+26?26:O-m;if(A<W)break;var F=A-W,B=36-W;Dm(r,VD(P4(W+F%B))),A=fv(F/B),O+=36}Dm(r,VD(P4(A))),m=_ue(h,C,E===g),h=0,E++}}h++,u++}return A4(r,"")},Eue=Wn,FD=ve,vue=JI,jD=L,O4=st,Cu=I,rA=Td,Iu=kh,Sue=b_,BD=zr,zD=Jle,mv=function(e){var r=sue(e),s=cue(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=rue(c,o>2?arguments[2]:void 0));var h,m,g,E,S,C,A=due(r),O=0;if(!A||this===w4&&aue(A))for(h=lue(r),m=s?new this(h):w4(h);h>O;O++)C=u?c(r[O],O):r[O],b4(m,O,C);else for(m=s?new this:[],S=(E=uue(r,A)).next;!(g=iue(S,E)).done;O++)C=u?oue(E,c,[g.value,O],!0):g.value,b4(m,O,C);return m.length=O,m},Ad=_s,bue=bD.codeAt,wue=function(e){var r,s,o=[],c=mue(fue(gue(e),T4,"."),".");for(r=0;r<c.length;r++)s=c[r],Dm(o,pue(hue,s)?"xn--"+yue(s):s);return A4(o,".")},tf=Ga,Tue=Eu,Rue=Hc,k4=Ble,N4=Oh,Cue=N4.set,iA=N4.getterFor("URL"),Iue=k4.URLSearchParams,Aue=k4.getState,_w=jD.URL,WD=jD.TypeError,sA=jD.parseInt,Pue=Math.floor,D4=Math.pow,Au=Cu("".charAt),Pd=Cu(/./.exec),yw=Cu([].join),Oue=Cu(1 .toString),kue=Cu([].pop),gv=Cu([].push),GD=Cu("".replace),Nue=Cu([].shift),Due=Cu("".split),Ew=Cu("".slice),oA=Cu("".toLowerCase),xue=Cu([].unshift),HD="Invalid scheme",M_="Invalid host",x4="Invalid port",L4=/[a-z]/i,Lue=/[\d+-.a-z]/i,$D=/\d/,Mue=/^0x/i,Uue=/^[0-7]+$/,Vue=/^\d+$/,M4=/^[\da-f]+$/i,Fue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,jue=/[\0\t\n\r #/:<>?@[\\\]^|]/,Bue=/^[\u0000-\u0020]+/,zue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Wue=/[\t\n\r]/g,vw=function(e){var r,s,o,c;if(typeof e=="number"){for(r=[],s=0;s<4;s++)xue(r,e%256),e=Pue(e/256);return yw(r,".")}if(typeof e=="object"){for(r="",o=function(u){for(var h=null,m=1,g=null,E=0,S=0;S<8;S++)u[S]!==0?(E>m&&(h=g,m=E),g=null,E=0):(g===null&&(g=S),++E);return E>m?g:h}(e),s=0;s<8;s++)c&&e[s]===0||(c&&(c=!1),o===s?(r+=s?":":"::",c=!0):(r+=Oue(e[s],16),s<7&&(r+=":")));return"["+r+"]"}return e},aA={},U4=zD({},aA,{" ":1,'"':1,"<":1,">":1,"`":1}),V4=zD({},U4,{"#":1,"?":1,"{":1,"}":1}),KD=zD({},V4,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),xm=function(e,r){var s=bue(e,0);return s>32&&s<127&&!BD(r,e)?e:encodeURIComponent(e)},cA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Sw=function(e,r){var s;return e.length===2&&Pd(L4,Au(e,0))&&((s=Au(e,1))===":"||!r&&s==="|")},F4=function(e){var r;return e.length>1&&Sw(Ew(e,0,2))&&(e.length===2||(r=Au(e,2))==="/"||r==="\\"||r==="?"||r==="#")},Gue=function(e){return e==="."||oA(e)==="%2e"},qD={},j4={},YD={},B4={},z4={},XD={},W4={},G4={},lA={},uA={},JD={},QD={},ZD={},ex={},H4={},tx={},_v={},zh={},$4={},U_={},nf={},nx=function(e,r,s){var o,c,u,h=tf(e);if(r){if(c=this.parse(h))throw new WD(c);this.searchParams=null}else{if(s!==void 0&&(o=new nx(s,!0)),c=this.parse(h,null,o))throw new WD(c);(u=Aue(new Iue)).bindURL(this),this.searchParams=u}};nx.prototype={type:"URL",parse:function(e,r,s){var o,c,u,h,m,g=this,E=r||qD,S=0,C="",A=!1,O=!1,W=!1;for(e=tf(e),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,e=GD(e,Bue,""),e=GD(e,zue,"$1")),e=GD(e,Wue,""),o=mv(e);S<=o.length;){switch(c=o[S],E){case qD:if(!c||!Pd(L4,c)){if(r)return HD;E=YD;continue}C+=oA(c),E=j4;break;case j4:if(c&&(Pd(Lue,c)||c==="+"||c==="-"||c==="."))C+=oA(c);else{if(c!==":"){if(r)return HD;C="",E=YD,S=0;continue}if(r&&(g.isSpecial()!==BD(cA,C)||C==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=C,r)return void(g.isSpecial()&&cA[g.scheme]===g.port&&(g.port=null));C="",g.scheme==="file"?E=ex:g.isSpecial()&&s&&s.scheme===g.scheme?E=B4:g.isSpecial()?E=G4:o[S+1]==="/"?(E=z4,S++):(g.cannotBeABaseURL=!0,gv(g.path,""),E=$4)}break;case YD:if(!s||s.cannotBeABaseURL&&c!=="#")return HD;if(s.cannotBeABaseURL&&c==="#"){g.scheme=s.scheme,g.path=Ad(s.path),g.query=s.query,g.fragment="",g.cannotBeABaseURL=!0,E=nf;break}E=s.scheme==="file"?ex:XD;continue;case B4:if(c!=="/"||o[S+1]!=="/"){E=XD;continue}E=lA,S++;break;case z4:if(c==="/"){E=uA;break}E=zh;continue;case XD:if(g.scheme=s.scheme,c===Ru)g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ad(s.path),g.query=s.query;else if(c==="/"||c==="\\"&&g.isSpecial())E=W4;else if(c==="?")g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ad(s.path),g.query="",E=U_;else{if(c!=="#"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ad(s.path),g.path.length--,E=zh;continue}g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ad(s.path),g.query=s.query,g.fragment="",E=nf}break;case W4:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,E=zh;continue}E=uA}else E=lA;break;case G4:if(E=lA,c!=="/"||Au(C,S+1)!=="/")continue;S++;break;case lA:if(c!=="/"&&c!=="\\"){E=uA;continue}break;case uA:if(c==="@"){A&&(C="%40"+C),A=!0,u=mv(C);for(var F=0;F<u.length;F++){var B=u[F];if(B!==":"||W){var Z=xm(B,KD);W?g.password+=Z:g.username+=Z}else W=!0}C=""}else if(c===Ru||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(A&&C==="")return"Invalid authority";S-=mv(C).length+1,C="",E=JD}else C+=c;break;case JD:case QD:if(r&&g.scheme==="file"){E=tx;continue}if(c!==":"||O){if(c===Ru||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&C==="")return M_;if(r&&C===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(C))return h;if(C="",E=_v,r)return;continue}c==="["?O=!0:c==="]"&&(O=!1),C+=c}else{if(C==="")return M_;if(h=g.parseHost(C))return h;if(C="",E=ZD,r===QD)return}break;case ZD:if(!Pd($D,c)){if(c===Ru||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(C!==""){var Q=sA(C,10);if(Q>65535)return x4;g.port=g.isSpecial()&&Q===cA[g.scheme]?null:Q,C=""}if(r)return;E=_v;continue}return x4}C+=c;break;case ex:if(g.scheme="file",c==="/"||c==="\\")E=H4;else{if(!s||s.scheme!=="file"){E=zh;continue}switch(c){case Ru:g.host=s.host,g.path=Ad(s.path),g.query=s.query;break;case"?":g.host=s.host,g.path=Ad(s.path),g.query="",E=U_;break;case"#":g.host=s.host,g.path=Ad(s.path),g.query=s.query,g.fragment="",E=nf;break;default:F4(yw(Ad(o,S),""))||(g.host=s.host,g.path=Ad(s.path),g.shortenPath()),E=zh;continue}}break;case H4:if(c==="/"||c==="\\"){E=tx;break}s&&s.scheme==="file"&&!F4(yw(Ad(o,S),""))&&(Sw(s.path[0],!0)?gv(g.path,s.path[0]):g.host=s.host),E=zh;continue;case tx:if(c===Ru||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&Sw(C))E=zh;else if(C===""){if(g.host="",r)return;E=_v}else{if(h=g.parseHost(C))return h;if(g.host==="localhost"&&(g.host=""),r)return;C="",E=_v}continue}C+=c;break;case _v:if(g.isSpecial()){if(E=zh,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Ru&&(E=zh,c!=="/"))continue}else g.fragment="",E=nf;else g.query="",E=U_;break;case zh:if(c===Ru||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((m=oA(m=C))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||gv(g.path,"")):Gue(C)?c==="/"||c==="\\"&&g.isSpecial()||gv(g.path,""):(g.scheme==="file"&&!g.path.length&&Sw(C)&&(g.host&&(g.host=""),C=Au(C,0)+":"),gv(g.path,C)),C="",g.scheme==="file"&&(c===Ru||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)Nue(g.path);c==="?"?(g.query="",E=U_):c==="#"&&(g.fragment="",E=nf)}else C+=xm(c,V4);break;case $4:c==="?"?(g.query="",E=U_):c==="#"?(g.fragment="",E=nf):c!==Ru&&(g.path[0]+=xm(c,aA));break;case U_:r||c!=="#"?c!==Ru&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":xm(c,aA)):(g.fragment="",E=nf);break;case nf:c!==Ru&&(g.fragment+=xm(c,U4))}S++}},parseHost:function(e){var r,s,o;if(Au(e,0)==="["){if(Au(e,e.length-1)!=="]"||(r=function(c){var u,h,m,g,E,S,C,A=[0,0,0,0,0,0,0,0],O=0,W=null,F=0,B=function(){return Au(c,F)};if(B()===":"){if(Au(c,1)!==":")return;F+=2,W=++O}for(;B();){if(O===8)return;if(B()!==":"){for(u=h=0;h<4&&Pd(M4,B());)u=16*u+sA(B(),16),F++,h++;if(B()==="."){if(h===0||(F-=h,O>6))return;for(m=0;B();){if(g=null,m>0){if(!(B()==="."&&m<4))return;F++}if(!Pd($D,B()))return;for(;Pd($D,B());){if(E=sA(B(),10),g===null)g=E;else{if(g===0)return;g=10*g+E}if(g>255)return;F++}A[O]=256*A[O]+g,++m!=2&&m!==4||O++}if(m!==4)return;break}if(B()===":"){if(F++,!B())return}else if(B())return;A[O++]=u}else{if(W!==null)return;F++,W=++O}}if(W!==null)for(S=O-W,O=7;O!==0&&S>0;)C=A[O],A[O--]=A[W+S-1],A[W+--S]=C;else if(O!==8)return;return A}(Ew(e,1,-1)),!r))return M_;this.host=r}else if(this.isSpecial()){if(e=wue(e),Pd(Fue,e)||(r=function(c){var u,h,m,g,E,S,C,A=Due(c,".");if(A.length&&A[A.length-1]===""&&A.length--,(u=A.length)>4)return c;for(h=[],m=0;m<u;m++){if((g=A[m])==="")return c;if(E=10,g.length>1&&Au(g,0)==="0"&&(E=Pd(Mue,g)?16:8,g=Ew(g,E===8?1:2)),g==="")S=0;else{if(!Pd(E===10?Vue:E===8?Uue:M4,g))return c;S=sA(g,E)}gv(h,S)}for(m=0;m<u;m++)if(S=h[m],m===u-1){if(S>=D4(256,5-u))return null}else if(S>255)return null;for(C=kue(h),m=0;m<h.length;m++)C+=h[m]*D4(256,3-m);return C}(e),r===null))return M_;this.host=r}else{if(Pd(jue,e))return M_;for(r="",s=mv(e),o=0;o<s.length;o++)r+=xm(s[o],aA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return BD(cA,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme==="file"&&r===1&&Sw(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,s=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,g=e.fragment,E=r+":";return c!==null?(E+="//",e.includesCredentials()&&(E+=s+(o?":"+o:"")+"@"),E+=vw(c),u!==null&&(E+=":"+u)):r==="file"&&(E+="//"),E+=e.cannotBeABaseURL?h[0]:h.length?"/"+yw(h,"/"):"",m!==null&&(E+="?"+m),g!==null&&(E+="#"+g),E},setHref:function(e){var r=this.parse(e);if(r)throw new WD(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e==="blob")try{return new yv(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+vw(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(tf(e)+":",qD)},getUsername:function(){return this.username},setUsername:function(e){var r=mv(tf(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=xm(r[s],KD)}},getPassword:function(){return this.password},setPassword:function(e){var r=mv(tf(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=xm(r[s],KD)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?vw(e):vw(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,JD)},getHostname:function(){var e=this.host;return e===null?"":vw(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,QD)},getPort:function(){var e=this.port;return e===null?"":tf(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=tf(e))===""?this.port=null:this.parse(e,ZD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+yw(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,_v))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=tf(e))===""?this.query=null:(Au(e,0)==="?"&&(e=Ew(e,1)),this.query="",this.parse(e,U_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=tf(e))!==""?(Au(e,0)==="#"&&(e=Ew(e,1)),this.fragment="",this.parse(e,nf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var yv=function(e){var r=Sue(this,Rc),s=Rue(arguments.length,1)>1?arguments[1]:void 0,o=Cue(r,new nx(e,!1,s));FD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},Rc=yv.prototype,Pu=function(e,r){return{get:function(){return iA(this)[e]()},set:r&&function(s){return iA(this)[r](s)},configurable:!0,enumerable:!0}};if(FD&&(Iu(Rc,"href",Pu("serialize","setHref")),Iu(Rc,"origin",Pu("getOrigin")),Iu(Rc,"protocol",Pu("getProtocol","setProtocol")),Iu(Rc,"username",Pu("getUsername","setUsername")),Iu(Rc,"password",Pu("getPassword","setPassword")),Iu(Rc,"host",Pu("getHost","setHost")),Iu(Rc,"hostname",Pu("getHostname","setHostname")),Iu(Rc,"port",Pu("getPort","setPort")),Iu(Rc,"pathname",Pu("getPathname","setPathname")),Iu(Rc,"search",Pu("getSearch","setSearch")),Iu(Rc,"searchParams",Pu("getSearchParams")),Iu(Rc,"hash",Pu("getHash","setHash"))),rA(Rc,"toJSON",function(){return iA(this).serialize()},{enumerable:!0}),rA(Rc,"toString",function(){return iA(this).serialize()},{enumerable:!0}),_w){var K4=_w.createObjectURL,q4=_w.revokeObjectURL;K4&&rA(yv,"createObjectURL",O4(K4,_w)),q4&&rA(yv,"revokeObjectURL",O4(q4,_w))}Tue(yv,"URL"),Eue({global:!0,forced:!vue,sham:!FD},{URL:yv});var Hue=Wn,Y4=d,$ue=Hc,X4=Ga,Kue=JI,rx=Mt("URL"),que=Kue&&Y4(function(){rx.canParse()}),Yue=Y4(function(){return rx.canParse.length!==1});Hue({target:"URL",stat:!0,forced:!que||Yue},{canParse:function(e){var r=$ue(arguments.length,1),s=X4(e),o=r<2||arguments[1]===void 0?void 0:X4(arguments[1]);try{return!!new rx(s,o)}catch{return!1}}});var Xue=Wn,Jue=Hc,J4=Ga,Que=JI,Zue=Mt("URL");Xue({target:"URL",stat:!0,forced:!Que},{parse:function(e){var r=Jue(arguments.length,1),s=J4(e),o=r<2||arguments[1]===void 0?void 0:J4(arguments[1]);try{return new Zue(s,o)}catch{return null}}});var dA=l(xe.URL);let Q4=!0,Z4=!0;function hA(e,r,s){const o=e.match(r);return o&&o.length>=s&&parseInt(o[s],10)}function V_(e,r,s){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const g=E=>{const S=s(E);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,g),c.apply(this,[h,g])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const g=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,g])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function ede(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Q4=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function tde(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Z4=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function eB(){if(typeof window=="object"){if(Q4)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ix(e,r){Z4&&console.warn(e+" is deprecated, please use "+r+" instead.")}function tB(e){return Object.prototype.toString.call(e)==="[object Object]"}function nB(e){var r;return tB(e)?Ha(r=Object.keys(e)).call(r,function(s,o){const c=tB(e[o]),u=c?nB(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?s:Object.assign(s,{[o]:u})},{}):e}function sx(e,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?sx(e,e.get(r[o]),s):o.endsWith("Ids")&&r[o].forEach(c=>{sx(e,e.get(c),s)})}))}function rB(e,r,s){const o=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&sx(e,m,c)})}),c}const iB=eB;function sB(e,r){const s=e&&e.navigator;if(!s.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const E=typeof h[g]=="object"?h[g]:{ideal:h[g]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const S=function(C,A){return C?C+A.charAt(0).toUpperCase()+A.slice(1):A==="deviceId"?"sourceId":A};if(E.ideal!==void 0){m.optional=m.optional||[];let C={};typeof E.ideal=="number"?(C[S("min",g)]=E.ideal,m.optional.push(C),C={},C[S("max",g)]=E.ideal,m.optional.push(C)):(C[S("",g)]=E.ideal,m.optional.push(C))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",g)]=E.exact):["min","max"].forEach(C=>{E[C]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(C,g)]=E[C])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(E,S,C){S in E&&!(C in E)&&(E[C]=E[S],delete E[S])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const E=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||E)){let S;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?S=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(S=["front"]),S)return s.mediaDevices.enumerateDevices().then(C=>{C=C.filter(O=>O.kind==="videoinput");let A=C.find(O=>S.some(W=>{var F;return et(F=O.label.toLowerCase()).call(F,W)}));return!A&&C.length&&et(S).call(S,"back")&&(A=C[C.length-1]),A&&(h.video.deviceId=g.exact?{exact:A.deviceId}:{ideal:A.deviceId}),h.video=o(h.video),iB("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return iB("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,g){c(h,E=>{s.webkitGetUserMedia(E,m,S=>{g&&g(u(S))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,g=>h(g).then(E=>{if(g.audio&&!E.getAudioTracks().length||g.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>gt.reject(u(E))))}}}function oB(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function aB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)}),s.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else V_(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function cB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let g=c.apply(this,arguments);return g||(g=r(this,h),this._senders.push(g)),g};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function lB(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const u=function(m){const g={};return m.result().forEach(E=>{const S={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(C=>{S[C]=E.stat(C)}),g[S.id]=S}),g},h=function(m){return new Map(Object.keys(m).map(g=>[g,m[g]]))};if(arguments.length>=2){const m=function(g){o(h(u(g)))};return r.apply(this,[m,s])}return new gt((m,g)=>{r.apply(this,[function(E){m(h(u(E)))},g])}).then(o,c)}}function uB(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>rB(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=s.apply(this,[]);return o.forEach(c=>c._pc=this),o}),V_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>rB(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const s=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===s&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?u=!0:c=h),h.track===s)),u||o&&c?gt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():gt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function dB(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(g=>{if(this.getSenders().find(S=>S.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(g=>h.indexOf(g)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function hB(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return dB(e);const s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const g=s.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(E=>this._reverseStreams[E.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(E=>{if(this.getSenders().find(C=>C.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const E=new e.MediaStream(g.getTracks());this._streams[g.id]=E,this._reverseStreams[E.id]=g,g=E}o.apply(this,[g])};const c=e.RTCPeerConnection.prototype.removeStream;function u(g,E){let S=E.sdp;return Object.keys(g._reverseStreams||[]).forEach(C=>{const A=g._reverseStreams[C],O=g._streams[A.id];S=S.replace(new RegExp(O.id,"g"),A.id)}),new RTCSessionDescription({type:E.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},e.RTCPeerConnection.prototype.addTrack=function(g,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(O=>O===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(O=>O.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[E.id];if(A)A.addTrack(g),gt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const O=new e.MediaStream([g]);this._streams[E.id]=O,this._reverseStreams[O.id]=E,this.addStream(O)}return this.getSenders().find(O=>O.track===g)},["createOffer","createAnswer"].forEach(function(g){const E=e.RTCPeerConnection.prototype[g],S={[g](){const C=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[A=>{const O=u(this,A);C[0].apply(null,[O])},A=>{C[1]&&C[1].apply(null,A)},arguments[2]]):E.apply(this,arguments).then(A=>u(this,A))}};e.RTCPeerConnection.prototype[g]=S[g]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(g,E){let S=E.sdp;return Object.keys(g._reverseStreams||[]).forEach(C=>{const A=g._reverseStreams[C],O=g._streams[A.id];S=S.replace(new RegExp(A.id,"g"),O.id)}),new RTCSessionDescription({type:E.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const g=m.get.apply(this);return g.type===""?g:u(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(C=>g.track===C)&&(E=this._streams[S])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ox(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=e.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=c[s]})}function pB(e,r){V_(e,"negotiationneeded",s=>{const o=s.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return s})}var fB=Object.freeze({__proto__:null,fixNegotiationNeeded:pB,shimAddTrackRemoveTrack:hB,shimAddTrackRemoveTrackWithNative:dB,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(o=>{const c=s.video&&s.video.width,u=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),u&&(s.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:cB,shimGetStats:lB,shimGetUserMedia:sB,shimMediaStream:oB,shimOnTrack:aB,shimPeerConnection:ox,shimSenderReceiverGetStats:uB});function mB(e,r){const s=e&&e.navigator,o=e&&e.MediaStreamTrack;if(s.getUserMedia=function(c,u,h){ix("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},u=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function gB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ax(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(g=>{g.type=s[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;m.forEach((E,S)=>{m.set(S,Object.assign({},E,{type:s[E.type]||E.type}))})}return m}).then(u,h)}}function _B(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):gt.resolve(new Map)}}function yB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s}),V_(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function EB(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){ix("removeStream","removeTrack"),this.getSenders().forEach(s=>{var o;s.track&&et(o=r.getTracks()).call(o,s.track)&&this.removeTrack(s)})})}function vB(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function SB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const o=s.length>0;o&&s.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,u.sendEncodings=s,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function bB(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function wB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?gt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function TB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?gt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var RB=Object.freeze({__proto__:null,shimAddTransceiver:SB,shimCreateAnswer:TB,shimCreateOffer:wB,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,gt.reject(o)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:bB,shimGetUserMedia:mB,shimOnTrack:gB,shimPeerConnection:ax,shimRTCDataChannel:vB,shimReceiverGetStats:yB,shimRemoveStream:EB,shimSenderGetStats:_B});function CB(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(s){var o;this._localStreams||(this._localStreams=[]),et(o=this._localStreams).call(o,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},e.RTCPeerConnection.prototype.addTrack=function(s){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?et(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const o=r.getTracks();this.getSenders().forEach(c=>{et(o).call(o,c.track)&&this.removeTrack(c)})})}}function IB(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),et(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,s.dispatchEvent(u)})}),r.apply(s,arguments)}}}function AB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,s=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(g,E){const S=arguments.length>=2?arguments[2]:arguments[0],C=s.apply(this,[S]);return E?(C.then(g,E),gt.resolve()):C},r.createAnswer=function(g,E){const S=arguments.length>=2?arguments[2]:arguments[0],C=o.apply(this,[S]);return E?(C.then(g,E),gt.resolve()):C};let m=function(g,E,S){const C=c.apply(this,[g]);return S?(C.then(E,S),gt.resolve()):C};r.setLocalDescription=m,m=function(g,E,S){const C=u.apply(this,[g]);return S?(C.then(E,S),gt.resolve()):C},r.setRemoteDescription=m,m=function(g,E,S){const C=h.apply(this,[g]);return S?(C.then(E,S),gt.resolve()):C},r.addIceCandidate=m}function PB(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,o=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>o(OB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,o,c){r.mediaDevices.getUserMedia(s).then(o,c)}).bind(r))}function OB(e){return e&&e.video!==void 0?Object.assign({},e,{video:nB(e.video)}):e}function kB(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(s,o){if(s&&s.iceServers){const c=[];for(let u=0;u<s.iceServers.length;u++){let h=s.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(ix("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[u])}s.iceServers=c}return new r(s,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function NB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function DB(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function xB(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var LB=Object.freeze({__proto__:null,shimAudioContext:xB,shimCallbacksAPI:AB,shimConstraints:OB,shimCreateOfferLegacy:DB,shimGetUserMedia:PB,shimLocalStreamsAPI:CB,shimRTCIceServerUrls:kB,shimRemoteStreamsAPI:IB,shimTrackEventTransceiver:NB}),MB=`	
\v\f\r \u2028\u2029\uFEFF`,nde=mt,rde=Ga,cx=MB,UB=I("".replace),ide=RegExp("^["+cx+"]+"),sde=RegExp("(^|[^"+cx+"])["+cx+"]+$"),ode=function(e){return function(r){var s=rde(nde(r));return 1&e&&(s=UB(s,ide,"")),2&e&&(s=UB(s,sde,"$1")),s}},ade={trim:ode(3)},cde=jE.PROPER,lde=d,VB=MB,ude=ade.trim;Wn({target:"String",proto:!0,forced:function(e){return lde(function(){return!!VB[e]()||""[e]()!==""||cde&&VB[e].name!==e})}("trim")},{trim:function(){return ude(this)}});var dde=_c("String","trim"),hde=k,pde=dde,lx=String.prototype,fde=function(e){var r=e.trim;return typeof e=="string"||e===lx||hde(lx,e)&&r===lx.trim?pde:r},No=l(fde),FB={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(s){return s.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(s){const o=r.splitSections(s);return o&&o[0]},r.getMediaSections=function(s){const o=r.splitSections(s);return o.shift(),o},r.matchPrefix=function(s,o){return r.splitLines(s).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(s){let o;o=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(s){const o=[];o.push(s.foundation);const c=s.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);const u=s.type;return o.push("typ"),o.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let o=s.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let o=s.payloadType;s.preferredPayloadType!==void 0&&(o=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const o=s.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const o={};let c;const u=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(s){let o="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const u=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?u.push(h+"="+s.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(s){const o=s.substring(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(s){let o="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(s){const o=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,o),10)},u=s.indexOf(":",o);return u>-1?(c.attribute=s.substring(o+1,u),c.value=s.substring(u+1)):c.attribute=s.substring(o+1),c},r.parseSsrcGroup=function(s){const o=s.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(s){const o=r.matchPrefix(s,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(s){const o=s.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:r.matchPrefix(s+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,o){let c="a=setup:"+o+`\r
`;return s.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(s){const o=s.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const o=s.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,o){return r.matchPrefix(s+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,o){const c=r.matchPrefix(s+o,"a=ice-ufrag:")[0],u=r.matchPrefix(s+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(s){let o="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(s){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],g=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(g){const E=r.parseRtpMap(g),S=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(E.parameters=S.length?r.parseFmtp(S[0]):{},E.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(g=>g.type===m.type&&g.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(s,o){let c="";c+="m="+s+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const o=[],c=r.parseRtpParameters(s),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(A=>r.parseSsrcMedia(A)).filter(A=>A.attribute==="cname"),g=m.length>0&&m[0].ssrc;let E;const S=r.matchPrefix(s,"a=ssrc-group:FID").map(A=>A.substring(17).split(" ").map(O=>parseInt(O,10)));S.length>0&&S[0].length>1&&S[0][0]===g&&(E=S[0][1]),c.codecs.forEach(A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let O={ssrc:g,codecPayloadType:parseInt(A.parameters.apt,10)};g&&E&&(O.rtx={ssrc:E}),o.push(O),u&&(O=JSON.parse(JSON.stringify(O)),O.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},o.push(O))}}),o.length===0&&g&&o.push({ssrc:g});let C=r.matchPrefix(s,"b=");return C.length&&(C=C[0].indexOf("b=TIAS:")===0?parseInt(C[0].substring(7),10):C[0].indexOf("b=AS:")===0?1e3*parseInt(C[0].substring(5),10)*.95-16e3:void 0,o.forEach(A=>{A.maxBitrate=C})),o},r.parseRtcpParameters=function(s){const o={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(s){let o="";return s.reducedSize&&(o+=`a=rtcp-rsize\r
`),s.mux&&(o+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(o+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),o},r.parseMsid=function(s){let o;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(s){const o=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:u}}},r.writeSctpDescription=function(s,o){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,o,c){let u;const h=o!==void 0?o:2;return u=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,o){const c=r.splitLines(s);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const o=r.splitLines(s)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(s){const o=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const o=r.splitLines(s);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=r})(FB);var jB=FB.exports,Ev=l(jB),mde=i({__proto__:null,default:Ev},[jB]);function pA(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const o=new r(s),c=Ev.parseCandidate(s.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(s)},e.RTCIceCandidate.prototype=r.prototype,V_(e,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new e.RTCIceCandidate(s.candidate),writable:"false"}),s))}function ux(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||V_(e,"icecandidate",r=>{if(r.candidate){const s=Ev.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function fA(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const g=Ev.splitSections(m.sdp);return g.shift(),g.some(E=>{const S=Ev.parseMLine(E);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const E=parseInt(g[1],10);return E!=E?-1:E},c=function(m){let g=65536;return r.browser==="firefox"&&(g=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},u=function(m,g){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const S=Ev.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?E=parseInt(S[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(E=2147483637),E},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=o(arguments[0]),g=c(m),E=u(arguments[0],m);let S;S=g===0&&E===0?Number.POSITIVE_INFINITY:g===0||E===0?Math.max(g,E):Math.min(g,E);const C={};Object.defineProperty(C,"maxMessageSize",{get:()=>S}),this._sctp=C}return h.apply(this,arguments)}}function mA(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=s.apply(this,arguments);return r(o,this),o},V_(e,"datachannel",o=>(r(o.channel,o.target),o))}function dx(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const o=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function hx(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>No(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return s.apply(this,arguments)}}function gA(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?gt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),gt.resolve())})}function _A(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return s.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?s.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var gde=Object.freeze({__proto__:null,removeExtmapAllowMixed:hx,shimAddIceCandidateNullOrEmpty:gA,shimConnectionState:dx,shimMaxMessageSize:fA,shimParameterlessSetLocalDescription:_A,shimRTCIceCandidate:pA,shimRTCIceCandidateRelayProtocol:ux,shimSendThrowTypeError:mA});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=eB,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=hA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=hA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=hA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:gde,extractVersion:hA,disableLog:ede,disableWarnings:tde,sdp:mde};switch(o.browser){case"chrome":if(!fB||!ox||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(o.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=fB,gA(e,o),_A(e),sB(e,o),oB(e),ox(e,o),aB(e),hB(e,o),cB(e),lB(e),uB(e),pB(e,o),pA(e),ux(e),dx(e),fA(e,o),mA(e),hx(e,o);break;case"firefox":if(!RB||!ax||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=RB,gA(e,o),_A(e),mB(e,o),ax(e,o),gB(e),EB(e),_B(e),yB(e),vB(e),SB(e),bB(e),wB(e),TB(e),pA(e),dx(e),fA(e,o),mA(e);break;case"safari":if(!LB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=LB,gA(e,o),_A(e),kB(e),DB(e),AB(e),CB(e),IB(e),NB(e),PB(e),xB(e),pA(e),ux(e),fA(e,o),mA(e),hx(e,o);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var px=L;Wn({global:!0,forced:px.globalThis!==px},{globalThis:px});var BB=l(L),fx={exports:{}};(function(e,r){(function(s,o){var c="function",u="undefined",h="object",m="string",g="major",E="model",S="name",C="type",A="vendor",O="version",W="architecture",F="console",B="mobile",Z="tablet",Q="smarttv",ae="wearable",ye="embedded",_e="Amazon",ue="Apple",Ie="ASUS",Ue="BlackBerry",We="Browser",Je="Chrome",pn="Firefox",En="Google",Jt="Huawei",tr="LG",qn="Microsoft",io="Motorola",ze="Opera",nt="Samsung",St="Sharp",He="Sony",U="Xiaomi",le="Zebra",me="Facebook",Ze="Chromium OS",on="Mac OS",wr=" Browser",Fi=function(Li){for(var ji={},Nr=0;Nr<Li.length;Nr++)ji[Li[Nr].toUpperCase()]=Li[Nr];return ji},Kl=function(Li,ji){return typeof Li===m&&Wu(ji).indexOf(Wu(Li))!==-1},Wu=function(Li){return Li.toLowerCase()},RT=function(Li,ji){if(typeof Li===m)return Li=Li.replace(/^\s\s*/,""),typeof ji===u?Li:Li.substring(0,500)},hy=function(Li,ji){for(var Nr,nc,Hd,_i,_f,xn,$d=0;$d<ji.length&&!_f;){var py=ji[$d],sp=ji[$d+1];for(Nr=nc=0;Nr<py.length&&!_f&&py[Nr];)if(_f=py[Nr++].exec(Li))for(Hd=0;Hd<sp.length;Hd++)xn=_f[++nc],typeof(_i=sp[Hd])===h&&_i.length>0?_i.length===2?typeof _i[1]==c?this[_i[0]]=_i[1].call(this,xn):this[_i[0]]=_i[1]:_i.length===3?typeof _i[1]!==c||_i[1].exec&&_i[1].test?this[_i[0]]=xn?xn.replace(_i[1],_i[2]):o:this[_i[0]]=xn?_i[1].call(this,xn,_i[2]):o:_i.length===4&&(this[_i[0]]=xn?_i[3].call(this,xn.replace(_i[1],_i[2])):o):this[_i]=xn||o;$d+=2}},hS=function(Li,ji){for(var Nr in ji)if(typeof ji[Nr]===h&&ji[Nr].length>0){for(var nc=0;nc<ji[Nr].length;nc++)if(Kl(ji[Nr][nc],Li))return Nr==="?"?o:Nr}else if(Kl(ji[Nr],Li))return Nr==="?"?o:Nr;return ji.hasOwnProperty("*")?ji["*"]:Li},_1={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},y1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[O,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[O,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,O],[/opios[\/ ]+([\w\.]+)/i],[O,[S,ze+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[O,[S,ze+" GX"]],[/\bopr\/([\w\.]+)/i],[O,[S,ze]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[O,[S,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[O,[S,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[S,O],[/quark(?:pc)?\/([-\w\.]+)/i],[O,[S,"Quark"]],[/\bddg\/([\w\.]+)/i],[O,[S,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[O,[S,"UC"+We]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[O,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[O,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[O,[S,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[O,[S,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[O,[S,"Smart Lenovo "+We]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+We],O],[/\bfocus\/([\w\.]+)/i],[O,[S,pn+" Focus"]],[/\bopt\/([\w\.]+)/i],[O,[S,ze+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[O,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[O,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[O,[S,ze+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[O,[S,"MIUI"+wr]],[/fxios\/([\w\.-]+)/i],[O,[S,pn]],[/\bqihoobrowser\/?([\w\.]*)/i],[O,[S,"360"]],[/\b(qq)\/([\w\.]+)/i],[[S,/(.+)/,"$1Browser"],O],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1"+wr],O],[/samsungbrowser\/([\w\.]+)/i],[O,[S,nt+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[O,[S,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[S,"Sogou Mobile"],O],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[S,O],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[S],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[O,S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,me],O],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[S,O],[/\bgsa\/([\w\.]+) .*safari\//i],[O,[S,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[O,[S,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[O,[S,Je+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,Je+" WebView"],O],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[O,[S,"Android "+We]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,O],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[O,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[O,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[O,hS,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,O],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],O],[/(wolvic|librewolf)\/([\w\.]+)/i],[S,O],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[O,[S,pn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[S,[O,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[S,[O,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[W,"amd64"]],[/(ia32(?=;))/i],[[W,Wu]],[/((?:i[346]|x)86)[;\)]/i],[[W,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[W,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[W,"armhf"]],[/windows (ce|mobile); ppc;/i],[[W,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[W,/ower/,"",Wu]],[/(sun4\w)[;\)]/i],[[W,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[W,Wu]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[A,nt],[C,Z]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[E,[A,nt],[C,B]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[E,[A,ue],[C,B]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[A,ue],[C,Z]],[/(macintosh);/i],[E,[A,ue]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[A,St],[C,B]],[/(?:honor)([-\w ]+)[;\)]/i],[E,[A,"Honor"],[C,B]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[A,Jt],[C,Z]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[A,Jt],[C,B]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[E,/_/g," "],[A,U],[C,B]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[A,U],[C,Z]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[A,"OPPO"],[C,B]],[/\b(opd2\d{3}a?) bui/i],[E,[A,"OPPO"],[C,Z]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[A,"Vivo"],[C,B]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[E,[A,"Realme"],[C,B]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[A,io],[C,B]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[A,io],[C,Z]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[A,tr],[C,Z]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[A,tr],[C,B]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[A,"Lenovo"],[C,Z]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[A,"Nokia"],[C,B]],[/(pixel c)\b/i],[E,[A,En],[C,Z]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[A,En],[C,B]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[A,He],[C,B]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[A,He],[C,Z]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[A,"OnePlus"],[C,B]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[A,_e],[C,Z]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[A,_e],[C,B]],[/(playbook);[-\w\),; ]+(rim)/i],[E,A,[C,Z]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[A,Ue],[C,B]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[A,Ie],[C,Z]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[A,Ie],[C,B]],[/(nexus 9)/i],[E,[A,"HTC"],[C,Z]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[E,/_/g," "],[C,B]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[E,[A,"TCL"],[C,Z]],[/(itel) ((\w+))/i],[[A,Wu],E,[C,hS,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[A,"Acer"],[C,Z]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[A,"Meizu"],[C,B]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[E,[A,"Ulefone"],[C,B]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[E,[A,"Energizer"],[C,B]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[E,[A,"Cat"],[C,B]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[E,[A,"Smartfren"],[C,B]],[/droid.+; (a(?:015|06[35]|142p?))/i],[E,[A,"Nothing"],[C,B]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,E,[C,B]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,E,[C,Z]],[/(surface duo)/i],[E,[A,qn],[C,Z]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[A,"Fairphone"],[C,B]],[/(u304aa)/i],[E,[A,"AT&T"],[C,B]],[/\bsie-(\w*)/i],[E,[A,"Siemens"],[C,B]],[/\b(rct\w+) b/i],[E,[A,"RCA"],[C,Z]],[/\b(venue[\d ]{2,7}) b/i],[E,[A,"Dell"],[C,Z]],[/\b(q(?:mv|ta)\w+) b/i],[E,[A,"Verizon"],[C,Z]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[A,"Barnes & Noble"],[C,Z]],[/\b(tm\d{3}\w+) b/i],[E,[A,"NuVision"],[C,Z]],[/\b(k88) b/i],[E,[A,"ZTE"],[C,Z]],[/\b(nx\d{3}j) b/i],[E,[A,"ZTE"],[C,B]],[/\b(gen\d{3}) b.+49h/i],[E,[A,"Swiss"],[C,B]],[/\b(zur\d{3}) b/i],[E,[A,"Swiss"],[C,Z]],[/\b((zeki)?tb.*\b) b/i],[E,[A,"Zeki"],[C,Z]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],E,[C,Z]],[/\b(ns-?\w{0,9}) b/i],[E,[A,"Insignia"],[C,Z]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[A,"NextBook"],[C,Z]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],E,[C,B]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],E,[C,B]],[/\b(ph-1) /i],[E,[A,"Essential"],[C,B]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[A,"Envizen"],[C,Z]],[/\b(trio[-\w\. ]+) b/i],[E,[A,"MachSpeed"],[C,Z]],[/\btu_(1491) b/i],[E,[A,"Rotor"],[C,Z]],[/(shield[\w ]+) b/i],[E,[A,"Nvidia"],[C,Z]],[/(sprint) (\w+)/i],[A,E,[C,B]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[A,qn],[C,B]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[A,le],[C,Z]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[A,le],[C,B]],[/smart-tv.+(samsung)/i],[A,[C,Q]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[A,nt],[C,Q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,tr],[C,Q]],[/(apple) ?tv/i],[A,[E,ue+" TV"],[C,Q]],[/crkey/i],[[E,Je+"cast"],[A,En],[C,Q]],[/droid.+aft(\w+)( bui|\))/i],[E,[A,_e],[C,Q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[A,St],[C,Q]],[/(bravia[\w ]+)( bui|\))/i],[E,[A,He],[C,Q]],[/(mitv-\w{5}) bui/i],[E,[A,U],[C,Q]],[/Hbbtv.*(technisat) (.*);/i],[A,E,[C,Q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,RT],[E,RT],[C,Q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[C,Q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,E,[C,F]],[/droid.+; (shield) bui/i],[E,[A,"Nvidia"],[C,F]],[/(playstation [345portablevi]+)/i],[E,[A,He],[C,F]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[A,qn],[C,F]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[E,[A,nt],[C,ae]],[/((pebble))app/i],[A,E,[C,ae]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[A,ue],[C,ae]],[/droid.+; (glass) \d/i],[E,[A,En],[C,ae]],[/droid.+; (wt63?0{2,3})\)/i],[E,[A,le],[C,ae]],[/droid.+; (glass) \d/i],[E,[A,En],[C,ae]],[/(pico) (4|neo3(?: link|pro)?)/i],[A,E,[C,ae]],[/; (quest( \d| pro)?)/i],[E,[A,me],[C,ae]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[C,ye]],[/(aeobc)\b/i],[E,[A,_e],[C,ye]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[E,[C,B]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[C,Z]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[C,Z]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[C,B]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[O,[S,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[S,O],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[O,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[S,O],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[O,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,O],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[S,[O,hS,_1]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[O,hS,_1],[S,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[O,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,on],[O,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[O,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,O],[/\(bb(10);/i],[O,[S,Ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[O,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[O,[S,pn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[O,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[O,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[O,[S,Je+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Ze],O],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,O],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],O],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[S,O]]},ql=function(Li,ji){if(typeof Li===h&&(ji=Li,Li=o),!(this instanceof ql))return new ql(Li,ji).getResult();var Nr=typeof s!==u&&s.navigator?s.navigator:o,nc=Li||(Nr&&Nr.userAgent?Nr.userAgent:""),Hd=Nr&&Nr.userAgentData?Nr.userAgentData:o,_i=ji?function(xn,$d){var py={};for(var sp in xn)$d[sp]&&$d[sp].length%2==0?py[sp]=$d[sp].concat(xn[sp]):py[sp]=xn[sp];return py}(y1,ji):y1,_f=Nr&&Nr.userAgent==nc;return this.getBrowser=function(){var xn={};return xn[S]=o,xn[O]=o,hy.call(xn,nc,_i.browser),xn[g]=function($d){return typeof $d===m?$d.replace(/[^\d\.]/g,"").split(".")[0]:o}(xn[O]),_f&&Nr&&Nr.brave&&typeof Nr.brave.isBrave==c&&(xn[S]="Brave"),xn},this.getCPU=function(){var xn={};return xn[W]=o,hy.call(xn,nc,_i.cpu),xn},this.getDevice=function(){var xn={};return xn[A]=o,xn[E]=o,xn[C]=o,hy.call(xn,nc,_i.device),_f&&!xn[C]&&Hd&&Hd.mobile&&(xn[C]=B),_f&&xn[E]=="Macintosh"&&Nr&&typeof Nr.standalone!==u&&Nr.maxTouchPoints&&Nr.maxTouchPoints>2&&(xn[E]="iPad",xn[C]=Z),xn},this.getEngine=function(){var xn={};return xn[S]=o,xn[O]=o,hy.call(xn,nc,_i.engine),xn},this.getOS=function(){var xn={};return xn[S]=o,xn[O]=o,hy.call(xn,nc,_i.os),_f&&!xn[S]&&Hd&&Hd.platform&&Hd.platform!="Unknown"&&(xn[S]=Hd.platform.replace(/chrome os/i,Ze).replace(/macos/i,on)),xn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return nc},this.setUA=function(xn){return nc=typeof xn===m&&xn.length>500?RT(xn,500):xn,this},this.setUA(nc),this};ql.VERSION="0.7.40",ql.BROWSER=Fi([S,O,g]),ql.CPU=Fi([W]),ql.DEVICE=Fi([E,A,C,F,B,Q,Z,ae,ye]),ql.ENGINE=ql.OS=Fi([S,O]),e.exports&&(r=e.exports=ql),r.UAParser=ql;var gf=typeof s!==u&&(s.jQuery||s.Zepto);if(gf&&!gf.ua){var E1=new ql;gf.ua=E1.getResult(),gf.ua.get=function(){return E1.getUA()},gf.ua.set=function(Li){E1.setUA(Li);var ji=E1.getResult();for(var Nr in ji)gf.ua[Nr]=ji[Nr]}}})(typeof window=="object"?window:a)})(fx,fx.exports);var _de=l(fx.exports),zB=Rm.clear;Wn({global:!0,bind:!0,forced:L.clearImmediate!==zB},{clearImmediate:zB});var WB=L,yde=ne,Ede=fe,vde=Jg,Sde=dn,bde=_s,wde=Hc,Tde=WB.Function,Rde=/MSIE .\./.test(Sde)||vde==="BUN"&&function(){var e=WB.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Cde=Wn,GB=L,HB=Rm.set,Ide=function(e,r){var s=1;return Rde?function(o,c){var u=wde(arguments.length,1)>s,h=Ede(o)?o:Tde(o),m=u?bde(arguments,s):[],g=u?function(){yde(h,this,m)}:h;return e(g)}:e},$B=GB.setImmediate?Ide(HB):HB;Cde({global:!0,bind:!0,forced:GB.setImmediate!==$B},{setImmediate:$B});var KB=l(xe.setImmediate),Ade=L,Pde=dw,Ode=Sr,kde=Hc,Nde=ve;Wn({global:!0,dontCallGetSet:!0,forced:d(function(){return Nde&&Object.getOwnPropertyDescriptor(Ade,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){kde(arguments.length,1),Pde(Ode(e))}});var qB=l(xe.queueMicrotask);function YB(e,r){return function(){return e.apply(r,arguments)}}const{toString:Dde}=Object.prototype,{getPrototypeOf:mx}=Object,{iterator:yA,toStringTag:XB}=Symbol,EA=(gx=Object.create(null),e=>{const r=Dde.call(e);return gx[r]||(gx[r]=r.slice(8,-1).toLowerCase())});var gx;const Od=e=>(e=e.toLowerCase(),r=>EA(r)===e),vA=e=>r=>typeof r===e,{isArray:vv}=Array,bw=vA("undefined"),JB=Od("ArrayBuffer"),xde=vA("string"),qc=vA("function"),QB=vA("number"),SA=e=>e!==null&&typeof e=="object",bA=e=>{if(EA(e)!=="object")return!1;const r=mx(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||XB in e||yA in e)},Lde=Od("Date"),Mde=Od("File"),Ude=Od("Blob"),Vde=Od("FileList"),Fde=Od("URLSearchParams"),[jde,Bde,zde,Wde]=["ReadableStream","Request","Response","Headers"].map(Od);function ww(e,r){let s,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),vv(e))for(s=0,o=e.length;s<o;s++)r.call(null,e[s],s,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(s=0;s<h;s++)m=u[s],r.call(null,e[m],m,e)}}function ZB(e,r){r=r.toLowerCase();const s=Object.keys(e);let o,c=s.length;for(;c-- >0;)if(o=s[c],r===o.toLowerCase())return o;return null}const F_=BB!==void 0?BB:typeof self<"u"?self:typeof window<"u"?window:Sy,e6=e=>!bw(e)&&e!==F_,Gde=(_x=typeof Uint8Array<"u"&&mx(Uint8Array),e=>_x&&e instanceof _x);var _x;const Hde=Od("HTMLFormElement"),t6=(e=>{let{hasOwnProperty:r}=e;return(s,o)=>r.call(s,o)})(Object.prototype),$de=Od("RegExp"),n6=(e,r)=>{const s=Object.getOwnPropertyDescriptors(e),o={};ww(s,(c,u)=>{let h;(h=r(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},Kde=Od("AsyncFunction"),r6=(i6=typeof KB=="function",s6=qc(F_.postMessage),i6?KB:s6?(yx="axios@".concat(Math.random()),wA=[],F_.addEventListener("message",e=>{let{source:r,data:s}=e;r===F_&&s===yx&&wA.length&&wA.shift()()},!1),e=>{wA.push(e),F_.postMessage(yx,"*")}):e=>setTimeout(e));var i6,s6,yx,wA;const qde=qB!==void 0?qB.bind(F_):typeof process<"u"&&process.nextTick||r6;var ft={isArray:vv,isArrayBuffer:JB,isBuffer:function(e){return e!==null&&!bw(e)&&e.constructor!==null&&!bw(e.constructor)&&qc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||qc(e.append)&&((r=EA(e))==="formdata"||r==="object"&&qc(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&JB(e.buffer),r},isString:xde,isNumber:QB,isBoolean:e=>e===!0||e===!1,isObject:SA,isPlainObject:bA,isReadableStream:jde,isRequest:Bde,isResponse:zde,isHeaders:Wde,isUndefined:bw,isDate:Lde,isFile:Mde,isBlob:Ude,isRegExp:$de,isFunction:qc,isStream:e=>SA(e)&&qc(e.pipe),isURLSearchParams:Fde,isTypedArray:Gde,isFileList:Vde,forEach:ww,merge:function e(){const{caseless:r}=e6(this)&&this||{},s={},o=(c,u)=>{const h=r&&ZB(s,u)||u;bA(s[h])&&bA(c)?s[h]=e(s[h],c):bA(c)?s[h]=e({},c):vv(c)?s[h]=c.slice():s[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&ww(arguments[c],o);return s},extend:function(e,r,s){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return ww(r,(c,u)=>{s&&qc(c)?e[u]=YB(c,s):e[u]=c},{allOwnKeys:o}),e},trim:e=>No(e)?No(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,s,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,r,s,o)=>{let c,u,h;const m={};if(r=r||{},e==null)return r;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,r)||m[h]||(r[h]=e[h],m[h]=!0);e=s!==!1&&mx(e)}while(e&&(!s||s(e,r))&&e!==Object.prototype);return r},kindOf:EA,kindOfTest:Od,endsWith:(e,r,s)=>{e=String(e),(s===void 0||s>e.length)&&(s=e.length),s-=r.length;const o=e.indexOf(r,s);return o!==-1&&o===s},toArray:e=>{if(!e)return null;if(vv(e))return e;let r=e.length;if(!QB(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=e[r];return s},forEachEntry:(e,r)=>{const s=(e&&e[yA]).call(e);let o;for(;(o=s.next())&&!o.done;){const c=o.value;r.call(e,c[0],c[1])}},matchAll:(e,r)=>{let s;const o=[];for(;(s=e.exec(r))!==null;)o.push(s);return o},isHTMLForm:Hde,hasOwnProperty:t6,hasOwnProp:t6,reduceDescriptors:n6,freezeMethods:e=>{n6(e,(r,s)=>{if(qc(e)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=e[s];qc(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,r)=>{const s={},o=c=>{c.forEach(u=>{s[u]=!0})};return vv(e)?o(e):o(String(e).split(r)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,o){return s.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:ZB,global:F_,isContextDefined:e6,isSpecCompliantForm:function(e){return!!(e&&qc(e.append)&&e[XB]==="FormData"&&e[yA])},toJSONObject:e=>{const r=new Array(10),s=(o,c)=>{if(SA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=vv(o)?[]:{};return ww(o,(h,m)=>{const g=s(h,c+1);!bw(g)&&(u[m]=g)}),r[c]=void 0,u}}return o};return s(e,0)},isAsyncFn:Kde,isThenable:e=>e&&(SA(e)||qc(e))&&qc(e.then)&&qc(e.catch),setImmediate:r6,asap:qde,isIterable:e=>e!=null&&qc(e[yA])};function mr(e,r,s,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}ft.inherits(mr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ft.toJSONObject(this.config),code:this.code,status:this.status}}});const o6=mr.prototype,a6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{a6[e]={value:e}}),Object.defineProperties(mr,a6),Object.defineProperty(o6,"isAxiosError",{value:!0}),mr.from=(e,r,s,o,c,u)=>{const h=Object.create(o6);return ft.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),mr.call(h,e.message,r,s,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function Ex(e){return ft.isPlainObject(e)||ft.isArray(e)}function c6(e){return ft.endsWith(e,"[]")?e.slice(0,-2):e}function l6(e,r,s){return e?e.concat(r).map(function(o,c){return o=c6(o),!s&&c?"["+o+"]":o}).join(s?".":""):r}const Yde=ft.toFlatObject(ft,{},null,function(e){return/^is[A-Z]/.test(e)});function TA(e,r,s){if(!ft.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const o=(s=ft.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(A,O){return!ft.isUndefined(O[A])})).metaTokens,c=s.visitor||E,u=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&ft.isSpecCompliantForm(r);if(!ft.isFunction(c))throw new TypeError("visitor must be a function");function g(A){if(A===null)return"";if(ft.isDate(A))return A.toISOString();if(!m&&ft.isBlob(A))throw new mr("Blob is not supported. Use a Buffer instead.");return ft.isArrayBuffer(A)||ft.isTypedArray(A)?m&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function E(A,O,W){let F=A;if(A&&!W&&typeof A=="object"){if(ft.endsWith(O,"{}"))O=o?O:O.slice(0,-2),A=JSON.stringify(A);else if(ft.isArray(A)&&function(B){return ft.isArray(B)&&!B.some(Ex)}(A)||(ft.isFileList(A)||ft.endsWith(O,"[]"))&&(F=ft.toArray(A)))return O=c6(O),F.forEach(function(B,Z){!ft.isUndefined(B)&&B!==null&&r.append(h===!0?l6([O],Z,u):h===null?O:O+"[]",g(B))}),!1}return!!Ex(A)||(r.append(l6(W,O,u),g(A)),!1)}const S=[],C=Object.assign(Yde,{defaultVisitor:E,convertValue:g,isVisitable:Ex});if(!ft.isObject(e))throw new TypeError("data must be an object");return function A(O,W){if(!ft.isUndefined(O)){if(S.indexOf(O)!==-1)throw Error("Circular reference detected in "+W.join("."));S.push(O),ft.forEach(O,function(F,B){(!(ft.isUndefined(F)||F===null)&&c.call(r,F,ft.isString(B)?No(B).call(B):B,W,C))===!0&&A(F,W?W.concat(B):[B])}),S.pop()}}(e),r}function u6(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function vx(e,r){this._pairs=[],e&&TA(e,this,r)}const d6=vx.prototype;function Xde(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function h6(e,r,s){if(!r)return e;const o=s&&s.encode||Xde;ft.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let u;if(u=c?c(r,s):ft.isURLSearchParams(r)?r.toString():new vx(r,s).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}d6.append=function(e,r){this._pairs.push([e,r])},d6.toString=function(e){const r=e?function(s){return e.call(this,s,u6)}:u6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var p6=class{constructor(){this.handlers=[]}use(e,r,s){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ft.forEach(this.handlers,function(r){r!==null&&e(r)})}},f6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},m6={exports:{}},Jde=Wn,Qde=ve,g6=qt.f;Jde({target:"Object",stat:!0,forced:Object.defineProperty!==g6,sham:!Qde},{defineProperty:g6});var _6=xe.Object,Zde=m6.exports=function(e,r,s){return _6.defineProperty(e,r,s)};_6.defineProperty.sham&&(Zde.sham=!0);var y6=l(m6.exports),ehe=TypeError,E6=pd,the=xs,nhe=we,rhe=Pr("species"),v6=Array,ihe=function(e){var r;return E6(e)&&(r=e.constructor,(the(r)&&(r===v6||E6(r.prototype))||nhe(r)&&(r=r[rhe])===null)&&(r=void 0)),r===void 0?v6:r},S6=function(e,r){return new(ihe(e))(r===0?0:r)},she=d,ohe=ai,ahe=Pr("species"),b6=function(e){return ohe>=51||!she(function(){var r=[];return(r.constructor={})[ahe]=function(){return{foo:1}},r[e](Boolean).foo!==1})},che=Wn,lhe=d,uhe=pd,dhe=we,hhe=$s,phe=dr,w6=function(e){if(e>9007199254740991)throw ehe("Maximum allowed index exceeded");return e},T6=MD,fhe=S6,mhe=b6,ghe=ai,R6=Pr("isConcatSpreadable"),_he=ghe>=51||!lhe(function(){var e=[];return e[R6]=!1,e.concat()[0]!==e}),yhe=function(e){if(!dhe(e))return!1;var r=e[R6];return r!==void 0?!!r:uhe(e)};che({target:"Array",proto:!0,forced:!_he||!mhe("concat")},{concat:function(e){var r,s,o,c,u,h=hhe(this),m=fhe(h,0),g=0;for(r=-1,o=arguments.length;r<o;r++)if(yhe(u=r===-1?h:arguments[r]))for(c=phe(u),w6(g+c),s=0;s<c;s++,g++)s in u&&T6(m,g,u[s]);else w6(g+1),T6(m,g++,u);return m.length=g,m}});var C6={},Ehe=X,vhe=rn,I6=md.f,She=_s,A6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];C6.f=function(e){return A6&&Ehe(e)==="Window"?function(r){try{return I6(r)}catch{return She(A6)}}(e):I6(vhe(e))};var Sv={},bhe=Pr;Sv.f=bhe;var P6=xe,whe=zr,The=Sv,Rhe=qt.f,ys=function(e){var r=P6.Symbol||(P6.Symbol={});whe(r,e)||Rhe(r,e,{value:The.f(e)})},Che=be,Ihe=Mt,Ahe=Pr,Phe=Td,O6=function(){var e=Ihe("Symbol"),r=e&&e.prototype,s=r&&r.valueOf,o=Ahe("toPrimitive");r&&!r[o]&&Phe(r,o,function(c){return Che(s,this)},{})},Ohe=st,khe=rt,Nhe=$s,Dhe=dr,xhe=S6,k6=I([].push),Lhe=function(e){var r=e===1,s=e===2,o=e===3,c=e===4,u=e===6,h=e===7,m=e===5||u;return function(g,E,S,C){for(var A,O,W=Nhe(g),F=khe(W),B=Dhe(F),Z=Ohe(E,S),Q=0,ae=C||xhe,ye=r?ae(g,B):s||h?ae(g,0):void 0;B>Q;Q++)if((m||Q in F)&&(O=Z(A=F[Q],Q,W),e))if(r)ye[Q]=O;else if(O)switch(e){case 3:return!0;case 5:return A;case 6:return Q;case 2:k6(ye,A)}else switch(e){case 4:return!1;case 7:k6(ye,A)}return u?-1:o||c?c:ye}},N6={forEach:Lhe(0)},RA=Wn,Tw=L,Sx=be,Mhe=I,bv=ve,wv=Hi,Uhe=d,ia=zr,Vhe=k,bx=er,CA=rn,wx=fr,Fhe=Ga,Tx=Ke,Tv=a_,D6=wa,jhe=md,x6=C6,Bhe=dm,L6=de,M6=qt,zhe=Ah,U6=Ce,V6=Td,Whe=kh,Rx=fo,F6=Ol,j6=Uc,Ghe=Pr,Hhe=Sv,$he=ys,Khe=O6,qhe=Eu,B6=Oh,IA=N6.forEach,Yc=lm("hidden"),AA="Symbol",Rw="prototype",Yhe=B6.set,z6=B6.getterFor(AA),kd=Object[Rw],j_=Tw.Symbol,PA=j_&&j_[Rw],Xhe=Tw.RangeError,Jhe=Tw.TypeError,Cx=Tw.QObject,W6=L6.f,B_=M6.f,G6=x6.f,Qhe=U6.f,H6=Mhe([].push),rf=Rx("symbols"),Cw=Rx("op-symbols"),Zhe=Rx("wks"),Ix=!Cx||!Cx[Rw]||!Cx[Rw].findChild,$6=function(e,r,s){var o=W6(kd,r);o&&delete kd[r],B_(e,r,s),o&&e!==kd&&B_(kd,r,o)},Ax=bv&&Uhe(function(){return Tv(B_({},"a",{get:function(){return B_(this,"a",{value:7}).a}})).a!==7})?$6:B_,Px=function(e,r){var s=rf[e]=Tv(PA);return Yhe(s,{type:AA,tag:e,description:r}),bv||(s.description=r),s},OA=function(e,r,s){e===kd&&OA(Cw,r,s),bx(e);var o=wx(r);return bx(s),ia(rf,o)?(s.enumerable?(ia(e,Yc)&&e[Yc][o]&&(e[Yc][o]=!1),s=Tv(s,{enumerable:Tx(0,!1)})):(ia(e,Yc)||B_(e,Yc,Tx(1,Tv(null))),e[Yc][o]=!0),Ax(e,o,s)):B_(e,o,s)},Ox=function(e,r){bx(e);var s=CA(r),o=D6(s).concat(X6(s));return IA(o,function(c){bv&&!Sx(K6,s,c)||OA(e,c,s[c])}),e},K6=function(e){var r=wx(e),s=Sx(Qhe,this,r);return!(this===kd&&ia(rf,r)&&!ia(Cw,r))&&(!(s||!ia(this,r)||!ia(rf,r)||ia(this,Yc)&&this[Yc][r])||s)},q6=function(e,r){var s=CA(e),o=wx(r);if(s!==kd||!ia(rf,o)||ia(Cw,o)){var c=W6(s,o);return!c||!ia(rf,o)||ia(s,Yc)&&s[Yc][o]||(c.enumerable=!0),c}},Y6=function(e){var r=G6(CA(e)),s=[];return IA(r,function(o){ia(rf,o)||ia(F6,o)||H6(s,o)}),s},X6=function(e){var r=e===kd,s=G6(r?Cw:CA(e)),o=[];return IA(s,function(c){!ia(rf,c)||r&&!ia(kd,c)||H6(o,rf[c])}),o};wv||(j_=function(){if(Vhe(PA,this))throw new Jhe("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Fhe(arguments[0]):void 0,r=j6(e),s=function(o){var c=this===void 0?Tw:this;c===kd&&Sx(s,Cw,o),ia(c,Yc)&&ia(c[Yc],r)&&(c[Yc][r]=!1);var u=Tx(1,o);try{Ax(c,r,u)}catch(h){if(!(h instanceof Xhe))throw h;$6(c,r,u)}};return bv&&Ix&&Ax(kd,r,{configurable:!0,set:s}),Px(r,e)},V6(PA=j_[Rw],"toString",function(){return z6(this).tag}),V6(j_,"withoutSetter",function(e){return Px(j6(e),e)}),U6.f=K6,M6.f=OA,zhe.f=Ox,L6.f=q6,jhe.f=x6.f=Y6,Bhe.f=X6,Hhe.f=function(e){return Px(Ghe(e),e)},bv&&Whe(PA,"description",{configurable:!0,get:function(){return z6(this).description}})),RA({global:!0,wrap:!0,forced:!wv,sham:!wv},{Symbol:j_}),IA(D6(Zhe),function(e){$he(e)}),RA({target:AA,stat:!0,forced:!wv},{useSetter:function(){Ix=!0},useSimple:function(){Ix=!1}}),RA({target:"Object",stat:!0,forced:!wv,sham:!bv},{create:function(e,r){return r===void 0?Tv(e):Ox(Tv(e),r)},defineProperty:OA,defineProperties:Ox,getOwnPropertyDescriptor:q6}),RA({target:"Object",stat:!0,forced:!wv},{getOwnPropertyNames:Y6}),Khe(),qhe(j_,AA),F6[Yc]=!0;var J6=Hi&&!!Symbol.for&&!!Symbol.keyFor,epe=Wn,tpe=Mt,npe=zr,rpe=Ga,Q6=fo,ipe=J6,kx=Q6("string-to-symbol-registry"),spe=Q6("symbol-to-string-registry");epe({target:"Symbol",stat:!0,forced:!ipe},{for:function(e){var r=rpe(e);if(npe(kx,r))return kx[r];var s=tpe("Symbol")(r);return kx[r]=s,spe[s]=r,s}});var ope=Wn,ape=zr,cpe=po,lpe=Xo,upe=J6,Z6=fo("symbol-to-string-registry");ope({target:"Symbol",stat:!0,forced:!upe},{keyFor:function(e){if(!cpe(e))throw new TypeError(lpe(e)+" is not a symbol");if(ape(Z6,e))return Z6[e]}});var e8=pd,dpe=fe,t8=X,hpe=Ga,n8=I([].push),ppe=Wn,r8=Mt,i8=ne,fpe=be,Iw=I,s8=d,o8=fe,a8=po,c8=_s,mpe=function(e){if(dpe(e))return e;if(e8(e)){for(var r=e.length,s=[],o=0;o<r;o++){var c=e[o];typeof c=="string"?n8(s,c):typeof c!="number"&&t8(c)!=="Number"&&t8(c)!=="String"||n8(s,hpe(c))}var u=s.length,h=!0;return function(m,g){if(h)return h=!1,g;if(e8(this))return g;for(var E=0;E<u;E++)if(s[E]===m)return g}}},gpe=Hi,_pe=String,Lm=r8("JSON","stringify"),kA=Iw(/./.exec),l8=Iw("".charAt),ype=Iw("".charCodeAt),Epe=Iw("".replace),vpe=Iw(1 .toString),Spe=/[\uD800-\uDFFF]/g,u8=/^[\uD800-\uDBFF]$/,d8=/^[\uDC00-\uDFFF]$/,h8=!gpe||s8(function(){var e=r8("Symbol")("stringify detection");return Lm([e])!=="[null]"||Lm({a:e})!=="{}"||Lm(Object(e))!=="{}"}),p8=s8(function(){return Lm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Lm("\uDEAD")!=='"\\udead"'}),bpe=function(e,r){var s=c8(arguments),o=mpe(r);if(o8(o)||e!==void 0&&!a8(e))return s[1]=function(c,u){if(o8(o)&&(u=fpe(o,this,_pe(c),u)),!a8(u))return u},i8(Lm,null,s)},wpe=function(e,r,s){var o=l8(s,r-1),c=l8(s,r+1);return kA(u8,e)&&!kA(d8,c)||kA(d8,e)&&!kA(u8,o)?"\\u"+vpe(ype(e,0),16):e};Lm&&ppe({target:"JSON",stat:!0,forced:h8||p8},{stringify:function(e,r,s){var o=c8(arguments),c=i8(h8?bpe:Lm,null,o);return p8&&typeof c=="string"?Epe(c,Spe,wpe):c}});var f8=dm,Tpe=$s;Wn({target:"Object",stat:!0,forced:!Hi||d(function(){f8.f(1)})},{getOwnPropertySymbols:function(e){var r=f8.f;return r?r(Tpe(e)):[]}}),ys("asyncIterator"),ys("hasInstance"),ys("isConcatSpreadable"),ys("iterator"),ys("match"),ys("matchAll"),ys("replace"),ys("search"),ys("species"),ys("split");var Rpe=O6;ys("toPrimitive"),Rpe();var Cpe=Mt,Ipe=Eu;ys("toStringTag"),Ipe(Cpe("Symbol"),"Symbol"),ys("unscopables"),Eu(L.JSON,"JSON",!0);var Ape=xe.Symbol,Ppe=Pr,Ope=qt.f,m8=Ppe("metadata"),g8=Function.prototype;g8[m8]===void 0&&Ope(g8,m8,{value:null}),ys("asyncDispose"),ys("dispose"),ys("metadata");var kpe=Ape,Npe=I,Nx=Mt("Symbol"),Dpe=Nx.keyFor,xpe=Npe(Nx.prototype.valueOf),_8=Nx.isRegisteredSymbol||function(e){try{return Dpe(xpe(e))!==void 0}catch{return!1}};Wn({target:"Symbol",stat:!0},{isRegisteredSymbol:_8});for(var Lpe=fo,y8=Mt,Mpe=I,Upe=po,Vpe=Pr,NA=y8("Symbol"),E8=NA.isWellKnownSymbol,v8=y8("Object","getOwnPropertyNames"),Fpe=Mpe(NA.prototype.valueOf),S8=Lpe("wks"),Dx=0,b8=v8(NA),jpe=b8.length;Dx<jpe;Dx++)try{var w8=b8[Dx];Upe(NA[w8])&&Vpe(w8)}catch{}var T8=function(e){if(E8&&E8(e))return!0;try{for(var r=Fpe(e),s=0,o=v8(S8),c=o.length;s<c;s++)if(S8[o[s]]==r)return!0}catch{}return!1};Wn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:T8}),ys("customMatcher"),ys("observable"),Wn({target:"Symbol",stat:!0},{isRegistered:_8}),Wn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:T8}),ys("matcher"),ys("metadataKey"),ys("patternMatch"),ys("replaceAll");var Rv=l(kpe),R8=l(Sv.f("iterator"));function Aw(e){return Aw=typeof Rv=="function"&&typeof R8=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Rv=="function"&&r.constructor===Rv&&r!==Rv.prototype?"symbol":typeof r},Aw(e)}var Bpe=l(Sv.f("toPrimitive"));function zpe(e){var r=function(s,o){if(Aw(s)!="object"||!s)return s;var c=s[Bpe];if(c!==void 0){var u=c.call(s,o);if(Aw(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(e,"string");return Aw(r)=="symbol"?r:r+""}function q(e,r,s){return(r=zpe(r))in e?y6(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}var C8=l(zle),Wpe={isBrowser:!0,classes:{URLSearchParams:C8!==void 0?C8:vx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const xx=typeof window<"u"&&typeof document<"u",Lx=typeof navigator=="object"&&navigator||void 0,Gpe=xx&&(!Lx||["ReactNative","NativeScript","NS"].indexOf(Lx.product)<0),Hpe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",$pe=xx&&window.location.href||"http://localhost";function I8(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function A8(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?I8(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):I8(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}var Xa=A8(A8({},Object.freeze({__proto__:null,hasBrowserEnv:xx,hasStandardBrowserEnv:Gpe,hasStandardBrowserWebWorkerEnv:Hpe,navigator:Lx,origin:$pe})),Wpe),Kpe=er,qpe=be,Ype=zr,Xpe=k,Jpe=function(){var e=Kpe(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},P8=RegExp.prototype,O8=function(e){var r=e.flags;return r!==void 0||"flags"in P8||Ype(e,"flags")||!Xpe(P8,e)?r:qpe(Jpe,e)},Qpe=bD.charAt,k8=be,Zpe=er,efe=fe,tfe=X,nfe=/./.exec,rfe=TypeError,ife=Wn,N8=be,D8=ie,sfe=y_,DA=YE,x8=mt,L8=ii,Pw=Ga,ofe=er,afe=we,cfe=X,lfe=G0,M8=O8,ufe=Fa,dfe=d,hfe=Qp,pfe=function(e,r,s){return r+(s?Qpe(e,r).length:1)},ffe=function(e,r){var s=e.exec;if(efe(s)){var o=k8(s,e,r);return o!==null&&Zpe(o),o}if(tfe(e)==="RegExp")return k8(nfe,e,r);throw new rfe("RegExp#exec called on incompatible receiver")},U8=Oh,mfe=Pr("matchAll"),V8="RegExp String",F8=V8+" Iterator",gfe=U8.set,_fe=U8.getterFor(F8),yfe=TypeError,Mx=D8("".indexOf),xA=D8("".matchAll),Ux=!!xA&&!dfe(function(){xA("a",/./)}),Efe=sfe(function(e,r,s,o){gfe(this,{type:F8,regexp:e,string:r,global:s,unicode:o,done:!1})},V8,function(){var e=_fe(this);if(e.done)return DA(void 0,!0);var r=e.regexp,s=e.string,o=ffe(r,s);return o===null?(e.done=!0,DA(void 0,!0)):e.global?(Pw(o[0])===""&&(r.lastIndex=pfe(s,L8(r.lastIndex),e.unicode)),DA(o,!1)):(e.done=!0,DA(o,!1))}),j8=function(e){var r,s,o,c=ofe(this),u=Pw(e),h=hfe(c,RegExp),m=Pw(M8(c));return r=new h(h===RegExp?c.source:c,m),s=!!~Mx(m,"g"),o=!!~Mx(m,"u"),r.lastIndex=L8(c.lastIndex),new Efe(r,u,s,o)};ife({target:"String",proto:!0,forced:Ux},{matchAll:function(e){var r,s,o,c,u=x8(this);if(afe(e)){if(lfe(e)&&(r=Pw(x8(M8(e))),!~Mx(r,"g")))throw new yfe("`.matchAll` does not allow non-global regexes");if(Ux)return xA(u,e);if((o=ufe(e,mfe))===void 0&&cfe(e)==="RegExp"&&(o=j8),o)return N8(o,e,u)}else if(Ux)return xA(u,e);return s=Pw(u),c=new RegExp(e,"g"),N8(j8,c,s)}});var vfe=_c("String","matchAll"),Sfe=k,bfe=vfe,Vx=String.prototype,wfe=function(e){var r=e.matchAll;return typeof e=="string"||e===Vx||Sfe(Vx,e)&&r===Vx.matchAll?bfe:r},Tfe=l(wfe);function B8(e){function r(s,o,c,u){let h=s[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),g=u>=s.length;return h=!h&&ft.isArray(c)?c.length:h,g?(ft.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&ft.isObject(c[h])||(c[h]=[]),r(s,o,c[h],u)&&ft.isArray(c[h])&&(c[h]=function(E){const S={},C=Object.keys(E);let A;const O=C.length;let W;for(A=0;A<O;A++)W=C[A],S[W]=E[W];return S}(c[h])),!m)}if(ft.isFormData(e)&&ft.isFunction(e.entries)){const s={};return ft.forEachEntry(e,(o,c)=>{r(function(u){return Tfe(ft).call(ft,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,s,0)}),s}return null}const Fx={transitional:f6,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const s=r.getContentType()||"",o=s.indexOf("application/json")>-1,c=ft.isObject(e);if(c&&ft.isHTMLForm(e)&&(e=new FormData(e)),ft.isFormData(e))return o?JSON.stringify(B8(e)):e;if(ft.isArrayBuffer(e)||ft.isBuffer(e)||ft.isStream(e)||ft.isFile(e)||ft.isBlob(e)||ft.isReadableStream(e))return e;if(ft.isArrayBufferView(e))return e.buffer;if(ft.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return TA(h,new Xa.classes.URLSearchParams,Object.assign({visitor:function(g,E,S,C){return Xa.isNode&&ft.isBuffer(g)?(this.append(E,g.toString("base64")),!1):C.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=ft.isFileList(e))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return TA(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,g){if(ft.isString(h))try{return(m||JSON.parse)(h),No(ft).call(ft,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(g||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const r=this.transitional||Fx.transitional,s=r&&r.forcedJSONParsing,o=this.responseType==="json";if(ft.isResponse(e)||ft.isReadableStream(e))return e;if(e&&ft.isString(e)&&(s&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?mr.from(u,mr.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Xa.classes.FormData,Blob:Xa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ft.forEach(["delete","get","head","post","put","patch"],e=>{Fx.headers[e]={}});var jx=Fx;const Rfe=ft.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),z8=Symbol("internals");function Ow(e){var r;return e&&No(r=String(e)).call(r).toLowerCase()}function LA(e){return e===!1||e==null?e:ft.isArray(e)?e.map(LA):String(e)}function Bx(e,r,s,o,c){return ft.isFunction(o)?o.call(this,r,s):(c&&(r=s),ft.isString(r)?ft.isString(o)?r.indexOf(o)!==-1:ft.isRegExp(o)?o.test(r):void 0:void 0)}class MA{constructor(r){r&&this.set(r)}set(r,s,o){const c=this;function u(g,E,S){const C=Ow(E);if(!C)throw new Error("header name must be a non-empty string");const A=ft.findKey(c,C);(!A||c[A]===void 0||S===!0||S===void 0&&c[A]!==!1)&&(c[A||E]=LA(g))}const h=(g,E)=>ft.forEach(g,(S,C)=>u(S,C,E));if(ft.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(ft.isString(r)&&(r=No(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(No(m=r).call(m)))h((g=>{const E={};let S,C,A;return g&&g.split(`
`).forEach(function(O){var W,F;A=O.indexOf(":"),S=No(W=O.substring(0,A)).call(W).toLowerCase(),C=No(F=O.substring(A+1)).call(F),!S||E[S]&&Rfe[S]||(S==="set-cookie"?E[S]?E[S].push(C):E[S]=[C]:E[S]=E[S]?E[S]+", "+C:C)}),E})(r),s);else if(ft.isObject(r)&&ft.isIterable(r)){let g,E,S={};for(const C of r){if(!ft.isArray(C))throw TypeError("Object iterator must return a key-value pair");S[E=C[0]]=(g=S[E])?ft.isArray(g)?[...g,C[1]]:[g,C[1]]:C[1]}h(S,s)}else r!=null&&u(s,r,o);var m;return this}get(r,s){if(r=Ow(r)){const o=ft.findKey(this,r);if(o){const c=this[o];if(!s)return c;if(s===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=m.exec(u);)h[g[1]]=g[2];return h}(c);if(ft.isFunction(s))return s.call(this,c,o);if(ft.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=Ow(r)){const o=ft.findKey(this,r);return!(!o||this[o]===void 0||s&&!Bx(0,this[o],o,s))}return!1}delete(r,s){const o=this;let c=!1;function u(h){if(h=Ow(h)){const m=ft.findKey(o,h);!m||s&&!Bx(0,o[m],m,s)||(delete o[m],c=!0)}}return ft.isArray(r)?r.forEach(u):u(r),c}clear(r){const s=Object.keys(this);let o=s.length,c=!1;for(;o--;){const u=s[o];r&&!Bx(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const s=this,o={};return ft.forEach(this,(c,u)=>{var h;const m=ft.findKey(o,u);if(m)return s[m]=LA(c),void delete s[u];const g=r?function(E){return No(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,C,A)=>C.toUpperCase()+A)}(u):No(h=String(u)).call(h);g!==u&&delete s[u],s[g]=LA(c),o[g]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return ft.forEach(this,(o,c)=>{o!=null&&o!==!1&&(s[c]=r&&ft.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,o]=r;return s+": "+o}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[z8]=this[z8]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=Ow(u);s[h]||(function(m,g){const E=ft.toCamelCase(" "+g);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+E,{value:function(C,A,O){return this[S].call(this,g,C,A,O)},configurable:!0})})}(o,u),s[h]=!0)}return ft.isArray(r)?r.forEach(c):c(r),this}}MA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ft.reduceDescriptors(MA.prototype,(e,r)=>{let{value:s}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[o]=c}}}),ft.freezeMethods(MA);var Nd=MA;function zx(e,r){const s=this||jx,o=r||s,c=Nd.from(o.headers);let u=o.data;return ft.forEach(e,function(h){u=h.call(s,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function W8(e){return!(!e||!e.__CANCEL__)}function Cv(e,r,s){mr.call(this,e??"canceled",mr.ERR_CANCELED,r,s),this.name="CanceledError"}function G8(e,r,s){const o=s.config.validateStatus;s.status&&o&&!o(s.status)?r(new mr("Request failed with status code "+s.status,[mr.ERR_BAD_REQUEST,mr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}ft.inherits(Cv,mr,{__CANCEL__:!0});const UA=function(e,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),g=new Array(u);let E,S=0,C=0;return h=h!==void 0?h:1e3,function(A){const O=Date.now(),W=g[C];E||(E=O),m[S]=A,g[S]=O;let F=C,B=0;for(;F!==S;)B+=m[F++],F%=u;if(S=(S+1)%u,S===C&&(C=(C+1)%u),O-E<h)return;const Z=W&&O-W;return Z?Math.round(1e3*B/Z):void 0}}(50,250);return function(u,h){let m,g,E=0,S=1e3/h;const C=function(A){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),u.apply(null,A)};return[function(){const A=Date.now(),O=A-E;for(var W=arguments.length,F=new Array(W),B=0;B<W;B++)F[B]=arguments[B];O>=S?C(F,A):(m=F,g||(g=setTimeout(()=>{g=null,C(m)},S-O)))},()=>m&&C(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,g=h-o,E=c(g);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:g,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},H8=(e,r)=>{const s=e!=null;return[o=>r[0]({lengthComputable:s,total:e,loaded:o}),r[1]]},$8=e=>function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return ft.asap(()=>e(...s))};var Cfe=Xa.hasStandardBrowserEnv?((e,r)=>s=>(s=new dA(s,Xa.origin),e.protocol===s.protocol&&e.host===s.host&&(r||e.port===s.port)))(new dA(Xa.origin),Xa.navigator&&/(msie|trident)/i.test(Xa.navigator.userAgent)):()=>!0,Ife=Xa.hasStandardBrowserEnv?{write(e,r,s,o,c,u){const h=[e+"="+encodeURIComponent(r)];ft.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),ft.isString(o)&&h.push("path="+o),ft.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function K8(e,r,s){let o=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(r);return e&&(o||s==0)?function(c,u){return u?c.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):c}(e,r):r}function q8(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}const Y8=e=>e instanceof Nd?function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?q8(Object(o),!0).forEach(function(c){q(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):q8(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e):e;function z_(e,r){r=r||{};const s={};function o(E,S,C,A){return ft.isPlainObject(E)&&ft.isPlainObject(S)?ft.merge.call({caseless:A},E,S):ft.isPlainObject(S)?ft.merge({},S):ft.isArray(S)?S.slice():S}function c(E,S,C,A){return ft.isUndefined(S)?ft.isUndefined(E)?void 0:o(void 0,E,0,A):o(E,S,0,A)}function u(E,S){if(!ft.isUndefined(S))return o(void 0,S)}function h(E,S){return ft.isUndefined(S)?ft.isUndefined(E)?void 0:o(void 0,E):o(void 0,S)}function m(E,S,C){return C in r?o(E,S):C in e?o(void 0,E):void 0}const g={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,S,C)=>c(Y8(E),Y8(S),0,!0)};return ft.forEach(Object.keys(Object.assign({},e,r)),function(E){const S=g[E]||c,C=S(e[E],r[E],E);ft.isUndefined(C)&&S!==m||(s[E]=C)}),s}var X8=e=>{const r=z_({},e);let s,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:g}=r;if(r.headers=m=Nd.from(m),r.url=h6(K8(r.baseURL,r.url,r.allowAbsoluteUrls),e.params,e.paramsSerializer),g&&m.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),ft.isFormData(o)){if(Xa.hasStandardBrowserEnv||Xa.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[E,...S]=s?s.split(";").map(C=>No(C).call(C)).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...S].join("; "))}}if(Xa.hasStandardBrowserEnv&&(c&&ft.isFunction(c)&&(c=c(r)),c||c!==!1&&Cfe(r.url))){const E=u&&h&&Ife.read(h);E&&m.set(u,E)}return r},Afe=typeof XMLHttpRequest<"u"&&function(e){return new gt(function(r,s){const o=X8(e);let c=o.data;const u=Nd.from(o.headers).normalize();let h,m,g,E,S,{responseType:C,onUploadProgress:A,onDownloadProgress:O}=o;function W(){E&&E(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let F=new XMLHttpRequest;function B(){if(!F)return;const Q=Nd.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders());G8(function(ae){r(ae),W()},function(ae){s(ae),W()},{data:C&&C!=="text"&&C!=="json"?F.response:F.responseText,status:F.status,statusText:F.statusText,headers:Q,config:e,request:F}),F=null}F.open(o.method.toUpperCase(),o.url,!0),F.timeout=o.timeout,"onloadend"in F?F.onloadend=B:F.onreadystatechange=function(){F&&F.readyState===4&&(F.status!==0||F.responseURL&&F.responseURL.indexOf("file:")===0)&&setTimeout(B)},F.onabort=function(){F&&(s(new mr("Request aborted",mr.ECONNABORTED,e,F)),F=null)},F.onerror=function(){s(new mr("Network Error",mr.ERR_NETWORK,e,F)),F=null},F.ontimeout=function(){let Q=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const ae=o.transitional||f6;o.timeoutErrorMessage&&(Q=o.timeoutErrorMessage),s(new mr(Q,ae.clarifyTimeoutError?mr.ETIMEDOUT:mr.ECONNABORTED,e,F)),F=null},c===void 0&&u.setContentType(null),"setRequestHeader"in F&&ft.forEach(u.toJSON(),function(Q,ae){F.setRequestHeader(ae,Q)}),ft.isUndefined(o.withCredentials)||(F.withCredentials=!!o.withCredentials),C&&C!=="json"&&(F.responseType=o.responseType),O&&([g,S]=UA(O,!0),F.addEventListener("progress",g)),A&&F.upload&&([m,E]=UA(A),F.upload.addEventListener("progress",m),F.upload.addEventListener("loadend",E)),(o.cancelToken||o.signal)&&(h=Q=>{F&&(s(!Q||Q.type?new Cv(null,e,F):Q),F.abort(),F=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const Z=function(Q){const ae=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Q);return ae&&ae[1]||""}(o.url);Z&&Xa.protocols.indexOf(Z)===-1?s(new mr("Unsupported protocol "+Z+":",mr.ERR_BAD_REQUEST,e)):F.send(c||null)})},Pfe=(e,r)=>{const{length:s}=e=e?e.filter(Boolean):[];if(r||s){let o,c=new AbortController;const u=function(E){if(!o){o=!0,m();const S=E instanceof Error?E:this.reason;c.abort(S instanceof mr?S:new Cv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new mr("timeout ".concat(r," of ms exceeded"),mr.ETIMEDOUT))},r);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(E=>{E.unsubscribe?E.unsubscribe(u):E.removeEventListener("abort",u)}),e=null)};e.forEach(E=>E.addEventListener("abort",u));const{signal:g}=c;return g.unsubscribe=()=>ft.asap(m),g}},Wx=l(U3),J8=Sv.f("asyncIterator"),Ofe=l(J8);function Gx(e,r){this.v=e,this.k=r}function Ul(e){return function(){return new kw(e.apply(this,arguments))}}function kw(e){var r,s;function o(u,h){try{var m=e[u](h),g=m.value,E=g instanceof Gx;Wx.resolve(E?g.v:g).then(function(S){if(E){var C=u==="return"?"return":"next";if(!g.k||S.done)return o(C,S);S=e[C](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):s=null}this._invoke=function(u,h){return new Wx(function(m,g){var E={key:u,arg:h,resolve:m,reject:g,next:null};s?s=s.next=E:(r=s=E,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function Un(e){return new Gx(e,0)}function VA(e){var r={},s=!1;function o(c,u){return s=!0,u=new Wx(function(h){h(e[c](u))}),{done:!1,value:new Gx(u,1)}}return r[Rv!==void 0&&R8||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):o("next",c)},typeof e.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return o("throw",c)}),typeof e.return=="function"&&(r.return=function(c){return s?(s=!1,c):o("return",c)}),r}kw.prototype[typeof Rv=="function"&&Ofe||"@@asyncIterator"]=function(){return this},kw.prototype.next=function(e){return this._invoke("next",e)},kw.prototype.throw=function(e){return this._invoke("throw",e)},kw.prototype.return=function(e){return this._invoke("return",e)};var Hx=l(J8);function $x(e){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=Hx,o=Symbol.iterator);c--;){if(s&&(r=e[s])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new FA(r.call(e));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function FA(e){function r(s){if(Object(s)!==s)return gt.reject(new TypeError(s+" is not an object."));var o=s.done;return gt.resolve(s.value).then(function(c){return{value:c,done:o}})}return FA=function(s){this.s=s,this.n=s.next},FA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?gt.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?gt.reject(s):r(o.apply(this.s,arguments))}},new FA(e)}const kfe=function*(e,r){let s=e.byteLength;if(!r||s<r)return void(yield e);let o,c=0;for(;c<s;)o=c+r,yield e.slice(c,o),c=o},Nfe=function(){var e=Ul(function*(r,s){var o,c=!1,u=!1;try{for(var h,m=$x(Dfe(r));c=!(h=yield Un(m.next())).done;c=!1){const g=h.value;yield*VA($x(kfe(g,s)))}}catch(g){u=!0,o=g}finally{try{c&&m.return!=null&&(yield Un(m.return()))}finally{if(u)throw o}}});return function(r,s){return e.apply(this,arguments)}}(),Dfe=function(){var e=Ul(function*(r){if(r[Hx])return void(yield*VA($x(r)));const s=r.getReader();try{for(;;){const{done:o,value:c}=yield Un(s.read());if(o)break;yield c}}finally{yield Un(s.cancel())}});return function(r){return e.apply(this,arguments)}}(),Q8=(e,r,s,o)=>{const c=Nfe(e,r);let u,h=0,m=g=>{u||(u=!0,o&&o(g))};return new ReadableStream({async pull(g){try{const{done:E,value:S}=await c.next();if(E)return m(),void g.close();let C=S.byteLength;if(s){let A=h+=C;s(A)}g.enqueue(new Uint8Array(S))}catch(E){throw m(E),E}},cancel:g=>(m(g),c.return())},{highWaterMark:2})};function Z8(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function ez(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Z8(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Z8(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const jA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",tz=jA&&typeof ReadableStream=="function",xfe=jA&&(typeof TextEncoder=="function"?(nz=new TextEncoder,e=>nz.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var nz;const rz=function(e){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return!!e(...s)}catch{return!1}},Lfe=tz&&rz(()=>{let e=!1;const r=new Request(Xa.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),Kx=tz&&rz(()=>ft.isReadableStream(new Response("").body)),BA={stream:Kx&&(e=>e.body)};var iz;jA&&(iz=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!BA[e]&&(BA[e]=ft.isFunction(iz[e])?r=>r[e]():(r,s)=>{throw new mr("Response type '".concat(e,"' is not supported"),mr.ERR_NOT_SUPPORT,s)})}));const Mfe=async(e,r)=>{const s=ft.toFiniteNumber(e.getContentLength());return s??(async o=>o==null?0:ft.isBlob(o)?o.size:ft.isSpecCompliantForm(o)?(await new Request(Xa.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:ft.isArrayBufferView(o)||ft.isArrayBuffer(o)?o.byteLength:(ft.isURLSearchParams(o)&&(o+=""),ft.isString(o)?(await xfe(o)).byteLength:void 0))(r)};var Ufe=jA&&(async e=>{let{url:r,method:s,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:g,responseType:E,headers:S,withCredentials:C="same-origin",fetchOptions:A}=X8(e);E=E?(E+"").toLowerCase():"text";let O,W=Pfe([c,u&&u.toAbortSignal()],h);const F=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let B;try{if(g&&Lfe&&s!=="get"&&s!=="head"&&(B=await Mfe(S,o))!==0){let _e,ue=new Request(r,{method:"POST",body:o,duplex:"half"});if(ft.isFormData(o)&&(_e=ue.headers.get("content-type"))&&S.setContentType(_e),ue.body){const[Ie,Ue]=H8(B,UA($8(g)));o=Q8(ue.body,65536,Ie,Ue)}}ft.isString(C)||(C=C?"include":"omit");const Z="credentials"in Request.prototype;O=new Request(r,ez(ez({},A),{},{signal:W,method:s.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:Z?C:void 0}));let Q=await fetch(O);const ae=Kx&&(E==="stream"||E==="response");if(Kx&&(m||ae&&F)){const _e={};["status","statusText","headers"].forEach(We=>{_e[We]=Q[We]});const ue=ft.toFiniteNumber(Q.headers.get("content-length")),[Ie,Ue]=m&&H8(ue,UA($8(m),!0))||[];Q=new Response(Q8(Q.body,65536,Ie,()=>{Ue&&Ue(),F&&F()}),_e)}E=E||"text";let ye=await BA[ft.findKey(BA,E)||"text"](Q,e);return!ae&&F&&F(),await new gt((_e,ue)=>{G8(_e,ue,{data:ye,headers:Nd.from(Q.headers),status:Q.status,statusText:Q.statusText,config:e,request:O})})}catch(Z){throw F&&F(),Z&&Z.name==="TypeError"&&/Load failed|fetch/i.test(Z.message)?Object.assign(new mr("Network Error",mr.ERR_NETWORK,e,O),{cause:Z.cause||Z}):mr.from(Z,Z&&Z.code,e,O)}});const qx={http:null,xhr:Afe,fetch:Ufe};ft.forEach(qx,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const sz=e=>"- ".concat(e),Vfe=e=>ft.isFunction(e)||e===null||e===!1;var oz={getAdapter:e=>{e=ft.isArray(e)?e:[e];const{length:r}=e;let s,o;const c={};for(let u=0;u<r;u++){let h;if(s=e[u],o=s,!Vfe(s)&&(o=qx[(h=String(s)).toLowerCase()],o===void 0))throw new mr("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,g]=h;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")});throw new mr("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(sz).join(`
`):" "+sz(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:qx};function Yx(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Cv(null,e)}function az(e){return Yx(e),e.headers=Nd.from(e.headers),e.data=zx.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),oz.getAdapter(e.adapter||jx.adapter)(e).then(function(r){return Yx(e),r.data=zx.call(e,e.transformResponse,r),r.headers=Nd.from(r.headers),r},function(r){return W8(r)||(Yx(e),r&&r.response&&(r.response.data=zx.call(e,e.transformResponse,r.response),r.response.headers=Nd.from(r.response.headers))),gt.reject(r)})}const cz="1.9.0",zA={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{zA[e]=function(s){return typeof s===e||"a"+(r<1?"n ":" ")+e}});const lz={};zA.transitional=function(e,r,s){function o(c,u){return"[Axios v"+cz+"] Transitional option '"+c+"'"+u+(s?". "+s:"")}return(c,u,h)=>{if(e===!1)throw new mr(o(u," has been removed"+(r?" in "+r:"")),mr.ERR_DEPRECATED);return r&&!lz[u]&&(lz[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(c,u,h)}},zA.spelling=function(e){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};var WA={assertOptions:function(e,r,s){if(typeof e!="object")throw new mr("options must be an object",mr.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=e[u],g=m===void 0||h(m,u,e);if(g!==!0)throw new mr("option "+u+" must be "+g,mr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new mr("Unknown option "+u,mr.ERR_BAD_OPTION)}},validators:zA};const Wh=WA.validators;let GA=class{constructor(e){this.defaults=e||{},this.interceptors={request:new p6,response:new p6}}async request(e,r){try{return await this._request(e,r)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=z_(this.defaults,r);const{transitional:s,paramsSerializer:o,headers:c}=r;s!==void 0&&WA.assertOptions(s,{silentJSONParsing:Wh.transitional(Wh.boolean),forcedJSONParsing:Wh.transitional(Wh.boolean),clarifyTimeoutError:Wh.transitional(Wh.boolean)},!1),o!=null&&(ft.isFunction(o)?r.paramsSerializer={serialize:o}:WA.assertOptions(o,{encode:Wh.function,serialize:Wh.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),WA.assertOptions(r,{baseUrl:Wh.spelling("baseURL"),withXsrfToken:Wh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&ft.merge(c.common,c[r.method]);c&&ft.forEach(["delete","get","head","post","put","patch","common"],O=>{delete c[O]}),r.headers=Nd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(O){typeof O.runWhen=="function"&&O.runWhen(r)===!1||(m=m&&O.synchronous,h.unshift(O.fulfilled,O.rejected))});const g=[];let E;this.interceptors.response.forEach(function(O){g.push(O.fulfilled,O.rejected)});let S,C=0;if(!m){const O=[az.bind(this),void 0];for(O.unshift.apply(O,h),O.push.apply(O,g),S=O.length,E=gt.resolve(r);C<S;)E=E.then(O[C++],O[C++]);return E}S=h.length;let A=r;for(C=0;C<S;){const O=h[C++],W=h[C++];try{A=O(A)}catch(F){W.call(this,F);break}}try{E=az.call(this,A)}catch(O){return gt.reject(O)}for(C=0,S=g.length;C<S;)E=E.then(g[C++],g[C++]);return E}getUri(e){return h6(K8((e=z_(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ft.forEach(["delete","get","head","options"],function(e){GA.prototype[e]=function(r,s){return this.request(z_(s||{},{method:e,url:r,data:(s||{}).data}))}}),ft.forEach(["post","put","patch"],function(e){function r(s){return function(o,c,u){return this.request(z_(u||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}GA.prototype[e]=r(),GA.prototype[e+"Form"]=r(!0)});var HA=GA;class Xx{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new gt(function(c){s=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new gt(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new Cv(c,u,h),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=o=>{r.abort(o)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new Xx(function(o){r=o}),cancel:r}}}var Ffe=Xx;const Jx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Jx).forEach(e=>{let[r,s]=e;Jx[s]=r});var jfe=Jx;const go=function e(r){const s=new HA(r),o=YB(HA.prototype.request,s);return ft.extend(o,HA.prototype,s,{allOwnKeys:!0}),ft.extend(o,s,null,{allOwnKeys:!0}),o.create=function(c){return e(z_(r,c))},o}(jx);go.Axios=HA,go.CanceledError=Cv,go.CancelToken=Ffe,go.isCancel=W8,go.VERSION=cz,go.toFormData=TA,go.AxiosError=mr,go.Cancel=go.CanceledError,go.all=function(e){return gt.all(e)},go.spread=function(e){return function(r){return e.apply(null,r)}},go.isAxiosError=function(e){return ft.isObject(e)&&e.isAxiosError===!0},go.mergeConfig=z_,go.AxiosHeaders=Nd,go.formToJSON=e=>B8(ft.isHTMLForm(e)?new FormData(e):e),go.getAdapter=oz.getAdapter,go.HttpStatusCode=jfe,go.default=go;var Ca=go;const Bfe=()=>{};function Nw(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Bfe};return e.promise=new gt((r,s)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,s(o))}}),e}const $A=new Map,KA=new Map,Gh=new Map;let ts=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Gn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const uz=new _de;let Dd=uz.getResult(),Qx=null;function Nn(e){if(!Qx){Dd=uz.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Gn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Gn.CHROME;case"Safari":case"Mobile Safari":return Gn.SAFARI;case"Edge":return Gn.EDGE;case"Firefox":return Gn.FIREFOX;case"QQ":case"QQBrowser":return Gn.QQ;case"Opera":return Gn.OPERA;case"WeChat":return Gn.WECHAT;default:return m.browser.name||""}}(Dd),s=dz(Dd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Dd),c=Dd.os.version,u=dz(Dd,!1),h=Dd.device.type;if(!(r&&s&&o&&c))return{name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h};Qx={name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h}}return Qx}function dz(e){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",s?r.split(".")[0]:r}function qA(){return Nn().os}function hz(){const e=Nn();return"".concat(e.os," ").concat(e.osVersion)}function YA(){const e=Nn();return!!(Dd.engine.name==="WebKit"&&e.os===ts.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Gn.SAFARI||_o()&&e.name!==Gn.SAFARI)}function sf(){return Nn().name===Gn.CHROME}function Ls(){return Nn().name===Gn.SAFARI}function pz(){const e=Nn();if(e.name!==Gn.SAFARI||!e.browserVersion)return!1;const r=e.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function fz(){return Nn().name===Gn.EDGE}function Zr(){return Nn().name===Gn.FIREFOX}function _o(){return Nn().os===ts.IOS}function Iv(e){const r=Nn();return!(r.name!==Gn.CHROME||!r.osVersion)&&Number(r.version)>=e}function mz(e){const r=Nn();return!(r.name!==Gn.CHROME||!r.osVersion)&&Number(r.version)<e}function Zx(e,r,s){const o=Nn();return!(o.name!==e||!o.osVersion)&&(s?Number(o.version)>=r&&Number(o.version)<=s:Number(o.version)===r)}function eL(e){const r=Nn();return!(r.name!==Gn.EDGE||!r.osVersion)&&Number(r.version)>=e}function tL(e){const r=Nn();return!(r.name!==Gn.FIREFOX||!r.osVersion)&&Number(r.version)>=e}function gz(e){const r=Nn();return!(r.name!==Gn.SAFARI||!r.osVersion)&&Number(r.version)>=e}function _z(e,r,s){const o=Nn();if(o.os!==ts.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return s?r&&Number(c[0])===e&&Number(c[1])>r||Number(c[0])>e:r?Number(c[0])===e&&Number(c[1])>=r||Number(c[0])>e:Number(c[0])>=e}function yz(e,r,s){const o=Nn();if(o.os!==ts.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e}function nL(e,r,s){const o=Nn();if(o.name!==Gn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return s?r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e:r?Number(c[0])===e&&Number(c[1])<=r||Number(c[0])<e:Number(c[0])<=e}function rL(e){const r=Nn();return!(r.name!==Gn.OPERA||!r.osVersion)&&Number(r.version)>=e}function Ez(){const e=Nn();if(e.os!==ts.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Av(){const e=Nn();if(e.os!==ts.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function iL(){const e=Nn();if(e.os!==ts.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function vz(){const e=Nn();if(e.os!==ts.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Ou(){return Ls()&&navigator.maxTouchPoints>0}function Sz(){return Nn().name===Gn.WECHAT}function bz(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function sL(){const e=qA();return function(){const{deviceType:r}=Nn();return r==="mobile"||r==="tablet"}()||e===ts.ANDROID||e===ts.IOS||e===ts.HARMONY_OS}function of(){const e=Nn();return e.name!==Gn.EDGE&&e.name!==Gn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function XA(){return qA()===ts.ANDROID}function Dw(){const e=Nn();return XA()&&(e.name===Gn.CHROME||e.name===Gn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Zt(e,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(r))in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function wz(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Qe(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?wz(Object(s),!0).forEach(function(o){Zt(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):wz(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let ee=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Le=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Zt(this,"code",void 0),Zt(this,"message",void 0),Zt(this,"data",void 0),Zt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function xd(e,r){if(typeof e!="boolean")throw new Le(ee.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function qi(e,r,s){if(!et(s).call(s,e))throw new Le(ee.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function gr(e,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<s||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Le(ee.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(o,"]. integer only"))}function oL(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Le(ee.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&gr(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&gr(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&gr(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&gr(e.ideal,"".concat(r,".ideal"),1,1/0)}else gr(e,r,1,1/0)}function Es(e,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Le(ee.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!Tz(e,s,o,c))throw new Le(ee.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function af(e,r){if(!Array.isArray(e))throw new Le(ee.INVALID_PARAMS,"".concat(r," should be an array"))}function ei(e){return e==null}function Tz(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=s&&e.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var xw=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(xw||{}),aL=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(aL||{});const Rz=new class{constructor(){Zt(this,"_clientSize",null),Zt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Zt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Zt(this,"getStyle",e=>window.getComputedStyle(e,null)),Zt(this,"checkCssVisibleProperty",e=>{var r;let s=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||et(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(g=>{var E;const S=g.split("(")[0];return et(E=["brightness","blur","opacity"]).call(E,S)}).map(g=>{const[E,S]=g.split(/\(|\)/);return[E,Number(S.match(/^[0-9\.]+/))]}).forEach(g=>{const[E,S]=g;switch(E){case"brightness":(S<.1||S>3)&&(s=!1);break;case"blur":S>3&&(s=!1);break;case"opacity":S<.1&&(s=!1)}}),s)}),Zt(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let s=!0,o=!0;const c=h=>r(h);let u=e;for(;u&&o;)c(u)||(s=!1,o=!1),u=u.parentElement,u||(o=!1);return s}),Zt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Zt(this,"getSizeAboutClient",e=>{const{width:r,height:s,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:s,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}}),Zt(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(e,r,s)}),Zt(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),Zt(this,"checkCoverForAPoint",(e,r,s)=>{const o=this.elementFromPoint(e,r);return o!==null&&o!==s}),Zt(this,"getPointPositionList",()=>{const{width:e,height:r,left:s,top:o}=this._clientSize,c=e/6,u=r/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let E=0;E<5;E++){const S=(s*m+(g===0?.1:g===4?(c*g*m-1e5)/m:c*g)*m)/m,C=(o*m+(E===0?.1:E===4?(u*E*m-1e5)/m:u*E)*m)/m;h.push({x:S,y:C})}return[...h]}),Zt(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),Zt(this,"checkSizeIsVisible",(e,r,s)=>(e>50||s/e<=10)&&(r>50||s/r<=10)),Zt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:s,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,g,E,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(r<0)return!1;if(g=r<u?r:u,s<0)E=0;else{if(!(s<c))return!1;E=s}if(o<0)return!1;S=o<c?o:c;const C=g-m,A=S-E;return this.checkSizeIsVisible(C,A,h)}),Zt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Zt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(xw.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(xw.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(xw.SIZE)}}return this.returnHiddenResult(xw.STYLE)}return this.returnHiddenResult(aL.UNMOUNTED)}return this.returnHiddenResult(aL.INVALID_HTML_ELEMENT)}),Zt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function cL(e){return new TextEncoder().encode(e)}const Cz=function(e,r){const s=new Uint8Array(e.byteLength+r.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(r),e.byteLength),s},lL=async e=>function(r,s){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(s).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",cL(e)),16);class Xr{constructor(){Zt(this,"_events",{}),Zt(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map(s=>s.listener):[]}on(r,s){this._events[r]||(this._events[r]=[]);const o=this._events[r];this._indexOfListener(o,s)===-1&&o.push({listener:s,once:!1})}once(r,s){this._events[r]||(this._events[r]=[]);const o=this._events[r];this._indexOfListener(o,s)===-1&&o.push({listener:s,once:!0})}off(r,s){if(!this._events[r])return;const o=this._events[r],c=this._indexOfListener(o,s);c!==-1&&o.splice(c,1),this._events[r].length===0&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);const s=this._events[r].map(h=>h);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];for(let h=0;h<s.length;h+=1){const m=s[h];m.once&&this.off(r,m.listener),m.listener.apply(this,c||[])}}safeEmit(r){for(var s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];[...this._events[r]||[]].forEach(u=>{u.once&&this.off(r,u.listener);try{u.listener.apply(this,o)}catch(h){console.error("safeEmit event:".concat(r," error ").concat(h==null?void 0:h.toString()))}})}_indexOfListener(r,s){let o=r.length;for(;o--;)if(r[o].listener===s)return o;return-1}}let Lw=null;function Iz(){if(Lw)return Lw;if(window.electron)return Lw=window.electron;if(!window.require)return null;try{return Lw=window.require("electron"),Lw}catch{return null}}let li=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),Wr=function(e){return e.TRACER="tracer",e}({});function Az(e){return gr(e.timeout,"config.timeout",0,1e5),gr(e.timeoutFactor,"config.timeoutFactor",0,100,!1),gr(e.maxRetryCount,"config.maxRetryConfig",0,1/0),gr(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let zfe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),nr=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Mw(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function Pz(e){return Es(e.turnServerURL,"turnServerURL"),Es(e.username,"username"),Es(e.password,"password"),e.udpport&&gr(e.udpport,"udpport",1,99999,!0),e.forceturn&&xd(e.forceturn,"forceturn"),e.security&&xd(e.security,"security"),e.tcpport&&gr(e.tcpport,"tcpport",1,99999,!0),!0}function uL(e){return e.level!==void 0&&qi(e.level,"level",[1,2,3]),e.delay!==void 0&&gr(e.delay,"delay",0,3e3,!0),!0}let Tn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Ms=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Cc=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Pv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Us(e,r){for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return e.getListeners(r).length===0?gt.reject(new Le(ee.UNEXPECTED_ERROR,"can not emit promise")):new gt((u,h)=>{e.emit(r,...o,u,h)})}function yr(e,r){if(e.getListeners(r).length===0)return gt.resolve();for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return Us(e,r,...o)}function Xc(e,r){if(e.getListeners(r).length===0)return null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return Uw(e,r,...o)}function Uw(e,r){let s=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(r,...u,m=>{s=m},m=>{o=m}),o!==null)throw o;if(s===null)throw new Le(ee.UNEXPECTED_ERROR,"handler is not sync");return s}const bi=new class extends Xr{set networkState(e){this.emit(Pv.NETWORK_STATE_CHANGE,e,this._networkState),e===Cc.ONLINE?this.emit(Pv.ONLINE):e===Cc.OFFLINE&&(this.onlineWaiter=new gt(r=>{this.once(Pv.ONLINE,()=>{this.onlineWaiter=void 0,r(Cc.ONLINE)})}),this.emit(Pv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Cc.ONLINE}constructor(){super(),Zt(this,"_moduleName","network-indicator"),Zt(this,"_networkState",Cc.ONLINE),Zt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Cc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Cc.OFFLINE})}};function JA(e,r){const s=e.indexOf(r);s!==-1&&e.splice(s,1)}function Ov(e){const r=[];return e.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function QA(e){gt!==void 0?gt.resolve().then(e):setTimeout(e,0)}function Gr(e){return JSON.parse(JSON.stringify(e))}function W_(e){try{return Gr(e)}catch{return e}}const Oz={};function Mm(e,r){Oz[r]||(Oz[r]=!0,e())}function G_(e){const r=window.atob(e),s=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)s[o]=r.charCodeAt(o);return s}function Um(e){let r="";for(let s=0;s<e.length;s+=1)r+=String.fromCharCode(e[s]);return window.btoa(r)}function kz(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(e);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const o=new Uint8Array(r);o.set(s),s=o}return s}function Nz(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=Ha(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function Hh(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function Dz(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(s=>{r+=typeof s=="string"?Hh(s):s.size}),r+138}function Wfe(e){const r=new Le(ee.TIMEOUT,"timeout");return new gt((s,o)=>{window.setTimeout(()=>o(r),e)})}function vs(e){return new gt(r=>{window.setTimeout(r,e)})}function Er(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,e).toLowerCase();return s.length===e?"".concat(r).concat(s):"".concat(r).concat(s)+Er(e-s.length,"")}function H_(){return Er(32,"").toUpperCase()}const ZA=()=>{},xz=new class{constructor(){Zt(this,"fnMap",new Map)}throttleByKey(e,r,s,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout(()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:e,threshold:s,timer:g,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,Qe(Qe({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:e,threshold:s,timer:m,args:u,skipFn:o})}}},Lz=xz.throttleByKey.bind(xz);function Mz(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function dL(e,r){if(!Mz(e)||!Mz(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const s=[...e];for(let o=0;o<r.length;o++)s[o]=dL(e[o],r[o]);return s}{const s=Qe({},e);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?s[o]=dL(e[o],r[o]):s[o]=r[o]);return s}}function Uz(e,r){let s=[0];if(s=new Array(r).fill(0),e===0)return s;let o=0;for(;e>0&&(s[o]=255&e,e>>=8,o++,o!==r););return s}function kv(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function hL(e){return Ha(e).call(e,(r,s)=>r+s,0)}function Vz(e){const r="0123456789abcdef";function s(ae){let ye,_e="";for(ye=0;ye<=3;ye++)_e+=r.charAt(ae>>8*ye+4&15)+r.charAt(ae>>8*ye&15);return _e}function o(ae,ye){const _e=(65535&ae)+(65535&ye);return(ae>>16)+(ye>>16)+(_e>>16)<<16|65535&_e}function c(ae,ye,_e,ue,Ie,Ue){return o(function(We,Je){return We<<Je|We>>>32-Je}(o(o(ye,ae),o(ue,Ue)),Ie),_e)}function u(ae,ye,_e,ue,Ie,Ue,We){return c(ye&_e|~ye&ue,ae,ye,Ie,Ue,We)}function h(ae,ye,_e,ue,Ie,Ue,We){return c(ye&ue|_e&~ue,ae,ye,Ie,Ue,We)}function m(ae,ye,_e,ue,Ie,Ue,We){return c(ye^_e^ue,ae,ye,Ie,Ue,We)}function g(ae,ye,_e,ue,Ie,Ue,We){return c(_e^(ye|~ue),ae,ye,Ie,Ue,We)}const E=function(ae){let ye;const _e=1+(ae.length+8>>6),ue=new Array(16*_e);for(ye=0;ye<16*_e;ye++)ue[ye]=0;for(ye=0;ye<ae.length;ye++)ue[ye>>2]|=ae.charCodeAt(ye)<<ye%4*8;return ue[ye>>2]|=128<<ye%4*8,ue[16*_e-2]=8*ae.length,ue}(e);let S,C,A,O,W,F=1732584193,B=-271733879,Z=-1732584194,Q=271733878;for(S=0;S<E.length;S+=16)C=F,A=B,O=Z,W=Q,F=u(F,B,Z,Q,E[S+0],7,-680876936),Q=u(Q,F,B,Z,E[S+1],12,-389564586),Z=u(Z,Q,F,B,E[S+2],17,606105819),B=u(B,Z,Q,F,E[S+3],22,-1044525330),F=u(F,B,Z,Q,E[S+4],7,-176418897),Q=u(Q,F,B,Z,E[S+5],12,1200080426),Z=u(Z,Q,F,B,E[S+6],17,-1473231341),B=u(B,Z,Q,F,E[S+7],22,-45705983),F=u(F,B,Z,Q,E[S+8],7,1770035416),Q=u(Q,F,B,Z,E[S+9],12,-1958414417),Z=u(Z,Q,F,B,E[S+10],17,-42063),B=u(B,Z,Q,F,E[S+11],22,-1990404162),F=u(F,B,Z,Q,E[S+12],7,1804603682),Q=u(Q,F,B,Z,E[S+13],12,-40341101),Z=u(Z,Q,F,B,E[S+14],17,-1502002290),B=u(B,Z,Q,F,E[S+15],22,1236535329),F=h(F,B,Z,Q,E[S+1],5,-165796510),Q=h(Q,F,B,Z,E[S+6],9,-1069501632),Z=h(Z,Q,F,B,E[S+11],14,643717713),B=h(B,Z,Q,F,E[S+0],20,-373897302),F=h(F,B,Z,Q,E[S+5],5,-701558691),Q=h(Q,F,B,Z,E[S+10],9,38016083),Z=h(Z,Q,F,B,E[S+15],14,-660478335),B=h(B,Z,Q,F,E[S+4],20,-405537848),F=h(F,B,Z,Q,E[S+9],5,568446438),Q=h(Q,F,B,Z,E[S+14],9,-1019803690),Z=h(Z,Q,F,B,E[S+3],14,-187363961),B=h(B,Z,Q,F,E[S+8],20,1163531501),F=h(F,B,Z,Q,E[S+13],5,-1444681467),Q=h(Q,F,B,Z,E[S+2],9,-51403784),Z=h(Z,Q,F,B,E[S+7],14,1735328473),B=h(B,Z,Q,F,E[S+12],20,-1926607734),F=m(F,B,Z,Q,E[S+5],4,-378558),Q=m(Q,F,B,Z,E[S+8],11,-2022574463),Z=m(Z,Q,F,B,E[S+11],16,1839030562),B=m(B,Z,Q,F,E[S+14],23,-35309556),F=m(F,B,Z,Q,E[S+1],4,-1530992060),Q=m(Q,F,B,Z,E[S+4],11,1272893353),Z=m(Z,Q,F,B,E[S+7],16,-155497632),B=m(B,Z,Q,F,E[S+10],23,-1094730640),F=m(F,B,Z,Q,E[S+13],4,681279174),Q=m(Q,F,B,Z,E[S+0],11,-358537222),Z=m(Z,Q,F,B,E[S+3],16,-722521979),B=m(B,Z,Q,F,E[S+6],23,76029189),F=m(F,B,Z,Q,E[S+9],4,-640364487),Q=m(Q,F,B,Z,E[S+12],11,-421815835),Z=m(Z,Q,F,B,E[S+15],16,530742520),B=m(B,Z,Q,F,E[S+2],23,-995338651),F=g(F,B,Z,Q,E[S+0],6,-198630844),Q=g(Q,F,B,Z,E[S+7],10,1126891415),Z=g(Z,Q,F,B,E[S+14],15,-1416354905),B=g(B,Z,Q,F,E[S+5],21,-57434055),F=g(F,B,Z,Q,E[S+12],6,1700485571),Q=g(Q,F,B,Z,E[S+3],10,-1894986606),Z=g(Z,Q,F,B,E[S+10],15,-1051523),B=g(B,Z,Q,F,E[S+1],21,-2054922799),F=g(F,B,Z,Q,E[S+8],6,1873313359),Q=g(Q,F,B,Z,E[S+15],10,-30611744),Z=g(Z,Q,F,B,E[S+6],15,-1560198380),B=g(B,Z,Q,F,E[S+13],21,1309151649),F=g(F,B,Z,Q,E[S+4],6,-145523070),Q=g(Q,F,B,Z,E[S+11],10,-1120210379),Z=g(Z,Q,F,B,E[S+2],15,718787259),B=g(B,Z,Q,F,E[S+9],21,-343485551),F=o(F,C),B=o(B,A),Z=o(Z,O),Q=o(Q,W);return s(F)+s(B)+s(Z)+s(Q)}let Gfe=1,Fz=console,Zs=class{static setLogger(e){Fz=e}constructor(e,r){Zt(this,"id",void 0),Zt(this,"lockingPromise",gt.resolve()),Zt(this,"locks",0),Zt(this,"name",""),Zt(this,"lockId",void 0),this.lockId=Gfe++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");Fz.debug("".concat(s," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const s=new gt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),o}};function Nv(e,r){return function(s,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var g=arguments.length,E=new Array(g),S=0;S<g;S++)E[S]=arguments[S];return await u.apply(this,E)}finally{m()}},c}}const Di={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function pL(e,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,s)}function Ld(e,r,s,o){const c=Object.assign({},Di,o);let u=c.timeout;const h=async()=>{await function(E){return new gt(S=>{window.setTimeout(S,E)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const g=new gt(async(E,S)=>{r=r||(()=>!1),s=s||(()=>!0);for(let C=0;C<c.maxRetryCount;C+=1){if(m)return S(new Le(ee.OPERATION_ABORTED));try{const A=await e();if(!r(A,C)||C+1===c.maxRetryCount)return E(A);await h()}catch(A){if(!s(A,C)||C+1===c.maxRetryCount)return S(A);await h()}}});return g.cancel=()=>m=!0,g}let eP,jz=class{constructor(e){Zt(this,"input",[]),Zt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ha(e=this.input).call(e,(r,s)=>r+s)/this.input.length}},tP=0,fL=0;function mL(e,r,s,o){return new gt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),tP+=Hh(r.data)):s&&(r.data.size?tP+=r.data.size:r.data instanceof FormData?tP+=Dz(r.data):tP+=Hh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Ca.request(r).then(h=>{typeof h.data=="string"?fL+=Hh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?fL+=h.data.byteLength:fL+=Hh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Ca.isCancel(h)?u(new Le(ee.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Le(ee.NETWORK_TIMEOUT,h.message)):h.response?u(new Le(ee.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Le(ee.NETWORK_ERROR,h.message))})})}async function Hfe(e,r){const s=new Blob([r.data],{type:"buffer"});return await mL(e,Qe(Qe({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Bz=()=>window.isSecureContext!==void 0;function ku(e){if(Array.isArray(e))return e.map(s=>s);if(!zz(e))return e;const r={};for(const s in e){const o=e[s];zz(o)||Array.isArray(o)?r[s]=ku(o):r[s]=o}return r}function zz(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let gL=class{constructor(e){Zt(this,"input",[]),Zt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const $h={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Vw={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:$h,remoteCandidate:$h},updateInterval:0},Wz={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},Gz={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Hz={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},$z={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let _L=class{constructor(e,r){Zt(this,"onFirstVideoReceived",void 0),Zt(this,"onFirstVideoDecoded",void 0),Zt(this,"onFirstAudioReceived",void 0),Zt(this,"onFirstVideoDecodedTimeout",void 0),Zt(this,"onFirstAudioDecoded",void 0),Zt(this,"onSelectedLocalCandidateChanged",void 0),Zt(this,"onSelectedRemoteCandidateChanged",void 0),Zt(this,"videoIsReady",!1),Zt(this,"videoIsReady2",{}),Zt(this,"pc",void 0),Zt(this,"options",void 0),Zt(this,"intervalTimer",void 0),Zt(this,"stats",ku(Vw)),Zt(this,"isFirstVideoReceived",{}),Zt(this,"isFirstVideoDecoded",{}),Zt(this,"isFirstAudioReceived",{}),Zt(this,"isFirstAudioDecoded",{}),Zt(this,"isFirstVideoDecodedTimeout",{}),Zt(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new gt(e=>{e({local:Qe({},$h),remote:Qe({},$h)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of s)e[m].forEach((g,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const S=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,C=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=C):(c+=S,h+=C),Number.isNaN(S)||Number.isNaN(S)?g.packetLostRate=0:g.packetLostRate=S<=0||C<=0?0:C/(S+C)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},$fe=class extends _L{constructor(){super(...arguments),Zt(this,"_stats",Vw),Zt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=ku(Vw);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var s;const o=et(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=ku(Gz);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=ku(Wz),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Qe({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=ku($z);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=ku(Hz);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new gt((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(s=>{const o={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{o[c]=s.stat(c)}),r.push(o)}),r}},Fw=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),nP=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),yL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Jc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Dv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Dv||{});function jw(e,r,s,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Dv.kNone;if(!r)return;const u=Number(r[s]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[s]);if(typeof m!="number")return;const g=Number(e[o]);if(typeof g!="number")return;const E=h-g;return E?(u-m)/E*c:void 0}let Kz=class extends _L{constructor(){super(...arguments),Zt(this,"_stats",Vw),Zt(this,"report",void 0),Zt(this,"lastDecodeVideoReceiverStats",new Map),Zt(this,"lastVideoFramesRecv",new Map),Zt(this,"lastVideoFramesSent",new Map),Zt(this,"lastVideoFramesDecode",new Map),Zt(this,"lastVideoFramesOutput",new Map),Zt(this,"lastVideoJBDelay",new Map),Zt(this,"lastAudioJBDelay",new Map),Zt(this,"mediaBytesSent",new Map),Zt(this,"mediaBytesRetransmit",new Map),Zt(this,"mediaBytesTargetEncode",new Map),Zt(this,"lastDecodeAudioReceiverStats",new Map),Zt(this,"lastAudioConcealment",new Map),Zt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ku(Vw),this.report.forEach(e=>{switch(e.type){case Jc.OUTBOUND:case Jc.INBOUND:{const r=e.mediaType||e.kind,s=!r&&"frameWidth"in e,o=!r&&!("frameWidth"in e);e.type===Jc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(e):(r==="video"||s)&&this.processVideoOutboundStats(e):e.type===Jc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(e):(r==="video"||s)&&this.processVideoInboundStats(e));break}case Jc.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Jc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:Qe({},$h),remote:Qe({},$h)};return e.forEach(s=>{let o;if(s.type===Jc.TRANSPORT&&(o=e.get(s.selectedCandidatePairId)),s.type===Jc.CANDIDATE_PAIR&&s.selected&&(o=s),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===Jc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===Jc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===Jc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Qe({},r),Qe({},this.stats.selectedCandidatePair.localCandidate)),e.type===Jc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Qe({},r),Qe({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);r||(r=ku($z),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=jw(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Dv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),this.calculateAudioFreeze(r,s,e),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,Qe({},r))}calculateAudioFreeze(e,r,s){const o=this.lastAudioConcealment.get(e.ssrc);if(r!=null&&o!=null){const c=o.lts,u=s.timestamp,h=u-c;if(h<=0)return;const m=e.concealedSamples-r.concealedSamples-0,g=o.nonSilent+m,E=e.totalSamplesReceived-r.totalSamplesReceived;if(E<=0)return;const S=80*E/h,C=200*E/h,A=h/E;let O=0;e.freezeSamples80=r.freezeSamples80,e.freezeMs80=r.freezeMs80,g>S&&(o.plc80>0?(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*A)):(e.freezeSamples80+=g,e.freezeMs80+=Math.round(g*A)),O=o.plc80+1);let W=0;e.freezeSamples200=r.freezeSamples200,e.freezeMs200=r.freezeMs200,g>C&&(o.plc200>0?(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*A)):(e.freezeSamples200+=g,e.freezeMs200+=Math.round(g*A)),W=o.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:m,lts:u,plc80:O,plc200:W})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let r=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);r||(r=ku(Wz),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=u-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(s.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-s.qpSum)/(e.framesDecoded-s.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=jw(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=jw(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Dv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=jw(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Dv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=jw(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Dv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Qe({},r),lts:s?s.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);r||(r=ku(Gz),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(e.ssrc);if(s)s.add(e.bytesSent);else{const o=new gL(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new gL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new gL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,r.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const o=this.findRemoteStatsId(e.ssrc,Jc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(s=>s.ssrc===e.ssrc);if(r||(r=ku(Hz),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const s=this.findRemoteStatsId(e.ssrc,Jc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(e,r){var s;const o=Array.from(wc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,r){const s=this.report.get(e);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(e,r){const s=this.report.get(e);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(e,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,g=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof g!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,C=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof E=="number"&&typeof S=="number"||(E=0,S=0),C==null){const A=Date.now(),O=this.lastVideoFramesSent.get(s.ssrc);O&&A-O.lts>=800?(C=Math.round((g-O.count)/((A-O.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:C})):O?C=O.rate:this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:0})}s.sentFrame={width:E,height:S,frameRate:Math.max(0,C)}}processVideoTrackReceiverStats(e,r,s){var o,c,u,h,m;const g=r?this.report.get(r):void 0,E=(o=g==null?void 0:g.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:e.frameWidth,C=(u=g==null?void 0:g.frameHeight)!==null&&u!==void 0?u:e.frameHeight,A=(h=g==null?void 0:g.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,O=(m=g==null?void 0:g.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof E=="number"){const W=this.lastVideoFramesRecv.get(s.ssrc),F=Date.now();s.framesReceivedCount=E;let B=0;W&&F-W.lts>=800?(B=Math.round((E-W.count)/((F-W.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:F,rate:B})):W?B=W.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:F,rate:0}),s.receivedFrame={width:S||0,height:C||0,frameRate:B||0},s.decodedFrame={width:S||0,height:C||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:S||0,height:C||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(A&&O){const W=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let F=W.jitterBufferMs;const B=O-W.jitterBufferEmittedCount;B>0&&(F=1e3*(A-W.jitterBufferDelay)/B),s.jitterBufferMs=F,s.currentDelayMs=Math.round(F),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:O,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(e,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,g=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,E=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;s.aecReturnLoss=g,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(e,r,s){var o,c,u,h,m,g,E,S,C;const A=r?this.report.get(r):void 0,O=(o=A==null?void 0:A.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,W=(c=A==null?void 0:A.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,F=(u=A==null?void 0:A.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,B=(h=A==null?void 0:A.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,Z=(m=A==null?void 0:A.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,Q=(g=A==null?void 0:A.totalSamplesDuration)!==null&&g!==void 0?g:e==null?void 0:e.totalSamplesDuration,ae=(E=A==null?void 0:A.concealedSamples)!==null&&E!==void 0?E:e.concealedSamples,ye=(S=A==null?void 0:A.silentConcealedSamples)!==null&&S!==void 0?S:e.silentConcealedSamples,_e=(C=A==null?void 0:A.concealmentEvents)!==null&&C!==void 0?C:e.concealmentEvents;if(typeof W=="number"&&(s.totalSamplesReceived=W),typeof ye=="number"&&(s.silentConcealedSamples=ye),typeof _e=="number"&&(s.concealmentEvents=_e),typeof ae=="number"&&(s.concealedSamples=ae),O&&W&&(s.accelerateRate=O/W),F&&B){const Ie=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ue=Ie.jitterBufferMs;const We=B-Ie.jitterBufferEmittedCount;We>0&&(Ue=1e3*(F-Ie.jitterBufferDelay)/We),s.jitterBufferMs=Math.round(Ue),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:F,jitterBufferEmittedCount:B,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=Z;let ue=1920;Q&&W&&(ue=W/Q/50,s.receivedFrames=Math.round(W/ue)),ae&&(s.droppedFrames=Math.round(ae/ue))}processRemoteInboundStats(e,r){const s=this.report.get(e);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let e=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const o=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},Kfe=class extends _L{updateStats(){return gt.resolve()}};function EL(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new $fe(e,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Kz(e,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof gt||function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"}(m))}(e)?new Kz(e,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Kfe(e,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const qz="websdk_ng_install_id";function vL(){try{if(se("INSTALL_ID"))return se("INSTALL_ID");let e=window.localStorage.getItem(qz);return e||(e=H_(),window.localStorage.setItem(qz,e)),hr("INSTALL_ID",e),e}catch{return}}const Vl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],o=r[2];return"".concat(s,".").concat(o)}return"4.0.0.999"}("4.24.0"),SL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let $_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Vs=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const o=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Vs;const rP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},bL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},wL="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",TL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Ur=Qe(Qe(Qe(Qe({},TL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:bL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},rP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function hr(e,r,s){var o,c,u;et(o=Object.keys(Ur)).call(o,e)&&(!s&&et(c=Object.keys(Md)).call(c,e)||(Ur[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||r!==!0||(Ur.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,Ur.USE_NEW_NETWORK_CONFIG=u,u&&(Ur.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ur.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ur.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ur.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ur.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ur.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ur.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(Ur.ENABLE_INSTANT_VIDEO=!0,Ur.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(Ur.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(Ur.NEW_TURN_MODE||(Ur.NEW_TURN_MODE=4))))}function se(e){return Ur[e]}SL||(Ur.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ur.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ur.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ur.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ur.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ur.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ur.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ur.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ur.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ur.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ur.AREAS=["NORTH_AMERICA","OVERSEA"]);let Yz=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Md={};var en=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(en||{});let Bw=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const Xz=128,qfe=96,Jz=1e3,xv=10;let Yfe=0;var Qz=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>We,Printer:()=>tr,parse:()=>nt,print:()=>St});const h=`
`,m="".concat("\r").concat(h),g=" ";let E;function S(He){return He>="0"&&He<="9"}function C(He){return He>="!"&&He<="~"}function A(He){return C(He)||He>=""&&He<=""}function O(He){return He==="!"||He>="#"&&He<="'"||He>="*"&&He<="+"||He>="-"&&He<="."||He>="0"&&He<="9"||He>="A"&&He<="Z"||He>="^"&&He<="~"}function W(He){return He>="1"&&He<="9"}function F(He){return He>="A"&&He<="Z"||He>="a"&&He<="z"}function B(He){return He==="d"||He==="h"||He==="m"||He==="s"}function Z(He){return He>""&&He<"	"||He>"\v"&&He<"\f"||He>""&&He<""}function Q(He){return F(He)||S(He)||He==="+"||He==="/"}function ae(He){return S(He)||F(He)||He==="+"||He==="/"||He==="-"||He==="_"}function ye(He){return F(He)||S(He)||He==="+"||He==="/"}function _e(He,U){var le=Object.keys(He);if(Object.getOwnPropertySymbols){var me=Object.getOwnPropertySymbols(He);U&&(me=me.filter(function(Ze){return Object.getOwnPropertyDescriptor(He,Ze).enumerable})),le.push.apply(le,me)}return le}function ue(He){for(var U=1;U<arguments.length;U++){var le=arguments[U]!=null?arguments[U]:{};U%2?_e(Object(le),!0).forEach(function(me){Ie(He,me,le[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(He,Object.getOwnPropertyDescriptors(le)):_e(Object(le)).forEach(function(me){Object.defineProperty(He,me,Object.getOwnPropertyDescriptor(le,me))})}return He}function Ie(He,U,le){return U in He?Object.defineProperty(He,U,{value:le,enumerable:!0,configurable:!0,writable:!0}):He[U]=le,He}(function(He){He.VERSION="v",He.ORIGIN="o",He.SESSION_NAME="s",He.INFORMATION="i",He.URI="u",He.EMAIL="e",He.PHONE="p",He.CONNECTION="c",He.BANDWIDTH="b",He.TIME="t",He.REPEAT="r",He.ZONE_ADJUSTMENTS="z",He.KEY="k",He.ATTRIBUTE="a",He.MEDIA="m"})(E||(E={}));class Ue{consumeText(U,le){let me=le;for(;me<U.length;){const Ze=U[me];if(Ze==="\0"||Ze==="\r"||Ze===h)break;me+=1}if(me-le==0)throw new Error("Invalid text, at ".concat(U));return me}consumeUnicastAddress(U,le,me){return this.consumeTill(U,le,g)}consumeOneOrMore(U,le,me){let Ze=le;for(;me(U[Ze]);)Ze++;if(Ze-le==0)throw new Error("Invalid rule at ".concat(le,"."));return Ze}consumeSpace(U,le){if(U[le]===g)return le+1;throw new Error("Invalid space at ".concat(le,"."))}consumeIP4Address(U,le){let me=le;for(let Ze=0;Ze<4;Ze++)if(me=this.consumeDecimalUChar(U,me),Ze!==3){if(U[me]!==".")throw new Error("Invalid IP4 address.");me++}return me}consumeDecimalUChar(U,le){let me=le;for(let on=0;on<3&&S(U[me]);on++,me++);if(me-le==0)throw new Error("Invalid decimal uchar.");const Ze=parseInt(U.slice(le,me));if(Ze>=0&&Ze<=255)return me;throw new Error("Invalid decimal uchar")}consumeIP6Address(U,le){let me=this.consumeHexpart(U,le);return U[me]===":"&&(me+=1,me=this.consumeIP4Address(U,me)),me}consumeHexpart(U,le){let me=le;if(U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}if(me=this.consumeHexseq(U,me),U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}return me}consumeHexseq(U,le){let me=le;for(;me=this.consumeHex4(U,me),U[me]===":"&&U[me+1]!==":";)me+=1;return me}consumeHex4(U,le){let me=0;for(;me<4;me++)if(!((Ze=U[le+me])>="0"&&Ze<="9"||Ze>="a"&&Ze<="f"||Ze>="A"&&Ze<="F")){if(me===0)throw new Error("Invalid hex 4");break}var Ze;return le+me}consumeFQDN(U,le){let me=le;for(;S(U[me])||F(U[me])||U[me]==="-"||U[me]===".";)me+=1;if(me-le<4)throw new Error("Invalid FQDN");return me}consumeExtnAddr(U,le){return this.consumeOneOrMore(U,le,A)}consumeMulticastAddress(U,le,me){switch(me){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(U,le);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(U,le);default:try{return this.consumeFQDN(U,le)}catch{return this.consumeExtnAddr(U,le)}}}consumeIP6MulticastAddress(U,le){const me=this.consumeHexpart(U,le);return U[me]==="/"?this.consumeInteger(U,me+1):me}consumeIP4MulticastAddress(U,le){let me=le+3;const Ze=U.slice(le,me),on=parseInt(Ze);if(on<224||on>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let wr=0;wr<3;wr++){if(U[me]!==".")throw new Error("Invalid IP4 multicast address.");me+=1,me=this.consumeDecimalUChar(U,me)}return U[me]==="/"&&(me+=1),me=this.consumeTTL(U,me),U[me]==="/"&&(me=this.consumeInteger(U,me)),me}consumeInteger(U,le){if(!W(U[le]))throw new Error("Invalid integer.");for(le+=1;S(U[le]);)le+=1;return le}consumeTTL(U,le){if(U[le]==="0")return le+1;if(!W(U[le]))throw new Error("Invalid TTL.");le+=1;for(let me=0;me<2&&S(U[le]);me++)le+=1;return le}consumeToken(U,le){return this.consumeOneOrMore(U,le,O)}consumeTime(U,le){let me=le;if(U[me]==="0")return me+1;for(W(U[me])&&(me+=1);S(U[me]);)me++;if(me-le<10)throw new Error("Invalid time");return me}consumeAddress(U,le){return this.consumeTill(U,le,g)}consumeTypedTime(U,le){let me=le;return me=this.consumeOneOrMore(U,me,S),B(U[me])?me+1:me}consumeRepeatInterval(U,le){if(!W(U[le]))throw new Error("Invalid repeat interval");for(le+=1;S(U[le]);)le+=1;return B(U[le])&&(le+=1),le}consumePort(U,le){return this.consumeOneOrMore(U,le,S)}consume(U,le,me){for(let Ze=0;Ze<me.length;Ze++){if(le+Ze>=U.length)throw new Error("consume exceeding value length");if(U[le+Ze]!==me[Ze])throw new Error("consume ".concat(me," failed at ").concat(Ze))}return le+me.length}consumeTill(U,le,me){let Ze=le;for(;Ze<U.length&&(typeof me!="string"||U[Ze]!==me)&&(typeof me!="function"||!me(U[Ze]));)Ze++;return Ze}}class We extends Ue{constructor(){super(),Ie(this,"records",[]),Ie(this,"currentLine",0)}parse(U){const le=this.probeEOL(U);this.records=U.split(le).filter(gf=>!!No(gf).call(gf)).map(this.parseLine),this.currentLine=0;const me=this.parseVersion(),Ze=this.parseOrigin(),on=this.parseSessionName(),wr=this.parseInformation(),Fi=this.parseUri(),Kl=this.parseEmail(),Wu=this.parsePhone(),RT=this.parseConnection(),hy=this.parseBandWidth(),hS=this.parseTimeFields(),_1=this.parseKey(),y1=this.parseSessionAttribute(),ql=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:me,origin:Ze,sessionName:on,information:wr,uri:Fi,emails:Kl,phones:Wu,connection:RT,bandwidths:hy,timeFields:hS,key:_1,attributes:y1,mediaDescriptions:ql}}getCurrentRecord(){const U=this.records[this.currentLine];if(!U)throw new Error("Record doesn't exit.");return U}probeEOL(U){for(let le=0;le<U.length;le++)if(U[le]===h)return U[le-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(U,le){if(U.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const me=U[0];if(U[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:me,value:U.slice(2),line:le,cur:0}}parseSessionAttribute(){const U=new pn;for(;this.currentLine<this.records.length;){const le=this.getCurrentRecord();if(le.type!==E.ATTRIBUTE)break;const me={attField:this.extractOneOrMore(le,Ze=>O(Ze)&&Ze!==":"),_cur:0};le.value[le.cur]===":"&&(le.cur+=1,me.attValue=this.extractOneOrMore(le,Z)),U.parse(me),this.currentLine++}return U.digest()}parseMediaAttributes(U){const le=new En(U);for(;this.currentLine<this.records.length;){const me=this.getCurrentRecord();if(me.type!==E.ATTRIBUTE)break;const Ze={attField:this.extractOneOrMore(me,on=>O(on)&&on!==":"),_cur:0};me.value[me.cur]===":"&&(me.cur+=1,Ze.attValue=this.extractOneOrMore(me,Z)),le.parse(Ze),this.currentLine++}return le.digest()}parseKey(){const U=this.getCurrentRecord();if(U.type===E.KEY){if(U.value==="prompt"||U.value==="clear:"||U.value==="base64:"||U.value==="uri:")return U.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const U=this.getCurrentRecord();if(U.type===E.ZONE_ADJUSTMENTS){const le=[];for(;;)try{const me=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);let Ze=!1;U.value[U.cur]==="-"&&(Ze=!0,U.cur+=1);const on=this.extract(U,this.consumeTypedTime);le.push({time:me,typedTime:on,back:Ze})}catch{break}if(le.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,le}return[]}parseRepeat(){const U=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.REPEAT)break;{const me=this.extract(le,this.consumeRepeatInterval),Ze=this.parseTypedTime(le);U.push({repeatInterval:me,typedTimes:Ze}),this.currentLine++}}return U}parseTypedTime(U){const le=[];for(;;)try{this.consumeSpaceForRecord(U),le.push(this.extract(U,this.consumeTypedTime))}catch{break}if(le.length===0)throw new Error("Invalid typed time.");return le}parseTime(){const U=this.getCurrentRecord(),le=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);const me=this.extract(U,this.consumeTime);return this.currentLine++,{startTime:le,stopTime:me}}parseBandWidth(){const U=[];for(;this.currentLine<this.records.length;){const le=this.getCurrentRecord();if(le.type!==E.BANDWIDTH)break;{const me=this.extractOneOrMore(le,O);if(le.value[le.cur]!==":")throw new Error("Invalid bandwidth field.");le.cur++;const Ze=this.extractOneOrMore(le,S);U.push({bwtype:me,bandwidth:Ze}),this.currentLine++}}return U}parseVersion(){const U=this.getCurrentRecord();if(U.type!==E.VERSION)throw new Error("first sdp record must be version");const le=U.value.slice(0,this.consumeOneOrMore(U.value,0,S));if(le.length!==U.value.length)throw new Error('invalid proto version, "v='.concat(U.value,'"'));return this.currentLine++,le}parseOrigin(){const U=this.getCurrentRecord();if(U.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const le=this.extractOneOrMore(U,A);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,S);this.consumeSpaceForRecord(U);const Ze=this.extractOneOrMore(U,S);this.consumeSpaceForRecord(U);const on=this.extractOneOrMore(U,O);this.consumeSpaceForRecord(U);const wr=this.extractOneOrMore(U,O);this.consumeSpaceForRecord(U);const Fi=this.extract(U,this.consumeUnicastAddress);return this.currentLine++,{username:le,sessId:me,sessVersion:Ze,nettype:on,addrtype:wr,unicastAddress:Fi}}parseSessionName(){const U=this.getCurrentRecord();if(U.type===E.SESSION_NAME){const le=this.extract(U,this.consumeText);return this.currentLine++,le}}parseInformation(){const U=this.getCurrentRecord();if(U.type!==E.INFORMATION)return;const le=this.extract(U,this.consumeText);return this.currentLine++,le}parseUri(){const U=this.getCurrentRecord();if(U.type===E.URI)return this.currentLine++,U.value}parseEmail(){const U=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.EMAIL)break;U.push(le.value),this.currentLine++}return U}parsePhone(){const U=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.PHONE)break;U.push(le.value),this.currentLine++}return U}parseConnection(){const U=this.getCurrentRecord();if(U.type===E.CONNECTION){const le=this.extractOneOrMore(U,O);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,O);this.consumeSpaceForRecord(U);const Ze=this.extract(U,this.consumeAddress);return this.currentLine++,{nettype:le,addrtype:me,address:Ze}}}parseMedia(){const U=this.getCurrentRecord(),le=this.extract(U,this.consumeToken);this.consumeSpaceForRecord(U);let me=this.extract(U,this.consumePort);U.value[U.cur]==="/"&&(U.cur+=1,me+=this.extract(U,this.consumeInteger)),this.consumeSpaceForRecord(U);const Ze=[];for(Ze.push(this.extract(U,this.consumeToken));U.value[U.cur]==="/";)U.cur+=1,Ze.push(this.extract(U,this.consumeToken));if(Ze.length===0)throw new Error("Invalid proto");const on=this.parseFmt(U);return this.currentLine++,{mediaType:le,port:me,protos:Ze,fmts:on}}parseTimeFields(){const U=[];for(;this.getCurrentRecord().type===E.TIME;){const le=this.parseTime(),me=this.parseRepeat(),Ze=this.parseZone();U.push({time:le,repeats:me,zones:Ze})}return U}parseMediaDescription(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const le=this.parseMedia(),me=this.parseInformation(),Ze=this.parseConnections(),on=this.parseBandWidth(),wr=this.parseKey(),Fi=this.parseMediaAttributes(le);U.push({media:le,information:me,connections:Ze,bandwidths:on,key:wr,attributes:Fi})}return U}parseConnections(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)U.push(this.parseConnection());return U}parseFmt(U){const le=[];for(;;)try{this.consumeSpaceForRecord(U),le.push(this.extract(U,this.consumeToken))}catch{break}if(le.length===0)throw new Error("Invalid fmts");return le}extract(U,le){for(var me=arguments.length,Ze=new Array(me>2?me-2:0),on=2;on<me;on++)Ze[on-2]=arguments[on];const wr=le.call(this,U.value,U.cur,...Ze),Fi=U.value.slice(U.cur,wr);return U.cur=wr,Fi}extractOneOrMore(U,le){const me=this.consumeOneOrMore(U.value,U.cur,le),Ze=U.value.slice(U.cur,me);return U.cur=me,Ze}consumeSpaceForRecord(U){if(U.value[U.cur]!==g)throw new Error("Invalid space at ".concat(U.cur,"."));U.cur+=1}}class Je extends Ue{constructor(){super(...arguments),Ie(this,"attributes",void 0),Ie(this,"digested",!1)}extractOneOrMore(U,le,me){const Ze=this.consumeOneOrMore(U.attValue,U._cur,le),on=U.attValue.slice(U._cur,Ze),[wr,Fi]=me||[];if(typeof wr=="number"&&on.length<wr)throw new Error("error in length, should be more or equal than ".concat(wr," characters."));if(typeof Fi=="number"&&on.length>Fi)throw new Error("error in length, should be less or equal than ".concat(Fi," characters."));return U._cur=Ze,on}consumeAttributeSpace(U){if(U.attValue[U._cur]!==g)throw new Error("Invalid space at ".concat(U._cur,"."));U._cur+=1}extract(U,le){if(!U.attValue)throw new Error("Nothing to extract from attValue.");for(var me=arguments.length,Ze=new Array(me>2?me-2:0),on=2;on<me;on++)Ze[on-2]=arguments[on];const wr=le.call(this,U.attValue,U._cur,...Ze),Fi=U.attValue.slice(U._cur,wr);return U._cur=wr,Fi}atEnd(U){if(!U.attValue)throw new Error;return U._cur>=U.attValue.length}peekChar(U){if(!U.attValue)throw new Error;return U.attValue[U._cur]}peek(U,le){if(!U.attValue)throw new Error;for(let me=0;me<le.length;me++)if(le[me]!==U.attValue[U._cur+me])return!1;return!0}parseIceUfrag(U){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(U,Q,[4,256])}parseIcePwd(U){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(U,Q,[22,256])}parseIceOptions(U){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const le=[];for(;!this.atEnd(U);){le.push(this.extractOneOrMore(U,Q));try{this.consumeAttributeSpace(U)}catch(me){if(this.atEnd(U))break;throw me}}this.attributes.iceOptions=le}parseFingerprint(U){const le=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill);this.attributes.fingerprints.push({hashFunction:le,fingerprint:me})}parseExtmap(U){const le=this.extractOneOrMore(U,S);let me;this.peekChar(U)==="/"&&(this.extract(U,this.consume,"/"),me=this.extract(U,this.consumeToken)),this.consumeAttributeSpace(U);const Ze=this.extract(U,this.consumeTill,g),on=ue(ue({entry:parseInt(le,10)},me&&{direction:me}),{},{extensionName:Ze});this.peekChar(U)===g&&(this.consumeAttributeSpace(U),on.extensionAttributes=this.extract(U,this.consumeTill)),this.attributes.extmaps.push(on)}parseSetup(U){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const le=this.extract(U,this.consumeTill);if(le!=="active"&&le!=="passive"&&le!=="actpass"&&le!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=le}}class pn extends Je{constructor(){super(...arguments),Ie(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"group":this.parseGroup(U);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"fingerprint":this.parseFingerprint(U);break;case"setup":this.parseSetup(U);break;case"tls-id":this.parseTlsId(U);break;case"identity":this.parseIdentity(U);break;case"extmap":this.parseExtmap(U);break;case"msid-semantic":this.parseMsidSemantic(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(le){throw console.error("parsing session attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),le}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(U){const le=this.extract(U,this.consumeToken),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===g;)this.consumeAttributeSpace(U),me.push(this.extract(U,this.consumeToken));this.attributes.groups.push({semantic:le,identificationTag:me})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(U){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(U,ae)}parseIdentity(U){const le=this.extractOneOrMore(U,ye),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===g;){this.consumeAttributeSpace(U);const Ze=this.extract(U,this.consumeToken);this.extract(U,this.consume,"=");const on=this.extractOneOrMore(U,wr=>wr!==g&&Z(wr));me.push({name:Ze,value:on})}this.attributes.identities.push({assertionValue:le,extensions:me})}parseMsidSemantic(U){this.peekChar(U)===g&&this.consumeAttributeSpace(U);const le={semantic:this.extract(U,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(U)}catch{break}if(this.peekChar(U)==="*"){this.extract(U,this.consume,"*"),le.applyForAll=!0;break}{const me=this.extract(U,this.consumeTill,g);le.identifierList.push(me)}}this.attributes.msidSemantic=le}}class En extends Je{constructor(U){super(),Ie(this,"attributes",void 0),U.protos.indexOf("RTP")!==-1||U.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"extmap":this.parseExtmap(U);break;case"setup":this.parseSetup(U);break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"candidate":this.parseCandidate(U);break;case"remote-candidate":this.parseRemoteCandidate(U);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(U);break;case"rtpmap":this.parseRtpmap(U);break;case"ptime":this.parsePtime(U);break;case"maxptime":this.parseMaxPtime(U);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(U);break;case"ssrc":this.parseSSRC(U);break;case"fmtp":this.parseFmtp(U);break;case"rtcp-fb":this.parseRtcpFb(U);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(U);break;case"mid":this.parseMid(U);break;case"msid":this.parseMsid(U);break;case"imageattr":this.parseImageAttr(U);break;case"rid":this.parseRid(U);break;case"simulcast":this.parseSimulcast(U);break;case"sctp-port":this.parseSctpPort(U);break;case"max-message-size":this.parseMaxMessageSize(U);break;case"ssrc-group":this.parseSSRCGroup(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(le){throw console.error("parsing media attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),le}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}parseCandidate(U){const le=this.extractOneOrMore(U,Q,[1,32]);this.consumeAttributeSpace(U);const me=this.extractOneOrMore(U,S,[1,5]);this.consumeAttributeSpace(U);const Ze=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const on=this.extractOneOrMore(U,S,[1,10]);this.consumeAttributeSpace(U);const wr=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const Fi=this.extract(U,this.consumePort);this.consumeAttributeSpace(U),this.extract(U,this.consume,"typ"),this.consumeAttributeSpace(U);const Kl={foundation:le,componentId:me,transport:Ze,priority:on,connectionAddress:wr,port:Fi,type:this.extract(U,this.consumeToken),extension:{}};for(this.peek(U," raddr")&&(this.extract(U,this.consume," raddr"),this.consumeAttributeSpace(U),Kl.relAddr=this.extract(U,this.consumeAddress)),this.peek(U," rport")&&(this.extract(U,this.consume," rport"),this.consumeAttributeSpace(U),Kl.relPort=this.extract(U,this.consumePort));this.peekChar(U)===g;){this.consumeAttributeSpace(U);const Wu=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U),Kl.extension[Wu]=this.extractOneOrMore(U,C)}this.attributes.candidates.push(Kl)}parseRemoteCandidate(U){const le=[];for(;;){const me=this.extractOneOrMore(U,S,[1,5]);this.consumeAttributeSpace(U);const Ze=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const on=this.extract(U,this.consumePort);le.push({componentId:me,connectionAddress:Ze,port:on});try{this.consumeAttributeSpace(U)}catch{break}}this.attributes.remoteCandidatesList.push(le)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(U){const le=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,"/");this.extract(U,this.consume,"/");const Ze={encodingName:me,clockRate:this.extractOneOrMore(U,S)};this.atEnd(U)||this.peekChar(U)!=="/"||(this.extract(U,this.consume,"/"),Ze.encodingParameters=parseInt(this.extract(U,this.consumeTill),10));const on=this.attributes.payloads.find(wr=>wr.payloadType===parseInt(le,10));on?on.rtpMap=Ze:this.attributes.payloads.push({payloadType:parseInt(le,10),rtpMap:Ze,rtcpFeedbacks:[]})}parsePtime(U){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(U,this.consumeTill)}parseMaxPtime(U){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(U,this.consumeTill)}parseDirection(U){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=U.attField}parseSSRC(U){const le=this.extractOneOrMore(U,S);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,":");let Ze;this.peekChar(U)===":"&&(this.extract(U,this.consume,":"),Ze=this.extract(U,this.consumeTill));const on=this.attributes.ssrcs.find(wr=>wr.ssrcId===parseInt(le,10));on?on.attributes[me]=Ze:this.attributes.ssrcs.push({ssrcId:parseInt(le,10),attributes:{[me]:Ze}})}parseFmtp(U){const le=this.extract(U,this.consumeTill,g);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill),Ze={};me.split(";").forEach(wr=>{let[Fi,Kl]=wr.split("=");Fi=No(Fi).call(Fi);const Wu=typeof Kl=="string"?No(Kl).call(Kl):null;typeof Fi=="string"&&Fi.length>0&&(Ze[Fi]=Wu)});const on=this.attributes.payloads.find(wr=>wr.payloadType===parseInt(le,10));on?on.fmtp={parameters:Ze}:this.attributes.payloads.push({payloadType:parseInt(le,10),rtcpFeedbacks:[],fmtp:{parameters:Ze}})}parseFmtParameters(U){const le={},me=this.extract(U,this.consumeTill,"=");U._cur++;const Ze=this.extract(U,this.consumeTill,";");for(le[me]=Ze;U.attValue[U._cur]===";";){const on=this.extract(U,this.consumeTill,"=");U._cur++;const wr=this.extract(U,this.consumeTill,";");le[on]=wr}return le}parseRtcpFb(U){let le="";le=this.peekChar(U)==="*"?this.extract(U,this.consume,"*"):this.extract(U,this.consumeTill,g),this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,g);let Ze;if(me==="trr-int")Ze={type:me,interval:this.extract(U,this.consumeTill)};else{const on={type:me};this.peekChar(U)===g&&(this.consumeAttributeSpace(U),on.parameter=this.extract(U,this.consumeToken),this.peekChar(U)===g&&(on.additional=this.extract(U,this.consumeTill))),Ze=on}if(le==="*")this.attributes.rtcpFeedbackWildcards.push(Ze);else{const on=this.attributes.payloads.find(wr=>wr.payloadType===parseInt(le,10));on?on.rtcpFeedbacks.push(Ze):this.attributes.payloads.push({payloadType:parseInt(le,10),rtcpFeedbacks:[Ze]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(U){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const le={port:this.extract(U,this.consumePort)};this.peekChar(U)===g&&(this.consumeAttributeSpace(U),le.netType=this.extractOneOrMore(U,O),this.consumeAttributeSpace(U),le.addressType=this.extractOneOrMore(U,O),this.consumeAttributeSpace(U),le.address=this.extract(U,this.consumeAddress)),this.attributes.rtcp=le}parseMsid(U){const le={id:this.extractOneOrMore(U,O,[1,64])};this.peekChar(U)===g&&(this.consumeAttributeSpace(U),le.appdata=this.extractOneOrMore(U,O,[1,64])),this.attributes.msids.push(le)}parseImageAttr(U){this.attributes.imageattr.push(U.attValue)}parseRid(U){const le=this.extractOneOrMore(U,Ze=>F(Ze)||S(Ze)||Ze==="_"||Ze==="-");this.consumeAttributeSpace(U);const me={id:le,direction:this.extract(U,this.consumeToken),params:[]};if(this.peekChar(U)===g){if(this.consumeAttributeSpace(U),this.peek(U,"pt=")){this.extract(U,this.consume,"pt=");const Ze=[];for(;;){const on=this.extract(U,this.consumeToken);Ze.push(on);try{this.extract(U,this.consume,",")}catch{break}}me.payloads=Ze,this.peekChar(U)===g&&this.extract(U,this.consume,g)}for(;;){const Ze=this.extract(U,this.consumeToken);switch(Ze){case"depend":{const on={type:Ze,rids:this.extract(U,this.consume,"=").split(",")};me.params.push(on);break}default:{const on={type:Ze};this.peekChar(U)==="="&&(this.extract(U,this.consume,"="),on.val=this.extract(U,this.consumeTill,";")),me.params.push(on)}}try{this.extract(U,this.consume,";")}catch{break}}}this.attributes.rids.push(me)}parseSimulcast(U){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=U.attValue,this.extract(U,this.consumeTill)}parseSctpPort(U){this.attributes.sctpPort=this.extractOneOrMore(U,S,[1,5])}parseMaxMessageSize(U){this.attributes.maxMessageSize=this.extractOneOrMore(U,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(U){this.attributes.mid=this.extract(U,this.consumeToken)}parseSSRCGroup(U){const le=this.extract(U,this.consumeToken),me=[];for(;;)try{this.consumeAttributeSpace(U);const Ze=this.extract(U,this.consumeInteger);me.push(parseInt(Ze,10))}catch{break}this.attributes.ssrcGroups.push({semantic:le,ssrcIds:me})}}function Jt(He,U,le){return U in He?Object.defineProperty(He,U,{value:le,enumerable:!0,configurable:!0,writable:!0}):He[U]=le,He}class tr{constructor(){Jt(this,"eol",m)}print(U,le){let me="";return le&&(this.eol=le),me+=this.printVersion(U.version),me+=this.printOrigin(U.origin),me+=this.printSessionName(U.sessionName),me+=this.printInformation(U.information),me+=this.printUri(U.uri),me+=this.printEmail(U.emails),me+=this.printPhone(U.phones),me+=this.printConnection(U.connection),me+=this.printBandwidth(U.bandwidths),me+=this.printTimeFields(U.timeFields),me+=this.printKey(U.key),me+=this.printSessionAttributes(U.attributes),me+=this.printMediaDescription(U.mediaDescriptions),me}printVersion(U){return"v=".concat(U).concat(this.eol)}printOrigin(U){return"o=".concat(U.username," ").concat(U.sessId," ").concat(U.sessVersion," ").concat(U.nettype," ").concat(U.addrtype," ").concat(U.unicastAddress).concat(this.eol)}printSessionName(U){return U?"s=".concat(U).concat(this.eol):""}printInformation(U){return U?"i=".concat(U).concat(this.eol):""}printUri(U){return U?"u=".concat(U).concat(this.eol):""}printEmail(U){let le="";for(const me of U)le+="e=".concat(me).concat(this.eol);return le}printPhone(U){let le="";for(const me of U)le+="e=".concat(me).concat(this.eol);return le}printConnection(U){return U?"c=".concat(U.nettype," ").concat(U.addrtype," ").concat(U.address).concat(this.eol):""}printBandwidth(U){let le="";for(const me of U)le+="b=".concat(me.bwtype,":").concat(me.bandwidth).concat(this.eol);return le}printTimeFields(U){let le="";for(const me of U){le+="t=".concat(me.time.startTime," ").concat(me.time.startTime).concat(this.eol);for(const Ze of me.repeats)le+="r=".concat(Ze.repeatInterval," ").concat(Ze.typedTimes.join(" ")).concat(this.eol);me.zoneAdjustments&&(le+="z=",le+="z=".concat(me.zoneAdjustments.map(Ze=>"".concat(Ze.time," ").concat(Ze.back?"-":""," ").concat(Ze.typedTime)).join(" ")).concat(this.eol),le+=this.eol)}return le}printKey(U){return U?"k=".concat(U).concat(this.eol):""}printAttributes(U){let le="";for(const me of U)le+="a=".concat(me.attField).concat(me.attValue?":".concat(me.attValue):"").concat(this.eol);return le}printMediaDescription(U){let le="";for(const me of U)le+=this.printMedia(me.media),le+=this.printInformation(me.information),le+=this.printConnections(me.connections),le+=this.printBandwidth(me.bandwidths),le+=this.printKey(me.key),le+=this.printMediaAttributes(me);return le}printConnections(U){let le="";for(const me of U)le+=this.printConnection(me);return le}printMedia(U){return"m=".concat(U.mediaType," ").concat(U.port," ").concat(U.protos.join("/")," ").concat(U.fmts.join(" ")).concat(this.eol)}printSessionAttributes(U){return new io(this.eol).print(U)}printMediaAttributes(U){return new ze(this.eol).print(U)}}class qn{constructor(U){Jt(this,"eol",void 0),this.eol=U}printIceUfrag(U){return U===void 0?"":"a=ice-ufrag:".concat(U).concat(this.eol)}printIcePwd(U){return U===void 0?"":"a=ice-pwd:".concat(U).concat(this.eol)}printIceOptions(U){return U===void 0?"":"a=ice-options:".concat(U.join(g)).concat(this.eol)}printFingerprints(U){return U.length>0?U.map(le=>"a=fingerprint:".concat(le.hashFunction).concat(g).concat(le.fingerprint)).join(this.eol)+this.eol:""}printExtmap(U){return U.map(le=>"a=extmap:".concat(le.entry).concat(le.direction?"/".concat(le.direction):"").concat(g).concat(le.extensionName).concat(le.extensionAttributes?"".concat(g).concat(le.extensionAttributes):"").concat(this.eol)).join("")}printSetup(U){return U===void 0?"":"a=setup:".concat(U).concat(this.eol)}printUnrecognized(U){return U.map(le=>"a=".concat(le.attField).concat(le.attValue?":".concat(le.attValue):"").concat(this.eol)).join("")}}class io extends qn{print(U){let le="";return le+=this.printGroups(U.groups),le+=this.printMsidSemantic(U.msidSemantic),le+=this.printIceLite(U.iceLite),le+=this.printIceUfrag(U.iceUfrag),le+=this.printIcePwd(U.icePwd),le+=this.printIceOptions(U.iceOptions),le+=this.printFingerprints(U.fingerprints),le+=this.printSetup(U.setup),le+=this.printTlsId(U.tlsId),le+=this.printIdentity(U.identities),le+=this.printExtmap(U.extmaps),le+=this.printUnrecognized(U.unrecognized),le}printGroups(U){let le="";return U.length>0&&(le+=U.map(me=>"a=group:".concat(me.semantic).concat(me.identificationTag.map(Ze=>"".concat(g).concat(Ze)).join("")).concat(this.eol)).join("")),le}printIceLite(U){return U===void 0?"":"a=ice-lite"+this.eol}printTlsId(U){return U?"a=tls-id:".concat(U).concat(this.eol):""}printIdentity(U){return U.length===0?"":U.map(le=>"a=identity:".concat(le.assertionValue).concat(le.extensions.map(me=>"".concat(g).concat(me.name).concat(me.value?"=".concat(me.value):"")))).join(this.eol)+this.eol}printMsidSemantic(U){if(!U)return"";let le="a=msid-semantic:".concat(U.semantic);return U.applyForAll?le+="".concat(g,"*"):U.identifierList.length>0&&(le+=U.identifierList.map(me=>"".concat(g).concat(me))),le+this.eol}}class ze extends qn{print(U){const le=U.attributes;let me="";return me+=this.printRTCP(le.rtcp),me+=this.printIceUfrag(le.iceUfrag),me+=this.printIcePwd(le.icePwd),me+=this.printIceOptions(le.iceOptions),me+=this.printCandidates(le.candidates),me+=this.printRemoteCandidatesList(le.remoteCandidatesList),me+=this.printEndOfCandidates(le.endOfCandidates),me+=this.printFingerprints(le.fingerprints),me+=this.printSetup(le.setup),me+=this.printMid(le.mid),me+=this.printExtmap(le.extmaps),me+=this.printRTPRelated(le),me+=this.printPtime(le.ptime),me+=this.printMaxPtime(le.maxPtime),me+=this.printDirection(le.direction),me+=this.printSSRCGroups(le.ssrcGroups),me+=this.printSSRC(le.ssrcs),me+=this.printRTCPMux(le.rtcpMux),me+=this.printRTCPMuxOnly(le.rtcpMuxOnly),me+=this.printRTCPRsize(le.rtcpRsize),me+=this.printMSId(le.msids),me+=this.printImageattr(le.imageattr),me+=this.printRid(le.rids),me+=this.printSimulcast(le.simulcast),me+=this.printSCTPPort(le.sctpPort),me+=this.printMaxMessageSize(le.maxMessageSize),me+=this.printUnrecognized(le.unrecognized),me}printCandidates(U){return U.map(le=>"a=candidate:".concat(le.foundation).concat(g).concat(le.componentId).concat(g).concat(le.transport).concat(g).concat(le.priority).concat(g).concat(le.connectionAddress).concat(g).concat(le.port).concat(g,"typ").concat(g).concat(le.type).concat(le.relAddr?"".concat(g,"raddr").concat(g).concat(le.relAddr):"").concat(le.relPort?"".concat(g,"rport").concat(g).concat(le.relPort):"").concat(Object.keys(le.extension).map(me=>"".concat(g).concat(me).concat(g).concat(le.extension[me])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(U){return U.map(le=>"a=remote-candidates:".concat(le.join(g)).concat(this.eol)).join("")}printEndOfCandidates(U){return U===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(U){if(!U.payloads)return"";const le=U.payloads;let me="";me+=U.rtcpFeedbackWildcards.map(Ze=>this.printRTCPFeedback("*",Ze)).join("");for(const Ze of le)me+=this.printRtpMap(Ze.payloadType,Ze.rtpMap),me+=this.printFmtp(Ze.payloadType,Ze.fmtp),me+=Ze.rtcpFeedbacks.map(on=>this.printRTCPFeedback(Ze.payloadType,on)).join("");return me}printFmtp(U,le){if(!le)return"";const me=Object.keys(le.parameters);return me.length===1&&le.parameters[me[0]]===null?"a=fmtp:".concat(U).concat(g).concat(me[0]).concat(this.eol):"a=fmtp:".concat(U).concat(g).concat(Object.keys(le.parameters).map(Ze=>"".concat(Ze,"=").concat(le.parameters[Ze])).join(";")).concat(this.eol)}printRtpMap(U,le){return le?"a=rtpmap:".concat(U).concat(g).concat(le.encodingName,"/").concat(le.clockRate).concat(le.encodingParameters?"/".concat(le.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(U,le){let me="a=rtcp-fb:".concat(U).concat(g),Ze=le;return Ze.type==="trr-int"?me+="ttr-int".concat(g).concat(Ze.interval):(me+="".concat(Ze.type),Ze.parameter&&(me+="".concat(g).concat(Ze.parameter),Ze.additional&&(me+="".concat(g).concat(Ze.additional)))),me+this.eol}printPtime(U){return U===void 0?"":"a=ptime:".concat(U).concat(this.eol)}printMaxPtime(U){return U===void 0?"":"a=maxptime:".concat(U).concat(this.eol)}printDirection(U){return U===void 0?"":"a=".concat(U).concat(this.eol)}printSSRC(U){return U.map(le=>Object.keys(le.attributes).map(me=>"a=ssrc:".concat(le.ssrcId.toString(10)).concat(g).concat(me).concat(le.attributes[me]?":".concat(le.attributes[me]):"").concat(this.eol)).join("")).join("")}printRTCPMux(U){return U===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(U){return U===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(U){return U===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(U){if(U===void 0)return"";let le="a=rtcp:".concat(U.port);return U.netType&&(le+="".concat(g).concat(U.netType)),U.addressType&&(le+="".concat(g).concat(U.addressType)),U.address&&(le+="".concat(g).concat(U.address)),le+this.eol}printMSId(U){return U.map(le=>"a=msid:".concat(le.id).concat(le.appdata?"".concat(g).concat(le.appdata):"").concat(this.eol)).join("")}printImageattr(U){return U.map(le=>"a=imageattr:".concat(le).concat(this.eol)).join("")}printRid(U){return U.map(le=>{let me="a=rid:".concat(le.id).concat(g).concat(le.direction);return le.payloads&&(me+="".concat(g,"pt=").concat(le.payloads.join(","))),le.params.length>0&&(me+="".concat(g).concat(le.params.map(Ze=>Ze.type==="depend"?"depend=".concat(Ze.rids.join(",")):"".concat(Ze.type,"=").concat(Ze.val)).join(";"))),me+this.eol}).join("")}printSimulcast(U){return U===void 0?"":"a=simulcast:".concat(U).concat(this.eol)}printSCTPPort(U){return U===void 0?"":"a=sctp-port:".concat(U).concat(this.eol)}printMaxMessageSize(U){return U===void 0?"":"a=max-message-size:".concat(U).concat(this.eol)}printMid(U){return U===void 0?"":"a=mid:".concat(U).concat(this.eol)}printSSRCGroups(U){return U.map(le=>"a=ssrc-group:".concat(le.semantic).concat(le.ssrcIds.map(me=>"".concat(g).concat(me.toString(10))).join("")).concat(this.eol)).join("")}}function nt(He){return new We().parse(He)}function St(He,U){return new tr().print(He,U)}}},r={};function s(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return e[o](c,c.exports,s),c.exports}return s.d=(o,c)=>{for(var u in c)s.o(c,u)&&!s.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},s.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s(8)})();function Ja(e){return Qz.parse(e)}function Vm(e,r){return Qz.print(e,r)}var Xfe=_c("Array","keys"),Jfe=hd,Qfe=zr,Zfe=k,eme=Xfe,RL=Array.prototype,tme={DOMTokenList:!0,NodeList:!0},nme=function(e){var r=e.keys;return e===RL||Zfe(RL,e)&&r===RL.keys||Qfe(tme,Jfe(e))?eme:r},Qa=l(nme);function ti(e,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(r))in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function Zz(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function ln(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Zz(Object(s),!0).forEach(function(o){ti(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Zz(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const eW=new class extends Xr{constructor(){super(...arguments),ti(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class rme{constructor(r){ti(this,"logger",void 0),ti(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function CL(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function tW(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Fl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},iP=Date.now(),zw=e=>{for(const r in Fl)if(Object.prototype.hasOwnProperty.call(Fl,r)&&Fl[r]===e)return r;return"DEFAULT"},x=new class{constructor(){ti(this,"proxyServerURL",void 0),ti(this,"logLevel",Fl.DEBUG),ti(this,"uploadState","collecting"),ti(this,"uploadLogWaitingList",[]),ti(this,"uploadLogUploadingList",[]),ti(this,"uploadErrorCount",0),ti(this,"currentLogID",0),ti(this,"url",void 0),ti(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[Fl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[Fl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[Fl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[Fl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[Fl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){hr("UPLOAD_LOG",!0)}disableLogUpload(){hr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new rme(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];if(Date.now()-iP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-iP);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=CL()+" Agora-SDK [".concat(zw(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=CL()+" %cAgora-SDK [".concat(zw(o),"]:");let u=[];if(!se("USE_NEW_LOG"))switch(o){case Fl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case Fl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case Fl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case Fl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];if(Date.now()-iP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-iP);const o=Math.max(0,Math.min(4,r[0]));r[0]=CL()+" Agora-SDK [".concat(zw(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!se("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];Array.isArray(s[0])?s[0][0]=tW()+" Agora-SDK [".concat(zw(e),"]:"):s[0]=tW()+" Agora-SDK [".concat(zw(e),"]:");let c="";s.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:Vl,process_id:se("PROCESS_ID"),payload:JSON.stringify(e)};return Ld(async()=>{const s=await Ca.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(se("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(se("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=s,o}},()=>(this.uploadLogUploadingList=[],!1),s=>{const o={status:-1,message:s.message,errorRange:e.map(c=>c.log_item_id)};return s.response?(o.status=s.response.status,o.data=s.response.data,o.headers=s.response.headers):s.request&&(o.status=s.request.status),eW.reportLogUploadError(o),!0},{timeout:se("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:se("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,se("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var nW;function ime(e){return Es(e.reportId,"params.reportId",0,100,!1),Es(e.category,"params.category",0,100,!1),Es(e.event,"params.event",0,100,!1),Es(e.label,"params.label",0,100,!1),gr(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(nW={}).FREE="free",nW.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const sme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Yi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Vr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let ome=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Gt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,o){const c=o.value;if(typeof c=="function"){const u=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,g=new Array(m),E=0;E<m;E++)g[E]=arguments[E];let S=g;if(e.argsMap)try{S=e.argsMap(this,...g)}catch(A){x.warning(A),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(u,".").concat(String(s)," not serializable for apiInvoke.")),S=[]}const C=(e.report||At).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(s)),options:S,tag:Wr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const A=c.apply(this,g);return A instanceof gt?A.then(O=>(C.onSuccess(e.reportResult&&O),O)).catch(O=>{throw C.onError(O),O}):(C.onSuccess(e.reportResult&&A),A)}catch(A){throw C.onError(A),A}}}return o}}const At=new class{constructor(){ti(this,"baseInfoMap",new Map),ti(this,"proxyServer",void 0),ti(this,"eventUploadTimer",void 0),ti(this,"setSessionIdTimer",void 0),ti(this,"url",void 0),ti(this,"sids",new Set),ti(this,"backupUrl",void 0),ti(this,"_appId",void 0),ti(this,"_aid",0),ti(this,"keyEventUploadPendingItems",[]),ti(this,"normalEventUploadPendingItems",[]),ti(this,"apiInvokeUploadPendingItems",[]),ti(this,"apiInvokeCount",0),ti(this,"apiInvokeLoggedCount",0),ti(this,"ltsList",[]),ti(this,"lastSendNormalEventTime",Date.now()),ti(this,"customReportCounterTimer",void 0),ti(this,"customReportCount",0),ti(this,"extApiInvoke",async e=>{for(const r of e){const s=ln(ln({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Wr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),se("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),se("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,o]=r;return s+o}),16)||0}reportApiInvoke(e,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!se("SHOW_REPORT_INVOKER_LOG"),h=!!se("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function E(O,W){if(m){let F="[apiInvoke-".concat(g,"]");if(r.id&&(F+="[".concat(r.id,"]")),r.name&&(F+="[".concat(r.name,"]"),r.name===li.JOIN))return x.info("".concat(F," ").concat(O));x.info("".concat(F," ").concat(O),O==="start"?r.options:W||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:e,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});E("start");let C=!1;vs(r.timeout).then(()=>{C||(this.sendApiInvoke(ln(ln({},S()),{},{error:ee.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const A=new Le(ee.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:O=>{const W=()=>{if(C)throw A;return C=!0,this.sendApiInvoke(ln(ln({},S()),{},{success:!0},r.reportResult&&{result:O})),E("onSuccess"),O};return s?Lz(W,r.name+"Success",s,()=>C=!0):W()},onError:O=>{const W=()=>{if(C)throw O;C=!0,this.sendApiInvoke(ln(ln({},S()),{},{success:!1,error:O})),E("onFailure",O.toString())};return s?Lz(W,r.name+"Error",s,()=>C=!0):W()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const s=Date.now(),o=this.createBaseInfo(e,s);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:se("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:SL?"global":"oversea",areas:se("AREAS")&&se("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:E,clientRole:S}=r,C=Date.now(),A=ln(ln({},o),{},{eventType:Yi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:wL,lts:C,elapse:C-s,extend:JSON.stringify(c),mode:r.mode,process:se("PROCESS_ID"),appType:se("APP_TYPE"),success:!0,version:Vl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:E,clientType:et(O=window.navigator.userAgent).call(O,"AgoraWebView")?42:20,clientRole:S,serviceId:se("PROCESS_ID"),extensionID:se("PLUGIN_INFO").join(",")||""});var O;this.send({type:Vr.SESSION,data:A},!0)}joinChooseServer(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln({},o),{},{role:r.role,eventType:Yi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:Vr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln({},o),{},{eventType:Yi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Vr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,addr:h,isProxy:m}=r,g=c-s.startTime,E=ln(ln({},o),{},{eventType:Yi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:vL(),isABTestSuccess:r.isABTestSuccess?1:0}),S=E.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),u)this.send({type:Vr.JOIN_GATEWAY,data:E},!0);else{let C;if(h)if(m){const O=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),W=h.match(/p=[0-9]{1,6}/g);C={isSuccess:S,gatewayIp:O&&O.length?O[0].split("=")[1].replace(/-/g,"."):"",port:W&&W.length?W[0].split("=")[1]:"",isProxy:m?1:0}}else{const O=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),W=h.match(/(:|p=)[0-9]{1,6}/g);C={isSuccess:S,gatewayIp:O&&O.length?O[0].split("//")[1].replace(/-/g,"."):"",port:W&&W.length?W[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else C={isSuccess:S,gatewayIp:"",port:"",isProxy:m?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);const A=Object.assign({},E,C,{eventType:Yi.REJOIN_GATEWAY});this.send({type:Vr.RE_JOIN_GATEWAY,data:A},!0)}}joinChannelTimeout(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=Date.now(),c=ln(ln({},s.info),{},{lts:o,timeout:r,elapse:o-s.startTime});this.send({type:Vr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln({},o),{},{eventType:Yi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Vr.PUBLISH,data:u},!0)}subscribe(e,r,s){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=ln(ln({},c),{},{eventType:Yi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Vr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var r;const s=[...Qa(r=this.baseInfoMap).call(r)],o=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln({},u),{},{eventType:Yi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:Vr.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=r.peerPubStatusMs-(s.lastJoinSuccessTime||c),h=ln(ln({},o),{},{elapse:c-s.startTime,eventType:Yi.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:u,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>u?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0});this.send({type:Vr.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(e,r,s,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(e,r,s,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln(ln({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Yi.AB_TEST,lts:c});this.send({type:Vr.AB_TEST,data:u},!0)}pcStats(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln(ln({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Yi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Vr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,r){if(e){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln(ln({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Yi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Vr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,r,s,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),o),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln({},o),{},{eventType:Yi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Vr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln({},o),{},{eventType:Yi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Vr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln({},o),{},{eventType:Yi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Vr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?x.debug("reportProxyServerurl: ".concat(e)):x.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Vr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now();(function(u,h,m){const g=u[h];if(!g||typeof g!="string")return[u];u[h]="";const E=Hh(JSON.stringify(u));let S=0;const C=[];let A=0;for(let O=0;O<g.length;O++)A+=g.charCodeAt(O)<=127?1:3,A<=m-E||(C[C.length]=Qe(Qe({},u),{},{[h]:g.substring(S,O)}),S=O,A=g.charCodeAt(O)<=127?1:3);return S!==g.length-1&&(C[C.length]=Qe(Qe({},u),{},{[h]:g.substring(S)})),C})(ln(ln(ln({},o),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Vr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln(ln({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Vr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln(ln({},o),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Vr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=ln(ln(ln({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Vr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>se("CUSTOM_REPORT_LIMIT"))throw new Le(ee.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),o=r.map(c=>({type:Vr.USER_ANALYTICS,data:ln(ln({sid:e},c),{},{lts:s})}));try{se("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new Le(ee.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const r=se("NOT_REPORT_EVENT");if(e.tag&&et(r)&&et(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const s=this.baseInfoMap.get(e.sid);if(!s)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=s.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Le){const{code:g,message:E}=e.error;h=g||E||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-s.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Vr.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&e.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>se("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const s=[],o=[];for(;e.length;){const u=e.shift();s.length<20?s.push(u):o.push(u)}e.push(...o);for(const u of[...s]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),x_(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),se("ENABLE_EVENT_REPORT")&&s.length&&(se("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((u=>h=>{se("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>se("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-se("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),e}async postDataToStatsCollector2(e){bi.networkState===Cc.OFFLINE&&await gt.race([bi.onlineWaiter,vs(2*Di.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=cL(JSON.stringify(h.data)),g=new ArrayBuffer(5),E=(C=>{let A=0;return Object.entries(Vr).forEach(O=>{let[W,F]=O;F===C.type&&(A=ome[W])}),A})(h),S=new DataView(g);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&E),S.setUint8(3,E>>>8&255),S.setUint8(4,E>>>16&255),u=Cz(u,new Uint8Array(g)),u=Cz(u,m)}),u},s="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(se("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(se("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await mL(o,{timeout:1e4,data:r(e),headers:ln(ln({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(e[0]),o=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:s,aid:o};bi.networkState===Cc.OFFLINE&&await gt.race([bi.onlineWaiter,vs(2*Di.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("EVENT_REPORT_DOMAIN"),"&p=").concat(se("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(se("EVENT_REPORT_DOMAIN"),":").concat(se("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(se("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(se("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(se("STATS_COLLECTOR_PORT")).concat(u)));try{r?await Hfe(h,{timeout:1e4,data:c}):await mL(h,{timeout:1e4,data:c})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(e,r){const s=Object.assign({},sme);return s.sid=e,this.baseInfoMap.set(e,{info:s,startTime:r}),s}reportResourceTiming(e,r){const s=performance.getEntriesByName(e),o=s[s.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:Wr.TRACER}).onSuccess()}};eW.on("REPORT_LOG_UPLOAD",e=>{e.networkState=bi.networkState,At.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Wr.TRACER}).onSuccess("logUploadError")});class ke extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ti(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const Ss={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Vn(){return Ss}function rW(){return"setSinkId"in HTMLAudioElement.prototype&&(!se("RESTRICTION_SET_PLAYBACK_DEVICE")||(sf()||fz())&&!sL())}function sP(){return!Ss.supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&of()}function IL(e){return!(Zr()||mz(87)||sP()||!se("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||se("FORCE_DISABLE_AUTO_SUB")))}function iW(e){return!!se("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||se("FORCE_DISABLE_AUTO_SUB"))}let bs=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Lv(e,r,s){return{sampleRate:e,stereo:r,bitrate:s}}function Fn(e,r,s,o,c){return{width:e,height:r,frameRate:s,bitrateMin:o,bitrateMax:c}}function Nu(e,r,s,o,c){return{width:{max:e},height:{max:r},frameRate:s,bitrateMin:o,bitrateMax:c}}function AL(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const ame={"90p":Fn(160,90),"90p_1":Fn(160,90),"120p":Fn(160,120,15,30,65),"120p_1":Fn(160,120,15,30,65),"120p_3":Fn(120,120,15,30,50),"120p_4":Fn(212,120),"180p":Fn(320,180,15,30,140),"180p_1":Fn(320,180,15,30,140),"180p_3":Fn(180,180,15,30,100),"180p_4":Fn(240,180,15,30,120),"240p":Fn(320,240,15,40,200),"240p_1":Fn(320,240,15,40,200),"240p_3":Fn(240,240,15,40,140),"240p_4":Fn(424,240,15,40,220),"360p":Fn(640,360,15,80,400),"360p_1":Fn(640,360,15,80,400),"360p_3":Fn(360,360,15,80,260),"360p_4":Fn(640,360,30,80,600),"360p_6":Fn(360,360,30,80,400),"360p_7":Fn(480,360,15,80,320),"360p_8":Fn(480,360,30,80,490),"360p_9":Fn(640,360,15,80,800),"360p_10":Fn(640,360,24,80,800),"360p_11":Fn(640,360,24,80,1e3),"480p":Fn(640,480,15,100,500),"480p_1":Fn(640,480,15,100,500),"480p_2":Fn(640,480,30,100,1e3),"480p_3":Fn(480,480,15,100,400),"480p_4":Fn(640,480,30,100,750),"480p_6":Fn(480,480,30,100,600),"480p_8":Fn(848,480,15,100,610),"480p_9":Fn(848,480,30,100,930),"480p_10":Fn(640,480,10,100,400),"720p":Fn(1280,720,15,120,1130),"720p_auto":Fn(1280,720,30,900,3e3),"720p_1":Fn(1280,720,15,120,1130),"720p_2":Fn(1280,720,30,120,2e3),"720p_3":Fn(1280,720,30,120,1710),"720p_5":Fn(960,720,15,120,910),"720p_6":Fn(960,720,30,120,1380),"1080p":Fn(1920,1080,15,120,2080),"1080p_1":Fn(1920,1080,15,120,2080),"1080p_2":Fn(1920,1080,30,120,3e3),"1080p_3":Fn(1920,1080,30,120,3150),"1080p_5":Fn(1920,1080,60,120,4780),"1440p":Fn(2560,1440,30,120,4850),"1440p_1":Fn(2560,1440,30,120,4850),"1440p_2":Fn(2560,1440,60,120,7350),"4k":Fn(3840,2160,30,120,8910),"4k_1":Fn(3840,2160,30,120,8910),"4k_3":Fn(3840,2160,60,120,13500)},cme={"480p":Nu(640,480,5),"480p_1":Nu(640,480,5),"480p_2":Nu(640,480,30),"480p_3":Nu(640,480,15),"720p":Nu(1280,720,5),"720p_auto":Fn(1280,720,30,900,3e3),"720p_1":Nu(1280,720,5),"720p_2":Nu(1280,720,30),"720p_3":Nu(1280,720,15),"1080p":Nu(1920,1080,5),"1080p_1":Nu(1920,1080,5),"1080p_2":Nu(1920,1080,30),"1080p_3":Nu(1920,1080,15)},lme={"1SL1TL":AL(1,1),"3SL3TL":AL(3,3),"2SL3TL":AL(2,3)};function Du(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},ame[e]):e}function PL(e){return typeof e=="string"?Object.assign({},cme[e]):e}function oP(e){return typeof e=="string"?Object.assign({},lme[e]):e}const ume={speech_low_quality:Lv(16e3,!1),speech_standard:Lv(32e3,!1,18),music_standard:Lv(48e3,!1),standard_stereo:Lv(48e3,!0,56),high_quality:Lv(48e3,!1,128),high_quality_stereo:Lv(48e3,!0,192)};function aP(e){return typeof e=="string"?Object.assign({},ume[e]):e}const Mv=[];function sW(e){return qi(e,"mediaSource",["screen","window","application"]),!0}let Tt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),_r=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Uv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),dme=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),hme=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),K_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Vv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),jl=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Fv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Qc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const OL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},kL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},oW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},pme={uplinkNetworkQuality:0,downlinkNetworkQuality:0},aW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let sa=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Zc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Ww=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),q_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),eo=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Kh=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const NL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let cP=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function On(e,r,s,o,c){var u,h,m={};return Object.keys(o).forEach(function(g){m[g]=o[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ha(u=n_(h=s.slice()).call(h)).call(u,function(g,E){return E(e,r,g)||g},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(e,r,m),null):m}function Pe(e,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(r))in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function cW(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Tr(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?cW(Object(s),!0).forEach(function(o){Pe(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):cW(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class lW extends Xr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(K_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||Er(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){et(Mv).call(Mv,o)||Mv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Mm(()=>{var s;At.reportApiInvoke(null,{name:li.GET_MEDIA_STREAM_TRACK,options:[],tag:Wr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Uv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Mv.indexOf(r);s!==-1&&Mv.splice(s,1)}(this),this.emit(Vv.CLOSED),this.removeAllListeners(K_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===Uv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(K_.TRANSCEIVER_UPDATED,r,s)}}class jv extends lW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Zs("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(Tt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await yr(this,Tt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vv.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),xd(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(ee.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(ee.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():gt.resolve([])}}const uW=window.AudioContext||window.webkitAudioContext;let el=null;const pr=new class extends Xr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(bs.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(el&&await el.suspend(),this.emit(bs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){x.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){x.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Bv(){if(!el){if(function(){if(!uW)return void x.error("your browser is not support web audio");x.info("create audio context");const e=Tr({},se("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(e)),el=new uW(e),pr.curState=el.state,el.onstatechange=()=>{pr.prevState=pr.curState,pr.curState=el?el.state:void 0;const{prevState:r,curState:s}=pr,o=s==="running",c=s==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",g=Nn().osVersion;(_o()||Ou())&&u&&c&&(x.info("ios".concat(g,"-interruption-start")),pr.emit(bs.IOS_INTERRUPTION_START)),(_o()||Ou())&&(h||m)&&o&&(x.info("ios".concat(g,"-interruption-end")),pr.emit(bs.IOS_INTERRUPTION_END)),r!==s&&pr.emit(bs.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=el)===null||r===void 0?void 0:r.currentTime;pr.currentTime!==s?(pr.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),pr.currentTimeStuckAt=void 0),pr.currentTime=s):(s!==pr.currentTimeStuckAt&&(At.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Wr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),pr.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(F){r.state==="running"?g(!1):_o()||Ou()?r.state==="suspended"&&(g(!0),F&&r.resume().then(E,E)):r.state!=="closed"&&(g(!0),F&&r.resume().then(E,E))}function g(F){if(c!==F){c=F;for(let B=0,Z=s;B<Z.length;B+=1){const Q=Z[B];F?window.addEventListener(Q,S,{capture:!0,passive:!0}):window.removeEventListener(Q,S,{capture:!0,passive:!0})}}}function E(){m(!1)}function S(){m(!0)}function C(F){if(!h)if(o.paused)if(F){let B;A(!1),h=!0;try{B=o.play(),B?B.then(O,O):(o.addEventListener("playing",O),o.addEventListener("abort",O),o.addEventListener("error",O))}catch{O()}}else A(!0);else A(!1)}function A(F){if(u!==F){u=F;for(let B=0,Z=s;B<Z.length;B++){const Q=Z[B];F?window.addEventListener(Q,W,{capture:!0,passive:!0}):window.removeEventListener(Q,W,{capture:!0,passive:!0})}}}function O(){o.removeEventListener("playing",O),o.removeEventListener("abort",O),o.removeEventListener("error",O),h=!1,C(!1)}function W(){C(!0)}if(_o()){const F=r.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=B.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=F.stream,C(!0)}pr.on(bs.STATE_CHANGE,function(){m(!0)}),m(!1)}(el)}(),!el)throw new Le(ee.NOT_SUPPORTED,"can not create audio context");return el}return el}function Y_(e){if(function(){if(DL!==null)return DL;const o=Bv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),DL=m,m}())return;const r=e.connect,s=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),et(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,c,u)):r.call(e,o,c)),e},e.disconnect=(o,c,u)=>{s.call(e),o?JA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)r.call(e,h)}}let DL=null;function xL(e,r){let s=!1;const o=1/r;if(se("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Bv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(s)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{s=!0}}class dW{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Bv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||_o()||Ou()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const s=Ha(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class hW extends Xr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Bv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Y_(this.outputNode),this.volumeLevelAnalyser=new dW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Qc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Vn().webAudioMediaStreamDest)throw new Le(ee.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&QA(()=>{pr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;_o()||Ou()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let o;s.getFloatTimeDomainData?(o=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o)):(o=new Uint8Array(s.fftSize),s.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await vs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class pW extends hW{get isFreeze(){return!1}constructor(r,s,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),Y_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),Y_(this.outputNode),this.emit(Qc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(ee.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(u),Y_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));Y_(g),this.originVolumeLevelAnalyser=new dW,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Nn();s&&h.os===ts.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(pr.on(bs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),Y_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Qc.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),pr.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([s]));Y_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function fW(e,r,s){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function fme(e,r){const s=await mW(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new gt((m,g)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const C=document.createElement("div");C.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",C.setAttribute("style","height: 12%;");const A=document.createElement("div");A.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const O=document.createElement("div");O.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const W=document.createElement("button");W.innerHTML="cancel",W.setAttribute("style","width: 85px;"),W.onclick=()=>{document.body.removeChild(Z);const Q=new Error("NotAllowedError");Q.name="NotAllowedError",g(Q)};let F=h;const B=document.createElement("div");if(h){const Q=document.createElement("input");Q.setAttribute("type","checkbox");const ae=document.createElement("span");Q.setAttribute("style","margin-right: 6px;"),ae.innerText="Share audio",Q.checked=F,Q.onchange=()=>{F=Q.checked},B.appendChild(Q),B.appendChild(ae)}O.appendChild(B),O.appendChild(W),S.appendChild(C),S.appendChild(A),S.appendChild(O);const Z=document.createElement("div");Z.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Z.appendChild(E),Z.appendChild(S),document.body.appendChild(Z),u.map(Q=>{if(Q.id){const ae=document.createElement("div");ae.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=Q.thumbnail;try{const{width:_e}=ye.getSize();_e>1920&&(ye=ye.resize({width:1920}))}catch(_e){throw _e&&_e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_e}ae.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Q.name.replace(/[\u00A0-\u9999<>\&]/g,function(_e){return"&#"+_e.charCodeAt(0)+";"})+"</span>",ae.onclick=()=>{document.body.removeChild(Z),m({sourceId:Q.id,audio:F})},A.appendChild(ae)}})})}(s,r);return await fW(o,e,c)}async function mW(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const s=Iz();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(ee.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new gt((u,h)=>{s.desktopCapturer.getSources({types:r},(m,g)=>{m?h(m):u(g)})}));try{return await o}catch(u){throw new Le(ee.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const LL=new Zs("safari");let gW=!1,_W=!1;async function tl(e,r){let s=0,o=null;for(;s<2;)try{o=await mme(e,r,s>0);break}catch(c){if(c instanceof Le)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const u=lP(c.name||c.code||c,c.message);if(u.code===ee.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await vs(500);continue}throw x.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new Le(ee.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function mme(e,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(ee.NOT_SUPPORTED,"can not find getUserMedia");s&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=Vn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return x.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(Iz())e.screen.sourceId?zv(c,await fW(e.screen.sourceId,e.screen,!!e.screenAudio)):zv(c,await fme(e.screen,!!e.screenAudio));else if(sf()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Le(ee.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const A=await(h=e.screen.extensionId,m=r,new gt((O,W)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},F=>{if(!F||!F.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),F),void W(new Le(ee.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));O(F.streamId)})}catch(F){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),F.toString()),W(new Le(ee.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=A,zv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&sW(e.screen.mediaSource);const A={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:O,surfaceSwitching:W,systemAudio:F,preferCurrentTab:B}=e.screen,Z={selfBrowserSurface:O,surfaceSwitching:W,systemAudio:F,preferCurrentTab:B};!O&&delete Z.selfBrowserSurface,!W&&delete Z.surfaceSwitching,!F&&delete Z.systemAudio,!B&&delete Z.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:A,audio:e.screenAudio,controls:Z})),zv(c,await navigator.mediaDevices.getDisplayMedia(Tr({video:A,audio:e.screenAudio},Z)))}else{if(!Zr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Le(ee.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&sW(e.screen.mediaSource);const A={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(A))),zv(c,await navigator.mediaDevices.getUserMedia(A))}}var h,m;if(!e.video&&!e.audio)return c;let g={video:e.video,audio:e.audio},E=se("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),g=dL(g,E)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),Nn();let S,C=null;(Ls()||_o()||YA())&&(C=await LL.lock());try{S=await navigator.mediaDevices.getUserMedia(g)}catch(A){throw C&&C(),A}return g.audio&&(gW=!0),g.video&&(_W=!0),zv(c,S),C&&C(),c}function lP(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(ee.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(ee.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new Le(ee.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new Le(ee.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(ee.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(ee.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return x.error("getUserMedia unexpected error",e),new Le(ee.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function zv(e,r){const s=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(s&&e.removeTrack(s),e.addTrack(c))}const nl=new class extends Xr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(q_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Pe(this,"_state",Ww.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(se("ENUMERATE_DEVICES_INTERVAL")||(XA()||qA()===ts.HARMONY_OS)&&of())&&this.updateDevicesInfo()},se("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>x.error(e.toString()))}async enumerateDevices(e,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(ee.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,g=null,E=null;if(!s&&(u||h)){if(LL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await LL.lock())(),x.debug("[device manager] GUM unlock")),gW&&(u=!1,this.isAccessMicrophonePermission=!0),_W&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",e,r,u,h),u&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const C=lP(S.name||S.code||S,S.message);if(C.code===ee.PERMISSION_DENIED)throw C;x.warning("getUserMedia failed in getDevices",C)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const C=lP(S.name||S.code||S,S.message);if(C.code===ee.PERMISSION_DENIED)throw C;x.warning("getUserMedia failed in getDevices",C)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const C=lP(S.name||S.code||S,S.message);if(C.code===ee.PERMISSION_DENIED)throw C;x.warning("getUserMedia failed in getDevices",C)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",e,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(C=>C.stop()),g&&g.getTracks().forEach(C=>C.stop()),E&&E.getTracks().forEach(C=>C.stop()),m=null,g=null,E=null,S}catch(S){return m&&m.getTracks().forEach(C=>C.stop()),g&&g.getTracks().forEach(C=>C.stop()),E&&E.getTracks().forEach(C=>C.stop()),m=null,g=null,E=null,new Le(ee.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===e&&(r=s.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===e);if(!r)throw new Le(ee.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=Ww.INITING;try{await this.updateDevicesInfo(),this.state=Ww.INITEND}catch(e){throw x.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Ww.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(ee.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==Ww.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(q_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(q_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(q_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(c=>c.kind==="audioinput"),s=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){o.video=!0;break}return o}};let ML=!1;const rl=new class extends Xr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function yW(){if(Nn(),!ML){const e=r=>{r.preventDefault(),ML=!1,Dw()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};ML=!0,Dw()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),rl.onAutoplayFailed?rl.onAutoplayFailed():rl.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),rl.emit("autoplay-failed")}}function EW(e,r,s,o){if(!e)return;const c=At.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=Tr(Tr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:rl.onAutoplayFailed||rl.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:o,extend:void 0});At.send({type:Vr.AUTOPLAY_FAILED,data:m},!0)}const gme=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ia=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,o]=r;const c=this.elementStateMap.get(s),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(pr.curState==="running")return Av()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,s]=e;const o=s.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),pr.on(bs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pr.on(bs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),pr.on(bs.STATE_CHANGE,()=>{_o()&&pr.prevState==="suspended"&&pr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const s=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),s)try{await s.setSinkId(r)}catch(o){throw new Le(ee.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,s,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,eo.INIT),this.setVolume(r,s);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&EW(o,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),QA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),yW()}))})}updateTrack(e,r){const s=this.elementMap.get(e);s&&(s.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const s=this.elementMap.get(e);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){gme.forEach(s=>{r.addEventListener(s,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new gt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{Dw()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function si(){return function(e,r,s){const o=s.value;return typeof o=="function"&&(s.value=function(){this._isClosed&&new Le(ee.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof gt?new gt((g,E)=>{m.then(g).catch(E)}):m}),s}}class vW extends Xr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(ee.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(ee.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(sa.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(sa.ON_TRACK,void 0)}}class SW extends Xr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Us(this,Zc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),yr(this,Zc.REQUEST_UPDATE_CONSTRAINTS,Array.from(wc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),yr(this,Zc.REQUEST_UPDATE_CONSTRAINTS,Array.from(wc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new Le(ee.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof gt&&(o=await o),r.push(Tr(Tr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class bW extends Xr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(ee.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(ee.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(sa.ON_TRACK,void 0),this.emit(sa.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(sa.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(sa.ON_NODE,this.inputNode))}}class wW extends Xr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=o}async getConstraints(){return Us(this,Zc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),yr(this,Zc.REQUEST_UPDATE_CONSTRAINTS,Array.from(wc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),yr(this,Zc.REQUEST_UPDATE_CONSTRAINTS,Array.from(wc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new Le(ee.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof gt&&(o=await o),r.push(Tr(Tr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class UL extends Xr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new _me}setVolume(){}createOutputTrack(){throw new Le(ee.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class _me{disconnect(){}connect(){}}function TW(e){return new gt((r,s)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=_o()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Zr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(ZA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function uP(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const s=Du(e.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!bz()&&s.frameRate&&(r.frameRate=s.frameRate),fz()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Zr()&&(r.frameRate={ideal:30,max:30}),r}function RW(e){const r={};return bz()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,sf()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function CW(e){const r=RW(e);if(e.encoderConfig){const s=aP(e.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),XA()&&(r.sampleRate=void 0),r}const yme=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:s,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=s,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=kv(h),m=kv(m),u=kv(u);const{max:g,min:E}=function(O,W,F){const B=200*Math.pow(F/15,.6)*Math.pow(O*W/640/360,.75);return{min:Math.floor(B),max:Math.floor(4*B)}}(h,m,u),{bitrateMax:S,bitrateMin:C}=r||{};S||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(C,"]"));const{maxFramerate:A}=se("ENCODER_CONFIG_LIMIT");return A&&typeof A=="number"&&(u=Math.min(u,A)),{frameRate:u,bitrateMax:S||g,bitrateMin:C||E,scaleResolutionDownBy:1,scale:0}},IW=async(e,r,s)=>await(async(o,c,u)=>{const h=function(E){const S=[];for(let C=0;C<E.length;C+=2)S.push(parseInt(E.slice(C,C+2),16));return Uint8Array.from(S)}(Vz(""+c+u)).slice(0,16),m=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,o))})(e.buffer,r,s),VL=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new gt((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await AW(c);s({buffer:u,width:r.width,height:r.height})}else o(new Le(ee.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},AW=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var PW,OW,kW,NW,DW,xW,LW,MW,UW,VW,FW,jW,BW,zW,WW,GW,HW,$W,Jr,KW,qW,YW,XW,JW,QW,qh,ZW,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,dG,Fs;let oi=(PW=Gt({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),OW=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),kW=si(),NW=Nv("LocalAudioTrack","_enabledMutex"),DW=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),xW=si(),LW=Nv("LocalAudioTrack","_enabledMutex"),MW=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),UW=si(),VW=si(),FW=si(),jW=Gt({argsMap:e=>[e.getTrackId()]}),BW=si(),zW=Gt({argsMap:e=>[e.getTrackId()]}),WW=si(),GW=Gt({argsMap:e=>[e.getTrackId()]}),HW=Gt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),$W=Gt({argsMap:e=>[e.getTrackId()]}),On((Jr=class extends jv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ia.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,s,o){super(e,s),Pe(this,"trackMediaType",Fv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new UL,se("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),se("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ls()&&!el?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){gr(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ia.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,yr(this,Tt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!rW())throw new Le(ee.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ia.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,s){return this._setEnabled(e,r,s)}async _setEnabled(e,r,s){if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await yr(this,Tt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await yr(this,Tt.NEED_DISABLE_TRACK,this)}catch(o){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await yr(this,Tt.NEED_MUTE_TRACK,this):await yr(this,Tt.NEED_UNMUTE_TRACK,this))}getStats(){return Mm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Xc(this,Tt.GET_STATS)||Tr({},OL)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Qc.ON_AUDIO_BUFFER),this._source.on(Qc.ON_AUDIO_BUFFER,s=>e(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ia.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ia.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ia.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await yr(this,Tt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return gt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Le(ee.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Le(ee.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(sa.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await yr(this,Tt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await yr(this,Tt.NEED_REPLACE_TRACK,this))}),e.on(sa.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(sa.ON_TRACK),e.removeAllListeners(sa.ON_NODE)}bindProcessorContextEvents(e){e.on(Zc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Zc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof UL&&(this._trackSource=new pW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new wW(this._source.context,this.getTrackId(),"local"),r=new bW(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(Qc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ia.stop(this.getTrackId()),this._source.play()),yr(this,Tt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[PW],Object.getOwnPropertyDescriptor(Jr.prototype,"setVolume"),Jr.prototype),On(Jr.prototype,"setPlaybackDevice",[OW,kW],Object.getOwnPropertyDescriptor(Jr.prototype,"setPlaybackDevice"),Jr.prototype),On(Jr.prototype,"setEnabled",[NW,DW,xW],Object.getOwnPropertyDescriptor(Jr.prototype,"setEnabled"),Jr.prototype),On(Jr.prototype,"setMuted",[LW,MW,UW],Object.getOwnPropertyDescriptor(Jr.prototype,"setMuted"),Jr.prototype),On(Jr.prototype,"getStats",[VW],Object.getOwnPropertyDescriptor(Jr.prototype,"getStats"),Jr.prototype),On(Jr.prototype,"setAudioFrameCallback",[FW],Object.getOwnPropertyDescriptor(Jr.prototype,"setAudioFrameCallback"),Jr.prototype),On(Jr.prototype,"play",[jW,BW],Object.getOwnPropertyDescriptor(Jr.prototype,"play"),Jr.prototype),On(Jr.prototype,"stop",[zW,WW],Object.getOwnPropertyDescriptor(Jr.prototype,"stop"),Jr.prototype),On(Jr.prototype,"close",[GW],Object.getOwnPropertyDescriptor(Jr.prototype,"close"),Jr.prototype),On(Jr.prototype,"pipe",[HW],Object.getOwnPropertyDescriptor(Jr.prototype,"pipe"),Jr.prototype),On(Jr.prototype,"unpipe",[$W],Object.getOwnPropertyDescriptor(Jr.prototype,"unpipe"),Jr.prototype),Jr),Gw=(KW=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),qW=si(),YW=Nv("MicrophoneAudioTrack","_enabledMutex"),XW=Gt({argsMap:(e,r,s)=>[e.getTrackId(),r,s]}),JW=si(),QW=Gt({argsMap:e=>[e.getTrackId()]}),On((qh=class extends oi{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,s,o){super(e,r.encoderConfig?aP(r.encoderConfig):{},o,se("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Av()||iL())&&pr.bindInterruptDetectorTrack(this)}async setDevice(e){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await nl.getDeviceById(e),s={};s.audio=Tr({},this._constraints),s.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await tl(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await tl({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await nl.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),se("AUTO_RESET_AUDIO_ROUTE")&&(_o()||Ou())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),s||(this._enabled=!1);try{await yr(this,Tt.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Tr({},this._constraints),u=nl.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{s||(this._enabled=!0);const h=await tl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await yr(this,Tt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Av()||iL())&&pr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((_o()||Ou())&&this._enabled&&!this._isClosed&&pr.duringInterruption){const e=async()=>{pr.off(bs.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pr.on(bs.IOS_INTERRUPTION_END,e)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vv.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,s=nl.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await tl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Zc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Zc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[KW,qW],Object.getOwnPropertyDescriptor(qh.prototype,"setDevice"),qh.prototype),On(qh.prototype,"setEnabled",[YW,XW,JW],Object.getOwnPropertyDescriptor(qh.prototype,"setEnabled"),qh.prototype),On(qh.prototype,"close",[QW],Object.getOwnPropertyDescriptor(qh.prototype,"close"),qh.prototype),qh),Eme=(ZW=Gt({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),eG=si(),tG=Gt({argsMap:e=>[e.getTrackId()]}),nG=si(),rG=Gt({argsMap:e=>[e.getTrackId()]}),iG=si(),sG=Gt({argsMap:e=>[e.getTrackId()]}),oG=si(),aG=Gt({argsMap:e=>[e.getTrackId()]}),cG=si(),lG=Gt({argsMap:e=>[e.getTrackId()]}),uG=Gt({argsMap:e=>[e.getTrackId()]}),dG=si(),On((Fs=class extends oi{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,s,o){super(r.createOutputTrack(),s,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(Qc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Vv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){gr(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[ZW,eG],Object.getOwnPropertyDescriptor(Fs.prototype,"startProcessAudioBuffer"),Fs.prototype),On(Fs.prototype,"pauseProcessAudioBuffer",[tG,nG],Object.getOwnPropertyDescriptor(Fs.prototype,"pauseProcessAudioBuffer"),Fs.prototype),On(Fs.prototype,"seekAudioBuffer",[rG,iG],Object.getOwnPropertyDescriptor(Fs.prototype,"seekAudioBuffer"),Fs.prototype),On(Fs.prototype,"resumeProcessAudioBuffer",[sG,oG],Object.getOwnPropertyDescriptor(Fs.prototype,"resumeProcessAudioBuffer"),Fs.prototype),On(Fs.prototype,"stopProcessAudioBuffer",[aG,cG],Object.getOwnPropertyDescriptor(Fs.prototype,"stopProcessAudioBuffer"),Fs.prototype),On(Fs.prototype,"close",[lG],Object.getOwnPropertyDescriptor(Fs.prototype,"close"),Fs.prototype),On(Fs.prototype,"setAudioBufferPlaybackSpeed",[uG,dG],Object.getOwnPropertyDescriptor(Fs.prototype,"setAudioBufferPlaybackSpeed"),Fs.prototype),Fs);class Ui extends oi{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Bv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,Er(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}JA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Ui?s.emit(K_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class vme extends hW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Qc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const hG=new Map;function pG(e,r){if(e.length===0||r.length===0)return 1/0;const s=hL(e),o=hL(r);return Math.floor(o/s)}class FL{get rendFrameRate(){const r=Math.max(1,pG(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:eo.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onFirstVideoFrameRender",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"renderFreezeAccTime2",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"isDestroyed",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"internal",!1),Pe(this,"_render_interframe_delays",[]),Pe(this,"_render_interframe_delays_sizes",[]),Pe(this,"_videoState",Kh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",eo.NONE),Pe(this,"_isInPage",!0),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&pr.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(hz())),vz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":s.type==="play"&&x.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=eo.PLAYING;break;case"loadeddata":if(this.videoState=Kh.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=eo.CANPLAY;break;case"stalled":this.videoElementStatus=eo.STALLED;break;case"suspend":this.videoElementStatus=eo.SUSPEND;break;case"pause":this.videoElementStatus=eo.PAUSED,_o()||Ou()||Ls()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=eo.WAITING;break;case"abort":this.videoElementStatus=eo.ABORT;break;case"ended":this.videoElementStatus=eo.ENDED;break;case"emptied":this.videoElementStatus=eo.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=eo.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Yh.lastVisibleTime<Yh.lastHiddenTime||u<Yh.lastHiddenTime||u<Yh.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>se("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(hz())),vz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),pr.on(bs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pr.on(bs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&EW(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Nn();if((o.name==="Safari"&&Number(o.version)===15||Av())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new gt((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const g=await AW(m);u({buffer:g,width:o.width,height:o.height})}else h(new Le(ee.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await VL(r)}destroy(){this.isDestroyed=!0,pr.off(bs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pr.off(bs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Kh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=eo.INIT,!this.videoElementCheckInterval&&(fG.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(u){return u!==document.body&&document.body.contains(u)}(this.videoElement)},1e3),se("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,se("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Kh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Kh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(E,S)=>{if(this.videoElementStatus===eo.PLAYING){if(u){const O=S.presentationTime-u.presentationTime,W=S.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(W),this._render_interframe_delays.push(O);const F=hL(this._render_interframe_delays_sizes),B=F-this._render_interframe_delays_sizes[0];if(F>30&&B>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Kh.VideoStateStarting&&(this.videoState=Kh.VideoStateDecoding),this.videoState===Kh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,se("VIDEO_FREEZE_DURATION"))),O<se("VIDEO_FREEZE_DURATION")&&this.videoState===Kh.VideoStateFrozen&&(this.videoState=Kh.VideoStateDecoding),O>se("VIDEO_FREEZE_DURATION")&&Yh.lastVisibleTime>=Yh.lastHiddenTime&&u.timestamp>Yh.lastVisibleTime&&u.timestamp>Yh.lastHiddenTime){const Z=Math.min(66,pG(this._render_interframe_delays_sizes,this._render_interframe_delays)),Q=Math.max(0,O-(W-1)*Z);this.renderFreezeAccTime2+=Q>Z?Q:0,this.renderFreezeAccTime+=O}}u=Tr(Tr({},S),{},{timestamp:E})}else this.isSkipCalcRenderFreezeTime()&&(u=Tr(Tr({},S),{},{timestamp:E}));var C,A;se("ENABLE_VIDEO_FRAME_CALLBACK")&&((C=(A=this.videoElement).requestVideoFrameCallback)===null||C===void 0||C.call(A,g))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),XA()&&!se("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Nn();o.name==="Safari"&&Number(o.version)===15||Av()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Zr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Zr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){fG.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=eo.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===eo.DESTROYED||this.internal}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,Dw()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};Dw()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),yW()}}const fG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class jL extends FL{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.internal=s,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;var o;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(o=this.slot)===null||o===void 0||o.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await VL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",se("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var mG,gG,_G,yG,EG,vG,SG,bG,wG,TG,RG,CG,IG,AG,PG,OG,kG,NG,DG,xG,LG,MG,UG,VG,FG,jG,BG,zG,bn,WG,GG,HG,$G,KG,qG,YG,XG,il;let Or=(mG=Gt({argsMap:(e,r,s)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),gG=si(),_G=Gt({argsMap:e=>[e.getTrackId()]}),yG=Nv("LocalVideoTrack","_enabledMutex"),EG=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),vG=si(),SG=Nv("LocalVideoTrack","_enabledMutex"),bG=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),wG=si(),TG=Gt({argsMap:(e,r)=>[e.getTrackId(),r,e._saveEncodeBitrateRatio]}),RG=si(),CG=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),IG=si(),AG=si(),PG=Gt({argsMap:(e,r,s)=>[e.getTrackId(),r,s]}),OG=si(),kG=si(),NG=si(),DG=Gt({argsMap:e=>[e.getTrackId()]}),xG=si(),LG=si(),MG=si(),UG=si(),VG=si(),FG=Gt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),jG=Gt({argsMap:e=>[e.getTrackId()]}),BG=Gt({argsMap:e=>[e.getTrackId()]}),zG=Gt({argsMap:(e,r,s)=>[e.getTrackId(),r.label,s]}),bn=class sae extends jv{get videoHeight(){if(Ls()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ls()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==eo.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,o,c,u,h){if(super(r,u),Pe(this,"trackMediaType",Fv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_saveEncodeBitrateRatio",1),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Ls()){const{width:m,height:g}=r.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],s&&this._hints.indexOf(_r.CUSTOM_TRACK)!==-1?this._encoderConfig=Gr(s):this._encoderConfig=s,this._hints.indexOf(_r.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Zx(Gn.CHROME,115)&&qA().indexOf("Windows")!==-1){const m=function(g,E){if("VideoFrame"in window&&"TransformStream"in window&&Vn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(g),C=new MediaStreamTrackGenerator({kind:"video"});let A,O,W=Date.now();const F=()=>{B&&(clearInterval(B),B=void 0),A&&(A.close(),A=void 0),g.stop(),O=void 0,C.removeEventListener("ended",F)};let B=window.setInterval(()=>{if(O&&A&&Date.now()-W>1e3)try{C.readyState==="live"?O.enqueue(A.clone()):F()}catch{F()}},1e3);const Z=new TransformStream({transform:(Q,ae)=>{C.readyState==="live"?(O=ae,W=Date.now(),A===void 0?(A=Q,ae.enqueue(Q.clone())):(ae.enqueue(A),A=Q)):Q.close()}});return C.addEventListener("ended",F),S.readable.pipeThrough(Z).pipeTo(C.writable),C}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(_r.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new SW(this.getTrackId(),"local"),this._processorDestination=new vW(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const o=Tr(Tr(Tr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new FL(o):this._player=new jL(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Vv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},se("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await yr(this,Tt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await yr(this,Tt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await yr(this,Tt.NEED_MUTE_TRACK,this):await yr(this,Tt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),x.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await yr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(ee.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Du(r),se("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=uP({encoderConfig:r});(Ls()||_o()||Ou())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Le(ee.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await yr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return Mm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Xc(this,Tt.GET_STATS)||Tr({},kL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await VL(r)}async findClosestProfile(){const{width:r,height:s,frameRate:o}=this.getMediaStreamTrackSettings(),{width:c,height:u,frameRate:h}=this._encoderConfig||{},m=kv(this._videoWidth||r||c||0),g=kv(this._videoHeight||s||u||0),E=function(S,C,A){if(!Array.isArray(se("VIDEO_ENCODER_CONFIG_LIST"))||se("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const O=Math.min(S,C);return!(O>=480)&&Tr(Tr({},se("VIDEO_ENCODER_CONFIG_LIST").find(W=>W.height>O)),{},{frameRate:A})}(m,g,kv(o||h||15));if(E)return x.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(E))),this.setEncoderConfiguration(E)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(ee.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await yr(this,Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(ee.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){TW(this._originMediaStreamTrack).then(r=>{let[s,o]=r;this._videoHeight=o,this._videoWidth=s}).catch(ZA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(ee.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Du(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await yr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!s||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(g,E,S,C,A){const O=se("BITRATE_ADAPTER_TYPE");if(O==="DEFAULT_BITRATE")return{min:C,max:A};if(A===void 0){const W=Math.floor(200*Math.pow(S/15,.6)*Math.pow(g*E/640/360,.75));A=O==="STANDARD_BITRATE"?4*W:2*W,C=C??W}else C=C??Math.floor(A/10);return{min:C,max:A}}(r,s,o,u,c);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,se("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&c==null){const[g,E]=function(S,C,A){const O=4*Math.floor(2e5*Math.pow(A/15,.6)*Math.pow(S*C/230400,.75)),W=S*C,F=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),B=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let Z=wc(F).call(F).next().value,Q=1;if(F.has(W))Z=F.get(W);else{var ae;const Je=x_(ae=Array.from(F.entries())).call(ae,(En,Jt)=>{let[tr]=En,[qn]=Jt;return tr-qn}),pn=Je.find(En=>{let[Jt]=En;return Jt>W});if(pn){const En=Je.indexOf(pn);if(En>0){const Jt=Je[En-1],tr=(W-Jt[0])/(pn[0]-Jt[0]);Z=Jt[1]+tr*(pn[1]-Jt[1])}else Z=pn[1]}else Z=Je[Je.length-1][1]}if(B.has(W))Q=B.get(W);else{var ye;const Je=x_(ye=Array.from(B.entries())).call(ye,(En,Jt)=>{let[tr]=En,[qn]=Jt;return tr-qn}),pn=Je.find(En=>{let[Jt]=En;return Jt>W});if(pn){const En=Je.indexOf(pn);if(En>0){const Jt=Je[En-1],tr=(W-Jt[0])/(pn[0]-Jt[0]);Q=Jt[1]+tr*(pn[1]-Jt[1])}else Q=pn[1]}else Q=Je[Je.length-1][1]}const _e=se("VIDEO_NEW_BITRATE_RATIO");_e&&_e>0&&(Z=_e/100);const ue=Math.floor(O*Z),Ie=Math.floor(65e4*Math.pow(S*C/230400,.5)*Math.pow(A/15,.69));let Ue=ue;const We=se("VIDEO_STANDARD_BITRATE_VERSION");return We&&We>0&&(We===1?Ue=O:We===2?Ue=ue:We===3&&(Ue=Ie)),[Math.floor(Ue/1e3),Q]}(r,s,o);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=E,x.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,s;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=Rz.checkOneElementVisible(u),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const E=At.reportApiInvoke(null,{tag:Wr.TRACER,name:li.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(o){throw new Le(ee.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(ee.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Tr(Tr({},o),Du(r))),o=W_(o);const c=Er(8,"track-video-cloned-"),u=new sae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,W_(this._scalabilityMode),this._optimizationMode,c,W_(this._hints));return r&&o&&u.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(ee.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(ee.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Mm(()=>{At.reportApiInvoke(null,{name:li.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Wr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!se("ENABLE_VIDEO_SEI")||!se("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(ee.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const o=s.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(sa.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await yr(this,Tt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await yr(this,Tt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sa.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Zc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Zc.REQUEST_CONSTRAINTS)}},On(bn.prototype,"play",[mG,gG],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),On(bn.prototype,"stop",[_G],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),On(bn.prototype,"setEnabled",[yG,EG,vG],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),On(bn.prototype,"setMuted",[SG,bG,wG],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),On(bn.prototype,"setSaveEncodeBitrateRatio",[TG,RG],Object.getOwnPropertyDescriptor(bn.prototype,"setSaveEncodeBitrateRatio"),bn.prototype),On(bn.prototype,"setEncoderConfiguration",[CG,IG],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),On(bn.prototype,"getStats",[AG],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),On(bn.prototype,"setBeautyEffect",[PG,OG],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),On(bn.prototype,"getCurrentFrameData",[kG],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),On(bn.prototype,"getCurrentFrameImage",[NG],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),On(bn.prototype,"findClosestProfile",[DG,xG],Object.getOwnPropertyDescriptor(bn.prototype,"findClosestProfile"),bn.prototype),On(bn.prototype,"setBitrateLimit",[LG],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),On(bn.prototype,"setOptimizationMode",[MG],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),On(bn.prototype,"setScalabiltyMode",[UG],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),On(bn.prototype,"updateMediaStreamTrackResolution",[VG],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),On(bn.prototype,"pipe",[FG],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),On(bn.prototype,"unpipe",[jG],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),On(bn.prototype,"close",[BG],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),On(bn.prototype,"replaceTrack",[zG],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),dP=(WG=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),GG=si(),HG=Nv("CameraVideoTrack","_enabledMutex"),$G=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),KG=si(),qG=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),YG=si(),XG=Gt({argsMap:e=>[e.getTrackId()]}),il=class oae extends Or{get __className__(){return"CameraVideoTrack"}constructor(r,s,o,c,u,h){super(r,Du(s.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Av()||iL())&&!function(){const m=Nn();if(m.os!==ts.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2}()&&Sz()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=Du(this._config.encoderConfig),pr.on(bs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pr.on(bs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await nl.getDeviceById(r),o={};o.video=Tr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await tl(o,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await tl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await nl.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Tr(Tr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await tl(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await tl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Tr({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await tl({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await yr(this,Tt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await yr(this,Tt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(ee.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Du(r),se("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=Gr(this._config);o.encoderConfig=r;const c=uP(o);(Ls()||_o()||Ou())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Le(ee.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await yr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((_o()||Ou())&&this._enabled&&!this._isClosed&&pr.duringInterruption){const r=async()=>{pr.off(bs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pr.on(bs.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,o=nl.searchDeviceIdByName(this._deviceName);if(o&&!s.deviceId&&(s.deviceId={exact:o}),this._enabled){const c=await tl({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),pr.off(bs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pr.off(bs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Tr(Tr({},o),Du(r))),o=W_(o);const c=Er(8,"track-cam-cloned-"),u=new oae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,W_(Tr(Tr({},this._config),{},{encoderConfig:o})),W_(this._constraints),W_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}bindProcessorContextEvents(){this.processorContext.on(Zc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}}),this.processorContext.on(Zc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},On(il.prototype,"setDevice",[WG,GG],Object.getOwnPropertyDescriptor(il.prototype,"setDevice"),il.prototype),On(il.prototype,"setEnabled",[HG,$G,KG],Object.getOwnPropertyDescriptor(il.prototype,"setEnabled"),il.prototype),On(il.prototype,"setEncoderConfiguration",[qG,YG],Object.getOwnPropertyDescriptor(il.prototype,"setEncoderConfiguration"),il.prototype),On(il.prototype,"close",[XG],Object.getOwnPropertyDescriptor(il.prototype,"close"),il.prototype),il);function BL(e,r,s,o){s.optimizationMode&&(o&&o.width&&o.height?(s.encoderConfig=Tr(Tr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(e,"] set content hint to"),s.optimizationMode):x.debug("[".concat(e,"] set content hint failed")))):x.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var JG,QG,ZG,e9,Bl,t9,n9,r9,i9,s9,o9,Do;class a9 extends lW{getUserId(){return this._userId}constructor(r,s,o,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(Er(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Wv=(JG=Gt({argsMap:(e,r,s)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),QG=Gt({argsMap:e=>[e.getTrackId()]}),ZG=Gt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),e9=Gt({argsMap:e=>[e.getTrackId()]}),On((Bl=class extends a9{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==eo.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,s,o,c){super(e,r,s,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",Fv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"_prePlayer",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new SW(this.getTrackId(),"remote"),this.processorDestination=new vW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Mm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Xc(this,Tt.GET_STATS)||Tr({},aW)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(jl.PLAY_START),typeof e=="string"){const o=document.getElementById(e);o?e=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Tr(Tr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(s);else{let o=!1,c=!1;e instanceof HTMLVideoElement?(this._player=new FL(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,o=this._player.videoState>0,this._player.updateConfig(s)):this._player=new jL(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(jl.FIRST_FRAME_DECODED),c&&this.safeEmit(jl.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=u=>{this.safeEmit(jl.VIDEO_STATE_CHANGED,u)},o&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(jl.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},se("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(jl.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){TW(this._originMediaStreamTrack).then(e=>{let[r,s]=e;this._videoHeight=s,this._videoWidth=r}).catch(ZA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const s=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=Rz.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=At.reportApiInvoke(null,{tag:Wr.TRACER,name:li.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(ee.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Le(ee.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(sa.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sa.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(K_.SEI_RECEIVED,e)}}).prototype,"play",[JG],Object.getOwnPropertyDescriptor(Bl.prototype,"play"),Bl.prototype),On(Bl.prototype,"stop",[QG],Object.getOwnPropertyDescriptor(Bl.prototype,"stop"),Bl.prototype),On(Bl.prototype,"pipe",[ZG],Object.getOwnPropertyDescriptor(Bl.prototype,"pipe"),Bl.prototype),On(Bl.prototype,"unpipe",[e9],Object.getOwnPropertyDescriptor(Bl.prototype,"unpipe"),Bl.prototype),Bl),Gv=(t9=Gt({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),n9=Gt({argsMap:(e,r)=>[e.getTrackId(),r]}),r9=Gt({argsMap:e=>[e.getTrackId()]}),i9=Gt({argsMap:e=>[e.getTrackId()]}),s9=Gt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),o9=Gt({argsMap:e=>[e.getTrackId()]}),On((Do=class extends a9{get isPlaying(){return this._useAudioElement?Ia.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,s,o){super(e,r,s,o),Pe(this,"trackMediaType",Fv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),se("DISABLE_WEBAUDIO")?(this._source=new UL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new pW(e,!0),se("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Qc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(jl.FIRST_FRAME_DECODED)}),this.processorContext=new wW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new bW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Qc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Qc.ON_AUDIO_BUFFER),this._source.on(Qc.ON_AUDIO_BUFFER,s=>e(s))}setVolume(e){this._volume=e,this._useAudioElement?Ia.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!rW())throw new Le(ee.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ia.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Mm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Xc(this,Tt.GET_STATS)||Tr({},oW)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ia.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ia.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ia.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Le(ee.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Le(ee.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Le(ee.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(sa.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(sa.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sa.ON_TRACK),this.processorDestination.removeAllListeners(sa.ON_NODE)}}).prototype,"setVolume",[t9],Object.getOwnPropertyDescriptor(Do.prototype,"setVolume"),Do.prototype),On(Do.prototype,"setPlaybackDevice",[n9],Object.getOwnPropertyDescriptor(Do.prototype,"setPlaybackDevice"),Do.prototype),On(Do.prototype,"play",[r9],Object.getOwnPropertyDescriptor(Do.prototype,"play"),Do.prototype),On(Do.prototype,"stop",[i9],Object.getOwnPropertyDescriptor(Do.prototype,"stop"),Do.prototype),On(Do.prototype,"pipe",[s9],Object.getOwnPropertyDescriptor(Do.prototype,"pipe"),Do.prototype),On(Do.prototype,"unpipe",[o9],Object.getOwnPropertyDescriptor(Do.prototype,"unpipe"),Do.prototype),Do);const Yh=new class extends Xr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class c9 extends Xr{constructor(r,s){super(),Pe(this,"trackMediaType",Fv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return se("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new gt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;s(new Le(ee.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Le(ee.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(ee.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[cP.OPEN,cP.CLOSE,cP.ERROR].forEach(s=>{const o=()=>{this.emit(s)};this._datachannelEventMap.set(s,o),r.addEventListener(s,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[o,c]=s;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Sme extends c9{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(se("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=s.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(cP.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class bme extends c9{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function hP(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>dA.revokeObjectURL(e),0),new Worker(dA.createObjectURL(e))}const l9=71,zL=1,WL=2,GL=1,u9=2;var Fm=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Fm||{});function HL(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=e.getUint8(0);if(s!==l9)return;const o=e.getUint16(1),c=zL+WL+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:s,tlvLen:o,tlv:[],frame:u};let m=zL+WL;for(;m<c;){const g=e.getUint8(m),E=e.getUint16(m+GL),S=GL+u9;if(g===Fm.AUDIO_LEVEL){let C=e.getUint8(m+S);for(let A=1;A<E;A++)C=C<<8|e.getUint8(m+S+A);h.tlv.push({tag:g,length:E,value:r?127^C>>1:127&C})}else if(g===Fm.METADATA||g===Fm.AUDIO_64_BIT_PTS){const C=new Uint8Array(E);for(let A=0;A<E;A++)C[A]=e.getUint8(m+S+A);h.tlv.push({tag:g,length:E,value:C})}m+=S+E}return h}const pP=new Map,fP=127,X_=1e-10,$L=139/13,mP=new Map;function KL(e,r,s){const o="".concat(e,"-").concat(r,"-").concat(s);let c=0;return mP.has(o)?c=mP.get(o):(c=Math.log(function(h,m){const g=h-m;m<g&&(m=g);let E=1;for(let S=h,C=1;S>m;S--,C++)E=E*S/C;return E}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(s)+s*e,mP.set(o,c)),c<X_&&(c=X_),c}function d9(e,r,s){const o=r.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let g=0;for(let E=m+c;m<E;m++)e[m]>s&&g++;r[h]!==g&&(r[h]=g,u=!0)}return u}window.cache=mP;let wme=0;class h9{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",X_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",X_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",X_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(wme++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,o=this.minLevel+$L;let c=!1;for(let u=0;u<r.length;++u){let h=s[u];h<o&&(h=0);const m=Math.floor(h/$L);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return d9(this.mediums,this.longs,4)}computeMediums(){return d9(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=KL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=KL(this.longs[0],10,47),this.longSpeechActivityScore>X_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=KL(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(n_(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let o=r;return r<0&&(o=0),r>fP&&(o=fP),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+$L?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>fP&&(s=fP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Tme{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class qL{constructor(r,s,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=o}}class Rme extends Xr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(s,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new h9(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,o){const c=r.id===this.dominantId;if(s<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new qL(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new qL(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new qL(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Tme(this),this.decisionMaker.execute())}makeDecision(r){let s=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=wc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let E=2;for(const S of this.speakers.entries()){const[C,A]=S;if(A===m)continue;A.evaluateSpeechActivityScores(r);for(let B=0;B<g.length;++B){const Z=m==null?X_:m.getSpeechActivityScore(B);g[B]=Math.log(A.getSpeechActivityScore(B)/Z)}const O=g[0],W=g[1],F=g[2];O>3&&W>2&&F>0&&W>E&&(E=W,u=C)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(s=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===s||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let o=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const s=[];for(const c of wc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<u&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const Hv=new Map;let Ud=null,gP=null;const p9=3;let J_=[];const Vd=new Map,_P=new Map;class Cme{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(Vd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:o}=function(){const c=[],u=[];return Array.from(wc(Vd).call(Vd)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(s.length>3){let c;s.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(s.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let o;return Array.from(wc(Vd).call(Vd)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let o;return Array.from(wc(Vd).call(Vd)).forEach(c=>{c.active||c.id===s||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let yP;function f9(e){const r=Vd.get(e);r&&(Vd.delete(e),r.clearTimer())}const EP=new Map,Ime=new Map,YL="video/h264",XL="video/h265";function m9(e,r,s){let o=new Uint8Array(e,r,s),c=[],u=0;for(;c.length<s;)u+3<s&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}function g9(e){const r=e.length;let s=[],o=0;for(;o<r;)o+2<r&&e[o]===0&&e[o+1]===0&&(e[o+2]===0||e[o+2]===1||e[o+2]===2||e[o+2]===3)?(s.push(e[o],e[o+1],3,e[o+2]),o+=3):(s.push(e[o]),o++);return new Uint8Array(s)}function _9(e){if(e.length<5)return"";let r=-1;for(let c=0;c<e.length-3;c++){if(e[c]===0&&e[c+1]===0&&e[c+2]===1){r=c;break}if(c<e.length-4&&e[c]===0&&e[c+1]===0&&e[c+2]===0&&e[c+3]===1){r=c;break}}if(r===-1)return"";const s=r+(e[r+2]===0?4:3);if(s>=e.length)return"";const o=e[s];return 128&o?"":(o>>1&63)>=32||s+1<e.length&&(248&e[s+1])==0?XL:(31&o)<=31?YL:""}const vP=new Map,Hw=new Map;(function(){const e=Nn();Ss.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ss.getStreamFromExtension=e.name===Gn.CHROME&&Number(e.version)>34,Ss.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),Ss.supportMinBitrate=e.name===Gn.CHROME||e.name===Gn.EDGE,Ss.supportSetRtpSenderParameters=function(){const r=Nn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!of()||!(!Ls()&&!YA())||r.name===Gn.FIREFOX&&Number(r.version)>=64)}(),e.name===Gn.SAFARI&&(Number(e.version)>=14?Ss.supportDualStream=!0:Ss.supportDualStream=!1),Ss.webAudioMediaStreamDest=function(){const r=Nn();return!(r.name===Gn.SAFARI&&Number(r.version)<12)}(),Ss.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ss.supportWebGL=typeof WebGLRenderingContext<"u",Ss.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,of()||(Ss.webAudioWithAEC=!0),Ss.supportShareAudio=function(){const r=Nn();return(r.os===ts.WIN_10||r.os===ts.WIN_81||r.os===ts.WIN_7||r.os===ts.LINUX||r.os===ts.MAC_OS||r.os===ts.CHROMIUM_OS)&&r.name===Gn.CHROME&&Number(r.version)>=74}(),Ss.supportDataChannel=!!(Iv(76)||tL(68)||gz(14)),Ss.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Zr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),Ss.supportWebRTCEncodedTransform=Iv(87)||pz()||tL(117),Ss.supportWebRTCInsertableStream=function(){const r=Nn();return(r.name===Gn.CHROME||r.name===Gn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ss.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ss.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,QA(()=>{Ss.supportDualStreamEncoding=function(){const r=Nn();return!!se("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&se("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",e),x.info("browser compatibility: ",Ss)})})();const Ame=["CHINA","GLOBAL"],y9=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Q_=[],$v=[];function Z_(e,r){return!!r&&Q_.some(s=>s.uid===e&&s.channelName===r)}function JL(){return $v.length>0}var Pme=N6.forEach,E9=Xg("forEach")?[].forEach:function(e){return Pme(this,e,arguments.length>1?arguments[1]:void 0)};Wn({target:"Array",proto:!0,forced:[].forEach!==E9},{forEach:E9});var Ome=_c("Array","forEach"),kme=hd,Nme=zr,Dme=k,xme=Ome,QL=Array.prototype,Lme={DOMTokenList:!0,NodeList:!0},Mme=function(e){var r=e.forEach;return e===QL||Dme(QL,e)&&r===QL.forEach||Nme(Lme,kme(e))?xme:r},Ume=l(Mme),Vme=$s,v9=wa;Wn({target:"Object",stat:!0,forced:d(function(){v9(1)})},{keys:function(e){return v9(Vme(e))}});var Fme=l(xe.Object.keys),jme=l(ki),Bme=l(t_),zme=Wn,S9=pd,Wme=xs,Gme=we,b9=qe,Hme=dr,$me=rn,Kme=MD,qme=Pr,Yme=_s,Xme=b6("slice"),Jme=qme("species"),ZL=Array,Qme=Math.max;zme({target:"Array",proto:!0,forced:!Xme},{slice:function(e,r){var s,o,c,u=$me(this),h=Hme(u),m=b9(e,h),g=b9(r===void 0?h:r,h);if(S9(u)&&(s=u.constructor,(Wme(s)&&(s===ZL||S9(s.prototype))||Gme(s)&&(s=s[Jme])===null)&&(s=void 0),s===ZL||s===void 0))return Yme(u,m,g);for(o=new(s===void 0?ZL:s)(Qme(g-m,0)),c=0;m<g;m++,c++)m in u&&Kme(o,c,u[m]);return o.length=c,o}});var Zme=_c("Array","slice"),ege=k,tge=Zme,e2=Array.prototype,nge=function(e){var r=e.slice;return e===e2||ege(e2,e)&&r===e2.slice?tge:r},rge=l(nge);function Ct(e,r,s,o,c){var u,h,m,g={};return Ume(u=Fme(o)).call(u,function(E){g[E]=o[E]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=jme(h=Bme(m=rge(s).call(s)).call(m)).call(h,function(E,S){return S(e,r,E)||E},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(y6(e,r,g),null):g}let SP=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),t2=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),xu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),oa=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Bt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Rr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Qt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Yt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),$w=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Rn=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),aa=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),cn=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function bP(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw x.error("Invalid Channel Name ".concat(e)),new ke(ee.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function wP(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||Tz(e,1,255)))throw new ke(ee.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let cf=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const ige={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},n2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function r2(e,r){Es(e.url,"".concat(r,".url"),1,1e3,!1),ei(e.x)||gr(e.x,"".concat(r,".x"),0,1e4),ei(e.y)||gr(e.y,"".concat(r,".y"),0,1e4),ei(e.width)||gr(e.width,"".concat(r,".width"),0,1e4),ei(e.height)||gr(e.height,"".concat(r,".height"),0,1e4),ei(e.zOrder)||gr(e.zOrder,"".concat(r,".zOrder"),0,255),ei(e.alpha)||gr(e.alpha,"".concat(r,".alpha"),0,1,!1)}const sge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let jm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),i2=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Vi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function w9(e){if(!e.channelName)throw new ke(ee.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ke(ee.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Es(e.token,"info.token",1,2047),wP(e.uid),bP(e.channelName),!0}let ca=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),lf=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Za=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Kv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),or=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),us=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),TP=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ns=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Xn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const T9=[Xn.AFRICA,Xn.ASIA,Xn.CHINA,Xn.EUROPE,Xn.GLOBAL,Xn.INDIA,Xn.JAPAN,Xn.NORTH_AMERICA,Xn.OCEANIA,Xn.OVERSEA,Xn.SOUTH_AMERICA];let to=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const RP={CHINA:{},ASIA:{CODE:to.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:to.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:to.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:to.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:to.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:to.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:to.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:to.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:to.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:to.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:to.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:to.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:to.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};SL&&(RP.CHINA={CODE:to.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Kw=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function R9(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class C9 extends Xr{constructor(r,s){super(),q(this,"onICEConnectionStateChange",void 0),q(this,"onConnectionStateChange",void 0),q(this,"onDTLSTransportStateChange",void 0),q(this,"onDTLSTransportError",void 0),q(this,"onICETransportStateChange",void 0),q(this,"onFirstAudioReceived",void 0),q(this,"onFirstVideoReceived",void 0),q(this,"onFirstAudioDecoded",void 0),q(this,"onFirstVideoDecoded",void 0),q(this,"onFirstVideoRender",void 0),q(this,"onFirstVideoDecodedTimeout",void 0),q(this,"onSelectedLocalCandidateChanged",void 0),q(this,"onSelectedRemoteCandidateChanged",void 0),q(this,"onICECandidateError",void 0),q(this,"getLocalVideoStats",void 0)}}class I9 extends C9{constructor(r,s){super(r,s),q(this,"establishPromise",void 0)}}let Et=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),no=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),uf=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const A9=["disconnected","failed"];let Ye=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),rr=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ut=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Lu=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Mu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ds=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),P9=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Xh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),zl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Fd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),qv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),gi=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Yv=function(e){return e.ABORT="abort",e}({}),Bm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),oge=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const age={[SP.ACCESS_POINT]:{[oa.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[oa.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[oa.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[oa.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[oa.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[oa.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[oa.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[SP.UNILBS]:{[xu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[xu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[xu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[xu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[xu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[xu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[xu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[xu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[xu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[xu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[xu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[xu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[SP.STRING_UID_ALLOCATOR]:{[t2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[t2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[t2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Xv(e){const r=age[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[e%1e4];if(!s){if(Math.floor(e/1e4)===SP.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const cge={[Bt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Bt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Bt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Bt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Bt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Bt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Bt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Bt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Bt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Bt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Bt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Bt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Bt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Bt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Bt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Bt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Bt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Bt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Bt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Bt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Bt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Bt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Bt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Bt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Bt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Bt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Bt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Bt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Bt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Bt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Bt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Bt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Bt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Bt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Bt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Bt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Bt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Bt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Bt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Bt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Bt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Bt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Bt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Bt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Bt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Bt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Bt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Bt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Bt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Bt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Bt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Bt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Bt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Bt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Bt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Bt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function qw(e){return cge[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function O9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function s2(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?O9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):O9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function o2(e,r){if(typeof e=="string")return e;const{proxy:s,host:o,port:c}=e;if(r){const u=se("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const lge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,uge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,dge=/wss:\/\/(.+):([0-9]+)\/?/,hge=/wss:\/\/(.[^\/]+)\/?/;let pge=0;class fge{constructor(r,s){q(this,"id",0),q(this,"store",void 0),q(this,"recordIndex",void 0),q(this,"websockets",[]),q(this,"try443PortDuration",2e3),q(this,"forceCloseWSDuration",5e3),q(this,"try443PortTimeout",null),q(this,"forceCloseTimeout",null),q(this,"isTry443PortFailed",!1),q(this,"isNormalPortFailed",!1),q(this,"useDoubleDomain",!1),q(this,"useProxy",!1),q(this,"startTime",Date.now()),this.id=++pge,this.try443PortDuration=se("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,o){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:o});const c=se("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(A=>{var O;return et(O=r.host).call(O,A)});m||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach(A=>{g.push(o2(s2(s2({},r),{},{host:r.host.replace(m,A)}),s))});else{const A=s2({},r);if(s&&m){const O=c.find(W=>W!==m);O&&(A.host=A.host.replace(m,O))}g.push(o2(A,s))}try{g.forEach(A=>{const O=new WebSocket(A);O.binaryType="arraybuffer",h.push(O),this.logger("ws is connecting:",O.url)})}catch(A){if(this.logger("ws create failed"),h.forEach(O=>O.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,o);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new ke(ee.WS_ERR,"init websocket failed! Error: ".concat(A.toString()))}const E=Nw();this.store&&this.store.recordJoinChannelService({urls:h.map(A=>A.url),service:"gateway"},this.recordIndex),h.forEach(A=>{A.onopen=()=>{this.logger("onopen: ws ".concat(A.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(O=>{O!==A&&(O.onopen=null,O.onclose=null,O.onmessage=null,O.close(),this.logger("close backup websocket: ".concat(O.url)))}),this.websockets.length=0,E.resolve(A)},A.onclose=O=>{this.logger("onclose: ws ".concat(A.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(A.readyState));const W=h.every(F=>F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(W)),W&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(O.reason)),E.reject({code:O.code,reason:TP.A_ROUND_WS_FAILED})):!s&&W&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),C()),s?this.isTry443PortFailed=W:this.isNormalPortFailed=W},A.onmessage=O=>this.logger("".concat(A.url," onmessage: ").concat(O.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(A=>A.readyState!==WebSocket.OPEN&&A.close())},C=()=>{if(E.isResolved)return S();Nn().os===ts.MAC_OS&&Zr()&&S(),this.createWebSocket(r,!0,!0).then(A=>{E.resolve(A)}).catch(A=>{this.isNormalPortFailed&&E.reject(A),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,C()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,s,o,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(u){let h,m,g;return[,h,m,g]=u.match(lge)||[],h||([,m,g]=u.match(uge)||[]),m&&g||([,m,g]=u.match(dge)||[]),m&&g||([,m]=u.match(hge)||[]),m||x.warning("un-destructible url: ",u),{proxy:h,host:m,port:g||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function k9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}class N9 extends Xr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;et(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(cn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(cn.CONNECTED):this._state==="closed"?this.emit(cn.CLOSED):this._state==="failed"&&this.emit(cn.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),q(this,"_websocketUrl",null),q(this,"connectionID",0),q(this,"currentURLIndex",0),q(this,"urls",[]),q(this,"_reconnectMode","tryNext"),q(this,"reconnectReason",void 0),q(this,"_initMutex",void 0),q(this,"name",void 0),q(this,"_state","closed"),q(this,"reconnectInterrupter",void 0),q(this,"websocket",void 0),q(this,"retryConfig",void 0),q(this,"reconnectCount",0),q(this,"forceCloseTimeout",5e3),q(this,"onlineReconnectListener",void 0),q(this,"useCompress",void 0),q(this,"tryDoubleDomain",!1),q(this,"use443PortOnly",!1),q(this,"wsInflateLength",0),q(this,"wsDeflateLength",0),q(this,"closeEstablishingWs",()=>{}),q(this,"store",void 0),q(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(C){for(var A=1;A<arguments.length;A++){var O=arguments[A]!=null?arguments[A]:{};A%2?k9(Object(O),!0).forEach(function(W){q(C,W,O[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(O)):k9(Object(O)).forEach(function(W){Object.defineProperty(C,W,Object.getOwnPropertyDescriptor(O,W))})}return C}({},s),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Zs("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:g}=s,E=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*g)/10);Cc.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S),bi.on(Pv.NETWORK_STATE_CHANGE,(C,A)=>{C!==A&&(this.resetReconnectCount("network state change: ".concat(A," -> ").concat(C)),C===Cc.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{var c;const u=Nw(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(m){return!(sP()||se("USE_NEW_TOKEN")||!se("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||se("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(P9.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(u.resolve).catch(u.reject),this.once(cn.CLOSED,()=>{u.reject(new Le(ee.WS_DISCONNECT))}),this.once(cn.CONNECTED,u.resolve),await u.promise}catch{}finally{o()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;s?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(ee.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new Le(ee.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const o=Nw();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var C;(C=this.store)===null||C===void 0||C.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var C;if(x.debug("[".concat(this.name,"] websocket close ").concat((C=this.websocket)===null||C===void 0?void 0:C.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Le(ee.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const A=Xc(this,cn.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,O=await this.reconnectWithAction(A);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!O)return o.reject(new Le(ee.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(cn.ON_MESSAGE,S)},m=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),se("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=se("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const g=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;this._websocketUrl=o2(r);const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(S){const C=this.state==="closed",A=S instanceof Le,O=A&&S.code===ee.WS_ABORT,W=A&&S.code===ee.WS_ERR,F=A?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(F)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:O?"aborted":"error",errors:[S]},g),C||W?(o.reject(C?new Le(ee.WS_DISCONNECT,"websocket is closed: ".concat(F)):new Le(ee.WS_ERR,"init websocket failed: ".concat(F))),W&&x.error("[".concat(this.name,"] init websocket failed: ").concat(F))):u&&u(S)}return o.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||bi.isOnline||!bi.onlineWaiter||(this.onlineReconnectListener=bi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,s){const h=pL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await gt.race([vs(h),this.onlineReconnectListener||new gt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(cn.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Us(this,cn.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&et(m).call(m,"dynamic key expired")?(this.emit(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class a2 extends N9{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const o=Nw(),c=function(h,m){return new fge(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Le(ee.WS_ABORT,"choose best websocket aborted"))};const u=se("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Yw extends N9{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new gt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(W=>{W.onclose=null,W.onopen=null,W.onmessage=null,W.close()}),c(new Le(ee.WS_ABORT,"choose best websocket aborted"))};const m=se("GATEWAY_DOMAINS");let g;const E=r.indexOf("?h="),S=m.find(W=>E!==-1?et(r).call(r,W,E):et(r).call(r,W));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let C=!this.tryDoubleDomain||!S;if(!C&&S){var A;const W=Date.now();try{m.forEach(F=>{const B=E===-1?r.replace(S,F):r.substr(0,E)+r.substr(E).replace(S,F),Z=new WebSocket(B);Z.binaryType="arraybuffer",h.push(Z),x.debug("[choose-best-ws] ws is connecting:",Z.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(B=>B.close());h.length;)h.pop();C=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:h.map(F=>F.url),service:"gateway"},s),h.forEach(F=>{F.onopen=()=>{if(u)return;const B=Date.now()-W;x.debug("[choose-best-ws] ws open cost ".concat(B,"ms")),h.filter(Z=>Z!==F).forEach(Z=>{x.debug("[choose-best-ws]close backup websocket: ".concat(Z.url)),Z.close()}),u=!0,o(F)},F.onclose=B=>{g=B,!u&&(h.find(Z=>!(Z.readyState===WebSocket.CLOSED||Z.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(g)))},F.onmessage=B=>{x.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(B.data))}}),vs(this.forceCloseTimeout).then(()=>{h.forEach(F=>{F.readyState!==WebSocket.OPEN&&F.close()})})}if(C){var O;let W;x.debug("[choose-best-ws] use single url: ",r),(O=this.store)===null||O===void 0||O.recordJoinChannelService({urls:[r],service:"gateway"},s);try{W=new WebSocket(r),h.push(W),W.binaryType="arraybuffer"}catch(F){const B=new Le(ee.WS_ERR,"init websocket failed! Error: ".concat(F.toString()));return x.error("[".concat(this.name,"]").concat(B)),void c(B)}W.onopen=()=>{o(W)},W.onclose=F=>{c(F)},W.onmessage=F=>{x.debug("[choose-best-ws]".concat(W.url," onmessage: ").concat(F.data))},vs(this.forceCloseTimeout).then(()=>{W&&W.readyState!==WebSocket.OPEN&&W.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class mge extends Xr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Rr.CONNECTED?this.emit(Qt.WS_CONNECTED):r===Rr.RECONNECTING?this.emit(Qt.WS_RECONNECTING,this._websocketReconnectReason):r===Rr.CLOSED&&this.emit(Qt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",Rr.CLOSED),q(this,"reconnectToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new jz(5)),q(this,"pingpongTimer",void 0),q(this,"wsInflateDataTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"ortc",void 0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Qt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Rn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Rn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(nr.UID_BANNED);break;case 15:this.close(nr.IP_BANNED);break;case 16:this.close(nr.CHANNEL_BANNED)}if(c._type===Rn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(nr.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(nr.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(nr.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(nr.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(nr.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(nr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new a2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,se("JOIN_GATEWAY_USE_DUAL_DOMAIN"),se("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Rr.CONNECTED&&this.reconnect("retry",Ms.OFFLINE)})}async request(r,s,o,c){const u=Er(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new gt((W,F)=>{if(this.connectionState===Rr.CONNECTED)return W();const B=()=>{this.off(Qt.WS_CLOSED,Z),W()},Z=()=>{this.off(Qt.WS_CONNECTED,B),F(new ke(ee.WS_ABORT))};this.once(Qt.WS_CONNECTED,B),this.once(Qt.WS_CLOSED,Z),r!==Yt.PUBLISH&&r!==Yt.PUBLISH_DATASTREAM&&r!==Yt.SUBSCRIBE&&r!==Yt.SUBSCRIBE_DATASTREAM&&r!==Yt.UNSUBSCRIBE&&r!==Yt.UNSUBSCRIBE_DATASTREAM&&r!==Yt.UNPUBLISH&&r!==Yt.UNPUBLISH_DATASTREAM&&r!==Yt.CONTROL&&r!==Yt.RESTART_ICE||this.once(Qt.DISCONNECT_P2P,()=>{F(new ke(ee.DISCONNECT_P2P))}),r!==Yt.PUBLISH&&r!==Yt.RESTART_ICE||this.once(Qt.ABORT_P2P_EXECUTION,()=>{F(new ke(ee.DISCONNECT_P2P))})});if(this.connectionState!==Rr.CONNECTING&&this.connectionState!==Rr.RECONNECTING||r===Yt.JOIN||r===Yt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const E=new gt((W,F)=>{let B=!1;const Z=(ae,ye)=>{B=!0,W({isSuccess:ae==="success",message:ye||{}}),this.off(Qt.WS_CLOSED,Q),this.off(Qt.WS_RECONNECTING,Q),this.emit(Qt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),Z);const Q=()=>{F(new ke(ee.WS_ABORT,"type: ".concat(r))),this.off(Qt.WS_CLOSED,Q),this.off(Qt.WS_RECONNECTING,Q),this.off("res-@".concat(u),Z)};this.once(Qt.WS_CLOSED,Q),this.once(Qt.WS_RECONNECTING,Q),vs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Qt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await E}catch(W){if(this.connectionState===Rr.CLOSED||r===Yt.LEAVE)throw new ke(ee.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?W.throw():r===Yt.JOIN||r===Yt.REJOIN?null:(await g(),await this.request(r,s))}if(S.isSuccess)return S.message;const C=Number(S.message.error_code||S.message.code),A=qw(C),O=new ke(ee.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(S.message.error_str),{code:C,data:S.message,desc:A.desc});return A.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(C,", message: ").concat(A.desc,", action: ").concat(A.action)),C===Bt.ERR_TOO_MANY_BROADCASTERS?((r===Yt.JOIN||r===Yt.REJOIN)&&(this.initError=O,this.close()),O.throw()):A.action==="failed"?O.throw():A.action==="quit"?(this.initError=O,this.close(),O.throw()):(C===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ms.MULTI_IP)):this.reconnect(A.action,Ms.SERVER_ERROR),r===Yt.JOIN||r===Yt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new gt(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload($w.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=se("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Rr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},se("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new gt((s,o)=>{this.once(Qt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Qt.WS_CLOSED,c=>o(this.initError||new ke(ee.WS_ABORT,c))),this.connectionState=Rr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||nr.LEAVE,this.connectionState=Rr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Qt.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await Us(this,Qt.REQUEST_JOIN_INFO);this.store.joinReq();const s=await this.request(Yt.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!s)return this.emit(Qt.REPORT_JOIN_GATEWAY,TP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Qt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Rr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ke(ee.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Uw(this,Qt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Yt.REJOIN,r);return!!s&&(this.connectionState=Rr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(o=>{this.emit(Rn.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(Rn.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(Rn.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(Rn.MUTE_AUDIO,{uid:o.uid}):this.emit(Rn.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(Rn.MUTE_VIDEO,{uid:o.uid}):this.emit(Rn.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(Rn.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(Rn.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(Rn.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(Rn.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(Rn.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){if(!this.ortc)return!1;const s={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Yt.DOWNGRADE_CODEC,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=qw(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Qt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(nr.UID_BANNED),void this.close()):void this.reconnect(s.action,Ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=se("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>se("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ms.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),se("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload($w.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(cn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Qt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(cn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(cn.CLOSED,()=>{this.connectionState=Rr.CLOSED}),this.websocket.on(cn.FAILED,()=>{this._disconnectedReason=nr.NETWORK_ERROR,this.connectionState=Rr.CLOSED}),this.websocket.on(cn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Rr.CONNECTED?this.connectionState=Rr.RECONNECTING:this.connectionState=Rr.CONNECTING}),this.websocket.on(cn.WILL_RECONNECT,(r,s,o)=>{const c=Uw(this,Qt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=TP.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Qt.REPORT_JOIN_GATEWAY,s||TP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Qt.DISCONNECT_P2P)),o(r)}),this.websocket.on(cn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Ms.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Qt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof ke){if(r.code===ee.UNEXPECTED_RESPONSE&&r.data.code===Bt.ERR_NO_AUTHORIZED)return this.initError=new ke(ee.TOKEN_EXPIRE,"dynamic key expired"),void this.close(nr.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ms.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(cn.REQUEST_NEW_URLS,(r,s)=>{Us(this,Qt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(P9.PRE_CONNECT_PC,()=>{this.emit(Qt.PRE_CONNECT_PC)})}}let gge=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),wi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function D9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function CP(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?D9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):D9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function zm(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(se("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function IP(e){try{const r=se("GATEWAY_DOMAINS").concat(se("TURN_DOMAIN")).find(s=>et(e).call(e,s));return r?e.split(".".concat(r))[0].replace(/-/g,"."):e}catch{return x.debug("serverUrlToIp error, fallback to url",e),e}}function c2(e,r){e.addresses||(e.addresses=[]);const s=function(m,g){if(se("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(C=>{let{ip:A,port:O}=C;return{address:"".concat(A,":").concat(O)}});const E=se("GATEWAY_DOMAINS");let S=E[1]&&et(g).call(g,E[1])?1:0;return m.map(C=>{let{domain_prefix:A,port:O,ip:W}=C;if(A)return{address:"".concat(A,".").concat(E[S++%E.length],":").concat(O)};const F=/^[\.\:\d]+$/.test(W),B=F?"".concat(W.replace(/[^\d]/g,"-"),".").concat(E[S++%E.length],":").concat(O):"".concat(W,":").concat(O);return F||x.debug("Cannot recognized as ip address: ".concat(W,", use as host3")),{ip:W,port:O,address:B}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let g=0;g<m.length;g++){var c;const E=No(c=m[g]).call(c);s[g]&&E&&(s[g].ip6=E)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,g]=u.split(":");m&&g&&(h={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ic(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function x9(e){const r=e._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(Ic(r.width),"x").concat(Ic(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function L9(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Xw(e,r){let s,o,c;switch(r){case wi.CHOOSE_SERVER:o=4096,c="choose server";break;case wi.CLOUD_PROXY:o=1048576,c="proxy";break;case wi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case wi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new ke(ee.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(s={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>CP(CP({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:CP(CP({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!s)throw new ke(ee.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return s}async function M9(e,r){return await gt.all(e.addresses.map(async s=>({address:zm(s.ip),tcpport:s.port,udpport:s.port,username:r&&se("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Vs.username,password:r&&se("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await lL(r.toString()):Vs.password})))}function l2(e,r){const s=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||s.height,c=r.videoWidth||s.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Ic(e.height),Ic(e.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Wm(e){let{candidateType:r,relayProtocol:s,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:r,relayProtocol:s,protocol:h};if(o!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=u}return m}function ey(e){const r=e.split(":"),s=e.split(/[-.]/),o=et(e).call(e,"-")?"-":".";let c=e;return r.length>1?s.length>1?(s[1]="**",c=s[0]+o+"**:"+r[r.length-1]):c=r.length>2?r[0]+o+"**:"+r[r.length-1]:"**:"+r[r.length-1]:s.length>1&&(c=s[0]+o+"**"),c}function AP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:se("SVC_MODE");if(se("ENABLE_SVC"))return function(r){return r in nP}(e)?e:nP.L1T3}const U9={[Et.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Et.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function PP(e,r,s){r.forEach(o=>{var c;const u=U9[e].find(m=>{var g;let{key:E}=m;return et(g=o.extensionName).call(g,E)});if(!u)return;const h=s.find(m=>{let{extensionName:g}=m;return et(g).call(g,u.key)});h&&et(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function Jv(e,r){r.forEach(s=>{var o;const c=U9[e].find(u=>{var h;let{key:m}=u;return et(h=s.extensionName).call(h,m)});et(o=s.extensionName).call(o,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function V9(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||et(e).call(e,"abs-send-time")}function OP(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||et(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function F9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function j9(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?F9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):F9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function Jw(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:E,unsupportedVideoDownlinkCodec:S}=r,{useXR:C}=s;let A=[],O=[],W=[],F=[],B=!1,Z=!1;if(Ja(e).mediaDescriptions.forEach(ae=>{o&&o!==ae.attributes.direction||(ae.media.mediaType!=="video"||B||(O=ae.attributes.payloads,F=ae.attributes.extmaps,B=!0),ae.media.mediaType!=="audio"||Z||(A=ae.attributes.payloads,W=ae.attributes.extmaps,Z=!0))}),!F||O.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!W||A.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(O.forEach(ae=>{var ye;(ye=ae.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(ae.rtpMap.clockRate=parseInt(ae.rtpMap.clockRate)),C&&ae.rtcpFeedbacks.push({type:"rrtr"})}),A.forEach(ae=>{var ye;(ye=ae.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(ae.rtpMap.clockRate=parseInt(ae.rtpMap.clockRate)),C&&ae.rtcpFeedbacks.push({type:"rrtr"})}),c&&(A=A.filter(ae=>{var ye;return((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"}),O=O.filter(ae=>{var ye;return((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"})),u){const ae=O.filter(ue=>{var Ie;return/(red)|(ulpfec)|(flexfec)/i.test(((Ie=ue.rtpMap)===null||Ie===void 0?void 0:Ie.encodingName)||"")}),ye=Hm(ae,O).map(ue=>ue.payloadType),_e=[...ae.map(ue=>ue.payloadType),...ye];O=O.filter(ue=>!et(_e).call(_e,ue.payloadType))}if(h&&(A=A.filter(ae=>{var ye;return!/(red)|(ulpfec)|(flexfec)/i.test(((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(A=A.filter(ae=>{var ye;return et(m).call(m,((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0){const ae=O.filter(ye=>{var _e;return et(g).call(g,((_e=ye.rtpMap)===null||_e===void 0?void 0:_e.encodingName.toLowerCase())||"")});O=ae.concat(c?[]:Hm(ae,O))}const Q=se("UNSUPPORTED_VIDEO_CODEC");if(Q&&Q.length>0){const ae=O.filter(ue=>ue.rtpMap&&et(Q).call(Q,ue.rtpMap.encodingName.toLowerCase())),ye=Hm(ae,O),_e=ae.concat(ye).map(ue=>ue.payloadType);O=O.filter(ue=>!et(_e).call(_e,ue.payloadType)),x.debug("unsupportedVideoCodec: ".concat(Q,", toBeRemoved: ").concat(_e))}if(E&&E.length>0&&o==="sendonly"){const ae=O.filter(ue=>ue.rtpMap&&et(E).call(E,ue.rtpMap.encodingName.toLowerCase())),ye=Hm(ae,O),_e=ae.concat(ye).map(ue=>ue.payloadType);O=O.filter(ue=>!et(_e).call(_e,ue.payloadType)),x.debug("unsupportedVideoUplinkCodec: ".concat(E,", toBeRemoved: ").concat(_e))}if(S&&S.length>0&&o==="recvonly"){const ae=O.filter(ue=>ue.rtpMap&&et(S).call(S,ue.rtpMap.encodingName.toLowerCase())),ye=Hm(ae,O),_e=ae.concat(ye).map(ue=>ue.payloadType);O=O.filter(ue=>!et(_e).call(_e,ue.payloadType)),x.debug("unsupportedVideoDownlinkCodec: ".concat(S,", toBeRemoved: ").concat(_e))}return{audioCodecs:A,videoCodecs:O,audioExtensions:W,videoExtensions:F}}function Gm(e){const r=Ja(e);let s,o;for(const c of r.mediaDescriptions){if(!s){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:o}}function B9(e,r){const s=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const g=(m=o.find(E=>E.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?g:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:u[0].ssrcId})}return s}function z9(e,r,s){const{cname:o}=e;let c=[];r&&(c=W9(r)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const g=NP(e.rtpCapabilities),E=[];return Array.isArray(s)&&s.length>0&&s.forEach(S=>{E.push({kind:Et.VIDEO,ssrcMsg:[{ssrcId:S.v,rtx:S.v_rtx}],mslabel:"".concat(S.v,"_").concat(S.a)},{kind:Et.AUDIO,ssrcMsg:[{ssrcId:S.a}],mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:g,setup:m,cname:o,preSSRCs:E}}function W9(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(ey(e.ip),":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(ey(e.ip6),":").concat(e.port)))),r}function Qw(e,r,s){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const g=Er(8,"track-"),E={ssrcId:h,attributes:j9({label:g,mslabel:s=s||Er(10,""),msid:"".concat(s," ").concat(g)},r&&{cname:r})};if(o.push(E),m!==void 0){const S={ssrcId:m,attributes:j9({label:g,mslabel:s,msid:"".concat(s," ").concat(g)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function Qv(e,r){r instanceof oi&&e.attributes.payloads.forEach(s=>{var o;const c=(o=s.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),c==="opus"&&typeof se("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=se("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Zr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),r instanceof Gw&&c==="opus"&&r._config.DTX&&(s.fmtp.parameters.usedtx="1"))})}function u2(e){const r=e.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function d2(e,r){var s;if(!(r instanceof Or&&r._encoderConfig&&r._hints.indexOf(_r.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;Vn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;et(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Vn().supportMinBitrate&&!et(s=r._hints).call(s,_r.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;et(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(se("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function G9(e){if(e.media.mediaType!=="video")return;const r=Nn();if(r.name!==Gn.SAFARI&&r.os!==ts.IOS)return;const s=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1)}function kP(e,r,s){if(!r)return;let o,c;if(e.media.mediaType==="video"?(o=s.videoExtensions,c=s.videoCodecs):(o=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const u=o.find(h=>OP(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(g=>OP(g.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(g,E){return E.filter(S=>!!g.find(C=>C.payloadType===S.payloadType&&!!C.rtcpFeedbacks.find(A=>A.type==="transport-cc")))}(c,e.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(E=>E.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>OP(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>V9(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(g=>g.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(g,E){return E.filter(S=>!!g.find(C=>C.payloadType===S.payloadType&&!!C.rtcpFeedbacks.find(A=>A.type==="goog-remb")))}(c,e.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(E=>E.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=e.attributes.extmaps.findIndex(h=>V9(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function H9(e,r,s){if(Zr()||e.media.mediaType!=="video"||!(r instanceof Or)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!se("SIMULCAST")||s==="vp9"&&se("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Gr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Gr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function $9(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const o=(await s.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const S=Jw(E,m,g,"sendonly"),C=Jw(E,m,g,"recvonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Uu(S,C,"videoExtensions",A,O,W),Uu(S,C,"videoCodecs",A,O,W),Uu(S,C,"audioExtensions",A,O,W),Uu(S,C,"audioCodecs",A,O,W),se("RAISE_H264_BASELINE_PRIORITY")){const F=[],B=[];if(W.videoCodecs.forEach((Z,Q)=>{var ae;if(((ae=Z.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){var ye,_e;const ue=W.videoCodecs[Q+1],Ie=ue&&J9(Z,ue),Ue=(ye=Z.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],We=(_e=Z.fmtp)===null||_e===void 0?void 0:_e.parameters["packetization-mode"];!Ue||Ue!==se("FIRST_H264_PROFILE_LEVEL_ID")||se("FIRST_PACKETIZATION_MODE")&&We!==se("FIRST_PACKETIZATION_MODE")?Ie?B.push([Z,ue]):B.push([Z]):Ie?F.push([Z,ue]):F.push([Z])}}),F.length>0&&B.length>0){x.debug("raising H264 baseline profile priority"),W.videoCodecs.forEach((Q,ae)=>{var ye;if(((ye=Q.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLocaleLowerCase())==="h264"){const _e=J9(Q,W.videoCodecs[ae+1]),ue=F.shift()||B.shift()||[];ue.length>0&&(_e?W.videoCodecs.splice(ae,2,...ue):W.videoCodecs.splice(ae,1,...ue))}});const Z=O.videoCodecs.filter(Q=>{var ae,ye;return((ae=Q.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"&&((ye=Q.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==se("FIRST_H264_PROFILE_LEVEL_ID")});if(Z.length>0){const Q=Hm(Z,O.videoCodecs).map(ye=>ye.payloadType),ae=[...Z.map(ye=>ye.payloadType),...Q];O.videoCodecs=O.videoCodecs.filter(ye=>!et(ae).call(ae,ye.payloadType))}se("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(Q=>{var ae,ye;return!(((ae=Q.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"&&((ye=Q.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==se("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:A,recv:O,sendrecv:W}}return{send:A,recv:O,sendrecv:W}}(e,r,o);try{s.close()}catch{}return{send:c,recv:u,sendrecv:h}}function K9(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=Jw(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Uu(e,r,"videoExtensions",s,o,c),Uu(e,r,"videoCodecs",s,o,c),Uu(e,r,"audioExtensions",s,o,c),Uu(e,r,"audioCodecs",s,o,c),se("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:o,sendrecv:c}}function Uu(e,r,s,o,c,u){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return e[s].forEach(m=>{r[s].some((g,E)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(E),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return e[s].forEach(m=>{r[s].some((g,E)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(E),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)})}}function NP(e){const{send:r,recv:s,sendrecv:o}=e;if(!o){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,s?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...s.audioCodecs,...o.audioCodecs],u.videoCodecs=[...s.videoCodecs,...o.videoCodecs],u.audioExtensions=[...s.audioExtensions,...o.audioExtensions],u.videoExtensions=[...s.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function Zv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function Zw(e,r,s,o){let c=[];if(e===Et.VIDEO){if(se("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return et(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===se("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],g=[];if(s.videoCodecs.forEach(E=>{const S=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";et(S).call(S,o)?u.push(E):et(S).call(S,"vp9")?h.push(E):et(S).call(S,"vp8")?m.push(E):et(S).call(S,"h264")&&g.push(E)}),u.length===0){let E="";h.length!==0?(u=h,E="vp9"):m.length!==0?(u=m,E="vp8"):g.length!==0&&(u=g,E="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}u.length!==0&&(c=r.videoCodecs.filter(E=>u.some(S=>S.payloadType===E.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),se("USE_PUB_RTX")||se("USE_SUB_RTX")){const u=Hm(c,r.videoCodecs);c=[...c,...u]}}else{c=r.audioCodecs.filter(h=>{var m;return et(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,o)});const u=r.audioCodecs.filter(h=>{var m;return et(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"red")});c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(h=>{var m;return et(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")})),se("ENABLE_AUDIO_RED")&&u.length!==0&&(c=[...u,...c])}return c}function Hm(e,r){const s=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&et(s).call(s,o.fmtp&&o.fmtp.parameters.apt))}async function $m(e,r,s){const o=r.toString(),c=Y9(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=q9(h,s||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function q9(e,r,s){const o=Ja(e),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(s)&&!et(s).call(s,u.attributes.mid)||(u.media.mediaType==="audio"&&Zv(u),c&&et(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Vm(o)}function Y9(e,r,s,o){if(se("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?c=>{Y9(c,"answer",s==="local"?"remote":"local",o)}:void 0}function X9(e){const r=se("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>et(e).call(e,s))}function J9(e,r){try{var s;return((s=e.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function Q9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function sl(e,r){return typeof se(e)===r?se(e):void 0}function _ge(){try{const e=se("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?Q9(Object(o),!0).forEach(function(c){q(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):Q9(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e)}catch(e){return x.debug("handle gateway attributes failed: ",e),{}}}const Z9={};function Km(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(e.name)),Z9[e.name]=e}function df(e){const r=Z9[e];if(!r)throw new Le(ee.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function eH(e,r){return df("DataStream").create(e,r)}function DP(){return df("InterceptFrame").create()}function tH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function yo(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?tH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):tH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const h2=new Map;class yge extends Xr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(us.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(us.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var o,c,u;super(),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"key",void 0),q(this,"ntpOffset",0),q(this,"signal",void 0),q(this,"role",void 0),q(this,"isPreallocation",void 0),q(this,"isPreSub",void 0),q(this,"inChannelInfo",{joinAt:null,duration:0}),q(this,"spec",void 0),q(this,"_state","DISCONNECTED"),q(this,"_statsCollector",void 0),q(this,"_disconnectedReason",void 0),q(this,"isSignalRecover",!1),q(this,"hasChangeBGPAddress",!1),q(this,"trafficStatsInterval",void 0),q(this,"networkQualityInterval",void 0),q(this,"_joinGatewayStartTime",0),q(this,"_signalTimeout",!1),q(this,"_clientRoleOptions",void 0),q(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(o={spec:yo(yo({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(u=df("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new mge(yo(yo({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=h2.get(r.cname);if(u||(u=new Map,h2.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const E=new ke(ee.UID_CONFLICT);throw At.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}u.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map(S=>{let{address:C}=S;const[A,O]=C.split(":"),W={host:A,port:O};return r.proxyServer&&(W.proxy=r.proxyServer),W});h=(await this.signal.init(E)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var g;throw x.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),At.joinGateway(r.sid,{lts:c,succ:!1,ec:((g=E.data)===null||g===void 0?void 0:g.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(us.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(us.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(us.NETWORK_QUALITY,{uplinkNetworkQuality:L9(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:L9(this._statsCollector.trafficStats.B_dnq)}):this.emit(us.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==nr.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Rr.CONNECTED||await function(o,c){return c===1/0?o:gt.race([o,Wfe(c)])}(this.signal.request(Yt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(s),s!==nr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:se("PUB_EXTEND"),twcc:!!se("PUBLISH_TWCC"),rtx:!!se("USE_PUB_RTX")};try{return(await this.signal.request(Yt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw u}}async publishDataChannel(r,s,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Yt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Yt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await gt.all(r.map(s=>this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!se("SUBSCRIBE_TWCC"),rtx:!!se("USE_SUB_RTX")||void 0,extend:se("SUB_EXTEND"),svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return await this.signal.request(Yt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,s,!1);throw u}}async subscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!se("SUBSCRIBE_TWCC"),rtx:!!se("USE_SUB_RTX"),extend:se("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return(await this.signal.request(Yt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw u}}async subscribeDataChannel(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Yt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw u}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!se("USE_SUB_RTX"),twcc:!!se("SUBSCRIBE_TWCC"),svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return await this.signal.request(Yt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(s&&c.data&&c.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(s)return this.signal.request(Yt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await gt.all(r.map(o=>this.signal.request(Yt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:s},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Yt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Yt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Yt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),se("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(se("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},se("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),se("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},se("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(se("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const u=Object.assign({},s);delete u.delay,delete u.level,await this.signal.request(Yt.SET_CLIENT_ROLE,yo(yo({role:r,level:c,delay:o},u),{},{client_ts:Date.now()})),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Yt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Yt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Yt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Yt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Yt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),yo({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Yt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=h2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let o;return o=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Vs.username,password:Vs.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(yo(yo({},Vs),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Yt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);o&&o.B_st!==s.B_st&&QA(()=>{this.emit(us.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var s,o;if(!this.joinInfo||!this.key)throw new ke(ee.UNEXPECTED_ERROR,"can not generate join message, no join info");const c=Object.assign({},this.joinInfo.apResponse);let u=se("REPORT_APP_SCENARIO");if(typeof u!="string")try{u=JSON.stringify(u)}catch{u=void 0}var h;u&&u.length>128&&(u=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(us.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,et($v).call($v,h)||$v.push(h);const m=IL(this.store),g=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),E=iW(this.store),S=_ge(),C=Iv(87)||pz()||tL(117),A=(function(){const W=Nn();if(W.name!==Gn.SAFARI||!W.browserVersion)return!1;const F=W.browserVersion.split(".");return Number(F[0])>18||Number(F[0])===18&&Number(F[1])>=4}()||_z(18,4,!1))&&nL(18,6,!0)&&this.spec.codec==="h264"&&se("ENABLE_ABSSENDTIME_AS_SENTTS"),O=yo({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Vl,browser:navigator.userAgent,process_id:se("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:se("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:u,attributes:{userAttributes:yo(yo({enableEncodedTransform:(!!se("ENABLE_AUDIO_METADATA")||!!se("ENABLE_AUDIO_PTS"))&&C||!!se("ENABLE_AUDIO_TOPN")&&Zx(Gn.CHROME,87,116)||void 0,enableAudioMetadata:!!se("ENABLE_AUDIO_METADATA")&&C,enableAudioPts:!!se("ENABLE_AUDIO_PTS")&&C,topnSmoothLevel:se("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:se("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:se("TOPN_SWITCH_HOLD_MS"),topnAudioGain:se("TOPN_AUDIO_GAIN"),enablePublishedUserList:se("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:se("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:sl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:sl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:sl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:se("USE_PUB_RTX")===!0||se("USE_SUB_RTX")===!0||void 0,disableFEC:se("DISABLE_FEC"),enableNTPReport:!!se("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:E,enableFulllinkAvSync:!!se("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:sl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!se("FORCE_ENABLE_AUT_CC")||!sP()&&(!!se("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!se("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:sl("USE_XR","boolean"),enableLossbasedBwe:sl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!se("FORCE_ENABLE_AUT_CC")||!sP()&&(!!se("ENABLE_AUT_CC")||void 0),enableCCFallback:sl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:m?sl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:sl("PUBLISH_TWCC","boolean"),enableSubTWCC:sl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:sl("USE_PUB_RTX","boolean"),enableSubRTX:sl("USE_SUB_RTX","boolean"),enableSubSVC:se("ENABLE_SVC")?se("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0,enableSvcExtended:se("ENABLE_SVC")&&Array.isArray(se("SVC_EXTENDED"))&&se("SVC_EXTENDED").length!==0?se("SVC_EXTENDED"):void 0},S),{},{audioDuplicate:sl("ENABLE_AUDIO_RED","boolean")?(o=sl("AUDIO_DUPLICATE_NUM","number"))!==null&&o!==void 0?o:2:void 0,senttsUsesAbsSendTime:!!A||void 0})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(O.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(O.aes_mode=this.joinInfo.aesmode,se("ENCRYPT_AES")?(O.aes_secret=this.joinInfo.aespassword,O.aes_encrypt=!0):O.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(O.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(O.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(O.default_video_stream=this.joinInfo.defaultVideoStream),O}getRejoinMessage(){if(!this.joinInfo)throw new ke(ee.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Qt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Qt.WS_RECONNECTING,r=>{this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Ms.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",At.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Qt.WS_CLOSED,r=>{let s;switch(r){case nr.LEAVE:s=Ms.LEAVE;break;case nr.UID_BANNED:case nr.IP_BANNED:case nr.CHANNEL_BANNED:case nr.SERVER_ERROR:s=Ms.SERVER_ERROR;break;case nr.FALLBACK:s=Ms.FALLBACK;break;case nr.LICENSE_MISSING:case nr.LICENSE_EXPIRED:case nr.LICENSE_MINUTES_EXCEEDED:case nr.LICENSE_PERIOD_INVALID:case nr.LICENSE_MULTIPLE_SDK_SERVICE:case nr.LICENSE_ILLEGAL:case nr.TOKEN_EXPIRE:s=r;break;default:s=Ms.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Ms.NETWORK_ERROR)),this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===nr.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==nr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Qt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=se("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));hr("EVENT_REPORT_DOMAIN",r[1]),hr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),hr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(Rn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Qt.REQUEST_RECOVER,(r,s,o)=>{if(!this.joinInfo)return o(new ke(ee.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Us(this,us.REQUEST_NEW_GATEWAY_LIST).then(s).catch(o)}),this.signal.on(Qt.REQUEST_JOIN_INFO,async(r,s,o)=>{var c,u,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const m=Gr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(se("NEW_TURN_MODE")&&m&&((u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer)==="disabled"){var g;let A=m.servers.map(F=>"turnServerURL"in F&&se("USE_TURN_IP")?yo(yo({},F),{},{turnServerURL:IP(F.turnServerURL)}):F),O=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map(F=>se("USE_TURN_IP")?yo(yo({},F),{},{turnServerURL:IP(F.turnServerURL)}):F);const W=this.signal.currentURLIndex;A.length>0&&(A=[A[W%A.length]],m.servers=A),Array.isArray(O)&&O.length>0&&(O=[O[0]],m.serversFromGateway=O),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(W))}const{iceParameters:E,dtlsParameters:S,rtpCapabilities:C}=await Us(this,us.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:E,dtlsParameters:S,rtpCapabilities:C,version:"2"}}))}catch(A){s(A)}}),this.signal.on(Qt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Qt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof ke?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Qt.IS_P2P_DISCONNECTED,r=>{r(Uw(this,us.IS_P2P_DISCONNECTED))}),this.signal.on(Qt.DISCONNECT_P2P,()=>{this.emit(us.DISCONNECT_P2P)}),this.signal.on(Qt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Qt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Qt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(us.JOIN_RESPONSE,r,s)}),this.signal.on(Qt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var r,s;this.updateTurnConfigFromSignal();const c=this.getCurrentGatewayAddress(),u=Gr((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(se("NEW_TURN_MODE")&&u&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var o;let m=u.servers.map(S=>"turnServerURL"in S&&se("USE_TURN_IP")?yo(yo({},S),{},{turnServerURL:IP(S.turnServerURL)}):S),g=(o=u.serversFromGateway)===null||o===void 0?void 0:o.map(S=>se("USE_TURN_IP")?yo(yo({},S),{},{turnServerURL:IP(S.turnServerURL)}):S);const E=this.signal.currentURLIndex;m.length>0&&(m=[m[E%m.length]],u.servers=m),Array.isArray(g)&&g.length>0&&(g=[g[0]],u.serversFromGateway=g),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(E,",in pre pc"))}const h=se("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){const m=W9(c);this.emit(us.PRE_CONNECT_PC,{candidates:m,fingerprint:h,turnServer:u})}}}),this.signal.on(Qt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof se("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(se("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Yt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const s={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,s){const o={action:r.find(c=>c.stream_type===or.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Yt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const o={action:r.find(c=>c.stream_type===or.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Yt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const o={action:r===Et.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Yt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const o={action:r===Et.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Yt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Yt.RESTART_ICE,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Ms.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!se("GATEWAY_WSS_ADDRESS"))return se("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Yt.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}}let xP=0,p2=0;function jd(e,r,s,o){return new gt((c,u)=>{r.timeout=r.timeout||se("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),xP+=Hh(r.data)):s&&(r.data.size?xP+=r.data.size:r.data instanceof FormData?xP+=Dz(r.data):xP+=Hh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Ca.request(r).then(h=>{typeof h.data=="string"?p2+=Hh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?p2+=h.data.byteLength:p2+=Hh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Ca.isCancel(h)?u(new ke(ee.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new ke(ee.NETWORK_TIMEOUT,h.message)):h.response?u(new ke(ee.NETWORK_RESPONSE_ERROR,h.response.status)):u(new ke(ee.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(ze){var nt=0;return function(){return nt<ze.length?{done:!1,value:ze[nt++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(ze,nt,St){return ze==Array.prototype||ze==Object.prototype||(ze[nt]=St.value),ze},o,c=function(ze){ze=[typeof globalThis=="object"&&globalThis,ze,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var nt=0;nt<ze.length;++nt){var St=ze[nt];if(St&&St.Math==Math)return St}throw Error("Cannot find global object")}(this);function u(ze,nt){if(nt)e:{var St=c;ze=ze.split(".");for(var He=0;He<ze.length-1;He++){var U=ze[He];if(!(U in St))break e;St=St[U]}(nt=nt(He=St[ze=ze[ze.length-1]]))!=He&&nt!=null&&s(St,ze,{configurable:!0,writable:!0,value:nt})}}function h(ze){return(ze={next:ze})[Symbol.iterator]=function(){return this},ze}function m(ze){var nt=typeof Symbol<"u"&&Symbol.iterator&&ze[Symbol.iterator];return nt?nt.call(ze):{next:r(ze)}}if(u("Symbol",function(ze){function nt(U,le){this.A=U,s(this,"description",{configurable:!0,writable:!0,value:le})}if(ze)return ze;nt.prototype.toString=function(){return this.A};var St="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function U(le){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new nt(St+(le||"")+"_"+He++,le)}}),u("Symbol.iterator",function(ze){if(ze)return ze;ze=Symbol("Symbol.iterator");for(var nt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),St=0;St<nt.length;St++){var He=c[nt[St]];typeof He=="function"&&typeof He.prototype[ze]!="function"&&s(He.prototype,ze,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return ze}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var g;e:{var E={};try{E.__proto__={a:!0},g=E.a;break e}catch{}g=!1}o=g?function(ze,nt){if(ze.__proto__=nt,ze.__proto__!==nt)throw new TypeError(ze+" is not extensible");return ze}:null}var S=o;function C(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function A(ze){if(ze.m)throw new TypeError("Generator is already running");ze.m=!0}function O(ze,nt){return ze.h=3,{value:nt}}function W(ze){this.g=new C,this.G=ze}function F(ze,nt,St,He){try{var U=nt.call(ze.g.j,St);if(!(U instanceof Object))throw new TypeError("Iterator result "+U+" is not an object");if(!U.done)return ze.g.m=!1,U;var le=U.value}catch(me){return ze.g.j=null,ze.g.s(me),B(ze)}return ze.g.j=null,He.call(ze.g,le),B(ze)}function B(ze){for(;ze.g.h;)try{var nt=ze.G(ze.g);if(nt)return ze.g.m=!1,{value:nt.value,done:!1}}catch(St){ze.g.v=void 0,ze.g.s(St)}if(ze.g.m=!1,ze.g.l){if(nt=ze.g.l,ze.g.l=null,nt.F)throw nt.D;return{value:nt.return,done:!0}}return{value:void 0,done:!0}}function Z(ze){this.next=function(nt){return ze.o(nt)},this.throw=function(nt){return ze.s(nt)},this.return=function(nt){return function(St,He){A(St.g);var U=St.g.j;return U?F(St,"return"in U?U.return:function(le){return{value:le,done:!0}},He,St.g.return):(St.g.return(He),B(St))}(ze,nt)},this[Symbol.iterator]=function(){return this}}function Q(ze,nt){return nt=new Z(new W(nt)),S&&ze.prototype&&S(nt,ze.prototype),nt}if(C.prototype.o=function(ze){this.v=ze},C.prototype.s=function(ze){this.l={D:ze,F:!0},this.h=this.C||this.u},C.prototype.return=function(ze){this.l={return:ze},this.h=this.u},W.prototype.o=function(ze){return A(this.g),this.g.j?F(this,this.g.j.next,ze,this.g.o):(this.g.o(ze),B(this))},W.prototype.s=function(ze){return A(this.g),this.g.j?F(this,this.g.j.throw,ze,this.g.o):(this.g.s(ze),B(this))},u("Array.prototype.entries",function(ze){return ze||function(){return function(nt,St){nt instanceof String&&(nt+="");var He=0,U=!1,le={next:function(){if(!U&&He<nt.length){var me=He++;return{value:St(me,nt[me]),done:!1}}return U=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}(this,function(nt,St){return[nt,St]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ae=function(ze,nt){for(var St=0;St<ze.length;St++)nt(ze[St])},ye=function(ze){return ze.replace(/\r?\n|\r/g,`\r
`)},_e=function(ze,nt,St){return nt instanceof Blob?(St=St!==void 0?St+"":typeof nt.name=="string"?nt.name:"blob",nt.name===St&&Object.prototype.toString.call(nt)!=="[object Blob]"||(nt=new File([nt],St)),[String(ze),nt]):[String(ze),String(nt)]},ue=function(ze,nt){if(ze.length<nt)throw new TypeError(nt+" argument required, but only "+ze.length+" present.")},Ie=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ue=Ie.FormData,We=Ie.XMLHttpRequest&&Ie.XMLHttpRequest.prototype.send,Je=Ie.Request&&Ie.fetch,pn=Ie.navigator&&Ie.navigator.sendBeacon,En=Ie.Element&&Ie.Element.prototype,Jt=Ie.Symbol&&Symbol.toStringTag;Jt&&(Blob.prototype[Jt]||(Blob.prototype[Jt]="Blob"),"File"in Ie&&!File.prototype[Jt]&&(File.prototype[Jt]="File"));try{new File([],"")}catch{Ie.File=function(nt,St,He){return nt=new Blob(nt,He||{}),Object.defineProperties(nt,{name:{value:St},lastModified:{value:+(He&&He.lastModified!==void 0?new Date(He.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Jt&&Object.defineProperty(nt,Jt,{value:"File"}),nt}}var tr=function(ze){return ze.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},qn=function(ze){this.i=[];var nt=this;ze&&ae(ze.elements,function(St){if(St.name&&!St.disabled&&St.type!=="submit"&&St.type!=="button"&&!St.matches("form fieldset[disabled] *"))if(St.type==="file"){var He=St.files&&St.files.length?St.files:[new File([],"",{type:"application/octet-stream"})];ae(He,function(U){nt.append(St.name,U)})}else St.type==="select-multiple"||St.type==="select-one"?ae(St.options,function(U){!U.disabled&&U.selected&&nt.append(St.name,U.value)}):St.type==="checkbox"||St.type==="radio"?St.checked&&nt.append(St.name,St.value):(He=St.type==="textarea"?ye(St.value):St.value,nt.append(St.name,He))})};if((e=qn.prototype).append=function(ze,nt,St){ue(arguments,2),this.i.push(_e(ze,nt,St))},e.delete=function(ze){ue(arguments,1);var nt=[];ze=String(ze),ae(this.i,function(St){St[0]!==ze&&nt.push(St)}),this.i=nt},e.entries=function ze(){var nt,St=this;return Q(ze,function(He){if(He.h==1&&(nt=0),He.h!=3)return nt<St.i.length?He=O(He,St.i[nt]):(He.h=0,He=void 0),He;nt++,He.h=2})},e.forEach=function(ze,nt){ue(arguments,1);for(var St=m(this),He=St.next();!He.done;He=St.next()){var U=m(He.value);He=U.next().value,U=U.next().value,ze.call(nt,U,He,this)}},e.get=function(ze){ue(arguments,1);var nt=this.i;ze=String(ze);for(var St=0;St<nt.length;St++)if(nt[St][0]===ze)return nt[St][1];return null},e.getAll=function(ze){ue(arguments,1);var nt=[];return ze=String(ze),ae(this.i,function(St){St[0]===ze&&nt.push(St[1])}),nt},e.has=function(ze){ue(arguments,1),ze=String(ze);for(var nt=0;nt<this.i.length;nt++)if(this.i[nt][0]===ze)return!0;return!1},e.keys=function ze(){var nt,St,He,U,le=this;return Q(ze,function(me){if(me.h==1&&(nt=m(le),St=nt.next()),me.h!=3)return St.done?void(me.h=0):(He=St.value,U=m(He),O(me,U.next().value));St=nt.next(),me.h=2})},e.set=function(ze,nt,St){ue(arguments,2),ze=String(ze);var He=[],U=_e(ze,nt,St),le=!0;ae(this.i,function(me){me[0]===ze?le&&(le=!He.push(U)):He.push(me)}),le&&He.push(U),this.i=He},e.values=function ze(){var nt,St,He,U,le=this;return Q(ze,function(me){if(me.h==1&&(nt=m(le),St=nt.next()),me.h!=3)return St.done?void(me.h=0):(He=St.value,(U=m(He)).next(),O(me,U.next().value));St=nt.next(),me.h=2})},qn.prototype._asNative=function(){for(var ze=new Ue,nt=m(this),St=nt.next();!St.done;St=nt.next()){var He=m(St.value);St=He.next().value,He=He.next().value,ze.append(St,He)}return ze},qn.prototype._blob=function(){var ze="----formdata-polyfill-"+Math.random(),nt=[],St="--"+ze+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(He,U){return typeof He=="string"?nt.push(St+tr(ye(U))+`"\r
\r
`+ye(He)+`\r
`):nt.push(St+tr(ye(U))+'"; filename="'+tr(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)}),nt.push("--"+ze+"--"),new Blob(nt,{type:"multipart/form-data; boundary="+ze})},qn.prototype[Symbol.iterator]=function(){return this.entries()},qn.prototype.toString=function(){return"[object FormData]"},En&&!En.matches&&(En.matches=En.matchesSelector||En.mozMatchesSelector||En.msMatchesSelector||En.oMatchesSelector||En.webkitMatchesSelector||function(ze){for(var nt=(ze=(this.document||this.ownerDocument).querySelectorAll(ze)).length;0<=--nt&&ze.item(nt)!==this;);return-1<nt}),Jt&&(qn.prototype[Jt]="FormData"),We){var io=Ie.XMLHttpRequest.prototype.setRequestHeader;Ie.XMLHttpRequest.prototype.setRequestHeader=function(ze,nt){io.call(this,ze,nt),ze.toLowerCase()==="content-type"&&(this.B=!0)},Ie.XMLHttpRequest.prototype.send=function(ze){ze instanceof qn?(ze=ze._blob(),this.B||this.setRequestHeader("Content-Type",ze.type),We.call(this,ze)):We.call(this,ze)}}Je&&(Ie.fetch=function(ze,nt){return nt&&nt.body&&nt.body instanceof qn&&(nt.body=nt.body._blob()),Je.call(this,ze,nt)}),pn&&(Ie.navigator.sendBeacon=function(ze,nt){return nt instanceof qn&&(nt=nt._asNative()),pn.call(this,ze,nt)}),Ie.FormData=qn}})();const eT=()=>{const e=se("AREAS");return e.length===0&&e.push(Xn.GLOBAL),Ha(e).call(e,(r,s,o)=>{const c=nH(s);return c?o===0?c:"".concat(r,",").concat(c):r},"")},nH=e=>e===Xn.OVERSEA?"".concat(to.ASIA,",").concat(to.EUROPE,",").concat(to.AFRICA,",").concat(to.NORTH_AMERICA,",").concat(to.SOUTH_AMERICA,",").concat(to.OCEANIA):to[e],Ege=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(s=>{const o=RP[s],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},LP={GLOBAL:{ASIA:[Xn.CHINA,Xn.JAPAN,Xn.INDIA,Xn.KOREA,Xn.HKMC],EUROPE:[],NORTH_AMERICA:[Xn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},MP=Object.keys(LP[Xn.GLOBAL]),f2=[Xn.CHINA,Xn.NORTH_AMERICA,Xn.EUROPE,Xn.ASIA,Xn.JAPAN,Xn.INDIA,Xn.OCEANIA,Xn.SOUTH_AMERICA,Xn.AFRICA,Xn.KOREA,Xn.HKMC,Xn.US],vge=function(e,r){let s=[];if(et(e).call(e,Xn.GLOBAL)){const u=[Xn.GLOBAL,Xn.OVERSEA],h=Object.keys(RP);if(r===Xn.GLOBAL)throw new ke(ee.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Xn.CHINA)s=[Xn.OVERSEA];else if(c=r,et(MP).call(MP,c)){const m=(o=r,LP[Xn.GLOBAL][o]||[]),g=[...u,r,...m];s=h.filter(E=>!et(g).call(g,E))}else if(function(m){let g=!1;return MP.forEach(E=>{var S;et(S=LP[Xn.GLOBAL][E]).call(S,m)&&(g=!0)}),g}(r)){const m=function(E){let S;return MP.forEach(C=>{var A;et(A=LP[Xn.GLOBAL][C]).call(A,E)&&(S=C)}),S}(r),g=[...u,m,r];s=h.filter(E=>!et(g).call(g,E))}else s=e;s=function(m){const g=[];return f2.forEach(E=>{et(m).call(m,E)&&g.push(E)}),g.concat(m.filter(E=>!et(f2).call(f2,E)))}(s)}else s=e;var o,c;return s};function rH(e){var r,s;if(!e&&et(r=se("AREAS")).call(r,Xn.EXTENSIONS))return x.debug("update area from ap : reset"),void m2(Ame,!0);if(!et(s=se("AREAS")).call(s,Xn.GLOBAL)||!e)return;let o=RP.EXTENSIONS;o&&(o={CODE:nH(Xn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},x.debug("update area from ap success: ".concat(e,",config is "),o),hr("AREAS",[Xn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?hr(c,o[c][0]):hr(c,o[c])}))}function m2(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=At.reportApiInvoke(null,{name:li.SET_AREA,options:e,tag:Wr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!et(T9).call(T9,u))throw new ke(ee.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new ke(ee.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?vge(m,h):m}if(!r){if(Md.AREAS){const u=new ke(ee.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(et(o).call(o,Xn.GLOBAL)&&se("AREAS")===Xn.EXTENSIONS){const u=new ke(ee.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}hr("AREAS",o,r);const c=Ege(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?hr(u,c[u][0]):hr(u,c[u])}),x.debug("set area success:",o.join(","))}catch(o){throw s.onError(o),o}s.onSuccess()}function iH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Jh(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?iH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):iH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let g2=1;function Sge(e,r,s,o,c){g2+=1;const u={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:g2,requestId:g2,version:Vl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,g,E=e[0];return Ld(async()=>{m=Date.now();const S=await jd(E,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,S.code!==0){const O=new ke(ee.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:g});throw x.error(O.toString()),O}const C=JSON.parse(S.json_body);if(C.code!==200){const O=new ke(ee.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(C.code,", reason: ").concat(C.reason),{code:C.code,responseTime:g});throw x.error(O.toString()),O}if(!C.servers||C.servers.length===0){const O=new ke(ee.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:C.code,responseTime:g});throw x.error(O.toString()),O}const A=function(O,W){return{addressList:O.servers.map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(se("WORKER_DOMAIN"),":").concat(F.wss,"?serviceName=").concat(encodeURIComponent(W))),workerToken:O.workerToken,vid:O.vid}}(C,r);return se("LIVE_STREAMING_ADDRESS")&&(A.addressList=se("LIVE_STREAMING_ADDRESS")instanceof Array?se("LIVE_STREAMING_ADDRESS"):[se("LIVE_STREAMING_ADDRESS")]),Jh(Jh({},A),{},{responseTime:g})},(S,C)=>(At.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:C===0,responseTime:g,serverIp:e[C%e.length]}),!1),(S,C)=>(At.apworkerEvent(s.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:g,serverIp:e[C%e.length]}),!!(S.code!==ee.OPERATION_ABORTED&&S.code!==ee.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(E=e[(C+1)%e.length],!0)),c)}let _2=1;function sH(e,r,s,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=r,g=Date.now();let E;const S=r.role,[C,A]=E2(r,u,[wi.CHOOSE_SERVER]);let O=bi.networkState;return Ld(async()=>{O&&bi.networkState===Cc.OFFLINE&&bi.onlineWaiter&&await gt.race([bi.onlineWaiter,vs(o&&o.maxRetryTimeout||Di.maxRetryTimeout)]),O=bi.networkState;const{data:W,headers:F}=await jd(c,{data:C,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=F.http3==="1"?1:-1,At.reportResourceTiming(c,m),aH(W,c,r,g,[wi.CHOOSE_SERVER],E);const B=Xw(W,wi.CHOOSE_SERVER);return y2(B),c2(B,c)},W=>(W&&At.joinChooseServer(m,{role:S,lts:g,succ:!0,csAddr:c,opid:A,serverList:W.gatewayAddrs.map(F=>F.address),ec:null,cid:W.cid.toString(),uid:W.uid.toString(),csIp:W.csIp,unilbsServerIds:[wi.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:W.res.detail&&W.res.detail[38]}),!1),W=>W.code!==ee.OPERATION_ABORTED&&(W.code===ee.CAN_NOT_GET_GATEWAY_SERVER?W.data.retry:(At.joinChooseServer(m,{role:S,lts:g,succ:!1,csAddr:c,serverList:null,opid:A,ec:W.code,csIp:W.data&&W.data.csIp,unilbsServerIds:[wi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:O}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),W),!0)),o)}function oH(e,r,s,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const g=Date.now(),E=r.role,[S,C]=E2(r,h,m);let A;return Ld(async()=>{A&&bi.networkState===Cc.OFFLINE&&bi.onlineWaiter&&await gt.race([bi.onlineWaiter,vs(o&&o.maxRetryTimeout||Di.maxRetryTimeout)]),A=bi.networkState;const{data:O,headers:W}=await jd(u,{data:S,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=W.http3==="1"?1:-1,At.reportResourceTiming(u,r.sid),aH(O,u,r,g,m,c);const F=Xw(O,wi.CHOOSE_SERVER),B=Xw(O,r.cloudProxyServer==="proxy5"?wi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?wi.CLOUD_PROXY:wi.CLOUD_PROXY_FALLBACK),Z=performance.getEntriesByName(u),Q=Z[Z.length-1];let ae;return Q&&(ae={name:Q.name,protocol:"nextHopProtocol"in Q?Q.nextHopProtocol:"",dnscost:"domainLookupEnd"in Q&&"domainLookupStart"in Q&&typeof Q.domainLookupEnd=="number"&&typeof Q.domainLookupStart=="number"?Q.domainLookupEnd-Q.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Q&&"connectStart"in Q&&typeof Q.connectEnd=="number"&&typeof Q.connectStart=="number"?Q.connectEnd-Q.connectStart:-1,reqCost:"requestStart"in Q&&typeof Q.requestStart=="number"&&"responseEnd"in Q&&typeof Q.responseEnd=="number"?Q.responseEnd-Q.requestStart:-1,handleCost:"leave_ts"in O&&"enter_ts"in O&&typeof O.leave_ts=="number"&&typeof O.enter_ts=="number"?O.leave_ts-O.enter_ts:-1}),y2(F),{gatewayInfo:c2(F,u),proxyInfo:B,url:u,resourceTimingInfo:ae}},O=>(O.gatewayInfo&&At.joinChooseServer(r.sid,{role:E,lts:g,succ:!0,csAddr:u,serverList:O.gatewayInfo.gatewayAddrs.map(W=>W.address),ec:null,opid:C,cid:O.gatewayInfo.cid.toString(),uid:O.gatewayInfo.uid.toString(),csIp:O.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:O.gatewayInfo.res.detail&&O.gatewayInfo.res.detail[38],resourceTimingInfo:O.resourceTimingInfo?JSON.stringify(O.resourceTimingInfo):void 0}),O.proxyInfo&&At.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:u,turnServerAddrList:O.proxyInfo.addresses.map(W=>W.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),O=>O.code!==ee.OPERATION_ABORTED&&(O.code===ee.CAN_NOT_GET_GATEWAY_SERVER?O.data.retry:(At.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:O.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:A})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),O),!0)),o)}const aH=(e,r,s,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:g}=s,E=[],S=C=>{C.flag===4096?At.joinChooseServer(h,{role:s.role,lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:C.error.message,csIp:C.error.data&&C.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:s.apRequestDetail}):C.flag!==1048576&&C.flag!==4194304&&C.flag!==4194310||At.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:C.error.code,eventType:g,unilbsServerIds:c.toString()})};if(e.response_body.forEach(C=>{const A=C.buffer.code;if(C.uri===23&&A===0&&!C.buffer.edges_services)if(C.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),C.buffer.edges_services=[];else{const O={error:new ke(ee.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:C.buffer.flag};E.push(O),S(O)}if(A!==0){const O=Xv(A),W={error:new ke(ee.CAN_NOT_GET_GATEWAY_SERVER,O.desc,{desc:O.desc,retry:O.retry,csIp:e.detail[502]}),flag:C.buffer.flag};C.buffer.flag===4194310?x.warning(W.error.toString()):E.push(W),S(W)}}),E.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map(C=>"flag: ".concat(C.flag,", message: ").concat(C.error.message,", retry: ").concat(C.error.data.retry)).join(" | "))),new ke(ee.CAN_NOT_GET_GATEWAY_SERVER,E.map(C=>"flag: ".concat(C.flag,", message: ").concat(C.error.message)).join(" | "),{retry:!!E.find(C=>C.error.data.retry),csIp:e.detail[502],desc:[...new Set(E.map(C=>{var A;return C==null||(A=C.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc}).filter(C=>!!C))]})},y2=e=>{var r,s,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ke(ee.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(se("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?rH(e.detail[23].toLowerCase()):rH()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((s=e.detail)===null||s===void 0?void 0:s[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let g=0;g<m.length;g++){var u;const E=No(u=m[g]).call(u);e.addresses[g]&&m&&(e.addresses[g].fingerprint=E)}}if(se("GATEWAY_ADDRESS")&&se("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",se("GATEWAY_ADDRESS"));const h=se("GATEWAY_ADDRESS").map(m=>{var g,E;const S=(g=(E=e.addresses.find(C=>C.ip===m.ip&&C.port===m.port))===null||E===void 0?void 0:E.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},bge=(e,r)=>{if(e.response_body&&e.response_body.length){const s=e.response_body[0];if(s.buffer.code!==0){const o=Xv(s.buffer.code);throw new ke(ee.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new ke(ee.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},E2=(e,r,s)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Jh(Jh(Jh({6:e.stringUid,11:r,12:se("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:s,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},wge=(e,r)=>{const s=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,s]};let eS=0;function tS(e){return gt.all(e.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const tT=async e=>{let{fragementLength:r,referenceList:s,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=r;let g,E=0;const S=async()=>{const C=(()=>{const A=h*m,O=A+m;return s.slice(A,O).map(o)})();u&&u.push(...C);try{g=await tS(C)}catch(A){if(E+=m,h++,!(E>=s.length))return void await S();c(A)}C.forEach(A=>A.cancel())};return await S(),g},cH=async e=>{let{referenceList:r,asyncMapHandler:s,closeFn:o}=e;const c=r.length;let u=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(g){if(u++,u>=c||o!=null&&o(g))throw g;return h()}};return h()};async function Tge(){if(typeof VideoDecoder>"u")return!0;let e;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],o=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],u=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new gt((g,E)=>{let S;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:A=>{A.close(),clearTimeout(S),g(!0)},error:A=>{clearTimeout(S),g(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const C=[r,s,o,c,u,h];for(let A=0;A<C.length;A++){const O=new EncodedVideoChunk({type:A==0?"key":"delta",timestamp:33333*A,duration:33333,data:new Uint8Array(C[A])});try{await e.decode(O)}catch{return void g(!1)}}})(),S=setTimeout(()=>{g(!1)},5e3)})}async function v2(e,r,s,o){return{gatewayInfo:await async function(u,h,m,g){let E=null;const S=[],C=async()=>{const O=se("WEBCS_DOMAIN").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(B=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:eT()})),W=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(B=>B.url)}),F=await tT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:B=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),B.url),sH(B,u,h,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},W),B[0]},promisesCollector:S});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},W),F},A=async()=>{if(await vs(1e3),E!==null)return E;const O=se("WEBCS_DOMAIN_BACKUP_LIST").map(B=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:eT()})),W=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(B=>B.url)}),F=await tT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:B=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),B.url),sH(B,u,h,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},W),B[0]},promisesCollector:S});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},W),F};try{return E=await tS([C(),A()]),S.length&&S.forEach(O=>O.cancel&&typeof O.cancel=="function"&&O.cancel()),E}catch(O){throw O[0]}}(e,r,s,o)}}async function lH(e,r,s,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await v2(e,r,s,c);if(se("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:A,proxyInfo:O}=await hH(e,r,s,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:A};const W=O.map(F=>({turnServerURL:F.address,tcpport:F.tcpport||Vs.tcpport,udpport:F.udpport||Vs.udpport,username:F.username||Vs.username,password:F.password||Vs.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const F=(h=e.uid)!==null&&h!==void 0?h:A.uid,B="glb:".concat(F.toString()),Z=await lL(B),Q=O.map(ae=>({turnServerURL:ae.address,tcpport:ae.tcpport||Vs.tcpport,udpport:ae.udpport||Vs.udpport,username:B,password:Z,forceturn:!1,security:!0}));W.push(...Q)}return e.turnServer={mode:"manual",servers:W},{gatewayInfo:A}}return await v2(e,r,s,c)}const{proxyInfo:m,gatewayInfo:g}=await hH(e,r,s,c),E={gatewayInfo:g},S=m.map(A=>({turnServerURL:A.address,tcpport:u==="proxy3"?void 0:A.tcpport?A.tcpport:Vs.tcpport,udpport:u==="proxy4"?void 0:A.udpport?A.udpport:Vs.udpport,username:A.username||Vs.username,password:A.password||Vs.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var C;const A=(C=e.uid)!==null&&C!==void 0?C:g.uid,O="glb:".concat(A.toString()),W=await lL(O),F=m.map(B=>({turnServerURL:B.address,tcpport:u==="proxy3"?void 0:B.tcpport||Vs.tcpport,udpport:u==="proxy4"?void 0:B.udpport||Vs.udpport,username:O,password:W,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...F)}return e.turnServer={mode:"manual",servers:S},x.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),E}async function uH(e,r,s,o,c){const u=se("ACCOUNT_REGISTER").slice(0,se("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1")):u.map(g=>"https://".concat(g,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await async function(E,S,C,A,O){const W=Date.now(),F={sid:C.sid,opid:10,appid:C.appId,string_uid:S};let B=E[0];const Z=await Ld(()=>jd(B+"".concat(B.indexOf("?")===-1?"?":"&","action=stringuid"),{data:F,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Q,ae)=>{if(Q.code===0){if(Q.uid<=0||Q.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(Q.uid),Q),At.reqUserAccount(F.sid,{lts:W,success:!1,serverAddr:B,stringUid:F.string_uid,uid:Q.uid,errorCode:ee.INVALID_UINT_UID_FROM_STRING_UID,extend:F}),new ke(ee.INVALID_UINT_UID_FROM_STRING_UID);return At.reqUserAccount(F.sid,{lts:W,success:!0,serverAddr:B,stringUid:F.string_uid,uid:Q.uid,errorCode:null,extend:F}),!1}const ye=Xv(Q.code);return ye.retry&&(B=E[(ae+1)%E.length]),At.reqUserAccount(F.sid,{lts:W,success:!1,serverAddr:B,stringUid:F.string_uid,uid:Q.uid,errorCode:ye.desc,extend:F}),ye.retry},(Q,ae)=>Q.code!==ee.OPERATION_ABORTED&&(At.reqUserAccount(F.sid,{lts:W,success:!1,serverAddr:B,stringUid:F.string_uid,uid:null,errorCode:Q.code,extend:F}),B=E[(ae+1)%E.length],!0),O);if(Z.code!==0){const Q=Xv(Z.code);throw new ke(ee.UNEXPECTED_RESPONSE,Q.desc)}return Z}(h,e,r,s,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function Rge(e,r,s){const o=se("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await cH({referenceList:c,asyncMapHandler:h=>async function(m,g,E,S){const C=Date.now(),A={sid:E.sid,opid:10,appid:E.appId,string_uid:g};try{const O=await jd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(O.code!==0){const W=Xv(O.code);throw new ke(ee.UNEXPECTED_RESPONSE,"preload sua error:".concat(W.desc),W)}if(O.uid<=0||O.uid>=Math.pow(2,32))throw new ke(ee.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:C,url:m,req:A,uid:O.uid,elapse:Date.now()-C}}catch(O){throw O}}(h,e,r,s),closeFn:h=>h.code===ee.OPERATION_ABORTED||h.code===ee.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Cge(e,r,s){const o=se("CDS_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=o.map(g=>function(E,S,C,A){const O=Nn(),W={flag:64,cipher_method:0,features:Jh(Jh(Jh(Jh(Jh({install_id:vL(),device:O.name,system:O.os,system_general:navigator.userAgent,vendor:S.appId,version:Vl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:gge.WEB_RTC,browser_name:O.name,browser_version:O.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),O.os&&{os_name:O.os}),O.osVersion&&{os_version:O.osVersion}),{},{detail:""})};return Ld(()=>jd(E,{data:W,timeout:1e3,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,F=>F.code!==ee.OPERATION_ABORTED,A)}(g,e,r,s));let u=null,h=null,m={};try{u=await tS(c)}catch(g){if(g.code===ee.OPERATION_ABORTED)throw g;h=g}if(c.forEach(g=>g.cancel()),At.reportApiInvoke(e.sid,{name:li.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(g){if(!g.test_tags)return{};const E=g.test_tags,S=Object.keys(E),C={};return S.forEach(A=>{var O;const W=No(O=A.slice(4)).call(O),F=JSON.parse(E[A]),B=F[1];C[W]={tag:F[0]||"",value:B}}),C}(u)}catch{}return m}async function dH(e,r){const s=se("WEBCS_DOMAIN").concat(se("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:eT(),serviceIds:[wi.CHOOSE_SERVER,wi.CLOUD_PROXY_FALLBACK]}));try{return await cH({referenceList:s,asyncMapHandler:c=>async function(u,h,m){let g,{url:E,areaCode:S,serviceIds:C}=u;const A=Date.now(),[O,W]=E2(h,S,C);let F=bi.networkState;try{F&&bi.networkState===Cc.OFFLINE&&bi.onlineWaiter&&await gt.race([bi.onlineWaiter,vs(Di.maxRetryTimeout)]),F=bi.networkState;const{data:B,headers:Z}=await jd(E,{data:O,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=Z.http3==="1"?1:-1,(_e=>{const ue=[];if(_e.response_body.forEach(Ie=>{const Ue=Ie.buffer.code;if(Ie.uri===23&&Ue===0&&!Ie.buffer.edges_services)if(Ie.buffer.flag===4194310)Ie.buffer.edges_services=[];else{const We={error:new ke(ee.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_e.detail[502]}),flag:Ie.buffer.flag};ue.push(We)}if(Ue!==0){const We=Xv(Ue),Je={error:new ke(ee.CAN_NOT_GET_GATEWAY_SERVER,We.desc,{desc:We.desc,retry:We.retry,csIp:_e.detail[502]}),flag:Ie.buffer.flag};Ie.buffer.flag===4194310?x.warning(Je.error.toString()):ue.push(Je)}}),ue.length)throw new ke(ee.CAN_NOT_GET_GATEWAY_SERVER,ue.map(Ie=>"flag: ".concat(Ie.flag,", message: ").concat(Ie.error.message)).join(" | "),{retry:!!ue.find(Ie=>Ie.error.data.retry),csIp:_e.detail[502],desc:[...new Set(ue.map(Ie=>{var Ue;return Ie==null||(Ue=Ie.error)===null||Ue===void 0||(Ue=Ue.data)===null||Ue===void 0?void 0:Ue.desc}).filter(Ie=>!!Ie))]})})(B);const ae=Xw(B,wi.CHOOSE_SERVER),ye=Xw(B,wi.CLOUD_PROXY_FALLBACK);return y2(ae),{gatewayInfo:c2(ae,E),proxyInfo:ye,opid:W,requestTime:A,url:E,isHttp3:g,elapse:Date.now()-A}}catch(B){throw B}}(c,e,r),closeFn:c=>c.code===ee.OPERATION_ABORTED||c.code===ee.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function hH(e,r,s,o){const c=se("PROXY_SERVER_TYPE3"),u=(O,W,F)=>{let B=F||c;return Array.isArray(B)&&(B=W%2==0&&c[1]||c[0]),"https://".concat(B,"/ap/?url=").concat(O)};let h=null;const m=[],g=async()=>{const O=se("WEBCS_DOMAIN").slice(0,se("AJAX_REQUEST_CONCURRENT")).map((B,Z)=>{let Q;return Q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(B,"/api/v2/transpond/webrtc?v=2"),Z,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):u("".concat(B,"/api/v2/transpond/webrtc?v=2"),Z),{url:Q,areaCode:eT(),serviceIds:[wi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?wi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?wi.CLOUD_PROXY:wi.CLOUD_PROXY_FALLBACK]}}),W=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(B=>B.url)}),F=await tT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:B=>(x.debug("[".concat(e.clientId,"] Connect to choose_server:"),B.url),oH(B,e,r,s)),allFailedhandler:B=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},W),B[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},W),F},E=async()=>{if(await vs(1e3),h!==null)return h;const O=se("WEBCS_DOMAIN_BACKUP_LIST").map((B,Z)=>{let Q;return Q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(B,"/api/v2/transpond/webrtc?v=2"),Z,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):u("".concat(B,"/api/v2/transpond/webrtc?v=2"),Z),{url:Q,areaCode:eT(),serviceIds:[wi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?wi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?wi.CLOUD_PROXY:wi.CLOUD_PROXY_FALLBACK]}}),W=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(B=>B.url)}),F=await tT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:B=>(x.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),B.url),oH(B,e,r,s)),allFailedhandler:B=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},W),B[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},W),F};let S,C,A;try{({gatewayInfo:S,proxyInfo:C,url:A}=await tS([g(),E()]))}catch(O){throw O[0]}if(m.length&&m.forEach(O=>O.cancel&&typeof O.cancel=="function"&&O.cancel()),!S||!C)throw new ke(ee.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=A,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&A){const O=/^https?:\/\/(.+?)(\/.*)?$/.exec(A)[1];et(c).call(c,O)&&(e.proxyServer=O,x.setProxyServer(O),At.setProxyServer(O))}return h={gatewayInfo:S,proxyInfo:await M9(C,S.uid)},h}async function Ige(e,r,s){const o=se("UAP_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,g,E){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Vl,cname:m.cname,uid:m.uid.toString(),requestId:_2,seq:_2};_2+=1;const C={service_name:"tele_channel",json_body:JSON.stringify(S)};return Ld(async()=>{const A=await jd(h,{data:C,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(A.code!==0){const W=new ke(ee.UNEXPECTED_RESPONSE,"cross channel ap error, code"+A.code,{retry:!0});throw x.error(W.toString()),W}const O=JSON.parse(A.json_body);if(O.code!==200){const W=new ke(ee.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(O.code,", reason: ").concat(O.reason));throw x.error(W.toString()),W}if(!O.servers||O.servers.length===0){const W=new ke(ee.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(W.toString()),W}return{vid:O.vid,workerToken:O.workerToken,addressList:(se("CHANNEL_MEDIA_RELAY_SERVERS")||O.servers).map(W=>"wss://".concat(W.address.replace(/\./g,"-"),".").concat(se("WORKER_DOMAIN"),":").concat(W.wss))}},void 0,A=>!!(A.code!==ee.OPERATION_ABORTED&&A.code!==ee.UNEXPECTED_RESPONSE||A.data&&A.data.retry),E)}(u,e,r,s));try{const u=await tS(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Age(e,r,s){let o=null;const c=[],u=async h=>{const m=se(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return h&&(await vs(1e3),o!==null)?o:await tT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(x.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),function(E,S,C,A){const[O]=wge(S,[wi.CHOOSE_SERVER]);let W=bi.networkState;return Ld(async()=>{W&&bi.networkState===Cc.OFFLINE&&bi.onlineWaiter&&await gt.race([bi.onlineWaiter,vs(A&&A.maxRetryTimeout||Di.maxRetryTimeout)]),W=bi.networkState;const F=await jd(E,{data:O,cancelToken:C,headers:{"Content-Type":"multipart/form-data;"}},!0);return bge(F,E)},()=>!1,F=>F.code!==ee.OPERATION_ABORTED&&(F.code===ee.UPDATE_TICKET_FAILED?F.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),F),!0)),A)}(g,e,r,s)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return o=await tS([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function pH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function S2(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?pH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):pH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class Pge extends Xr{get isSuccess(){return!!this.configs}constructor(r,s){super(),q(this,"configs",void 0),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"cancelToken",void 0),q(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),q(this,"interval",void 0),q(this,"mutex",void 0),q(this,"mutableParamsRead",!1),q(this,"configCache",{}),q(this,"limit_bitrate",void 0),this.mutex=new Zs("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),se("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},se("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,At.reportApiInvoke(null,{options:void 0,name:li.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Wr.TRACER}).onSuccess(JSON.stringify(Md))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await Cge(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=x_(u=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(u);for(let E=0;E<h.length;E++)for(let S=h.length-1;S>E;S--){const C=h[S],A=c[C].value;if(typeof A.__priority=="number"){const O=A.__priority,W=h[S-1],F=c[W].value;if(typeof F.__priority=="number"){if(!(O>F.__priority))continue;{const B=C;h[S]=h[S-1],h[S-1]=B}}else{const B=C;h[S]=h[S-1],h[S-1]=B}}}const m=Date.now();let g={};return h.forEach(E=>{const S=c[E].value.__expires;S&&S<=m||(g[E]=c[E])}),g}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new ke(ee.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){R9(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(Kw.UPDATE_BITRATE_LIMIT,r):this.emit(Kw.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&S2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;s[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const g=h.__type,E=r[u].value,S=r[u].tag;let C=0;g?g===Yz.REALTIME&&(C=1):Object.keys(E).some(A=>Object.prototype.hasOwnProperty.call(TL,A)||!JL()&&Object.prototype.hasOwnProperty.call(rP,A)?(C=1,!0):void 0),c.push({tag:S,isApplied:C,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:g,isApplied:E}=u;this.store.sessionId&&At.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,g=m.__expires,E=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=S2(S2({value:m[S]},g&&{expires:g}),E&&{type:E}))})}),u}(r);try{var o;const c=(o=s.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete s.LIMIT_BITRATE,c&&R9(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const g=Date.now();Object.keys(m).forEach(E=>{const{value:S,type:C,expires:A}=m[E];A&&A<=g||((C===Yz.REALTIME||Object.prototype.hasOwnProperty.call(TL,E))&&(Md[E]=S,Ur[E]=S,x.debug("Update realtime parameters from config distribute",E,S)),C||JL()||!Object.prototype.hasOwnProperty.call(rP,E)||(Md[E]=S,Ur[E]=S,x.debug("Update gateway parameters from config distribute",E,S)))})}catch(g){x.error("Error update config immediately: ".concat(m),g.message)}}(s);const u=JSON.stringify(s),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Ur,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(Ur[o],c)||(Md[o]=c,Ur[o]=c,this.emit(Kw.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class Oge extends Xr{constructor(){super(...arguments),q(this,"resultStorage",new Map)}setLocalAudioStats(r,s,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,s))}setLocalVideoStats(r,s,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(o))}setRemoteAudioStats(r,s){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(s))}record(r,s,o){if(se("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(o);const u=r==="VIDEO_ENCODE_FAILED"?se("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=u){var h;const m=et(h=c.result).call(h,!0);c.isPrevNormal&&!m&&this.emit("exception",b2[r],r,s),!c.isPrevNormal&&m&&this.emit("exception",b2[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=m,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Ui&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let o=null;s._encoderConfig&&s._encoderConfig.frameRate&&(o=Ic(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var s;return!(!r.codecType||et(s=se("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Ui&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const b2={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ro=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function fH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function ty(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?fH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):fH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class nT{constructor(r){q(this,"store",void 0),q(this,"onStatsException",void 0),q(this,"onUploadPublishDuration",void 0),q(this,"onStatsChanged",void 0),q(this,"onVideoCodecChanged",void 0),q(this,"localStats",new Map),q(this,"remoteStats",new Map),q(this,"updateStatsInterval",void 0),q(this,"trafficStats",void 0),q(this,"trafficStatsPeerList",[]),q(this,"uplinkStats",void 0),q(this,"exceptionMonitor",void 0),q(this,"p2pChannel",void 0),q(this,"scalabilityMode",nP.L1T1),q(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Oge,this.exceptionMonitor.on("exception",(s,o,c)=>{this.onStatsException&&this.onStatsException(s,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ye.LocalAudioTrack)||ty({},OL)}getLocalVideoTrackStats(){return this.localStats.get(Ye.LocalVideoTrack)||ty({},kL)}getRemoteAudioTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRemoteNetworkQualityStats(r){const s={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(s[u]=h)});return s}getRemoteVideoTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRTCStats(){let r=0,s=0,o=0,c=0;const u=this.localStats.get(Ye.LocalAudioTrack);u&&(r+=u.sendBytes,s+=u.sendBitrate);const h=this.localStats.get(Ye.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Ye.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:S,videoStats:C}=E;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),C&&(o+=C.receiveBytes,c+=C.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:s,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(s.peer_uid),u=c!=null&&c.videoSSRC?ro.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?ro.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,o){if(!r)return!1;const c=!!o&&s.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||s.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[o,c]=s;switch(o){case Ye.LocalVideoTrack:case Ye.LocalVideoLowTrack:{const m=c,g=ty({},kL),E=r.getStats(),S=r.getLocalMedia(o);if(E){const C=E.videoSend.find(A=>A.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(C){const A=r.getLocalVideoSize(),O=r.getEncoderConfig(Ye.LocalVideoTrack);var u;(C.codec==="H264"||C.codec==="H265"||C.codec==="VP8"||C.codec==="VP9"||C.codec==="AV1X"||C.codec==="AV1")&&(g.codecType=C.codec,(m==null?void 0:m.codecType)!==C.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,C.codec.toLocaleLowerCase()))),g.sendBytes=C.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,C.inputFrame?(g.captureFrameRate=C.inputFrame.frameRate,g.captureResolutionHeight=C.inputFrame.height,g.captureResolutionWidth=C.inputFrame.width):A&&(g.captureResolutionWidth=A.width,g.captureResolutionHeight=A.height),C.sentFrame?(g.sendFrameRate=C.sentFrame.frameRate,g.sendResolutionHeight=C.sentFrame.height,g.sendResolutionWidth=C.sentFrame.width):A&&(g.sendResolutionWidth=A.width,g.sendResolutionHeight=A.height),C.avgEncodeMs&&(g.encodeDelay=C.avgEncodeMs),O&&O.bitrateMax?g.targetSendBitrate=1e3*O.bitrateMax:C.targetBitrate&&(g.targetSendBitrate=C.targetBitrate),g.sendPackets=C.packets,g.sendPacketsLost=C.packetsLost,g.sendJitterMs=C.jitterMs,g.sendRttMs=C.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(C)&&(g.totalFreezeTime+=1),C.scalabilityMode&&this.scalabilityMode!==C.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(C.scalabilityMode)),this.scalabilityMode=C.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(o,g),((m==null?void 0:m.sendResolutionWidth)!==g.sendResolutionWidth||(m==null?void 0:m.sendResolutionHeight)!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&S&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,S.track,g);break}case Ye.LocalAudioTrack:{const m=c,g=ty({},OL),E=r.getStats(),S=r.getLocalMedia(o);if(E){const C=E.audioSend.find(A=>A.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(C){if(C.codec!=="opus"&&C.codec!=="aac"&&C.codec!=="PCMU"&&C.codec!=="PCMA"&&C.codec!=="G722"||(g.codecType=C.codec),C.inputLevel)g.sendVolumeLevel=Math.round(32767*C.inputLevel);else{const A=r.getLocalAudioVolume();A&&(g.sendVolumeLevel=Math.round(32767*A))}g.sendBytes=C.bytes,g.sendPackets=C.packets,g.sendPacketsLost=C.packetsLost,g.sendJitterMs=C.jitterMs,g.sendRttMs=C.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ye.LocalAudioTrack,g),g&&S&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,S.track,g);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:g}]=s;const E=m,S=h,C=g,A=ty({},oW),O=ty({},aW),W=ty({},pme),{audioTrack:F,videoTrack:B,audioSSRC:Z,videoSSRC:Q}=r.getRemoteMedia(u);let ae;ae=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(o=ae)===null||o===void 0?void 0:o.audioRecv.find(Ue=>Ue.ssrc===Z),_e=(c=ae)===null||c===void 0?void 0:c.videoRecv.find(Ue=>Ue.ssrc===Q),ue=this.trafficStats&&this.trafficStats.peer_delay.find(Ue=>Ue.peer_uid===u);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(A.codecType=ye.codec),ye.outputLevel?A.receiveLevel=Math.round(32767*ye.outputLevel):F&&(A.receiveLevel=Math.round(32767*F.getVolumeLevel())),A.receiveBytes=ye.bytes,A.receivePackets=ye.packets,A.receivePacketsLost=ye.packetsLost,A.receivePacketsDiscarded=ye.packetsDiscarded,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost),A.receiveBitrate=E?8*Math.max(0,A.receiveBytes-E.receiveBytes):0,A.totalDuration=E?E.totalDuration+1:1,A.totalFreezeTime=E?E.totalFreezeTime:0,A.freezeRate=A.totalFreezeTime/A.totalDuration,A.receiveDelay=ye.jitterBufferMs,A.totalDuration>10&&nT.isRemoteAudioFreeze(F)&&(A.totalFreezeTime+=1)),_e){var Ie;_e.codec!=="H264"&&_e.codec!=="H265"&&_e.codec!=="VP8"&&_e.codec!=="VP9"&&_e.codec!=="AV1X"&&_e.codec!=="AV1"||(O.codecType=_e.codec),O.receiveBytes=_e.bytes,O.receiveBitrate=S?8*Math.max(0,O.receiveBytes-S.receiveBytes):0,O.decodeFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,O.renderFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,_e.outputFrame&&(O.renderFrameRate=_e.outputFrame.frameRate),_e.receivedFrame?(O.receiveFrameRate=_e.receivedFrame.frameRate,O.receiveResolutionHeight=_e.receivedFrame.height,O.receiveResolutionWidth=_e.receivedFrame.width):B&&(O.receiveResolutionHeight=B._videoHeight||0,O.receiveResolutionWidth=B._videoWidth||0),_e.framesRateFirefox!==void 0&&(O.receiveFrameRate=Math.round(_e.framesRateFirefox)),O.receivePackets=_e.packets,O.receivePacketsLost=_e.packetsLost,O.packetLossRate=O.receivePacketsLost/(O.receivePackets+O.receivePacketsLost);const Ue=S?S.totalFreezeTime:0,We=S?S.totalDuration:0;O.totalDuration=S?S.totalDuration+1:1,O.totalFreezeTime=(Ie=_e.totalFreezesDuration)!==null&&Ie!==void 0?Ie:Ue||0,O.receiveDelay=_e.jitterBufferMs||0;const Je=!!Q&&r.getRemoteVideoIsReady(Q);_e.totalFreezesDuration===void 0&&B&&Je&&nT.isRemoteVideoFreeze(B,_e,C)&&(O.totalFreezeTime+=1),O.freezeRate=Math.max(0,Math.min((O.totalFreezeTime-Ue)/(O.totalDuration-We),1))}ue&&(A.end2EndDelay=ue.B_ad,O.end2EndDelay=ue.B_vd,A.transportDelay=ue.B_ed,O.transportDelay=ue.B_ed,A.currentPacketLossRate=ue.B_ealr4/100,O.currentPacketLossRate=ue.B_evlr4/100,W.uplinkNetworkQuality=ue.B_punq?ue.B_punq:0,W.downlinkNetworkQuality=ue.B_pdnq?ue.B_pdnq:0),this.remoteStats.set(u,{audioStats:A,videoStats:O,videoPcStats:_e,networkStats:W}),F&&this.exceptionMonitor.setRemoteAudioStats(F,A),B&&this.exceptionMonitor.setRemoteVideoStats(B,O)})}}class mH{constructor(){q(this,"destChannelMediaInfos",new Map),q(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){w9(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){w9(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){bP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function gH(e){if(!(e instanceof mH))return new ke(ee.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),s=e.getDestChannelMediaInfo();if(!r)return new ke(ee.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new ke(ee.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class qm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){q(this,"uid",void 0),q(this,"_uintid",void 0),q(this,"_trust_in_room_",!0),q(this,"_trust_audio_enabled_state_",!0),q(this,"_trust_video_enabled_state_",!0),q(this,"_trust_audio_mute_state_",!0),q(this,"_trust_video_mute_state_",!0),q(this,"_audio_muted_",!1),q(this,"_video_muted_",!1),q(this,"_audio_enabled_",!0),q(this,"_video_enabled_",!0),q(this,"_audio_added_",!1),q(this,"_video_added_",!1),q(this,"_is_pre_created",!1),q(this,"_video_pre_subscribed",!1),q(this,"_audio_pre_subscribed",!1),q(this,"_trust_video_stream_added_state_",!0),q(this,"_trust_audio_stream_added_state_",!0),q(this,"_audioTrack",void 0),q(this,"_videoTrack",void 0),q(this,"_dataChannels",[]),q(this,"_audioSSRC",void 0),q(this,"_videoSSRC",void 0),q(this,"_audioOrtc",void 0),q(this,"_videoOrtc",void 0),q(this,"_cname",void 0),q(this,"_rtxSsrcId",void 0),q(this,"_videoMid",void 0),q(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function _H(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function w2(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?_H(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):_H(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const UP="9",T2=2e4,VP=4e4;function yH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function hf(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?yH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):yH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}var nS=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(nS||{});const FP=new Map;function EH(e,r,s,o){let{scale:c}=e;if(c===0&&o===nS.UP||c>=r.length-1&&o===nS.DOWN)return e;let u=hf(hf({},e),{},{scale:o===nS.DOWN?++c:--c});switch(s){case"maintain-framerate":u=hf(hf({},u),r[c].motion);break;case"maintain-resolution":u=hf(hf({},u),r[c].detail);break;case"balanced":u=hf(hf({},u),r[c].balanced)}return u}function vH(e,r){if(r){const s={overUse:0,underUse:0,adaptationList:SH(r)};FP.set(e,s)}else FP.delete(e)}function SH(e){const r=hf({},e),{bitrateMax:s,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:C,BWE_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_DOWN_THRESHOLD:O,PERF_SCALE_UP_THRESHOLD:W,BALANCE_BITRATE_FACTOR:F,BALANCE_FRAMERATE_FACTOR:B,BALANCE_RESOLUTION_FACTOR:Z,MOTION_RESOLUTION_FACTOR:Q,MOTION_BITRATE_FACTOR:ae,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:_e}=bL,ue=Math.min(r.frameRate,m),Ie=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(A,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(O,1)*ue),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u}}];for(let Ue=1;Ue<=g;Ue++){const We={bwe_up:Math.round(Math.pow(C,Ue)*s),bwe_down:Math.round(Math.pow(A,Ue+1)*s),fps_up:Math.round(Math.pow(W,Ue)*ue),fps_down:Math.round(Math.pow(O,Ue+1)*ue)},Je={scaleResolutionDownBy:c/Math.pow(Z,Ue),frameRate:Math.max(Math.round(Math.pow(B,Ue)*o),h),bitrateMax:Math.max(Math.round(Math.pow(F,Ue)*s),S),bitrateMin:Math.max(Math.round(Math.pow(F,Ue)*u),E)},pn={scaleResolutionDownBy:c/Math.pow(Q,Ue),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ae,Ue)*s),S),bitrateMin:Math.max(Math.round(Math.pow(ae,Ue)*u),E)},En={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Ue)*o),h),bitrateMax:Math.max(Math.round(Math.pow(_e,Ue)*s),S),bitrateMin:Math.max(Math.round(Math.pow(_e,Ue)*u),E)};Ie.push({scale:Ue,threshold:We,balanced:Je,motion:pn,detail:En})}return Ie}function kge(e,r,s,o,c,u){const h=FP.get(e)||{overUse:0,underUse:0,adaptationList:SH(c)},{adaptationList:m}=h;FP.set(e,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:E}=bL,{scale:S}=o;let C,A;return typeof r=="number"&&r>0&&function(O,W,F,B){if(W>=F.length)return!1;let{threshold:{fps_down:Z}}=F[W];return se("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(Z=F[0].threshold.fps_down),O<Z}(r,S,m,u)&&(h.overUse++,A=Fw.CPU,h.overUse>g)||typeof s=="number"&&s>0&&function(O,W,F){if(W>=F.length)return!1;const{threshold:{bwe_down:B}}=F[W];return O<B}(s,S,m)&&(h.overUse++,A=Fw.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,C=EH(o,m,u,nS.DOWN),[C,A]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(O,W,F,B){if(W===0)return;let{threshold:{fps_up:Z}}=F[W];return se("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(Z=F[1].threshold.fps_up),O>Z}(r,S,m,u)&&function(O,W,F){if(W===0)return;const{threshold:{bwe_up:B}}=F[W];return O>B}(s,S,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,C=EH(o,m,u,nS.UP),C.scale===0&&(A=Fw.NONE))),[C,A])}function bH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function R2(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):bH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const jP=new Map;function BP(e,r){const s=jP.get(e);if(s){const{timer:o}=s;window.clearTimeout(o),jP.delete(e)}r.qualityLimitationReason=Fw.NONE,vH(e)}function Nge(e,r){var s;let o;switch(r){case Ye.LocalAudioTrack:o=or.Audio;break;case Ye.LocalVideoTrack:o=et(s=e._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Ye.LocalVideoLowTrack:o=or.Low}return o}function C2(e){const r=Vn();if(e.some(s=>s._bypassWebAudio))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function I2(e,r){C2(e);const s=new Ui;return e.forEach(o=>s.addAudioTrack(o)),s}const Dge=!Vn().supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&of();function zP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return Dge?(s={spec:r,store:e},df("PlanBConnection").create(s)):new Wl(r,e)}function A2(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function wH(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Mw(e.turnServer.servers))return!1;if(se("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Dn;function TH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Bd(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?TH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):TH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let Wl=(Dn=class Ey extends I9{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return et(s=Object.keys(Bw)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"id",Er(5,"connection-")),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"forceTurn",!1),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"transportEventReceiver",void 0),q(this,"statsFilter",void 0),q(this,"extension",{useXR:se("USE_XR")}),q(this,"localCapabilities",void 0),q(this,"remoteCodecs",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"isPreallocation",!1),q(this,"preMediaMap",new Map),q(this,"dataStreamChannelMap",new Map),q(this,"establishPromise",void 0),q(this,"recoveredDataChannelIds",[]),q(this,"currentDataChannelId",1),q(this,"supportAV1RtpSpec",!1),q(this,"mutex",void 0),q(this,"qualityLimitationReason",Fw.NONE),q(this,"isFirstConnected",!1),this.store=s,this.forceTurn=wH(r),this.mutex=new Zs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Ey.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=EL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,Zr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Gm(o.sdp),u=await $9({filterRTX:!se("USE_PUB_RTX")&&!se("USE_SUB_RTX"),filterVideoFec:se("FILTER_VIDEO_FEC"),filterAudioFec:se("FILTER_AUDIO_FEC"),filterVideoCodec:se("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:se("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:se("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=NP(u),this.initialOffer=o,se("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:nP.L1T3}]});const E=await g.createOffer();if(!E.sdp)return void g.close();const S=Ja(E.sdp).mediaDescriptions[0];if(!S)return;const C=S.attributes.extmaps.find(A=>A.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return g.close(),C}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&X9(o.sdp)&&(h=Gr(u),(s=h).send&&(Jv(Et.VIDEO,s.send.videoExtensions),Jv(Et.AUDIO,s.send.audioExtensions)),s.recv&&(Jv(Et.VIDEO,s.recv.videoExtensions),Jv(Et.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(Jv(Et.VIDEO,s.sendrecv.videoExtensions),Jv(Et.AUDIO,s.sendrecv.audioExtensions))),Bd(Bd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Le(ee.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&X9(this.initialOffer.sdp)&&(s=r.rtpCapabilities,o=this.localCapabilities,s.send&&(PP(Et.VIDEO,s.send.videoExtensions,o.send.videoExtensions),PP(Et.AUDIO,s.send.audioExtensions,o.send.audioExtensions)),s.recv&&(PP(Et.VIDEO,s.recv.videoExtensions,o.recv.videoExtensions),PP(Et.AUDIO,s.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Gr(this._localCapabilities)}get rtpCapabilities(){return Gr(this._rtpCapabilities)}get candidates(){return Gr(this._candidates)}get iceParameters(){return Gr(this._iceParameters)}get dtlsParameters(){return Gr(this._dtlsParameters)}constructor(g){let E=arguments.length>1&&arguments[1]!==void 0&&arguments[1],S=arguments.length>2&&arguments[2]!==void 0&&arguments[2];q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_originCandidates",void 0),q(this,"_iceParameters",void 0),q(this,"_isUseExtmapAllowMixed",void 0),q(this,"_isUseLocalCodecs",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),q(this,"useLocalCodecsMids",[]),q(this,"preloadSsrcs",[]),q(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=E,this._isUseLocalCodecs=S,g=Gr(g);const{iceParameters:C,dtlsParameters:A,candidates:O,rtpCapabilities:W,setup:F,localCapabilities:B,cname:Z}=g;this._rtpCapabilities=W,this._candidates=O,this._originCandidates=Gr(O),this._iceParameters=C,this._dtlsParameters=A,this._localCapabilities=B,this.setup=F,this.cname=Z,[this.sessionDesc]=this.updateRemoteRTPCapabilities(W),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(g){return g.length===this.preloadSsrcs.length&&g.every(E=>{var S;return et(S=this.preloadSsrcs).call(S,E)})}preloadRemoteMedia(g){let E=0;const S=[],C=[];for(;g>0;){const A=[w2({ssrcId:VP+E},se("USE_SUB_RTX")?{rtx:VP+E+1}:{})],O="".concat(VP+E,"_").concat(T2+E),{ssrcs:W,ssrcGroups:F}=Qw(A,this.cname,se("SYNC_GROUP")?O:void 0),B=this.preCreateOrRecycleSendMedia("video",W,F,void 0),Z=[{ssrcId:T2+E}],Q="".concat(VP+E,"_").concat(T2+E),{ssrcs:ae,ssrcGroups:ye}=Qw(Z,this.cname,se("SYNC_GROUP")?Q:void 0),_e=this.preCreateOrRecycleSendMedia("audio",ae,ye,void 0);g--,E+=2,S.push(B,_e),C.push(W[0].ssrcId,ae[0].ssrcId)}return this.useLocalCodecsMids.push(...S),this.preloadSsrcs=C,{mids:S,preSSRCs:C,isAvailable:!0}}preCreateOrRecycleSendMedia(g,E,S,C){const A=this.rtpCapabilities.send.videoCodecs,O=this._isUseLocalCodecs||A.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;x.debug("create or recycle send media without remote rtp capabilities, ssrcs ",E[0].ssrcId);const W=g===Et.VIDEO?O.videoCodecs:O.audioCodecs,F=g===Et.VIDEO?O.videoExtensions:O.audioExtensions;this.currentMidIndex+=1;const B="".concat(this.currentMidIndex);let Z={media:{mediaType:g,port:UP,protos:["UDP","TLS","RTP","SAVPF"],fmts:W.map(Q=>Q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:W,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(B)}};return Z=this.mungSendMediaDesc(Z,C),this.sessionDesc.mediaDescriptions.push(Z),this.updateBundleMids(),B}toString(){return Vm(this.sessionDesc)}send(g,E,S,C){const{ssrcs:A,ssrcGroups:O}=Qw(E,this.cname,se("SYNC_GROUP")?S:void 0),W=this.findPreloadMediaDesc(A);if(W){if(Zr()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,W.attributes.mid),C&&(C.twcc||C.remb)){const F=this.sessionDesc.mediaDescriptions.indexOf(W);return this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(W,C),{mid:W.attributes.mid,needExchangeSDP:!0}}return{mid:W.attributes.mid,needExchangeSDP:!1}}{const F=this.findAvailableMediaIndex(g,A);let B;return F===-1||F===1&&(Ls()||function(){const Z=Nn();return!(Z.name!==Gn.CHROME||!Z.osVersion)&&Number(Z.version)<=90}()||se("ENABLE_ENCODED_TRANSFORM")&&sf())||F===0&&!function(Z){const Q=Nn();return!(Q.name!==Gn.FIREFOX||!Q.osVersion)&&Number(Q.version)===Z}(138)&&se("USE_SUB_RTX")||Ez()?(B=this.createOrRecycleSendMedia(g,A,O,"sendonly",C),this.updateBundleMids()):(B=Gr(this.sessionDesc.mediaDescriptions[F]),B.attributes.direction="sendonly",B.attributes.ssrcs=A,B.attributes.ssrcGroups=O,this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(B,C)),Zr()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,B.attributes.mid),{mid:B.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:E}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:E}}batchSend(g){const E=g.map(A=>{let{kind:O,ssrcMsg:W,mslabel:F}=A;return this.send(O,W,F)}),S=[];let C=!1;return E.forEach(A=>{let{mid:O,needExchangeSDP:W}=A;W&&(C=!0),S.push(O)}),{mids:S,needExchangeSDP:C}}stopSending(g){const E=this.sessionDesc.mediaDescriptions.filter(S=>S.attributes.mid&&g.indexOf(S.attributes.mid)!==-1);if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");E.forEach(S=>{S.attributes.mid==="0"||Zr()||Ez()?S.attributes.ssrcs=[]:(S.attributes.ssrcs=[],S.attributes.direction="inactive",S.media.port="0")}),this.updateBundleMids()}mute(g){const E=this.sessionDesc.mediaDescriptions.find(S=>S.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(g){const E=this.sessionDesc.mediaDescriptions.find(S=>S.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}muteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter(S=>et(g).call(g,S.attributes.mid||""));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach(S=>{S.attributes.direction="inactive"})}unmuteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter(S=>et(g).call(g,S.attributes.mid||""));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach(S=>{S.attributes.direction="recvonly"})}receive(g,E,S,C){g.forEach((A,O)=>{this.createOrRecycleRecvMedia(A,[],"recvonly",E,S,C[O])}),this.updateBundleMids()}stopReceiving(g){const E=this.sessionDesc.mediaDescriptions.filter(S=>g.indexOf(S.attributes.mid)!==-1);if(E.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");E.forEach(S=>{S.media.port="0",S.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const E=this.sessionDesc||Ja((S=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(S?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var S;this._rtpCapabilities=g;let C=!1;const A=this.rtpCapabilities.send,O=this.localCapabilities.send,W=this.localCapabilities.recv,F=W.videoCodecs,B=W.audioCodecs,Z=W.videoExtensions,Q=W.audioExtensions;for(const ue of E.mediaDescriptions){var ae;if(ue.attributes.direction!=="sendonly"||typeof ue.attributes.mid!="string"||!et(ae=this.useLocalCodecsMids).call(ae,ue.attributes.mid)){if(C=!0,ue.attributes.iceUfrag=this._iceParameters.iceUfrag,ue.attributes.icePwd=this._iceParameters.icePwd,ue.attributes.fingerprints=this._dtlsParameters.fingerprints,ue.attributes.candidates=this._candidates,ue.attributes.setup=this.setup,ue.media.mediaType==="application"&&(ue.attributes.sctpPort="5000"),ue.media.mediaType==="video")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var ye;ue.media.fmts=F.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=F,ue.attributes.extmaps=Z;const Ie=ue.attributes.mid;typeof Ie!="string"||et(ye=this.useLocalCodecsMids).call(ye,Ie)||this.useLocalCodecsMids.push(Ie)}else if(A.videoCodecs.length===0){const Ie=O.videoCodecs.filter(Ue=>{var We,Je;return(We=Ue.rtpMap)===null||We===void 0?void 0:et(Je=We.encodingName.toLowerCase()).call(Je,"vp8")})||[O.videoCodecs[0]];ue.media.fmts=Ie.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=Ie,ue.attributes.extmaps=[]}else ue.media.fmts=A.videoCodecs.map(Ie=>Ie.payloadType.toString(10)),ue.attributes.payloads=A.videoCodecs,ue.attributes.extmaps=A.videoExtensions;if(ue.media.mediaType==="audio")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var _e;ue.media.fmts=B.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=B,ue.attributes.extmaps=Q;const Ie=ue.attributes.mid;typeof Ie!="string"||et(_e=this.useLocalCodecsMids).call(_e,Ie)||this.useLocalCodecsMids.push(Ie)}else if(A.audioCodecs.length===0){const Ie=O.audioCodecs.filter(Ue=>{var We,Je;return(We=Ue.rtpMap)===null||We===void 0?void 0:et(Je=We.encodingName.toLowerCase()).call(Je,"opus")})||[O.audioCodecs[0]];ue.media.fmts=Ie.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=Ie,ue.attributes.extmaps=[]}else ue.media.fmts=A.audioCodecs.map(Ie=>Ie.payloadType.toString(10)),ue.attributes.payloads=A.audioCodecs,ue.attributes.extmaps=A.audioExtensions,Zv(ue)}}return this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1,[this.sessionDesc,C]}updateCandidates(g){const E=this._originCandidates.filter(C=>C.transport==="udp"),S=[];if(E.forEach(C=>{S.push(w2(w2({},C),{},{foundation:"tcpcandidate",priority:Number(C.priority)-1+"",transport:"tcp",port:Number(C.port)+90+""}))}),E.length!==0){switch(g){case no.TCP_RELAY:this._candidates=S;break;case no.UDP_TCP_RELAY:case no.RELAY:this._candidates=[...E,...S];break;default:this._candidates=E}for(const C of this.sessionDesc.mediaDescriptions)C.attributes.candidates=this.candidates}}restartICE(g){g=Gr(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=g.iceUfrag,E.attributes.icePwd=g.icePwd})}predictReceivingMids(g){const E=[];for(let S=0;S<g;S++)E.push((this.currentMidIndex+S+1).toString(10));return E}findAvailableMediaIndex(g,E){return this.sessionDesc.mediaDescriptions.findIndex(S=>{const C=S.media.mediaType===g&&S.media.port!=="0"&&(S.attributes.direction==="sendonly"||S.attributes.direction==="sendrecv")&&S.attributes.ssrcs.length===0;if(Zr()){if(C){const A=this.firefoxSsrcMidMap.get(E[0].ssrcId);return!(A||S.attributes.mid!=="0"&&S.attributes.mid!=="1")||!(!A||A!==S.attributes.mid)}return!1}return C})}createOrRecycleDataChannel(){for(const S of this.sessionDesc.mediaDescriptions)if(S.media.mediaType==="application")return{mediaDesc:S,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),E={media:{mediaType:"application",port:UP,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(E),{mediaDesc:E,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,E,S,C,A,O){const W=g._mediaStreamTrack.kind,F=this.rtpCapabilities.recv,B=Zw(W,F,this.localCapabilities.send,W===Et.VIDEO?C:A),Z=W===Et.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const Q="".concat(this.currentMidIndex);let ae={media:{mediaType:W,port:UP,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:S,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Q)}};ae=this.mungRecvMediaDsec(ae,g,O);const ye=this.findFirstClosedMedia(W);if(ye){const _e=this.sessionDesc.mediaDescriptions.indexOf(ye);this.sessionDesc.mediaDescriptions[_e]=ae}else this.sessionDesc.mediaDescriptions.push(ae);return ae}updateRemoteDtlsParameters(g){const E=new Set(this._dtlsParameters.fingerprints.map(A=>A.fingerprint)),S=new Set(g.map(A=>A.fingerprint));let C=!1;E.size!==S.size&&(C=!0);for(const A of E)S.has(A)||(C=!0);return C}updateRemoteCodec(g,E,S){const C=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"").filter(ae=>{var ye;return et(ye=Object.keys(Bw)).call(ye,ae)}))],A=new Set(E);if(C.every(ae=>A.has(ae)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(E)),!1;const O=this._rtpCapabilities.recv.videoCodecs.filter(ae=>E.some(ye=>{var _e;return et(_e=ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"").call(_e,ye)}));if(O.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(C," codecs: ").concat(E)),!1;const W=[...new Set(O.map(ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||""))];let F;if(x.debug("updateRemoteCodec, from ".concat(C," to ").concat(W)),g.length===0)F=this.sessionDesc.mediaDescriptions.filter(ae=>ae.media.mediaType==="video"&&ae.attributes.direction==="recvonly");else if(F=this.sessionDesc.mediaDescriptions.filter(ae=>ae.attributes.mid&&ae.media.mediaType==="video"&&et(g).call(g,ae.attributes.mid)&&ae.attributes.direction==="recvonly"),F.length!==g.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(E)),!1;if(se("USE_PUB_RTX")||se("USE_SUB_RTX")){const ae=Hm(O,this.rtpCapabilities.recv.videoCodecs);O.push(...ae)}this._rtpCapabilities.recv.videoCodecs=O;const B=this.localCapabilities.send,Z=this.rtpCapabilities.recv,Q=Zw(Et.VIDEO,Z,B,S);return F.forEach(ae=>{const ye=Q.map(_e=>_e.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(ae.attributes.mid,", from"),ae.attributes.payloads,"to",Q),ae.attributes.payloads=Q,ae.media.fmts=ye}),!0}createOrRecycleSendMedia(g,E,S,C,A){const O=this.rtpCapabilities.send.videoCodecs,W=this._isUseLocalCodecs||O.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,F=g===Et.VIDEO?W.videoCodecs:W.audioCodecs,B=g===Et.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const Z="".concat(this.currentMidIndex);let Q={media:{mediaType:g,port:UP,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:B,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:C,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Z)}};Q=this.mungSendMediaDesc(Q,A);const ae=this.findFirstClosedMedia(g);if(ae){const ye=this.sessionDesc.mediaDescriptions.indexOf(ae);this.sessionDesc.mediaDescriptions[ye]=Q}else this.sessionDesc.mediaDescriptions.push(Q);return Q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(g=>g.media.port!=="0").map(g=>g.attributes.mid)}mungRecvMediaDsec(g,E,S){const C=Gr(g);return u2(C),Qv(C,E),d2(C,E),G9(C),kP(C,S,this.localCapabilities.send),C}mungSendMediaDesc(g,E){const S=Gr(g);return kP(S,E,this.localCapabilities.recv),Zv(S),S}updateRecvMedia(g,E){const S=this.sessionDesc.mediaDescriptions.findIndex(C=>C.attributes.mid===g);if(S!==-1){const C=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[S],E);this.sessionDesc.mediaDescriptions[S]=C}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find(E=>Zr()?E.media.port==="0"&&E.media.mediaType===g:E.media.port==="0")}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find(E=>{var S;return((S=E.attributes)===null||S===void 0||(S=S.ssrcs[0])===null||S===void 0?void 0:S.ssrcId)===g[0].ssrcId})}getSSRC(g){var E;return(E=this.sessionDesc.mediaDescriptions.find(S=>S.attributes.mid===g))===null||E===void 0?void 0:E.attributes.ssrcs}}(Bd(Bd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!se("ENABLE_PRE_SUB_WITH_PRE_PC")||!se("PRE_USE_LOCAL_CODECS"))&&IL(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=q9(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),IL(this.store))if(r.preallocation&&se("ENABLE_PRE_SUB_WITH_PRE_PC")){const g=se("PRE_SUB_NUM"),{mids:E,preSSRCs:S}=this.remoteSDP.preloadRemoteMedia(g);await $m(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(S)),this.presetMedia(E,S)}else{const{preSSRCs:g=[]}=r,E=g.map(C=>C.ssrcMsg[0].ssrcId);if(g.length===0)return;const{mids:S}=this.remoteSDP.batchSend(g.map(C=>Object.assign({},C)));await $m(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(E)),this.presetMedia(S,E)}}catch(c){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,o}presetMedia(r,s){r.forEach((o,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&o===u.mid&&u.receiver.track){const h=u.receiver.track;let m;h.kind==="video"&&se("ENABLE_PRE_RENDER")&&(m=new jL({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(Er(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;const E=this.preMediaMap.get(s[c]);E&&(E.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,s[c])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[c],{mid:o,track:h,player:m,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:o}=r;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(o),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||h}const{preSSRCs:c=[]}=r,u=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){const h=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[E,{mid:S,player:C,track:A}]=g;return h.push(S),m.push(E),this.preMediaMap.delete(E),C&&C.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await $m(this.peerConnection,this.remoteSDP,this.extension),x.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),At.reportApiInvoke(this.store.sessionId,{name:li.PRELOAD_MEDIA_FAILED,options:[c,m],tag:Wr.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(E=>Object.assign({},E)));await $m(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}s?(await $m(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):x.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return Ul(function*(){const u=yield Un(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=AP();r.forEach(B=>{const Z=c.peerConnection.addTransceiver(B._mediaStreamTrack,Bd({direction:"sendonly"},B.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Z),B._updateRtpTransceiver(Z)}),Zr()&&se("SIMULCAST")===!0&&(yield Un(c.applySimulcastForFirefox(h,r)));const g=yield Un(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(g.sdp,r,E),C=Ja(S),A=E.map(B=>{const Z=C.mediaDescriptions.find(Q=>Q.attributes.mid===B);if(!Z)throw new Error("Cannot extract ssrc from mediaDescription.");return B9(Z,se("USE_PUB_RTX"))});let O;try{O=yield A}catch(B){O=[],c.remoteSDP.receive(r,s,o,O);const Z=c.remoteSDP.toString();throw yield Un(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Un(c.peerConnection.setRemoteDescription({type:"answer",sdp:Z})),yield Un(c.stopSending(E,!0)),B}c.remoteSDP.receive(r,s,o,O);const W=c.remoteSDP.toString(),F=c.logSDPExchange(S,"offer","local","send");return yield Un(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Un(c.applySimulcastEncodings(h,r)),yield Un(c.applySendEncodings(h,r)),F==null||F(W),yield Un(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),h.map((B,Z)=>{const Q=E[Z];return{localSSRC:A[Z],id:Q,transceiver:B}})}catch(h){throw h instanceof Le?h:new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:se("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}s.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Le?o:new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(ee.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var E;BP(this.id+g.mid,this),g.direction="inactive",(E=g.stop)===null||E===void 0||E.call(g)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);h&&(await $m(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await $m(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preMediaMap.entries()).some(h=>{let[m,{mid:g,player:E}]=h;if(g===u)return this.preMediaMap.delete(m),E&&E.destroy(),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Ul(function*(){const o=yield Un(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Vn().supportPCSetConfiguration,u=se("FORCE_TURN_TCP")||s.forceTurn;if(r===no.RELAY&&!c)return;if(c&&!u){const C=r===no.RELAY?"relay":"all",A=s.peerConnection.getConfiguration();A.iceTransportPolicy!==C&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(C,"]")),A.iceTransportPolicy=C,s.peerConnection.setConfiguration(A))}s.remoteSDP.updateCandidates(r);const h=yield Un(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Gm(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;s.remoteSDP.restartICE(g);const E=s.remoteSDP.toString(),S=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Un(s.peerConnection.setLocalDescription(h)),S==null||S(E),yield Un(s.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(no.TCP_RELAY),await $m(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{BP(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:o}=s;o&&o.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Bd(Bd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(ee.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Zr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:Bd(Bd({},$h),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Bd(Bd({},$h),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",u=ey(r.url||"");x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(u||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},se("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]},o=r.cloudProxyServer||"disabled";return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(Mw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:se("NEW_TURN_MODE")&&s.iceServers&&o==="disabled"?(se("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Ey.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Ey.newTurnServerConfigToIceServers(r.turnServer.servers)),se("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Ey.turnServerConfigToIceServers(r.turnServer.servers)),se("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Ey.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),se("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),se("ENABLE_ENCODED_TRANSFORM")&&Vn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(zm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!se("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{const c=se("NEW_TURN_MODE");c===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(zm(o.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(zm(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair()||{};if(c&&u){const h=c.address+":"+c.port,m=u.address+":"+u.port;x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ey(h)),", remote ").concat(JSON.stringify(ey(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o,c;if(s||(s=this.peerConnection.getSenders().find(B=>B.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(F,B){return F.getTransceivers().find(Z=>Z.sender.track===B||Z.receiver.track===B)}(this.peerConnection,r._mediaStreamTrack),g=yme(r);if(function(F){var B;return!(!se("ENABLE_AG_ADAPTATION")||!(F instanceof dP||et(B=F._hints).call(B,_r.CUSTOM_TRACK))||!se("FORCE_SUPPORT_AG_ADAPTATION")&&!(_z(14,0,!1)&&yz(17,4)||gz(14)&&nL(17,4,!0)))}(r)&&m&&s&&g&&this.getLocalVideoStats&&et(o=["vp8","vp9"]).call(o,this.store.codec)){var E;const F=u.degradationPreference||(et(E=r._hints).call(E,_r.CUSTOM_TRACK)?se("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(B,Z,Q,ae,ye,_e){if(BP(B,Q),ye(Z),ae!=="balanced"&&ae!=="maintain-framerate"&&ae!=="maintain-resolution")return;let ue=-1;vH(B,Z);const Ie=window.setInterval(()=>{const We=jP.get(B);if(!se("ENABLE_AG_ADAPTATION")||!We)return BP(B,Q),void ye(Z);const Je=_e();if(Je.sendPackets>0&&Je.OutgoingAvailableBandwidth>0){if(ue===-1)return void(ue=Date.now());if(Date.now()-ue<1e3)return;const pn=Je.sendFrameRate,En=Je.OutgoingAvailableBandwidth,[Jt,tr]=kge(B,pn,En,We.adaptationConfig,Z,ae);tr&&(Q.qualityLimitationReason=tr),Jt&&We.adaptationConfig.scale!==Jt.scale&&(x.debug("[".concat(B,"] applyAdaptation: ").concat(Q.qualityLimitationReason,`
           sendFps `).concat(pn,", bwe ").concat(En,", switch from ").concat(We.adaptationConfig.scale," to ").concat(Jt.scale," ")),We.adaptationConfig=R2(R2({},We.adaptationConfig),Jt),ye(Jt))}},se("CHECK_LOCAL_STATS_INTERVAL")),Ue=R2({},Z);jP.set(B,{timer:Ie,adaptationConfig:Ue,originConfig:Z,adaptationFunc:ye}),x.debug("[".concat(B,"] start adaptation, originConfig: ").concat(JSON.stringify(Z),", degradationPreference: ").concat(ae))})(this.id+m.mid,g,this,F,B=>{s&&this.updateAdaptation(s,B)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:F,frameRate:B,scaleResolutionDownBy:Z}=r._encoderConfig;F&&(h.maxBitrate=1e3*F),(et(S=r._hints).call(S,_r.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(B&&(h.maxFramerate=Ic(B)),Z&&Z>=1&&(h.scaleResolutionDownBy=Z))}const{maxFramerate:C}=se("ENCODER_CONFIG_LIMIT");if(C&&typeof C=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,C):C),se("DSCP_TYPE")&&of()){var A;const F=se("DSCP_TYPE");et(A=["very-low","low","medium","high"]).call(A,F)&&(h.networkPriority=F)}const O=s.getParameters(),W=(c=O.encodings)===null||c===void 0?void 0:c[0];Zr()&&!W&&(u.encodings=[h]),W&&Object.assign(W,h),Object.assign(O,u),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(O.encodings))),await s.setParameters(O),await async function(F,B,Z){try{var Q;if(!Vn().supportSetRtpSenderParameters||!function(Ie){return Ie==="vp9"||Ie==="av1"}(F)||!se("ENABLE_SVC"))return;const ae={},ye={},_e=B.getParameters(),ue=(Q=_e.encodings)===null||Q===void 0?void 0:Q[0];ye.scalabilityMode=AP(Z),ue&&Object.assign(ue,ye),Object.assign(_e,ae),await B.setParameters(_e),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(_e.encodings)))}catch(ae){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ae)}}(this.store.codec,s,se("SVC_MODE"))}async updateAdaptation(r,s){var o,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!Vn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=s;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=Ic(m)),g&&g>=1&&et(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=g);const E=r.getParameters(),S=(c=E.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(E,{});try{await r.setParameters(E),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(C){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",C):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Vn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof Or&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ja(r);return s.forEach((u,h)=>{const m=o[h],g=c.mediaDescriptions.find(E=>E.attributes.mid===m);g&&(Qv(g,u),H9(g,u,this.store.codec))}),Vm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var o,c,u,h,m;const E=r[g],S=s[g];if(S instanceof Or&&!et(o=S._hints).call(o,_r.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const C={},A={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const O=E.sender.getParameters();await E.sender.setParameters(Object.assign(O,C))}}}async applySimulcastEncodings(r,s){if(!Zr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Or&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof Or&&se("SIMULCAST")&&this.store.codec==="vp8"&&!et(s=r._hints).call(s,_r.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(se("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Vn().supportPCSetConfiguration){const s=Ey.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}r.isPreallocation&&(this.isPreallocation=!0)}},Ct(Dn.prototype,"updateRemoteRTPCapabilities",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateRemoteRTPCapabilities"),Dn.prototype),Ct(Dn.prototype,"connect",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"connect"),Dn.prototype),Ct(Dn.prototype,"updateRemoteConnect",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateRemoteConnect"),Dn.prototype),Ct(Dn.prototype,"createDataChannels",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"createDataChannels"),Dn.prototype),Ct(Dn.prototype,"receive",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"receive"),Dn.prototype),Ct(Dn.prototype,"batchReceive",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"batchReceive"),Dn.prototype),Ct(Dn.prototype,"stopReceiving",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"stopReceiving"),Dn.prototype),Ct(Dn.prototype,"muteRemote",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"muteRemote"),Dn.prototype),Ct(Dn.prototype,"unmuteRemote",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"unmuteRemote"),Dn.prototype),Ct(Dn.prototype,"muteLocal",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"muteLocal"),Dn.prototype),Ct(Dn.prototype,"unmuteLocal",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"unmuteLocal"),Dn.prototype),Ct(Dn.prototype,"close",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"close"),Dn.prototype),Ct(Dn.prototype,"updateEncoderConfig",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateEncoderConfig"),Dn.prototype),Ct(Dn.prototype,"updateSendParameters",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateSendParameters"),Dn.prototype),Ct(Dn.prototype,"replaceTrack",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"replaceTrack"),Dn.prototype),Ct(Dn.prototype,"updateAdaptation",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateAdaptation"),Dn.prototype),Ct(Dn.prototype,"getRemoteSSRC",[Aa],Object.getOwnPropertyDescriptor(Dn.prototype,"getRemoteSSRC"),Dn.prototype),Dn);function Aa(e,r,s){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},s}function P2(e,r){let s=document.createElement("video"),o=document.createElement("canvas");s.setAttribute("style","display:none"),o.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),o.width=Ic(r.width),o.height=Ic(r.height);const c=Ic(r.framerate||15);document.body.append(s),document.body.append(o);let u=e._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();const h=o.getContext("2d");if(!h)throw new ke(ee.UNEXPECTED_ERROR,"can not get canvas context");const m=Vn(),g=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=o),o.startCapture=()=>{if(!s)return o.stopCapture&&o.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const S=s.videoWidth,C=s.videoHeight/S,A=o.width*C;Math.abs(A-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(A)),o.height=A)}h.drawImage(s,0,0,o.width,o.height),g.requestFrame&&g.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,s.srcObject=new MediaStream([u]))},o.stopCapture=xL(()=>o.startCapture&&o.startCapture(),c);const E=g.stop;return g.stop=()=>{E.call(g),s&&(s.remove(),s.srcObject=null,s=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},g}var RH=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(RH||{}),zd=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(zd||{}),tn=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(tn||{}),ws=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(ws||{}),Pa=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Pa||{}),WP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(WP||{});const ny=1e3,GP=6,rT=3,xge=Math.max(GP,rT,60);function zt(e,r,s){s!=null&&Number.isFinite(s)&&(e[r]=Math.round(Math.max(0,s)))}function CH(e){const r={[Pa.CONN_TYPE]:0,[Pa.RTT]:e.rtt,[Pa.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=e.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[Pa.CONN_TYPE]=1),s==="tcp"&&(r[Pa.CONN_TYPE]=3),s==="tls"&&(r[Pa.CONN_TYPE]=4);break}case"srflx":r[Pa.CONN_TYPE]=2;break;case"unknown":r[Pa.CONN_TYPE]=5;break;default:r[Pa.CONN_TYPE]=0}return r}function IH(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class AH extends Xr{constructor(r){super(),q(this,"store",void 0),q(this,"uploadWRTCStatsTimer",void 0),q(this,"uploadOutboundDenoiserStatsTimer",void 0),q(this,"uploadExtStatsTimer",void 0),q(this,"uploadExtUsageStatsTimer",void 0),q(this,"uploadInboundExtStatsTimer",void 0),q(this,"requestStats",void 0),q(this,"requestTransportStats",void 0),q(this,"requestLocalMedia",void 0),q(this,"requestRemoteMedia",void 0),q(this,"requestAllTracks",void 0),q(this,"requestVideoIsReady",void 0),q(this,"requestUploadStats",void 0),q(this,"requestUpload",void 0),q(this,"uploadOutboundStarted",!1),q(this,"uploadInboundStarted",!1),q(this,"uploadTransportStarted",!1),q(this,"uploadBaseStatsStarted",!1),q(this,"uploadExtensionUsageStarted",!1),q(this,"lastRecvStats",void 0),q(this,"lastSendStats",void 0),q(this,"lastRefRecvStats",void 0),q(this,"lastRefSendStats",void 0),q(this,"lastNormalRecvStats",void 0),q(this,"lastNormalSendStats",void 0),q(this,"lastExtendStats",{}),q(this,"needUploadStats",{}),q(this,"needUploadRenderFreezeTime",!0),q(this,"lastUploadCompensateTime",-1),q(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%rT==0,o=r%GP==0,c=r%60==0;let u,h;if(this.uploadTransportStarted&&(u=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!u&&this.uploadOutboundStarted&&(u=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),u||h){var m;const g={};if(this.uploadTransportStarted&&u){const S=this.getTransportStats(u,h,s);S&&(g.misc=[S])}if(this.uploadOutboundStarted&&u){const S=this.getOutboundStats(u,o?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,c);S&&(g.outbound=[S])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(r);const S=this.getInboundStats(h,o?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);S&&(g.inbound=S)}const E=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;E&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[WP.RTC_PEER_CONNECTION_STATE]=yL[E]):g.misc=[{addition:{[WP.RTC_PEER_CONNECTION_STATE]:yL[E]}}]),this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[RH.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=u,o&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=u),s&&(this.lastRefRecvStats=h,this.lastRefSendStats=u)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,o;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[WP.RTC_PEER_CONNECTION_STATE]:yL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===xge+1&&(r=1)},ny)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s=r%rT==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const o=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=o,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const u=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&u){const m=this.requestRemoteMedia()||[],g=[];m.forEach(E=>{let[S,C]=E;const A={peer:S.uid};if(S._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(S._videoSSRC)&&C.has(Et.VIDEO)&&S.videoTrack){const O=function(W,F,B){if(!F.videoRecv.find(Q=>Q.ssrc===W))return;const Z={};if(B&&B._player){const Q=B._player,{renderFreezeAccTime2:ae,videoElementStatus:ye}=Q;if(Yh.visibility==="visible"&&ye===eo.PLAYING&&Vn().supportRequestVideoFrameCallback){const _e=Math.min(6e3,ae);Q.renderFreezeAccTime2=Math.max(0,ae-_e),zt(Z,zd.Video_Render_Freeze_Time_Render2,_e),se("USE_NEW_RENDER_FREEZE_TIME")&&zt(Z,zd.Video_Render_Freeze_Time_Render,_e)}}return Z}(S._videoSSRC,u,S.videoTrack);O&&(A.video=O)}A.video&&g.push(A)}),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,s,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[Pa.RTT]:r.rtt,[Pa.CONN_TYPE]:void 0,[Pa.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=CH(r);if(this.store.useP2P){if(s){const u=CH(s);c[Pa.CONN_TYPE]+=u[Pa.CONN_TYPE]<<3}c[Pa.CONN_TYPE]+=110}else c[Pa.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,o,c,u){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let m,g,E;return h.forEach(S=>{let[C,{track:A,ssrcs:O}]=S;switch(C){case Ye.LocalVideoLowTrack:case Ye.LocalVideoTrack:if(C===Ye.LocalVideoTrack){var W;const F=function(ae,ye,_e,ue,Ie,Ue){const We=ye.videoSend.find(Jt=>Jt.ssrc===ae);if(!We)return;const Je={},{sentFrame:pn,inputFrame:En}=We;if(ue&&(zt(Je,zd.Video_Send_Qp_Sum,We.qpSumPerFrame),En&&pn)){const Jt=En.frameRate,tr=pn.frameRate;Je[zd.Video_Send_Freeze]=function(qn,io){let ze=!0;return ze=!(qn<=5)&&(qn<=10?io<3:qn<=20?io<4:io<5),ze}(Jt,tr)?1:0}if(Ie){switch(pn&&(zt(Je,tn.Video_Send_Height,pn.height),zt(Je,tn.Video_Send_Width,pn.width),zt(Je,tn.Video_Send_Frame_Rate,pn.frameRate)),Je[tn.Video_Send_Disabled]=_e._originMediaStreamTrack&&!_e._originMediaStreamTrack.enabled||_e._mediaStreamTrack&&!_e._mediaStreamTrack.enabled?1:0,We.adaptionChangeReason){case"none":Je[tn.Video_Send_Adaptation]=0;break;case"cpu":Je[tn.Video_Send_Adaptation]=1;break;case"bandwidth":Je[tn.Video_Send_Adaptation]=2;break;case"other":Je[tn.Video_Send_Adaptation]=3}let Jt=0;We.adaptionChangeReason&&(Jt+=IH(We.adaptionChangeReason)),ye.qualityLimitationReason&&(Jt+=IH(ye.qualityLimitationReason)<<3),Je[tn.Video_Send_Adaptation]=Jt,Je[tn.Video_Send_Player_Status]=NL[_e._player?_e._player.videoElementStatus:"uninit"],zt(Je,tn.Video_Send_Nacks,We.nacksCount),zt(Je,tn.Video_Send_Plis,We.plisCount),zt(Je,tn.Video_Send_Firs,We.firsCount),zt(Je,tn.Video_Send_Avg_Encode,We.avgEncodeMs),zt(Je,tn.Video_Send_Huge_Frame_Sent,We.hugeFramesSent),zt(Je,tn.Video_Send_Bytes_Retransmit,We.retransmittedBytesSent),zt(Je,tn.Video_Send_Packages_Retransmit,We.retransmittedPacketsSent),zt(Je,tn.Video_Send_Key_Frames_Encoded,We.keyFramesEncoded);const tr=Ie.videoSend.find(qn=>qn.ssrc===ae);if(tr){let qn=ny*rT;tr.timestamp&&We.timestamp&&(qn=We.timestamp-tr.timestamp),tr.packets!=null&&We.packets!=null&&zt(Je,tn.Video_Send_Package_Rate,1e3*(We.packets-tr.packets)/qn),We.packetsLost!=null&&tr.packetsLost!=null&&zt(Je,tn.Video_Send_Package_Lost,We.packetsLost-tr.packetsLost),tr.bytes!=null&&We.bytes!=null&&zt(Je,tn.Video_Send_Bitrate,8*(We.bytes-tr.bytes)/qn)}}return Je}(O[0].ssrcId,r,A,s,o),B=A.__className__==="CameraVideoTrack"?3:et(W=A._hints).call(W,_r.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==B||u)&&(this.needUploadStats={sendType:B},this.lastExtendStats.sendType=B);const Z=A&&function(ae,ye,_e,ue){const Ie=ye.videoSend.find(We=>We.ssrc===ae);if(!Ie)return null;const Ue={};if(ue){const We=Ie.inputFrame,Je=We&&We.height||_e.videoHeight||0,pn=We&&We.width||_e.videoWidth||0,En=We&&We.frameRate||0;zt(Ue,tn.Video_Capture_Height,Je),zt(Ue,tn.Video_Capture_Width,pn),zt(Ue,tn.Video_Capture_Frame_Rate,En)}return Ue}(O[0].ssrcId,r,A,!!o),Q=function(ae,ye){const _e={};return ye&&(zt(_e,tn.Video_Send_Retransmit,ae.bitrate.retransmit),zt(_e,tn.Video_Send_Target_Encoded,ae.bitrate.targetEncoded),zt(_e,tn.Video_Send_Actual_Encoded,ae.bitrate.actualEncoded),zt(_e,tn.Video_Send_Transmit,ae.bitrate.transmit),zt(_e,tn.Video_Send_Bandwidth,ae.sendBandwidth)),_e}(r,!!o);g=Object.assign({},F,Z,Q)}else E=function(F,B,Z,Q,ae){const ye=B.videoSend.find(ue=>ue.ssrc===F);if(!ye)return;const _e={};if(Q){const ue=ye.sentFrame;ue&&(zt(_e,tn.Video_Send_Low_Height,ue.height),zt(_e,tn.Video_Send_Low_Width,ue.width),zt(_e,tn.Video_Send_Low_Frame_Rate,ue.frameRate));const Ie=Q.videoSend.find(Ue=>Ue.ssrc===F);if(Ie){let Ue=ny*GP;Ie.timestamp&&ye.timestamp&&(Ue=ye.timestamp-Ie.timestamp),Ie.packets!=null&&ye.packets!=null&&zt(_e,tn.Video_Send_Low_Package_Rate,1e3*(ye.packets-Ie.packets)/Ue),ye.packetsLost!=null&&Ie.packetsLost!=null&&zt(_e,tn.Video_Send_Low_Package_Lost,ye.packetsLost-Ie.packetsLost),Ie.bytes!=null&&ye.bytes!=null&&zt(_e,tn.Video_Send_Low_Bitrate,8*(ye.bytes-Ie.bytes)/Ue)}}return _e}(O[0].ssrcId,r,0,o);break;case Ye.LocalAudioTrack:m=A&&function(F,B,Z,Q,ae,ye){const _e=B.audioSend.find(Ie=>Ie.ssrc===F);if(!_e)return;const ue={};if(ae){ue[tn.Audio_Send_Disabled]=Z._originMediaStreamTrack&&!Z._originMediaStreamTrack.enabled||Z._mediaStreamTrack&&!Z._mediaStreamTrack.enabled?1:0;const Ie=100*Z._source.getAccurateVolumeLevel(),Ue=_e.inputLevel;if(Ue!=null){const Je=Math.ceil(50*Math.log10(100*Ue+1));zt(ue,tn.Audio_Send_Level,Je)}zt(ue,tn.Audio_Capture_PCM_Level,Ie),zt(ue,tn.Audio_Send_AEC_Return_Loss,_e.aecReturnLoss),zt(ue,tn.Audio_Send_AEC_Return_Loss_Enhancement,_e.aecReturnLossEnhancement),zt(ue,tn.Audio_Send_Bytes_Retransmit,_e.retransmittedBytesSent),zt(ue,tn.Audio_Send_Packages_Retransmit,_e.retransmittedPacketsSent),ue[tn.Audio_Send_Freeze]=0;const We=ae.audioSend.find(Je=>Je.ssrc===F);if(We){let Je=ny*GP;We.timestamp&&_e.timestamp&&(Je=_e.timestamp-We.timestamp),We.bytes!=null&&_e.bytes!=null&&zt(ue,tn.Audio_Send_Bitrate,8*(_e.bytes-We.bytes)/Je),We.packets!=null&&_e.packets!=null&&zt(ue,tn.Audio_Send_Package_Rate,1e3*(_e.packets-We.packets)/Je)}}return ue}(O[0].ssrcId,r,A,0,o)}}),{high:g,low:E,audio:m}}getInboundStats(r,s,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[g,E]=m;const S={peer:g.uid};if(E.has(Et.VIDEO)&&g.videoTrack){const C=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,A=g.videoTrack?function(O,W,F,B,Z,Q,ae,ye){const _e=W.videoRecv.find(Jt=>Jt.ssrc===O);if(!_e)return;const ue={},{receivedFrame:Ie,outputFrame:Ue,decodeFrameRate:We}=_e;zt(ue,ws.Video_Render_Frame_Rate_Decode,We),_e.framesRateFirefox&&zt(ue,ws.Video_Recv_Frame_Rate,_e.framesRateFirefox),Ie&&zt(ue,ws.Video_Recv_Frame_Rate,Ie.frameRate),zt(ue,ws.Video_Recv_Frame_Dropped,_e.framesDroppedCount),zt(ue,ws.Video_Recv_Bytes_Retransmit,_e.retransmittedBytesReceived),zt(ue,ws.Video_Recv_Packages_Retransmit,_e.retransmittedPacketsReceived),zt(ue,ws.Video_Recv_Packages_Discarded,_e.packetsDiscarded),zt(ue,ws.Video_Recv_Avg_Decode,_e.avgDecodeMs),zt(ue,ws.Video_Recv_Avg_Processing_Delay,_e.avgProcessingDelayMs),zt(ue,ws.Video_Recv_Avg_Assembly_Time,_e.avgFramesAssembledFromMultiplePacketsMs),zt(ue,ws.Video_Recv_Avg_Inter_Frame_Delay,_e.avgInterFrameDelayMs),zt(ue,ws.Video_Recv_Key_Frames_Decoded,_e.keyFramesDecoded);const Je=ye&&ye.videoRecv.find(Jt=>Jt.ssrc===O);if(Je){const Jt=W.timestamp-ye.timestamp||ny;_e.packetsLost!=null&&Je.packetsLost!=null&&zt(ue,ws.Video_Recv_Package_Lost,_e.packetsLost-Je.packetsLost),Je.bytes!=null&&_e.bytes!=null&&zt(ue,ws.Video_Recv_Bitrate,8*(_e.bytes-Je.bytes)/Jt),Je.packets!=null&&_e.packets!=null&&zt(ue,ws.Video_Recv_Package_Rate,1e3*(_e.packets-Je.packets)/Jt)}const pn=Q&&Q.videoRecv.find(Jt=>Jt.ssrc===O);if(pn&&(zt(ue,zd.Video_Recv_Qp_Sum,_e.qpSumPerFrame),ue[zd.Video_Recv_Freeze]=B&&nT.isRemoteVideoFreeze(F,_e,pn)?1:0),ae){var En;const Jt=ae.videoRecv.find(qn=>qn.ssrc===O);Ie?(zt(ue,tn.Video_Recv_Height,Ie.height),zt(ue,tn.Video_Recv_Width,Ie.width)):F&&(zt(ue,tn.Video_Recv_Height,F._videoHeight||0),zt(ue,tn.Video_Recv_Width,F._videoWidth||0)),Ue&&zt(ue,tn.Video_Recv_Frame_Rate_Output,Ue.frameRate);const tr=(En=F._player)===null||En===void 0?void 0:En.rendFrameRate.toFixed(0);if(tr&&zt(ue,tn.Video_Render_Frame_Rate_Render,+tr),zt(ue,tn.Video_Recv_Jitter_Buffer,_e.jitterBufferMs),zt(ue,tn.Video_Recv_Current_Delay,_e.currentDelayMs),zt(ue,tn.Video_Recv_Firs,_e.firsCount),zt(ue,tn.Video_Recv_Nacks,_e.nacksCount),zt(ue,tn.Video_Recv_Plis,_e.plisCount),F){ue[tn.Video_Recv_Disabled]=F._originMediaStreamTrack.enabled&&F._mediaStreamTrack.enabled?0:1;const qn=F._player;if(qn){const{freezeTimeCounterList:io,renderFreezeAccTime:ze,renderFreezeAccTime2:nt,videoElementStatus:St}=qn;if(io&&io.length>0&&zt(ue,zd.Video_Render_Freeze_Time,io.splice(0,1)[0]),Z&&Yh.visibility==="visible"&&St===eo.PLAYING&&Vn().supportRequestVideoFrameCallback){const He=Math.min(6e3,nt);qn.renderFreezeAccTime2=Math.max(0,nt-He),zt(ue,zd.Video_Render_Freeze_Time_Render2,He);const U=Math.min(6e3,ze);qn.renderFreezeAccTime=Math.max(0,ze-U),zt(ue,zd.Video_Render_Freeze_Time_Render,se("USE_NEW_RENDER_FREEZE_TIME")?He:U)}if(typeof _e.totalFreezesDuration=="number"){const He=Jt&&Jt.totalFreezesDuration?_e.totalFreezesDuration-Jt.totalFreezesDuration:_e.totalFreezesDuration;zt(ue,tn.Video_Render_Freeze_Duration,1e3*He)}}}if(ue[tn.Video_Recv_Player_Status]=NL[F._player?F._player.videoElementStatus:"uninit"],Jt&&_e.totalInterFrameDelay!==void 0&&_e.totalSquaredInterFrameDelay!==void 0&&Jt.totalInterFrameDelay!==void 0&&Jt.totalSquaredInterFrameDelay!==void 0){const qn=_e.totalInterFrameDelay-Jt.totalInterFrameDelay,io=_e.totalSquaredInterFrameDelay-Jt.totalSquaredInterFrameDelay,ze=_e.framesDecodeCount-Jt.framesDecodeCount,nt=qn/ze*1e3,St=Math.round(1e3*Math.sqrt((io-Math.pow(qn,2)/ze)/ze));!isNaN(St)&&nt+St>Math.max(3*nt,nt+150)&&(ue[tn.Video_Recv_I_Frame_Delay]=St)}}return ue}(g._videoSSRC,r,g.videoTrack,C===!0,this.needUploadRenderFreezeTime,s,o,c):void 0;A&&(S.video=A)}if(E.has(Et.AUDIO)&&g.audioTrack){const C=g.audioTrack?function(A,O,W,F,B,Z){const Q=O.audioRecv.find(ue=>ue.ssrc===A);if(!Q)return;const ae={};zt(ae,ws.Audio_Recv_Jitter,Q.jitterMs),zt(ae,ws.Audio_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),zt(ae,ws.Audio_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),zt(ae,ws.Audio_Recv_Packages_Discarded,Q.packetsDiscarded),zt(ae,ws.Audio_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs);const ye=Z&&Z.audioRecv.find(ue=>ue.ssrc===A);if(ye){const ue=ny;Q.packets!=null&&ye.packets!=null&&zt(ae,ws.Audio_Recv_Package_Rate,1e3*(Q.packets-ye.packets)/ue),Q.packetsLost!=null&&ye.packetsLost!=null&&zt(ae,ws.Audio_Recv_Package_Lost,Q.packetsLost-ye.packetsLost)}if(F){const{receivedFrames:ue,droppedFrames:Ie}=Q;ue!=null&&Ie!=null&&(ae[zd.Audio_Recv_Freeze]=(_e=ue)===0||100*Ie/_e>20?1:0)}var _e;if(B){const ue=100*W._source.getAccurateVolumeLevel(),Ie=Q.outputLevel;if(Ie!=null){const We=Math.ceil(50*Math.log10(100*Ie+1));zt(ae,tn.Audio_Render_Level,We)}zt(ae,tn.Audio_Recv_PCM_Level,ue),W&&(ae[tn.Audio_Recv_Disabled]=W._originMediaStreamTrack.enabled&&W._mediaStreamTrack.enabled?0:1),zt(ae,tn.Audio_Recv_Jitter_Buffer,Q.jitterBufferMs),zt(ae,tn.Audio_Recv_Current_Delay,Q.jitterBufferMs),ae[tn.Audio_Recv_Player_Status]=NL[Ia.getPlayerState(W.getTrackId())];const Ue=B.audioRecv.find(We=>We.ssrc===A);if(Ue){Ue.bytes!=null&&Q.bytes!=null&&zt(ae,tn.Audio_Recv_Bitrate,8*(Q.bytes-Ue.bytes)/(ny*rT));const We=Q.concealedSamples-Ue.concealedSamples;We>0&&zt(ae,tn.Audio_Recv_Concealed_Samples,We);const Je=Q.totalSamplesReceived-Ue.totalSamplesReceived;Je>0&&zt(ae,tn.Audio_Recv_Total_Samples_Received,Je);const pn=Q.freezeSamples80-Ue.freezeSamples80;pn>0&&zt(ae,tn.Audio_Render_Freeze_Samples_80ms,pn);const En=Q.freezeSamples200-Ue.freezeSamples200;En>0&&zt(ae,tn.Audio_Render_Freeze_Samples_200ms,En);const Jt=Q.freezeMs80-Ue.freezeMs80;zt(ae,tn.Audio_Render_Freeze_Time_80ms,Jt<0?0:Jt);const tr=Q.freezeMs200-Ue.freezeMs200;zt(ae,tn.Audio_Render_Freeze_Time_200ms,tr<0?0:tr)}}return ae}(g._audioSSRC,r,g.audioTrack,s,o,c):void 0;C&&(S.audio=C)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof Gw);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload($w.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,o]=r;o.has(Et.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(Et.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),o={connectionInterval:se("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of u)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,S]of h)S.has(Et.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),S.has(Et.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(E,S){const C={};for(const{id:F,value:B,level:Z,direction:Q}of E){var A;const ae=(A=S.get(F))!==null&&A!==void 0?A:0,ye=B===2?ae+se("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ae;var O,W;S.set(F,ye),C[F]?(B===2&&(C[F].value=B),Z>C[F].level&&(C[F].level=Z),Q==="remote"&&(C[F].remoteUidCount+=1),C[F].totalTs=(O=S.get(F))!==null&&O!==void 0?O:0):C[F]={value:B,level:Z,remoteUidCount:Q==="local"?0:1,totalTs:(W=S.get(F))!==null&&W!==void 0?W:0}}return Object.keys(C).map(F=>{const{level:B,value:Z,totalTs:Q}=C[F];return{id:F,level:B,value:Z,totalTs:Q}})}(c,r);const m=Date.now(),g=m>s?m:s+1;this.requestUpload&&this.requestUpload($w.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:g})},se("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Lge=se("ICE_RESTART_INTERVAL");let HP=new Map,rS=new Map,Ym=[no.UDP_TCP_RELAY,no.TCP_RELAY,no.RELAY],O2=se("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vn().supportPCSetConfiguration;function PH(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=HP.get(e.id);s&&(window.clearTimeout(s),HP.delete(e.id));const o=rS.get(e.id);r&&o&&o.index===Ym.length-1&&(x.debug("[".concat(e.id,"] reset ICE restart policy")),rS.delete(e.id))}function OH(e,r,s){if(HP.size===0&&rS.size===0&&(Array.isArray(se("RESTART_SEQUENCE"))&&se("RESTART_SEQUENCE").length>0&&!function(m,g){if(m.length!==g.length)return!1;for(let E=0;E<m.length;E+=1){const S=m[E];if(m.filter(C=>C===S).length!==g.filter(C=>C===S).length)return!1}return!0}(Ym,se("RESTART_SEQUENCE"))&&(Ym=se("RESTART_SEQUENCE").filter(m=>{var g;if(et(g=Object.values(no)).call(g,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Ym.join(" => ")))),O2=se("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vn().supportPCSetConfiguration),Ym.length===0)return void s();let o,{index:c=0,type:u}=rS.get(e.id)||{};if(O2&&u===no.RELAY)return void s();let h=u&&c>=Ym.length-1;if(O2)u=no.RELAY;else{if(h)return void s();u?(c++,u=Ym[c]):(u=Ym[0],c=0)}x.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),rS.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>OH(e,r,s),Lge),HP.set(e.id,o)}var wn;function kH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Qh(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?kH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):kH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function NH(e){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=Hx,o=Symbol.iterator);c--;){if(s&&(r=e[s])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new $P(r.call(e));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function $P(e){function r(s){if(Object(s)!==s)return gt.reject(new TypeError(s+" is not an object."));var o=s.done;return gt.resolve(s.value).then(function(c){return{value:c,done:o}})}return $P=function(s){this.s=s,this.n=s.next},$P.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?gt.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?gt.reject(s):r(o.apply(this.s,arguments))}},new $P(e)}let iT=(wn=class extends Xr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(Ut.StateChange,r,this._state)}constructor(e,r){super(),q(this,"isPlanB",void 0),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"connection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"remoteDataChannelMap",new Map),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"pendingLocalDataChannels",[]),q(this,"pendingRemoteDataChannels",[]),q(this,"statsCollector",void 0),q(this,"shouldForwardP2PCreation",void 0),q(this,"iceFailedCount",0),q(this,"dtlsFailedCount",0),q(this,"mutex",void 0),q(this,"_state",rr.Disconnected),q(this,"_pcStatsUploadType",se("NEW_ICE_RESTART")?uf.FIRST_CONNECTION:uf.OLD_FIRST_CONNECTION),q(this,"_isStartRestartIce",!1),q(this,"_restartTimer",void 0),q(this,"_isTryConnecting",!1),q(this,"_iceError",null),q(this,"_forceTurn",!1),q(this,"_isWaitPcToRePub",!1),q(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==rr.Connected)return void c(new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];this.store.enableInstantMuteRestore?(E.track._originMediaStreamTrack.enabled=!1,x.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):E.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?x.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const g=this.createMuteMessage(h);await yr(this,Ut.RequestMuteLocal,g),o()}catch(h){c(h)}finally{u()}}),q(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==rr.Connected)return void c(new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];if(this.store.enableInstantMuteRestore)E.track._originMediaStreamTrack.enabled=!0,x.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(E.track._originMediaStreamTrack.stop(),!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const S=s._mediaStreamTrack.clone();E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}else{const S=P2(s,Uw(this,Ut.RequestLowStreamParameter));E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}await new gt((S,C)=>{this.handleReplaceTrack(E.track,S,C,!0)})}}this.store.enableInstantMuteRestore?x.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const g=this.createUnmuteMessage(h);await yr(this,Ut.RequestUnmuteLocal,g),o()}catch(h){c(h)}finally{u()}}),q(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.connection||!g||g.track!==s||this.state!==rr.Connected)return void o();const{id:E,track:S}=g;await this.connection.updateSendParameters(E,S),await this.connection.updateEncoderConfig(E,S),this.emit(Ut.UpdateVideoEncoder,S),o()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==rr.Connected)return void o();const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),o()}catch(h){c(h)}finally{u()}}),q(this,"handleReplaceMixingTrack",async(s,o,c,u)=>{if(!this.connection||this.state!==rr.Connected)return void o();const h=I2([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),o()}catch(E){c(E)}finally{var g;(g=m)===null||g===void 0||g()}}),q(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:C}]=S;return s===C});if(!this.connection||!E||this.state!==rr.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),this.isPlanB){const S=E[1];S.id=s._mediaStreamTrack.id,this.localTrackMap.set(E[0],S)}if(E[0]===Ye.LocalVideoTrack&&!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(S){const C=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=C,S.track._originMediaStreamTrack=C,await new gt((A,O)=>{this.handleReplaceTrack(S.track,A,O,!0)})}}o()}catch(E){c(E)}finally{var g;(g=h)===null||g===void 0||g()}}),q(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new AH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Zs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Vn().supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&of(),this.shouldForwardP2PCreation=se("FORWARD_P2P_CREATION")&&Vn().supportPCSetConfiguration&&sL(),this.shouldForwardP2PCreation&&(this.connection=zP(this.store),this.emit(Ut.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,r){var s;this.state=rr.New,this._forceTurn=wH(e),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const o=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||o||r)&&((o||r)&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=zP(this.store,e),this.emit(Ut.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=se("NEW_ICE_RESTART")?uf.FIRST_CONNECTION:uf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===rr.Connected){if(this.connection instanceof Wl&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),At.reportApiInvoke(this.store.sessionId,{name:li.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Wr.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Ut.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=rr.Connected}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return et(u=[Ye.LocalVideoLowTrack,Ye.LocalVideoTrack]).call(u,h)}),s=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Wl){if(At.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!et(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>et(e).call(e,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,e)}}async getEstablishParams(){var e;if(this.connection instanceof Wl&&this.connection.peerConnectionState!=="closed"&&et(e=[rr.New,rr.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==rr.Connected){if(this.state===rr.Disconnected)throw new Le(ee.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(s=>{var o;et(o=this.pendingLocalDataChannels).call(o,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(s=>{const o=Date.now();this.store.publish(s.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const o=Date.now();this.store.publish(s.id+"","datachannel",void 0,o)}),e.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(e,r,s){var o=this;return Ul(function*(){const c=yield Un(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&et(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==rr.Connected||h){if(o.state===rr.Disconnected)throw new Le(ee.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const g=e.filter(E=>o.pendingLocalTracks.indexOf(E)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(g),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,ro.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,r,s);if(m.length===0)return void(yield Un(o.tryToUnmuteAudio(e)));yield*VA(NH(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,r){var s=this;return Ul(function*(){r.forEach(A=>{let{track:O,type:W}=A;const F=Date.now();s.store.publish(O.getTrackId(),W===Ye.LocalAudioTrack?"audio":"video",F)}),s.bindLocalTrackEvents(r);const o=r.map(A=>{let{track:O}=A;return O}),c=yield Un(e.send(o,s.store.codec,s.store.audioCodec)),u=(yield Un(c.next())).value,h=s.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(A){throw c.throw(A),(A==null?void 0:A.code)===ee.WS_ABORT&&r.forEach(O=>{let{track:W}=O;s.pendingLocalTracks.indexOf(W)===-1&&s.pendingLocalTracks.push(W)}),s.unbindLocalTrackEvents(r),A}const g=s.mapPubResToRemoteConfig(h,m,o),E=(yield Un(c.next(g))).value;if(s.state===rr.Disconnected)throw new Le(ee.UNEXPECTED_ERROR,"PeerConnection already disconnected.");se("ENABLE_VIDEO_SEI");const S=se("ENABLE_ENCODED_TRANSFORM"),C=se("ENABLE_AUDIO_METADATA");o.forEach(async A=>{const O=A.getRTCRtpTransceiver();if(!O||!S)return;const{interceptLocalVideoFrame:W,interceptLocalAudioFrame:F}=DP();A.trackMediaType===Et.VIDEO?await W(O.sender,A):A.trackMediaType===Et.AUDIO&&await F(O.sender,{metadata:C?()=>{const B=A.metadata.shift();return B&&B.value}:void 0})}),r.forEach(A=>{let{type:O}=A;s.statsCollector.addLocalStats(O)}),s.assignLocalTracks(r,E),s.statsUploader.startUploadOutboundStats(),r.forEach(A=>{let{track:O,type:W}=A;const F=Date.now();s.store.publish(O.getTrackId(),W===Ye.LocalAudioTrack?"audio":"video",void 0,F)})})()}async updateVideoStreamParameter(e,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Or))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=s,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=l2(u,h)),m.maxFramerate=u.framerate?Ic(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==Ye.LocalVideoLowTrack||!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const g=h.canvas;m.width&&(g.width=Ic(m.width)),m.height&&(g.height=Ic(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=xL(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Ic(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return Ul(function*(){if(!r.connection||r.state!==rr.Connected)return;const s=yield Un(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ye.LocalVideoTrack);if(!c)throw new Le(ee.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ye.LocalVideoLowTrack))throw new Le(ee.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,e),type:Ye.LocalVideoLowTrack}];if(yield*VA(NH(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get(Ye.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Un(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Us(this,Ut.RequestRePublish,this.pendingLocalTracks),this.emit(Ut.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Us(this,Ut.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:o}=this.pendingRemoteTracks[r];(o!==Et.AUDIO||s._audio_added_&&s._audioSSRC)&&(o!==Et.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await Us(this,Ut.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===Et.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(Ut.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==rr.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const s=r.find(o=>o[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==rr.Connected)return void e.forEach(s=>{const o=this.pendingLocalDataChannels.indexOf(s);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(s=>{const o=this.localDataChannels.indexOf(s);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==rr.Connected)return;const e=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[Ye.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const s=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(e,r){if(!this.connection||this.state!==rr.Connected)throw new Le(ee.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(s.length!==0)return await this.connection.createDataChannels(e.uid,s),s.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:g}=h;return m.uid===e.uid&&g===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),s.map(o=>o.id)}async subscribe(e,r,s,o,c){var u;if(!this.connection||this.state!==rr.Connected)throw new Le(ee.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(r))return;let h,m,g,E;const S=this.connection.getPreMedia(s);if(S)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),g=S.transceiver,h=S.track,m=S.mid,E=S.player,S.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:S.firstVideoRender});else if(c){const O=c.find(F=>{let{stream_type:B}=F;return B===r});if(!O)throw new Le(ee.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const W=await this.connection.receive(r,O.ssrcs,String(e._uintid),O.attributes);this.connection instanceof Wl&&(g=W.transceiver),h=W.track,m=W.id}else{const O=await this.connection.receive(r,[{ssrcId:s,rtx:o}],String(e._uintid),void 0);this.connection instanceof Wl&&(g=O.transceiver),h=O.track,m=O.id}if(r===Et.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Gv(h,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),g&&e._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Wv(h,e.uid,e._uintid,this.store,E),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(jl.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(jl.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),E?e._videoTrack.once(jl.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(jl.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),g&&e._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._videoTrack)),g&&se("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:W}=DP();r==Et.VIDEO?await O(g.receiver,{onSei:se("ENABLE_VIDEO_SEI")&&(F=>{var B;return(B=e._videoTrack)===null||B===void 0?void 0:B._onSei(F)})}):r==Et.AUDIO&&await W(g.receiver,{enableTopn:!!se("ENABLE_AUDIO_TOPN"),enableMetadata:!!se("ENABLE_AUDIO_METADATA"),enablePts:!!se("ENABLE_AUDIO_PTS"),onMetadata:F=>{this.safeEmit(Ut.AudioMetadata,F)},onPts:F=>{this.safeEmit(Ut.AudioPts,F)}})}const C=this.remoteUserMap.get(e);C?C.set(r,m):this.remoteUserMap.set(e,new Map([[r,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex(O=>{let{user:W,kind:F}=O;return W.uid===e.uid&&r===F});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Ut.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==rr.Connected)throw new Le(ee.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],s=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);if(u){const{track:h,mid:m,transceiver:g,player:E}=u;s.set(c.ssrcId,{track:h,id:m,transceiver:g,player:E})}else r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{s.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:g,id:E,transceiver:S,player:C}=m;if(S&&se("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:W,interceptRemoteAudioFrame:F}=DP();u==Et.VIDEO?await W(S.receiver,{onSei:se("ENABLE_VIDEO_SEI")&&(B=>{var Z;return(Z=c._videoTrack)===null||Z===void 0?void 0:Z._onSei(B)})}):u==Et.AUDIO&&await F(S.receiver,{enableTopn:!!se("ENABLE_AUDIO_TOPN"),enableMetadata:!!se("ENABLE_AUDIO_METADATA"),enablePts:!!se("ENABLE_AUDIO_PTS"),onMetadata:B=>{this.safeEmit(Ut.AudioMetadata,B)},onPts:B=>{this.safeEmit(Ut.AudioPts,B)}})}if(u===Et.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new Gv(g,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new Wv(g,c.uid,c._uintid,this.store,C),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),se("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:W,interceptRemoteAudioFrame:F}=DP();u==Et.VIDEO?await W(S.receiver,{onSei:B=>{var Z;(Z=c._videoTrack)===null||Z===void 0||Z._onSei(B)}}):u==Et.AUDIO&&await F(S.receiver)}const A=this.remoteUserMap.get(c);A?A.set(u,E):this.remoteUserMap.set(c,new Map([[u,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const O=this.pendingRemoteTracks.findIndex(W=>{let{user:F,kind:B}=W;return F.uid===c.uid&&u===B});O!==-1&&(this.pendingRemoteTracks.splice(O,1),this.emit(Ut.MediaReconnectEnd,c.uid))}}async unsubscribe(e,r,s){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return r!==void 0?m.uid===e.uid&&r===g:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===rr.Connected||s||o.forEach(h=>{let{kind:m}=h;var g;if(m===Et.AUDIO)(g=e._audioTrack)===null||g===void 0||g._destroy(),e._audioTrack=void 0;else if(m===Et.VIDEO){var E;(E=e._videoTrack)===null||E===void 0||E._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==rr.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:g}]=h;var E,S;if(g===Et.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===Et.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(g===Et.AUDIO){var C;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((C=m._audioTrack)===null||C===void 0||C._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(e,r);if(s.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return s.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),s.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:g,kind:E}=m;return u!==void 0?g.uid===c.uid&&u===E:g.uid===c.uid});h.forEach(m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)}),r=r.concat(h)}if(!this.connection||this.state!==rr.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===Et.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===Et.VIDEO){var g;(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0}});const s=Ha(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const g=this.filterTobeUnSubscribedTracks(h,m);return c.concat(g)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[u,{kind:h}]=c;var m,g;if(h===Et.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Et.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0;else if(h===Et.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),(E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==rr.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===Et.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get(Ye.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get(Ye.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ui){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ye.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ye.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(e&&o===Ye.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,s,o,c){if(e){const h=this.localTrackMap.get(Ye.LocalAudioTrack),m=o?this.localTrackMap.get(Ye.LocalVideoLowTrack):this.localTrackMap.get(Ye.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(g=>g instanceof oi),m=o?(u=this.localTrackMap.get(Ye.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(g=>g instanceof Or);At.publish(this.store.sessionId,{eventElapse:ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,s,o){const c=o===Et.VIDEO?s._videoSSRC:s._audioSSRC;c&&At.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===Et.VIDEO,audio:o===Et.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:ro.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Zs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=zP(this.store),this.emit(Ut.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ye.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ui){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=rr.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ye.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ye.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof Or||r&&r.track instanceof oi?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!r||s.has(r))}getRemoteMedia(e){var r;const s=Array.from(Qa(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ye.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=x_(e).call(e,(s,o)=>s.level-o.level),e}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=rr.Reconnecting,se("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=zP(this.store),this.emit(Ut.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[s,{track:o}]=e;switch(s){case Ye.LocalVideoTrack:et(r=o._hints).call(r,_r.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ye.LocalAudioTrack:o instanceof Ui?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ye.LocalVideoLowTrack:}}),this.emit(Ut.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,s]=e;Array.from(Qa(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Ut.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,s]=e;Array.from(Qa(s).call(s)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const s of this.pendingRemoteDataChannels){const{user:o,id:c}=s;if((e instanceof qm?e.uid:e)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((e instanceof qm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return Ul(function*(){if(!r.connection||r.state!==rr.Connected)return;const s=yield Un(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Un(r.connection.restartICE(e));const u=yield Un(o.next());if(u.done)return;const h=u.value,m=yield h;switch(A2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case no.UDP_TCP_RELAY:r._pcStatsUploadType=uf.UDP_TCP_RESTART;break;case no.TCP_RELAY:r._pcStatsUploadType=uf.TCP_RESTART;break;case no.RELAY:r._pcStatsUploadType=uf.RELAY_RESTART;break;default:r._pcStatsUploadType=uf.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalAudioTrack),o=e.videoSend.find(O=>O.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=e.audioSend.find(O=>O.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Xc(this,Ut.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,E=(g&&u?(g+u)/2:g||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,C=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(_r.SCREEN_TRACK)===-1){const O=A._encoderConfig.bitrateMax,W=e.bitrate.actualEncoded;if(O&&W){const F=(1e3*O-W)/(1e3*O);return y9[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][C]}}return C}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(W=>W.ssrc===c),m=e.videoRecv.find(W=>W.ssrc===u);if(!h&&!m)return void(r+=1);const g=Xc(this,Ut.NeedSignalRTT),E=e.rtt,S=(E&&g?(E+g)/2:E||g)||0,C=h?h.jitterMs:void 0,A=e.recvPacketLossRate;let O=.7*A*100/50+.3*S/1500;C&&(O=.6*A*100/50+.2*S/1500+.2*C/400),r+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new gt((r,s)=>{this.handleMuteLocalTrack(e,r,s)})}async replaceTrack(e,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==rr.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ye.LocalVideoTrack&&!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const u=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new gt((m,g)=>{this.handleReplaceTrack(u.track,m,g,!0)})}}}filterTobePublishedTracks(e,r,s){const o=[],c=this.getAllTracks();e=Ov(e=e.filter(g=>c.indexOf(g)===-1));let u,h=!1;const m=this.localTrackMap.get(Ye.LocalAudioTrack);for(const g of e){if(g instanceof Or&&(this.localTrackMap.has(Ye.LocalVideoTrack)||h?new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:g,type:Ye.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(g,s);o.push({track:E,type:Ye.LocalVideoLowTrack})}if(g instanceof oi)if(m){const E=m.track;if(E instanceof Ui)C2([g]),E.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const S=I2([E,g]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(E,S)}}else u instanceof Ui?(C2([g]),u.addAudioTrack(g)):u||!g._useAudioElement&&Vn().webAudioMediaStreamDest&&!g._bypassWebAudio?u=I2(u?[g,u]:[g]):u=g}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Ye.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const r=[],s=this.getAllTracks();e=Ov(e=e.filter(o=>s.indexOf(o)!==-1));for(const o of e){if(o instanceof oi){const c=this.localTrackMap.get(Ye.LocalAudioTrack);if(!c)continue;c.track instanceof Ui?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ye.LocalAudioTrack,c]),c.track.close())):r.push([Ye.LocalAudioTrack,c])}if(o instanceof Or){const c=this.localTrackMap.get(Ye.LocalVideoTrack);if(!c)continue;r.push([Ye.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ye.LocalVideoLowTrack);u&&r.push([Ye.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(e){return e=(e=Ov(e)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ov(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ye.LocalVideoTrack:s.addListener(Tt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Tt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ui?e.trackList.forEach(s=>{s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Tt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),e.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ye.LocalVideoTrack:s.off(Tt.GET_STATS,this.handleGetLocalVideoStats),s.off(Tt.GET_RTC_STATS,this.handleGetRTCStats),s.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ui?e.trackList.forEach(r=>{r.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Tt.GET_STATS,this.handleGetLocalAudioStats),r.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Tt.GET_STATS,this.handleGetLocalAudioStats),e.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Tt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Wv&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),r instanceof Gv&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Tt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,s]=e;s.has(Et.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Et.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((s,o)=>{var c;let u,h,{track:m,type:g}=s;switch(g){case Ye.LocalAudioTrack:u=or.Audio,h={dtx:m instanceof Gw&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ye.LocalVideoTrack:u=et(c=m._hints).call(c,_r.SCREEN_TRACK)?or.Screen:or.High,h=Qh(Qh({},x9(m)),{},{codec:this.store.codec,svc_mode:AP()});break;case Ye.LocalVideoLowTrack:u=or.Low,h=Qh(Qh({},x9(m)),{},{codec:this.store.codec,svc_mode:AP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalVideoTrack:o=et(s=u._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Ye.LocalAudioTrack:o=or.Audio;break;case Ye.LocalVideoLowTrack:o=or.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Ut.PeerConnectionStateChange,r),r==="connecting"&&e instanceof Wl&&!Zr()&&se("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},se("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Wl&&PH(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=uf.DISCONNECTED_OR_FAILED,Xc(this,Ut.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));At.reportApiInvoke(this.store.sessionId,{name:li.REPUB_AFTER_PC_CONNECTED,options:s.concat(o),tag:Wr.TRACER}).onSuccess(),this.republish()}if(se("NEW_ICE_RESTART")&&e instanceof Wl&&!Zr()&&!this._forceTurn){if(et(A9).call(A9,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{A2(e)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Xc(this,Ut.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ut.RequestRestartICE,c))},o=()=>{A2(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ut.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{OH(e,s,o)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&se("ICE_RESTART")&&Xc(this,Ut.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ut.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ut.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ut.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),At.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Wr.TRACER}).onSuccess(),this.emit(Ut.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var s;const o=Array.from(Qa(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(jl.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,Yi.FIRST_AUDIO_DECODE,Vr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:ro.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var s;const o=Array.from(Qa(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&At.firstRemoteFrame(this.store.sessionId,Yi.FIRST_AUDIO_RECEIVED,Vr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:ro.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,s,o)=>{var c;const u=Array.from(Qa(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===r);u&&this.store.firstVideoFrameDecoded(u.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,s,o)},e.onFirstVideoRender=r=>{var s;const o=Array.from(Qa(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&(this.store.firstVideoFrameDecoded(o.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(o))},e.onFirstVideoReceived=r=>{var s;const o=Array.from(Qa(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&(this.store.firstVideoFrameDecoded(o.uid,{firstReceived:Date.now()}),At.firstRemoteFrame(this.store.sessionId,Yi.FIRST_VIDEO_RECEIVED,Vr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:ro.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(Ut.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Wm(s))," -> ").concat(JSON.stringify(Wm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Wm(s))," -> ").concat(JSON.stringify(Wm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Qh(Qh({},r),s)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof Wl&&function(r){rS.delete(r.id),PH(r)}(e),e.close(),this.emit(Ut.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const s=this.localTrackMap.get(Ye.LocalAudioTrack);if(e instanceof oi&&(s==null?void 0:s.track)instanceof Ui)return s.track.isActive||r.push([Ye.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Ye.LocalVideoTrack)){const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],s=this.localTrackMap.get(Ye.LocalAudioTrack);if(e instanceof oi&&(s==null?void 0:s.track)instanceof Ui)return s.track.isActive&&r.push([Ye.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ye.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:o=or.Audio;break;case Ye.LocalVideoTrack:o=et(s=u._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Ye.LocalVideoLowTrack:o=or.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:o=or.Audio;break;case Ye.LocalVideoTrack:o=et(s=u._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Ye.LocalVideoLowTrack:o=or.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const s=[],o=this.remoteUserMap.get(e);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([e,{kind:u,id:h}])});return s}filterTobeUnSubscribedDataChannels(e,r){const s=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&s.push(o)}),s}createUnsubscribeMessage(e){const r=[];return e.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case Et.VIDEO:return void(o._videoSSRC&&r.push({stream_type:Et.VIDEO,ssrcId:o._videoSSRC}));case Et.AUDIO:return void(o._audioSSRC&&r.push({stream_type:Et.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(s=>{let[o,{kind:c}]=s;if(r.has(o)){let u=r.get(o);c===Et.VIDEO?u|=ns.Video:u|=ns.Audio,r.set(o,u)}else c===Et.VIDEO?r.set(o,ns.Video):r.set(o,ns.Audio)}),{users:Array.from(r.entries()).map(s=>{let[o,c]=s;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new gt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new gt((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Wl&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Wl&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,r,s){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(g=>{let{stream_type:E}=g;return h===E}))===null||u===void 0?void 0:u.attributes;if(m&&se("DISABLE_SCREEN_SHARE_REMB")){const g=s[c]._hints;(et(g).call(g,_r.SCREEN_TRACK)||et(g).call(g,_r.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",g))}return m})}async tryToUnmuteAudio(e){for(let s=0;s<e.length;s++)if(e[s]instanceof oi){var r;const o=this.filterTobeUnmutedTracks(e[s]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await yr(this,Ut.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(Ut.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(Ut.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await vs(pL(this.dtlsFailedCount,Di)),this.emit(Ut.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await Us(this,Ut.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Ut.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ye.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Or)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof Or).length>1)throw new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof oi).length>1&&(e.some(r=>r instanceof oi&&r._bypassWebAudio)||!Vn().webAudioMediaStreamDest))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof Or&&this.pendingLocalTracks.some(s=>s instanceof Or))throw new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof oi&&this.pendingLocalTracks.some(s=>s instanceof oi)&&(!Vn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof oi&&s._bypassWebAudio)))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var s;const o=!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding,c=Qh(Qh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?e._mediaStreamTrack.clone():P2(e,c);const h=Er(8,"track-low-"),m=new Or(u,Qh(Qh({},o&&{scaleResolutionDownBy:l2(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(K_.TRANSCEIVER_UPDATED,g=>{e._updateRtpTransceiver(g,Uv.LOW_STREAM)}),m._hints.push(_r.LOW_STREAM),et(s=e._hints).call(s,_r.SCREEN_TRACK)&&m._hints.push(_r.SCREEN_LOW_TRACK),e.on("sei-to-send",g=>{m.emit("sei-to-send",g)}),e.addListener(Tt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Wl){var c,u,h,m;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:S,peerConnectionState:C}=this.connection,{local:A,remote:O}=await this.connection.getSelectedCandidatePair();At.pcStats(this.store.sessionId,{startTime:g,eventElapse:e-g||0,iceconnectionsate:E,dtlsstate:S,connectionstate:C,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=A==null?void 0:A.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=A.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(A.address,":").concat(A.port),selectedRemoteCandidateProtocol:(h=O.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=O.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(O.address,":").concat(O.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const r=this.store.keyMetrics,s=r.firstVideoFrameDecoded.find(S=>S.userId===e.uid);if(!s)return;const{isInternalUpload:o,isExternalUpload:c}=s;if(o&&c)return;const{subscribeEnd:u,firstPreRender:h,peerPublishDuration:m,peerPubStatusMs:g}=s;let{firstRender:E=0}=s;if(u&&(E||h)&&m&&g){s.isInternalUpload=!0;const{playEnd:S}=s;S&&(s.isExternalUpload=!0);const{firstPreRender:C=0}=s;E=C||E;const A=e.videoTrack,O={peer:e._uintid,width:(A==null?void 0:A._videoWidth)||0,height:(A==null?void 0:A._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:C||0,firstRender:S?Math.max(E,S):Math.max(E,u),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:iW(this.store)};At.firstXLAPeerFirstVideoFrame(this.store.sessionId,O)}}reportVideoFirstFrameDecoded(e,r,s,o){var c;const u=Array.from(Qa(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===u.uid&&g.type==="video");At.firstRemoteVideoDecode(this.store.sessionId,Yi.FIRST_VIDEO_DECODE,Vr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:ro.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,s){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:s}]=e;r===Ye.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Uv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Ct(wn.prototype,"startP2PConnection",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"startP2PConnection"),wn.prototype),Ct(wn.prototype,"connect",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),Ct(wn.prototype,"updateRemoteRTPCapabilities",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteRTPCapabilities"),wn.prototype),Ct(wn.prototype,"publishDataChannel",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"publishDataChannel"),wn.prototype),Ct(wn.prototype,"unpublish",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"unpublish"),wn.prototype),Ct(wn.prototype,"unpublishDataChannel",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishDataChannel"),wn.prototype),Ct(wn.prototype,"unpublishLowStream",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishLowStream"),wn.prototype),Ct(wn.prototype,"subscribeDataChannel",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"subscribeDataChannel"),wn.prototype),Ct(wn.prototype,"subscribe",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"subscribe"),wn.prototype),Ct(wn.prototype,"massSubscribe",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"massSubscribe"),wn.prototype),Ct(wn.prototype,"unsubscribe",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribe"),wn.prototype),Ct(wn.prototype,"unsubscribeDataChannel",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribeDataChannel"),wn.prototype),Ct(wn.prototype,"massUnsubscribe",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"massUnsubscribe"),wn.prototype),Ct(wn.prototype,"muteRemote",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),Ct(wn.prototype,"unmuteRemote",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),Ct(wn.prototype,"hasRemoteMediaWithLock",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"hasRemoteMediaWithLock"),wn.prototype),Ct(wn.prototype,"disconnectForReconnect",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"disconnectForReconnect"),wn.prototype),Ct(wn.prototype,"updateBitrateLimit",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"updateBitrateLimit"),wn.prototype),Ct(wn.prototype,"remoteMediaSsrcChanged",[xo],Object.getOwnPropertyDescriptor(wn.prototype,"remoteMediaSsrcChanged"),wn.prototype),wn);function xo(e,r,s){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},s}function DH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function xH(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?DH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):DH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const Mge=Date.now(),Uge=20,k2=new Map,KP=new Map;async function LH(e){const r=k2.get(e),s=Array.isArray(r)&&r[r.length-1],o=KP.get(e);if(!s)return void(o.isSyncing=!1);const c={uid:s.uid,payload:s.payload};o.firstRecvTs===0&&(o.firstRecvTs=s.recvTs,o.firstSendTs=s.sendTs);const u=s.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=s.mediaDelay+h;m<=0?(r.pop(),MH(s.context,c),m=0):m=Math.min(m,Uge),setTimeout(()=>r.length&&LH(e),m)}function MH(e,r){e.safeEmit(Tn.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function Vge(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return MH(s,{uid:e.uid,payload:e.payload});const o="".concat(s.id,"-").concat(e.uid),c=k2.get(o)||[],u=c.findIndex(E=>e.sendTs>=E.sendTs),h=xH(xH({},e),{},{context:s,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),k2.set(o,c);let m=!1;var g;KP.has(o)?m=!((g=KP.get(o))===null||g===void 0||!g.isSyncing):KP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||LH(o)}const Fge=Nn().name;function UH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function VH(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?UH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):UH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const iS="websdk_ng_cache_parameter",jge=se("MAX_PRELOAD_ASYNC_LENGTH"),Bge=1e4,ry=new Map,iy=[];let N2=null,D2=0,x2=0;const qP=new Map,zge=function(e,r){const s=[];let o=0;const c=async()=>{const u=s.shift();u&&await u(),s.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new gt(async(g,E)=>{s.push(async()=>{try{const S=await e(...h);g(S)}catch(S){E(S)}}),o<r&&(o++,c())})}}(FH,jge),L2=Ca.CancelToken.source();async function FH(e,r,s,o,c,u){try{if(!se("ENABLE_PRELOAD"))return;if(!Vn().supportWebCrypto)return void Mm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(ee.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&Es(s,"token",1,2047),Es(e,"appid",1,2047),bP(r),o&&wP(o);const h=H_();x.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:e,cname:r,token:s||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let g,E;typeof o=="string"?(m.stringUid=o,[E,g]=await gt.all([Rge(o,{sid:h,appId:e},L2.token),dH(VH(VH({},m),{},{token:s||e,uid:0}),L2.token)]),m.uid=E.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),g=await dH(m,L2.token));const S={sid:h,appId:e,cname:r,token:s||e,uid:m.stringUid||o,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:g};await async function(C){let A;try{C.uid&&BH({appId:C.appId,cname:C.cname,token:C.token,uid:C.uid,stringUid:C.stringUid});const O=HH(C),W=await async function(B,Z){try{const Q=await window.crypto.subtle.importKey("raw",kz(Z),"AES-GCM",!1,["encrypt"]),ae=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Q,G_(window.btoa(JSON.stringify(B))));return Um(new Uint8Array(ae))}catch{return}}(C,C.token||C.appId);if(!W)return;A=GH(iS);const F=A?JSON.parse(A):[];F.push({[O]:W}),F.length>se("AP_CACHE_NUM")&&F.shift(),YP(iS,JSON.stringify(F))}catch(O){x.warn("Error caching server parameters:",O.message),YP(iS,"")}}(S),D2++}catch(h){throw x2++,function(m){N2||(N2=window.setTimeout(()=>{let E="";qP.forEach((S,C)=>{E+="".concat(C,": ").concat(S," ;")}),At.reportApiInvoke(null,{name:li.PRELOAD,options:{success:D2,failed:x2,err:E}}).onError(m),D2=0,x2=0,qP.clear(),N2=null},Bge));const g=qP.get(m.code)||0;qP.set(m.code,g+1)}(h),h}}async function jH(e){try{if(se("AP_REQUEST_DETAIL")||se("ENABLE_ROLE_SELECT_EDGE"))return;const r=BH(e);if(!r||e.cloudProxyServer!=="disabled")return;const s=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",kz(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,G_(o));return JSON.parse(window.atob(Um(new Uint8Array(h))))}catch{return}}(r,e.token||e.appId);if(!s||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(s,e))return;if(s&&Date.now()-s.ts<se("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function BH(e){let r;try{if(r=GH(iS),!r)return;const s=JSON.parse(r),o=HH(e),c=function(h,m){for(let g=h.length-1;g>=0;g--)if(m(h[g]))return g;return-1}(s,h=>o in h);if(c===-1)return;const u=s.splice(c,1)[0];return YP(iS,JSON.stringify(s)),u[o]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),YP(iS,"")}}function M2(e){if(e){let r=ry.get(e);r&&(window.clearTimeout(r),r=null,ry.delete(e)),et(iy).call(iy,e)||e.cloudProxyServer!=="disabled"||iy.push(e)}if(ry.size<se("AP_CACHE_NUM")&&iy.length>0){const r=iy.shift();ry.set(r,window.setTimeout(async()=>{const{appId:s,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await zge(s,o,c,h,m,u),ry.has(r)&&M2(r)}catch(g){x.warn("update preload failed",g.message),zH(r)}},se("AP_UPDATE_INTERVAL")))}}function zH(e){const r=iy.indexOf(e);r!==-1&&iy.splice(r,1);let s=ry.get(e);s&&(window.clearTimeout(s),s=null,ry.delete(e),M2())}function WH(e,r){const s=e.sua,o=e.ap;r&&s&&At.reqUserAccount(e.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:e.intUid,errorCode:null,extend:s.req}),At.reportResourceTiming(e.ap.url,e.sid),At.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[wi.CHOOSE_SERVER,wi.CLOUD_PROXY_FALLBACK].toString()}),At.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[wi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function GH(e){return window.atob(window.localStorage.getItem(e)||"")}function YP(e,r){window.localStorage.setItem(e,window.btoa(r))}function HH(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),Vz(r)}function Wge(e){let r=function(){const s=$ge.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,o){let c=s.appId;c!==void 0&&(Ti(o,10),Xm(o,c));let u=s.cid;u!==void 0&&(Ti(o,16),Ti(o,u));let h=s.cname;h!==void 0&&(Ti(o,26),Xm(o,h));let m=s.deviceId;m!==void 0&&(Ti(o,34),Xm(o,m));let g=s.elapse;g!==void 0&&(Ti(o,40),Jm(o,g));let E=s.fileSize;E!==void 0&&(Ti(o,48),Jm(o,sS(E)));let S=s.height;S!==void 0&&(Ti(o,56),Jm(o,sS(S)));let C=s.jpg;C!==void 0&&(Ti(o,66),Ti(o,C.length),KH(o,C));let A=s.networkType;A!==void 0&&(Ti(o,72),Jm(o,sS(A)));let O=s.osType;O!==void 0&&(Ti(o,80),Jm(o,sS(O)));let W=s.requestId;W!==void 0&&(Ti(o,90),Xm(o,W));let F=s.sdkVersion;F!==void 0&&(Ti(o,98),Xm(o,F));let B=s.sequence;B!==void 0&&(Ti(o,104),Jm(o,sS(B)));let Z=s.sid;Z!==void 0&&(Ti(o,114),Xm(o,Z));let Q=s.timestamp;Q!==void 0&&(Ti(o,120),Jm(o,Q));let ae=s.uid;ae!==void 0&&(Ti(o,128),Ti(o,ae));let ye=s.vid;ye!==void 0&&(Ti(o,136),Ti(o,ye));let _e=s.width;_e!==void 0&&(Ti(o,144),Jm(o,sS(_e)));let ue=s.service;ue!==void 0&&(Ti(o,152),Ti(o,ue));let Ie=s.callbackData;Ie!==void 0&&(Ti(o,162),Ti(o,Ie.length),KH(o,Ie));let Ue=s.ticket;Ue!==void 0&&(Ti(o,170),Xm(o,Ue));let We=s.vendorConfigs;We!==void 0&&(Ti(o,178),Xm(o,We))}(e,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function Gge(e){return function(s){let o={};e:for(;!Kge(s);){let c=sT(s);switch(c>>>3){case 0:break e;case 1:o.code=sT(s);break;case 2:o.msg=qH(s,sT(s));break;case 3:o.requestId=qH(s,sT(s));break;case 4:o.timestamp=qge(s,!1);break;default:Hge(s,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function Hge(e,r){switch(r){case 0:for(;128&Vu(e););break;case 2:U2(e,sT(e));break;case 5:U2(e,4);break;case 1:U2(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function sS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let $ge=[];function U2(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function Kge(e){return e.offset>=e.limit}function XP(e,r){let s=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function $H(e,r){let s=e.offset;if(s+r>e.limit)throw new Error("Read past limit");return e.offset+=r,s}function KH(e,r){let s=XP(e,r.length);e.bytes.set(r,s)}function qH(e,r){let s=$H(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let g,E,S,C,A=c[m+s];(128&A)==0?h+=o(A):(224&A)==192?m+1>=r?h+=u:(g=c[m+s+1],(192&g)!=128?h+=u:(C=(31&A)<<6|63&g,C<128?h+=u:(h+=o(C),m++))):(240&A)==224?m+2>=r?h+=u:(g=c[m+s+1],E=c[m+s+2],(49344&(g|E<<8))!=32896?h+=u:(C=(15&A)<<12|(63&g)<<6|63&E,C<2048||C>=55296&&C<=57343?h+=u:(h+=o(C),m+=2))):(248&A)==240?m+3>=r?h+=u:(g=c[m+s+1],E=c[m+s+2],S=c[m+s+3],(12632256&(g|E<<8|S<<16))!=8421504?h+=u:(C=(7&A)<<18|(63&g)<<12|(63&E)<<6|63&S,C<65536||C>1114111?h+=u:(C-=65536,h+=o(55296+(C>>10),56320+(1023&C)),m+=3))):h+=u}return h}function Xm(e,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Ti(e,o);let c=XP(e,o),u=e.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Vu(e){return e.bytes[$H(e,1)]}function YH(e,r){let s=XP(e,1);e.bytes[s]=r}function sT(e){let r,s=0,o=0;do r=Vu(e),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function Ti(e,r){for(r>>>=0;r>=128;)YH(e,127&r|128),r>>>=7;YH(e,r)}function qge(e,r){let s,o=0,c=0,u=0;return s=Vu(e),o=127&s,128&s&&(s=Vu(e),o|=(127&s)<<7,128&s&&(s=Vu(e),o|=(127&s)<<14,128&s&&(s=Vu(e),o|=(127&s)<<21,128&s&&(s=Vu(e),c=127&s,128&s&&(s=Vu(e),c|=(127&s)<<7,128&s&&(s=Vu(e),c|=(127&s)<<14,128&s&&(s=Vu(e),c|=(127&s)<<21,128&s&&(s=Vu(e),u=127&s,128&s&&(s=Vu(e),u|=(127&s)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function Jm(e,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=XP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}const XH={},JH={},JP=4294967296,Yge=JP*JP,Xge=Yge/2;ZH(0,!0);const QH=ZH(0),Jge=oT(0,-2147483648,!1),Qge=oT(-1,2147483647,!1);function ZH(e,r){let s,o,c;return r?(c=0<=(e>>>=0)&&e<256)&&(o=JH[e],o)?o:(s=oT(e,0,!0),c&&(JH[e]=s),s):(c=-128<=(e|=0)&&e<128)&&(o=XH[e],o)?o:(s=oT(e,e<0?-1:0,!1),c&&(XH[e]=s),s)}function oT(e,r,s){return{low:0|e,high:0|r,unsigned:!!s}}function e7(e,r){if(isNaN(e))return QH;{if(e<=-9223372036854776e3)return Jge;if(e+1>=Xge)return Qge}return e<0?QH:oT(e%JP|0,e/JP|0,r)}function t7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}class V2 extends Xr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Fd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),q(this,"name","AgoraRTCImageModeration"),q(this,"_connectionState",zl.CONNECTING),q(this,"_sequence",0),q(this,"_moderationStartTime",void 0),q(this,"_workerConnection",void 0),q(this,"_workerMessageLengthLimit",void 0),q(this,"_qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",Ca.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"_moderationInterval",void 0),q(this,"_moderationTimer",null),q(this,"_moderationMode",1),q(this,"_quality",1),q(this,"_qualityTimer",null),q(this,"_ticket",void 0),q(this,"_moderationIntervalMinimum",void 0),q(this,"_uploadFailedNum",0),q(this,"_uploadNum",0),q(this,"_uploadTimer",null),q(this,"_extraInfo",void 0),q(this,"_vendor",""),q(this,"_encoder",new TextEncoder),q(this,"_moderationId",void 0),q(this,"inspectImage",()=>{if(this.connectionState!==zl.CONNECTED)throw new ke(ee.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===zl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Er(5,"image-moderation-"),this._workerMessageLengthLimit=se("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=se("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=se("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Yw("worker-"+this._moderationId,Di),this.on(Fd.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(qv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Fd.STATE_CHANGE,qv.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new gt((c,u)=>{this.on(Fd.CONNECTION_STATE_CHANGE,(h,m)=>{h===zl.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===zl.CONNECTED&&this.inspectImage()}async requestAP(r,s,o){const c=se("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),u=await function(g,E,S,C){let{appId:A,areaCode:O,cname:W,sid:F,token:B,uid:Z}=E;eS++;const Q="moderation_plugin",ae={service_name:Q,json_body:JSON.stringify({appId:A,areaCode:O,cname:W,command:"allocateEdge",requestId:eS,seq:eS,sid:F,appToken:B,ts:Date.now(),uid:Z+""})};let ye,_e,ue=g[0];return Ld(async()=>{ye=Date.now();const Ie=await jd(ue,{data:ae,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ye,Ie.code!==0){const Je=new ke(ee.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ie.code,{retry:!0,responseTime:_e});throw x.error(Je.toString()),Je}const Ue=JSON.parse(Ie.json_body);if(Ue.code!==200){const Je=new ke(ee.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ue.code,", reason: ").concat(Ue.reason),{code:Ue.code,responseTime:_e});throw x.error(Je.toString()),Je}if(!Ue.servers||!Array.isArray(Ue.servers)||Ue.servers.length===0){const Je=new ke(ee.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ue.code,responseTime:_e});throw x.error(Je.toString()),Je}if(!Ue.servers.some(Je=>!!Je.wss)){const Je=new ke(ee.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ue.code,responseTime:_e});throw x.error(Je.toString()),Je}const We=se("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ue.servers.map(Je=>{let{address:pn,wss:En}=Je;if(pn&&En)return"wss://".concat(pn.replace(/\./g,"-"),".").concat(We,":").concat(En,"/moderation")}).filter(Je=>!!Je),workerToken:Ue.workerToken,vid:Ue.vid,ticket:Ue.appTicket,responseTime:_e}},(Ie,Ue)=>(At.apworkerEvent(F,{success:!0,sc:200,serviceName:Q,responseDetail:JSON.stringify(Ie.addressList),firstSuccess:Ue===0,responseTime:_e,serverIp:g[Ue%g.length]}),!1),(Ie,Ue)=>(At.apworkerEvent(F,{success:!1,sc:Ie.data&&Ie.data.code||200,serviceName:Q,responseTime:_e,serverIp:g[Ue%g.length]}),!!(Ie.code!==ee.OPERATION_ABORTED&&Ie.code!==ee.UNEXPECTED_RESPONSE||Ie.data&&Ie.data.retry)&&(ue=g[(Ue+1)%g.length],!0)),C)}(c,r,s,o);this.emit(Fd.STATE_CHANGE,qv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(Fd.STATE_CHANGE,qv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(cn.CONNECTED,async()=>{this.emit(Fd.STATE_CHANGE,qv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=zl.CONNECTED}),this._workerConnection.on(cn.CLOSED,()=>{this.connectionState=zl.CLOSED}),this._workerConnection.on(cn.FAILED,()=>{this.connectionState=zl.CLOSED}),this._workerConnection.on(cn.RECONNECTING,()=>{this.connectionState=this.connectionState===zl.CONNECTED?zl.RECONNECTING:zl.CONNECTING}),this._workerConnection.on(cn.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=Gge(new Uint8Array(r.data));se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{At.reportApiInvoke(this._connectInfo.sid||null,{name:li.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Wr.TRACER}).onError(new ke(ee.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},se("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(cn.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(cn.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Xc(this,Fd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,s);this._workerConnection.sendMessage(o,!0,!0)}else se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:g}=s;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),C=await IW(S,o,c),A=this._sequence+"-"+u+"-"+g+"-"+E+"-"+Er(12,""),O={appId:o,cid:u,cname:c,deviceId:"",elapse:V2.intToLong(Number(E-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:C,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this._sequence,sid:m,timestamp:e7(E),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete O.callbackData;const W=Wge(O);if(W.byteLength<this._workerMessageLengthLimit){if(se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const F=function(B){for(var Z=1;Z<arguments.length;Z++){var Q=arguments[Z]!=null?arguments[Z]:{};Z%2?t7(Object(Q),!0).forEach(function(ae){q(B,ae,Q[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(Q)):t7(Object(Q)).forEach(function(ae){Object.defineProperty(B,ae,Object.getOwnPropertyDescriptor(Q,ae))})}return B}({},O);delete F.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(F))}return W}{const F=this.quality*this._qualityRatio;return this.quality=F,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ca.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=zl.CLOSED,this.emit(Fd.STATE_CHANGE,qv.CLOSED)}}function n7(e){if(gr(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ke(ee.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ke(ee.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Zge={name:"ImageModeration",create:function(e){let{config:r}=e;return n7(r),new V2(r)}};var r7,i7,s7,o7,a7,c7,l7,u7,d7,h7,p7,f7,m7,g7,_7,y7,E7,v7,S7,b7,w7,T7,R7,C7,I7,A7,P7,O7,k7,N7,D7,x7,L7,M7,U7,V7,F7,j7,B7,z7,W7,yt;function G7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Fu(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?G7(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):G7(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}Zs.setLogger(x);let e_e=(r7=Gt(),i7=Gt({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof jv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),s7=Gt({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Fv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),o7=Gt({argsMap:(e,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),a7=Gt({argsMap:(e,r,s)=>[r,s]}),c7=Gt({argsMap:(e,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return[o==null?void 0:o.uid,c]})}),l7=Gt({argsMap:(e,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),u7=Gt({argsMap:(e,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return{uid:o==null?void 0:o.uid,mediaType:c}})}),d7=Gt(),h7=Gt(),p7=Gt(),f7=Gt(),m7=Gt(),g7=Gt(),_7=Gt(),y7=Gt(),E7=Gt(),v7=Gt(),S7=Gt(),b7=Gt(),w7=Gt(),T7=Gt(),R7=Gt(),C7=Gt({argsMap:(e,r)=>[r]}),I7=Gt(),A7=Gt(),P7=Gt(),O7=Gt(),k7=Gt(),N7=Gt(),D7=Gt(),x7=Gt(),L7=Gt({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),M7=Gt(),U7=Gt(),V7=Gt(),F7=Gt(),j7=Gt(),B7=Gt(),z7=Gt({reportResult:!0}),W7=Gt(),yt=class extends Xr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let s;if(super(),q(this,"store",void 0),q(this,"_uid",void 0),q(this,"_channelName",void 0),q(this,"_uintUid",void 0),q(this,"_users",[]),q(this,"_config",void 0),q(this,"_clientId",void 0),q(this,"_appId",void 0),q(this,"_sessionId",null),q(this,"_key",void 0),q(this,"_rtmConfig",{}),q(this,"_joinInfo",void 0),q(this,"_gateway",void 0),q(this,"_statsCollector",void 0),q(this,"_configDistribute",void 0),q(this,"_leaveMutex",void 0),q(this,"_publishMutex",void 0),q(this,"_renewTokenMutex",void 0),q(this,"_subscribeMutex",void 0),q(this,"_encryptionMode","none"),q(this,"_encryptionSecret",null),q(this,"_encryptionSalt",null),q(this,"_encryptDataStream",!1),q(this,"_encryptDataStreamKey",null),q(this,"_encryptDataStreamIv",null),q(this,"_proxyServer",void 0),q(this,"_turnServer",{servers:[],mode:"auto"}),q(this,"_cloudProxyServerMode","disabled"),q(this,"_isDualStreamEnabled",!1),q(this,"_defaultStreamFallbackType",void 0),q(this,"_lowStreamParameter",void 0),q(this,"_streamFallbackTypeCacheMap",new Map),q(this,"_remoteStreamTypeCacheMap",new Map),q(this,"_axiosCancelSource",Ca.CancelToken.source()),q(this,"_audioVolumeIndicationInterval",void 0),q(this,"_networkQualityInterval",void 0),q(this,"_userOfflineTimeout",void 0),q(this,"_streamRemovedTimeout",void 0),q(this,"_liveTranscodeStreamingClient",void 0),q(this,"_liveRawStreamingClient",void 0),q(this,"_channelMediaRelayClient",void 0),q(this,"_networkQualitySensitivity","normal"),q(this,"_p2pChannel",void 0),q(this,"_useLocalAccessPoint",!1),q(this,"_setLocalAPVersion",void 0),q(this,"_joinAndNotLeaveYet",!1),q(this,"_numberOfJoinCount",0),q(this,"_joinResponse",null),q(this,"_remoteDefaultVideoStreamType",void 0),q(this,"_inspect",void 0),q(this,"_moderation",void 0),q(this,"_license",void 0),q(this,"_pendingPublishedUsers",[]),q(this,"ntpAlignErrorCount",0),q(this,"remoteInboundOffset",0),q(this,"_peerConnectionState",void 0),q(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),q(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),q(this,"_handleUserOnline",c=>{if(se("BLOCK_LOCAL_CLIENT")&&Z_(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(Tn.USER_JOINED,u));else{const h=new qm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(Tn.USER_JOINED,h)}}),q(this,"_handleUserOffline",c=>{if(se("BLOCK_LOCAL_CLIENT")&&Z_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:JA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Tn.USER_LEAVED,u,c.reason))}),q(this,"_handleAddAudioOrVideoStream",(c,u,h,m,g,E,S,C)=>{if(se("BLOCK_LOCAL_CLIENT")&&Z_(u,this.channelName))return;const A=this._users.find(W=>W.uid===u);if(!A)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(A.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(A.uid,{videoAddNotify:Date.now()});const O=c==="audio"?A.hasAudio:A.hasVideo;if(A._uintid||(A._uintid=E||u),c==="audio"?A._trust_audio_stream_added_state_=!0:A._trust_video_stream_added_state_=!0,c==="audio"?(A._audio_added_=!0,h!==void 0&&(A._audioSSRC=h),m!==void 0&&(A._cname=m),S&&(A._audioOrtc=S)):(A._video_added_=!0,h!==void 0&&(A._videoSSRC=h),m!==void 0&&(A._cname=m),C!==void 0&&(A._rtxSsrcId=C),S&&(A._videoOrtc=S)),(c==="audio"?A.hasAudio:A.hasVideo)&&!O&&(x.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published ").concat(c)),this.safeEmit(Tn.USER_PUBLISHED,A,c)),c==="video"?At.onGatewayStream(this._sessionId,Yi.ON_ADD_VIDEO_STREAM,Vr.ON_ADD_VIDEO_STREAM,{peer:E||u,ssrc:A._videoSSRC}):At.onGatewayStream(this._sessionId,Yi.ON_ADD_AUDIO_STREAM,Vr.ON_ADD_AUDIO_STREAM,{peer:E||u,ssrc:A._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(A,c,h).then(W=>{if(W&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof iT))return this._p2pChannel.unsubscribe(A,c,!0).then(()=>this._subscribe(A,c,!0).catch(F=>{x.error("[".concat(this._clientId,"] resubscribe error"),F.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(A,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after reconnect.")),this._subscribe(A,c,!0).catch(W=>{x.error("[".concat(this._clientId,"] resubscribe error"),W.toString())})),c==="video"&&!Ls()&&!_o()){const W=this._getEncodingName(g);(W==null?void 0:W.toLocaleLowerCase())==Bw.av1&&Tge().then(F=>{F||this._gateway.downgradeCodec(W)})}}),q(this,"_handleRemoveStream",c=>{if(se("BLOCK_LOCAL_CLIENT")&&Z_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Tn.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Tn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Tn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Tn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof iT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),At.onGatewayStream(this._sessionId,Yi.ON_REMOVE_STREAM,Vr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),q(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(se("BLOCK_LOCAL_CLIENT")&&Z_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const g=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const C=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(C)),this.safeEmit(Tn.USER_INFO_UPDATED,u,C)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const C=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(C)),this.safeEmit(Tn.USER_INFO_UPDATED,u,C)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return g!==E?!g&&E?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(Tn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(Tn.USER_UNPUBLISHED,m,c)):void 0}),q(this,"_handleMuteStream",(c,u,h)=>{if(se("BLOCK_LOCAL_CLIENT")&&Z_(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const C=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(C)),this.safeEmit(Tn.USER_INFO_UPDATED,c,C)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const C=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(C)),this.safeEmit(Tn.USER_INFO_UPDATED,c,C)}}const E=u==="audio"?m.hasAudio:m.hasVideo;if(g!==E){if(!g&&E)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(Tn.USER_PUBLISHED,m,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(Tn.USER_UNPUBLISHED,m,u)}}),q(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),q(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Tn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),q(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),q(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Tn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Tn.NETWORK_QUALITY,c)}),q(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const g=this._users.find(S=>S.uid===u);if(!g)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),m!==void 0&&(g._videoMid=m)),(c==="audio"?g.hasAudio:g.hasVideo)&&!E&&(x.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Tn.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=r||Er(5,"client-"),this.store=new class{constructor(c,u,h,m){Zt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:$_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case en.SET_SESSION_ID:return Qe(Qe({},u),{},{sessionId:h.sessionId});case en.SET_P2P_ID:return Qe(Qe({},u),{},{p2pId:h.p2pId});case en.SET_UID:return Qe(Qe({},u),{},{uid:h.uid});case en.SET_INT_UID:return Qe(Qe({},u),{},{intUid:h.intUid});case en.SET_PUB_ID:return Qe(Qe({},u),{},{pubId:h.pubId});case en.KEY_METRIC_CLIENT_CREATED:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{clientCreated:h.metric})});case en.KEY_METRIC_JOIN_START:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{joinStart:h.metric})});case en.KEY_METRIC_PRELOAD_START:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{preloadStart:h.metric})});case en.KEY_METRIC_PRELOAD_END:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{preloadEnd:h.metric})});case en.KEY_METRIC_JOIN_END:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{joinEnd:h.metric})});case en.KEY_METRIC_REQUEST_AP_START:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{requestAPStart:h.metric})});case en.KEY_METRIC_REQUEST_AP_END:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{requestAPEnd:h.metric})});case en.KEY_METRIC_REQUEST_SUA_END:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{requestSUAEnd:h.metric})});case en.KEY_METRIC_BEFORE_CONNECT:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{beforeConnect:h.metric})});case en.KEY_METRIC_PEER_RECEIVER:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{peerReceiver:h.metric})});case en.KEY_METRIC_SIGNAL_CONNECTED:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{signalConnected:h.metric})});case en.KEY_METRIC_JOIN_REQ:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{joinReq:h.metric})});case en.KEY_METRIC_JOIN_REP:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{joinRep:h.metric})});case en.KEY_METRIC_JOIN_GATEWAY_START:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case en.KEY_METRIC_JOIN_GATEWAY_END:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case en.KEY_METRIC_PEER_CONNECTION_START:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case en.KEY_METRIC_PEER_CONNECTION_END:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case en.KEY_METRIC_DESCRIPTION_START:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{descriptionStart:h.metric})});case en.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case en.KEY_METRIC_ICE_CONNECTION_END:return Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case en.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,g=m.findIndex(E=>E.trackId===h.metric.trackId);return g!==-1?(m[g]=Qe(Qe({},m[g]),h.metric),Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{publish:[...m]})})):Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case en.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,g=m.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return g!==-1?(m[g]=Qe(Qe({},m[g]),h.metric),Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{subscribe:[...m]})})):Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case en.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const m=u.keyMetrics.firstVideoFrameDecoded,g=m.findIndex(E=>E.userId===h.metric.userId);return g!==-1?(m[g]=Qe(Qe({},m[g]),h.metric),Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):Qe(Qe({},u),{},{keyMetrics:Qe(Qe({},u.keyMetrics),{},{firstVideoFrameDecoded:[...u.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case en.RESET_FIRST_VIDEO_FRAME_DECODED:return u.keyMetrics.firstVideoFrameDecoded=[],u;case en.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case en.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=Qe(Qe({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case en.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case en.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},u;case en.SET_USE_P2P:return Qe(Qe({},u),{},{useP2P:h.val});case en.SET_TRANSPORT_TYPE:return Qe(Qe({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:en.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:en.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:en.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:en.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:en.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:en.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:en.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:en.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:en.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:en.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:en.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:en.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:en.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:en.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:en.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:en.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:en.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:en.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:en.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:en.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:en.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:en.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:en.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:en.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:en.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:en.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,u){this.dispatch({type:en.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Qe({userId:c},u)})}descriptionStart(){this.dispatch({type:en.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:en.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:en.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:en.KEY_METRIC_PUBLISH,metric:Qe(Qe({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,g,E,S){this.dispatch({type:en.KEY_METRIC_SUBSCRIBE,metric:Qe(Qe(Qe(Qe(Qe({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),E&&{streamAdded:E}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(g=>{this.dispatch({type:en.KEY_METRIC_SUBSCRIBE,metric:Qe(Qe(Qe({userId:g.userId,type:g.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:en.RECORD_JOIN_CHANNEL_SERVICE,record:Qe(Qe({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:en.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:en.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:en.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:en.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Zs("client-leave",this._clientId),this._publishMutex=new Zs("client-publish",this._clientId),this._renewTokenMutex=new Zs("client-renewtoken",this._clientId),this._subscribeMutex=new Zs("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Vl," build: ").concat(wL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{uL(e.clientRoleOptions),s=Object.assign({},e.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new nT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),c===b2.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(m=>{m instanceof dP&&se("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()}),this.safeEmit(Tn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const g=this._users.find(E=>E.uid===c);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),At.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(se("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const u=this.localTracks.find(h=>h instanceof Or);u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(c==="h264"?se("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new yge(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Di,httpRetryConfig:e.httpRetryConfig||Di,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:s}),this._configDistribute=new Pge(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},df("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new iT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,s,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];hr("JOIN_GATEWAY_USE_443PORT_ONLY",u),hr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof a2&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(g,E,S){$A.get(g)||$A.set(g,[]),KA.get(g)||KA.set(g,E),Gh.get(g)||Gh.set(g,0);const C=$A.get(g),A=KA.get(g);if(!C||!A)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Gh.get(g)===A){const Z=Nw();C.push(Z),await Z.promise}Gh.set(g,Gh.get(g)+1);for(var O=arguments.length,W=new Array(O>3?O-3:0),F=3;F<O;F++)W[F-3]=arguments[F];const B=await S(...W);return Gh.set(g,Gh.get(g)-1),Gh.get(g)===A-1&&C.length>0&&(C[0].resolve(),C.shift()),Gh.get(g)===0&&($A.set(g,[]),KA.set(g,0),Gh.set(g,0)),B}("client.join",se("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,s,o,c)}async join(e,r,s,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(eP||eP||(eP=(window.location.protocol.split(":")[0]||"").toUpperCase(),eP))==="HTTPS",m=Bz()?window.isSecureContext:"Browser Not Support";(!Bz()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;At.setAppId(e);try{if(!s&&s!==null)throw new ke(ee.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&Es(s,"token",1,2047),Es(e,"appid",1,2047),bP(r),o&&wP(o),c)if(typeof c=="string")Es(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new ke(ee.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:B,enableInstantMuteRestore:Z}=c;B&&(xd(B,"autoSubscribe"),x.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(B)),this.store.autoSubscribe=B),Z&&(xd(Z,"enableInstantMuteRestore"),x.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(Z)),this.store.enableInstantMuteRestore=Z)}}}catch(B){throw At.reportApiInvoke(H_(),{name:li.JOIN,options:[e,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}).onError(B),B}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const B=new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw At.reportApiInvoke(H_(),{name:li.JOIN,options:[e,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}).onError(B),B}this._gateway.state="CONNECTING",this.store.preloadStart();const E=await jH({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:s||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const S=(E==null?void 0:E.sid)||H_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=S,this.store.sessionId=this._sessionId);const C=At.reportApiInvoke(S,{id:this._clientId,name:li.JOIN,options:[e,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}),A=Fu(Fu(Fu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!E},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:se("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(A.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(A.stringUid=o,this._uintUid?(A.uid=this._uintUid,this._uintUid=void 0):A.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(A.aesmode=this._encryptionMode,A.aespassword=await(async B=>{const Z=function(_e){const ue=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Ie=new Uint8Array(new ArrayBuffer(ue.length));for(let Ue=0;Ue<ue.length;Ue+=1)Ie[Ue]=ue.charCodeAt(Ue);return Ie}(),Q=await window.crypto.subtle.importKey("spki",Z,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ae=cL(B),ye=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Q,ae);return function(_e){let ue="";for(let Ie=0;Ie<_e.length;Ie+=1)ue+=String.fromCharCode(_e[Ie]);return window.btoa(ue)}(new Uint8Array(ye))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(A.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const B=new TextEncoder,Z=se("USE_PURE_ENCRYPTION_MASTER_KEY")?B.encode(A.appId+this._encryptionSecret+this._encryptionSecret):B.encode(A.appId+A.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Q,ae,ye){const _e=await window.crypto.subtle.importKey("raw",ae,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Q==="aes-128-gcm2"?128:256,Ie=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:Jz,hash:"SHA-256",salt:ye},_e,ue+qfe);return new Uint8Array(Ie).subarray(ue/8)}(this._encryptionMode,Z,G_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Q,ae,ye){const _e=await window.crypto.subtle.importKey("raw",ae,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:Jz,hash:"SHA-256",salt:ye},_e,{name:"AES-GCM",length:ue},!0,["encrypt","decrypt"])}(this._encryptionMode,Z,G_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:A.stringUid});const O=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&O===this._sessionId&&At.joinChannelTimeout(this._sessionId,5)},5e3);try{var W;let B;const Z=A.cloudProxyServer;if(et(W=["proxy3","proxy4","proxy5"]).call(W,Z)){const ue=se("PROXY_SERVER_TYPE3");Array.isArray(ue)?A.proxyServer=ue[0]:A.proxyServer=ue}if(At.setProxyServer(A.proxyServer),x.setProxyServer(A.proxyServer),this.store.requestAPStart(),E){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(A.stringUid?", ".concat(A.stringUid," => ").concat(E.intUid):""," ")),A.stringUid&&!A.uid&&(A.uid=E.intUid),B={gatewayInfo:E.ap.gatewayInfo},se("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&A.turnServer.mode==="auto")if(E.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ue=(await M9(E.ap.proxyInfo,E.ap.gatewayInfo.uid)).map(Ie=>({turnServerURL:Ie.address,tcpport:Ie.tcpport||Vs.tcpport,udpport:Ie.udpport||Vs.udpport,username:Ie.username||Vs.username,password:Ie.password||Vs.password,forceturn:!1,security:!0}));A.turnServer={mode:"manual",servers:ue}}WH(E,A.stringUid)}else{if(A.stringUid&&!A.uid){let ue;[ue,B]=await gt.all([uH(A.stringUid,A,this._axiosCancelSource.token,this._config.httpRetryConfig||Di,this.store).finally(()=>{this.store.requestSUAEnd()}),lH(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Di,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(A.stringUid," => ").concat(ue)),A.uid=ue,B.gatewayInfo.uid=ue,B.gatewayInfo.res.uid=ue}else B=await lH(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Di,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(A,this._axiosCancelSource.token),this._configDistribute.on(Kw.UPDATE_BITRATE_LIMIT,ue=>{this._p2pChannel.updateBitrateLimit(ue)}),this._configDistribute.on(Kw.UPDATE_CLIENT_ROLE_OPTIONS,ue=>{this._setClientRoleOptions(ue)})},0),this._key=s||e;const Q=B.gatewayInfo,ae=A.uid?A.uid:Q.uid;this._joinInfo=Fu(Fu({},A),{},{cid:Q.cid,uid:ae,vid:Q.vid,apResponse:Q.res,apGatewayAddress:Q.apGatewayAddress,uni_lbs_ip:Q.uni_lbs_ip,gatewayAddrs:Q.gatewayAddrs}),this.store.intUid=ae,this.store.cid=Q.cid;const ye=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));C.onSuccess(ye),this._appId=e,this._channelName=A.cname,this._uid=ye,this.store.uid=ye,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ls()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _e=A.stringUid?"string uid: ".concat(A.stringUid,",uid: ").concat(A.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_e)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),F=this,et(Q_).call(Q_,F)||Q_.push(F),this._cloudProxyServerMode==="disabled"&&Vn().supportWebCrypto&&se("ENABLE_PRELOAD")&&M2(this._joinInfo),ye}catch(B){const Z=Array.isArray(B)?B[0]:B;throw Z&&Z.code===ee.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),Z):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),Z),Z.code!==ee.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),C.onError(Z),Z}var F}_joinGateway(){if(!this._joinInfo||!this._key)throw new ke(ee.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!se("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ls()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=Q_.indexOf(r);s!==-1&&Q_.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",nr.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof jv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ke(ee.INVALID_PARAMS,"param list is empty");const s=e;if(this._gateway.role==="audience")throw new ke(ee.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof jv))throw new ke(ee.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new ke(ee.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof Or&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){if(e==null)throw new ke(ee.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));gr(e.id,"id",0,65535,!0),xd(e.ordered,"ordered"),Es(e.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new ke(ee.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ke(ee.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&se("FORCE_TURN")&&!se("TURN_ENABLE_TCP")&&!se("TURN_ENABLE_UDP"))throw new ke(ee.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return eH(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([s]);if(o.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ke(ee.CREATE_DATACHANNEL_ERROR);try{await gt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==ee.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ke(ee.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof jv))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(gi.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{s&&s()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(e);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(e,r,s){if(!(e instanceof qm)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new ke(ee.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,s):this._subscribe(e,r)}async presubscribe(e,r){if(qi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new ke(ee.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===Et.AUDIO,o=r===Et.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:g,uint_id:E}=await this._gateway.presubscribe(e,r,!0);if(u==null)throw new ke(ee.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(A=>A.uid===e);S||(S=new qm(e,E||e),S._is_pre_created=!0,this._users.push(S)),g&&(S._cname=g),S._uintid||(S._uintid=E||e),s&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const C=s?S._audioTrack:S._videoTrack;if(!C)throw new ke(ee.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),C}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,r){var s;if(gr(r,"channelId",0,65535,!0),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ke(ee.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ke(ee.INVALID_REMOTE_USER,"user is not published");const c=(s=e._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ke(ee.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&et(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ke(ee.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==ee.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),g;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,r,s){if(qi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new ke(ee.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new ke(ee.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!s&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const u=new ke(ee.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const h=r==="audio"?e._audioSSRC:e._videoSSRC,m=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new ke(ee.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,r,s){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(qi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===e)){const E=new ke(ee.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),E}if(!e.hasAudio&&!e.hasVideo){const E=new ke(ee.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),E}if(!(s||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const E=new ke(ee.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?e._audioSSRC:e._videoSSRC,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?Et.AUDIO:Et.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const S=r==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?Et.AUDIO:Et.VIDEO,ssrcId:c}),ro.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(C){if((C==null?void 0:C.code)!==ee.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),C;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,r),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const E=r==="audio"?e._audioTrack:e._videoTrack;if(!E)throw new ke(ee.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),E}catch(E){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),E),E}finally{g()}}async massSubscribe(e){if(af(e,"subscribeList"),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:g,mediaType:E}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(E)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:g,mediaType:E}=m;return{user:g,mediaType:E}}),u=await this._p2pChannel.globalLock();try{var h;for(let g=e.length-1;g>=0;g--){const E=e[g],{user:S,mediaType:C}=E;if(qi(C,"mediaType",["audio","video"]),!S){const F=new ke(ee.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),F}if(!this._users.find(F=>F===S)){const F=new ke(ee.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[g].error=F,e.splice(g,1);continue}if(C==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||C==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const F=new ke(ee.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(C,", remote user is not published")),c[g].error=F,e.splice(g,1);continue}const O=ns.Video|ns.LwoVideo,W=s.get(S);if(W){if(C==="video"?W&O:W&ns.Audio){e.splice(g,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(C," twice"));continue}s.set(S,W|(C==="video"?O:ns.Audio))}else s.set(S,C==="video"?O:ns.Audio)}for(let g=e.length-1;g>=0;g--){const E=e[g],{user:S,mediaType:C}=E,A=ns.Video|ns.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,C)){await this._p2pChannel.unmuteRemoteNoLock(S,C);const O=s.get(S);s.set(S,C==="video"?O^A:O^ns.Audio),e.splice(g,1)}}this.store.massSubscribe(e.map(g=>({userId:g.user.uid,type:g.mediaType})),r);let m=Ha(h=Array.from(s.entries())).call(h,(g,E)=>{let[S,C]=E;if(C===0)return g;const A={stream_id:S.uid,stream_type:C};return C&ns.Audio&&(A.audio_ssrc=S._audioSSRC),C&ns.Video&&(A.video_ssrc=S._videoSSRC),g.push(A),g},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(E=>{let{user:S,mediaType:C}=E;return{user:S,mediaType:C,ssrcId:C===Et.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:C===Et.VIDEO?S._rtxSsrcId:void 0}}));const g=new Map;if(m=m.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach(S=>{let{stream_id:C,video_error_code:A,audio_error_code:O,error_code:W}=S;(A||O||W)&&g.set(C,{video_error_code:A,audio_error_code:O,error_code:W})})}if(Array.from(g.entries()).length>0){const E=[];Array.from(g.entries()).forEach(S=>{let[C,A]=S;const O=this.remoteUsers.find(W=>W.uid===C);if(O){let W;A.error_code||A.video_error_code&&A.audio_error_code?W=void 0:A.video_error_code?W=Et.VIDEO:A.audio_error_code&&(W=Et.AUDIO),E.push({user:O,mediaType:W})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const S=g.get(E.user.uid);if(S){const C=S.error_code||E.mediaType==="audio"&&S.audio_error_code||E.mediaType==="video"&&S.video_error_code;if(C){const A=qw(C);x.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(A.desc)),E.error=new ke(ee.SUBSCRIBE_FAILED,"code ".concat(C,": ").concat(A.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var S;At.subscribe(this.store.sessionId,{succ:!!E.error,ec:((S=E.error)===null||S===void 0?void 0:S.code)||null,video:E.mediaType===Et.VIDEO,audio:E.mediaType===Et.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===Et.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(E=>{let{user:S,mediaType:C}=E;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(C)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(e),g}}finally{u(),o()}}async unsubscribe(e,r,s){if(!(e instanceof qm)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new ke(ee.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,s)}else await this._unsubscribeDataChannel(e,s);if(r&&qi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new ke(ee.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const u=await this._p2pChannel.unsubscribe(e,r);u&&await this._gateway.unsubscribe(u,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&JA(this._users,e),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===ee.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,r){if(r&&gr(r,"id",0,65535,!0),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new ke(ee.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=e._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new ke(ee.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===ee.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(af(e,"unsubscribeList"),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(s=>{let{user:o,mediaType:c}=s;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const r=new Map;for(let s=e.length-1;s>=0;s--){const{user:o,mediaType:c}=e[s];if(!o){const m=new ke(ee.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(qi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(s,1);continue}const h=ns.Video|ns.LwoVideo;if(r.has(o)){const m=r.get(o);let g;switch(c){case"video":g=m&h;break;case"audio":g=m&ns.Audio;break;default:g=m&(ns.Audio|h)}if(g){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(s,1);continue}c?c==="audio"?r.set(o,m|ns.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|ns.Audio|h)}else c?c==="audio"?r.set(o,ns.Audio):c==="video"&&r.set(o,h):r.set(o,ns.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(e);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(s){if(s.code===ee.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(e){(function(s){if(!s)throw new Le(ee.INVALID_PARAMS);ei(s.width)||oL(s.width,"streamParameter.width"),ei(s.height)||oL(s.height,"streamParameter.height"),ei(s.framerate)||oL(s.framerate,"streamParameter.framerate"),ei(s.bitrate)||gr(s.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ye.LocalVideoLowTrack)}async enableDualStream(){if(!Vn().supportDualStream)throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ke(ee.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ke(ee.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ye.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(o){qi(o,"role",["audience","host"])}(e),r&&uL(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ke(ee.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new ke(ee.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ke(ee.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==s&&se("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",Ms.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),x.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&uL(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(Es(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new ke(ee.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ke(ee.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,At.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new ke(ee.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ke(ee.INVALID_OPERATION,"You have already set the proxy")}if(Mw(e))return this._turnServer={servers:e,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(s=>s.urls).join(","),"."));e.forEach(s=>Pz(s)),this._turnServer={servers:e,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ke(ee.INVALID_OPERATION,"you should set license before join channel");if(Es(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ke(ee.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,x.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ke(ee.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ke(ee.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ke(ee.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new ke(ee.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ke(ee.INVALID_OPERATION,"Stop proxy server after leave channel");At.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ke(ee.INVALID_PARAMS,"accessPoints is required.");af(e.accessPoints.serverList,"accessPoints.serverList"),Es(e.accessPoints.domain,"accessPoints.domain");const r=(A,O)=>{gr(A,O,0,65535,!0)};let s=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),s=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ke(ee.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");se("CLOSE_AFB_FOR_LOCAL_AP")&&(hr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),hr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(A=>o.test(A)?"".concat(A.replace(/\./g,"-"),".").concat(c):A),h=u.map(A=>"".concat(A,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,hr("WEBCS_DOMAIN",h),hr("WEBCS_DOMAIN_BACKUP_LIST",h),hr("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(af(e.report.hostname,"report.hostname"),hr("EVENT_REPORT_DOMAIN",e.report.hostname[0]),hr("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(hr("EVENT_REPORT_DOMAIN",u[0]),hr("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),m=e.report.port),hr("STATS_COLLECTOR_PORT",m),e.report?hr("ENABLE_EVENT_REPORT",!0):hr("ENABLE_EVENT_REPORT",!1);let g="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(af(e.log.hostname,"log.hostname"),g=e.log.hostname[0]):g=u[0];let E=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),E=e.log.port),hr("LOG_UPLOAD_SERVER","".concat(g,":").concat(E));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(af(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let C=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),C=e.cds.port),hr("CDS_AP",S.map(A=>"".concat(A,":").concat(C))),e.cds?hr("ENABLE_CONFIG_DISTRIBUTE",!0):hr("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(af(e,"serverList"),Es(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ke(ee.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>s.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,hr("WEBCS_DOMAIN",e),hr("WEBCS_DOMAIN_BACKUP_LIST",e),hr("GATEWAY_DOMAINS",[r]),hr("EVENT_REPORT_DOMAIN",e[0]),hr("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),hr("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(qi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){qi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const s=this._users.find(o=>o.uid===e);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){qi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,s,o){(function(u){qi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Es(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(et(c).call(c,e)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new ke(ee.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new ke(ee.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(xd(o,"encryptDataStream"),!et(c).call(c,e))throw new ke(ee.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,s&&(this._encryptionSalt=Um(s))}async renewToken(e){if(Es(e,"token",1,2047),!this._key||!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const s=await this._renewTokenMutex.lock();try{if(se("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Age(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Di);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Tn.VOLUME_INDICATOR,e)},se("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new ke(ee.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ke(ee.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ke(ee.LIVE_STREAMING_TASK_CONFLICT);const s=r?cf.TRANSCODE:cf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(e,s)}setLiveTranscoding(e){return this._createLiveStreamingClient(cf.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(e));if(!r.length)throw new ke(ee.INVALID_PARAMS,"can not find live streaming url to stop");await gt.all(r.map(s=>s&&s.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){gH(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){gH(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof iT&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&et(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const g=Ha(m=Array.from(h)).call(m,(F,B)=>F+B,0),E={serverTs:0,seq:Yfe++,length:h.length,checkSum:g},S=new Uint8Array(Uz(g,2)),C=new ArrayBuffer(xv),A=new DataView(C);A.setUint32(0,E.serverTs),A.setUint16(4,E.seq),A.setUint16(6,E.length),A.setUint16(8,E.checkSum);const O=16-h.length%16;h=Nz(h,new Uint8Array(O));const W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:Xz,additionalData:S},u,h);return Nz(new Uint8Array(C),new Uint8Array(W))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ke(ee.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Yt.DATA_STREAM,{payload:Um(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Mge},!s)}sendMetadata(e){if(!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ke(ee.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Yt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Um(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(ime),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"can not send custom report, not joined");await At.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(se("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map(s=>s.uid+"");Object.keys(e).forEach(s=>{et(r).call(r,s)||delete e[s]})}return e}async pickSVCLayer(e,r){qi(r.spatialLayer,"spatialLayer",[0,1,2,3]),qi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:s}=e;if(xd(r,"apRTM"),gr(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(e){const r=$v.indexOf(e);r!==-1&&$v.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ca.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&zH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&At.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Zs("client-publish",this._clientId),this._subscribeMutex=new Zs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var s;const o=e||H_();e?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,At.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};At.sessionInit(this._sessionId,Fu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ke(ee.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&se("FORCE_TURN")&&!se("TURN_ENABLE_TCP")&&!se("TURN_ENABLE_UDP"))throw new ke(ee.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await s.next()).value;if(o){try{await this._gateway.sendExtensionMessage(gi.PUBLISH,o,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==ee.DISCONNECT_P2P)throw s.throw(u),u}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof Or&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,e),(s==null?void 0:s.code)===ee.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ke(ee.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(ee.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==ee.DISCONNECT_P2P)throw s.throw(u),u}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===ee.WS_ABORT)return;throw s}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new ke(ee.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},df("LiveStreaming").create(o));var o;return s.onLiveStreamError=(c,u)=>{At.reportApiInvoke(this._sessionId,{name:li.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Wr.TRACER}).onSuccess(),this.safeEmit(Tn.LIVE_STREAMING_ERROR,c,u)},s.onLiveStreamWarning=(c,u)=>{At.reportApiInvoke(this._sessionId,{name:li.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Wr.TRACER}).onSuccess(),this.safeEmit(Tn.LIVE_STREAMING_WARNING,c,u)},s.on(i2.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new ke(ee.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,E,S){const C=se("UAP_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(A=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap"));return await Sge(C,m,g,E,S)})(c,this._joinInfo,this._axiosCancelSource.token,Di).then(u).catch(h)}),s};return e===cf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ke(ee.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},df("ChannelMediaRelay").create(e));o.on("state",c=>{c===Za.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(Tn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(Tn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:s,deleted:o}=e,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(g=>g.uid!==h._uintid||g.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m,ordered:g,max_retrans_times:E,metadata:S}=u,C=this._users.find(A=>A._uintid===h);if(!C)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),et(c).call(c,C)||c.push(C),C._uintid||(C._uintid=h),C._dataChannels.findIndex(A=>A.id===u.stream_id)===-1){const A={id:m,ordered:!!g,maxRetransmits:E,metadata:S},O=function(W){return eH(W,!0)}(A);C._dataChannels.push(O),x.info("[".concat(this._clientId,"] remote user ").concat(C.uid," published datachannel")),r||this.safeEmit(Tn.USER_PUBLISHED,C,"datachannel",A)}this._p2pChannel.hasPendingRemoteDataChannel(C,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(C.uid," after reconnect.")),this._subscribeDataChannel(C,u.stream_id).catch(A=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),A.toString())}))}),r&&(this.safeEmit(Tn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,g=this._users.find(S=>S._uintid===h);if(!g)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=g._dataChannels.find(S=>S.id===u.stream_id);E&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[E]).then(S=>{if(g._dataChannels=g._dataChannels.filter(C=>C!==E),S)return this._gateway.unsubscribeDataChannel(S,g.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(Tn.USER_UNPUBLISHED,g,"datachannel",E._config))})}_getEncodingName(e){var r;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(s)for(const c of s){var o;if(c.payloadType===e)return c==null||(o=c.rtpMap)===null||o===void 0?void 0:o.encodingName}}_handleRemoveDataChannels(e){const r=this._users.find(s=>s.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(Tn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(us.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),s=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=s||u||JL()||!Object.prototype.hasOwnProperty.call(rP,o)||(Md[o]=c,Ur[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(us.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(us.CONNECTION_STATE_CHANGE,(e,r,s)=>{var o;if(s===nr.FALLBACK)return;const c=()=>{this.safeEmit(Tn.CONNECTION_STATE_CHANGE,e,r,s)};if(At.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:li.CONNECTION_STATE_CHANGE,options:[e,r,s],tag:Wr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(g=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(g=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Et.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Et.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(us.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new ke(ee.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const o=await jH(Fu(Fu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(s=o.ap,WH(o),this._joinInfo.preload=!0):(s=await v2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Di,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,g]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:g}):c.push({host:m,port:g})}),e(c)}catch(s){r(s)}}),this._gateway.on(us.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Tn.NETWORK_QUALITY,e)}),this._gateway.on(us.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(Tn.STREAM_TYPE_CHANGED,e,r),At.reportApiInvoke(this._sessionId,{name:li.STREAM_TYPE_CHANGE,options:[e,r],tag:Wr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(us.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(us.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,s)=>{try{let o=await this._p2pChannel.getEstablishParams();o&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){s(o)}}),this._gateway.on(us.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let s;this._joinResponse=e,e.attributes?s=e.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=z9(e.ortc,r,s);this._p2pChannel.connect(o)}),this._gateway.on(us.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:s,turnServer:o}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:u,cid:h}=this._joinInfo.apResponse,m="".concat(h,"_").concat(u);if(m.length<4||m.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:o,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(u),icePwd:"".concat(h,"_").concat(u)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=se("FINGERPRINT"))!==null&&c!==void 0?c:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(g){g.code&&g.code===ee.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:o,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Rn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Rn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Rn.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Rn.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Rn.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Rn.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Rn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Rn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Rn.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Et.AUDIO,!0)),this._gateway.signal.on(Rn.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Et.AUDIO,!1)),this._gateway.signal.on(Rn.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Et.VIDEO,!0)),this._gateway.signal.on(Rn.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Et.VIDEO,!1)),this._gateway.signal.on(Rn.RECEIVE_METADATA,e=>{const r=G_(e.metadata);this.safeEmit(Tn.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(Rn.ON_DATA_STREAM,async e=>{var r;if(!e)return;let s=G_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&et(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<xv)throw new ke(ee.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(xv));s=await async function(u,h,m){const g=m.subarray(0,xv),E=g.slice(8,xv),S=(E[0]<<8)+E[1],C=(g[6]<<8)+g[7],A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:Xz,additionalData:new Uint8Array(Uz(S,2))},h,m.subarray(xv));return new Uint8Array(A).subarray(0,C)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Vge(Fu(Fu({},e),{},{payload:s}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Rn.ON_CRYPT_ERROR,()=>{Mm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Tn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Rn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,nr.TOKEN_EXPIRE),this.safeEmit(Tn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Rn.ON_STREAM_FALLBACK_UPDATE,e=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Tn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Rn.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Rn.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Rn.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Qt.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case Yt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,o;const u=c.some(g=>{let{stream_type:E}=g;return E===or.Audio}),h=c.some(g=>{let{stream_type:E}=g;return E!==or.Audio}),m=c.some(g=>{let{stream_type:E}=g;return E===or.Screen||E===or.ScreenLow});r.state==="offer"&&At.publish(this._joinInfo.sid,{eventElapse:ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:ee.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(s=c.find(g=>{let{stream_type:E}=g;return E===or.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(o=c.find(g=>{let{stream_type:E}=g;return E!==or.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Yt.SUBSCRIBE:r&&At.subscribe(this._joinInfo.sid,{succ:!1,ec:ee.TIMEOUT,audio:r.stream_type===Et.AUDIO,video:r.stream_type===Et.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:ro.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(Rn.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Rn.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;se("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!Z_(o.string_id||o.stream_id,this.channelName)));const r=[],s=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new qm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(Tn.USER_JOINED,c)));const u=ns.Audio&o.stream_type,h=(ns.Video|ns.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,g=u&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!g&&this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Tn.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Tn.USER_PUBLISHED,c,"video")),(u&&!g||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(Tn.PUBLISHED_USER_LIST).length>0?se("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(Tn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(Rn.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof iT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var o;return et(o=Object.keys(Bw)).call(o,s)}))})}_handleP2PEvents(){this._gateway.signal.on(Rn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(gi.PUBLISH,(e,r,s)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const E=this._users.find(S=>S.uid===o);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,u,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(o,u,!!g)})}),this._gateway.signal.on(gi.CALL,async(e,r,s)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){s(c)}}),this._gateway.signal.on(Qt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(gi.UNPUBLISH,async(e,r,s)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const g=m===or.Audio?Et.AUDIO:Et.VIDEO;await this._p2pChannel.unsubscribe(u,g),this._handleMuteStream(c,g,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(gi.CONTROL,async(e,r)=>{const{action:s}=e;switch(s){case Bm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Et.VIDEO,!0);break;case Bm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Et.AUDIO,!0);break;case Bm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Et.VIDEO,!1);break;case Bm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Et.AUDIO,!1)}}),this._gateway.signal.on(gi.RESTART_ICE,async(e,r,s)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==aa.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){s(o)}}),this._gateway.signal.on(gi.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:s}=e;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(Ut.RequestP2PRestartICE,async(e,r,s)=>{try{const{direction:o}=e;r(await this._gateway.sendExtensionMessage(gi.RESTART_ICE,e,o===aa.SEND_ONLY))}catch(o){s(o)}}),this._p2pChannel.on(Ut.LocalCandidate,e=>{this._gateway.sendExtensionMessage(gi.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ut.RequestP2PMuteLocal,async(e,r,s)=>{try{await this._gateway.sendExtensionMessage(gi.CONTROL,e,!0),r()}catch(o){s(o)}}),this._p2pChannel.on(Ut.RequestP2PUnmuteRemote,async(e,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===ee.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Ut.RequestP2PMuteRemote,async(e,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===ee.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Ut.StateChange,(e,r)=>{r===rr.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ut.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(Tn.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(Ut.RequestMuteLocal,async(e,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===ee.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Ut.RequestUnmuteLocal,async(e,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===ee.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Ut.RequestRePublish,(e,r,s)=>{this.publish(e,!1).then(r).catch(s)}),this._p2pChannel.on(Ut.RequestRePublishDataChannel,(e,r,s)=>{gt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==ee.DISCONNECT_P2P)throw u}})).then(r).catch(s)}),this._p2pChannel.on(Ut.RequestReSubscribe,async(e,r,s)=>{try{for(const{user:o,kind:c}of e)c===Et.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){s(o)}}),this._p2pChannel.on(Ut.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(Ut.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ut.MediaReconnectStart,e=>{this.safeEmit(Tn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ut.MediaReconnectEnd,e=>{this.safeEmit(Tn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ut.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ut.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),s=await r.next();if(s.done)return;const o=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(Ut.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ut.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:o}),h=z9(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ut.RequestUnpublishForReconnectPC,async(e,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):s()}),this._p2pChannel.on(Ut.P2PLost,()=>{this.safeEmit(Tn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ut.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ut.ConnectionTypeChange,e=>{this.safeEmit(Tn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ut.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ut.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Ut.AudioMetadata,e=>{this.safeEmit(Tn.AUDIO_METADATA,e)}),this._p2pChannel.on(Ut.AudioPts,e=>{this.safeEmit(Tn.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:e},df("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:g,vid:E}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:g,vid:E?Number(E):0},Di)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(e){e.on(ds.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Tn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Lu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Tn.CONTENT_INSPECT_ERROR,new ke(ee.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(ds.INSPECT_RESULT,(r,s)=>{var o;if((s==null?void 0:s.code)===ee.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(Tn.CONTENT_INSPECT_RESULT,r,s)}),e.on(ds.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(xd(e,"enabled"),e){if(!r)throw new ke(ee.INVALID_PARAMS,"config is required");if(n7(r),!this._joinInfo)throw new ke(ee.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(s={config:r},df("ImageModeration").create(s));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:g,cid:E,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:g,cid:E,vid:S?Number(S):0},Di)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var s;if(!this._moderation)throw new ke(ee.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(Fd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Tn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===zl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ke(ee.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Fd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){qi(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ke(ee.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){xd(e,"enabled"),hr("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ct(yt.prototype,"leave",[r7],Object.getOwnPropertyDescriptor(yt.prototype,"leave"),yt.prototype),Ct(yt.prototype,"publish",[i7],Object.getOwnPropertyDescriptor(yt.prototype,"publish"),yt.prototype),Ct(yt.prototype,"unpublish",[s7],Object.getOwnPropertyDescriptor(yt.prototype,"unpublish"),yt.prototype),Ct(yt.prototype,"subscribe",[o7],Object.getOwnPropertyDescriptor(yt.prototype,"subscribe"),yt.prototype),Ct(yt.prototype,"presubscribe",[a7],Object.getOwnPropertyDescriptor(yt.prototype,"presubscribe"),yt.prototype),Ct(yt.prototype,"massSubscribe",[c7],Object.getOwnPropertyDescriptor(yt.prototype,"massSubscribe"),yt.prototype),Ct(yt.prototype,"unsubscribe",[l7],Object.getOwnPropertyDescriptor(yt.prototype,"unsubscribe"),yt.prototype),Ct(yt.prototype,"massUnsubscribe",[u7],Object.getOwnPropertyDescriptor(yt.prototype,"massUnsubscribe"),yt.prototype),Ct(yt.prototype,"setLowStreamParameter",[d7],Object.getOwnPropertyDescriptor(yt.prototype,"setLowStreamParameter"),yt.prototype),Ct(yt.prototype,"enableDualStream",[h7],Object.getOwnPropertyDescriptor(yt.prototype,"enableDualStream"),yt.prototype),Ct(yt.prototype,"disableDualStream",[p7],Object.getOwnPropertyDescriptor(yt.prototype,"disableDualStream"),yt.prototype),Ct(yt.prototype,"setClientRole",[f7],Object.getOwnPropertyDescriptor(yt.prototype,"setClientRole"),yt.prototype),Ct(yt.prototype,"_setClientRoleOptions",[m7],Object.getOwnPropertyDescriptor(yt.prototype,"_setClientRoleOptions"),yt.prototype),Ct(yt.prototype,"setProxyServer",[g7],Object.getOwnPropertyDescriptor(yt.prototype,"setProxyServer"),yt.prototype),Ct(yt.prototype,"setTurnServer",[_7],Object.getOwnPropertyDescriptor(yt.prototype,"setTurnServer"),yt.prototype),Ct(yt.prototype,"setLicense",[y7],Object.getOwnPropertyDescriptor(yt.prototype,"setLicense"),yt.prototype),Ct(yt.prototype,"startProxyServer",[E7],Object.getOwnPropertyDescriptor(yt.prototype,"startProxyServer"),yt.prototype),Ct(yt.prototype,"stopProxyServer",[v7],Object.getOwnPropertyDescriptor(yt.prototype,"stopProxyServer"),yt.prototype),Ct(yt.prototype,"setLocalAccessPointsV2",[S7],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPointsV2"),yt.prototype),Ct(yt.prototype,"setLocalAccessPoints",[b7],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPoints"),yt.prototype),Ct(yt.prototype,"setRemoteDefaultVideoStreamType",[w7],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteDefaultVideoStreamType"),yt.prototype),Ct(yt.prototype,"setRemoteVideoStreamType",[T7],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteVideoStreamType"),yt.prototype),Ct(yt.prototype,"setStreamFallbackOption",[R7],Object.getOwnPropertyDescriptor(yt.prototype,"setStreamFallbackOption"),yt.prototype),Ct(yt.prototype,"setEncryptionConfig",[C7],Object.getOwnPropertyDescriptor(yt.prototype,"setEncryptionConfig"),yt.prototype),Ct(yt.prototype,"renewToken",[I7],Object.getOwnPropertyDescriptor(yt.prototype,"renewToken"),yt.prototype),Ct(yt.prototype,"enableAudioVolumeIndicator",[A7],Object.getOwnPropertyDescriptor(yt.prototype,"enableAudioVolumeIndicator"),yt.prototype),Ct(yt.prototype,"startLiveStreaming",[P7],Object.getOwnPropertyDescriptor(yt.prototype,"startLiveStreaming"),yt.prototype),Ct(yt.prototype,"setLiveTranscoding",[O7],Object.getOwnPropertyDescriptor(yt.prototype,"setLiveTranscoding"),yt.prototype),Ct(yt.prototype,"stopLiveStreaming",[k7],Object.getOwnPropertyDescriptor(yt.prototype,"stopLiveStreaming"),yt.prototype),Ct(yt.prototype,"startChannelMediaRelay",[N7],Object.getOwnPropertyDescriptor(yt.prototype,"startChannelMediaRelay"),yt.prototype),Ct(yt.prototype,"updateChannelMediaRelay",[D7],Object.getOwnPropertyDescriptor(yt.prototype,"updateChannelMediaRelay"),yt.prototype),Ct(yt.prototype,"stopChannelMediaRelay",[x7],Object.getOwnPropertyDescriptor(yt.prototype,"stopChannelMediaRelay"),yt.prototype),Ct(yt.prototype,"sendCustomReportMessage",[L7],Object.getOwnPropertyDescriptor(yt.prototype,"sendCustomReportMessage"),yt.prototype),Ct(yt.prototype,"pickSVCLayer",[M7],Object.getOwnPropertyDescriptor(yt.prototype,"pickSVCLayer"),yt.prototype),Ct(yt.prototype,"setRTMConfig",[U7],Object.getOwnPropertyDescriptor(yt.prototype,"setRTMConfig"),yt.prototype),Ct(yt.prototype,"enableContentInspect",[V7],Object.getOwnPropertyDescriptor(yt.prototype,"enableContentInspect"),yt.prototype),Ct(yt.prototype,"disableContentInspect",[F7],Object.getOwnPropertyDescriptor(yt.prototype,"disableContentInspect"),yt.prototype),Ct(yt.prototype,"setImageModeration",[j7],Object.getOwnPropertyDescriptor(yt.prototype,"setImageModeration"),yt.prototype),Ct(yt.prototype,"setP2PTransport",[B7],Object.getOwnPropertyDescriptor(yt.prototype,"setP2PTransport"),yt.prototype),Ct(yt.prototype,"getJoinChannelServiceRecords",[z7],Object.getOwnPropertyDescriptor(yt.prototype,"getJoinChannelServiceRecords"),yt.prototype),Ct(yt.prototype,"setPublishAudioFilterEnabled",[W7],Object.getOwnPropertyDescriptor(yt.prototype,"setPublishAudioFilterEnabled"),yt.prototype),yt);class aT{constructor(r,s){q(this,"id",0),q(this,"element",void 0),q(this,"peerPair",void 0),q(this,"context",void 0),q(this,"audioPlayerElement",void 0),q(this,"audioTrack",void 0),aT.count+=1,this.id=aT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new gt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},s=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await s(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(o){throw new ke(ee.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new ke(ee.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new ke(ee.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=s.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var H7,QP;q(aT,"count",0);const t_e=window.AudioContext||window.webkitAudioContext,n_e=new(H7=Gt({report:At}),Ct((QP=class{constructor(){q(this,"units",[]),q(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new t_e);let r=this.units.find(s=>s&&s.getElement()===e);return r||(r=new aT(e,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Nn().name!==Gn.SAFARI}}).prototype,"processExternalMediaAEC",[H7],Object.getOwnPropertyDescriptor(QP.prototype,"processExternalMediaAEC"),QP.prototype),QP);function $7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function K7(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$7(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$7(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const F2=window||document;function q7(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!F2)return;const s=xi._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const o=c=>{if(!(c&&c.blockedURI&&(xi.onSecurityPolicyViolation||xi.getListeners(Xh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;se("CSP_DETECTED_HOSTNAME_LIST").some(h=>et(u).call(u,h))&&(xi.onSecurityPolicyViolation&&typeof xi.onSecurityPolicyViolation=="function"&&xi.onSecurityPolicyViolation(c),xi.getListeners(Xh.SECURITY_POLICY_VIOLATION).length>0&&xi.safeEmit(Xh.SECURITY_POLICY_VIOLATION,c))};s&&F2.removeEventListener("securitypolicyviolation",s),(r||e&&typeof e=="function"||xi.getListeners(Xh.SECURITY_POLICY_VIOLATION).length>0)&&F2.addEventListener("securitypolicyviolation",o),xi._cspEventHandlerPointer=o}var r_e=k,i_e=O8,Y7=RegExp.prototype,s_e=function(e){return e===Y7||r_e(Y7,e)?i_e(e):e.flags},Lo=l(s_e);function oS(e){let r=e.length;for(;--r>=0;)e[r]=0}const j2=256,X7=286,cT=30,lT=15,B2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ZP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),o_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),J7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pf=new Array(576);oS(pf);const uT=new Array(60);oS(uT);const dT=new Array(512);oS(dT);const hT=new Array(256);oS(hT);const z2=new Array(29);oS(z2);const e1=new Array(cT);function W2(e,r,s,o,c){this.static_tree=e,this.extra_bits=r,this.extra_base=s,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let Q7,Z7,e$;function G2(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}oS(e1);const t$=e=>e<256?dT[e]:dT[256+(e>>>7)],pT=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},ol=(e,r,s)=>{e.bi_valid>16-s?(e.bi_buf|=r<<e.bi_valid&65535,pT(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=s)},Zh=(e,r,s)=>{ol(e,s[2*r],s[2*r+1])},n$=(e,r)=>{let s=0;do s|=1&e,e>>>=1,s<<=1;while(--r>0);return s>>>1},r$=(e,r,s)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=lT;c++)h=h+s[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=e[2*u+1];m!==0&&(e[2*u]=n$(o[m]++,m))}},i$=e=>{let r;for(r=0;r<X7;r++)e.dyn_ltree[2*r]=0;for(r=0;r<cT;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},s$=e=>{e.bi_valid>8?pT(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},o$=(e,r,s,o)=>{const c=2*r,u=2*s;return e[c]<e[u]||e[c]===e[u]&&o[r]<=o[s]},H2=(e,r,s)=>{const o=e.heap[s];let c=s<<1;for(;c<=e.heap_len&&(c<e.heap_len&&o$(r,e.heap[c+1],e.heap[c],e.depth)&&c++,!o$(r,o,e.heap[c],e.depth));)e.heap[s]=e.heap[c],s=c,c<<=1;e.heap[s]=o},a$=(e,r,s)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?Zh(e,c,r):(u=hT[c],Zh(e,u+j2+1,r),h=B2[u],h!==0&&(c-=z2[u],ol(e,c,h)),o--,u=t$(o),Zh(e,u,s),h=ZP[u],h!==0&&(o-=e1[u],ol(e,o,h)));while(m<e.sym_next);Zh(e,256,r)},$2=(e,r)=>{const s=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,g,E=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)s[2*h]!==0?(e.heap[++e.heap_len]=E=h,e.depth[h]=0):s[2*h+1]=0;for(;e.heap_len<2;)g=e.heap[++e.heap_len]=E<2?++E:0,s[2*g]=1,e.depth[g]=0,e.opt_len--,c&&(e.static_len-=o[2*g+1]);for(r.max_code=E,h=e.heap_len>>1;h>=1;h--)H2(e,s,h);g=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],H2(e,s,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,s[2*g]=s[2*h]+s[2*m],e.depth[g]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,s[2*h+1]=s[2*m+1]=g,e.heap[1]=g++,H2(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,C)=>{const A=C.dyn_tree,O=C.max_code,W=C.stat_desc.static_tree,F=C.stat_desc.has_stree,B=C.stat_desc.extra_bits,Z=C.stat_desc.extra_base,Q=C.stat_desc.max_length;let ae,ye,_e,ue,Ie,Ue,We=0;for(ue=0;ue<=lT;ue++)S.bl_count[ue]=0;for(A[2*S.heap[S.heap_max]+1]=0,ae=S.heap_max+1;ae<573;ae++)ye=S.heap[ae],ue=A[2*A[2*ye+1]+1]+1,ue>Q&&(ue=Q,We++),A[2*ye+1]=ue,ye>O||(S.bl_count[ue]++,Ie=0,ye>=Z&&(Ie=B[ye-Z]),Ue=A[2*ye],S.opt_len+=Ue*(ue+Ie),F&&(S.static_len+=Ue*(W[2*ye+1]+Ie)));if(We!==0){do{for(ue=Q-1;S.bl_count[ue]===0;)ue--;S.bl_count[ue]--,S.bl_count[ue+1]+=2,S.bl_count[Q]--,We-=2}while(We>0);for(ue=Q;ue!==0;ue--)for(ye=S.bl_count[ue];ye!==0;)_e=S.heap[--ae],_e>O||(A[2*_e+1]!==ue&&(S.opt_len+=(ue-A[2*_e+1])*A[2*_e],A[2*_e+1]=ue),ye--)}})(e,r),r$(s,E,e.bl_count)},c$=(e,r,s)=>{let o,c,u=-1,h=r[1],m=0,g=7,E=4;for(h===0&&(g=138,E=3),r[2*(s+1)+1]=65535,o=0;o<=s;o++)c=h,h=r[2*(o+1)+1],++m<g&&c===h||(m<E?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(g=138,E=3):c===h?(g=6,E=3):(g=7,E=4))},l$=(e,r,s)=>{let o,c,u=-1,h=r[1],m=0,g=7,E=4;for(h===0&&(g=138,E=3),o=0;o<=s;o++)if(c=h,h=r[2*(o+1)+1],!(++m<g&&c===h)){if(m<E)do Zh(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Zh(e,c,e.bl_tree),m--),Zh(e,16,e.bl_tree),ol(e,m-3,2)):m<=10?(Zh(e,17,e.bl_tree),ol(e,m-3,3)):(Zh(e,18,e.bl_tree),ol(e,m-11,7));m=0,u=c,h===0?(g=138,E=3):c===h?(g=6,E=3):(g=7,E=4)}};let u$=!1;const d$=(e,r,s,o)=>{ol(e,0+(o?1:0),3),s$(e),pT(e,s),pT(e,~s),s&&e.pending_buf.set(e.window.subarray(r,r+s),e.pending),e.pending+=s};var a_e=e=>{u$||((()=>{let r,s,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(z2[c]=o,r=0;r<1<<B2[c];r++)hT[o++]=c;for(hT[o-1]=c,u=0,c=0;c<16;c++)for(e1[c]=u,r=0;r<1<<ZP[c];r++)dT[u++]=c;for(u>>=7;c<cT;c++)for(e1[c]=u<<7,r=0;r<1<<ZP[c]-7;r++)dT[256+u++]=c;for(s=0;s<=lT;s++)h[s]=0;for(r=0;r<=143;)pf[2*r+1]=8,r++,h[8]++;for(;r<=255;)pf[2*r+1]=9,r++,h[9]++;for(;r<=279;)pf[2*r+1]=7,r++,h[7]++;for(;r<=287;)pf[2*r+1]=8,r++,h[8]++;for(r$(pf,287,h),r=0;r<cT;r++)uT[2*r+1]=5,uT[2*r]=n$(r,5);Q7=new W2(pf,B2,257,X7,lT),Z7=new W2(uT,ZP,0,cT,lT),e$=new W2(new Array(0),o_e,0,19,7)})(),u$=!0),e.l_desc=new G2(e.dyn_ltree,Q7),e.d_desc=new G2(e.dyn_dtree,Z7),e.bl_desc=new G2(e.bl_tree,e$),e.bi_buf=0,e.bi_valid=0,i$(e)},c_e=(e,r,s,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let g,E=4093624447;for(g=0;g<=31;g++,E>>>=1)if(1&E&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<j2;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(e)),$2(e,e.l_desc),$2(e,e.d_desc),h=(m=>{let g;for(c$(m,m.dyn_ltree,m.l_desc.max_code),c$(m,m.dyn_dtree,m.d_desc.max_code),$2(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*J7[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=s+5,s+4<=c&&r!==-1?d$(e,r,s,o):e.strategy===4||u===c?(ol(e,2+(o?1:0),3),a$(e,pf,uT)):(ol(e,4+(o?1:0),3),((m,g,E,S)=>{let C;for(ol(m,g-257,5),ol(m,E-1,5),ol(m,S-4,4),C=0;C<S;C++)ol(m,m.bl_tree[2*J7[C]+1],3);l$(m,m.dyn_ltree,g-1),l$(m,m.dyn_dtree,E-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),a$(e,e.dyn_ltree,e.dyn_dtree)),i$(e),o&&s$(e)},l_e=(e,r,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,r===0?e.dyn_ltree[2*s]++:(e.matches++,r--,e.dyn_ltree[2*(hT[s]+j2+1)]++,e.dyn_dtree[2*t$(r)]++),e.sym_next===e.sym_end),u_e=e=>{ol(e,2,3),Zh(e,256,pf),(r=>{r.bi_valid===16?(pT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},d_e={_tr_init:a_e,_tr_stored_block:d$,_tr_flush_block:c_e,_tr_tally:l_e,_tr_align:u_e},fT=(e,r,s,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const h_e=new Uint32Array((()=>{let e,r=[];for(var s=0;s<256;s++){e=s;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[s]=e}return r})());var la=(e,r,s,o)=>{const c=h_e,u=o+s;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^r[h])];return-1^e},sy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},t1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:p_e,_tr_stored_block:K2,_tr_flush_block:f_e,_tr_tally:Qm,_tr_align:m_e}=d_e,{Z_NO_FLUSH:Zm,Z_PARTIAL_FLUSH:g_e,Z_FULL_FLUSH:__e,Z_FINISH:ju,Z_BLOCK:h$,Z_OK:Oa,Z_STREAM_END:p$,Z_STREAM_ERROR:ep,Z_DATA_ERROR:y_e,Z_BUF_ERROR:q2,Z_DEFAULT_COMPRESSION:E_e,Z_FILTERED:v_e,Z_HUFFMAN_ONLY:n1,Z_RLE:S_e,Z_FIXED:b_e,Z_DEFAULT_STRATEGY:w_e,Z_UNKNOWN:T_e,Z_DEFLATED:r1}=t1,Y2=286,R_e=30,C_e=19,I_e=2*Y2+1,A_e=15,oy=258,tp=262,aS=42,ay=113,mT=666,cy=(e,r)=>(e.msg=sy[r],r),f$=e=>2*e-(e>4?9:0),eg=e=>{let r=e.length;for(;--r>=0;)e[r]=0},P_e=e=>{let r,s,o,c=e.w_size;r=e.hash_size,o=r;do s=e.head[--o],e.head[o]=s>=c?s-c:0;while(--r);r=c,o=r;do s=e.prev[--o],e.prev[o]=s>=c?s-c:0;while(--r)};let tg=(e,r,s)=>(r<<e.hash_shift^s)&e.hash_mask;const Gl=e=>{const r=e.state;let s=r.pending;s>e.avail_out&&(s=e.avail_out),s!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),e.next_out),e.next_out+=s,r.pending_out+=s,e.total_out+=s,e.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},Hl=(e,r)=>{f_e(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,Gl(e.strm)},ui=(e,r)=>{e.pending_buf[e.pending++]=r},gT=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},X2=(e,r,s,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,r.set(e.input.subarray(e.next_in,e.next_in+c),s),e.state.wrap===1?e.adler=fT(e.adler,r,c,s):e.state.wrap===2&&(e.adler=la(e.adler,r,c,s)),e.next_in+=c,e.total_in+=c,c)},m$=(e,r)=>{let s,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const g=e.strstart>e.w_size-tp?e.strstart-(e.w_size-tp):0,E=e.window,S=e.w_mask,C=e.prev,A=e.strstart+oy;let O=E[u+h-1],W=E[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(s=r,E[s+h]===W&&E[s+h-1]===O&&E[s]===E[u]&&E[++s]===E[u+1]){u+=2,s++;do;while(E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&u<A);if(o=oy-(A-u),u=A-oy,o>h){if(e.match_start=r,h=o,o>=m)break;O=E[u+h-1],W=E[u+h]}}while((r=C[r&S])>g&&--c!=0);return h<=e.lookahead?h:e.lookahead},cS=e=>{const r=e.w_size;let s,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-tp)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),P_e(e),o+=r),e.strm.avail_in===0)break;if(s=X2(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=s,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=tg(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=tg(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<tp&&e.strm.avail_in!==0)},g$=(e,r)=>{let s,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(s=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,s>o+e.strm.avail_in&&(s=o+e.strm.avail_in),s>c&&(s=c),s<u&&(s===0&&r!==ju||r===Zm||s!==o+e.strm.avail_in)))break;h=r===ju&&s===o+e.strm.avail_in?1:0,K2(e,0,0,h),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,Gl(e.strm),o&&(o>s&&(o=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,s-=o),s&&(X2(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:r!==Zm&&r!==ju&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(X2(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||r===ju)&&r!==Zm&&e.strm.avail_in===0&&o<=c)&&(s=o>c?c:o,h=r===ju&&e.strm.avail_in===0&&s===o?1:0,K2(e,e.block_start,s,h),e.block_start+=s,Gl(e.strm)),h?3:1)},J2=(e,r)=>{let s,o;for(;;){if(e.lookahead<tp){if(cS(e),e.lookahead<tp&&r===Zm)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=tg(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),s!==0&&e.strstart-s<=e.w_size-tp&&(e.match_length=m$(e,s)),e.match_length>=3)if(o=Qm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=tg(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=tg(e,e.ins_h,e.window[e.strstart+1]);else o=Qm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Hl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===ju?(Hl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Hl(e,!1),e.strm.avail_out===0)?1:2},lS=(e,r)=>{let s,o,c;for(;;){if(e.lookahead<tp){if(cS(e),e.lookahead<tp&&r===Zm)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=tg(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,s!==0&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-tp&&(e.match_length=m$(e,s),e.match_length<=5&&(e.strategy===v_e||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Qm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=tg(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Hl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Qm(e,0,e.window[e.strstart-1]),o&&Hl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Qm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===ju?(Hl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Hl(e,!1),e.strm.avail_out===0)?1:2};function np(e,r,s,o,c){this.good_length=e,this.max_lazy=r,this.nice_length=s,this.max_chain=o,this.func=c}const _T=[new np(0,0,0,0,g$),new np(4,4,8,4,J2),new np(4,5,16,8,J2),new np(4,6,32,32,J2),new np(4,4,16,16,lS),new np(8,16,32,32,lS),new np(8,16,128,128,lS),new np(8,32,128,256,lS),new np(32,128,258,1024,lS),new np(32,258,258,4096,lS)];function O_e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=r1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*I_e),this.dyn_dtree=new Uint16Array(2*(2*R_e+1)),this.bl_tree=new Uint16Array(2*(2*C_e+1)),eg(this.dyn_ltree),eg(this.dyn_dtree),eg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(A_e+1),this.heap=new Uint16Array(2*Y2+1),eg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Y2+1),eg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const yT=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==aS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==ay&&r.status!==mT?1:0},_$=e=>{if(yT(e))return cy(e,ep);e.total_in=e.total_out=0,e.data_type=T_e;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?aS:ay,e.adler=r.wrap===2?0:1,r.last_flush=-2,p_e(r),Oa},y$=e=>{const r=_$(e);return r===Oa&&(s=>{s.window_size=2*s.w_size,eg(s.head),s.max_lazy_match=_T[s.level].max_lazy,s.good_match=_T[s.level].good_length,s.nice_match=_T[s.level].nice_length,s.max_chain_length=_T[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(e.state),r},E$=(e,r,s,o,c,u)=>{if(!e)return ep;let h=1;if(r===E_e&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||s!==r1||o<8||o>15||r<0||r>9||u<0||u>b_e||o===8&&h!==1)return cy(e,ep);o===8&&(o=9);const m=new O_e;return e.state=m,m.strm=e,m.status=aS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=s,y$(e)};var k_e=(e,r)=>{if(yT(e)||r>h$||r<0)return e?cy(e,ep):ep;const s=e.state;if(!e.output||e.avail_in!==0&&!e.input||s.status===mT&&r!==ju)return cy(e,e.avail_out===0?q2:ep);const o=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Gl(e),e.avail_out===0)return s.last_flush=-1,Oa}else if(e.avail_in===0&&f$(r)<=f$(o)&&r!==ju)return cy(e,q2);if(s.status===mT&&e.avail_in!==0)return cy(e,q2);if(s.status===aS&&s.wrap===0&&(s.status=ay),s.status===aS){let c=r1+(s.w_bits-8<<4)<<8,u=-1;if(u=s.strategy>=n1||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=u<<6,s.strstart!==0&&(c|=32),c+=31-c%31,gT(s,c),s.strstart!==0&&(gT(s,e.adler>>>16),gT(s,65535&e.adler)),e.adler=1,s.status=ay,Gl(e),s.pending!==0)return s.last_flush=-1,Oa}if(s.status===57){if(e.adler=0,ui(s,31),ui(s,139),ui(s,8),s.gzhead)ui(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ui(s,255&s.gzhead.time),ui(s,s.gzhead.time>>8&255),ui(s,s.gzhead.time>>16&255),ui(s,s.gzhead.time>>24&255),ui(s,s.level===9?2:s.strategy>=n1||s.level<2?4:0),ui(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ui(s,255&s.gzhead.extra.length),ui(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=la(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(ui(s,0),ui(s,0),ui(s,0),ui(s,0),ui(s,0),ui(s,s.level===9?2:s.strategy>=n1||s.level<2?4:0),ui(s,3),s.status=ay,Gl(e),s.pending!==0)return s.last_flush=-1,Oa}if(s.status===69){if(s.gzhead.extra){let c=s.pending,u=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+u>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(e.adler=la(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Gl(e),s.pending!==0)return s.last_flush=-1,Oa;c=0,u-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending+=u,s.gzhead.hcrc&&s.pending>c&&(e.adler=la(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(e.adler=la(e.adler,s.pending_buf,s.pending-u,u)),Gl(e),s.pending!==0)return s.last_flush=-1,Oa;u=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ui(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(e.adler=la(e.adler,s.pending_buf,s.pending-u,u)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(e.adler=la(e.adler,s.pending_buf,s.pending-u,u)),Gl(e),s.pending!==0)return s.last_flush=-1,Oa;u=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ui(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(e.adler=la(e.adler,s.pending_buf,s.pending-u,u))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Gl(e),s.pending!==0))return s.last_flush=-1,Oa;ui(s,255&e.adler),ui(s,e.adler>>8&255),e.adler=0}if(s.status=ay,Gl(e),s.pending!==0)return s.last_flush=-1,Oa}if(e.avail_in!==0||s.lookahead!==0||r!==Zm&&s.status!==mT){let c=s.level===0?g$(s,r):s.strategy===n1?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(cS(u),u.lookahead===0)){if(h===Zm)return 1;break}if(u.match_length=0,m=Qm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(Hl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===ju?(Hl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Hl(u,!1),u.strm.avail_out===0)?1:2})(s,r):s.strategy===S_e?((u,h)=>{let m,g,E,S;const C=u.window;for(;;){if(u.lookahead<=oy){if(cS(u),u.lookahead<=oy&&h===Zm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(E=u.strstart-1,g=C[E],g===C[++E]&&g===C[++E]&&g===C[++E])){S=u.strstart+oy;do;while(g===C[++E]&&g===C[++E]&&g===C[++E]&&g===C[++E]&&g===C[++E]&&g===C[++E]&&g===C[++E]&&g===C[++E]&&E<S);u.match_length=oy-(S-E),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Qm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Qm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(Hl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===ju?(Hl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Hl(u,!1),u.strm.avail_out===0)?1:2})(s,r):_T[s.level].func(s,r);if(c!==3&&c!==4||(s.status=mT),c===1||c===3)return e.avail_out===0&&(s.last_flush=-1),Oa;if(c===2&&(r===g_e?m_e(s):r!==h$&&(K2(s,0,0,!1),r===__e&&(eg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Gl(e),e.avail_out===0))return s.last_flush=-1,Oa}return r!==ju?Oa:s.wrap<=0?p$:(s.wrap===2?(ui(s,255&e.adler),ui(s,e.adler>>8&255),ui(s,e.adler>>16&255),ui(s,e.adler>>24&255),ui(s,255&e.total_in),ui(s,e.total_in>>8&255),ui(s,e.total_in>>16&255),ui(s,e.total_in>>24&255)):(gT(s,e.adler>>>16),gT(s,65535&e.adler)),Gl(e),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Oa:p$)},N_e=(e,r)=>{let s=r.length;if(yT(e))return ep;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==aS||o.lookahead)return ep;if(c===1&&(e.adler=fT(e.adler,r,s,0)),o.wrap=0,s>=o.w_size){c===0&&(eg(o.head),o.strstart=0,o.block_start=0,o.insert=0);let g=new Uint8Array(o.w_size);g.set(r.subarray(s-o.w_size,s),0),r=g,s=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=s,e.next_in=0,e.input=r,cS(o);o.lookahead>=3;){let g=o.strstart,E=o.lookahead-2;do o.ins_h=tg(o,o.ins_h,o.window[g+3-1]),o.prev[g&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=g,g++;while(--E);o.strstart=g,o.lookahead=2,cS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,Oa},ET={deflateInit:(e,r)=>E$(e,r,r1,15,8,w_e),deflateInit2:E$,deflateReset:y$,deflateResetKeep:_$,deflateSetHeader:(e,r)=>yT(e)||e.state.wrap!==2?ep:(e.state.gzhead=r,Oa),deflate:k_e,deflateEnd:e=>{if(yT(e))return ep;const r=e.state.status;return e.state=null,r===ay?cy(e,y_e):Oa},deflateSetDictionary:N_e,deflateInfo:"pako deflate (from Nodeca project)"};const D_e=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var i1={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const o in s)D_e(s,o)&&(e[o]=s[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,c=e.length;o<c;o++)r+=e[o].length;const s=new Uint8Array(r);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];s.set(h,c),c+=h.length}return s}};let v$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{v$=!1}const vT=new Uint8Array(256);for(let e=0;e<256;e++)vT[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;vT[254]=vT[254]=1;var ST={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,s,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)s=e.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)s=e.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),s<128?r[u++]=s:s<2048?(r[u++]=192|s>>>6,r[u++]=128|63&s):s<65536?(r[u++]=224|s>>>12,r[u++]=128|s>>>6&63,r[u++]=128|63&s):(r[u++]=240|s>>>18,r[u++]=128|s>>>12&63,r[u++]=128|s>>>6&63,r[u++]=128|63&s);return r},buf2string:(e,r)=>{const s=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,c;const u=new Array(2*s);for(c=0,o=0;o<s;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=vT[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<s;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&v$)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let g="";for(let E=0;E<m;E++)g+=String.fromCharCode(h[E]);return g})(u,c)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let s=r-1;for(;s>=0&&(192&e[s])==128;)s--;return s<0||s===0?r:s+vT[e[s]]>r?s:r}},S$=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const b$=Object.prototype.toString,{Z_NO_FLUSH:x_e,Z_SYNC_FLUSH:L_e,Z_FULL_FLUSH:M_e,Z_FINISH:U_e,Z_OK:s1,Z_STREAM_END:V_e,Z_DEFAULT_COMPRESSION:F_e,Z_DEFAULT_STRATEGY:j_e,Z_DEFLATED:B_e}=t1;function o1(e){this.options=i1.assign({level:F_e,method:B_e,chunkSize:16384,windowBits:15,memLevel:8,strategy:j_e},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S$,this.strm.avail_out=0;let s=ET.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==s1)throw new Error(sy[s]);if(r.header&&ET.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?ST.string2buf(r.dictionary):b$.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=ET.deflateSetDictionary(this.strm,o),s!==s1)throw new Error(sy[s]);this._dict_set=!0}}function z_e(e,r){const s=new o1(r);if(s.push(e,!0),s.err)throw s.msg||sy[s.err];return s.result}o1.prototype.push=function(e,r){const s=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?U_e:x_e,typeof e=="string"?s.input=ST.string2buf(e):b$.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),(u===L_e||u===M_e)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=ET.deflate(s,u),c===V_e)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=ET.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===s1;if(s.avail_out!==0){if(u>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},o1.prototype.onData=function(e){this.chunks.push(e)},o1.prototype.onEnd=function(e){e===s1&&(this.result=i1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var W_e={deflate:z_e};const a1=16209;var G_e=function(e,r){let s,o,c,u,h,m,g,E,S,C,A,O,W,F,B,Z,Q,ae,ye,_e,ue,Ie,Ue,We;const Je=e.state;s=e.next_in,Ue=e.input,o=s+(e.avail_in-5),c=e.next_out,We=e.output,u=c-(r-e.avail_out),h=c+(e.avail_out-257),m=Je.dmax,g=Je.wsize,E=Je.whave,S=Je.wnext,C=Je.window,A=Je.hold,O=Je.bits,W=Je.lencode,F=Je.distcode,B=(1<<Je.lenbits)-1,Z=(1<<Je.distbits)-1;e:do{O<15&&(A+=Ue[s++]<<O,O+=8,A+=Ue[s++]<<O,O+=8),Q=W[A&B];t:for(;;){if(ae=Q>>>24,A>>>=ae,O-=ae,ae=Q>>>16&255,ae===0)We[c++]=65535&Q;else{if(!(16&ae)){if((64&ae)==0){Q=W[(65535&Q)+(A&(1<<ae)-1)];continue t}if(32&ae){Je.mode=16191;break e}e.msg="invalid literal/length code",Je.mode=a1;break e}ye=65535&Q,ae&=15,ae&&(O<ae&&(A+=Ue[s++]<<O,O+=8),ye+=A&(1<<ae)-1,A>>>=ae,O-=ae),O<15&&(A+=Ue[s++]<<O,O+=8,A+=Ue[s++]<<O,O+=8),Q=F[A&Z];n:for(;;){if(ae=Q>>>24,A>>>=ae,O-=ae,ae=Q>>>16&255,!(16&ae)){if((64&ae)==0){Q=F[(65535&Q)+(A&(1<<ae)-1)];continue n}e.msg="invalid distance code",Je.mode=a1;break e}if(_e=65535&Q,ae&=15,O<ae&&(A+=Ue[s++]<<O,O+=8,O<ae&&(A+=Ue[s++]<<O,O+=8)),_e+=A&(1<<ae)-1,_e>m){e.msg="invalid distance too far back",Je.mode=a1;break e}if(A>>>=ae,O-=ae,ae=c-u,_e>ae){if(ae=_e-ae,ae>E&&Je.sane){e.msg="invalid distance too far back",Je.mode=a1;break e}if(ue=0,Ie=C,S===0){if(ue+=g-ae,ae<ye){ye-=ae;do We[c++]=C[ue++];while(--ae);ue=c-_e,Ie=We}}else if(S<ae){if(ue+=g+S-ae,ae-=S,ae<ye){ye-=ae;do We[c++]=C[ue++];while(--ae);if(ue=0,S<ye){ae=S,ye-=ae;do We[c++]=C[ue++];while(--ae);ue=c-_e,Ie=We}}}else if(ue+=S-ae,ae<ye){ye-=ae;do We[c++]=C[ue++];while(--ae);ue=c-_e,Ie=We}for(;ye>2;)We[c++]=Ie[ue++],We[c++]=Ie[ue++],We[c++]=Ie[ue++],ye-=3;ye&&(We[c++]=Ie[ue++],ye>1&&(We[c++]=Ie[ue++]))}else{ue=c-_e;do We[c++]=We[ue++],We[c++]=We[ue++],We[c++]=We[ue++],ye-=3;while(ye>2);ye&&(We[c++]=We[ue++],ye>1&&(We[c++]=We[ue++]))}break}}break}}while(s<o&&c<h);ye=O>>3,s-=ye,O-=ye<<3,A&=(1<<O)-1,e.next_in=s,e.next_out=c,e.avail_in=s<o?o-s+5:5-(s-o),e.avail_out=c<h?h-c+257:257-(c-h),Je.hold=A,Je.bits=O};const c1=15,H_e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$_e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),K_e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),q_e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var bT=(e,r,s,o,c,u,h,m)=>{const g=m.bits;let E,S,C,A,O,W,F=0,B=0,Z=0,Q=0,ae=0,ye=0,_e=0,ue=0,Ie=0,Ue=0,We=null;const Je=new Uint16Array(16),pn=new Uint16Array(16);let En,Jt,tr,qn=null;for(F=0;F<=c1;F++)Je[F]=0;for(B=0;B<o;B++)Je[r[s+B]]++;for(ae=g,Q=c1;Q>=1&&Je[Q]===0;Q--);if(ae>Q&&(ae=Q),Q===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(Z=1;Z<Q&&Je[Z]===0;Z++);for(ae<Z&&(ae=Z),ue=1,F=1;F<=c1;F++)if(ue<<=1,ue-=Je[F],ue<0)return-1;if(ue>0&&(e===0||Q!==1))return-1;for(pn[1]=0,F=1;F<c1;F++)pn[F+1]=pn[F]+Je[F];for(B=0;B<o;B++)r[s+B]!==0&&(h[pn[r[s+B]]++]=B);if(e===0?(We=qn=h,W=20):e===1?(We=H_e,qn=$_e,W=257):(We=K_e,qn=q_e,W=0),Ue=0,B=0,F=Z,O=u,ye=ae,_e=0,C=-1,Ie=1<<ae,A=Ie-1,e===1&&Ie>852||e===2&&Ie>592)return 1;for(;;){En=F-_e,h[B]+1<W?(Jt=0,tr=h[B]):h[B]>=W?(Jt=qn[h[B]-W],tr=We[h[B]-W]):(Jt=96,tr=0),E=1<<F-_e,S=1<<ye,Z=S;do S-=E,c[O+(Ue>>_e)+S]=En<<24|Jt<<16|tr|0;while(S!==0);for(E=1<<F-1;Ue&E;)E>>=1;if(E!==0?(Ue&=E-1,Ue+=E):Ue=0,B++,--Je[F]==0){if(F===Q)break;F=r[s+h[B]]}if(F>ae&&(Ue&A)!==C){for(_e===0&&(_e=ae),O+=Z,ye=F-_e,ue=1<<ye;ye+_e<Q&&(ue-=Je[ye+_e],!(ue<=0));)ye++,ue<<=1;if(Ie+=1<<ye,e===1&&Ie>852||e===2&&Ie>592)return 1;C=Ue&A,c[C]=ae<<24|ye<<16|O-u|0}}return Ue!==0&&(c[O+Ue]=F-_e<<24|64<<16|0),m.bits=ae,0};const{Z_FINISH:w$,Z_BLOCK:Y_e,Z_TREES:l1,Z_OK:ly,Z_STREAM_END:X_e,Z_NEED_DICT:J_e,Z_STREAM_ERROR:Bu,Z_DATA_ERROR:T$,Z_MEM_ERROR:R$,Z_BUF_ERROR:Q_e,Z_DEFLATED:C$}=t1,u1=16180,d1=16190,ff=16191,Q2=16192,Z2=16194,h1=16199,p1=16200,eM=16206,hs=16209,I$=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Z_e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const uy=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<u1||r.mode>16211?1:0},A$=e=>{if(uy(e))return Bu;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=u1,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,ly},P$=e=>{if(uy(e))return Bu;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,A$(e)},O$=(e,r)=>{let s;if(uy(e))return Bu;const o=e.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Bu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=s,o.wbits=r,P$(e))},k$=(e,r)=>{if(!e)return Bu;const s=new Z_e;e.state=s,s.strm=e,s.window=null,s.mode=u1;const o=O$(e,r);return o!==ly&&(e.state=null),o};let tM,nM,N$=!0;const eye=e=>{if(N$){tM=new Int32Array(512),nM=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(bT(1,e.lens,0,288,tM,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;bT(2,e.lens,0,32,nM,0,e.work,{bits:5}),N$=!1}e.lencode=tM,e.lenbits=9,e.distcode=nM,e.distbits=5},D$=(e,r,s,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(s-u.wsize,s),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(s-o,s-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(s-o,s),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var tye=(e,r)=>{let s,o,c,u,h,m,g,E,S,C,A,O,W,F,B,Z,Q,ae,ye,_e,ue,Ie,Ue=0;const We=new Uint8Array(4);let Je,pn;const En=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(uy(e)||!e.output||!e.input&&e.avail_in!==0)return Bu;s=e.state,s.mode===ff&&(s.mode=Q2),h=e.next_out,c=e.output,g=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,E=s.hold,S=s.bits,C=m,A=g,Ie=ly;e:for(;;)switch(s.mode){case u1:if(s.wrap===0){s.mode=Q2;break}for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(2&s.wrap&&E===35615){s.wbits===0&&(s.wbits=15),s.check=0,We[0]=255&E,We[1]=E>>>8&255,s.check=la(s.check,We,2,0),E=0,S=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",s.mode=hs;break}if((15&E)!==C$){e.msg="unknown compression method",s.mode=hs;break}if(E>>>=4,S-=4,ue=8+(15&E),s.wbits===0&&(s.wbits=ue),ue>15||ue>s.wbits){e.msg="invalid window size",s.mode=hs;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&E?16189:ff,E=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(s.flags=E,(255&Lo(s))!==C$){e.msg="unknown compression method",s.mode=hs;break}if(57344&Lo(s)){e.msg="unknown header flags set",s.mode=hs;break}s.head&&(s.head.text=E>>8&1),512&Lo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=la(s.check,We,2,0)),E=0,S=0,s.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.head&&(s.head.time=E),512&Lo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,We[2]=E>>>16&255,We[3]=E>>>24&255,s.check=la(s.check,We,4,0)),E=0,S=0,s.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.head&&(s.head.xflags=255&E,s.head.os=E>>8),512&Lo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=la(s.check,We,2,0)),E=0,S=0,s.mode=16184;case 16184:if(1024&Lo(s)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.length=E,s.head&&(s.head.extra_len=E),512&Lo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=la(s.check,We,2,0)),E=0,S=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&Lo(s)&&(O=s.length,O>m&&(O=m),O&&(s.head&&(ue=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(o.subarray(u,u+O),ue)),512&Lo(s)&&4&s.wrap&&(s.check=la(s.check,o,O,u)),m-=O,u+=O,s.length-=O),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&Lo(s)){if(m===0)break e;O=0;do ue=o[u+O++],s.head&&ue&&s.length<65536&&(s.head.name+=String.fromCharCode(ue));while(ue&&O<m);if(512&Lo(s)&&4&s.wrap&&(s.check=la(s.check,o,O,u)),m-=O,u+=O,ue)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&Lo(s)){if(m===0)break e;O=0;do ue=o[u+O++],s.head&&ue&&s.length<65536&&(s.head.comment+=String.fromCharCode(ue));while(ue&&O<m);if(512&Lo(s)&&4&s.wrap&&(s.check=la(s.check,o,O,u)),m-=O,u+=O,ue)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&Lo(s)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&s.wrap&&E!==(65535&s.check)){e.msg="header crc mismatch",s.mode=hs;break}E=0,S=0}s.head&&(s.head.hcrc=Lo(s)>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=ff;break;case 16189:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}e.adler=s.check=I$(E),E=0,S=0,s.mode=d1;case d1:if(s.havedict===0)return e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,s.hold=E,s.bits=S,J_e;e.adler=s.check=1,s.mode=ff;case ff:if(r===Y_e||r===l1)break e;case Q2:if(s.last){E>>>=7&S,S-=7&S,s.mode=eM;break}for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}switch(s.last=1&E,E>>>=1,S-=1,3&E){case 0:s.mode=16193;break;case 1:if(eye(s),s.mode=h1,r===l1){E>>>=2,S-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=hs}E>>>=2,S-=2;break;case 16193:for(E>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",s.mode=hs;break}if(s.length=65535&E,E=0,S=0,s.mode=Z2,r===l1)break e;case Z2:s.mode=16195;case 16195:if(O=s.length,O){if(O>m&&(O=m),O>g&&(O=g),O===0)break e;c.set(o.subarray(u,u+O),h),m-=O,u+=O,g-=O,h+=O,s.length-=O;break}s.mode=ff;break;case 16196:for(;S<14;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(s.nlen=257+(31&E),E>>>=5,S-=5,s.ndist=1+(31&E),E>>>=5,S-=5,s.ncode=4+(15&E),E>>>=4,S-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=hs;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.lens[En[s.have++]]=7&E,E>>>=3,S-=3}for(;s.have<19;)s.lens[En[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,Je={bits:s.lenbits},Ie=bT(0,s.lens,0,19,s.lencode,0,s.work,Je),s.lenbits=Je.bits,Ie){e.msg="invalid code lengths set",s.mode=hs;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ue=s.lencode[E&(1<<s.lenbits)-1],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(Q<16)E>>>=B,S-=B,s.lens[s.have++]=Q;else{if(Q===16){for(pn=B+2;S<pn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(E>>>=B,S-=B,s.have===0){e.msg="invalid bit length repeat",s.mode=hs;break}ue=s.lens[s.have-1],O=3+(3&E),E>>>=2,S-=2}else if(Q===17){for(pn=B+3;S<pn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=B,S-=B,ue=0,O=3+(7&E),E>>>=3,S-=3}else{for(pn=B+7;S<pn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=B,S-=B,ue=0,O=11+(127&E),E>>>=7,S-=7}if(s.have+O>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=hs;break}for(;O--;)s.lens[s.have++]=ue}}if(s.mode===hs)break;if(s.lens[256]===0){e.msg="invalid code -- missing end-of-block",s.mode=hs;break}if(s.lenbits=9,Je={bits:s.lenbits},Ie=bT(1,s.lens,0,s.nlen,s.lencode,0,s.work,Je),s.lenbits=Je.bits,Ie){e.msg="invalid literal/lengths set",s.mode=hs;break}if(s.distbits=6,s.distcode=s.distdyn,Je={bits:s.distbits},Ie=bT(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,Je),s.distbits=Je.bits,Ie){e.msg="invalid distances set",s.mode=hs;break}if(s.mode=h1,r===l1)break e;case h1:s.mode=p1;case p1:if(m>=6&&g>=258){e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,s.hold=E,s.bits=S,G_e(e,A),h=e.next_out,c=e.output,g=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,E=s.hold,S=s.bits,s.mode===ff&&(s.back=-1);break}for(s.back=0;Ue=s.lencode[E&(1<<s.lenbits)-1],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(Z&&(240&Z)==0){for(ae=B,ye=Z,_e=Q;Ue=s.lencode[_e+((E&(1<<ae+ye)-1)>>ae)],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(ae+B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=ae,S-=ae,s.back+=ae}if(E>>>=B,S-=B,s.back+=B,s.length=Q,Z===0){s.mode=16205;break}if(32&Z){s.back=-1,s.mode=ff;break}if(64&Z){e.msg="invalid literal/length code",s.mode=hs;break}s.extra=15&Z,s.mode=16201;case 16201:if(s.extra){for(pn=s.extra;S<pn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.length+=E&(1<<s.extra)-1,E>>>=s.extra,S-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ue=s.distcode[E&(1<<s.distbits)-1],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((240&Z)==0){for(ae=B,ye=Z,_e=Q;Ue=s.distcode[_e+((E&(1<<ae+ye)-1)>>ae)],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(ae+B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=ae,S-=ae,s.back+=ae}if(E>>>=B,S-=B,s.back+=B,64&Z){e.msg="invalid distance code",s.mode=hs;break}s.offset=Q,s.extra=15&Z,s.mode=16203;case 16203:if(s.extra){for(pn=s.extra;S<pn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.offset+=E&(1<<s.extra)-1,E>>>=s.extra,S-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=hs;break}s.mode=16204;case 16204:if(g===0)break e;if(O=A-g,s.offset>O){if(O=s.offset-O,O>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=hs;break}O>s.wnext?(O-=s.wnext,W=s.wsize-O):W=s.wnext-O,O>s.length&&(O=s.length),F=s.window}else F=c,W=h-s.offset,O=s.length;O>g&&(O=g),g-=O,s.length-=O;do c[h++]=F[W++];while(--O);s.length===0&&(s.mode=p1);break;case 16205:if(g===0)break e;c[h++]=s.length,g--,s.mode=p1;break;case eM:if(s.wrap){for(;S<32;){if(m===0)break e;m--,E|=o[u++]<<S,S+=8}if(A-=g,e.total_out+=A,s.total+=A,4&s.wrap&&A&&(e.adler=s.check=Lo(s)?la(s.check,c,A,h-A):fT(s.check,c,A,h-A)),A=g,4&s.wrap&&(Lo(s)?E:I$(E))!==s.check){e.msg="incorrect data check",s.mode=hs;break}E=0,S=0}s.mode=16207;case 16207:if(s.wrap&&Lo(s)){for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&s.wrap&&E!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=hs;break}E=0,S=0}s.mode=16208;case 16208:Ie=X_e;break e;case hs:Ie=T$;break e;case 16210:return R$;default:return Bu}return e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,s.hold=E,s.bits=S,(s.wsize||A!==e.avail_out&&s.mode<hs&&(s.mode<eM||r!==w$))&&D$(e,e.output,e.next_out,A-e.avail_out),C-=e.avail_in,A-=e.avail_out,e.total_in+=C,e.total_out+=A,s.total+=A,4&s.wrap&&A&&(e.adler=s.check=Lo(s)?la(s.check,c,A,e.next_out-A):fT(s.check,c,A,e.next_out-A)),e.data_type=s.bits+(s.last?64:0)+(s.mode===ff?128:0)+(s.mode===h1||s.mode===Z2?256:0),(C===0&&A===0||r===w$)&&Ie===ly&&(Ie=Q_e),Ie},mf={inflateReset:P$,inflateReset2:O$,inflateResetKeep:A$,inflateInit:e=>k$(e,15),inflateInit2:k$,inflate:tye,inflateEnd:e=>{if(uy(e))return Bu;let r=e.state;return r.window&&(r.window=null),e.state=null,ly},inflateGetHeader:(e,r)=>{if(uy(e))return Bu;const s=e.state;return(2&s.wrap)==0?Bu:(s.head=r,r.done=!1,ly)},inflateSetDictionary:(e,r)=>{const s=r.length;let o,c,u;return uy(e)?Bu:(o=e.state,o.wrap!==0&&o.mode!==d1?Bu:o.mode===d1&&(c=1,c=fT(c,r,s,0),c!==o.check)?T$:(u=D$(e,r,s,s),u?(o.mode=16210,R$):(o.havedict=1,ly)))},inflateInfo:"pako inflate (from Nodeca project)"},nye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const x$=Object.prototype.toString,{Z_NO_FLUSH:rye,Z_FINISH:iye,Z_OK:wT,Z_STREAM_END:rM,Z_NEED_DICT:iM,Z_STREAM_ERROR:sye,Z_DATA_ERROR:L$,Z_MEM_ERROR:oye}=t1;function f1(e){this.options=i1.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S$,this.strm.avail_out=0;let s=mf.inflateInit2(this.strm,r.windowBits);if(s!==wT)throw new Error(sy[s]);if(this.header=new nye,mf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=ST.string2buf(r.dictionary):x$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=mf.inflateSetDictionary(this.strm,r.dictionary),s!==wT)))throw new Error(sy[s])}function aye(e,r){const s=new f1(r);if(s.push(e),s.err)throw s.msg||sy[s.err];return s.result}f1.prototype.push=function(e,r){const s=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?iye:rye,x$.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),u=mf.inflate(s,h),u===iM&&c&&(u=mf.inflateSetDictionary(s,c),u===wT?u=mf.inflate(s,h):u===L$&&(u=iM));s.avail_in>0&&u===rM&&s.state.wrap>0&&e[s.next_in]!==0;)mf.inflateReset(s),u=mf.inflate(s,h);switch(u){case sye:case L$:case iM:case oye:return this.onEnd(u),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||u===rM))if(this.options.to==="string"){let g=ST.utf8border(s.output,s.next_out),E=s.next_out-g,S=ST.buf2string(s.output,g);s.next_out=E,s.avail_out=o-E,E&&s.output.set(s.output.subarray(g,g+E),0),this.onData(S)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(u!==wT||m!==0){if(u===rM)return u=mf.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},f1.prototype.onData=function(e){this.chunks.push(e)},f1.prototype.onEnd=function(e){e===wT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var cye={inflate:aye};const{deflate:lye}=W_e,{inflate:uye}=cye;var dye=lye,hye=uye,M$=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(M$||{});class pye{constructor(){q(this,"_sequence",0),q(this,"_startTime",Date.now()),q(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const g={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};s.commonPacketHeader.extension=1,s.extension=E,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;se("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const o=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,u.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let o=0;const c=s.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(o+2,!0)<<16|s.getUint16(o,!0)};let h,m;if(o+=4,se("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),s.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let g=!1;if(m.datas.length>0){const E=m.datas.find(S=>S.id===0);E&&(g=(1&new DataView(E.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let g=0;if(m.setUint8(g++,s),m.setUint8(g++,o),c.forEach(E=>{s?(m.setUint8(g++,E.id),m.setUint8(g++,E.length),h.set(new Uint8Array(E.data),g),g+=E.data.byteLength):(m.setUint8(g++,E.id|E.length<<4),h.set(new Uint8Array(E.data),g),g+=E.data.byteLength)}),g!==o+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(o+2));return u}deserializeExtension(r){const s=new DataView(r);let o=0;const c=s.getUint8(o);o++;const u=s.getUint8(o);o++;const h=c===M$.TWO_BYTE,m=[],g=new DataView(r,2);let E=0;for(;E<u;){let S=0,C=0,A=new ArrayBuffer(0);h?(S=g.getUint8(E),E++,C=g.getUint8(E),E++):(S=15&g.getUint8(E),C=g.getUint8(E)>>4,E++),C>0&&(A=g.buffer.slice(E+2,E+2+C),E+=A.byteLength),m.push({id:S,length:C,data:A})}if(E!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return hye(new Uint8Array(r))}compress(r){return dye(new Uint8Array(r))}}const fye={name:"DataStream",create:(e,r)=>{const s=r?new Sme(e):new bme(e);return s.useDataStream(new pye),s}};class mye extends Xr{constructor(r,s,o){super(),q(this,"ws",void 0),q(this,"requestId",1),q(this,"heartBeatTimer",void 0),q(this,"joinInfo",void 0),q(this,"clientId",void 0),q(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),q(this,"onClose",c=>{this.emit("close"),this.dispose()}),q(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=s,this.ws=new Yw("cross-channel-".concat(this.clientId),o),this.ws.on(cn.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(cn.CONNECTED,this.onOpen),this.ws.on(cn.ON_MESSAGE,this.onMessage),this.ws.on(cn.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new gt((s,o)=>{const c=window.setTimeout(()=>{o(new ke(ee.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new ke(ee.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new ke(ee.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new ke(ee.WS_DISCONNECT);const s=()=>new gt((h,m)=>{this.ws.once(cn.CLOSED,()=>m(new ke(ee.WS_ABORT))),this.ws.once(cn.CONNECTED,h)});this.ws.state!=="connected"&&await s();const o=this.sendMessage(r),c=new gt((h,m)=>{const g=()=>{m(new ke(ee.WS_ABORT))};this.ws.once(cn.RECONNECTING,g),this.ws.once(cn.CLOSED,g),this.once("req_".concat(o),h),vs(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(cn.RECONNECTING,g),this.ws.off(cn.CLOSED,g),m(new ke(ee.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new ke(ee.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(cn.REQUEST_NEW_URLS),this.ws.on(cn.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class gye extends Xr{set state(r){r!==this._state&&(r!==Za.RELAY_STATE_FAILURE&&(this.errorCode=Kv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,o,c,u){super(),q(this,"joinInfo",void 0),q(this,"sid",void 0),q(this,"clientId",void 0),q(this,"cancelToken",Ca.CancelToken.source()),q(this,"workerToken",void 0),q(this,"requestId",0),q(this,"signal",void 0),q(this,"prevChannelMediaConfig",void 0),q(this,"httpRetryConfig",void 0),q(this,"_resolution",void 0),q(this,"_state",Za.RELAY_STATE_IDLE),q(this,"errorCode",Kv.RELAY_OK),q(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",lf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",lf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Kv.SRC_TOKEN_EXPIRED,this.state=Za.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Kv.DEST_TOKEN_EXPIRED,this.state=Za.RELAY_STATE_FAILURE))}),q(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",lf.NETWORK_DISCONNECTED),this.state=Za.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Za.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=Kv.SERVER_CONNECTION_LOST,this.state=Za.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=H_(),this.signal=new mye(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Za.RELAY_STATE_IDLE)throw new ke(ee.INVALID_OPERATION);this.state=Za.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new ke(ee.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new ke(ee.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new ke(ee.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Za.RELAY_STATE_RUNNING)throw new ke(ee.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Za.RELAY_STATE_RUNNING)throw new ke(ee.INVALID_OPERATION);const s=this.genMessage(ca.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Za.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ca.CancelToken.source(),this.state=Za.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Ige(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",lf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(ca.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(ca.SetSdkProfile,r);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(ca.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",lf.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(ca.SetSourceUserId,r);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(ca.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",lf.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(ca.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",lf.PACKET_SENT_TO_DEST_CHANNEL),this.state=Za.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(ca.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",lf.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(ca.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Vl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(r){case ca.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case ca.SetSourceChannel:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new ke(ee.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case ca.SetSourceUserId:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new ke(ee.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case ca.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new ke(ee.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case ca.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case ca.Reconnect:return h.clientRequest={command:"Reconnect"},h;case ca.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case ca.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new ke(ee.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case ca.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const _ye={name:"ChannelMediaRelay",create:function(e){return new gye(e.joinInfo,e.clientId,e.websocketRetryConfig||Di,e.httpRetryConfig||Di,e.resolution)}};function U$(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function TT(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?U$(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):U$(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class yye extends Xr{constructor(r,s,o,c){super(),q(this,"spec",void 0),q(this,"token",void 0),q(this,"websocket",void 0),q(this,"pingpongTimer",void 0),q(this,"reconnectMode","retry"),q(this,"serviceMode",void 0),q(this,"reqId",0),q(this,"commandReqId",0),q(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),q(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(At.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===cf.TRANSCODE?1:2}),this.emit(jm.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new Yw("live-streaming",o),this.websocket.on(cn.CONNECTED,this.handleWebSocketOpen),this.websocket.on(cn.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(cn.REQUEST_NEW_URLS,(u,h)=>{Us(this,jm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(cn.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new ke(ee.UNEXPECTED_ERROR);const m=TT({command:r,sdkVersion:Vl==="4.24.0"?"0.0.1":Vl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new ke(ee.WS_DISCONNECT);const g=()=>new gt((A,O)=>{this.websocket.once(cn.CLOSED,()=>O(new ke(ee.WS_ABORT))),this.websocket.once(cn.CONNECTED,A)});this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new gt((A,O)=>{const W=()=>{O(new ke(ee.WS_ABORT))};this.websocket.once(cn.RECONNECTING,W),this.websocket.once(cn.CLOSED,W),this.once("@".concat(h,"-").concat(this.spec.sid),F=>{A(F)})});c&&At.workerEvent(this.spec.sid,TT(TT({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let C=null;try{C=await E}catch(A){if(this.websocket.state==="closed")throw A;return await g(),await this.request(r,s,o)}return c&&At.workerEvent(this.spec.sid,TT(TT({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(C.serverResponse),serverCode:C.code,success:C.code===200,responseTime:Date.now()-S})),C.code!==200&&this.handleResponseError(C),C}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Vl==="4.24.0"?"0.0.1":Vl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Vi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Vi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Vi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Vi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ke(ee.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Vi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new ke(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ke(ee.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Vi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new ke(ee.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(jm.WARNING,s,r.serverResponse.url)}case Vi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new ke(ee.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(jm.WARNING,s,r.serverResponse.url)}case Vi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ke(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ke(ee.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Vi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new ke(ee.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(jm.WARNING,s,r.serverResponse.url)}case Vi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ke(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Vi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ke(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Vi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new ke(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new ke(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new ke(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ke(ee.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(ZA)},6e3)}}function V$(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function ec(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?V$(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):V$(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class Eye extends Xr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Di,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Di;super(),q(this,"onLiveStreamWarning",void 0),q(this,"onLiveStreamError",void 0),q(this,"spec",void 0),q(this,"retryTimeout",1e4),q(this,"connection",void 0),q(this,"httpRetryConfig",void 0),q(this,"wsRetryConfig",void 0),q(this,"streamingTasks",new Map),q(this,"isStartingStreamingTask",!1),q(this,"taskMutex",new Zs("live-streaming")),q(this,"cancelToken",Ca.CancelToken.source()),q(this,"transcodingConfig",void 0),q(this,"uapResponse",void 0),q(this,"lastTaskId",1),q(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=ec(ec({},sge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>ec(ec(ec({},ige),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){ei(h.width)||gr(h.width,"config.width",0,1e4),ei(h.height)||gr(h.height,"config.height",0,1e4),ei(h.videoBitrate)||gr(h.videoBitrate,"config.videoBitrate",1,1e6),ei(h.videoFrameRate)||gr(h.videoFrameRate,"config.videoFrameRate"),ei(h.lowLatency)||xd(h.lowLatency,"config.lowLatency"),ei(h.audioSampleRate)||qi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ei(h.audioBitrate)||gr(h.audioBitrate,"config.audioBitrate",1,128),ei(h.audioChannels)||qi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),ei(h.videoGop)||gr(h.videoGop,"config.videoGop"),ei(h.videoCodecProfile)||qi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ei(h.userCount)||gr(h.userCount,"config.userCount",0,17),ei(h.backgroundColor)||gr(h.backgroundColor,"config.backgroundColor",0,16777215),ei(h.userConfigExtraInfo)||Es(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!ei(h.transcodingUsers)&&(af(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,g)=>{wP(m.uid),ei(m.x)||gr(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),ei(m.y)||gr(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),ei(m.width)||gr(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),ei(m.height)||gr(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),ei(m.zOrder)||gr(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),ei(m.alpha)||gr(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),ei(h.watermark)||r2(h.watermark,"watermark"),ei(h.backgroundImage)||r2(h.backgroundImage,"backgroundImage"),h.images&&!ei(h.images)&&(af(h.images,"config.images"),h.images.forEach((m,g)=>{r2(m,"images[".concat(g,"]"))}))}(s);const o=[];s.images&&o.push(...s.images.map(h=>ec(ec(ec({},n2),h),{},{zOrder:255}))),s.backgroundImage&&(o.push(ec(ec(ec({},n2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(o.push(ec(ec(ec({},n2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=o,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>ec({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?gt.resolve(h.uid):uH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await gt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(wc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})})}}async startLiveStreamingTask(r,s,o){if(!this.transcodingConfig&&s===cf.TRANSCODE)throw new ke(ee.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new ke(ee.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw u(),m}switch(s){case cf.TRANSCODE:c.transcodingConfig=ec({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new gt((E,S)=>{vs(this.retryTimeout).then(()=>{if(o)return S(o);const C=this.statusError.get(r);return C?(this.statusError.delete(r),S(C)):void 0})}),g=await gt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===cf.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new gt((s,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new ke(ee.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===cf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(o)})}resetAllTask(){var r;const s=Array.from(wc(r=this.streamingTasks).call(r));this.terminate();for(const o of s)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ca.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new ke(ee.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Us(this,i2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new yye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(jm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(jm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(jm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new ke(ee.UNEXPECTED_ERROR,"can not get new live streaming address list"));Us(this,i2.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Vi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new ke(ee.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Vi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new ke(ee.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Vi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(wc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new ke(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(g=>{x.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const vye={name:"LiveStreaming",create:function(e){return new Eye(e.joinInfo,e.websocketRetryConfig||Di,e.httpRetryConfig||Di)}};function Sye(e){let r=B$();return function(s,o){let c=s.appId;c!==void 0&&(cr(o,10),rp(o,c));let u=s.cid;u!==void 0&&(cr(o,16),cr(o,u));let h=s.cname;h!==void 0&&(cr(o,26),rp(o,h));let m=s.deviceId;m!==void 0&&(cr(o,34),rp(o,m));let g=s.elapse;g!==void 0&&(cr(o,40),ng(o,g));let E=s.fileSize;E!==void 0&&(cr(o,48),ng(o,uS(E)));let S=s.height;S!==void 0&&(cr(o,56),ng(o,uS(S)));let C=s.jpg;C!==void 0&&(cr(o,66),cr(o,C.length),function(io,ze){let nt=dS(io,ze.length);io.bytes.set(ze,nt)}(o,C));let A=s.networkType;A!==void 0&&(cr(o,72),ng(o,uS(A)));let O=s.osType;O!==void 0&&(cr(o,80),ng(o,uS(O)));let W=s.requestId;W!==void 0&&(cr(o,90),rp(o,W));let F=s.sdkVersion;F!==void 0&&(cr(o,98),rp(o,F));let B=s.sequence;B!==void 0&&(cr(o,104),ng(o,uS(B)));let Z=s.sid;Z!==void 0&&(cr(o,114),rp(o,Z));let Q=s.timestamp;Q!==void 0&&(cr(o,120),ng(o,Q));let ae=s.uid;ae!==void 0&&(cr(o,128),cr(o,ae));let ye=s.vid;ye!==void 0&&(cr(o,136),cr(o,ye));let _e=s.width;_e!==void 0&&(cr(o,144),ng(o,uS(_e)));let ue=s.service;ue!==void 0&&(cr(o,152),cr(o,ue));let Ie=s.callbackData;Ie!==void 0&&(cr(o,162),rp(o,Ie));let Ue=s.jpgEncryption;Ue!==void 0&&(cr(o,168),cr(o,Ue));let We=s.requestType;We!==void 0&&(cr(o,176),cr(o,We));let Je=s.scorePorn;Je!==void 0&&(cr(o,185),lM(o,Je));let pn=s.scoreSexy;pn!==void 0&&(cr(o,193),lM(o,pn));let En=s.scoreNeutral;En!==void 0&&(cr(o,201),lM(o,En));let Jt=s.scene;Jt!==void 0&&(cr(o,208),cr(o,Jt));let tr=s.ossFilePrefix;tr!==void 0&&(cr(o,218),rp(o,tr));let qn=s.serviceVendor;if(qn!==void 0)for(let io of qn){cr(o,226);let ze=B$();Tye(io,ze),cr(o,ze.limit),Aye(o,ze),Iye(ze)}}(e,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function bye(e){return function(s){let o={};e:for(;!z$(s);){let c=ip(s);switch(c>>>3){case 0:break e;case 1:o.code=ip(s);break;case 2:o.msg=W$(s,ip(s));break;case 3:{let u=Rye(s);o.data=wye(s),s.limit=u;break}default:F$(s,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function wye(e){let r={};e:for(;!z$(e);){let s=ip(e);switch(s>>>3){case 0:break e;case 1:r.requestId=W$(e,ip(e));break;case 2:r.requestType=ip(e)>>>0;break;case 3:r.scorePorn=cM(e);break;case 4:r.scoreSexy=cM(e);break;case 5:r.scoreNeutral=cM(e);break;case 6:r.requestScene=ip(e)>>>0;break;case 7:r.scene=ip(e)>>>0;break;default:F$(e,7&s)}}return r}function Tye(e,r){let s=e.service;s!==void 0&&(cr(r,8),cr(r,s));let o=e.vendor;o!==void 0&&(cr(r,16),cr(r,o));let c=e.token;c!==void 0&&(cr(r,26),rp(r,c));let u=e.callbackUrl;u!==void 0&&(cr(r,34),rp(r,u))}function Rye(e){let r=ip(e),s=e.limit;return e.limit=e.offset+r,s}function F$(e,r){switch(r){case 0:for(;128&G$(e););break;case 2:oM(e,ip(e));break;case 5:oM(e,4);break;case 1:oM(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let Cye=new Float32Array(1);new Uint8Array(Cye.buffer);let sM=new Float64Array(1),tc=new Uint8Array(sM.buffer);function uS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let j$=[];function B$(){const e=j$.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Iye(e){j$.push(e)}function oM(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function z$(e){return e.offset>=e.limit}function dS(e,r){let s=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function aM(e,r){let s=e.offset;if(s+r>e.limit)throw new Error("Read past limit");return e.offset+=r,s}function W$(e,r){let s=aM(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let g,E,S,C,A=c[m+s];(128&A)==0?h+=o(A):(224&A)==192?m+1>=r?h+=u:(g=c[m+s+1],(192&g)!=128?h+=u:(C=(31&A)<<6|63&g,C<128?h+=u:(h+=o(C),m++))):(240&A)==224?m+2>=r?h+=u:(g=c[m+s+1],E=c[m+s+2],(49344&(g|E<<8))!=32896?h+=u:(C=(15&A)<<12|(63&g)<<6|63&E,C<2048||C>=55296&&C<=57343?h+=u:(h+=o(C),m+=2))):(248&A)==240?m+3>=r?h+=u:(g=c[m+s+1],E=c[m+s+2],S=c[m+s+3],(12632256&(g|E<<8|S<<16))!=8421504?h+=u:(C=(7&A)<<18|(63&g)<<12|(63&E)<<6|63&S,C<65536||C>1114111?h+=u:(C-=65536,h+=o(55296+(C>>10),56320+(1023&C)),m+=3))):h+=u}return h}function rp(e,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}cr(e,o);let c=dS(e,o),u=e.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Aye(e,r){let s=dS(e,r.limit),o=e.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+s]=c[u]}function G$(e){return e.bytes[aM(e,1)]}function H$(e,r){let s=dS(e,1);e.bytes[s]=r}function cM(e){let r=aM(e,8),s=e.bytes;return tc[0]=s[r++],tc[1]=s[r++],tc[2]=s[r++],tc[3]=s[r++],tc[4]=s[r++],tc[5]=s[r++],tc[6]=s[r++],tc[7]=s[r++],sM[0]}function lM(e,r){let s=dS(e,8),o=e.bytes;sM[0]=r,o[s++]=tc[0],o[s++]=tc[1],o[s++]=tc[2],o[s++]=tc[3],o[s++]=tc[4],o[s++]=tc[5],o[s++]=tc[6],o[s++]=tc[7]}function ip(e){let r,s=0,o=0;do r=G$(e),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function cr(e,r){for(r>>>=0;r>=128;)H$(e,127&r|128),r>>>=7;H$(e,r)}function ng(e,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=dS(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}function $$(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}const Pye=new Map([["moderation",1],["supervise",2]]);class Oye extends Xr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(ds.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Ha(s=r.map(o=>Pye.get(o)||0)).call(s,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),q(this,"name","AgoraRTCVideoContentInspect"),q(this,"_connectionState",Lu.CONNECTING),q(this,"_innerConnectionState",void 0),q(this,"sequence",0),q(this,"inspectStartTime",void 0),q(this,"workerManagerConnection",void 0),q(this,"workerConnection",void 0),q(this,"workerMessageLengthLimit",void 0),q(this,"inspectIntervalMinimum",void 0),q(this,"qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",Ca.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"wmSequence",0),q(this,"inspectInterval",void 0),q(this,"inspectTimer",null),q(this,"ossFilePrefix",void 0),q(this,"extraInfo",void 0),q(this,"_inspectType",void 0),q(this,"_inspectMode",void 0),q(this,"_quality",1),q(this,"qualityTimer",null),q(this,"_inspectId",void 0),q(this,"_needWorkUrlOnly",!1),q(this,"inspectImage",()=>{if(this.connectionState!==Lu.CONNECTED)throw new ke(ee.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Lu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Er(5,"inspect-"),this.workerMessageLengthLimit=se("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=se("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=se("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Yw("worker-manager-"+this._inspectId,Di),this.on(ds.STATE_CHANGE,(s,o)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Mu[s]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Yw("worker-"+this._inspectId,Di),this.handleWorkerEvents()}async init(r,s){this.emit(ds.STATE_CHANGE,Mu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new gt((c,u)=>{this.on(ds.CONNECTION_STATE_CHANGE,(h,m)=>{m===Lu.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,s,o){const c=se("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,g,E,S){let{appId:C,areaCode:A,cname:O,sid:W,token:F,uid:B}=g;eS++;const Z="image_moderation_api",Q={service_name:Z,json_body:JSON.stringify({appId:C,areaCode:A,cname:O,command:"allocateEdge",requestId:eS,seq:eS,sid:W,token:F,ts:Date.now(),uid:B+""})};let ae,ye,_e=m[0];return Ld(async()=>{ae=Date.now();const ue=await jd(_e,{data:Q,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-ae,ue.code!==0){const Je=new ke(ee.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ue.code,{retry:!0,responseTime:ye});throw x.error(Je.toString()),Je}const Ie=JSON.parse(ue.json_body);if(Ie.code!==200){const Je=new ke(ee.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ie.code,", reason: ").concat(Ie.reason),{code:Ie.code,responseTime:ye});throw x.error(Je.toString()),Je}if(!Ie.servers||!Array.isArray(Ie.servers)||Ie.servers.length===0){const Je=new ke(ee.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ie.code,responseTime:ye});throw x.error(Je.toString()),Je}const Ue=se("VIDEO_INSPECT_WORKER_MANAGER_HOST"),We=se("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ie.servers.map(Je=>{let{address:pn,wss:En}=Je;if(pn&&En)return"wss://".concat(pn.replace(/\./g,"-"),".").concat(Ue,":").concat(We||En)}).filter(Je=>!!Je),workerToken:Ie.workerToken,vid:Ie.vid,responseTime:ye}},(ue,Ie)=>(At.apworkerEvent(W,{success:!0,sc:200,serviceName:Z,responseDetail:JSON.stringify(ue.addressList),firstSuccess:Ie===0,responseTime:ye,serverIp:m[Ie%m.length]}),!1),(ue,Ie)=>(At.apworkerEvent(W,{success:!1,sc:ue.data&&ue.data.code||200,serviceName:Z,responseTime:ye,serverIp:m[Ie%m.length]}),!!(ue.code!==ee.OPERATION_ABORTED&&ue.code!==ee.UNEXPECTED_RESPONSE||ue.data&&ue.data.retry)&&(_e=m[(Ie+1)%m.length],!0)),S)}(c,r,s,o);this.emit(ds.STATE_CHANGE,Mu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(ds.STATE_CHANGE,Mu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(cn.CONNECTED,async()=>{this.emit(ds.STATE_CHANGE,Mu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(cn.CLOSED,()=>{this._innerConnectionState<Mu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(cn.FAILED,()=>{this._innerConnectionState<Mu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(cn.RECONNECTING,()=>{this._innerConnectionState<Mu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(cn.ON_MESSAGE,async r=>{this.emit(ds.STATE_CHANGE,Mu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new ke(ee.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new ke(ee.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=se("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=s.replace(/:\d+\/?$/,":".concat(c));this.emit(ds.STATE_CHANGE,Mu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(ds.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(cn.WILL_RECONNECT,(r,s,o)=>{o(r)}),this.workerManagerConnection.on(cn.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(cn.CONNECTED,async()=>{this.emit(ds.STATE_CHANGE,Mu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Lu.CONNECTED}),this.workerConnection.on(cn.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=bye(new Uint8Array(r.data));if(se("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ds.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var s;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Ha(s=Object.keys(c)).call(s,(m,g)=>c[m]>c[g]?m:g,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(ds.INSPECT_RESULT,h)}else this.emit(ds.INSPECT_RESULT,void 0,new ke(ee.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(ds.INSPECT_RESULT,void 0,new ke(ee.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ds.INSPECT_RESULT,void 0,new ke(ee.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(cn.CLOSED,()=>{this.connectionState=Lu.CLOSED}),this.workerConnection.on(cn.FAILED,()=>{this.connectionState=Lu.CLOSED}),this.workerConnection.on(cn.RECONNECTING,()=>{this.connectionState=this.connectionState===Lu.CONNECTED?Lu.RECONNECTING:Lu.CONNECTING}),this.workerConnection.on(cn.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(cn.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(ds.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{s(o)})})}async requestToInspectImage(){this.sequence++;const r=Xc(this,ds.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(ds.INSPECT_RESULT,void 0,new ke(ee.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,s);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(ds.INSPECT_RESULT,void 0,new ke(ee.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:g}=s;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),C=await IW(S,o,c),A=this.sequence+"-"+u+"-"+g+"-"+E+"-"+Er(12,""),O={appId:o,cid:u,cname:c,deviceId:"",elapse:(W=Number(E-this.inspectStartTime),{low:W|=0,high:W>>31,unsigned:W>=0}),fileSize:C.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:C,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this.sequence,sid:m,timestamp:e7(E),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var W;this.extraInfo===void 0&&delete O.callbackData,this.ossFilePrefix===void 0&&delete O.ossFilePrefix;const F=Sye(O);if(F.byteLength<this.workerMessageLengthLimit){if(se("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const B=function(Z){for(var Q=1;Q<arguments.length;Q++){var ae=arguments[Q]!=null?arguments[Q]:{};Q%2?$$(Object(ae),!0).forEach(function(ye){q(Z,ye,ae[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(ae)):$$(Object(ae)).forEach(function(ye){Object.defineProperty(Z,ye,Object.getOwnPropertyDescriptor(ae,ye))})}return Z}({},O);delete B.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(B))}return F}{const B=this.quality*this.qualityRatio;return this.quality=B,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ca.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Lu.CLOSED,this.emit(ds.STATE_CHANGE,Mu.CLOSED)}}const kye={name:"ContentInspect",create:function(e){let{config:r}=e;return function(s){if(!s)throw new ke(ee.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new ke(ee.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(s.inspectType)];o.forEach(c=>{var u;if(!et(u=["supervise","moderation"]).call(u,c))throw new ke(ee.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=o}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new ke(ee.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new Oye(r)}};var K$=l(xe.Object.getOwnPropertySymbols),Nye=Wn,Dye=dd.indexOf,xye=Xg,uM=ie([].indexOf),q$=!!uM&&1/uM([1],1,-0)<0;Nye({target:"Array",proto:!0,forced:q$||!xye("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return q$?uM(this,e,r)||0:Dye(this,e,r)}});var Lye=_c("Array","indexOf"),Mye=k,Uye=Lye,dM=Array.prototype,Vye=function(e){var r=e.indexOf;return e===dM||Mye(dM,e)&&r===dM.indexOf?Uye:r},Y$=l(Vye);function Fye(e,r){if(e==null)return{};var s,o,c=function(h,m){if(h==null)return{};var g={};for(var E in h)if({}.hasOwnProperty.call(h,E)){if(Y$(m).call(m,E)!==-1)continue;g[E]=h[E]}return g}(e,r);if(K$){var u=K$(e);for(o=0;o<u.length;o++)s=u[o],Y$(r).call(r,s)===-1&&{}.propertyIsEnumerable.call(e,s)&&(c[s]=e[s])}return c}let X$=class{get localCapabilities(){return Gr(this._localCapabilities)}get rtpCapabilities(){return Gr(this._rtpCapabilities)}get candidates(){return Gr(this._candidates)}get iceParameters(){return Gr(this._iceParameters)}get dtlsParameters(){return Gr(this._dtlsParameters)}constructor(e){q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_iceParameters",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname","o/i14u9pJrxRKAsu"),q(this,"firefoxSsrcMidMap",new Map),e=Gr(e);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:g,audioCodec:E}=e;let S;this.setup=m,S=h===aa.RECEIVE_ONLY?Ja(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ja(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=u;const C=h===aa.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,A=h===aa.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,O=h===aa.RECEIVE_ONLY?c.send.videoCodecs:Zw(Et.VIDEO,C,A,g),W=h===aa.RECEIVE_ONLY?c.send.audioCodecs:Zw(Et.AUDIO,C,A,E);for(const F of S.mediaDescriptions)F.attributes.iceUfrag=r.iceUfrag,F.attributes.icePwd=r.icePwd,F.attributes.fingerprints=s.fingerprints,F.attributes.candidates=o,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video"&&(F.media.fmts=O.map(B=>B.payloadType.toString(10)),F.attributes.payloads=O,F.attributes.extmaps=C.videoExtensions),F.media.mediaType==="audio"&&(F.media.fmts=W.map(B=>B.payloadType.toString(10)),F.attributes.payloads=W,F.attributes.extmaps=C.audioExtensions,Zv(F));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Vm(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,s,o,c){s=s.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=Qw(r,this.cname,se("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Zr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(e,u,o);let E;return g===-1?(E=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(E=Gr(this.sessionDesc.mediaDescriptions[g]),E.attributes.direction="sendonly",E.attributes.ssrcs=u,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(E,c)),Zr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&e.indexOf(s.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,s){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,g=!1;h===-1?(g=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Gr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:g})}),o}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(s=>e.indexOf(s.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:s,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:g}=new RTCIceCandidate(e),E={foundation:r??"",componentId:"1",transport:s??"",priority:g?g+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===E.priority&&S.connectionAddress===E.connectionAddress&&S.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,s,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=Zw(u,h,this.localCapabilities.send,u===Et.AUDIO?c:o),g=u===Et.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};S=this.mungRecvMediaDsec(S,e);const C=this.findFirstClosedMedia(u);if(C){const A=this.sessionDesc.mediaDescriptions.indexOf(C);this.sessionDesc.mediaDescriptions[A]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(s=>et(e).call(e,s.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(s=>et(e).call(e,s.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,s){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Zr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===s})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(e){const r=[];for(let s=0;s<e;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(e){e=Gr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,s,o,c,u){const h=this.rtpCapabilities.send,m=e===Et.VIDEO?h.videoCodecs:h.audioCodecs,g=e===Et.VIDEO?h.videoExtensions:h.audioExtensions;Zr()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,u);const S=this.findFirstClosedMedia(e);if(S){const C=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[C]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(e,r,s){const o=Gr(e);return u2(o),Qv(o,r),d2(o,r),G9(o),kP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(e,r){const s=Gr(e);return kP(s,r,this.localCapabilities.recv),Zv(s),s}updateRecvMedia(e,r){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>Zr()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const jye=["sdp"];var kr;function J$(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function rg(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?J$(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):J$(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let Q$=(kr=class RS extends C9{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,o){super(r,s),q(this,"direction",void 0),q(this,"name",void 0),q(this,"store",void 0),q(this,"spec",void 0),q(this,"peerConnection",void 0),q(this,"initialOffer",void 0),q(this,"transport",void 0),q(this,"statsFilter",void 0),q(this,"localCandidateCount",0),q(this,"_isInRestartIce",!1),q(this,"mutex",void 0),q(this,"onLocalCandidate",void 0),q(this,"remoteSDP",void 0),q(this,"pendingCandidates",[]),q(this,"localCapabilities",void 0),q(this,"isReady",!1),q(this,"restartCnt",0),q(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Zs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(RS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??aa.SEND_ONLY,this.name=this.direction===aa.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=EL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,Zr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await $9();if(this.localCapabilities=NP(s),r){const{sdp:o}=r,c=Fye(r,jye),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},C=Jw(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Uu(C,S,"videoExtensions",A,O,W),Uu(C,S,"videoCodecs",A,O,W),Uu(C,S,"audioExtensions",A,O,W),Uu(C,S,"audioCodecs",A,O,W),se("RAISE_H264_BASELINE_PRIORITY")){const F=W.videoCodecs.findIndex(B=>B.rtpMap&&B.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&B.fmtp&&B.fmtp.parameters["profile-level-id"]==="42001f");if(F!==-1){const B=W.videoCodecs.findIndex(Z=>Z.rtpMap&&Z.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(B<F){x.debug("raising H264 baseline profile priority");const Z=W.videoCodecs[F];W.videoCodecs.splice(F,1),W.videoCodecs.splice(B,0,Z)}B!==-1&&se("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(Z=>!(Z.rtpMap&&Z.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Z.fmtp&&Z.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:A,recv:O,sendrecv:W}}({},{},o);this.remoteSDP=new X$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Gm(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await K9({},{},h.sdp);this.localCapabilities=NP(g);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),rg(rg({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Gm(o.sdp);return this.initialOffer=o,rg(rg({},c),{},{sdp:o.sdp})}}catch(s){throw new Le(ee.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:o,dtlsParameters:c}=r,u=await K9({},{},s);this.remoteSDP=new X$({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(ee.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return Ul(function*(){const u=yield Un(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,o);r.forEach((B,Z)=>{if(m[Z].needCreateTransceiver){const Q=c.peerConnection.addTransceiver(B._mediaStreamTrack,{direction:"sendonly"});h.push(Q),B._updateRtpTransceiver(Q)}else{const Q=c.peerConnection.getTransceivers().find(ae=>ae.mid===m[Z].mid);if(!Q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Z].mid));h.push(Q),B._updateRtpTransceiver(Q)}}),Zr()&&se("SIMULCAST")===!0&&(yield Un(c.applySimulcastForFirefox(h,r)));const g=m.map(B=>B.mid),E=yield Un(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(E.sdp,r,g),C=Ja(S),A=g.map(B=>{const Z=C.mediaDescriptions.find(Q=>Q.attributes.mid===B);if(!Z)throw new Error("Cannot extract ssrc from mediaDescription.");return B9(Z,se("USE_PUB_RTX"))}),O=h.map((B,Z)=>{const Q=g[Z];return{localSSRC:A[Z],id:Q}});yield Un(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield O}catch(B){const Z=c.remoteSDP.toString();throw yield Un(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Un(c.peerConnection.setRemoteDescription({type:"answer",sdp:Z})),yield Un(c.stopSending(g,!0)),B}yield Un(c.applySimulcastEncodings(h,r)),yield Un(c.applySendEncodings(h,r));const W=c.remoteSDP.toString(),F=c.logSDPExchange(S,"offer","local","send");return F==null||F(W),yield Un(c.setRemoteDescription({type:"answer",sdp:W})),h.map((B,Z)=>{const Q=g[Z];return{localSSRC:A[Z],id:Q}})}catch(h){throw h instanceof Le?h:new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var E;g.direction="inactive",(E=g.stop)===null||E===void 0||E.call(g)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const g=this.remoteSDP.toString(),E=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const S=await this.peerConnection.createAnswer(),C=this.mungReceiveAnswerSDP(S.sdp,u,r);E==null||E(C||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:C}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(E.sdp,u,r);g==null||g(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===$_.Auto&&(this.store.p2pTransport=$_.SdRtn,Vn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(RS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Vn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(RS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Gm(s.sdp);return this.store.descriptionStart(),this.direction===aa.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===aa.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Gm(s.sdp);return await this.peerConnection.setLocalDescription(s),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(ee.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Zr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:rg(rg({},$h),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:rg(rg({},$h),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;et(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Mw(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...RS.turnServerConfigToIceServers(r.turnServer.servers,s,o)),se("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...RS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,o)),et(u=[$_.Relay,$_.SdRtn]).call(u,s)&&(c.iceTransportPolicy="relay"),se("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),se("ENABLE_ENCODED_TRANSFORM")&&Vn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(s){case $_.SdRtn:const m=r.filter(E=>{var S;return et(S=E.username).call(S,"glb:")&&E.turnServerURL==E.turnServerURL}),g=m.length>o?m[o]:m[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(zm(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(zm(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case $_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(zm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(zm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:o,remote:c}=s.getSelectedCandidatePair()||{};if(o&&c){const u=o.address+":"+o.port,h=c.address+":"+c.port;x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ey(u)),", remote ").concat(JSON.stringify(ey(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:C,scaleResolutionDownBy:A}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),et(h=r._hints).call(h,_r.LOW_STREAM)&&(C&&(u.maxFramerate=Ic(C)),A&&A>=1&&(u.scaleResolutionDownBy=A))}if(se("DSCP_TYPE")&&of()){var m;const S=se("DSCP_TYPE");et(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const g=s.getParameters(),E=(o=g.encodings)===null||o===void 0?void 0:o[0];Zr()&&!E&&(c.encodings=[u]),E&&Object.assign(E,u),Object.assign(g,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await s.setParameters(g)}async applySendEncodings(r,s){try{if(!Vn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof Or&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ja(r);return s.forEach((u,h)=>{const m=o[h],g=c.mediaDescriptions.find(E=>E.attributes.mid===m);g&&(Qv(g,u),H9(g,u,this.store.codec))}),Vm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var o,c,u,h,m;const E=r[g],S=s[g];if(S instanceof Or&&!et(o=S._hints).call(o,_r.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const C={},A={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const O=E.sender.getParameters();await E.sender.setParameters(Object.assign(O,C))}}}async applySimulcastEncodings(r,s){if(!Zr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Or&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof Or&&se("SIMULCAST")&&this.store.codec==="vp8"&&!et(s=r._hints).call(s,_r.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(se("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var o;if(s=s??((o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp)){var c;const u=(c=Ja(s).mediaDescriptions.find(h=>h.attributes.mid===r))===null||c===void 0?void 0:c.attributes.ssrcs;return u==null?void 0:u[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),et(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,o){const c=Ja(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===s);return u&&o===Et.AUDIO&&u.media.mediaType==="audio"&&Zv(u),Vm(c)}},Ct(kr.prototype,"establish",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"establish"),kr.prototype),Ct(kr.prototype,"connect",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"connect"),kr.prototype),Ct(kr.prototype,"receive",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"receive"),kr.prototype),Ct(kr.prototype,"mockReceive",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"mockReceive"),kr.prototype),Ct(kr.prototype,"stopReceiving",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"stopReceiving"),kr.prototype),Ct(kr.prototype,"restartICE",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"restartICE"),kr.prototype),Ct(kr.prototype,"close",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"close"),kr.prototype),Ct(kr.prototype,"updateEncoderConfig",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"updateEncoderConfig"),kr.prototype),Ct(kr.prototype,"updateSendParameters",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"updateSendParameters"),kr.prototype),Ct(kr.prototype,"replaceTrack",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"replaceTrack"),kr.prototype),Ct(kr.prototype,"muteLocal",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"muteLocal"),kr.prototype),Ct(kr.prototype,"unmuteLocal",[zu],Object.getOwnPropertyDescriptor(kr.prototype,"unmuteLocal"),kr.prototype),kr);function zu(e,r,s){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},s}let Wd=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var Z$,eK,tK,nK,rK,iK,sK,oK,aK,cK,lK,Hr;function uK(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function m1(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?uK(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):uK(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let Bye=(Z$=Gd(Wd.SEND_ONLY),eK=Gd(Wd.SEND_ONLY),tK=Gd(),nK=Gd(Wd.RECEIVE_ONLY),rK=Gd(Wd.RECEIVE_ONLY),iK=Gd(Wd.RECEIVE_ONLY),sK=Gd(Wd.RECEIVE_ONLY),oK=Gd(Wd.RECEIVE_ONLY),aK=Gd(Wd.RECEIVE_ONLY),cK=Gd(),lK=Gd(Wd.RECEIVE_ONLY),Hr=class extends Xr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(Ut.StateChange,r,this._state)}constructor(e,r){super(),q(this,"isPlanB",!1),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"sendConnection",void 0),q(this,"recvConnection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"statsCollector",void 0),q(this,"dtlsFailedCount",0),q(this,"sendMutex",void 0),q(this,"recvMutex",void 0),q(this,"_state",rr.Disconnected),q(this,"_restartStates",["disconnected","failed"]),q(this,"reconnectInterval",void 0),q(this,"uploadUnplinkStarted",!1),q(this,"uploadDownlinkStarted",!1),q(this,"uplinkStateUploadInterval",void 0),q(this,"downlinkStatsUploadInterval",void 0),q(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==rr.Connected)return void c(new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(s);if(g.length===0)return void o();const E=g.find(O=>O[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(O=>{let[,{id:W}]=O;return W}));let S=!1;var h,m;s.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Ye.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Ye.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const C=this.createMuteMessage(g);await yr(this,Ut.RequestMuteLocal,C);const A=s.trackMediaType==="video"?Bm.MUTE_LOCAL_VIDEO:Bm.MUTE_LOCAL_AUDIO;await yr(this,Ut.RequestP2PMuteLocal,{action:A,message:C,isMuteAll:S}),o()}catch(g){c(g)}finally{u()}}),q(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==rr.Connected)return void c(new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const m=this.createUnmuteMessage(h),g=s.trackMediaType==="video"?Bm.UNMUTE_LOCAL_VIDEO:Bm.UNMUTE_LOCAL_AUDIO;await yr(this,Ut.RequestP2PMuteLocal,{action:g,message:m}),o()}catch(h){c(h)}finally{u()}}),q(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==s||this.state!==rr.Connected)return void o();const{id:E,track:S}=g;E&&(await this.sendConnection.updateSendParameters(E,S),await this.sendConnection.updateEncoderConfig(E,S),this.emit(Ut.UpdateVideoEncoder,S)),o()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==rr.Connected)return void o();const{id:m,track:g}=h;m&&await this.sendConnection.updateSendParameters(m,g),o()}catch(h){c(h)}finally{u()}}),q(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:C}]=S;return s===C});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==rr.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),E[0]===Ye.LocalVideoTrack&&Vn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(S){const C=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=C,S.track._originMediaStreamTrack=C,await new gt((A,O)=>{this.handleReplaceTrack(S.track,A,O,!0)})}}o()}catch(E){c(E)}finally{var g;(g=h)===null||g===void 0||g()}}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new AH(e),this.bindStatsUploaderEvents(),this.sendMutex=new Zs("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Zs("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},se("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Q$(e,this.store,aa.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=rr.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Q$(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{s&&s()}}async p2pConnect(e){if(!this.sendConnection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=rr.Connected}async addRemoteCandidate(e,r){if(r===aa.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,s){var o=this;return Ul(function*(){const c=yield Un(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==rr.Connected){o.throwIfTrackTypeNotMatch(e);const E=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(E))}o.store.pubId=o.store.pubId+1,ro.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,r,s);if(u.length===0)return void(yield Un(o.tryToUnmuteAudio(e)));u.forEach(E=>{let{track:S,type:C}=E;const A=Date.now();o.store.publish(S.getTrackId(),C===Ye.LocalAudioTrack?"audio":"video",A)}),o.bindLocalTrackEvents(u);const h=yield Un(o.sendConnection.send(u.map(E=>{let{track:S}=E;return S}),o.store.codec,o.store.audioCodec)),m=(yield Un(h.next())).value,g=o.createGatewayPublishMessage(u,m);try{yield g}catch(E){throw h.throw(E),(E==null?void 0:E.code)===ee.WS_ABORT&&u.forEach(S=>{let{track:C}=S;o.pendingLocalTracks.indexOf(C)===-1&&o.pendingLocalTracks.push(C)}),o.unbindLocalTrackEvents(u),E}yield Un(h.next()),u.forEach(E=>{let{type:S}=E;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(E=>{let{track:S,type:C}=E;const A=Date.now();o.store.publish(S.getTrackId(),C===Ye.LocalAudioTrack?"audio":"video",void 0,A)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==rr.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!et(e).call(e,c)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===rr.Connected)return s&&s[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:Nge(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(o=>{yr(this,Ut.RequestMuteLocal,[o])}),s.length>0&&s.forEach(o=>{yr(this,Ut.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Ul(function*(){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Us(this,Ut.RequestRePublish,this.pendingLocalTracks),this.emit(Ut.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,s,o){var c;if(!this.recvConnection)throw new Le(ee.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(e.uid),o);r===Et.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Gv(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=s,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Wv(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const g=this.remoteUserMap.get(e);g?g.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(S=>{let{user:C,kind:A}=S;return C.uid===e.uid&&r===A});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Ut.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,s,o){if(!this.recvConnection)throw new Le(ee.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(e.uid),o)}async unsubscribe(e,r,s){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===e.uid&&r===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||o.forEach(u=>{let{kind:h}=u;var m;if(h===Et.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===Et.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var g,E;if(m===Et.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Et.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===Et.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;yr(this,Ut.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[Et.VIDEO,Et.AUDIO].forEach(o=>{s.has(o)?yr(this,Ut.RequestP2PUnmuteRemote,o):yr(this,Ut.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===Et.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get(Ye.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ui){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ye.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ye.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(e&&o===Ye.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}reportPublishEvent(e,r,s,o,c){if(e){const h=this.localTrackMap.get(Ye.LocalAudioTrack),m=o?this.localTrackMap.get(Ye.LocalVideoLowTrack):this.localTrackMap.get(Ye.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(g=>g instanceof oi),m=o?(u=this.localTrackMap.get(Ye.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(g=>g instanceof Or);At.publish(this.store.sessionId,{eventElapse:ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,s,o){const c=o===Et.VIDEO?s._videoSSRC:s._audioSSRC;c&&At.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===Et.VIDEO,audio:o===Et.AUDIO,peerid:s.uid,subscribeRequestid:o===Et.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:ro.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Zs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Zs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ye.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ui){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=rr.Disconnected}getStats(e){var r,s;return e?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ye.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ye.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof Or||r&&r.track instanceof oi?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!r||s.has(r))}getRemoteMedia(e){var r;const s=Array.from(Qa(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ye.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=x_(e).call(e,(s,o)=>s.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=rr.Reconnecting,se("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[s,{track:o}]=e;switch(s){case Ye.LocalVideoTrack:et(r=o._hints).call(r,_r.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ye.LocalAudioTrack:o instanceof Ui?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ye.LocalVideoLowTrack:}}),this.emit(Ut.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,s]=e;Array.from(Qa(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Ut.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((e instanceof qm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let s,o;if(e===aa.SEND_ONLY){if(!this.sendConnection)throw new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Us(this,Ut.RequestP2PRestartICE,{direction:aa.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalAudioTrack),o=e.videoSend.find(O=>{var W;return O.ssrc===(r==null||(W=r.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)}),c=e.audioSend.find(O=>{var W;return O.ssrc===(s==null||(W=s.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)});if(!o||!c)return 1;const u=Xc(this,Ut.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,E=(g&&u?(g+u)/2:g||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,C=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(_r.SCREEN_TRACK)===-1){const O=A._encoderConfig.bitrateMax,W=e.bitrate.actualEncoded;if(O&&W){const F=(1e3*O-W)/(1e3*O);return y9[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][C]}}return C}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(W=>W.ssrc===c),m=e.videoRecv.find(W=>W.ssrc===u);if(!h&&!m)return void(r+=1);const g=Xc(this,Ut.NeedSignalRTT),E=e.rtt,S=(E&&g?(E+g)/2:E||g)||0,C=h?h.jitterMs:void 0,A=e.recvPacketLossRate;let O=.7*A*100/50+.3*S/1500;C&&(O=.6*A*100/50+.2*S/1500+.2*C/400),r+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new gt((r,s)=>{this.handleMuteLocalTrack(e,r,s)})}filterTobePublishedTracks(e,r,s){const o=[],c=Vn(),u=this.getAllTracks();e=Ov(e=e.filter(g=>u.indexOf(g)===-1));let h=!1,m=!1;for(const g of e){if(g instanceof Or&&(this.localTrackMap.has(Ye.LocalVideoTrack)||h?new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:g,type:Ye.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(g,s);o.push({track:E,type:Ye.LocalVideoLowTrack})}if(g instanceof oi){const E=this.localTrackMap.get(Ye.LocalAudioTrack);if(E){if(!(E.track instanceof Ui))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const S=o.find(C=>{let{type:A}=C;return A===Ye.LocalAudioTrack});if(!(S.track instanceof Ui))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof Ui||g._bypassWebAudio)o.push({track:g,type:Ye.LocalAudioTrack});else{const S=new Ui;S.addAudioTrack(g),o.push({track:S,type:Ye.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const r=[],s=this.getAllTracks();e=Ov(e=e.filter(o=>s.indexOf(o)!==-1));for(const o of e){if(o instanceof oi){const c=this.localTrackMap.get(Ye.LocalAudioTrack);if(!c)continue;c.track instanceof Ui?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ye.LocalAudioTrack,c]),c.track.close())):r.push([Ye.LocalAudioTrack,c])}if(o instanceof Or){const c=this.localTrackMap.get(Ye.LocalVideoTrack);if(!c)continue;r.push([Ye.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ye.LocalVideoLowTrack);u&&r.push([Ye.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ye.LocalVideoTrack:s.addListener(Tt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ui?e.trackList.forEach(s=>{s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),e.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ye.LocalVideoTrack:s.off(Tt.GET_STATS,this.handleGetLocalVideoStats),s.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ui?e.trackList.forEach(r=>{r.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Tt.GET_STATS,this.handleGetLocalAudioStats),r.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Tt.GET_STATS,this.handleGetLocalAudioStats),e.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Wv&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),r instanceof Gv&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Tt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,s]=e;s.has(Et.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Et.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((s,o)=>{var c;let u,{track:h,type:m}=s;switch(m){case Ye.LocalAudioTrack:u=or.Audio;break;case Ye.LocalVideoTrack:u=et(c=h._hints).call(c,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Ye.LocalVideoLowTrack:u=or.Low}return{kind:m===Ye.LocalAudioTrack?Et.AUDIO:Et.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalVideoTrack:o=et(s=u._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Ye.LocalAudioTrack:o=or.Audio;break;case Ye.LocalVideoLowTrack:o=or.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(Ut.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),et(s=this._restartStates).call(s,r)&&!e.isInRestartIce&&(r==="disconnected"&&await vs(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),At.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Wr.TRACER}).onSuccess(),this.emit(Ut.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var s;const o=Array.from(Qa(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(jl.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,Yi.FIRST_AUDIO_DECODE,Vr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:ro.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var s;const o=Array.from(Qa(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&At.firstRemoteFrame(this.store.sessionId,Yi.FIRST_AUDIO_RECEIVED,Vr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:ro.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},e.onFirstVideoReceived=r=>{var s;const o=Array.from(Qa(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&At.firstRemoteFrame(this.store.sessionId,Yi.FIRST_VIDEO_RECEIVED,Vr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:ro.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(Ut.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Wm(s))," -> ").concat(JSON.stringify(Wm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Wm(s))," -> ").concat(JSON.stringify(Wm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(Ut.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===aa.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===aa.SEND_ONLY?this.restartICE(e):Us(this,Ut.RequestP2PRestartICE,{direction:aa.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const s=this.localTrackMap.get(Ye.LocalAudioTrack);if(e instanceof oi&&(s==null?void 0:s.track)instanceof Ui)return s.track.isActive||r.push([Ye.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Ye.LocalVideoTrack)){const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],s=this.localTrackMap.get(Ye.LocalAudioTrack);if(e instanceof oi&&(s==null?void 0:s.track)instanceof Ui)return s.track.isActive&&r.push([Ye.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ye.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:o=or.Audio;break;case Ye.LocalVideoTrack:o=et(s=u._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Ye.LocalVideoLowTrack:o=or.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:o=or.Audio;break;case Ye.LocalVideoTrack:o=et(s=u._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Ye.LocalVideoLowTrack:o=or.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const s=[],o=this.remoteUserMap.get(e);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([e,{kind:u,id:h}])});return s}createUnsubscribeMessage(e){const r=[];return e.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case Et.VIDEO:return void(o._videoSSRC&&r.push({stream_type:Et.VIDEO,ssrcId:o._videoSSRC}));case Et.AUDIO:return void(o._audioSSRC&&r.push({stream_type:Et.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new gt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new gt((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof oi){const s=this.filterTobeUnmutedTracks(e[r]);if(s.length===0)continue;const o=this.createUnmuteMessage(s);return void await yr(this,Ut.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(Ut.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(Ut.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await vs(pL(this.dtlsFailedCount,Di)),this.emit(Ut.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ye.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Or)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof Or).length>1)throw new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof oi).length>1&&(e.some(r=>r instanceof oi&&r._bypassWebAudio)||!Vn().webAudioMediaStreamDest))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof Or&&this.pendingLocalTracks.some(s=>s instanceof Or))throw new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof oi&&this.pendingLocalTracks.some(s=>s instanceof oi)&&(!Vn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof oi&&s._bypassWebAudio)))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const s=!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding,o=m1(m1({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?e._mediaStreamTrack.clone():P2(e,o);const u=Er(8,"track-low-"),h=new Or(c,m1(m1({},s&&{scaleResolutionDownBy:l2(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(K_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Uv.LOW_STREAM)}),h._hints.push(_r.LOW_STREAM),e.addListener(Tt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,s,o){var c;const u=Array.from(Qa(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===u.uid&&g.type==="video");At.firstRemoteVideoDecode(this.store.sessionId,Yi.FIRST_VIDEO_DECODE,Vr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:ro.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,s){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==s}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Le(ee.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Le(ee.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new Le(ee.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new Le(ee.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new Le(ee.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new Le(ee.NOT_SUPPORTED)}async preConnect(e){throw new Le(ee.NOT_SUPPORTED)}getEstablishParams(){throw new Le(ee.NOT_SUPPORTED)}async reSubscribe(e){throw new Le(ee.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,r){throw new Le(ee.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:s}]=e;r===Ye.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Uv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Ct(Hr.prototype,"p2pConnect",[Z$],Object.getOwnPropertyDescriptor(Hr.prototype,"p2pConnect"),Hr.prototype),Ct(Hr.prototype,"unpublish",[eK],Object.getOwnPropertyDescriptor(Hr.prototype,"unpublish"),Hr.prototype),Ct(Hr.prototype,"unpublishLowStream",[tK],Object.getOwnPropertyDescriptor(Hr.prototype,"unpublishLowStream"),Hr.prototype),Ct(Hr.prototype,"subscribe",[nK],Object.getOwnPropertyDescriptor(Hr.prototype,"subscribe"),Hr.prototype),Ct(Hr.prototype,"mockSubscribe",[rK],Object.getOwnPropertyDescriptor(Hr.prototype,"mockSubscribe"),Hr.prototype),Ct(Hr.prototype,"unsubscribe",[iK],Object.getOwnPropertyDescriptor(Hr.prototype,"unsubscribe"),Hr.prototype),Ct(Hr.prototype,"muteRemote",[sK],Object.getOwnPropertyDescriptor(Hr.prototype,"muteRemote"),Hr.prototype),Ct(Hr.prototype,"unmuteRemote",[oK],Object.getOwnPropertyDescriptor(Hr.prototype,"unmuteRemote"),Hr.prototype),Ct(Hr.prototype,"hasRemoteMediaWithLock",[aK],Object.getOwnPropertyDescriptor(Hr.prototype,"hasRemoteMediaWithLock"),Hr.prototype),Ct(Hr.prototype,"disconnectForReconnect",[cK],Object.getOwnPropertyDescriptor(Hr.prototype,"disconnectForReconnect"),Hr.prototype),Ct(Hr.prototype,"remoteMediaSsrcChanged",[lK],Object.getOwnPropertyDescriptor(Hr.prototype,"remoteMediaSsrcChanged"),Hr.prototype),Hr);function Gd(e){return function(r,s,o){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case Wd.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}case Wd.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s)),E=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g(),E()}}}},o}}class dy extends Xr{constructor(r,s){super(),q(this,"signal",void 0),q(this,"token",void 0),q(this,"tokenTimeout",void 0),q(this,"tokenInterval",void 0),q(this,"_sequence",0),q(this,"userMap",new Map),q(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const o=()=>{this.signal.connectionState===Rr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*se("P2P_TOKEN_INTERVAL"))};o()}async send(r,s,o,c,u){var h;if(this.userMap.size===0)return;const m=Array.from(wc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=c??Er(6,""),u=u??this._sequence++;const g={_id:c,_type:r,_seq:u,_message:s,token:"".concat(this.token,"_").concat(m)};se("SHOW_P2P_LOG")&&x.debug("send message",g,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(g)).forEach(S=>{this.signal.request(Yt.DATA_STREAM,{payload:Um(this.encoder.encode(S))})});const E=new gt((S,C)=>{const A=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),O),this.off("res-@".concat(c),F),this.off(Yv.ABORT,W),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?C(new Le(ee.INVALID_REMOTE_USER)):C(new Le(ee.TIMEOUT))},se("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),O=()=>{A&&window.clearTimeout(A),this.off(Yv.ABORT,W),o&&S()},W=()=>{A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),O),this.off("res-@".concat(c),F),C(new Le(ee.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Yv.ABORT,W),this.once("res-@".concat(c,"_ack"),O);const F=(Z,Q)=>{B=!0,A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),O),this.off(Yv.ABORT,W),Z==="success"?S(Q):C(new Le(ee.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let B=!1;o||(this.once("res-@".concat(c),F),vs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{B||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))}))});try{return await E}catch(S){if(S.code===ee.TIMEOUT)return await this.send(r,s,o,c,u);throw S}}onMessage(r){var s;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==gi.CHECK)return;const{token:E}=r;c=new Map,u={uid:o,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(Rn.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:S}=r,C=(h=c.get(E))!==null&&h!==void 0?h:[];if(C.push(r),c.has(E)||c.set(E,C),C.length!==S)return;{const A=x_(C).call(C,(O,W)=>O.index-W.index).map(O=>O.payload).join("");c.delete(E),(r=JSON.parse(A))._uid=o}}const{_type:m,token:g}=r;if(et(s=[gi.ACK,gi.CHECK]).call(s,m))return m===gi.CHECK&&this.handleCheckToken(u,g),void this.receiveMessage(r);g==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:Er(6,""),token:this.token,_type:gi.CHECK};se("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Yt.DATA_STREAM,{payload:Um(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:gi.ACK,token:this.token};se("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Yt.DATA_STREAM,{payload:Um(this.encoder.encode(JSON.stringify(s)))})}response(r,s,o){this.send(gi.RESPONSE,JSON.stringify({success:!o,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:C}=E;for(;S.has(C);){const A=S.get(C);S.delete(C),this.receiveMessage(A),E.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:g}=u;if(c<g)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===g&&(this.receiveMessage(r),h.delete(g),u.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:o,_message:c,_uid:u}=r;if(se("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==gi.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case gi.CANDIDATE:case gi.CONTROL:this.signal.emit(o,h,u);break;case gi.PUBLISH:case gi.UNPUBLISH:case gi.RESTART_ICE:case gi.CALL:h.uid=u,Us(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case gi.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case gi.RESPONSE:{const{success:m,message:g}=h;this.emit("res-@".concat(s),m?"success":"failed",g);break}}}}splitMessage(r){if(r.length<dy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:o}=JSON.parse(r),c=Er(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const g={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(g).length>dy.MAX_MESSAGE_SIZE?h-=50:(s.push(g),r=r.slice(h))}return s.map(g=>JSON.stringify(g))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},se("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Us(this.signal,gi.CALL,void 0),s=await this.send(gi.CALL,r);this.signal.emit(Qt.P2P_CONNECTION,s,!0)}async reset(r,s){const o=this.userMap.get(r);o&&(this.emit(Yv.ABORT),this.signal.emit(Rn.ON_USER_OFFLINE,{uid:o.uid,reason:oge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=Er(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Yv.ABORT)}}q(dy,"MAX_SIZE",1),q(dy,"MAX_MESSAGE_SIZE",1024);class zye extends Xr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Rr.CONNECTED?this.emit(Qt.WS_CONNECTED):r===Rr.RECONNECTING?this.emit(Qt.WS_RECONNECTING,this._websocketReconnectReason):r===Rr.CLOSED&&this.emit(Qt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",Rr.CLOSED),q(this,"reconnectToken",void 0),q(this,"p2pToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new jz(5)),q(this,"pingpongTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"_external_signal",void 0),q(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Qt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Rn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Rn.MUTE_AUDIO:case Rn.MUTE_VIDEO:case Rn.ON_P2P_LOST:case Rn.ON_USER_ONLINE:return;case Rn.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===Rn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Rn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(nr.UID_BANNED);break;case 15:this.close(nr.IP_BANNED);break;case 16:this.close(nr.CHANNEL_BANNED)}if(c._type===Rn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(nr.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(nr.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(nr.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(nr.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(nr.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(nr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new a2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,se("JOIN_GATEWAY_USE_DUAL_DOMAIN"),se("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Rr.CONNECTED&&this.reconnect("retry",Ms.OFFLINE)}),this.p2pToken=Er(6,""),this._external_signal=new dy(this,this.p2pToken)}async request(r,s,o,c){const u=Er(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new gt((W,F)=>{if(this.connectionState===Rr.CONNECTED)return W();const B=()=>{this.off(Qt.WS_CLOSED,Z),W()},Z=()=>{this.off(Qt.WS_CONNECTED,B),F(new Le(ee.WS_ABORT))};this.once(Qt.WS_CONNECTED,B),this.once(Qt.WS_CLOSED,Z)});if(this.connectionState!==Rr.CONNECTING&&this.connectionState!==Rr.RECONNECTING||r===Yt.JOIN||r===Yt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const E=new gt((W,F)=>{let B=!1;const Z=(ae,ye)=>{B=!0,W({isSuccess:ae==="success",message:ye||{}}),this.off(Qt.WS_CLOSED,Q),this.off(Qt.WS_RECONNECTING,Q),this.emit(Qt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),Z);const Q=()=>{F(new Le(ee.WS_ABORT,"type: ".concat(r))),this.off(Qt.WS_CLOSED,Q),this.off(Qt.WS_RECONNECTING,Q),this.off("res-@".concat(u),Z)};this.once(Qt.WS_CLOSED,Q),this.once(Qt.WS_RECONNECTING,Q),vs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Qt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await E}catch(W){if(this.connectionState===Rr.CLOSED||r===Yt.LEAVE)throw new Le(ee.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?W.throw():r===Yt.JOIN||r===Yt.REJOIN?null:(await g(),await this.request(r,s))}if(S.isSuccess)return S.message;const C=Number(S.message.error_code||S.message.code),A=qw(C),O=new Le(ee.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(S.message.error_str),{code:C,data:S.message,desc:A.desc});return A.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(C,", message: ").concat(A.desc,", action: ").concat(A.action)),C===Bt.ERR_TOO_MANY_BROADCASTERS?((r===Yt.JOIN||r===Yt.REJOIN)&&(this.initError=O,this.close()),O.throw()):A.action==="failed"?O.throw():A.action==="quit"?(this.initError=O,this.close(),O.throw()):(C===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ms.MULTI_IP)):this.reconnect(A.action,Ms.SERVER_ERROR),r===Yt.JOIN||r===Yt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new gt(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload($w.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=se("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Rr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},se("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}async sendExtensionMessage(r,s,o){return await this._external_signal.send(r,s,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new gt((s,o)=>{this.once(Qt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Qt.WS_CLOSED,()=>o(this.initError||new Le(ee.WS_ABORT))),this.connectionState=Rr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||nr.LEAVE,this.connectionState=Rr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Er(6,""),this._external_signal.clear(),this._external_signal=new dy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Qt.ABORT_P2P_EXECUTION);const r=await Us(this,Qt.REQUEST_JOIN_INFO),s=await this.request(Yt.JOIN,r);if(!s)return this.emit(Qt.REPORT_JOIN_GATEWAY,ee.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Qt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Rr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){return!1}handleDataStream(r){try{var s;const o=G_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||et(s=Object.values(gi)).call(s,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(Rn.ON_DATA_STREAM,r)}catch{this.emit(Rn.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=qw(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(nr.UID_BANNED),void this.close()):void this.reconnect(s.action,Ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=se("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>se("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ms.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),se("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(cn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Qt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(cn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(cn.CLOSED,()=>{this.connectionState=Rr.CLOSED}),this.websocket.on(cn.FAILED,()=>{this._disconnectedReason=nr.NETWORK_ERROR,this.connectionState=Rr.CLOSED}),this.websocket.on(cn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Rr.CONNECTED?this.connectionState=Rr.RECONNECTING:this.connectionState=Rr.CONNECTING}),this.websocket.on(cn.WILL_RECONNECT,(r,s,o)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(cn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Qt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===ee.UNEXPECTED_RESPONSE&&r.data.code===Bt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ms.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(cn.REQUEST_NEW_URLS,(r,s)=>{Us(this,Qt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Wye={name:"P2PChannel",create:function(e){let{store:r,statsCollector:s}=e;return new Bye(r,s)},createSubmodule:function(e){let{store:r,spec:s}=e;return new zye(s,r)}};function dK(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function hK(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?dK(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):dK(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class Gye{constructor(r){q(this,"sessionDesc",void 0),q(this,"localCapabilities",void 0),q(this,"rtpCapabilities",void 0),q(this,"candidates",void 0),q(this,"_originCandidates",void 0),q(this,"iceParameters",void 0),q(this,"dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),r=Gr(r);const{iceParameters:s,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:g,cname:E}=r,S=Ja(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Gr(c),this.iceParameters=s,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=E;for(let C=0;C<S.mediaDescriptions.length;C++){const A=S.mediaDescriptions[C];if(A.attributes.iceUfrag=s.iceUfrag,A.attributes.icePwd=s.icePwd,A.attributes.fingerprints=o.fingerprints,A.attributes.candidates=c,A.attributes.setup=h,A.media.mediaType==="video"){A.media.fmts=u.videoCodecs.map(F=>F.payloadType.toString(10));const O=u.videoCodecs.filter(F=>{var B,Z;return(B=F.rtpMap)===null||B===void 0?void 0:et(Z=B.encodingName.toLowerCase()).call(Z,g)}),W=u.videoCodecs.filter(F=>!et(O).call(O,F));A.attributes.payloads=[...O,...W],A.attributes.extmaps=u.videoExtensions}A.media.mediaType==="audio"&&(A.media.fmts=u.audioCodecs.map(O=>O.payloadType.toString(10)),A.attributes.payloads=u.audioCodecs,A.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[C]=this.mungMediaDesc(A)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Vm(this.sessionDesc)}send(r,s,o){const{ssrcs:c,ssrcGroups:u}=Qw(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>r===Et.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),m=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:g}}batchSend(r){return r.map(s=>{let{kind:o,ssrcMsg:c}=s;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const o=[],c=[],u=[];s.attributes.ssrcs.forEach(h=>{et(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;et(m=u.map(g=>g.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=o,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=g})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(s.forEach(c=>{o.push(hK(hK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case no.TCP_RELAY:this.candidates=o;break;case no.UDP_TCP_RELAY:case no.RELAY:this.candidates=[...s,...o];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Gr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let o=0;o<r;o++)s.push((this.currentMidIndex+o+1).toString(10));return s}mungRecvMediaDsec(r,s){const o=Gr(r);return Qv(o,s),d2(o,s),o}updateRecvMedia(r,s){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],s);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===Et.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(s,o))}}mungMediaDesc(r){const s=Gr(r);return u2(s),function(o){const c=o.attributes.extmaps.find(u=>OP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const o of s.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var vr;function pK(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function g1(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?pK(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):pK(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let Hye=(vr=class cR extends I9{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return et(s=Object.keys(Bw)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"statsFilter",void 0),q(this,"useRTX",!1),q(this,"localCapabilities",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"establishPromise",void 0),q(this,"mutex",void 0),this.store=s,this.mutex=new Zs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(cR.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=EL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,Zr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Gm(r.sdp),o=Jw(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:se("FILTER_VIDEO_FEC"),filterAudioFec:se("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,g1(g1({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new Le(ee.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Gye(g1(g1({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(ee.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var o=this;return Ul(function*(){const c=yield Un(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(A=>o.peerConnection.addTrack(A._mediaStreamTrack)),h=yield Un(o.peerConnection.createOffer()),m=Ja(h.sdp),g=r.map(A=>{const O=A._mediaStreamTrack,W=m.mediaDescriptions.find(F=>F.attributes.mid===O.kind);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return function(F,B,Z){const Q=F.attributes.ssrcs.filter(ye=>ye.attributes.label===B),ae=F.attributes.ssrcGroups;if(Q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ae&&Q.length>1){const ye=ae.find(_e=>_e.ssrcIds.indexOf(Q[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:Z?ye.ssrcIds[1]:void 0}]:[{ssrcId:Q[0].ssrcId}]}return[{ssrcId:Q[0].ssrcId}]}(W,O.id,o.useRTX)});let E;try{E=yield g}catch(A){throw u.forEach(O=>{Ls()&&O.replaceTrack(null),o.peerConnection.removeTrack(O)}),A}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,s,E);const C=o.remoteSDP.toString();return yield Un(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Un(o.applySendEncodings(u,r)),yield Un(o.peerConnection.setRemoteDescription({type:"answer",sdp:C})),r.map((A,O)=>{const W=A._mediaStreamTrack.id;return{localSSRC:g[O],id:W}})}catch(u){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(u=>{Ls()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,s,c),m=new gt((S,C)=>{const A=setTimeout(()=>{C(new Error("Cannot receive track, id: ".concat(u)))},1e4),O=W=>{const F=Nn();if((F.name==="Safari"&&Number(F.version)===11||_o())&&W.track.id!==u&&W.streams[0].id===h){var B;const Z=W.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(r,u,W.track.id),this.peerConnection.removeEventListener("track",O),clearTimeout(A),void S(Z)}if(W.track.id===u)return this.peerConnection.removeEventListener("track",O),clearTimeout(A),void S(W.track)};this.peerConnection.addEventListener("track",O)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:u}}catch(u){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(o=>{if(Ls()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async u=>{if(Ls()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Ul(function*(){const o=yield Un(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Vn().supportPCSetConfiguration;if(r===no.RELAY&&!c)return;if(c){const E=s.peerConnection.getConfiguration(),S=r===no.RELAY?"relay":"all";E.iceTransportPolicy!==S&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(S,"]")),E.iceTransportPolicy=S,s.peerConnection.setConfiguration(E))}r!==no.RELAY&&s.remoteSDP.updateCandidates(r);const u=yield Un(s.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Gm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const g=s.remoteSDP.toString();yield Un(s.peerConnection.setLocalDescription(u)),yield Un(s.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(ee.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===s});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(ee.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(ee.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},se("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Mw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...cR.turnServerConfigToIceServers(r.turnServer.servers)),se("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...cR.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(E=>{var S;return((S=E.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Vn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof Or)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(se("DSCP_TYPE")&&of()){var h;const E=se("DSCP_TYPE");et(h=["very-low","low","medium","high"]).call(h,E)&&(u.networkPriority=E)}const m=s.getParameters(),g=(o=m.encodings)===null||o===void 0?void 0:o[0];g&&Object.assign(g,u),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Vn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const o=Ja(r);return s.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(g=>g.attributes.mid===h.kind);m&&Qv(m,c)}),Vm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:g}=u;const{kind:E}=r[h];return new gt((S,C)=>{const A=setTimeout(()=>{C(new Error("Cannot receive track, id: ".concat(m)))},1e4),O=W=>{const F=Nn();if(F.name==="Safari"&&Number(F.version)===11&&W.track.id!==m&&W.streams[0].id===g){var B;const Z=W.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(E,m,W.track.id),this.peerConnection.removeEventListener("track",O),clearTimeout(A),void S({track:Z,id:m})}if(W.track.id===m)return this.peerConnection.removeEventListener("track",O),clearTimeout(A),void S({track:W.track,id:m})};this.peerConnection.addEventListener("track",O)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await gt.all(s)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Vn().supportPCSetConfiguration){const s=cR.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Ct(vr.prototype,"connect",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"connect"),vr.prototype),Ct(vr.prototype,"stopSending",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"stopSending"),vr.prototype),Ct(vr.prototype,"receive",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"receive"),vr.prototype),Ct(vr.prototype,"stopReceiving",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"stopReceiving"),vr.prototype),Ct(vr.prototype,"muteRemote",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"muteRemote"),vr.prototype),Ct(vr.prototype,"unmuteRemote",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"unmuteRemote"),vr.prototype),Ct(vr.prototype,"muteLocal",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"muteLocal"),vr.prototype),Ct(vr.prototype,"unmuteLocal",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"unmuteLocal"),vr.prototype),Ct(vr.prototype,"close",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"close"),vr.prototype),Ct(vr.prototype,"updateEncoderConfig",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"updateEncoderConfig"),vr.prototype),Ct(vr.prototype,"updateSendParameters",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"updateSendParameters"),vr.prototype),Ct(vr.prototype,"replaceTrack",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"replaceTrack"),vr.prototype),Ct(vr.prototype,"getRemoteSSRC",[$l],Object.getOwnPropertyDescriptor(vr.prototype,"getRemoteSSRC"),vr.prototype),vr);function $l(e,r,s){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},s}const $ye={name:"PlanBConnection",create:function(e){let{store:r,spec:s}=e;return new Hye(s,r)}},Kye={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(pP.has(e)||!e.track)return;const s={track:e.track};if(sf()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),e.track&&e.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o));const g=r.metadata&&r.metadata();g?function(E,S){const{chunk:C,controller:A}=S,O=Fm.METADATA;C.data=function(W,F,B){const Z=B.byteLength,Q=Z+GL+u9,ae=zL+WL+Q,ye=new ArrayBuffer(W.byteLength+ae),_e=new DataView(ye);_e.setUint8(0,l9),_e.setUint16(1,Q),_e.setUint8(3,F),_e.setUint16(4,Z);for(let Ie=0;Ie<Z;Ie++)_e.setUint8(6+Ie,B[Ie]);const ue=new Uint8Array(_e.buffer);return ue.set(new Uint8Array(W),ae),ue.buffer}(C.data,O,E),A.enqueue(C)}(g,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ls()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=hP(),u=new MessageChannel;await new gt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new gt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;if(m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&u.port1.postMessage({metadata:E})}},s.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=pP.get(e);if(c){pP.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}pP.set(e,s),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(EP.has(e))return;const s={track:e.track,onMetadata:r.onMetadata,onPts:r.onPts};if(sf()&&!_o()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");Zx(Gn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),e.track&&e.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o)),r.enableTopn?function(g,E,S){var C;const A=HL(new DataView(E.data));if(!A)return S.enqueue(E);const O=g.track.id;Ime.set(O,g.track);const W=(C=A.tlv.find(ye=>ye.tag===Fm.AUDIO_LEVEL))===null||C===void 0?void 0:C.value;let F=0;typeof W=="number"&&(F=127-W);const B=Math.round(Math.pow(10,F/60)-1),{selected:Z,speaker:Q}=function(ye,_e){let ue=Hv.get(ye);if(ue||(ue=function(Ie){const Ue=new h9;return Hv.set(Ie,Ue),Ud||(Ud=new Rme(se("TOPN_SILENCE_THRESHOLD")||500),Ud.on("ActiveSpeakerChanged",We=>{We!=null&&(gP=We)})),Ud.addSpeakers([Ue]),Ue}(ye)),Hv.size<=p9)return{selected:!0,speaker:ue};if(!Ud)throw new Error("no active speaker detector");return Ud.levelChanged(ue.id,_e),J_=Ud.loudest.map(Ie=>Ie.id),gP&&!et(J_).call(J_,gP)&&J_.length>=p9&&J_.pop(),{selected:et(J_).call(J_,ue.id)||ue.id===gP,speaker:ue}}(g,B),ae=function(ye,_e,ue){const Ie=Vd.get(ye)||new Cme(ye,_e);return Ie.score=ue,Vd.set(ye,Ie),function(Ue){if(_P.set(Ue,!0),!yP)return void(yP=Date.now());const We=Date.now();We-yP>1e3&&(_P.get(Ue)?_P.set(Ue,!1):(f9(Ue),_P.delete(Ue)),yP=We)}(ye),Ie}(O,g.track,Q.energyScore);ae.addSample(Z),ae.active&&(E.data=A.frame.buffer,S.enqueue(E))}(e,h,m):r.enableMetadata||r.enablePts?function(g,E,S,C){const A=new DataView(g.data),O=A.getUint8(0);let W;if((128&O)!=0&&O!==71){const Z=function(Q){if(Q.byteLength<=0)return[];const ae=[];let ye=0;for(;ye<Q.byteLength;){const ue=(128&Q.getUint8(ye))>>7,Ie=127&Q.getUint8(ye);if(!(ue&&ye+4<=Q.byteLength)){ye++;break}{const Ue=Q.getUint32(ye,!1),We=(16776192&Ue)>>10,Je=1023&Ue;ae.push({pt:Ie,ts_offset:We,length:Je,data:new Uint8Array}),ye+=4}}let _e=Q.byteLength-ye;for(const ue of ae){if(ue.length>_e)return console.warn("Broken red payload"),[];ue.length>0&&(ue.data=new Uint8Array(Q.buffer,Q.byteOffset+ye,ue.length),ye+=ue.length,_e-=ue.length)}if(_e>0){const ue={pt:ae.length>0?ae[ae.length-1].pt:0,ts_offset:0,length:_e,data:new Uint8Array(Q.buffer,Q.byteOffset+ye,_e)};ae.push(ue)}return ae}(A);if(Z.length>0){const Q=function(ae){let ye=0;for(let Ie=0;Ie<ae.length;Ie++)ye+=Ie<ae.length-1?4:1,ye+=ae[Ie].length;const _e=new Uint8Array(ye);let ue=0;for(let Ie=0;Ie<ae.length;Ie++)if(Ie<ae.length-1){const Ue=(2147483648|(127&ae[Ie].pt)<<24|(262143&ae[Ie].ts_offset)<<10|1023&ae[Ie].length)>>>0;_e[ue++]=Ue>>24&255,_e[ue++]=Ue>>16&255,_e[ue++]=Ue>>8&255,_e[ue++]=255&Ue}else _e[ue++]=127&ae[Ie].pt;for(const Ie of ae)_e.set(Ie.data,ue),ue+=Ie.length;return _e}(Z.map(ae=>{const ye=new Uint8Array(ae.length);ye.set(ae.data);const _e=HL(new DataView(ye.buffer));return _e!=null&&_e.frame&&(ae.data=_e==null?void 0:_e.frame),W=_e,ae}));g.data=Q.buffer}}else W=HL(A),W&&(g.data=W.frame.buffer);if(E.enqueue(g),!W)return;const F=W.tlv.find(Z=>Z.tag===Fm.METADATA);F&&S&&F.value instanceof Uint8Array&&S(F.value);const B=W.tlv.find(Z=>Z.tag===Fm.AUDIO_64_BIT_PTS);B&&C&&B.value instanceof Uint8Array&&B.value.length==8&&C(new DataView(B.value.buffer).getBigUint64(0,!0))}(h,m,r.onMetadata,r.onPts):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=hP(),u=new MessageChannel;await new gt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new gt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o)):m.data.metadata&&s.onMetadata?s.onMetadata(m.data.metadata):m.data.pts&&s.onPts&&s.onPts(m.data.pts)},s.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=EP.get(c);if(u){(function(g){const E=Hv.get(g);E&&(Hv.delete(g),Ud&&(Ud.removeSpeakers([E]),Hv.size===0&&(Ud.destroy(),Ud=null)))})(c),f9(c.track.id),EP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){x.warning(g&&g.message)}}}(e)}EP.set(e,s),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,r){if(!Vn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(vP.has(e)||!e.track)return;const s={track:e.track};if(sf()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,g){s.controller||(s.controller=g),e.track&&e.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o));const E=_9(new Uint8Array(m.data)),S=u.shift();if(S){const C=function(A,O,W){switch(W){case YL:return function(F,B){const Z=g9(B),Q=Z.length,ae=Math.floor(Q/255),ye=Q%255,_e=new Uint8Array(6+ae+1+Q+F.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=6,_e[5]=101;let ue=0;for(;ue<ae;)_e[6+ue]=255,ue++;return _e[6+ue]=ye,ue++,_e.set(Z,6+ue),_e.set(new Uint8Array(F),6+ue+Q),_e.buffer}(A,O);case XL:return function(F,B){const Z=g9(B),Q=Z.length,ae=Math.floor(Q/255),ye=Q%255,_e=new Uint8Array(7+ae+1+Q+1+F.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=78,_e[5]=1,_e[6]=101;let ue=0;for(;ue<ae;)_e[7+ue]=255,ue++;return _e[7+ue]=ye,ue++,_e.set(Z,7+ue),ue+=Q,_e[7+ue]=128,ue++,_e.set(new Uint8Array(F),7+ue),_e.buffer}(A,O);default:return null}}(m.data,S,E);C&&(m.data=C)}g.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Ls())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=hP(),u=new MessageChannel;await new gt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new gt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var g;m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o))},s.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=vP.get(e);if(c){vP.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}vP.set(e,s),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!e.track)return;if(Hw.has(e)){const c=Hw.get(e);return void(c&&(c.onSei=r.onSei))}const s={track:e.track,onSei:r.onSei};if(sf()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),e.track&&e.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o));const g=function(E,S){switch(S){case YL:return function(C){const A=new DataView(C.data);let O=0;for(;O+4<C.data.byteLength;){if(A.getUint8(O+0)===0&&A.getUint8(O+1)===0&&A.getUint8(O+2)===0&&A.getUint8(O+3)===1&&A.getUint8(O+4)===6){let W=O+6,F=0,B=0;for(;(B=A.getUint8(W++))===255;)F+=255;F+=B;const Z=m9(C.data,W,F);return new Uint8Array(Z)}O++}return null}(E);case XL:return function(C){const A=new DataView(C.data);let O=0;for(;O+5<C.data.byteLength;){if(A.getUint8(O+0)===0&&A.getUint8(O+1)===0&&A.getUint8(O+2)===0&&A.getUint8(O+3)===1&&A.getUint8(O+4)===78&&A.getUint8(O+5)===1&&A.getUint8(O+6)===101){let W=O+7,F=0,B=0;for(;(B=A.getUint8(W++))===255;)F+=255;F+=B;const Z=m9(C.data,W,F);return new Uint8Array(Z)}O++}return null}(E);default:return null}}(h,_9(new Uint8Array(h.data)));g&&s.onSei&&s.onSei(g),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ls()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=hP(),u=new MessageChannel;await new gt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new gt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=Hw.get(c);if(u){Hw.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){x.warning(g&&g.message)}}})(e)}Hw.set(e,s),e.track.addEventListener("ended",o)}},qye={name:"InterceptFrame",create:()=>Kye};vL(),hr("PROCESS_ID","process-".concat(Er(8,""),"-").concat(Er(4,""),"-").concat(Er(4,""),"-").concat(Er(4,""),"-").concat(Er(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(Ur,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;Md[o]=c,Ur[o]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(Md.AREAS)&&Md.AREAS.length>0&&m2(Md.AREAS,!0);const fK=(e,r,s)=>{x.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),hr(e,r,s)};Km(_ye,!1),Km(vye,!1),Km(Zge,!1),Km(kye,!1),Km(fye,!1),Km(Wye,!1),Km($ye,!1),Km(qye,!1);const xi=function(e){const r=new Xr,s=e,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===Xh.SECURITY_POLICY_VIOLATION&&q7(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return K7(K7({},s),o)}({__TRACK_LIST__:Mv,VERSION:Vl,BUILD:wL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:fK,getParameter:se,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(o){let c;return Vn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return e;r.close(),r=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new ke(ee.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=At.reportApiInvoke(null,{name:li.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Wr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&sL()&&mz(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let s=!1;const o=Nn();o.name===Gn.CHROME&&Number(o.version)>=58&&(Dd.engine.name!=="WebKit"||function(){const u=Nn();if(YA()){if(u.os===ts.MAC_OS)return!0;if(u.os===ts.IOS){const h=Dd.os.version&&Dd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(o.name===Gn.FIREFOX&&Number(o.version)>=56||o.name===Gn.OPERA&&Number(o.version)>=45||o.name===Gn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(_o()||Ou())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||Sz()||Nn().name===Gn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return e.onSuccess(c),c},getDevices:function(e){return nl.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return nl.getRecordingDevices(e)},getCameras:function(e){return nl.getCamerasDevices(e)},getElectronScreenSources:mW,getPlaybackDevices:function(e){return nl.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=Er(5,"client-"),o=At.reportApiInvoke(null,{id:s,name:li.CREATE_CLIENT,options:[r],tag:Wr.TRACER});try{(function(c){qi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),qi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&qi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Es(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&Pz(c.turnServer),c.httpRetryConfig!==void 0&&Az(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&Az(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(yz(16,0)||nL(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),hr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new e_e(Fu(Fu({forceWaitGatewayResponse:!0},r),{},{role:et(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=se("CAMERA_CAPTURE_CONFIG"),s=Er(8,"track-cam-"),o=At.reportApiInvoke(null,{id:s,tag:Wr.TRACER,name:li.CREATE_CAM_VIDEO_TRACK,options:[Tr({},e),r]});r&&(e.encoderConfig=r);const c=uP(e);let u=null;x.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{u=(await tl({video:c},s)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Le(ee.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(x)}if(e.optimizationMode&&BL(s,u,e,Du(e.encoderConfig)),se("USE_STANDARD_BITRATE_DEFAULT")){const m=Du(e.encoderConfig);e.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const h=new dP(u,e,c,e.scalabiltyMode?oP(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return o.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(e){const r=Er(8,"track-cus-"),s=At.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:li.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});se("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const o=new Or(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?oP(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[_r.CUSTOM_TRACK]);return s.onSuccess(o.getTrackId()),x.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(A){return RW(A)}(r):void 0;s&&(r="auto");const o=Er(8,"track-scr-v-"),c=At.reportApiInvoke(null,{id:o,tag:Wr.TRACER,name:li.CREATE_SCREEN_VIDEO_TRACK,options:[Tr({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(A){const O={};A.screenSourceType&&(O.mediaSource=A.screenSourceType),A.extensionId&&sf()&&(O.extensionId=A.extensionId);const{displaySurface:W,selfBrowserSurface:F,surfaceSwitching:B,systemAudio:Z,preferCurrentTab:Q}=A;(Iv(107)||eL(107)||rL(93))&&(W&&(qi(W,"displaySurface",["browser","window","monitor"]),O.displaySurface=W),F?(qi(F,"selfBrowserSurface",["exclude","include"]),O.selfBrowserSurface=F):O.selfBrowserSurface="include",B&&(qi(B,"surfaceSwitching",["exclude","include"]),O.surfaceSwitching=B)),(Iv(105)||eL(105)||rL(91))&&Z&&(qi(Z,"systemAudio",["exclude","include"]),O.systemAudio=Z),(Iv(94)||eL(94)||rL(80))&&Q&&(O.preferCurrentTab=!0),A.electronScreenSourceId&&(O.sourceId=A.electronScreenSourceId);const ae=A.encoderConfig?PL(A.encoderConfig):null;return O.mandatory={chromeMediaSource:"desktop",maxWidth:ae?ae.width:void 0,maxHeight:ae?ae.height:void 0},ae&&(ae.frameRate&&(typeof ae.frameRate=="number"?(O.mandatory.maxFrameRate=ae.frameRate,O.mandatory.minFrameRate=ae.frameRate):(O.mandatory.maxFrameRate=ae.frameRate.max||ae.frameRate.ideal||ae.frameRate.exact||void 0,O.mandatory.minFrameRate=ae.frameRate.min||ae.frameRate.ideal||ae.frameRate.exact||void 0),O.frameRate=ae.frameRate),ae.width&&(O.width=ae.width),ae.height&&(O.height=ae.height)),O}(e);let h=null,m=null;const g=Vn();if(!g.supportShareAudio&&r==="enable"){const A=new Le(ee.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(A),A.throw(x)}x.info("start create screen video track with config",e,"withAudio",r,"trackId",o);const E=g.supportShareAudio&&r!=="disable";try{const A=await tl({screen:u,screenAudio:E?s||!0:void 0},o);h=A.getVideoTracks()[0]||null,m=A.getAudioTracks()[0]||null}catch(A){throw c.onError(A),A}if(!h){const A=new Le(ee.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(A),A.throw(x)}if(!m&&r==="enable"){h&&h.stop();const A=new Le(ee.SHARE_AUDIO_NOT_ALLOWED);return c.onError(A),A.throw(x)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(BL(o,h,e,e.encoderConfig&&PL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new Or(h,e.encoderConfig?PL(e.encoderConfig):{},e.scalabiltyMode?oP(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[_r.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const C=new oi(m,void 0,Er(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),C.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",C.getTrackId()),[S,C]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=se("CAMERA_CAPTURE_CONFIG"),o=Er(8,"track-mic-"),c=Er(8,"track-cam-"),u=At.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Wr.TRACER,name:li.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,s]});s&&(r.encoderConfig=s);const h=uP(r),m=CW(e);let g=null,E=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const A=await tl({audio:m,video:h},"".concat(o,"-").concat(c));g=A.getAudioTracks()[0],E=A.getVideoTracks()[0]}catch(A){throw u.onError(A),A}if(!g||!E){const A=new Le(ee.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(A),A.throw(x)}if(r.optimizationMode&&BL(c,E,r,Du(r.encoderConfig)),se("USE_STANDARD_BITRATE_DEFAULT")){const A=Du(r.encoderConfig);r.encoderConfig=A,delete A.bitrateMax,delete A.bitrateMin}const S=new Gw(g,e,m,o),C=new dP(E,r,h,r.scalabiltyMode?oP(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),C.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,C]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Er(8,"track-mic-"),s=At.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:li.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=CW(e);let c=null;x.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{c=(await tl({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(ee.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const u=new Gw(c,e,o,r);return s.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(e){const r=Er(8,"track-cus-"),s=At.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:li.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new oi(e.mediaStreamTrack,e.encoderConfig?aP(e.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",e,"trackId",o.getTrackId()),s.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:s,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:o},h=Er(8,"track-buf-"),m=At.reportApiInvoke(null,{id:h,tag:Wr.TRACER,name:li.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(se("DISABLE_WEBAUDIO"))throw new Le(ee.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const g=c;if(!(c instanceof AudioBuffer))try{c=await async function(C,A){let O=null;if(typeof C=="string"){const F=hG.get(C);if(F)return x.debug("use cached audio resource: ",C),F;try{O=(await Ld(()=>Ca.get(C,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(B){throw new Le(ee.FETCH_AUDIO_FILE_FAILED,B.toString())}}else O=await new gt((B,Z)=>{const Q=new FileReader;Q.onload=ae=>{ae.target?B(ae.target.result):Z(new Le(ee.READ_LOCAL_AUDIO_FILE_ERROR))},Q.onerror=()=>{Z(new Le(ee.READ_LOCAL_AUDIO_FILE_ERROR))},Q.readAsArrayBuffer(C)});const W=await function(F){const B=Bv();return new gt((Z,Q)=>{B.decodeAudioData(F,ae=>{Z(ae)},ae=>{Q(new Le(ee.DECODE_AUDIO_FILE_FAILED,ae.toString()))})})}(O);return typeof C=="string"&&A&&hG.set(C,W),W}(c,s)}catch(C){return m.onError(C),C.throw(x)}const E=new vme(c),S=new Eme(g,E,o?aP(o):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(x.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw x.debug("Invalid appType"),new ke(ee.INVALID_PARAMS,"invalid app type",e);hr("APP_TYPE",Math.floor(e))},setLogLevel:function(e){x.setLogLevel(e)},enableLogUpload:function(){se("USE_NEW_LOG")?hr("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){se("USE_NEW_LOG")?hr("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new mH},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=At.reportApiInvoke(null,{tag:Wr.TRACER,name:li.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof oi||e instanceof Gv)){const g=new ke(ee.INVALID_TRACK,"the parameter is not a audio track");return s.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof oi?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new gt(g=>{const E=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const C=u-h>1e-4,A=Date.now()-m;if(C||A>r){clearInterval(E);const O=C,W={duration:A,deviceLabel:o,maxVolumeLevel:u,result:O};x.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(W))),s.onSuccess(W),g(O)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=At.reportApiInvoke(null,{tag:Wr.TRACER,name:li.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Or||e instanceof Wv)){const C=new ke(ee.INVALID_TRACK,"the parameter is not a video track");return s.onError(C),C.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof Or?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Ls()||YA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,g=0;try{const C=Date.now();m=await function(A,O,W,F){let B,Z=0,Q=null;return new gt((ae,ye)=>{function _e(){Z>F&&B&&(B(),ae(Z));const ue=W.getContext("2d");if(!ue){const We=new ke(ee.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(We.toString()),void ye(We)}ue.drawImage(A,0,0,160,120);const Ie=ue.getImageData(0,0,W.width,W.height),Ue=Math.floor(Ie.data.length/3);if(Q){for(let We=0;We<Ue;We+=3)if(Ie.data[We]!==Q[We])return Z+=1,void(Q=Ie.data);Q=Ie.data}else Q=Ie.data}setTimeout(()=>{B&&(B(),ae(Z))},O),B=xL(()=>{_e()},30)})}(u,r,h,4),g=Date.now()-C}catch(C){throw s.onError(C),C}Fge===Gn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const E=m>4,S={duration:g,changedPicNum:m,deviceLabel:o,result:E};return x.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),s.onSuccess(S),E},setArea:m2,audioElementPlayCenter:Ia,resumeAudioContext:function(){Ia.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){n_e.processExternalMediaAEC(e)},registerExtensions:function(e){const r=se("PLUGIN_INFO")||[];e.forEach(s=>{"name"in s&&!et(r).call(r,s.name)&&r.push(s.name);const o=s;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=At.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=se(c)})}),fK("PLUGIN_INFO",r)},ChannelMediaRelayError:Kv,ChannelMediaRelayEvent:lf,ChannelMediaRelayState:Za,RemoteStreamFallbackType:hme,RemoteStreamType:dme,ConnectionDisconnectedReason:nr,AudienceLatencyLevelType:zfe,AREAS:Xn,preload:async function(e,r,s,o){return FH(e,r,s,o)}});return Object.defineProperties(xi,{onAudioAutoplayFailed:{get:()=>rl.onAudioAutoplayFailed,set:e=>{rl.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>rl.onAutoplayFailed,set:e=>{rl.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>xi._onSecurityPolicyViolation,set(e){xi._onSecurityPolicyViolation=e,q7(e)}},__CLIENT_LIST__:{get:()=>se("SHOW_GLOBAL_CLIENT_LIST")?Q_:[]}}),nl.on(q_.CAMERA_DEVICE_CHANGED,e=>{x.info("camera device changed",JSON.stringify(e)),xi.onCameraChanged&&xi.onCameraChanged(e),xi.safeEmit(Xh.CAMERA_CHANGED,e)}),nl.on(q_.RECORDING_DEVICE_CHANGED,e=>{x.info("microphone device changed",JSON.stringify(e)),xi.onMicrophoneChanged&&xi.onMicrophoneChanged(e),xi.safeEmit(Xh.MICROPHONE_CHANGED,e)}),nl.on(q_.PLAYOUT_DEVICE_CHANGED,e=>{x.debug("playout device changed",JSON.stringify(e)),xi.onPlaybackDeviceChanged&&xi.onPlaybackDeviceChanged(e),xi.safeEmit(Xh.PLAYBACK_DEVICE_CHANGED,e)}),Ia.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),rl.onAudioAutoplayFailed&&rl.onAudioAutoplayFailed()},pr.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),rl.onAudioAutoplayFailed&&rl.onAudioAutoplayFailed(),xi.safeEmit(Xh.AUTOPLAY_FAILED)}),pr.on(bs.STATE_CHANGE,(e,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(e)),xi.onAudioContextStateChanged&&xi.onAudioContextStateChanged(e,r),xi.safeEmit(Xh.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),bi.on(Pv.NETWORK_STATE_CHANGE,(e,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=xi),xi})}(DO)),DO.exports}var IWe=CWe();const lC=Mg(IWe),AWe="9442a472625f44e7b2c5065b9f9b3988",PWe=lC.createClient({mode:"rtc",codec:"vp8"});let zT=null;const aae=N.createContext(null),cae=({children:n,appId:t=AWe,channel:i=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:y=()=>{}})=>{const[v,b]=N.useState(!1),[R,I]=N.useState(!1),[k,M]=N.useState([]),[L,j]=N.useState(null),[z,Y]=N.useState(null),[K,ne]=N.useState(null),[ce,oe]=N.useState(!1),[ge,X]=N.useState(!1),[J,te]=N.useState(!1),[ie,he]=N.useState(null),[fe,de]=N.useState(!1),ve=uc(),Te=N.useRef(PWe),Fe=N.useRef({appId:t,channel:i,uid:l,enabled:d}),be=N.useRef(!1),Ce=N.useRef(null);N.useRef(null),N.useEffect(()=>{Fe.current={appId:t,channel:i,uid:l,enabled:d}},[t,i,l,d]),N.useEffect(()=>{Y(i)},[i]),N.useEffect(()=>{if(!Te.current)return;const lt=vt=>{G.log(`Connection state changed to: ${vt}`),vt==="DISCONNECTED"?(b(!1),G.log("Disconnected from Agora")):vt==="CONNECTED"&&(b(!0),j(null))};return Te.current.on("connection-state-change",lt),()=>{Te.current.off("connection-state-change",lt)}},[]),N.useEffect(()=>{if(!i||!d)return;const lt=async(ut,mt)=>{G.log(`User published: ${ut.uid}, mediaType: ${mt}`);try{await Te.current.subscribe(ut,mt),mt==="audio"&&ut.audioTrack.play(),M(at=>at.some(Vt=>Vt.uid===ut.uid)?at:[...at,ut])}catch(at){G.error("Error subscribing to user:",at)}},vt=(ut,mt)=>{G.log(`User unpublished: ${ut.uid}, mediaType: ${mt}`),mt==="audio"&&ut.audioTrack&&ut.audioTrack.stop()},rt=ut=>{G.log(`User joined: ${ut.uid}`),M(mt=>mt.some(at=>at.uid===ut.uid)?mt:[...mt,ut])},bt=ut=>{G.log(`User left: ${ut.uid}`),M(mt=>mt.filter(at=>at.uid!==ut.uid))};return Te.current.on("user-published",lt),Te.current.on("user-unpublished",vt),Te.current.on("user-joined",rt),Te.current.on("user-left",bt),(async()=>{if(be.current){G.log("Already initializing, skipping duplicate initialization");return}be.current=!0;try{if(v&&Ce.current===i){G.log(`Already joined to channel ${i}`),oe(!0),y(Te.current);return}if(Te.current.connectionState==="CONNECTING"||Te.current.connectionState==="CONNECTED")if(Ce.current&&Ce.current!==i){G.log("Connected to different channel, leaving first");try{await Ee()}catch(ut){G.error("Error leaving channel:",ut)}}else{b(!0),oe(!0),Ce.current=i,zT=i,y(Te.current);return}G.log(`Joining channel ${i}`),await De(),G.log("Join channel completed")}catch(ut){G.error("Error during initialization:",ut)}finally{be.current=!1}})(),()=>{G.log("Cleaning up event listeners"),Te.current.off("user-published",lt),Te.current.off("user-unpublished",vt),Te.current.off("user-joined",rt),Te.current.off("user-left",bt)}},[i,d,l,y,v]);const Ae=async()=>{if(!d||K)return K;G.log("Initializing microphone");try{const lt=await lC.createMicrophoneAudioTrack();return await lt.setMuted(f),ne(lt),G.log("Microphone initialized successfully"),lt}catch(lt){return G.error("Error initializing microphone:",lt),j("Failed to initialize microphone. Please check your permissions."),null}};N.useEffect(()=>{(async()=>{if(i)try{const bt=await Ma(i);bt&&bt.voiceDisabled?(G.log("Voice is disabled for this space"),de(!0),v&&await Ee()):de(!1)}catch(rt){G.error("Error checking if voice is disabled:",rt)}})();const vt=rt=>{rt.detail&&typeof rt.detail.voiceDisabled=="boolean"&&(G.log("Voice setting changed:",rt.detail.voiceDisabled),de(rt.detail.voiceDisabled),rt.detail.voiceDisabled&&v?Ee():!rt.detail.voiceDisabled&&!v&&d&&i&&De())};return window.addEventListener("SpaceVoiceSettingChanged",vt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",vt)}},[i,v,d]);const De=async()=>{if(!d)return G.log("Agora is disabled, not joining channel"),!1;if(fe)return G.log("Voice is disabled for this space, not joining channel"),j("Voice chat is disabled for this space"),!1;if(!i)return G.error("AgoraProvider: No channel specified"),j("No channel specified"),!1;if(G.log(`joinChannel called for channel ${i} with UID ${l}`),G.log("Current state:",{isJoined:v,isJoining:ge,connectionState:Te.current.connectionState,joinedChannel:Ce.current}),v&&Ce.current===i)return G.log(`Already joined to channel: ${i}`),!0;if(ge)return G.log("AgoraProvider: Already in the process of joining"),!1;if(Te.current.connectionState==="CONNECTED")if(Ce.current&&Ce.current!==i){G.log("Connected to different channel, leaving first");try{await Ee()}catch(lt){G.error("Error leaving channel:",lt)}}else return G.log("Client already connected, setting joined state to true"),b(!0),oe(!0),Ce.current=i,zT=i,y(Te.current),!0;if(Te.current.connectionState==="CONNECTING")return G.log("Client already connecting, waiting for connection"),X(!0),new Promise(lt=>{const vt=setInterval(()=>{Te.current.connectionState==="CONNECTED"&&(clearInterval(vt),b(!0),X(!1),oe(!0),Ce.current=i,zT=i,y(Te.current),lt(!0))},500);setTimeout(()=>{clearInterval(vt),G.log("AgoraProvider: Connection timeout, considering join failed"),X(!1),lt(!1)},1e4)});try{if(G.log(`Joining channel: ${i} with UID: ${l||"random"}`),G.log(`Using appId: ${t}, Type: ${typeof t}, Length: ${t.length}`),!t||t.trim()===""){const vt="AgoraProvider: App ID is empty or invalid";return G.error(vt),j(vt),X(!1),!1}X(!0);const lt=l||Math.floor(Math.random()*1e6);return await Te.current.join(t,i,a,lt),G.log(`Joined channel successfully with UID: ${Te.current.uid}`),b(!0),X(!1),oe(!0),Ce.current=i,zT=i,y(Te.current),!0}catch(lt){return G.error("Error joining channel:",lt),j(`Error joining channel: ${lt.toString()}`),X(!1),!1}},Ee=async()=>{if(v)try{K&&await Te.current.unpublish(K),await Te.current.leave(),zT=null,Ce.current=null,G.log("Left channel successfully"),b(!1),M([])}catch(lt){G.error("Error leaving channel:",lt),j(lt.message||"Failed to leave channel")}};N.useEffect(()=>()=>{K&&K.close()},[]),N.useEffect(()=>{d&&i&&(!v||Ce.current!==i)&&De()},[d,i,v]);const Ne=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(lt){return G.error("Error checking microphone status:",lt),!1}};N.useEffect(()=>{const lt=()=>{const rt=Ne();rt!==R&&(G.log("Syncing microphone state:",{actualStatus:rt,currentState:R}),I(rt),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:rt}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=rt,window.agoraClient.microphoneTrack=K))};K&&lt();const vt=setInterval(lt,1e3);return()=>{clearInterval(vt)}},[K,R]);const je=async()=>{var lt;if(fe)return G.log("Voice is disabled for this space, cannot toggle"),ve({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const vt=R!==void 0?R:K?!K.muted:!1;if(G.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:R,currentState:vt,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(G.log("AgoraProvider: No microphone track, initializing..."),!await Ae()))return G.error("AgoraProvider: Failed to initialize microphone"),vt;const rt=!vt;if(G.log("AgoraProvider: New voice state will be:",rt),vt){if(K)try{G.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(G.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),G.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(bt){return G.error("Error muting track:",bt),vt}}else if(K)try{Te.current&&v&&!((lt=Te.current.localTracks)!=null&&lt.includes(K))&&(G.log("AgoraProvider: Publishing microphone track"),await Te.current.publish(K),G.log("AgoraProvider: Microphone track published successfully")),G.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(G.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),G.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(bt){return G.error("Error unmuting track:",bt),vt}return I(rt),rt}catch(vt){return G.error("Error toggling voice:",vt),R}},Ke=async lt=>{try{ne(lt),G.log("Microphone track updated successfully")}catch(vt){throw G.error("Error updating microphone track:",vt),vt}},ot=async()=>{if(!Te.current||!i)return G.error("AgoraProvider: Voice chat not connected"),!1;try{if(J)return G.log("AgoraProvider: Stopping screen share"),ie&&(Array.isArray(ie)?(await Te.current.unpublish(ie),ie.forEach(lt=>lt.close())):(await Te.current.unpublish(ie),ie.close()),he(null)),te(!1),G.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;G.log("AgoraProvider: Starting screen share");try{const lt=await lC.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return G.log("AgoraProvider: Screen track created:",lt),lt.on("track-ended",()=>{G.log("AgoraProvider: Screen sharing ended by browser UI"),Te.current.unpublish(lt),lt.close(),he(null),te(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await Te.current.publish(lt),he(lt),te(!0),G.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=lt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(lt){return G.error("AgoraProvider: Error creating screen track:",lt),te(!1),he(null),!1}}catch(lt){return G.error("AgoraProvider: Error toggling screen share:",lt),te(!1),he(null),!1}};N.useEffect(()=>{if(G.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Te.current,isScreenSharing:!1,screenTrack:null};const lt=rt=>{G.log("AgoraProvider: Received ToggleScreenShare event"),ot().then(bt=>{rt.detail&&rt.detail.callback&&rt.detail.callback(!0,bt)}).catch(bt=>{G.error("AgoraProvider: Error handling ToggleScreenShare event:",bt),rt.detail&&rt.detail.callback&&rt.detail.callback(!1,J)})},vt=rt=>{G.log("AgoraProvider: Received JoinVoiceChat event"),De().then(bt=>{rt.detail&&rt.detail.callback&&rt.detail.callback(bt)}).catch(bt=>{G.error("AgoraProvider: Error handling JoinVoiceChat event:",bt),rt.detail&&rt.detail.callback&&rt.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",lt),window.addEventListener("JoinVoiceChat",vt),()=>{window.removeEventListener("ToggleScreenShare",lt),window.removeEventListener("JoinVoiceChat",vt),typeof window<"u"&&window.agoraClient&&(G.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(G.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),N.useEffect(()=>{G.log("AgoraProvider: Voice enabled state changed:",R),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=R,window.agoraClient.microphoneTrack=K,window.agoraClient.client=Te.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:R}})),G.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:R}))},[R,K]);const _t={client:Te.current,isJoined:v,isVoiceEnabled:R,users:k,error:L,channel:z,appId:t,toggleVoice:je,leaveChannel:Ee,joinChannel:De,microphoneTrack:K,isReady:ce,createMicrophoneTrack:Ke,isScreenSharing:J,screenTrack:ie,toggleScreenShare:ot,voiceDisabled:fe};return w.jsx(aae.Provider,{value:_t,children:n})},lae=()=>{const n=N.useContext(aae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};cae.propTypes={children:Pn.node.isRequired,appId:Pn.string.isRequired,channel:Pn.string.isRequired,token:Pn.string,uid:Pn.oneOfType([Pn.string,Pn.number])};const OWe=()=>{var be,Ce;const{client:n,isVoiceEnabled:t,isJoined:i,users:a,error:l,microphoneTrack:d,isReady:f,channel:y,appId:v,toggleVoice:b,joinChannel:R,leaveChannel:I,createMicrophoneTrack:k,isScreenSharing:M,screenTrack:L,toggleScreenShare:j,voiceDisabled:z}=lae(),[Y,K]=N.useState(t!==void 0?t:((be=window.agoraClient)==null?void 0:be.isVoiceEnabled)||!1),[ne,ce]=N.useState(M!==void 0?M:((Ce=window.agoraClient)==null?void 0:Ce.isScreenSharing)||!1),[oe,ge]=N.useState(z!==void 0?z:!1),[X,J]=N.useState(!0);N.useEffect(()=>{var Ae;t!==void 0?K(t):((Ae=window.agoraClient)==null?void 0:Ae.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):d&&K(!d.muted)},[t,d]),N.useEffect(()=>{var Ae;M!==void 0?ce(M):((Ae=window.agoraClient)==null?void 0:Ae.isScreenSharing)!==void 0&&ce(window.agoraClient.isScreenSharing)},[M]),N.useEffect(()=>{z!==void 0&&ge(z)},[z]);const te=N.useRef({isVoiceEnabled:Y,isScreenSharing:ne,isJoined:i,users:a,error:l,isReady:f,channel:y,appId:v,voiceDisabled:oe});N.useEffect(()=>{te.current={isVoiceEnabled:Y,isScreenSharing:ne,isJoined:i,users:a,error:l,isReady:f,channel:y,appId:v,voiceDisabled:oe}},[Y,ne,i,a,l,f,y,v,oe]),N.useEffect(()=>{const Ae=setTimeout(()=>{J(!1)},5e3);return()=>clearTimeout(Ae)},[]),N.useEffect(()=>{f&&J(!1)},[f]),N.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:Y,contextIsScreenSharing:M,localScreenSharing:ne,isJoined:i,users:a.length,error:l,isReady:f,channel:y,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!L})},[t,Y,M,ne,i,a,l,f,y,v,d,L]);const ie=async()=>{try{console.log("useVoiceChat: Toggling voice from:",Y);const Ae=await b();if(console.log("useVoiceChat: Toggle result:",Ae),Ae!==void 0)K(Ae);else{const De=!Y;K(De),window.agoraClient&&(window.agoraClient.isVoiceEnabled=De)}return Ae!==void 0?Ae:!Y}catch(Ae){return console.error("useVoiceChat: Error toggling voice:",Ae),Y}},he=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ne);const Ae=await j();if(console.log("useVoiceChat: Screen share toggle result:",Ae),Ae!==void 0)ce(Ae);else{const De=!ne;ce(De),window.agoraClient&&(window.agoraClient.isScreenSharing=De)}return Ae!==void 0?Ae:!ne}catch(Ae){return console.error("useVoiceChat: Error toggling screen share:",Ae),ne}},fe=async()=>{Y&&d&&await ie()},de=async()=>{!Y&&d&&await ie()},ve=Ae=>a.some(De=>{var Ee;return De.uid===Ae&&((Ee=De.audioTrack)==null?void 0:Ee.isPlaying)}),Te=N.useCallback(()=>{if(!d||!Y)return 0;try{return d.getVolumeLevel()}catch(Ae){return console.error("Error getting volume level:",Ae),0}},[d,Y]);return{isVoiceEnabled:Y,isScreenSharing:ne,isJoined:i,users:a,error:l,toggleVoice:ie,toggleScreenShare:he,mute:fe,unmute:de,isUserSpeaking:ve,getVolumeLevel:Te,microphoneTrack:d,screenTrack:L,isLoading:X,channel:y,appId:v,joinChannel:R,leaveChannel:I,client:n,setMicrophoneDevice:async Ae=>{try{if(!Ae){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}d&&(Y&&await n.unpublish(d),await d.close());const De=await lC.createMicrophoneAudioTrack({microphoneId:Ae,encoderConfig:"music_standard"});k&&await k(De),Y&&await n.publish(De),console.log("Microphone device changed successfully")}catch(De){throw console.error("Error changing microphone device:",De),De}},voiceDisabled:oe}},kWe=({size:n="md",tooltipPlacement:t="top",defaultMuted:i=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:y,joinChannel:v,channel:b,client:R,voiceDisabled:I}=OWe(),[k,M]=N.useState(!1),[L,j]=N.useState(!1);N.useEffect(()=>{const K=()=>{G.log("VoiceButton: Player instantiated, showing button"),j(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(G.log("VoiceButton: Player was already instantiated"),j(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),N.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:y,channel:b,hasClient:!!R,clientState:R==null?void 0:R.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:L,voiceDisabled:I})},[d,y,b,R,L,I]);const z=async()=>{if(!(k||I)){M(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:y});try{if(!y&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(ne){ne.message&&ne.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ne)}console.log("VoiceButton: Toggling voice state from:",d);const K=await f();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{M(!1)}}},Y=()=>I?"Voice chat is disabled for this space":L?k?"Processing...":y?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!L||I?null:w.jsx(Nf,{label:Y(),placement:t,hasArrow:!0,children:w.jsxs(ht,{position:"relative",cursor:"pointer",onClick:z,children:[w.jsx(ih,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?w.jsx(rae,{color:"white"}):w.jsx(nae,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),k&&w.jsx(ht,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:w.jsx(uh,{size:"sm",color:"white"})})]})})},NWe=Ei.createContext({user:null}),DWe=({userNickname:n})=>{const{client:t,channel:i,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=lae(),[f,y]=N.useState([]),[v,b]=N.useState(!1),[R,I]=N.useState(!0);N.useRef({});const k=N.useRef(null);N.useRef(null);const{user:M}=N.useContext(NWe)||{user:null},[L,j]=N.useState({}),z=N.useRef(a),[Y,K]=N.useState(null),{isOpen:ne,onOpen:ce,onClose:oe}=sh(),[ge,X]=N.useState(!1),J=N.useRef(null),te=N.useRef(null);N.useEffect(()=>{z.current=a},[a]),N.useEffect(()=>{if(!t||!i){b(!1);return}const ve=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",i);const Te=t.connectionState;if(console.log("Current connection state:",Te),Te==="CONNECTED")b(!0),I(!1);else{b(!1);const Fe=be=>{console.log("Connection state changed:",be),be==="CONNECTED"?(b(!0),I(!1)):b(!1)};return t.on("connection-state-change",Fe),()=>{t.off("connection-state-change",Fe),clearTimeout(ve)}}return()=>{clearTimeout(ve)}},[t,i]),N.useEffect(()=>{const ve=async()=>{const Te={...L};let Fe=!1;for(const be of f){if(L[be.uid])continue;let Ce=null,Ae=be.uid;if(typeof Ae=="string"&&(Ae.includes("-")?(Ce=Ae.split("-")[0],Ae=Ae.split("-")[1]):Ae.includes("_")&&(Ce=Ae.split("_")[0],Ae=Ae.split("_")[1])),Ae)try{console.log("Trying to fetch nickname for user ID:",Ae);const De=await ru(Ae);De&&De.Nickname?(console.log("Found nickname in Firebase for user ID:",Ae,"Nickname:",De.Nickname),Te[be.uid]=De.Nickname,Fe=!0):Ce?(console.log("Using extracted name for user ID:",Ae,"Name:",Ce),Te[be.uid]=Ce,Fe=!0):(Te[be.uid]="User",Fe=!0)}catch(De){console.error("Error fetching user profile:",De),Ce?(Te[be.uid]=Ce,Fe=!0):(Te[be.uid]="User",Fe=!0)}else Ce?(Te[be.uid]=Ce,Fe=!0):(Te[be.uid]="User",Fe=!0)}Fe&&j(Te)};f.length>0&&ve()},[f,L]),N.useEffect(()=>{if(!t||!i||!v)return;console.log("Setting up screen share event handlers");const ve=async(be,Ce)=>{if(console.log("User published:",be.uid,Ce,be),Ce==="video"){console.log("Remote video track detected:",be.uid);try{await t.subscribe(be,Ce),console.log("Subscribed to remote video track:",be.uid),y(Ae=>Ae.some(De=>De.uid===be.uid)?Ae:[...Ae,be])}catch(Ae){console.error("Error subscribing to remote video track:",Ae)}}},Te=(be,Ce)=>{if(console.log("User unpublished:",be.uid,Ce),Ce==="video"){if(console.log("Remote video track unpublished:",be.uid),be.videoTrack)try{be.videoTrack.stop()}catch(Ae){console.error("Error stopping video track:",Ae)}if(y(Ae=>Ae.filter(De=>De.uid!==be.uid)),l&&z.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),z.current.play(k.current)}catch(Ae){console.error("Error replaying local screen track:",Ae)}}},Fe=be=>{console.log("User left:",be.uid);const Ce=f.find(Ae=>Ae.uid===be.uid);if(Ce&&Ce.videoTrack)try{Ce.videoTrack.stop()}catch(Ae){console.error("Error stopping video track:",Ae)}if(y(Ae=>Ae.filter(De=>De.uid!==be.uid)),l&&z.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user left"),z.current.play(k.current)}catch(Ae){console.error("Error replaying local screen track:",Ae)}};return t.on("user-published",ve),t.on("user-unpublished",Te),t.on("user-left",Fe),()=>{t.off("user-published",ve),t.off("user-unpublished",Te),t.off("user-left",Fe)}},[t,i,v,f,l]),N.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(ve=>{if(ve.videoTrack)try{console.log("Playing video track for:",ve.uid),ve.videoTrack.play(`video-container-${ve.uid}`)}catch(Te){console.error("Error playing video track:",Te)}}),l&&z.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),z.current.play(k.current)}catch(ve){console.error("Error replaying local screen track:",ve)}},[f,l]),N.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&k.current)try{console.log("Playing local screen track"),a.play(k.current)}catch(ve){console.error("Error playing local screen track:",ve)}},[l,a]),N.useEffect(()=>()=>{if(f.forEach(ve=>{if(ve.videoTrack)try{ve.videoTrack.stop()}catch(Te){console.error("Error stopping video track on unmount:",Te)}}),a)try{a.stop()}catch(ve){console.error("Error stopping local screen track on unmount:",ve)}},[f,a]);const ie=()=>{console.log("Stopping local screen share"),d()},he=ve=>(console.log("Getting display name for UID:",ve,"type:",typeof ve),l&&M&&(ve===M.uid||ve===(t==null?void 0:t.uid))?n||"You":L[ve]?L[ve]:typeof ve=="string"?ve.includes("-")?ve.split("-")[0]:ve.includes("_")?ve.split("_")[0]:ve:"User"),fe=ve=>{console.log("Opening modal for remote screen",ve),K(ve),ce()},de=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),ce()};return N.useEffect(()=>{ne&&Y?(console.log("Modal opened, activeScreen:",Y),setTimeout(()=>{if(Y.isLocal&&z.current)try{console.log("Playing local screen in modal"),z.current.play("modal-screen-container"),X(!0)}catch(ve){console.error("Error playing local screen in modal:",ve)}else if(Y.videoTrack)try{console.log("Playing remote screen in modal"),Y.videoTrack.play("modal-screen-container"),X(!0)}catch(ve){console.error("Error playing remote screen in modal:",ve)}},500)):ne||(X(!1),K(null),setTimeout(()=>{if(l&&z.current)try{z.current.play("local-screen-container")}catch(ve){console.error("Error playing local screen in small container:",ve)}f.forEach(ve=>{if(ve.videoTrack)try{ve.videoTrack.play(`video-container-${ve.uid}`)}catch(Te){console.error(`Error playing remote screen ${ve.uid} in small container:`,Te)}})},500))},[ne,Y,l,f]),!v||R&&f.length===0&&!l||f.length===0&&!l?null:w.jsxs(w.Fragment,{children:[!ne&&w.jsxs(ht,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:J,children:[l&&a&&w.jsxs(ht,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:de,children:[w.jsx(ht,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),w.jsx(ht,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(ve=>{const Te=L[ve.uid]||he(ve.uid);return w.jsxs(ht,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>fe(ve),children:[w.jsx(ht,{id:`video-container-${ve.uid}`,width:"100%",height:"100%",position:"relative"}),w.jsx(ht,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${Te}'s Screen`})]},ve.uid)})]}),ne&&w.jsx(ht,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:oe,children:w.jsxs(ht,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:ve=>ve.stopPropagation(),children:[!ge&&w.jsxs(ht,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[w.jsx(uh,{size:"xl"}),w.jsx(it,{mt:4,children:"Loading screen share..."})]}),w.jsx(ht,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:te}),w.jsx(ht,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:oe,children:""}),w.jsx(ht,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:Y!=null&&Y.isLocal?n?`${n}'s Screen`:"Your Screen":`${L[Y==null?void 0:Y.uid]||he(Y==null?void 0:Y.uid)}'s Screen`}),(Y==null?void 0:Y.isLocal)&&w.jsx(ht,{position:"absolute",bottom:4,right:4,children:w.jsx($n,{colorScheme:"red",size:"sm",onClick:ie,children:"Stop Sharing"})})]})})]})},xWe=({onClose:n})=>{const t=uc(),[i,a]=N.useState(!1),[l,d]=N.useState(!1);N.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),R=()=>{v()};return window.addEventListener("ScreenShareToggled",R),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",R)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)y();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:R=>{if(!R){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}y()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,R)=>{a(!1),b?(d(R),t(R?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return w.jsx(it,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function LWe({open:n,onClose:t}){const[i,a]=N.useState(0);return w.jsxs(Rs,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[w.jsx(As,{backdropFilter:"blur(4px)"}),w.jsxs(Cs,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[w.jsx(To,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),w.jsx(zs,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),w.jsx(Is,{p:0,display:"flex",children:w.jsxs(y0,{orientation:"vertical",variant:"unstyled",index:i,onChange:a,display:"flex",flexGrow:1,children:[w.jsxs(E0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:uWe,mb:1}),w.jsx(it,{fontSize:"xs",children:"Movement"})]}),w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:dWe,mb:1}),w.jsx(it,{fontSize:"xs",children:"Camera"})]}),w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:cWe,mb:1}),w.jsx(it,{fontSize:"xs",children:"Actions"})]}),w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:lWe,mb:1}),w.jsx(it,{fontSize:"xs",children:"Tips"})]})]}),w.jsxs(ZR,{flexGrow:1,display:"flex",flexDirection:"column",children:[w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),w.jsxs(Bi,{wrap:"wrap",gap:3,children:[w.jsx(Yl,{keyLabel:"W",description:"Move Forward"}),w.jsx(Yl,{keyLabel:"A",description:"Move Left"}),w.jsx(Yl,{keyLabel:"S",description:"Move Backward"}),w.jsx(Yl,{keyLabel:"D",description:"Move Right"}),w.jsx(Yl,{keyLabel:"Shift",description:"Run"}),w.jsx(Yl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),w.jsxs(Bi,{wrap:"wrap",gap:3,children:[w.jsx(Yl,{keyLabel:"Mouse",description:"Look Around"}),w.jsx(Yl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),w.jsx(Yl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),w.jsxs(Bi,{wrap:"wrap",gap:3,children:[w.jsx(Yl,{keyLabel:"E",description:"Interact"}),w.jsx(Yl,{keyLabel:"F",description:"Emote Menu"}),w.jsx(Yl,{keyLabel:"T",description:"Chat"}),w.jsx(Yl,{keyLabel:"M",description:"Mute Mic"})]})]}),w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),w.jsxs(qr,{align:"stretch",spacing:2,children:[w.jsx(it,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),w.jsx(it,{fontSize:"xs",children:" Press ESC to access settings"}),w.jsx(it,{fontSize:"xs",children:" Click on players to view their profile"}),w.jsx(it,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Yl=({keyLabel:n,description:t})=>w.jsx(ht,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:w.jsxs(jn,{spacing:2,children:[w.jsx(ht,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),w.jsx(it,{fontSize:"xs",children:t})]})}),MWe=({isOpen:n,onClose:t,containerRef:i})=>{const[a,l]=N.useState([]),[d,f]=N.useState(""),[y,v]=N.useState(0),[b,R]=N.useState(100),[I,k]=N.useState(100),[M,L]=N.useState(!0),[j,z]=N.useState(!0),[Y,K]=N.useState(!1),[ne,ce]=N.useState(null),[oe,ge]=N.useState(null),[X,J]=N.useState(null);N.useEffect(()=>{if(!n)return;(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ve=await lC.getMicrophones();l(ve),ve.length>0&&f(ve[0].deviceId)}catch(ve){console.error("Error getting audio devices:",ve)}})()},[n]),N.useEffect(()=>{if(!n||!Y){v(0);return}let de;return(async()=>{try{const Te=await navigator.mediaDevices.getUserMedia({audio:{deviceId:d?{exact:d}:void 0}});J(Te);const Fe=new(window.AudioContext||window.webkitAudioContext),be=Fe.createAnalyser(),Ce=Fe.createMediaStreamSource(Te);be.fftSize=256,be.smoothingTimeConstant=.8,Ce.connect(be),ce(Fe),ge(be);const Ae=new Uint8Array(be.frequencyBinCount),De=()=>{be.getByteFrequencyData(Ae);const Ee=Math.sqrt(Ae.reduce((Ke,ot)=>Ke+ot*ot,0)/Ae.length),je=Math.min(Ee*3,255)/255*100*(b/100);v(Math.min(je,100)),Y&&n&&(de=requestAnimationFrame(De))};De()}catch(Te){console.error("Error setting up audio analysis:",Te),v(0)}})(),()=>{de&&cancelAnimationFrame(de),X&&(X.getTracks().forEach(Te=>Te.stop()),J(null)),ne&&(ne.close(),ce(null)),ge(null),v(0)}},[Y,n,d,b]);const te=de=>{const ve=de.target.value;f(ve),console.log("Microphone changed to:",ve)},ie=de=>{R(de),console.log("Microphone volume set to:",de)},he=de=>{k(de),console.log("Speaker volume set to:",de)},fe=()=>{K(!Y)};return w.jsx(El,{containerRef:i,children:w.jsxs(Rs,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),w.jsxs(Cs,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"500px",children:[w.jsx(To,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Voice Chat Settings"}),w.jsx(zs,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),w.jsx(Is,{px:4,py:3,children:w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsxs(Kr,{children:[w.jsxs(ss,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone",w.jsx(Qd,{ml:2,bg:Y?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)",color:Y?"#22c55e":"#ef4444",fontSize:"xs",px:2,py:1,borderRadius:"full",children:Y?"Enabled":"Muted"})]}),w.jsxs(gre,{value:d,onChange:te,bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",children:[a.map(de=>w.jsx("option",{value:de.deviceId,style:{backgroundColor:"#1a1a1a",color:"white"},children:de.label||`Microphone ${de.deviceId.slice(0,5)}...`},de.deviceId)),a.length===0&&w.jsx("option",{value:"",style:{backgroundColor:"#1a1a1a",color:"white"},children:"No microphones found"})]})]}),w.jsxs(ht,{children:[w.jsx(it,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:"Microphone Level"}),w.jsx(Uy,{value:y,colorScheme:"green",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)",hasStripe:y>20,isAnimated:y>20,sx:{"& > div":{backgroundColor:"#22c55e !important"}}})]}),w.jsxs(Kr,{children:[w.jsxs(ss,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone Volume: ",b,"%"]}),w.jsxs(YS,{value:b,onChange:ie,min:0,max:100,step:1,colorScheme:"gray",children:[w.jsx(JS,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:w.jsx(QS,{})}),w.jsx(XS,{boxSize:4})]})]}),w.jsxs(Kr,{children:[w.jsxs(ss,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Speaker Volume: ",I,"%"]}),w.jsxs(YS,{value:I,onChange:he,min:0,max:100,step:1,colorScheme:"gray",children:[w.jsx(JS,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:w.jsx(QS,{})}),w.jsx(XS,{boxSize:4})]})]}),w.jsxs(Kr,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[w.jsx(ss,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Microphone Enabled"}),w.jsx(eh,{isChecked:Y,onChange:fe,colorScheme:"gray",size:"md"})]}),w.jsxs(Kr,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[w.jsx(ss,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Echo Cancellation"}),w.jsx(eh,{isChecked:M,onChange:()=>L(!M),colorScheme:"gray",size:"md"})]}),w.jsxs(Kr,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[w.jsx(ss,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Noise Suppression"}),w.jsx(eh,{isChecked:j,onChange:()=>z(!j),colorScheme:"gray",size:"md"})]}),w.jsx(ht,{mt:2,p:3,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:w.jsx(it,{fontSize:"xs",color:"gray.400",children:"Note: These settings will be applied when you join a voice chat."})})]})})]})]})})};function UWe({open:n,onClose:t,containerRef:i}){const[a,l]=N.useState(!1),[d,f]=N.useState(100),[y,v]=N.useState(100),[b,R]=N.useState(100),I=dc(),k=()=>{l(!0)},M=()=>{l(!1)},L=Y=>{f(Y),I("SetMasterVolume",{volume:Y/100})},j=Y=>{v(Y),I("SetMusicVolume",{volume:Y/100})},z=Y=>{R(Y),I("SetSFXVolume",{volume:Y/100})};return n?w.jsxs(w.Fragment,{children:[w.jsx(El,{containerRef:i,children:w.jsx(ht,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",backdropFilter:"blur(2px)",bg:"rgba(0, 0, 0, 0.3)",zIndex:"999",opacity:n?1:0,visibility:n?"visible":"hidden",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out",pointerEvents:n?"auto":"none",onClick:t})}),w.jsx(El,{containerRef:i,children:w.jsxs(ht,{position:"absolute",top:"0",right:"0",bottom:"0",width:"35%",minWidth:"600px",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",borderLeft:"1px solid rgba(255, 255, 255, 0.1)",zIndex:"1000",color:"white",overflowY:"auto",transform:n?"translateX(0)":"translateX(100%)",transition:"transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)",maxHeight:"100vh",children:[w.jsx(ht,{p:4,borderBottom:"1px solid rgba(255, 255, 255, 0.1)",position:"sticky",top:"0",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",zIndex:"1001",children:w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsx(it,{fontSize:"xl",fontWeight:"bold",children:"Settings"}),w.jsx($n,{variant:"ghost",size:"xs",onClick:t,color:"white",_hover:{bg:"whiteAlpha.200"},"aria-label":"Close settings",minW:"auto",h:"auto",p:1,children:""})]})}),w.jsx(ht,{p:4,children:w.jsxs(y0,{variant:"unstyled",colorScheme:"blue",children:[w.jsxs(E0,{mb:4,bg:"rgba(255, 255, 255, 0.1)",borderRadius:"md",p:.5,children:[w.jsx(Na,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Audio & Video"}),w.jsx(Na,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Graphics"})]}),w.jsxs(ZR,{children:[w.jsx(Pc,{p:0,children:w.jsxs(qr,{spacing:6,align:"stretch",children:[w.jsxs(ht,{children:[w.jsx(it,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Audio"}),w.jsxs(qr,{spacing:3,align:"stretch",children:[w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsx(it,{fontSize:"sm",color:"white",minW:"120px",children:"Master Volume"}),w.jsxs(jn,{spacing:3,flex:"1",justify:"flex-end",children:[w.jsxs(it,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[d,"%"]}),w.jsx(ht,{width:"180px",children:w.jsxs(YS,{value:d,onChange:L,min:0,max:100,step:1,colorScheme:"blue",size:"sm",children:[w.jsx(JS,{bg:"whiteAlpha.300",h:"4px",children:w.jsx(QS,{})}),w.jsx(XS,{boxSize:4})]})})]})]}),w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsx(it,{fontSize:"sm",color:"white",minW:"120px",children:"Music Volume"}),w.jsxs(jn,{spacing:3,flex:"1",justify:"flex-end",children:[w.jsxs(it,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[y,"%"]}),w.jsx(ht,{width:"180px",children:w.jsxs(YS,{value:y,onChange:j,min:0,max:100,step:1,colorScheme:"green",size:"sm",children:[w.jsx(JS,{bg:"whiteAlpha.300",h:"4px",children:w.jsx(QS,{})}),w.jsx(XS,{boxSize:4})]})})]})]}),w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsx(it,{fontSize:"sm",color:"white",minW:"120px",children:"Sound Effects Volume"}),w.jsxs(jn,{spacing:3,flex:"1",justify:"flex-end",children:[w.jsxs(it,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[b,"%"]}),w.jsx(ht,{width:"180px",children:w.jsxs(YS,{value:b,onChange:z,min:0,max:100,step:1,colorScheme:"orange",size:"sm",children:[w.jsx(JS,{bg:"whiteAlpha.300",h:"4px",children:w.jsx(QS,{})}),w.jsx(XS,{boxSize:4})]})})]})]})]})]}),w.jsxs(ht,{children:[w.jsx(it,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Voice Chat"}),w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsx(it,{fontSize:"sm",color:"white",children:"Microphone"}),w.jsx($n,{onClick:k,variant:"outline",size:"sm",colorScheme:"gray",borderColor:"whiteAlpha.400",color:"white",_hover:{bg:"whiteAlpha.200"},rightIcon:w.jsx(ht,{as:"span",children:""}),px:4})]})]})]})}),w.jsx(Pc,{p:0,children:w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsx(it,{fontSize:"md",fontWeight:"semibold",children:"Graphics Settings"}),w.jsx(ht,{p:4,bg:"whiteAlpha.100",borderRadius:"md",border:"1px solid",borderColor:"whiteAlpha.200",children:w.jsx(it,{color:"whiteAlpha.700",fontSize:"sm",children:"Graphics settings will be available here."})})]})})]})]})})]})}),a&&w.jsx(MWe,{isOpen:a,onClose:M,containerRef:i})]}):null}function VWe(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function FWe(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function xQ(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function Cy(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function jWe(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function BWe(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function zWe(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function WWe(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function i0(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function xO(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function LQ(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function MQ(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function UQ(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function DR(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function GWe(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const HWe=async()=>{try{G.log("tagsFirestore: Fetching all tags");const n=nu(ir,"tags"),t=await Zu(n),i=[];return t.forEach(a=>{i.push({id:a.id,...a.data()})}),i}catch(n){throw G.error("tagsFirestore: Error fetching tags:",n),n}},$We=async n=>{try{G.log(`tagsFirestore: Fetching tag with ID: ${n}`);const t=Ir(ir,"tags",n),i=await Ho(t);return i.exists()?{id:i.id,...i.data()}:(G.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(t){throw G.error(`tagsFirestore: Error fetching tag with ID ${n}:`,t),t}},KWe=async({id:n,name:t,color:i,description:a})=>{try{G.log(`tagsFirestore: Creating new tag: ${t}`);const l={name:t,color:i||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const f=Ir(ir,"tags",n);await Lg(f,l),d=n}else{const f=nu(ir,"tags");d=(await RBe(f,l)).id}return{id:d,...l}}catch(l){throw G.error("tagsFirestore: Error creating tag:",l),l}},qWe=async(n,t)=>{try{G.log(`tagsFirestore: Adding tag ${t} to space ${n}`);const i=Ir(ir,"tags",t);if(!(await Ho(i)).exists())throw new Error(`Tag with ID ${t} does not exist`);const l=Ir(ir,"spaces",n);return await $o(l,{tags:IBe(t)}),!0}catch(i){throw G.error(`tagsFirestore: Error adding tag ${t} to space ${n}:`,i),i}},YWe=async(n,t)=>{try{G.log(`tagsFirestore: Removing tag ${t} from space ${n}`);const i=Ir(ir,"spaces",n);return await $o(i,{tags:ooe(t)}),!0}catch(i){throw G.error(`tagsFirestore: Error removing tag ${t} from space ${n}:`,i),i}},XWe=async n=>{try{G.log(`tagsFirestore: Getting tags for space ${n}`);const t=Ir(ir,"spaces",n),i=await Ho(t);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const d=[];for(const f of l){const y=await $We(f);y&&d.push(y)}return d}catch(t){throw G.error(`tagsFirestore: Error getting tags for space ${n}:`,t),t}},JWe=async()=>{G.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let t=0,i=0;for(const a of n){G.log(`tagsFirestore: Processing tag: ${a.name}`);const l=Ir(ir,"tags",a.id);(await Ho(l)).exists()?(G.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),i++):(await KWe(a),t++,G.log(`tagsFirestore: Created tag: ${a.name}`))}return G.log(`tagsFirestore: Tags initialization complete. Created: ${t}, Skipped: ${i}`),{created:t,skipped:i}}catch(t){throw G.error("tagsFirestore: Error initializing default tags:",t),t}},uae=({spaceID:n})=>{const[t,i]=N.useState([]),[a,l]=N.useState([]),[d,f]=N.useState(!0),[y,v]=N.useState(!1),[b,R]=N.useState(!1),[I,k]=N.useState(null),{isOpen:M,onOpen:L,onClose:j}=sh(),z=uc(),{user:Y}=N.useContext(Hs),K=(Y==null?void 0:Y.groups)&&(Y.groups.includes("disruptiveAdmin")||Y.groups.includes("admin"));N.useEffect(()=>{ne()},[n]);const ne=async()=>{f(!0);try{let te=[];try{te=await HWe(),i(te)}catch(ie){G.error("SpaceTagsManager: Error loading available tags:",ie),i([]),z({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ie=await XWe(n);l(ie)}catch(ie){G.error("SpaceTagsManager: Error loading space tags:",ie),l([]),z({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(te){G.error("SpaceTagsManager: Error in loadTags:",te),z({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},ce=async()=>{R(!0),k(null);try{const te=await JWe();console.log("Tag initialization result:",te),k(te),z({title:"Tags initialized",description:`Successfully created ${te.created} tags. Skipped ${te.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ne()}catch(te){G.error("SpaceTagsManager: Error initializing tags:",te),k(!1),z({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{R(!1)}},oe=async te=>{if(!(!n||!te)){v(!0);try{await qWe(n,te);const ie=t.find(he=>he.id===te);ie&&l(he=>[...he,ie]),z({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ie){G.error(`SpaceTagsManager: Error adding tag ${te} to space:`,ie),z({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},ge=async te=>{if(!(!n||!te)){v(!0);try{await YWe(n,te),l(ie=>ie.filter(he=>he.id!==te)),z({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ie){G.error(`SpaceTagsManager: Error removing tag ${te} from space:`,ie),z({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},X=()=>{const te=a.map(ie=>ie.id);return t.filter(ie=>!te.includes(ie.id))},J=X().length===0;return w.jsxs(ht,{children:[w.jsx(Bi,{mb:3,justifyContent:"space-between",alignItems:"center",children:w.jsxs(jn,{spacing:2,ml:"auto",children:[K&&w.jsx($n,{size:"xs",leftIcon:w.jsx(gze,{}),onClick:L,variant:"outline",colorScheme:"purple",children:"Admin"}),w.jsxs(Hk,{children:[w.jsx($k,{as:$n,size:"xs",leftIcon:w.jsx(mze,{}),rightIcon:w.jsx(yze,{}),isDisabled:d||y||J,children:J?"No Available Tags":"Add Tag"}),w.jsx(Kk,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:X().length>0?X().map(te=>w.jsx(QR,{onClick:()=>oe(te.id),icon:w.jsx(ht,{width:"12px",height:"12px",borderRadius:"full",bg:te.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:te.name},te.id)):w.jsx(QR,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?w.jsx(Bi,{justify:"center",py:4,children:w.jsx(uh,{size:"sm",color:"blue.300"})}):t.length===0?w.jsx(ht,{children:w.jsxs(it,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",K?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?w.jsx(it,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):w.jsx(Ire,{spacing:2,children:a.map(te=>w.jsx(n5,{children:w.jsxs(bre,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${te.color||"#888"}`,children:[w.jsx(ht,{width:"8px",height:"8px",borderRadius:"full",bg:te.color||"#888",mr:1}),w.jsx(wre,{children:te.name}),w.jsx(Rre,{onClick:()=>ge(te.id),isDisabled:y})]})},te.id))}),w.jsxs(Rs,{isOpen:M,onClose:j,size:"md",children:[w.jsx(As,{backdropFilter:"blur(4px)"}),w.jsxs(Cs,{bg:"gray.800",color:"white",children:[w.jsx(To,{fontSize:"md",children:"Tag System Administration"}),w.jsx(zs,{}),w.jsxs(Is,{children:[w.jsx(it,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&w.jsxs(Eg,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[w.jsx(vg,{}),w.jsxs(it,{fontSize:"sm",children:["Tags initialized. Created: ",w.jsx("b",{children:I.created}),", Skipped: ",w.jsx("b",{children:I.skipped})]})]}),w.jsx($n,{colorScheme:"blue",onClick:ce,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),w.jsx(oh,{children:w.jsx($n,{variant:"ghost",size:"sm",onClick:j,children:"Close"})})]})]})]})};uae.propTypes={spaceID:Pn.string.isRequired};const QWe=({isOpen:n,onClose:t})=>{const{spaceID:i}=Ro(),[a,l]=N.useState(0),[d,f]=N.useState(""),[y,v]=N.useState(""),[b,R]=N.useState(!1),[I,k]=N.useState(null),[M,L]=N.useState(null),[j,z]=N.useState(!1),[Y,K]=N.useState(0),[ne,ce]=N.useState(null),oe=N.useRef(null),[ge,X]=N.useState(null),[J,te]=N.useState(null),[ie,he]=N.useState(!1),[fe,de]=N.useState(0),[ve,Te]=N.useState(null),Fe=N.useRef(null),[be,Ce]=N.useState(null),[Ae,De]=N.useState(null),[Ee,Ne]=N.useState(!1),[je,Ke]=N.useState(0),[ot,_t]=N.useState(null),lt=N.useRef(null),[vt,rt]=N.useState([]),[bt,$t]=N.useState([]),[ut,mt]=N.useState(!1),[at,Vt]=N.useState([]),[rn,Ht]=N.useState(null),[we,xe]=N.useState(!1),[$e,Pt]=N.useState(!0),[It,wt]=N.useState(!1),[Mt,vn]=N.useState(!1),[Cn,dn]=N.useState(!1),[Rt,Qn]=N.useState(!1),[xt,Xt]=N.useState(""),[Lr,Ci]=N.useState(""),[ai,Ii]=N.useState(""),[ps,qo]=N.useState(!1),{setHLSStreamUrl:Hi,savedStreamData:Ai}=Goe(),Kn=uc();N.useEffect(()=>{n&&i&&cs()},[n,i]);const cs=async()=>{try{const pt=await Ma(i);pt.logoUrl&&ce(pt.logoUrl),pt.backgroundUrl&&Te(pt.backgroundUrl),pt.videoBackgroundUrl&&_t(pt.videoBackgroundUrl),pt.voiceDisabled!==void 0&&xe(pt.voiceDisabled),pt.accessibleToAllUsers!==void 0&&Pt(pt.accessibleToAllUsers),pt.allowGuestUsers!==void 0&&wt(pt.allowGuestUsers),pt.hideGuestSignInButton!==void 0&&vn(pt.hideGuestSignInButton),f(pt.name||""),v(pt.description||"");try{const nn=await Poe(i);if(nn){Xt(nn.streamUrl||""),Ci(nn.rtmpUrl||""),Ii(nn.streamKey||"");const Ar=nn.enabled===!0;Qn(Ar),G.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:Ar,rawValue:nn.enabled})}else Qn(!1),G.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(nn){if(G.error("Error fetching stream data directly:",nn),Ai){Xt(Ai.streamUrl||""),Ci(Ai.rtmpUrl||""),Ii(Ai.streamKey||"");const Ar=Ai.enabled===!0;Qn(Ar),G.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:Ar,rawValue:Ai.enabled})}else Qn(!1),G.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}da(pt)}catch(pt){G.error("Error fetching space data:",pt),Kn({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};N.useEffect(()=>{if(Ai){if(!ps){Xt(Ai.streamUrl||""),Ci(Ai.rtmpUrl||""),Ii(Ai.streamKey||"");const pt=Ai.enabled===!0;Qn(pt),G.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:pt,rawValue:Ai.enabled})}}else n&&!ps&&G.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Ai,ps,n]);const da=async pt=>{if(i&&n){mt(!0);try{const nn=AO(),Ar=`space_${i}_owners`,Pi=iF(nu(nn,"users"),YJ("groups","array-contains",Ar)),pc=await Zu(Pi),fo=[];for(const $i of pc.docs){const fs=$i.data(),ni=await ru($i.id);fo.push({uid:$i.id,email:fs.email,displayName:fs.displayName||ni.Nickname||"Unknown User",photoURL:fs.photoURL||ni.photoURL,firstName:ni.firstName,lastName:ni.lastName})}rt(fo);const Sl=`space_${i}_hosts`,mh=iF(nu(nn,"users"),YJ("groups","array-contains",Sl)),$s=await Zu(mh),Br=[];for(const $i of $s.docs){const fs=$i.data(),ni=await ru($i.id);Br.push({uid:$i.id,email:fs.email,displayName:fs.displayName||ni.Nickname||"Unknown User",photoURL:fs.photoURL||ni.photoURL,firstName:ni.firstName,lastName:ni.lastName})}$t(Br);const gh=nu(nn,`spaces/${i}/BannedUsers`),zr=await Zu(gh),pa=[];for(const $i of zr.docs){const fs=$i.id;try{const ni=await ru(fs);pa.push({uid:fs,displayName:(ni==null?void 0:ni.Nickname)||fs,firstName:ni==null?void 0:ni.firstName,lastName:ni==null?void 0:ni.lastName,photoURL:ni==null?void 0:ni.photoURL})}catch{pa.push({uid:fs,displayName:fs})}}Vt(pa)}catch(nn){G.error("Error fetching space users:",nn),Kn({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{mt(!1)}}};N.useEffect(()=>{i&&n&&a===4&&da()},[i,n,a]);const Yo=pt=>{const nn=pt.target.files[0];if(nn){if(!nn.type.startsWith("image/")){Kn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}k(nn);const Ar=new FileReader;Ar.onloadend=()=>{L(Ar.result)},Ar.readAsDataURL(nn)}},po=pt=>{const nn=pt.target.files[0];if(nn){if(!nn.type.startsWith("image/")){Kn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}X(nn);const Ar=new FileReader;Ar.onloadend=()=>{te(Ar.result)},Ar.readAsDataURL(nn)}},rd=pt=>{const nn=pt.target.files[0];if(nn){if(!nn.type.startsWith("video/")){Kn({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const Ar=5*1024*1024;if(nn.size>Ar){Kn({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}Ce(nn);const Pi=new FileReader;Pi.onloadend=()=>{De(Pi.result)},Pi.readAsDataURL(nn)}},Xo=async()=>{if(!I){Kn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{z(!0);const pt=setInterval(()=>{K(Ar=>{const Pi=Ar+10;return Pi>=90?90:Pi})},300),nn=await b8e(i,I);clearInterval(pt),K(100),ce(nn),Kn({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{k(null),L(null),K(0),z(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:nn}}))}catch(pt){console.error("Error uploading logo:",pt),Kn({title:"Upload failed",description:pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),z(!1),K(0)}},id=async()=>{if(!ge){Kn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{he(!0);const pt=setInterval(()=>{de(Ar=>{const Pi=Ar+10;return Pi>=90?90:Pi})},300),nn=await T8e(i,ge);clearInterval(pt),de(100),Te(nn),Kn({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{X(null),te(null),de(0),he(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:nn}}))}catch(pt){console.error("Error uploading background:",pt),Kn({title:"Upload failed",description:pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),he(!1),de(0)}},hc=async()=>{if(ne)try{z(!0),await w8e(i),ce(null),Kn({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),z(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(pt){console.error("Error deleting logo:",pt),Kn({title:"Deletion failed",description:pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),z(!1)}},Co=async()=>{if(ve)try{he(!0),await R8e(i),Te(null),Kn({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),he(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(pt){console.error("Error deleting background:",pt),Kn({title:"Deletion failed",description:pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),he(!1)}},Sr=async()=>{if(!be){Kn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{Ne(!0);const pt=setInterval(()=>{Ke(Ar=>{const Pi=Ar+10;return Pi>=90?90:Pi})},300),nn=await A8e(i,be);clearInterval(pt),Ke(100),_t(nn),Kn({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Ce(null),De(null),Ke(0),Ne(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:nn}}))}catch(pt){console.error("Error uploading video background:",pt),Kn({title:"Upload failed",description:pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),Ne(!1),Ke(0)}},ou=async()=>{if(ot)try{Ne(!0),await P8e(i),_t(null),Kn({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),Ne(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(pt){console.error("Error deleting video background:",pt),Kn({title:"Deletion failed",description:pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),Ne(!1)}},ha=()=>{oe.current&&oe.current.click()},Fa=()=>{Fe.current&&Fe.current.click()},Mc=()=>{lt.current&&lt.current.click()},Jo=async()=>{dn(!0);try{await kR(i,{voiceDisabled:!we}),xe(!we),Kn({title:"Settings Updated",description:`Voice chat has been ${we?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(pt){G.error("Error updating voice settings:",pt),Kn({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{dn(!1)}},Qo=async()=>{dn(!0);try{await I8e(i,!$e),Pt(!$e),Kn({title:"Settings Updated",description:`Space is now ${$e?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(pt){G.error("Error updating accessibility settings:",pt),Kn({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{dn(!1)}},sd=async()=>{dn(!0);try{const pt=!It,nn={allowGuestUsers:pt};pt||(nn.hideGuestSignInButton=!1,vn(!1)),await kR(i,nn),wt(pt),Kn({title:"Settings Updated",description:`Guest users are now ${pt?"allowed":"not allowed"} in this space.`,status:"success",duration:3e3,isClosable:!0})}catch(pt){G.error("Error updating guest user settings:",pt),Kn({title:"Error",description:"Failed to update guest user settings",status:"error",duration:3e3,isClosable:!0})}finally{dn(!1)}},ph=async()=>{dn(!0);try{await kR(i,{hideGuestSignInButton:!Mt}),vn(!Mt),window.dispatchEvent(new CustomEvent("SpaceSettingsChanged",{detail:{spaceId:i,hideGuestSignInButton:!Mt}})),Kn({title:"Settings Updated",description:`Guest sign-in button is now ${Mt?"visible":"hidden"}.`,status:"success",duration:3e3,isClosable:!0})}catch(pt){G.error("Error updating sign-in button settings:",pt),Kn({title:"Error",description:"Failed to update sign-in button settings",status:"error",duration:3e3,isClosable:!0})}finally{dn(!1)}},vl=async()=>{if(i){R(!0);try{const pt=AO(),nn=Ir(pt,"spaces",i);await $o(nn,{name:d,description:y}),Kn({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:y}}))}catch(pt){G.error("Error updating space details:",pt),Kn({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{R(!1)}}},fh=async()=>{if(i){qo(!0);try{const pt={enabled:Rt,streamUrl:xt,rtmpUrl:Lr,streamKey:ai,playerIndex:"0",updatedAt:new Date().toISOString()};G.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Rt,url:xt,hasRtmp:!!Lr,hasKey:!!ai});try{await lF(i,pt),G.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(nn){throw G.error("SpaceManageModal: Error updating stream settings directly in Firebase:",nn),nn}await Hi(xt,0,{enabled:Rt,rtmpUrl:Lr,streamKey:ai}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Rt,spaceId:i}})),Kn({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Rt?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{cs()},500)}catch(pt){G.error("Error updating stream settings:",pt),Kn({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{qo(!1)}}},Os=async pt=>{try{Ht(pt);const nn=AO();await TBe(Ir(nn,`spaces/${i}/BannedUsers`,pt));const Ar=Ir(nn,"users",pt),Pi=`space_${i}_banned`;await $o(Ar,{groups:ooe(Pi)}),Vt(pc=>pc.filter(fo=>fo.uid!==pt)),Kn({title:"User Unbanned",description:"User can now re-enter this space.",status:"success",duration:3e3,isClosable:!0})}catch(nn){G.error("Error unbanning user:",nn),Kn({title:"Error",description:"Failed to unban user",status:"error",duration:3e3,isClosable:!0})}finally{Ht(null)}};return w.jsxs(Rs,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),w.jsxs(Cs,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[w.jsx(To,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.200",children:"Manage Space"}),w.jsx(zs,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),w.jsx(Is,{p:0,display:"flex",overflow:"hidden",children:w.jsxs(y0,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",width:"100%",height:"100%",children:[w.jsxs(E0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:jWe,mb:1}),w.jsx(it,{fontSize:"xs",children:"Details"})]}),w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:Cy,mb:1}),w.jsx(it,{fontSize:"xs",children:"Logo"})]}),w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:FWe,mb:1}),w.jsx(it,{fontSize:"xs",children:"Background"})]}),w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:zWe,mb:1}),w.jsx(it,{fontSize:"xs",children:"Settings"})]}),w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:UQ,mb:1}),w.jsx(it,{fontSize:"xs",children:"Users"})]}),w.jsxs(Na,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(yn,{as:DR,mb:1}),w.jsx(it,{fontSize:"xs",children:"Stream"})]})]}),w.jsxs(ZR,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Details"}),w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsxs(Kr,{children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"Space Name"}),w.jsx(Xi,{value:d,onChange:pt=>f(pt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),w.jsxs(Kr,{children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"Description"}),w.jsx(Cre,{value:y,onChange:pt=>v(pt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),w.jsxs(Kr,{children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"Space Tags"}),w.jsx(ht,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?w.jsx(uae,{spaceID:i}):w.jsxs(Eg,{status:"warning",variant:"subtle",borderRadius:"md",children:[w.jsx(vg,{}),w.jsx(vR,{fontSize:"sm",children:"Space ID missing"}),w.jsx(SR,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),w.jsx($n,{colorScheme:"blue",size:"sm",onClick:vl,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Logo"}),w.jsx(it,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ne||M)&&w.jsxs(Bi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ne&&w.jsxs(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(it,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),w.jsx(yp,{src:ne,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),w.jsx($n,{mt:3,colorScheme:"red",leftIcon:w.jsx(yn,{as:i0}),onClick:hc,isLoading:j,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),M&&w.jsxs(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(it,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),w.jsx(yp,{src:M,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),w.jsxs(Kr,{children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"Upload New Logo"}),w.jsx(Xi,{type:"file",accept:"image/*",onChange:Yo,ref:oe,display:"none"}),j&&w.jsxs(ht,{mt:3,mb:3,children:[w.jsxs(it,{fontSize:"xs",mb:1,children:["Uploading... ",Y,"%"]}),w.jsx(Uy,{value:Y,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),w.jsxs(jn,{mt:3,spacing:3,children:[w.jsx($n,{colorScheme:"blue",leftIcon:w.jsx(yn,{as:Cy}),onClick:ha,isDisabled:j,size:"sm",variant:"outline",children:"Browse"}),w.jsx($n,{colorScheme:"green",leftIcon:w.jsx(yn,{as:xO}),onClick:Xo,isLoading:j,loadingText:"Uploading...",isDisabled:!I||j,size:"sm",children:"Upload"})]}),w.jsx(HS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Background"}),w.jsx(it,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),w.jsxs(y0,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[w.jsxs(E0,{children:[w.jsxs(Na,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[w.jsx(yn,{as:Cy,mr:2}),"Image"]}),w.jsxs(Na,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[w.jsx(yn,{as:xQ,mr:2}),"Video (max 5MB)"]})]}),w.jsxs(ZR,{mt:4,children:[w.jsxs(Pc,{p:0,children:[(ve||J)&&w.jsxs(Bi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ve&&w.jsxs(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(it,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),w.jsx(yp,{src:ve,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),w.jsx($n,{mt:3,colorScheme:"red",leftIcon:w.jsx(yn,{as:i0}),onClick:Co,isLoading:ie,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),J&&w.jsxs(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(it,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),w.jsx(yp,{src:J,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),w.jsxs(Kr,{children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"Upload New Background Image"}),w.jsx(Xi,{type:"file",accept:"image/*",onChange:po,ref:Fe,display:"none"}),ie&&w.jsxs(ht,{mt:3,mb:3,children:[w.jsxs(it,{fontSize:"xs",mb:1,children:["Uploading... ",fe,"%"]}),w.jsx(Uy,{value:fe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),w.jsxs(jn,{mt:3,spacing:3,children:[w.jsx($n,{colorScheme:"blue",leftIcon:w.jsx(yn,{as:Cy}),onClick:Fa,isDisabled:ie,size:"sm",variant:"outline",children:"Browse"}),w.jsx($n,{colorScheme:"green",leftIcon:w.jsx(yn,{as:xO}),onClick:id,isLoading:ie,loadingText:"Uploading...",isDisabled:!ge||ie,size:"sm",children:"Upload"})]}),w.jsx(HS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),w.jsxs(Pc,{p:0,children:[(ot||Ae)&&w.jsxs(Bi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ot&&w.jsxs(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(it,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),w.jsx(ht,{maxH:"160px",overflow:"hidden",position:"relative",children:w.jsx("video",{src:ot,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),w.jsx($n,{mt:3,colorScheme:"red",leftIcon:w.jsx(yn,{as:i0}),onClick:ou,isLoading:Ee,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Ae&&w.jsxs(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(it,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),w.jsx(ht,{maxH:"160px",overflow:"hidden",children:w.jsx("video",{src:Ae,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),w.jsxs(Kr,{children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"Upload New Video Background"}),w.jsx(Xi,{type:"file",accept:"video/*",onChange:rd,ref:lt,display:"none"}),Ee&&w.jsxs(ht,{mt:3,mb:3,children:[w.jsxs(it,{fontSize:"xs",mb:1,children:["Uploading... ",je,"%"]}),w.jsx(Uy,{value:je,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),w.jsxs(jn,{mt:3,spacing:3,children:[w.jsx($n,{colorScheme:"blue",leftIcon:w.jsx(yn,{as:xQ}),onClick:Mc,isDisabled:Ee,size:"sm",variant:"outline",children:"Browse"}),w.jsx($n,{colorScheme:"green",leftIcon:w.jsx(yn,{as:xO}),onClick:Sr,isLoading:Ee,loadingText:"Uploading...",isDisabled:!be||Ee,size:"sm",children:"Upload"})]}),w.jsx(HS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Settings"}),w.jsx(it,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsx(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsxs(ht,{children:[w.jsxs(jn,{mb:1,spacing:2,children:[w.jsxs(ht,{position:"relative",w:"16px",h:"16px",children:[w.jsx(yn,{as:GWe,color:we?"red.400":"green.400"}),we&&w.jsx(ht,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),w.jsx(it,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.800",children:we?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),w.jsx(eh,{isChecked:!we,onChange:Jo,colorScheme:"green",size:"md",isDisabled:Cn})]})}),w.jsx(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsxs(ht,{children:[w.jsxs(jn,{mb:1,spacing:2,children:[w.jsx(ht,{position:"relative",w:"16px",h:"16px",children:w.jsx(yn,{as:UQ,color:$e?"green.400":"red.400"})}),w.jsx(it,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.800",children:$e?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.700",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),w.jsx(eh,{isChecked:$e,onChange:Qo,colorScheme:"green",size:"md",isDisabled:Cn})]})}),w.jsxs(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsxs(ht,{children:[w.jsxs(jn,{mb:1,spacing:2,children:[w.jsx(ht,{position:"relative",w:"16px",h:"16px",children:w.jsx(yn,{as:MQ,color:It?"green.400":"red.400"})}),w.jsx(it,{fontSize:"sm",fontWeight:"600",children:"Allow Guest Users"})]}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.800",children:It?"Unauthenticated users can enter as guests with usernames like 'Visitor_1234'.":"Only authenticated users can access this space."}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.700",mt:1,children:"Guest users have limited permissions and cannot save progress."})]}),w.jsx(eh,{isChecked:It,onChange:sd,colorScheme:"green",size:"md",isDisabled:Cn})]}),It&&w.jsx(ht,{mt:3,pt:3,borderTop:"1px solid",borderColor:"whiteAlpha.200",children:w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsxs(ht,{children:[w.jsxs(jn,{mb:1,spacing:2,children:[w.jsx(ht,{position:"relative",w:"14px",h:"14px",ml:1,children:w.jsx(yn,{as:LQ,color:Mt?"orange.400":"gray.400",fontSize:"sm"})}),w.jsx(it,{fontSize:"sm",fontWeight:"500",children:"Remove Sign In Button"})]}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.700",ml:5,children:Mt?"Guest users won't see the sign-in button to upgrade their account.":"Guest users can see a sign-in button to upgrade to a full account."})]}),w.jsx(eh,{isChecked:Mt,onChange:ph,colorScheme:"orange",size:"sm",isDisabled:Cn||!It})]})})]}),w.jsxs(Eg,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[w.jsx(vg,{color:"blue.300"}),w.jsxs(ht,{children:[w.jsx(vR,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),w.jsx(SR,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Manage Users"}),w.jsx(it,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),ut?w.jsx(Bi,{justify:"center",align:"center",h:"200px",children:w.jsx(uh,{color:"blue.300"})}):w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsxs(ht,{children:[w.jsxs(jn,{mb:2,children:[w.jsx(yn,{as:VWe,color:"green.400"}),w.jsx(it,{fontSize:"sm",fontWeight:"600",children:"Owners"}),w.jsx(Qd,{colorScheme:"green",ml:2,children:vt.length})]}),w.jsx(ht,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:vt.length===0?w.jsx(it,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):w.jsx(qr,{spacing:1,align:"stretch",children:vt.map(pt=>w.jsxs(jn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[w.jsx(ih,{size:"xs",src:pt.photoURL,name:pt.displayName}),w.jsxs(ht,{children:[w.jsx(it,{fontSize:"xs",children:pt.displayName}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.600",children:pt.firstName&&pt.lastName?`${pt.firstName} ${pt.lastName}`:"Full name not available"})]}),w.jsx(ZS,{}),w.jsx(Qd,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},pt.uid))})})]}),w.jsxs(ht,{children:[w.jsxs(jn,{mb:2,children:[w.jsx(yn,{as:WWe,color:"purple.400"}),w.jsx(it,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),w.jsx(Qd,{colorScheme:"purple",ml:2,children:bt.length})]}),w.jsx(ht,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:bt.length===0?w.jsx(it,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):w.jsx(qr,{spacing:1,align:"stretch",children:bt.map(pt=>w.jsxs(jn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[w.jsx(ih,{size:"xs",src:pt.photoURL,name:pt.displayName}),w.jsxs(ht,{children:[w.jsx(it,{fontSize:"xs",children:pt.displayName}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.600",children:pt.firstName&&pt.lastName?`${pt.firstName} ${pt.lastName}`:"Full name not available"})]}),w.jsx(ZS,{}),w.jsx(Qd,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},pt.uid))})})]}),w.jsxs(ht,{children:[w.jsxs(jn,{mb:2,children:[w.jsx(yn,{as:LQ,color:"red.400"}),w.jsx(it,{fontSize:"sm",fontWeight:"600",children:"Banned Users"}),w.jsx(Qd,{colorScheme:"red",ml:2,children:at.length})]}),w.jsx(ht,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:at.length===0?w.jsx(it,{fontSize:"xs",color:"whiteAlpha.600",children:"No banned users"}):w.jsx(qr,{spacing:1,align:"stretch",children:at.map(pt=>w.jsxs(jn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[w.jsx(ih,{size:"xs",src:pt.photoURL,name:pt.displayName}),w.jsxs(ht,{children:[w.jsx(it,{fontSize:"xs",children:pt.displayName}),pt.firstName&&w.jsxs(it,{fontSize:"xs",color:"whiteAlpha.600",children:[pt.firstName," ",pt.lastName]})]}),w.jsx(ZS,{}),w.jsxs(jn,{spacing:2,children:[w.jsx($n,{size:"xs",colorScheme:"green",isLoading:rn===pt.uid,onClick:()=>Os(pt.uid),leftIcon:w.jsx(yn,{as:MQ}),children:"Unban"}),w.jsx(Qd,{colorScheme:"red",variant:"solid",fontSize:"2xs",children:"Banned"})]})]},pt.uid))})})]})]})]}),w.jsxs(Pc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Stream Settings"}),w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsx(ht,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(jn,{justify:"space-between",align:"center",children:[w.jsx(ht,{children:w.jsxs(jn,{mb:1,spacing:2,children:[w.jsx(ht,{position:"relative",w:"16px",h:"16px",children:w.jsx(yn,{as:DR,color:Rt?"green.400":"red.400"})}),w.jsx(it,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),w.jsx(eh,{isChecked:Rt,onChange:async()=>{const pt=!Rt;Qn(pt),qo(!0);try{G.log("SpaceManageModal: Auto-saving streaming enabled state:",pt);const nn={enabled:pt,streamUrl:xt||"",rtmpUrl:Lr||"",streamKey:ai||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await lF(i,nn),G.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(Ar){throw G.error("SpaceManageModal: Error updating streaming state directly in Firebase:",Ar),Ar}await Hi(xt,0,{enabled:pt,rtmpUrl:Lr,streamKey:ai}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:pt,spaceId:i}})),Kn({title:"Streaming "+(pt?"Enabled":"Disabled"),description:`Streaming is now ${pt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(nn){G.error("Error auto-saving streaming state:",nn),Qn(!pt),Kn({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{qo(!1),setTimeout(()=>{cs()},500)}},colorScheme:"green",size:"md",isDisabled:ps})]})}),w.jsxs(ht,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),w.jsxs(Kr,{mb:4,children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"Stream URL"}),w.jsx(Xi,{value:xt,onChange:pt=>Xt(pt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:ps})]}),w.jsx(h0,{my:3,borderColor:"whiteAlpha.200"}),w.jsx(it,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),w.jsxs(Kr,{mb:3,children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"RTMP URL"}),w.jsx(Xi,{value:Lr,onChange:pt=>Ci(pt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:ps})]}),w.jsxs(Kr,{mb:3,children:[w.jsx(ss,{fontSize:"xs",color:"white",children:"Stream Key"}),w.jsx(Xi,{value:ai,onChange:pt=>Ii(pt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:ps,type:"password"})]})]}),w.jsx($n,{colorScheme:"blue",size:"sm",onClick:fh,isLoading:ps,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Rt?"inline-flex":"none",children:"Save Stream Settings"}),w.jsxs(Eg,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[w.jsx(vg,{color:"blue.300"}),w.jsxs(ht,{children:[w.jsx(vR,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),w.jsx(SR,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},dae="spaces",hae="portals",ZWe=async(n,t,i)=>{try{const a=Ir(ir,dae,n,hae,t),l={...i,sourceSpaceId:n,portalId:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Lg(a,l),G.log(`Saved portal ${t} to space ${n}`),!0}catch(a){return G.error("Error saving portal:",a),!1}},VQ=async(n,t,i)=>{try{const a=Ir(ir,dae,n,hae,t),l={...i,updatedAt:new Date().toISOString()};return await $o(a,l),G.log(`Updated portal ${t} in space ${n}`),!0}catch(a){return G.error("Error updating portal:",a),!1}},eGe=({isOpen:n,onClose:t,currentSpaceId:i})=>{const[a,l]=N.useState([]),[d,f]=N.useState(!1),[y,v]=N.useState(null),[b,R]=N.useState(!1),I=uc(),{placePortal:k,directPlacePortal:M}=Koe(),L=_g("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),j=_g("gray.800","white"),z=_g("gray.200","whiteAlpha.200"),Y=_g("gray.200","whiteAlpha.300");N.useEffect(()=>{n&&(async()=>{f(!0),v(null),l([]);try{const oe=nu(ir,"spaces"),X=(await Zu(oe)).docs.map(J=>({id:J.id,name:J.data().name||`Space ID: ${J.id}`}));l(X)}catch(oe){G.error("PortalAdminModal: Error fetching spaces:",oe),v("Failed to load spaces. Please check your connection and try again.")}f(!1)})()},[n]);const K=async(ce,oe)=>{if(!i){G.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),I({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}R(!0),G.log(`PortalAdminModal: Attempting to place portal to ${oe} (${ce}) in space ${i}`);try{const ge=await Ma(ce);if(!ge)throw new Error(`Failed to fetch target space data for ${ce}`);const X=ge.backgroundUrl||ge.backgroundGsUrl;X||G.warn(`PortalAdminModal: No background image URL found for target space: ${ce}`);const J="PortalObjectPrefab",te={x:0,y:1.5,z:0},ie={x:0,y:0,z:0},he={x:1,y:1,z:1},fe=`portal_${i}_${ce}_${Date.now()}`;if(!await ZWe(i,fe,{type:"portal",targetSpaceId:ce,targetSpaceName:oe,portalId:fe,position:te,rotation:ie,scale:he,prefabName:J,initialImageUrl:X})){G.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),I({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),R(!1);return}G.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let Te=!1;try{const Fe={portalId:fe,prefabName:J,position:te,rotation:ie,scale:he,initialImageUrl:X};Te=k(fe,J,te,ie,he,X),Te||(Te=M(fe,J,te,ie,he,X)),G.log("PortalAdminModal: Portal placement in Unity:",Te)}catch(Fe){G.error("PortalAdminModal: Error placing portal in Unity:",Fe)}Te?(I({title:"Portal Placed",description:`Portal to ${oe} created successfully.`,status:"success",duration:3e3,isClosable:!0}),t()):(I({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),t())}catch(ge){G.error("PortalAdminModal: Error creating portal:",ge),I({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{R(!1)}},ne=d||b;return w.jsxs(Rs,{isOpen:n,onClose:t,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[w.jsx(As,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),w.jsxs(Cs,{bg:L,backdropFilter:"blur(18px)",color:j,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[w.jsx(To,{borderBottom:"1px solid",borderColor:Y,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),w.jsx(zs,{}),w.jsxs(Is,{p:6,children:[ne&&w.jsxs(qr,{justifyContent:"center",alignItems:"center",height:"200px",children:[w.jsx(uh,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),w.jsx(it,{mt:3,children:"Loading Spaces..."})]}),y&&w.jsxs(Eg,{status:"error",borderRadius:"md",variant:"subtle",children:[w.jsx(vg,{}),y]}),!d&&!y&&a.length===0&&w.jsx(it,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!d&&!y&&a.length>0&&w.jsx(Wk,{spacing:3,children:a.map(ce=>w.jsx(Mne,{p:3,borderRadius:"md",_hover:{bg:z,cursor:ne?"not-allowed":"pointer",transform:ne?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!ne&&K(ce.id,ce.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:ne?.7:1,pointerEvents:ne?"none":"auto",children:ce.name},ce.id))})]})]})]})},FQ=["Recent","Furniture","Objects","Upload","Portals"],tGe={Furniture:"chair",Objects:"misc"},nGe=({isOpen:n,onClose:t,settings:i})=>{const[a,l]=N.useState(FQ[0]),[d,f]=N.useState(""),[y,v]=N.useState(!1),[b,R]=N.useState(!1),[I,k]=N.useState([]),[M,L]=N.useState(!0),[j,z]=N.useState(null),{placeCatalogueItem:Y}=qoe(),K=_g("blue.500","blue.300"),ne=_g("gray.500","gray.400"),ce=_g("whiteAlpha.200","whiteAlpha.200");N.useEffect(()=>{n&&(async()=>{L(!0),z(null),k([]);try{const fe=nu(ir,"catalogue"),de=await Zu(fe),ve=[];de.forEach(Te=>{var Ce,Ae;const Fe=Te.data(),be=["chair","misc"];Fe.glbUrl&&((Ce=Fe.categories)!=null&&Ce.some(De=>be.includes(De)))&&ve.push({id:Te.id,name:Fe.name||"Unnamed Item",thumbnail:((Ae=Fe.thumbnail)==null?void 0:Ae.src)||"https://via.placeholder.com/150",glbUrl:Fe.glbUrl,categories:Fe.categories})}),k(ve)}catch(fe){console.error("Error fetching catalogue items:",fe),z("Failed to load catalogue items. Please check your connection and try again.")}L(!1)})()},[n]);const oe=he=>{l(he),f(""),v(he==="Portals")},ge=(he,fe)=>{const de=tGe[fe];let ve=he;return de&&(ve=ve.filter(Te=>{var Fe;return(Fe=Te.categories)==null?void 0:Fe.includes(de)})),d&&(ve=ve.filter(Te=>Te.name.toLowerCase().includes(d.toLowerCase()))),ve},X=["Furniture","Objects"].includes(a)?ge(I,a):[],J=async he=>{console.log(`Placing item: ${he.name}`);try{if(!he.glbUrl){console.error("Item is missing GLB URL");return}const fe=`item_${i.spaceID}_${Date.now()}`,de={x:0,y:0,z:0},ve={x:0,y:0,z:0},Te={x:1,y:1,z:1},Fe={itemId:fe,name:he.name||"Unnamed Item",glbUrl:he.glbUrl,thumbnail:he.thumbnail||"https://via.placeholder.com/150",position:de,rotation:ve,scale:Te,createdAt:Date.now(),updatedAt:Date.now(),categories:he.categories||[]};if(!Fe.glbUrl)throw new Error("GLB URL is required");await Lg(Ir(ir,"spaces",i.spaceID,"catalogue",fe),Fe),Y(fe,Fe.glbUrl,de,ve,Te)?t():console.error("Failed to place item in Unity")}catch(fe){console.error("Error placing item:",fe)}},te=()=>{R(!0)},ie=()=>{R(!1)};return w.jsxs(Rs,{isOpen:n,onClose:t,size:"5xl",isCentered:!0,children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),w.jsxs(Cs,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",height:"85vh",maxHeight:"750px",width:"85vw",maxWidth:"1200px",overflow:"hidden",children:[w.jsx(To,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:y?"Create New Portal":"Content Catalogue"}),w.jsx(zs,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),w.jsxs(Is,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[w.jsxs(jn,{spacing:4,p:4,borderBottom:"1px solid",borderColor:"whiteAlpha.300",overflowX:"auto",children:[FQ.filter(he=>he!=="Portals").map(he=>w.jsx($n,{variant:"ghost",size:"md",fontWeight:a===he?"semibold":"normal",color:a===he?"white":ne,bg:a===he?ce:"transparent",borderBottom:a===he?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:a!==he?"whiteAlpha.100":ce,color:"white"},onClick:()=>oe(he),px:4,whiteSpace:"nowrap",children:he},he)),w.jsx(ZS,{}),w.jsx($n,{variant:"ghost",size:"md",fontWeight:a==="Portals"?"semibold":"normal",color:a==="Portals"?"white":ne,bg:a==="Portals"?ce:"transparent",borderBottom:a==="Portals"?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:a!=="Portals"?"whiteAlpha.100":ce,color:"white"},onClick:()=>oe("Portals"),px:4,whiteSpace:"nowrap",children:"Portals"},"Portals")]}),y&&a==="Portals"?w.jsx(ht,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:w.jsx($n,{size:"lg",colorScheme:"blue",onClick:te,children:"Browse"})}):w.jsxs(w.Fragment,{children:[w.jsx(ht,{p:4,children:w.jsx(Xi,{placeholder:`Search in ${a}...`,value:d,onChange:he=>f(he.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),w.jsx(ht,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:w.jsx(Wj,{templateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:4,children:M?w.jsx(it,{color:"whiteAlpha.700",children:"Loading items..."}):X.length>0?X.map(he=>w.jsxs(ht,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>J(he),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[w.jsx(ht,{bgImage:`url(${he.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"100px",mb:2,flexShrink:0}),w.jsx(it,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:he.name})]},he.id)):w.jsxs(it,{color:"whiteAlpha.700",children:[a==="Furniture"&&"No chairs found in the catalogue.",a==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(a)&&`No items found in "${a}"${d&&` matching "${d}"`}.`]})})})]})]})]}),w.jsx(eGe,{isOpen:b,onClose:ie,currentSpaceId:i==null?void 0:i.spaceID})]})},rGe=({onTogglePlayerList:n,spaceID:t,containerRef:i})=>{const{fullscreenRef:a}=hh(),[l,d]=N.useState(!0),[f,y]=N.useState(!1),[v,b]=N.useState(!1),[R,I]=N.useState(!1),[k,M]=N.useState(!1),[L,j]=N.useState(!1),[z,Y]=N.useState(!1),[K,ne]=N.useState(null),[ce,oe]=N.useState(!1),[ge,X]=N.useState(!1),[J,te]=N.useState(!1),[ie,he]=N.useState(!1),fe=uc(),{user:de,currentUser:ve,isGuestUser:Te}=N.useContext(Hs),be=de!=null&&de.Nickname?de.Nickname:ve&&Te(ve)?ve.username||ve.Nickname||"Guest User":"Unknown",[Ce,Ae]=N.useState(!1),De=$t=>{if(!$t)return"G";if($t.startsWith("Visitor_")){const ut=$t.split("_")[1];return`V${ut?ut.charAt(0):""}`}return $t.charAt(0).toUpperCase()},Ee=async()=>{if(de!=null&&de.uid&&t)try{const $t=await ru(de.uid);let ut=!1,mt=!1;if($t.groups){const Vt=`space_${t}_owners`,rn=`space_${t}_hosts`;ut=$t.groups.includes(Vt),mt=$t.groups.includes(rn)}const at=await doe(de.uid,"disruptiveAdmin");if(he(at),ne({rpmURL:$t.rpmURL?$t.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,isGuest:!1}),X(ut||at),te(mt),!ut&&!at&&ce){oe(!1);const Vt=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Vt),fe({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch($t){console.error("Error fetching profile data:",$t),X(!1),te(!1),he(!1)}else if(ve&&Te(ve)){if(ne({rpmURL:ve.rpmURL?ve.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,isGuest:!0}),X(!1),te(!1),he(!1),ce){oe(!1);const $t=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent($t)}}else ne(null),X(!1),te(!1),he(!1)};N.useEffect(()=>{Ee()},[de==null?void 0:de.uid,ve==null?void 0:ve.uid,ve==null?void 0:ve.rpmURL,t,ce]),N.useEffect(()=>{const $t=()=>{d(!0)};return window.addEventListener("PlayerInstantiated",$t),()=>{window.removeEventListener("PlayerInstantiated",$t)}},[]),N.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&Ae(window.agoraClient.voiceDisabled)}catch(mt){console.error("Error checking if voice is disabled:",mt)}})();const ut=mt=>{mt.detail&&typeof mt.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",mt.detail.voiceDisabled),Ae(mt.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",ut),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ut)}},[]);const Ne=()=>{b(!v),v||rt()},je=()=>I(!R),Ke=()=>{j(!L),rt()},ot=()=>{M(!1),Ee()},_t=()=>{Y(!1)},lt=()=>{Y(!0),rt()},vt=$t=>{$t.stopPropagation(),typeof n=="function"&&(G.log("CanvasMainMenu: Toggling player list"),n())},rt=()=>{y(!1)},bt=$t=>{if($t.stopPropagation(),!ge){fe({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const ut=!ce;oe(ut);const mt=new CustomEvent("editModeChanged",{detail:{enabled:ut}});window.dispatchEvent(mt),fe({title:ut?"Edit Mode Enabled":"Edit Mode Disabled",description:ut?"You can now make changes to the scene.":"Scene editing is now disabled.",status:ut?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return w.jsxs(w.Fragment,{children:[w.jsxs(Hk,{isOpen:f,onClose:()=>y(!1),children:[w.jsx($k,{as:kc,icon:w.jsx(Sze,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:f?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:f?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>y(!f)}),w.jsx(El,{containerRef:a,children:w.jsx(Kk,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:3,borderRadius:"lg",zIndex:9999,transform:"none !important",children:w.jsxs(qr,{align:"stretch",spacing:3,children:[w.jsxs(jn,{spacing:3,children:[w.jsx(ih,{size:"sm",src:K==null?void 0:K.rpmURL,bg:"white",name:K!=null&&K.isGuest?De((ve==null?void 0:ve.username)||(ve==null?void 0:ve.Nickname)):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),w.jsxs(qr,{align:"start",spacing:0,children:[w.jsxs(jn,{children:[w.jsx(it,{fontWeight:"bold",fontSize:"sm",children:be}),ge&&!ie&&w.jsx(Nf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:a},children:w.jsx(ht,{display:"inline-block",children:w.jsx(yn,{as:_F,color:"green.400",boxSize:2.5})})}),!ge&&J&&!ie&&w.jsx(Nf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:a},children:w.jsx(ht,{display:"inline-block",children:w.jsx(yn,{as:yF,color:"purple.400",boxSize:2.5})})}),ie&&w.jsx(Nf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:a},children:w.jsx(ht,{display:"inline-block",children:w.jsx(yn,{as:pWe,color:"blue.400",boxSize:2.5})})})]}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),w.jsxs(jn,{spacing:3,justify:"center",children:[w.jsx(kc,{icon:w.jsx(mWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:vt}),ge&&w.jsx(kc,{icon:w.jsx(oWe,{}),variant:"ghost",colorScheme:ce?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:bt}),!ce&&w.jsx(kc,{icon:w.jsx(ht,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"},isDisabled:!0}),ce&&w.jsx(kc,{icon:w.jsx(sWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Catalogue",_hover:{bg:"whiteAlpha.200"},onClick:lt}),w.jsx(kc,{icon:w.jsx(ht,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),w.jsx(h0,{borderColor:"whiteAlpha.300"}),w.jsxs(qr,{align:"stretch",spacing:1,children:[ge&&w.jsxs(jn,{p:1.5,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},justify:"space-between",children:[w.jsx(it,{fontSize:"sm",children:"Edit Mode"}),w.jsx(eh,{id:"edit-mode-toggle",isChecked:ce,onChange:bt,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:ce?"green.500":"black"}}})]}),ge&&w.jsx(it,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:Ke,children:"Manage Space"}),de&&t&&!Ce&&w.jsx(xWe,{onClose:rt}),w.jsx(it,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:Ne,children:"Settings"}),w.jsx(it,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:je,children:"Controls"}),w.jsx(it,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),w.jsx(it,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),R&&w.jsx(LWe,{open:R,onClose:je}),v&&w.jsx(UWe,{open:v,onClose:Ne,containerRef:i}),k&&w.jsx(iae,{open:k,onClose:ot}),w.jsx(QWe,{isOpen:L,onClose:Ke}),w.jsx(nGe,{isOpen:z,onClose:_t,settings:{spaceID:t}})]})},iGe=({isOpen:n,onClose:t,mediaScreenId:i,onImageChange:a})=>{const{spaceID:l}=Ro(),d=dc(),f=uc(),y=N.useRef(null),v=N.useRef(null),b=N.useRef(),[R,I]=N.useState(null),[k,M]=N.useState(""),[L,j]=N.useState(!1),[z,Y]=N.useState(0),[K,ne]=N.useState(null),[ce,oe]=N.useState(!0),[ge,X]=N.useState(!1),[J,te]=N.useState(!1),[ie,he]=N.useState(0),[fe,de]=N.useState("image"),[ve,Te]=N.useState(""),[Fe,be]=N.useState(!1);N.useEffect(()=>{(async()=>{if(n&&i&&l){oe(!0);try{const bt=await Xy(l,i);if(bt&&(bt.imageUrl||bt.videoUrl)){ne(bt);const $t=bt.mediaType==="video";de($t?"video":"image"),be(bt.displayAsVideo||!1),$t&&bt.videoUrl&&(Te(bt.videoUrl),he(1))}else ne(null)}catch(bt){G.error("Error fetching existing image:",bt),ne(null)}finally{oe(!1)}}})()},[n,i,l]),N.useEffect(()=>{n||(I(null),M(""),Y(0),Te(""))},[n]);const Ce=N.useCallback(rt=>{rt.preventDefault(),rt.stopPropagation(),te(!0)},[]),Ae=N.useCallback(rt=>{rt.preventDefault(),rt.stopPropagation(),te(!1)},[]),De=N.useCallback(rt=>{rt.preventDefault(),rt.stopPropagation()},[]),Ee=N.useCallback(rt=>{if(rt.preventDefault(),rt.stopPropagation(),te(!1),rt.dataTransfer.files&&rt.dataTransfer.files.length>0){const bt=rt.dataTransfer.files[0];Ne(bt)}},[]);N.useEffect(()=>{const rt=v.current;if(rt)return rt.addEventListener("dragenter",Ce),rt.addEventListener("dragleave",Ae),rt.addEventListener("dragover",De),rt.addEventListener("drop",Ee),()=>{rt.removeEventListener("dragenter",Ce),rt.removeEventListener("dragleave",Ae),rt.removeEventListener("dragover",De),rt.removeEventListener("drop",Ee)}},[Ce,Ae,De,Ee]);const Ne=rt=>{if(!rt)return;if(!rt.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(rt);const bt=new FileReader;bt.onloadend=()=>{M(bt.result)},bt.readAsDataURL(rt)},je=rt=>{const bt=rt.target.files[0];Ne(bt)},Ke=async rt=>{const bt=rt.target.checked;if(be(bt),K)try{await Lze(l,i,bt),bt?d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),ne({...K,displayAsVideo:bt}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${bt?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),G.log(`Updated display mode for media screen ${i} to ${bt?"video":"image"}`),a&&a({type:"update",mediaScreenId:i,displayAsVideo:bt})}catch($t){G.error("Error updating display mode:",$t),f({title:"Update failed",description:$t.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),be(!bt)}},ot=async()=>{if(fe==="image"&&!R){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(fe==="video"&&!ve){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{j(!0);const rt=setInterval(()=>{Y(mt=>{const at=mt+10;return at>=90?90:at})},300);let bt;fe==="image"?bt=await IQ(l,i,R,{mediaType:fe,displayAsVideo:Fe}):(bt=ve,await IQ(l,i,null,{mediaType:"video",directUrl:ve,displayAsVideo:Fe})),clearInterval(rt),Y(100);let $t=null,ut=null;fe==="image"?($t=Fe?null:bt,ut=(K==null?void 0:K.videoUrl)||null):($t=!Fe&&(K!=null&&K.imageUrl)?K.imageUrl:null,ut=bt),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:$t,videoUrl:ut,mediaType:fe,displayAsVideo:Fe}),G.log(`Uploaded and sent ${fe} for media screen ${i} (display as video: ${Fe})`),a&&a({type:"upload",mediaScreenId:i,imageUrl:fe==="image"?bt:K==null?void 0:K.imageUrl,videoUrl:fe==="video"?bt:K==null?void 0:K.videoUrl,mediaType:fe,displayAsVideo:Fe}),f({title:"Upload successful",description:`The ${fe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),M(""),j(!1),Y(0),t()},1e3)}catch(rt){G.error(`Error uploading ${fe}:`,rt),f({title:"Upload failed",description:rt.message||`An error occurred while uploading the ${fe}`,status:"error",duration:5e3,isClosable:!0}),j(!1),Y(0)}},_t=async()=>{X(!1);try{j(!0),await xze(l,i),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:fe==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:fe==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),G.log(`Deleted ${fe} for media screen ${i}`),a&&a({type:"delete",mediaScreenId:i}),f({title:`${fe==="image"?"Image":"Video"} deleted`,description:`The ${fe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ne(null),j(!1),Te(""),be(!1),setTimeout(()=>{t()},500)}catch(rt){G.error(`Error deleting ${fe}:`,rt),f({title:"Deletion failed",description:rt.message||`An error occurred while deleting the ${fe}`,status:"error",duration:5e3,isClosable:!0}),j(!1)}},lt=()=>{L||(I(null),M(""),Y(0),t())},vt=rt=>{he(rt),de(rt===0?"image":"video")};return w.jsxs(w.Fragment,{children:[w.jsxs(Rs,{isOpen:n,onClose:lt,size:"lg",children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),w.jsxs(Cs,{bg:"#1a1a1a",color:"white",maxW:"650px",borderRadius:"xl",border:"1px solid #333",children:[w.jsx(To,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Media Screen"}),w.jsx(zs,{isDisabled:L,color:"gray.400",_hover:{color:"white",bg:"rgba(255,255,255,0.1)"},borderRadius:"full",size:"sm",top:3,right:3}),w.jsxs(ht,{px:4,pb:1,children:[w.jsxs(Bi,{justify:"space-between",align:"center",bg:"rgba(255,255,255,0.03)",p:2,borderRadius:"lg",mb:1,border:"1px solid rgba(255,255,255,0.08)",children:[w.jsxs(jn,{spacing:2,children:[w.jsx(it,{fontWeight:"500",fontSize:"xs",color:"gray.300",children:"Display:"}),w.jsxs(jn,{spacing:2,children:[w.jsx(yn,{as:Cy,color:Fe?"gray.500":"white",size:"sm"}),w.jsx(eh,{colorScheme:"gray",size:"sm",isChecked:Fe,onChange:Ke}),w.jsx(yn,{as:DR,color:Fe?"white":"gray.500",size:"sm"})]})]}),w.jsx(Qd,{bg:"rgba(255,255,255,0.1)",color:"gray.300",fontSize:"xs",px:2,py:1,borderRadius:"md",fontWeight:"500",children:Fe?"Video":"Image"})]}),w.jsxs(it,{fontSize:"xs",color:"gray.500",children:["ID: ",i]})]}),w.jsx(Is,{px:4,py:1,children:w.jsxs(Bi,{children:[w.jsx(y0,{orientation:"vertical",variant:"unstyled",index:ie,onChange:vt,h:"100%",minW:"75px",mr:3,children:w.jsxs(E0,{spacing:1,children:[w.jsxs(Na,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},mb:1,py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[w.jsx(yn,{as:Cy,mr:1.5,size:"sm"})," Image"]}),w.jsxs(Na,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[w.jsx(yn,{as:DR,mr:1.5,size:"sm"})," Video"]})]})}),w.jsx(ht,{flex:"1",children:ce?w.jsx(Bi,{justify:"center",align:"center",h:"120px",children:w.jsx(uh,{size:"lg",color:"white"})}):w.jsxs(w.Fragment,{children:[w.jsx(ht,{children:ie===0?w.jsxs(qr,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&fe==="image"&&w.jsxs(ht,{children:[w.jsx(it,{fontWeight:"semibold",mb:2,children:"Current Image:"}),w.jsxs(Bi,{children:[w.jsx(ht,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:w.jsx(yp,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),w.jsxs(qr,{align:"flex-start",spacing:2,children:[w.jsxs(it,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),w.jsxs(it,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),w.jsx($n,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:w.jsx(yn,{as:i0}),onClick:()=>X(!0),isDisabled:L,children:"Delete"})]})]}),w.jsx(h0,{my:4})]}),w.jsx(it,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&fe==="image"?"Replace with new image:":"Upload new image:"}),w.jsxs(ht,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:J?"rgba(255,255,255,0.3)":"rgba(255,255,255,0.15)",bg:J?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.03)",p:4,textAlign:"center",transition:"all 0.2s ease",_hover:{borderColor:"rgba(255,255,255,0.3)",bg:"rgba(255,255,255,0.06)"},cursor:"pointer",onClick:()=>y.current.click(),children:[k?w.jsx(ht,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:w.jsx(yp,{src:k,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):w.jsxs(qr,{spacing:2,children:[w.jsx(yn,{as:xO,boxSize:"20px",color:"gray.400"}),w.jsxs(qr,{spacing:0,children:[w.jsx(it,{fontSize:"xs",fontWeight:"500",color:"white",children:"Drop image or click to browse"}),w.jsx(it,{fontSize:"xs",color:"gray.500",children:"PNG, JPG, JPEG, GIF"})]})]}),w.jsx(Xi,{type:"file",accept:"image/*",onChange:je,ref:y,display:"none"})]}),R&&w.jsxs(it,{fontSize:"xs",color:"gray.400",bg:"rgba(255,255,255,0.05)",p:2,borderRadius:"md",border:"1px solid rgba(255,255,255,0.1)",children:[R.name," (",Math.round(R.size/1024)," KB)"]})]}):w.jsxs(qr,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&fe==="video"&&w.jsxs(ht,{children:[w.jsx(it,{fontWeight:"500",mb:1,fontSize:"xs",color:"gray.400",children:"Current Video URL:"}),w.jsxs(Bi,{children:[w.jsx(ht,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:w.jsx(it,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),w.jsxs(qr,{align:"flex-start",spacing:2,children:[w.jsxs(it,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),w.jsxs(it,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),w.jsx($n,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:w.jsx(yn,{as:i0}),onClick:()=>X(!0),isDisabled:L,children:"Delete"})]})]}),w.jsx(h0,{my:4})]}),w.jsxs(Kr,{children:[w.jsx(ss,{fontSize:"xs",fontWeight:"500",color:"white",mb:1.5,children:"Video URL"}),w.jsx(Xi,{placeholder:"https://youtube.com/watch?v=...",value:ve,onChange:rt=>Te(rt.target.value),bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},size:"sm",borderRadius:"lg",color:"white",fontSize:"xs",_placeholder:{color:"gray.500",fontSize:"xs"}})]}),ve&&w.jsxs(ht,{mt:2,p:2,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:[w.jsxs(jn,{mb:1,children:[w.jsx(yn,{as:BWe,color:"gray.400",size:"sm"}),w.jsx(it,{fontWeight:"500",fontSize:"xs",color:"white",children:"Preview"})]}),w.jsx(it,{fontSize:"xs",wordBreak:"break-all",color:"gray.400",children:ve})]})]})}),L&&w.jsxs(ht,{mt:3,children:[w.jsxs(it,{mb:2,fontSize:"sm",fontWeight:"500",color:"white",children:["Uploading: ",z,"%"]}),w.jsx(Uy,{value:z,colorScheme:"gray",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)"})]})]})})]})}),w.jsx(oh,{pt:2,pb:3,px:4,children:w.jsxs(Bi,{w:"full",gap:3,children:[w.jsx($n,{variant:"outline",flex:1,onClick:lt,isDisabled:L,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"500",children:"Cancel"}),w.jsx($n,{bg:"#6b7280",color:"white",flex:2,onClick:ot,isLoading:L,loadingText:"Saving",isDisabled:fe==="image"&&!R||fe==="video"&&!ve||L||ce,leftIcon:w.jsx(yn,{as:fe==="image"?Cy:DR,size:"sm"}),_hover:{bg:"#4b5563"},_active:{bg:"#374151"},_disabled:{bg:"#374151",opacity:.5},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"600",children:fe==="image"?"Upload":"Save URL"})]})})]})]}),w.jsx(pMe,{isOpen:ge,leastDestructiveRef:b,onClose:()=>X(!1),children:w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",children:w.jsxs(fMe,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"350px",children:[w.jsxs(To,{fontSize:"md",fontWeight:"600",pt:4,pb:2,color:"white",children:["Delete ",fe==="video"?"Video":"Image"]}),w.jsx(Is,{py:2,color:"gray.400",fontSize:"sm",children:"Are you sure? This will revert the media screen to its blank state."}),w.jsx(oh,{pt:3,pb:4,children:w.jsxs(Bi,{w:"full",gap:2,children:[w.jsx($n,{ref:b,onClick:()=>X(!1),variant:"outline",flex:1,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)"},borderRadius:"lg",size:"sm",fontSize:"sm",children:"Cancel"}),w.jsx($n,{bg:"#dc2626",color:"white",onClick:_t,flex:1,leftIcon:w.jsx(yn,{as:i0,size:"sm"}),_hover:{bg:"#b91c1c"},borderRadius:"lg",fontWeight:"600",size:"sm",fontSize:"sm",children:"Delete"})]})})]})})})]})},sGe=n=>{const[t,i]=N.useState(null),[a,l]=N.useState(""),[d,f]=N.useState(null),[y,v]=N.useState(!1),b=Lc(),{spaceID:R}=Ro(),I=N.useCallback(L=>{var j,z;try{if(!L)return null;if(L.includes("youtube.com")||L.includes("youtu.be")){let Y="";return L.includes("youtube.com/watch")?Y=new URLSearchParams(new URL(L).search).get("v"):L.includes("youtu.be/")&&(Y=L.split("youtu.be/")[1].split("?")[0]),Y?`https://www.youtube.com/embed/${Y}?autoplay=1`:L}if(L.includes("vimeo.com")){if(L.includes("player.vimeo.com/video"))return L;const Y=(z=(j=L.split("vimeo.com/")[1])==null?void 0:j.split("?")[0])==null?void 0:z.split("/")[0];return Y?`https://player.vimeo.com/video/${Y}?autoplay=1`:L}return L}catch(Y){return G.error("Error converting to embed URL:",Y),L}},[]),k=N.useCallback(()=>{setTimeout(()=>{v(!1),G.log("Video processing state reset")},100)},[]);N.useEffect(()=>{let L=!0,j=null;const Y=b("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:ne,videoUrl:ce}=K||{};if(!ne){G.error("Media screen ID is missing in Unity event data."),k();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ne}, setting ID but not playing video`),G.log("Edit mode is active, setting media screen ID but not playing video"),f(ne);return}if(v(!0),j=setTimeout(()=>{L&&(G.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ce){if(console.log(`Using direct video URL from event: ${ce}`),L)try{const oe=I(ce);console.log(`Setting video URL to: ${oe} (original: ${ce})`),i(oe),l(`Media Screen ${ne}`),f(ne),G.log("Media screen video URL set directly from event:",oe)}catch(oe){G.error("Error setting video URL from direct URL:",oe)}finally{k(),clearTimeout(j)}return}console.log(`Fetching media screen data for ID: ${ne}`);try{const oe=await Xy(R,ne);if(console.log("Media screen data from Firestore:",oe),!oe||!oe.videoUrl){G.error("No video URL found for media screen:",ne),k(),clearTimeout(j);return}if(!oe.displayAsVideo){G.log("Media screen is not set to display as video:",ne),console.log("displayAsVideo flag is false for this media screen"),k(),clearTimeout(j);return}if(L)try{const ge=I(oe.videoUrl);console.log(`Setting video URL to: ${ge} (original: ${oe.videoUrl})`);const X=oe.title||`Media Screen ${ne}`;i(ge),l(X),f(ne),G.log("Media screen video URL set to:",ge)}catch(ge){G.error("Error setting video URL from Firestore:",ge)}finally{k(),clearTimeout(j)}}catch(oe){G.error(`Error fetching media screen data for ${ne}:`,oe),k(),clearTimeout(j)}}catch(ne){G.error("Error handling media screen video play:",ne),console.error("Error handling media screen video play:",ne),k(),clearTimeout(j)}});return()=>{L=!1,j&&clearTimeout(j),Y()}},[b,R,n,I,k]);const M=N.useCallback(()=>{i(null),l(""),f(null),v(!1),G.log("Video player state reset")},[]);return[t,a,d,M,y]},oGe=()=>{const{spaceID:n}=Ro(),t=dc(),i=Lc(),[a,l]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){G.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{G.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=N.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await y(b):"https://via.placeholder.com/640x360?text=Video"}catch(R){return G.error(`Error fetching thumbnail for ${b}:`,R),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const R=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(R);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const k=await I.json(),M=k.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let j=null;for(let z of L){const Y=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${M}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Y,{method:"HEAD"})).ok){j=Y;break}}catch(K){G.warn(`Failed to validate thumbnail URL: ${Y}`,K)}}return j||k.thumbnail_url}catch(R){return G.error(`Error fetching Vimeo thumbnail: ${R.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async b=>{let R="";if(b.includes("youtube.com/watch")?R=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(R=b.split("youtu.be/")[1].split("?")[0]),!R)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${R}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(k){G.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${R}`,k)}return`https://img.youtube.com/vi/${R}/hqdefault.jpg`},v=N.useCallback(async b=>{try{if(!n||!b)return;G.log(`Refreshing thumbnail for media screen ${b}`);const R=await Xy(n,b);if(!R){G.log(`No media screen found with ID ${b}`);return}if(G.log("Media screen data:",R),!R.displayAsVideo||!R.videoUrl){G.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await d(R.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),G.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(R){G.error(`Error refreshing thumbnail for media screen ${b}:`,R)}},[n,d,t]);N.useEffect(()=>{if(!a){G.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}G.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const R=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:k,thumbnailUrl:M}=I;M==="refresh"&&k&&(console.log(`Received request to refresh thumbnail for media screen ${k}`),await v(k))}catch(k){console.error("Error handling SetMediaScreenThumbnail event:",k)}});return()=>{R()}},[i,v,a]),N.useEffect(()=>{if(!a){G.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}G.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");G.log("Fetching media screens for thumbnails...");const I=await p3(n);G.log("All media screens:",I);const k=I.filter(j=>j.displayAsVideo&&j.videoUrl);if(G.log("Media screens set to display as videos:",k),k.length===0){G.log("No media screens set to display as videos found.");return}G.log(`Found ${k.length} media screens set to display as videos.`);const M=k.map(async j=>{try{const z=await d(j.videoUrl);return G.log(`Fetched thumbnail for ${j.id}: ${z}`),{mediaScreenId:j.id,thumbnailUrl:z}}catch(z){return G.error(`Error processing thumbnail for media screen ${j.id}:`,z),{mediaScreenId:j.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),L=await Promise.all(M);G.log("Fetched Media Screen Thumbnails",L),L.forEach(({mediaScreenId:j,thumbnailUrl:z})=>{t("SetMediaScreenThumbnail",{mediaScreenId:j,thumbnailUrl:z}),G.log(`Sent thumbnail to Unity for media screen ${j}: ${z}`)})}catch(I){G.error("Error fetching media screen thumbnails:",I)}};b();const R=setInterval(b,5*60*1e3);return()=>{clearInterval(R)}},[t,n,d,a])},jQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},aGe=()=>w.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),cGe=({videoUrl:n,videoTitle:t,mediaScreenId:i,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=hh();return kN(a,`video-modal-${i}`),N.useEffect(()=>{if(a){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const y=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),y&&(y.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),w.jsxs(w.Fragment,{children:[w.jsx(aGe,{}),w.jsxs(Rs,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),w.jsxs(Cs,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[w.jsx(zs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),w.jsx(Is,{p:0,width:"100%",children:n?w.jsx(ht,{className:"iframe-container",style:jQ.iframeContainer,children:w.jsx("iframe",{className:"video-iframe",src:n,style:jQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):w.jsxs(Bi,{direction:"column",align:"center",justify:"center",h:"400px",children:[w.jsx(uh,{size:"xl",mb:4}),w.jsx(it,{children:"Unable to load video"}),w.jsx(it,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},lGe=5e3,uGe=n=>{if(!(n!=null&&n.includes("firebasestorage.googleapis.com")))return n;try{const t=new URL(n),i=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",i&&t.searchParams.set("alt",i),a&&t.searchParams.set("token",a),t.toString()}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},dGe=()=>{const{isOpen:n,onOpen:t,onClose:i}=sh(),[a,l]=N.useState(null),[d,f]=N.useState("image"),y=N.useRef(null);kN(n,"image-viewer-modal");const v=N.useCallback(I=>I.stopPropagation(),[]);return N.useEffect(()=>{if(!n||!y.current)return;const I=y.current,k=document.getElementById("unity-canvas"),M=["mousemove","mousedown","mouseup","wheel"];return M.forEach(L=>I.addEventListener(L,v)),k&&(k.style.pointerEvents="none"),()=>{M.forEach(L=>I.removeEventListener(L,v)),k&&(k.style.pointerEvents="auto")}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(I,k="image")=>{const M=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video"));l(I),f(M?"image":k),t()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:y,preventPropagation:v}},hGe=()=>w.jsx("style",{dangerouslySetInnerHTML:{__html:`
      body.unity-input-disabled #unity-container,
      body.unity-input-disabled #unity-canvas { pointer-events: none !important; }
      .image-viewer-modal-content,
      .chakra-modal__overlay { pointer-events: auto !important; }
    `}}),pGe=()=>{const[n,t]=N.useState([]),[i,a]=N.useState(!1),[l,d]=N.useState(null),[f,y]=N.useState(!1),v=N.useCallback((R,I)=>{t(k=>Array.isArray(k)&&k.some(L=>L.mediaScreenId===R)?k.map(L=>L.mediaScreenId===R?{...L,...I,lastUpdated:new Date().toISOString()}:L):[...Array.isArray(k)?k:[],{mediaScreenId:R,...I,firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},[]),b=N.useCallback(R=>Array.isArray(n)?n.find(I=>I.mediaScreenId===R):null,[n]);return{mediaScreens:n,setMediaScreens:t,isEditMode:i,setIsEditMode:a,selectedScreen:l,setSelectedScreen:d,unityReady:f,setUnityReady:y,updateMediaScreen:v,getScreenData:b}},fGe=()=>{const{spaceID:n}=Ro(),{isOpen:t,onOpen:i,onClose:a}=sh(),l=dc(),{fullscreenRef:d}=hh(),f=Lc(),{trackReactEvent:y}=oE(n),{setMediaScreens:v,isEditMode:b,setIsEditMode:R,selectedScreen:I,setSelectedScreen:k,unityReady:M,setUnityReady:L,updateMediaScreen:j,getScreenData:z}=pGe(),{isOpen:Y,currentImageUrl:K,currentMediaType:ne,openImageViewer:ce,closeImageViewer:oe,modalContentRef:ge,preventPropagation:X}=dGe(),[J,te,ie,he,fe]=sGe(b),{isOpen:de,onOpen:ve,onClose:Te}=sh();oGe(),Hoe(),N.useEffect(()=>{if(window.isPlayerInstantiated){L(!0);return}const De=()=>L(!0);return window.addEventListener("PlayerInstantiated",De),()=>window.removeEventListener("PlayerInstantiated",De)},[L]);const Fe=N.useCallback(async De=>{const Ee=z(De);if(Ee)return{screen:Ee,imageUrl:Ee.imageUrl,videoUrl:Ee.videoUrl,mediaType:Ee.mediaType||"image",displayAsVideo:Ee.displayAsVideo||!1};if(K)return{screen:{mediaScreenId:De},imageUrl:K,videoUrl:null,mediaType:"image",displayAsVideo:!1};if(n&&De)try{const Ne=await Xy(n,De);if(Ne)return j(De,{...Ne,hasImage:!!Ne.imageUrl,source:"firestore-fetch"}),{screen:Ne,imageUrl:Ne.imageUrl,videoUrl:Ne.videoUrl,mediaType:Ne.mediaType||"image",displayAsVideo:Ne.displayAsVideo||!1}}catch(Ne){console.error(`Error fetching media screen data for ${De}:`,Ne)}return null},[z,K,n,j]),be=N.useCallback(async De=>{if(k(De),b){i();return}if(de&&ie===De)return;const Ee=await Fe(De);if(Ee){if(Ee.displayAsVideo&&Ee.videoUrl)l("PlayMediaScreenVideo",{mediaScreenId:De,videoUrl:Ee.videoUrl});else if(Ee.imageUrl){const Ne=uGe(Ee.imageUrl);ce(Ne,Ee.mediaType||"image")}}},[b,i,de,ie,Fe,l,ce]);N.useEffect(()=>{if(!M||!n)return;const De=async()=>{try{const Ee=await p3(n),Ne={};Ee.forEach(je=>{je.id&&je.imageUrl&&(Ne[je.id]=je.imageUrl)}),v(je=>je.map(Ke=>({...Ke,hasImage:!!Ne[Ke.mediaScreenId],imageUrl:Ne[Ke.mediaScreenId],mediaType:Ke.mediaType||"image"})))}catch(Ee){console.error("Error fetching media screen images:",Ee)}};if(De(),b){const Ee=setInterval(De,lGe);return()=>clearInterval(Ee)}},[n,b,M,v]);const Ce=N.useCallback(De=>{const{mediaScreenId:Ee,type:Ne,imageUrl:je,mediaType:Ke}=De;Ne==="upload"?j(Ee,{hasImage:!0,imageUrl:je,mediaType:Ke||"image"}):Ne==="delete"&&setTimeout(()=>{v(ot=>ot.filter(_t=>_t.mediaScreenId!==Ee))},100)},[j,v]);N.useEffect(()=>{const De=Ee=>{const Ne=Ee.detail.enabled;R(Ne),l("SetMediaScreenEditMode",{enabled:Ne,showUploadIcon:Ne})};return window.addEventListener("editModeChanged",De),()=>window.removeEventListener("editModeChanged",De)},[l,R]),N.useEffect(()=>(window.JsSendMediaScreenClick=De=>{try{const Ee=JSON.parse(De);window.dispatchEvent(new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ee)}))}catch(Ee){console.error("Error processing MediaScreenClick data:",Ee)}},window.handleMediaScreenClick=De=>{be(De)},window.TestJavaScriptFromUnity=De=>{console.log("Unity called JavaScript:",De)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[be]),N.useEffect(()=>{const De=Ke=>{try{const ot=JSON.parse(Ke.detail);j(ot.mediaScreenId,{...ot,source:"event"}),b&&l("SetMediaScreenEditMode",{mediaScreenId:ot.mediaScreenId,enabled:!0,showUploadIcon:!0}),n&&ot.mediaScreenId&&Xy(n,ot.mediaScreenId).then(_t=>{_t!=null&&_t.displayAsVideo&&(_t!=null&&_t.videoUrl)&&l("SetMediaScreenImage",{mediaScreenId:ot.mediaScreenId,imageUrl:null,displayAsVideo:!0})}).catch(_t=>console.error("Error fetching media screen data:",_t))}catch(ot){console.error("Error handling MediaScreen registration:",ot)}},Ee=Ke=>{try{let ot;typeof Ke=="string"?ot=Ke:ot=JSON.parse(Ke.detail).mediaScreenId,be(ot)}catch(ot){console.error("Error handling MediaScreen click:",ot)}},je=[["RegisterMediaScreen",De],["MediaScreenClick",Ee],["reactUnityEvent",Ke=>{const{eventName:ot,eventData:_t}=Ke.detail||{};switch(ot){case"RegisterMediaScreen":De({detail:_t});break;case"MediaScreenClick":Ee({detail:_t});break;case"SetMediaScreenImage":try{const lt=JSON.parse(_t);lt.mediaScreenId&&j(lt.mediaScreenId,{imageUrl:lt.imageUrl,hasImage:!!lt.imageUrl,displayAsVideo:lt.displayAsVideo||!1,source:"set-media-screen-image"})}catch(lt){console.error("Error handling SetMediaScreenImage event:",lt)}break}}]];return je.forEach(([Ke,ot])=>window.addEventListener(Ke,ot)),()=>{je.forEach(([Ke,ot])=>window.removeEventListener(Ke,ot))}},[b,l,n,j,be]),N.useEffect(()=>{J&&(ve(),y(ao.REACT.VIDEO_CLICK,{mediaScreenId:ie,videoUrl:J,videoTitle:te,source:"media_screen_controller",trigger:"video_modal_open"}))},[J,ve,y,ie,te]);const Ae=N.useCallback(()=>{he(),Te()},[he,Te]);return N.useEffect(()=>{const Ee=f("RegisterMediaScreen",je=>{je!=null&&je.mediaScreenId&&(j(je.mediaScreenId,{...je,source:"direct-event"}),b&&l("SetMediaScreenEditMode",{mediaScreenId:je.mediaScreenId,enabled:!0,showUploadIcon:!0}))}),Ne=f("MediaScreenClick",je=>{je!=null&&je.mediaScreenId&&be(je.mediaScreenId)});return()=>{Ee(),Ne()}},[f,b,l,j,be]),N.useEffect(()=>{b&&ie&&(k(ie),i(),he())},[b,ie,i,he,k]),w.jsxs(w.Fragment,{children:[w.jsx(iGe,{isOpen:t,onClose:a,mediaScreenId:I,onImageChange:Ce}),w.jsx(hGe,{}),w.jsx(El,{containerRef:d,children:w.jsxs(Rs,{isOpen:Y,onClose:oe,size:"lg",isCentered:!0,portalProps:{containerRef:d},id:"image-viewer-modal",blockScrollOnMount:!0,children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X}),w.jsxs(Cs,{ref:ge,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:[w.jsx(zs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),w.jsx(Is,{p:0,width:"100%",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:K?w.jsx(ht,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:ne==="image"?w.jsx(yp,{src:K,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",K),onError:De=>console.error("Error loading image:",De,K),onClick:X}):w.jsxs(ht,{width:"100%",textAlign:"center",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:[w.jsx(it,{mb:4,fontSize:"lg",children:"Video URL:"}),w.jsx(it,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:K}),w.jsx(it,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):w.jsx(Bi,{direction:"column",align:"center",justify:"center",h:"400px",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:w.jsx(it,{children:"No image available"})})})]})]})}),w.jsx(cGe,{videoUrl:J,videoTitle:te,mediaScreenId:ie,isOpen:de,onClose:Ae})]})},pae=({backgroundUrl:n=null,videoBackgroundUrl:t=null,containerRef:i})=>{const[a,l]=N.useState(!1),[d,f]=N.useState(n),[y,v]=N.useState(t),b=N.useRef(null),R=N.useRef(null),I=N.useRef(null),k=N.useRef(!1),M=N.useRef(!1);N.useEffect(()=>{if(!(k.current||M.current)){if(M.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${t}, imageUrl: ${n}`),t){console.log(` PersistentBackground: Using provided video URL: ${t}`),j(t),k.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),z(n),k.current=!0;return}L()}},[n,t]),N.useEffect(()=>{const ne=ce=>{const{videoBackgroundUrl:oe}=ce.detail;console.log(` PersistentBackground: Received video background update event: ${oe}`),oe&&!k.current&&(j(oe),k.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",ne),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",ne)}},[]);const L=()=>{const ce=window.location.pathname.match(/\/space\/([^\/]+)/);if(!ce||!ce[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const oe=ce[1];console.log(` PersistentBackground: Found space ID: ${oe}`),Ma(oe).then(ge=>{if(console.log(` PersistentBackground: Retrieved space data for ${oe}:`,ge?"success":"null"),ge&&ge.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${ge.videoBackgroundUrl}`),j(ge.videoBackgroundUrl),k.current=!0;else if(ge&&(ge.backgroundUrl||ge.backgroundGsUrl)){const X=ge.backgroundUrl||ge.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${X}`),z(X),k.current=!0}}).catch(ge=>{console.error(" PersistentBackground: Error fetching space data:",ge)})},j=ne=>{if(!i||!i.current)return;console.log(` PersistentBackground: Setting up video background: ${ne}`),K();const ce=document.createElement("video");I.current=ce,ce.autoplay=!0,ce.loop=!0,ce.muted=!0,ce.playsInline=!0,ce.setAttribute("playsinline",""),ce.setAttribute("webkit-playsinline",""),ce.setAttribute("preload","auto"),ce.src=ne,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ce),Y(),ce.load();try{ce.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(oe=>{console.warn(" First video play attempt failed:",oe);const ge=()=>{ce.play().then(()=>console.log(" Video started after user interaction")).catch(X=>console.error(" Video still failed to play:",X))};window.addEventListener("click",ge,{once:!0}),window.addEventListener("touchstart",ge,{once:!0}),setTimeout(()=>{ce.play().then(()=>console.log(" Video started after timeout")).catch(X=>console.error(" Video still failed to play after timeout:",X))},1e3)})}catch(oe){console.error(" Error attempting to play video:",oe)}},z=ne=>{if(!i||!i.current||!ne)return;console.log(` PersistentBackground: Setting up image background: ${ne}`);const ce=document.createElement("div");b.current=ce,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${ne}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ce),Y()},Y=()=>{if(!i||!i.current)return;const ne=document.createElement("div");R.current=ne,Object.assign(ne.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ne)},K=()=>{!i||!i.current||(b.current&&i.current.contains(b.current)&&(i.current.removeChild(b.current),b.current=null),I.current&&i.current.contains(I.current)&&(I.current.pause(),I.current.src="",I.current.load(),i.current.removeChild(I.current),I.current=null),R.current&&i.current.contains(R.current)&&(i.current.removeChild(R.current),R.current=null))};return N.useEffect(()=>{if(!i||!i.current)return;const ne=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),b.current&&(b.current.style.opacity="0"),I.current&&(I.current.style.opacity="0"),R.current&&(R.current.style.opacity="0"),setTimeout(()=>{K()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),ne();return}rh.subscribe(nh.playerInstantiated,ne),window.addEventListener("PlayerInstantiated",ne);const ce=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),ne()},3e4);return()=>{rh.unsubscribe(nh.playerInstantiated,ne),window.removeEventListener("PlayerInstantiated",ne),clearTimeout(ce),K()}},[i]),null};pae.propTypes={backgroundUrl:Pn.string,videoBackgroundUrl:Pn.string,containerRef:Pn.shape({current:Pn.instanceOf(Element)})};const BQ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",fae=({containerRef:n})=>{const{spaceID:t}=Ro(),{isUserBannedFromSpace:i}=N.useContext(Hs),[a,l]=N.useState(!1),[d,f]=N.useState(!1),[y,v]=N.useState(!1),[b,R]=N.useState(0),[I,k]=N.useState("Initialising World"),[M,L]=N.useState(null),j=N.useRef(null),z=N.useRef(null),Y=N.useRef(null),K=N.useRef(null),ne=N.useRef(null),ce=N.useRef(null);N.useEffect(()=>(G.log("PersistentLoader: Component mounted with spaceID:",t),G.log("PersistentLoader: Container ref:",n),()=>{G.log("PersistentLoader: Component unmounting")}),[]);const{error:oe}=Ro(),[ge,X]=N.useState(!1);return N.useEffect(()=>{oe&&(G.error("PersistentLoader: Unity error detected:",oe),X(!0),setTimeout(()=>{if(j.current){const J=j.current.querySelector("div:first-child");J&&(J.textContent="Reconnecting...")}},3e3))},[oe]),N.useEffect(()=>{(async()=>{if(t){G.log(`PersistentLoader: Fetching logo for space ${t}`);try{const te=await Ma(t);te&&te.logoUrl?(G.log(`PersistentLoader: Found logo URL: ${te.logoUrl}`),L(te.logoUrl)):G.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(te){G.error("PersistentLoader: Error fetching space logo:",te)}}else G.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),N.useEffect(()=>{const J=te=>{const{logoUrl:ie}=te.detail;G.log(`PersistentLoader: Logo update event received with URL: ${ie}`),L(ie),z.current?ie?(G.log("PersistentLoader: Updating logo element with new URL"),z.current.src=ie,Y.current.style.display="flex"):(G.log("PersistentLoader: Hiding logo element (no URL)"),Y.current.style.display="none"):G.warn("PersistentLoader: Logo ref is null during update")};return G.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",J),()=>{G.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",J)}},[]),N.useEffect(()=>{(async()=>{if(t&&i)try{await i(t)&&(G.warn(`PersistentLoader: user banned from space ${t}`),l(!0))}catch(te){G.error("PersistentLoader: error checking ban status",te)}})()},[t,i]),N.useEffect(()=>{if(!n||!n.current){G.error("PersistentLoader: Container ref missing");return}if(a){const De=document.createElement("div");return Object.assign(De.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"red",background:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"8px",zIndex:"100",fontSize:"18px",fontWeight:"bold",textAlign:"center"}),De.textContent="Access Denied: You have been banned from this space.",n.current.appendChild(De),()=>{n.current.removeChild(De)}}G.log("PersistentLoader: Creating loader elements");const J=document.createElement("div");if(j.current=J,Object.assign(J.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),M){G.log(`PersistentLoader: Creating logo element with URL: ${M}`);const De=document.createElement("div");Y.current=De,Object.assign(De.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const Ee=document.createElement("img");z.current=Ee,Ee.src=M,Ee.alt="Space Logo",Ee.style.maxHeight="100px",Ee.style.maxWidth="100%",Ee.style.objectFit="contain",Ee.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",De.appendChild(Ee),n.current.appendChild(De),G.log("PersistentLoader: Logo container added to main container")}else G.log("PersistentLoader: No logo URL available, skipping logo creation");const te=document.createElement("style");te.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(te),G.log("PersistentLoader: Animation styles added to document head");const ie=document.createElement("div");ie.style.fontSize="16px",ie.style.fontWeight="bold",ie.style.textAlign="center",ie.style.marginBottom="16px",ie.style.color="#ffffff",ie.textContent="Initialising World";const he=document.createElement("div");he.style.width="240px",he.style.height="100px",he.style.position="relative",he.style.marginBottom="15px",he.style.padding="0px",he.style.overflow="hidden",he.style.boxSizing="border-box",he.style.transition="opacity 0.8s ease-in-out",he.style.opacity="0";const fe=document.createElement("div");fe.style.width="100%",fe.style.height="100%",fe.style.position="absolute",fe.style.top="0",fe.style.left="0",fe.style.maskImage=`url(${BQ})`,fe.style.maskSize="contain",fe.style.maskPosition="center",fe.style.maskRepeat="no-repeat",fe.style.webkitMaskImage=`url(${BQ})`,fe.style.webkitMaskSize="contain",fe.style.webkitMaskPosition="center",fe.style.webkitMaskRepeat="no-repeat",fe.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",fe.style.backgroundSize="100% 100%",fe.style.transition="background 0.5s ease-out",K.current=fe,ne.current=null,he.appendChild(fe);const de=document.createElement("div");de.style.marginTop="8px",de.style.fontSize="14px",de.style.fontWeight="bold",de.style.color="#ffffff",de.textContent="0%",J.appendChild(ie),J.appendChild(he),J.appendChild(de),n.current.appendChild(J),G.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{Y.current&&(Y.current.style.opacity="1"),J.style.opacity="1",he.style.opacity="1"},500);const ve=De=>{R(De);const Ee=Math.round(De*100),Ne=`linear-gradient(to right, #4facfe 0%, #00f2fe ${Ee}%, white ${Ee}%, white 100%)`;fe.style.background=Ne,de.textContent=`${Ee}%`,G.log(`PersistentLoader: Progress updated to ${Ee}%`)},Te=De=>{k(De),ie.textContent=De,G.log(`PersistentLoader: Loading stage updated to "${De}"`)},Fe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];ge&&(Fe[0].stage="Connecting to Space",Fe[1].stage="Reconnecting...",Fe[2].stage="Please Wait"),Te(Fe[0].stage),ve(.25);const be=De=>{const Ee=De.detail.progress;G.log(`PersistentLoader: Progress event received with value: ${Ee}`),ve(Ee),Ee<.33?Te(Fe[0].stage):Ee<.66?Te(Fe[1].stage):Te(Fe[2].stage)},Ce=()=>{G.log("PersistentLoader: First scene loaded event received"),f(!0),Te(Fe[1].stage),ve(.66)},Ae=()=>{if(G.log("PersistentLoader: Player instantiated event received"),ce.current&&(clearInterval(ce.current),G.log("PersistentLoader: Progress interval cleared")),v(!0),Te(Fe[2].stage),ve(1),ge){G.log("PersistentLoader: Keeping loader visible due to Unity error");return}J.style.transition="all 0.5s ease-in-out",he.style.transition="opacity 1.2s ease-in-out",ie.style.transition="opacity 0.4s ease-in-out",de.style.transition="opacity 0.4s ease-in-out",Y.current&&(Y.current.style.transition="opacity 0.5s ease-in-out"),J.style.backgroundColor="rgba(0, 0, 0, 0)",J.style.backdropFilter="blur(0px)",J.style.WebkitBackdropFilter="blur(0px)",J.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",J.style.border="1px solid rgba(255, 255, 255, 0)",ie.style.opacity="0",de.style.opacity="0",Y.current&&(Y.current.style.opacity="0"),setTimeout(()=>{he.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(J)?(n.current.removeChild(J),G.log("PersistentLoader: Loader element removed after fade")):G.warn("PersistentLoader: Could not remove loader element (not found in container)"),Y.current&&n.current&&n.current.contains(Y.current)?(n.current.removeChild(Y.current),G.log("PersistentLoader: Logo container removed after fade")):Y.current&&G.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)G.log("PersistentLoader: Player was already instantiated"),Ae();else{G.log("PersistentLoader: Subscribing to playerInstantiated event"),rh.subscribe(nh.playerInstantiated,Ae);const De=()=>Ae();G.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",De),G.log("PersistentLoader: Adding firstSceneLoaded event listener"),rh.subscribe(nh.firstSceneLoaded,Ce),G.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",be),ce.current=setInterval(()=>{y||R(Ne=>{const je=Math.min(Ne+.02,.95);return ve(je),je<.33&&I!==Fe[0].stage?Te(Fe[0].stage):je>=.33&&je<.66&&I!==Fe[1].stage?Te(Fe[1].stage):je>=.66&&I!==Fe[2].stage&&Te(Fe[2].stage),je})},300);const Ee=setTimeout(()=>{G.log("PersistentLoader: Forcing loader removal after timeout"),Ae()},6e4);return()=>{G.log("PersistentLoader: Cleaning up event listeners"),rh.unsubscribe(nh.playerInstantiated,Ae),window.removeEventListener("PlayerInstantiated",De),rh.unsubscribe(nh.firstSceneLoaded,Ce),window.removeEventListener("UnityProgress",be),clearInterval(ce.current),clearTimeout(Ee),n.current&&n.current.contains(J)&&(n.current.removeChild(J),G.log("PersistentLoader: Loader element removed during cleanup")),Y.current&&n.current&&n.current.contains(Y.current)&&(n.current.removeChild(Y.current),G.log("PersistentLoader: Logo container removed during cleanup"))}}},[M,n]),null};fae.propTypes={containerRef:Pn.shape({current:Pn.instanceOf(Element)})};const O0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,f3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],t=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),y=document.activeElement===d;!l&&(f||y)&&a.preventDefault()}},i=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",t),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",t),document.removeEventListener("click",i)}},mae=()=>{document.body.classList.remove("unity-focused")};function wk(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?f3():mae(),new Promise(t=>{try{const i=O0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),t(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),t(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),t(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),EF(n)),t(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),t(!1)}})}function EF(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const t=20;let i=0;const a=()=>{i++;const l=O0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(i<t){const d=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${t}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${t} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function mGe(){const n=O0();if(!n)return!1;const t=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(t&&document.activeElement===t||n.Module&&n.Module.WebGLInputHandler)}function lR(n=!0){return console.log("Focusing Unity canvas"),n?f3():mae(),new Promise(t=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){wk(!0).then(t);return}t(!0)}else console.warn("Unity canvas not found"),t(!1)}catch(i){console.error("Error focusing Unity canvas:",i),t(!1)}})}function J1(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),f3(),new Promise(t=>{try{if(n)wk(!1).then(i=>{var d;i&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=O0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),t(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=O0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),wk(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),t(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),t(!1)}})}function gGe(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const t=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${t}`);try{t?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${t} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",t),console.log(`Applied pending keyboard state: ${t} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(t){console.error("Error applying pending keyboard state:",t)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function _Ge(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=wk,window.focusUnity=lR,window.blockUnityKeyboardInput=J1,window.hasUnityKeyboardFocus=mGe,window.getUnityInstance=O0,window.registerUnityInstance=gGe,document.getElementById("webgl-root")){const n=new MutationObserver(t=>{for(const i of t)if(i.addedNodes.length)for(let a=0;a<i.addedNodes.length;a++){const l=i.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),EF(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),EF(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,a]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),J1(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),J1(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),J1(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(_Ge,0);const yGe=({size:n="md",tooltipPlacement:t="top",className:i="livestream-button"})=>{const[a,l]=N.useState(!1),[d,f]=N.useState(!1),{savedStreamData:y,reloadStreamData:v}=Goe(),{spaceID:b}=Ro(),{user:R}=N.useContext(Hs),I=uc(),[k,M]=N.useState(!1),L=xK((y==null?void 0:y.rtmpUrl)||""),j=xK((y==null?void 0:y.streamKey)||"");N.useEffect(()=>{if(b){G.log("LiveStreamButton: Forcing reload of stream data"),v();const K=()=>{G.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",K),()=>{window.removeEventListener("StreamSettingsChanged",K)}}},[b,v]),N.useEffect(()=>{(async()=>{if(!(R!=null&&R.uid)||!b){M(!1);return}try{const ne=await n6e(R.uid,"disruptiveAdmin"),ce=await o6e(R,b);M(ne||ce)}catch(ne){G.error("Error checking user permissions:",ne),M(!1)}})()},[R==null?void 0:R.uid,b]),N.useEffect(()=>{G.log("LiveStreamButton: Current streaming data:",{enabled:y==null?void 0:y.enabled,hasRtmpUrl:!!(y!=null&&y.rtmpUrl),hasStreamKey:!!(y!=null&&y.streamKey),hasPermission:k,isPlayerReady:d})},[y,k,d]),N.useEffect(()=>{const K=()=>{G.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(G.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const z=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},Y=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!d||!k||(y==null?void 0:y.enabled)!==!0?(G.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!d,noPermission:!k,streamingDisabled:(y==null?void 0:y.enabled)!==!0,enabledValue:y==null?void 0:y.enabled}),null):w.jsxs(w.Fragment,{children:[w.jsx(Nf,{label:"Live Stream Info",placement:t,hasArrow:!0,children:w.jsx(ih,{size:n,borderRadius:"full",bg:"black",icon:w.jsx(gWe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:z})}),w.jsxs(Rs,{isOpen:a,onClose:Y,isCentered:!0,size:"md",children:[w.jsx(As,{backdropFilter:"blur(4px)"}),w.jsxs(Cs,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[w.jsx(To,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),w.jsx(zs,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),w.jsx(Is,{p:4,children:y!=null&&y.rtmpUrl&&(y!=null&&y.streamKey)?w.jsxs(ht,{children:[w.jsx(it,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),w.jsxs(ht,{mb:4,children:[w.jsx(it,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),w.jsx(Bi,{children:w.jsxs(Ly,{size:"sm",children:[w.jsx(Xi,{value:y.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),w.jsx(qO,{children:w.jsx(kc,{"aria-label":"Copy RTMP URL",icon:L.hasCopied?w.jsx(OQ,{}):w.jsx(kQ,{}),size:"xs",colorScheme:L.hasCopied?"green":"blue",onClick:()=>{L.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),w.jsxs(ht,{mb:4,children:[w.jsx(it,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),w.jsx(Bi,{children:w.jsxs(Ly,{size:"sm",children:[w.jsx(Xi,{value:y.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),w.jsx(qO,{children:w.jsx(kc,{"aria-label":"Copy Stream Key",icon:j.hasCopied?w.jsx(OQ,{}):w.jsx(kQ,{}),size:"xs",colorScheme:j.hasCopied?"green":"blue",onClick:()=>{j.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),w.jsx(it,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):w.jsxs(ht,{textAlign:"center",p:4,children:[w.jsx(it,{color:"white",children:"No stream configuration found for this space."}),w.jsx(it,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})};function EGe(n,t,i){const a=N.useRef();N.useEffect(()=>(a.current&&clearTimeout(a.current),a.current=setTimeout(n,t),()=>clearTimeout(a.current)),i)}const vGe=({isOpen:n,onClose:t,portal:i,spaceId:a,style:l})=>{if(!n||!i)return null;const[d,f]=N.useState({x:0,y:1.5,z:0}),[y,v]=N.useState({x:0,y:0,z:0}),[b,R]=N.useState({x:1,y:1,z:1}),I=dc(),k=uc();N.useEffect(()=>{i&&(f(i.position||{x:0,y:1.5,z:0}),v(i.rotation||{x:0,y:0,z:0}),R(i.scale||{x:1,y:1,z:1}))},[i]),N.useEffect(()=>{I("UpdatePortalTransform",{portalId:i.portalId,position:d,rotation:y,scale:b})},[d,y,b,i.portalId,I]),EGe(()=>{const L={...i,position:d,rotation:y,scale:b};VQ(a,i.portalId,L)},300,[d,y,b,a,i.portalId]);const M=async()=>{try{if(I("DeletePortal",{portalId:i.portalId}),await VQ(a,i.portalId,null))k({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),t();else throw new Error("Failed to delete portal from Firebase")}catch{k({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return w.jsxs(ht,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[w.jsx(ht,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsxs(Kr,{children:[w.jsx(ss,{children:"Position"}),w.jsxs(jn,{children:[w.jsxs(Vo,{value:d.x,onChange:(L,j)=>f(z=>({...z,x:j})),step:.1,precision:2,children:[w.jsx(jo,{placeholder:"X"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:d.y,onChange:(L,j)=>f(z=>({...z,y:j})),step:.1,precision:2,children:[w.jsx(jo,{placeholder:"Y"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:d.z,onChange:(L,j)=>f(z=>({...z,z:j})),step:.1,precision:2,children:[w.jsx(jo,{placeholder:"Z"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]})]})]}),w.jsxs(Kr,{children:[w.jsx(ss,{children:"Rotation"}),w.jsxs(jn,{children:[w.jsxs(Vo,{value:y.x,onChange:(L,j)=>v(z=>({...z,x:j})),step:1,children:[w.jsx(jo,{placeholder:"X"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:y.y,onChange:(L,j)=>v(z=>({...z,y:j})),step:1,children:[w.jsx(jo,{placeholder:"Y"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:y.z,onChange:(L,j)=>v(z=>({...z,z:j})),step:1,children:[w.jsx(jo,{placeholder:"Z"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]})]})]}),w.jsxs(Kr,{children:[w.jsx(ss,{children:"Scale"}),w.jsxs(jn,{children:[w.jsxs(Vo,{value:b.x,onChange:(L,j)=>R(z=>({...z,x:j})),step:.1,precision:2,min:.1,children:[w.jsx(jo,{placeholder:"X"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:b.y,onChange:(L,j)=>R(z=>({...z,y:j})),step:.1,precision:2,min:.1,children:[w.jsx(jo,{placeholder:"Y"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:b.z,onChange:(L,j)=>R(z=>({...z,z:j})),step:.1,precision:2,min:.1,children:[w.jsx(jo,{placeholder:"Z"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]})]})]}),w.jsx(jn,{spacing:4,width:"100%",justify:"flex-end",children:w.jsx($n,{colorScheme:"red",onClick:M,variant:"outline",children:"Delete Portal"})}),w.jsx($n,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:t,children:"Close"})]})]})},SGe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),i=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",i&&t.searchParams.set("alt",i),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},bGe=()=>{const{spaceID:n}=Ro(),t=dc(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){G.log("useUnityPortalImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{G.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){G.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}G.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=nu(ir,"spaces",n,"portals"),f=await Zu(d);if(f.empty){G.log("useUnityPortalImages: No portals found for space:",n);return}G.log(`useUnityPortalImages: Found ${f.size} portals for space ${n}`);for(const y of f.docs){const v=y.data(),b=v.portalId,R=v.targetSpaceId;if(!R){G.warn(`useUnityPortalImages: No target space ID found for portal: ${b}`);continue}const I=await Ma(R);if(!I){G.warn(`useUnityPortalImages: No space data found for target space: ${R}`);continue}const k=I.backgroundUrl||I.backgroundGsUrl;if(!k){G.warn(`useUnityPortalImages: No background image URL found for target space: ${R}`);continue}const M=SGe(k);t("SetPortalImage",JSON.stringify({portalId:b,imageUrl:M})),G.log(`Sent portal image data to Unity for portal ${b}: ${M}`)}}catch(d){G.error("Error fetching portal images:",d)}})()},[t,n,i])},wGe=()=>(bGe(),null);function TGe(n,t,i){const a=N.useRef();N.useEffect(()=>(a.current&&clearTimeout(a.current),a.current=setTimeout(n,t),()=>clearTimeout(a.current)),i)}const RGe=({isOpen:n,onClose:t,item:i,spaceId:a,style:l})=>{if(!n||!i)return null;const[d,f]=N.useState({x:0,y:0,z:0}),[y,v]=N.useState({x:0,y:0,z:0}),[b,R]=N.useState({x:1,y:1,z:1}),I=dc(),k=uc();N.useEffect(()=>{i&&(f(i.position||{x:0,y:0,z:0}),v(i.rotation||{x:0,y:0,z:0}),R(i.scale||{x:1,y:1,z:1}))},[i]),N.useEffect(()=>{I("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:d,rotation:y,scale:b})},[d,y,b,i.hotspotId,I]),TGe(()=>{const L=Ir(ir,"spaces",a,"catalogue",i.hotspotId);$o(L,{position:d,rotation:y,scale:b,updatedAt:Date.now()})},300,[d,y,b,a,i.hotspotId]);const M=async()=>{try{I("DeleteCatalogueItem",{hotspotId:i.hotspotId});const L=Ir(ir,"spaces",a,"catalogue",i.hotspotId);await $o(L,{deleted:!0}),k({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),t()}catch{k({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return w.jsxs(ht,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[w.jsx(ht,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),w.jsxs(qr,{spacing:4,align:"stretch",children:[w.jsxs(Kr,{children:[w.jsx(ss,{children:"Position"}),w.jsxs(jn,{children:[w.jsxs(Vo,{value:d.x,onChange:(L,j)=>f(z=>({...z,x:j})),step:.1,precision:2,children:[w.jsx(jo,{placeholder:"X"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:d.y,onChange:(L,j)=>f(z=>({...z,y:j})),step:.1,precision:2,children:[w.jsx(jo,{placeholder:"Y"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:d.z,onChange:(L,j)=>f(z=>({...z,z:j})),step:.1,precision:2,children:[w.jsx(jo,{placeholder:"Z"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]})]})]}),w.jsxs(Kr,{children:[w.jsx(ss,{children:"Rotation"}),w.jsxs(jn,{children:[w.jsxs(Vo,{value:y.x,onChange:(L,j)=>v(z=>({...z,x:j})),step:1,children:[w.jsx(jo,{placeholder:"X"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:y.y,onChange:(L,j)=>v(z=>({...z,y:j})),step:1,children:[w.jsx(jo,{placeholder:"Y"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:y.z,onChange:(L,j)=>v(z=>({...z,z:j})),step:1,children:[w.jsx(jo,{placeholder:"Z"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]})]})]}),w.jsxs(Kr,{children:[w.jsx(ss,{children:"Scale"}),w.jsxs(jn,{children:[w.jsxs(Vo,{value:b.x,onChange:(L,j)=>R(z=>({...z,x:j})),step:.1,precision:2,min:.1,children:[w.jsx(jo,{placeholder:"X"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:b.y,onChange:(L,j)=>R(z=>({...z,y:j})),step:.1,precision:2,min:.1,children:[w.jsx(jo,{placeholder:"Y"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]}),w.jsxs(Vo,{value:b.z,onChange:(L,j)=>R(z=>({...z,z:j})),step:.1,precision:2,min:.1,children:[w.jsx(jo,{placeholder:"Z"}),w.jsxs(Fo,{children:[w.jsx(zo,{}),w.jsx(Bo,{})]})]})]})]}),w.jsx(jn,{spacing:4,width:"100%",justify:"flex-end",children:w.jsx($n,{colorScheme:"red",onClick:M,variant:"outline",children:"Delete Item"})}),w.jsx($n,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:t,children:"Close"})]})]})};function CGe(){const{clickedItem:n,clearClickedItem:t}=Xoe(),[i,a]=N.useState(!1);N.useEffect(()=>{const f=y=>{y!=null&&y.detail&&typeof y.detail.enabled=="boolean"&&(a(y.detail.enabled),y.detail.enabled||t())};return window.addEventListener("editModeChanged",f),()=>window.removeEventListener("editModeChanged",f)},[t]);const l=()=>{t()};let d="";if(n!=null&&n.hotspotId){const f=n.hotspotId.split("_");f.length>=3&&(d=f.slice(1,-1).join("_"))}return w.jsx(w.Fragment,{children:n&&i&&w.jsx(RGe,{isOpen:!!n&&i,onClose:l,item:n,spaceId:d})})}const IGe=(n,t={})=>{const{user:i}=N.useContext(Hs),{trackUnityEvent:a,isReady:l}=oE(n,{enableDebugLogs:t.enableDebugLogs||!1}),d=Lc();return N.useEffect(()=>{if(!l||!i)return;G.log(" Unity Analytics: Setting up event listeners");const f=d("PlayVideo",L=>{G.log(" Unity Analytics: Video play event detected",L),a(ao.UNITY.VIDEO_PLAY,{category:co.MEDIA_INTERACTION,videoId:L==null?void 0:L.gameObjectName,videoUrl:L==null?void 0:L.videoUrl,isEditMode:(L==null?void 0:L.isEditMode)||!1,timestamp:new Date().toISOString(),...L})}),y=d("PlayMediaScreenVideo",L=>{G.log(" Unity Analytics: Media screen click event detected",L),a(ao.UNITY.MEDIA_SCREEN_CLICK,{category:co.MEDIA_INTERACTION,mediaScreenId:L==null?void 0:L.mediaScreenId,videoUrl:L==null?void 0:L.videoUrl,isEditMode:(L==null?void 0:L.isEditMode)||!1,timestamp:new Date().toISOString(),...L})}),v=d("OpenNameplateModal",L=>{G.log(" Unity Analytics: Nameplate click event detected",L),a(ao.UNITY.NAMEPLATE_CLICK,{category:co.SOCIAL_INTERACTION,targetUserId:L==null?void 0:L.uid,targetPlayerName:L==null?void 0:L.playerName,targetPlayerId:L==null?void 0:L.playerId,isLocalPlayer:(L==null?void 0:L.isLocalPlayer)||!1,timestamp:new Date().toISOString(),...L})}),b=d("PlayerInstantiated",L=>{G.log(" Unity Analytics: Player spawn event detected",L),a(ao.UNITY.PLAYER_SPAWN,{category:co.SYSTEM_EVENT,timestamp:new Date().toISOString(),...L})}),R=d("FirstSceneLoaded",L=>{G.log(" Unity Analytics: First scene loaded event detected",L),a(ao.UNITY.SPACE_READY,{category:co.SYSTEM_EVENT,timestamp:new Date().toISOString(),...L})}),I=d("SeatingHotspotClicked",L=>{G.log(" Unity Analytics: Catalogue item click event detected",L),a(ao.UNITY.OBJECT_INTERACT,{category:co.CONTENT_INTERACTION,objectType:"catalogue_item",hotspotId:L==null?void 0:L.hotspotId,itemId:L==null?void 0:L.itemId,position:L==null?void 0:L.position,timestamp:new Date().toISOString(),...L})}),k=d("UpdatePlayerList",L=>{L!=null&&L.players&&Array.isArray(L.players)&&(G.log(" Unity Analytics: Player list update event detected",L),a(ao.UNITY.PLAYER_MOVE,{category:co.SOCIAL_INTERACTION,activePlayerCount:L.players.length,playerList:L.players.map(j=>({playerId:j.playerId,playerName:j.playerName,isLocalPlayer:j.isLocalPlayer})),timestamp:new Date().toISOString()}))}),M=d("RequestUserForUnity",L=>{G.log(" Unity Analytics: Unity user request event detected",L),a(ao.UNITY.SPACE_LOAD,{category:co.SYSTEM_EVENT,requestType:"user_data",timestamp:new Date().toISOString(),...L})});return()=>{G.log(" Unity Analytics: Cleaning up event listeners"),f(),y(),v(),b(),R(),I(),k(),M()}},[l,i,a,d]),{isReady:l,trackUnityEvent:a}},AGe="9442a472625f44e7b2c5065b9f9b3988",UU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),m3=N.forwardRef(({settings:n},t)=>{const{unityProvider:i,isLoaded:a,error:l}=Ro(),d=kze();Dze();const f=dc(),y=Qze(d),{user:v}=N.useContext(Hs),[b,R]=N.useState(!1),[I,k]=N.useState(window.devicePixelRatio),[M,L]=Nze();$oe().find(ut=>ut.isLocalPlayer);const[z,Y]=N.useState(!0),[K,ne]=N.useState(!0),ce=n.spaceID||"default";Xze(),qze(ce),IGe(ce,{enableDebugLogs:!0});const{trackUnityEvent:oe}=oE(ce,{enableDebugLogs:!0}),[ge,X]=N.useState(!1),[J,te]=N.useState(!1),[ie,he]=N.useState(!1),fe=N.useMemo(()=>{const at=new URLSearchParams(window.location.search).get("sessionId")||ce;return console.log("WebGLRenderer: Using session ID:",at),at},[ce]),[de,ve]=N.useState(null);N.useEffect(()=>{v!=null&&v.uid&&ru(v.uid).then(ut=>{ve(ut),console.log("WebGLRenderer: User profile loaded:",(ut==null?void 0:ut.Nickname)||"Unknown")}).catch(ut=>{console.error("Error fetching user profile:",ut)})},[v==null?void 0:v.uid]),N.useEffect(()=>{const ut=async()=>{if(l){console.log("WebGLRenderer: Unity error, showing sign-in modal"),te(!0),he(!0);return}if(v){te(!1);return}try{const at=await Ma(ce);at&&at.allowGuestUsers===!0?(console.log("WebGLRenderer: Guest users confirmed allowed, not showing sign-in modal"),te(!1)):(console.log("WebGLRenderer: Guest users not allowed or space data invalid, showing sign-in modal"),te(!0),he(!0))}catch{console.log("WebGLRenderer: Cannot verify space guest access, showing sign-in modal for security"),te(!0),he(!0)}},mt=setTimeout(()=>{ut()},1e3);return()=>clearTimeout(mt)},[l,v,ce]),N.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const ut=()=>{console.log("WebGLRenderer: Player instantiated event received"),ne(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ne(!0)),rh.subscribe(nh.playerInstantiated,ut);const mt=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ne(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{rh.unsubscribe(nh.playerInstantiated,ut),clearTimeout(mt)}},[K]),N.useEffect(()=>{const ut=()=>{console.log("WebGLRenderer: Modal opened"),he(!0)},mt=()=>{console.log("WebGLRenderer: Modal closed"),he(!1)};return window.addEventListener("modal-opened",ut),window.addEventListener("modal-closed",mt),()=>{window.removeEventListener("modal-opened",ut),window.removeEventListener("modal-closed",mt)}},[]),N.useEffect(()=>{he(M!==null)},[M]),N.useEffect(()=>{a||d?setTimeout(()=>{R(!0),console.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),N.useEffect(()=>{a&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(ut){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",ut)}},1e3)},[a,i]),N.useEffect(()=>{const ut=document.getElementById("webgl-root");return ut?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),ut.style.display="block",ut.getAttribute("data-space-id")!==ce&&(ut.setAttribute("data-space-id",ce),console.log(`WebGLRenderer: Set data-space-id attribute to ${ce}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[ce]),N.useEffect(()=>{const ut=()=>{const Vt=UU();Vt?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Vt.tabIndex=1,Vt.style.outline="none",Vt.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ie||lR(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};ut();const mt=setTimeout(ut,1e3),at=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),ut()};return window.addEventListener("unityReady",at),()=>{clearTimeout(mt),window.removeEventListener("unityReady",at)}},[a,ie]);const Te=N.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ie||lR(!0)},[ie]);N.useEffect(()=>{if(a&&i){const ut=UU();if(ut)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),ut.addEventListener("click",Te),()=>{ut.removeEventListener("click",Te)}}},[a,i,Te]),N.useEffect(()=>{if(a&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const ut=mt=>{if(ie){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(mt.target.tagName==="INPUT"||mt.target.tagName==="TEXTAREA"||mt.target.tagName==="SELECT"||mt.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(mt.target.closest(".chakra-modal__content")||mt.target.closest('[role="dialog"]')||mt.target.closest('[role="menu"]')||mt.target.closest(".chakra-popover__content")||mt.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const at=UU();if(at&&(mt.target===at||at.contains(mt.target)))return;if(mt.target.closest(".webgl-overlay")||mt.target.closest(".game-ui")||mt.target.closest(".player-list")||mt.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{ie||lR(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{at&&!ie&&((at.tabIndex===void 0||at.tabIndex<0)&&(at.tabIndex=1),at.focus(),lR(!0))},50)};return document.addEventListener("click",ut,!0),()=>{document.removeEventListener("click",ut,!0)}}},[a,i,ie]),N.useEffect(()=>{const ut=mt=>{console.log("WebGLRenderer: Received 'sendUserToUnity' event"),console.log("WebGLRenderer: Sending to Unity via 'FirebaseUserFromReact':",mt),console.log("WebGLRenderer: User data keys:",Object.keys(mt)),console.log("WebGLRenderer: RPM URL being sent:",mt.rpmURL),console.log("WebGLRenderer: Nickname being sent:",mt.Nickname),console.log("WebGLRenderer: Username being sent:",mt.username),console.log("WebGLRenderer: Is Guest:",mt.isGuest),console.log("WebGLRenderer: UID:",mt.uid),console.log("WebGLRenderer: JSON data being sent to Unity:",JSON.stringify(mt,null,2)),f("FirebaseUserFromReact",mt)};return rh.subscribe(nh.sendUserToUnity,ut),()=>rh.unsubscribe(nh.sendUserToUnity,ut)},[f]);const{setFullscreenRef:Fe,fullscreenRef:be}=hh();N.useEffect(()=>{Fe(t.current)},[t,Fe]);const Ce=()=>{Y(!z)},Ae=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:K,showVoiceChat:Ae,sessionId:fe}),N.useEffect(()=>{const ut=mt=>{console.log("Edit mode changed event:",mt.detail),X(mt.detail.enabled)};return window.addEventListener("editModeChanged",ut),()=>{window.removeEventListener("editModeChanged",ut)}},[]),Hoe(),Uze();const De=N.useRef(null),{clickedPortal:Ee,clearClickedPortal:Ne}=Yze(),[je,Ke]=N.useState(!1),[ot,_t]=N.useState(!1),[lt,vt]=N.useState(""),[rt,bt]=N.useState("");N.useEffect(()=>{async function ut(){if(vt(""),bt(""),Ee&&!ge){let mt=Ee.targetSpaceId;if(!mt&&Ee.portalId)try{const at=Ir(ir,"spaces",ce,"portals",Ee.portalId),Vt=await Ho(at);Vt.exists()&&(mt=Vt.data().targetSpaceId)}catch{}if(mt)try{const at=await Ma(mt);vt((at==null?void 0:at.name)||mt),bt((at==null?void 0:at.slug)||""),_t(!0)}catch{vt(mt),bt(""),_t(!0)}else vt(""),bt(""),_t(!0)}}Ee&&ge&&Ke(!0),Ee&&!ge&&ut()},[Ee,ge,ce]);const $t=()=>{console.log("Closing portal editor"),Ke(!1),Ne()};return console.log("WebGLRenderer render state:",{isPortalEditorOpen:je,clickedPortal:Ee,isEditMode:ge}),Jze(ce),Xoe(),w.jsxs(ht,{className:"webgl-renderer",children:[n.urlLoadingBackground&&w.jsx(pae,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:De}),!J&&w.jsx(fae,{containerRef:De}),J&&w.jsx(ht,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:w.jsx(cC,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),w.jsx(CGe,{spaceId:ce,isEditMode:ge}),w.jsx(jF,{containerRef:be.current?be:document.body,children:w.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[w.jsxs(ht,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[w.jsx(eWe,{}),v&&w.jsx(yGe,{size:"md"}),Ae&&w.jsxs(cae,{appId:AGe,channel:fe,uid:v==null?void 0:v.uid,enabled:!0,children:[w.jsx(kWe,{size:"md",defaultMuted:!0,joinOnClick:!0}),w.jsx(DWe,{userNickname:de==null?void 0:de.Nickname})]}),w.jsx(yWe,{}),w.jsx(ht,{position:"relative",zIndex:"9999",children:w.jsx(rGe,{onTogglePlayerList:Ce,spaceID:ce,containerRef:De})})]}),w.jsxs(ht,{ref:De,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[w.jsx(ht,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),w.jsx(ht,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i&&!J?w.jsx(Woe.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):w.jsx(ht,{width:"100%",height:"100%",backgroundColor:"#333",display:"flex",alignItems:"center",justifyContent:"center",children:J&&w.jsx(it,{color:"white",fontSize:"lg",children:"Authentication Required"})})}),w.jsx(ht,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:w.jsx(Zze,{})})]}),w.jsx(ht,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&w.jsx(yp,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),w.jsxs(ht,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&w.jsx(tWe,{}),w.jsx(SWe,{})]}),w.jsx(bWe,{}),w.jsx(wWe,{isOpen:M!==null,onClose:()=>{console.log(" Closing nameplate modal"),L()},playerName:(M==null?void 0:M.playerName)||"Unknown Player",playerId:(M==null?void 0:M.playerId)||"Unknown ID"}),w.jsx(TWe,{isVisible:z,onToggleVisibility:Y,spaceID:ce}),w.jsx(fGe,{}),w.jsx(ht,{position:"absolute",top:4,right:4,zIndex:1e3,children:je&&Ee&&w.jsx(vGe,{isOpen:je,onClose:$t,portal:Ee,spaceId:ce})}),!ge&&ot&&w.jsxs(Rs,{isOpen:ot,onClose:()=>{_t(!1),Ne(),vt(""),bt("")},isCentered:!0,children:[w.jsx(As,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),w.jsxs(Cs,{bg:"#1a1a1a",borderRadius:"xl",border:"1px solid #333",maxW:"420px",p:0,children:[w.jsx(To,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",textAlign:"center",children:lt?`Visit ${lt}?`:"Visit Space?"}),w.jsx(zs,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),w.jsx(Is,{pb:8,pt:2,px:8,children:w.jsxs(Bi,{mt:4,gap:6,justify:"center",children:[w.jsx($n,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{_t(!1),Ne(),vt(""),bt("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),w.jsx($n,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:async()=>{if(Ee&&v){let ut=null;if(Ee.portalId){const mt=Ee.portalId.split("_");mt.length>=3&&(ut=mt[2])}await oe(ao.UNITY.PORTAL_NAVIGATE,{category:co.NAVIGATION,portalId:Ee.portalId,targetSpaceId:ut,sourceSpaceId:ce,targetSpaceName:lt,targetSpaceSlug:rt,isEditMode:!1,navigationType:"confirmed",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",Ee.portalId,"",ut)}rt&&window.open(`https://www.spacesmetaverse.com/w/${rt}`,"_blank","noopener"),_t(!1),Ne(),vt(""),bt("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),w.jsx(wGe,{})]})})]})});m3.displayName="WebGLRenderer";m3.propTypes={settings:Pn.shape({urlLoadingBackground:Pn.string,videoBackgroundUrl:Pn.string,showAuthButton:Pn.bool,showDisruptiveLogo:Pn.bool,urlDisruptiveLogo:Pn.string,showHelpButton:Pn.bool,enableVoiceChat:Pn.bool,spaceID:Pn.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:t=>(console.log("HISPlayer: mute called with state:",t),!0),isMuted:!1,seek:t=>(console.log("HISPlayer: seek called with time:",t),!0),setVolume:t=>(console.log("HISPlayer: setVolume called with volume:",t),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:t=>(console.log("HISPlayer: setUnityContext called with:",t),window.hisPlayerContextId=t,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:t=>(console.log("HISPlayer: setProperties called with:",t),!0),setMultiPaths:t=>(console.log("HISPlayer: setMultiPaths called with:",t),window._hisplayer_paths=t,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(G.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),G.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const t=new window.MultipleView;if(t&&t.multiView&&typeof t.multiView.setUnityContext=="function")return t.multiView.setUnityContext(n),window._hisplayer_instance=t,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const t=new window.MultipleView;return t.multiView.setUnityContext(n),window._hisplayer_instance=t,!0}}catch(t){console.error("HISPlayer: Error in setUpContext:",t);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+t.message)}return!1}}const gae=({spaceID:n,overrideSettings:t})=>{const i=N.useRef(null),[a,l]=N.useState(!0),{loading:d,isUserBannedFromSpace:f,user:y}=N.useContext(Hs),[v,b]=N.useState(!1),[R,I]=N.useState(!1),[k,M]=N.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[L,j]=N.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return N.useEffect(()=>{(async()=>{try{const Y=await Ma(n);if(Y){if(console.log("Space data: ",Y),console.log("WebGLLoader: Current user state:",y?"authenticated":"not authenticated"),console.log("WebGLLoader: allowGuestUsers setting:",Y.allowGuestUsers),!y&&(!Y.allowGuestUsers||Y.allowGuestUsers!==!0)){console.log("WebGLLoader:  AUTHENTICATION REQUIRED - guest users not allowed"),console.log("WebGLLoader:  BLOCKING UNITY INITIALIZATION"),I(!0),l(!1);return}else!y&&Y.allowGuestUsers===!0?(console.log("WebGLLoader:  Guest users allowed, proceeding with Unity load"),I(!1)):y&&(console.log("WebGLLoader:  User authenticated, proceeding with Unity load"),I(!1));M(oe=>({...oe,spaceID:n,loaderUrl:Y.loaderUrl,dataUrl:Y.dataUrl,frameworkUrl:Y.frameworkUrl,codeUrl:Y.codeUrl}));const K=await OO(L.urlDisruptiveLogo);let ne="";if(Y.backgroundUrl)ne=Y.backgroundUrl;else if(Y.backgroundGsUrl)try{ne=await OO(Y.backgroundGsUrl)}catch(oe){G.warn("WebGLLoader: Error fetching background from GS URL:",oe)}else if(Y.gsUrlLoadingBackground)try{ne=await OO(Y.gsUrlLoadingBackground)}catch(oe){G.warn("WebGLLoader: Error fetching background from legacy GS URL:",oe)}let ce="";Y.videoBackgroundUrl&&(ce=Y.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",ce)),j(oe=>({...oe,urlLoadingBackground:ne,videoBackgroundUrl:ce,showAuthButton:Y.showAuthButton!==void 0?Y.showAuthButton:!0,showDisruptiveLogo:Y.showDisruptiveLogo!==void 0?Y.showDisruptiveLogo:!0,showHelpButton:Y.showHelpButton!==void 0?Y.showHelpButton:!0,enableVoiceChat:Y.enableVoiceChat!==void 0?Y.enableVoiceChat:!0,urlDisruptiveLogo:K,spaceID:n,...t||{}})),ce&&(console.log("WebGLLoader: Dispatching video background event with URL:",ce),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:ce}}))),l(!1)}else G.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(Y){G.error("WebGLLoader: Error fetching space data:",Y)}finally{l(!1)}})()},[n,L.urlDisruptiveLogo,t,y]),N.useEffect(()=>{(async()=>{if(!d&&y&&f)try{const Y=await f(n);b(Y)}catch(Y){G.error("WebGLLoader: ban check error",Y)}})()},[d,y,n,f]),N.useEffect(()=>{a||(G.log("WebGLLoader: Unity config from Firebase",k),G.log("WebGLLoader: Space settings from Firebase",L))},[a]),d?w.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Loading user"}):v?w.jsx("div",{className:"flex justify-center items-center h-full mt-12 text-red-500",children:"Access Denied: You have been banned from this space."}):R?w.jsx(ht,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:"1000",children:w.jsx(cC,{mode:"button",label:"Sign In Required",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}):n?w.jsx(w.Fragment,{children:a?w.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):w.jsx(Oze,{...k,children:w.jsx(m3,{ref:i,settings:L})})}):null};gae.propTypes={spaceID:Pn.string.isRequired,overrideSettings:Pn.object};function zQ(){const n=document.getElementById("webgl-root");if(n){const t=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=N.useState(null);return N.useEffect(()=>{vUe(i).then(d)},[]),l?w.jsx(_Ne,{theme:l,children:w.jsx(U8e,{children:w.jsx(V8e,{children:w.jsx(gae,{spaceID:t})})})}):w.jsx("div",{children:"Loading theme..."})};try{iEe.createRoot(n).render(w.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",zQ):zQ());export{EEe as a,HSe as b,Ji as c,zSe as d,OGe as e,PGe as f,xSe as g,Yu as i,_p as m,WCe as t};
